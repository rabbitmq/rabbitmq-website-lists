From pc88mxer at gmail.com  Wed Jun  1 06:34:19 2011
From: pc88mxer at gmail.com (E R)
Date: Wed, 1 Jun 2011 00:34:19 -0500
Subject: [rabbitmq-discuss] high availability solutions?
Message-ID: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>

Hello,

I am wondering generally how one architects a rabbitmq system so that
it is tolerant of a node going down or being taken offline.

Specifically...

1. Is there ever a need to stop and restart the rabbitmq process, i.e.
for maintenance, re-configuration, etc.?

2. If there is a need to restart the rabbitmq process, how do people
generally assure that the queuing system is available when a rabbitmq
server is down? Put retry code in the client? Have multiple servers
that the client automatically fails over to?

3. As a solution to the above problem, what about running a "buffering
queue" in front of a main queue server? This would allow the main
server to be taken offline for short periods of time while still
allowing the application to continue inject messages into the queuing
system. Good idea? overkill? introduces other problems?

In my particular case latency in the queuing system is not a concern,
but I don't want to hold up the application if a queuing node goes
down or is taken offline.

Thanks,
ER

From rafalkot at gmail.com  Wed Jun  1 10:59:37 2011
From: rafalkot at gmail.com (KooT)
Date: Wed, 1 Jun 2011 02:59:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika AttributeError: Channel instance has no
	attribute 'start_consuming'
In-Reply-To: <9C776B18231D420BA49AB1539493BF05@myyearbook.com>
References: <aee61729-6939-434c-bcdb-03b5cdd23318@b1g2000yql.googlegroups.com>
	<456D69DC138D4B3EB5FE3CE716084E43@myyearbook.com>
	<593729ae-efb9-4749-b9c1-28352deb4705@24g2000yqk.googlegroups.com>
	<BANLkTinYD9iQorBPa95EEipNM-E1TRSP1g@mail.gmail.com>
	<e922a059-762c-4960-9afb-544c6968ee8c@x6g2000yqj.googlegroups.com>
	<1C343F08B9574F78B9A4AC7C4816E849@myyearbook.com>
	<c601f5a3-9d7a-4bf3-be41-6c480c3f28d2@z13g2000yqg.googlegroups.com>
	<9C776B18231D420BA49AB1539493BF05@myyearbook.com>
Message-ID: <6048db71-0c87-49ee-b9b4-f409a05dd5c8@g12g2000yqd.googlegroups.com>

I had open 'mc', and on right panel there wasn't my home dir :)
Will try virtualenv. Again, thank You for Your time! very much
appreciate it!

On 31 Maj, 20:32, "Gavin M. Roy" <g... at myyearbook.com> wrote:
> Is it possible that an older version of pika is also installed in the global scope?
>
> You could install in virtualenv to keep it local:
>
> gmr at binti ~ $ virtualenv --no-site-packages test
> New python executable in test/bin/python2.6
> Also creating executable in test/bin/python
> Installing setuptools............done.
> Installing pip...............done.
> gmr at binti ~ $ cd test/
> gmr at binti ~/test $ ls
> bin include lib lib64
> gmr at binti ~/test $ source bin/activate
> (test)gmr at binti ~/test $ pip install pika
> Downloading/unpacking pika
> Downloading pika-0.9.5.tar.gz
> Running setup.py egg_info for package pika
> Installing collected packages: pika
> Running setup.py install for pika
> Successfully installed pika
> Cleaning up...
> (test)gmr at binti ~/test $ python -c "import pika;print pika.__version__"
> 0.9.5
> (test)gmr at binti ~/test $
>
>
>
>
>
>
>
> On Tuesday, May 31, 2011 at 2:27 PM, KooT wrote:
> > I don't have root access there, i want pika as local lib :|
>
> > On 31 Maj, 20:25, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > That doesn't look like a 0.9.5 install.
>
> > > Have you tried pip or easy_install?
>
> > > gmr at binti ~ $ sudo pip install pika
> > > Downloading/unpacking pika
> > > Downloading pika-0.9.5.tar.gz
> > > Running setup.py egg_info for package pika
> > > Installing collected packages: pika
> > > Running setup.py install for pika
> > > Successfully installed pika
> > > Cleaning up...
> > > gmr at binti ~ $ python -c "import pika;print pika.__version__"
> > > 0.9.5
>
> > > On Tuesday, May 31, 2011 at 2:21 PM, KooT wrote:
> > > > rkot at a0:~$ python2.7 -c "import pika;print pika.__version__"
> > > > Traceback (most recent call last):
> > > > File "<string>", line 1, in <module>
> > > > AttributeError: 'module' object has no attribute '__version__'
>
> > > > On 31 Maj, 20:15, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > > > Sounds like it may not be Pika 0.9.5, how did you install?
>
> > > > > What output do you get if you do:
>
> > > > > python -c "import pika;print pika.__version__"
>
> > > > > On Tue, May 31, 2011 at 2:10 PM, KooT <rafal... at gmail.com (http://gmail.com)> wrote:
> > > > > > Yes, its worker.py from
> > > > > >http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> > > > > > #!/usr/bin/env python
> > > > > > import pika
> > > > > > import time
>
> > > > > > connection = pika.BlockingConnection(pika.ConnectionParameters(
> > > > > > host='localhost'))
> > > > > > channel = connection.channel()
>
> > > > > > channel.queue_declare(queue='task_queue', durable=True)
> > > > > > print ' [*] Waiting for messages. To exit press CTRL+C'
>
> > > > > > def callback(ch, method, properties, body):
> > > > > > print " [x] Received %r" % (body,)
> > > > > > time.sleep( body.count('.') )
> > > > > > print " [x] Done"
> > > > > > ch.basic_ack(delivery_tag = method.delivery_tag)
>
> > > > > > channel.basic_qos(prefetch_count=1)
> > > > > > channel.basic_consume(callback,
> > > > > > queue='task_queue')
>
> > > > > > channel.start_consuming()
>
> > > > > > On 31 Maj, 16:02, "Gavin M. Roy" <g... at myyearbook.com (http://myyearbook.com)> wrote:
> > > > > > > Are you using the BlockingConnection adapter?
>
> > > > > > > On Tuesday, May 31, 2011 at 9:30 AM, KooT wrote:
> > > > > > > > python worker.py
> > > > > > > > [*] Waiting for messages. To exit press CTRL+C
> > > > > > > > Traceback (most recent call last):
> > > > > > > > File "worker.py", line 22, in ?
> > > > > > > > channel.start_consuming()
> > > > > > > > AttributeError: Channel instance has no attribute 'start_consuming'
>
> > > > > > > > I got pika 0.9.5
> > > > > > > > _______________________________________________
> > > > > > > > rabbitmq-discuss mailing list
> > > > > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com) (mailto:
> > > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com))
> > > > > > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > > > > > _______________________________________________
> > > > > > > rabbitmq-discuss mailing list
> > > > > > > rabbitmq-disc... at lists.rabbitmq.comhttps://
> > > > > > lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss (http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com)
> > > > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss(...)
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com (mailto:rabbitmq-disc... at lists.rabbitmq.com (http://lists.rabbitmq.com))
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss(http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss)
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com (mailto:rabbitmq-disc... at lists.rabbitmq.com)
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Simone.Busoli at ferrari.com  Wed Jun  1 11:52:24 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Wed, 1 Jun 2011 10:52:24 +0000
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
Message-ID: <88E590DC4586974D825FC82AE798294E5200AFCE@GSVCLU03.ges.ferlan.it>

Hi,

I am trying to achieve a scenario in which messages are published from some data source into a RabbitMQ exchange and clients should be able to receive the full history of messages flown through that exchange, regardless of the exact moment in time when they connect.

I've been thinking to solve it by setting up a proxy which subscribes to the exchange where messages are published using its own queue, keeps an internal storage of the messages and accepts requests from clients.
When a request from a client arrives it just replays the full message history to the client by publishing the messages to the client queue (supplied in the ReplyTo field), then binds the client queue to the messages exchange, so that the client from this moment onwards starts receiving the "live" messages, and is pretty much unaware of what's happened; it simply just receives the whole history.

Now I am under the impression that there's a fundamental flaw in this reasoning, since the proxy cannot know when the message history has completed and he can switch the client to the live stream, because while it is replaying historical messages to the client other live messages might be arriving on the proxy's queue, thus getting into an endless loop.

I'm probably missing something obvious, any advice about how others would approach this scenario is appreciated.

Simone

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110601/f56fdab6/attachment-0001.htm>

From alexis at rabbitmq.com  Wed Jun  1 13:54:02 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 1 Jun 2011 13:54:02 +0100
Subject: [rabbitmq-discuss] Perl Net::RabbitMQ and failure conditions
In-Reply-To: <BANLkTimz4P1H+NgiAkdhQ_C3CNCjbmum7Q@mail.gmail.com>
References: <BANLkTim==hb=hDLCqEN=0J5vfbHQN14BOw@mail.gmail.com>
	<BANLkTi=BKveXBFiObCUDCvUcAhx3-8Oyrg@mail.gmail.com>
	<BANLkTimz4P1H+NgiAkdhQ_C3CNCjbmum7Q@mail.gmail.com>
Message-ID: <BANLkTi==ARxqdub+kay+83PHgLQnH8kVpg@mail.gmail.com>

Ronald

Have you been able to speak to the author(s) of the client?

alexis


On Tue, May 31, 2011 at 6:34 PM, Ronald J Kimball
<rkimball at pangeamedia.com> wrote:
> Hi, thanks for the response.? Unfortunately, I haven't really found an
> answer.
>
> We upgraded RabbitMQ to 2.4.1, after which Net::RabbitMQ no longer hangs
> when the remote server is up but the remote app is down.
>
> However, Net::RabbitMQ still returns a false success when the remote server
> or app goes down after the publisher connects to the local node.? (The queue
> is located on the remote app.)
>
> For now, we've switched to having a single node.? This decreases our
> throughput slightly, but at least we don't risk dropping messages.
>
> I think we must be doing something wrong, but I don't know what...
>
> Ronald
>
>
> On Tue, May 31, 2011 at 7:41 AM, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
>>
>> Ronald
>>
>> Were you able to find an answer to this?
>>
>> alexis
>>
>>
>>
>> On Thu, May 19, 2011 at 9:44 PM, Ronald J Kimball
>> <rkimball at pangeamedia.com> wrote:
>> > I'm trying to understand how RabbitMQ behaves under failure conditions,
>> > specifically when using the Net::RabbitMQ Perl module.
>> >
>> > We have RabbitMQ set up with three nodes, one on the backend, which
>> > holds
>> > the actual queues, and two on the frontend, which receive publish
>> > requests.
>> >
>> > RabbitMQ 2.2.0
>> > Net::RabbitMQ 0.1.8
>> >
>> >
>> > Below is the chart of behaviors that I have observed.
>> >
>> > "+" means the behavior is as I expected: either the message is
>> > successfully
>> > queued, or an error is thrown.
>> > "-" means the behavior is not as I expected, but can be managed:
>> > specifically, the process receives a SIGPIPE, which I can trap and
>> > recover
>> > from.
>> > "!" means the behavior is not as I expected, and cannot be managed: the
>> > message is not queued but no error is thrown and/or the process hangs.
>> >
>> > "App down" means I ran `rabbitmqctl stop_app`.? "Daemon down" means I
>> > ran
>> > `rabbitmqctl stop`.
>> >
>> > ? As publishing process starts up:
>> >
>> > ??? Remote daemon up, app up
>> > ????? + Everything okay
>> >
>> > ??? Remote daemon up, app down
>> > ????? ! Net::RabbitMQ hangs when declaring queue
>> >
>> > ??? Remote daemon down
>> > ????? + Net::RabbitMQ throws error when declaring queue
>> > ??????? "Declaring queue: server channel error 404, message: NOT_FOUND -
>> > no
>> > queue 'test' in vhost '/'"
>> >
>> > ??? Local daemon up, app down
>> > ????? + Net::RabbitMQ throws error when connecting
>> > ??????? "Opening socket: Connection refused"
>> >
>> > ??? Local daemon down
>> > ????? + Net::RabbitMQ throws error when connecting
>> > ??????? "Opening socket: Connection refused"
>> >
>> >
>> > ? After publishing process starts up:
>> >
>> > ??? Local app goes down
>> > ????? - Process receives SIGPIPE
>> >
>> > ??? Local daemon goes down
>> > ????? - Process receives SIGPIPE
>> >
>> > ??? Remote app goes down
>> > ????? ! Net::RabbitMQ falsely indicates success when publishing, then
>> > hangs
>> > (in DESTROY?)
>> >
>> > ??? Remote daemon goes down
>> > ????? ! Net::RabbitMQ falsely indicates success when publishing
>> >
>> >
>> > ??? Local app goes down, comes back up
>> > ????? - Process receives SIGPIPE
>> >
>> > ??? Local daemon goes down, comes back up
>> > ????? - Process receives SIGPIPE
>> >
>> > ??? Remote app goes down, comes back up
>> > ????? + Everything okay
>> >
>> > ??? Remote daemon goes down, comes back up
>> > ????? + Everything okay
>> >
>> >
>> > Have other people had these problems with Net::RabbitMQ?? Can we resolve
>> > these issues by changing something in our RabbitMQ configuration?
>> >
>> >
>> > thanks,
>> > Ronald
>> >
>> >
>> > P.S. Here's my script.
>> >
>> > #!/usr/local/bin/perl
>> >
>> > use strict;
>> > use warnings;
>> >
>> > use Net::RabbitMQ;
>> >
>> > $| = 1;
>> >
>> > $SIG{'PIPE'} = sub { die "SIGPIPE\n" };
>> >
>> > my $mq = Net::RabbitMQ->new();
>> >
>> > alarm(10);
>> >
>> > print "Connecting\n";
>> > $mq->connect('localhost', { user => 'engagement', password => '********'
>> > })
>> > ? or die "Can't connect to RabbitMQ\n";
>> >
>> > print "Opening channel\n";
>> > $mq->channel_open(1);
>> >
>> > print "Declaring exchange\n";
>> > $mq->exchange_declare(1, 'ee_exchange', { durable => 1 });
>> >
>> > print "Declaring queue\n";
>> > $mq->queue_declare(1, 'test', { durable => 1 });
>> >
>> > print "Binding queue\n";
>> > $mq->queue_bind(1, 'test', 'ee_exchange', 'ee_test');
>> >
>> > alarm(0);
>> >
>> > print "> ";
>> > <>;
>> >
>> > alarm(10);
>> >
>> > print "Publishing message\n";
>> > my $rc =
>> > ? $mq->publish(1, 'ee_test', 'hello world!',
>> > ?????????????? { exchange => 'ee_exchange', mandatory => 1, immediate =>
>> > 0
>> > },
>> > ?????????????? { delivery_mode => 2 });
>> > print "Result: $rc\n";
>> >
>> > __END__
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>

From jon at jbrisbin.com  Wed Jun  1 14:38:14 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 01 Jun 2011 08:38:14 -0500 (CDT)
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <88E590DC4586974D825FC82AE798294E5200AFCE@GSVCLU03.ges.ferlan.it>
Message-ID: <e2a25528-5368-4fad-bd79-97f589607ecd@jbrisbin.local>

I've been seriously considering adding this functionality to the Riak-backed custom exchange. It was something I thought I would add first time through but didn't. 

You'd have to use a custom exchange. Not sure if that's an issue in your scenario or not. 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

----- Original Message -----

> From: "Simone Busoli" <Simone.Busoli at ferrari.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, June 1, 2011 5:52:24 AM
> Subject: [rabbitmq-discuss] How to handle full exchange history
> delivery

> Hi,

> I am trying to achieve a scenario in which messages are published
> from some data source into a RabbitMQ exchange and clients should be
> able to receive the full history of messages flown through that
> exchange, regardless of the exact moment in time when they connect.

> I?ve been thinking to solve it by setting up a proxy which subscribes
> to the exchange where messages are published using its own queue,
> keeps an internal storage of the messages and accepts requests from
> clients.
> When a request from a client arrives it just replays the full message
> history to the client by publishing the messages to the client queue
> (supplied in the ReplyTo field), then binds the client queue to the
> messages exchange, so that the client from this moment onwards
> starts receiving the ?live? messages, and is pretty much unaware of
> what?s happened; it simply just receives the whole history.

> Now I am under the impression that there?s a fundamental flaw in this
> reasoning, since the proxy cannot know when the message history has
> completed and he can switch the client to the live stream, because
> while it is replaying historical messages to the client other live
> messages might be arriving on the proxy?s queue, thus getting into
> an endless loop.

> I?m probably missing something obvious, any advice about how others
> would approach this scenario is appreciated.

> Simone
> _________________________________________________________________________________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del
> destinatario e puo contenere informazioni che sono di natura
> privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del
> presente messaggio non e il destinatario designato, o il
> dipendente/agente responsabile
> per la consegna del messaggio al destinatario designato, si informa
> che ogni disseminazione, distribuzione o copiatura di questa
> comunicazione e
> strettamente proibita anche ai sensi del decreto legislativo 196/03 .
> Se avete ricevuto questo messaggio per errore, vi preghiamo di
> notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di
> procedere alla cancellazione di questa e-mail e relativi allegati
> dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may
> contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not
> the intended recipient, or the employee or agent responsible for
> delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is
> strictly
> prohibited. If you have received this e-mail in error, please notify
> us immediately by return e-mail and delete this e-mail and all
> attachments from
> your system.
> _________________________________________________________________________________________________________________

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110601/9525f0fd/attachment.htm>

From Simone.Busoli at ferrari.com  Wed Jun  1 14:43:58 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Wed, 1 Jun 2011 13:43:58 +0000
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <e2a25528-5368-4fad-bd79-97f589607ecd@jbrisbin.local>
References: <88E590DC4586974D825FC82AE798294E5200AFCE@GSVCLU03.ges.ferlan.it>
	<e2a25528-5368-4fad-bd79-97f589607ecd@jbrisbin.local>
Message-ID: <88E590DC4586974D825FC82AE798294E5200B0B1@GSVCLU03.ges.ferlan.it>

That?s what I thought as well, although I?m thinking about a couple of issues about it:


?         Lack of knowledge about Erlang, which is the language I?d have to use to build a custom exchange, I guess

?         Amount of memory it would require to store the entire history in memory. It needn?t be in memory actually, but I?m not sure what would be the recommended way if the storage has to be carried out by exchange itself. Mnesia perhaps, would it make sense?
_______________________________________________________________
Simone Busoli
Direzione risorse umane e segreteria generale ? Sistemi informativi gestione sportiva
Collaboratore
Ferrari S.p.A.     Via Ascari 55/57, 41053, Maranello (MO); Italy
T (+39) 0536-949.850
E simone.busoli at ferrari.com<mailto:simone.busoli at ferrari.com>  www.ferrari.com<http://www.ferrari.com/>

From: Jon Brisbin [mailto:jon at jbrisbin.com]
Sent: Wednesday, June 01, 2011 3:38 PM
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] How to handle full exchange history delivery

I've been seriously considering adding this functionality to the Riak-backed custom exchange. It was something I thought I would add first time through but didn't.

You'd have to use a custom exchange. Not sure if that's an issue in your scenario or not.


Thanks!

Jon Brisbin
http//jbrisbin.com

________________________________
From: "Simone Busoli" <Simone.Busoli at ferrari.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, June 1, 2011 5:52:24 AM
Subject: [rabbitmq-discuss] How to handle full exchange history delivery


Hi,

I am trying to achieve a scenario in which messages are published from some data source into a RabbitMQ exchange and clients should be able to receive the full history of messages flown through that exchange, regardless of the exact moment in time when they connect.

I?ve been thinking to solve it by setting up a proxy which subscribes to the exchange where messages are published using its own queue, keeps an internal storage of the messages and accepts requests from clients.
When a request from a client arrives it just replays the full message history to the client by publishing the messages to the client queue (supplied in the ReplyTo field), then binds the client queue to the messages exchange, so that the client from this moment onwards starts receiving the ?live? messages, and is pretty much unaware of what?s happened; it simply just receives the whole history.

Now I am under the impression that there?s a fundamental flaw in this reasoning, since the proxy cannot know when the message history has completed and he can switch the client to the live stream, because while it is replaying historical messages to the client other live messages might be arriving on the proxy?s queue, thus getting into an endless loop.

I?m probably missing something obvious, any advice about how others would approach this scenario is appreciated.

Simone

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
your system.
_________________________________________________________________________________________________________________

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110601/de75cd5a/attachment-0001.htm>

From irrer at umich.edu  Wed Jun  1 14:46:04 2011
From: irrer at umich.edu (Jim Irrer)
Date: Wed, 1 Jun 2011 09:46:04 -0400
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <e2a25528-5368-4fad-bd79-97f589607ecd@jbrisbin.local>
References: <88E590DC4586974D825FC82AE798294E5200AFCE@GSVCLU03.ges.ferlan.it>
	<e2a25528-5368-4fad-bd79-97f589607ecd@jbrisbin.local>
Message-ID: <BANLkTikS+ZvkHn44rJ=g6gojRThEX+DhWg@mail.gmail.com>

This sounds similar to this conversation:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/011933.html


Maybe the plugin is ready?

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Wed, Jun 1, 2011 at 9:38 AM, Jon Brisbin <jon at jbrisbin.com> wrote:

> I've been seriously considering adding this functionality to the
> Riak-backed custom exchange. It was something I thought I would add first
> time through but didn't.
>
> You'd have to use a custom exchange. Not sure if that's an issue in your
> scenario or not.
>
>
> Thanks!
>
> Jon Brisbin
> http//jbrisbin.com
>
>
> ------------------------------
>
> *From: *"Simone Busoli" <Simone.Busoli at ferrari.com>
> *To: *rabbitmq-discuss at lists.rabbitmq.com
> *Sent: *Wednesday, June 1, 2011 5:52:24 AM
> *Subject: *[rabbitmq-discuss] How to handle full exchange history delivery
>
>
>  Hi,
>
>
>
> I am trying to achieve a scenario in which messages are published from some
> data source into a RabbitMQ exchange and clients should be able to receive
> the full history of messages flown through that exchange, regardless of the
> exact moment in time when they connect.
>
>
>
> I?ve been thinking to solve it by setting up a proxy which subscribes to
> the exchange where messages are published using its own queue, keeps an
> internal storage of the messages and accepts requests from clients.
>
> When a request from a client arrives it just replays the full message
> history to the client by publishing the messages to the client queue
> (supplied in the ReplyTo field), *then* binds the client queue to the
> messages exchange, so that the client from this moment onwards starts
> receiving the ?live? messages, and is pretty much unaware of what?s
> happened; it simply just receives the whole history.
>
>
>
> Now I am under the impression that there?s a fundamental flaw in this
> reasoning, since the proxy cannot know when the message history has
> completed and he can switch the client to the live stream, because while it
> is replaying historical messages to the client other live messages might be
> arriving on the proxy?s queue, thus getting into an endless loop.
>
>
>
> I?m probably missing something obvious, any advice about how others would
> approach this scenario is appreciated.
>
>
>
> Simone
>
>
> _________________________________________________________________________________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del destinatario e
> puo contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
> messaggio non e il destinatario designato, o il dipendente/agente
> responsabile
> per la consegna del messaggio al destinatario designato, si informa che
> ogni disseminazione, distribuzione o copiatura di questa comunicazione e
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere
> alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
>
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may contain
> information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not the
> intended recipient, or the employee or agent responsible for delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us
> immediately by return e-mail and delete this e-mail and all attachments from
>
> your system.
>
> _________________________________________________________________________________________________________________
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110601/3725c1ab/attachment.htm>

From jon at jbrisbin.com  Wed Jun  1 15:58:39 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 01 Jun 2011 09:58:39 -0500 (CDT)
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <88E590DC4586974D825FC82AE798294E5200B0B1@GSVCLU03.ges.ferlan.it>
Message-ID: <ff0d7920-6cad-4eb6-8fd0-a432cd69d2e3@jbrisbin.local>

Maybe I wasn't being clear: 

I've already written a custom exchange that stores every message it receives in Riak (http://wiki.basho.com/). I'm going to be talking about it next week at Erlang Factory in London, as a matter of fact. :) 

https://github.com/jbrisbin/riak-exchange 

When I was writing it, I thought it would be really easy to, when a new queue is bound to this exchange, go fetch all the messages in that bucket and send them to the queue. 

Since I'm using Riak, the messages themselves are not all stored in memory. 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

----- Original Message -----

> From: "Simone Busoli" <Simone.Busoli at ferrari.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, June 1, 2011 8:43:58 AM
> Subject: Re: [rabbitmq-discuss] How to handle full exchange history
> delivery

> That?s what I thought as well, although I?m thinking about a couple
> of issues about it:

> ? Lack of knowledge about Erlang, which is the language I?d have to
> use to build a custom exchange, I guess
> ? Amount of memory it would require to store the entire history in
> memory. It needn?t be in memory actually, but I?m not sure what
> would be the recommended way if the storage has to be carried out by
> exchange itself. Mnesia perhaps, would it make sense?

> _______________________________________________________ ________
> Simone Busoli
> Direzione risorse umane e segreteria generale ? Sistemi informativi
> gestione sportiva
> Collaboratore
> Ferrari S.p.A. Via Ascari 55/57, 41053, Maranello (MO); Italy
> T (+39) 0536-949.850
> E simone.busoli at ferrari.com www.ferrari.com

> From: Jon Brisbin [mailto:jon at jbrisbin.com]
> Sent: Wednesday, June 01, 2011 3:38 PM
> To: Busoli, Simone
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] How to handle full exchange history
> delivery

> I've been seriously considering adding this functionality to the
> Riak-backed custom exchange. It was something I thought I would add
> first time through but didn't.

> You'd have to use a custom exchange. Not sure if that's an issue in
> your scenario or not.

> Thanks!

> Jon Brisbin
> http//jbrisbin.com

> ----- Original Message -----

> > From: "Simone Busoli" <Simone.Busoli at ferrari.com>
> 
> > To: rabbitmq-discuss at lists.rabbitmq.com
> 
> > Sent: Wednesday, June 1, 2011 5:52:24 AM
> 
> > Subject: [rabbitmq-discuss] How to handle full exchange history
> > delivery
> 

> > Hi,
> 

> > I am trying to achieve a scenario in which messages are published
> > from some data source into a RabbitMQ exchange and clients should
> > be
> > able to receive the full history of messages flown through that
> > exchange, regardless of the exact moment in time when they connect.
> 

> > I?ve been thinking to solve it by setting up a proxy which
> > subscribes
> > to the exchange where messages are published using its own queue,
> > keeps an internal storage of the messages and accepts requests from
> > clients.
> 
> > When a request from a client arrives it just replays the full
> > message
> > history to the client by publishing the messages to the client
> > queue
> > (supplied in the ReplyTo field), then binds the client queue to the
> > messages exchange, so that the client from this moment onwards
> > starts receiving the ?live? messages, and is pretty much unaware of
> > what?s happened; it simply just receives the whole history.
> 

> > Now I am under the impression that there?s a fundamental flaw in
> > this
> > reasoning, since the proxy cannot know when the message history has
> > completed and he can switch the client to the live stream, because
> > while it is replaying historical messages to the client other live
> > messages might be arriving on the proxy?s queue, thus getting into
> > an endless loop.
> 

> > I?m probably missing something obvious, any advice about how others
> > would approach this scenario is appreciated.
> 

> > Simone
> 
> > _________________________________________________________________________________________________________________
> 
> > Questo messaggio e da intendersi esclusivamente ad uso del
> > destinatario e puo contenere informazioni che sono di natura
> > privilegiata, confidenziale
> 
> > o non divulgabile secondo le leggi vigenti. Se il lettore del
> > presente messaggio non e il destinatario designato, o il
> > dipendente/agente responsabile
> 
> > per la consegna del messaggio al destinatario designato, si informa
> > che ogni disseminazione, distribuzione o copiatura di questa
> > comunicazione e
> 
> > strettamente proibita anche ai sensi del decreto legislativo 196/03
> > .
> > Se avete ricevuto questo messaggio per errore, vi preghiamo di
> > notificarcelo
> 
> > immediatamente a mezzo e-mail di risposta e successivamente di
> > procedere alla cancellazione di questa e-mail e relativi allegati
> > dal vostro sistema.
> 
> > _________________________________________________________________________________________________________________
> 
> > This message is intended only for the use of the addressee and may
> > contain information that is privileged, confidential and exempt
> > from
> 
> > disclosure under applicable law. If the reader of this message is
> > not
> > the intended recipient, or the employee or agent responsible for
> > delivering the
> 
> > message to the intended recipient, you are hereby notified that any
> > dissemination, distribution or copying of this communication is
> > strictly
> 
> > prohibited. If you have received this e-mail in error, please
> > notify
> > us immediately by return e-mail and delete this e-mail and all
> > attachments from
> 
> > your system.
> 
> > _________________________________________________________________________________________________________________
> 

> > _______________________________________________
> 
> > rabbitmq-discuss mailing list
> 
> > rabbitmq-discuss at lists.rabbitmq.com
> 
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _________________________________________________________________________________________________________________
> Questo messaggio ? da intendersi esclusivamente ad uso del
> destinatario e pu? contenere informazioni che sono di natura
> privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del
> presente messaggio non ? il destinatario designato, o il
> dipendente/agente responsabile
> per la consegna del messaggio al destinatario designato, si informa
> che ogni disseminazione, distribuzione o copiatura di questa
> comunicazione ?
> strettamente proibita anche ai sensi del decreto legislativo 196/03 .
> Se avete ricevuto questo messaggio per errore, vi preghiamo di
> notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di
> procedere alla cancellazione di questa e-mail e relativi allegati
> dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may
> contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not
> the intended recipient, or the employee or agent responsible for
> delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is
> strictly
> prohibited. If you have received this e-mail in error, please notify
> us immediately by return e-mail and delete this e-mail and all
> attachments from
> your system.
> _________________________________________________________________________________________________________________

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110601/bbc6dc01/attachment-0001.htm>

From Simone.Busoli at ferrari.com  Wed Jun  1 16:15:26 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Wed, 1 Jun 2011 15:15:26 +0000
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <ff0d7920-6cad-4eb6-8fd0-a432cd69d2e3@jbrisbin.local>
References: <88E590DC4586974D825FC82AE798294E5200B0B1@GSVCLU03.ges.ferlan.it>
	<ff0d7920-6cad-4eb6-8fd0-a432cd69d2e3@jbrisbin.local>
Message-ID: <88E590DC4586974D825FC82AE798294E5200B1AA@GSVCLU03.ges.ferlan.it>

Thanks Jon, I misunderstood you probably.

WRT this:

When I was writing it, I thought it would be really easy to, when a new queue is bound to this exchange, go fetch all the messages in that bucket and send them to the queue.

I?m not sure it is, that was my main question actually. How do you figure out how to join the messages stored in the bucket and those arriving live so that the last message you send to the queue from those picked up from the bucket is followed exactly by its logical successor from those coming live?

Say I have messages 1..100 being published to the exchange, each time one arrives it?s stored. The exchange has received the first 50 messages and a client performs a binding of a queue to the exchange. So you start pulling the messages from the storage and sending them to the queue before forwarding any live messages. While you are pulling them out of the storage messages 51..60 are published to the exchange, how do you deal with them? Do you always pull from the storage? When do you stop pulling from the storage and relay to the queue directly what is being published to the exchange if you don?t know whether any new messages have arrived while you were pulling from the storage?
_______________________________________________________________
Simone Busoli
Direzione risorse umane e segreteria generale ? Sistemi informativi gestione sportiva
Collaboratore
Ferrari S.p.A.     Via Ascari 55/57, 41053, Maranello (MO); Italy
T (+39) 0536-949.850
E simone.busoli at ferrari.com<mailto:simone.busoli at ferrari.com>  www.ferrari.com<http://www.ferrari.com/>

From: Jon Brisbin [mailto:jon at jbrisbin.com]
Sent: Wednesday, June 01, 2011 4:59 PM
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] How to handle full exchange history delivery

Maybe I wasn't being clear:

I've already written a custom exchange that stores every message it receives in Riak (http://wiki.basho.com/). I'm going to be talking about it next week at Erlang Factory in London, as a matter of fact. :)

https://github.com/jbrisbin/riak-exchange

When I was writing it, I thought it would be really easy to, when a new queue is bound to this exchange, go fetch all the messages in that bucket and send them to the queue.

Since I'm using Riak, the messages themselves are not all stored in memory.

Thanks!

Jon Brisbin
http//jbrisbin.com

________________________________
From: "Simone Busoli" <Simone.Busoli at ferrari.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, June 1, 2011 8:43:58 AM
Subject: Re: [rabbitmq-discuss] How to handle full exchange history delivery


That?s what I thought as well, although I?m thinking about a couple of issues about it:


?         Lack of knowledge about Erlang, which is the language I?d have to use to build a custom exchange, I guess

?         Amount of memory it would require to store the entire history in memory. It needn?t be in memory actually, but I?m not sure what would be the recommended way if the storage has to be carried out by exchange itself. Mnesia perhaps, would it make sense?
_______________________________________________________________
Simone Busoli
Direzione risorse umane e segreteria generale ? Sistemi informativi gestione sportiva
Collaboratore
Ferrari S.p.A.     Via Ascari 55/57, 41053, Maranello (MO); Italy
T (+39) 0536-949.850
E simone.busoli at ferrari.com<mailto:simone.busoli at ferrari.com>  www.ferrari.com<http://www.ferrari.com/>

From: Jon Brisbin [mailto:jon at jbrisbin.com]
Sent: Wednesday, June 01, 2011 3:38 PM
To: Busoli, Simone
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] How to handle full exchange history delivery

I've been seriously considering adding this functionality to the Riak-backed custom exchange. It was something I thought I would add first time through but didn't.

You'd have to use a custom exchange. Not sure if that's an issue in your scenario or not.


Thanks!

Jon Brisbin
http//jbrisbin.com
________________________________
From: "Simone Busoli" <Simone.Busoli at ferrari.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wednesday, June 1, 2011 5:52:24 AM
Subject: [rabbitmq-discuss] How to handle full exchange history delivery

Hi,

I am trying to achieve a scenario in which messages are published from some data source into a RabbitMQ exchange and clients should be able to receive the full history of messages flown through that exchange, regardless of the exact moment in time when they connect.

I?ve been thinking to solve it by setting up a proxy which subscribes to the exchange where messages are published using its own queue, keeps an internal storage of the messages and accepts requests from clients.
When a request from a client arrives it just replays the full message history to the client by publishing the messages to the client queue (supplied in the ReplyTo field), then binds the client queue to the messages exchange, so that the client from this moment onwards starts receiving the ?live? messages, and is pretty much unaware of what?s happened; it simply just receives the whole history.

Now I am under the impression that there?s a fundamental flaw in this reasoning, since the proxy cannot know when the message history has completed and he can switch the client to the live stream, because while it is replaying historical messages to the client other live messages might be arriving on the proxy?s queue, thus getting into an endless loop.

I?m probably missing something obvious, any advice about how others would approach this scenario is appreciated.

Simone

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
your system.
_________________________________________________________________________________________________________________

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
your system.
_________________________________________________________________________________________________________________

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110601/6c16cfe6/attachment-0001.htm>

From jon at jbrisbin.com  Wed Jun  1 16:50:46 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 01 Jun 2011 10:50:46 -0500 (CDT)
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <88E590DC4586974D825FC82AE798294E5200B1AA@GSVCLU03.ges.ferlan.it>
Message-ID: <90509f6f-a1dc-4631-8e4a-e60ae6e18d6b@jbrisbin.local>

I'm not a big fan of forcing the message broker to keep fascist control over message ordering. Spring Integration has great tools for handling splitting and aggregation that can do this message ordering for you, which means your message broker situation can be much more flexible. 

In this particular case, the only way to guarantee you won't receive new messages before you've finished sending them the old ones is to suspend message delivery of new messages to the newly-bound queue until it is finished sending the old ones. One would have to literally queue requests to route messages internally (to the exchange). The problem is that exchanges are stateless. One would have to actually store new message routing requests in mnesia or something based on whether or not the currently-being-filled queue has a new routing request pending. 

All that said, it's technically possible to implement this kind of behaviour in the broker. I'm just not sure it would be a good idea. :) Messaging applications are, after all, supposed to be "A"synchronous, which means, necessarily, undetermined ordering. If ordering is really that important, then you don't want a message broker, you want a datastore and a cursor of some sort to sequentially process ordered items. You need, in fact, a datastore just like the one I'm currently proof-of-concepting (is that a word? ;) in my spare time, which is an asynchronous datastore that mixes messaging and data storage to achieve very closely to what you're wanting here. ;) 

Thanks! 

Jon Brisbin 
http//jbrisbin.com 

----- Original Message -----

> From: "Simone Busoli" <Simone.Busoli at ferrari.com>
> To: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Wednesday, June 1, 2011 10:15:26 AM
> Subject: Re: [rabbitmq-discuss] How to handle full exchange history
> delivery

> Thanks Jon, I misunderstood you probably.

> WRT this:

> When I was writing it, I thought it would be really easy to, when a
> new queue is bound to this exchange, go fetch all the messages in
> that bucket and send them to the queue.

> I?m not sure it is, that was my main question actually. How do you
> figure out how to join the messages stored in the bucket and those
> arriving live so that the last message you send to the queue from
> those picked up from the bucket is followed exactly by its logical
> successor from those coming live?

> Say I have messages 1..100 being published to the exchange, each time
> one arrives it?s stored. The exchange has received the first 50
> messages and a client performs a binding of a queue to the exchange.
> So you start pulling the messages from the storage and sending them
> to the queue before forwarding any live messages. While you are
> pulling them out of the storage messages 51..60 are published to the
> exchange, how do you deal with them? Do you always pull from the
> storage? When do you stop pulling from the storage and relay to the
> queue directly what is being published to the exchange if you don?t
> know whether any new messages have arrived while you were pulling
> from the storage?

> _______________________________________________________________
> Simone Busoli
> Direzione risorse umane e segreteria generale ? Sistemi informativi
> gestione sportiva
> Collaboratore
> Ferrari S.p.A. Via Ascari 55/57, 41053, Maranello (MO); Italy
> T (+39) 0536-949.850
> E simone.busoli at ferrari.com www.ferrari.com

> From: Jon Brisbin [mailto:jon at jbrisbin.com]
> Sent: Wednesday, June 01, 2011 4:59 PM
> To: Busoli, Simone
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] How to handle full exchange history
> delivery

> Maybe I wasn't being clear:

> I've already written a custom exchange that stores every message it
> receives in Riak ( http://wiki.basho.com/ ). I'm going to be talking
> about it next week at Erlang Factory in London, as a matter of fact.
> :)

> https://github.com/jbrisbin/riak-exchange

> When I was writing it, I thought it would be really easy to, when a
> new queue is bound to this exchange, go fetch all the messages in
> that bucket and send them to the queue.

> Since I'm using Riak, the messages themselves are not all stored in
> memory.

> Thanks!

> Jon Brisbin
> http//jbrisbin.com

> ----- Original Message -----

> > From: "Simone Busoli" <Simone.Busoli at ferrari.com>
> 
> > To: rabbitmq-discuss at lists.rabbitmq.com
> 
> > Sent: Wednesday, June 1, 2011 8:43:58 AM
> 
> > Subject: Re: [rabbitmq-discuss] How to handle full exchange history
> > delivery
> 

> > That?s what I thought as well, although I?m thinking about a couple
> > of issues about it:
> 

> > ? Lack of knowledge about Erlang, which is the language I?d have to
> > use to build a custom exchange, I guess
> 
> > ? Amount of memory it would require to store the entire history in
> > memory. It needn?t be in memory actually, but I?m not sure what
> > would be the recommended way if the storage has to be carried out
> > by
> > exchange itself. Mnesia perhaps, would it make sense?
> 

> > _______________________________________________________ ________
> 
> > Simone Busoli
> 
> > Direzione risorse umane e segreteria generale ? Sistemi informativi
> > gestione sportiva
> 
> > Collaboratore
> 
> > Ferrari S.p.A. Via Ascari 55/57, 41053, Maranello (MO); Italy
> 
> > T (+39) 0536-949.850
> 
> > E simone.busoli at ferrari.com www.ferrari.com
> 

> > From: Jon Brisbin [mailto:jon at jbrisbin.com]
> 
> > Sent: Wednesday, June 01, 2011 3:38 PM
> 
> > To: Busoli, Simone
> 
> > Cc: rabbitmq-discuss at lists.rabbitmq.com
> 
> > Subject: Re: [rabbitmq-discuss] How to handle full exchange history
> > delivery
> 

> > I've been seriously considering adding this functionality to the
> > Riak-backed custom exchange. It was something I thought I would add
> > first time through but didn't.
> 

> > You'd have to use a custom exchange. Not sure if that's an issue in
> > your scenario or not.
> 

> > Thanks!
> 

> > Jon Brisbin
> 
> > http//jbrisbin.com
> 

> > > From: "Simone Busoli" <Simone.Busoli at ferrari.com>
> > 
> 
> > > To: rabbitmq-discuss at lists.rabbitmq.com
> > 
> 
> > > Sent: Wednesday, June 1, 2011 5:52:24 AM
> > 
> 
> > > Subject: [rabbitmq-discuss] How to handle full exchange history
> > > delivery
> > 
> 

> > > Hi,
> > 
> 

> > > I am trying to achieve a scenario in which messages are published
> > > from some data source into a RabbitMQ exchange and clients should
> > > be
> > > able to receive the full history of messages flown through that
> > > exchange, regardless of the exact moment in time when they
> > > connect.
> > 
> 

> > > I?ve been thinking to solve it by setting up a proxy which
> > > subscribes
> > > to the exchange where messages are published using its own queue,
> > > keeps an internal storage of the messages and accepts requests
> > > from
> > > clients.
> > 
> 
> > > When a request from a client arrives it just replays the full
> > > message
> > > history to the client by publishing the messages to the client
> > > queue
> > > (supplied in the ReplyTo field), then binds the client queue to
> > > the
> > > messages exchange, so that the client from this moment onwards
> > > starts receiving the ?live? messages, and is pretty much unaware
> > > of
> > > what?s happened; it simply just receives the whole history.
> > 
> 

> > > Now I am under the impression that there?s a fundamental flaw in
> > > this
> > > reasoning, since the proxy cannot know when the message history
> > > has
> > > completed and he can switch the client to the live stream,
> > > because
> > > while it is replaying historical messages to the client other
> > > live
> > > messages might be arriving on the proxy?s queue, thus getting
> > > into
> > > an endless loop.
> > 
> 

> > > I?m probably missing something obvious, any advice about how
> > > others
> > > would approach this scenario is appreciated.
> > 
> 

> > > Simone
> > 
> 
> > > _________________________________________________________________________________________________________________
> > 
> 
> > > Questo messaggio e da intendersi esclusivamente ad uso del
> > > destinatario e puo contenere informazioni che sono di natura
> > > privilegiata, confidenziale
> > 
> 
> > > o non divulgabile secondo le leggi vigenti. Se il lettore del
> > > presente messaggio non e il destinatario designato, o il
> > > dipendente/agente responsabile
> > 
> 
> > > per la consegna del messaggio al destinatario designato, si
> > > informa
> > > che ogni disseminazione, distribuzione o copiatura di questa
> > > comunicazione e
> > 
> 
> > > strettamente proibita anche ai sensi del decreto legislativo
> > > 196/03
> > > .
> > > Se avete ricevuto questo messaggio per errore, vi preghiamo di
> > > notificarcelo
> > 
> 
> > > immediatamente a mezzo e-mail di risposta e successivamente di
> > > procedere alla cancellazione di questa e-mail e relativi allegati
> > > dal vostro sistema.
> > 
> 
> > > _________________________________________________________________________________________________________________
> > 
> 
> > > This message is intended only for the use of the addressee and
> > > may
> > > contain information that is privileged, confidential and exempt
> > > from
> > 
> 
> > > disclosure under applicable law. If the reader of this message is
> > > not
> > > the intended recipient, or the employee or agent responsible for
> > > delivering the
> > 
> 
> > > message to the intended recipient, you are hereby notified that
> > > any
> > > dissemination, distribution or copying of this communication is
> > > strictly
> > 
> 
> > > prohibited. If you have received this e-mail in error, please
> > > notify
> > > us immediately by return e-mail and delete this e-mail and all
> > > attachments from
> > 
> 
> > > your system.
> > 
> 
> > > _________________________________________________________________________________________________________________
> > 
> 

> > > _______________________________________________
> > 
> 
> > > rabbitmq-discuss mailing list
> > 
> 
> > > rabbitmq-discuss at lists.rabbitmq.com
> > 
> 
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> 
> > _________________________________________________________________________________________________________________
> 
> > Questo messaggio ? da intendersi esclusivamente ad uso del
> > destinatario e pu? contenere informazioni che sono di natura
> > privilegiata, confidenziale
> 
> > o non divulgabile secondo le leggi vigenti. Se il lettore del
> > presente messaggio non ? il destinatario designato, o il
> > dipendente/agente responsabile
> 
> > per la consegna del messaggio al destinatario designato, si informa
> > che ogni disseminazione, distribuzione o copiatura di questa
> > comunicazione ?
> 
> > strettamente proibita anche ai sensi del decreto legislativo 196/03
> > .
> > Se avete ricevuto questo messaggio per errore, vi preghiamo di
> > notificarcelo
> 
> > immediatamente a mezzo e-mail di risposta e successivamente di
> > procedere alla cancellazione di questa e-mail e relativi allegati
> > dal vostro sistema.
> 
> > _________________________________________________________________________________________________________________
> 
> > This message is intended only for the use of the addressee and may
> > contain information that is privileged, confidential and exempt
> > from
> 
> > disclosure under applicable law. If the reader of this message is
> > not
> > the intended recipient, or the employee or agent responsible for
> > delivering the
> 
> > message to the intended recipient, you are hereby notified that any
> > dissemination, distribution or copying of this communication is
> > strictly
> 
> > prohibited. If you have received this e-mail in error, please
> > notify
> > us immediately by return e-mail and delete this e-mail and all
> > attachments from
> 
> > your system.
> 
> > _________________________________________________________________________________________________________________
> 

> > _______________________________________________
> 
> > rabbitmq-discuss mailing list
> 
> > rabbitmq-discuss at lists.rabbitmq.com
> 
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _________________________________________________________________________________________________________________
> Questo messaggio ? da intendersi esclusivamente ad uso del
> destinatario e pu? contenere informazioni che sono di natura
> privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del
> presente messaggio non ? il destinatario designato, o il
> dipendente/agente responsabile
> per la consegna del messaggio al destinatario designato, si informa
> che ogni disseminazione, distribuzione o copiatura di questa
> comunicazione ?
> strettamente proibita anche ai sensi del decreto legislativo 196/03 .
> Se avete ricevuto questo messaggio per errore, vi preghiamo di
> notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di
> procedere alla cancellazione di questa e-mail e relativi allegati
> dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may
> contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not
> the intended recipient, or the employee or agent responsible for
> delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is
> strictly
> prohibited. If you have received this e-mail in error, please notify
> us immediately by return e-mail and delete this e-mail and all
> attachments from
> your system.
> _________________________________________________________________________________________________________________

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110601/665b0a46/attachment-0001.htm>

From simon at rabbitmq.com  Wed Jun  1 19:00:02 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 01 Jun 2011 19:00:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ management plugin/API - extended
 permissions
In-Reply-To: <43e50da1-fcef-4239-9595-ae0cf3e7b522@l14g2000pro.googlegroups.com>
References: <5120b5e0-e083-4e5d-8140-d115179340aa@k3g2000prl.googlegroups.com>	<4DE512BE.2020507@rabbitmq.com>
	<43e50da1-fcef-4239-9595-ae0cf3e7b522@l14g2000pro.googlegroups.com>
Message-ID: <4DE67E22.8070709@rabbitmq.com>

On 31/05/2011 5:24PM, Dan B wrote:
> It would probably be worth mentioning that in the documentation here:
> http://www.rabbitmq.com/management.html#permissions

Good point, I'll add something.

Cheers, Simon

From mikeb at rabbitmq.com  Thu Jun  2 11:40:26 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 02 Jun 2011 11:40:26 +0100
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <88E590DC4586974D825FC82AE798294E5200B1AA@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E5200B0B1@GSVCLU03.ges.ferlan.it>	<ff0d7920-6cad-4eb6-8fd0-a432cd69d2e3@jbrisbin.local>
	<88E590DC4586974D825FC82AE798294E5200B1AA@GSVCLU03.ges.ferlan.it>
Message-ID: <4DE7689A.2020809@rabbitmq.com>

> WRT this:
>
> /When I was writing it, I thought it would be really easy to, when a new
> queue is bound to this exchange, go fetch all the messages in that
> bucket and send them to the queue.///
>
> I?m not sure it is, that was my main question actually. How do you
> figure out how to join the messages stored in the bucket and those
> arriving live so that the last message you send to the queue from those
> picked up from the bucket is followed exactly by its logical successor
> from those coming live?
>
> Say I have messages 1..100 being published to the exchange, each time
> one arrives it?s stored. The exchange has received the first 50 messages
> and a client performs a binding of a queue to the exchange. So you start
> pulling the messages from the storage and sending them to the queue
> before forwarding any live messages. While you are pulling them out of
> the storage messages 51..60 are published to the exchange, how do you
> deal with them? Do you always pull from the storage? When do you stop
> pulling from the storage and relay to the queue directly what is being
> published to the exchange if you don?t know whether any new messages
> have arrived while you were pulling from the storage?

My inclination with this and similar use cases* is that they deserve 
their own content class (alongside 'exchange', 'queue', etc.).

By way of illustration: the last-value-caching exchange, though it was 
developed as a verification of the exchange type mechanism, is rather 
awkward; in the main because it is encoded in the existing AMQP 
operations (bind, consume), and these aren't the right vocabulary for 
the intended use.  See the "Limitations" section of
https://github.com/squaremo/rabbitmq-lvc-plugin.

There's two natural generalisations of LVC: one is to keep an arbitrary 
number of values around, and the other is to make the hold higher-order 
(i.e., instead of replaying values, replay some aggregate of values). 
Neither of these really fit in AMQP as it stands, not in the available 
methods or their semantics.

Anyway.  So that this is helpful and not just me kicking AMQP, here is a 
suggestion: if the consumers are made to co-operate just slightly you 
can get your proxy idea to work. Just use different queues for the 
replay and the live.  Subscribe the live first and note the most recent 
message you know about at that time; then publish your saved messages 
through to that message into the replay queue.  The consumer, when it 
hears back from the proxy, drains the replay queue then starts on the 
live queue.


Michael

*I call the category "value+updates", and the synchronisation problem 
you describe above is the essence of it.

> _______________________________________________________________
>
> *Simone Busoli*
> Direzione risorse umane e segreteria generale ? Sistemi informativi
> gestione sportiva
> /Collaboratore/
>
> *Ferrari S.p.A. * Via Ascari 55/57, 41053, Maranello (MO); Italy
> *T* (+39) 0536-949.850
> *E* _simone.busoli at ferrari.com <mailto:simone.busoli at ferrari.com>_
> _www.ferrari.com <http://www.ferrari.com/>_
>
> *From:* Jon Brisbin [mailto:jon at jbrisbin.com]
> *Sent:* Wednesday, June 01, 2011 4:59 PM
> *To:* Busoli, Simone
> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Re: [rabbitmq-discuss] How to handle full exchange history
> delivery
>
> Maybe I wasn't being clear:
>
> I've already written a custom exchange that stores every message it
> receives in Riak (http://wiki.basho.com/). I'm going to be talking about
> it next week at Erlang Factory in London, as a matter of fact. :)
>
> https://github.com/jbrisbin/riak-exchange
>
> When I was writing it, I thought it would be really easy to, when a new
> queue is bound to this exchange, go fetch all the messages in that
> bucket and send them to the queue.
>
> Since I'm using Riak, the messages themselves are not all stored in memory.
>
> Thanks!
>
> Jon Brisbin
> http//jbrisbin.com
>
> ------------------------------------------------------------------------
>
>     *From: *"Simone Busoli" <Simone.Busoli at ferrari.com>
>     *To: *rabbitmq-discuss at lists.rabbitmq.com
>     *Sent: *Wednesday, June 1, 2011 8:43:58 AM
>     *Subject: *Re: [rabbitmq-discuss] How to handle full exchange
>     history delivery
>
>
>     That?s what I thought as well, although I?m thinking about a couple
>     of issues about it:
>
>     ? Lack of knowledge about Erlang, which is the language I?d have to
>     use to build a custom exchange, I guess
>
>     ? Amount of memory it would require to store the entire history in
>     memory. It needn?t be in memory actually, but I?m not sure what
>     would be the recommended way if the storage has to be carried out by
>     exchange itself. Mnesia perhaps, would it make sense?
>
>     _______________________________________________________________
>
>     *Simone Busoli*
>     Direzione risorse umane e segreteria generale ? Sistemi informativi
>     gestione sportiva
>     /Collaboratore/
>
>     *Ferrari S.p.A. * Via Ascari 55/57, 41053, Maranello (MO); Italy
>     *T* (+39) 0536-949.850
>     *E* _simone.busoli at ferrari.com <mailto:simone.busoli at ferrari.com>_
>     _www.ferrari.com <http://www.ferrari.com/>_
>
>     *From:* Jon Brisbin [mailto:jon at jbrisbin.com]
>     *Sent:* Wednesday, June 01, 2011 3:38 PM
>     *To:* Busoli, Simone
>     *Cc:* rabbitmq-discuss at lists.rabbitmq.com
>     *Subject:* Re: [rabbitmq-discuss] How to handle full exchange
>     history delivery
>
>     I've been seriously considering adding this functionality to the
>     Riak-backed custom exchange. It was something I thought I would add
>     first time through but didn't.
>
>     You'd have to use a custom exchange. Not sure if that's an issue in
>     your scenario or not.
>
>
>     Thanks!
>
>     Jon Brisbin
>     http//jbrisbin.com
>
>     ------------------------------------------------------------------------
>
>         *From: *"Simone Busoli" <Simone.Busoli at ferrari.com>
>         *To: *rabbitmq-discuss at lists.rabbitmq.com
>         *Sent: *Wednesday, June 1, 2011 5:52:24 AM
>         *Subject: *[rabbitmq-discuss] How to handle full exchange
>         history delivery
>
>         Hi,
>
>         I am trying to achieve a scenario in which messages are
>         published from some data source into a RabbitMQ exchange and
>         clients should be able to receive the full history of messages
>         flown through that exchange, regardless of the exact moment in
>         time when they connect.
>
>         I?ve been thinking to solve it by setting up a proxy which
>         subscribes to the exchange where messages are published using
>         its own queue, keeps an internal storage of the messages and
>         accepts requests from clients.
>
>         When a request from a client arrives it just replays the full
>         message history to the client by publishing the messages to the
>         client queue (supplied in the ReplyTo field), *then* binds the
>         client queue to the messages exchange, so that the client from
>         this moment onwards starts receiving the ?live? messages, and is
>         pretty much unaware of what?s happened; it simply just receives
>         the whole history.
>
>         Now I am under the impression that there?s a fundamental flaw in
>         this reasoning, since the proxy cannot know when the message
>         history has completed and he can switch the client to the live
>         stream, because while it is replaying historical messages to the
>         client other live messages might be arriving on the proxy?s
>         queue, thus getting into an endless loop.
>
>         I?m probably missing something obvious, any advice about how
>         others would approach this scenario is appreciated.
>
>         Simone
>
>         _________________________________________________________________________________________________________________
>         Questo messaggio e da intendersi esclusivamente ad uso del
>         destinatario e puo contenere informazioni che sono di natura
>         privilegiata, confidenziale
>         o non divulgabile secondo le leggi vigenti. Se il lettore del
>         presente messaggio non e il destinatario designato, o il
>         dipendente/agente responsabile
>         per la consegna del messaggio al destinatario designato, si
>         informa che ogni disseminazione, distribuzione o copiatura di
>         questa comunicazione e
>         strettamente proibita anche ai sensi del decreto legislativo
>         196/03 . Se avete ricevuto questo messaggio per errore, vi
>         preghiamo di notificarcelo
>         immediatamente a mezzo e-mail di risposta e successivamente di
>         procedere alla cancellazione di questa e-mail e relativi
>         allegati dal vostro sistema.
>         _________________________________________________________________________________________________________________
>         This message is intended only for the use of the addressee and
>         may contain information that is privileged, confidential and
>         exempt from
>         disclosure under applicable law. If the reader of this message
>         is not the intended recipient, or the employee or agent
>         responsible for delivering the
>         message to the intended recipient, you are hereby notified that
>         any dissemination, distribution or copying of this communication
>         is strictly
>         prohibited. If you have received this e-mail in error, please
>         notify us immediately by return e-mail and delete this e-mail
>         and all attachments from
>         your system.
>         _________________________________________________________________________________________________________________
>
>
>         _______________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>     _________________________________________________________________________________________________________________
>     Questo messaggio ? da intendersi esclusivamente ad uso del
>     destinatario e pu? contenere informazioni che sono di natura
>     privilegiata, confidenziale
>     o non divulgabile secondo le leggi vigenti. Se il lettore del
>     presente messaggio non ? il destinatario designato, o il
>     dipendente/agente responsabile
>     per la consegna del messaggio al destinatario designato, si informa
>     che ogni disseminazione, distribuzione o copiatura di questa
>     comunicazione ?
>     strettamente proibita anche ai sensi del decreto legislativo 196/03
>     . Se avete ricevuto questo messaggio per errore, vi preghiamo di
>     notificarcelo
>     immediatamente a mezzo e-mail di risposta e successivamente di
>     procedere alla cancellazione di questa e-mail e relativi allegati
>     dal vostro sistema.
>     _________________________________________________________________________________________________________________
>     This message is intended only for the use of the addressee and may
>     contain information that is privileged, confidential and exempt from
>     disclosure under applicable law. If the reader of this message is
>     not the intended recipient, or the employee or agent responsible for
>     delivering the
>     message to the intended recipient, you are hereby notified that any
>     dissemination, distribution or copying of this communication is
>     strictly
>     prohibited. If you have received this e-mail in error, please notify
>     us immediately by return e-mail and delete this e-mail and all
>     attachments from
>     your system.
>     _________________________________________________________________________________________________________________
>
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _________________________________________________________________________________________________________________
> Questo messaggio ? da intendersi esclusivamente ad uso del destinatario
> e pu? contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
> messaggio non ? il destinatario designato, o il dipendente/agente
> responsabile
> per la consegna del messaggio al destinatario designato, si informa che
> ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere
> alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may
> contain information that is privileged, confidential and exempt from
> disclosure under applicable law. If the reader of this message is not
> the intended recipient, or the employee or agent responsible for
> delivering the
> message to the intended recipient, you are hereby notified that any
> dissemination, distribution or copying of this communication is strictly
> prohibited. If you have received this e-mail in error, please notify us
> immediately by return e-mail and delete this e-mail and all attachments
> from
> your system.
> _________________________________________________________________________________________________________________
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mbaffa at opus.com.br  Thu Jun  2 13:43:50 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Thu, 2 Jun 2011 09:43:50 -0300
Subject: [rabbitmq-discuss] Treating the Ack Message
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A35815D@srv-opus-02.opus.net>

Hi,

 

I am new to RabbitMQ and I am starting with test and prototypes. I have
pretty basic questions:

 

1)      When the client sends a message to a service and the server
crashes before it can send back the ack to the client the message stays
in the queue.

How can the client know the message has not been received, by a timeout
??? 

2)      In this case when the server runs again I would like to clear
all the messages not received. 

 

What could be the best practice to treat this problems.

 

Thanks in advance.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110602/6f97480c/attachment.htm>

From simone.busoli at gmail.com  Thu Jun  2 14:36:13 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 2 Jun 2011 15:36:13 +0200
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <90509f6f-a1dc-4631-8e4a-e60ae6e18d6b@jbrisbin.local>
References: <88E590DC4586974D825FC82AE798294E5200B1AA@GSVCLU03.ges.ferlan.it>
	<90509f6f-a1dc-4631-8e4a-e60ae6e18d6b@jbrisbin.local>
Message-ID: <BANLkTikxEA4VEqabJ1Jj5PH5u3MW2wW63g@mail.gmail.com>

Thanks Jon, I see your point. I'm really just evaluating ways to accomplish
this scenario and went down to trying to carry it out by relying on RabbitMQ
alone, which I get doesn't fit very well here.
I will probably fallback to creating a layer on top of it which takes care
of message ordering and merging of storage and live streams. Thanks for
sharing your ideas!
On Jun 1, 2011 5:51 PM, "Jon Brisbin" <jon at jbrisbin.com> wrote:
> I'm not a big fan of forcing the message broker to keep fascist control
over message ordering. Spring Integration has great tools for handling
splitting and aggregation that can do this message ordering for you, which
means your message broker situation can be much more flexible.
>
> In this particular case, the only way to guarantee you won't receive new
messages before you've finished sending them the old ones is to suspend
message delivery of new messages to the newly-bound queue until it is
finished sending the old ones. One would have to literally queue requests to
route messages internally (to the exchange). The problem is that exchanges
are stateless. One would have to actually store new message routing requests
in mnesia or something based on whether or not the currently-being-filled
queue has a new routing request pending.
>
> All that said, it's technically possible to implement this kind of
behaviour in the broker. I'm just not sure it would be a good idea. :)
Messaging applications are, after all, supposed to be "A"synchronous, which
means, necessarily, undetermined ordering. If ordering is really that
important, then you don't want a message broker, you want a datastore and a
cursor of some sort to sequentially process ordered items. You need, in
fact, a datastore just like the one I'm currently proof-of-concepting (is
that a word? ;) in my spare time, which is an asynchronous datastore that
mixes messaging and data storage to achieve very closely to what you're
wanting here. ;)
>
> Thanks!
>
> Jon Brisbin
> http//jbrisbin.com
>
> ----- Original Message -----
>
>> From: "Simone Busoli" <Simone.Busoli at ferrari.com>
>> To: rabbitmq-discuss at lists.rabbitmq.com
>> Sent: Wednesday, June 1, 2011 10:15:26 AM
>> Subject: Re: [rabbitmq-discuss] How to handle full exchange history
>> delivery
>
>> Thanks Jon, I misunderstood you probably.
>
>> WRT this:
>
>> When I was writing it, I thought it would be really easy to, when a
>> new queue is bound to this exchange, go fetch all the messages in
>> that bucket and send them to the queue.
>
>> I?m not sure it is, that was my main question actually. How do you
>> figure out how to join the messages stored in the bucket and those
>> arriving live so that the last message you send to the queue from
>> those picked up from the bucket is followed exactly by its logical
>> successor from those coming live?
>
>> Say I have messages 1..100 being published to the exchange, each time
>> one arrives it?s stored. The exchange has received the first 50
>> messages and a client performs a binding of a queue to the exchange.
>> So you start pulling the messages from the storage and sending them
>> to the queue before forwarding any live messages. While you are
>> pulling them out of the storage messages 51..60 are published to the
>> exchange, how do you deal with them? Do you always pull from the
>> storage? When do you stop pulling from the storage and relay to the
>> queue directly what is being published to the exchange if you don?t
>> know whether any new messages have arrived while you were pulling
>> from the storage?
>
>> _______________________________________________________________
>> Simone Busoli
>> Direzione risorse umane e segreteria generale ? Sistemi informativi
>> gestione sportiva
>> Collaboratore
>> Ferrari S.p.A. Via Ascari 55/57, 41053, Maranello (MO); Italy
>> T (+39) 0536-949.850
>> E simone.busoli at ferrari.com www.ferrari.com
>
>> From: Jon Brisbin [mailto:jon at jbrisbin.com]
>> Sent: Wednesday, June 01, 2011 4:59 PM
>> To: Busoli, Simone
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] How to handle full exchange history
>> delivery
>
>> Maybe I wasn't being clear:
>
>> I've already written a custom exchange that stores every message it
>> receives in Riak ( http://wiki.basho.com/ ). I'm going to be talking
>> about it next week at Erlang Factory in London, as a matter of fact.
>> :)
>
>> https://github.com/jbrisbin/riak-exchange
>
>> When I was writing it, I thought it would be really easy to, when a
>> new queue is bound to this exchange, go fetch all the messages in
>> that bucket and send them to the queue.
>
>> Since I'm using Riak, the messages themselves are not all stored in
>> memory.
>
>> Thanks!
>
>> Jon Brisbin
>> http//jbrisbin.com
>
>> ----- Original Message -----
>
>> > From: "Simone Busoli" <Simone.Busoli at ferrari.com>
>>
>> > To: rabbitmq-discuss at lists.rabbitmq.com
>>
>> > Sent: Wednesday, June 1, 2011 8:43:58 AM
>>
>> > Subject: Re: [rabbitmq-discuss] How to handle full exchange history
>> > delivery
>>
>
>> > That?s what I thought as well, although I?m thinking about a couple
>> > of issues about it:
>>
>
>> > ? Lack of knowledge about Erlang, which is the language I?d have to
>> > use to build a custom exchange, I guess
>>
>> > ? Amount of memory it would require to store the entire history in
>> > memory. It needn?t be in memory actually, but I?m not sure what
>> > would be the recommended way if the storage has to be carried out
>> > by
>> > exchange itself. Mnesia perhaps, would it make sense?
>>
>
>> > _______________________________________________________ ________
>>
>> > Simone Busoli
>>
>> > Direzione risorse umane e segreteria generale ? Sistemi informativi
>> > gestione sportiva
>>
>> > Collaboratore
>>
>> > Ferrari S.p.A. Via Ascari 55/57, 41053, Maranello (MO); Italy
>>
>> > T (+39) 0536-949.850
>>
>> > E simone.busoli at ferrari.com www.ferrari.com
>>
>
>> > From: Jon Brisbin [mailto:jon at jbrisbin.com]
>>
>> > Sent: Wednesday, June 01, 2011 3:38 PM
>>
>> > To: Busoli, Simone
>>
>> > Cc: rabbitmq-discuss at lists.rabbitmq.com
>>
>> > Subject: Re: [rabbitmq-discuss] How to handle full exchange history
>> > delivery
>>
>
>> > I've been seriously considering adding this functionality to the
>> > Riak-backed custom exchange. It was something I thought I would add
>> > first time through but didn't.
>>
>
>> > You'd have to use a custom exchange. Not sure if that's an issue in
>> > your scenario or not.
>>
>
>> > Thanks!
>>
>
>> > Jon Brisbin
>>
>> > http//jbrisbin.com
>>
>
>> > > From: "Simone Busoli" <Simone.Busoli at ferrari.com>
>> >
>>
>> > > To: rabbitmq-discuss at lists.rabbitmq.com
>> >
>>
>> > > Sent: Wednesday, June 1, 2011 5:52:24 AM
>> >
>>
>> > > Subject: [rabbitmq-discuss] How to handle full exchange history
>> > > delivery
>> >
>>
>
>> > > Hi,
>> >
>>
>
>> > > I am trying to achieve a scenario in which messages are published
>> > > from some data source into a RabbitMQ exchange and clients should
>> > > be
>> > > able to receive the full history of messages flown through that
>> > > exchange, regardless of the exact moment in time when they
>> > > connect.
>> >
>>
>
>> > > I?ve been thinking to solve it by setting up a proxy which
>> > > subscribes
>> > > to the exchange where messages are published using its own queue,
>> > > keeps an internal storage of the messages and accepts requests
>> > > from
>> > > clients.
>> >
>>
>> > > When a request from a client arrives it just replays the full
>> > > message
>> > > history to the client by publishing the messages to the client
>> > > queue
>> > > (supplied in the ReplyTo field), then binds the client queue to
>> > > the
>> > > messages exchange, so that the client from this moment onwards
>> > > starts receiving the ?live? messages, and is pretty much unaware
>> > > of
>> > > what?s happened; it simply just receives the whole history.
>> >
>>
>
>> > > Now I am under the impression that there?s a fundamental flaw in
>> > > this
>> > > reasoning, since the proxy cannot know when the message history
>> > > has
>> > > completed and he can switch the client to the live stream,
>> > > because
>> > > while it is replaying historical messages to the client other
>> > > live
>> > > messages might be arriving on the proxy?s queue, thus getting
>> > > into
>> > > an endless loop.
>> >
>>
>
>> > > I?m probably missing something obvious, any advice about how
>> > > others
>> > > would approach this scenario is appreciated.
>> >
>>
>
>> > > Simone
>> >
>>
>> > >
_________________________________________________________________________________________________________________
>> >
>>
>> > > Questo messaggio e da intendersi esclusivamente ad uso del
>> > > destinatario e puo contenere informazioni che sono di natura
>> > > privilegiata, confidenziale
>> >
>>
>> > > o non divulgabile secondo le leggi vigenti. Se il lettore del
>> > > presente messaggio non e il destinatario designato, o il
>> > > dipendente/agente responsabile
>> >
>>
>> > > per la consegna del messaggio al destinatario designato, si
>> > > informa
>> > > che ogni disseminazione, distribuzione o copiatura di questa
>> > > comunicazione e
>> >
>>
>> > > strettamente proibita anche ai sensi del decreto legislativo
>> > > 196/03
>> > > .
>> > > Se avete ricevuto questo messaggio per errore, vi preghiamo di
>> > > notificarcelo
>> >
>>
>> > > immediatamente a mezzo e-mail di risposta e successivamente di
>> > > procedere alla cancellazione di questa e-mail e relativi allegati
>> > > dal vostro sistema.
>> >
>>
>> > >
_________________________________________________________________________________________________________________
>> >
>>
>> > > This message is intended only for the use of the addressee and
>> > > may
>> > > contain information that is privileged, confidential and exempt
>> > > from
>> >
>>
>> > > disclosure under applicable law. If the reader of this message is
>> > > not
>> > > the intended recipient, or the employee or agent responsible for
>> > > delivering the
>> >
>>
>> > > message to the intended recipient, you are hereby notified that
>> > > any
>> > > dissemination, distribution or copying of this communication is
>> > > strictly
>> >
>>
>> > > prohibited. If you have received this e-mail in error, please
>> > > notify
>> > > us immediately by return e-mail and delete this e-mail and all
>> > > attachments from
>> >
>>
>> > > your system.
>> >
>>
>> > >
_________________________________________________________________________________________________________________
>> >
>>
>
>> > > _______________________________________________
>> >
>>
>> > > rabbitmq-discuss mailing list
>> >
>>
>> > > rabbitmq-discuss at lists.rabbitmq.com
>> >
>>
>> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>>
>> >
_________________________________________________________________________________________________________________
>>
>> > Questo messaggio ? da intendersi esclusivamente ad uso del
>> > destinatario e pu? contenere informazioni che sono di natura
>> > privilegiata, confidenziale
>>
>> > o non divulgabile secondo le leggi vigenti. Se il lettore del
>> > presente messaggio non ? il destinatario designato, o il
>> > dipendente/agente responsabile
>>
>> > per la consegna del messaggio al destinatario designato, si informa
>> > che ogni disseminazione, distribuzione o copiatura di questa
>> > comunicazione ?
>>
>> > strettamente proibita anche ai sensi del decreto legislativo 196/03
>> > .
>> > Se avete ricevuto questo messaggio per errore, vi preghiamo di
>> > notificarcelo
>>
>> > immediatamente a mezzo e-mail di risposta e successivamente di
>> > procedere alla cancellazione di questa e-mail e relativi allegati
>> > dal vostro sistema.
>>
>> >
_________________________________________________________________________________________________________________
>>
>> > This message is intended only for the use of the addressee and may
>> > contain information that is privileged, confidential and exempt
>> > from
>>
>> > disclosure under applicable law. If the reader of this message is
>> > not
>> > the intended recipient, or the employee or agent responsible for
>> > delivering the
>>
>> > message to the intended recipient, you are hereby notified that any
>> > dissemination, distribution or copying of this communication is
>> > strictly
>>
>> > prohibited. If you have received this e-mail in error, please
>> > notify
>> > us immediately by return e-mail and delete this e-mail and all
>> > attachments from
>>
>> > your system.
>>
>> >
_________________________________________________________________________________________________________________
>>
>
>> > _______________________________________________
>>
>> > rabbitmq-discuss mailing list
>>
>> > rabbitmq-discuss at lists.rabbitmq.com
>>
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
_________________________________________________________________________________________________________________
>> Questo messaggio ? da intendersi esclusivamente ad uso del
>> destinatario e pu? contenere informazioni che sono di natura
>> privilegiata, confidenziale
>> o non divulgabile secondo le leggi vigenti. Se il lettore del
>> presente messaggio non ? il destinatario designato, o il
>> dipendente/agente responsabile
>> per la consegna del messaggio al destinatario designato, si informa
>> che ogni disseminazione, distribuzione o copiatura di questa
>> comunicazione ?
>> strettamente proibita anche ai sensi del decreto legislativo 196/03 .
>> Se avete ricevuto questo messaggio per errore, vi preghiamo di
>> notificarcelo
>> immediatamente a mezzo e-mail di risposta e successivamente di
>> procedere alla cancellazione di questa e-mail e relativi allegati
>> dal vostro sistema.
>>
_________________________________________________________________________________________________________________
>> This message is intended only for the use of the addressee and may
>> contain information that is privileged, confidential and exempt from
>> disclosure under applicable law. If the reader of this message is not
>> the intended recipient, or the employee or agent responsible for
>> delivering the
>> message to the intended recipient, you are hereby notified that any
>> dissemination, distribution or copying of this communication is
>> strictly
>> prohibited. If you have received this e-mail in error, please notify
>> us immediately by return e-mail and delete this e-mail and all
>> attachments from
>> your system.
>>
_________________________________________________________________________________________________________________
>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110602/c0f28dba/attachment-0001.htm>

From simone.busoli at gmail.com  Thu Jun  2 14:43:00 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 2 Jun 2011 15:43:00 +0200
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <4DE7689A.2020809@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E5200B0B1@GSVCLU03.ges.ferlan.it>
	<ff0d7920-6cad-4eb6-8fd0-a432cd69d2e3@jbrisbin.local>
	<88E590DC4586974D825FC82AE798294E5200B1AA@GSVCLU03.ges.ferlan.it>
	<4DE7689A.2020809@rabbitmq.com>
Message-ID: <BANLkTinz69+pr2L8QqO+yzPOo=ffUjTEpg@mail.gmail.com>

Hi Michael, now I realize this scenario is not one RabbitMQ is supposed to
handle out of the box, thanks for clearing it out. Nonetheless I'm afraid
building support for it inside the broker is not something I can afford,
therefore I think I will build something at a higher level externally, as
you suggested with some collaboration from the client side.
On Jun 2, 2011 12:30 PM, "Michael Bridgen" <mikeb at rabbitmq.com> wrote:
>> WRT this:
>>
>> /When I was writing it, I thought it would be really easy to, when a new
>> queue is bound to this exchange, go fetch all the messages in that
>> bucket and send them to the queue.///
>>
>> I?m not sure it is, that was my main question actually. How do you
>> figure out how to join the messages stored in the bucket and those
>> arriving live so that the last message you send to the queue from those
>> picked up from the bucket is followed exactly by its logical successor
>> from those coming live?
>>
>> Say I have messages 1..100 being published to the exchange, each time
>> one arrives it?s stored. The exchange has received the first 50 messages
>> and a client performs a binding of a queue to the exchange. So you start
>> pulling the messages from the storage and sending them to the queue
>> before forwarding any live messages. While you are pulling them out of
>> the storage messages 51..60 are published to the exchange, how do you
>> deal with them? Do you always pull from the storage? When do you stop
>> pulling from the storage and relay to the queue directly what is being
>> published to the exchange if you don?t know whether any new messages
>> have arrived while you were pulling from the storage?
>
> My inclination with this and similar use cases* is that they deserve
> their own content class (alongside 'exchange', 'queue', etc.).
>
> By way of illustration: the last-value-caching exchange, though it was
> developed as a verification of the exchange type mechanism, is rather
> awkward; in the main because it is encoded in the existing AMQP
> operations (bind, consume), and these aren't the right vocabulary for
> the intended use. See the "Limitations" section of
> https://github.com/squaremo/rabbitmq-lvc-plugin.
>
> There's two natural generalisations of LVC: one is to keep an arbitrary
> number of values around, and the other is to make the hold higher-order
> (i.e., instead of replaying values, replay some aggregate of values).
> Neither of these really fit in AMQP as it stands, not in the available
> methods or their semantics.
>
> Anyway. So that this is helpful and not just me kicking AMQP, here is a
> suggestion: if the consumers are made to co-operate just slightly you
> can get your proxy idea to work. Just use different queues for the
> replay and the live. Subscribe the live first and note the most recent
> message you know about at that time; then publish your saved messages
> through to that message into the replay queue. The consumer, when it
> hears back from the proxy, drains the replay queue then starts on the
> live queue.
>
>
> Michael
>
> *I call the category "value+updates", and the synchronisation problem
> you describe above is the essence of it.
>
>> _______________________________________________________________
>>
>> *Simone Busoli*
>> Direzione risorse umane e segreteria generale ? Sistemi informativi
>> gestione sportiva
>> /Collaboratore/
>>
>> *Ferrari S.p.A. * Via Ascari 55/57, 41053, Maranello (MO); Italy
>> *T* (+39) 0536-949.850
>> *E* _simone.busoli at ferrari.com <mailto:simone.busoli at ferrari.com>_
>> _www.ferrari.com <http://www.ferrari.com/>_
>>
>> *From:* Jon Brisbin [mailto:jon at jbrisbin.com]
>> *Sent:* Wednesday, June 01, 2011 4:59 PM
>> *To:* Busoli, Simone
>> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
>> *Subject:* Re: [rabbitmq-discuss] How to handle full exchange history
>> delivery
>>
>> Maybe I wasn't being clear:
>>
>> I've already written a custom exchange that stores every message it
>> receives in Riak (http://wiki.basho.com/). I'm going to be talking about
>> it next week at Erlang Factory in London, as a matter of fact. :)
>>
>> https://github.com/jbrisbin/riak-exchange
>>
>> When I was writing it, I thought it would be really easy to, when a new
>> queue is bound to this exchange, go fetch all the messages in that
>> bucket and send them to the queue.
>>
>> Since I'm using Riak, the messages themselves are not all stored in
memory.
>>
>> Thanks!
>>
>> Jon Brisbin
>> http//jbrisbin.com
>>
>> ------------------------------------------------------------------------
>>
>> *From: *"Simone Busoli" <Simone.Busoli at ferrari.com>
>> *To: *rabbitmq-discuss at lists.rabbitmq.com
>> *Sent: *Wednesday, June 1, 2011 8:43:58 AM
>> *Subject: *Re: [rabbitmq-discuss] How to handle full exchange
>> history delivery
>>
>>
>> That?s what I thought as well, although I?m thinking about a couple
>> of issues about it:
>>
>> ? Lack of knowledge about Erlang, which is the language I?d have to
>> use to build a custom exchange, I guess
>>
>> ? Amount of memory it would require to store the entire history in
>> memory. It needn?t be in memory actually, but I?m not sure what
>> would be the recommended way if the storage has to be carried out by
>> exchange itself. Mnesia perhaps, would it make sense?
>>
>> _______________________________________________________________
>>
>> *Simone Busoli*
>> Direzione risorse umane e segreteria generale ? Sistemi informativi
>> gestione sportiva
>> /Collaboratore/
>>
>> *Ferrari S.p.A. * Via Ascari 55/57, 41053, Maranello (MO); Italy
>> *T* (+39) 0536-949.850
>> *E* _simone.busoli at ferrari.com <mailto:simone.busoli at ferrari.com>_
>> _www.ferrari.com <http://www.ferrari.com/>_
>>
>> *From:* Jon Brisbin [mailto:jon at jbrisbin.com]
>> *Sent:* Wednesday, June 01, 2011 3:38 PM
>> *To:* Busoli, Simone
>> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
>> *Subject:* Re: [rabbitmq-discuss] How to handle full exchange
>> history delivery
>>
>> I've been seriously considering adding this functionality to the
>> Riak-backed custom exchange. It was something I thought I would add
>> first time through but didn't.
>>
>> You'd have to use a custom exchange. Not sure if that's an issue in
>> your scenario or not.
>>
>>
>> Thanks!
>>
>> Jon Brisbin
>> http//jbrisbin.com
>>
>> ------------------------------------------------------------------------
>>
>> *From: *"Simone Busoli" <Simone.Busoli at ferrari.com>
>> *To: *rabbitmq-discuss at lists.rabbitmq.com
>> *Sent: *Wednesday, June 1, 2011 5:52:24 AM
>> *Subject: *[rabbitmq-discuss] How to handle full exchange
>> history delivery
>>
>> Hi,
>>
>> I am trying to achieve a scenario in which messages are
>> published from some data source into a RabbitMQ exchange and
>> clients should be able to receive the full history of messages
>> flown through that exchange, regardless of the exact moment in
>> time when they connect.
>>
>> I?ve been thinking to solve it by setting up a proxy which
>> subscribes to the exchange where messages are published using
>> its own queue, keeps an internal storage of the messages and
>> accepts requests from clients.
>>
>> When a request from a client arrives it just replays the full
>> message history to the client by publishing the messages to the
>> client queue (supplied in the ReplyTo field), *then* binds the
>> client queue to the messages exchange, so that the client from
>> this moment onwards starts receiving the ?live? messages, and is
>> pretty much unaware of what?s happened; it simply just receives
>> the whole history.
>>
>> Now I am under the impression that there?s a fundamental flaw in
>> this reasoning, since the proxy cannot know when the message
>> history has completed and he can switch the client to the live
>> stream, because while it is replaying historical messages to the
>> client other live messages might be arriving on the proxy?s
>> queue, thus getting into an endless loop.
>>
>> I?m probably missing something obvious, any advice about how
>> others would approach this scenario is appreciated.
>>
>> Simone
>>
>>
_________________________________________________________________________________________________________________
>> Questo messaggio e da intendersi esclusivamente ad uso del
>> destinatario e puo contenere informazioni che sono di natura
>> privilegiata, confidenziale
>> o non divulgabile secondo le leggi vigenti. Se il lettore del
>> presente messaggio non e il destinatario designato, o il
>> dipendente/agente responsabile
>> per la consegna del messaggio al destinatario designato, si
>> informa che ogni disseminazione, distribuzione o copiatura di
>> questa comunicazione e
>> strettamente proibita anche ai sensi del decreto legislativo
>> 196/03 . Se avete ricevuto questo messaggio per errore, vi
>> preghiamo di notificarcelo
>> immediatamente a mezzo e-mail di risposta e successivamente di
>> procedere alla cancellazione di questa e-mail e relativi
>> allegati dal vostro sistema.
>>
_________________________________________________________________________________________________________________
>> This message is intended only for the use of the addressee and
>> may contain information that is privileged, confidential and
>> exempt from
>> disclosure under applicable law. If the reader of this message
>> is not the intended recipient, or the employee or agent
>> responsible for delivering the
>> message to the intended recipient, you are hereby notified that
>> any dissemination, distribution or copying of this communication
>> is strictly
>> prohibited. If you have received this e-mail in error, please
>> notify us immediately by return e-mail and delete this e-mail
>> and all attachments from
>> your system.
>>
_________________________________________________________________________________________________________________
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
_________________________________________________________________________________________________________________
>> Questo messaggio ? da intendersi esclusivamente ad uso del
>> destinatario e pu? contenere informazioni che sono di natura
>> privilegiata, confidenziale
>> o non divulgabile secondo le leggi vigenti. Se il lettore del
>> presente messaggio non ? il destinatario designato, o il
>> dipendente/agente responsabile
>> per la consegna del messaggio al destinatario designato, si informa
>> che ogni disseminazione, distribuzione o copiatura di questa
>> comunicazione ?
>> strettamente proibita anche ai sensi del decreto legislativo 196/03
>> . Se avete ricevuto questo messaggio per errore, vi preghiamo di
>> notificarcelo
>> immediatamente a mezzo e-mail di risposta e successivamente di
>> procedere alla cancellazione di questa e-mail e relativi allegati
>> dal vostro sistema.
>>
_________________________________________________________________________________________________________________
>> This message is intended only for the use of the addressee and may
>> contain information that is privileged, confidential and exempt from
>> disclosure under applicable law. If the reader of this message is
>> not the intended recipient, or the employee or agent responsible for
>> delivering the
>> message to the intended recipient, you are hereby notified that any
>> dissemination, distribution or copying of this communication is
>> strictly
>> prohibited. If you have received this e-mail in error, please notify
>> us immediately by return e-mail and delete this e-mail and all
>> attachments from
>> your system.
>>
_________________________________________________________________________________________________________________
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
_________________________________________________________________________________________________________________
>> Questo messaggio ? da intendersi esclusivamente ad uso del destinatario
>> e pu? contenere informazioni che sono di natura privilegiata,
confidenziale
>> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
>> messaggio non ? il destinatario designato, o il dipendente/agente
>> responsabile
>> per la consegna del messaggio al destinatario designato, si informa che
>> ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
>> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
>> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
>> immediatamente a mezzo e-mail di risposta e successivamente di procedere
>> alla cancellazione di questa e-mail e relativi allegati dal vostro
sistema.
>>
_________________________________________________________________________________________________________________
>> This message is intended only for the use of the addressee and may
>> contain information that is privileged, confidential and exempt from
>> disclosure under applicable law. If the reader of this message is not
>> the intended recipient, or the employee or agent responsible for
>> delivering the
>> message to the intended recipient, you are hereby notified that any
>> dissemination, distribution or copying of this communication is strictly
>> prohibited. If you have received this e-mail in error, please notify us
>> immediately by return e-mail and delete this e-mail and all attachments
>> from
>> your system.
>>
_________________________________________________________________________________________________________________
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110602/bfb30f07/attachment-0001.htm>

From david at rabbitmq.com  Thu Jun  2 14:53:58 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 02 Jun 2011 14:53:58 +0100
Subject: [rabbitmq-discuss] Treating the Ack Message
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A35815D@srv-opus-02.opus.net>
	(Marcus Vinitius Baffa's message of "Thu, 2 Jun 2011 09:43:50 -0300")
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A35815D@srv-opus-02.opus.net>
Message-ID: <yrv4c1uzcl4p5.fsf@dwragg.eng.vmware.com>

"Marcus Vinitius Baffa" <mbaffa at opus.com.br> writes:
> I am new to RabbitMQ and I am starting with test and prototypes. I have
> pretty basic questions:
>
> 1)      When the client sends a message to a service and the server
> crashes before it can send back the ack to the client the message stays
> in the queue.
>
> How can the client know the message has not been received, by a timeout
> ???

I'll use the terms "producer" and "consumer", rather than "client" and
"server", because the latter terms risk confusion: All agents sending
and receiving messages are clients of rabbitmq-server (the broker).

There are a couple of AMQP features related to your question.  On a
publish operation, you can set the "mandatory" and "immediate" flags.
"mandatory" tells the broker that the producer expects the message to be
directly routed into at least one queue (rather than being dropped
because there were no bindings of the exchange that matched the
message).  "immediate" says that the producer expects the message to be
directory routed to a consumer via a queue immediately.  If these flags
can't be satisfied, the error is signalled to the producer.

But neither of these give you what you ask for: "mandatory" merely says
that the message should be routed to a queue, and says nothing about
receipt by a consumer.  "immediate" really does require immediate
delivery to a consumer.  If the consumer is already processing earlier
messages, so that the message cannot be delivery due to outstanding
acknowledgements, the publish will fail.

So if you want to send a message from a producer to a consumer, and have
the consumer know whether the message was processed by a consumer within
a certain time, then you will need to make the consumer send a response
message back to the original producer in your application's code.

> 2)      In this case when the server runs again I would like to clear
> all the messages not received.

There is a purge operation that clears a queue.  So your consumer should
purge its queues on startup.

But note that what you are asking for will tightly couple your clients
and servers.  One of the benefits of using a message broker, compared to
(for example) using HTTP for clients to send requests to servers, is
that the broker can reliably convey a message even if producers and
consumers are not running at the same time, or get restarted.

So for instance, a producer might send a message while the consumer is
temporarily stopped.  When the consumer becomes available again, it can
start handling the messages sent while it was away.

Taking advantage of that kind of approach can help to build more robust
systems.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From bkjones at gmail.com  Thu Jun  2 15:21:04 2011
From: bkjones at gmail.com (Brian K. Jones)
Date: Thu, 2 Jun 2011 10:21:04 -0400
Subject: [rabbitmq-discuss] duplicate 'messages' queue attribute in HTTP API
	JSON response?
Message-ID: <35B39F33D4774088B65684FE8E43B0DF@gmail.com>

Hi all, 

I'm running RabbitMQ w/ the mgmt plugin and I discovered while using the HTTP API that when I ask for /api/queues, the JSON response is a list of JSON objects that each have *two* instances of the "messages" attribute. Is this a bug? If so, is it fixed somewhere already? Is there any reason for the code I'm writing not to throw away the duplicate? I did a quick test and published a message that went to one of the queues, and confirmed that both instances of "messages" has the same value whether there are messages in the queue or not. 

I'm using v. 2.4.1 on a mac, if it helps. :) 

brian

-- 
Brian K. Jones
Sent over the internet
My blog: http://www.protocolostomy.com
Follow me: http://twitter.com/bkjones

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110602/941f1cd6/attachment.htm>

From david at rabbitmq.com  Thu Jun  2 15:28:45 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 02 Jun 2011 15:28:45 +0100
Subject: [rabbitmq-discuss] Treating the Ack Message
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A3581F0@srv-opus-02.opus.net>
	(Marcus Vinitius Baffa's message of "Thu, 2 Jun 2011 11:12:43 -0300")
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A35815D@srv-opus-02.opus.net>
	<yrv4c1uzcl4p5.fsf@dwragg.eng.vmware.com>
	<5EFADC7B94CAF64BAB113AD9DE1ACD200A3581F0@srv-opus-02.opus.net>
Message-ID: <yrv4cwrh4joiq.fsf@dwragg.eng.vmware.com>

"Marcus Vinitius Baffa" <mbaffa at opus.com.br> writes:
> 1) If I understood well the consumer will send an explicit response to
> the producer confirming the service messages was received. The producer
> will wait for this messages and define a timeout to receive this kind of
> customized acknowledge message;

Right.  In an RPC setting, clients can simply timeout if they don't get
a reply soon enough.

> 2) As these messages are RPC messages there is no point for the
> consumer, after a crash, to process messages that possibly had timedout
> so I could simply purge these messages, and additionally send to the
> producer, for each message still in the queue and not processed, a
> special notification message indicating the consumer had crashed. This
> could make the producer, if it is still running, reset the process and
> notify the user what happened;
> 3) The producer will allways purge its output queue when it begins to
> run;

The problem with purging the queue is the your consumer would not see
requests even if they were sent just before the purge.  So it's probably
better to use RabbitMQ's per-queue message TTL feature.  This allows you
to request that messages by expired from a queue after a certain time,
and you could configure this to match your timeout period.  See
<http://www.rabbitmq.com/extensions.html#queue-ttl>.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From bkjones at gmail.com  Thu Jun  2 15:47:00 2011
From: bkjones at gmail.com (Brian K. Jones)
Date: Thu, 2 Jun 2011 10:47:00 -0400
Subject: [rabbitmq-discuss] duplicate 'messages' queue attribute in HTTP
 API JSON response?
In-Reply-To: <35B39F33D4774088B65684FE8E43B0DF@gmail.com>
References: <35B39F33D4774088B65684FE8E43B0DF@gmail.com>
Message-ID: <0F89F72C8F144660A1A592534D9DC650@gmail.com>

Here's the data, only slightly prettified:



[{"memory":7512,
"messages":0,
"consumer_details":[],
"idle_since":"2011-6-2 10:11:16",
"exclusive_consumer_pid":"",
"exclusive_consumer_tag":"",
"messages_ready":0,
"messages_unacknowledged":0,
"messages":0,
"consumers":0,
"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"outstanding_txns":0,"target_ram_count":"infinity","ram_msg_count":0,"ram_ack_count":0,"ram_index_count":0,"next_seq_id":8,"persistent_count":0,"avg_ingress_rate":0.0052629918611936,"avg_egress_rate":0.0052629918611936,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},
"name":"aliveness-test",
"vhost":"/",
"durable":false,
"auto_delete":false,
"owner_pid":"none",
"arguments":{},
"pid":"<rabbit at newhotness.3.461.0>",
"node":"rabbit at newhotness"}, 

{"memory":14664,
"messages":1,
"consumer_details":[],
"idle_since":"2011-6-2 10:19:11",
"exclusive_consumer_pid":"",
"exclusive_consumer_tag":"",
"messages_ready":1,
"messages_unacknowledged":0,
"messages":1,
"consumers":0,
"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":0,"q4":1,"len":1,"pending_acks":0,"outstanding_txns":0,"target_ram_count":"infinity","ram_msg_count":1,"ram_ack_count":0,"ram_index_count":0,"next_seq_id":1,"persistent_count":1,"avg_ingress_rate":0.0003672439900472369,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},
"name":"testq",
"vhost":"/",
"durable":true,
"auto_delete":false,
"owner_pid":"none",
"arguments":{},
"pid":"<rabbit at newhotness.3.233.0>",
"node":"rabbit at newhotness"},

{"memory":12256,
"messages":0,
"consumer_details":[],
"idle_since":"2011-6-2 9:33:46",
"exclusive_consumer_pid":"",
"exclusive_consumer_tag":"",
"messages_ready":0,
"messages_unacknowledged":0,
"messages":0,
"consumers":0,
"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":0,"q4":0,"len":0,"pending_acks":0,"outstanding_txns":0,"target_ram_count":"infinity","ram_msg_count":0,"ram_ack_count":0,"ram_index_count":0,"next_seq_id":0,"persistent_count":0,"avg_ingress_rate":0.0,"avg_egress_rate":0.0,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},
"name":"test123",
"vhost":"testvhost",
"durable":true,
"auto_delete":false,
"owner_pid":"none",
"arguments":{},
"pid":"<rabbit at newhotness.3.232.0>",
"node":"rabbit at newhotness"}]


-- 
Brian K. Jones
Sent over the internet
My blog: http://www.protocolostomy.com
Follow me: http://twitter.com/bkjones


On Thursday, June 2, 2011 at 10:21 AM, Brian K. Jones wrote:

> Hi all, 
> 
> I'm running RabbitMQ w/ the mgmt plugin and I discovered while using the HTTP API that when I ask for /api/queues, the JSON response is a list of JSON objects that each have *two* instances of the "messages" attribute. Is this a bug? If so, is it fixed somewhere already? Is there any reason for the code I'm writing not to throw away the duplicate? I did a quick test and published a message that went to one of the queues, and confirmed that both instances of "messages" has the same value whether there are messages in the queue or not. 
> 
> I'm using v. 2.4.1 on a mac, if it helps. :) 
> 
> brian
> 
> -- 
> Brian K. Jones
> Sent over the internet
> My blog: http://www.protocolostomy.com
> Follow me: http://twitter.com/bkjones
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110602/8a9c63db/attachment.htm>

From simon at rabbitmq.com  Thu Jun  2 15:52:44 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 Jun 2011 15:52:44 +0100
Subject: [rabbitmq-discuss] duplicate 'messages' queue attribute in HTTP
 API	JSON response?
In-Reply-To: <35B39F33D4774088B65684FE8E43B0DF@gmail.com>
References: <35B39F33D4774088B65684FE8E43B0DF@gmail.com>
Message-ID: <4DE7A3BC.4040402@rabbitmq.com>

On 02/06/11 15:21, Brian K. Jones wrote:
> I'm running RabbitMQ w/ the mgmt plugin and I discovered while using the
> HTTP API that when I ask for /api/queues, the JSON response is a list of
> JSON objects that each have *two* instances of the "messages" attribute.
> Is this a bug?

Yes.

> If so, is it fixed somewhere already?

No.

> Is there any reason
> for the code I'm writing not to throw away the duplicate?

No.

> I did a quick
> test and published a message that went to one of the queues, and
> confirmed that both instances of "messages" has the same value whether
> there are messages in the queue or not.

That's correct. This bug has been around since forever, thank you for 
spotting it. Both copies of "messages" will have the same value, so it's 
harmless.

I'll get this fixed...

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From tonygarnockjones+rabbitmq at gmail.com  Thu Jun  2 17:43:01 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 2 Jun 2011 12:43:01 -0400
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <4DE7689A.2020809@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E5200B0B1@GSVCLU03.ges.ferlan.it>
	<ff0d7920-6cad-4eb6-8fd0-a432cd69d2e3@jbrisbin.local>
	<88E590DC4586974D825FC82AE798294E5200B1AA@GSVCLU03.ges.ferlan.it>
	<4DE7689A.2020809@rabbitmq.com>
Message-ID: <BANLkTinTc7r4VTDwgC0psqEfvMwYNL=Jjg@mail.gmail.com>

(Dammit, forgot to reply-to-all. Sorry about the dup, mikeb!)

On 2 June 2011 06:40, Michael Bridgen <mikeb at rabbitmq.com> wrote:

> By way of illustration: the last-value-caching exchange, though it was
> developed as a verification of the exchange type mechanism, is rather
> awkward; in the main because it is encoded in the existing AMQP operations
> (bind, consume), and these aren't the right vocabulary for the intended use.
>  See the "Limitations" section of
> https://github.com/squaremo/rabbitmq-lvc-plugin.
>

Aren't these RabbitMQ implementation restrictions rather than things that,
in principle, require new or different AMQP vocabulary? If new vocabulary
really is required, what kind of thing do you have in mind?

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110602/12bf175a/attachment.htm>

From chrisch at ecollege.com  Thu Jun  2 17:51:25 2011
From: chrisch at ecollege.com (Chris Chew)
Date: Thu, 2 Jun 2011 16:51:25 +0000
Subject: [rabbitmq-discuss] RabbitMQ Pub Sub Meetup?
Message-ID: <1C7E61787A08F34BBBBD9E7A7CBC368B0A310287@EXMB02OSG.eclg.org>

Hi Everybody.

Has there been any talk about having another "pub sub" meetup for Rabbit users next week while Erlang Factory is going on?

-Chris

From simon at rabbitmq.com  Thu Jun  2 18:39:03 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 Jun 2011 18:39:03 +0100
Subject: [rabbitmq-discuss] Fwd: Management UI plugin issue on 2 node
 cluster
In-Reply-To: <2CF490B2-43DD-4A9F-86CB-57CA79254FDD@dwim.org>
References: <86CD90E7-A172-4A09-A73C-282BA2B36644@dwim.org>
	<CB1B0C94-E22D-4831-841B-453016627E6B@dwim.org>
	<4DBFF8F9.3040800@rabbitmq.com>
	<2CF490B2-43DD-4A9F-86CB-57CA79254FDD@dwim.org>
Message-ID: <4DE7CAB7.6060404@rabbitmq.com>

On 06/05/11 19:47, Jos Boumans wrote:
> Correct; if I move the mgmt plugin (not the client, the ui), out of the
> way, everything starts as expected. I've left the mnesia dir completely
> untouched.

Hi Jo - in case you didn't see the other mails this is now finally 
solved. Sorry your mails fell through the cracks.

There's a fixed version of the plugin available here:

http://www.rabbitmq.com/releases/plugins/v2.4.1/rabbitmq-management-2.4.1-globals-fix.ez

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Thu Jun  2 18:40:23 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 Jun 2011 18:40:23 +0100
Subject: [rabbitmq-discuss] Fwd: Management UI plugin issue on 2 node
 cluster
In-Reply-To: <4DE7CAB7.6060404@rabbitmq.com>
References: <86CD90E7-A172-4A09-A73C-282BA2B36644@dwim.org>
	<CB1B0C94-E22D-4831-841B-453016627E6B@dwim.org>
	<4DBFF8F9.3040800@rabbitmq.com>
	<2CF490B2-43DD-4A9F-86CB-57CA79254FDD@dwim.org>
	<4DE7CAB7.6060404@rabbitmq.com>
Message-ID: <4DE7CB07.2090309@rabbitmq.com>

On 02/06/11 18:39, Simon MacMullen wrote:
> Hi Jo - in case you didn't see the other mails this is now finally
> solved. Sorry your mails fell through the cracks.

And then just to complete things I manage a typo. Sorry, *Jos*.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From alexis at rabbitmq.com  Thu Jun  2 19:13:30 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 2 Jun 2011 19:13:30 +0100
Subject: [rabbitmq-discuss] RabbitMQ Pub Sub Meetup?
In-Reply-To: <1C7E61787A08F34BBBBD9E7A7CBC368B0A310287@EXMB02OSG.eclg.org>
References: <1C7E61787A08F34BBBBD9E7A7CBC368B0A310287@EXMB02OSG.eclg.org>
Message-ID: <BANLkTinprQ-GCRjeya3KmfeMuhn8R=qeAQ@mail.gmail.com>

yes we are looking at either tuesday or wednesday


On Thu, Jun 2, 2011 at 5:51 PM, Chris Chew <chrisch at ecollege.com> wrote:
> Hi Everybody.
>
> Has there been any talk about having another "pub sub" meetup for Rabbit users next week while Erlang Factory is going on?
>
> -Chris
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From bkjones at gmail.com  Thu Jun  2 21:35:07 2011
From: bkjones at gmail.com (Brian K. Jones)
Date: Thu, 2 Jun 2011 16:35:07 -0400
Subject: [rabbitmq-discuss] Document HTTP API responses?
Message-ID: <0720336B07744FA8AA8E71ADCAF2E669@gmail.com>

Hi, 

I'm testing a Python module that provides an easy way to work with the RabbitMQ Management HTTP API. I'm testing against various different broker instances, and I'm finding that, although they're the same version, there are apparently circumstances that exist which make the same call return different collections of attributes across different servers. For example, some hosts' 'overview' have a 'listeners' attribute while others don't. For queues, some have a 'node' attribute (iirc), and others don't. I imagine there are more of these situations, and I'm wondering if these conditions are documented anywhere? This would obviously be useful to those writing any code against the API as well, not just module authors (think of the poor ops folks writing nagios checks!). :) 

If the expectation is that servers with the same versions of the server and management software return the same exact attributes given the same exact calls, then let me know and I'll document these issues more thoroughly & update this thread (unless there's a public bug tracker?)

Thanks, 
brian


-- 
Brian K. Jones
Sent over the internet
My blog: http://www.protocolostomy.com
Follow me: http://twitter.com/bkjones

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110602/3934107b/attachment.htm>

From yluppo at leads360.com  Thu Jun  2 22:49:28 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Thu, 2 Jun 2011 14:49:28 -0700
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A3092A46A6@l360xch01.office.leads360.com>

Hi everyone,

 

I hope this is the right place to ask questions about Wonderland because
I couldn't find another community for it and I figured at least some of
you may have deployed it successfully already.

My deal is on the same box I have RabbitMQ and Alice running, and also
Wonderland.

When I click on the "Dashboard" link in Wonderland I get:

 

=INFO REPORT==== 2-Jun-2011::14:26:56 ===

(rest_server:232) Error in rest server: {function_clause,

 
[{dashboard,'-get/1-lc$^0/1-1-',

                                           [<<"no vhosts">>]},

                                          {dashboard,get,1},

 
{rest_server,run_controller,4},

                                          {mochiweb_http,headers,5},

                                          {proc_lib,init_p_do_apply,3}]}

 

 

Notice the <<"no vhosts">>.

 

However if I simply run on that same machine again the commands:

 

sudo rabbitmqctl status

sudo rabbitmqctl list_vhosts

 

I can confirm that my RabbitMQ server is running and that I have 3
existing vhosts.

 

Any idea?

 

Thanks,

 

Yann Luppo 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110602/01610ecd/attachment-0001.htm>

From simon at rabbitmq.com  Thu Jun  2 23:10:59 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 02 Jun 2011 23:10:59 +0100
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq
In-Reply-To: <8882CFE4FFAF3F4E8814F0E61F2919A3092A46A6@l360xch01.office.leads360.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A3092A46A6@l360xch01.office.leads360.com>
Message-ID: <4DE80A73.7080104@rabbitmq.com>

Hi Yann.

I don't think Alice / Wonderland have been updated for a long time, I 
think since the 1.6.0 timeframe or so.

You don't say which version of RabbitMQ you're running, but if it's 
remotely up to date the management plugin 
(http://www.rabbitmq.com/management.html) can do everything Alice / 
Wonderland can do, and a great deal more.

Admittedly with a less whimsical UI.

Cheers, Simon

On 02/06/2011 10:49PM, Yann Luppo wrote:
> Hi everyone,
>
> I hope this is the right place to ask questions about Wonderland because
> I couldn?t find another community for it and I figured at least some of
> you may have deployed it successfully already.
>
> My deal is on the same box I have RabbitMQ and Alice running, and also
> Wonderland.
>
> When I click on the ?Dashboard? link in Wonderland I get:
>
> =INFO REPORT==== 2-Jun-2011::14:26:56 ===
>
> (rest_server:232) Error in rest server: {function_clause,
>
> [{dashboard,'-get/1-lc$^0/1-1-',
>
> [<<"no vhosts">>]},
>
> {dashboard,get,1},
>
> {rest_server,run_controller,4},
>
> {mochiweb_http,headers,5},
>
> {proc_lib,init_p_do_apply,3}]}
>
> Notice the <<?no vhosts?>>.
>
> However if I simply run on that same machine again the commands:
>
> sudo rabbitmqctl status
>
> sudo rabbitmqctl list_vhosts
>
> I can confirm that my RabbitMQ server is running and that I have 3
> existing vhosts.
>
> Any idea?
>
> Thanks,
>
> *Yann Luppo*
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From yluppo at leads360.com  Thu Jun  2 23:32:25 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Thu, 2 Jun 2011 15:32:25 -0700
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq
In-Reply-To: <4DE80A73.7080104@rabbitmq.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A3092A46A6@l360xch01.office.leads360.com>
	<4DE80A73.7080104@rabbitmq.com>
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A3092A46FC@l360xch01.office.leads360.com>

This might be exactly what I need... minus the Disney graphics... :)

Thank you Simon, I'm gonna try that out right now.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon
MacMullen
Sent: Thursday, June 02, 2011 3:11 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq

Hi Yann.

I don't think Alice / Wonderland have been updated for a long time, I 
think since the 1.6.0 timeframe or so.

You don't say which version of RabbitMQ you're running, but if it's 
remotely up to date the management plugin 
(http://www.rabbitmq.com/management.html) can do everything Alice / 
Wonderland can do, and a great deal more.

Admittedly with a less whimsical UI.

Cheers, Simon

On 02/06/2011 10:49PM, Yann Luppo wrote:
> Hi everyone,
>
> I hope this is the right place to ask questions about Wonderland
because
> I couldn't find another community for it and I figured at least some
of
> you may have deployed it successfully already.
>
> My deal is on the same box I have RabbitMQ and Alice running, and also
> Wonderland.
>
> When I click on the "Dashboard" link in Wonderland I get:
>
> =INFO REPORT==== 2-Jun-2011::14:26:56 ===
>
> (rest_server:232) Error in rest server: {function_clause,
>
> [{dashboard,'-get/1-lc$^0/1-1-',
>
> [<<"no vhosts">>]},
>
> {dashboard,get,1},
>
> {rest_server,run_controller,4},
>
> {mochiweb_http,headers,5},
>
> {proc_lib,init_p_do_apply,3}]}
>
> Notice the <<"no vhosts">>.
>
> However if I simply run on that same machine again the commands:
>
> sudo rabbitmqctl status
>
> sudo rabbitmqctl list_vhosts
>
> I can confirm that my RabbitMQ server is running and that I have 3
> existing vhosts.
>
> Any idea?
>
> Thanks,
>
> *Yann Luppo*
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Fri Jun  3 00:14:11 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 3 Jun 2011 01:14:11 +0200
Subject: [rabbitmq-discuss] How to handle full exchange history delivery
In-Reply-To: <4DE7689A.2020809@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E5200B0B1@GSVCLU03.ges.ferlan.it>
	<ff0d7920-6cad-4eb6-8fd0-a432cd69d2e3@jbrisbin.local>
	<88E590DC4586974D825FC82AE798294E5200B1AA@GSVCLU03.ges.ferlan.it>
	<4DE7689A.2020809@rabbitmq.com>
Message-ID: <BANLkTinzWXnwcX2XBbvR+uT_yCOi2bpUMA@mail.gmail.com>

I have started implementing it with a layer on top of rabbit, and it gets
tricky soon. There are two main challenges:

- figure out how to merge the stored and live message streams
- make sure that the replayer component replays messages which partially
overlap with those the client subscribed to before asking for stored
messages (this is a case of slow message store)

To solve the first I have to decorated the messages with a unique identifier
so that the client knows when to merge live and stored messages based on id
match.
The second one is a bit trickier and I didn't solve it yet. This happens if
the component which stores messages is slow and upon replay request is only
capable of replaying messages up to a point in time earlier than the first
message the client gets from the live stream receives, thus leaving a client
with a hole in the message stream.

On Thu, Jun 2, 2011 at 12:40, Michael Bridgen <mikeb at rabbitmq.com> wrote:

>  WRT this:
>>
>> /When I was writing it, I thought it would be really easy to, when a new
>> queue is bound to this exchange, go fetch all the messages in that
>> bucket and send them to the queue.///
>>
>> I?m not sure it is, that was my main question actually. How do you
>> figure out how to join the messages stored in the bucket and those
>> arriving live so that the last message you send to the queue from those
>> picked up from the bucket is followed exactly by its logical successor
>> from those coming live?
>>
>> Say I have messages 1..100 being published to the exchange, each time
>> one arrives it?s stored. The exchange has received the first 50 messages
>> and a client performs a binding of a queue to the exchange. So you start
>> pulling the messages from the storage and sending them to the queue
>> before forwarding any live messages. While you are pulling them out of
>> the storage messages 51..60 are published to the exchange, how do you
>> deal with them? Do you always pull from the storage? When do you stop
>> pulling from the storage and relay to the queue directly what is being
>> published to the exchange if you don?t know whether any new messages
>> have arrived while you were pulling from the storage?
>>
>
> My inclination with this and similar use cases* is that they deserve their
> own content class (alongside 'exchange', 'queue', etc.).
>
> By way of illustration: the last-value-caching exchange, though it was
> developed as a verification of the exchange type mechanism, is rather
> awkward; in the main because it is encoded in the existing AMQP operations
> (bind, consume), and these aren't the right vocabulary for the intended use.
>  See the "Limitations" section of
> https://github.com/squaremo/rabbitmq-lvc-plugin.
>
> There's two natural generalisations of LVC: one is to keep an arbitrary
> number of values around, and the other is to make the hold higher-order
> (i.e., instead of replaying values, replay some aggregate of values).
> Neither of these really fit in AMQP as it stands, not in the available
> methods or their semantics.
>
> Anyway.  So that this is helpful and not just me kicking AMQP, here is a
> suggestion: if the consumers are made to co-operate just slightly you can
> get your proxy idea to work. Just use different queues for the replay and
> the live.  Subscribe the live first and note the most recent message you
> know about at that time; then publish your saved messages through to that
> message into the replay queue.  The consumer, when it hears back from the
> proxy, drains the replay queue then starts on the live queue.
>
>
> Michael
>
> *I call the category "value+updates", and the synchronisation problem you
> describe above is the essence of it.
>
>  _______________________________________________________________
>>
>> *Simone Busoli*
>>
>> Direzione risorse umane e segreteria generale ? Sistemi informativi
>> gestione sportiva
>> /Collaboratore/
>>
>> *Ferrari S.p.A. * Via Ascari 55/57, 41053, Maranello (MO); Italy
>> *T* (+39) 0536-949.850
>> *E* _simone.busoli at ferrari.com <mailto:simone.busoli at ferrari.com>_
>> _www.ferrari.com <http://www.ferrari.com/>_
>>
>>
>> *From:* Jon Brisbin [mailto:jon at jbrisbin.com]
>> *Sent:* Wednesday, June 01, 2011 4:59 PM
>> *To:* Busoli, Simone
>> *Cc:* rabbitmq-discuss at lists.rabbitmq.com
>> *Subject:* Re: [rabbitmq-discuss] How to handle full exchange history
>> delivery
>>
>> Maybe I wasn't being clear:
>>
>> I've already written a custom exchange that stores every message it
>> receives in Riak (http://wiki.basho.com/). I'm going to be talking about
>> it next week at Erlang Factory in London, as a matter of fact. :)
>>
>> https://github.com/jbrisbin/riak-exchange
>>
>> When I was writing it, I thought it would be really easy to, when a new
>> queue is bound to this exchange, go fetch all the messages in that
>> bucket and send them to the queue.
>>
>> Since I'm using Riak, the messages themselves are not all stored in
>> memory.
>>
>> Thanks!
>>
>> Jon Brisbin
>> http//jbrisbin.com
>>
>> ------------------------------------------------------------------------
>>
>>    *From: *"Simone Busoli" <Simone.Busoli at ferrari.com>
>>    *To: *rabbitmq-discuss at lists.rabbitmq.com
>>    *Sent: *Wednesday, June 1, 2011 8:43:58 AM
>>    *Subject: *Re: [rabbitmq-discuss] How to handle full exchange
>>    history delivery
>>
>>
>>    That?s what I thought as well, although I?m thinking about a couple
>>    of issues about it:
>>
>>    ? Lack of knowledge about Erlang, which is the language I?d have to
>>    use to build a custom exchange, I guess
>>
>>    ? Amount of memory it would require to store the entire history in
>>    memory. It needn?t be in memory actually, but I?m not sure what
>>    would be the recommended way if the storage has to be carried out by
>>    exchange itself. Mnesia perhaps, would it make sense?
>>
>>    _______________________________________________________________
>>
>>    *Simone Busoli*
>>    Direzione risorse umane e segreteria generale ? Sistemi informativi
>>    gestione sportiva
>>    /Collaboratore/
>>
>>    *Ferrari S.p.A. * Via Ascari 55/57, 41053, Maranello (MO); Italy
>>    *T* (+39) 0536-949.850
>>    *E* _simone.busoli at ferrari.com <mailto:simone.busoli at ferrari.com>_
>>    _www.ferrari.com <http://www.ferrari.com/>_
>>
>>
>>    *From:* Jon Brisbin [mailto:jon at jbrisbin.com]
>>    *Sent:* Wednesday, June 01, 2011 3:38 PM
>>    *To:* Busoli, Simone
>>    *Cc:* rabbitmq-discuss at lists.rabbitmq.com
>>    *Subject:* Re: [rabbitmq-discuss] How to handle full exchange
>>    history delivery
>>
>>    I've been seriously considering adding this functionality to the
>>    Riak-backed custom exchange. It was something I thought I would add
>>    first time through but didn't.
>>
>>    You'd have to use a custom exchange. Not sure if that's an issue in
>>    your scenario or not.
>>
>>
>>    Thanks!
>>
>>    Jon Brisbin
>>    http//jbrisbin.com
>>
>>
>>  ------------------------------------------------------------------------
>>
>>        *From: *"Simone Busoli" <Simone.Busoli at ferrari.com>
>>        *To: *rabbitmq-discuss at lists.rabbitmq.com
>>        *Sent: *Wednesday, June 1, 2011 5:52:24 AM
>>        *Subject: *[rabbitmq-discuss] How to handle full exchange
>>        history delivery
>>
>>        Hi,
>>
>>        I am trying to achieve a scenario in which messages are
>>        published from some data source into a RabbitMQ exchange and
>>        clients should be able to receive the full history of messages
>>        flown through that exchange, regardless of the exact moment in
>>        time when they connect.
>>
>>        I?ve been thinking to solve it by setting up a proxy which
>>        subscribes to the exchange where messages are published using
>>        its own queue, keeps an internal storage of the messages and
>>        accepts requests from clients.
>>
>>        When a request from a client arrives it just replays the full
>>        message history to the client by publishing the messages to the
>>        client queue (supplied in the ReplyTo field), *then* binds the
>>        client queue to the messages exchange, so that the client from
>>        this moment onwards starts receiving the ?live? messages, and is
>>        pretty much unaware of what?s happened; it simply just receives
>>        the whole history.
>>
>>        Now I am under the impression that there?s a fundamental flaw in
>>        this reasoning, since the proxy cannot know when the message
>>        history has completed and he can switch the client to the live
>>        stream, because while it is replaying historical messages to the
>>        client other live messages might be arriving on the proxy?s
>>        queue, thus getting into an endless loop.
>>
>>        I?m probably missing something obvious, any advice about how
>>        others would approach this scenario is appreciated.
>>
>>        Simone
>>
>>
>>  _________________________________________________________________________________________________________________
>>        Questo messaggio e da intendersi esclusivamente ad uso del
>>        destinatario e puo contenere informazioni che sono di natura
>>        privilegiata, confidenziale
>>        o non divulgabile secondo le leggi vigenti. Se il lettore del
>>        presente messaggio non e il destinatario designato, o il
>>        dipendente/agente responsabile
>>        per la consegna del messaggio al destinatario designato, si
>>        informa che ogni disseminazione, distribuzione o copiatura di
>>        questa comunicazione e
>>        strettamente proibita anche ai sensi del decreto legislativo
>>        196/03 . Se avete ricevuto questo messaggio per errore, vi
>>        preghiamo di notificarcelo
>>        immediatamente a mezzo e-mail di risposta e successivamente di
>>        procedere alla cancellazione di questa e-mail e relativi
>>        allegati dal vostro sistema.
>>
>>  _________________________________________________________________________________________________________________
>>        This message is intended only for the use of the addressee and
>>        may contain information that is privileged, confidential and
>>        exempt from
>>        disclosure under applicable law. If the reader of this message
>>        is not the intended recipient, or the employee or agent
>>        responsible for delivering the
>>        message to the intended recipient, you are hereby notified that
>>        any dissemination, distribution or copying of this communication
>>        is strictly
>>        prohibited. If you have received this e-mail in error, please
>>        notify us immediately by return e-mail and delete this e-mail
>>        and all attachments from
>>        your system.
>>
>>  _________________________________________________________________________________________________________________
>>
>>
>>        _______________________________________________
>>        rabbitmq-discuss mailing list
>>        rabbitmq-discuss at lists.rabbitmq.com
>>        <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>
>>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>  _________________________________________________________________________________________________________________
>>    Questo messaggio ? da intendersi esclusivamente ad uso del
>>    destinatario e pu? contenere informazioni che sono di natura
>>    privilegiata, confidenziale
>>    o non divulgabile secondo le leggi vigenti. Se il lettore del
>>    presente messaggio non ? il destinatario designato, o il
>>    dipendente/agente responsabile
>>    per la consegna del messaggio al destinatario designato, si informa
>>    che ogni disseminazione, distribuzione o copiatura di questa
>>    comunicazione ?
>>    strettamente proibita anche ai sensi del decreto legislativo 196/03
>>    . Se avete ricevuto questo messaggio per errore, vi preghiamo di
>>    notificarcelo
>>    immediatamente a mezzo e-mail di risposta e successivamente di
>>    procedere alla cancellazione di questa e-mail e relativi allegati
>>    dal vostro sistema.
>>
>>  _________________________________________________________________________________________________________________
>>    This message is intended only for the use of the addressee and may
>>    contain information that is privileged, confidential and exempt from
>>    disclosure under applicable law. If the reader of this message is
>>    not the intended recipient, or the employee or agent responsible for
>>    delivering the
>>    message to the intended recipient, you are hereby notified that any
>>    dissemination, distribution or copying of this communication is
>>    strictly
>>    prohibited. If you have received this e-mail in error, please notify
>>    us immediately by return e-mail and delete this e-mail and all
>>    attachments from
>>    your system.
>>
>>  _________________________________________________________________________________________________________________
>>
>>
>>    _______________________________________________
>>    rabbitmq-discuss mailing list
>>    rabbitmq-discuss at lists.rabbitmq.com
>>    <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>
>>    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _________________________________________________________________________________________________________________
>> Questo messaggio ? da intendersi esclusivamente ad uso del destinatario
>> e pu? contenere informazioni che sono di natura privilegiata,
>> confidenziale
>> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
>> messaggio non ? il destinatario designato, o il dipendente/agente
>> responsabile
>> per la consegna del messaggio al destinatario designato, si informa che
>> ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
>> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
>> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
>> immediatamente a mezzo e-mail di risposta e successivamente di procedere
>> alla cancellazione di questa e-mail e relativi allegati dal vostro
>> sistema.
>>
>> _________________________________________________________________________________________________________________
>> This message is intended only for the use of the addressee and may
>> contain information that is privileged, confidential and exempt from
>> disclosure under applicable law. If the reader of this message is not
>> the intended recipient, or the employee or agent responsible for
>> delivering the
>> message to the intended recipient, you are hereby notified that any
>> dissemination, distribution or copying of this communication is strictly
>> prohibited. If you have received this e-mail in error, please notify us
>> immediately by return e-mail and delete this e-mail and all attachments
>> from
>> your system.
>>
>> _________________________________________________________________________________________________________________
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/9bbf59eb/attachment-0001.htm>

From bkjones at gmail.com  Fri Jun  3 00:30:22 2011
From: bkjones at gmail.com (Brian K. Jones)
Date: Thu, 2 Jun 2011 19:30:22 -0400
Subject: [rabbitmq-discuss] Document HTTP API responses?
In-Reply-To: <0720336B07744FA8AA8E71ADCAF2E669@gmail.com>
References: <0720336B07744FA8AA8E71ADCAF2E669@gmail.com>
Message-ID: <19D28EF2DBB940C2B021586EF5C94AA1@gmail.com>

Here's a quick peek at two responses to the /api/overview call. Same server software version. 
#############################
{
"management_version":"2.4.1",
"statistics_level":"fine",

"message_stats":{"publish":2445210,"publish_details":{"rate":4.593489204928332,"last_event":1307046917111},"ack":31,"ack_details":{"rate":0,"last_event":1306966493190},"deliver":57,"deliver_details":{"rate":0,"last_event":1306966493190},"deliver_get":6228204,"deliver_get_details":{"rate":4.593484491297741,"last_event":1307046917111},"deliver_no_ack":6228147,"deliver_no_ack_details":{"rate":4.593484491297741,"last_event":1307046917111}},

"queue_totals":{"messages":44,"messages_ready":18,"messages_unacknowledged":26}
}
################################
{
"management_version":"2.4.1",
"statistics_level":"fine",

"message_stats":{"publish":11340,"publish_details":{"rate":0,"last_event":1307041432286},"ack":401,"ack_details":{"rate":0,"last_event":1307039730923},"deliver":401,"deliver_details":{"rate":0,"last_event":1307039730923},"deliver_get":215791,"deliver_get_details":{"rate":0,"last_event":1307041433196},"deliver_no_ack":215390,"deliver_no_ack_details":{"rate":0,"last_event":1307041433196}},

"queue_totals":{"messages":0,"messages_ready":0,"messages_unacknowledged":0},
"node":"rabbit at mybox",
"statistics_db_node":"rabbit at mybox",
"listeners":[{"node":"rabbit at mybox","protocol":"amqp","host":"mybox.example.com","ip_address":"::","port":5672},{"node":"rabbit at mybox","protocol":"stomp","host":"mybox.example.com","ip_address":"::","port":61613}]
}

#################################

As you can see, the second broker has 'node', 'statistics_db_node', and 'listeners', whereas the first broker does not. Just now I noticed we're supporting STOMP on one of the servers, but does that account for all of the differences above? What other JSON responses will be different because of this, and how? What other configuration options affect the JSON responses? How are they affected?

brian



-- 
Brian K. Jones
Sent over the internet
My blog: http://www.protocolostomy.com
Follow me: http://twitter.com/bkjones


On Thursday, June 2, 2011 at 4:35 PM, Brian K. Jones wrote:

> Hi, 
> 
> I'm testing a Python module that provides an easy way to work with the RabbitMQ Management HTTP API. I'm testing against various different broker instances, and I'm finding that, although they're the same version, there are apparently circumstances that exist which make the same call return different collections of attributes across different servers. For example, some hosts' 'overview' have a 'listeners' attribute while others don't. For queues, some have a 'node' attribute (iirc), and others don't. I imagine there are more of these situations, and I'm wondering if these conditions are documented anywhere? This would obviously be useful to those writing any code against the API as well, not just module authors (think of the poor ops folks writing nagios checks!). :) 
> 
> If the expectation is that servers with the same versions of the server and management software return the same exact attributes given the same exact calls, then let me know and I'll document these issues more thoroughly & update this thread (unless there's a public bug tracker?)
> 
> Thanks, 
> brian
> 
> 
> -- 
> Brian K. Jones
> Sent over the internet
> My blog: http://www.protocolostomy.com
> Follow me: http://twitter.com/bkjones
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110602/41f2ca52/attachment.htm>

From sebastien at hopper.travel  Fri Jun  3 01:33:20 2011
From: sebastien at hopper.travel (=?ISO-8859-1?Q?S=E9bastien_Rainville?=)
Date: Thu, 2 Jun 2011 20:33:20 -0400
Subject: [rabbitmq-discuss] message rates moving averages
Message-ID: <BANLkTinXVWASQx9m-=KfquSy2_OCuB47qQ@mail.gmail.com>

Hi,

I installed the management plugin to monitor the message rates but I have
trouble getting it to show accurate rates. Most of the time it shows that
it's receiving messages at a rate of 0 msg/s but I know that in reality I'm
getting messages at a rate of about 25 msg/s because I added some metrics in
my consumer code. The problem is that I'm receiving bursts of messages so
it's true that most of the time the instant rate is 0 msg/s, but on average
it's about 25 msg/s. I'm now adding more queues, things start to be a bit
more complex, including multiple shovels, and I'd really like to have
rabbitmq giving the real stats to have greater visibility on the traffic of
messages.

Is there a way to have a moving average of the rate that is greater than
what it is now, something like the load 1, 5 and 15 in linux? I looked at
configuration options but didn't find any for that... (btw, unless I missed
something, rabbitmq configuration is really obscure)

Thanks,
Sebastien
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110602/f8b235e2/attachment.htm>

From rajc at myquu.com  Fri Jun  3 07:40:14 2011
From: rajc at myquu.com (Rajarshi Chakravarty)
Date: Fri, 3 Jun 2011 12:10:14 +0530
Subject: [rabbitmq-discuss] 2 services on one machine
In-Reply-To: <4DE4B5F2.2020001@rabbitmq.com>
References: <000301cc1d11$69cf61f0$3d6e25d0$@com>
	<4DE4B5F2.2020001@rabbitmq.com>
Message-ID: <000801cc21b9$1aee6840$50cb38c0$@com>

Thank you, Emile.
Your mail makes me ask another question.
I have Erlang ver. 13B03. This came with the Rabbit 1.7.2 windows bundle.
Won't this work with RabbitMQ 2.4?

Regards
Raj

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Tuesday, May 31, 2011 3:04 PM
To: Rajarshi Chakravarty
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] 2 services on one machine

Hi Raj,

On 28/05/11 09:29, Rajarshi Chakravarty wrote:
> Hi,
>
> I have an old version(1.7.2) of RabbitMQ running as a service on my
> machine.

You should consider upgrading.

> I want to keep that as well as run the latest version as a service
> too.
>
> Please tell how to make that happen.
>
> I guess the rabbitmq-service.bat file will have to be changed.

This is possible, but it's easier to do by setting environment variables 
rather than editing the .bat files. You will need to make sure that at 
least the  service name (RABBITMQ_SERVICENAME) node name 
(RABBITMQ_NODENAME) and port (RABBITMQ_NODE_PORT) are set to values that 
are different from the existing service. The hidden 
"rabbitmq-service.bat list" command can help you make sure the values 
are all different.

Version 1.7.2 is very old. In fact it is so old that recent (R14B0*) 
versions of Erlang are no longer compatible with the compiled .beam 
format, so you will need to install the version 1.7.2 service to use an 
old enough version of Erlang. The two rabbit services do not need to be 
running on the same version of Erlang.



-Emile


From emile at rabbitmq.com  Fri Jun  3 09:39:16 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 03 Jun 2011 09:39:16 +0100
Subject: [rabbitmq-discuss] 2 services on one machine
In-Reply-To: <000801cc21b9$1aee6840$50cb38c0$@com>
References: <000301cc1d11$69cf61f0$3d6e25d0$@com>
	<4DE4B5F2.2020001@rabbitmq.com>
	<000801cc21b9$1aee6840$50cb38c0$@com>
Message-ID: <4DE89DB4.90600@rabbitmq.com>

Hi Raj,

On 03/06/11 07:40, Rajarshi Chakravarty wrote:
> Thank you, Emile. Your mail makes me ask another question. I have
> Erlang ver. 13B03. This came with the Rabbit 1.7.2 windows bundle. 
> Won't this work with RabbitMQ 2.4?

I can confirm that Erlang R13B03 will run rabbit version 1.7.2 and all
later versions (2.4.1 at the time of writing). You should normally try
to use the latest (non-alpha) version of Erlang, but in your case that's
not possible.


-Emile

From simon at rabbitmq.com  Fri Jun  3 10:47:39 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 03 Jun 2011 10:47:39 +0100
Subject: [rabbitmq-discuss] message rates moving averages
In-Reply-To: <BANLkTinXVWASQx9m-=KfquSy2_OCuB47qQ@mail.gmail.com>
References: <BANLkTinXVWASQx9m-=KfquSy2_OCuB47qQ@mail.gmail.com>
Message-ID: <4DE8ADBB.5080701@rabbitmq.com>

On 03/06/11 01:33, S?bastien Rainville wrote:
> Is there a way to have a moving average of the rate that is greater than
> what it is now, something like the load 1, 5 and 15 in linux? I looked
> at configuration options but didn't find any for that...

I'm afraid not. The message rate is just sampled over the last five 
seconds. Adding longer-period moving averages is on the to-do list, but 
at quite a low priority.

> (btw, unless I
> missed something, rabbitmq configuration is really obscure)

Yeah, that could be improved too. But all the configuration for the 
management plugin is documented at http://www.rabbitmq.com/management.html

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Fri Jun  3 11:02:20 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 03 Jun 2011 11:02:20 +0100
Subject: [rabbitmq-discuss] Document HTTP API responses?
In-Reply-To: <0720336B07744FA8AA8E71ADCAF2E669@gmail.com>
References: <0720336B07744FA8AA8E71ADCAF2E669@gmail.com>
Message-ID: <4DE8B12C.4080602@rabbitmq.com>

On 02/06/11 21:35, Brian K. Jones wrote:
> I'm testing a Python module that provides an easy way to work with the
> RabbitMQ Management HTTP API. I'm testing against various different
> broker instances, and I'm finding that, although they're the same
> version, there are apparently circumstances that exist which make the
> same call return different collections of attributes across different
> servers.

Hi Brian. You're right, this isn't very well documented. I'll try to 
give an overview here.

There are two reasons why different attributes appear: relevance and 
permissions.

The first derives from the fact that internally the mgmt plugin works by 
receiving statistics events from the various entities (connections, 
channels, queues) inside the broker. If a certain entity has never done 
something it'll never emit an event related to that - for example if the 
queue has only just been created and never received or delivered any 
messages, it won't have a message_stats attribute. This could also 
happen if fine-grained stats are disabled - the broker simply isn't 
emitting the events in this case. Therefore for stats-related 
attributes, you should always bear in mind that any given metric might 
be unknown.

However, that's not what you are seeing. The presence or absence of 
listeners / nodes etc comes down to the principle that non-administrator 
users are not meant to be able to see any of the structure of the broker 
- so they can't learn about which nodes exist other than the one they 
connect to. They also don't see message rates for vhosts they can't 
access, even when looking at "global" rates, while administrators do.

tl;dr: it depends whether you connect as an administrator or not.

Of course, for monitoring, lots of people want to be able to have a 
monitoring user which does not have administrator rights but can still 
see everything. This will hopefully bubble towards the top of the to-do 
list soon.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From Ozan.Seymen at tdpg.com  Fri Jun  3 12:21:07 2011
From: Ozan.Seymen at tdpg.com (Ozan Seymen)
Date: Fri, 3 Jun 2011 12:21:07 +0100
Subject: [rabbitmq-discuss] Database Corruption Possibilities
Message-ID: <E90DA8CBFB449146A7A73EFDF4CAD61306807F5875@plex05.fastcrop.local>

Hi all,

Can someone please explain the scenarios where we might have Rabbit message storage (is it mnesia?) corrupted in a way that it is not recoverable?

In the solution I am working on, I simply cannot afford to lose any messages. In order to secure this, I will:


*         Rely on publisher confirms. This should ensure that broker will always confirm whether it assumed responsibility and persisted the message.

*         Implement durable queues/exchanges.

*         Ack enabled in consumers to prevent losing messages if consumer dies halfway. I will solve the ordering problem on the consumer side.

Even though all of these above prevent message loss in normal conditions, none of them covers the case where data gets corrupted in the broker. There is a window (albeit small) that things might go wrong: broker assumes responsibility (message is in the disk) and before message is sent to the consumer, broker experiences problems which corrupts the storage. If I can't bring the broker up with all data previously persisted, I've lost messages - producer forgot about the message as broker accepts responsibility and consumers have no idea about the message as it hasn't been delivered to it.

Am I a total paranoid that is beyond help? Even so, I would really appreciate any info you guys can share.

Cheers,
oseymen





________________________________
This e-mail and any attached files are intended for the named addressee only. It contains information which may be confidential and legally privileged and also protected by copyright. Unless you are the named addressee (or authorised to receive for the addressee) you may not copy or use it or disclose it to anyone else. If you received it in error please notify the sender immediately and then delete it from your system.

Please be advised that the views and opinions expressed in this e-mail may not reflect the views and opinions of The Digital Property Group Limited or any of its subsidiary companies.

We make every effort to keep our network free from viruses. However, you do need to check this e-mail and any attachments to it for viruses as we can take no responsibility for any computer virus which may be transferred by way of this e-mail. We reserve the right to monitor all e-mail communications.

The Digital Property Group Limited is a Daily Mail and General Trust plc company.
Registered Office: Northcliffe House, 2 Derry Street, London, W8 5TT.
Registered in England & Wales No: 02290527 VAT no. 243571174

______________________________________________________________________
This email has been scanned by the MessageLabs Email Security System.
For more information please visit http://www.messagelabs.com/email 
______________________________________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/14a02c64/attachment.htm>

From sebastien at hopper.travel  Fri Jun  3 12:34:06 2011
From: sebastien at hopper.travel (=?ISO-8859-1?Q?S=E9bastien_Rainville?=)
Date: Fri, 3 Jun 2011 07:34:06 -0400
Subject: [rabbitmq-discuss] message rates moving averages
In-Reply-To: <4DE8ADBB.5080701@rabbitmq.com>
References: <BANLkTinXVWASQx9m-=KfquSy2_OCuB47qQ@mail.gmail.com>
	<4DE8ADBB.5080701@rabbitmq.com>
Message-ID: <BANLkTikvEM_Cn1d-rS1xqrJExE9oMqpyDQ@mail.gmail.com>

Is there a constant somewhere that I could change directly in the code so
that it's always an average over, say 1 minute, instead of the default 5
seconds? I browsed the source code of the management plugin but couldn't
isolate it. I don't know Erlang so it makes things a bit more complicated :P
Then, ideally I'd like to make that thing configurable in the config file.
Is it easy to do? If not, then I'm ok with simply changing the value
directly in the code.



On Fri, Jun 3, 2011 at 5:47 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 03/06/11 01:33, S?bastien Rainville wrote:
>
>> Is there a way to have a moving average of the rate that is greater than
>> what it is now, something like the load 1, 5 and 15 in linux? I looked
>> at configuration options but didn't find any for that...
>>
>
> I'm afraid not. The message rate is just sampled over the last five
> seconds. Adding longer-period moving averages is on the to-do list, but at
> quite a low priority.
>
>
>  (btw, unless I
>> missed something, rabbitmq configuration is really obscure)
>>
>
> Yeah, that could be improved too. But all the configuration for the
> management plugin is documented at http://www.rabbitmq.com/management.html
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/d2abc5c6/attachment.htm>

From alex.lovelltroy at gmail.com  Fri Jun  3 12:35:21 2011
From: alex.lovelltroy at gmail.com (Alex Lovell-Troy)
Date: Fri, 3 Jun 2011 12:35:21 +0100
Subject: [rabbitmq-discuss] Database Corruption Possibilities
In-Reply-To: <E90DA8CBFB449146A7A73EFDF4CAD61306807F5875@plex05.fastcrop.local>
References: <E90DA8CBFB449146A7A73EFDF4CAD61306807F5875@plex05.fastcrop.local>
Message-ID: <BANLkTi=gvve68xr4r-05pvsVZs99KOQP+g@mail.gmail.com>

There are a handful of approaches to this problem which all seem to follow a
similar pattern.  Until there is a way to replace mnesia with a replicable
back end, we've all written something on our own that wraps each amqp
transaction with a transactional write to the datastore of our choice and.
 I've seen this done with MySQL, MongoDB, and riak personally.

@jbrisbin has done some interesting work with implementing a specific queue
that sends messages to riak that looks intriguing.  I believe there is also
a piece that pushes messages from riak into rabbitmq.

At least, that was the state of the art the last time I looked

Anyone else?

-alex

On Fri, Jun 3, 2011 at 12:21 PM, Ozan Seymen <Ozan.Seymen at tdpg.com> wrote:

>  Hi all,
>
>
>
> Can someone please explain the scenarios where we might have Rabbit message
> storage (is it mnesia?) corrupted in a way that it is not recoverable?
>
>
>
> In the solution I am working on, I simply cannot afford to lose any
> messages. In order to secure this, I will:
>
>
>
> ?         Rely on publisher confirms. This should ensure that broker will
> always confirm whether it assumed responsibility and persisted the message.
>
> ?         Implement durable queues/exchanges.
>
> ?         Ack enabled in consumers to prevent losing messages if consumer
> dies halfway. I will solve the ordering problem on the consumer side.
>
>
>
> Even though all of these above prevent message loss in normal conditions,
> none of them covers the case where data gets corrupted in the broker. There
> is a window (albeit small) that things might go wrong: broker assumes
> responsibility (message is in the disk) and before message is sent to the
> consumer, broker experiences problems which corrupts the storage. If I can?t
> bring the broker up with all data previously persisted, I?ve lost messages ?
> producer forgot about the message as broker accepts responsibility and
> consumers have no idea about the message as it hasn?t been delivered to it.
>
>
>
> Am I a total paranoid that is beyond help? Even so, I would really
> appreciate any info you guys can share.
>
>
>
> Cheers,
>
> oseymen
>
>
>
>
>
>
>
>
>
> ------------------------------
> This e-mail and any attached files are intended for the named addressee
> only. It contains information which may be confidential and legally
> privileged and also protected by copyright. Unless you are the named
> addressee (or authorised to receive for the addressee) you may not copy or
> use it or disclose it to anyone else. If you received it in error please
> notify the sender immediately and then delete it from your system.
>
> Please be advised that the views and opinions expressed in this e-mail may
> not reflect the views and opinions of The Digital Property Group Limited or
> any of its subsidiary companies.
>
> We make every effort to keep our network free from viruses. However, you do
> need to check this e-mail and any attachments to it for viruses as we can
> take no responsibility for any computer virus which may be transferred by
> way of this e-mail. We reserve the right to monitor all e-mail
> communications.
>
> The Digital Property Group Limited is a Daily Mail and General Trust plc
> company.
> Registered Office: Northcliffe House, 2 Derry Street, London, W8 5TT.
> Registered in England & Wales No: 02290527 VAT no. 243571174
>
> ______________________________________________________________________
> This email has been scanned by the MessageLabs Email Security System.
> For more information please visit http://www.messagelabs.com/email
> ______________________________________________________________________
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/51fa024b/attachment-0001.htm>

From videlalvaro at gmail.com  Fri Jun  3 12:40:54 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 3 Jun 2011 13:40:54 +0200
Subject: [rabbitmq-discuss] Database Corruption Possibilities
In-Reply-To: <BANLkTi=gvve68xr4r-05pvsVZs99KOQP+g@mail.gmail.com>
References: <E90DA8CBFB449146A7A73EFDF4CAD61306807F5875@plex05.fastcrop.local>
	<BANLkTi=gvve68xr4r-05pvsVZs99KOQP+g@mail.gmail.com>
Message-ID: <8E0354BD-F819-4D6D-895E-4472CF121B30@gmail.com>

Just FYI,

RabbitMQ does not use Mnesia as message storage. It has it's own persister module.

AFAIK Mnesia is only used for storing routing tables, Exchanges and Queues meta information.

-Alvaro

On Jun 3, 2011, at 1:35 PM, Alex Lovell-Troy wrote:

> There are a handful of approaches to this problem which all seem to follow a similar pattern.  Until there is a way to replace mnesia with a replicable back end, we've all written something on our own that wraps each amqp transaction with a transactional write to the datastore of our choice and.  I've seen this done with MySQL, MongoDB, and riak personally.  
> 
> @jbrisbin has done some interesting work with implementing a specific queue that sends messages to riak that looks intriguing.  I believe there is also a piece that pushes messages from riak into rabbitmq.
> 
> At least, that was the state of the art the last time I looked
> 
> Anyone else?
> 
> -alex
> 
> On Fri, Jun 3, 2011 at 12:21 PM, Ozan Seymen <Ozan.Seymen at tdpg.com> wrote:
> Hi all,
> 
>  
> Can someone please explain the scenarios where we might have Rabbit message storage (is it mnesia?) corrupted in a way that it is not recoverable?
> 
>  
> In the solution I am working on, I simply cannot afford to lose any messages. In order to secure this, I will:
> 
>  
> ?         Rely on publisher confirms. This should ensure that broker will always confirm whether it assumed responsibility and persisted the message.
> 
> ?         Implement durable queues/exchanges.
> 
> ?         Ack enabled in consumers to prevent losing messages if consumer dies halfway. I will solve the ordering problem on the consumer side.
> 
>  
> Even though all of these above prevent message loss in normal conditions, none of them covers the case where data gets corrupted in the broker. There is a window (albeit small) that things might go wrong: broker assumes responsibility (message is in the disk) and before message is sent to the consumer, broker experiences problems which corrupts the storage. If I can?t bring the broker up with all data previously persisted, I?ve lost messages ? producer forgot about the message as broker accepts responsibility and consumers have no idea about the message as it hasn?t been delivered to it.
> 
>  
> Am I a total paranoid that is beyond help? Even so, I would really appreciate any info you guys can share.
> 
>  
> Cheers,
> 
> oseymen
> 
>  
>   
>  
>  
> 
> This e-mail and any attached files are intended for the named addressee only. It contains information which may be confidential and legally privileged and also protected by copyright. Unless you are the named addressee (or authorised to receive for the addressee) you may not copy or use it or disclose it to anyone else. If you received it in error please notify the sender immediately and then delete it from your system.
> 
> Please be advised that the views and opinions expressed in this e-mail may not reflect the views and opinions of The Digital Property Group Limited or any of its subsidiary companies.
> 
> We make every effort to keep our network free from viruses. However, you do need to check this e-mail and any attachments to it for viruses as we can take no responsibility for any computer virus which may be transferred by way of this e-mail. We reserve the right to monitor all e-mail communications.
> 
> The Digital Property Group Limited is a Daily Mail and General Trust plc company.
> Registered Office: Northcliffe House, 2 Derry Street, London, W8 5TT.
> Registered in England & Wales No: 02290527 VAT no. 243571174
> 
> ______________________________________________________________________
> This email has been scanned by the MessageLabs Email Security System.
> For more information please visit http://www.messagelabs.com/email 
> ______________________________________________________________________
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/a45c0ced/attachment.htm>

From simon at rabbitmq.com  Fri Jun  3 13:17:16 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 03 Jun 2011 13:17:16 +0100
Subject: [rabbitmq-discuss] message rates moving averages
In-Reply-To: <BANLkTikvEM_Cn1d-rS1xqrJExE9oMqpyDQ@mail.gmail.com>
References: <BANLkTinXVWASQx9m-=KfquSy2_OCuB47qQ@mail.gmail.com>	<4DE8ADBB.5080701@rabbitmq.com>
	<BANLkTikvEM_Cn1d-rS1xqrJExE9oMqpyDQ@mail.gmail.com>
Message-ID: <4DE8D0CC.2050408@rabbitmq.com>

On 03/06/11 12:34, S?bastien Rainville wrote:
> Is there a constant somewhere that I could change directly in the code
> so that it's always an average over, say 1 minute, instead of the
> default 5 seconds? I browsed the source code of the management plugin
> but couldn't isolate it. I don't know Erlang so it makes things a bit
> more complicated :P Then, ideally I'd like to make that thing
> configurable in the config file. Is it easy to do? If not, then I'm ok
> with simply changing the value directly in the code.

It's actually in the broker rather than the management plugin. Change 
the line defining STATS_INTERVAL in rabbitmq-server/include/rabbit.hrl.

Hmm, maybe we should make this configurable...

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From shammi at arosys.com  Fri Jun  3 13:26:34 2011
From: shammi at arosys.com (cheepu)
Date: Fri, 3 Jun 2011 05:26:34 -0700 (PDT)
Subject: [rabbitmq-discuss]  Message is available in multiple queue
Message-ID: <31764872.post@talk.nabble.com>


Hi,

In my producer and consumer code Exchange Name and RouteKey name are same.
In the producer i am setting the message property "replyTo" with the message
queue name.
As i think it after this message should be put in the message queue whose
name is specified in the "reply To" property, but this message is available
in all the queue whose name is being used in past.
My question is: does setting the reply to property bind the message with a
queue? If this is the case then why messages are available in multiple
queues, and if this is not the case then how can restrict the messages to be
put in only one queue?

Thanks
-- 
View this message in context: http://old.nabble.com/Message-is-available-in-multiple-queue-tp31764872p31764872.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From videlalvaro at gmail.com  Fri Jun  3 13:35:37 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 3 Jun 2011 14:35:37 +0200
Subject: [rabbitmq-discuss] Message is available in multiple queue
In-Reply-To: <31764872.post@talk.nabble.com>
References: <31764872.post@talk.nabble.com>
Message-ID: <84643C55-FD01-4907-AE59-AB6052794B56@gmail.com>

Setting the reply_to of a message does not put the message on a queue whose name is the value of that message property.

Messages are routed based on exchanges and bindings. So you publish a message to an exchange using certain routing key. If there's a queue bound to that exchange whose binding matches the routing key you used to publish the message then the message will be delivered to said queue.

The reply_to property is usually used for RPC scenarios. You publish messages adding a reply_to value to them. Then the consumer on the other end inspects that reply_to value and publishes a reply message to the anonymous exchange (or unnamed exchange) using that reply_to property as routing key. Since every queue is bound to that anonymous exchange using its name as binding key, the message will arrive to said queue.

See: http://eaipatterns.com/ReturnAddress.html and http://www.rabbitmq.com/tutorials/tutorial-six-python.html for some sample implementation.

Regards,

-Alvaro

On Jun 3, 2011, at 2:26 PM, cheepu wrote:

> 
> Hi,
> 
> In my producer and consumer code Exchange Name and RouteKey name are same.
> In the producer i am setting the message property "replyTo" with the message
> queue name.
> As i think it after this message should be put in the message queue whose
> name is specified in the "reply To" property, but this message is available
> in all the queue whose name is being used in past.
> My question is: does setting the reply to property bind the message with a
> queue? If this is the case then why messages are available in multiple
> queues, and if this is not the case then how can restrict the messages to be
> put in only one queue?
> 
> Thanks
> -- 
> View this message in context: http://old.nabble.com/Message-is-available-in-multiple-queue-tp31764872p31764872.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From kamauallan at gmail.com  Fri Jun  3 13:53:55 2011
From: kamauallan at gmail.com (Allan Kamau)
Date: Fri, 3 Jun 2011 15:53:55 +0300
Subject: [rabbitmq-discuss] Database Corruption Possibilities
In-Reply-To: <8E0354BD-F819-4D6D-895E-4472CF121B30@gmail.com>
References: <E90DA8CBFB449146A7A73EFDF4CAD61306807F5875@plex05.fastcrop.local>
	<BANLkTi=gvve68xr4r-05pvsVZs99KOQP+g@mail.gmail.com>
	<8E0354BD-F819-4D6D-895E-4472CF121B30@gmail.com>
Message-ID: <BANLkTinjfqz6kfzgoKNmU_8f8KfPpsm63g@mail.gmail.com>

On Fri, Jun 3, 2011 at 2:40 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Just FYI,
> RabbitMQ does not use Mnesia as message storage. It has it's own persister
> module.
> AFAIK Mnesia is only used for storing routing tables, Exchanges and Queues
> meta information.
> -Alvaro
> On Jun 3, 2011, at 1:35 PM, Alex Lovell-Troy wrote:
>
> There are a handful of approaches to this problem which all seem to follow a
> similar pattern. ?Until there is a way to replace mnesia with a replicable
> back end, we've all written something on our own that wraps each amqp
> transaction with a transactional write to the datastore of our choice and.
> ?I've seen this done with MySQL, MongoDB, and riak personally.
> @jbrisbin has done some interesting work with implementing a specific queue
> that sends messages to riak that looks intriguing. ?I believe there is also
> a piece that pushes messages from riak into rabbitmq.
> At least, that was the state of the art the last time I looked
> Anyone else?
> -alex
> On Fri, Jun 3, 2011 at 12:21 PM, Ozan Seymen <Ozan.Seymen at tdpg.com> wrote:
>>
>> Hi all,
>>
>>
>>
>> Can someone please explain the scenarios where we might have Rabbit
>> message storage (is it mnesia?) corrupted in a way that it is not
>> recoverable?
>>
>>
>>
>> In the solution I am working on, I simply cannot afford to lose any
>> messages. In order to secure this, I will:
>>
>>
>>
>> ????????? Rely on publisher confirms. This should ensure that broker will
>> always confirm whether it assumed responsibility and persisted the message.
>>
>> ????????? Implement durable queues/exchanges.
>>
>> ????????? Ack enabled in consumers to prevent losing messages if consumer
>> dies halfway. I will solve the ordering problem on the consumer side.
>>
>>
>>
>> Even though all of these above prevent message loss in normal conditions,
>> none of them covers the case where data gets corrupted in the broker. There
>> is a window (albeit small) that things might go wrong: broker assumes
>> responsibility (message is in the disk) and before message is sent to the
>> consumer, broker experiences problems which corrupts the storage. If I can?t
>> bring the broker up with all data previously persisted, I?ve lost messages ?
>> producer forgot about the message as broker accepts responsibility and
>> consumers have no idea about the message as it hasn?t been delivered to it.
>>
>>
>>
>> Am I a total paranoid that is beyond help? Even so, I would really
>> appreciate any info you guys can share.
>>
>>
>>
>> Cheers,
>>
>> oseymen
>>
>>
>>
>>
>>
>>
>> ________________________________
>> This e-mail and any attached files are intended for the named addressee
>> only. It contains information which may be confidential and legally
>> privileged and also protected by copyright. Unless you are the named
>> addressee (or authorised to receive for the addressee) you may not copy or
>> use it or disclose it to anyone else. If you received it in error please
>> notify the sender immediately and then delete it from your system.
>>
>> Please be advised that the views and opinions expressed in this e-mail may
>> not reflect the views and opinions of The Digital Property Group Limited or
>> any of its subsidiary companies.
>>
>> We make every effort to keep our network free from viruses. However, you
>> do need to check this e-mail and any attachments to it for viruses as we can
>> take no responsibility for any computer virus which may be transferred by
>> way of this e-mail. We reserve the right to monitor all e-mail
>> communications.
>>
>> The Digital Property Group Limited is a Daily Mail and General Trust plc
>> company.
>> Registered Office: Northcliffe House, 2 Derry Street, London, W8 5TT.
>> Registered in England & Wales No: 02290527 VAT no. 243571174
>>
>> ______________________________________________________________________
>> This email has been scanned by the MessageLabs Email Security System.
>> For more information please visit http://www.messagelabs.com/email
>> ______________________________________________________________________
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> Sent form my Nokia 1100
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

I would recommend a solution similar to Alex's but using PostgreSQL.
Have each message send to a special queue to this queue have a
consuming application that simply inserts each message into a database
table. Then have the same application send the message to your
ordinary queue, then acknowledge it's consumption of the message it
received. You may implement something similar on the reverse to ensure
that you know what messages have be processed at any time.

Then when things don't go very well, you will have the listing of the
messages produced and another listing of the messages consumed
(successfully). Then you may write a small script that injects the
produced-but-not-yet-successfully processed messages into the queue of
the newly initialized rabbitmq installation.

Ideally you may want to develop this application as a multi-threaded
application to make use of more cores on your server. This application
could be hosted on a different server that has the DB running on SSD,
then periodically make backups to your usual mechanical HDD, and
subsequently to another HDD which you will be taking offsite everyday
to interchange with other the next morning.

Testing the implementations of these work-arounds is very important to
ensure it all works as planned. In a way the messages produced and
messages consumed tables could be used for other purposes too.

Why PostgreSQL?
1)MyISAM may not scale very well under significantly high concurrent
write situations.
2)Table corruption may be a possibility that is why there is a repair
utility in your MySQL's bin directory (the last time I checked).
3)The numerous other MVCC based engine offerings under MySQL are very
new and may not be as scalable as PostgreSQL. Why, it has taken the
leading MVCC based databases companies decades developing, refining
and honing their MVCC DB engines. Concurrency is a challenging
concept.
4)I think now (just as before) one needs to pay for MySQL.
5)It is possible that referential and data integrity concepts are
still not being appreciated in the MySQL community as it may be
de-harmonizing their speed song.

Allan.

From shammi at arosys.com  Fri Jun  3 13:57:07 2011
From: shammi at arosys.com (cheepu)
Date: Fri, 3 Jun 2011 05:57:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Message is available in multiple queue
In-Reply-To: <31764872.post@talk.nabble.com>
References: <31764872.post@talk.nabble.com>
Message-ID: <31765174.post@talk.nabble.com>



This means if i want to put the message in one dedicated queue then i will
have to keep the Exchange name and routekey name combination unique?





cheepu wrote:
> 
> Hi,
> 
> In my producer and consumer code Exchange Name and RouteKey name are same.
> In the producer i am setting the message property "replyTo" with the
> message queue name.
> As i think it after this message should be put in the message queue whose
> name is specified in the "reply To" property, but this message is
> available in all the queue whose name is being used in past.
> My question is: does setting the reply to property bind the message with a
> queue? If this is the case then why messages are available in multiple
> queues, and if this is not the case then how can restrict the messages to
> be put in only one queue?
> 
> Thanks
> 

-- 
View this message in context: http://old.nabble.com/Message-is-available-in-multiple-queue-tp31764872p31765174.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sebastien at hopper.travel  Fri Jun  3 13:59:51 2011
From: sebastien at hopper.travel (=?ISO-8859-1?Q?S=E9bastien_Rainville?=)
Date: Fri, 3 Jun 2011 08:59:51 -0400
Subject: [rabbitmq-discuss] message rates moving averages
In-Reply-To: <4DE8D0CC.2050408@rabbitmq.com>
References: <BANLkTinXVWASQx9m-=KfquSy2_OCuB47qQ@mail.gmail.com>
	<4DE8ADBB.5080701@rabbitmq.com>
	<BANLkTikvEM_Cn1d-rS1xqrJExE9oMqpyDQ@mail.gmail.com>
	<4DE8D0CC.2050408@rabbitmq.com>
Message-ID: <BANLkTikMdWO4HmhTVd2uyMDkxwNEu6fs0Q@mail.gmail.com>

Thanks! I'll change it in the code directly for now, but yes simply making
it configurable would be great. Since it seems fairly simple, any chance
that thing can go up in the priority queue?



On Fri, Jun 3, 2011 at 8:17 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 03/06/11 12:34, S?bastien Rainville wrote:
>
>> Is there a constant somewhere that I could change directly in the code
>> so that it's always an average over, say 1 minute, instead of the
>> default 5 seconds? I browsed the source code of the management plugin
>> but couldn't isolate it. I don't know Erlang so it makes things a bit
>> more complicated :P Then, ideally I'd like to make that thing
>> configurable in the config file. Is it easy to do? If not, then I'm ok
>> with simply changing the value directly in the code.
>>
>
> It's actually in the broker rather than the management plugin. Change the
> line defining STATS_INTERVAL in rabbitmq-server/include/rabbit.hrl.
>
> Hmm, maybe we should make this configurable...
>
>
> Cheers, Simon
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/25572255/attachment.htm>

From videlalvaro at gmail.com  Fri Jun  3 14:02:32 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 3 Jun 2011 15:02:32 +0200
Subject: [rabbitmq-discuss] Database Corruption Possibilities
In-Reply-To: <BANLkTinjfqz6kfzgoKNmU_8f8KfPpsm63g@mail.gmail.com>
References: <E90DA8CBFB449146A7A73EFDF4CAD61306807F5875@plex05.fastcrop.local>
	<BANLkTi=gvve68xr4r-05pvsVZs99KOQP+g@mail.gmail.com>
	<8E0354BD-F819-4D6D-895E-4472CF121B30@gmail.com>
	<BANLkTinjfqz6kfzgoKNmU_8f8KfPpsm63g@mail.gmail.com>
Message-ID: <42419625-DC13-44D2-8E88-D2B28FFD5776@gmail.com>

> 
> 4)I think now (just as before) one needs to pay for MySQL.

You don't need to pay for MySQL: http://dev.mysql.com/downloads/mysql/ The community edition is free and AFAIK is what most LAMP users are using.


From Ozan.Seymen at tdpg.com  Fri Jun  3 14:10:28 2011
From: Ozan.Seymen at tdpg.com (Ozan Seymen)
Date: Fri, 3 Jun 2011 14:10:28 +0100
Subject: [rabbitmq-discuss] Database Corruption Possibilities
In-Reply-To: <BANLkTi=gvve68xr4r-05pvsVZs99KOQP+g@mail.gmail.com>
References: <E90DA8CBFB449146A7A73EFDF4CAD61306807F5875@plex05.fastcrop.local>
	<BANLkTi=gvve68xr4r-05pvsVZs99KOQP+g@mail.gmail.com>
Message-ID: <E90DA8CBFB449146A7A73EFDF4CAD61306807F590E@plex05.fastcrop.local>

Thanks Alex. That's also something I thought of - creating a transaction log somewhere else and replay that log if rabbit storage gets corrupted.

However wouldn't I have the same the problem if I use a specific queue to push data to another datastore, i.e. if the consumer listening to that queue is not fast enough, messages will accumulate in the queue. If queue data is corrupted shortly after, I will lose messages before my "transaction log writer" see them.

The only way that I can think of is to persist the message to my custom transaction log (MySQL, etc) _on the publisher side_ before message goes into rabbit. In order to guarantee that _all_ messages go in the transaction log, I would have to do this synchronously, i.e. if I can't persist the data in my transaction log, I won't bother pushing that message to rabbit. But this seems to be doing too much on the producer side and will obviously affect producer performance. Other way of achieving this would be to use two phase commits but I don't want to go there...

I will definitely check @jbrisbin's work. That sounds really interesting.

Cheers,
oseymen

From: Alex Lovell-Troy [mailto:alex.lovelltroy at gmail.com]
Sent: 03 June 2011 12:35
To: Ozan Seymen
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Database Corruption Possibilities

There are a handful of approaches to this problem which all seem to follow a similar pattern.  Until there is a way to replace mnesia with a replicable back end, we've all written something on our own that wraps each amqp transaction with a transactional write to the datastore of our choice and.  I've seen this done with MySQL, MongoDB, and riak personally.

@jbrisbin has done some interesting work with implementing a specific queue that sends messages to riak that looks intriguing.  I believe there is also a piece that pushes messages from riak into rabbitmq.

At least, that was the state of the art the last time I looked

Anyone else?

-alex

On Fri, Jun 3, 2011 at 12:21 PM, Ozan Seymen <Ozan.Seymen at tdpg.com<mailto:Ozan.Seymen at tdpg.com>> wrote:
Hi all,

Can someone please explain the scenarios where we might have Rabbit message storage (is it mnesia?) corrupted in a way that it is not recoverable?

In the solution I am working on, I simply cannot afford to lose any messages. In order to secure this, I will:


*         Rely on publisher confirms. This should ensure that broker will always confirm whether it assumed responsibility and persisted the message.

*         Implement durable queues/exchanges.

*         Ack enabled in consumers to prevent losing messages if consumer dies halfway. I will solve the ordering problem on the consumer side.

Even though all of these above prevent message loss in normal conditions, none of them covers the case where data gets corrupted in the broker. There is a window (albeit small) that things might go wrong: broker assumes responsibility (message is in the disk) and before message is sent to the consumer, broker experiences problems which corrupts the storage. If I can't bring the broker up with all data previously persisted, I've lost messages - producer forgot about the message as broker accepts responsibility and consumers have no idea about the message as it hasn't been delivered to it.

Am I a total paranoid that is beyond help? Even so, I would really appreciate any info you guys can share.

Cheers,
oseymen





________________________________
This e-mail and any attached files are intended for the named addressee only. It contains information which may be confidential and legally privileged and also protected by copyright. Unless you are the named addressee (or authorised to receive for the addressee) you may not copy or use it or disclose it to anyone else. If you received it in error please notify the sender immediately and then delete it from your system.

Please be advised that the views and opinions expressed in this e-mail may not reflect the views and opinions of The Digital Property Group Limited or any of its subsidiary companies.

We make every effort to keep our network free from viruses. However, you do need to check this e-mail and any attachments to it for viruses as we can take no responsibility for any computer virus which may be transferred by way of this e-mail. We reserve the right to monitor all e-mail communications.

The Digital Property Group Limited is a Daily Mail and General Trust plc company.
Registered Office: Northcliffe House, 2 Derry Street, London, W8 5TT.
Registered in England & Wales No: 02290527 VAT no. 243571174

______________________________________________________________________
This email has been scanned by the MessageLabs Email Security System.
For more information please visit http://www.messagelabs.com/email
______________________________________________________________________

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


______________________________________________________________________
This email has been scanned by the MessageLabs Email Security System.
For more information please visit http://www.messagelabs.com/email
______________________________________________________________________

________________________________
This e-mail and any attached files are intended for the named addressee only. It contains information which may be confidential and legally privileged and also protected by copyright. Unless you are the named addressee (or authorised to receive for the addressee) you may not copy or use it or disclose it to anyone else. If you received it in error please notify the sender immediately and then delete it from your system.

Please be advised that the views and opinions expressed in this e-mail may not reflect the views and opinions of The Digital Property Group Limited or any of its subsidiary companies.

We make every effort to keep our network free from viruses. However, you do need to check this e-mail and any attachments to it for viruses as we can take no responsibility for any computer virus which may be transferred by way of this e-mail. We reserve the right to monitor all e-mail communications.

The Digital Property Group Limited is a Daily Mail and General Trust plc company.
Registered Office: Northcliffe House, 2 Derry Street, London, W8 5TT.
Registered in England & Wales No: 02290527 VAT no. 243571174

______________________________________________________________________
This email has been scanned by the MessageLabs Email Security System.
For more information please visit http://www.messagelabs.com/email 
______________________________________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/96633659/attachment-0001.htm>

From davegreggory at yahoo.com  Fri Jun  3 15:11:59 2011
From: davegreggory at yahoo.com (Dave Greggory)
Date: Fri, 3 Jun 2011 07:11:59 -0700 (PDT)
Subject: [rabbitmq-discuss] message rates moving averages
In-Reply-To: <BANLkTikMdWO4HmhTVd2uyMDkxwNEu6fs0Q@mail.gmail.com>
References: <BANLkTinXVWASQx9m-=KfquSy2_OCuB47qQ@mail.gmail.com>
	<4DE8ADBB.5080701@rabbitmq.com>
	<BANLkTikvEM_Cn1d-rS1xqrJExE9oMqpyDQ@mail.gmail.com>
	<4DE8D0CC.2050408@rabbitmq.com>
	<BANLkTikMdWO4HmhTVd2uyMDkxwNEu6fs0Q@mail.gmail.com>
Message-ID: <888619.14950.qm@web111003.mail.gq1.yahoo.com>

+1 for this feature request.




________________________________
From: S?bastien Rainville <sebastien at hopper.travel>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Fri, June 3, 2011 8:59:51 AM
Subject: Re: [rabbitmq-discuss] message rates moving averages

Thanks! I'll change it in the code directly for now, but yes simply making it 
configurable would be great. Since it seems fairly simple, any chance that thing 
can go up in the priority queue?




On Fri, Jun 3, 2011 at 8:17 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

On 03/06/11 12:34, S?bastien Rainville wrote:
>
>Is there a constant somewhere that I could change directly in the code
>>so that it's always an average over, say 1 minute, instead of the
>>default 5 seconds? I browsed the source code of the management plugin
>>but couldn't isolate it. I don't know Erlang so it makes things a bit
>>more complicated :P Then, ideally I'd like to make that thing
>>configurable in the config file. Is it easy to do? If not, then I'm ok
>>with simply changing the value directly in the code.
>>

It's actually in the broker rather than the management plugin. Change the line 
defining STATS_INTERVAL in rabbitmq-server/include/rabbit.hrl.
>
>Hmm, maybe we should make this configurable...
>
>
>Cheers, Simon
>-- 
>Simon MacMullen
>Staff Engineer, RabbitMQ
>SpringSource, a division of VMware
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/42c6d18e/attachment.htm>

From bkjones at gmail.com  Fri Jun  3 16:06:13 2011
From: bkjones at gmail.com (Brian K. Jones)
Date: Fri, 3 Jun 2011 11:06:13 -0400
Subject: [rabbitmq-discuss] Document HTTP API responses?
In-Reply-To: <4DE8B12C.4080602@rabbitmq.com>
References: <0720336B07744FA8AA8E71ADCAF2E669@gmail.com>
	<4DE8B12C.4080602@rabbitmq.com>
Message-ID: <A6F615DAA5D64E57A854EBEE1893956A@gmail.com>




On Friday, June 3, 2011 at 6:02 AM, Simon MacMullen wrote:

> On 02/06/11 21:35, Brian K. Jones wrote:
> > I'm testing a Python module that provides an easy way to work with the
> > RabbitMQ Management HTTP API. I'm testing against various different
> > broker instances, and I'm finding that, although they're the same
> > version, there are apparently circumstances that exist which make the
> > same call return different collections of attributes across different
> > servers.
> 
> Hi Brian. You're right, this isn't very well documented. I'll try to 
> give an overview here.

This would likely be a lot to document, but perhaps a start would be to document just the base attributes that should be in every single request for a given resource, and then build the docs up from there. So, what should be in an /api/queues response if: 

You're not an admin and:
a) there are no queues
b) there are queues, but no events
c) there are queues and events

You *are* an admin and:
a) there are no queues
b) there are queues, but no events
c) there are queues and events

That'd be a good start, and you can build from there to include attributes with object values that also differ and all the corner case-ish things. 

If there were some kind of collaborative doc project with a moderator or a passthrough for commits, I'd love to know about that, btw.
Let me know!

brian


> 
> There are two reasons why different attributes appear: relevance and 
> permissions.
> 
> The first derives from the fact that internally the mgmt plugin works by 
> receiving statistics events from the various entities (connections, 
> channels, queues) inside the broker. If a certain entity has never done 
> something it'll never emit an event related to that - for example if the 
> queue has only just been created and never received or delivered any 
> messages, it won't have a message_stats attribute. This could also 
> happen if fine-grained stats are disabled - the broker simply isn't 
> emitting the events in this case. Therefore for stats-related 
> attributes, you should always bear in mind that any given metric might 
> be unknown.
> 
> However, that's not what you are seeing. The presence or absence of 
> listeners / nodes etc comes down to the principle that non-administrator 
> users are not meant to be able to see any of the structure of the broker 
> - so they can't learn about which nodes exist other than the one they 
> connect to. They also don't see message rates for vhosts they can't 
> access, even when looking at "global" rates, while administrators do.
> 
> tl;dr: it depends whether you connect as an administrator or not.
> 
> Of course, for monitoring, lots of people want to be able to have a 
> monitoring user which does not have administrator rights but can still 
> see everything. This will hopefully bubble towards the top of the to-do 
> list soon.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/08ca9863/attachment.htm>

From alexis at rabbitmq.com  Fri Jun  3 16:47:00 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 3 Jun 2011 16:47:00 +0100
Subject: [rabbitmq-discuss] Perl Net::RabbitMQ and failure conditions
In-Reply-To: <BANLkTimz4P1H+NgiAkdhQ_C3CNCjbmum7Q@mail.gmail.com>
References: <BANLkTim==hb=hDLCqEN=0J5vfbHQN14BOw@mail.gmail.com>
	<BANLkTi=BKveXBFiObCUDCvUcAhx3-8Oyrg@mail.gmail.com>
	<BANLkTimz4P1H+NgiAkdhQ_C3CNCjbmum7Q@mail.gmail.com>
Message-ID: <BANLkTim7mAL7+paskDUU8-kOA5Wh4kCLog@mail.gmail.com>

Ronald

I spoke with the author, Theo Schlossnagle, who permitted to post his
reply here:

-
You must catch SIGPIPE if you plan to handle busted writes on
sockets. This is straight forward from perl.

The publishes don't erroneously indicated success as the writes() and
synchronous. The remote is down, but the TCP socket hasn't realized it
yet... So you write(), which is fine (as the socket hasn't flushed).
So, if it flushes into the kernel and the kernel knows the socket is
busted -> SIGPIPE, if not, then you'll get a successful publish.  That
behaviour is expected, no?

The hang in DESTROY sounds like a bug -- I have not seen that one on
my side.  Would like some more information -- user-space stack trace
of the hung perl process w/ symbols would be awesome.

You can also open a issue on github for the specific problems
remaining unresolved:

https://github.com/omniti-labs/Net--RabbitMQ
-

Hope this helps!

alexis



On Tue, May 31, 2011 at 6:34 PM, Ronald J Kimball
<rkimball at pangeamedia.com> wrote:
> Hi, thanks for the response.? Unfortunately, I haven't really found an
> answer.
>
> We upgraded RabbitMQ to 2.4.1, after which Net::RabbitMQ no longer hangs
> when the remote server is up but the remote app is down.
>
> However, Net::RabbitMQ still returns a false success when the remote server
> or app goes down after the publisher connects to the local node.? (The queue
> is located on the remote app.)
>
> For now, we've switched to having a single node.? This decreases our
> throughput slightly, but at least we don't risk dropping messages.
>
> I think we must be doing something wrong, but I don't know what...
>
> Ronald
>
>
> On Tue, May 31, 2011 at 7:41 AM, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
>>
>> Ronald
>>
>> Were you able to find an answer to this?
>>
>> alexis
>>
>>
>>
>> On Thu, May 19, 2011 at 9:44 PM, Ronald J Kimball
>> <rkimball at pangeamedia.com> wrote:
>> > I'm trying to understand how RabbitMQ behaves under failure conditions,
>> > specifically when using the Net::RabbitMQ Perl module.
>> >
>> > We have RabbitMQ set up with three nodes, one on the backend, which
>> > holds
>> > the actual queues, and two on the frontend, which receive publish
>> > requests.
>> >
>> > RabbitMQ 2.2.0
>> > Net::RabbitMQ 0.1.8
>> >
>> >
>> > Below is the chart of behaviors that I have observed.
>> >
>> > "+" means the behavior is as I expected: either the message is
>> > successfully
>> > queued, or an error is thrown.
>> > "-" means the behavior is not as I expected, but can be managed:
>> > specifically, the process receives a SIGPIPE, which I can trap and
>> > recover
>> > from.
>> > "!" means the behavior is not as I expected, and cannot be managed: the
>> > message is not queued but no error is thrown and/or the process hangs.
>> >
>> > "App down" means I ran `rabbitmqctl stop_app`.? "Daemon down" means I
>> > ran
>> > `rabbitmqctl stop`.
>> >
>> > ? As publishing process starts up:
>> >
>> > ??? Remote daemon up, app up
>> > ????? + Everything okay
>> >
>> > ??? Remote daemon up, app down
>> > ????? ! Net::RabbitMQ hangs when declaring queue
>> >
>> > ??? Remote daemon down
>> > ????? + Net::RabbitMQ throws error when declaring queue
>> > ??????? "Declaring queue: server channel error 404, message: NOT_FOUND -
>> > no
>> > queue 'test' in vhost '/'"
>> >
>> > ??? Local daemon up, app down
>> > ????? + Net::RabbitMQ throws error when connecting
>> > ??????? "Opening socket: Connection refused"
>> >
>> > ??? Local daemon down
>> > ????? + Net::RabbitMQ throws error when connecting
>> > ??????? "Opening socket: Connection refused"
>> >
>> >
>> > ? After publishing process starts up:
>> >
>> > ??? Local app goes down
>> > ????? - Process receives SIGPIPE
>> >
>> > ??? Local daemon goes down
>> > ????? - Process receives SIGPIPE
>> >
>> > ??? Remote app goes down
>> > ????? ! Net::RabbitMQ falsely indicates success when publishing, then
>> > hangs
>> > (in DESTROY?)
>> >
>> > ??? Remote daemon goes down
>> > ????? ! Net::RabbitMQ falsely indicates success when publishing
>> >
>> >
>> > ??? Local app goes down, comes back up
>> > ????? - Process receives SIGPIPE
>> >
>> > ??? Local daemon goes down, comes back up
>> > ????? - Process receives SIGPIPE
>> >
>> > ??? Remote app goes down, comes back up
>> > ????? + Everything okay
>> >
>> > ??? Remote daemon goes down, comes back up
>> > ????? + Everything okay
>> >
>> >
>> > Have other people had these problems with Net::RabbitMQ?? Can we resolve
>> > these issues by changing something in our RabbitMQ configuration?
>> >
>> >
>> > thanks,
>> > Ronald
>> >
>> >
>> > P.S. Here's my script.
>> >
>> > #!/usr/local/bin/perl
>> >
>> > use strict;
>> > use warnings;
>> >
>> > use Net::RabbitMQ;
>> >
>> > $| = 1;
>> >
>> > $SIG{'PIPE'} = sub { die "SIGPIPE\n" };
>> >
>> > my $mq = Net::RabbitMQ->new();
>> >
>> > alarm(10);
>> >
>> > print "Connecting\n";
>> > $mq->connect('localhost', { user => 'engagement', password => '********'
>> > })
>> > ? or die "Can't connect to RabbitMQ\n";
>> >
>> > print "Opening channel\n";
>> > $mq->channel_open(1);
>> >
>> > print "Declaring exchange\n";
>> > $mq->exchange_declare(1, 'ee_exchange', { durable => 1 });
>> >
>> > print "Declaring queue\n";
>> > $mq->queue_declare(1, 'test', { durable => 1 });
>> >
>> > print "Binding queue\n";
>> > $mq->queue_bind(1, 'test', 'ee_exchange', 'ee_test');
>> >
>> > alarm(0);
>> >
>> > print "> ";
>> > <>;
>> >
>> > alarm(10);
>> >
>> > print "Publishing message\n";
>> > my $rc =
>> > ? $mq->publish(1, 'ee_test', 'hello world!',
>> > ?????????????? { exchange => 'ee_exchange', mandatory => 1, immediate =>
>> > 0
>> > },
>> > ?????????????? { delivery_mode => 2 });
>> > print "Result: $rc\n";
>> >
>> > __END__
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>

From michael.s.klishin at gmail.com  Fri Jun  3 16:57:43 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 3 Jun 2011 19:57:43 +0400
Subject: [rabbitmq-discuss] Message is available in multiple queue
In-Reply-To: <31765174.post@talk.nabble.com>
References: <31764872.post@talk.nabble.com>
 <31765174.post@talk.nabble.com>
Message-ID: <D03B9749BCB642AA84D2D41FE6892FEE@gmail.com>

Cheepu,

No. You can use a shared exchange and unique queue names (a very common scenario) or separate exchanges (many applications
usually can get by with just one).

Tutorials 1, 2 and 6 [1] provide some examples.

1. http://www.rabbitmq.com/getstarted.html
-- 
MK

cheepu escribi?:

> This means if i want to put the message in one dedicated queue then i will
> have to keep the Exchange name and routekey name combination unique?



From rkimball at pangeamedia.com  Fri Jun  3 17:39:47 2011
From: rkimball at pangeamedia.com (Ronald J Kimball)
Date: Fri, 3 Jun 2011 12:39:47 -0400
Subject: [rabbitmq-discuss] Perl Net::RabbitMQ and failure conditions
In-Reply-To: <BANLkTim7mAL7+paskDUU8-kOA5Wh4kCLog@mail.gmail.com>
References: <BANLkTim==hb=hDLCqEN=0J5vfbHQN14BOw@mail.gmail.com>
	<BANLkTi=BKveXBFiObCUDCvUcAhx3-8Oyrg@mail.gmail.com>
	<BANLkTimz4P1H+NgiAkdhQ_C3CNCjbmum7Q@mail.gmail.com>
	<BANLkTim7mAL7+paskDUU8-kOA5Wh4kCLog@mail.gmail.com>
Message-ID: <BANLkTi=7r2sQzrjUCCybHbHtEPWwPQgfSw@mail.gmail.com>

Hi Alexis, thanks for getting in touch with Theo.  However, I'm not sure
this addresses my issue.

I think he's using "remote" here to refer to the Rabbit process on the other
end of the socket from my publisher.  If that Rabbit process goes down, the
publisher does receive a SIGPIPE.  However, that is actually my "local"
process.  My "remote" process is the Rabbit node on another machine that
holds the queue.  My publisher connects to the local Rabbit, and the local
Rabbit connects to the remote Rabbit.  If the remote Rabbit goes down, there
is no SIGPIPE in my publisher.

The hang in DESTROY was resolved by upgrading Rabbit itself.

I'll contact him myself and let you know what I find out.

Ronald


On Fri, Jun 3, 2011 at 11:47 AM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Ronald
>
> I spoke with the author, Theo Schlossnagle, who permitted to post his
> reply here:
>
> -
> You must catch SIGPIPE if you plan to handle busted writes on
> sockets. This is straight forward from perl.
>
> The publishes don't erroneously indicated success as the writes() and
> synchronous. The remote is down, but the TCP socket hasn't realized it
> yet... So you write(), which is fine (as the socket hasn't flushed).
> So, if it flushes into the kernel and the kernel knows the socket is
> busted -> SIGPIPE, if not, then you'll get a successful publish.  That
> behaviour is expected, no?
>
> The hang in DESTROY sounds like a bug -- I have not seen that one on
> my side.  Would like some more information -- user-space stack trace
> of the hung perl process w/ symbols would be awesome.
>
> You can also open a issue on github for the specific problems
> remaining unresolved:
>
> https://github.com/omniti-labs/Net--RabbitMQ
> -
>
> Hope this helps!
>
> alexis
>
>
>
> On Tue, May 31, 2011 at 6:34 PM, Ronald J Kimball
> <rkimball at pangeamedia.com> wrote:
> > Hi, thanks for the response.  Unfortunately, I haven't really found an
> > answer.
> >
> > We upgraded RabbitMQ to 2.4.1, after which Net::RabbitMQ no longer hangs
> > when the remote server is up but the remote app is down.
> >
> > However, Net::RabbitMQ still returns a false success when the remote
> server
> > or app goes down after the publisher connects to the local node.  (The
> queue
> > is located on the remote app.)
> >
> > For now, we've switched to having a single node.  This decreases our
> > throughput slightly, but at least we don't risk dropping messages.
> >
> > I think we must be doing something wrong, but I don't know what...
> >
> > Ronald
> >
> >
> > On Tue, May 31, 2011 at 7:41 AM, Alexis Richardson <alexis at rabbitmq.com>
> > wrote:
> >>
> >> Ronald
> >>
> >> Were you able to find an answer to this?
> >>
> >> alexis
> >>
> >>
> >>
> >> On Thu, May 19, 2011 at 9:44 PM, Ronald J Kimball
> >> <rkimball at pangeamedia.com> wrote:
> >> > I'm trying to understand how RabbitMQ behaves under failure
> conditions,
> >> > specifically when using the Net::RabbitMQ Perl module.
> >> >
> >> > We have RabbitMQ set up with three nodes, one on the backend, which
> >> > holds
> >> > the actual queues, and two on the frontend, which receive publish
> >> > requests.
> >> >
> >> > RabbitMQ 2.2.0
> >> > Net::RabbitMQ 0.1.8
> >> >
> >> >
> >> > Below is the chart of behaviors that I have observed.
> >> >
> >> > "+" means the behavior is as I expected: either the message is
> >> > successfully
> >> > queued, or an error is thrown.
> >> > "-" means the behavior is not as I expected, but can be managed:
> >> > specifically, the process receives a SIGPIPE, which I can trap and
> >> > recover
> >> > from.
> >> > "!" means the behavior is not as I expected, and cannot be managed:
> the
> >> > message is not queued but no error is thrown and/or the process hangs.
> >> >
> >> > "App down" means I ran `rabbitmqctl stop_app`.  "Daemon down" means I
> >> > ran
> >> > `rabbitmqctl stop`.
> >> >
> >> >   As publishing process starts up:
> >> >
> >> >     Remote daemon up, app up
> >> >       + Everything okay
> >> >
> >> >     Remote daemon up, app down
> >> >       ! Net::RabbitMQ hangs when declaring queue
> >> >
> >> >     Remote daemon down
> >> >       + Net::RabbitMQ throws error when declaring queue
> >> >         "Declaring queue: server channel error 404, message: NOT_FOUND
> -
> >> > no
> >> > queue 'test' in vhost '/'"
> >> >
> >> >     Local daemon up, app down
> >> >       + Net::RabbitMQ throws error when connecting
> >> >         "Opening socket: Connection refused"
> >> >
> >> >     Local daemon down
> >> >       + Net::RabbitMQ throws error when connecting
> >> >         "Opening socket: Connection refused"
> >> >
> >> >
> >> >   After publishing process starts up:
> >> >
> >> >     Local app goes down
> >> >       - Process receives SIGPIPE
> >> >
> >> >     Local daemon goes down
> >> >       - Process receives SIGPIPE
> >> >
> >> >     Remote app goes down
> >> >       ! Net::RabbitMQ falsely indicates success when publishing, then
> >> > hangs
> >> > (in DESTROY?)
> >> >
> >> >     Remote daemon goes down
> >> >       ! Net::RabbitMQ falsely indicates success when publishing
> >> >
> >> >
> >> >     Local app goes down, comes back up
> >> >       - Process receives SIGPIPE
> >> >
> >> >     Local daemon goes down, comes back up
> >> >       - Process receives SIGPIPE
> >> >
> >> >     Remote app goes down, comes back up
> >> >       + Everything okay
> >> >
> >> >     Remote daemon goes down, comes back up
> >> >       + Everything okay
> >> >
> >> >
> >> > Have other people had these problems with Net::RabbitMQ?  Can we
> resolve
> >> > these issues by changing something in our RabbitMQ configuration?
> >> >
> >> >
> >> > thanks,
> >> > Ronald
> >> >
> >> >
> >> > P.S. Here's my script.
> >> >
> >> > #!/usr/local/bin/perl
> >> >
> >> > use strict;
> >> > use warnings;
> >> >
> >> > use Net::RabbitMQ;
> >> >
> >> > $| = 1;
> >> >
> >> > $SIG{'PIPE'} = sub { die "SIGPIPE\n" };
> >> >
> >> > my $mq = Net::RabbitMQ->new();
> >> >
> >> > alarm(10);
> >> >
> >> > print "Connecting\n";
> >> > $mq->connect('localhost', { user => 'engagement', password =>
> '********'
> >> > })
> >> >   or die "Can't connect to RabbitMQ\n";
> >> >
> >> > print "Opening channel\n";
> >> > $mq->channel_open(1);
> >> >
> >> > print "Declaring exchange\n";
> >> > $mq->exchange_declare(1, 'ee_exchange', { durable => 1 });
> >> >
> >> > print "Declaring queue\n";
> >> > $mq->queue_declare(1, 'test', { durable => 1 });
> >> >
> >> > print "Binding queue\n";
> >> > $mq->queue_bind(1, 'test', 'ee_exchange', 'ee_test');
> >> >
> >> > alarm(0);
> >> >
> >> > print "> ";
> >> > <>;
> >> >
> >> > alarm(10);
> >> >
> >> > print "Publishing message\n";
> >> > my $rc =
> >> >   $mq->publish(1, 'ee_test', 'hello world!',
> >> >                { exchange => 'ee_exchange', mandatory => 1, immediate
> =>
> >> > 0
> >> > },
> >> >                { delivery_mode => 2 });
> >> > print "Result: $rc\n";
> >> >
> >> > __END__
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110603/afc55274/attachment.htm>

From yluppo at leads360.com  Fri Jun  3 19:10:06 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Fri, 3 Jun 2011 11:10:06 -0700
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq
In-Reply-To: <8882CFE4FFAF3F4E8814F0E61F2919A3092A46FC@l360xch01.office.leads360.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A3092A46A6@l360xch01.office.leads360.com><4DE80A73.7080104@rabbitmq.com>
	<8882CFE4FFAF3F4E8814F0E61F2919A3092A46FC@l360xch01.office.leads360.com>
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A3092A49A5@l360xch01.office.leads360.com>

Ok first I want to say the Management plugin... much easier to deploy
and looks like it provides more data points than Wonderland. Big pluses.

However it would appear that the tabs matching commands that I would
need to run using the vhost -p switch, Exchanges and Queues, don't show
any data. I double checked w/ rabbitmqctl and running the list_queues
and list_exchanges w/ the -p switch do show my queues and exchanges.

I'm not excluding a configuration issue, in fact it is probably like my
friend says all the time: "the bug is between the chair and the
keyboard". Any pointer to resolve this little kink is much appreciated. 

Thanks. :)

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Yann
Luppo
Sent: Thursday, June 02, 2011 3:32 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq

This might be exactly what I need... minus the Disney graphics... :)

Thank you Simon, I'm gonna try that out right now.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon
MacMullen
Sent: Thursday, June 02, 2011 3:11 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq

Hi Yann.

I don't think Alice / Wonderland have been updated for a long time, I 
think since the 1.6.0 timeframe or so.

You don't say which version of RabbitMQ you're running, but if it's 
remotely up to date the management plugin 
(http://www.rabbitmq.com/management.html) can do everything Alice / 
Wonderland can do, and a great deal more.

Admittedly with a less whimsical UI.

Cheers, Simon

On 02/06/2011 10:49PM, Yann Luppo wrote:
> Hi everyone,
>
> I hope this is the right place to ask questions about Wonderland
because
> I couldn't find another community for it and I figured at least some
of
> you may have deployed it successfully already.
>
> My deal is on the same box I have RabbitMQ and Alice running, and also
> Wonderland.
>
> When I click on the "Dashboard" link in Wonderland I get:
>
> =INFO REPORT==== 2-Jun-2011::14:26:56 ===
>
> (rest_server:232) Error in rest server: {function_clause,
>
> [{dashboard,'-get/1-lc$^0/1-1-',
>
> [<<"no vhosts">>]},
>
> {dashboard,get,1},
>
> {rest_server,run_controller,4},
>
> {mochiweb_http,headers,5},
>
> {proc_lib,init_p_do_apply,3}]}
>
> Notice the <<"no vhosts">>.
>
> However if I simply run on that same machine again the commands:
>
> sudo rabbitmqctl status
>
> sudo rabbitmqctl list_vhosts
>
> I can confirm that my RabbitMQ server is running and that I have 3
> existing vhosts.
>
> Any idea?
>
> Thanks,
>
> *Yann Luppo*
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From yluppo at leads360.com  Fri Jun  3 19:13:55 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Fri, 3 Jun 2011 11:13:55 -0700
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq
In-Reply-To: <8882CFE4FFAF3F4E8814F0E61F2919A3092A49A5@l360xch01.office.leads360.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A3092A46A6@l360xch01.office.leads360.com><4DE80A73.7080104@rabbitmq.com><8882CFE4FFAF3F4E8814F0E61F2919A3092A46FC@l360xch01.office.leads360.com>
	<8882CFE4FFAF3F4E8814F0E61F2919A3092A49A5@l360xch01.office.leads360.com>
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A3092A49B3@l360xch01.office.leads360.com>

In case it helps that ubuntu server hosting RabbitMq and the management
plugin is running Erlang R13B03.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Yann
Luppo
Sent: Friday, June 03, 2011 11:10 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq

Ok first I want to say the Management plugin... much easier to deploy
and looks like it provides more data points than Wonderland. Big pluses.

However it would appear that the tabs matching commands that I would
need to run using the vhost -p switch, Exchanges and Queues, don't show
any data. I double checked w/ rabbitmqctl and running the list_queues
and list_exchanges w/ the -p switch do show my queues and exchanges.

I'm not excluding a configuration issue, in fact it is probably like my
friend says all the time: "the bug is between the chair and the
keyboard". Any pointer to resolve this little kink is much appreciated. 

Thanks. :)

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Yann
Luppo
Sent: Thursday, June 02, 2011 3:32 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq

This might be exactly what I need... minus the Disney graphics... :)

Thank you Simon, I'm gonna try that out right now.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon
MacMullen
Sent: Thursday, June 02, 2011 3:11 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq

Hi Yann.

I don't think Alice / Wonderland have been updated for a long time, I 
think since the 1.6.0 timeframe or so.

You don't say which version of RabbitMQ you're running, but if it's 
remotely up to date the management plugin 
(http://www.rabbitmq.com/management.html) can do everything Alice / 
Wonderland can do, and a great deal more.

Admittedly with a less whimsical UI.

Cheers, Simon

On 02/06/2011 10:49PM, Yann Luppo wrote:
> Hi everyone,
>
> I hope this is the right place to ask questions about Wonderland
because
> I couldn't find another community for it and I figured at least some
of
> you may have deployed it successfully already.
>
> My deal is on the same box I have RabbitMQ and Alice running, and also
> Wonderland.
>
> When I click on the "Dashboard" link in Wonderland I get:
>
> =INFO REPORT==== 2-Jun-2011::14:26:56 ===
>
> (rest_server:232) Error in rest server: {function_clause,
>
> [{dashboard,'-get/1-lc$^0/1-1-',
>
> [<<"no vhosts">>]},
>
> {dashboard,get,1},
>
> {rest_server,run_controller,4},
>
> {mochiweb_http,headers,5},
>
> {proc_lib,init_p_do_apply,3}]}
>
> Notice the <<"no vhosts">>.
>
> However if I simply run on that same machine again the commands:
>
> sudo rabbitmqctl status
>
> sudo rabbitmqctl list_vhosts
>
> I can confirm that my RabbitMQ server is running and that I have 3
> existing vhosts.
>
> Any idea?
>
> Thanks,
>
> *Yann Luppo*
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Sat Jun  4 19:11:17 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 4 Jun 2011 22:11:17 +0400
Subject: [rabbitmq-discuss] Ruby AMQP gem 0.8.0.rc13 is released
Message-ID: <BANLkTimVLSTpSAR5xykR-TcH_yNV=vWUJA@mail.gmail.com>

Ruby AMQP gem 0.8.0.rc13 is released.

This release of amqp gem has one backwards incompatibility with respect to
RC12,
several bug fixes and minor features as well as significant documentation
improvements
(mostly guides).

All users of previous 0.8.0 RCs are recommended to upgrade. Get it with

gem install amqp --pre --version "~> 0.8.0.rc13"


Backwards-incompatible change
================================================================================

 * AMQP connection URIs that use slashes (/) in vhost names now must
URL-encode
   them. With this change, connection URIs use the same conventions other
AMQP
   ecosystem projects use instead of inventing our own thing.

   Documentation: http://bit.ly/mfzwcB. Note that apps that use hashes for
   connection (:host => "hub.megacorp.internal", :vhost => "production") are
   not affected by this change.


Bug fixes
================================================================================

 * AMQP::Exchange#publish callback is no longer double-fired when message is
   published before asynchronous channel opening succeeds.

 * When AMQ entities are declared multiple times using AMQP::Channel#queue
and
   related methods, callback will be fired on 2nd, 3rd and subsequent
   declarations even though object is taken from channel cache.

 * When broker uses error messages longer than 127 characters,
   AMQ::Protocol::Channel::Close#class_id and #method_id are now decoded
   correctly.


Minor features and API usability improvements
================================================================================

 * AMQP::Session#on_error lets applications handle connection-level
exceptions.
   Example: http://bit.ly/maZmEv

 * AMQP::Exchange#publish callback is now run on the next event loop tick.
   This still DOES NOT OFFER ANY GUARANTEES that it is fired "after data is
   sent" (because system calls EventMachine core relies on use buffering),
   but is safe enough for 80% of the applications and works the way most
people
   expect it to work.

 * Message header values now can be floats, too. Since Ruby floats are
double
   precision, Java client will unpack them as `double`.

 * AMQP::Queue#initialize and AMQP::Channel#queue will now raise
ArgumentError
   if queue name is given as `nil` instead of an empty string (for
server-named queues).

 * When declaring a server-named queue, AMQP::Queue will now better check
that
   arguments actually make sense (for example, :nowait doesn't make sense
   because we need to receive generated name from the broker).

 * Connection (AMQP::Session) now exposes #server_capabilities,
   #server_authentication_mechanisms and #server_locales methods.

 * AMQP::Channel#reset was originally meant to be used by the library itself
   to handle network connectivity issues but is now safe to use by
applications,
   should they need to.

 * AMQP::Session#send was renamed to #send_frame and will never conflict
with
   Ruby's Object#send on 1.8.7, even in the edgiest of cases.


Documentation improvements
================================================================================

Documentation guides improved a great deal, we can't possibly name all the
improvements. Some highlights are

 * Installation routine specific to Windows 7 on C Rubies
 * Integration with applications that run on Unicorn
 * Typical queue lifecycle patterns
 * Message acknowledgements, redelivery, rejection and negative
acknowledgements
 * Consumer exclusivity
 * QoS and message pre-fetching
 * Fetching messages on demand ("pull API" with basic.get)
 * Exchanges and queues durability, message persistence and related matters

Documentation is at http://bit.ly/amqp-gem-docs


Newly added examples cover

 * Error handling (network connection failure, channel-level exceptions,
connection-
   level exceptions)
 * Accessible message metadata (aka envelope)
 * Message acknowledgements & redelivery
 * Handling of returned messages
 * RabbitMQ AMQP extensions

Examples are at http://bit.ly/amq-gem-examples



Git commit list
================================================================================

Commit list:
https://github.com/ruby-amqp/amqp/compare/cd76e8c41d55...bd6125f738


What to expect in RC14 and RC15
================================================================================

RC14 will be focused on further improving error handling after network
failures.
RC15 will bring support for Ruby 1.8.7-p249 (this specific patch level)
back.

Of course, both releases will feature documentation improvements to extent
the
time permits.


When will final 0.8.0 be released?
================================================================================

When all documentation guides are written, proof-read and edited. We expect
it to
take between 1 and 2 months.


Follow @rubyamqp for updates
================================================================================

For updates on the state of Ruby AMQP ecosystem, follow @rubyamqp on
Twitter.


Thanks to everyone who contributed feedback and reported all the edge cases
and
API usability issues, especially Elias Levy, Jonathan Simms and Mark
Abramov.


ruby-amqp team [1] members.

1. https://github.com/ruby-amqp

-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110604/aede3e3d/attachment.htm>

From matthias at rabbitmq.com  Sat Jun  4 19:26:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 04 Jun 2011 19:26:34 +0100
Subject: [rabbitmq-discuss] Ruby AMQP gem 0.8.0.rc13 is released
In-Reply-To: <BANLkTimVLSTpSAR5xykR-TcH_yNV=vWUJA@mail.gmail.com>
References: <BANLkTimVLSTpSAR5xykR-TcH_yNV=vWUJA@mail.gmail.com>
Message-ID: <4DEA78DA.2090500@rabbitmq.com>

Michael,

it's great to see development of the amqp gem proceeding apace. There 
was one thing that caught my eye in the list of changes...

On 04/06/11 19:11, Michael Klishin wrote:
>   * When declaring a server-named queue, AMQP::Queue will now better
> check that
>     arguments actually make sense (for example, :nowait doesn't make sense
>     because we need to receive generated name from the broker).

In protocol terms it actually *can* make sense to declare a server-named 
queue with 'nowait'. That's because AMQP has a little known feature: 
blank queue name in commands are substituted with the name of the most 
recently declared queue. Hence it is possible to, say, declare a 
server-named queue with 'nowait' and then bind it and consume from it.

Regards,

Matthias.

From videlalvaro at gmail.com  Sun Jun  5 18:52:24 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 5 Jun 2011 19:52:24 +0200
Subject: [rabbitmq-discuss] Ruby AMQP gem 0.8.0.rc13 is released
In-Reply-To: <4DEA78DA.2090500@rabbitmq.com>
References: <BANLkTimVLSTpSAR5xykR-TcH_yNV=vWUJA@mail.gmail.com>
	<4DEA78DA.2090500@rabbitmq.com>
Message-ID: <E5429854-2579-45F5-9C11-A5FB6C432DD8@gmail.com>

Matthias,

> In protocol terms it actually *can* make sense to declare a server-named queue with 'nowait'. That's because AMQP has a little known feature: blank queue name in commands are substituted with the name of the most recently declared queue. Hence it is possible to, say, declare a server-named queue with 'nowait' and then bind it and consume from it.


How is the "most recently declared queue" handled. Is it broker wide, or channel wide? Or per vhost, or user?

-Alvaro


From matthias at rabbitmq.com  Sun Jun  5 19:04:07 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 05 Jun 2011 19:04:07 +0100
Subject: [rabbitmq-discuss] Ruby AMQP gem 0.8.0.rc13 is released
In-Reply-To: <E5429854-2579-45F5-9C11-A5FB6C432DD8@gmail.com>
References: <BANLkTimVLSTpSAR5xykR-TcH_yNV=vWUJA@mail.gmail.com>
	<4DEA78DA.2090500@rabbitmq.com>
	<E5429854-2579-45F5-9C11-A5FB6C432DD8@gmail.com>
Message-ID: <4DEBC517.20706@rabbitmq.com>

On 05/06/11 18:52, Alvaro Videla wrote:
> How is the "most recently declared queue" handled. Is it broker wide,
> or channel wide? Or per vhost, or user?

Channel. See 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#domain.queue-name

Matthias.

From taylste at gmail.com  Mon Jun  6 09:27:41 2011
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 6 Jun 2011 09:27:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ Pub Sub Meetup?
In-Reply-To: <BANLkTinprQ-GCRjeya3KmfeMuhn8R=qeAQ@mail.gmail.com>
References: <1C7E61787A08F34BBBBD9E7A7CBC368B0A310287@EXMB02OSG.eclg.org>
	<BANLkTinprQ-GCRjeya3KmfeMuhn8R=qeAQ@mail.gmail.com>
Message-ID: <BANLkTincOGHQ89ES_5rNRNoWwOR0HiQ7Ew@mail.gmail.com>

... and the decision is?

Enjoy Erlang Factory.  It'd be great if it was recorded.
On 2 June 2011 19:13, Alexis Richardson <alexis at rabbitmq.com> wrote:

> yes we are looking at either tuesday or wednesday
>
>
> On Thu, Jun 2, 2011 at 5:51 PM, Chris Chew <chrisch at ecollege.com> wrote:
> > Hi Everybody.
> >
> > Has there been any talk about having another "pub sub" meetup for Rabbit
> users next week while Erlang Factory is going on?
> >
> > -Chris
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110606/91335242/attachment.htm>

From simon at rabbitmq.com  Mon Jun  6 10:47:21 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 06 Jun 2011 10:47:21 +0100
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq
In-Reply-To: <8882CFE4FFAF3F4E8814F0E61F2919A3092A49A5@l360xch01.office.leads360.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A3092A46A6@l360xch01.office.leads360.com><4DE80A73.7080104@rabbitmq.com>	<8882CFE4FFAF3F4E8814F0E61F2919A3092A46FC@l360xch01.office.leads360.com>
	<8882CFE4FFAF3F4E8814F0E61F2919A3092A49A5@l360xch01.office.leads360.com>
Message-ID: <4DECA229.3050100@rabbitmq.com>

On 03/06/11 19:10, Yann Luppo wrote:
> However it would appear that the tabs matching commands that I would
> need to run using the vhost -p switch, Exchanges and Queues, don't show
> any data. I double checked w/ rabbitmqctl and running the list_queues
> and list_exchanges w/ the -p switch do show my queues and exchanges.

This is a bit of a guess, but does the user you're using to connect to 
mgmt have permissions to access the appropriate vhosts? Unlike 
rabbitmqctl and Alice, mgmt tries to play nice with the RabbitMQ 
permissions system, therefore if your user does not have any permissions 
for a vhost then you won't see anything. See 
http://www.rabbitmq.com/management.html#permissions

Also: if you have multiple vhosts then have you selected "all" in the 
vhost select box?

If neither of these suggestions help, are there any errors in the logs?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From huntermorris+rabbitmq at gmail.com  Mon Jun  6 11:16:43 2011
From: huntermorris+rabbitmq at gmail.com (Hunter Morris)
Date: Mon, 6 Jun 2011 11:16:43 +0100
Subject: [rabbitmq-discuss] rabbitmq-erlang-client git repo lagging behind
	hg?
Message-ID: <BANLkTinJQnyVX-8dx1-qJW_zog3e2ZTq8w@mail.gmail.com>

It appears that the canonical Mercurial repository at:

http://hg.rabbitmq.com/rabbitmq-erlang-client/

is several commits (and indeed a version) ahead of the github git mirror at:

https://github.com/rabbitmq/rabbitmq-erlang-client

Perhaps some automated job has stopped running, or perhaps I am
looking in the wrong place for a git mirror.

Best,
Hunter Morris

From alexis at rabbitmq.com  Mon Jun  6 12:28:34 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 6 Jun 2011 12:28:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ Pub Sub Meetup?
In-Reply-To: <BANLkTincOGHQ89ES_5rNRNoWwOR0HiQ7Ew@mail.gmail.com>
References: <1C7E61787A08F34BBBBD9E7A7CBC368B0A310287@EXMB02OSG.eclg.org>
	<BANLkTinprQ-GCRjeya3KmfeMuhn8R=qeAQ@mail.gmail.com>
	<BANLkTincOGHQ89ES_5rNRNoWwOR0HiQ7Ew@mail.gmail.com>
Message-ID: <BANLkTimsWUPWnEpaVGqyMXLuVzE5FUoA7Q@mail.gmail.com>

Wednesday has been selected.

Location - in the City not far from Spitalfields.  More to come on that.

On Mon, Jun 6, 2011 at 9:27 AM, Steven Taylor <taylste at gmail.com> wrote:
> ... and the decision is?
>
> Enjoy?Erlang Factory.? It'd be great if it was recorded.
> On 2 June 2011 19:13, Alexis Richardson <alexis at rabbitmq.com> wrote:
>>
>> yes we are looking at either tuesday or wednesday
>>
>>
>> On Thu, Jun 2, 2011 at 5:51 PM, Chris Chew <chrisch at ecollege.com> wrote:
>> > Hi Everybody.
>> >
>> > Has there been any talk about having another "pub sub" meetup for Rabbit
>> > users next week while Erlang Factory is going on?
>> >
>> > -Chris
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From yluppo at leads360.com  Mon Jun  6 18:49:46 2011
From: yluppo at leads360.com (Yann Luppo)
Date: Mon, 6 Jun 2011 10:49:46 -0700
Subject: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq
In-Reply-To: <4DECA229.3050100@rabbitmq.com>
References: <8882CFE4FFAF3F4E8814F0E61F2919A3092A46A6@l360xch01.office.leads360.com><4DE80A73.7080104@rabbitmq.com>	<8882CFE4FFAF3F4E8814F0E61F2919A3092A46FC@l360xch01.office.leads360.com><8882CFE4FFAF3F4E8814F0E61F2919A3092A49A5@l360xch01.office.leads360.com>
	<4DECA229.3050100@rabbitmq.com>
Message-ID: <8882CFE4FFAF3F4E8814F0E61F2919A3092A4D89@l360xch01.office.leads360.com>

That was it, I just added the permissions on all the vhosts for my admin
user and it started showing in the Management pluging. Thanks a lot
Simon. 

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon
MacMullen
Sent: Monday, June 06, 2011 2:47 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Alice in Wonderland chasing the RabbitMq

On 03/06/11 19:10, Yann Luppo wrote:
> However it would appear that the tabs matching commands that I would
> need to run using the vhost -p switch, Exchanges and Queues, don't
show
> any data. I double checked w/ rabbitmqctl and running the list_queues
> and list_exchanges w/ the -p switch do show my queues and exchanges.

This is a bit of a guess, but does the user you're using to connect to 
mgmt have permissions to access the appropriate vhosts? Unlike 
rabbitmqctl and Alice, mgmt tries to play nice with the RabbitMQ 
permissions system, therefore if your user does not have any permissions

for a vhost then you won't see anything. See 
http://www.rabbitmq.com/management.html#permissions

Also: if you have multiple vhosts then have you selected "all" in the 
vhost select box?

If neither of these suggestions help, are there any errors in the logs?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From josh at gebaschtel.ch  Mon Jun  6 20:55:54 2011
From: josh at gebaschtel.ch (Josh Geisser)
Date: Mon, 6 Jun 2011 21:55:54 +0200
Subject: [rabbitmq-discuss] very stupid: set memory highwater mark
Message-ID: <9C37154E143FE14CBA656B2D2232745F086BEAB74E66@popeye.gebaschtel.bnet>

Quite stupid question: nice / suggested way to set the high-water mark to 80% (server doing nothing else)?

Cheers & thx
Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110606/023238fc/attachment.htm>

From jerryk at vmware.com  Mon Jun  6 21:44:39 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 6 Jun 2011 13:44:39 -0700 (PDT)
Subject: [rabbitmq-discuss] very stupid: set memory highwater mark
In-Reply-To: <9C37154E143FE14CBA656B2D2232745F086BEAB74E66@popeye.gebaschtel.bnet>
Message-ID: <873773876.17604.1307393079678.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

Indeed, yes. 


See the 'Usage' subsection of the 'Memory-based flow control' section here: 


http://www.rabbitmq.com/extensions.html 


Be mindful to get your []'s, {}'s, commas and dots right in your rabbitmq.config edits, or Erlang will be most put out. 


Best regards, 
Jerry 

----- Original Message -----

From: "Josh Geisser" <josh at gebaschtel.ch> 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, June 6, 2011 12:55:54 PM 
Subject: [rabbitmq-discuss] very stupid: set memory highwater mark 



Quite stupid question: nice / suggested way to set the high-water mark to 80% (server doing nothing else)? 

Cheers & thx 
Josh 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110606/cda94951/attachment.htm>

From dan.j.richards at gmail.com  Mon Jun  6 17:03:30 2011
From: dan.j.richards at gmail.com (Dan)
Date: Mon, 6 Jun 2011 09:03:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Startup scripts on RedHat 5.6
Message-ID: <88b6e104-cdcb-4fd0-bdeb-a1ee26e50d19@dn9g2000vbb.googlegroups.com>

Hi
Could you clarify the best practice for starting and stopping RabbitMQ
when using the generic source, please?
(We're using the generic to get the latest versions of Erlang and
Rabbit.)

Interactively it's all fine whilst logged on as the rabbit user.  I
can start from the command line with:
  rabbitmq_server-2.4.1/sbin/rabbitmq-server -detached
and stop with:
  rabbitmqctl stop

But if I do this as root it causes problems with the permissions on
the cookie and lock files, and I'd like RabbitMQ to start
automatically on system reboot.

I therefore took the '/etc/init.d/rabbitmq-server' startup script
provided in the Fedora RPM package, modified the paths and used
'chkconfig' to make it auto start, but this also ran everything as
root, so I've modified it to import the '/etc/rc.d/init.d/functions'
and call 'rabbitmq_server-2.4.1/sbin/rabbitmq-server' using the
'daemon' function which can take a '--user' parameter.

So rabbitmq starts correctly at system boot and root can run 'service
rabbitmq-server start | status | stop'.
If I'm the rabbit user I can start it up using either 'sudo service
rabbitmq-server start' or 'rabbitmq_server-2.4.1/sbin/rabbitmq-server -
detached', query the status using 'rabbitmqctl status' and stop it
using 'rabbitmqctl stop'.
Everything seems good to me, but I'd just like to check I'm doing the
right thing given this is a production environment...?  I'm sure this
problem has been solved already, so have I missed a trick with the
default RPM startup script? e.g. does it use the SUID bit or something
similar to achieve this?

Cheers

Dan

From toby.corkindale at strategicdata.com.au  Tue Jun  7 05:20:19 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Tue, 07 Jun 2011 14:20:19 +1000
Subject: [rabbitmq-discuss] STOMP - Message queue selectors for consumers?
Message-ID: <4DEDA703.8070502@strategicdata.com.au>

Hi,
I'm afraid I'm something of a beginner when it comes to message queuing 
systems, although I've submitted several patches to the Perl STOMP 
modules in the process of using them recently, and have picked up what I 
think is a bit of knowledge.

Anyway, I have a query about RabbitMQ's STOMP plugin, and haven't quite 
been able to understand the docs on the matter.

My goal is to have a queue where the consumers of that queue only 
receive a subset of all messages. I want them to filter based on a 
header in the messages.

Eg.

SEND
destination:/queue/foo
x-country:australia

with the receiver somehow doing something like:
SUBSCRIBE
destination:/queue/foo?x-country=australia


Now currently I can achieve this goal by creating lots of queues, one 
for each possible value, and then the consumers can subscribe to all the 
queues.. but this is a bit messy.

Eg.
SEND
destination:/queue/foo.australia

SUBSCRIBE
destination:/queue/foo.australia


There are some discussions of routing keys in the STOMP plugin's docs, 
but I don't understand how they relate. Are they what I'm looking for?
I only want this to work with simple queues, not, as far as I know, 
exchanges. Maybe I'm barking up the wrong tree though?

I note that in ActiveMQ's STOMP plugin, you can apply a selector to the 
subscription like this:

SUBSCRIBE
destination:/queue/foo
activemq.selector:country="australia"


Thanks,
Toby

From simon at rabbitmq.com  Tue Jun  7 10:35:10 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 07 Jun 2011 10:35:10 +0100
Subject: [rabbitmq-discuss] Startup scripts on RedHat 5.6
In-Reply-To: <88b6e104-cdcb-4fd0-bdeb-a1ee26e50d19@dn9g2000vbb.googlegroups.com>
References: <88b6e104-cdcb-4fd0-bdeb-a1ee26e50d19@dn9g2000vbb.googlegroups.com>
Message-ID: <4DEDF0CE.70206@rabbitmq.com>

On 06/06/11 17:03, Dan wrote:
> Hi
> Could you clarify the best practice for starting and stopping RabbitMQ
> when using the generic source, please?
> (We're using the generic to get the latest versions of Erlang and
> Rabbit.)

I would suggest you get the latest Rabbit RPM from 
http://www.rabbitmq.com/server.html, and then install the Erlang R14B02 
RPM from the fedorapeople repository referenced there. But it's your 
machine :)

> Interactively it's all fine whilst logged on as the rabbit user.  I
> can start from the command line with:
>    rabbitmq_server-2.4.1/sbin/rabbitmq-server -detached
> and stop with:
>    rabbitmqctl stop
>
> But if I do this as root it causes problems with the permissions on
> the cookie and lock files, and I'd like RabbitMQ to start
> automatically on system reboot.

Sure. Also in general you shouldn't run servers as root, although I'm 
sure you're aware of that.

<snip>

> Everything seems good to me, but I'd just like to check I'm doing the
> right thing given this is a production environment...?  I'm sure this
> problem has been solved already, so have I missed a trick with the
> default RPM startup script? e.g. does it use the SUID bit or something
> similar to achieve this?

The RPM installs a wrapper script which is used to invoke 
rabbitmq-server, rabbitmqctl etc. The "real" scripts live outside your 
path.  The wrapper script can be found here:

http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_4_1/packaging/common/rabbitmq-script-wrapper

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From videlalvaro at gmail.com  Tue Jun  7 11:17:19 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 7 Jun 2011 12:17:19 +0200
Subject: [rabbitmq-discuss] Minor bug on the new erlang client
Message-ID: <B45BF63E-FC76-45E8-9102-04BA54BFD2EE@gmail.com>

Hi,

I was reading through the latest changes on the hg repo for the erlang client. 

I tried to build the docs to have a better understanding of the new modules but `make documentation` failed.

The problem is reported to be here http://hg.rabbitmq.com/rabbitmq-erlang-client/file/0247acc5c1d2/src/amqp_gen_consumer.erl#l33 with the _ character. 

I think is faster if I report it here than merging a diff that contains an `any()` instead of the `_`. Also maybe there's a better solution for edocs than the `any()`.

Cheers,

Alvaro

From matthew at rabbitmq.com  Tue Jun  7 11:21:20 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 7 Jun 2011 11:21:20 +0100
Subject: [rabbitmq-discuss] Minor bug on the new erlang client
In-Reply-To: <B45BF63E-FC76-45E8-9102-04BA54BFD2EE@gmail.com>
References: <B45BF63E-FC76-45E8-9102-04BA54BFD2EE@gmail.com>
Message-ID: <20110607102120.GE21118@rabbitmq.com>

Hi Alvaro,

On Tue, Jun 07, 2011 at 12:17:19PM +0200, Alvaro Videla wrote:
> I tried to build the docs to have a better understanding of the new modules but `make documentation` failed.
> The problem is reported to be here http://hg.rabbitmq.com/rabbitmq-erlang-client/file/0247acc5c1d2/src/amqp_gen_consumer.erl#l33 with the _ character. 
> I think is faster if I report it here than merging a diff that contains an `any()` instead of the `_`. Also maybe there's a better solution for edocs than the `any()`.

Thanks for the report. Please note though that that's not on default,
and thus the code has not gone through QA and can be considered to be in
a state of flux. There is no guarantee that code not on default will
even compile let alone work.

Matthew

From videlalvaro at gmail.com  Tue Jun  7 11:31:37 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 7 Jun 2011 12:31:37 +0200
Subject: [rabbitmq-discuss] Minor bug on the new erlang client
In-Reply-To: <20110607102120.GE21118@rabbitmq.com>
References: <B45BF63E-FC76-45E8-9102-04BA54BFD2EE@gmail.com>
	<20110607102120.GE21118@rabbitmq.com>
Message-ID: <C4888E5B-997C-486A-B556-F30B7AF70F72@gmail.com>

Hi Matthew,

Lately I've been working in many utility kind of functions for the erlang client. For example, do retrieve pre created records for queue declare, exchange declare, and so on. So a function called anon_queue() will give back a record like: #'queue.declare'{queue = <<"">>, durable = false, exclusive = true, auto_delete = true}.

Do you think these kind of functions might be useful for the erlang client?

Alvaro

From matthew at rabbitmq.com  Tue Jun  7 11:38:44 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 7 Jun 2011 11:38:44 +0100
Subject: [rabbitmq-discuss] Minor bug on the new erlang client
In-Reply-To: <C4888E5B-997C-486A-B556-F30B7AF70F72@gmail.com>
References: <B45BF63E-FC76-45E8-9102-04BA54BFD2EE@gmail.com>
	<20110607102120.GE21118@rabbitmq.com>
	<C4888E5B-997C-486A-B556-F30B7AF70F72@gmail.com>
Message-ID: <20110607103844.GF21118@rabbitmq.com>

On Tue, Jun 07, 2011 at 12:31:37PM +0200, Alvaro Videla wrote:
> Lately I've been working in many utility kind of functions for the erlang client. For example, do retrieve pre created records for queue declare, exchange declare, and so on. So a function called anon_queue() will give back a record like: #'queue.declare'{queue = <<"">>, durable = false, exclusive = true, auto_delete = true}.
> 
> Do you think these kind of functions might be useful for the erlang client?

Sounds like something that may be of use to users of the erlang client,
but probably not actually used directly by the erlang client itself, if
you see what I mean.

Matthew

From michael.justin at gmx.net  Tue Jun  7 12:07:37 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 07 Jun 2011 13:07:37 +0200
Subject: [rabbitmq-discuss] STOMP - Message queue selectors for
	consumers?
In-Reply-To: <4DEDA703.8070502@strategicdata.com.au>
References: <4DEDA703.8070502@strategicdata.com.au>
Message-ID: <isl0pu$lqb$1@dough.gmane.org>

Am 07.06.2011 06:20, Toby Corkindale wrote:
> Hi,
> I'm afraid I'm something of a beginner when it comes to message queuing
> systems, although I've submitted several patches to the Perl STOMP
> modules in the process of using them recently, and have picked up what I
> think is a bit of knowledge.
>
> Anyway, I have a query about RabbitMQ's STOMP plugin, and haven't quite
> been able to understand the docs on the matter.
>
> My goal is to have a queue where the consumers of that queue only
> receive a subset of all messages. I want them to filter based on a
> header in the messages.
>
> Eg.
>
> SEND
> destination:/queue/foo
> x-country:australia
>
> with the receiver somehow doing something like:
> SUBSCRIBE
> destination:/queue/foo?x-country=australia
>
>
> Now currently I can achieve this goal by creating lots of queues, one
> for each possible value, and then the consumers can subscribe to all the
> queues.. but this is a bit messy.
>
> Eg.
> SEND
> destination:/queue/foo.australia
>
> SUBSCRIBE
> destination:/queue/foo.australia
>
>
> There are some discussions of routing keys in the STOMP plugin's docs,
> but I don't understand how they relate. Are they what I'm looking for?
> I only want this to work with simple queues, not, as far as I know,
> exchanges. Maybe I'm barking up the wrong tree though?
>
> I note that in ActiveMQ's STOMP plugin, you can apply a selector to the
> subscription like this:
>
> SUBSCRIBE
> destination:/queue/foo
> activemq.selector:country="australia"
>
>

This is also documented in a broker independent way on 
http://stomp.codehaus.org/Stomp+JMS

"You can use an SQL 92 selector whenever you subscribe using the 
selector header

selector:location = 'London' and sex = 'M'


It is also supported by the Oracle Open Message Queue (OpenMQ) Stomp 
connector.

But the RabbitMQ Stomp plugin does not support the JMS+Stomp extensions 
like no-local, expires, persistent, priority, reply-to or 
durable-subscriber-name etc. AFAIK - but please correct me if I am wrong :)

Regards,
Michael Justin



From rob at rabbitmq.com  Tue Jun  7 12:30:51 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 7 Jun 2011 12:30:51 +0100
Subject: [rabbitmq-discuss] STOMP - Message queue selectors for
 consumers?
In-Reply-To: <4DEDA703.8070502@strategicdata.com.au>
References: <4DEDA703.8070502@strategicdata.com.au>
Message-ID: <C65507186EB34851993F3CA3F72470D1@rabbitmq.com>

Toby,

The solution you propose is the easiest and most efficient way of doing it on RabbitMQ STOMP. Using different /queue/ destinations removes the need for complex matching during message routing.

Queues are cheap in RabbitMQ and each /queue corresponds to one queue, so creating a queue per country is not expensive. Also, queues are created lazily so you don't need to worry about ordering consumers/publishers.

There is another option that you could consider that has _slightly_ different semantics: use a destination such as /exchange/amq.direct/country.australia.

The main difference between /queue and /exchange in this instance is how multiple subscribers are treated.

With /queue, if you have two subscribers to the same country queue, then messages are sent out to the consumers in a round-robin fashion.

With /exchange, each subscriber will get a copy of each message. 

I'm guessing for your use case that round-robin is probably the most suitable.

Regards,

Rob

-- 
Rob Harrop
RabbitMQ

On Tuesday, 7 June 2011 at 05:20, Toby Corkindale wrote:

> Hi,
> I'm afraid I'm something of a beginner when it comes to message queuing 
> systems, although I've submitted several patches to the Perl STOMP 
> modules in the process of using them recently, and have picked up what I 
> think is a bit of knowledge.
> 
> Anyway, I have a query about RabbitMQ's STOMP plugin, and haven't quite 
> been able to understand the docs on the matter.
> 
> My goal is to have a queue where the consumers of that queue only 
> receive a subset of all messages. I want them to filter based on a 
> header in the messages.
> 
> Eg.
> 
> SEND
> destination:/queue/foo
> x-country:australia
> 
> with the receiver somehow doing something like:
> SUBSCRIBE
> destination:/queue/foo?x-country=australia
> 
> 
> Now currently I can achieve this goal by creating lots of queues, one 
> for each possible value, and then the consumers can subscribe to all the 
> queues.. but this is a bit messy.
> 
> Eg.
> SEND
> destination:/queue/foo.australia
> 
> SUBSCRIBE
> destination:/queue/foo.australia
> 
> 
> There are some discussions of routing keys in the STOMP plugin's docs, 
> but I don't understand how they relate. Are they what I'm looking for?
> I only want this to work with simple queues, not, as far as I know, 
> exchanges. Maybe I'm barking up the wrong tree though?
> 
> I note that in ActiveMQ's STOMP plugin, you can apply a selector to the 
> subscription like this:
> 
> SUBSCRIBE
> destination:/queue/foo
> activemq.selector:country="australia"
> 
> 
> Thanks,
> Toby
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110607/d0a9fd59/attachment.htm>

From rob at rabbitmq.com  Tue Jun  7 12:36:28 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 7 Jun 2011 12:36:28 +0100
Subject: [rabbitmq-discuss] STOMP - Message queue selectors for
 consumers?
In-Reply-To: <isl0pu$lqb$1@dough.gmane.org>
References: <4DEDA703.8070502@strategicdata.com.au>
	<isl0pu$lqb$1@dough.gmane.org>
Message-ID: <935DF2781EC84E4DB61EB134DE472DA0@rabbitmq.com>

> But the RabbitMQ Stomp plugin does not support the JMS+Stomp extensions 
> like no-local, expires, persistent, priority, reply-to or 
> durable-subscriber-name etc. AFAIK - but please correct me if I am wrong :)
> 
We do support the 'persistent' header, and you're free to add in reply-to headers on any SEND frame and they will be present in the corresponding MESSAGE frames. 
> Regards,
> Michael Justin
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110607/023fbded/attachment.htm>

From danbarua at gmail.com  Tue Jun  7 13:19:44 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 7 Jun 2011 05:19:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
Message-ID: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>

Hi,

Me again.

I'm having a bit of a nightmare getting Rabbit running with SSL using
the .Net client.

rabbitmq.config is:
[
  {rabbit, [
     {ssl_listeners, [5671]},
     {ssl_options, [{cacertfile,"C:/CAConfig/trustisroot.cer"},
                    {certfile,"C:/CAConfig/publicCertificate.cer"},
                    {keyfile,"C:/CAConfig/private.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,false}]}
   ]}
].

Client says:
System.IO.IOException: Authentication failed because the remote party
has closed
 the transport stream.

Rabbit says:
=INFO REPORT==== 7-Jun-2011::13:09:55 ===
accepted TCP connection on 0.0.0.0:5671 from 192.168.0.20:52754

=INFO REPORT==== 7-Jun-2011::13:09:55 ===
starting TCP connection <0.2710.0> from 192.168.0.20:52754

=ERROR REPORT==== 7-Jun-2011::13:09:55 ===
SSL: 1092: error:[] C:/CAConfig/publicCertificate.cer
  [{ssl_connection,init_certificates,5},
   {ssl_connection,ssl_init,2},
   {ssl_connection,init,1},
   {gen_fsm,init_it,6},
   {proc_lib,init_p_do_apply,3}]


=ERROR REPORT==== 7-Jun-2011::13:09:55 ===
error on TCP connection <0.2710.0>:{ssl_upgrade_error,ecertfile}

=INFO REPORT==== 7-Jun-2011::13:09:55 ===
closing TCP connection <0.2710.0>

Any ideas what I'm doing wrong?

Cheers,

Dan

From matthew at rabbitmq.com  Tue Jun  7 13:27:13 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 7 Jun 2011 13:27:13 +0100
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
Message-ID: <20110607122713.GG21118@rabbitmq.com>

Hi Dan,

Erlang's having a hard time of implementing SSL correctly. Thus the
first question is inevitably: which version of Erlang are you using?
R14B02 is, I believe, the best implementation of SSL - they've gone and
broken some things in the latest release (R14B03).

Matthew

From danbarua at gmail.com  Tue Jun  7 13:29:08 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 7 Jun 2011 05:29:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <20110607122713.GG21118@rabbitmq.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
Message-ID: <8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>

I'm on R14B03, I'll give R14B02 a try and report back.

Thanks for the hint!

-Dan

On Jun 7, 1:27?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> Hi Dan,
>
> Erlang's having a hard time of implementing SSL correctly. Thus the
> first question is inevitably: which version of Erlang are you using?
> R14B02 is, I believe, the best implementation of SSL - they've gone and
> broken some things in the latest release (R14B03).
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From danbarua at gmail.com  Tue Jun  7 13:58:47 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 7 Jun 2011 05:58:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
Message-ID: <df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>

Now I can't get Rabbit to start...

=erl_crash_dump:0.1
Tue Jun 07 13:50:57 2011
Slogan: init terminating in do_boot ()
System version: Erlang R14B02 (erts-5.8.3) [smp:4:4] [rq:4] [async-
threads:30]
Compiled: Mon Mar 14 19:59:18 2011
<snip>

Any ideas?

Thanks.

On Jun 7, 1:29?pm, Dan B <danba... at gmail.com> wrote:
> I'm on R14B03, I'll give R14B02 a try and report back.
>
> Thanks for the hint!
>
> -Dan
>
> On Jun 7, 1:27?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:> Hi Dan,
>
> > Erlang's having a hard time of implementing SSL correctly. Thus the
> > first question is inevitably: which version of Erlang are you using?
> > R14B02 is, I believe, the best implementation of SSL - they've gone and
> > broken some things in the latest release (R14B03).
>
> > Matthew
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Tue Jun  7 14:00:53 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 7 Jun 2011 14:00:53 +0100
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
Message-ID: <20110607130052.GI21118@rabbitmq.com>

On Tue, Jun 07, 2011 at 05:58:47AM -0700, Dan B wrote:
> Now I can't get Rabbit to start...

Hmm, are you sure you cleared out all elements of the old install and
adjusted any env vars as necessary?

Matthew

From danbarua at gmail.com  Tue Jun  7 14:56:22 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 7 Jun 2011 06:56:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <20110607130052.GI21118@rabbitmq.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
Message-ID: <807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>

I've cleaned out erlang, i've removed and reinstalled Rabbit (clearing
out everything under %AppData% also).

Error: unable to connect to node 'rabbit at BSL-A77295F2947': nodedown
diagnostics:
- nodes and their ports on BSL-A77295F2947: [{rabbit,2968},
                                             {rabbitmqctl20186,3035}]
- current node: 'rabbitmqctl20186 at bsl-a77295f2947'
- current node home dir: C:\Documents and Settings\stuartm
- current node cookie hash: rNa1F6WF2SlemsrgMZvA5g==

I've made sure erlang.cookie in c:\windows is copied over to c:\docs &
settings\user\
I've checked all the env vars...

Any ideas?


On Jun 7, 2:00?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Tue, Jun 07, 2011 at 05:58:47AM -0700, Dan B wrote:
> > Now I can't get Rabbit to start...
>
> Hmm, are you sure you cleared out all elements of the old install and
> adjusted any env vars as necessary?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Tue Jun  7 15:03:39 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 7 Jun 2011 15:03:39 +0100
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
	<807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>
Message-ID: <20110607140339.GL21118@rabbitmq.com>

On Tue, Jun 07, 2011 at 06:56:22AM -0700, Dan B wrote:
> I've cleaned out erlang, i've removed and reinstalled Rabbit (clearing
> out everything under %AppData% also).
> 
> Error: unable to connect to node 'rabbit at BSL-A77295F2947': nodedown
> diagnostics:
> - nodes and their ports on BSL-A77295F2947: [{rabbit,2968},
>                                              {rabbitmqctl20186,3035}]

Looks like rabbit is running. Is this error you're getting after you've
stopped and restarted rabbit with the new (older!) erlang or is it
possible there's still an old rabbit running (yes - even though you've
deleted everything beneath it)?

Matthew

From danbarua at gmail.com  Tue Jun  7 14:57:16 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 7 Jun 2011 06:57:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <20110607130052.GI21118@rabbitmq.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
Message-ID: <01ee2473-2e12-4ad5-a419-b8c13094f120@z7g2000prh.googlegroups.com>

I should add that the service seems to have started without reporting
any errors, but I cannot connect to it with rabbitmqctl.bat or
negotiate a protocol from the client.

From danbarua at gmail.com  Tue Jun  7 15:21:35 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 7 Jun 2011 07:21:35 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <20110607140339.GL21118@rabbitmq.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
	<807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>
	<20110607140339.GL21118@rabbitmq.com>
Message-ID: <a50f8661-f939-47f5-abb5-daf00e9fb829@q14g2000prh.googlegroups.com>

Clean install of Rabbit, clean install of new (older) erlang, just
rebooted the server... same problem.

On Jun 7, 3:03?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Tue, Jun 07, 2011 at 06:56:22AM -0700, Dan B wrote:
> > I've cleaned out erlang, i've removed and reinstalled Rabbit (clearing
> > out everything under %AppData% also).
>
> > Error: unable to connect to node 'rabbit at BSL-A77295F2947': nodedown
> > diagnostics:
> > - nodes and their ports on BSL-A77295F2947: [{rabbit,2968},
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{rabbitmqctl20186,3035}]
>
> Looks like rabbit is running. Is this error you're getting after you've
> stopped and restarted rabbit with the new (older!) erlang or is it
> possible there's still an old rabbit running (yes - even though you've
> deleted everything beneath it)?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Tue Jun  7 15:24:04 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 7 Jun 2011 15:24:04 +0100
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <a50f8661-f939-47f5-abb5-daf00e9fb829@q14g2000prh.googlegroups.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
	<807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>
	<20110607140339.GL21118@rabbitmq.com>
	<a50f8661-f939-47f5-abb5-daf00e9fb829@q14g2000prh.googlegroups.com>
Message-ID: <20110607142404.GN21118@rabbitmq.com>

On Tue, Jun 07, 2011 at 07:21:35AM -0700, Dan B wrote:
> Clean install of Rabbit, clean install of new (older) erlang, just
> rebooted the server... same problem.

Hmm. The only thing I can think of is a firewall issue? If rabbit seems
to be running and you get no errors in the logs, but other things can't
connect to it, I'm not sure what else it could be?

Matthew

From danbarua at gmail.com  Tue Jun  7 15:41:04 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 7 Jun 2011 07:41:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <20110607142404.GN21118@rabbitmq.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
	<807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>
	<20110607140339.GL21118@rabbitmq.com>
	<a50f8661-f939-47f5-abb5-daf00e9fb829@q14g2000prh.googlegroups.com>
	<20110607142404.GN21118@rabbitmq.com>
Message-ID: <f5dfc8cc-7b70-48cc-9ca3-f60daa4787ef@u26g2000vby.googlegroups.com>

Just did another reinstall.

Interestingly, if I don't specify a rabbitmq.config file then I can
connect to the node from rabbitmqctl.bat, but if I do include a
rabbitmq.config file then the service seems to start ok, listens for
SSL on 5671, but I rabbitmqctl status reports node down, can't
connect... weird.

From michael.justin at gmx.net  Tue Jun  7 15:48:01 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 07 Jun 2011 16:48:01 +0200
Subject: [rabbitmq-discuss] STOMP - Message queue selectors for
	consumers?
In-Reply-To: <935DF2781EC84E4DB61EB134DE472DA0@rabbitmq.com>
References: <4DEDA703.8070502@strategicdata.com.au>	<isl0pu$lqb$1@dough.gmane.org>
	<935DF2781EC84E4DB61EB134DE472DA0@rabbitmq.com>
Message-ID: <isldn8$b5d$1@dough.gmane.org>

Am 07.06.2011 13:36, Rob Harrop wrote:

> We do support the 'persistent' header, and you're free to add in
> reply-to headers on any SEND frame and they will be present in the
> corresponding MESSAGE frames.

Thank you for the correction! I have tested it in my Habari RabbitMQ 
Client library, and it works as expected. Also the performance is very 
impressive, I can easily exchange up to 3000 messages per second (send 
and receive) on an entry-level system with the client running on the 
same system as RabbitMQ 2.4.1

Regards,
Michael Justin


From matthew at rabbitmq.com  Tue Jun  7 15:51:54 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 7 Jun 2011 15:51:54 +0100
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <f5dfc8cc-7b70-48cc-9ca3-f60daa4787ef@u26g2000vby.googlegroups.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
	<807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>
	<20110607140339.GL21118@rabbitmq.com>
	<a50f8661-f939-47f5-abb5-daf00e9fb829@q14g2000prh.googlegroups.com>
	<20110607142404.GN21118@rabbitmq.com>
	<f5dfc8cc-7b70-48cc-9ca3-f60daa4787ef@u26g2000vby.googlegroups.com>
Message-ID: <20110607145153.GQ21118@rabbitmq.com>

On Tue, Jun 07, 2011 at 07:41:04AM -0700, Dan B wrote:
> Just did another reinstall.
> 
> Interestingly, if I don't specify a rabbitmq.config file then I can
> connect to the node from rabbitmqctl.bat, but if I do include a
> rabbitmq.config file then the service seems to start ok, listens for
> SSL on 5671, but I rabbitmqctl status reports node down, can't
> connect... weird.

Very weird. And the .config's as you posted earlier?

Does the same behaviour occur if you run it as a service and if you run
it directly from the -server.bat?

Matthew

From danbarua at gmail.com  Tue Jun  7 15:42:58 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 7 Jun 2011 07:42:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <20110607142404.GN21118@rabbitmq.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
	<807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>
	<20110607140339.GL21118@rabbitmq.com>
	<a50f8661-f939-47f5-abb5-daf00e9fb829@q14g2000prh.googlegroups.com>
	<20110607142404.GN21118@rabbitmq.com>
Message-ID: <98be4b47-7a15-469f-bd62-00123017d326@z7g2000prh.googlegroups.com>

but now we're getting somewhere with SSL:
.Net:
System.IO.IOException: The handshake failed due to an unexpected
packet format.
Erlang:
=ERROR REPORT==== 7-Jun-2011::15:35:11 ===
exception on TCP connection <0.398.0> from 192.168.0.20:54839
{bad_header,<<128,34,1,0,2,0,9,0>>}

From danbarua at gmail.com  Tue Jun  7 16:04:42 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 7 Jun 2011 08:04:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <20110607145153.GQ21118@rabbitmq.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
	<807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>
	<20110607140339.GL21118@rabbitmq.com>
	<a50f8661-f939-47f5-abb5-daf00e9fb829@q14g2000prh.googlegroups.com>
	<20110607142404.GN21118@rabbitmq.com>
	<f5dfc8cc-7b70-48cc-9ca3-f60daa4787ef@u26g2000vby.googlegroups.com>
	<20110607145153.GQ21118@rabbitmq.com>
Message-ID: <4f9f24df-1b83-4fdb-820c-67700067a028@h12g2000pro.googlegroups.com>

If i run it from -server.bat it works and I can do rabbitmqctl status
and connect to it (with the .config).

I'm getting the following crash logs when trying to connect over SSL,
I can connect fine over a standard connection:
=CRASH REPORT==== 7-Jun-2011::15:55:42 ===
  crasher:
    initial call: ssl_connection:init/1
    pid: <0.271.0>
    registered_name: []
    exception exit: ecertfile
      in function  gen_fsm:init_it/6
    ancestors: [ssl_connection_sup,ssl_sup,<0.200.0>]
    messages: []
    links: [<0.204.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 1052
  neighbours:

=SUPERVISOR REPORT==== 7-Jun-2011::15:55:42 ===
     Supervisor: {local,ssl_connection_sup}
     Context:    child_terminated
     Reason:     ecertfile
     Offender:   [{pid,<0.271.0>},
                  {name,undefined},
                  {mfargs,{ssl_connection,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4000},
                  {child_type,worker}]

Are we getting anywhere?

Thanks for your time.


On Jun 7, 3:51?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Tue, Jun 07, 2011 at 07:41:04AM -0700, Dan B wrote:
> > Just did another reinstall.
>
> > Interestingly, if I don't specify a rabbitmq.config file then I can
> > connect to the node from rabbitmqctl.bat, but if I do include a
> > rabbitmq.config file then the service seems to start ok, listens for
> > SSL on 5671, but I rabbitmqctl status reports node down, can't
> > connect... weird.
>
> Very weird. And the .config's as you posted earlier?
>
> Does the same behaviour occur if you run it as a service and if you run
> it directly from the -server.bat?
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From danbarua at gmail.com  Tue Jun  7 16:20:08 2011
From: danbarua at gmail.com (Dan B)
Date: Tue, 7 Jun 2011 08:20:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <4f9f24df-1b83-4fdb-820c-67700067a028@h12g2000pro.googlegroups.com>
References: <b58f178c-ad68-40b4-bd51-1e42cdfd3f9c@r20g2000yqd.googlegroups.com>
	<20110607122713.GG21118@rabbitmq.com>
	<8cd39637-32f7-45e0-a90b-8b5faac5160f@dr5g2000vbb.googlegroups.com>
	<df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
	<807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>
	<20110607140339.GL21118@rabbitmq.com>
	<a50f8661-f939-47f5-abb5-daf00e9fb829@q14g2000prh.googlegroups.com>
	<20110607142404.GN21118@rabbitmq.com>
	<f5dfc8cc-7b70-48cc-9ca3-f60daa4787ef@u26g2000vby.googlegroups.com>
	<20110607145153.GQ21118@rabbitmq.com>
	<4f9f24df-1b83-4fdb-820c-67700067a028@h12g2000pro.googlegroups.com>
Message-ID: <15e0cd74-c774-4dce-af3e-6d0cf3341cf0@22g2000prx.googlegroups.com>

Hi Mark,

Ok, firstly I switched to the .pem format for the Public Certificate.
That's one of the things I've been doing wrong all along.

The .net client started rejecting the certificate which is fine, we
now know that they're at least speaking to eachother so I temporarily
changed the CertificationValidationCallBack to

//return (sslPolicyErrors & ~m_sslOption.AcceptablePolicyErrors) ==
SslPolicyErrors.None;
return true;

...and wahey! We're exchanging messages over SSL!

Here's the catch: if I run RabbitMq as a service, SSL doesn't work,
and I can't talk to the node. If I run it as an application it all
works fine.

So I've got SSL up and running but it's not robust enough to use in
production yet....

-Dan

From matthew at rabbitmq.com  Tue Jun  7 16:40:49 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 7 Jun 2011 16:40:49 +0100
Subject: [rabbitmq-discuss] Rabbit + .Net + SSL
In-Reply-To: <15e0cd74-c774-4dce-af3e-6d0cf3341cf0@22g2000prx.googlegroups.com>
References: <df0ab322-1be1-487e-acff-eb6223336909@w10g2000yqh.googlegroups.com>
	<20110607130052.GI21118@rabbitmq.com>
	<807fb92b-367a-40ee-9bdb-9cfd63ab420c@u19g2000vbi.googlegroups.com>
	<20110607140339.GL21118@rabbitmq.com>
	<a50f8661-f939-47f5-abb5-daf00e9fb829@q14g2000prh.googlegroups.com>
	<20110607142404.GN21118@rabbitmq.com>
	<f5dfc8cc-7b70-48cc-9ca3-f60daa4787ef@u26g2000vby.googlegroups.com>
	<20110607145153.GQ21118@rabbitmq.com>
	<4f9f24df-1b83-4fdb-820c-67700067a028@h12g2000pro.googlegroups.com>
	<15e0cd74-c774-4dce-af3e-6d0cf3341cf0@22g2000prx.googlegroups.com>
Message-ID: <20110607154049.GR21118@rabbitmq.com>

On Tue, Jun 07, 2011 at 08:20:08AM -0700, Dan B wrote:
> Here's the catch: if I run RabbitMq as a service, SSL doesn't work,
> and I can't talk to the node. If I run it as an application it all
> works fine.

I'd try doing a "rabbitmq-service install" again, with rabbit stopped,
to see if that solves this.

Matthew

From mbaffa at opus.com.br  Tue Jun  7 18:12:58 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Tue, 7 Jun 2011 14:12:58 -0300
Subject: [rabbitmq-discuss] Connection Closing when used by more that one
	exchange
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A3E7261@srv-opus-02.opus.net>

Hi,

 

Iam new to RabbitMQ. I am developing my test applications and I have a
problem that maybe you can help me.

 

I have a Producer, in Flex, that send a message to a direct exchange,
sendMsgExc and a routing key with same name. The consumer, in C#, binds
the exchange and receives the message and sends a reply like this:

 

The message is received in an thread like this:

 

        private void receiveMessagesAmqp() {

 

            IConnection connection = null;

            IModel channel = null;

 

            try {

 

                var connectionFactory = new ConnectionFactory();

                connectionFactory.HostName = "localhost";

                connectionFactory.UserName = "guest";

                connectionFactory.Password = "guest";

 

                connection = connectionFactory.CreateConnection();

                channel = connection.CreateModel();

            }

            catch( Exception ) { }

 

            try {

 

                channel.ExchangeDeclare( "sendMsgExc",
ExchangeType.Direct, false );

                channel.QueueDeclare( "myQueue", false, false, false,
null );

                channel.QueueBind( "myQueue", "sendMsgExc", "sendMsgExc"
);

 

                QueueingBasicConsumer consumer = new
QueueingBasicConsumer( channel );

                String consumerTag = channel.BasicConsume( "myQueue",
false, consumer );

                RabbitMQ.Client.Events.BasicDeliverEventArgs
basicDeliveryEventArgs = null;

 

                while( true ) {

                    try {

                        basicDeliveryEventArgs =
(RabbitMQ.Client.Events.BasicDeliverEventArgs) consumer.Queue.Dequeue();

 

                        IBasicProperties props =
basicDeliveryEventArgs.BasicProperties;

                        byte[] body = basicDeliveryEventArgs.Body;

 

                        string messageContent = Encoding.UTF8.GetString(
basicDeliveryEventArgs.Body );

                        channel.BasicAck(
basicDeliveryEventArgs.DeliveryTag, false );

 

                        MessageVO message =
JsonConvert.DeserializeObject<MessageVO>( messageContent );

                        sendReply( message );

                    }

                    catch( OperationInterruptedException ex ) {

                        // The consumer was removed, either through

                        // channel or connection closure, or through the

                        // action of IModel.BasicCancel().

                        break;

                    }

                }

            }

            catch( Exception ) {

            }

            finally {

 

                channel.Close();

                connection.Close();

            }

                }

 

The sendReply method sends a message back to the Producer, like this:

 

        private void sendReply( MessageVO messageVO ) {

 

            var connectionFactory = new ConnectionFactory();

            connectionFactory.HostName = "localhost";

            connectionFactory.UserName = "guest";

            connectionFactory.Password = "guest";

 

            using( IConnection connection =
connectionFactory.CreateConnection() ) {

                using( IModel model = connection.CreateModel() ) {

 

                    messageVO.task.question = 8;

                    messageVO.task.answer += 10;

                    messageVO.task.msg = messageVO.task.msg + " -
Message Reply";

 

                    messageVO.task.errorMessage = new ErrorMessageVO();

                    messageVO.task.errorMessage.errorNumber = -10;

  messageVO.task.errorMessage.errorMessage =
messageVO.task.errorMessage.errorMessage 

+ " - Message Reply";

 

                    string message = JsonConvert.SerializeObject(
messageVO );

                    IBasicProperties basicProperties =
model.CreateBasicProperties();

                    model.BasicPublish( "ReplyExc", "ReplyExc", false,
false, basicProperties, Encoding.UTF8.GetBytes( 

 message ) );

                }

            }

        }

 

 

As you can see the sendReply opens another connection and channel to
send the reply back to the consumer. I know I can use the RPC pattern
but I need to send a message back like this.

 

When I try to define one connection that would be used by the
receiveMessageAmqp and the sendReply it stops working. 

 

That is the connection becomes global to the class, that implements a
thread, receiveMessageAmqp creates the connection and channel exactly in
the same manner.  The sendReply will now only to create the channel,
will not create a connection, and It will use the same connection
created by receiveMessageAmqp.

 

What happens is that the first message received everything works ok, the
message is received and the reply is sent. When another message is sent
by the producer the consumer receives the message and the line
channel.BasicAck( basicDeliveryEventArgs.DeliveryTag, false ); is
executed an exception is thrown:

base {RabbitMQ.Client.Exceptions.OperationInterruptedException} = {"The
AMQP operation was interrupted: AMQP close-reason, initiated by
Application, code=200, text=\"Connection close forced\", classId=0,
methodId=0, cause="}

 

Debugging the code I could verify that the finally block did not close
neither the connection nor the channel.

 

I presumed I could use one connection per thread and open as many as I
need channels. What is wrong here please ???

 

Thanks in advance.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110607/6fcc64a9/attachment-0001.htm>

From toby.corkindale at strategicdata.com.au  Wed Jun  8 03:00:47 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 08 Jun 2011 12:00:47 +1000
Subject: [rabbitmq-discuss] How many ports does RabbitMQ need open?
Message-ID: <4DEED7CF.9000101@strategicdata.com.au>

Hi,
Our systems are fairly thoroughly firewalled by default.
I want to cluster a couple of RabbitMQ nodes.
It's no problem to ask the sysadmins to open up some ports, and I have 
found how to adjust the kernel inet_dist_listen_* options to limit the 
ports Erlang will use..

But I wonder how many ports RabbitMQ really needs there?
Is one port enough? Ten? One hundred? One thousand?

Cheers,
Toby

From toby.corkindale at strategicdata.com.au  Wed Jun  8 03:15:58 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 08 Jun 2011 12:15:58 +1000
Subject: [rabbitmq-discuss] STOMP - Message queue selectors for
	consumers?
In-Reply-To: <C65507186EB34851993F3CA3F72470D1@rabbitmq.com>
References: <4DEDA703.8070502@strategicdata.com.au>
	<C65507186EB34851993F3CA3F72470D1@rabbitmq.com>
Message-ID: <4DEEDB5E.5080105@strategicdata.com.au>

On 07/06/11 21:30, Rob Harrop wrote:
> Toby,
>
> The solution you propose is the easiest and most efficient way of doing
> it on RabbitMQ STOMP. Using different /queue/ destinations removes the
> need for complex matching during message routing.
>
> Queues are cheap in RabbitMQ and each /queue corresponds to one queue,
> so creating a queue per country is not expensive. Also, queues are
> created lazily so you don't need to worry about ordering
> consumers/publishers.

Hi Rob,
Thanks, that's good to know.

Let's say I change the example to using machine hostnames or IP 
addresses. In that case there are not going to be large numbers of 
unique names in use at any one time, but over time the names may stop 
being used and new ones will appear.

So I could use STOMP destinations such as:
/queue/hostname.foobar.example.com

Is there a way to clean up the queues once those machines have gone 
away, say after some months or more of use?

I couldn't spot anything on the STOMP plugin page, nor the rabbitmq 
admin guide page.

I can see there is a "list_queues" option to rabbitmqctl, but not a 
corresponding delete_queue option.. Where would I find that?

Sorry about all these newbie questions..
Thanks again for your help,
Toby


From lawgon at thenilgiris.com  Wed Jun  8 03:52:29 2011
From: lawgon at thenilgiris.com (Kenneth Gonsalves)
Date: Wed, 08 Jun 2011 08:22:29 +0530
Subject: [rabbitmq-discuss] will not start on fedora 12
Message-ID: <1307501549.1998.567.camel@localhost>

hi,

am on fedora 12 and installed rabbitmq using yum. On start it fails with
the error message:

Error: {cannot_connect_to_epmd,"xlquest",address}

I have done an extensive search, but not come up with a solution. Any
clues?
-- 
regards
KG
http://lawgon.livejournal.com
Coimbatore LUG rox
http://ilugcbe.techstud.org/


From michael.s.klishin at gmail.com  Wed Jun  8 06:24:30 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 8 Jun 2011 09:24:30 +0400
Subject: [rabbitmq-discuss] will not start on fedora 12
In-Reply-To: <1307501549.1998.567.camel@localhost>
References: <1307501549.1998.567.camel@localhost>
Message-ID: <BANLkTiks+dAhf=mxGQ7CG27hWYy+5CBSmQ@mail.gmail.com>

epmd [1] is Erlang runtime daemon that uses port 4369 by default. Can you
check that port is accessible
or that epmd is running?

1. http://www.erlang.org/doc/man/epmd.html

2011/6/8 Kenneth Gonsalves <lawgon at thenilgiris.com>

> Error: {cannot_connect_to_epmd,"xlquest",address}
>
> I have done an extensive search, but not come up with a solution. Any
> clues?
>

-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110608/f21dbfae/attachment.htm>

From rob at rabbitmq.com  Wed Jun  8 08:11:51 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Wed, 8 Jun 2011 08:11:51 +0100
Subject: [rabbitmq-discuss] STOMP - Message queue selectors for
 consumers?
In-Reply-To: <4DEEDB5E.5080105@strategicdata.com.au>
References: <4DEDA703.8070502@strategicdata.com.au>
	<C65507186EB34851993F3CA3F72470D1@rabbitmq.com>
	<4DEEDB5E.5080105@strategicdata.com.au>
Message-ID: <430AA88FEB8549C3A40A3BA327DE0A5C@rabbitmq.com>

Tony,

The best option here is to use the management plugin (http://www.rabbitmq.com/management.html).

You'll be able to manually delete the queues using the UI or script the deletion using the REST API or the rabbitmqadmin plugin.

If you think it would be useful we can add support to STOMP for queue leases (http://www.rabbitmq.com/extensions.html#queue-leases).

-- 
Rob Harrop
RabbitMQ

> Hi Rob,
> Thanks, that's good to know.
> 
> Let's say I change the example to using machine hostnames or IP 
> addresses. In that case there are not going to be large numbers of 
> unique names in use at any one time, but over time the names may stop 
> being used and new ones will appear.
> 
> So I could use STOMP destinations such as:
> /queue/hostname.foobar.example.com (http://hostname.foobar.example.com)
> 
> Is there a way to clean up the queues once those machines have gone 
> away, say after some months or more of use?
> 
> I couldn't spot anything on the STOMP plugin page, nor the rabbitmq 
> admin guide page.
> 
> I can see there is a "list_queues" option to rabbitmqctl, but not a 
> corresponding delete_queue option.. Where would I find that?
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110608/f49fdf24/attachment.htm>

From simon at rabbitmq.com  Wed Jun  8 10:20:19 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Jun 2011 10:20:19 +0100
Subject: [rabbitmq-discuss] will not start on fedora 12
In-Reply-To: <BANLkTiks+dAhf=mxGQ7CG27hWYy+5CBSmQ@mail.gmail.com>
References: <1307501549.1998.567.camel@localhost>
	<BANLkTiks+dAhf=mxGQ7CG27hWYy+5CBSmQ@mail.gmail.com>
Message-ID: <4DEF3ED3.8010208@rabbitmq.com>

When we've seen this error message before, it's been because the 
machine's hostname *is* resolvable in the DNS, but does *not* actually 
point to the machine in question. Erlang starts epmd and attempts to 
connect to `hostname`, but since that's not the same machine, epmd is 
not running there.

Kenneth, does that sound like it could describe your problem? Is the 
machine really "xlquest"?

Also, I think we changed that error message in 2.4.1 - are you running 
an older version?

Cheers, Simon

On 08/06/11 06:24, Michael Klishin wrote:
> epmd [1] is Erlang runtime daemon that uses port 4369 by default. Can
> you check that port is accessible
> or that epmd is running?
>
> 1. http://www.erlang.org/doc/man/epmd.html
>
> 2011/6/8 Kenneth Gonsalves <lawgon at thenilgiris.com
> <mailto:lawgon at thenilgiris.com>>
>
>     Error: {cannot_connect_to_epmd,"xlquest",address}
>
>     I have done an extensive search, but not come up with a solution. Any
>     clues?
>
>
> --
> MK
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Wed Jun  8 10:22:30 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Jun 2011 10:22:30 +0100
Subject: [rabbitmq-discuss] How many ports does RabbitMQ need open?
In-Reply-To: <4DEED7CF.9000101@strategicdata.com.au>
References: <4DEED7CF.9000101@strategicdata.com.au>
Message-ID: <4DEF3F56.7090200@rabbitmq.com>

On 08/06/11 03:00, Toby Corkindale wrote:
> Our systems are fairly thoroughly firewalled by default.
> I want to cluster a couple of RabbitMQ nodes.
> It's no problem to ask the sysadmins to open up some ports, and I have
> found how to adjust the kernel inet_dist_listen_* options to limit the
> ports Erlang will use..
>
> But I wonder how many ports RabbitMQ really needs there?
> Is one port enough? Ten? One hundred? One thousand?

Hi Toby. We've had reports of success with a single port. You'll also 
need to open up port 4369 for epmd.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From Simone.Busoli at ferrari.com  Wed Jun  8 10:24:49 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Wed, 8 Jun 2011 09:24:49 +0000
Subject: [rabbitmq-discuss] How many ports does RabbitMQ need open?
In-Reply-To: <4DEED7CF.9000101@strategicdata.com.au>
References: <4DEED7CF.9000101@strategicdata.com.au>
Message-ID: <88E590DC4586974D825FC82AE798294E5200C8C8@GSVCLU03.ges.ferlan.it>

I'm not sure but as far as I know only one port (5672 is the default) needs to be open.

_______________________________________________________________ 
Simone Busoli
Direzione risorse umane e segreteria generale - Sistemi informativi gestione sportiva 
Collaboratore
Ferrari S.p.A.???? Via Ascari 55/57, 41053, Maranello (MO); Italy
T?(+39) 0536-949.850
E simone.busoli at ferrari.com  www.ferrari.com 

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Toby Corkindale
Sent: Wednesday, June 08, 2011 4:01 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] How many ports does RabbitMQ need open?

Hi,
Our systems are fairly thoroughly firewalled by default.
I want to cluster a couple of RabbitMQ nodes.
It's no problem to ask the sysadmins to open up some ports, and I have found how to adjust the kernel inet_dist_listen_* options to limit the ports Erlang will use..

But I wonder how many ports RabbitMQ really needs there?
Is one port enough? Ten? One hundred? One thousand?

Cheers,
Toby
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


From lawgon at thenilgiris.com  Wed Jun  8 11:10:33 2011
From: lawgon at thenilgiris.com (Kenneth Gonsalves)
Date: Wed, 08 Jun 2011 15:40:33 +0530
Subject: [rabbitmq-discuss] will not start on fedora 12
In-Reply-To: <4DEF3ED3.8010208@rabbitmq.com>
References: <1307501549.1998.567.camel@localhost>
	<BANLkTiks+dAhf=mxGQ7CG27hWYy+5CBSmQ@mail.gmail.com>
	<4DEF3ED3.8010208@rabbitmq.com>
Message-ID: <1307527833.1998.610.camel@localhost>

On Wed, 2011-06-08 at 10:20 +0100, Simon MacMullen wrote:
> Kenneth, does that sound like it could describe your problem? Is the 
> machine really "xlquest"?

fqdn is xlquest.web, which is in /etc/hosts, but it was looking for
xlquest - when I added 'xlquest' to /etc/hosts, the problem went away
> 
> Also, I think we changed that error message in 2.4.1 - are you
> running 
> an older version?
> 
> 

2.1.1 - this comes with fedora 12 
-- 
regards
KG
http://lawgon.livejournal.com
Coimbatore LUG rox
http://ilugcbe.techstud.org/


From matthew at rabbitmq.com  Wed Jun  8 11:16:25 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 8 Jun 2011 11:16:25 +0100
Subject: [rabbitmq-discuss] will not start on fedora 12
In-Reply-To: <1307527833.1998.610.camel@localhost>
References: <1307501549.1998.567.camel@localhost>
	<BANLkTiks+dAhf=mxGQ7CG27hWYy+5CBSmQ@mail.gmail.com>
	<4DEF3ED3.8010208@rabbitmq.com>
	<1307527833.1998.610.camel@localhost>
Message-ID: <20110608101625.GC25768@rabbitmq.com>

On Wed, Jun 08, 2011 at 03:40:33PM +0530, Kenneth Gonsalves wrote:
> 2.1.1 - this comes with fedora 12 

Please upgrade if you can. Many bugs get fixed (and normally a few
added) each release, along with a slew of features. We provide RPMs on
our website. http://www.rabbitmq.com/server.html

Matthew

From lawgon at thenilgiris.com  Wed Jun  8 11:26:03 2011
From: lawgon at thenilgiris.com (Kenneth Gonsalves)
Date: Wed, 08 Jun 2011 15:56:03 +0530
Subject: [rabbitmq-discuss] will not start on fedora 12
In-Reply-To: <20110608101625.GC25768@rabbitmq.com>
References: <1307501549.1998.567.camel@localhost>
	<BANLkTiks+dAhf=mxGQ7CG27hWYy+5CBSmQ@mail.gmail.com>
	<4DEF3ED3.8010208@rabbitmq.com> <1307527833.1998.610.camel@localhost>
	<20110608101625.GC25768@rabbitmq.com>
Message-ID: <1307528763.1998.612.camel@localhost>

On Wed, 2011-06-08 at 11:16 +0100, Matthew Sackman wrote:
> On Wed, Jun 08, 2011 at 03:40:33PM +0530, Kenneth Gonsalves wrote:
> > 2.1.1 - this comes with fedora 12 
> 
> Please upgrade if you can. Many bugs get fixed (and normally a few
> added) each release, along with a slew of features. We provide RPMs on
> our website. http://www.rabbitmq.com/server.html 

will do - am going to fedora 15 tommorrow
-- 
regards
KG
http://lawgon.livejournal.com
Coimbatore LUG rox
http://ilugcbe.techstud.org/


From alexis at rabbitmq.com  Wed Jun  8 13:26:52 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 8 Jun 2011 13:26:52 +0100
Subject: [rabbitmq-discuss] PUBSUB
Message-ID: <BANLkTin8Ga7bgh0KPBSWLQmvyYfXyD_2Bg@mail.gmail.com>

Please come and talk about messaging over a beer or two...

Tonight, from around 5:30pm at the Water Poet, 9-11 Folgate St, London E1 6BX

The pub is large and has a space at the back where we should be able
to gather...

alexis



http://maps.google.co.uk/maps/place?client=safari&rls=en&oe=UTF-8&redir_esc=&um=1&ie=UTF-8&q=the+water+poet&fb=1&gl=uk&hq=the+water+poet&hnear=0x48760378cf4fae73:0x74f70bc4fa0e26cb,Camberwell&cid=12611810961984780368

From matthias at rabbitmq.com  Wed Jun  8 17:52:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Jun 2011 17:52:01 +0100
Subject: [rabbitmq-discuss] rabbitmq-erlang-client git repo lagging
 behind hg?
In-Reply-To: <BANLkTinJQnyVX-8dx1-qJW_zog3e2ZTq8w@mail.gmail.com>
References: <BANLkTinJQnyVX-8dx1-qJW_zog3e2ZTq8w@mail.gmail.com>
Message-ID: <4DEFA8B1.2090106@rabbitmq.com>

On 06/06/11 11:16, Hunter Morris wrote:
> It appears that the canonical Mercurial repository at:
>
> http://hg.rabbitmq.com/rabbitmq-erlang-client/
>
> is several commits (and indeed a version) ahead of the github git mirror at:
>
> https://github.com/rabbitmq/rabbitmq-erlang-client

Well spotted.

> Perhaps some automated job has stopped running

It's still running, but tripping over one specific revision. We are 
investigating.

Matthias.

From matthias at rabbitmq.com  Wed Jun  8 17:54:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 08 Jun 2011 17:54:41 +0100
Subject: [rabbitmq-discuss] message rates moving averages
In-Reply-To: <888619.14950.qm@web111003.mail.gq1.yahoo.com>
References: <BANLkTinXVWASQx9m-=KfquSy2_OCuB47qQ@mail.gmail.com>	<4DE8ADBB.5080701@rabbitmq.com>	<BANLkTikvEM_Cn1d-rS1xqrJExE9oMqpyDQ@mail.gmail.com>	<4DE8D0CC.2050408@rabbitmq.com>	<BANLkTikMdWO4HmhTVd2uyMDkxwNEu6fs0Q@mail.gmail.com>
	<888619.14950.qm@web111003.mail.gq1.yahoo.com>
Message-ID: <4DEFA951.6090408@rabbitmq.com>

On 03/06/11 15:11, Dave Greggory wrote:
> +1 for this feature request.
>
> ------------------------------------------------------------------------
> *From:* S?bastien Rainville <sebastien at hopper.travel>
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Sent:* Fri, June 3, 2011 8:59:51 AM
> *Subject:* Re: [rabbitmq-discuss] message rates moving averages
>
> Thanks! I'll change it in the code directly for now, but yes simply
> making it configurable would be great. Since it seems fairly simple, any
> chance that thing can go up in the priority queue?

We've filed a bug for it. You are right that it's comparatively little 
work, but it's still competing for attention which lots of other items.


Matthias.

From simon at rabbitmq.com  Wed Jun  8 17:56:45 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 08 Jun 2011 17:56:45 +0100
Subject: [rabbitmq-discuss] message rates moving averages
In-Reply-To: <888619.14950.qm@web111003.mail.gq1.yahoo.com>
References: <BANLkTinXVWASQx9m-=KfquSy2_OCuB47qQ@mail.gmail.com>	<4DE8ADBB.5080701@rabbitmq.com>	<BANLkTikvEM_Cn1d-rS1xqrJExE9oMqpyDQ@mail.gmail.com>	<4DE8D0CC.2050408@rabbitmq.com>	<BANLkTikMdWO4HmhTVd2uyMDkxwNEu6fs0Q@mail.gmail.com>
	<888619.14950.qm@web111003.mail.gq1.yahoo.com>
Message-ID: <4DEFA9CD.50601@rabbitmq.com>

OK, this is now officially on my radar.

Whatever that means :)

Cheers, Simon

On 03/06/11 15:11, Dave Greggory wrote:
> +1 for this feature request.
>
> ------------------------------------------------------------------------
> *From:* S?bastien Rainville <sebastien at hopper.travel>
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Sent:* Fri, June 3, 2011 8:59:51 AM
> *Subject:* Re: [rabbitmq-discuss] message rates moving averages
>
> Thanks! I'll change it in the code directly for now, but yes simply
> making it configurable would be great. Since it seems fairly simple, any
> chance that thing can go up in the priority queue?
>
>
>
> On Fri, Jun 3, 2011 at 8:17 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 03/06/11 12:34, S?bastien Rainville wrote:
>
>         Is there a constant somewhere that I could change directly in
>         the code
>         so that it's always an average over, say 1 minute, instead of the
>         default 5 seconds? I browsed the source code of the management
>         plugin
>         but couldn't isolate it. I don't know Erlang so it makes things
>         a bit
>         more complicated :P Then, ideally I'd like to make that thing
>         configurable in the config file. Is it easy to do? If not, then
>         I'm ok
>         with simply changing the value directly in the code.
>
>
>     It's actually in the broker rather than the management plugin.
>     Change the line defining STATS_INTERVAL in
>     rabbitmq-server/include/rabbit.hrl.
>
>     Hmm, maybe we should make this configurable...
>
>
>     Cheers, Simon
>     --
>     Simon MacMullen
>     Staff Engineer, RabbitMQ
>     SpringSource, a division of VMware
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From toby.corkindale at strategicdata.com.au  Thu Jun  9 01:35:45 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Thu, 09 Jun 2011 10:35:45 +1000
Subject: [rabbitmq-discuss] How many ports does RabbitMQ need open?
In-Reply-To: <88E590DC4586974D825FC82AE798294E5200C8C8@GSVCLU03.ges.ferlan.it>
References: <4DEED7CF.9000101@strategicdata.com.au>
	<88E590DC4586974D825FC82AE798294E5200C8C8@GSVCLU03.ges.ferlan.it>
Message-ID: <4DF01561.4000803@strategicdata.com.au>

On 08/06/11 19:24, Busoli, Simone wrote:
> I'm not sure but as far as I know only one port (5672 is the default) needs to be open.

Ah, you're thinking of when it is clients connecting to the MQ.
I'm talking about clustering multiple RabbitMQ nodes.

It definitely needs a few more - the erlang port mapper on 4369 for 
starters - and then some more that erlang dynamically chooses. (Although 
can be limited to a range with the parameters I mentioned below)

I'm curious to know how many are really needed for those extras; if I 
limit the range to just 5 ports, am I likely to hit troubles? How about 
100 ports?

Cheers,
Toby

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Toby Corkindale
> Sent: Wednesday, June 08, 2011 4:01 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] How many ports does RabbitMQ need open?
>
> Hi,
> Our systems are fairly thoroughly firewalled by default.
> I want to cluster a couple of RabbitMQ nodes.
> It's no problem to ask the sysadmins to open up some ports, and I have found how to adjust the kernel inet_dist_listen_* options to limit the ports Erlang will use..
>
> But I wonder how many ports RabbitMQ really needs there?
> Is one port enough? Ten? One hundred? One thousand?
>
> Cheers,
> Toby

From simon at rabbitmq.com  Thu Jun  9 08:55:12 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 09 Jun 2011 08:55:12 +0100
Subject: [rabbitmq-discuss] How many ports does RabbitMQ need open?
In-Reply-To: <4DF01561.4000803@strategicdata.com.au>
References: <4DEED7CF.9000101@strategicdata.com.au>	<88E590DC4586974D825FC82AE798294E5200C8C8@GSVCLU03.ges.ferlan.it>
	<4DF01561.4000803@strategicdata.com.au>
Message-ID: <4DF07C60.5050504@rabbitmq.com>

On 09/06/2011 1:35AM, Toby Corkindale wrote:
> Ah, you're thinking of when it is clients connecting to the MQ.
> I'm talking about clustering multiple RabbitMQ nodes.
>
> It definitely needs a few more - the erlang port mapper on 4369 for
> starters - and then some more that erlang dynamically chooses. (Although
> can be limited to a range with the parameters I mentioned below)
>
> I'm curious to know how many are really needed for those extras; if I
> limit the range to just 5 ports, am I likely to hit troubles? How about
> 100 ports?

Hi Toby. In my mail I *was* talking about clustering - like I said, 
although it's not a configuration we test we've heard of people running 
with that range collapsed to one port and not running into problems.

Cheers, Simon

From stammailbox at gmail.com  Thu Jun  9 12:33:23 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Thu, 9 Jun 2011 14:33:23 +0300
Subject: [rabbitmq-discuss] consumer.nextDelivery() does not return with a
	value
Message-ID: <BANLkTinD9ke0igfCqMjOxRCA_81Oa_4GBA@mail.gmail.com>

Hi,
I have a basic problem with rabbitmq.

I have two clients
One does queuedeclare() and queue bind()
and then the other should  iterates with consumer.nextDelivery()

I can clearly sea that only after the queuedeclare it is added to the
list_queues
and only when I bind - the messages are added to the message count.
so it seems ok, but -

 the  consumer.nextDelivery() does not return with value (the application is
stuck on that line)

any suggestions?
Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110609/bfcf96c2/attachment.htm>

From joseph.a.marlin at gmail.com  Thu Jun  9 13:27:09 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Thu, 9 Jun 2011 05:27:09 -0700 (PDT)
Subject: [rabbitmq-discuss] consumer.nextDelivery() does not return with
 a value
In-Reply-To: <BANLkTinD9ke0igfCqMjOxRCA_81Oa_4GBA@mail.gmail.com>
Message-ID: <11293887.1386.1307622429509.JavaMail.geo-discussion-forums@vbbhi2>

If the other client is not binding to the queue, then how does it know where 
to get deliveries from? (Perhaps I am misunderstanding how you have your 
clients configured...)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110609/e83b42ed/attachment.htm>

From a2alt at ya.ru  Thu Jun  9 17:02:32 2011
From: a2alt at ya.ru (Groshev Dmitry)
Date: Thu, 09 Jun 2011 20:02:32 +0400
Subject: [rabbitmq-discuss] Bug or feature? Erlang client
Message-ID: <172321307635353@web50.yandex.ru>

I have a node running rabbit. I'm trying to connect to a rabbit with "direct" method from another node (with same cookie, of course), but amqp_connect fails with broker_not_found_in_vm. I'm pinging manually rabbit's host during init and I can see rabbit at rabbithost in nodes(), but driver doesn't work. "network" method works fine. What am I doing wrong?

From jtm.moon.forum.user at gmail.com  Thu Jun  9 22:00:18 2011
From: jtm.moon.forum.user at gmail.com (J_Tom_Moon_79)
Date: Thu, 9 Jun 2011 14:00:18 -0700 (PDT)
Subject: [rabbitmq-discuss] build failure: `deps.mk',
	needed by `ebin/bpqueue.beam'
Message-ID: <8aaa2d14-57e2-4b38-8472-313b17d7b242@l2g2000prg.googlegroups.com>

Hi,
Builds fail with
[]escript: script failed: {function_clause,
                   [{erl_parse,
                        build_type,
                        [{atom,159,ok_or_error2},
                         [{type,pid,[]},{type,any,[]}]]},
                    {erl_parse,yeccpars2,7},
                    {erl_parse,yeccpars0,2},
                    {epp,parse_file,2},
                    {epp,parse_file,2},
                    {epp,parse_file,2},
                    {epp,parse_file,2},
                    {epp,parse_file,2}]}
make: *** No rule to make target `deps.mk', needed by `ebin/
bpqueue.beam'.  Stop.



Here is the history of commands.
<pre>
$ uname -a
SunOS dev21 5.10 Generic_141445-09 i86pc i386 i86pc
$ erl --version
Erlang (BEAM) emulator version 5.5.5 [source] [async-threads:0]
[kernel-poll:false]
$ python --version
Python 2.6.2
$ make --version
GNU Make 3.81
$ wget 'http://www.rabbitmq.com/rabbitmq-signing-key-public.asc'
$ wget 'http://www.rabbitmq.com/releases/rabbitmq-server/v2.4.1/
rabbitmq-server-2.4.1.zip.asc'
$ wget 'http://www.rabbitmq.com/releases/rabbitmq-server/v2.4.1/
rabbitmq-server-2.4.1.zip'
$ gpg --verify rabbitmq-server-2.4.1.zip.asc rabbitmq-server-2.4.1.zip
gpg: Signature made Thu Apr 07 09:04:47 2011 PDT using DSA key ID
056E8E56
gpg: Good signature from "RabbitMQ Release Signing Key
<info at rabbitmq.com>"
$ unzip rabbitmq-server-2.4.1.zip
$ cd rabbitmq-server-2.4.1
$ make clean
/bin/sh: python2.5: not found
rm -f ebin/*.beam
rm -f ebin/rabbit.app ebin/rabbit.boot ebin/rabbit.script ebin/
rabbit.rel
rm -f include/rabbit_framing.hrl src/rabbit_framing_amqp_*.erl
codegen.pyc
rm -f docs/*.[0-9].gz docs/*.man.xml docs/*.erl     src/
rabbit_ctl_usage.erl
rm -f rabbit.plt
rm -f deps.mk
$ make
/bin/sh: python2.5: not found
python codegen.py body codegen/amqp-rabbitmq-0.9.1.json src/
rabbit_framing_amqp_0_9_1.erl
python codegen.py body codegen/amqp-rabbitmq-0.8.json src/
rabbit_framing_amqp_0_8.erl
xsltproc --stringparam modulename "`basename src/
rabbit_ctl_usage.erl .erl`" \
                docs/usage.xsl docs/rabbitmqctl.1.xml > src/
rabbit_ctl_usage.erl.tmp
sed -e 's/"/\\"/g' -e 's/%QUOTE%/"/g' src/rabbit_ctl_usage.erl.tmp >
src/rabbit_ctl_usage.erl.tmp2
fold -s src/rabbit_ctl_usage.erl.tmp2 > src/rabbit_ctl_usage.erl.tmp3
mv src/rabbit_ctl_usage.erl.tmp3 src/rabbit_ctl_usage.erl
rm src/rabbit_ctl_usage.erl.tmp src/rabbit_ctl_usage.erl.tmp2
python codegen.py --ignore-conflicts header codegen/amqp-
rabbitmq-0.9.1.json codegen/amqp-rabbitmq-0.8.json include/
rabbit_framing.hrl
rm -f deps.mk
echo src/bpqueue.erl:src/delegate.erl:src/delegate_sup.erl:src/
file_handle_cache.erl:src/gatherer.erl:src/gen_server2.erl:src/
gm.erl:src/gm_soak_test.erl:src/gm_speed_test.erl:src/gm_tests.erl:src/
pg_local.erl:src/priority_queue.erl:src/rabbit.erl:src/
rabbit_access_control.erl:src/rabbit_alarm.erl:src/
rabbit_amqqueue.erl:src/rabbit_amqqueue_process.erl:src/
rabbit_amqqueue_sup.erl:src/rabbit_auth_backend.erl:src/
rabbit_auth_backend_internal.erl:src/rabbit_auth_mechanism.erl:src/
rabbit_auth_mechanism_amqplain.erl:src/
rabbit_auth_mechanism_cr_demo.erl:src/
rabbit_auth_mechanism_plain.erl:src/rabbit_backing_queue.erl:src/
rabbit_basic.erl:src/rabbit_binary_generator.erl:src/
rabbit_binary_parser.erl:src/rabbit_binding.erl:src/
rabbit_channel.erl:src/rabbit_channel_sup.erl:src/
rabbit_channel_sup_sup.erl:src/rabbit_client_sup.erl:src/
rabbit_command_assembler.erl:src/rabbit_connection_sup.erl:src/
rabbit_control.erl:src/rabbit_direct.erl:src/
rabbit_error_logger.erl:src/rabbit_error_logger_file_h.erl:src/
rabbit_event.erl:src/rabbit_exchange.erl:src/
rabbit_exchange_type.erl:src/rabbit_exchange_type_direct.erl:src/
rabbit_exchange_type_fanout.erl:src/
rabbit_exchange_type_headers.erl:src/
rabbit_exchange_type_topic.erl:src/rabbit_framing.erl:src/
rabbit_guid.erl:src/rabbit_heartbeat.erl:src/rabbit_limiter.erl:src/
rabbit_log.erl:src/rabbit_memory_monitor.erl:src/rabbit_misc.erl:src/
rabbit_mnesia.erl:src/rabbit_msg_file.erl:src/rabbit_msg_store.erl:src/
rabbit_msg_store_ets_index.erl:src/rabbit_msg_store_gc.erl:src/
rabbit_msg_store_index.erl:src/rabbit_net.erl:src/
rabbit_networking.erl:src/rabbit_node_monitor.erl:src/
rabbit_prelaunch.erl:src/rabbit_queue_collector.erl:src/
rabbit_queue_index.erl:src/rabbit_reader.erl:src/
rabbit_registry.erl:src/rabbit_restartable_sup.erl:src/
rabbit_router.erl:src/rabbit_sasl_report_file_h.erl:src/
rabbit_ssl.erl:src/rabbit_sup.erl:src/rabbit_tests.erl:src/
rabbit_tests_event_receiver.erl:src/rabbit_types.erl:src/
rabbit_upgrade.erl:src/rabbit_upgrade_functions.erl:src/
rabbit_variable_queue.erl:src/rabbit_version.erl:src/
rabbit_vhost.erl:src/rabbit_writer.erl:src/supervisor2.erl:src/
tcp_acceptor.erl:src/tcp_acceptor_sup.erl:src/tcp_listener.erl:src/
tcp_listener_sup.erl:src/test_sup.erl:src/vm_memory_monitor.erl:src/
worker_pool.erl:src/worker_pool_sup.erl:src/worker_pool_worker.erl:src/
rabbit_framing_amqp_0_9_1.erl:src/rabbit_framing_amqp_0_8.erl:src/
rabbit_ctl_usage.erl:include/gm_specs.hrl:include/rabbit.hrl:include/
rabbit_auth_backend_spec.hrl:include/
rabbit_auth_mechanism_spec.hrl:include/
rabbit_backing_queue_spec.hrl:include/
rabbit_exchange_type_spec.hrl:include/rabbit_msg_store.hrl:include/
rabbit_msg_store_index.hrl:include/rabbit_framing.hrl: | escript
generate_deps deps.mk ebin
[]escript: script failed: {function_clause,
                   [{erl_parse,
                        build_type,
                        [{atom,159,ok_or_error2},
                         [{type,pid,[]},{type,any,[]}]]},
                    {erl_parse,yeccpars2,7},
                    {erl_parse,yeccpars0,2},
                    {epp,parse_file,2},
                    {epp,parse_file,2},
                    {epp,parse_file,2},
                    {epp,parse_file,2},
                    {epp,parse_file,2}]}
make: *** No rule to make target `deps.mk', needed by `ebin/
bpqueue.beam'.  Stop.
</pre>

I already read this
http://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/eb8c99d8c70ba110/9fc6572a0b6ccf7f?lnk=gst&q=ebin%2Fbpqueue.beam#9fc6572a0b6ccf7f
There was no helpful information.

<i>-J_Tom_Moon_79</i>

From emile at rabbitmq.com  Thu Jun  9 22:42:45 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 09 Jun 2011 22:42:45 +0100
Subject: [rabbitmq-discuss] build failure: `deps.mk',
	needed by `ebin/bpqueue.beam'
In-Reply-To: <8aaa2d14-57e2-4b38-8472-313b17d7b242@l2g2000prg.googlegroups.com>
References: <8aaa2d14-57e2-4b38-8472-313b17d7b242@l2g2000prg.googlegroups.com>
Message-ID: <4DF13E55.1080208@rabbitmq.com>

Hi,

Op 09/06/11 22:00, het J_Tom_Moon_79 geskryf:
> $ erl --version
> Erlang (BEAM) emulator version 5.5.5 [source] [async-threads:0]

Unfortunately R11B-5 is too old. You need at least R12B-5 to build and
R12B-3 to run rabbit at the moment. It is fairly straight-foward to
build the latest version of Erlang on Solaris.

Note that the rabbit download for generic Unix includes
platform-independent binaries. This makes it unnecessary to compile
rabbit for most users.



-Emile

From toby.corkindale at strategicdata.com.au  Fri Jun 10 01:33:54 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Fri, 10 Jun 2011 10:33:54 +1000
Subject: [rabbitmq-discuss] How many ports does RabbitMQ need open?
In-Reply-To: <4DF07C60.5050504@rabbitmq.com>
References: <4DEED7CF.9000101@strategicdata.com.au>	<88E590DC4586974D825FC82AE798294E5200C8C8@GSVCLU03.ges.ferlan.it>	<4DF01561.4000803@strategicdata.com.au>
	<4DF07C60.5050504@rabbitmq.com>
Message-ID: <4DF16672.7040802@strategicdata.com.au>

On 09/06/11 17:55, Simon MacMullen wrote:
> On 09/06/2011 1:35AM, Toby Corkindale wrote:
>> Ah, you're thinking of when it is clients connecting to the MQ.
>> I'm talking about clustering multiple RabbitMQ nodes.
>>
>> It definitely needs a few more - the erlang port mapper on 4369 for
>> starters - and then some more that erlang dynamically chooses. (Although
>> can be limited to a range with the parameters I mentioned below)
>>
>> I'm curious to know how many are really needed for those extras; if I
>> limit the range to just 5 ports, am I likely to hit troubles? How about
>> 100 ports?
>
> Hi Toby. In my mail I *was* talking about clustering - like I said,
> although it's not a configuration we test we've heard of people running
> with that range collapsed to one port and not running into problems.

Ah, thanks for clarifying that!
I'll see how things go here.

Cheers,
-Toby

From jasonjwwilliams at gmail.com  Fri Jun 10 02:15:58 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 9 Jun 2011 19:15:58 -0600
Subject: [rabbitmq-discuss] Management plugin throwing "cannot read
	property" errors
Message-ID: <BANLkTikktVL5wu4nP_zexf0DW28vGFijDw@mail.gmail.com>

Hi All,

On a new server running RMQ 2.4.1 with the management, I've noticed a
behavior where after about 30 minutes of runtime the WebUI for the
management plugin starts showing this error at the bottom of the page:

"TypeError: Cannot read property 'messages_ready' of undefined"

You can navigate the UI but the message counters are "?" in addition to the
error message. The _log, _err, and .log files show no errors. Any idea what
might be causing this? Thank you in advance.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110609/a713903f/attachment-0001.htm>

From jtm.moon.forum.user at gmail.com  Fri Jun 10 02:27:30 2011
From: jtm.moon.forum.user at gmail.com (J_Tom_Moon_79)
Date: Thu, 9 Jun 2011 18:27:30 -0700 (PDT)
Subject: [rabbitmq-discuss] build failure: `deps.mk',
	needed by `ebin/bpqueue.beam'
In-Reply-To: <4DF13E55.1080208@rabbitmq.com>
References: <8aaa2d14-57e2-4b38-8472-313b17d7b242@l2g2000prg.googlegroups.com>
	<4DF13E55.1080208@rabbitmq.com>
Message-ID: <6cd6d309-2a65-4294-828b-f02a03264b2c@e17g2000prj.googlegroups.com>

Thanks Emile.

For reference here are the commands that work.
My version of Sun OS (Solaris).
<code>
$ uname -a
SunOS eciddev21 5.10 Generic_141445-09 i86pc i386 i86pc
</code>

<code>
#!/usr/bin/env bash
# for Solaris machines using blastwave distribution you will want to
install lots of packages, including but not limited to
sudo pkgutil --install python-2.6.2,REV=2009.08.06
sudo pkgutil --install gpgme

# check versions (for good bug reports)
python --version
make --version
gcc --version

# create a work space
cd ${HOME}
mkdir rabbitmq-workspace
cd rabbitmq-workspace

# get erlang R12B-5
ERLANG_HOME=${HOME}/erlang-R12B-5
PATH="${ERLANG_HOME}:${ERLANG_HOME}/bin:${PATH}"
export PATH
wget 'http://www.erlang.org/download/otp_src_R12B-5.tar.gz'
gunzip -c otp_src_R12B-5.tar.gz | tar -xvf -
# compile erlang R12B-5
cd 'otp_src_R12B-5'
LANG=C
export LANG # Bourne shell
./configure --prefix="${ERLANG_HOME}"
make
make install
# check erlang installation
if [ "$(which erl)" != "${ERLANG_HOME}/bin/erl" ] ; then
	echo erlang did not install correctly
fi
erl -version

# get rabbitmq
wget 'http://www.rabbitmq.com/rabbitmq-signing-key-public.asc'
wget 'http://www.rabbitmq.com/releases/rabbitmq-server/v2.4.1/rabbitmq-
server-2.4.1.zip.asc'
wget 'http://www.rabbitmq.com/releases/rabbitmq-server/v2.4.1/rabbitmq-
server-2.4.1.zip'
gpg --verify rabbitmq-server-2.4.1.zip.asc rabbitmq-server-2.4.1.zip
unzip rabbitmq-server-2.4.1.zip
cd rabbitmq-server-2.4.1
# compile rabbitmq
make clean
make

# run rabbitmq
sudo /usr/xpg4/bin/sh ./scripts/rabbitmq-server
</code>

-J_Tom_Moon_79

From pdezwart at rubiconproject.com  Fri Jun 10 03:11:44 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Thu, 09 Jun 2011 19:11:44 -0700
Subject: [rabbitmq-discuss] FW: [PECL-DEV] [ANNOUNCEMENT] amqp-0.3.0 (beta)
	Released.
In-Reply-To: <20110610020754.24130.qmail@pb12.pair.com>
Message-ID: <CA16CB70.20166%pdezwart@rubiconproject.com>

Hey everyone,

Andy Wick and Jonathan Tansavatdi have done some work to improve the PHP
extension for AMQP compliant brokers. Please check it out and let us know
how it works for you!

Thanks,
Pieter

------ Forwarded Message
From: PECL Announce <pecl-dev at lists.php.net>
Date: 10 Jun 2011 02:07:54 -0000
To: PECL developers list <pecl-dev at lists.php.net>
Subject: [PECL-DEV] [ANNOUNCEMENT] amqp-0.3.0 (beta) Released.

The new PECL package amqp-0.3.0 (beta) has been released at
http://pecl.php.net/.

Release notes
-------------
0.3.0 Release:
Fixed memory leaks in many functions (courtesy Jonathan Tansavatdi and Andy
Wick)
Fixed consume method to return proper values
Cleaned up variable usage
Fixed bugs:
    * 22638: Unexpected exit code 1 with AMQPQueue::consume()
    * 22698: AMQPQueue::consume

0.2.2 Release:
Made extension compatible with PHP lt 5.3 (courtesy John Skopis)
Fixed wrong typing of message properties (courtesy John Skopis)

0.2.1 Release:
Fixed refcount decrementing bug causing segfaults.

0.2.0 Release:
Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
Modified AMQPConnection object:
    * Requires call to 'connect' method to connect (no longer connects on
instantiation)
    * Added support for disconnect and reconnect
    * Added helper setters for port, host, vhost, login and password
Improved consume method to block for MIN messages, and try to get MAX
messages if available
Fixed zval descoping bugs
Fixed bugs:
    * 17809: Couldn't compile pecl extension under PHP 5.3
    * 17831: Segmentation fault when the exchange doesn't exists
    * 19707: AMQPQueue::get() doesn't return the message
    * 19840: Connection Exception

Package Info
-------------
This extension can communicate with any AMQP spec 0-9-1 compatible server,
such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to create and
delete exchanges and queues, as well as publish to any exchange and consume
from any queue.

Related Links
-------------
Package home: http://pecl.php.net/package/amqp
   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
    Download: http://pecl.php.net/get/amqp-0.3.0.tgz

Authors
-------------
Pieter de Zwart (lead)


-- 
PECL development discussion Mailing List (http://pecl.php.net/)
To unsubscribe, visit: http://www.php.net/unsub.php


------ End of Forwarded Message


From simon at rabbitmq.com  Fri Jun 10 10:12:19 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 10 Jun 2011 10:12:19 +0100
Subject: [rabbitmq-discuss] Management plugin throwing "cannot
 read	property" errors
In-Reply-To: <BANLkTikktVL5wu4nP_zexf0DW28vGFijDw@mail.gmail.com>
References: <BANLkTikktVL5wu4nP_zexf0DW28vGFijDw@mail.gmail.com>
Message-ID: <4DF1DFF3.8050506@rabbitmq.com>

On 10/06/11 02:15, Jason J. W. Williams wrote:
> Hi All,
>
> On a new server running RMQ 2.4.1 with the management, I've noticed a
> behavior where after about 30 minutes of runtime the WebUI for the
> management plugin starts showing this error at the bottom of the page:
>
> "TypeError: Cannot read property 'messages_ready' of undefined"
>
> You can navigate the UI but the message counters are "?" in addition to
> the error message. The _log, _err, and .log files show no errors. Any
> idea what might be causing this? Thank you in advance.

Hi Jason. What you're seeing is consistent with the management 
statistics database going away.

I can see this happening in two ways - either you're running a cluster 
and the node hosting the db went down (one day we'll have failover for 
this, but not yet), or it crashed - but in that case I would expect the 
supervisor to restart it.

So - are you running a cluster? If not, can you send me the logs somehow?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From pierre-marie.padiou at morpho.com  Fri Jun 10 11:15:01 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Fri, 10 Jun 2011 12:15:01 +0200
Subject: [rabbitmq-discuss] publish/suscribe model with typed consumers
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>

Hello,

I am currently struggling with the following use case:
- I am using a publish/subscribe model
- I've got many subscribers and I only want one of them to process a publisher's message
- requests can be of many types (say A to Z), and each consumer knows how to deal with only a subset of them

For example :
- consumer 1 can process requests A to M
- consumer 2 can process requests N to Z
- consumer 3 can process requests F to Q

There is actually far more types than that (say a thousand). For now, the only solution I see would be to create as many queues as requests types (queueA, queueB, etc), and make consumer listen to the appropriate queues.

Thing is:
- this implies that consumers create as many threads as queues there are listening from (more than a hundred in my case), which I would like to avoid.
- or I could make a single thread of a consumer randomly and sequentially dequeue messages from all queues assigned to it?

Is there a better way to handle this?

Thanks in advance

Pierre-Marie


#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110610/844bee2d/attachment.htm>

From chrisch at ecollege.com  Fri Jun 10 11:53:52 2011
From: chrisch at ecollege.com (Chris Chew)
Date: Fri, 10 Jun 2011 10:53:52 +0000
Subject: [rabbitmq-discuss] publish/suscribe model with typed consumers
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>
Message-ID: <1C7E61787A08F34BBBBD9E7A7CBC368B0A32CD53@EXMB02OSG.eclg.org>

> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf > of PADIOU Pierre-Marie (MORPHO) [pierre-marie.padiou at morpho.com]
>
> <snip>
>  
> There is actually far more types than that (say a thousand). For now, the only solution I see would be to create as many queues as requests types (queueA, queueB, etc), and make consumer listen to the appropriate queues.
>  
> Thing is: 
> - this implies that consumers create as many threads as queues there are listening from (more than a hundred in my case), which I would like to avoid.
> - or I could make a single thread of a consumer randomly and sequentially dequeue messages from all queues assigned to it?
>  
> Is there a better way to handle this?

Here's an alternative solution that might work for you:

* Producers produce messages into a headers exchange, specifying the header "Type" = "A,B,C...Z"
* Consumers are grouped into "type groups" (e.g. group 1: A-M, group 2: N-Q, group 3: R-Z)
* The consumer idempotently declares a queue for its group and binds the queue for each of the message types handled by the group

...which should offer these features:

* Messages will be routed only to consumers that know how to handle that message type
* Consumers only have to consume from one queue
* Consumers can be load-balanced by group without having to process duplicates
* A message of a certain type could potentially be sent to multiple groups if applicable

Keep in mind that the Headers exchange is among the slowest options.  But, realistically, this is rarely a problem since it is rather like comparing Formula 1 cars.

Cheers,

Chris

From matthias at rabbitmq.com  Fri Jun 10 12:00:51 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 10 Jun 2011 12:00:51 +0100
Subject: [rabbitmq-discuss] publish/suscribe model with typed consumers
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>
Message-ID: <4DF1F963.7080603@rabbitmq.com>

Pierre-Marie,

On 10/06/11 11:15, PADIOU Pierre-Marie (MORPHO) wrote:
> For now, the only solution I see would be to create as many queues as requests
> types (queueA, queueB, etc), and make consumer listen to the appropriate
> queues.
>
> Thing is:
>
> - this implies that consumers create as many threads as queues there are
> listening from (more than a hundred in my case), which I would like to
> avoid.

Which client are you using? Java? If so, a single consumer thread can 
happily consume from multiple queues. E.g. you can pass a single 
QueuingConsumer instance to multiple ch.basicConsume(...) invocations.


Regards,

Matthias.

From emile at rabbitmq.com  Fri Jun 10 13:14:18 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 10 Jun 2011 13:14:18 +0100
Subject: [rabbitmq-discuss] Connection Closing when used by more that
 one	exchange
In-Reply-To: <5EFADC7B94CAF64BAB113AD9DE1ACD200A3E7261@srv-opus-02.opus.net>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A3E7261@srv-opus-02.opus.net>
Message-ID: <4DF20A9A.1020007@rabbitmq.com>

Hi Marcus,

On 07/06/11 18:12, Marcus Vinitius Baffa wrote:

> As you can see the sendReply opens another connection and channel to
> send the reply back to the consumer. I know I can use the RPC pattern
> but I need to send a message back like this.

You code does execute, but the peak performance achievable will be
limited, because you are establishing a new channel for each reply.

> When I try to define one connection that would be used by the
> receiveMessageAmqp and the sendReply it stops working.

This works fine for me when I modify your example to use the same
connection for both receiver and sender.

> What happens is that the first message received everything works ok, the
> message is received and the reply is sent. When another message is sent
> by the producer the consumer receives the message and the line
> channel.BasicAck( basicDeliveryEventArgs.DeliveryTag, false ); is
> executed an exception is thrown:

Are you perhaps acknowledging the same message twice? Does the broker
logfile contain anything useful around the time this happens?

> base {RabbitMQ.Client.Exceptions.OperationInterruptedException} = {"The
> AMQP operation was interrupted: AMQP close-reason, initiated by
> Application, code=200, text=\"Connection close forced\", classId=0,
> methodId=0, cause="}

"initiated by Application" normally means a shutdown initiated by the
application using the library, but I'm not sure I believe it in this
case. Your code traps and ignores exceptions in many places - are you
sure the real reason is masked in that way?


-Emile

From christopher.rhodes at cloudkick.com  Fri Jun 10 14:54:26 2011
From: christopher.rhodes at cloudkick.com (Christopher Rhodes)
Date: Fri, 10 Jun 2011 08:54:26 -0500
Subject: [rabbitmq-discuss] message via stomp adapter crashes queue
Message-ID: <BANLkTikYr_getudAfmNJdFRBz7dXvdxLng@mail.gmail.com>

Hello!

We're using v2.1.0 on Ubuntu 9.10 with the same versions of the stomp and
amqp adapter and stuck there because some issues our code has with a rewrite
of the stomp adapter that occurred some time soon after 2.1.0.

I'm pretty certain we're bumping into the bug reported here:
http://goo.gl/V4ww2

Last message from that thread:

"I have raised a bug for this problem.

As reported here Matthew feels that the *stomp* client is generating the
wrong form for the payload of a message, and the code verifies this
observation.

On Wed, Feb 02, 2011 at 11:48:19PM +0000, Matthew Sackman wrote:
> Ok, so the message payload is being sent through as a list instead of as
> a binary. My guess without checking further is this is a bug in the
> *stomp* client in the way it constructs the messages which are then sent
> further into *Rabbit*, but this may not be the case.

The fix is to send it flattened, of course.

To validate this fix a small testcase is being constructed.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-disc...<http://groups.google.com/groups/unlock?_done=/group/rabbitmq-discuss/browse_thread/thread/796e1f0c7ba0551c/fa0f29e51b43d70f%3Flnk%3Dgst%26q%3Drabbit%2Bstomp%2Bcrash&msg=e292a5436aa24076>
@lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss<http://www.google.com/url?sa=D&q=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>


"


Any chance of a backport of the fix, please or workaround I might be able to
get in place?   :)

Thanks!

crr

Christopher.Rhodes at cloudkick.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110610/788e76c3/attachment.htm>

From harvey.robin at gmail.com  Fri Jun 10 15:09:08 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Fri, 10 Jun 2011 15:09:08 +0100
Subject: [rabbitmq-discuss] Amqphp Version 0.9
Message-ID: <BANLkTi=6pGtkac3B3kfQ4pdPjLFx5ai4CQ@mail.gmail.com>

Hello,

Just a quick note from me to say that I've released a 0.9 version of my Amqp
PHP 5.3 library.  Here's a quick breakdown of changes in recent versions:


1.  Support for lightwight publish confirms (
http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/)
2.  Support for multiple broker connections.  A single consumer can consume
from 2 or more brokers at the same time
3.  A new build system, based on Phing (like Ant for PHP) which takes care
of code generation
4.  Build system outputs to different package varieties to help integrate in
to either a web server or script based environment
5.  Documentation: https://github.com/BraveSirRobin/amqphp/wiki
6.  Support for RabbitMQ Capabilities:
http://www.rabbitmq.com/extensions.html#capabilities


Unless you want to help develop the library I suggest you download the
tagged 0.9 tarball, this includes all of the generated code so you don't
have to install Phing and do it yourself.


Thanks,
--Robin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110610/88c033db/attachment.htm>

From joseph.a.marlin at gmail.com  Fri Jun 10 16:21:58 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Fri, 10 Jun 2011 08:21:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Redudancy solutions
Message-ID: <f42f1b61-0099-4ab6-bf38-1731df3de704@fr19g2000vbb.googlegroups.com>

Greetings!

I'm looking for some insight on different ways of achieving a HA
RabbitMQ setup without using DRBD. Because of our current setup, doing
that kind of configuration would be very difficult to achieve.

I'd really like to get a setup where if one machine goes down, another
machine can immediately take over, retaining the exact state of
RabbitMQ on the failed machine when it went down.

My latest attempt at a redudant solution was two completely separate,
identical, RabbitMQ setups. A publisher pushed messages to the queues
of each independent node at the same time. I also had a Cassandra
cluster node installed on each node. Before a consumer would handle a
message, it would check in with the Cassandra database to ensure that
it had not already been handled. This worked fine at extremely slow
speeds, but at anything above 50 messages/sec, there were simply way
too many double-handled messages, which are not acceptable.

Is there an alternative to HA that doesn't involve DRBD/Pacemaker/etc?

From jasonjwwilliams at gmail.com  Fri Jun 10 18:22:42 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 10 Jun 2011 11:22:42 -0600
Subject: [rabbitmq-discuss] Management plugin throwing "cannot read
 property" errors
In-Reply-To: <4DF1DFF3.8050506@rabbitmq.com>
References: <BANLkTikktVL5wu4nP_zexf0DW28vGFijDw@mail.gmail.com>
	<4DF1DFF3.8050506@rabbitmq.com>
Message-ID: <BANLkTimfmMeCstaButW2Ligm-k6f1XayBA@mail.gmail.com>

Hey Simon,

Actually, I found an error message in rabbit.log that seems related to
that: https://gist.github.com/1019290

Any ideas? It appears to happen some period of time after several
vhost/user/permission creations via the REST API.

-J

On Fri, Jun 10, 2011 at 3:12 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 10/06/11 02:15, Jason J. W. Williams wrote:
>
>> Hi All,
>>
>> On a new server running RMQ 2.4.1 with the management, I've noticed a
>> behavior where after about 30 minutes of runtime the WebUI for the
>> management plugin starts showing this error at the bottom of the page:
>>
>> "TypeError: Cannot read property 'messages_ready' of undefined"
>>
>> You can navigate the UI but the message counters are "?" in addition to
>> the error message. The _log, _err, and .log files show no errors. Any
>> idea what might be causing this? Thank you in advance.
>>
>
> Hi Jason. What you're seeing is consistent with the management statistics
> database going away.
>
> I can see this happening in two ways - either you're running a cluster and
> the node hosting the db went down (one day we'll have failover for this, but
> not yet), or it crashed - but in that case I would expect the supervisor to
> restart it.
>
> So - are you running a cluster? If not, can you send me the logs somehow?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110610/700938ec/attachment-0001.htm>

From matthias at rabbitmq.com  Fri Jun 10 18:30:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 10 Jun 2011 18:30:01 +0100
Subject: [rabbitmq-discuss] Management plugin throwing "cannot read
 property" errors
In-Reply-To: <BANLkTimfmMeCstaButW2Ligm-k6f1XayBA@mail.gmail.com>
References: <BANLkTikktVL5wu4nP_zexf0DW28vGFijDw@mail.gmail.com>	<4DF1DFF3.8050506@rabbitmq.com>
	<BANLkTimfmMeCstaButW2Ligm-k6f1XayBA@mail.gmail.com>
Message-ID: <4DF25499.7080504@rabbitmq.com>

Jason,

On 10/06/11 18:22, Jason J. W. Williams wrote:
> Actually, I found an error message in rabbit.log that seems related to
> that: https://gist.github.com/1019290

That seems unrelated and looks like an Erlang version issue. What 
version are you running?

Matthias.

From jasonjwwilliams at gmail.com  Fri Jun 10 18:56:35 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 10 Jun 2011 11:56:35 -0600
Subject: [rabbitmq-discuss] Management plugin throwing "cannot read
 property" errors
In-Reply-To: <4DF25499.7080504@rabbitmq.com>
References: <BANLkTikktVL5wu4nP_zexf0DW28vGFijDw@mail.gmail.com>
	<4DF1DFF3.8050506@rabbitmq.com>
	<BANLkTimfmMeCstaButW2Ligm-k6f1XayBA@mail.gmail.com>
	<4DF25499.7080504@rabbitmq.com>
Message-ID: <BANLkTikzER57ebU4CcEM_a1fzkqY8A5NNA@mail.gmail.com>


From d.young at cabinfeversoftware.com  Fri Jun 10 19:03:48 2011
From: d.young at cabinfeversoftware.com (David Young)
Date: Fri, 10 Jun 2011 13:03:48 -0500
Subject: [rabbitmq-discuss] publish/suscribe model with typed consumers
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>
Message-ID: <BANLkTinp1OdHSZa4Mfjtx4+Q74iOPBA85g@mail.gmail.com>

FWIW, my "solution" (pretty basic) to the same problem is to have one
exchange/queue combo per type of message (or job). IOW I use the same queue
for all subscribers to any exchange.

Each consumer ("agent" in me-speak) subscribes to the queues it knows how to
handle, assuming I want it to...I can set up workers anywhere, but some
tasks are best handled in certain places, due to network or hardware issues.

RabbitMQ (at least with v1.7.2...I dunno about others.) does a really neat
round-robin distribution of messages when multiple consumers subscribe to
the same queue. Workers "ack" each message only when they're finished doing
the work (yes, that can create network timeout issues), so there's
near-perfect load-balancing built in. Any time I need to pass more info than
I want to try to push through RabbitMQ, I store it in S3 and pass the
filename.

HTH, but actually I hope someone else has a better idea...

-David

On Fri, Jun 10, 2011 at 5:15 AM, PADIOU Pierre-Marie (MORPHO) <
pierre-marie.padiou at morpho.com> wrote:

>  Hello,
>
>
>
> I am currently struggling with the following use case:
>
> - I am using a publish/subscribe model
>
> - I?ve got many subscribers and I only want one of them to process a
> publisher?s message
>
> - requests can be of many types (say A to Z), and each consumer knows how
> to deal with only a subset of them
>
>
>
> For example :
>
> - consumer 1 can process requests A to M
>
> - consumer 2 can process requests N to Z
>
> - consumer 3 can process requests F to Q
>
>
>
> There is actually far more types than that (say a thousand). For now, the
> only solution I see would be to create as many queues as requests types
> (queueA, queueB, etc), and make consumer listen to the appropriate queues.
>
>
>
> Thing is:
>
> - this implies that consumers create as many threads as queues there are
> listening from (more than a hundred in my case), which I would like to
> avoid.
>
> - or I could make a single thread of a consumer randomly and sequentially
> dequeue messages from all queues assigned to it?
>
>
>
> Is there a better way to handle this?
>
>
> Thanks in advance
>
>
>
> Pierre-Marie
>
>
>
>
>
> #
> " Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
> ******
> " This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
> #
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110610/fbaeec65/attachment.htm>

From matthias at rabbitmq.com  Fri Jun 10 19:03:47 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 10 Jun 2011 19:03:47 +0100
Subject: [rabbitmq-discuss] Management plugin throwing "cannot read
 property" errors
In-Reply-To: <BANLkTikzER57ebU4CcEM_a1fzkqY8A5NNA@mail.gmail.com>
References: <BANLkTikktVL5wu4nP_zexf0DW28vGFijDw@mail.gmail.com>	<4DF1DFF3.8050506@rabbitmq.com>	<BANLkTimfmMeCstaButW2Ligm-k6f1XayBA@mail.gmail.com>	<4DF25499.7080504@rabbitmq.com>
	<BANLkTikzER57ebU4CcEM_a1fzkqY8A5NNA@mail.gmail.com>
Message-ID: <4DF25C83.3030808@rabbitmq.com>

On 10/06/11 18:56, Jason J. W. Williams wrote:
>  From the "Generic server rabbit_mgmt_db terminating" message I assumed
> that was related to Simon's mention that the behavior I saw is caused
> by the management plugin database terminating....

Right, except rabbit_mgmt_db terminated because it couldn't load the 
xmerl_ucs module.

> We're running Erlang R13B03 on this box.

Hmm. xmerl_ucs should definitely be in that. In fact it looks like it's 
been around for a long time. Could you please check whether you have a 
xmerl_ucs.beam file around and whether starting an erlang shell and 
evaluating
   xmerl_ucs:from_utf8(<<"foo">>).
works ok?

Regards,

Matthias.

From d.young at cabinfeversoftware.com  Fri Jun 10 19:07:57 2011
From: d.young at cabinfeversoftware.com (David Young)
Date: Fri, 10 Jun 2011 13:07:57 -0500
Subject: [rabbitmq-discuss] publish/suscribe model with typed consumers
In-Reply-To: <4DF1F963.7080603@rabbitmq.com>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>
	<4DF1F963.7080603@rabbitmq.com>
Message-ID: <BANLkTim9to+B6KAB2q4dRz1iTcMzwbPkag@mail.gmail.com>

The AMQP gem in ruby can also subscribe to multiple queues using a single
thread.

On Fri, Jun 10, 2011 at 6:00 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Pierre-Marie,
>
>
> On 10/06/11 11:15, PADIOU Pierre-Marie (MORPHO) wrote:
>
>> For now, the only solution I see would be to create as many queues as
>> requests
>> types (queueA, queueB, etc), and make consumer listen to the appropriate
>> queues.
>>
>> Thing is:
>>
>> - this implies that consumers create as many threads as queues there are
>> listening from (more than a hundred in my case), which I would like to
>> avoid.
>>
>
> Which client are you using? Java? If so, a single consumer thread can
> happily consume from multiple queues. E.g. you can pass a single
> QueuingConsumer instance to multiple ch.basicConsume(...) invocations.
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110610/47b0a174/attachment.htm>

From jasonjwwilliams at gmail.com  Fri Jun 10 19:14:30 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 10 Jun 2011 12:14:30 -0600
Subject: [rabbitmq-discuss] Management plugin throwing "cannot read
 property" errors
In-Reply-To: <4DF25C83.3030808@rabbitmq.com>
References: <BANLkTikktVL5wu4nP_zexf0DW28vGFijDw@mail.gmail.com>
	<4DF1DFF3.8050506@rabbitmq.com>
	<BANLkTimfmMeCstaButW2Ligm-k6f1XayBA@mail.gmail.com>
	<4DF25499.7080504@rabbitmq.com>
	<BANLkTikzER57ebU4CcEM_a1fzkqY8A5NNA@mail.gmail.com>
	<4DF25C83.3030808@rabbitmq.com>
Message-ID: <BANLkTi=05kiOCQqZ_ze5AjoCskeTeMh6Sg@mail.gmail.com>

> Hmm. xmerl_ucs should definitely be in that. In fact it looks like it's been
> around for a long time. Could you please check whether you have a
> xmerl_ucs.beam file around and whether starting an erlang shell and
> evaluating
> ?xmerl_ucs:from_utf8(<<"foo">>).
> works ok?

Looks like it's missing: https://gist.github.com/1019395

Thank you for your help BTW.

-J

From d.young at cabinfeversoftware.com  Fri Jun 10 19:14:50 2011
From: d.young at cabinfeversoftware.com (David Young)
Date: Fri, 10 Jun 2011 13:14:50 -0500
Subject: [rabbitmq-discuss] publish/suscribe model with typed consumers
In-Reply-To: <1C7E61787A08F34BBBBD9E7A7CBC368B0A32CD53@EXMB02OSG.eclg.org>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>
	<1C7E61787A08F34BBBBD9E7A7CBC368B0A32CD53@EXMB02OSG.eclg.org>
Message-ID: <BANLkTik+Ain0V=zK-DPmr8Bwxg9AAtXocg@mail.gmail.com>

If I understand this correctly, either some messages might end up in more
than one queue if groups compete for the header types, or there would be no
way to divide consumers such that consumer A handles group 1 messages, B
handles group 2, but C handles some of group 1 and some of group 2.

'Course I don't always understand correctly  {8'>

On Fri, Jun 10, 2011 at 5:53 AM, Chris Chew <chrisch at ecollege.com> wrote:

> > From: rabbitmq-discuss-bounces at lists.rabbitmq.com [
> rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf > of PADIOU
> Pierre-Marie (MORPHO) [pierre-marie.padiou at morpho.com]
> >
> > <snip>
> >
> > There is actually far more types than that (say a thousand). For now, the
> only solution I see would be to create as many queues as requests types
> (queueA, queueB, etc), and make consumer listen to the appropriate queues.
> >
> > Thing is:
> > - this implies that consumers create as many threads as queues there are
> listening from (more than a hundred in my case), which I would like to
> avoid.
> > - or I could make a single thread of a consumer randomly and sequentially
> dequeue messages from all queues assigned to it?
> >
> > Is there a better way to handle this?
>
> Here's an alternative solution that might work for you:
>
> * Producers produce messages into a headers exchange, specifying the header
> "Type" = "A,B,C...Z"
> * Consumers are grouped into "type groups" (e.g. group 1: A-M, group 2:
> N-Q, group 3: R-Z)
> * The consumer idempotently declares a queue for its group and binds the
> queue for each of the message types handled by the group
>
> ...which should offer these features:
>
> * Messages will be routed only to consumers that know how to handle that
> message type
> * Consumers only have to consume from one queue
> * Consumers can be load-balanced by group without having to process
> duplicates
> * A message of a certain type could potentially be sent to multiple groups
> if applicable
>
> Keep in mind that the Headers exchange is among the slowest options.  But,
> realistically, this is rarely a problem since it is rather like comparing
> Formula 1 cars.
>
> Cheers,
>
> Chris
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110610/b50529bd/attachment.htm>

From simon at rabbitmq.com  Fri Jun 10 19:15:59 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 10 Jun 2011 19:15:59 +0100
Subject: [rabbitmq-discuss] Management plugin throwing "cannot read
 property" errors
In-Reply-To: <4DF25C83.3030808@rabbitmq.com>
References: <BANLkTikktVL5wu4nP_zexf0DW28vGFijDw@mail.gmail.com>	<4DF1DFF3.8050506@rabbitmq.com>	<BANLkTimfmMeCstaButW2Ligm-k6f1XayBA@mail.gmail.com>	<4DF25499.7080504@rabbitmq.com>
	<BANLkTikzER57ebU4CcEM_a1fzkqY8A5NNA@mail.gmail.com>
	<4DF25C83.3030808@rabbitmq.com>
Message-ID: <4DF25F5F.7080004@rabbitmq.com>

On 10/06/2011 7:03PM, Matthias Radestock wrote:
> On 10/06/11 18:56, Jason J. W. Williams wrote:
>> From the "Generic server rabbit_mgmt_db terminating" message I assumed
>> that was related to Simon's mention that the behavior I saw is caused
>> by the management plugin database terminating....
>
> Right, except rabbit_mgmt_db terminated because it couldn't load the
> xmerl_ucs module.
>
>> We're running Erlang R13B03 on this box.
>
> Hmm. xmerl_ucs should definitely be in that.

xmerl is sometimes packaged separately (Debian, Ubuntu).

Mind you, I thought we sorted that out on 2.4.1, we changed the deb 
packaging to pull in all of Erlang in case plugins needed bits the 
server didn't.

Jason, which OS is this? How is Erlang installed? Is there an 
erlang-xmerl package you could install?

Cheers, Simon

From jasonjwwilliams at gmail.com  Fri Jun 10 19:30:44 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 10 Jun 2011 12:30:44 -0600
Subject: [rabbitmq-discuss] Management plugin throwing "cannot read
 property" errors
In-Reply-To: <4DF25F5F.7080004@rabbitmq.com>
References: <BANLkTikktVL5wu4nP_zexf0DW28vGFijDw@mail.gmail.com>
	<4DF1DFF3.8050506@rabbitmq.com>
	<BANLkTimfmMeCstaButW2Ligm-k6f1XayBA@mail.gmail.com>
	<4DF25499.7080504@rabbitmq.com>
	<BANLkTikzER57ebU4CcEM_a1fzkqY8A5NNA@mail.gmail.com>
	<4DF25C83.3030808@rabbitmq.com> <4DF25F5F.7080004@rabbitmq.com>
Message-ID: <BANLkTinqqb2HXGAC3VvvxuaM6g0k4kSYmA@mail.gmail.com>

> xmerl is sometimes packaged separately (Debian, Ubuntu).

That was the problem. Installing erlang-xmerl seems to have fixed it.

> Jason, which OS is this? How is Erlang installed? Is there an erlang-xmerl
> package you could install?

RMQ is installed from tarball, and Erlang was installed from debs
(erlang-base erlang-crypto erlang-mnesia erlang-os-mon
erlang-public-key erlang-runtime-tools erlang-snmp erlang-ssl
erlang-syntax-tools erlang-inets erlang-xmerl libsctp1 lksctp-tools).
We've added erlang-xmerl to that list now. Thank you for your help. I
really appreciate it.

-J

From kuleshovmail at gmail.com  Sun Jun 12 07:40:47 2011
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Sun, 12 Jun 2011 06:40:47 +0000
Subject: [rabbitmq-discuss] Compile rabbitmq-erlang-client
Message-ID: <BANLkTi=Q6Usb1HROn8p-B1EbQ+POeKP+-Q@mail.gmail.com>

Hello,

I try to build from source rabbitmq-erlang-client package. But get error:

make
rm -f deps.mk
echo src/amqp_auth_mechanisms.erl:src/amqp_channel.erl:src/amqp_channels_manager.erl:src/amqp_channel_sup.erl:src/amqp_channel_sup_sup.erl:src/amqp_client.erl:src/amqp_connection.erl:src/amqp_connection_sup.erl:src/amqp_connection_type_sup.erl:src/amqp_direct_connection.erl:src/amqp_gen_connection.erl:src/amqp_main_reader.erl:src/amqp_network_connection.erl:src/amqp_rpc_client.erl:src/amqp_rpc_server.erl:src/amqp_sup.erl:include/amqp_client.hrl:
| escript ../rabbitmq-server/generate_deps deps.mk ebin
escript  ../rabbitmq-server/generate_app rabbit_common.app.in
rabbit_common.app src
escript: exception error: {function_clause,
                     [{local,main,
                          [["rabbit_common.app.in","rabbit_common.app",
                            "src"]]}]}
  in function  escript:code_handler/4
  in call from erl_eval:local_func/5
  in call from escript:interpret/4
  in call from escript:start/1
  in call from init:start_it/1
  in call from init:start_em/1
make: *** [rabbit_common.app] Error 127

How can i fix it?

Thank you.

From videlalvaro at gmail.com  Sun Jun 12 07:54:49 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 12 Jun 2011 07:54:49 +0100
Subject: [rabbitmq-discuss] Compile rabbitmq-erlang-client
In-Reply-To: <BANLkTi=Q6Usb1HROn8p-B1EbQ+POeKP+-Q@mail.gmail.com>
References: <BANLkTi=Q6Usb1HROn8p-B1EbQ+POeKP+-Q@mail.gmail.com>
Message-ID: <C79C06E1-BBB2-42D8-8D45-66F7DBC0C7DC@gmail.com>

The easiest way to compile it is by downloading the rabbitmq-public-umbrella. I think your error is due to not fulfilling some dependencies, probably the rabbitmq-server ones, or the rabbitmq-codegen.

$ hg co http://hg.rabbitmq.com/rabbitmq-public-umbrella/
$ cd rabbitmq-public-umbrella
$ make co #this will take a while
$ cd rabbitmq-erlang-client
$ make

Then you should get something like:

$ ls dist
amqp_client-0.0.0/      amqp_client-0.0.0.ez    rabbit_common-0.0.0/    rabbit_common-0.0.0.ez

Use those files as dependencies of your project. For example I decompress them inside the deps folder of my app, so I get something like:

$ ls deps/
amqp_client/             rabbit_common/     

Then I use the following include in my_app.hrl:

-include_lib("amqp_client/include/amqp_client.hrl").

And finally I have a rebar.config file like this:

{erl_opts, [debug_info, fail_on_warning,
  {i, "include"},
  {i, "deps"}
]}.

Hope this helps.

-Alvaro


On Jun 12, 2011, at 7:40 AM, Alexander Kuleshov wrote:

> Hello,
> 
> I try to build from source rabbitmq-erlang-client package. But get error:
> 
> make
> rm -f deps.mk
> echo src/amqp_auth_mechanisms.erl:src/amqp_channel.erl:src/amqp_channels_manager.erl:src/amqp_channel_sup.erl:src/amqp_channel_sup_sup.erl:src/amqp_client.erl:src/amqp_connection.erl:src/amqp_connection_sup.erl:src/amqp_connection_type_sup.erl:src/amqp_direct_connection.erl:src/amqp_gen_connection.erl:src/amqp_main_reader.erl:src/amqp_network_connection.erl:src/amqp_rpc_client.erl:src/amqp_rpc_server.erl:src/amqp_sup.erl:include/amqp_client.hrl:
> | escript ../rabbitmq-server/generate_deps deps.mk ebin
> escript  ../rabbitmq-server/generate_app rabbit_common.app.in
> rabbit_common.app src
> escript: exception error: {function_clause,
>                     [{local,main,
>                          [["rabbit_common.app.in","rabbit_common.app",
>                            "src"]]}]}
>  in function  escript:code_handler/4
>  in call from erl_eval:local_func/5
>  in call from escript:interpret/4
>  in call from escript:start/1
>  in call from init:start_it/1
>  in call from init:start_em/1
> make: *** [rabbit_common.app] Error 127
> 
> How can i fix it?
> 
> Thank you.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From matthew at rabbitmq.com  Sun Jun 12 09:14:05 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 12 Jun 2011 09:14:05 +0100
Subject: [rabbitmq-discuss] Compile rabbitmq-erlang-client
In-Reply-To: <C79C06E1-BBB2-42D8-8D45-66F7DBC0C7DC@gmail.com>
References: <BANLkTi=Q6Usb1HROn8p-B1EbQ+POeKP+-Q@mail.gmail.com>
	<C79C06E1-BBB2-42D8-8D45-66F7DBC0C7DC@gmail.com>
Message-ID: <20110612081405.GA2676@rabbitmq.com>

On Sun, Jun 12, 2011 at 07:54:49AM +0100, Alvaro Videla wrote:
> Use those files as dependencies of your project. For example I
> decompress them inside the deps folder of my app...

> -include_lib("amqp_client/include/amqp_client.hrl").

Note that if you're using a recent Erlang, you should be able to do the
-include_lib without having to unzip the .ezs first.

Matthew

From stammailbox at gmail.com  Sun Jun 12 14:06:23 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Sun, 12 Jun 2011 16:06:23 +0300
Subject: [rabbitmq-discuss] consumer.nextDelivery() does not return with
	a value
In-Reply-To: <11293887.1386.1307622429509.JavaMail.geo-discussion-forums@vbbhi2>
References: <BANLkTinD9ke0igfCqMjOxRCA_81Oa_4GBA@mail.gmail.com>
	<11293887.1386.1307622429509.JavaMail.geo-discussion-forums@vbbhi2>
Message-ID: <BANLkTimnsj6foMfAbvbzkmxK2Ue6K2zA5w@mail.gmail.com>

one client is only sending data. So it doesnt bind queues. sends a message
with routing key.
The other client receives data - so it binds a queue to a routing key.
Isnt that right?

On Thu, Jun 9, 2011 at 3:27 PM, Joseph Marlin <joseph.a.marlin at gmail.com>wrote:

> If the other client is not binding to the queue, then how does it know
> where to get deliveries from? (Perhaps I am misunderstanding how you have
> your clients configured...)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110612/020c1d8b/attachment.htm>

From Simone.Busoli at ferrari.com  Mon Jun 13 09:00:45 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Mon, 13 Jun 2011 08:00:45 +0000
Subject: [rabbitmq-discuss] Configuration documentation
Message-ID: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>

Hello,

I realize this has been asked in the past but I think reference documentation for the configuration file is needed and would be a big selling point for RabbitMQ. Currently there doesn't seem to be any place where to find even unofficial guidance.
Are there any plans to add that to the official documentation?

Thanks

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110613/6ada3534/attachment.htm>

From videlalvaro at gmail.com  Mon Jun 13 09:03:28 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 13 Jun 2011 09:03:28 +0100
Subject: [rabbitmq-discuss] Configuration documentation
In-Reply-To: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
Message-ID: <0F138A8D-4FA6-4BA7-B792-15209C9D3EAE@gmail.com>

Do you mean something like this: http://www.rabbitmq.com/configure.html ?

On Jun 13, 2011, at 9:00 AM, Busoli, Simone wrote:

> Hello,
>  
> I realize this has been asked in the past but I think reference documentation for the configuration file is needed and would be a big selling point for RabbitMQ. Currently there doesn?t seem to be any place where to find even unofficial guidance.
> Are there any plans to add that to the official documentation?
>  
> Thanks
> _________________________________________________________________________________________________________________
> Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
> o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
> per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
> immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
> _________________________________________________________________________________________________________________
> This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
> disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
> message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
> prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
> your system.
> _________________________________________________________________________________________________________________
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110613/21c35a01/attachment.htm>

From Simone.Busoli at ferrari.com  Mon Jun 13 10:17:53 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Mon, 13 Jun 2011 09:17:53 +0000
Subject: [rabbitmq-discuss] Configuration documentation
In-Reply-To: <0F138A8D-4FA6-4BA7-B792-15209C9D3EAE@gmail.com>
References: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
	<0F138A8D-4FA6-4BA7-B792-15209C9D3EAE@gmail.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5200DF63@GSVCLU03.ges.ferlan.it>

Yes, but unfortunately it's missing what the configuration file may contain, and only shows an empty configuration for rabbit:

[
    {mnesia, [{dump_log_write_threshold, 1000}]},
    {rabbit, []}
].

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110613/cbd8cbb7/attachment-0001.htm>

From simon at rabbitmq.com  Mon Jun 13 10:46:08 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 13 Jun 2011 10:46:08 +0100
Subject: [rabbitmq-discuss] Configuration documentation
In-Reply-To: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
Message-ID: <4DF5DC60.2000209@rabbitmq.com>

On 13/06/11 09:00, Busoli, Simone wrote:
> Are there any plans to add that to the official documentation?

Yeah, this is a bit awkward.

I'll see what I can do.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From Simone.Busoli at ferrari.com  Mon Jun 13 10:56:29 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Mon, 13 Jun 2011 09:56:29 +0000
Subject: [rabbitmq-discuss] Configuration documentation
In-Reply-To: <4DF5DC60.2000209@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
	<4DF5DC60.2000209@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5200DFD4@GSVCLU03.ges.ferlan.it>

Thank you Simon, I am aware of the open source nature of the project therefore any efforts on this side are greatly appreciated. I would be glad to contribute to that myself but unluckily I don't know RabbitMQ well enough to be able to do it. 

Nonetheless, on this topic I would like to remind that most of my experiments with RabbitMQ (and 0mq) using the .NET API are open sourced here to anyone who may find them useful http://mexexp.googlecode.com
It includes a rewriting of the 6 tutorials,  a .NET client for consuming the REST API exposed by the management plugin, and a wrapper for the rabbitmqctl utility useful to automate tests, among others.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: Monday, June 13, 2011 11:46 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Configuration documentation

On 13/06/11 09:00, Busoli, Simone wrote:
> Are there any plans to add that to the official documentation?

Yeah, this is a bit awkward.

I'll see what I can do.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From michael.s.klishin at gmail.com  Mon Jun 13 12:03:18 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 13 Jun 2011 15:03:18 +0400
Subject: [rabbitmq-discuss] Configuration documentation
In-Reply-To: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
References: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
Message-ID: <26C3C628B4834B79943ADD7501DB5510@gmail.com>

Busoli, Simone escribi?:
> I realize this has been asked in the past but I think reference documentation for the configuration file is needed and would be a big selling point for RabbitMQ. Currently there doesn?t seem to be any place where to find even unofficial guidance.
> Are there any plans to add that to the official documentation?
I have to add that configuration documentation page right now references OTP documentation page. No matter how good OTP documentation is, that's not enough:

* It doesn't explain what configuration parameters RabbitMQ recognizes
* It doesn't provide any examples (OTP documentation is heavily skewed towards experienced engineers, in my opinion)

I hear questions like "how do I configure hostname" and similar ones over and over. I think it is very worth to document things like this well (or make them easy to find if they are
already documented).

I don't know how feasible is the idea of putting documentation that is up on rabbitmq.com into Hg repositories or on github, but at times I felt like "man, I wish I could just clone that
and send a pull request/patch".
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin








From joseph.a.marlin at gmail.com  Mon Jun 13 13:30:49 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Mon, 13 Jun 2011 05:30:49 -0700 (PDT)
Subject: [rabbitmq-discuss] consumer.nextDelivery() does not return with
	a value
In-Reply-To: <BANLkTimnsj6foMfAbvbzkmxK2Ue6K2zA5w@mail.gmail.com>
References: <BANLkTinD9ke0igfCqMjOxRCA_81Oa_4GBA@mail.gmail.com>
	<11293887.1386.1307622429509.JavaMail.geo-discussion-forums@vbbhi2>
	<BANLkTimnsj6foMfAbvbzkmxK2Ue6K2zA5w@mail.gmail.com>
Message-ID: <c192403b-380c-4934-98a2-a356693ba6d6@l6g2000vbn.googlegroups.com>

That is correct; however, that is not what you said you were doing in
your first message:

"One does queuedeclare() and queue bind()
and then the other should  iterates with consumer.nextDelivery()"

From pdezwart at rubiconproject.com  Mon Jun 13 17:34:11 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 13 Jun 2011 09:34:11 -0700
Subject: [rabbitmq-discuss] RabbitMQ-C client and SSL support
Message-ID: <CA1B8A13.207D1%pdezwart@rubiconproject.com>

Hey everyone,

Last February, David Wragg mentioned that the RabbitMQ C client library was
build in such a way that adding things like SSL would be difficult. Are
there any updates regarding the library since then with regard to this
topic? I have a few people that really want to be able to use SSL from PHP,
but there is little I can do if the C client does not support it (I have no
interest in reinventing the wheel and building the rabbitmq-c functionality
into our codebase...)

Thanks!
Pieter 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110613/e42c1292/attachment.htm>

From matthew at rabbitmq.com  Mon Jun 13 17:36:47 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 13 Jun 2011 17:36:47 +0100
Subject: [rabbitmq-discuss] Bug or feature? Erlang client
In-Reply-To: <172321307635353@web50.yandex.ru>
References: <172321307635353@web50.yandex.ru>
Message-ID: <20110613163646.GC3553@rabbitmq.com>

On Thu, Jun 09, 2011 at 08:02:32PM +0400, Groshev Dmitry wrote:
> I have a node running rabbit. I'm trying to connect to a rabbit with
> "direct" method from another node (with same cookie, of course), but
> amqp_connect fails with broker_not_found_in_vm. I'm pinging manually
> rabbit's host during init and I can see rabbit at rabbithost in nodes(),
> but driver doesn't work. "network" method works fine. What am I doing
> wrong?

Hmm. amqp_connect isn't a function. You should be doing something like:

Conn = amqp_connection:start(#amqp_params_direct{ node = RemoteNode }),

The "broker_not_found_in_vm" is more interesting though as it suggests
that the connection is being made, but then rabbit isn't finding the
broker running, which is doubly odd if it then works via the network.

Are your versions of the erlang client and the server mismatched? If you
do, from the client node, an "rpc:call(RemoteNode, application,
which_applications, [])", do you get a list back including rabbit?

Matthew

From joe at tanga.com  Mon Jun 13 20:04:49 2011
From: joe at tanga.com (Joe Van Dyk)
Date: Mon, 13 Jun 2011 12:04:49 -0700
Subject: [rabbitmq-discuss] Amazon ELB to load balance rabbitmq?
Message-ID: <BANLkTinEZ3_txHb08K-Hg6Uk12tM9gU0jw@mail.gmail.com>

Anyone using Amazon's ELB
(http://aws.amazon.com/elasticloadbalancing/) to LB rabbitmq?

Joe

From toby.corkindale at strategicdata.com.au  Tue Jun 14 01:45:52 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Tue, 14 Jun 2011 10:45:52 +1000
Subject: [rabbitmq-discuss] message via stomp adapter crashes queue
In-Reply-To: <BANLkTikYr_getudAfmNJdFRBz7dXvdxLng@mail.gmail.com>
References: <BANLkTikYr_getudAfmNJdFRBz7dXvdxLng@mail.gmail.com>
Message-ID: <4DF6AF40.80106@strategicdata.com.au>

On 10/06/11 23:54, Christopher Rhodes wrote:
> Hello!
>
> We're using v2.1.0 on Ubuntu 9.10 with the same versions of the stomp
> and amqp adapter and stuck there because some issues our code has with a
> rewrite of the stomp adapter that occurred some time soon after 2.1.0.
>
[snip]
>
> Any chance of a backport of the fix, please or workaround I might be
> able to get in place?   :)


I found it was quite simple to backport the later versions of RabbitMQ 
and plugins - grab the source packages from upcoming ubuntu version 
11.10 and just recompile them into packages for 9.10 - it's mostly 
automatic.

From rob at rabbitmq.com  Tue Jun 14 12:31:59 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 14 Jun 2011 12:31:59 +0100
Subject: [rabbitmq-discuss] high availability solutions?
In-Reply-To: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
Message-ID: <4DF746AF.9000204@rabbitmq.com>



E R wrote:
> Hello,
>
> I am wondering generally how one architects a rabbitmq system so that
> it is tolerant of a node going down or being taken offline.
>
> Specifically...
>
> 1. Is there ever a need to stop and restart the rabbitmq process, i.e.
> for maintenance, re-configuration, etc.?

The only real need to stop a rabbit node is for upgrade or to tweak some 
configuration settings.

>
> 2. If there is a need to restart the rabbitmq process, how do people
> generally assure that the queuing system is available when a rabbitmq
> server is down? Put retry code in the client? Have multiple servers
> that the client automatically fails over to?

You can run a cluster of servers each of which has a copy of the routing 
network set up by your client code.

You can kill one of these nodes, and with retry code in your client, 
have the client failover on to another node in the cluster.

However, in the current version of Rabbit, queue contents are *not* 
clustered - queues reside on a single node. So if you kill a node with a 
queue on it then you will lose any non-persistent messages from that queue.

This is currently being addressed and indeed, we are close to releasing 
our full Active/Active HA queues.

>
> 3. As a solution to the above problem, what about running a "buffering
> queue" in front of a main queue server? This would allow the main
> server to be taken offline for short periods of time while still
> allowing the application to continue inject messages into the queuing
> system. Good idea? overkill? introduces other problems?

This is certainly not a bad choice, and works quite well with the above 
situation. You simply have a process (which you could run using the 
shovel) that moves messages from your buffer to your backend queues.

At maintenance time, you disable this shovel process, wait for your 
backend queues to be empty and take the backend instances down.

>
> In my particular case latency in the queuing system is not a concern,
> but I don't want to hold up the application if a queuing node goes
> down or is taken offline.
>
> Thanks,
> ER
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rob at rabbitmq.com  Tue Jun 14 12:35:13 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 14 Jun 2011 12:35:13 +0100
Subject: [rabbitmq-discuss] message via stomp adapter crashes queue
In-Reply-To: <BANLkTikYr_getudAfmNJdFRBz7dXvdxLng@mail.gmail.com>
References: <BANLkTikYr_getudAfmNJdFRBz7dXvdxLng@mail.gmail.com>
Message-ID: <4DF74771.4040700@rabbitmq.com>

What exactly is the problem? The shortened URL seems to be disabled for 
spam ;)

I'm particularly interested in knowing if there is something in the 
latest version of the adapter that is preventing you from moving. Fixing 
that will be a lot easier than backporting a fix to the pre-2.1.0 era code.

Rob

Christopher Rhodes wrote:
> Hello!
>
> We're using v2.1.0 on Ubuntu 9.10 with the same versions of the stomp
> and amqp adapter and stuck there because some issues our code has with a
> rewrite of the stomp adapter that occurred some time soon after 2.1.0.
>
> I'm pretty certain we're bumping into the bug reported here:
> http://goo.gl/V4ww2
>
> Last message from that thread:
>
> "I have raised a bug for this problem.
>
> As reported here Matthew feels that the *stomp* client is generating the
> wrong form for the payload of a message, and the code verifies this
> observation.
>
> On Wed, Feb 02, 2011 at 11:48:19PM +0000, Matthew Sackman wrote:
>  > Ok, so the message payload is being sent through as a list instead of as
>  > a binary. My guess without checking further is this is a bug in the
>  > *stomp* client in the way it constructs the messages which are then sent
>  > further into *Rabbit*, but this may not be the case.
>
> The fix is to send it flattened, of course.
>
> To validate this fix a small testcase is being constructed.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc...
> <http://groups.google.com/groups/unlock?_done=/group/rabbitmq-discuss/browse_thread/thread/796e1f0c7ba0551c/fa0f29e51b43d70f%3Flnk%3Dgst%26q%3Drabbit%2Bstomp%2Bcrash&msg=e292a5436aa24076>@lists.rabbitmq.com
> <http://lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> <http://www.google.com/url?sa=D&q=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
> "
>
>
> Any chance of a backport of the fix, please or workaround I might be
> able to get in place?   :)
>
> Thanks!
>
> crr
>
> Christopher.Rhodes at cloudkick.com <mailto:Christopher.Rhodes at cloudkick.com>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From joseph.a.marlin at gmail.com  Tue Jun 14 13:32:07 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Tue, 14 Jun 2011 05:32:07 -0700 (PDT)
Subject: [rabbitmq-discuss] high availability solutions?
In-Reply-To: <4DF746AF.9000204@rabbitmq.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
	<4DF746AF.9000204@rabbitmq.com>
Message-ID: <43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>



On Jun 14, 7:31?am, Rob Harrop <r... at rabbitmq.com> wrote:
> This is currently being addressed and indeed, we are close to releasing
> our full Active/Active HA queues.

This is awesome news! If you can, what is your rough estimate on
"close"? On the order of days, weeks, months, years?

Thanks!

From rob at rabbitmq.com  Tue Jun 14 14:17:49 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 14 Jun 2011 14:17:49 +0100
Subject: [rabbitmq-discuss] high availability solutions?
In-Reply-To: <43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>	<4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
Message-ID: <4DF75F7D.4090902@rabbitmq.com>



Joseph Marlin wrote:
>
> On Jun 14, 7:31 am, Rob Harrop<r... at rabbitmq.com>  wrote:
>> This is currently being addressed and indeed, we are close to releasing
>> our full Active/Active HA queues.
>
> This is awesome news! If you can, what is your rough estimate on
> "close"? On the order of days, weeks, months, years?

I hate to give estimates, but I'd like to think it will be finished 
within the next month. [Note: this is my personal opinion].

Functionally, HA queues are ready to go, but we just need to finalise 
the exact usage model before releasing it into the wild.

>
> Thanks!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From robert.weissmann at web.de  Tue Jun 14 15:33:20 2011
From: robert.weissmann at web.de (Robert)
Date: Tue, 14 Jun 2011 16:33:20 +0200
Subject: [rabbitmq-discuss] Starts slow, but then fast.
Message-ID: <op.vw2lduskgqrarf@ntnbrwe.rgb.systemagmbh.de>

Hi,

I did the "Hello, World" - Example from  
http://www.rabbitmq.com/tutorials/tutorial-one-java.html

and only added to send the message 100000 times.

Any ideas on the following behaviour:

The first couple of hundred messages being received pretty slowly (per 100  
messages 2-3 seconds), then it improves up to a couple thausand messages a  
little bit (per 1000 messages 2-3 seconds), but then - peng - from around  
8000 messages it is extremly fast (rest in about 1 second !!!).

And it doesn't matter if I ran the producer code 1 time or a couple times.  
It is always the same bahaviour. (Also, the producers loop is done much  
before all messages being consumed - so, it looks as the sending is fast).

What is going on. Any ideas ?

Cheers, Rob.

Here my code (but in Scala):



object ConsumerTest {
   val QUEUE_NAME = "robs_queue"

   def main(args: Array[String]) {
     val factory = new ConnectionFactory();
     factory.setHost("localhost");
     val connection = factory.newConnection();
     val channel = connection.createChannel();
     channel.queueDeclare(AMQPTesterRaw.QUEUE_NAME, false, false, false,  
null)

     val consumer = new QueueingConsumer(channel)
     channel.basicConsume(AMQPTesterRaw.QUEUE_NAME, true, consumer)

     while(true){
       val del = consumer.nextDelivery();
       println("arrived = " + new String(del.getBody))
     }

   }
}

object ProducerTest {
   def main(args: Array[String]) {
     val factory = new ConnectionFactory();
     factory.setHost("localhost");
     val connection = factory.newConnection();
     val channel = connection.createChannel();
     channel.queueDeclare(AMQPTesterRaw.QUEUE_NAME, false, false, false,  
null)

     for(x <- 1 to 100000){
       val msg = "Hello World(" + x + ")"
       channel.basicPublish("", AMQPTesterRaw.QUEUE_NAME, null,  
msg.getBytes)
     }

     channel.close()
     connection.close()

   }
}


-- 
Erstellt mit Operas revolution?rem E-Mail-Modul: http://www.opera.com/mail/

From tim at rabbitmq.com  Tue Jun 14 15:42:55 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Tue, 14 Jun 2011 15:42:55 +0100
Subject: [rabbitmq-discuss] Starts slow, but then fast.
In-Reply-To: <op.vw2lduskgqrarf@ntnbrwe.rgb.systemagmbh.de>
References: <op.vw2lduskgqrarf@ntnbrwe.rgb.systemagmbh.de>
Message-ID: <4DF7736F.6040506@rabbitmq.com>

If you're starting a JVM every time you run the producer code, then the 
delay is probably because the VM hasn't had time to "warm up" and the 
JIT to kick in.

JIT can take 10s of seconds to minutes to really kick in and get the 
best benefit. (This is one reason why JVM is not really suited to 
scripting applications).

This is why when running any benchmarks it's always sensible to your let 
your client application warm up by sending and consuming messages for a 
minute or more before you start taking measurements.

On 14/06/11 15:33, Robert wrote:
> Hi,
>
> I did the "Hello, World" - Example from 
> http://www.rabbitmq.com/tutorials/tutorial-one-java.html
>
> and only added to send the message 100000 times.
>
> Any ideas on the following behaviour:
>
> The first couple of hundred messages being received pretty slowly (per 
> 100 messages 2-3 seconds), then it improves up to a couple thausand 
> messages a little bit (per 1000 messages 2-3 seconds), but then - peng 
> - from around 8000 messages it is extremly fast (rest in about 1 
> second !!!).
>
> And it doesn't matter if I ran the producer code 1 time or a couple 
> times. It is always the same bahaviour. (Also, the producers loop is 
> done much before all messages being consumed - so, it looks as the 
> sending is fast).
>
> What is going on. Any ideas ?
>
> Cheers, Rob.
>
> Here my code (but in Scala):
>
>
>
> object ConsumerTest {
>   val QUEUE_NAME = "robs_queue"
>
>   def main(args: Array[String]) {
>     val factory = new ConnectionFactory();
>     factory.setHost("localhost");
>     val connection = factory.newConnection();
>     val channel = connection.createChannel();
>     channel.queueDeclare(AMQPTesterRaw.QUEUE_NAME, false, false, 
> false, null)
>
>     val consumer = new QueueingConsumer(channel)
>     channel.basicConsume(AMQPTesterRaw.QUEUE_NAME, true, consumer)
>
>     while(true){
>       val del = consumer.nextDelivery();
>       println("arrived = " + new String(del.getBody))
>     }
>
>   }
> }
>
> object ProducerTest {
>   def main(args: Array[String]) {
>     val factory = new ConnectionFactory();
>     factory.setHost("localhost");
>     val connection = factory.newConnection();
>     val channel = connection.createChannel();
>     channel.queueDeclare(AMQPTesterRaw.QUEUE_NAME, false, false, 
> false, null)
>
>     for(x <- 1 to 100000){
>       val msg = "Hello World(" + x + ")"
>       channel.basicPublish("", AMQPTesterRaw.QUEUE_NAME, null, 
> msg.getBytes)
>     }
>
>     channel.close()
>     connection.close()
>
>   }
> }
>
>


From davegreggory at yahoo.com  Tue Jun 14 16:17:06 2011
From: davegreggory at yahoo.com (Dave Greggory)
Date: Tue, 14 Jun 2011 08:17:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Fw:  high availability solutions?
In-Reply-To: <4DF75F7D.4090902@rabbitmq.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
	<4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
	<4DF75F7D.4090902@rabbitmq.com>
Message-ID: <70846.95116.qm@web111001.mail.gq1.yahoo.com>

Sending to list...



----- Forwarded Message ----

Wow, this indeed is fantastic news. Thanks for giving us a rough idea on when to 

expect it too. To get something like this within the next 3 months or so is so 
great. You guys rock!


Joseph Marlin wrote:
>
> On Jun 14, 7:31 am, Rob Harrop<r... at rabbitmq.com>  wrote:
>> This is currently being addressed and indeed, we are close to releasing
>> our full Active/Active HA queues.
>
> This is awesome news! If you can, what is your rough estimate on
> "close"? On the order of days, weeks, months, years?

I hate to give estimates, but I'd like to think it will be finished 
within the next month. [Note: this is my personal opinion].

Functionally, HA queues are ready to go, but we just need to finalise 
the exact usage model before releasing it into the wild.

>
> Thanks!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tranzenziuzex at gmail.com  Tue Jun 14 17:00:05 2011
From: tranzenziuzex at gmail.com (T-zex)
Date: Tue, 14 Jun 2011 17:00:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ as a reliable message queue
Message-ID: <BANLkTi=t1G2KhHq1yKYNaAG9bo1HkLtN_A@mail.gmail.com>

Hi,

Is it possible to use RabbitMQ as a reliable message queue? What I
mean is to make it preserve the order of messages in queues even for
non ack'ed durable messages.
Putting non acked messages into the end of the queue just doesn't make sence.

http://www.rabbitmq.com/faq.html#message-ordering

Thank you!

From jasonjwwilliams at gmail.com  Tue Jun 14 17:08:07 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 14 Jun 2011 10:08:07 -0600
Subject: [rabbitmq-discuss] RabbitMQ as a reliable message queue
In-Reply-To: <BANLkTi=t1G2KhHq1yKYNaAG9bo1HkLtN_A@mail.gmail.com>
References: <BANLkTi=t1G2KhHq1yKYNaAG9bo1HkLtN_A@mail.gmail.com>
Message-ID: <BANLkTi=QDJg-6QOsu5vTiFJVRiBuvYVRkA@mail.gmail.com>

> Is it possible to use RabbitMQ as a reliable message queue? What I
> mean is to make it preserve the order of messages in queues even for
> non ack'ed durable messages.
> Putting non acked messages into the end of the queue just doesn't make sence.

Actually, it would be difficult to preserve the order in the case of
non-ack. Let's say you've got M1, M2, M3, M4 in the queue (like the
FAQ describes). If you have two consumers, and C1 is consuming M1 and
C2 is consuming M2. C1 finishes, acks M1 and starts consuming M3.
However, C2 fails and disconnects without acking M2, where should M2
go in the order? M3 is already being consumed. The only sane approach
is to treat M2 as a new submission and append it to the end of the
queue.

-J

From joseph.a.marlin at gmail.com  Tue Jun 14 17:18:03 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Tue, 14 Jun 2011 09:18:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <70846.95116.qm@web111001.mail.gq1.yahoo.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
	<4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
	<4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
Message-ID: <f7615d15-9590-4c6d-82d1-9fa8e826fcd0@fr19g2000vbb.googlegroups.com>


> ----- Forwarded Message ----
>
> Wow, this indeed is fantastic news. Thanks for giving us a rough idea on when to
>
> expect it too. To get something like this within the next 3 months or so is so
> great. You guys rock!

I second this sentiment! Thank you!

From rob at rabbitmq.com  Tue Jun 14 17:23:06 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Tue, 14 Jun 2011 17:23:06 +0100
Subject: [rabbitmq-discuss] Fw:  high availability solutions?
In-Reply-To: <70846.95116.qm@web111001.mail.gq1.yahoo.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>	<4DF746AF.9000204@rabbitmq.com>	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>	<4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
Message-ID: <4DF78AEA.7000703@rabbitmq.com>

I would like to clarify my comments lest I mislead everyone to think 
that the king of all HA solutions is just around the corner - what we 
will be releasing soon is just the first step of our HA solution.

We'll have support for Active/Active queues. We're happy with how this 
works for known, preset cluster topologies.

However, for clusters that change dynamically, a fully automated 
solution is not there yet and will be following in the future.

As with all first release software, I doubt this will solve all problems 
for all users, but it is certainly a good step along the path.

Rob

Dave Greggory wrote:
> Sending to list...
>
>
>
> ----- Forwarded Message ----
>
> Wow, this indeed is fantastic news. Thanks for giving us a rough idea
> on when to
>
> expect it too. To get something like this within the next 3 months or
> so is so
> great. You guys rock!
>
>
> Joseph Marlin wrote:
>> On Jun 14, 7:31 am, Rob Harrop<r... at rabbitmq.com> wrote:
>>> This is currently being addressed and indeed, we are close to releasing
>>> our full Active/Active HA queues.
>> This is awesome news! If you can, what is your rough estimate on
>> "close"? On the order of days, weeks, months, years?
>
> I hate to give estimates, but I'd like to think it will be finished
> within the next month. [Note: this is my personal opinion].
>
> Functionally, HA queues are ready to go, but we just need to finalise
> the exact usage model before releasing it into the wild.
>
>> Thanks!
>> _______________________________________________

From jasonjwwilliams at gmail.com  Tue Jun 14 17:42:44 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 14 Jun 2011 10:42:44 -0600
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <4DF78AEA.7000703@rabbitmq.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
	<4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
	<4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
	<4DF78AEA.7000703@rabbitmq.com>
Message-ID: <BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>

> We'll have support for Active/Active queues. We're happy with how this works
> for known, preset cluster topologies.
>
> However, for clusters that change dynamically, a fully automated solution is
> not there yet and will be following in the future.

What do you mean by "change dynamically"? Does that mean it will be
difficult to replace a node?

-J

From huntermorris+rabbitmq at gmail.com  Tue Jun 14 18:22:41 2011
From: huntermorris+rabbitmq at gmail.com (Hunter Morris)
Date: Tue, 14 Jun 2011 18:22:41 +0100
Subject: [rabbitmq-discuss] Linking to a channel process (erlang client)
Message-ID: <BANLkTikgZNG=1cj2QyDKhSATV12img3p-Q@mail.gmail.com>

This is a rough continuation of
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-September/009032.html
which is the only mailing list post I could find relevant to my issue.
(Aside: kudos to Matthew Sackman for clear explanations including
ASCII diagrams!)

I have a similar application to Erik which supervises a connection via
a worker and creates a channel per application worker process so that
channel exceptions kill only worker processes and the entire
supervision tree is torn down by a connection exception. In general
this works brilliantly well. However, on rare but possible occasions,
the following happens when a worker process opens a channel:

    {ok, ChanPid} = amqp_connection:open_channel(ConnPid),
    % self() dies due to exit signal from another linked process
    link(ChanPid), % we never get here due to exit race

Unfortunately, this leaves a "hanging chad" channel in the supervision
tree. Am I missing something subtle? Is it possible to avoid such a
race?

Best,
Hunter Morris

From mbaffa at opus.com.br  Tue Jun 14 20:16:23 2011
From: mbaffa at opus.com.br (Marcus Vinitius Baffa)
Date: Tue, 14 Jun 2011 16:16:23 -0300
Subject: [rabbitmq-discuss] Connection Closing when used by more that
	one	exchange
In-Reply-To: <4DF20A9A.1020007@rabbitmq.com>
References: <5EFADC7B94CAF64BAB113AD9DE1ACD200A3E7261@srv-opus-02.opus.net>
	<4DF20A9A.1020007@rabbitmq.com>
Message-ID: <5EFADC7B94CAF64BAB113AD9DE1ACD200A50D59B@srv-opus-02.opus.net>

Hi Emile,

It worked. The problem was the using block. I was opening the connection
and the channel in a using block. When the block lessed scope, in the
first message the connection was closed, and the second message that
should use this connection caused the error.

I have removed the using blocks and everything is working OK.

Thanks
 

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: Friday, June 10, 2011 9:14 AM
To: Marcus Vinitius Baffa
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Connection Closing when used by more
that one exchange

Hi Marcus,

On 07/06/11 18:12, Marcus Vinitius Baffa wrote:

> As you can see the sendReply opens another connection and channel to
> send the reply back to the consumer. I know I can use the RPC pattern
> but I need to send a message back like this.

You code does execute, but the peak performance achievable will be
limited, because you are establishing a new channel for each reply.

> When I try to define one connection that would be used by the
> receiveMessageAmqp and the sendReply it stops working.

This works fine for me when I modify your example to use the same
connection for both receiver and sender.

> What happens is that the first message received everything works ok,
the
> message is received and the reply is sent. When another message is
sent
> by the producer the consumer receives the message and the line
> channel.BasicAck( basicDeliveryEventArgs.DeliveryTag, false ); is
> executed an exception is thrown:

Are you perhaps acknowledging the same message twice? Does the broker
logfile contain anything useful around the time this happens?

> base {RabbitMQ.Client.Exceptions.OperationInterruptedException} =
{"The
> AMQP operation was interrupted: AMQP close-reason, initiated by
> Application, code=200, text=\"Connection close forced\", classId=0,
> methodId=0, cause="}

"initiated by Application" normally means a shutdown initiated by the
application using the library, but I'm not sure I believe it in this
case. Your code traps and ignores exceptions in many places - are you
sure the real reason is masked in that way?


-Emile

From jerry at rabbitmq.com  Tue Jun 14 23:09:12 2011
From: jerry at rabbitmq.com (jerry)
Date: Tue, 14 Jun 2011 15:09:12 -0700
Subject: [rabbitmq-discuss] Fwd: RabbitMQ 2.5.0 release
Message-ID: <57695fc324d793b460846c8f33de77b6@rabbitmq.com>

The RabbitMQ team is delighted to announce the release of RabbitMQ 
2.5.0.

This release fixes a number of bugs.  In particular:

   - recovery has been simplified, improving startup times when
     many exchanges or bindings exist

   - bindings are recovered between durable queues and
     non-durable exchanges on restart of individual cluster nodes

   - better performance under high load and memory pressure

   - source compatibility with the new Erlang R14B03 release

New features include:

   - tracing facility for debugging incoming and outgoing messages,
     (see http://www.rabbitmq.com/firehose.html)

   - improved inbound network performance

   - improved routing performance

   - new rabbitmqctl commands ('report', 'environment', and
     'cluster_status')

For details see the release notes.

As always, we welcome any questions, bug reports, and other feedback on 
this release, as well as general suggestions for features and 
enhancements in future releases. Mail us via the RabbitMQ discussion 
list, or directly at info at rabbitmq.com.


From jerry at rabbitmq.com  Wed Jun 15 00:03:54 2011
From: jerry at rabbitmq.com (jerry)
Date: Tue, 14 Jun 2011 16:03:54 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 release (incl release notes)
Message-ID: <7cac6df08d9c98cf27ed2dfdba9ae7b2@rabbitmq.com>

The RabbitMQ team is delighted to announce the release of RabbitMQ 
2.5.0.

This release fixes a number of bugs.  In particular:

   - recovery has been simplified, improving startup times when
     many exchanges or bindings exist

   - bindings are recovered between durable queues and
     non-durable exchanges on restart of individual cluster nodes

   - better performance under high load and memory pressure

   - source compatibility with the new Erlang R14B03 release

New features include:

   - tracing facility for debugging incoming and outgoing messages,
     (see http://www.rabbitmq.com/firehose.html)

   - improved inbound network performance

   - improved routing performance

   - new rabbitmqctl commands ('report', 'environment', and
     'cluster_status')


As always, we welcome any questions, bug reports, and other feedback on 
this release, as well as general suggestions for features and 
enhancements in future releases. Mail us via the RabbitMQ discussion 
list, or directly at info at rabbitmq.com.

For details see the release notes below.

Release: RabbitMQ 2.5.0

Release Highlights
==================

server
------
bug fixes
- reduce complexity of recovery, significantly improving startup times
   when there are large numbers of exchanges or bindings
- recover bindings between durable queues and non-durable exchanges
   on restart of individual cluster nodes
- do not read messages off disk in the x-message-ttl logic. This could
   severely impact performance when many queues expired messages
   (near)simultaneously.
- resolve a timer issue that could impact performance when under high
   load and memory pressure
- make source code compilable with latest Erlang release (R14B03)
- assert x-message-ttl equivalence on queue redeclaration

enhancements
- tracing facility for incoming and outgoing messages - see
   http://www.rabbitmq.com/firehose.html
- optionally serialise events for exchange types
- detect available memory on OpenBSD
- add Windows service description
- improve inbound network performance
- improve routing performance
- new rabbitmqctl commands:
   report - comprehensive report of server status for support purposes
   environment - display application environment (such as config vars)
   cluster_status - display cluster status (formerly part of 'status')

java client
-----------
bug fixes
- compile under Java 1.5 (again)

enhancements
- experimental API employing command objects and builders. See
   
http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/client/test/AMQBuilderApiTest.java
   for some examples. Feedback welcome!

.net client
-----------
bug fixes
- make method id of 'exchange.unbind-ok' match definition in the
   broker, so the client lib can recognise that command.
- WCF bindings specified in configuration files are no longer ignored

enhancements
- allow larger than default message sizes in WCF

management plugin
-----------------
bug fixes
- handle race between queue creation/deletion and stats reporting that
   could result in errors in the latter, particularly when there are
   large numbers of queues and/or high churn
- handle race when starting the management plug-in on multiple cluster
   nodes, which in some rare (but quite reproducible) circumstances
   could cause some of the brokers to crash
- remove duplicate 'messages' entry from queue stats JSON
- make binding arguments optional in the HTTP API for binding creation
- correct error handling in the HTTP API for binding creation
- prevent spurious failures of aliveness test

enhancements
- performance improvements which significantly reduce the cost of
   stats reporting, allowing the management plug-in to cope with much
   higher numbers of queues, bindings, etc.
- issue an alert when a configured user cannot access any vhost or a
   vhost has no users
- allow choice of which stats/info items to return in the HTTP API
- include protocol adapter and direct connections in API and UI

rabbitmq-mochiweb
-----------------

enhancements
- more flexible configuration permitting different services to run on
   different ports, SSL support and interface-based restrictions. See
   http://www.rabbitmq.com/mochiweb.html for more details. Note that by
   default the JSON-RPC channel plugin will now listen on port 55670.

STOMP plugin
------------
enhancements
- support connections over SSL
bug fixes
- correct spelling of 'heart-beat' header

build and packaging
-------------------
bug fixes
- fix breakage in /etc/init.d/rabbitmq-server rotate-logs command

enhancements
- plug-in build system: support the declaration of inter-plugin
   dependencies, making development of plugins much easier.
   Inter-module dependencies are calculated automatically for all
   plugins. Note that some plugins and applications have been
   renamed for  consistency, which may require changes to any existing
   `rabbitmq.config` to match.
- do not require access to www.docbook.org when building the server
   w/o docbook installed
- get rid of some warnings in the .net client build


Upgrading
=========
To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, simply
install the new version. All configuration and persistent message data
is retained.

To upgrade a clustered RabbitMQ from release 2.1.1 or later, install
the new version on all the nodes and follow these instructions:
     http://www.rabbitmq.com/clustering.html#upgrading
All configuration and persistent message data is retained.

To upgrade a non-clustered RabbitMQ from release 2.1.0, first upgrade
to 2.1.1 (which retains all data), and then to the current version as
described above.

To upgrade a clustered RabbitMQ prior to 2.1.1 or a stand-alone broker
from releases prior to 2.1.0, if the RabbitMQ installation does not
contain any important data then simply install the new
version. RabbitMQ will move the existing data to a backup location
before creating a fresh, empty database. A warning is recorded in the
logs. If your RabbitMQ installation contains important data then we
recommend you contact support at rabbitmq.com for assistance with the
upgrade.


From matthew at rabbitmq.com  Wed Jun 15 00:45:34 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 15 Jun 2011 00:45:34 +0100
Subject: [rabbitmq-discuss] Linking to a channel process (erlang client)
In-Reply-To: <BANLkTikgZNG=1cj2QyDKhSATV12img3p-Q@mail.gmail.com>
References: <BANLkTikgZNG=1cj2QyDKhSATV12img3p-Q@mail.gmail.com>
Message-ID: <20110614234533.GA3008@rabbitmq.com>

On Tue, Jun 14, 2011 at 06:22:41PM +0100, Hunter Morris wrote:
> I have a similar application to Erik which supervises a connection via
> a worker and creates a channel per application worker process so that
> channel exceptions kill only worker processes and the entire
> supervision tree is torn down by a connection exception. In general
> this works brilliantly well. However, on rare but possible occasions,
> the following happens when a worker process opens a channel:
> 
>     {ok, ChanPid} = amqp_connection:open_channel(ConnPid),
>     % self() dies due to exit signal from another linked process
>     link(ChanPid), % we never get here due to exit race
> 
> Unfortunately, this leaves a "hanging chad" channel in the supervision
> tree. Am I missing something subtle? Is it possible to avoid such a
> race?

Hmm, that's tricky. Depends what you want to do really - you could have
the supervisor link to the base process that is the amqp_client
application if you want (before starting any workers), but it depends if
you want death of your application to tear down the whole client -
sequencing of those actions to achieve a safe, controlled shutdown, is
not trivial.

My understanding is that on the whole, libraries that spawn processes
are linked to, or monitored, rather than linking / monitoring their
clients. However, this may be wrong and/or not best practise. If you
have ideas how this can be improved, please do let us know.

Best wishes,

Matthew

From tranzenziuzex at gmail.com  Wed Jun 15 10:08:27 2011
From: tranzenziuzex at gmail.com (T-zex)
Date: Wed, 15 Jun 2011 10:08:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
	HandleBasicDeliver question
Message-ID: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>

Hi,

We are overriding DefaultBasicConsumer.HandleBasicDeliver method and
use IModel.BasicConsume to subscribe to incoming messages:
model.BasicConsume(queue, false, instanceOfDerivedConsumer);

When application fails to ack a message that message is requeued. How
can I guarantee that BasicConsume is receiving one message at a time?
How to deterministically stop consuming when application detects that
it is unable to process a message and prevent the second message from
arriving? How to make sure that there is one and only one unacked
message and that message is at the peak of broker queue.

Currently we are trying to close the model (channel) in
HandleBasicDeliver override, but then it blocks and does not seem to
be a right solution.

From dan at puppetlabs.com  Wed Jun 15 07:05:24 2011
From: dan at puppetlabs.com (Dan Bode)
Date: Tue, 14 Jun 2011 23:05:24 -0700
Subject: [rabbitmq-discuss] rabbitmq puppet module
Message-ID: <BANLkTik0dyQQ3AXrMD1YvSzGKMo3OTDUuQ@mail.gmail.com>

Hi all,

I have been working on a puppet module for managing rabbitmq. It should be
ready enough for people to try out.

I just cut a 2.0.0rc1 release:

https://github.com/puppetlabs/puppetlabs-rabbitmq

It has two external dependencies:

https://github.com/puppetlabs/puppetlabs-stdlib
https://github.com/puppetlabs/puppet-apt

Feedback would be greatly appreciated, and best facilitated as issues
through github or via email

regards,

Dan Bode
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110614/6dc28461/attachment.htm>

From emile at rabbitmq.com  Wed Jun 15 10:33:00 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Jun 2011 10:33:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume
 and	HandleBasicDeliver question
In-Reply-To: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>
Message-ID: <4DF87C4C.3010402@rabbitmq.com>

Hi,

On 15/06/11 10:08, T-zex wrote:
> Hi,
> 
> We are overriding DefaultBasicConsumer.HandleBasicDeliver method and
> use IModel.BasicConsume to subscribe to incoming messages:
> model.BasicConsume(queue, false, instanceOfDerivedConsumer);
> 
> When application fails to ack a message that message is requeued. How
> can I guarantee that BasicConsume is receiving one message at a time?
> How to deterministically stop consuming when application detects that
> it is unable to process a message and prevent the second message from
> arriving? How to make sure that there is one and only one unacked
> message and that message is at the peak of broker queue.

The solution is to set the prefetch count of the channel to 1 using
IModel.BasicQos(). Also see
http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos .
Note that rabbit does not implement the prefetch size or global
parameters to the same method.


-Emile

From emile at rabbitmq.com  Wed Jun 15 10:54:28 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Jun 2011 10:54:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ as a reliable message queue
In-Reply-To: <BANLkTi=QDJg-6QOsu5vTiFJVRiBuvYVRkA@mail.gmail.com>
References: <BANLkTi=t1G2KhHq1yKYNaAG9bo1HkLtN_A@mail.gmail.com>
	<BANLkTi=QDJg-6QOsu5vTiFJVRiBuvYVRkA@mail.gmail.com>
Message-ID: <4DF88154.8060101@rabbitmq.com>

On 14/06/11 17:08, Jason J. W. Williams wrote:
>> Is it possible to use RabbitMQ as a reliable message queue? What I
>> mean is to make it preserve the order of messages in queues even for
>> non ack'ed durable messages.
>> Putting non acked messages into the end of the queue just doesn't make sence.
> 
> Actually, it would be difficult to preserve the order in the case of
> non-ack. Let's say you've got M1, M2, M3, M4 in the queue (like the
> FAQ describes). If you have two consumers, and C1 is consuming M1 and
> C2 is consuming M2. C1 finishes, acks M1 and starts consuming M3.
> However, C2 fails and disconnects without acking M2, where should M2
> go in the order? M3 is already being consumed. The only sane approach
> is to treat M2 as a new submission and append it to the end of the
> queue.

Yes, it is not obvious how to requeue in the presence of multiple
consumers. But it is possible to do better in the case of a single
consumer where the inconsistency can't arise. At present rabbit always
requeues at the back of the queue, i.e. treat it as a new message. This
is consistent with the spec which only guarantees ordering along the
same path from a single producer to a single consumer.


-Emile

From simon at rabbitmq.com  Wed Jun 15 10:55:00 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Jun 2011 10:55:00 +0100
Subject: [rabbitmq-discuss] Plugin configuration has changed in 2.5.0
Message-ID: <4DF88174.8040802@rabbitmq.com>

Just a quick note to emphasise that the names of the Erlang applications 
for plugins have all changed in 2.5.0 (in order to be more OTPish) - 
from rabbit_foo to rabbitmq_foo. This means that if you've written 
configuration of any plugins in your rabbitmq.config, you'll need to 
edit it.

For example:

{rabbit_stomp, [ {tcp_listeners, [12345]} ]}

would become:

{rabbitmq_stomp, [ {tcp_listeners, [12345]} ]}

Also, the configuration for rabbitmq_mochiweb has completely changed 
(and is now much more flexible) - see 
http://www.rabbitmq.com/mochiweb.html for details.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tranzenziuzex at gmail.com  Wed Jun 15 10:55:19 2011
From: tranzenziuzex at gmail.com (T-zex)
Date: Wed, 15 Jun 2011 10:55:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <4DF87C4C.3010402@rabbitmq.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>
	<4DF87C4C.3010402@rabbitmq.com>
Message-ID: <BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>

Thank you!

When prefetch count is set to 1 channel will try to fetch the next
message as soon as HandleBasicDeliver returns? Should I invoke
Channel.Close() on a different thread (to avoid blocking) and then
return?

On Wed, Jun 15, 2011 at 10:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi,
>
> On 15/06/11 10:08, T-zex wrote:
>> Hi,
>>
>> We are overriding DefaultBasicConsumer.HandleBasicDeliver method and
>> use IModel.BasicConsume to subscribe to incoming messages:
>> model.BasicConsume(queue, false, instanceOfDerivedConsumer);
>>
>> When application fails to ack a message that message is requeued. How
>> can I guarantee that BasicConsume is receiving one message at a time?
>> How to deterministically stop consuming when application detects that
>> it is unable to process a message and prevent the second message from
>> arriving? How to make sure that there is one and only one unacked
>> message and that message is at the peak of broker queue.
>
> The solution is to set the prefetch count of the channel to 1 using
> IModel.BasicQos(). Also see
> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos .
> Note that rabbit does not implement the prefetch size or global
> parameters to the same method.
>
>
> -Emile
>

From simon at rabbitmq.com  Wed Jun 15 11:05:02 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Jun 2011 11:05:02 +0100
Subject: [rabbitmq-discuss] rabbitmq puppet module
In-Reply-To: <BANLkTik0dyQQ3AXrMD1YvSzGKMo3OTDUuQ@mail.gmail.com>
References: <BANLkTik0dyQQ3AXrMD1YvSzGKMo3OTDUuQ@mail.gmail.com>
Message-ID: <4DF883CE.9000206@rabbitmq.com>

On 15/06/11 07:05, Dan Bode wrote:
> I have been working on a puppet module for managing rabbitmq. It should
> be ready enough for people to try out.

Cool!

> Feedback would be greatly appreciated, and best facilitated as issues
> through github or via email

Couple of things, just from reading the source.

TODO says:

   - can permissions from list_user_permissions contain whitespace?

They can contain spaces. In general you should parse the output of 
rabbitmqctl treating only tabs as delimiters, it'll never use spaces.

The approach of copying .ez files into the repo for plugin support seems 
a bit odd, since that means you'll always be behind. Might be better to 
assemble the URL for the plugin and download it. Mind you, we just 
changed the naming scheme in 2.5.0...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Jun 15 12:03:29 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Jun 2011 12:03:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>	<4DF87C4C.3010402@rabbitmq.com>
	<BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>
Message-ID: <4DF89181.7010605@rabbitmq.com>

Hi,

Prefetch count limits the number of unacknowledged messages, so you
would need to acknowledge the last message to get the next one if the
prefetch count was set to 1.

You should never need to close the channel for flow control. You can use
IModel.ChannelFlow() if you need to temporarily stop the broker from
delivering messages. This works independently from the prefetch count.


-Emile


On 15/06/11 10:55, T-zex wrote:
> Thank you!
> 
> When prefetch count is set to 1 channel will try to fetch the next
> message as soon as HandleBasicDeliver returns? Should I invoke
> Channel.Close() on a different thread (to avoid blocking) and then
> return?
> 
> On Wed, Jun 15, 2011 at 10:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>> Hi,
>>
>> On 15/06/11 10:08, T-zex wrote:
>>> Hi,
>>>
>>> We are overriding DefaultBasicConsumer.HandleBasicDeliver method and
>>> use IModel.BasicConsume to subscribe to incoming messages:
>>> model.BasicConsume(queue, false, instanceOfDerivedConsumer);
>>>
>>> When application fails to ack a message that message is requeued. How
>>> can I guarantee that BasicConsume is receiving one message at a time?
>>> How to deterministically stop consuming when application detects that
>>> it is unable to process a message and prevent the second message from
>>> arriving? How to make sure that there is one and only one unacked
>>> message and that message is at the peak of broker queue.
>>
>> The solution is to set the prefetch count of the channel to 1 using
>> IModel.BasicQos(). Also see
>> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos .
>> Note that rabbit does not implement the prefetch size or global
>> parameters to the same method.

From matthew at rabbitmq.com  Wed Jun 15 12:23:42 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 15 Jun 2011 12:23:42 +0100
Subject: [rabbitmq-discuss] Database Corruption Possibilities
In-Reply-To: <E90DA8CBFB449146A7A73EFDF4CAD61306807F5875@plex05.fastcrop.local>
References: <E90DA8CBFB449146A7A73EFDF4CAD61306807F5875@plex05.fastcrop.local>
Message-ID: <20110615112341.GA8285@rabbitmq.com>

On Fri, Jun 03, 2011 at 12:21:07PM +0100, Ozan Seymen wrote:
> Can someone please explain the scenarios where we might have Rabbit
> message storage (is it mnesia?) corrupted in a way that it is not
> recoverable?

As stated elsewhere, Rabbit does not store messages in mnesia. That
doesn't mean that mnesia being damaged won't cause problems - if you
take a hex editor to its files, I'm sure you can do much damage. Whether
or not mnesia will start up after that, I'm not sure.

Rabbit's own on disk format is very simple, and recovery is done on a
best effort basis. Rabbit is able to fsck its queues and msg stores if
necessary on start up to ensure that messages are where they're expected
to be, and Rabbit will throw away corrupted files as it finds them. This
may result, in extremis, in Rabbit being able to recover no messages
from disk, but it'll still start up happily. It doesn't care too much
that it can't read messages from disk; it'll just tidy up and get on
with life.

> In the solution I am working on, I simply cannot afford to lose any
> messages. In order to secure this, I will:
> 
> *         Rely on publisher confirms. This should ensure that broker
> will always confirm whether it assumed responsibility and persisted
> the message.

Yes-ish. If the message is persistent and sent to a durable queue, and
the message isn't consumed (and ack'd), then the confirm will indicate
it's been fsync'd to disk.

> *         Ack enabled in consumers to prevent losing messages if
> consumer dies halfway. I will solve the ordering problem on the
> consumer side.

Ok. It's not just an ordering problem though; you also will need to
detect duplicates.

> Even though all of these above prevent message loss in normal
> conditions, none of them covers the case where data gets corrupted in
> the broker.

Indeed not. There are dozens of other places where messages can get
corrupted too. Faulty RAM, for example, dying hard discs,
man-in-the-middle attacks that rewrite your messages on the fly. etc
etc.

> There is a window (albeit small) that things might go
> wrong: broker assumes responsibility (message is in the disk) and
> before message is sent to the consumer, broker experiences problems
> which corrupts the storage.

This is remarkably unlikely, and whilst I could argue long and hard
about how the design of the persister should prevent this from ever
happening, I've not proved the correctness of the kernel disk drivers,
file system, or even Erlang's own file driver. Thus there could, and
probably are, bugs in all of those that could cause such corruption.

> Am I a total paranoid that is beyond help? Even so, I would really
> appreciate any info you guys can share.

I don't think you're paranoid, but all (well, nearly all) reasonably
complex software has bugs. Maybe consider taking out insurance against
message loss? Otherwise, IMO, it's far better to build your systems with
message loss in mind, rather than trying to avoid it.


Best wishes,

Matthew

From matthew at rabbitmq.com  Wed Jun 15 12:34:32 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 15 Jun 2011 12:34:32 +0100
Subject: [rabbitmq-discuss] Redudancy solutions
In-Reply-To: <f42f1b61-0099-4ab6-bf38-1731df3de704@fr19g2000vbb.googlegroups.com>
References: <f42f1b61-0099-4ab6-bf38-1731df3de704@fr19g2000vbb.googlegroups.com>
Message-ID: <20110615113432.GA8842@rabbitmq.com>

Hi Joseph,

On Fri, Jun 10, 2011 at 08:21:58AM -0700, Joseph Marlin wrote:
> I'm looking for some insight on different ways of achieving a HA
> RabbitMQ setup without using DRBD. Because of our current setup, doing
> that kind of configuration would be very difficult to achieve.
> 
> I'd really like to get a setup where if one machine goes down, another
> machine can immediately take over, retaining the exact state of
> RabbitMQ on the failed machine when it went down.

I'd like that too. However, the "exact state" includes things like open
file descriptors, including sockets etc, which is rather difficult to
migrate in this way. The only thing that I'm aware of that might come
close to working for this is the FT feature in VMware vSphere
(http://www.vmware.com/products/fault-tolerance/overview.html).

Even the upcoming active/active HA, which offers RAID-1-style mirroring
of queues will not migrate consumers of those queues in the event of
failure. It's just too damn hard.

> My latest attempt at a redudant solution was two completely separate,
> identical, RabbitMQ setups. A publisher pushed messages to the queues
> of each independent node at the same time. I also had a Cassandra
> cluster node installed on each node. Before a consumer would handle a
> message, it would check in with the Cassandra database to ensure that
> it had not already been handled. This worked fine at extremely slow
> speeds, but at anything above 50 messages/sec, there were simply way
> too many double-handled messages, which are not acceptable.

Yup. You might also try zookeeper but that too I think is going to be
too slow - my understanding is that paxos is quite chatty.

There are clever ways of partitioning the workload though which, whilst
they end up rather complicated, can be made to work. The basic idea is
that you have all your consumers consume from all the duplicate queues.
They then only act on a message if they get sufficient copies of the
same message that they can prove no one else will get more copies. That
works quite nicely, but you have to ensure there can be no draws. So for
example, 2 consumers both subscribed to the same 3 queues is fine
because the outcomes are (0,3), (1,2), (2,1) and (3,0) - there's always
a clear winner. But 2 consumers both subscribe to 2 queues can result in
draws and then you have to do cleverer things to resolve such issues.

If I were you, I'd wait for the upcoming active/active HA stuff to land
before going down the above route.

> Is there an alternative to HA that doesn't involve DRBD/Pacemaker/etc?

Well, other than what's due to arrive shortly. But you can always use
Pacemaker without DRBD - any sort of reliable SAN/NAS thingy should
work ok.

Matthew

From matthew at rabbitmq.com  Wed Jun 15 12:39:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 15 Jun 2011 12:39:55 +0100
Subject: [rabbitmq-discuss] consumer.nextDelivery() does not return with
 a value
In-Reply-To: <BANLkTinD9ke0igfCqMjOxRCA_81Oa_4GBA@mail.gmail.com>
References: <BANLkTinD9ke0igfCqMjOxRCA_81Oa_4GBA@mail.gmail.com>
Message-ID: <20110615113954.GB8842@rabbitmq.com>

On Thu, Jun 09, 2011 at 02:33:23PM +0300, mysurf mail wrote:
> I have two clients
> One does queuedeclare() and queue bind()
> and then the other should  iterates with consumer.nextDelivery()
> 
> I can clearly sea that only after the queuedeclare it is added to the
> list_queues
> and only when I bind - the messages are added to the message count.
> so it seems ok, but -
> 
>  the  consumer.nextDelivery() does not return with value (the application is
> stuck on that line)

How are you actually setting up the consumer? You are calling
channel.basicConsume, yes?

Matthew

From huntermorris+rabbitmq at gmail.com  Wed Jun 15 13:05:44 2011
From: huntermorris+rabbitmq at gmail.com (Hunter Morris)
Date: Wed, 15 Jun 2011 13:05:44 +0100
Subject: [rabbitmq-discuss] Linking to a channel process (erlang client)
In-Reply-To: <20110614234533.GA3008@rabbitmq.com>
References: <BANLkTikgZNG=1cj2QyDKhSATV12img3p-Q@mail.gmail.com>
	<20110614234533.GA3008@rabbitmq.com>
Message-ID: <BANLkTimjpyquxen+yBQ2-XPvZ6JmHBfvOA@mail.gmail.com>

On Wed, Jun 15, 2011 at 12:45 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> Hmm, that's tricky. Depends what you want to do really - you could have
> the supervisor link to the base process that is the amqp_client
> application if you want (before starting any workers), but it depends if
> you want death of your application to tear down the whole client -
> sequencing of those actions to achieve a safe, controlled shutdown, is
> not trivial.

Currently, my application's top-level supervisor starts amqp_sup as a
child itself which gives the behaviour I want when my application
crashes. That works quite well and behaves as I expect.

> My understanding is that on the whole, libraries that spawn processes
> are linked to, or monitored, rather than linking / monitoring their
> clients. However, this may be wrong and/or not best practise. If you
> have ideas how this can be improved, please do let us know.

My main concern is leaking processes since client-side channels are
composed of at least 3 processes each (and I expect hundreds of
channels in this particular application).

I've seen other "client" applications which manage socket connections
treat this issue very differently. For example, lhttpc
(https://github.com/esl/lhttpc) spawn_links a simple lhttpc_client
process, passing along self() in order to unlink when a request is
finished. Obviously, HTTP clients are largely stateless which differs
greatly from the situation we have with AMQP connections and channels.

Based on a suggestion, I will most likely trap exits in the worker
process while setting up the link to the channel in order to clean up
if it receives an exit signal from elsewhere. Because the worker
processes are quite simple, this should be fine.

Thanks for your help,
Hunter

From matthew at rabbitmq.com  Wed Jun 15 13:10:00 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 15 Jun 2011 13:10:00 +0100
Subject: [rabbitmq-discuss] Linking to a channel process (erlang client)
In-Reply-To: <BANLkTimjpyquxen+yBQ2-XPvZ6JmHBfvOA@mail.gmail.com>
References: <BANLkTikgZNG=1cj2QyDKhSATV12img3p-Q@mail.gmail.com>
	<20110614234533.GA3008@rabbitmq.com>
	<BANLkTimjpyquxen+yBQ2-XPvZ6JmHBfvOA@mail.gmail.com>
Message-ID: <20110615120959.GE8842@rabbitmq.com>

On Wed, Jun 15, 2011 at 01:05:44PM +0100, Hunter Morris wrote:
> I've seen other "client" applications which manage socket connections
> treat this issue very differently. For example, lhttpc
> (https://github.com/esl/lhttpc) spawn_links a simple lhttpc_client
> process, passing along self() in order to unlink when a request is
> finished. Obviously, HTTP clients are largely stateless which differs
> greatly from the situation we have with AMQP connections and channels.

Interesting, and thanks for the pointer. I'll take a look at that and we
may well change the behaviour here, or at least introduce a start_link
variant as there used to be.

Matthew

From tranzenziuzex at gmail.com  Wed Jun 15 13:35:09 2011
From: tranzenziuzex at gmail.com (T-zex)
Date: Wed, 15 Jun 2011 13:35:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <4DF89181.7010605@rabbitmq.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>
	<4DF87C4C.3010402@rabbitmq.com>
	<BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>
	<4DF89181.7010605@rabbitmq.com>
Message-ID: <BANLkTinpXYu6k9mv=MFx6rXfXoVDVPWuGQ@mail.gmail.com>

In my case it doesn't matter if it is IModel.Close() or
IModel.ChannelFlow(false) couse the process must be terminated anyway.
We need an atomic operation which would ack the message and would not
fetch the other one. It seems that BasicConsume is unable to gurantee
that, so maybe BasicGet is a better option?

On Wed, Jun 15, 2011 at 12:03 PM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi,
>
> Prefetch count limits the number of unacknowledged messages, so you
> would need to acknowledge the last message to get the next one if the
> prefetch count was set to 1.
>
> You should never need to close the channel for flow control. You can use
> IModel.ChannelFlow() if you need to temporarily stop the broker from
> delivering messages. This works independently from the prefetch count.
>
>
> -Emile
>
>
> On 15/06/11 10:55, T-zex wrote:
>> Thank you!
>>
>> When prefetch count is set to 1 channel will try to fetch the next
>> message as soon as HandleBasicDeliver returns? Should I invoke
>> Channel.Close() on a different thread (to avoid blocking) and then
>> return?
>>
>> On Wed, Jun 15, 2011 at 10:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>>> Hi,
>>>
>>> On 15/06/11 10:08, T-zex wrote:
>>>> Hi,
>>>>
>>>> We are overriding DefaultBasicConsumer.HandleBasicDeliver method and
>>>> use IModel.BasicConsume to subscribe to incoming messages:
>>>> model.BasicConsume(queue, false, instanceOfDerivedConsumer);
>>>>
>>>> When application fails to ack a message that message is requeued. How
>>>> can I guarantee that BasicConsume is receiving one message at a time?
>>>> How to deterministically stop consuming when application detects that
>>>> it is unable to process a message and prevent the second message from
>>>> arriving? How to make sure that there is one and only one unacked
>>>> message and that message is at the peak of broker queue.
>>>
>>> The solution is to set the prefetch count of the channel to 1 using
>>> IModel.BasicQos(). Also see
>>> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos .
>>> Note that rabbit does not implement the prefetch size or global
>>> parameters to the same method.
>

From emile at rabbitmq.com  Wed Jun 15 13:42:31 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Jun 2011 13:42:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <BANLkTinpXYu6k9mv=MFx6rXfXoVDVPWuGQ@mail.gmail.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>	<4DF87C4C.3010402@rabbitmq.com>	<BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>	<4DF89181.7010605@rabbitmq.com>
	<BANLkTinpXYu6k9mv=MFx6rXfXoVDVPWuGQ@mail.gmail.com>
Message-ID: <4DF8A8B7.4010809@rabbitmq.com>

Hi,

Yes, if you want to retrieve a single message synchronously then use
IModel.BasicGet() . BasicConsume() is for asynchronous delivery of
messages, which is faster than BasicGet() and often leads to simpler
client code.



On 15/06/11 13:35, T-zex wrote:
> In my case it doesn't matter if it is IModel.Close() or
> IModel.ChannelFlow(false) couse the process must be terminated anyway.
> We need an atomic operation which would ack the message and would not
> fetch the other one. It seems that BasicConsume is unable to gurantee
> that, so maybe BasicGet is a better option?
> 
> On Wed, Jun 15, 2011 at 12:03 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>> Hi,
>>
>> Prefetch count limits the number of unacknowledged messages, so you
>> would need to acknowledge the last message to get the next one if the
>> prefetch count was set to 1.
>>
>> You should never need to close the channel for flow control. You can use
>> IModel.ChannelFlow() if you need to temporarily stop the broker from
>> delivering messages. This works independently from the prefetch count.
>>
>>
>> -Emile
>>
>>
>> On 15/06/11 10:55, T-zex wrote:
>>> Thank you!
>>>
>>> When prefetch count is set to 1 channel will try to fetch the next
>>> message as soon as HandleBasicDeliver returns? Should I invoke
>>> Channel.Close() on a different thread (to avoid blocking) and then
>>> return?
>>>
>>> On Wed, Jun 15, 2011 at 10:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>>>> Hi,
>>>>
>>>> On 15/06/11 10:08, T-zex wrote:
>>>>> Hi,
>>>>>
>>>>> We are overriding DefaultBasicConsumer.HandleBasicDeliver method and
>>>>> use IModel.BasicConsume to subscribe to incoming messages:
>>>>> model.BasicConsume(queue, false, instanceOfDerivedConsumer);
>>>>>
>>>>> When application fails to ack a message that message is requeued. How
>>>>> can I guarantee that BasicConsume is receiving one message at a time?
>>>>> How to deterministically stop consuming when application detects that
>>>>> it is unable to process a message and prevent the second message from
>>>>> arriving? How to make sure that there is one and only one unacked
>>>>> message and that message is at the peak of broker queue.
>>>>
>>>> The solution is to set the prefetch count of the channel to 1 using
>>>> IModel.BasicQos(). Also see
>>>> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos .
>>>> Note that rabbit does not implement the prefetch size or global
>>>> parameters to the same method.


From harvey.robin at gmail.com  Wed Jun 15 13:58:29 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Wed, 15 Jun 2011 13:58:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ-C client and SSL support
In-Reply-To: <CA1B8A13.207D1%pdezwart@rubiconproject.com>
References: <CA1B8A13.207D1%pdezwart@rubiconproject.com>
Message-ID: <BANLkTim3v5Gj_e8UT3+mj5ZS3J4QmwdFFg@mail.gmail.com>

Hi Pieter,

Not sure about the native client, but my client can support SSL via. the
standard PHP streams library, there's more info here:

https://github.com/BraveSirRobin/amqphp/wiki/SSL-Setup

Of course, my library is written in PHP and so is likely to be slower, but
this might help if you're unable to get the C client working with SSL.

HTH,
--Robin

On Mon, Jun 13, 2011 at 5:34 PM, Pieter de Zwart <
pdezwart at rubiconproject.com> wrote:

>  Hey everyone,
>
> Last February, David Wragg mentioned that the RabbitMQ C client library was
> build in such a way that adding things like SSL would be difficult. Are
> there any updates regarding the library since then with regard to this
> topic? I have a few people that really want to be able to use SSL from PHP,
> but there is little I can do if the C client does not support it (I have no
> interest in reinventing the wheel and building the rabbitmq-c functionality
> into our codebase...)
>
> Thanks!
> Pieter
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110615/7ed9d48f/attachment.htm>

From tranzenziuzex at gmail.com  Wed Jun 15 15:34:42 2011
From: tranzenziuzex at gmail.com (T-zex)
Date: Wed, 15 Jun 2011 15:34:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <4DF8A8B7.4010809@rabbitmq.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>
	<4DF87C4C.3010402@rabbitmq.com>
	<BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>
	<4DF89181.7010605@rabbitmq.com>
	<BANLkTinpXYu6k9mv=MFx6rXfXoVDVPWuGQ@mail.gmail.com>
	<4DF8A8B7.4010809@rabbitmq.com>
Message-ID: <BANLkTinA3YG-qnQEEx_RpchRLqNhwsdSjw@mail.gmail.com>

Thank you Emile.

The thing I'm trying to solve is have a guaranteed order of messages:
if I fail to ack after BasicGet() the message anyway will go to the
end of the queue. In case noAck = true, there is a risk to lose a
message when a process fails. I can't find a way to make RabbitMQ work
as a queue in a simple single reader scenario...

On Wed, Jun 15, 2011 at 1:42 PM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi,
>
> Yes, if you want to retrieve a single message synchronously then use
> IModel.BasicGet() . BasicConsume() is for asynchronous delivery of
> messages, which is faster than BasicGet() and often leads to simpler
> client code.
>
>
>
> On 15/06/11 13:35, T-zex wrote:
>> In my case it doesn't matter if it is IModel.Close() or
>> IModel.ChannelFlow(false) couse the process must be terminated anyway.
>> We need an atomic operation which would ack the message and would not
>> fetch the other one. It seems that BasicConsume is unable to gurantee
>> that, so maybe BasicGet is a better option?
>>
>> On Wed, Jun 15, 2011 at 12:03 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>>> Hi,
>>>
>>> Prefetch count limits the number of unacknowledged messages, so you
>>> would need to acknowledge the last message to get the next one if the
>>> prefetch count was set to 1.
>>>
>>> You should never need to close the channel for flow control. You can use
>>> IModel.ChannelFlow() if you need to temporarily stop the broker from
>>> delivering messages. This works independently from the prefetch count.
>>>
>>>
>>> -Emile
>>>
>>>
>>> On 15/06/11 10:55, T-zex wrote:
>>>> Thank you!
>>>>
>>>> When prefetch count is set to 1 channel will try to fetch the next
>>>> message as soon as HandleBasicDeliver returns? Should I invoke
>>>> Channel.Close() on a different thread (to avoid blocking) and then
>>>> return?
>>>>
>>>> On Wed, Jun 15, 2011 at 10:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>>>>> Hi,
>>>>>
>>>>> On 15/06/11 10:08, T-zex wrote:
>>>>>> Hi,
>>>>>>
>>>>>> We are overriding DefaultBasicConsumer.HandleBasicDeliver method and
>>>>>> use IModel.BasicConsume to subscribe to incoming messages:
>>>>>> model.BasicConsume(queue, false, instanceOfDerivedConsumer);
>>>>>>
>>>>>> When application fails to ack a message that message is requeued. How
>>>>>> can I guarantee that BasicConsume is receiving one message at a time?
>>>>>> How to deterministically stop consuming when application detects that
>>>>>> it is unable to process a message and prevent the second message from
>>>>>> arriving? How to make sure that there is one and only one unacked
>>>>>> message and that message is at the peak of broker queue.
>>>>>
>>>>> The solution is to set the prefetch count of the channel to 1 using
>>>>> IModel.BasicQos(). Also see
>>>>> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos .
>>>>> Note that rabbit does not implement the prefetch size or global
>>>>> parameters to the same method.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From emile at rabbitmq.com  Wed Jun 15 16:03:19 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Jun 2011 16:03:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <BANLkTinA3YG-qnQEEx_RpchRLqNhwsdSjw@mail.gmail.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>	<4DF87C4C.3010402@rabbitmq.com>	<BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>	<4DF89181.7010605@rabbitmq.com>	<BANLkTinpXYu6k9mv=MFx6rXfXoVDVPWuGQ@mail.gmail.com>	<4DF8A8B7.4010809@rabbitmq.com>
	<BANLkTinA3YG-qnQEEx_RpchRLqNhwsdSjw@mail.gmail.com>
Message-ID: <4DF8C9B7.3010908@rabbitmq.com>

Hi,

Message order guarantees only apply along the same path between a single
producer and consumer. The guarantees do not hold if messages get
requeued. Rabbit will requeue messages at the back of the queue, i.e.
treat it as a new message.

Your producer may add a sequence number to messages so that consumers
can detect this. Consumers may also inspect the "redelivered" flag to
check whether a message has been delivered before.


-Emile


On 15/06/11 15:34, T-zex wrote:
> Thank you Emile.
> 
> The thing I'm trying to solve is have a guaranteed order of messages:
> if I fail to ack after BasicGet() the message anyway will go to the
> end of the queue. In case noAck = true, there is a risk to lose a
> message when a process fails. I can't find a way to make RabbitMQ work
> as a queue in a simple single reader scenario...
> 
> On Wed, Jun 15, 2011 at 1:42 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>> Hi,
>>
>> Yes, if you want to retrieve a single message synchronously then use
>> IModel.BasicGet() . BasicConsume() is for asynchronous delivery of
>> messages, which is faster than BasicGet() and often leads to simpler
>> client code.
>>
>>
>>
>> On 15/06/11 13:35, T-zex wrote:
>>> In my case it doesn't matter if it is IModel.Close() or
>>> IModel.ChannelFlow(false) couse the process must be terminated anyway.
>>> We need an atomic operation which would ack the message and would not
>>> fetch the other one. It seems that BasicConsume is unable to gurantee
>>> that, so maybe BasicGet is a better option?
>>>
>>> On Wed, Jun 15, 2011 at 12:03 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>>>> Hi,
>>>>
>>>> Prefetch count limits the number of unacknowledged messages, so you
>>>> would need to acknowledge the last message to get the next one if the
>>>> prefetch count was set to 1.
>>>>
>>>> You should never need to close the channel for flow control. You can use
>>>> IModel.ChannelFlow() if you need to temporarily stop the broker from
>>>> delivering messages. This works independently from the prefetch count.
>>>>
>>>>
>>>> -Emile
>>>>
>>>>
>>>> On 15/06/11 10:55, T-zex wrote:
>>>>> Thank you!
>>>>>
>>>>> When prefetch count is set to 1 channel will try to fetch the next
>>>>> message as soon as HandleBasicDeliver returns? Should I invoke
>>>>> Channel.Close() on a different thread (to avoid blocking) and then
>>>>> return?
>>>>>
>>>>> On Wed, Jun 15, 2011 at 10:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>>>>>> Hi,
>>>>>>
>>>>>> On 15/06/11 10:08, T-zex wrote:
>>>>>>> Hi,
>>>>>>>
>>>>>>> We are overriding DefaultBasicConsumer.HandleBasicDeliver method and
>>>>>>> use IModel.BasicConsume to subscribe to incoming messages:
>>>>>>> model.BasicConsume(queue, false, instanceOfDerivedConsumer);
>>>>>>>
>>>>>>> When application fails to ack a message that message is requeued. How
>>>>>>> can I guarantee that BasicConsume is receiving one message at a time?
>>>>>>> How to deterministically stop consuming when application detects that
>>>>>>> it is unable to process a message and prevent the second message from
>>>>>>> arriving? How to make sure that there is one and only one unacked
>>>>>>> message and that message is at the peak of broker queue.
>>>>>>
>>>>>> The solution is to set the prefetch count of the channel to 1 using
>>>>>> IModel.BasicQos(). Also see
>>>>>> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos .
>>>>>> Note that rabbit does not implement the prefetch size or global
>>>>>> parameters to the same method.


From michael.s.klishin at gmail.com  Wed Jun 15 16:03:48 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 15 Jun 2011 19:03:48 +0400
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 release (incl release notes)
In-Reply-To: <7cac6df08d9c98cf27ed2dfdba9ae7b2@rabbitmq.com>
References: <7cac6df08d9c98cf27ed2dfdba9ae7b2@rabbitmq.com>
Message-ID: <2456589E7567411A866048090FCDBD1B@gmail.com>

jerry escribi?:
> The RabbitMQ team is delighted to announce the release of RabbitMQ 
> 2.5.0.
A note to Mac OS X users: if you use Homebrew and sync with master, brew install rabbitmq will now install 2.5.0 [1].But don't forget to upgrade plugins.

1. https://github.com/mxcl/homebrew/commit/08f7237400ed51aa0d96b25490f8e2f3ca2db8cd
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin





From tranzenziuzex at gmail.com  Wed Jun 15 16:31:16 2011
From: tranzenziuzex at gmail.com (T-zex)
Date: Wed, 15 Jun 2011 16:31:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <4DF8C9B7.3010908@rabbitmq.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>
	<4DF87C4C.3010402@rabbitmq.com>
	<BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>
	<4DF89181.7010605@rabbitmq.com>
	<BANLkTinpXYu6k9mv=MFx6rXfXoVDVPWuGQ@mail.gmail.com>
	<4DF8A8B7.4010809@rabbitmq.com>
	<BANLkTinA3YG-qnQEEx_RpchRLqNhwsdSjw@mail.gmail.com>
	<4DF8C9B7.3010908@rabbitmq.com>
Message-ID: <BANLkTimuDuK15j-B8PEZ11iWzWBtVrmJ1Q@mail.gmail.com>

Tanks again!

So, in case we detect that current message sequence number is bigger
than expected do we need to loop through the queue untill the required
message is found? Does this mean that producer must be stopped,
because all other messages in front of the queue will become unacked
and will go back to the queue and new ones will appear at the front -
basically to avoid shuffling.



On Wed, Jun 15, 2011 at 4:03 PM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi,
>
> Message order guarantees only apply along the same path between a single
> producer and consumer. The guarantees do not hold if messages get
> requeued. Rabbit will requeue messages at the back of the queue, i.e.
> treat it as a new message.
>
> Your producer may add a sequence number to messages so that consumers
> can detect this. Consumers may also inspect the "redelivered" flag to
> check whether a message has been delivered before.
>
>
> -Emile
>
>
> On 15/06/11 15:34, T-zex wrote:
>> Thank you Emile.
>>
>> The thing I'm trying to solve is have a guaranteed order of messages:
>> if I fail to ack after BasicGet() the message anyway will go to the
>> end of the queue. In case noAck = true, there is a risk to lose a
>> message when a process fails. I can't find a way to make RabbitMQ work
>> as a queue in a simple single reader scenario...
>>
>> On Wed, Jun 15, 2011 at 1:42 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>>> Hi,
>>>
>>> Yes, if you want to retrieve a single message synchronously then use
>>> IModel.BasicGet() . BasicConsume() is for asynchronous delivery of
>>> messages, which is faster than BasicGet() and often leads to simpler
>>> client code.
>>>
>>>
>>>
>>> On 15/06/11 13:35, T-zex wrote:
>>>> In my case it doesn't matter if it is IModel.Close() or
>>>> IModel.ChannelFlow(false) couse the process must be terminated anyway.
>>>> We need an atomic operation which would ack the message and would not
>>>> fetch the other one. It seems that BasicConsume is unable to gurantee
>>>> that, so maybe BasicGet is a better option?
>>>>
>>>> On Wed, Jun 15, 2011 at 12:03 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>>>>> Hi,
>>>>>
>>>>> Prefetch count limits the number of unacknowledged messages, so you
>>>>> would need to acknowledge the last message to get the next one if the
>>>>> prefetch count was set to 1.
>>>>>
>>>>> You should never need to close the channel for flow control. You can use
>>>>> IModel.ChannelFlow() if you need to temporarily stop the broker from
>>>>> delivering messages. This works independently from the prefetch count.
>>>>>
>>>>>
>>>>> -Emile
>>>>>
>>>>>
>>>>> On 15/06/11 10:55, T-zex wrote:
>>>>>> Thank you!
>>>>>>
>>>>>> When prefetch count is set to 1 channel will try to fetch the next
>>>>>> message as soon as HandleBasicDeliver returns? Should I invoke
>>>>>> Channel.Close() on a different thread (to avoid blocking) and then
>>>>>> return?
>>>>>>
>>>>>> On Wed, Jun 15, 2011 at 10:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>>>>>>> Hi,
>>>>>>>
>>>>>>> On 15/06/11 10:08, T-zex wrote:
>>>>>>>> Hi,
>>>>>>>>
>>>>>>>> We are overriding DefaultBasicConsumer.HandleBasicDeliver method and
>>>>>>>> use IModel.BasicConsume to subscribe to incoming messages:
>>>>>>>> model.BasicConsume(queue, false, instanceOfDerivedConsumer);
>>>>>>>>
>>>>>>>> When application fails to ack a message that message is requeued. How
>>>>>>>> can I guarantee that BasicConsume is receiving one message at a time?
>>>>>>>> How to deterministically stop consuming when application detects that
>>>>>>>> it is unable to process a message and prevent the second message from
>>>>>>>> arriving? How to make sure that there is one and only one unacked
>>>>>>>> message and that message is at the peak of broker queue.
>>>>>>>
>>>>>>> The solution is to set the prefetch count of the channel to 1 using
>>>>>>> IModel.BasicQos(). Also see
>>>>>>> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos .
>>>>>>> Note that rabbit does not implement the prefetch size or global
>>>>>>> parameters to the same method.
>
>

From Massimo.Paladin at cern.ch  Wed Jun 15 16:34:36 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Wed, 15 Jun 2011 17:34:36 +0200
Subject: [rabbitmq-discuss] Rabbitmq 2.5.0 and rabbitmq-stomp plugin +
	certificate authentication
Message-ID: <BANLkTinH+kxMMOV3wToB0BT4J82wW5JpBA@mail.gmail.com>

Hello,

I am looking at rabbitmq 2.5.0 and the stomp plugin.

I am able to connect through ssl with plain authentication but not with ssl
and certificate authentication.

Is certificate authentication supported in this version of stomp plugin?

What I get in the log is (using stomp 1.0 for this example):

=INFO REPORT==== 15-Jun-2011::17:17:35 ===
accepted TCP connection on 0.0.0.0:xxxxx from x.x.x.x:48014

=INFO REPORT==== 15-Jun-2011::17:17:35 ===
upgraded TCP connection <0.231.0> to SSL

=INFO REPORT==== 15-Jun-2011::17:17:35 ===
starting STOMP connection <0.1585.0> from x.x.x.x:48014

=ERROR REPORT==== 15-Jun-2011::17:17:35 ===
STOMP error frame sent:
Message: "Bad CONNECT"
Detail: "Missing login or passcode header(s)\n"
Server private detail: none

=INFO REPORT==== 15-Jun-2011::17:17:35 ===
Socket {ssl_socket,#Port<0.5884>,{sslsocket,new_ssl,<0.1581.0>}} closed by
client

=INFO REPORT==== 15-Jun-2011::17:17:35 ===
ending STOMP connection <0.1585.0> from x.x.x.x:48014

It still looks for login and passcode...

The config part related to ssl and authentication is:
    {rabbit, [ {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
               {tcp_listeners, [xxxxx]},
               {ssl_listeners, [xxxxx]},
               {ssl_options, [
                    {cacertfile,"/path/to/cacert.pem"},
                    {certfile,"/path/to/hostcert.pem"},
                    {keyfile,"/path/to/hostkey.pem"},
                    {verify,verify_peer},
                    {fail_if_no_peer_cert,true}]}
    ] }
and for stomp I have:
    {rabbitmq_stomp, [{tcp_listeners, [xxxxx]},
                      {ssl_listeners, [xxxxx]}]}

Of course I have enabled rabbitmq_auth_mechanism_ssl:
Status of node 'rabbitmq-dev at devhost001' ...
[{pid,30594},
 {running_applications,
     [{rabbitmq_auth_mechanism_ssl,
          "RabbitMQ SSL authentication (SASL EXTERNAL)","2.5.0"},
      {rabbitmq_management,"RabbitMQ Management Console","2.5.0"},
      {webmachine,"webmachine","1.7.0-rmq2.5.0-hg0c4b60a"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.5.0"},
      {amqp_client,"RabbitMQ AMQP Client","2.5.0"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.5.0"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.5.0-git9a53dbd"},
      {inets,"INETS  CXC 138 49","5.5.2"},
      {rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","2.5.0"},
      {rabbit,"RabbitMQ","2.5.0"},
      {ssl,"Erlang/OTP SSL application","4.1.4"},
      {public_key,"Public key infrastructure","0.11"},
      {crypto,"CRYPTO version 2","2.0.2.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.17"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9.3"},
      {stdlib,"ERTS  CXC 138 10","1.17.3"},
      {kernel,"ERTS  CXC 138 10","2.14.3"}]},
.......


Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110615/092e67ed/attachment.htm>

From gmr at myyearbook.com  Wed Jun 15 16:40:08 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 15 Jun 2011 08:40:08 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 release (incl release notes)
In-Reply-To: <2456589E7567411A866048090FCDBD1B@gmail.com>
References: <7cac6df08d9c98cf27ed2dfdba9ae7b2@rabbitmq.com>
	<2456589E7567411A866048090FCDBD1B@gmail.com>
Message-ID: <764BAEE5A8164323A1D33B8273B4B1C6@myyearbook.com>

That's great, any chance you can add a symlink in the brew install? The plugin dir is nested a bit deep compared to the normal source based install.

/usr/local/Cellar/rabbitmq/2.5.0/lib/rabbitmq/erlang/lib/rabbitmq-2.5.0/plugins

to

/usr/local/Cellar/rabbitmq/2.5.0/plugins

Thanks for the update,

Gavin

On Wednesday, June 15, 2011 at 8:03 AM, Michael Klishin wrote:
> jerry escribi?:
> > The RabbitMQ team is delighted to announce the release of RabbitMQ 
> > 2.5.0.
> A note to Mac OS X users: if you use Homebrew and sync with master, brew install rabbitmq will now install 2.5.0 [1].But don't forget to upgrade plugins.
> 
> 1. https://github.com/mxcl/homebrew/commit/08f7237400ed51aa0d96b25490f8e2f3ca2db8cd
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com) (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110615/4425b6c6/attachment.htm>

From simon at rabbitmq.com  Wed Jun 15 16:42:03 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Jun 2011 16:42:03 +0100
Subject: [rabbitmq-discuss] Rabbitmq 2.5.0 and rabbitmq-stomp plugin +
 certificate authentication
In-Reply-To: <BANLkTinH+kxMMOV3wToB0BT4J82wW5JpBA@mail.gmail.com>
References: <BANLkTinH+kxMMOV3wToB0BT4J82wW5JpBA@mail.gmail.com>
Message-ID: <4DF8D2CB.1020008@rabbitmq.com>

On 15/06/11 16:34, Massimo Paladin wrote:
> I am looking at rabbitmq 2.5.0 and the stomp plugin.
>
> I am able to connect through ssl with plain authentication but not with
> ssl and certificate authentication.
>
> Is certificate authentication supported in this version of stomp plugin?

No. It hooks into the SASL mechanism layer and STOMP doesn't use SASL.

I'll raise a bug.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From fabiomargarido at gmail.com  Wed Jun 15 16:51:07 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Wed, 15 Jun 2011 12:51:07 -0300
Subject: [rabbitmq-discuss] rabbitmq-lvc-plugin broken with 2.5.0 release
Message-ID: <BANLkTim_19Ah2ttNuZmk2SpEaE2N+1FkEg@mail.gmail.com>

Hi there,
I'd just like to point out that the last value cache exchange made available
by the rabbitmq-lvc-plugin is broken with the latest RabbitMQ release. This
is the message I get when starting the broker:

BOOT ERROR: Could not add boot step dependency of rabbit_lvc_plugin on
exchange_recovery:
Boot step not registered: exchange_recovery
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabb
it,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}
}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbi
t,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}
}})

I know it's experimental stuff, but since I'm using it it would be nice to
have it working with the latest and greatest... :)
If anyone is interested I can post the mentioned crash dump.
Thank you very much.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110615/d99b5131/attachment.htm>

From sam at pfgltd.com  Wed Jun 15 17:04:47 2011
From: sam at pfgltd.com (Sam Domonkos)
Date: Wed, 15 Jun 2011 11:04:47 -0500
Subject: [rabbitmq-discuss] 2.5.0 stomp ssl Windows 2008R2
Message-ID: <4DF8D81F.60306@pfgltd.com>

Hello,

Looks like Massimo.Paladin at cern.ch is further along in his question.

Maybe I just have ssl setup wrong which I suspect because of the following:
=ERROR REPORT==== 15-Jun-2011::10:22:27 ===
SSL: hello: ./ssl_handshake.erl:247:Fatal error: internal error

I am trying to use the stomp plugin-2.5.0 with ssl (no certificates yet) 
on RabbitMQ-2.5.0 on a Windows 2008R2 server.  I have openssl-32bit 
installed with VS 2008 Redistributables. Stomp with ssl is a requirement 
in our search for the right mq broker.
I know this is not in the docs yet, but I see some unit tests using ssl 
with stomp so just seeing if this is fully functional as of 2.5.0.

Thanks in advance for any direction.
-Sam

################ rabbitmq.config #################################
[
   {rabbitmq_stomp, [{ssl_listeners, [61614]}]},
   {rabbit, [
      {ssl_listeners, [5671]},
      {ssl_options, [{verify,verify_none},
                     {fail_if_no_peer_cert,false}]}
    ]}
].

################ stomp_ssl_test.py ###############################
#!/usr/bin/env python
import stomp # using stomp.py
import time
import logging
import sys
import random
import yaml

logging.basicConfig()

class MyListener(object):
     def on_error(self, headers, message):
         print 'received an error %s' % message

     def on_message(self, headers, message):
         print 'received a message %s' % message

dest='/queue/test'
host='192.168.0.108'
# port=61614
# ssl=True
port=61613
ssl=False
conn=stomp.Connection(host_and_ports=[(host,port)], user='guest', 
passcode='guest',use_ssl=ssl)
print('set up Connection')
conn.set_listener('somename',MyListener())
print('Set up listener')

conn.start()
print('started connection')

conn.connect(wait=True, headers={'login':'guest', 'passcode':'guest'})
print('connected')
conn.subscribe(destination=dest, ack='auto', headers={})
print('subscribed')

message = 'hi'

headers = {'destination':dest,
             'type':'textMessage',
             'id': str(random.randint(0,65535)),
             'routing_key':'xxxxxx'}
conn.send(message=message, destination=dest,headers=headers,ack='auto')
print('sent message')
time.sleep(2)
print('slept')
conn.disconnect()
print('disconnected')

########################## rabbitmq logging 
#######################################

=INFO REPORT==== 15-Jun-2011::10:22:27 ===
accepted TCP connection on 0.0.0.0:61614 from 192.168.0.30:64098

=ERROR REPORT==== 15-Jun-2011::10:22:27 ===
SSL: hello: ./ssl_handshake.erl:247:Fatal error: internal error

=ERROR REPORT==== 15-Jun-2011::10:22:27 ===
** Generic server <0.531.0> terminating
** Last message in was {inet_async,#Port<0.5451>,572,{ok,#Port<0.6286>}}
** When Server state == {state,
                             {rabbit_stomp_sup,start_ssl_client,
                                 [[{verify,verify_none},
                                   {fail_if_no_peer_cert,false}]]},
                             #Port<0.5451>,572}
** Reason for termination ==
** {{badmatch,{error,{ssl_upgrade_error,"internal error"}}},
     [{rabbit_stomp_sup,start_ssl_client,2},
      {tcp_acceptor,handle_info,2},
      {gen_server,handle_msg,5},
      {proc_lib,init_p_do_apply,3}]}
##################################################################################

From michael.s.klishin at gmail.com  Wed Jun 15 17:10:01 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 15 Jun 2011 20:10:01 +0400
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 release (incl release notes)
In-Reply-To: <764BAEE5A8164323A1D33B8273B4B1C6@myyearbook.com>
References: <7cac6df08d9c98cf27ed2dfdba9ae7b2@rabbitmq.com>
	<2456589E7567411A866048090FCDBD1B@gmail.com>
	<764BAEE5A8164323A1D33B8273B4B1C6@myyearbook.com>
Message-ID: <32A90D7F48F84C809AABD512843001BE@gmail.com>

Gavin M. Roy escribi?:
> That's great, any chance you can add a symlink in the brew install? The plugin dir is nested a bit deep compared to the normal source based install.
> 
> /usr/local/Cellar/rabbitmq/2.5.0/lib/rabbitmq/erlang/lib/rabbitmq-2.5.0/plugins
> 
> to
> 
> /usr/local/Cellar/rabbitmq/2.5.0/plugins
Gavin,

This is a good idea. I also wanted to add switches that will install plugins. We will see what I can do.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin

From simon at rabbitmq.com  Wed Jun 15 17:11:38 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 15 Jun 2011 17:11:38 +0100
Subject: [rabbitmq-discuss] 2.5.0 stomp ssl Windows 2008R2
In-Reply-To: <4DF8D81F.60306@pfgltd.com>
References: <4DF8D81F.60306@pfgltd.com>
Message-ID: <4DF8D9BA.4040409@rabbitmq.com>

On 15/06/11 17:04, Sam Domonkos wrote:
> I know this is not in the docs yet, but I see some unit tests using ssl
> with stomp so just seeing if this is fully functional as of 2.5.0.

It should be functional.

> ################ rabbitmq.config #################################
> [
> {rabbitmq_stomp, [{ssl_listeners, [61614]}]},
> {rabbit, [
> {ssl_listeners, [5671]},
> {ssl_options, [{verify,verify_none},
> {fail_if_no_peer_cert,false}]}
> ]}
> ].

In ssl_options you need to point to your cert files as described here:

http://www.rabbitmq.com/ssl.html#enabling-ssl

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Jun 15 17:14:21 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 15 Jun 2011 17:14:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <BANLkTimuDuK15j-B8PEZ11iWzWBtVrmJ1Q@mail.gmail.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>	<4DF87C4C.3010402@rabbitmq.com>	<BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>	<4DF89181.7010605@rabbitmq.com>	<BANLkTinpXYu6k9mv=MFx6rXfXoVDVPWuGQ@mail.gmail.com>	<4DF8A8B7.4010809@rabbitmq.com>	<BANLkTinA3YG-qnQEEx_RpchRLqNhwsdSjw@mail.gmail.com>	<4DF8C9B7.3010908@rabbitmq.com>
	<BANLkTimuDuK15j-B8PEZ11iWzWBtVrmJ1Q@mail.gmail.com>
Message-ID: <4DF8DA5D.2010206@rabbitmq.com>

Hi,

Rabbit preserves order of messages under strict conditions, as
discussed. Your case does not meet those conditions, so the ordering
guarantees do not apply. The current version of rabbit (2.5.0 at the
time of writing) will therefore not deliver those messages in order
(unless the queue happens to be empty when requeues take place).
Unfortunately stopping the producer will not change that.

You could try to meet the conditions under which the broker preserves
message order or you could detect the problem and attempt to deal with
it downstream.


-Emile


On 15/06/11 16:31, T-zex wrote:
> Tanks again!
> 
> So, in case we detect that current message sequence number is bigger
> than expected do we need to loop through the queue untill the required
> message is found? Does this mean that producer must be stopped,
> because all other messages in front of the queue will become unacked
> and will go back to the queue and new ones will appear at the front -
> basically to avoid shuffling.
> 
> 
> 
> On Wed, Jun 15, 2011 at 4:03 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>> Hi,
>>
>> Message order guarantees only apply along the same path between a single
>> producer and consumer. The guarantees do not hold if messages get
>> requeued. Rabbit will requeue messages at the back of the queue, i.e.
>> treat it as a new message.
>>
>> Your producer may add a sequence number to messages so that consumers
>> can detect this. Consumers may also inspect the "redelivered" flag to
>> check whether a message has been delivered before.
>>
>>
>> -Emile
>>
>>
>> On 15/06/11 15:34, T-zex wrote:
>>> Thank you Emile.
>>>
>>> The thing I'm trying to solve is have a guaranteed order of messages:
>>> if I fail to ack after BasicGet() the message anyway will go to the
>>> end of the queue. In case noAck = true, there is a risk to lose a
>>> message when a process fails. I can't find a way to make RabbitMQ work
>>> as a queue in a simple single reader scenario...
>>>
>>> On Wed, Jun 15, 2011 at 1:42 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>>>> Hi,
>>>>
>>>> Yes, if you want to retrieve a single message synchronously then use
>>>> IModel.BasicGet() . BasicConsume() is for asynchronous delivery of
>>>> messages, which is faster than BasicGet() and often leads to simpler
>>>> client code.
>>>>
>>>>
>>>>
>>>> On 15/06/11 13:35, T-zex wrote:
>>>>> In my case it doesn't matter if it is IModel.Close() or
>>>>> IModel.ChannelFlow(false) couse the process must be terminated anyway.
>>>>> We need an atomic operation which would ack the message and would not
>>>>> fetch the other one. It seems that BasicConsume is unable to gurantee
>>>>> that, so maybe BasicGet is a better option?
>>>>>
>>>>> On Wed, Jun 15, 2011 at 12:03 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>>>>>> Hi,
>>>>>>
>>>>>> Prefetch count limits the number of unacknowledged messages, so you
>>>>>> would need to acknowledge the last message to get the next one if the
>>>>>> prefetch count was set to 1.
>>>>>>
>>>>>> You should never need to close the channel for flow control. You can use
>>>>>> IModel.ChannelFlow() if you need to temporarily stop the broker from
>>>>>> delivering messages. This works independently from the prefetch count.
>>>>>>
>>>>>>
>>>>>> -Emile
>>>>>>
>>>>>>
>>>>>> On 15/06/11 10:55, T-zex wrote:
>>>>>>> Thank you!
>>>>>>>
>>>>>>> When prefetch count is set to 1 channel will try to fetch the next
>>>>>>> message as soon as HandleBasicDeliver returns? Should I invoke
>>>>>>> Channel.Close() on a different thread (to avoid blocking) and then
>>>>>>> return?
>>>>>>>
>>>>>>> On Wed, Jun 15, 2011 at 10:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>>>>>>>> Hi,
>>>>>>>>
>>>>>>>> On 15/06/11 10:08, T-zex wrote:
>>>>>>>>> Hi,
>>>>>>>>>
>>>>>>>>> We are overriding DefaultBasicConsumer.HandleBasicDeliver method and
>>>>>>>>> use IModel.BasicConsume to subscribe to incoming messages:
>>>>>>>>> model.BasicConsume(queue, false, instanceOfDerivedConsumer);
>>>>>>>>>
>>>>>>>>> When application fails to ack a message that message is requeued. How
>>>>>>>>> can I guarantee that BasicConsume is receiving one message at a time?
>>>>>>>>> How to deterministically stop consuming when application detects that
>>>>>>>>> it is unable to process a message and prevent the second message from
>>>>>>>>> arriving? How to make sure that there is one and only one unacked
>>>>>>>>> message and that message is at the peak of broker queue.
>>>>>>>>
>>>>>>>> The solution is to set the prefetch count of the channel to 1 using
>>>>>>>> IModel.BasicQos(). Also see
>>>>>>>> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos .
>>>>>>>> Note that rabbit does not implement the prefetch size or global
>>>>>>>> parameters to the same method.

From simone.busoli at gmail.com  Wed Jun 15 20:36:17 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 15 Jun 2011 21:36:17 +0200
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <4DF8DA5D.2010206@rabbitmq.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>
	<4DF87C4C.3010402@rabbitmq.com>
	<BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>
	<4DF89181.7010605@rabbitmq.com>
	<BANLkTinpXYu6k9mv=MFx6rXfXoVDVPWuGQ@mail.gmail.com>
	<4DF8A8B7.4010809@rabbitmq.com>
	<BANLkTinA3YG-qnQEEx_RpchRLqNhwsdSjw@mail.gmail.com>
	<4DF8C9B7.3010908@rabbitmq.com>
	<BANLkTimuDuK15j-B8PEZ11iWzWBtVrmJ1Q@mail.gmail.com>
	<4DF8DA5D.2010206@rabbitmq.com>
Message-ID: <BANLkTik835JM=-NJPY-_6gH2PfQ=mhntSA@mail.gmail.com>

I'd say that if you need strict ordering then the subscriber will have to
handle that, perhaps by caching incoming messages as soon as it detects a
hole in the sequence flow and starting to process once again once the
missing message has been processed. This gets messy soon, however, if you
happen to lose another message while you are already waiting for the first
one. And so on, recursively.

Are there any other approaches to achieve ordering guarantees?
On Jun 15, 2011 6:14 PM, "Emile Joubert" <emile at rabbitmq.com> wrote:
> Hi,
>
> Rabbit preserves order of messages under strict conditions, as
> discussed. Your case does not meet those conditions, so the ordering
> guarantees do not apply. The current version of rabbit (2.5.0 at the
> time of writing) will therefore not deliver those messages in order
> (unless the queue happens to be empty when requeues take place).
> Unfortunately stopping the producer will not change that.
>
> You could try to meet the conditions under which the broker preserves
> message order or you could detect the problem and attempt to deal with
> it downstream.
>
>
> -Emile
>
>
> On 15/06/11 16:31, T-zex wrote:
>> Tanks again!
>>
>> So, in case we detect that current message sequence number is bigger
>> than expected do we need to loop through the queue untill the required
>> message is found? Does this mean that producer must be stopped,
>> because all other messages in front of the queue will become unacked
>> and will go back to the queue and new ones will appear at the front -
>> basically to avoid shuffling.
>>
>>
>>
>> On Wed, Jun 15, 2011 at 4:03 PM, Emile Joubert <emile at rabbitmq.com>
wrote:
>>> Hi,
>>>
>>> Message order guarantees only apply along the same path between a single
>>> producer and consumer. The guarantees do not hold if messages get
>>> requeued. Rabbit will requeue messages at the back of the queue, i.e.
>>> treat it as a new message.
>>>
>>> Your producer may add a sequence number to messages so that consumers
>>> can detect this. Consumers may also inspect the "redelivered" flag to
>>> check whether a message has been delivered before.
>>>
>>>
>>> -Emile
>>>
>>>
>>> On 15/06/11 15:34, T-zex wrote:
>>>> Thank you Emile.
>>>>
>>>> The thing I'm trying to solve is have a guaranteed order of messages:
>>>> if I fail to ack after BasicGet() the message anyway will go to the
>>>> end of the queue. In case noAck = true, there is a risk to lose a
>>>> message when a process fails. I can't find a way to make RabbitMQ work
>>>> as a queue in a simple single reader scenario...
>>>>
>>>> On Wed, Jun 15, 2011 at 1:42 PM, Emile Joubert <emile at rabbitmq.com>
wrote:
>>>>> Hi,
>>>>>
>>>>> Yes, if you want to retrieve a single message synchronously then use
>>>>> IModel.BasicGet() . BasicConsume() is for asynchronous delivery of
>>>>> messages, which is faster than BasicGet() and often leads to simpler
>>>>> client code.
>>>>>
>>>>>
>>>>>
>>>>> On 15/06/11 13:35, T-zex wrote:
>>>>>> In my case it doesn't matter if it is IModel.Close() or
>>>>>> IModel.ChannelFlow(false) couse the process must be terminated
anyway.
>>>>>> We need an atomic operation which would ack the message and would not
>>>>>> fetch the other one. It seems that BasicConsume is unable to gurantee
>>>>>> that, so maybe BasicGet is a better option?
>>>>>>
>>>>>> On Wed, Jun 15, 2011 at 12:03 PM, Emile Joubert <emile at rabbitmq.com>
wrote:
>>>>>>> Hi,
>>>>>>>
>>>>>>> Prefetch count limits the number of unacknowledged messages, so you
>>>>>>> would need to acknowledge the last message to get the next one if
the
>>>>>>> prefetch count was set to 1.
>>>>>>>
>>>>>>> You should never need to close the channel for flow control. You can
use
>>>>>>> IModel.ChannelFlow() if you need to temporarily stop the broker from
>>>>>>> delivering messages. This works independently from the prefetch
count.
>>>>>>>
>>>>>>>
>>>>>>> -Emile
>>>>>>>
>>>>>>>
>>>>>>> On 15/06/11 10:55, T-zex wrote:
>>>>>>>> Thank you!
>>>>>>>>
>>>>>>>> When prefetch count is set to 1 channel will try to fetch the next
>>>>>>>> message as soon as HandleBasicDeliver returns? Should I invoke
>>>>>>>> Channel.Close() on a different thread (to avoid blocking) and then
>>>>>>>> return?
>>>>>>>>
>>>>>>>> On Wed, Jun 15, 2011 at 10:33 AM, Emile Joubert <emile at rabbitmq.com>
wrote:
>>>>>>>>> Hi,
>>>>>>>>>
>>>>>>>>> On 15/06/11 10:08, T-zex wrote:
>>>>>>>>>> Hi,
>>>>>>>>>>
>>>>>>>>>> We are overriding DefaultBasicConsumer.HandleBasicDeliver method
and
>>>>>>>>>> use IModel.BasicConsume to subscribe to incoming messages:
>>>>>>>>>> model.BasicConsume(queue, false, instanceOfDerivedConsumer);
>>>>>>>>>>
>>>>>>>>>> When application fails to ack a message that message is requeued.
How
>>>>>>>>>> can I guarantee that BasicConsume is receiving one message at a
time?
>>>>>>>>>> How to deterministically stop consuming when application detects
that
>>>>>>>>>> it is unable to process a message and prevent the second message
from
>>>>>>>>>> arriving? How to make sure that there is one and only one unacked
>>>>>>>>>> message and that message is at the peak of broker queue.
>>>>>>>>>
>>>>>>>>> The solution is to set the prefetch count of the channel to 1
using
>>>>>>>>> IModel.BasicQos(). Also see
>>>>>>>>> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos .
>>>>>>>>> Note that rabbit does not implement the prefetch size or global
>>>>>>>>> parameters to the same method.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110615/acfe7080/attachment-0001.htm>

From josh at gebaschtel.ch  Wed Jun 15 22:36:43 2011
From: josh at gebaschtel.ch (Josh Geisser)
Date: Wed, 15 Jun 2011 23:36:43 +0200
Subject: [rabbitmq-discuss] sequence of consumation (was: Message
	Aggregating Queue)
In-Reply-To: <BANLkTinrLhhrO8jOCqeBkdRGDyfsvWfNpg@mail.gmail.com>
References: <9C37154E143FE14CBA656B2D2232745F080CACC1E145@popeye.gebaschtel.bnet>
	<BANLkTinrLhhrO8jOCqeBkdRGDyfsvWfNpg@mail.gmail.com>
Message-ID: <9C37154E143FE14CBA656B2D2232745F088AE856B8F8@popeye.gebaschtel.bnet>

Sorry coming back to this old "information-aggregation" topic, still hanging on the stack-idea of message consuming. 

As far as my horizon goes, queuing ('keeping') of messages happens in two cases:

1) no consumer at queue arrival: message (persistent) is stored on a queue which is picked up later in a e.g. eod-job, or when the consumer becomes available. Most important thing is that it will eventually delivered.

2) Consumer present at queue arrival: en-queuing will only happen in this case when the consumer is busy, -> a client which you want to buffer for him -> en-queue 


I understand that the mechanism of en-queuing and de-queuing is done anyway, but in an ideal world(2) you have <=1 msg in your queue.

This is not always possible, depending on various factors, so the great thing of MQ is queuing.


At the very top of my head, I'd think of the following scenarios of how information arrive to me in which ways:

A) Girlfriend likes to have a call-back, left a voice box on queue 'home', 
   Before this, queue has items like "feed dog", "bring out the trash", etc

B) Some friends are chatting about the latest news, into queue 'gossip'

C) Football plays are going on, sending me every goal via queue 'sport'.
   

Scenario A) is late-consuming, I'll read queue 'home' when I arrive at home. Sequential retrieval will make sure the dog survives, but not specified in this case

Scenario B) is 'trying to keep up realtime'. Can't look at the chatroom all the time, but when i can, I can read the messages I missed. As long as I'm online, I stay tuned. Sequential retrieval is required for coherency.

Scenario C) is where a stack would be better than a queue: After a while you look at you mobile inbox: 
...
21:32 subje: Madr-Berl  
21:49 subje: Madr-Berl 
21:57 subje: Roma-Live 
22:01 subje: Madr-Berl 
22:10 subje: Roma-Live 

The only two messages you will open and read the body (score) are the two latest ones. That tells you who has the lead right now(!). 
If you're curious you still can consume the earlier messages for historical purposes, or simply drop them. 

Also, while reading the older messages, the next message you consume might also just update you again on Roma-Liverpool.

This would certainly not solve aggregation, but would give the consumer a chance to stay as updated as possible. 

Just some thoughts & Cheers
Josh



-----Urspr?ngliche Nachricht-----
Von: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com] Im Auftrag von Alexis Richardson
Gesendet: Dienstag, 3. Mai 2011 07:34
An: Josh Geisser
Cc: rabbitmq-discuss at lists.rabbitmq.com
Betreff: Re: [rabbitmq-discuss] WG: Message Aggregating Queue

I'd be interested to see what semantics for "update" people on this
list would propose, that would make sense for queues.  Include the
case where messages are routed to multiple queues which have different
sets of consumers.

alexis


On Tue, May 3, 2011 at 6:26 AM, Josh Geisser <josh at gebaschtel.ch> wrote:
> Let me quickly try to understand that:
>
> You want to get the most accurate instrument-data. As long as you're not overloaded, the sequential message processing is fine (queue size <=1). The Problem occurs if you can't keep up with the producers (>1). Then you have the case of consuming UBS at 12.3 although the very latest information (12.8) is already in the queue, but not yet processed, right?
>
> A na?ve way to overcome that would be a Stack/FILO instead of a queue, not? Instead of consuming the next message, you'd consume the most recent one.
> This way you get 12.8 before 12.3.
>
> Of coarse this imposes that you have to take care of which tick is which (they are time stamped, not?) when you working down the stack.
>
> The further problem of starving messages could be reduced if the broker could kind of match and remove out-dated messages on a same pattern.
>
> afaik not possible with rabbit :(
>
> My 2 cents :)
>
> Cheers
> Josh
>
>
> -----Urspr?ngliche Nachricht-----
> Von: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] Im Auftrag von Jason Zaugg
> Gesendet: Donnerstag, 28. April 2011 16:18
> An: Irmo Manie
> Cc: Alexis Richardson; rabbitmq-discuss at lists.rabbitmq.com
> Betreff: Re: [rabbitmq-discuss] Message Aggregating Queue
>
> On Thu, Apr 28, 2011 at 3:44 PM, Irmo Manie <irmo.manie at gmail.com> wrote:
>> The problem is actually a bit more tricky than this. When it comes to
>> market data you would route all the data to a client specific
>> exclusive queue based on a subscription because every client has its
>> own authorization, authentication and quality of service. (real-time,
>> delayed, only eu stocks, tick by tick, tick only every minute, etc,
>> etc).
>
> But each client specific queue could implement the 'obsolete tick'
> discarding in the broker, right?
>
>> So the easy way is still just to have the consumer do the filtering
>> itself by storing all messages in a key value store and empty this
>> based on a ordered queue of ids to process.
>> That way the consumer can 'consume' as fast as it can put the values
>> in the K/V store which probably always is fast enough :-)
>
> I would feel more comfortable knowing that the number of messages in
> the broker is naturally bounded, even if the consumer misbehaves. It
> would also be nice to have the possibility to have a pool of consumers
> processing from a single queue, be able to restart the consumers
> without losing unprocessed messages etc. Anyway, we should discuss
> this some more internally; as always these sort of cats are amenable
> to being skinned in multitude of ways :)
>
>> Only if you can process the data (ticks) independently from each other
>> it makes sense to have this filtering on the broker because then it
>> would be useful for a cluster of consumers apps processing the data.
>> But 9 out of 10 times you need the ticks of more than one instrument
>> to do your business logic so you'd already keep a cache with the last
>> values anyway.
>
>> Still there could be other usecases of course where having this
>> functionality at the broker can be really useful and powerful.
>
>> /2cents
>
> And well worth both of them :)
>
> -jason
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> -----Urspr?ngliche Nachricht-----
>
> Among other things, we're using RabbitMQ to distribute market data ticks. The interesting characteristic about this stream of messages is that a new tick for a obsoletes previous, unprocessed, ticks for the same stock.
>
> After a little brainstorming last night with Alvaro Videla, I'm curious to discuss how this could be modeled with an extension to RabbitMQ.
>
> It seems a similar problem to the Queue Based TTL [1], however TTL isn't quite right for this case, as the validity period of a tick depends on the liquidity of the stock. We really just want the
> *latest* tick.
>
> Assume a message stream:
>
> 1. Tick { stock = "UBS", bid = 12.3 } ? RK="tick.UBS"
> 2. Tick { stock = "ABB", bid = 15.3 } ?RK="tick.ABB"
> 3. Tick { stock = "UBS", bid = 12.28 } RK="tick.UBS"
>
> These are sent to a fanout exchange, and on to a queue(s) for a Consumer(s). Assume that consumer is slow, and the messages are not processed immediately. Rather than just en queuing message #3, I would like to insert it in place of message #1.
>
> This has the nice property that the broker won't overrun with messages if the consumer can't keep up; and that the consumer doesn't do work that is obsolete.
>
> What would be the suitable way to identify that #1 and #3 refer to the same stock? Is the routing key of message #1 retained after it has been en queued?
>
> An generalization of this would be to provide a function that takes the old and new message and combines them into an aggregated message.
> For example, we might want to track the latest, min and max:
>
> ?AggregatedTick { stock = "UBS", latestBid = 12.28 minBid=12.28 maxBid=12.30 }
>
> So, does this sound sensible and possible?
>
> -jason
>
> [1] http://www.rabbitmq.com/extensions.html#queue-ttl
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From Jason.Klassen at protegra.com  Wed Jun 15 22:51:00 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Wed, 15 Jun 2011 21:51:00 +0000
Subject: [rabbitmq-discuss] use rabbit.config file to start multiple nodes
Message-ID: <676E1597FDBED54694CBA16B69DE71C302DF03@PTGMAIL02v.protegra.com>

Hi,

I'd like to use the rabbitmq.config file and rabbitmq-server.bat to start 2 nodes with a single call to rabbitmq-server.bat.  From the information on clustering it sounds like this should be possible.  My desired setup is:

Node 1:
Nodename = Writer
IP = localhost
Port = 4444

Node 2:
Nodename = Reader
IP = 127.0.0.1
Port = 5555

I have it to the point now where I can configure multiple tcp listeners but that still gives me the default node of "rabbit" and the intent is to have 2 separate nodes.  Separate nodes are preferable over vhost solutions for better isolation.

My rabbitmq.config file currently looks like this:

[
    {rabbit, [{tcp_listeners,[{"localhost", 4444}]}]}
].

How do I set the nodename through the config file?  How can I set 2 nodes in a single config file?  I am trying to avoid setting environment variables as this solution should be easily run by other developers and a config file removes the chance of typos.

Thanks,
Jason Klassen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110615/c6ac16c7/attachment.htm>

From christopher.rhodes at gmail.com  Wed Jun 15 17:47:35 2011
From: christopher.rhodes at gmail.com (Chris)
Date: Wed, 15 Jun 2011 09:47:35 -0700 (PDT)
Subject: [rabbitmq-discuss] message via stomp adapter crashes queue
In-Reply-To: <4DF74771.4040700@rabbitmq.com>
References: <BANLkTikYr_getudAfmNJdFRBz7dXvdxLng@mail.gmail.com>
	<4DF74771.4040700@rabbitmq.com>
Message-ID: <7cd40385-f6c2-4217-80d5-430b8c7f6b90@36g2000yqj.googlegroups.com>

>
> I'm particularly interested in knowing if there is something in the
> latest version of the adapter that is preventing you from moving. Fixing
> that will be a lot easier than backporting a fix to the pre-2.1.0 era code.
>
> Rob

Thank you for the response Rob.

Not sure exactly, but I know that if we move past 2.1.0 and the
matching stomp plugin things get worse.  I'm just the guy that has to
keep this thing running and not the developer of the stomp client
pushing data at the rabbit stomp adapter or the clients on the other
side doing amqp.  I'll try again to get the details on what's keeping
us stuck at this version.

In the meantime this is what we see when the Queue goes away:

10:49 < arreyder> =ERROR REPORT==== 15-Jun-2011::15:46:12 ===
10:49 < arreyder> STOMP error frame sent:
10:49 < arreyder> Message: "Invalid frame"
10:49 < arreyder> Detail: "Could not parse frame\n"
10:49 < arreyder> Server private detail:
{bad_header_key,"destinaSEND"}
10:49 < arreyder> "detinaSEND"
10:51 < arreyder> here's the one from just before that one:
10:51 < arreyder> =ERROR REPORT==== 15-Jun-2011::15:31:11 ===
10:51 < arreyder> STOMP error frame sent:
10:51 < arreyder> Message: "Invalid frame"
10:51 < arreyder> Detail: "Could not parse frame\n"
10:51 < arreyder> Server private detail:
{bad_header_key,"destinationSEND"}

I've verified on the wire (packet captures) that the message headers
do not look like how they are logged there.  They appear correctly
sent.

crr

From christopher.rhodes at gmail.com  Wed Jun 15 18:17:00 2011
From: christopher.rhodes at gmail.com (Chris)
Date: Wed, 15 Jun 2011 10:17:00 -0700 (PDT)
Subject: [rabbitmq-discuss] message via stomp adapter crashes queue
In-Reply-To: <4DF74771.4040700@rabbitmq.com>
References: <BANLkTikYr_getudAfmNJdFRBz7dXvdxLng@mail.gmail.com>
	<4DF74771.4040700@rabbitmq.com>
Message-ID: <fa488f29-ba39-4fe0-9f7b-2e3a6970827b@v8g2000yqb.googlegroups.com>

On Jun 14, 6:35?am, Rob Harrop <r... at rabbitmq.com> wrote:
> What exactly is the problem? The shortened URL seems to be disabled for
> spam ;)


Here's the full link to the previous thread that I think is related to
the bug we are hitting.

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011071.html

crr


From toby.corkindale at strategicdata.com.au  Thu Jun 16 02:14:16 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Thu, 16 Jun 2011 11:14:16 +1000
Subject: [rabbitmq-discuss] RabbitMQ as a reliable message queue
In-Reply-To: <4DF88154.8060101@rabbitmq.com>
References: <BANLkTi=t1G2KhHq1yKYNaAG9bo1HkLtN_A@mail.gmail.com>	<BANLkTi=QDJg-6QOsu5vTiFJVRiBuvYVRkA@mail.gmail.com>
	<4DF88154.8060101@rabbitmq.com>
Message-ID: <4DF958E8.8040800@strategicdata.com.au>

On 15/06/11 19:54, Emile Joubert wrote:
> On 14/06/11 17:08, Jason J. W. Williams wrote:
>>> Is it possible to use RabbitMQ as a reliable message queue? What I
>>> mean is to make it preserve the order of messages in queues even for
>>> non ack'ed durable messages.
>>> Putting non acked messages into the end of the queue just doesn't make sence.
>>
>> Actually, it would be difficult to preserve the order in the case of
>> non-ack. Let's say you've got M1, M2, M3, M4 in the queue (like the
>> FAQ describes). If you have two consumers, and C1 is consuming M1 and
>> C2 is consuming M2. C1 finishes, acks M1 and starts consuming M3.
>> However, C2 fails and disconnects without acking M2, where should M2
>> go in the order? M3 is already being consumed. The only sane approach
>> is to treat M2 as a new submission and append it to the end of the
>> queue.
>
> Yes, it is not obvious how to requeue in the presence of multiple
> consumers. But it is possible to do better in the case of a single
> consumer where the inconsistency can't arise. At present rabbit always
> requeues at the back of the queue, i.e. treat it as a new message. This
> is consistent with the spec which only guarantees ordering along the
> same path from a single producer to a single consumer.

I quite like the "send to the back of the queue" behaviour.
In the event of a bad message that is always failing/crashing on the 
consumer, it'll get pushed to the back of the queue to allow other good 
messages to be processed.

In a system where the messages are always delivered in-order, that bad 
message would effectively lock the system up.

Toby

From yaohui1984 at qq.com  Thu Jun 16 07:13:14 2011
From: yaohui1984 at qq.com (=?ISO-8859-1?B?eWFvaHVp?=)
Date: Thu, 16 Jun 2011 14:13:14 +0800
Subject: [rabbitmq-discuss] erlang client problem?
Message-ID: <tencent_4D9EB80E1F71141E2DDE2FDD@qq.com>

hi,
  
 I use erlang client connecting to rabbitmq broker, when i stop rabbitmq server , in the side of  erlang client, there is a error log, but the client  can send the message all the same without error?
  
 log is like this 
  
 Sending......
Satus:ok.
 =ERROR REPORT==== 16-Jun-2011::13:55:34 ===
** Generic server <0.38.0> terminating 
** Last message in was socket_closed
** When Server state == {state,amqp_network_connection,
                            {state,#Port<0.771>,0,<0.44.0>,131072,
                                {server_initiated_close,320,
                                    <<"CONNECTION_FORCED - broker forced connection closure with reason 'shutdown'">>},
                                false},
                            <0.37.0>,<0.40.0>,
                            {amqp_params_network,<<"goomemq">>,
                                <<"erlang2goomemq">>,<<"/">>,"localhost",5672,
                                0,0,0,none,
                                [#Fun<amqp_auth_mechanisms.plain.3>,
                                 #Fun<amqp_auth_mechanisms.amqplain.3>],
                                []},
                            0,
                            [{<<"capabilities">>,table,
                              [{<<"publisher_confirms">>,bool,true},
                               {<<"exchange_exchange_bindings">>,bool,true},
                               {<<"basic.nack">>,bool,true},
                               {<<"consumer_cancel_notify">>,bool,true}]},
                             {<<"copyright">>,longstr,
                              <<"Copyright (C) 2007-2011 VMware, Inc.">>},
                             {<<"information">>,longstr,
                              <<"Licensed under the MPL.  See http://www.rabbitmq.com/">>},
                             {<<"platform">>,longstr,<<"Erlang/OTP">>},
                             {<<"product">>,longstr,<<"RabbitMQ">>},
                             {<<"version">>,longstr,<<"2.4.0">>}],
                            #Fun<amqp_connection_sup.0.39273983>,
                            #Fun<amqp_connection_sup.2.54430129>,
                            {closing,server_initiated_close,
                                {'connection.close',320,
                                    <<"CONNECTION_FORCED - broker forced connection closure with reason 'shutdown'">>,
                                    0,0},
                                none}}
** Reason for termination == 
** socket_closed_unexpectedly
 Sending......
Satus:ok.
  
  
 my code is like this:
 sendmq() ->
     {ok,Conn1} = amqp_connection:start(#amqp_params_network{username= <<"guest">> ,password= <<"guest">> }),
    {ok,C1} = amqp_connection:open_channel(Conn1),
    Q1 = #'queue.declare'{queue = <<"goome_queue1">>}, #'queue.declare_ok'{}  = amqp_channel:call(C1, Q1),
    E1 = #'exchange.declare'{exchange = <<"goome_exchange1">>}, #'exchange.declare_ok'{} = amqp_channel:call(C1, E1),
    B1 = #'queue.bind'{queue = <<"goome_queue1">>,
                                exchange = <<"goome_exchange1">>,
                                routing_key = <<"goomeRk1">>},
     #'queue.bind_ok'{} = amqp_channel:call(C1, B1),
    P1 = #'basic.publish'{exchange = <<"goome_exchange1">>, routing_key = <<"goomeRk1">>},
         loop(C1,P1).
  
 loop(Channel,Publish)->
        io:format("Sending......~n"),
        Status = amqp_channel:cast(Channel, Publish, #amqp_msg{payload = <<"test">>}),
        io:format("Satus:~p.~n",[Status]),
        timer:sleep(1000),
        loop(Channel,Publish).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110616/3e005ed5/attachment.htm>

From tranzenziuzex at gmail.com  Thu Jun 16 09:14:16 2011
From: tranzenziuzex at gmail.com (T-zex)
Date: Thu, 16 Jun 2011 09:14:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ as a reliable message queue
In-Reply-To: <4DF958E8.8040800@strategicdata.com.au>
References: <BANLkTi=t1G2KhHq1yKYNaAG9bo1HkLtN_A@mail.gmail.com>
	<BANLkTi=QDJg-6QOsu5vTiFJVRiBuvYVRkA@mail.gmail.com>
	<4DF88154.8060101@rabbitmq.com>
	<4DF958E8.8040800@strategicdata.com.au>
Message-ID: <BANLkTikxdi30FBBTuMC7-jJr1h1B8Qu1Tw@mail.gmail.com>

Unexpected shut down of a process (power failure) will result in
"good" message being put to the end of the queue - a very unexpected
behaviour. In case of a "bad" message application should decide that
it is bad and what should be done with it - requeue (unlikely) or get
rid of it.

On Thu, Jun 16, 2011 at 2:14 AM, Toby Corkindale
<toby.corkindale at strategicdata.com.au> wrote:
> On 15/06/11 19:54, Emile Joubert wrote:
>>
>> On 14/06/11 17:08, Jason J. W. Williams wrote:
>>>>
>>>> Is it possible to use RabbitMQ as a reliable message queue? What I
>>>> mean is to make it preserve the order of messages in queues even for
>>>> non ack'ed durable messages.
>>>> Putting non acked messages into the end of the queue just doesn't make
>>>> sence.
>>>
>>> Actually, it would be difficult to preserve the order in the case of
>>> non-ack. Let's say you've got M1, M2, M3, M4 in the queue (like the
>>> FAQ describes). If you have two consumers, and C1 is consuming M1 and
>>> C2 is consuming M2. C1 finishes, acks M1 and starts consuming M3.
>>> However, C2 fails and disconnects without acking M2, where should M2
>>> go in the order? M3 is already being consumed. The only sane approach
>>> is to treat M2 as a new submission and append it to the end of the
>>> queue.
>>
>> Yes, it is not obvious how to requeue in the presence of multiple
>> consumers. But it is possible to do better in the case of a single
>> consumer where the inconsistency can't arise. At present rabbit always
>> requeues at the back of the queue, i.e. treat it as a new message. This
>> is consistent with the spec which only guarantees ordering along the
>> same path from a single producer to a single consumer.
>
> I quite like the "send to the back of the queue" behaviour.
> In the event of a bad message that is always failing/crashing on the
> consumer, it'll get pushed to the back of the queue to allow other good
> messages to be processed.
>
> In a system where the messages are always delivered in-order, that bad
> message would effectively lock the system up.
>
> Toby
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From toby.corkindale at strategicdata.com.au  Thu Jun 16 09:17:10 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Thu, 16 Jun 2011 18:17:10 +1000
Subject: [rabbitmq-discuss] RabbitMQ as a reliable message queue
In-Reply-To: <BANLkTikxdi30FBBTuMC7-jJr1h1B8Qu1Tw@mail.gmail.com>
References: <BANLkTi=t1G2KhHq1yKYNaAG9bo1HkLtN_A@mail.gmail.com>	<BANLkTi=QDJg-6QOsu5vTiFJVRiBuvYVRkA@mail.gmail.com>	<4DF88154.8060101@rabbitmq.com>	<4DF958E8.8040800@strategicdata.com.au>
	<BANLkTikxdi30FBBTuMC7-jJr1h1B8Qu1Tw@mail.gmail.com>
Message-ID: <4DF9BC06.1030803@strategicdata.com.au>

On 16/06/11 18:14, T-zex wrote:
> Unexpected shut down of a process (power failure) will result in
> "good" message being put to the end of the queue - a very unexpected
> behaviour. In case of a "bad" message application should decide that
> it is bad and what should be done with it - requeue (unlikely) or get
> rid of it.

In an ideal world, yes, but in practice it's much better to assume the 
worst.

> On Thu, Jun 16, 2011 at 2:14 AM, Toby Corkindale
> <toby.corkindale at strategicdata.com.au>  wrote:
>> On 15/06/11 19:54, Emile Joubert wrote:
>>>
>>> On 14/06/11 17:08, Jason J. W. Williams wrote:
>>>>>
>>>>> Is it possible to use RabbitMQ as a reliable message queue? What I
>>>>> mean is to make it preserve the order of messages in queues even for
>>>>> non ack'ed durable messages.
>>>>> Putting non acked messages into the end of the queue just doesn't make
>>>>> sence.
>>>>
>>>> Actually, it would be difficult to preserve the order in the case of
>>>> non-ack. Let's say you've got M1, M2, M3, M4 in the queue (like the
>>>> FAQ describes). If you have two consumers, and C1 is consuming M1 and
>>>> C2 is consuming M2. C1 finishes, acks M1 and starts consuming M3.
>>>> However, C2 fails and disconnects without acking M2, where should M2
>>>> go in the order? M3 is already being consumed. The only sane approach
>>>> is to treat M2 as a new submission and append it to the end of the
>>>> queue.
>>>
>>> Yes, it is not obvious how to requeue in the presence of multiple
>>> consumers. But it is possible to do better in the case of a single
>>> consumer where the inconsistency can't arise. At present rabbit always
>>> requeues at the back of the queue, i.e. treat it as a new message. This
>>> is consistent with the spec which only guarantees ordering along the
>>> same path from a single producer to a single consumer.
>>
>> I quite like the "send to the back of the queue" behaviour.
>> In the event of a bad message that is always failing/crashing on the
>> consumer, it'll get pushed to the back of the queue to allow other good
>> messages to be processed.
>>
>> In a system where the messages are always delivered in-order, that bad
>> message would effectively lock the system up.
>>
>> Toby
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>


-- 
.signature

From matthew at rabbitmq.com  Thu Jun 16 10:32:45 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 16 Jun 2011 10:32:45 +0100
Subject: [rabbitmq-discuss] erlang client problem?
In-Reply-To: <tencent_4D9EB80E1F71141E2DDE2FDD@qq.com>
References: <tencent_4D9EB80E1F71141E2DDE2FDD@qq.com>
Message-ID: <20110616093244.GA8195@rabbitmq.com>

On Thu, Jun 16, 2011 at 02:13:14PM +0800, yaohui wrote:
>  loop(Channel,Publish)->
>         io:format("Sending......~n"),
>         Status = amqp_channel:cast(Channel, Publish, #amqp_msg{payload = <<"test">>}),

Cast doesn't care whether or not the destination process (the channel in
this case) exists or has died. Your best bet is to monitor or link to
the channel after creating in, and then you'll be informed when it dies.

Matthew

From yaohui1984 at qq.com  Thu Jun 16 10:50:31 2011
From: yaohui1984 at qq.com (=?ISO-8859-1?B?eWFvaHVp?=)
Date: Thu, 16 Jun 2011 17:50:31 +0800
Subject: [rabbitmq-discuss] Over memory threshold?
Message-ID: <tencent_255D12DF1DE24156347EF661@qq.com>

When there is plenty of  messages in the queues, the memory would be over a high_watermark that is 1/4 physical memory by default. after write some message to disk, the memory will below the high_watermark.
  but i found that, after it's over the hig_watermark some times, the rabbitmq do nothing though the memory is over the high_watermark. then i can't send any message to rabbitmq. why the message aren't written to disk?
  
 this is a tail of log
=INFO REPORT==== 16-Jun-2011::17:24:08 ===
vm_memory_high_watermark clear. Memory used:429337976 allowed:429496729
 =INFO REPORT==== 16-Jun-2011::17:24:08 ===
    alarm_handler: {clear,{vm_memory_high_watermark,node1 at test01}}
 =INFO REPORT==== 16-Jun-2011::17:24:09 ===
vm_memory_high_watermark set. Memory used:438883816 allowed:429496729
 =INFO REPORT==== 16-Jun-2011::17:24:09 ===
    alarm_handler: {set,{{vm_memory_high_watermark,node1 at test01},[]}}
 =INFO REPORT==== 16-Jun-2011::17:24:58 ===
vm_memory_high_watermark clear. Memory used:421535520 allowed:429496729
 =INFO REPORT==== 16-Jun-2011::17:24:58 ===
    alarm_handler: {clear,{vm_memory_high_watermark,node1 at test01}}
 =INFO REPORT==== 16-Jun-2011::17:24:59 ===
vm_memory_high_watermark set. Memory used:430383912 allowed:429496729
 =INFO REPORT==== 16-Jun-2011::17:24:59 ===
    alarm_handler: {set,{{vm_memory_high_watermark,node1 at test01},[]}}
 =INFO REPORT==== 16-Jun-2011::17:25:02 ===
vm_memory_high_watermark clear. Memory used:428755056 allowed:429496729
 =INFO REPORT==== 16-Jun-2011::17:25:02 ===
    alarm_handler: {clear,{vm_memory_high_watermark,node1 at test01}}
 =INFO REPORT==== 16-Jun-2011::17:25:03 ===
vm_memory_high_watermark set. Memory used:433435224 allowed:429496729
 =INFO REPORT==== 16-Jun-2011::17:25:03 ===
    alarm_handler: {set,{{vm_memory_high_watermark,node1 at test01},[]}}
 =INFO REPORT==== 16-Jun-2011::17:25:51 ===
vm_memory_high_watermark clear. Memory used:428601928 allowed:429496729
 =INFO REPORT==== 16-Jun-2011::17:25:51 ===
    alarm_handler: {clear,{vm_memory_high_watermark,node1 at test01}}
 =INFO REPORT==== 16-Jun-2011::17:25:52 ===
vm_memory_high_watermark set. Memory used:436017336 allowed:429496729
 =INFO REPORT==== 16-Jun-2011::17:25:52 ===
    alarm_handler: {set,{{vm_memory_high_watermark,node1 at test01},[]}}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110616/8fd654e6/attachment.htm>

From simon at rabbitmq.com  Thu Jun 16 11:07:27 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 Jun 2011 11:07:27 +0100
Subject: [rabbitmq-discuss] 2.5.0 stomp ssl Windows 2008R2
In-Reply-To: <4DF8EC2C.6070605@pfgltd.com>
References: <4DF8D81F.60306@pfgltd.com> <4DF8D9BA.4040409@rabbitmq.com>
	<4DF8EC2C.6070605@pfgltd.com>
Message-ID: <4DF9D5DF.40005@rabbitmq.com>

There aren't any common set of certificates, you need to generate your own.

There's a tutorial at:

http://www.rabbitmq.com/ssl.html#keys-and-certs

Cheers, Simon

On 15/06/11 18:30, Sam Domonkos wrote:
> Simon,
>
> Thanks, do you mind pointing me to the certificates from the tests.
>
> -Sam
>
> On 2011-06-15 11:11, Simon MacMullen wrote:
>> On 15/06/11 17:04, Sam Domonkos wrote:
>>> I know this is not in the docs yet, but I see some unit tests using ssl
>>> with stomp so just seeing if this is fully functional as of 2.5.0.
>>
>> It should be functional.
>>
>>> ################ rabbitmq.config #################################
>>> [
>>> {rabbitmq_stomp, [{ssl_listeners, [61614]}]},
>>> {rabbit, [
>>> {ssl_listeners, [5671]},
>>> {ssl_options, [{verify,verify_none},
>>> {fail_if_no_peer_cert,false}]}
>>> ]}
>>> ].
>>
>> In ssl_options you need to point to your cert files as described here:
>>
>> http://www.rabbitmq.com/ssl.html#enabling-ssl
>>
>> Cheers, Simon
>>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Jun 16 11:13:30 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 Jun 2011 11:13:30 +0100
Subject: [rabbitmq-discuss] use rabbit.config file to start multiple
	nodes
In-Reply-To: <676E1597FDBED54694CBA16B69DE71C302DF03@PTGMAIL02v.protegra.com>
References: <676E1597FDBED54694CBA16B69DE71C302DF03@PTGMAIL02v.protegra.com>
Message-ID: <4DF9D74A.4090705@rabbitmq.com>

On 15/06/11 22:51, Jason Klassen wrote:
> How do I set the nodename through the config file?

I'm afraid you can't do that. (Boring reason why: the nodename is set as 
the process starts up, before we read the config file.)

> How can I set 2 nodes in a single config file?

...and you also can't do that.

> I am trying to avoid setting environment
> variables as this solution should be easily run by other developers and
> a config file removes the chance of typos.

That makes sense. In future we might move to preprocessing the config 
file somehow so that nodename can be set that way.

Probably your best bet is to write a script to start nodes in the way 
you want.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From david at rabbitmq.com  Thu Jun 16 11:43:54 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 16 Jun 2011 11:43:54 +0100
Subject: [rabbitmq-discuss] Amazon ELB to load balance rabbitmq?
In-Reply-To: <BANLkTinEZ3_txHb08K-Hg6Uk12tM9gU0jw@mail.gmail.com> (Joe Van
	Dyk's message of "Mon, 13 Jun 2011 12:04:49 -0700")
References: <BANLkTinEZ3_txHb08K-Hg6Uk12tM9gU0jw@mail.gmail.com>
Message-ID: <yrv4cy612giol.fsf@dwragg.eng.vmware.com>

Joe Van Dyk <joe at tanga.com> writes:
> Anyone using Amazon's ELB
> (http://aws.amazon.com/elasticloadbalancing/) to LB rabbitmq?

It should be possible to load balance connections to a RabbitMQ cluster
using ELB's TCP connection load balancing.  But note that this approach
would only be appropriate for certain use cases, as you will have no
control over which node queues get stored on.  But for example, if you
have a pub-sub application, and all queues are auto-delete, then you
should be fine.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From simon at rabbitmq.com  Thu Jun 16 13:35:47 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 16 Jun 2011 13:35:47 +0100
Subject: [rabbitmq-discuss] Configuration documentation
In-Reply-To: <26C3C628B4834B79943ADD7501DB5510@gmail.com>
References: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
	<26C3C628B4834B79943ADD7501DB5510@gmail.com>
Message-ID: <4DF9F8A3.6030404@rabbitmq.com>

On 13/06/11 12:03, Michael Klishin wrote:
> I don't know how feasible is the idea of putting documentation that
> is up on rabbitmq.com into Hg repositories or on github, but at times
> I felt like "man, I wish I could just clone that and send a pull
> request/patch".

Not very right now, the website source is not public.

However, good news: I wrote a reference for the config items. Hopefully 
that helps:

http://www.rabbitmq.com/configure.html#config-items

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Thu Jun 16 13:39:11 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 16 Jun 2011 14:39:11 +0200
Subject: [rabbitmq-discuss] Configuration documentation
In-Reply-To: <4DF9F8A3.6030404@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
	<26C3C628B4834B79943ADD7501DB5510@gmail.com>
	<4DF9F8A3.6030404@rabbitmq.com>
Message-ID: <28B91B37-AA97-4B72-8FAF-71485CD5732E@gmail.com>

+1 on having the docs as some Markdown or something on Github.

On Jun 16, 2011, at 2:35 PM, Simon MacMullen wrote:

> On 13/06/11 12:03, Michael Klishin wrote:
>> I don't know how feasible is the idea of putting documentation that
>> is up on rabbitmq.com into Hg repositories or on github, but at times
>> I felt like "man, I wish I could just clone that and send a pull
>> request/patch".
> 
> Not very right now, the website source is not public.
> 
> However, good news: I wrote a reference for the config items. Hopefully that helps:
> 
> http://www.rabbitmq.com/configure.html#config-items
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From michael.s.klishin at gmail.com  Thu Jun 16 14:20:09 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 16 Jun 2011 17:20:09 +0400
Subject: [rabbitmq-discuss] Configuration documentation
In-Reply-To: <4DF9F8A3.6030404@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it>
	<26C3C628B4834B79943ADD7501DB5510@gmail.com>
	<4DF9F8A3.6030404@rabbitmq.com>
Message-ID: <AE16CDF6CAA9406F87485165AA98F2FC@gmail.com>

Simon MacMullen escribi?:
> However, good news: I wrote a reference for the config items. Hopefully 
> that helps:
> 
> http://www.rabbitmq.com/configure.html#config-items
Simon,

Thank you. This alone is a noticeable improvement. 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin

From bmurphy1976 at gmail.com  Thu Jun 16 14:55:02 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Thu, 16 Jun 2011 08:55:02 -0500
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <BANLkTinA3YG-qnQEEx_RpchRLqNhwsdSjw@mail.gmail.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>
	<4DF87C4C.3010402@rabbitmq.com>
	<BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>
	<4DF89181.7010605@rabbitmq.com>
	<BANLkTinpXYu6k9mv=MFx6rXfXoVDVPWuGQ@mail.gmail.com>
	<4DF8A8B7.4010809@rabbitmq.com>
	<BANLkTinA3YG-qnQEEx_RpchRLqNhwsdSjw@mail.gmail.com>
Message-ID: <BANLkTi=KRPvvXvRcGRjRYF_0UjMrbvJg+Q@mail.gmail.com>

Maybe RabbitMQ isn't the right solution then.  We have a queue where
everything absolutely must be processed in the correct order.  Where
do we store it?  In a transactional database, not RabbitMQ.  All of
our other queues are in RabbitMQ, but they don't have the same
requirement.

Bryan

On Wed, Jun 15, 2011 at 9:34 AM, T-zex <tranzenziuzex at gmail.com> wrote:
> Thank you Emile.
>
> The thing I'm trying to solve is have a guaranteed order of messages:
> if I fail to ack after BasicGet() the message anyway will go to the
> end of the queue. In case noAck = true, there is a risk to lose a
> message when a process fails. I can't find a way to make RabbitMQ work
> as a queue in a simple single reader scenario...

From james.r.carr at gmail.com  Thu Jun 16 14:59:38 2011
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 16 Jun 2011 08:59:38 -0500
Subject: [rabbitmq-discuss] Question on who usually manages brokers
Message-ID: <BANLkTi=hTd1OXGn_+KURpskxEXLEajOT=Q@mail.gmail.com>

Hey All,

We're prepping to do a major roll out of using rabbitmq at work and
one of the questions that has come up is who would be responsible for
owning the messaging infrastructure. Although we have some ideas I'd
be interested in hearing how other midsized companies (500-2000
employees) go about this.

Thanks,
James

From majek04 at gmail.com  Thu Jun 16 15:00:39 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 16 Jun 2011 15:00:39 +0100
Subject: [rabbitmq-discuss] Over memory threshold?
In-Reply-To: <tencent_255D12DF1DE24156347EF661@qq.com>
References: <tencent_255D12DF1DE24156347EF661@qq.com>
Message-ID: <BANLkTi=N6EXqBKWsbB0n218erWGz2mgY8g@mail.gmail.com>

On Thu, Jun 16, 2011 at 10:50, yaohui <yaohui1984 at qq.com> wrote:
> When there is plenty of? messages in the queues, the memory would be over
> a?high_watermark that is?1/4 physical memory by default. after write some
> message to disk, the memory will below the?high_watermark.
> ?but i found that,?after?it's over the hig_watermark?some times, the
> rabbitmq do nothing though the memory is over the high_watermark. then i
> can't send any message to rabbitmq. why the message aren't written to disk?

Hi,

Unfortunately it's not that simple. Rabbit does the best to free memory,
but in practice, it's not always able to do enough. For example, Rabbit doesn't
control the way Erlang VM handles garbage collection.

In the over-memory situation Rabbit tries to put messages to the disk,
frees the memory used by them, and prays that Erlang GC will eventually
release memory.

But in some corner situations, it's possible for Rabbit to get stuck. For
example: if you created more queues than you have available
memory. As queue metadata must always be in memory, Rabbit will
hit memory watermark and will never be able to recover.

Also, there is some memory cost associated with every message even
though the message is stored on-disk (unless you use a magical
rabbitmq-toke plugin, which intends to solve this problem).

So, take a look at rabbitmq-toke, monitor rabbitmq memory
usage usign rabbitmq-managament plugin, and just buy
more RAM if that's not enough!

Cheers,
   Marek

From Simone.Busoli at ferrari.com  Thu Jun 16 15:04:26 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Thu, 16 Jun 2011 14:04:26 +0000
Subject: [rabbitmq-discuss] Configuration documentation
In-Reply-To: <4DF9F8A3.6030404@rabbitmq.com>
References: <88E590DC4586974D825FC82AE798294E5200DED2@GSVCLU03.ges.ferlan.it><26C3C628B4834B79943ADD7501DB5510@gmail.com>
	<4DF9F8A3.6030404@rabbitmq.com>
Message-ID: <88E590DC4586974D825FC82AE798294E5200F931@GSVCLU03.ges.ferlan.it>

Very useful indeed, thanks Simon. 

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: Thursday, June 16, 2011 2:36 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Configuration documentation

On 13/06/11 12:03, Michael Klishin wrote:
> I don't know how feasible is the idea of putting documentation that is 
> up on rabbitmq.com into Hg repositories or on github, but at times I 
> felt like "man, I wish I could just clone that and send a pull 
> request/patch".

Not very right now, the website source is not public.

However, good news: I wrote a reference for the config items. Hopefully that helps:

http://www.rabbitmq.com/configure.html#config-items

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_________________________________________________________________________________________________________________
Questo messaggio e da intendersi esclusivamente ad uso del destinatario e puo contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non e il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione e 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From Jason.Klassen at protegra.com  Thu Jun 16 16:47:38 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Thu, 16 Jun 2011 15:47:38 +0000
Subject: [rabbitmq-discuss] use rabbit.config file to start multiple
 nodes
Message-ID: <676E1597FDBED54694CBA16B69DE71C302E05F@PTGMAIL02v.protegra.com>

Hi Simon,

Thanks for the insight.  Looks like it's Plan B then.  I modified the rabbitmq-server.bat and created rabbitmq-multi-server.bat to take parameters of nodename and port.   It would be handy to have future batch files include the ability to use named parameters instead of relying on environment variables. so we can do:

...\sbin>rabbitmq-server -port=5555 -sname=testRabbit -startargs='-rabbitmq_mochiweb port 55555'

With this in place I can now start 2 servers by calling

...\sbin> rabbitmq-multi-server rabbit1 4444
...\sbin> rabbitmq-multi-server rabbit2 5555

Not the most flexible but it works.  In case it's of use to anyone else the contents are below. Replace setlocal enabledelayedexpansion  with the below snippet in rabbitmq-server 

setlocal enabledelayedexpansion 

rem ************
rem hacking around config
rem ************

set USER_NODENAME=rabbit
if not "%1"=="" (
    set USER_NODENAME=%1
)

set USER_PORT=5672
if not "%2"=="" (
    set USER_PORT=%2
)

if "!RABBITMQ_BASE!"=="" (
    set RABBITMQ_BASE=!APPDATA!\RabbitMQ
)

if "!COMPUTERNAME!"=="" (
    set COMPUTERNAME=localhost
)

if "!RABBITMQ_NODENAME!"=="" (
    set RABBITMQ_NODENAME=!USER_NODENAME!@!COMPUTERNAME!
)

if "!RABBITMQ_NODE_PORT!"=="" (
    set RABBITMQ_NODE_PORT=!USER_PORT!
)

rem ************
rem end of hacking around config
rem ************

Note: if you run the rabbitMQ management plugin you'll need some additional handling to prevent conflicts with multiple launches of that as well.

Cheers,
Jason

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: June-16-11 5:14 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] use rabbit.config file to start multiple nodes

On 15/06/11 22:51, Jason Klassen wrote:
> How do I set the nodename through the config file?

I'm afraid you can't do that. (Boring reason why: the nodename is set as the process starts up, before we read the config file.)

> How can I set 2 nodes in a single config file?

...and you also can't do that.

> I am trying to avoid setting environment variables as this solution 
> should be easily run by other developers and a config file removes the 
> chance of typos.

That makes sense. In future we might move to preprocessing the config file somehow so that nodename can be set that way.

Probably your best bet is to write a script to start nodes in the way you want.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Jason.Klassen at protegra.com  Thu Jun 16 17:07:50 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Thu, 16 Jun 2011 16:07:50 +0000
Subject: [rabbitmq-discuss] 2.4.1, RABBITMQ_SERVER_START_ARGS,
	and the management plugin
Message-ID: <676E1597FDBED54694CBA16B69DE71C302E09E@PTGMAIL02v.protegra.com>

Hi,

We're using rabbitMQ server 2.4.1 and the management plugin.  I want to run the management plugin on a different port than 55672 and have it set using the rabbitmq-server.bat.

Using the example from the clustering documentation I added this line

    set RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb port 54444"

after

    setlocal enabledelayedexpansion

but then running

    rabbitmq-server.bat

will successfully activate the plugins but the management plugin still starts up on 55672 and not 54444

    http://localhost:55672/mgmt/#/  =  works
    http://localhost:54444/mgmt/#/ = fails

How can I start the management plugin on a different port using the RABBITMQ_SERVER_START_ARGS?

Thanks,
Jason Klassen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110616/edc26b9c/attachment.htm>

From joseph.a.marlin at gmail.com  Thu Jun 16 17:30:04 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Thu, 16 Jun 2011 09:30:04 -0700 (PDT)
Subject: [rabbitmq-discuss] 2.4.1, RABBITMQ_SERVER_START_ARGS,
	and the management plugin
In-Reply-To: <676E1597FDBED54694CBA16B69DE71C302E09E@PTGMAIL02v.protegra.com>
References: <676E1597FDBED54694CBA16B69DE71C302E09E@PTGMAIL02v.protegra.com>
Message-ID: <1e0eaf4f-a8ab-4184-bc0d-7ec4b206485e@h7g2000yqa.googlegroups.com>

You have to configure a listener:

[
  ...
  {rabbitmq_mochiweb, [{listeners, [{'*',  [{port, 55670}]},,
                                    {mgmt, [{port, 55555}]}]}]},
  ...
].

On Jun 16, 12:07?pm, Jason Klassen <Jason.Klas... at protegra.com> wrote:
> Hi,
>
> We're using rabbitMQ server 2.4.1 and the management plugin. ?I want to run the management plugin on a different port than 55672 and have it set using the rabbitmq-server.bat.
>
> Using the example from the clustering documentation I added this line
>
> ? ? set RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb port 54444"
>
> after
>
> ? ? setlocal enabledelayedexpansion
>
> but then running
>
> ? ? rabbitmq-server.bat
>
> will successfully activate the plugins but the management plugin still starts up on 55672 and not 54444
>
> ? ?http://localhost:55672/mgmt/#/?= ?works
> ? ?http://localhost:54444/mgmt/#/= fails
>
> How can I start the management plugin on a different port using the RABBITMQ_SERVER_START_ARGS?
>
> Thanks,
> Jason Klassen
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Jason.Klassen at protegra.com  Thu Jun 16 17:33:54 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Thu, 16 Jun 2011 16:33:54 +0000
Subject: [rabbitmq-discuss] 2.4.1, RABBITMQ_SERVER_START_ARGS,
 and the management plugin
In-Reply-To: <1e0eaf4f-a8ab-4184-bc0d-7ec4b206485e@h7g2000yqa.googlegroups.com>
References: <676E1597FDBED54694CBA16B69DE71C302E09E@PTGMAIL02v.protegra.com>
	<1e0eaf4f-a8ab-4184-bc0d-7ec4b206485e@h7g2000yqa.googlegroups.com>
Message-ID: <676E1597FDBED54694CBA16B69DE71C302E0BA@PTGMAIL02v.protegra.com>

How can that listener be configured using RABBITMQ_SERVER_START_ARGS?  I want to be able to pass the port of the listener in on the args for rabbitmq-server.bat.  I won't know this port ahead of time to put it in the rabbitmq.config file.

Thanks,
Jason

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Joseph Marlin
Sent: June-16-11 11:30 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] 2.4.1, RABBITMQ_SERVER_START_ARGS, and the management plugin

You have to configure a listener:

[
  ...
  {rabbitmq_mochiweb, [{listeners, [{'*',  [{port, 55670}]},,
                                    {mgmt, [{port, 55555}]}]}]},
  ...
].

On Jun 16, 12:07?pm, Jason Klassen <Jason.Klas... at protegra.com> wrote:
> Hi,
>
> We're using rabbitMQ server 2.4.1 and the management plugin. ?I want to run the management plugin on a different port than 55672 and have it set using the rabbitmq-server.bat.
>
> Using the example from the clustering documentation I added this line
>
> ? ? set RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb port 54444"
>
> after
>
> ? ? setlocal enabledelayedexpansion
>
> but then running
>
> ? ? rabbitmq-server.bat
>
> will successfully activate the plugins but the management plugin still starts up on 55672 and not 54444
>
> ? ?http://localhost:55672/mgmt/#/?= ?works
> ? ?http://localhost:54444/mgmt/#/= fails
>
> How can I start the management plugin on a different port using the RABBITMQ_SERVER_START_ARGS?
>
> Thanks,
> Jason Klassen
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Jun 16 18:00:11 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 16 Jun 2011 18:00:11 +0100
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
	<4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
	<4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
	<4DF78AEA.7000703@rabbitmq.com>
	<BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>
Message-ID: <20110616170011.GA30612@rabbitmq.com>

Hi Jason,

On Tue, Jun 14, 2011 at 10:42:44AM -0600, Jason J. W. Williams wrote:
> What do you mean by "change dynamically"? Does that mean it will be
> difficult to replace a node?

I may as well just attach the full documentation as it stands given
otherwise snippets of it will just leak out.

Obviously please bear in mind this may change before release, though not
in any profound ways (unless the release is delayed for a few years).

Matthew
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ha.xml
Type: application/xml
Size: 16493 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110616/357853d8/attachment-0001.xml>

From jasonjwwilliams at gmail.com  Thu Jun 16 18:47:14 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 16 Jun 2011 11:47:14 -0600
Subject: [rabbitmq-discuss] RabbitMQ as a reliable message queue
In-Reply-To: <BANLkTikxdi30FBBTuMC7-jJr1h1B8Qu1Tw@mail.gmail.com>
References: <BANLkTi=t1G2KhHq1yKYNaAG9bo1HkLtN_A@mail.gmail.com>
	<BANLkTi=QDJg-6QOsu5vTiFJVRiBuvYVRkA@mail.gmail.com>
	<4DF88154.8060101@rabbitmq.com>
	<4DF958E8.8040800@strategicdata.com.au>
	<BANLkTikxdi30FBBTuMC7-jJr1h1B8Qu1Tw@mail.gmail.com>
Message-ID: <BANLkTik9d4siTpHV74j==ufgG0f5sr2zow@mail.gmail.com>

On Thu, Jun 16, 2011 at 2:14 AM, T-zex <tranzenziuzex at gmail.com> wrote:
> Unexpected shut down of a process (power failure) will result in
> "good" message being put to the end of the queue - a very unexpected
> behaviour. In case of a "bad" message application should decide that
> it is bad and what should be done with it - requeue (unlikely) or get
> rid of it.

Well technically you can do that already. If you don't want it
requeued just consume it and toss it, if you want it requeued just
recreate the channel. I'm not sure that a message in the process of
being consumed when the broker dies is requeued to the back. My
experience is the queue comes up in the state it was in when the
broker died.

-J

From matthias at rabbitmq.com  Thu Jun 16 18:53:52 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 16 Jun 2011 18:53:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ as a reliable message queue
In-Reply-To: <BANLkTik9d4siTpHV74j==ufgG0f5sr2zow@mail.gmail.com>
References: <BANLkTi=t1G2KhHq1yKYNaAG9bo1HkLtN_A@mail.gmail.com>	<BANLkTi=QDJg-6QOsu5vTiFJVRiBuvYVRkA@mail.gmail.com>	<4DF88154.8060101@rabbitmq.com>	<4DF958E8.8040800@strategicdata.com.au>	<BANLkTikxdi30FBBTuMC7-jJr1h1B8Qu1Tw@mail.gmail.com>
	<BANLkTik9d4siTpHV74j==ufgG0f5sr2zow@mail.gmail.com>
Message-ID: <4DFA4330.9020801@rabbitmq.com>

On 16/06/11 18:47, Jason J. W. Williams wrote:
> On Thu, Jun 16, 2011 at 2:14 AM, T-zex<tranzenziuzex at gmail.com>
> wrote:
>> Unexpected shut down of a process (power failure) will result in
>> "good" message being put to the end of the queue - a very
>> unexpected behaviour. In case of a "bad" message application should
>> decide that it is bad and what should be done with it - requeue
>> (unlikely) or get rid of it.
>
> Well technically you can do that already. If you don't want it
> requeued just consume it and toss it,

...or reject the message with basic.reject(requeue=false).

> if you want it requeued just recreate the channel.

...or reject the message with basic.reject(requeue=true).

> I'm not sure that a message in the process of being consumed when the
> broker dies is requeued to the back.

They are. But we have some work underway to change that.


Matthias.

From jasonjwwilliams at gmail.com  Thu Jun 16 18:59:24 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 16 Jun 2011 11:59:24 -0600
Subject: [rabbitmq-discuss] RabbitMQ as a reliable message queue
In-Reply-To: <4DFA4330.9020801@rabbitmq.com>
References: <BANLkTi=t1G2KhHq1yKYNaAG9bo1HkLtN_A@mail.gmail.com>
	<BANLkTi=QDJg-6QOsu5vTiFJVRiBuvYVRkA@mail.gmail.com>
	<4DF88154.8060101@rabbitmq.com>
	<4DF958E8.8040800@strategicdata.com.au>
	<BANLkTikxdi30FBBTuMC7-jJr1h1B8Qu1Tw@mail.gmail.com>
	<BANLkTik9d4siTpHV74j==ufgG0f5sr2zow@mail.gmail.com>
	<4DFA4330.9020801@rabbitmq.com>
Message-ID: <BANLkTimCztwBojyS59eECQ5FvtsQAY3+EA@mail.gmail.com>

>
> ...or reject the message with basic.reject(requeue=false).
>
>> if you want it requeued just recreate the channel.
>
> ...or reject the message with basic.reject(requeue=true).

Couldn't remember if reject had been supported yet. :)

-J

From matthias at rabbitmq.com  Thu Jun 16 19:16:37 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 16 Jun 2011 19:16:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET client BasicConsume and
 HandleBasicDeliver question
In-Reply-To: <BANLkTi=KRPvvXvRcGRjRYF_0UjMrbvJg+Q@mail.gmail.com>
References: <BANLkTik=RwAgYe7cuC59b0E+g=F1-fkosQ@mail.gmail.com>	<4DF87C4C.3010402@rabbitmq.com>	<BANLkTimdnAFH4x6g_uRjLCrFRk4SOVNnkw@mail.gmail.com>	<4DF89181.7010605@rabbitmq.com>	<BANLkTinpXYu6k9mv=MFx6rXfXoVDVPWuGQ@mail.gmail.com>	<4DF8A8B7.4010809@rabbitmq.com>	<BANLkTinA3YG-qnQEEx_RpchRLqNhwsdSjw@mail.gmail.com>
	<BANLkTi=KRPvvXvRcGRjRYF_0UjMrbvJg+Q@mail.gmail.com>
Message-ID: <4DFA4885.8000901@rabbitmq.com>

On 16/06/11 14:55, Bryan Murphy wrote:
> Maybe RabbitMQ isn't the right solution then.  We have a queue where
> everything absolutely must be processed in the correct order.  Where
> do we store it?  In a transactional database, not RabbitMQ.  All of
> our other queues are in RabbitMQ, but they don't have the same
> requirement.

As I just mentioned on another thread, we do have some work underway to 
change the requeuing behaviour so that order is preserved in some of the 
more common scenarios, e.g. connection closure for a queue with a single 
consumer.

Regards,

Matthias.

From jasonjwwilliams at gmail.com  Thu Jun 16 19:24:27 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 16 Jun 2011 12:24:27 -0600
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <20110616170011.GA30612@rabbitmq.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
	<4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
	<4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
	<4DF78AEA.7000703@rabbitmq.com>
	<BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>
	<20110616170011.GA30612@rabbitmq.com>
Message-ID: <BANLkTi=kqXV5efNT=p0+gZD8_iyBOhO4eQ@mail.gmail.com>

Hey Matthew,

> I may as well just attach the full documentation as it stands given
> otherwise snippets of it will just leak out.
>
> Obviously please bear in mind this may change before release, though not
> in any profound ways (unless the release is delayed for a few years).

Thank you for the docs! Overall it looks like a big step up. All of
your hard work on this is very much appreciated. I do have a few
questions/comments on it:


* The fact that messages in a transactions published to a mirrored
queue are silently dropped is inevitably setting up a customer to lose
messages when they forget about that property. Why not error out the
transaction so the problem is actively in their face, or at least give
it a best effort?

* If publishes are parallel to the master queue and it's slaves, how
are consumes and other actions that are slaved serially off the master
able to keep the slaves in sync since you're mixing parallel ops with
serial ones?

* If consumers are going to be considered disconnected, why aren't
they actually disconnected so they can use their assumptions about
lost connections to assume acknowledgements in flight were lost etc
(and re-use app logic they already have)?

* The lack of synchronization for new Q slaves is a bummer,
particularly in the case where a rejoining slave tosses it's durable
messages regardless of whether those message have actually been
consumed. It seems like there should be a history log shared across
the masters and slaves so a rejoining slave can sync up off the master
and reconcile it's durable contents.

* Why do mirror slaves have to be specified by node name, rather than
just passing a "numCopies=X" to the queue on creation and letting the
cluster handle the distribution? It seems to be shifting complexity to
the client that should be in the cluster which has the best knowledge
of how many members exist and other internals.


-J

From rob at rabbitmq.com  Fri Jun 17 09:42:02 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 17 Jun 2011 09:42:02 +0100
Subject: [rabbitmq-discuss] message via stomp adapter crashes queue
In-Reply-To: <7cd40385-f6c2-4217-80d5-430b8c7f6b90@36g2000yqj.googlegroups.com>
References: <BANLkTikYr_getudAfmNJdFRBz7dXvdxLng@mail.gmail.com>	<4DF74771.4040700@rabbitmq.com>
	<7cd40385-f6c2-4217-80d5-430b8c7f6b90@36g2000yqj.googlegroups.com>
Message-ID: <4DFB135A.6070402@rabbitmq.com>

Hi Chris,

This is what you see against 2.1?

The bug you linked to is not present in 2.1, it was introduced in 2.2 
but is fixed since 2.4.1 (or maybe 2.4.0).

The log doesn't seem to be saying anything interesting about queues 
crashing, simply that the parser thinks the incoming frame is corrupted. 
In particular, it looks like the header key has a newline in it, which 
is definitely not allowed.

Do you have a few sample frames that you could send me.

The best solution to this is to find out why you can't run against 
2.5.0. The parser was much updated to support STOMP 1.1 recently and to 
handle some clarifications around handling of extraneous newlines and such.

Rob

Chris wrote:
>
> Thank you for the response Rob.
>
> Not sure exactly, but I know that if we move past 2.1.0 and the
> matching stomp plugin things get worse. I'm just the guy that has to
> keep this thing running and not the developer of the stomp client
> pushing data at the rabbit stomp adapter or the clients on the other
> side doing amqp. I'll try again to get the details on what's keeping
> us stuck at this version.
>
> In the meantime this is what we see when the Queue goes away:
>
> 10:49< arreyder> =ERROR REPORT==== 15-Jun-2011::15:46:12 ===
> 10:49< arreyder> STOMP error frame sent:
> 10:49< arreyder> Message: "Invalid frame"
> 10:49< arreyder> Detail: "Could not parse frame\n"
> 10:49< arreyder> Server private detail:
> {bad_header_key,"destinaSEND"}
> 10:49< arreyder> "detinaSEND"
> 10:51< arreyder> here's the one from just before that one:
> 10:51< arreyder> =ERROR REPORT==== 15-Jun-2011::15:31:11 ===
> 10:51< arreyder> STOMP error frame sent:
> 10:51< arreyder> Message: "Invalid frame"
> 10:51< arreyder> Detail: "Could not parse frame\n"
> 10:51< arreyder> Server private detail:
> {bad_header_key,"destinationSEND"}
>
> I've verified on the wire (packet captures) that the message headers
> do not look like how they are logged there. They appear correctly
> sent.
>
> crr
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Fri Jun 17 09:45:02 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 17 Jun 2011 09:45:02 +0100
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <BANLkTi=kqXV5efNT=p0+gZD8_iyBOhO4eQ@mail.gmail.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
	<4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
	<4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
	<4DF78AEA.7000703@rabbitmq.com>
	<BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>
	<20110616170011.GA30612@rabbitmq.com>
	<BANLkTi=kqXV5efNT=p0+gZD8_iyBOhO4eQ@mail.gmail.com>
Message-ID: <20110617084501.GA2532@rabbitmq.com>

Hi Jason,

On Thu, Jun 16, 2011 at 12:24:27PM -0600, Jason J. W. Williams wrote:
> * The fact that messages in a transactions published to a mirrored
> queue are silently dropped is inevitably setting up a customer to lose
> messages when they forget about that property. Why not error out the
> transaction so the problem is actively in their face, or at least give
> it a best effort?

I wouldn't worry - we'll likely be dropping support for transactions
completely soon so any attempt to use tx.* will result in at least a
channel error.

> * If publishes are parallel to the master queue and it's slaves, how
> are consumes and other actions that are slaved serially off the master
> able to keep the slaves in sync since you're mixing parallel ops with
> serial ones?

Consumers are never aware of the slaves. They talk only to the master,
using Erlang's normal inter-node messaging.

Whilst publishes go in parallel to all mirrors, there are race
conditions there, thus the master informs the slaves of what order the
publishes should be accepted in. The _only_ reason that publishes go to
slaves as well as the master from publishing channels is so that in the
event of the death of the master, there is no window in which msgs can
be lost.

> * If consumers are going to be considered disconnected, why aren't
> they actually disconnected so they can use their assumptions about
> lost connections to assume acknowledgements in flight were lost etc
> (and re-use app logic they already have)?

It's far better to use the consumer cancel notification that we added -
much lighter-weight. If we closed the channel, then there would be other
consequences - for example, that channel could be consuming from dozens
of queues. By closing it, all outstanding non-acked msgs from all those
other queues would now have to be needlessly requeued.

> * The lack of synchronization for new Q slaves is a bummer,
> particularly in the case where a rejoining slave tosses it's durable
> messages regardless of whether those message have actually been
> consumed. It seems like there should be a history log shared across
> the masters and slaves so a rejoining slave can sync up off the master
> and reconcile it's durable contents.

That'll be fixed eventually.

> * Why do mirror slaves have to be specified by node name, rather than
> just passing a "numCopies=X" to the queue on creation and letting the
> cluster handle the distribution? It seems to be shifting complexity to
> the client that should be in the cluster which has the best knowledge
> of how many members exist and other internals.

We all agree that leaking details of the cluster to the clients is very
likely not what's wanted in most cases, especially node names. However,
the numCopies is far too inflexible. There are a number of suggestions
in this area and they will be implemented in the future. However, there
are genuine reasons why a client may want to control precisely which
nodes get mirrors on them, or rather, why Rabbit may not be best placed
to decide which nodes.

Yes, Rabbit could start doing load monitoring and all that jazz, but for
example, one thing it's not aware of is whether it's in a virtualised
environment. It seems to me quite reasonable to want to ensure that your
mirrors will not end up on nodes that are actually on the same physical
machine, albeit different guests - if they do, then you're hardly
protecting your queues from spectacular hardware failure.

So yes, none of us like the specification of node names. However, I'm
keen to ensure any replacement offers, does not preclude the same level
of flexibility. Yes - all sorts of better layers of indirection and
abstraction would make this more pleasant. But ultimately, I do want to
ensure we don't lose this ability.

FWIW, discussion about mirror specification is why this work did not
make it into 2.5.0.

Matthew

From mikeb at rabbitmq.com  Fri Jun 17 10:10:18 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 17 Jun 2011 10:10:18 +0100
Subject: [rabbitmq-discuss] rabbitmq-lvc-plugin broken with 2.5.0 release
In-Reply-To: <BANLkTim_19Ah2ttNuZmk2SpEaE2N+1FkEg@mail.gmail.com>
References: <BANLkTim_19Ah2ttNuZmk2SpEaE2N+1FkEg@mail.gmail.com>
Message-ID: <4DFB19FA.5080800@rabbitmq.com>

Hi Fabio,

> I'd just like to point out that the last value cache exchange made
> available by the rabbitmq-lvc-plugin is broken with the latest RabbitMQ
> release.

I've updated it. There were yet more changes to how exchange type 
callbacks are called, a change to a record definition (basic_message), 
the boot sequence, and a different plugin build system.  Just about the 
only thing that hasn't changed is the name!  Oh actually no that had to 
change too.

> I know it's experimental stuff, but since I'm using it it would be nice
> to have it working with the latest and greatest... :)
> If anyone is interested I can post the mentioned crash dump.
> Thank you very much.

It's not even an experiment, it's a toy I made to demonstrate the 
exchange type API when I first finished that.  But you are aware of its 
limitations ..

Cheers,
Michael

From michael.s.klishin at gmail.com  Fri Jun 17 11:59:39 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 17 Jun 2011 14:59:39 +0400
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <20110617084501.GA2532@rabbitmq.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
	<4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
	<4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
	<4DF78AEA.7000703@rabbitmq.com>
	<BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>
	<20110616170011.GA30612@rabbitmq.com>
	<BANLkTi=kqXV5efNT=p0+gZD8_iyBOhO4eQ@mail.gmail.com>
	<20110617084501.GA2532@rabbitmq.com>
Message-ID: <B8F885B92631497B8B2C281B22709B11@gmail.com>

Matthew Sackman escribi?:
> I wouldn't worry - we'll likely be dropping support for transactions
> completely soon so any attempt to use tx.* will result in at least a
> channel error.
Does it mean client maintainers should discourage transaction use by focusing on publisher confirms and
message acknowledgements? It just so happens that I am in the process of expanding Ruby amqp gem documentation
on transactions and their relation to publisher confirms & message acknowledgements. I am not sure what to do now.


MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin




From matthew at rabbitmq.com  Fri Jun 17 12:08:45 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 17 Jun 2011 12:08:45 +0100
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <B8F885B92631497B8B2C281B22709B11@gmail.com>
References: <4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
	<4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
	<4DF78AEA.7000703@rabbitmq.com>
	<BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>
	<20110616170011.GA30612@rabbitmq.com>
	<BANLkTi=kqXV5efNT=p0+gZD8_iyBOhO4eQ@mail.gmail.com>
	<20110617084501.GA2532@rabbitmq.com>
	<B8F885B92631497B8B2C281B22709B11@gmail.com>
Message-ID: <20110617110845.GA5178@rabbitmq.com>

On Fri, Jun 17, 2011 at 02:59:39PM +0400, Michael Klishin wrote:
> Does it mean client maintainers should discourage transaction use by
> focusing on publisher confirms and message acknowledgements? It just
> so happens that I am in the process of expanding Ruby amqp gem
> documentation on transactions and their relation to publisher confirms
> & message acknowledgements. I am not sure what to do now.

There problem with AMQP transactions as they're defined is that they're
essentially useless once you have publisher confirms.

The only compelling use case is if you had a client that wanted to
receive a message, transform it, and republish it as one action. In that
case, wrapping that lot in a transaction makes sense. However, what
you'll immediately notice is that the transaction precludes you from
publishing to a different broker than you received from.

Instead, you should publish with confirms, wait for the confirm, and
then ack the message you received. This allows you to use different
brokers, and allows you to pipeline actions, substantially increasing
performance.

Yes, in the event of a failure of a client, you could end up with
duplicates - the ack could be lost and so that initial message will be
requeued and delivered. But in the event of client (and broker)
failures, there's always the chance of duplicates anyway, and even
transactions do not actually solve this (for one thing, the
implementation of transactions in Rabbit is _not_ atomic).

We would encourage all 3rd party clients to work to support the
extensions to AMQP 0-9-1 that we add. That does not mean that we
recommend you remove functionality that we remove - you can certainly
implement a superset of the functionality. But normally when we add and
remove features, it's because there is some fundamental deficiency that
needs to be addressed and so it's obviously helpful if 3rd party clients
are aware of that.

I hope that helps,

Matthew

From michael.s.klishin at gmail.com  Fri Jun 17 12:29:01 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 17 Jun 2011 15:29:01 +0400
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <20110617110845.GA5178@rabbitmq.com>
References: <4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
	<4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
	<4DF78AEA.7000703@rabbitmq.com>
	<BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>
	<20110616170011.GA30612@rabbitmq.com>
	<BANLkTi=kqXV5efNT=p0+gZD8_iyBOhO4eQ@mail.gmail.com>
	<20110617084501.GA2532@rabbitmq.com>
	<B8F885B92631497B8B2C281B22709B11@gmail.com>
	<20110617110845.GA5178@rabbitmq.com>
Message-ID: <AF11CEDC6A5540CC87D4D14621706CD0@gmail.com>

Matthew Sackman escribi?:
> We would encourage all 3rd party clients to work to support the
> extensions to AMQP 0-9-1 that we add. That does not mean that we
> recommend you remove functionality that we remove - you can certainly
> implement a superset of the functionality. But normally when we add and
> remove features, it's because there is some fundamental deficiency that
> needs to be addressed and so it's obviously helpful if 3rd party clients
> are aware of that.
Matthew,

I trust the RabbitMQ team judgement and agree that tx.* class has relatively few use cases
with Publisher Confirms. amqp gem also supports publisher confirms in 0.8.x series, our test suite covers them
and I am going to document that extension in detail with examples very soon.

That said, as a client library maintainer, I have a number of concerns:

* Should I explicitly discourage people from using tx.* class?
* How do I justify even more protocol fragmentation to library users?
* What do I do with my test suite that covers tx.* operations? I can add conditions that check for RabbitMQ versions
but that makes me think of Internet Explorer 6 and you can imagine what kind of thought that is.

I am not too worried about this. I see just one case my when applications could use tx.* and they currently don't.

However, I want amqp gem to have excellent documentation that also helps library users understand when to use what features
and why. The prospect of tx.* removal from that standpoint is a problem for me. We already have to explain people what AMQP 0.8 to
0.9.1 move means and why they cannot use stock Ubuntu packages. Adding one more note that "oh, and if you happen to use transactions,
please use RabbitMQ server < 2.6.0" is possible but I can imagine it won't reassure readers in RabbitMQ stability and maturity.

So, what are the RabbitMQ team recommendations for library maintainers? 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin








From maxence.cordier at gmail.com  Fri Jun 17 12:41:16 2011
From: maxence.cordier at gmail.com (Max C)
Date: Fri, 17 Jun 2011 04:41:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Exchange performance
Message-ID: <95a152d1-af26-4879-8dee-0f2bea5ce303@h7g2000yqa.googlegroups.com>

I have two questions I'd like to ask about exchanges.

What happen to a message published to an exchange if no queue is
suscribed to that exchange ?


In my application, I have a bunch of devices sendind data to a
rabbitMQ broker. I'm wondering if I should use 1 exchange for all my
devices, tagging messages with the name of the device which send
them ? Or if I should use 1 exchange per device.
I assume it depends on how the publication process is implemented.
Does it instanciate 1 thread per exchange ? or does 1 thread deal with
all of exchanges ? Maybe this is more complicated ..


From majek04 at gmail.com  Fri Jun 17 12:51:52 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 17 Jun 2011 12:51:52 +0100
Subject: [rabbitmq-discuss] Exchange performance
In-Reply-To: <95a152d1-af26-4879-8dee-0f2bea5ce303@h7g2000yqa.googlegroups.com>
References: <95a152d1-af26-4879-8dee-0f2bea5ce303@h7g2000yqa.googlegroups.com>
Message-ID: <BANLkTi=8cwOUZ7JYgodw2HNZ=2nN4MZLbA@mail.gmail.com>

On Fri, Jun 17, 2011 at 12:41, Max C <maxence.cordier at gmail.com> wrote:
> I have two questions I'd like to ask about exchanges.
>
> What happen to a message published to an exchange if no queue is
> suscribed to that exchange ?

Usually it's discarded.
There are two exceptions.
 a) look at the immediate/mandatory message flags:
    http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.publish
 b) look at 'alternate exchange' feature:
    http://www.rabbitmq.com/extensions.html#alternate-exchange

> In my application, I have a bunch of devices sendind data to a
> rabbitMQ broker. I'm wondering if I should use 1 exchange for all my
> devices, tagging messages with the name of the device which send
> them ? Or if I should use 1 exchange per device.

It all depends on how you want to use the messages. But 1 exchange
usually should do.
(and uses less resources than many exchanges :P)

Cheers,
  Marek

From michael.s.klishin at gmail.com  Fri Jun 17 12:55:05 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 17 Jun 2011 15:55:05 +0400
Subject: [rabbitmq-discuss] Exchange performance
In-Reply-To: <95a152d1-af26-4879-8dee-0f2bea5ce303@h7g2000yqa.googlegroups.com>
References: <95a152d1-af26-4879-8dee-0f2bea5ce303@h7g2000yqa.googlegroups.com>
Message-ID: <BANLkTimU+NyZdvCX=SNuW9QW9shzFyQH1g@mail.gmail.com>

2011/6/17 Max C <maxence.cordier at gmail.com>

> What happen to a message published to an exchange if no queue is
> suscribed to that exchange ?
>
>
If message cannot be routed to any queue because there are no bindings,
there are two scenarios:

* Messages with `mandatory` flag set will be returned to the producer
* Messages with `mandatory` flag off will be dropped.

If message can be routed (there are bindings) but no consumers, again, there
are two scenarios:

* Messages with `immediate` flag set will be returned to the producer
* Messages with `immediate` flag off will just stay in a queue they were
routed to.


>
> In my application, I have a bunch of devices sendind data to a
> rabbitMQ broker. I'm wondering if I should use 1 exchange for all my
> devices, tagging messages with the name of the device which send
> them ? Or if I should use 1 exchange per device.
>

You can use a single direct exchange but set routing key to device names.
Then each device can declare and consume messages from one queue named after
it.

-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110617/704267fa/attachment.htm>

From matthew at rabbitmq.com  Fri Jun 17 13:03:39 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 17 Jun 2011 13:03:39 +0100
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <AF11CEDC6A5540CC87D4D14621706CD0@gmail.com>
References: <4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
	<4DF78AEA.7000703@rabbitmq.com>
	<BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>
	<20110616170011.GA30612@rabbitmq.com>
	<BANLkTi=kqXV5efNT=p0+gZD8_iyBOhO4eQ@mail.gmail.com>
	<20110617084501.GA2532@rabbitmq.com>
	<B8F885B92631497B8B2C281B22709B11@gmail.com>
	<20110617110845.GA5178@rabbitmq.com>
	<AF11CEDC6A5540CC87D4D14621706CD0@gmail.com>
Message-ID: <20110617120338.GB5178@rabbitmq.com>

On Fri, Jun 17, 2011 at 03:29:01PM +0400, Michael Klishin wrote:
> That said, as a client library maintainer, I have a number of concerns:
> 
> * Should I explicitly discourage people from using tx.* class?

I think that documenting the deficiencies of transactions is worthwhile.
Whether that goes as far as actively telling people to not use them is
unclear, but certainly as far as Rabbit is concerned, we're likely to
make that decision for people ;)

> * How do I justify even more protocol fragmentation to library users?

Well this is certainly an issue. StormMQ, OpenAMQ and apparently the
Java QPid all claim to support 0-9-1, though in reality, the ambiguity
in the specification and the subsequently different readings of the spec
pretty much guarantee that application authors will, in all but the most
trivial of cases, need to be aware of which broker they're writing for.
In many ways, it's broadly comparable to the SQL 92 standard. Sadly, it
doesn't look as if this is going to improve either, for reasons beyond
our control.

> * What do I do with my test suite that covers tx.* operations? I can
> add conditions that check for RabbitMQ versions but that makes me
> think of Internet Explorer 6 and you can imagine what kind of thought
> that is.

Indeed. I don't really have a good answer here. Have you tried running
your test suite against other 0-9-1 implementations? I would be a little
surprised if it passes entirely which really means you're going to have
to do some degree of broker detection anyway.

> However, I want amqp gem to have excellent documentation that also
> helps library users understand when to use what features and why. The
> prospect of tx.* removal from that standpoint is a problem for me. We
> already have to explain people what AMQP 0.8 to 0.9.1 move means and
> why they cannot use stock Ubuntu packages. Adding one more note that
> "oh, and if you happen to use transactions, please use RabbitMQ server
> < 2.6.0" is possible but I can imagine it won't reassure readers in
> RabbitMQ stability and maturity.

One approach would be that rather than (or in addition to) documenting
features of AMQP, instead document use cases and how to solve them. In
that context, it makes sense to say something along the lines of "if
you're using a broker that doesn't support publisher confirms, then
you'll have to use transactions here. But beware of the following
problems with transactions: ...; many of these problems can be solved by
using publisher confirms instead, but currently this extension is only
implemented by ...".

The fact that some distributions still ship utterly ancient versions of
Rabbit is a different problem. Frankly, the more painful it is to use
such ancient versions, the more pressure should be exterted on such
distributions to update their versions of Rabbit[0]. Our clients stopped
supporting 0-8 when we introduced broker support for 0-9-1. I'm actually
a little surprised we still support 0-8 in the broker.

Matthew

[0] At the other end of the scale, we have the opposite problem where,
for example, Homebrew goes and updates their version of Erlang so
rapidly that they break both Rabbit and Riak because it takes us a while
to get versions out that can cope with the changes introduced in, for
example, R14B03 (though that has not been the only version of Erlang
which has caused us problems).

From simon at rabbitmq.com  Fri Jun 17 13:04:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Jun 2011 13:04:18 +0100
Subject: [rabbitmq-discuss] Exchange performance
In-Reply-To: <BANLkTi=8cwOUZ7JYgodw2HNZ=2nN4MZLbA@mail.gmail.com>
References: <95a152d1-af26-4879-8dee-0f2bea5ce303@h7g2000yqa.googlegroups.com>
	<BANLkTi=8cwOUZ7JYgodw2HNZ=2nN4MZLbA@mail.gmail.com>
Message-ID: <4DFB42C2.6070001@rabbitmq.com>

On 17/06/11 12:51, Marek Majkowski wrote:
> On Fri, Jun 17, 2011 at 12:41, Max C<maxence.cordier at gmail.com>  wrote:
>> In my application, I have a bunch of devices sendind data to a
>> rabbitMQ broker. I'm wondering if I should use 1 exchange for all my
>> devices, tagging messages with the name of the device which send
>> them ? Or if I should use 1 exchange per device.
>
> It all depends on how you want to use the messages. But 1 exchange
> usually should do.
> (and uses less resources than many exchanges :P)

The question of which uses less resources depends on the complexity of 
the routing logic - if your design is 1000 queues and a choice between 
either 100 direct exchanges or one headers exchange, the direct 
exchanges are likely to be faster.

But the OP said:

On 17/06/11 12:41, Max C wrote:
 > I assume it depends on how the publication process is implemented.
 > Does it instanciate 1 thread per exchange ? or does 1 thread deal with
 > all of exchanges ? Maybe this is more complicated ..

No, exchanges do not have a process associated with them at all (at 
least the four built in types don't). They're essentially just functions 
that run in the channel process, so you don't have to worry about 
exchange parallelism.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Fri Jun 17 13:22:48 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 17 Jun 2011 16:22:48 +0400
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <20110617120338.GB5178@rabbitmq.com>
References: <4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
	<4DF78AEA.7000703@rabbitmq.com>
	<BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>
	<20110616170011.GA30612@rabbitmq.com>
	<BANLkTi=kqXV5efNT=p0+gZD8_iyBOhO4eQ@mail.gmail.com>
	<20110617084501.GA2532@rabbitmq.com>
	<B8F885B92631497B8B2C281B22709B11@gmail.com>
	<20110617110845.GA5178@rabbitmq.com>
	<AF11CEDC6A5540CC87D4D14621706CD0@gmail.com>
	<20110617120338.GB5178@rabbitmq.com>
Message-ID: <BANLkTimjY6+O8mLgmS29W56t+fUrDGcuMg@mail.gmail.com>

2011/6/17 Matthew Sackman <matthew at rabbitmq.com>

>
> One approach would be that rather than (or in addition to) documenting
> features of AMQP, instead document use cases and how to solve them. In
> that context, it makes sense to say something along the lines of "if
> you're using a broker that doesn't support publisher confirms, then
> you'll have to use transactions here. But beware of the following
> problems with transactions: ...; many of these problems can be solved by
> using publisher confirms instead, but currently this extension is only
> implemented by ...".
>

This is the approach we are taking with amqp gem.

After thinking about it for a bit, we will do the following:

 * As far as functionality and test suite organization goes, simply do what
the most recent version of the Java client does. Broker version checking may
be considered.
 * In documentation, focus on how Publisher Confirms and message
acknowledgements can be used to
   accomplish what people may first consider using transactions for.
Transactions will be mentioned, too.
 * We already have a guide dedicated to RabbitMQ versions, so whenever tx.*
is dropped, that document will be updated.


> Frankly, the more painful it is to use
> such ancient versions, the more pressure should be exterted on such
> distributions to update their versions of Rabbit[0]. Our clients stopped
> supporting 0-8 when we introduced broker support for 0-9-1.
>
I'm actually
> a little surprised we still support 0-8 in the broker.
>
>
Many popular clients/versions of clients still support 0.8 only. I even
happen to use
0.8 producers and 0.9.1 consumers because upgrading all applications at the
same time
wasn't an option. So I hope AMQP 0.8 support in RabbitMQ will stay around
for a few more
releases.
-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110617/58e21877/attachment.htm>

From simon at rabbitmq.com  Fri Jun 17 13:26:49 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Jun 2011 13:26:49 +0100
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <BANLkTimjY6+O8mLgmS29W56t+fUrDGcuMg@mail.gmail.com>
References: <4DF75F7D.4090902@rabbitmq.com>	<70846.95116.qm@web111001.mail.gq1.yahoo.com>	<4DF78AEA.7000703@rabbitmq.com>	<BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>	<20110616170011.GA30612@rabbitmq.com>	<BANLkTi=kqXV5efNT=p0+gZD8_iyBOhO4eQ@mail.gmail.com>	<20110617084501.GA2532@rabbitmq.com>	<B8F885B92631497B8B2C281B22709B11@gmail.com>	<20110617110845.GA5178@rabbitmq.com>	<AF11CEDC6A5540CC87D4D14621706CD0@gmail.com>	<20110617120338.GB5178@rabbitmq.com>
	<BANLkTimjY6+O8mLgmS29W56t+fUrDGcuMg@mail.gmail.com>
Message-ID: <4DFB4809.7000301@rabbitmq.com>

On 17/06/11 13:22, Michael Klishin wrote:
> Many popular clients/versions of clients still support 0.8 only. I even
> happen to use
> 0.8 producers and 0.9.1 consumers because upgrading all applications at
> the same time
> wasn't an option. So I hope AMQP 0.8 support in RabbitMQ will stay
> around for a few more
> releases.

It doesn't feel like it's costing us much if anything to keep it in 
there (unlike transactions).

Mind you, clients that still only support 0-8 should get their skates on :)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From maxence.cordier at gmail.com  Fri Jun 17 14:38:31 2011
From: maxence.cordier at gmail.com (Max C)
Date: Fri, 17 Jun 2011 06:38:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Exchange performance
In-Reply-To: <4DFB42C2.6070001@rabbitmq.com>
References: <95a152d1-af26-4879-8dee-0f2bea5ce303@h7g2000yqa.googlegroups.com>
	<BANLkTi=8cwOUZ7JYgodw2HNZ=2nN4MZLbA@mail.gmail.com>
	<4DFB42C2.6070001@rabbitmq.com>
Message-ID: <46c90c7c-49cc-4cbd-8605-860749cb0da4@r2g2000vbj.googlegroups.com>

Thank you all so much, your answers are really helpfull.

> if your design is 1000 queues and a choice between either 100 direct exchanges or one headers exchange
This is almost that except there would be a lot of more exchanges than
queues, say, 50 queues and 1000 direct exchanges.
But, if I understood what you've said previously, 1 exhange with 1000
tags should be better than 1000 exchanges with no tag.


From simon at rabbitmq.com  Fri Jun 17 14:45:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Jun 2011 14:45:28 +0100
Subject: [rabbitmq-discuss] Exchange performance
In-Reply-To: <46c90c7c-49cc-4cbd-8605-860749cb0da4@r2g2000vbj.googlegroups.com>
References: <95a152d1-af26-4879-8dee-0f2bea5ce303@h7g2000yqa.googlegroups.com>	<BANLkTi=8cwOUZ7JYgodw2HNZ=2nN4MZLbA@mail.gmail.com>	<4DFB42C2.6070001@rabbitmq.com>
	<46c90c7c-49cc-4cbd-8605-860749cb0da4@r2g2000vbj.googlegroups.com>
Message-ID: <4DFB5A78.9030209@rabbitmq.com>

On 17/06/11 14:38, Max C wrote:
> Thank you all so much, your answers are really helpfull.
>
>> if your design is 1000 queues and a choice between either 100 direct exchanges or one headers exchange
> This is almost that except there would be a lot of more exchanges than
> queues, say, 50 queues and 1000 direct exchanges.
> But, if I understood what you've said previously, 1 exhange with 1000
> tags should be better than 1000 exchanges with no tag.

I'm not sure I understand. But what I was trying to say is that the 
different exchange types scale differently with different numbers of 
bindings - fanout and direct are very fast, topic is fast (post 2.4.0), 
and headers is slow.

Worrying about this in advance may be a case of micro-optimisation though...

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From jon.charette at gmail.com  Fri Jun 17 16:51:23 2011
From: jon.charette at gmail.com (Jon Charette)
Date: Fri, 17 Jun 2011 11:51:23 -0400
Subject: [rabbitmq-discuss] Cluster with Single Message queue
Message-ID: <BANLkTimLxtUXRecp4AsyAitP-2PE2Fht2g@mail.gmail.com>

Greetings,



We are investigating using RabbitMQ in a clustered environment to provide
load balancing and some fault tolerance for an application currently under
development.


I'm not a developer, I'm the lead of our Operations team.  Clustering seems
the best approach for my team as it simplifies our application configuration
significantly.



My question is this.  Our Dev team has told me that since clustering only
provides node fault tolerance, it doesn't add any additional gain to our
design.  Specifically, they mentioned that since a message queue only
resides on one node,



"All data/state required for the operation of a RabbitMQ broker is
replicated across all nodes, for reliability and scaling, with full ACID
properties. An exception to this are message queues, which currently only
reside on the node that created them, though they are visible and reachable
from all nodes. Future releases of RabbitMQ will introduce migration and
replication of message queues."



clustering doesn't allow us to scale based on the numbers of messages being
sent to one queue.  Is this true, or does the cluster distribute messages
sent to the same message queue throughout off of its member nodes?  My
assumption based on the documentation is that this is the case, but if a
node is lost, messages that were currently residing on that node are lost as
well due to no fault tolerance.



Thanks much.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110617/4af1ee5e/attachment.htm>

From msteele at beringmedia.com  Fri Jun 17 18:05:52 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Fri, 17 Jun 2011 13:05:52 -0400
Subject: [rabbitmq-discuss] Cluster with Single Message queue
In-Reply-To: <BANLkTimLxtUXRecp4AsyAitP-2PE2Fht2g@mail.gmail.com>
References: <BANLkTimLxtUXRecp4AsyAitP-2PE2Fht2g@mail.gmail.com>
Message-ID: <BANLkTim=zqRbYc0PH-h9zfkA_nssvqwOcA@mail.gmail.com>

Hi Jon,

Rabbit will not scale to a large throughput of messages published to a
single queue as they all get delivered to a single node.

Here's one way to do it:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/012007.html

The gist is:

   - Rabbit doesn't scale on per queue basis. The answer: create many
   queues, bound to the same exchange
   - Use a direct exchange, which will rely on routing keys to decide which
   queue to deliver a message to
   - Pre-declare the queues on the nodes inside your cluster, bind them
   using a known set of routing keys (eg: queueA with routing keys 1-100 on
   server1, queueB with routing keys 101-200 on server2, etc...). Assuming
   durable queues here...
   - Have your publisher randomly pick a routing key and node to connect to
   (or use a load balancer)
   - Use the mandatory flag to ensure your message reaches a queue, if it
   fails re-publish using a different randomly picked routing key
   - Have your consumers connect to all queues

Using the technique described above, you can load balance incoming TCP
connections to a cluster of rabbit nodes. Load will get distributed based on
the randomly picked routing keys used by the publishers.

The problem with this is that HA is not addressed.

Mark Steele
Bering Media Inc.
+1 (416) 888-1009



On Fri, Jun 17, 2011 at 11:51 AM, Jon Charette <jon.charette at gmail.com>wrote:

> Greetings,
>
>
>
> We are investigating using RabbitMQ in a clustered environment to provide
> load balancing and some fault tolerance for an application currently under
> development.
>
>
> I'm not a developer, I'm the lead of our Operations team.  Clustering seems
> the best approach for my team as it simplifies our application configuration
> significantly.
>
>
>
> My question is this.  Our Dev team has told me that since clustering only
> provides node fault tolerance, it doesn't add any additional gain to our
> design.  Specifically, they mentioned that since a message queue only
> resides on one node,
>
>
>
> "All data/state required for the operation of a RabbitMQ broker is
> replicated across all nodes, for reliability and scaling, with full ACID
> properties. An exception to this are message queues, which currently only
> reside on the node that created them, though they are visible and reachable
> from all nodes. Future releases of RabbitMQ will introduce migration and
> replication of message queues."
>
>
>
> clustering doesn't allow us to scale based on the numbers of messages being
> sent to one queue.  Is this true, or does the cluster distribute messages
> sent to the same message queue throughout off of its member nodes?  My
> assumption based on the documentation is that this is the case, but if a
> node is lost, messages that were currently residing on that node are lost as
> well due to no fault tolerance.
>
>
>
> Thanks much.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110617/95cce7b4/attachment-0001.htm>

From simon at rabbitmq.com  Fri Jun 17 18:09:03 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 17 Jun 2011 18:09:03 +0100
Subject: [rabbitmq-discuss] 2.4.1, RABBITMQ_SERVER_START_ARGS,
 and the management plugin
In-Reply-To: <1e0eaf4f-a8ab-4184-bc0d-7ec4b206485e@h7g2000yqa.googlegroups.com>
References: <676E1597FDBED54694CBA16B69DE71C302E09E@PTGMAIL02v.protegra.com>
	<1e0eaf4f-a8ab-4184-bc0d-7ec4b206485e@h7g2000yqa.googlegroups.com>
Message-ID: <4DFB8A2F.7010905@rabbitmq.com>

Jason is using 2.4.1 though - the listener thing is new in 2.5.0.

Jason - the name of the application is "rabbit_mochiweb" in 2.4.1 and 
below, and "rabbitmq_mochiweb" in 2.5.0. So I think you need:

RABBITMQ_SERVER_START_ARGS="-rabbit_mochiweb port 54444"

Cheers, Simon

On 16/06/11 17:30, Joseph Marlin wrote:
> You have to configure a listener:
>
> [
>    ...
>    {rabbitmq_mochiweb, [{listeners, [{'*',  [{port, 55670}]},,
>                                      {mgmt, [{port, 55555}]}]}]},
>    ...
> ].
>
> On Jun 16, 12:07 pm, Jason Klassen<Jason.Klas... at protegra.com>  wrote:
>> Hi,
>>
>> We're using rabbitMQ server 2.4.1 and the management plugin.  I want to run the management plugin on a different port than 55672 and have it set using the rabbitmq-server.bat.
>>
>> Using the example from the clustering documentation I added this line
>>
>>      set RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb port 54444"
>>
>> after
>>
>>      setlocal enabledelayedexpansion
>>
>> but then running
>>
>>      rabbitmq-server.bat
>>
>> will successfully activate the plugins but the management plugin still starts up on 55672 and not 54444
>>
>>     http://localhost:55672/mgmt/#/ =  works
>>     http://localhost:54444/mgmt/#/= fails
>>
>> How can I start the management plugin on a different port using the RABBITMQ_SERVER_START_ARGS?
>>
>> Thanks,
>> Jason Klassen
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Fri Jun 17 18:16:38 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 17 Jun 2011 18:16:38 +0100
Subject: [rabbitmq-discuss] Question on who usually manages brokers
In-Reply-To: <BANLkTi=hTd1OXGn_+KURpskxEXLEajOT=Q@mail.gmail.com>
References: <BANLkTi=hTd1OXGn_+KURpskxEXLEajOT=Q@mail.gmail.com>
Message-ID: <BANLkTi=FhUA8oQtfFTDRtv3BczKdtKyFUg@mail.gmail.com>

James

I don't think there is 'one' reply to this.  Ultimately, IMO, the
infra should belong to an ops team when the scale of the company
merits that.

alexis


On Thu, Jun 16, 2011 at 2:59 PM, James Carr <james.r.carr at gmail.com> wrote:
> Hey All,
>
> We're prepping to do a major roll out of using rabbitmq at work and
> one of the questions that has come up is who would be responsible for
> owning the messaging infrastructure. Although we have some ideas I'd
> be interested in hearing how other midsized companies (500-2000
> employees) go about this.
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From joseph.a.marlin at gmail.com  Fri Jun 17 19:25:11 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Fri, 17 Jun 2011 11:25:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster with Single Message queue
In-Reply-To: <BANLkTim=zqRbYc0PH-h9zfkA_nssvqwOcA@mail.gmail.com>
References: <BANLkTimLxtUXRecp4AsyAitP-2PE2Fht2g@mail.gmail.com>
	<BANLkTim=zqRbYc0PH-h9zfkA_nssvqwOcA@mail.gmail.com>
Message-ID: <1568a687-7cb7-4ccf-8320-01eac2fd1a9a@v31g2000vbs.googlegroups.com>

See the attachment on this message for details on high availability
implementation coming soon that will change the ways queues on
clusters work signficantly:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-June/013304.html

On Jun 17, 1:05?pm, Mark Steele <mste... at beringmedia.com> wrote:
> Hi Jon,
>
> Rabbit will not scale to a large throughput of messages published to a
> single queue as they all get delivered to a single node.
>
> Here's one way to do it:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/01200...
>
> The gist is:
>
> ? ?- Rabbit doesn't scale on per queue basis. The answer: create many
> ? ?queues, bound to the same exchange
> ? ?- Use a direct exchange, which will rely on routing keys to decide which
> ? ?queue to deliver a message to
> ? ?- Pre-declare the queues on the nodes inside your cluster, bind them
> ? ?using a known set of routing keys (eg: queueA with routing keys 1-100 on
> ? ?server1, queueB with routing keys 101-200 on server2, etc...). Assuming
> ? ?durable queues here...
> ? ?- Have your publisher randomly pick a routing key and node to connect to
> ? ?(or use a load balancer)
> ? ?- Use the mandatory flag to ensure your message reaches a queue, if it
> ? ?fails re-publish using a different randomly picked routing key
> ? ?- Have your consumers connect to all queues
>
> Using the technique described above, you can load balance incoming TCP
> connections to a cluster of rabbit nodes. Load will get distributed based on
> the randomly picked routing keys used by the publishers.
>
> The problem with this is that HA is not addressed.
>
> Mark Steele
> Bering Media Inc.+1 (416) 888-1009
>
> On Fri, Jun 17, 2011 at 11:51 AM, Jon Charette <jon.chare... at gmail.com>wrote:
>
>
>
>
>
>
>
> > Greetings,
>
> > We are investigating using RabbitMQ in a clustered environment to provide
> > load balancing and some fault tolerance for an application currently under
> > development.
>
> > I'm not a developer, I'm the lead of our Operations team. ?Clustering seems
> > the best approach for my team as it simplifies our application configuration
> > significantly.
>
> > My question is this. ?Our Dev team has told me that since clustering only
> > provides node fault tolerance, it doesn't add any additional gain to our
> > design. ?Specifically, they mentioned that since a message queue only
> > resides on one node,
>
> > "All data/state required for the operation of a RabbitMQ broker is
> > replicated across all nodes, for reliability and scaling, with full ACID
> > properties. An exception to this are message queues, which currently only
> > reside on the node that created them, though they are visible and reachable
> > from all nodes. Future releases of RabbitMQ will introduce migration and
> > replication of message queues."
>
> > clustering doesn't allow us to scale based on the numbers of messages being
> > sent to one queue. ?Is this true, or does the cluster distribute messages
> > sent to the same message queue throughout off of its member nodes? ?My
> > assumption based on the documentation is that this is the case, but if a
> > node is lost, messages that were currently residing on that node are lost as
> > well due to no fault tolerance.
>
> > Thanks much.
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jasonjwwilliams at gmail.com  Fri Jun 17 19:51:40 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 17 Jun 2011 12:51:40 -0600
Subject: [rabbitmq-discuss] Fw: high availability solutions?
In-Reply-To: <20110617084501.GA2532@rabbitmq.com>
References: <BANLkTi=PB1oFv6LaYxeP+v3kEv6GVK6HUQ@mail.gmail.com>
	<4DF746AF.9000204@rabbitmq.com>
	<43ea3332-60b0-4fa8-b674-c9f763d0d5c8@c26g2000vbq.googlegroups.com>
	<4DF75F7D.4090902@rabbitmq.com>
	<70846.95116.qm@web111001.mail.gq1.yahoo.com>
	<4DF78AEA.7000703@rabbitmq.com>
	<BANLkTik8UyTt54R2BS0HSs83v-xxMU_m4g@mail.gmail.com>
	<20110616170011.GA30612@rabbitmq.com>
	<BANLkTi=kqXV5efNT=p0+gZD8_iyBOhO4eQ@mail.gmail.com>
	<20110617084501.GA2532@rabbitmq.com>
Message-ID: <BANLkTimRyv2xyebF-tMfh+JFyFtmfY4FZw@mail.gmail.com>

> We all agree that leaking details of the cluster to the clients is very
> likely not what's wanted in most cases, especially node names. However,
> the numCopies is far too inflexible. There are a number of suggestions
> in this area and they will be implemented in the future. However, there
> are genuine reasons why a client may want to control precisely which
> nodes get mirrors on them, or rather, why Rabbit may not be best placed
> to decide which nodes.

That makes sense. Perhaps something that allows Rabbit to be
"rack-aware" (a la Cassandra) by identifying a
rack/facility/group/unit to a node when it's joined to the cluster,
then mirroring can ensure that the copies are spread across nodes in
different "units".


Just want to say thank you for giving us info on y'all's plans early
and being open to feedback.

-J

From msteele at beringmedia.com  Fri Jun 17 19:58:14 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Fri, 17 Jun 2011 14:58:14 -0400
Subject: [rabbitmq-discuss] Cluster with Single Message queue
In-Reply-To: <1568a687-7cb7-4ccf-8320-01eac2fd1a9a@v31g2000vbs.googlegroups.com>
References: <BANLkTimLxtUXRecp4AsyAitP-2PE2Fht2g@mail.gmail.com>
	<BANLkTim=zqRbYc0PH-h9zfkA_nssvqwOcA@mail.gmail.com>
	<1568a687-7cb7-4ccf-8320-01eac2fd1a9a@v31g2000vbs.googlegroups.com>
Message-ID: <BANLkTik-VOqv6kKYjy-AxOjCt7zJhR+kxQ@mail.gmail.com>

Are there timelines on when such a mirrored queue implementation might make
it out the door?

Mark Steele
Bering Media Inc.
+1 (416) 888-1009



On Fri, Jun 17, 2011 at 2:25 PM, Joseph Marlin <joseph.a.marlin at gmail.com>wrote:

> See the attachment on this message for details on high availability
> implementation coming soon that will change the ways queues on
> clusters work signficantly:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-June/013304.html
>
> On Jun 17, 1:05 pm, Mark Steele <mste... at beringmedia.com> wrote:
> > Hi Jon,
> >
> > Rabbit will not scale to a large throughput of messages published to a
> > single queue as they all get delivered to a single node.
> >
> > Here's one way to do it:
> >
> > http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/01200...
> >
> > The gist is:
> >
> >    - Rabbit doesn't scale on per queue basis. The answer: create many
> >    queues, bound to the same exchange
> >    - Use a direct exchange, which will rely on routing keys to decide
> which
> >    queue to deliver a message to
> >    - Pre-declare the queues on the nodes inside your cluster, bind them
> >    using a known set of routing keys (eg: queueA with routing keys 1-100
> on
> >    server1, queueB with routing keys 101-200 on server2, etc...).
> Assuming
> >    durable queues here...
> >    - Have your publisher randomly pick a routing key and node to connect
> to
> >    (or use a load balancer)
> >    - Use the mandatory flag to ensure your message reaches a queue, if it
> >    fails re-publish using a different randomly picked routing key
> >    - Have your consumers connect to all queues
> >
> > Using the technique described above, you can load balance incoming TCP
> > connections to a cluster of rabbit nodes. Load will get distributed based
> on
> > the randomly picked routing keys used by the publishers.
> >
> > The problem with this is that HA is not addressed.
> >
> > Mark Steele
> > Bering Media Inc.+1 (416) 888-1009
> >
> > On Fri, Jun 17, 2011 at 11:51 AM, Jon Charette <jon.chare... at gmail.com
> >wrote:
> >
> >
> >
> >
> >
> >
> >
> > > Greetings,
> >
> > > We are investigating using RabbitMQ in a clustered environment to
> provide
> > > load balancing and some fault tolerance for an application currently
> under
> > > development.
> >
> > > I'm not a developer, I'm the lead of our Operations team.  Clustering
> seems
> > > the best approach for my team as it simplifies our application
> configuration
> > > significantly.
> >
> > > My question is this.  Our Dev team has told me that since clustering
> only
> > > provides node fault tolerance, it doesn't add any additional gain to
> our
> > > design.  Specifically, they mentioned that since a message queue only
> > > resides on one node,
> >
> > > "All data/state required for the operation of a RabbitMQ broker is
> > > replicated across all nodes, for reliability and scaling, with full
> ACID
> > > properties. An exception to this are message queues, which currently
> only
> > > reside on the node that created them, though they are visible and
> reachable
> > > from all nodes. Future releases of RabbitMQ will introduce migration
> and
> > > replication of message queues."
> >
> > > clustering doesn't allow us to scale based on the numbers of messages
> being
> > > sent to one queue.  Is this true, or does the cluster distribute
> messages
> > > sent to the same message queue throughout off of its member nodes?  My
> > > assumption based on the documentation is that this is the case, but if
> a
> > > node is lost, messages that were currently residing on that node are
> lost as
> > > well due to no fault tolerance.
> >
> > > Thanks much.
> >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110617/a0471f9c/attachment-0001.htm>

From Jason.Klassen at protegra.com  Fri Jun 17 21:38:36 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Fri, 17 Jun 2011 20:38:36 +0000
Subject: [rabbitmq-discuss] 2.4.1, RABBITMQ_SERVER_START_ARGS,
 and the management plugin
In-Reply-To: <4DFB8A2F.7010905@rabbitmq.com>
References: <676E1597FDBED54694CBA16B69DE71C302E09E@PTGMAIL02v.protegra.com>
	<1e0eaf4f-a8ab-4184-bc0d-7ec4b206485e@h7g2000yqa.googlegroups.com>
	<4DFB8A2F.7010905@rabbitmq.com>
Message-ID: <676E1597FDBED54694CBA16B69DE71C30314EF@PTGMAIL02v.protegra.com>

Hi Simon,

Thanks much, that did the trick.  In the batch file it only would work without no quotes

    set RABBITMQ_SERVER_START_ARGS=-rabbit_mochiweb port 54444

Thanks again,
Jason

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon MacMullen
Sent: June-17-11 12:09 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] 2.4.1, RABBITMQ_SERVER_START_ARGS, and the management plugin

Jason is using 2.4.1 though - the listener thing is new in 2.5.0.

Jason - the name of the application is "rabbit_mochiweb" in 2.4.1 and below, and "rabbitmq_mochiweb" in 2.5.0. So I think you need:

RABBITMQ_SERVER_START_ARGS="-rabbit_mochiweb port 54444"

Cheers, Simon

On 16/06/11 17:30, Joseph Marlin wrote:
> You have to configure a listener:
>
> [
>    ...
>    {rabbitmq_mochiweb, [{listeners, [{'*',  [{port, 55670}]},,
>                                      {mgmt, [{port, 55555}]}]}]},
>    ...
> ].
>
> On Jun 16, 12:07 pm, Jason Klassen<Jason.Klas... at protegra.com>  wrote:
>> Hi,
>>
>> We're using rabbitMQ server 2.4.1 and the management plugin.  I want to run the management plugin on a different port than 55672 and have it set using the rabbitmq-server.bat.
>>
>> Using the example from the clustering documentation I added this line
>>
>>      set RABBITMQ_SERVER_START_ARGS="-rabbitmq_mochiweb port 54444"
>>
>> after
>>
>>      setlocal enabledelayedexpansion
>>
>> but then running
>>
>>      rabbitmq-server.bat
>>
>> will successfully activate the plugins but the management plugin 
>> still starts up on 55672 and not 54444
>>
>>     http://localhost:55672/mgmt/#/ =  works
>>     http://localhost:54444/mgmt/#/= fails
>>
>> How can I start the management plugin on a different port using the RABBITMQ_SERVER_START_ARGS?
>>
>> Thanks,
>> Jason Klassen
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin
>> /mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tsuraan at gmail.com  Fri Jun 17 23:07:48 2011
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 17 Jun 2011 17:07:48 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 cluster cannot start
Message-ID: <BANLkTi=S7xKiYMp1fGvFBiu8J-wrZyo5Pw@mail.gmail.com>

I have a three-node rabbit cluster (running on hosts kvm-alpha,
kvm-beta, and kvm-gamma) that I just upgraded to 2.5.0, and it's
misbehaving a bit.  After upgrading, I wiped out the mnesia dirs
(/var/lib/rabbitmq/mnesia) on each of the three machines, and then
attempted to start the cluster up again.  I first started rabbit on
kvm-beta, and when I did that the rabbits on alpha and gamma could not
start.  I stopped the rabbit on beta, and started it on alpha and
gamma, and those are happy talking to each other.  In both cases, the
error that I'm getting looks like this:


starting database
...BOOT ERROR: FAILED
Reason: {error,
            {unable_to_join_cluster,
                ['rabbit at kvm-alpha','rabbit at kvm-beta','rabbit at kvm-gamma'],
                {aborted,
                    {function_clause,
                        [{mnesia_schema,cs2list,
                             [{cstruct,schema,set,[],
                                  ['rabbit at kvm-gamma','rabbit at kvm-alpha'],
                                  [],0,read_write,[],[],false,schema,
                                  [table,cstruct],
                                  [],[],
                                  {{1308,347724,86957},'rabbit at kvm-alpha'},
                                  {{4,0},
                                   {'rabbit at kvm-gamma',
                                       {1308,347733,438674}}}}]},
                         {mnesia_schema,do_merge_schema,1},
                         {mnesia_tm,apply_fun,3},
                         {mnesia_tm,execute_transaction,5},
                         {mnesia_schema,schema_coordinator,3}]}}}}
Stacktrace: [{rabbit_mnesia,init_db,3},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]
Erlang has closed

that one's on kvm-beta with rabbits running happily on kvm-alpha and
gamma, but it looks the same if I start on beta first than then let
alpha or gamma fail.  The cookie hash is the same for each rabbit, but
the erlang version on alpha and gamma is 5.8.3, while beta has 5.8.4.
Is that likely to be the problem?  I thought minor releases of erl
were compatible, but maybe they aren't from rabbit's POV?  If that
isn't likely to be the case, then I'd be happy to take suggestions
about what the problem probably is.

My config file is the same on all three nodes, and looks like this:

kvm-beta watched # cat /etc/rabbitmq/rabbitmq.config
[
 {rabbit, [
  {cluster_nodes, ['rabbit at kvm-alpha', 'rabbit at kvm-beta', 'rabbit at kvm-gamma']}
 ]}
].

I'd be happy to provide any other info that could be useful.

From josh at gebaschtel.ch  Sat Jun 18 11:28:06 2011
From: josh at gebaschtel.ch (Josh Geisser)
Date: Sat, 18 Jun 2011 12:28:06 +0200
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 cluster cannot start
In-Reply-To: <BANLkTi=S7xKiYMp1fGvFBiu8J-wrZyo5Pw@mail.gmail.com>
References: <BANLkTi=S7xKiYMp1fGvFBiu8J-wrZyo5Pw@mail.gmail.com>
Message-ID: <9C37154E143FE14CBA656B2D2232745F088AE856B8FE@popeye.gebaschtel.bnet>

I understand that alpha and gamma are working together, only beta won't join any other node? 

On beta, try to remove the cluster directive from the configfile and join it manually:

Rabbitmqctl stop_app
Rabbitmqctl cluster rabbit at kvm-alpha rabbit at kvm-gamma
Rabbitmqctl start_app


The command 'rabbitmqctl cluster_status' will show you the current and running nodes.

Cheers & good luck
Josh

-----Urspr?ngliche Nachricht-----
Von: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] Im Auftrag von tsuraan
Gesendet: Samstag, 18. Juni 2011 00:08
An: rabbitmq
Betreff: [rabbitmq-discuss] RabbitMQ 2.5.0 cluster cannot start

I have a three-node rabbit cluster (running on hosts kvm-alpha,
kvm-beta, and kvm-gamma) that I just upgraded to 2.5.0, and it's
misbehaving a bit.  After upgrading, I wiped out the mnesia dirs
(/var/lib/rabbitmq/mnesia) on each of the three machines, and then
attempted to start the cluster up again.  I first started rabbit on
kvm-beta, and when I did that the rabbits on alpha and gamma could not
start.  I stopped the rabbit on beta, and started it on alpha and
gamma, and those are happy talking to each other.  In both cases, the
error that I'm getting looks like this:


starting database
...BOOT ERROR: FAILED
Reason: {error,
            {unable_to_join_cluster,
                ['rabbit at kvm-alpha','rabbit at kvm-beta','rabbit at kvm-gamma'],
                {aborted,
                    {function_clause,
                        [{mnesia_schema,cs2list,
                             [{cstruct,schema,set,[],
                                  ['rabbit at kvm-gamma','rabbit at kvm-alpha'],
                                  [],0,read_write,[],[],false,schema,
                                  [table,cstruct],
                                  [],[],
                                  {{1308,347724,86957},'rabbit at kvm-alpha'},
                                  {{4,0},
                                   {'rabbit at kvm-gamma',
                                       {1308,347733,438674}}}}]},
                         {mnesia_schema,do_merge_schema,1},
                         {mnesia_tm,apply_fun,3},
                         {mnesia_tm,execute_transaction,5},
                         {mnesia_schema,schema_coordinator,3}]}}}}
Stacktrace: [{rabbit_mnesia,init_db,3},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1},
             {rabbit,start,2},
             {application_master,start_it_old,4}]
Erlang has closed

that one's on kvm-beta with rabbits running happily on kvm-alpha and
gamma, but it looks the same if I start on beta first than then let
alpha or gamma fail.  The cookie hash is the same for each rabbit, but
the erlang version on alpha and gamma is 5.8.3, while beta has 5.8.4.
Is that likely to be the problem?  I thought minor releases of erl
were compatible, but maybe they aren't from rabbit's POV?  If that
isn't likely to be the case, then I'd be happy to take suggestions
about what the problem probably is.

My config file is the same on all three nodes, and looks like this:

kvm-beta watched # cat /etc/rabbitmq/rabbitmq.config
[
 {rabbit, [
  {cluster_nodes, ['rabbit at kvm-alpha', 'rabbit at kvm-beta', 'rabbit at kvm-gamma']}
 ]}
].

I'd be happy to provide any other info that could be useful.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tsuraan at gmail.com  Sat Jun 18 15:54:24 2011
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 18 Jun 2011 09:54:24 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 cluster cannot start
In-Reply-To: <9C37154E143FE14CBA656B2D2232745F088AE856B8FE@popeye.gebaschtel.bnet>
References: <BANLkTi=S7xKiYMp1fGvFBiu8J-wrZyo5Pw@mail.gmail.com>
	<9C37154E143FE14CBA656B2D2232745F088AE856B8FE@popeye.gebaschtel.bnet>
Message-ID: <BANLkTikxXV9s5B1FZUqTO0k+8rv8t8NTow@mail.gmail.com>

> I understand that alpha and gamma are working together, only beta won't join any other node?
>
> On beta, try to remove the cluster directive from the configfile and join it manually:
>
> Rabbitmqctl stop_app
> Rabbitmqctl cluster rabbit at kvm-alpha rabbit at kvm-gamma
> Rabbitmqctl start_app

Here's the transcript of trying to do that by hand (rabbitmq is
running on beta without any config-file cluster config, and rabbit is
running clustered on the other two machines):

kvm-beta ~ # rabbitmqctl cluster_status
Cluster status of node 'rabbit at kvm-beta' ...
[{nodes,[{disc,['rabbit at kvm-beta']}]},{running_nodes,['rabbit at kvm-beta']}]
...done.
kvm-beta ~ # rabbitmqctl stop_app
Stopping node 'rabbit at kvm-beta' ...
...done.
kvm-beta ~ # rabbitmqctl reset
Resetting node 'rabbit at kvm-beta' ...
...done.
kvm-beta ~ # rabbitmqctl cluster rabbit at kvm-alpha
Clustering node 'rabbit at kvm-beta' with ['rabbit at kvm-alpha'] ...
Error: {unable_to_join_cluster,
           ['rabbit at kvm-alpha'],
           {aborted,
               {function_clause,
                   [{mnesia_schema,cs2list,
                        [{cstruct,schema,set,[],
                             ['rabbit at kvm-gamma','rabbit at kvm-alpha'],
                             [],0,read_write,[],[],false,schema,
                             [table,cstruct],
                             [],[],
                             {{1308,347724,86957},'rabbit at kvm-alpha'},
                             {{4,0},
                              {'rabbit at kvm-gamma',{1308,347733,438674}}}}]},
                    {mnesia_schema,do_merge_schema,1},
                    {mnesia_tm,apply_fun,3},
                    {mnesia_tm,execute_transaction,5},
                    {mnesia_schema,schema_coordinator,3}]}}}

If I try to join with kvm-gamma instead, it gives me the same errors.  Very odd.

From tsuraan at gmail.com  Sat Jun 18 15:57:48 2011
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 18 Jun 2011 09:57:48 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 cluster cannot start
In-Reply-To: <BANLkTikxXV9s5B1FZUqTO0k+8rv8t8NTow@mail.gmail.com>
References: <BANLkTi=S7xKiYMp1fGvFBiu8J-wrZyo5Pw@mail.gmail.com>
	<9C37154E143FE14CBA656B2D2232745F088AE856B8FE@popeye.gebaschtel.bnet>
	<BANLkTikxXV9s5B1FZUqTO0k+8rv8t8NTow@mail.gmail.com>
Message-ID: <BANLkTi=+9XBgF5Fs7QKfebzvdOVwcrJ3hg@mail.gmail.com>

> Here's the transcript of trying to do that by hand (rabbitmq is
> running on beta without any config-file cluster config, and rabbit is
> running clustered on the other two machines):
> [snip]

Has anybody tried running rabbit in a mixed 5.8.4/5.8.3 erlang
environment?  It seems like a pretty strong coincidence that the
rabbit running on 5.8.4 can't join the rabbits running on 5.8.3.  I
have no problem upgrading my erlang on the other two nodes, but if
rabbit should be able to work across erlang versions, then I'd like to
try to figure out what the problem really is.

From josh at gebaschtel.ch  Sat Jun 18 16:05:50 2011
From: josh at gebaschtel.ch (Josh Geisser)
Date: Sat, 18 Jun 2011 17:05:50 +0200
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 cluster cannot start
In-Reply-To: <BANLkTikxXV9s5B1FZUqTO0k+8rv8t8NTow@mail.gmail.com>
References: <BANLkTi=S7xKiYMp1fGvFBiu8J-wrZyo5Pw@mail.gmail.com>
	<9C37154E143FE14CBA656B2D2232745F088AE856B8FE@popeye.gebaschtel.bnet>
	<BANLkTikxXV9s5B1FZUqTO0k+8rv8t8NTow@mail.gmail.com>
Message-ID: <9C37154E143FE14CBA656B2D2232745F088AE856B8FF@popeye.gebaschtel.bnet>

What do the other two nodes say on 'rabbitmqclt cluster_status'? 
Also keep tailing the other's logfiles, they might tell you more...

Also, from which previous version were you upgrading?
I just had an unfortunate behaviour from 2.1.1 -> 2.5.0, mnesia got screwed up and I had to reinstall the whole cluster

To your question about Erlang, I have a cluster with R12B and R13B04.
(please not that all nodes must/should be the same rabbit version)

cheers

-----Urspr?ngliche Nachricht-----
Von: tsuraan [mailto:tsuraan at gmail.com] 
Gesendet: Samstag, 18. Juni 2011 16:54
An: Josh Geisser
Cc: rabbitmq
Betreff: Re: [rabbitmq-discuss] RabbitMQ 2.5.0 cluster cannot start

> I understand that alpha and gamma are working together, only beta won't join any other node?
>
> On beta, try to remove the cluster directive from the configfile and join it manually:
>
> Rabbitmqctl stop_app
> Rabbitmqctl cluster rabbit at kvm-alpha rabbit at kvm-gamma
> Rabbitmqctl start_app

Here's the transcript of trying to do that by hand (rabbitmq is
running on beta without any config-file cluster config, and rabbit is
running clustered on the other two machines):

kvm-beta ~ # rabbitmqctl cluster_status
Cluster status of node 'rabbit at kvm-beta' ...
[{nodes,[{disc,['rabbit at kvm-beta']}]},{running_nodes,['rabbit at kvm-beta']}]
...done.
kvm-beta ~ # rabbitmqctl stop_app
Stopping node 'rabbit at kvm-beta' ...
...done.
kvm-beta ~ # rabbitmqctl reset
Resetting node 'rabbit at kvm-beta' ...
...done.
kvm-beta ~ # rabbitmqctl cluster rabbit at kvm-alpha
Clustering node 'rabbit at kvm-beta' with ['rabbit at kvm-alpha'] ...
Error: {unable_to_join_cluster,
           ['rabbit at kvm-alpha'],
           {aborted,
               {function_clause,
                   [{mnesia_schema,cs2list,
                        [{cstruct,schema,set,[],
                             ['rabbit at kvm-gamma','rabbit at kvm-alpha'],
                             [],0,read_write,[],[],false,schema,
                             [table,cstruct],
                             [],[],
                             {{1308,347724,86957},'rabbit at kvm-alpha'},
                             {{4,0},
                              {'rabbit at kvm-gamma',{1308,347733,438674}}}}]},
                    {mnesia_schema,do_merge_schema,1},
                    {mnesia_tm,apply_fun,3},
                    {mnesia_tm,execute_transaction,5},
                    {mnesia_schema,schema_coordinator,3}]}}}

If I try to join with kvm-gamma instead, it gives me the same errors.  Very odd.

From matthias at rabbitmq.com  Sat Jun 18 16:19:26 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 18 Jun 2011 16:19:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 cluster cannot start
In-Reply-To: <BANLkTi=+9XBgF5Fs7QKfebzvdOVwcrJ3hg@mail.gmail.com>
References: <BANLkTi=S7xKiYMp1fGvFBiu8J-wrZyo5Pw@mail.gmail.com>	<9C37154E143FE14CBA656B2D2232745F088AE856B8FE@popeye.gebaschtel.bnet>	<BANLkTikxXV9s5B1FZUqTO0k+8rv8t8NTow@mail.gmail.com>
	<BANLkTi=+9XBgF5Fs7QKfebzvdOVwcrJ3hg@mail.gmail.com>
Message-ID: <4DFCC1FE.5090307@rabbitmq.com>

Tsuraan,

On 18/06/11 15:57, tsuraan wrote:
> Has anybody tried running rabbit in a mixed 5.8.4/5.8.3 erlang
> environment?  It seems like a pretty strong coincidence that the
> rabbit running on 5.8.4 can't join the rabbits running on 5.8.3.

It's not a coincidence. Tracking down the source of the reported error 
reveals that some of mnesia's internal record definitions have changed 
between R14B03 and R14B04. As a result you cannot mix pre-R14B04 nodes 
with post-R14B04 nodes in the same mnesia cluster.

Regards,

Matthias.

From tsuraan at gmail.com  Sat Jun 18 16:21:31 2011
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 18 Jun 2011 10:21:31 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 cluster cannot start
In-Reply-To: <4DFCC1FE.5090307@rabbitmq.com>
References: <BANLkTi=S7xKiYMp1fGvFBiu8J-wrZyo5Pw@mail.gmail.com>
	<9C37154E143FE14CBA656B2D2232745F088AE856B8FE@popeye.gebaschtel.bnet>
	<BANLkTikxXV9s5B1FZUqTO0k+8rv8t8NTow@mail.gmail.com>
	<BANLkTi=+9XBgF5Fs7QKfebzvdOVwcrJ3hg@mail.gmail.com>
	<4DFCC1FE.5090307@rabbitmq.com>
Message-ID: <BANLkTi=dpoHidWhMGVxkjfcuicXTVN-AxQ@mail.gmail.com>

> It's not a coincidence. Tracking down the source of the reported error
> reveals that some of mnesia's internal record definitions have changed
> between R14B03 and R14B04. As a result you cannot mix pre-R14B04 nodes with
> post-R14B04 nodes in the same mnesia cluster.

Ok, thanks for the info.  I'll make sure I don't try to mix erlang
versions in the future :)

From hufflepuff at hush.com  Sat Jun 18 16:11:04 2011
From: hufflepuff at hush.com (hufflepuff at hush.com)
Date: Sat, 18 Jun 2011 17:11:04 +0200
Subject: [rabbitmq-discuss] accessing rabbitmq with json-rpc
Message-ID: <20110618151104.4EA98E6721@smtp.hushmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I'm trying to access my rabbitmq server using the json-rpc plugin
on my local machine using a js client (specifically, jquery).

Specifically, if I followed the examples correctly, I'm trying to
POST my requests to http://localhost:55670/rpc/rabbitmq

The problem I have is firefox blocking my request or rather turning
it into a preflight OPTIONS request, for which the corresponding
server should reply with some message allowing CORS (which rabbitmq
obviously doesn't do).

The examples in the plugin rabbitmq_jsonrpc_channel_examples don't
have this problem, since they sit on the same port, and are not
subject to CORS.

I got this problem only when I changed the contentType in my ajax
request to application/json. Apparently, this contentType requires
CORS, whereas the default application/x-www-form-urlencoded is
considered safe. Sending the data as application/x-www-form-
urlencoded doesn't get you any reply from rabbitmq.

I have no problem POSTing to rabbitmq with curl, so this is
obviously due to the limitation of the browser.

What am I doing wrong? Is it even possible to send a POST request
to rabbitmq without changing the example plugin and loading it
straight into rabbitmq? Otherwise (sorry if this sounds rude) what
is the point of json-rpc?

Maybe this is a really trivial question, but I've been looking for
an answer for the better part of the day.

Some references from what I've dug up:
https://groups.google.com/group/rabbitmq-
discuss/browse_thread/thread/5d3ad18f7c48b020?fwc=1

Thanks in advance
Jason
-----BEGIN PGP SIGNATURE-----
Charset: UTF8
Version: Hush 3.0
Note: This signature can be verified at https://www.hushtools.com/verify

wsBcBAEBAgAGBQJN/MAIAAoJEL7Kanawu8RE5YoH/RkA1YbYeer2ozfwEzF28Eb+wh4F
MpeLBlUtF+C2PFR8xo4yrt28pmGSFpvCTjwG/h35HuO3AxifM8x8eJSlmtBaQ+ffwfRu
s2Qupje5RhhG6iOFF9Akr4ZnhTfpIwqfYSKdN9HNtF+vp4uG/VY+KUiic/f1MQnBICOn
rfA4E5v6yvadsHXJI3Q7NEQHgIYcF4R4mTfzgR5dqtg9OEMEZWSqqy3wgADjx6GtykWs
0+uHafWiJzpafJaTQtqP7SrBL0XHmTyutS+402GNKXwpG+JFX94DDawdsfuhIl+hS3pj
tM/uX595tA6BEF5pBkRUe9F0IdIYhOPdtnQ9er4jOxs=
=8wUa
-----END PGP SIGNATURE-----


From videlalvaro at gmail.com  Sun Jun 19 16:54:12 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 19 Jun 2011 17:54:12 +0200
Subject: [rabbitmq-discuss] Rabbit Boot Steps
Message-ID: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>

Hi,

I'm reading the code of RabbitMQ. I've seen the *rabbit_boot_step* many times already and I always wondered if that's some Erlang feature/good practice or is it some clever idea to ensure dependencies/ordering while starting an Erlang app?

I haven't seen *boot_steps* in other Erlang apps, that's why I ask.

Cheers,

Alvaro

From matthew at rabbitmq.com  Sun Jun 19 20:32:29 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 19 Jun 2011 20:32:29 +0100
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
Message-ID: <20110619193229.GA2535@rabbitmq.com>

On Sun, Jun 19, 2011 at 05:54:12PM +0200, Alvaro Videla wrote:
> I'm reading the code of RabbitMQ. I've seen the *rabbit_boot_step*
> many times already and I always wondered if that's some Erlang
> feature/good practice or is it some clever idea to ensure
> dependencies/ordering while starting an Erlang app?
> 
> I haven't seen *boot_steps* in other Erlang apps, that's why I ask.

We invented it. Not sure whether other apps have something similar or
not. I think it's pretty neat.

Matthew

From videlalvaro at gmail.com  Sun Jun 19 20:52:21 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 19 Jun 2011 21:52:21 +0200
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <20110619193229.GA2535@rabbitmq.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
	<20110619193229.GA2535@rabbitmq.com>
Message-ID: <92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>

Hi,

On Jun 19, 2011, at 9:32 PM, Matthew Sackman wrote:
> We invented it. Not sure whether other apps have something similar or
> not. I think it's pretty neat.

It is indeed.

So, basically rabbit:boot_steps/0 will look for *rabbit_boot_step* declarations in the loaded apps modules, which mean we can use them on plugins right?

BTW, I attached a silly patch for rabbit_misc:module_attributes/1 warning message when the module is not defined. I think the function can be used for all kind of attributes an not only boot steps.

-Alvaro

-------------- next part --------------
A non-text attachment was scrubbed...
Name: warning.diff
Type: application/octet-stream
Size: 575 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110619/abafa9fb/attachment.obj>

From matthew at rabbitmq.com  Sun Jun 19 21:56:30 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sun, 19 Jun 2011 21:56:30 +0100
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
	<20110619193229.GA2535@rabbitmq.com>
	<92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>
Message-ID: <20110619205630.GB2535@rabbitmq.com>

On Sun, Jun 19, 2011 at 09:52:21PM +0200, Alvaro Videla wrote:
> So, basically rabbit:boot_steps/0 will look for *rabbit_boot_step* declarations in the loaded apps modules, which mean we can use them on plugins right?

Yup indeed. The nice thing is that that means you can just put the boot
steps in the relevant locations in your plugins.

> BTW, I attached a silly patch for rabbit_misc:module_attributes/1 warning message when the module is not defined. I think the function can be used for all kind of attributes an not only boot steps.

That's correct. We only use it with all the modules that we find - we
only call it from all_module_attributes, but yes, the error msg is
overly specific, as you spotted. Thanks.

Matthew

From videlalvaro at gmail.com  Sun Jun 19 22:46:04 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sun, 19 Jun 2011 23:46:04 +0200
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <20110619205630.GB2535@rabbitmq.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
	<20110619193229.GA2535@rabbitmq.com>
	<92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>
	<20110619205630.GB2535@rabbitmq.com>
Message-ID: <A4563130-D976-458A-AE5E-249A65F79BAE@gmail.com>

Hi,

I've extracted the boot steps logic into its own module. I think in this way it might get easier to use by projects outside RabbitMQ.

So far it depends on rabbit_misc:all_module_attributes/1 and rabbit_misc:build_acyclic_graph/3 but they are used in other parts of Rabbit's code so I don't know what's the best approach here.

I've added some specs, I hope they are correct, since is the first time I write those. Also I added extra functionality. So it's possible to have boot steps like -my_app_boot_step and so on. In this way, the prefix can be customized. There's a function boot_steps/1 that will look for the <prefix>_boot_step attributes. If prefix is omitted, then the current application name will be used.

My idea is to extract this module to some library via a Make target in the same way rabbit_common is extracted today.

I've attached the patch and the new module, let me know what you think.

-Alvaro

-------------- next part --------------
A non-text attachment was scrubbed...
Name: boot.diff
Type: application/octet-stream
Size: 3993 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110619/b21fa6a0/attachment-0002.obj>
-------------- next part --------------


-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_boot_step.erl
Type: application/octet-stream
Size: 4732 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110619/b21fa6a0/attachment-0003.obj>
-------------- next part --------------


On Jun 19, 2011, at 10:56 PM, Matthew Sackman wrote:

> On Sun, Jun 19, 2011 at 09:52:21PM +0200, Alvaro Videla wrote:
>> So, basically rabbit:boot_steps/0 will look for *rabbit_boot_step* declarations in the loaded apps modules, which mean we can use them on plugins right?
> 
> Yup indeed. The nice thing is that that means you can just put the boot
> steps in the relevant locations in your plugins.
> 
>> BTW, I attached a silly patch for rabbit_misc:module_attributes/1 warning message when the module is not defined. I think the function can be used for all kind of attributes an not only boot steps.
> 
> That's correct. We only use it with all the modules that we find - we
> only call it from all_module_attributes, but yes, the error msg is
> overly specific, as you spotted. Thanks.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From simon at rabbitmq.com  Mon Jun 20 11:10:33 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 Jun 2011 11:10:33 +0100
Subject: [rabbitmq-discuss] 2.4.1, RABBITMQ_SERVER_START_ARGS,
 and the management plugin
In-Reply-To: <676E1597FDBED54694CBA16B69DE71C30314EF@PTGMAIL02v.protegra.com>
References: <676E1597FDBED54694CBA16B69DE71C302E09E@PTGMAIL02v.protegra.com>	<1e0eaf4f-a8ab-4184-bc0d-7ec4b206485e@h7g2000yqa.googlegroups.com>
	<4DFB8A2F.7010905@rabbitmq.com>
	<676E1597FDBED54694CBA16B69DE71C30314EF@PTGMAIL02v.protegra.com>
Message-ID: <4DFF1C99.3080902@rabbitmq.com>

On 17/06/11 21:38, Jason Klassen wrote:
> Thanks much, that did the trick.  In the batch file it only would work without no quotes

Ah, right. Yeah, that was with my Unix head on.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jun 20 11:12:54 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 Jun 2011 11:12:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 cluster cannot start
In-Reply-To: <9C37154E143FE14CBA656B2D2232745F088AE856B8FF@popeye.gebaschtel.bnet>
References: <BANLkTi=S7xKiYMp1fGvFBiu8J-wrZyo5Pw@mail.gmail.com>	<9C37154E143FE14CBA656B2D2232745F088AE856B8FE@popeye.gebaschtel.bnet>	<BANLkTikxXV9s5B1FZUqTO0k+8rv8t8NTow@mail.gmail.com>
	<9C37154E143FE14CBA656B2D2232745F088AE856B8FF@popeye.gebaschtel.bnet>
Message-ID: <4DFF1D26.7010301@rabbitmq.com>

On 18/06/11 16:05, Josh Geisser wrote:
> Also, from which previous version were you upgrading? I just had an
> unfortunate behaviour from 2.1.1 ->  2.5.0, mnesia got screwed up and
> I had to reinstall the whole cluster

Huh. That should work.

I don't suppose you have any record of the 2.1.1 data directories?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Jun 20 14:49:17 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 20 Jun 2011 14:49:17 +0100
Subject: [rabbitmq-discuss] accessing rabbitmq with json-rpc
In-Reply-To: <20110618151104.4EA98E6721@smtp.hushmail.com>
References: <20110618151104.4EA98E6721@smtp.hushmail.com>
Message-ID: <4DFF4FDD.9080108@rabbitmq.com>

On 18/06/11 16:11, hufflepuff at hush.com wrote:
> What am I doing wrong? Is it even possible to send a POST request
> to rabbitmq without changing the example plugin and loading it
> straight into rabbitmq? Otherwise (sorry if this sounds rude) what
> is the point of json-rpc?

I assume that most people using json-rpc either:

1) Play with it in a trivial manner (i.e. serve static content with 
RabbitMQ)

or

2) Use some HTTP proxying to make it seem like part of the same domain

or

3) Use it with some server-side http messaging (I think someone wrote a 
PHP library which talks to JSON-RPC rather than AMQP?)

Having said that, it seems like CORS support would be a sensible thing 
to add. Having said *that*, rabbitmq-jsonrpc-channel doesn't really have 
a maintainer now, so I can't promise anything.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From abinesh.s at gmail.com  Mon Jun 20 15:47:10 2011
From: abinesh.s at gmail.com (abinesh s)
Date: Mon, 20 Jun 2011 20:17:10 +0530
Subject: [rabbitmq-discuss] Grails Plugin failed to fetch groovy Objects.
Message-ID: <BANLkTikNb6Ay6mfUdeFaVPD=9FKRTwmoxg@mail.gmail.com>

Hi,

Our problem is that, We created two Grails applications and one application
trying to post messages and it is posting successfully. And another
application has to fetch it and needs to process it. But, The messages are
not getting fetched and processed. Dont know whats happening there. And if
we are using java objects it is working fine(both producer and consumer).
But the Groovy objects are not getting fetched. We need some urgent solution
to this problem. We are using RabbitMQ Grails plugin version 0.3.

-- 
Thanks and Regards
Abinesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110620/3b1bfce5/attachment.htm>

From nominal at gmail.com  Mon Jun 20 19:25:09 2011
From: nominal at gmail.com (flzz)
Date: Mon, 20 Jun 2011 11:25:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer setup performance / starvation issue
Message-ID: <de22739c-11c7-4da8-b252-faa0d5239ddd@u26g2000vby.googlegroups.com>

Greetings,  I'm in the process of vetting RabbitMQ for a high
throughput
event bus.  In testing various durability cases I've observed some
behavior
that I can't explain.  I'll start by elaborating on the setup.

First,  I'm using a very simple direct exchange producer/consumer
environment
ala http://www.rabbitmq.com/tutorials/tutorial-two-python.html

I have a single broker and a single worker machine, both physical
boxes.
Both are identical hardware.  I am using python and kombu for the
producers/consumers.

To keep things as simple as possible for testing, I'm publishing a
Hello World!
message as fast as possible into the queue (I see upwards of 20k
messages/sec being published with 4 producers).  The publishing works
well
enough.

There are a few ways to create (what I think is) the problematic
condition,
but the common thread with all of them is queued messages (on durable
or
non-durable queue).

So, the steps to achieve this are as follows, this simulates a very
controlled condition of worker failure.  The problem arises when
workers/consumers begin to establish a new connection after all
workers have
failed.

1. Start a single producer, let it queue 500,000 messages or so, then
stop it
2. Start up 16 workers to consume the queue (workers have a prefetch
of 1)

The first 7 to 8 workers will successfully setup and start processing
messages, the other 8 to 9 workers will sit in a wait state while
trying to
set themselves up as consumers.  Only after all the messages in the
queue are
processed will the rest of the workers successfully establish a
connection
as a consumer.

Here is a log snippet generated by the benchmarking that is in the
simple
worker I'm using.  This is 8 different workers that are finally able
to
successfully establish themselves as consumers after the queue was
fully
processed.

DEBUG:amqp_worker:create_consumer took 53064.931 ms
DEBUG:amqp_worker:create_consumer took 52985.335 ms
DEBUG:amqp_worker:create_consumer took 51774.898 ms
DEBUG:amqp_worker:create_consumer took 54275.732 ms
DEBUG:amqp_worker:set_qos took 0.437 ms
DEBUG:amqp_worker:register_callback took 0.011 ms
DEBUG:amqp_worker:create_consumer took 55493.148 ms
DEBUG:amqp_worker:create_consumer took 54205.868 ms
DEBUG:amqp_worker:create_consumer took 51856.420 ms
DEBUG:amqp_worker:create_consumer took 55415.933 ms

To be clear, create_consumer is effectively the same as:

    channel.basic_consume(callback, queue='task_queue')

At this point I should mention that I can't find any type of
documentation that
would indicate this as being normal.

Now into a few more details about what I've tried to eliminate as
possible
causes.  I've used Kombu with pyamqplib transport,  pika directly
without
Kombu, and pyamqplib directly without kombu, Rabbit version 2.4.1 and
2.5.0.
All exhibited the same behavior as described above.  It really seems
to be
the broker itself.  I've also tried various config tweaks for erlang
and
rabbit,  ie, setting the async thread pool to 0, disabling
kernel polling, disabled all management plugins/stats collection,
setting
consumer prefetch to 0 as well as 10 etc, all to no avail.

Another item worth mentioning, is that rabbitmqctl list_channels will
exhibit
the same wait issue when workers are processing the queued messages.
I can provide further details and all the code I'm using for
producers/consumers if needed, but this issue can be duplicated with
the
examples from http://www.rabbitmq.com/tutorials/tutorial-two-python.html

I really hope I'm missing something simple, any insights would be much
appreciated!

Here are some additional details about broker os, status & evironment

Ubuntu lucid 10.04.2

Application environment of node rabbit at broker2 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,coarse},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_is_admin,true},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {frame_max,131072},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {persister_hibernate_after,10000},
 {persister_max_wrap_entries,500},
 {queue_index_max_journal_entries,262144},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[{"0.0.0.0",5672}]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.8}]
...done.

Status of node rabbit at broker2 ...
[{pid,15744},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.5.0"},
      {webmachine,"webmachine","1.7.0-rmq2.5.0-hg0c4b60a"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.5.0"},
      {amqp_client,"RabbitMQ AMQP Client","2.5.0"},
      {rabbit,"RabbitMQ","2.5.0"},
      {os_mon,"CPO  CXC 138 46","2.2.5"},
      {sasl,"SASL  CXC 138 11","2.1.9.2"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.5.0"},
      {mochiweb,"MochiMedia Web Server","1.3-rmq2.5.0-git9a53dbd"},
      {inets,"INETS  CXC 138 49","5.4"},
      {mnesia,"MNESIA  CXC 138 12","4.4.14"},
      {stdlib,"ERTS  CXC 138 10","1.17"},
      {kernel,"ERTS  CXC 138 10","2.14"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14A (erts-5.8) [source] [64-bit] [smp:16:16] [rq:16]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,57446128},
      {processes,12534864},
      {processes_used,12528176},
      {system,44911264},
      {atom,1317185},
      {atom_used,1283859},
      {binary,110448},
      {code,15152068},
      {ets,8861792}]}]
...done.

Cheers,
Etrik

From matthias at rabbitmq.com  Mon Jun 20 19:35:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 20 Jun 2011 19:35:10 +0100
Subject: [rabbitmq-discuss] Consumer setup performance / starvation issue
In-Reply-To: <de22739c-11c7-4da8-b252-faa0d5239ddd@u26g2000vby.googlegroups.com>
References: <de22739c-11c7-4da8-b252-faa0d5239ddd@u26g2000vby.googlegroups.com>
Message-ID: <4DFF92DE.7010404@rabbitmq.com>

Etrik,

On 20/06/11 19:25, flzz wrote:
> 1. Start a single producer, let it queue 500,000 messages or so, then
> stop it
> 2. Start up 16 workers to consume the queue (workers have a prefetch
> of 1)
>
> The first 7 to 8 workers will successfully setup and start
> processing messages, the other 8 to 9 workers will sit in a wait
> state while trying to set themselves up as consumers. Only after all
> the messages in the queue are processed will the rest of the workers
> successfully establish a connection as a consumer. >
> [...]
> Another item worth mentioning, is that rabbitmqctl list_channels
> will exhibit the same wait issue when workers are processing the
> queued messages.

I have a theory for why this may be happening. To confirm it, could you 
please get your workers to run more slowly, e.g. insert a sleep/pause 
between them receiving a message and then ack'ing it. Does that change 
the behaviour?

Regards,

Matthias.

From pdezwart at rubiconproject.com  Mon Jun 20 19:50:50 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 20 Jun 2011 11:50:50 -0700
Subject: [rabbitmq-discuss] Question on who usually manages brokers
In-Reply-To: <BANLkTi=FhUA8oQtfFTDRtv3BczKdtKyFUg@mail.gmail.com>
Message-ID: <CA24E49A.210E0%pdezwart@rubiconproject.com>

Hey James,

We are actually dealing with this very problem right now, and maybe our
experience can help inform your decision.
We have been using RabbitMQ for a little over a year. It started off as a
cool side project, because we thought it would be an interesting tool to
have. Unfortunately, RabbitMQ worked so well that it soon became a mission
critical portion of our system, even though the underlying install/setup was
done by non-operations people. However, because Rabbit is so solid, we have
yet to have any negative consequences (knock on wood.)

We are now a mid-size business, and I am pushing hard to get ops to take
over the basic setup and administration of Rabbit. The way it is treated and
used is much like Memcache or any other service: I have people on my team
who deeply understand how to use it and architect applications around it,
but they work in conjunction with Ops who administers and manages it.

My take aways are therefore:
Rabbit became mission critical really quickly
+ There are people better suited at dealing with servers, hardware,
configurations, etc.
+ I don't like to wake up at 3am on Sunday
= Ops is taking ownership.

me

On 6/17/11 10:16 AM, "Alexis Richardson" <alexis at rabbitmq.com> wrote:

> James
> 
> I don't think there is 'one' reply to this.  Ultimately, IMO, the
> infra should belong to an ops team when the scale of the company
> merits that.
> 
> alexis
> 
> 
> On Thu, Jun 16, 2011 at 2:59 PM, James Carr <james.r.carr at gmail.com> wrote:
>> Hey All,
>> 
>> We're prepping to do a major roll out of using rabbitmq at work and
>> one of the questions that has come up is who would be responsible for
>> owning the messaging infrastructure. Although we have some ideas I'd
>> be interested in hearing how other midsized companies (500-2000
>> employees) go about this.
>> 
>> Thanks,
>> James
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From nominal at gmail.com  Mon Jun 20 19:55:06 2011
From: nominal at gmail.com (flzz)
Date: Mon, 20 Jun 2011 11:55:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer setup performance / starvation issue
In-Reply-To: <4DFF92DE.7010404@rabbitmq.com>
References: <de22739c-11c7-4da8-b252-faa0d5239ddd@u26g2000vby.googlegroups.com>
	<4DFF92DE.7010404@rabbitmq.com>
Message-ID: <b79f3e45-a20a-4fc5-aae8-af2e004bd94b@gc3g2000vbb.googlegroups.com>

Yup, certainly does change the behavior.  I put a 1ms sleep before the
ack and all the workers establish a full consumer connection in a
reasonable amount of time.

Etrik

On Jun 20, 2:35?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> Etrik,
>
> On 20/06/11 19:25, flzz wrote:
>
> > 1. Start a single producer, let it queue 500,000 messages or so, then
> > stop it
> > 2. Start up 16 workers to consume the queue (workers have a prefetch
> > of 1)
>
> > The first 7 to 8 workers will successfully setup and start
> > processing messages, the other 8 to 9 workers will sit in a wait
> > state while trying to set themselves up as consumers. Only after all
> > the messages in the queue are processed will the rest of the workers
> > successfully establish a connection as a consumer. >
> > [...]
> > Another item worth mentioning, is that rabbitmqctl list_channels
> > will exhibit the same wait issue when workers are processing the
> > queued messages.
>
> I have a theory for why this may be happening. To confirm it, could you
> please get your workers to run more slowly, e.g. insert a sleep/pause
> between them receiving a message and then ack'ing it. Does that change
> the behaviour?
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From fabiomargarido at gmail.com  Mon Jun 20 20:05:34 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Mon, 20 Jun 2011 16:05:34 -0300
Subject: [rabbitmq-discuss] rabbitmq-lvc-plugin broken with 2.5.0 release
In-Reply-To: <4DFB19FA.5080800@rabbitmq.com>
References: <BANLkTim_19Ah2ttNuZmk2SpEaE2N+1FkEg@mail.gmail.com>
	<4DFB19FA.5080800@rabbitmq.com>
Message-ID: <BANLkTinyhHMxmmM6dMEUkdFtd34T81PuMA@mail.gmail.com>

On Fri, Jun 17, 2011 at 06:10, Michael Bridgen <mikeb at rabbitmq.com> wrote:
>
> I've updated it. There were yet more changes to how exchange type callbacks
> are called, a change to a record definition (basic_message), the boot
> sequence, and a different plugin build system.  Just about the only thing
> that hasn't changed is the name!  Oh actually no that had to change too.


Thank you very much. It's working now.
 A little bit off topic: any news on whether this type of non-pure AMQP
scenario will be more officially supported by RabbitMQ? It seems there was a
productive discussion on the list some time ago but it stopped.
Best regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110620/19960b8f/attachment-0001.htm>

From Kamil.Choudhury at anserinae.net  Mon Jun 20 20:15:51 2011
From: Kamil.Choudhury at anserinae.net (Kamil Choudhury)
Date: Mon, 20 Jun 2011 19:15:51 +0000
Subject: [rabbitmq-discuss] Question on who usually manages brokers
In-Reply-To: <CA24E49A.210E0%pdezwart@rubiconproject.com>
References: <BANLkTi=FhUA8oQtfFTDRtv3BczKdtKyFUg@mail.gmail.com>,
	<CA24E49A.210E0%pdezwart@rubiconproject.com>
Message-ID: <70C54549D24F0141B65FD8AB152BFBA0CBD10BEB@janus.anserinae.net>

Once an IT organization grows beyond a certain size, I think it's natural for the ownership of production messaging infrastructure to be transferred over to a dedicated sysops team. 

That said, there is something to be said for not relinquishing too much control to dedicated teams. I prefer to maintain control of my development infrastructure: the overhead of coordinating with external teams on the numerous config changes involved during the development period of any project is a horrible productivity sink. 

YMMV. 
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Pieter de Zwart [pdezwart at rubiconproject.com]
Sent: Monday, June 20, 2011 2:50 PM
To: Alexis Richardson; James Carr
Cc: rabbitmq-discuss
Subject: Re: [rabbitmq-discuss] Question on who usually manages brokers

Hey James,

We are actually dealing with this very problem right now, and maybe our
experience can help inform your decision.
We have been using RabbitMQ for a little over a year. It started off as a
cool side project, because we thought it would be an interesting tool to
have. Unfortunately, RabbitMQ worked so well that it soon became a mission
critical portion of our system, even though the underlying install/setup was
done by non-operations people. However, because Rabbit is so solid, we have
yet to have any negative consequences (knock on wood.)

We are now a mid-size business, and I am pushing hard to get ops to take
over the basic setup and administration of Rabbit. The way it is treated and
used is much like Memcache or any other service: I have people on my team
who deeply understand how to use it and architect applications around it,
but they work in conjunction with Ops who administers and manages it.

My take aways are therefore:
Rabbit became mission critical really quickly
+ There are people better suited at dealing with servers, hardware,
configurations, etc.
+ I don't like to wake up at 3am on Sunday
= Ops is taking ownership.

me

On 6/17/11 10:16 AM, "Alexis Richardson" <alexis at rabbitmq.com> wrote:

> James
>
> I don't think there is 'one' reply to this.  Ultimately, IMO, the
> infra should belong to an ops team when the scale of the company
> merits that.
>
> alexis
>
>
> On Thu, Jun 16, 2011 at 2:59 PM, James Carr <james.r.carr at gmail.com> wrote:
>> Hey All,
>>
>> We're prepping to do a major roll out of using rabbitmq at work and
>> one of the questions that has come up is who would be responsible for
>> owning the messaging infrastructure. Although we have some ideas I'd
>> be interested in hearing how other midsized companies (500-2000
>> employees) go about this.
>>
>> Thanks,
>> James
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Mon Jun 20 20:22:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 20 Jun 2011 20:22:41 +0100
Subject: [rabbitmq-discuss] Consumer setup performance / starvation issue
In-Reply-To: <b79f3e45-a20a-4fc5-aae8-af2e004bd94b@gc3g2000vbb.googlegroups.com>
References: <de22739c-11c7-4da8-b252-faa0d5239ddd@u26g2000vby.googlegroups.com>	<4DFF92DE.7010404@rabbitmq.com>
	<b79f3e45-a20a-4fc5-aae8-af2e004bd94b@gc3g2000vbb.googlegroups.com>
Message-ID: <4DFF9E01.1050309@rabbitmq.com>

Etrik,

On 20/06/11 19:55, flzz wrote:
> Yup, certainly does change the behavior.  I put a 1ms sleep before the
> ack and all the workers establish a full consumer connection in a
> reasonable amount of time.

Excellent.

Currently rabbit queues prioritise certain operations over others. There 
are good reasons for doing that which I don't want you to bore with, but 
the outcome in this case is that when a set of workers can keep up with 
the flow of messages dispatched to them by a queue, then additional 
workers may get starved.

Note that when this happens the additional workers wouldn't actually 
result in the work getting processed more quickly, even if they were 
getting messages.

Nevertheless, this behaviour is undesirable, so I've filed a bug to fix it.

Thanks for reporting this! It's interesting that you are the first 
person to spot the issue even though the behaviour has been like this 
for years. I guess most users either run fewer workers than you or their 
workers spend longer processing each message.


Regards,

Matthias.

From cooltechemail at gmail.com  Mon Jun 20 20:44:29 2011
From: cooltechemail at gmail.com (Vince)
Date: Tue, 21 Jun 2011 03:44:29 +0800
Subject: [rabbitmq-discuss] avoid duplicate messages in queue
Message-ID: <BANLkTinO6Ht+g7n1VdUPE568dgp4z8LRHA@mail.gmail.com>

Hi,

I am wondering if there is anyway to avoid duplicate messages in rabbitmq?
We have a loop that will submit jobs to rabbitmq once every 15 minutes.
However, some of the jobs take longer than 15 minutes to complete. So we are
wondering if there is anyway to search the content of the queue before we
submit. Does rabbitmq support this kind of search?

Thank you,

Vince
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110621/93d090bf/attachment.htm>

From nominal at gmail.com  Mon Jun 20 21:27:11 2011
From: nominal at gmail.com (flzz)
Date: Mon, 20 Jun 2011 13:27:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer setup performance / starvation issue
In-Reply-To: <4DFF9E01.1050309@rabbitmq.com>
References: <de22739c-11c7-4da8-b252-faa0d5239ddd@u26g2000vby.googlegroups.com>
	<4DFF92DE.7010404@rabbitmq.com>
	<b79f3e45-a20a-4fc5-aae8-af2e004bd94b@gc3g2000vbb.googlegroups.com>
	<4DFF9E01.1050309@rabbitmq.com>
Message-ID: <93d3a2be-0a95-45d6-94aa-4af4883e7394@i4g2000yqg.googlegroups.com>

Glad to be helpful,  thanks for the interim solution as well!

Etrik

On Jun 20, 3:22?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> Etrik,
>
> On 20/06/11 19:55, flzz wrote:
>
> > Yup, certainly does change the behavior. ?I put a 1ms sleep before the
> > ack and all the workers establish a full consumer connection in a
> > reasonable amount of time.
>
> Excellent.
>
> Currently rabbit queues prioritise certain operations over others. There
> are good reasons for doing that which I don't want you to bore with, but
> the outcome in this case is that when a set of workers can keep up with
> the flow of messages dispatched to them by a queue, then additional
> workers may get starved.
>
> Note that when this happens the additional workers wouldn't actually
> result in the work getting processed more quickly, even if they were
> getting messages.
>
> Nevertheless, this behaviour is undesirable, so I've filed a bug to fix it.
>
> Thanks for reporting this! It's interesting that you are the first
> person to spot the issue even though the behaviour has been like this
> for years. I guess most users either run fewer workers than you or their
> workers spend longer processing each message.
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Mon Jun 20 22:16:02 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 21 Jun 2011 01:16:02 +0400
Subject: [rabbitmq-discuss] avoid duplicate messages in queue
In-Reply-To: <BANLkTinO6Ht+g7n1VdUPE568dgp4z8LRHA@mail.gmail.com>
References: <BANLkTinO6Ht+g7n1VdUPE568dgp4z8LRHA@mail.gmail.com>
Message-ID: <BANLkTikhkZ35FhrzqkaTAJsyaN3cRWfxtA@mail.gmail.com>

2011/6/20 Vince <cooltechemail at gmail.com>

> I am wondering if there is anyway to avoid duplicate messages in rabbitmq?
> We have a loop that will submit jobs to rabbitmq once every 15 minutes.
> However, some of the jobs take longer than 15 minutes to complete. So we are
> wondering if there is anyway to search the content of the queue before we
> submit. Does rabbitmq support this kind of search?


Vince,

No. You consumers need to do deduplication.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110621/483cd158/attachment.htm>

From james.r.carr at gmail.com  Mon Jun 20 22:31:39 2011
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 20 Jun 2011 16:31:39 -0500
Subject: [rabbitmq-discuss] rabbitmq-messagepatterns
Message-ID: <BANLkTimEtE+KSQDgGpj8iy9==n-w42Z+AA@mail.gmail.com>

Hi all,

Is there a maven repository that I can find the rabbitmq-messagepatterns jar in?

Thanks,
James

From pshomov at gmail.com  Mon Jun 20 22:41:07 2011
From: pshomov at gmail.com (Petar Shomov)
Date: Mon, 20 Jun 2011 21:41:07 +0000
Subject: [rabbitmq-discuss] queue subscription + sending to some exchange
Message-ID: <BANLkTinBYxFQKFLEJF8VMT2gpuASwKaDiw@mail.gmail.com>

Hi guys,

I have a situation which I do not completely understand and I was
hoping someone more acquainted with AMQP and RabbitMQ might point me
in the right direction.

I have a console app that needs to subscribe to a message queue where
the process of handling a message is rather lengthy. During this
lengthy process I need to send out messages to some exchange which
represent information about the progress of the operation.
The subscription to the queue has to be asynchronous too, since I am
doing something else on the main thread. So I have running in a thread
this code (C#):

                var job = new Thread(() =>
                                         {
                                             var consumer = new
QueueingBasicConsumer(channel);

channel.BasicConsume(queueName, false, consumer);
                                             while (true)
                                             {
                                                 BasicDeliverEventArgs e = null;
                                                 e =
(BasicDeliverEventArgs) consumer.Queue.Dequeue();

queueHandlers[queueName][e.Exchange](e);

channel.BasicAck(e.DeliveryTag, false);
                                              }
                                         }

 Unfortunately when I try to send messages within the message handler
(I am opening a different channel on the same connection, tried even
opening a different connection with no better luck) I am getting these
kind of exceptions, usually when attempting to send the *second*
message:

-		$exception	{"The AMQP operation was interrupted: AMQP close-reason,
initiated by Library, code=504, text=\"Frame received for invalid
channel 2\", classId=0, methodId=0,
cause=RabbitMQ.Client.Impl.ChannelErrorException: Frame received for
invalid channel 2\r\n   at ...


Thoughts, ideas, anything?

---------------------------------
Regards,

Petar

From chris.madden at gmail.com  Mon Jun 20 23:24:45 2011
From: chris.madden at gmail.com (Chris Madden)
Date: Mon, 20 Jun 2011 18:24:45 -0400
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
Message-ID: <F9B643EB7BBA49D0B85A133AE06B8B38@gmail.com>

I'm working on a system that currently has 2 rabbit nodes in a cluster. Ideally, one would be a disc node and one would be a ram node. The two nodes exist on individual machines on the same LAN segment. The ram node is on a machine that can come and go every now and again. Network connectivity between the nodes is solid.

On each machine, applications wishing to use rabbit talk to the local instance, secure in the knowledge that rabbit will get the data where it needs to go. I've a modest number of exchanges (say, 5ish), and a mix of long-lived and short-lived queues. There is a modest flow of messages (say, maybe 30-40 a minute, amounting to a couple meg at peak).

In a nutshell, the LATEST.LOG file on my ram clustered node grows, by all accounts, forever. I left it running over the weekend and it was well over 500meg. In the past I've let it run until it consumed all the space on the partition and the broker instance cratered. Running it as a ram node instead of a disc node obviates the problem, but is sub-optimal.

I'm using rabbit 2.5.0, though I've seen the problem on 2.4.0 and 2.4.1. The OS is linux based (2.6.32), and our Erlang version is R14A.

The googles (or my google-fu) seem to be silent beyond tweaking mnesia parameters that I don't fully understand. Any insight or assistance would be greatly appreciated! 

Thanks!

-- 
Chris


From matthew at rabbitmq.com  Mon Jun 20 23:30:12 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 20 Jun 2011 23:30:12 +0100
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
In-Reply-To: <F9B643EB7BBA49D0B85A133AE06B8B38@gmail.com>
References: <F9B643EB7BBA49D0B85A133AE06B8B38@gmail.com>
Message-ID: <20110620223011.GB2511@rabbitmq.com>

On Mon, Jun 20, 2011 at 06:24:45PM -0400, Chris Madden wrote:
> In a nutshell, the LATEST.LOG file on my ram clustered node grows, by
> all accounts, forever. I left it running over the weekend and it was
> well over 500meg. In the past I've let it run until it consumed all
> the space on the partition and the broker instance cratered. Running
> it as a ram node instead of a disc node obviates the problem, but is
> sub-optimal.
> 
> I'm using rabbit 2.5.0, though I've seen the problem on 2.4.0 and
> 2.4.1. The OS is linux based (2.6.32), and our Erlang version is R14A.

Very interesting. I've not heard of that one before and it certainly
points to an mnesia issue. R14A is a beta release and I would strongly
point an accusing finger at that first. Please try the latest Erlang
R14B03.

Matthew

From pshomov at gmail.com  Tue Jun 21 01:17:24 2011
From: pshomov at gmail.com (Petar Shomov)
Date: Tue, 21 Jun 2011 00:17:24 +0000
Subject: [rabbitmq-discuss] queue subscription + sending to some exchange
In-Reply-To: <BANLkTinGihLGRMLadn+QsC_s_m9thfSv4w@mail.gmail.com>
References: <BANLkTinBYxFQKFLEJF8VMT2gpuASwKaDiw@mail.gmail.com>
	<BANLkTinGihLGRMLadn+QsC_s_m9thfSv4w@mail.gmail.com>
Message-ID: <BANLkTinY87p-tibCVvKfd-MFA-V+eJJQ7g@mail.gmail.com>

Hi Simone,

Thanx for the suggestion! I have read that section about threading
many times but my understanding is that channels can be shared among
threads as long as they are not used concurrently. I am not doing that
and I even went ahead and created that channel in the thread that is
doing the consumption just to be on the safe side. No dice, same
error.

What worries me in that section is this paragraph:

"Application callback handlers must not invoke blocking AMQP operations (such as
IModel.QueueDeclare, IModel.BasicCancel or IModel.BasicPublish). If
they do, the channel
will deadlock"

Now, does that mean I should not be doing what I intended to be doing
(I use IModel.BasicPublish)? I find that hard to believe.
I am taking care to open a different channel for the publishing of my
messages but I wonder is that enough?
My channel did not deadlock just looks like things got mixed up ;(

---------------------------------
Regards,

Petar



On Mon, Jun 20, 2011 at 9:57 PM, Simone Busoli <simone.busoli at gmail.com> wrote:
> Hi Petar,
>
> I think you are violating one of the assumption that the C# client does on
> channel usage. Channels should not be shared among threads (read the pdf
> user guide for details), and it appears you are using the channel on a
> different thread than that where the channel was created.
>
> On Mon, Jun 20, 2011 at 23:41, Petar Shomov <pshomov at gmail.com> wrote:
>>
>> Hi guys,
>>
>> I have a situation which I do not completely understand and I was
>> hoping someone more acquainted with AMQP and RabbitMQ might point me
>> in the right direction.
>>
>> I have a console app that needs to subscribe to a message queue where
>> the process of handling a message is rather lengthy. During this
>> lengthy process I need to send out messages to some exchange which
>> represent information about the progress of the operation.
>> The subscription to the queue has to be asynchronous too, since I am
>> doing something else on the main thread. So I have running in a thread
>> this code (C#):
>>
>> ? ? ? ? ? ? ? ?var job = new Thread(() =>
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? var consumer = new
>> QueueingBasicConsumer(channel);
>>
>> channel.BasicConsume(queueName, false, consumer);
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? while (true)
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? BasicDeliverEventArgs e =
>> null;
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? e =
>> (BasicDeliverEventArgs) consumer.Queue.Dequeue();
>>
>> queueHandlers[queueName][e.Exchange](e);
>>
>> channel.BasicAck(e.DeliveryTag, false);
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?}
>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? }
>>
>> ?Unfortunately when I try to send messages within the message handler
>> (I am opening a different channel on the same connection, tried even
>> opening a different connection with no better luck) I am getting these
>> kind of exceptions, usually when attempting to send the *second*
>> message:
>>
>> - ? ? ? ? ? ? ? $exception ? ? ?{"The AMQP operation was interrupted: AMQP
>> close-reason,
>> initiated by Library, code=504, text=\"Frame received for invalid
>> channel 2\", classId=0, methodId=0,
>> cause=RabbitMQ.Client.Impl.ChannelErrorException: Frame received for
>> invalid channel 2\r\n ? at ...
>>
>>
>> Thoughts, ideas, anything?
>>
>> ---------------------------------
>> Regards,
>>
>> Petar
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From David.Xie at morningstar.com  Tue Jun 21 07:44:16 2011
From: David.Xie at morningstar.com (David Xie)
Date: Tue, 21 Jun 2011 01:44:16 -0500
Subject: [rabbitmq-discuss] About rabbitmq queue list
Message-ID: <78B6C79154CC464F8ACDD67E8CE55431D3C013@MSEX891.morningstar.com>

Hi all,

 

I am a starter use rabbitmq with c/C++;

 

I have compiled the source code.

 

Now, I can not find the management interfaces about (get queue list,  total message num in queue..etc..).  

 

I need your help.

 

Thanks!

 

________________________________
David Xie

???
One Team

Morningstar Shenzhen Ltd.

 

Morningstar. Illuminating investing worldwide.

+86 755 0000-0000 voice
+86 135-xxxx-4676 mobile
David.Xie at morningstar.com

4F, HuaRong Insurance building, Mintian Road, Futian district, Shenzhen

 

http://cn.morningstar.com <http://cn.morningstar.com> 


This e-mail contains privileged and confidential information and is intended only for the use of the person(s) named above. Any dissemination, distribution, or duplication of this communication without prior written consent from Morningstar is strictly prohibited. If you have received this message in error, please contact the sender immediately and delete the materials from any computer.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110621/0bb181ff/attachment.htm>

From videlalvaro at gmail.com  Tue Jun 21 07:52:35 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 21 Jun 2011 08:52:35 +0200
Subject: [rabbitmq-discuss] About rabbitmq queue list
In-Reply-To: <78B6C79154CC464F8ACDD67E8CE55431D3C013@MSEX891.morningstar.com>
References: <78B6C79154CC464F8ACDD67E8CE55431D3C013@MSEX891.morningstar.com>
Message-ID: <CD67689E-1E00-4ED2-8C60-C952CCFF2832@gmail.com>

Hi David,

Follow the instructions here: http://www.rabbitmq.com/plugins.html#rabbitmq-management

Cheers,

Alvaro

On Jun 21, 2011, at 8:44 AM, David Xie wrote:

> Hi all,
>  
> I am a starter use rabbitmq with c/C++;
>  
> I have compiled the source code.
>  
> Now, I can not find the management interfaces about (get queue list,  total message num in queue..etc..). 
>  
> I need your help.
>  
> Thanks!
>  
> ________________________________
> David Xie
> ???
> One Team
> Morningstar Shenzhen Ltd.
>  
> Morningstar. Illuminating investing worldwide.
> 
> +86 755 0000-0000 voice
> +86 135-xxxx-4676 mobile
> David.Xie at morningstar.com
> 4F, HuaRong Insurance building, Mintian Road, Futian district, Shenzhen
>  
> http://cn.morningstar.com
> 
> This e-mail contains privileged and confidential information and is intended only for the use of the person(s) named above. Any dissemination, distribution, or duplication of this communication without prior written consent from Morningstar is strictly prohibited. If you have received this message in error, please contact the sender immediately and delete the materials from any computer.
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110621/3cd7311a/attachment-0001.htm>

From emile at rabbitmq.com  Tue Jun 21 10:40:25 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 21 Jun 2011 10:40:25 +0100
Subject: [rabbitmq-discuss] queue subscription + sending to some exchange
In-Reply-To: <BANLkTinY87p-tibCVvKfd-MFA-V+eJJQ7g@mail.gmail.com>
References: <BANLkTinBYxFQKFLEJF8VMT2gpuASwKaDiw@mail.gmail.com>	<BANLkTinGihLGRMLadn+QsC_s_m9thfSv4w@mail.gmail.com>
	<BANLkTinY87p-tibCVvKfd-MFA-V+eJJQ7g@mail.gmail.com>
Message-ID: <4E006709.6030804@rabbitmq.com>

Hi Petar,

I assume that queueHandlers in your snippet establishes a new channel
when the error occurs. Is it possible that queueHandlers is using the
wrong channel by mistake? Can you supply a minimal self-contained
example that illustrates the problem? Is there any additional
information in the broker logfile at the time of the error?


-Emile


On 21/06/11 01:17, Petar Shomov wrote:
> Hi Simone,
> 
> Thanx for the suggestion! I have read that section about threading
> many times but my understanding is that channels can be shared among
> threads as long as they are not used concurrently. I am not doing that
> and I even went ahead and created that channel in the thread that is
> doing the consumption just to be on the safe side. No dice, same
> error.
> 
> What worries me in that section is this paragraph:
> 
> "Application callback handlers must not invoke blocking AMQP operations (such as
> IModel.QueueDeclare, IModel.BasicCancel or IModel.BasicPublish). If
> they do, the channel
> will deadlock"
> 
> Now, does that mean I should not be doing what I intended to be doing
> (I use IModel.BasicPublish)? I find that hard to believe.
> I am taking care to open a different channel for the publishing of my
> messages but I wonder is that enough?
> My channel did not deadlock just looks like things got mixed up ;(
> 
> ---------------------------------
> Regards,
> 
> Petar
> 
> 
> 
> On Mon, Jun 20, 2011 at 9:57 PM, Simone Busoli <simone.busoli at gmail.com> wrote:
>> Hi Petar,
>>
>> I think you are violating one of the assumption that the C# client does on
>> channel usage. Channels should not be shared among threads (read the pdf
>> user guide for details), and it appears you are using the channel on a
>> different thread than that where the channel was created.
>>
>> On Mon, Jun 20, 2011 at 23:41, Petar Shomov <pshomov at gmail.com> wrote:
>>>
>>> Hi guys,
>>>
>>> I have a situation which I do not completely understand and I was
>>> hoping someone more acquainted with AMQP and RabbitMQ might point me
>>> in the right direction.
>>>
>>> I have a console app that needs to subscribe to a message queue where
>>> the process of handling a message is rather lengthy. During this
>>> lengthy process I need to send out messages to some exchange which
>>> represent information about the progress of the operation.
>>> The subscription to the queue has to be asynchronous too, since I am
>>> doing something else on the main thread. So I have running in a thread
>>> this code (C#):
>>>
>>>                var job = new Thread(() =>
>>>                                         {
>>>                                             var consumer = new
>>> QueueingBasicConsumer(channel);
>>>
>>> channel.BasicConsume(queueName, false, consumer);
>>>                                             while (true)
>>>                                             {
>>>                                                 BasicDeliverEventArgs e =
>>> null;
>>>                                                 e =
>>> (BasicDeliverEventArgs) consumer.Queue.Dequeue();
>>>
>>> queueHandlers[queueName][e.Exchange](e);
>>>
>>> channel.BasicAck(e.DeliveryTag, false);
>>>                                              }
>>>                                         }
>>>
>>>  Unfortunately when I try to send messages within the message handler
>>> (I am opening a different channel on the same connection, tried even
>>> opening a different connection with no better luck) I am getting these
>>> kind of exceptions, usually when attempting to send the *second*
>>> message:
>>>
>>> -               $exception      {"The AMQP operation was interrupted: AMQP
>>> close-reason,
>>> initiated by Library, code=504, text=\"Frame received for invalid
>>> channel 2\", classId=0, methodId=0,
>>> cause=RabbitMQ.Client.Impl.ChannelErrorException: Frame received for
>>> invalid channel 2\r\n   at ...
>>>
>>>
>>> Thoughts, ideas, anything?

From chris.madden at gmail.com  Tue Jun 21 16:18:36 2011
From: chris.madden at gmail.com (Chris Madden)
Date: Tue, 21 Jun 2011 11:18:36 -0400
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
In-Reply-To: <mailman.555.1308639242.2898.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.555.1308639242.2898.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <ABA42E48EC654326B9E2F059573DA9BE@gmail.com>

> On Mon, Jun 20, 2011 at 06:24:45PM -0400, Chris Madden wrote:
> > In a nutshell, the LATEST.LOG file on my ram clustered node grows, by
> > all accounts, forever. I left it running over the weekend and it was
> > well over 500meg. In the past I've let it run until it consumed all
> > the space on the partition and the broker instance cratered. Running
> > it as a ram node instead of a disc node obviates the problem, but is
> > sub-optimal.
> > 
> > I'm using rabbit 2.5.0, though I've seen the problem on 2.4.0 and
> > 2.4.1. The OS is linux based (2.6.32), and our Erlang version is R14A.
> 
> Very interesting. I've not heard of that one before and it certainly
> points to an mnesia issue. R14A is a beta release and I would strongly
> point an accusing finger at that first. Please try the latest Erlang
> R14B03.
> 
> Matthew
> 
> 
 I upgraded our erlang version to R14B03, but the LATEST.LOG still continues to be growing, albeit, more slowly perhaps? 

I'm kind of suspicious of one of the queue usage models I'm using. When one of the processes needs to make a one-off request (rpc like), it creates a queue dedicated to that request, and expects the reply to come back on that queue. After a timeout or the response is delivered, the queue is taken down. As a result, we have queues come and go a few times a minute... not really ideal, but it helps with debugging. Beyond this, I think the rabbit setup is pretty standard. Any ideas?


Below is the status/cluster_status output, in case it points at something obvious:

drone:0:~ # rabbitmqctl status
Status of node rabbit at drone ...
[{pid,12348},
{running_applications,[{rabbit,"RabbitMQ","2.5.0"},
{os_mon,"CPO CXC 138 46","2.2.6"},
{sasl,"SASL CXC 138 11","2.1.9.4"},
{mnesia,"MNESIA CXC 138 12","4.4.19"},
{stdlib,"ERTS CXC 138 10","1.17.4"},
{kernel,"ERTS CXC 138 10","2.14.4"}]},
{os,{unix,linux}},
{erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
{memory,[{total,30529744},
{processes,10871688},
{processes_used,10849544},
{system,19658056},
{atom,1114745},
{atom_used,1105101},
{binary,4144112},
{code,11021554},
{ets,1404144}]}]
...done.

drone:0:~ # rabbitmqctl cluster_status
Cluster status of node rabbit at drone ...
[{nodes,[{disc,[rabbit at controller]},{ram,[rabbit at drone]}]},
{running_nodes,[rabbit at controller,rabbit at drone]}]
...done.


From brking at gmail.com  Tue Jun 21 16:20:10 2011
From: brking at gmail.com (bradrover)
Date: Tue, 21 Jun 2011 08:20:10 -0700 (PDT)
Subject: [rabbitmq-discuss] erl.exe crash
In-Reply-To: <4CA4740F.8000502@rabbitmq.com>
Message-ID: <17393167.1984.1308669610314.JavaMail.geo-discussion-forums@vbpv16>

I just had this same problem. Similar situation, setting up RabbitMQ for the 
first time for evaluation. Running on an older Win XP desktop. I installed 
everything fresh from the Windows bundle, including erlang. (2.5.0/R14B02). 
I then ran the Perf  I'm not even approaching any resource limits I can see 
in the management plug-in. Handles were at 46/1024, memory at 422M. This is 
concerning to me that any client could actually crash the server, regardless 
of OS installed on. We would run production on Linux, but that doesn't 
explain this issue. I've done this twice now, so its reproducable. Here's 
the dump info:

Appname: erl.exe
ModName: beam.smp.dll
Offset: 00010e3f

Exception Information
Code: 0x40000015 Flags: 0x00000000
Record: 0x0000000000000000 Address: 0x0000000000900e3f

System Information
Windows NT 5.1 Build: 2600
CPU Vendor Code: 756E6547 - 49656E69 - 6C65746E
CPU Version: 000006F2  CPU Feature Code: BFEBFBFF
CPU AMD Feature Code: 00EEE824

Module 1
erl.exe
Image Base: 0x00400000  Image Size: 0x00000000
Checksum: 0x0000c0af Time Stamp: 0x4d7e769d
Version Information
 Signature: 00000000
 StrucVer: 00000000
 FileVer: (0.0:0.0)
 ProdVer: (0.0:0.0)
 FlagMask: 00000000
 Flags: 00000000
 OS: 00000000
 FileType: 00000000
 SubType: 00000000
 FileDate: 00000000:00000000

Module 2
ntdll.dll
Image Base: 0x7c900000  Image Size: 0x00000000
Checksum: 0x000afd30 Time Stamp: 0x4d00f27d
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.6055)
 ProdVer: (5.1:2600.6055)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 3
kernel32.dll
Image Base: 0x7c800000  Image Size: 0x00000000
Checksum: 0x000fe572 Time Stamp: 0x49c4f482
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5781)
 ProdVer: (5.1:2600.5781)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 4
MSVCR80.dll
Image Base: 0x78130000  Image Size: 0x00000000
Checksum: 0x0009cff1 Time Stamp: 0x4a594c79
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (8.0:50727.4053)
 ProdVer: (8.0:50727.4053)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 5
msvcrt.dll
Image Base: 0x77c10000  Image Size: 0x00000000
Checksum: 0x00057341 Time Stamp: 0x4802a188
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (7.0:2600.5512)
 ProdVer: (6.1:8638.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000001
 SubType: 00000000
 FileDate: 00000000:00000000

Module 6
erlexec.dll
Image Base: 0x10000000  Image Size: 0x00000000
Checksum: 0x00011bab Time Stamp: 0x4d7e76a7
Version Information
 Signature: 00000000
 StrucVer: 00000000
 FileVer: (0.0:0.0)
 ProdVer: (0.0:0.0)
 FlagMask: 00000000
 Flags: 00000000
 OS: 00000000
 FileType: 00000000
 SubType: 00000000
 FileDate: 00000000:00000000

Module 7
USER32.dll
Image Base: 0x7e410000  Image Size: 0x00000000
Checksum: 0x0008fc76 Time Stamp: 0x4802a11b
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 8
GDI32.dll
Image Base: 0x77f10000  Image Size: 0x00000000
Checksum: 0x0004ce95 Time Stamp: 0x49006fbe
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5698)
 ProdVer: (5.1:2600.5698)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 9
IMM32.DLL
Image Base: 0x76390000  Image Size: 0x00000000
Checksum: 0x0002921b Time Stamp: 0x4802a0e7
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 10
ADVAPI32.dll
Image Base: 0x77dd0000  Image Size: 0x00000000
Checksum: 0x000a5bb8 Time Stamp: 0x49901d48
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5755)
 ProdVer: (5.1:2600.5755)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 11
RPCRT4.dll
Image Base: 0x77e70000  Image Size: 0x00000000
Checksum: 0x000985cf Time Stamp: 0x4c68fa8c
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.6022)
 ProdVer: (5.1:2600.6022)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 12
Secur32.dll
Image Base: 0x77fe0000  Image Size: 0x00000000
Checksum: 0x0001bbcc Time Stamp: 0x4a433476
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5834)
 ProdVer: (5.1:2600.5834)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 13
beam.smp.dll
Image Base: 0x008f0000  Image Size: 0x00000000
Checksum: 0x001c1da7 Time Stamp: 0x4d7e7588
Version Information
 Signature: 00000000
 StrucVer: 00000000
 FileVer: (0.0:0.0)
 ProdVer: (0.0:0.0)
 FlagMask: 00000000
 Flags: 00000000
 OS: 00000000
 FileType: 00000000
 SubType: 00000000
 FileDate: 00000000:00000000

Module 14
COMCTL32.dll
Image Base: 0x773d0000  Image Size: 0x00000000
Checksum: 0x00107dd2 Time Stamp: 0x4c729dd1
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (6.0:2900.6028)
 ProdVer: (6.0:2900.6028)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 15
SHLWAPI.dll
Image Base: 0x77f60000  Image Size: 0x00000000
Checksum: 0x00080464 Time Stamp: 0x4b1e1b10
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (6.0:2900.5912)
 ProdVer: (6.0:2900.5912)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 16
comdlg32.dll
Image Base: 0x763b0000  Image Size: 0x00000000
Checksum: 0x0004edb8 Time Stamp: 0x4802a0c9
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (6.0:2900.5512)
 ProdVer: (6.0:2900.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 17
SHELL32.dll
Image Base: 0x7c9c0000  Image Size: 0x00000000
Checksum: 0x0081d3cf Time Stamp: 0x4d399bd5
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (6.0:2900.6072)
 ProdVer: (6.0:2900.6072)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 18
WS2_32.dll
Image Base: 0x71ab0000  Image Size: 0x00000000
Checksum: 0x0001f020 Time Stamp: 0x4802a163
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 19
WS2HELP.dll
Image Base: 0x71aa0000  Image Size: 0x00000000
Checksum: 0x0000925f Time Stamp: 0x4802a164
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 20
iphlpapi.dll
Image Base: 0x76d60000  Image Size: 0x00000000
Checksum: 0x0001ec36 Time Stamp: 0x4802a0d0
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 21
mswsock.dll
Image Base: 0x71a50000  Image Size: 0x00000000
Checksum: 0x0003ddcd Time Stamp: 0x485bd4a7
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5625)
 ProdVer: (5.1:2600.5625)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 22
hnetcfg.dll
Image Base: 0x662b0000  Image Size: 0x00000000
Checksum: 0x00059144 Time Stamp: 0x4802a0ca
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 23
wshtcpip.dll
Image Base: 0x71a90000  Image Size: 0x00000000
Checksum: 0x000098b0 Time Stamp: 0x4802a16e
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 24
DNSAPI.dll
Image Base: 0x76f20000  Image Size: 0x00000000
Checksum: 0x0002a794 Time Stamp: 0x4d6f3b57
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.6089)
 ProdVer: (5.1:2600.6089)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 25
winrnr.dll
Image Base: 0x76fb0000  Image Size: 0x00000000
Checksum: 0x0000ec94 Time Stamp: 0x4802a122
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 26
WLDAP32.dll
Image Base: 0x76f60000  Image Size: 0x00000000
Checksum: 0x0002f986 Time Stamp: 0x4802a12e
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 27
Apphelp.dll
Image Base: 0x77b40000  Image Size: 0x00000000
Checksum: 0x00029aea Time Stamp: 0x4802a0bf
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 28
VERSION.dll
Image Base: 0x77c00000  Image Size: 0x00000000
Checksum: 0x00012c70 Time Stamp: 0x4802a11d
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 29
faultrep.dll
Image Base: 0x69450000  Image Size: 0x00000000
Checksum: 0x0001dc1f Time Stamp: 0x4802a0bb
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000001
 SubType: 00000000
 FileDate: 00000000:00000000

Module 30
USERENV.dll
Image Base: 0x769c0000  Image Size: 0x00000000
Checksum: 0x000b36ed Time Stamp: 0x4802a11c
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000001
 SubType: 00000000
 FileDate: 00000000:00000000

Module 31
WINSTA.dll
Image Base: 0x76360000  Image Size: 0x00000000
Checksum: 0x00016b34 Time Stamp: 0x4802a129
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000001
 SubType: 00000000
 FileDate: 00000000:00000000

Module 32
NETAPI32.dll
Image Base: 0x5b860000  Image Size: 0x00000000
Checksum: 0x000535e8 Time Stamp: 0x48f61b90
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5694)
 ProdVer: (5.1:2600.5694)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 33
WTSAPI32.dll
Image Base: 0x76f50000  Image Size: 0x00000000
Checksum: 0x0000965a Time Stamp: 0x4802a174
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Module 34
SETUPAPI.dll
Image Base: 0x77920000  Image Size: 0x00000000
Checksum: 0x000f1928 Time Stamp: 0x4802a10b
Version Information
 Signature: feef04bd
 StrucVer: 00010000
 FileVer: (5.1:2600.5512)
 ProdVer: (5.1:2600.5512)
 FlagMask: 0000003f
 Flags: 00000000
 OS: 00040004
 FileType: 00000002
 SubType: 00000000
 FileDate: 00000000:00000000

Thread 1
Thread ID: 0x0000096c
Context:
EDI: 0x00000000  ESI: 0x0000064c  EAX: 0x00e312e0
EBX: 0x003658b8  ECX: 0x00000004  EDX: 0x0003ed80
EIP: 0x7c90e514  EBP: 0x0012fd88  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0012fd24  SegSs: 0x00000023
Stack:
0x0012fd20: 00000000 7c90df5a 7c8025db 0000064c ....Z..|.%.|L...
0x0012fd30: 00000000 00000000 7c802530 0000064c ........0%.|L...
0x0012fd40: 003658b8 00000014 00000001 00000000 .X6.............
0x0012fd50: 00000000 00000010 00a8348c c0000000 .........4......
0x0012fd60: 7ffde000 7ffdd000 00000000 0000064c ............L...
0x0012fd70: 0012fd38 7c8308d7 0012ffb0 7c839ad8 8......|.......|
0x0012fd80: 7c802608 00000000 0012fd9c 7c802542 ...|........B%.|
0x0012fd90: 0000064c ffffffff 00000000 00000007 L...............
0x0012fda0: 009c4e2d 0000064c ffffffff 003631b5 -N..L........16.
0x0012fdb0: 00a139f6 009027ba 003658b8 00000031 .9...'...X6.1...
0x0012fdc0: 00000000 008f0000 00000006 00000015 ................
0x0012fdd0: 003631bb 0000001e 00000002 7c91005d .16.........]..|
0x0012fde0: 0012fef0 00000000 7c910466 00000000 ........f..|....
0x0012fdf0: 7c910466 0012fe4e 0001033c 0012fee8 f..|N...<.......
0x0012fe00: 0001033c 0012feb8 7c92767f 0001033a <........v.|:...
0x0012fe10: 0001033c 7c910460 7c980620 7c9276cb <...`..| ..|.v.|
0x0012fe20: 7c9276b8 7c90eb3b 7c901225 7c910466 .v.|;..|%..|f..|
0x0012fe30: 00011e28 0012fed4 00000028 00000030 (.......(...0...
0x0012fe40: 7c910460 7c980620 00150000 00120010 `..| ..|........
0x0012fe50: 0001032a 00220020 00010308 00154128 *... .".....(A..
0x0012fe60: 001539c8 00150000 00000018 00000000 .9..............
0x0012fe70: 00000000 0012fc6c 0012fc70 0001ffb0 ....l...p.......
0x0012fe80: 00000006 0012fde0 0001033c 0012ffb0 ........<.......
0x0012fe90: 7c90e920 7c910060 ffffffff 7c91005d  ..|`..|....]..|
0x0012fea0: 7c9104ac 00150000 00000000 001539c8 ...|.........9..
0x0012feb0: 0012fec0 7c910482 7c90d80a 7c9132f0 .......|...|.2.|
0x0012fec0: ffffffff 00000024 0012fed4 00000004 ....$...........
0x0012fed0: 00000000 2e73136f 00000000 78132bc6 ....o.s......+.x
0x0012fee0: 009c3780 00000000 78138a58 2eef24ef .7......X..x.$..
0x0012fef0: 00000000 0cdd402b 10004b40 00000031 ....+ at ..@K..1...
0x0012ff00: 003658b8 008f0000 00365878 000000c4 .X6.....xX6.....
0x0012ff10: 00000000 003658b8 100043bf 00365878 .....X6..C..xX6.
0x0012ff20: 00365988 003658b8 00000000 00364c88 .Y6..X6......L6.
0x0012ff30: 10000000 00363710 78134d09 00000001 .....76..M.x....
0x0012ff40: 00000000 00000000 10000000 00000000 ................
0x0012ff50: 00000000 00000000 00000000 00401704 .............. at .
0x0012ff60: 00000031 003630c0 10000000 00000000 1....06.........
0x0012ff70: 00404540 00000001 0012ffc0 00000000 @E at .............
0x0012ff80: 00402731 00000031 003630c0 003639d8 1'@.1....06..96.
0x0012ff90: 094eb5a6 00000040 00000000 7ffde000 ..N. at ...........
0x0012ffa0: 00000000 00000000 0012ff90 222e03bc ..............."
0x0012ffb0: 0012ffe0 00402cf1 091c784e 00000000 ....., at .Nx......
0x0012ffc0: 0012fff0 7c817077 00000040 00000000 ....wp.|@.......
0x0012ffd0: 7ffde000 8054b6ed 0012ffc8 8764c120 ......T..... .d.
0x0012ffe0: ffffffff 7c839ad8 7c817080 00000000 .......|.p.|....
0x0012fff0: 00000000 00000000 004028d2 00000000 .........(@.....

Thread 2
Thread ID: 0x00001604
Context:
EDI: 0x7ffde000  ESI: 0x00000000  EAX: 0x781329e1
EBX: 0x0112fe98  ECX: 0x0012fbdc  EDX: 0x7c9101db
EIP: 0x7c90e514  EBP: 0x0112ff0c  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0112fe70  SegSs: 0x00000023
Stack:
0x0112fe6c: 781c19f8 7c90df4a 7c809590 00000001 ...xJ..|...|....
0x0112fe7c: 0112fe98 00000001 00000000 00000000 ................
0x0112fe8c: 7c80a0b7 7c80a0db 00000001 0000000c ...|...|........
0x0112fe9c: c0604420 806e7d43 aa4acc28 806e7427  D`.C}n.(.J.'tn.
0x0112feac: badb0d00 00000000 7c90d09a 00000014 ...........|....
0x0112febc: 00000001 00000000 00000000 00000010 ................
0x0112fecc: 00000000 ffffffff 00000000 7ffde000 ................
0x0112fedc: 7ffdc000 00000000 00000000 0112fe98 ................
0x0112feec: 0000001f 00000001 0112fe8c 00000000 ................
0x0112fefc: 0112ff9c 7c839ad8 7c809680 00000000 .......|...|....
0x0112ff0c: 0112ff28 7c80a115 00000001 0112ff50 (......|....P...
0x0112ff1c: 00000000 ffffffff 00000000 7c80a0fd ...............|
0x0112ff2c: 009c89fc 00000001 0112ff50 00000000 ........P.......
0x0112ff3c: ffffffff 00000000 0012fcf4 00000000 ................
0x0112ff4c: 009c89b0 0000000c 00bb12d8 009f94e6 ................
0x0112ff5c: 00000000 ffffffff 7c910222 0112ffac ........"..|....
0x0112ff6c: 00365658 00000001 00bb2c18 781329bb XV6......,...).x
0x0112ff7c: 00bb12d0 0baca414 ffffffff 7c910222 ............"..|
0x0112ff8c: 00365658 0112ff80 0112ff80 0112ffdc XV6.............
0x0112ff9c: 0112ffdc 78138ced 72a51000 00000000 .......x...r....
0x0112ffac: 0112ffec 78132a47 7c910222 7c80b729 ....G*.x"..|)..|
0x0112ffbc: 00365658 ffffffff 7c910222 00365658 XV6....."..|XV6.
0x0112ffcc: 7ffdc000 8a6eb600 0112ffc0 86839038 ......n.....8...
0x0112ffdc: ffffffff 7c839ad8 7c80b730 00000000 .......|0..|....
0x0112ffec: 00000000 00000000 781329e1 00365658 .........).xXV6.
0x0112fffc: 00000000                            ....

Thread 3
Thread ID: 0x000012dc
Context:
EDI: 0x0122fee8  ESI: 0x00000000  EAX: 0x781329e1
EBX: 0x00925330  ECX: 0x00000000  EDX: 0x00150000
EIP: 0x7c90e514  EBP: 0x0122ff10  SegCs: 0x0000001b
EFlags: 0x00000206  ESP: 0x0122feb8  SegSs: 0x00000023
Stack:
0x0122feb4: 00000000 7c90d21a 7c8023f1 00000000 .......|.#.|....
0x0122fec4: 0122fee8 00000000 0000ea60 00925330 ..".....`...0S..
0x0122fed4: 00000014 00000001 00000000 00000000 ................
0x0122fee4: 00000010 dc3cba00 ffffffff 00000000 ......<.........
0x0122fef4: 0122fee8 0122fec8 00000000 0122ff9c .."...".......".
0x0122ff04: 7c839ad8 7c802460 00000000 0122ff20 ...|`$.|.... .".
0x0122ff14: 7c802455 0000ea60 00000000 0122ff54 U$.|`.......T.".
0x0122ff24: 009fcd9f 0000ea60 00925404 0000ea60 ....`....T..`...
0x0122ff34: 0122ff40 0012fd78 00bb1350 4e00a582 @.".x...P......N
0x0122ff44: 00058228 00000000 0012fd74 009f94dc (.......t.......
0x0122ff54: 00000000 009f94e6 00000000 7c910222 ............"..|
0x0122ff64: 00000005 0122ffac 00365658 00000002 ......".XV6.....
0x0122ff74: 00bb2c38 781329bb 00bb12d0 0b9ca414 8,...).x........
0x0122ff84: 7c910222 00000005 00365658 0122ff80 "..|....XV6...".
0x0122ff94: 0122ff80 0122ffdc 0122ffdc 78138ced .."..."..."....x
0x0122ffa4: 72a51000 00000000 0122ffec 78132a47 ...r......".G*.x
0x0122ffb4: 00000005 7c80b729 00365658 7c910222 ....)..|XV6."..|
0x0122ffc4: 00000005 00365658 7ffdb000 8a6ed600 ....XV6.......n.
0x0122ffd4: 0122ffc0 86839038 ffffffff 7c839ad8 ..".8..........|
0x0122ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0122fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 4
Thread ID: 0x0000099c
Context:
EDI: 0x00000000  ESI: 0x0000075c  EAX: 0x781329e1
EBX: 0x00000000  ECX: 0x00000000  EDX: 0x00000000
EIP: 0x7c90e514  EBP: 0x0183fed4  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0183fe70  SegSs: 0x00000023
Stack:
0x0183fe6c: 00000000 7c90df5a 7c8025db 0000075c ....Z..|.%.|\...
0x0183fe7c: 00000000 00000000 00bb1398 00000032 ............2...
0x0183fe8c: 00000000 00000014 00000001 00000000 ................
0x0183fe9c: 00000000 00000010 adc73c28 806e7427 ........(<..'tn.
0x0183feac: 7ffde000 7ffda000 00000000 7c80a78a ...............|
0x0183febc: 0183fe84 00000000 0183ff9c 7c839ad8 ...............|
0x0183fecc: 7c802608 00000000 0183fee8 7c802542 ...|........B%.|
0x0183fedc: 0000075c ffffffff 00000000 7c802446 \...........F$.|
0x0183feec: 009fa576 0000075c ffffffff 00a5c048 v...\.......H...
0x0183fefc: 00bb13a4 00000000 00bb1390 009f8f79 ............y...
0x0183ff0c: 00bb1398 00000000 00000000 00000000 ................
0x0183ff1c: 00000000 0091ae60 00000000 0091af5f ....`......._...
0x0183ff2c: 00000000 00a5be3c 00000000 0012fd58 ....<.......X...
0x0183ff3c: 00000000 0091ae60 00bb1390 00000000 ....`...........
0x0183ff4c: 0012fd54 009f94dc 00bb12d8 009f94e6 T...............
0x0183ff5c: 00000000 00000000 00000000 0183ffac ................
0x0183ff6c: 00365658 00000003 00000000 781329bb XV6..........).x
0x0183ff7c: 00bb12d0 0b3da414 00000000 00000000 ......=.........
0x0183ff8c: 00365658 0183ff80 0183ff80 0183ffdc XV6.............
0x0183ff9c: 0183ffdc 78138ced 72a51000 00000000 .......x...r....
0x0183ffac: 0183ffec 78132a47 00000000 7c80b729 ....G*.x....)..|
0x0183ffbc: 00365658 00000000 00000000 00365658 XV6.........XV6.
0x0183ffcc: 7ffda000 8a6eb600 0183ffc0 86839038 ......n.....8...
0x0183ffdc: ffffffff 7c839ad8 7c80b730 00000000 .......|0..|....
0x0183ffec: 00000000 00000000 781329e1 00365658 .........).xXV6.
0x0183fffc: 00000000                            ....

Thread 5
Thread ID: 0x00001780
Context:
EDI: 0x00000000  ESI: 0x00000754  EAX: 0x00bb13d8
EBX: 0x00000000  ECX: 0x00bb13d8  EDX: 0x7c90e514
EIP: 0x7c90e514  EBP: 0x0193fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0193fe78  SegSs: 0x00000023
Stack:
0x0193fe74: 00000000 7c90df5a 7c8025db 00000754 ....Z..|.%.|T...
0x0193fe84: 00000000 00000000 00bb13d8 00000032 ............2...
0x0193fe94: 00000000 00000014 00000001 00000000 ................
0x0193fea4: 00000000 00000010 00000754 ffffffff ........T.......
0x0193feb4: 7ffde000 7ffd9000 00000000 009f7f31 ............1...
0x0193fec4: 0193fe8c 00bb13d8 0193ff9c 7c839ad8 ...............|
0x0193fed4: 7c802608 00000000 0193fef0 7c802542 ...|........B%.|
0x0193fee4: 00000754 ffffffff 00000000 7c802446 T...........F$.|
0x0193fef4: 009fa576 00000754 ffffffff 016ce004 v...T.........l.
0x0193ff04: 00bb13e4 00000000 00bb13d0 009f8f79 ............y...
0x0193ff14: 00bb13d8 00000000 00000000 016cdfe0 ..............l.
0x0193ff24: 00bb7578 016ce004 04209b28 0097b43e xu....l.(. .>...
0x0193ff34: 00000000 016cdfe0 00b800d8 016ad7a8 ......l.......j.
0x0193ff44: 0097b6c3 016cdfe0 0097b5f0 00000000 ......l.........
0x0193ff54: 0012fd18 009f94e6 016cdfe0 7c911086 ..........l....|
0x0193ff64: 7c9101db 0193ffac 00365658 00000004 ...|....XV6.....
0x0193ff74: 00bb2f38 781329bb 00bb12d0 0b2da414 8/...).x......-.
0x0193ff84: 7c911086 7c9101db 00365658 0193ff80 ...|...|XV6.....
0x0193ff94: 0193ff80 0193ffdc 0193ffdc 78138ced ...............x
0x0193ffa4: 72a51000 00000000 0193ffec 78132a47 ...r........G*.x
0x0193ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0193ffc4: 7c9101db 00365658 7ffd9000 8a6ed600 ...|XV6.......n.
0x0193ffd4: 0193ffc0 86aa1d88 ffffffff 7c839ad8 ...............|
0x0193ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0193fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 6
Thread ID: 0x000013f0
Context:
EDI: 0x00000000  ESI: 0x0000074c  EAX: 0x0000010f
EBX: 0x00000000  ECX: 0x00bb1418  EDX: 0x7ffe0300
EIP: 0x7c90e514  EBP: 0x01a3fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x01a3fe78  SegSs: 0x00000023
Stack:
0x01a3fe74: 00000000 7c90df5a 7c8025db 0000074c ....Z..|.%.|L...
0x01a3fe84: 00000000 00000000 00bb1418 00000032 ............2...
0x01a3fe94: 00000000 00000014 00000001 00000000 ................
0x01a3fea4: 00000000 00000010 00000000 01a3ff9c ................
0x01a3feb4: 7ffde000 7ffd8000 00000000 00000000 ................
0x01a3fec4: 01a3fe8c 00ea4468 01a3ff9c 7c839ad8 ....hD.........|
0x01a3fed4: 7c802608 00000000 01a3fef0 7c802542 ...|........B%.|
0x01a3fee4: 0000074c ffffffff 00000000 7c802446 L...........F$.|
0x01a3fef4: 009fa576 0000074c ffffffff 016ce05c v...L.......\.l.
0x01a3ff04: 00bb1424 00000000 00bb1410 009f8f79 $...........y...
0x01a3ff14: 00bb1418 00000000 00000000 016ce038 ............8.l.
0x01a3ff24: 00ba2798 016ce05c 00000000 0097b43e .'..\.l.....>...
0x01a3ff34: 00000000 016ce038 082ead38 016b96e0 ....8.l.8.....k.
0x01a3ff44: 0097b6c3 016ce038 0097b5f0 00000000 ....8.l.........
0x01a3ff54: 0012fd18 009f94e6 016ce038 7c911086 ........8.l....|
0x01a3ff64: 7c9101db 01a3ffac 00365658 00000005 ...|....XV6.....
0x01a3ff74: 00bb2f58 781329bb 00bb12d0 0b1da414 X/...).x........
0x01a3ff84: 7c911086 7c9101db 00365658 01a3ff80 ...|...|XV6.....
0x01a3ff94: 01a3ff80 01a3ffdc 01a3ffdc 78138ced ...............x
0x01a3ffa4: 72a51000 00000000 01a3ffec 78132a47 ...r........G*.x
0x01a3ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x01a3ffc4: 7c9101db 00365658 7ffd8000 8a6eb600 ...|XV6.......n.
0x01a3ffd4: 01a3ffc0 86839038 ffffffff 7c839ad8 ....8..........|
0x01a3ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x01a3fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 7
Thread ID: 0x00001348
Context:
EDI: 0x00000000  ESI: 0x00000744  EAX: 0x043eec20
EBX: 0x00000000  ECX: 0x00000004  EDX: 0x000f1400
EIP: 0x7c90e514  EBP: 0x01b3fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x01b3fe78  SegSs: 0x00000023
Stack:
0x01b3fe74: 00000000 7c90df5a 7c8025db 00000744 ....Z..|.%.|D...
0x01b3fe84: 00000000 00000000 00bb1458 00000032 ........X...2...
0x01b3fe94: 00000000 00000014 00000001 00000000 ................
0x01b3fea4: 00000000 00000010 00000744 01b3ff9c ........D.......
0x01b3feb4: 7ffde000 7ffd7000 00000000 00000000 .....p..........
0x01b3fec4: 01b3fe8c 00ea4468 01b3ff9c 7c839ad8 ....hD.........|
0x01b3fed4: 7c802608 00000000 01b3fef0 7c802542 ...|........B%.|
0x01b3fee4: 00000744 ffffffff 00000000 7c802446 D...........F$.|
0x01b3fef4: 009fa576 00000744 ffffffff 016ce0b4 v...D.........l.
0x01b3ff04: 00bb1464 00000000 00bb1450 009f8f79 d.......P...y...
0x01b3ff14: 00bb1458 00000000 00000000 016ce090 X.............l.
0x01b3ff24: 00ba2798 016ce0b4 00000000 0097b43e .'....l.....>...
0x01b3ff34: 00000000 016ce090 07dbcf98 016b97c8 ......l.......k.
0x01b3ff44: 0097b6c3 016ce090 0097b5f0 00000000 ......l.........
0x01b3ff54: 0012fd18 009f94e6 016ce090 7c911086 ..........l....|
0x01b3ff64: 7c9101db 01b3ffac 00365658 00000006 ...|....XV6.....
0x01b3ff74: 00bb2f78 781329bb 00bb12d0 0b0da414 x/...).x........
0x01b3ff84: 7c911086 7c9101db 00365658 01b3ff80 ...|...|XV6.....
0x01b3ff94: 01b3ff80 01b3ffdc 01b3ffdc 78138ced ...............x
0x01b3ffa4: 72a51000 00000000 01b3ffec 78132a47 ...r........G*.x
0x01b3ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x01b3ffc4: 7c9101db 00365658 7ffd7000 8a6ed600 ...|XV6..p....n.
0x01b3ffd4: 01b3ffc0 86aa1d88 ffffffff 7c839ad8 ...............|
0x01b3ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x01b3fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 8
Thread ID: 0x000008b8
Context:
EDI: 0x00000000  ESI: 0x0000073c  EAX: 0x25371ff9
EBX: 0x00000000  ECX: 0x25372000  EDX: 0x00000004
EIP: 0x7c90e514  EBP: 0x01c3fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x01c3fe78  SegSs: 0x00000023
Stack:
0x01c3fe74: 00000000 7c90df5a 7c8025db 0000073c ....Z..|.%.|<...
0x01c3fe84: 00000000 00000000 00bb1498 00000032 ............2...
0x01c3fe94: 00000000 00000014 00000001 00000000 ................
0x01c3fea4: 00000000 00000010 0000073c ffffffff ........<.......
0x01c3feb4: 7ffde000 7ffd6000 00000000 009f7f31 .....`......1...
0x01c3fec4: 01c3fe8c 00bb1498 01c3ff9c 7c839ad8 ...............|
0x01c3fed4: 7c802608 00000000 01c3fef0 7c802542 ...|........B%.|
0x01c3fee4: 0000073c ffffffff 00000000 7c802446 <...........F$.|
0x01c3fef4: 009fa576 0000073c ffffffff 016ce10c v...<.........l.
0x01c3ff04: 00bb14a4 00000000 00bb1490 009f8f79 ............y...
0x01c3ff14: 00bb1498 00000000 00000000 016ce0e8 ..............l.
0x01c3ff24: 00ba2798 016ce10c 046c32b0 0097b43e .'....l..2l.>...
0x01c3ff34: 00000000 016ce0e8 07dc7900 016b98b0 ......l..y....k.
0x01c3ff44: 0097b6c3 016ce0e8 0097b5f0 00000000 ......l.........
0x01c3ff54: 0012fd18 009f94e6 016ce0e8 7c911086 ..........l....|
0x01c3ff64: 7c9101db 01c3ffac 00365658 00000007 ...|....XV6.....
0x01c3ff74: 00bb2f98 781329bb 00bb12d0 0b7da414 ./...).x......}.
0x01c3ff84: 7c911086 7c9101db 00365658 01c3ff80 ...|...|XV6.....
0x01c3ff94: 01c3ff80 01c3ffdc 01c3ffdc 78138ced ...............x
0x01c3ffa4: 72a51000 00000000 01c3ffec 78132a47 ...r........G*.x
0x01c3ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x01c3ffc4: 7c9101db 00365658 7ffd6000 8a6eb600 ...|XV6..`....n.
0x01c3ffd4: 01c3ffc0 86839038 ffffffff 7c839ad8 ....8..........|
0x01c3ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x01c3fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 9
Thread ID: 0x00001388
Context:
EDI: 0x00000000  ESI: 0x00000734  EAX: 0x00ea36bf
EBX: 0x00000000  ECX: 0x01d3fcac  EDX: 0x00000000
EIP: 0x7c90e514  EBP: 0x01d3fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x01d3fe78  SegSs: 0x00000023
Stack:
0x01d3fe74: 00000000 7c90df5a 7c8025db 00000734 ....Z..|.%.|4...
0x01d3fe84: 00000000 00000000 00bb14d8 00000032 ............2...
0x01d3fe94: 00000000 00000014 00000001 00000000 ................
0x01d3fea4: 00000000 00000010 000004c4 00000020 ............ ...
0x01d3feb4: 7ffde000 7ffd5000 00000000 00000000 .....P..........
0x01d3fec4: 01d3fe8c 00ea3798 01d3ff9c 7c839ad8 .....7.........|
0x01d3fed4: 7c802608 00000000 01d3fef0 7c802542 ...|........B%.|
0x01d3fee4: 00000734 ffffffff 00000000 7c802446 4...........F$.|
0x01d3fef4: 009fa576 00000734 ffffffff 016ce164 v...4.......d.l.
0x01d3ff04: 00bb14e4 00000000 00bb14d0 009f8f79 ............y...
0x01d3ff14: 00bb14d8 00000000 00000000 016ce140 ............ at .l.
0x01d3ff24: 00bb8cf8 016ce164 00000000 0097b43e ....d.l.....>...
0x01d3ff34: 00000000 016ce140 07dc7900 016b9998 .... at .l..y....k.
0x01d3ff44: 0097b6c3 016ce140 0097b5f0 00000000 .... at .l.........
0x01d3ff54: 0012fd18 009f94e6 016ce140 7c911086 ........ at .l....|
0x01d3ff64: 7c9101db 01d3ffac 00365658 00000008 ...|....XV6.....
0x01d3ff74: 00bb2fb8 781329bb 00bb12d0 0b6da414 ./...).x......m.
0x01d3ff84: 7c911086 7c9101db 00365658 01d3ff80 ...|...|XV6.....
0x01d3ff94: 01d3ff80 01d3ffdc 01d3ffdc 78138ced ...............x
0x01d3ffa4: 72a51000 00000000 01d3ffec 78132a47 ...r........G*.x
0x01d3ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x01d3ffc4: 7c9101db 00365658 7ffd5000 8a6ed600 ...|XV6..P....n.
0x01d3ffd4: 01d3ffc0 86839038 ffffffff 7c839ad8 ....8..........|
0x01d3ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x01d3fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 10
Thread ID: 0x00000a1c
Context:
EDI: 0x00000000  ESI: 0x0000072c  EAX: 0x00eb3ee0
EBX: 0x00000000  ECX: 0x000000a1  EDX: 0x000001b8
EIP: 0x7c90e514  EBP: 0x01e3fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x01e3fe78  SegSs: 0x00000023
Stack:
0x01e3fe74: 00000000 7c90df5a 7c8025db 0000072c ....Z..|.%.|,...
0x01e3fe84: 00000000 00000000 00bb1518 00000032 ............2...
0x01e3fe94: 00000000 00000014 00000001 00000000 ................
0x01e3fea4: 00000000 00000010 000004c4 00000020 ............ ...
0x01e3feb4: 7ffde000 7ffd4000 00000000 00000000 ..... at ..........
0x01e3fec4: 01e3fe8c 00eb4468 01e3ff9c 7c839ad8 ....hD.........|
0x01e3fed4: 7c802608 00000000 01e3fef0 7c802542 ...|........B%.|
0x01e3fee4: 0000072c ffffffff 00000000 7c802446 ,...........F$.|
0x01e3fef4: 009fa576 0000072c ffffffff 016ce1bc v...,.........l.
0x01e3ff04: 00bb1524 00000000 00bb1510 009f8f79 $...........y...
0x01e3ff14: 00bb1518 00000000 00000000 016ce198 ..............l.
0x01e3ff24: 00ba2798 016ce1bc 00000000 0097b43e .'....l.....>...
0x01e3ff34: 00000000 016ce198 082fed30 016b9a80 ......l.0./...k.
0x01e3ff44: 0097b6c3 016ce198 0097b5f0 00000000 ......l.........
0x01e3ff54: 0012fd18 009f94e6 016ce198 7c911086 ..........l....|
0x01e3ff64: 7c9101db 01e3ffac 00365658 00000009 ...|....XV6.....
0x01e3ff74: 00bb2fd8 781329bb 00bb12d0 0b5da414 ./...).x......].
0x01e3ff84: 7c911086 7c9101db 00365658 01e3ff80 ...|...|XV6.....
0x01e3ff94: 01e3ff80 01e3ffdc 01e3ffdc 78138ced ...............x
0x01e3ffa4: 72a51000 00000000 01e3ffec 78132a47 ...r........G*.x
0x01e3ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x01e3ffc4: 7c9101db 00365658 7ffd4000 8a6eb600 ...|XV6.. at ....n.
0x01e3ffd4: 01e3ffc0 86d05f90 ffffffff 7c839ad8 ....._.........|
0x01e3ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x01e3fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 11
Thread ID: 0x00000ec8
Context:
EDI: 0x00000000  ESI: 0x00000724  EAX: 0x00000000
EBX: 0x00000000  ECX: 0x00bb1558  EDX: 0x00000000
EIP: 0x7c90e514  EBP: 0x01f3fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x01f3fe78  SegSs: 0x00000023
Stack:
0x01f3fe74: 00000000 7c90df5a 7c8025db 00000724 ....Z..|.%.|$...
0x01f3fe84: 00000000 00000000 00bb1558 00000032 ........X...2...
0x01f3fe94: 00000000 00000014 00000001 00000000 ................
0x01f3fea4: 00000000 00000010 00000000 00000020 ............ ...
0x01f3feb4: 7ffde000 7ffaf000 00000000 00000000 ................
0x01f3fec4: 01f3fe8c 00eb40e8 01f3ff9c 7c839ad8 ..... at .........|
0x01f3fed4: 7c802608 00000000 01f3fef0 7c802542 ...|........B%.|
0x01f3fee4: 00000724 ffffffff 00000000 7c802446 $...........F$.|
0x01f3fef4: 009fa576 00000724 ffffffff 016ce214 v...$.........l.
0x01f3ff04: 00bb1564 00000000 00bb1550 009f8f79 d.......P...y...
0x01f3ff14: 00bb1558 00000000 00000000 016ce1f0 X.............l.
0x01f3ff24: 00bb8248 016ce214 00000000 0097b43e H.....l.....>...
0x01f3ff34: 00000000 016ce1f0 00b900f8 016b49d8 ......l......Ik.
0x01f3ff44: 0097b6c3 016ce1f0 0097b5f0 00000000 ......l.........
0x01f3ff54: 0012fd18 009f94e6 016ce1f0 7c911086 ..........l....|
0x01f3ff64: 7c9101db 01f3ffac 00365658 0000000a ...|....XV6.....
0x01f3ff74: 00bb2ff8 781329bb 00bb12d0 0b4da414 ./...).x......M.
0x01f3ff84: 7c911086 7c9101db 00365658 01f3ff80 ...|...|XV6.....
0x01f3ff94: 01f3ff80 01f3ffdc 01f3ffdc 78138ced ...............x
0x01f3ffa4: 72a51000 00000000 01f3ffec 78132a47 ...r........G*.x
0x01f3ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x01f3ffc4: 7c9101db 00365658 7ffaf000 8a6ed600 ...|XV6.......n.
0x01f3ffd4: 01f3ffc0 86d05f90 ffffffff 7c839ad8 ....._.........|
0x01f3ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x01f3fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 12
Thread ID: 0x000015a8
Context:
EDI: 0x00000000  ESI: 0x0000071c  EAX: 0x00000003
EBX: 0x00000000  ECX: 0x00000000  EDX: 0x00001049
EIP: 0x7c90e514  EBP: 0x0203fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0203fe78  SegSs: 0x00000023
Stack:
0x0203fe74: 00000000 7c90df5a 7c8025db 0000071c ....Z..|.%.|....
0x0203fe84: 00000000 00000000 00bb1598 00000032 ............2...
0x0203fe94: 00000000 00000014 00000001 00000000 ................
0x0203fea4: 00000000 00000010 000004f8 0203fedc ................
0x0203feb4: 7ffde000 7ffae000 00000000 00000000 ................
0x0203fec4: 0203fe8c 00000000 0203ff9c 7c839ad8 ...............|
0x0203fed4: 7c802608 00000000 0203fef0 7c802542 ...|........B%.|
0x0203fee4: 0000071c ffffffff 00000000 7c802446 ............F$.|
0x0203fef4: 009fa576 0000071c ffffffff 016ce26c v...........l.l.
0x0203ff04: 00bb15a4 00000000 00bb1590 009f8f79 ............y...
0x0203ff14: 00bb1598 00000000 00000000 016ce248 ............H.l.
0x0203ff24: 00bb7d60 016ce26c 00000000 0097b43e `}..l.l.....>...
0x0203ff34: 00000000 016ce248 082fed00 016b8120 ....H.l.../. .k.
0x0203ff44: 0097b6c3 016ce248 0097b5f0 00000000 ....H.l.........
0x0203ff54: 0012fd18 009f94e6 016ce248 7c911086 ........H.l....|
0x0203ff64: 7c9101db 0203ffac 00365658 0000000b ...|....XV6.....
0x0203ff74: 00bb3018 781329bb 00bb12d0 08bda414 .0...).x........
0x0203ff84: 7c911086 7c9101db 00365658 0203ff80 ...|...|XV6.....
0x0203ff94: 0203ff80 0203ffdc 0203ffdc 78138ced ...............x
0x0203ffa4: 72a51000 00000000 0203ffec 78132a47 ...r........G*.x
0x0203ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0203ffc4: 7c9101db 00365658 7ffae000 8a6eb600 ...|XV6.......n.
0x0203ffd4: 0203ffc0 8843ccb8 ffffffff 7c839ad8 ......C........|
0x0203ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0203fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 13
Thread ID: 0x000001c0
Context:
EDI: 0x00000000  ESI: 0x00000714  EAX: 0x00000112
EBX: 0x00000000  ECX: 0x00000000  EDX: 0x7ffe0300
EIP: 0x7c90e514  EBP: 0x0213fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0213fe78  SegSs: 0x00000023
Stack:
0x0213fe74: 00000000 7c90df5a 7c8025db 00000714 ....Z..|.%.|....
0x0213fe84: 00000000 00000000 00bb15d8 00000032 ............2...
0x0213fe94: 00000000 00000014 00000001 00000000 ................
0x0213fea4: 00000000 00000010 00000714 ffffffff ................
0x0213feb4: 7ffde000 7ffad000 00000000 009f7f31 ............1...
0x0213fec4: 0213fe8c 00bb15d8 0213ff9c 7c839ad8 ...............|
0x0213fed4: 7c802608 00000000 0213fef0 7c802542 ...|........B%.|
0x0213fee4: 00000714 ffffffff 00000000 7c802446 ............F$.|
0x0213fef4: 009fa576 00000714 ffffffff 016ce2c4 v.............l.
0x0213ff04: 00bb15e4 00000000 00bb15d0 009f8f79 ............y...
0x0213ff14: 00bb15d8 00000000 00000000 016ce2a0 ..............l.
0x0213ff24: 00ba2798 016ce2c4 00000000 0097b43e .'....l.....>...
0x0213ff34: 00000000 016ce2a0 00b803c0 016b9d38 ......l.....8.k.
0x0213ff44: 0097b6c3 016ce2a0 0097b5f0 00000000 ......l.........
0x0213ff54: 0012fd18 009f94e6 016ce2a0 7c911086 ..........l....|
0x0213ff64: 7c9101db 0213ffac 00365658 0000000c ...|....XV6.....
0x0213ff74: 00bb3038 781329bb 00bb12d0 08ada414 80...).x........
0x0213ff84: 7c911086 7c9101db 00365658 0213ff80 ...|...|XV6.....
0x0213ff94: 0213ff80 0213ffdc 0213ffdc 78138ced ...............x
0x0213ffa4: 72a51000 00000000 0213ffec 78132a47 ...r........G*.x
0x0213ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0213ffc4: 7c9101db 00365658 7ffad000 8a6ed600 ...|XV6.......n.
0x0213ffd4: 0213ffc0 8843ccb8 ffffffff 7c839ad8 ......C........|
0x0213ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0213fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 14
Thread ID: 0x00000648
Context:
EDI: 0x00000000  ESI: 0x0000070c  EAX: 0x07992ff9
EBX: 0x00000000  ECX: 0x07993000  EDX: 0x00000001
EIP: 0x7c90e514  EBP: 0x0223fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0223fe78  SegSs: 0x00000023
Stack:
0x0223fe74: 00000000 7c90df5a 7c8025db 0000070c ....Z..|.%.|....
0x0223fe84: 00000000 00000000 00bb1618 00000032 ............2...
0x0223fe94: 00000000 00000014 00000001 00000000 ................
0x0223fea4: 00000000 00000010 00ea4670 00000020 ........pF.. ...
0x0223feb4: 7ffde000 7ffac000 00000000 00000000 ................
0x0223fec4: 0223fe8c 00ea43e0 0223ff9c 7c839ad8 ..#..C....#....|
0x0223fed4: 7c802608 00000000 0223fef0 7c802542 ...|......#.B%.|
0x0223fee4: 0000070c ffffffff 00000000 7c802446 ............F$.|
0x0223fef4: 009fa576 0000070c ffffffff 016ce31c v.............l.
0x0223ff04: 00bb1624 00000000 00bb1610 009f8f79 $...........y...
0x0223ff14: 00bb1618 00000000 00000000 016ce2f8 ..............l.
0x0223ff24: 00ba2798 016ce31c 00000000 0097b43e .'....l.....>...
0x0223ff34: 00000000 016ce2f8 00b900f8 016b3160 ......l.....`1k.
0x0223ff44: 0097b6c3 016ce2f8 0097b5f0 00000000 ......l.........
0x0223ff54: 0012fd18 009f94e6 016ce2f8 7c911086 ..........l....|
0x0223ff64: 7c9101db 0223ffac 00365658 0000000d ...|..#.XV6.....
0x0223ff74: 00bb3058 781329bb 00bb12d0 089da414 X0...).x........
0x0223ff84: 7c911086 7c9101db 00365658 0223ff80 ...|...|XV6...#.
0x0223ff94: 0223ff80 0223ffdc 0223ffdc 78138ced ..#...#...#....x
0x0223ffa4: 72a51000 00000000 0223ffec 78132a47 ...r......#.G*.x
0x0223ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0223ffc4: 7c9101db 00365658 7ffac000 8a6eb600 ...|XV6.......n.
0x0223ffd4: 0223ffc0 88413c20 ffffffff 7c839ad8 ..#. <A........|
0x0223ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0223fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 15
Thread ID: 0x00001644
Context:
EDI: 0x00000000  ESI: 0x00000704  EAX: 0x08521ff9
EBX: 0x00000000  ECX: 0x08522000  EDX: 0x00000006
EIP: 0x7c90e514  EBP: 0x0233fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0233fe78  SegSs: 0x00000023
Stack:
0x0233fe74: 00000000 7c90df5a 7c8025db 00000704 ....Z..|.%.|....
0x0233fe84: 00000000 00000000 00bb1658 00000032 ........X...2...
0x0233fe94: 00000000 00000014 00000001 00000000 ................
0x0233fea4: 00000000 00000010 0233fed4 10de4be8 ..........3..K..
0x0233feb4: 7ffde000 7ffab000 00000000 00000000 ................
0x0233fec4: 0233fe8c 016b4d78 0233ff9c 7c839ad8 ..3.xMk...3....|
0x0233fed4: 7c802608 00000000 0233fef0 7c802542 ...|......3.B%.|
0x0233fee4: 00000704 ffffffff 00000000 7c802446 ............F$.|
0x0233fef4: 009fa576 00000704 ffffffff 016ce374 v...........t.l.
0x0233ff04: 00bb1664 00000000 00bb1650 009f8f79 d.......P...y...
0x0233ff14: 00bb1658 00000000 00000000 016ce350 X...........P.l.
0x0233ff24: 00bb72f8 016ce374 00dbb120 0097b43e .r..t.l. ...>...
0x0233ff34: 00000000 016ce350 00b800d8 016b3248 ....P.l.....H2k.
0x0233ff44: 0097b6c3 016ce350 0097b5f0 00000000 ....P.l.........
0x0233ff54: 0012fd18 009f94e6 016ce350 7c911086 ........P.l....|
0x0233ff64: 7c9101db 0233ffac 00365658 0000000e ...|..3.XV6.....
0x0233ff74: 00bb3078 781329bb 00bb12d0 088da414 x0...).x........
0x0233ff84: 7c911086 7c9101db 00365658 0233ff80 ...|...|XV6...3.
0x0233ff94: 0233ff80 0233ffdc 0233ffdc 78138ced ..3...3...3....x
0x0233ffa4: 72a51000 00000000 0233ffec 78132a47 ...r......3.G*.x
0x0233ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0233ffc4: 7c9101db 00365658 7ffab000 8a6ed600 ...|XV6.......n.
0x0233ffd4: 0233ffc0 88413c20 ffffffff 7c839ad8 ..3. <A........|
0x0233ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0233fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 16
Thread ID: 0x000005a4
Context:
EDI: 0x00000000  ESI: 0x000006fc  EAX: 0x00000002
EBX: 0x00000000  ECX: 0x00000568  EDX: 0x00eb3e48
EIP: 0x7c90e514  EBP: 0x0243fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0243fe78  SegSs: 0x00000023
Stack:
0x0243fe74: 00000000 7c90df5a 7c8025db 000006fc ....Z..|.%.|....
0x0243fe84: 00000000 00000000 00bb1698 00000032 ............2...
0x0243fe94: 00000000 00000014 00000001 00000000 ................
0x0243fea4: 00000000 00000010 00000568 00000020 ........h... ...
0x0243feb4: 7ffde000 7ffaa000 00000000 7c810eb6 ...............|
0x0243fec4: 0243fe8c 00ea38e8 0243ff9c 7c839ad8 ..C..8....C....|
0x0243fed4: 7c802608 00000000 0243fef0 7c802542 ...|......C.B%.|
0x0243fee4: 000006fc ffffffff 00000000 7c802446 ............F$.|
0x0243fef4: 009fa576 000006fc ffffffff 016ce3cc v.............l.
0x0243ff04: 00bb16a4 00000000 00bb1690 009f8f79 ............y...
0x0243ff14: 00bb1698 00000000 00000000 016ce3a8 ..............l.
0x0243ff24: 00ba2798 016ce3cc 00000000 0097b43e .'....l.....>...
0x0243ff34: 00000000 016ce3a8 00b800d8 016b9ff0 ......l.......k.
0x0243ff44: 0097b6c3 016ce3a8 0097b5f0 00000000 ......l.........
0x0243ff54: 0012fd18 009f94e6 016ce3a8 7c911086 ..........l....|
0x0243ff64: 7c9101db 0243ffac 00365658 0000000f ...|..C.XV6.....
0x0243ff74: 00bb3098 781329bb 00bb12d0 08fda414 .0...).x........
0x0243ff84: 7c911086 7c9101db 00365658 0243ff80 ...|...|XV6...C.
0x0243ff94: 0243ff80 0243ffdc 0243ffdc 78138ced ..C...C...C....x
0x0243ffa4: 72a51000 00000000 0243ffec 78132a47 ...r......C.G*.x
0x0243ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0243ffc4: 7c9101db 00365658 7ffaa000 8a6eb600 ...|XV6.......n.
0x0243ffd4: 0243ffc0 875c0760 ffffffff 7c839ad8 ..C.`.\........|
0x0243ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0243fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 17
Thread ID: 0x000010e0
Context:
EDI: 0x00000000  ESI: 0x000006f4  EAX: 0x00000003
EBX: 0x00000000  ECX: 0x00eb42b8  EDX: 0x00eb3e88
EIP: 0x7c90e514  EBP: 0x0253fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0253fe78  SegSs: 0x00000023
Stack:
0x0253fe74: 00000000 7c90df5a 7c8025db 000006f4 ....Z..|.%.|....
0x0253fe84: 00000000 00000000 00bb16d8 00000032 ............2...
0x0253fe94: 00000000 00000014 00000001 00000000 ................
0x0253fea4: 00000000 00000010 000006f4 0253ff9c ..............S.
0x0253feb4: 7ffde000 7ffa9000 00000000 00000000 ................
0x0253fec4: 0253fe8c 00eb3f60 0253ff9c 7c839ad8 ..S.`?....S....|
0x0253fed4: 7c802608 00000000 0253fef0 7c802542 ...|......S.B%.|
0x0253fee4: 000006f4 ffffffff 00000000 7c802446 ............F$.|
0x0253fef4: 009fa576 000006f4 ffffffff 016ce424 v...........$.l.
0x0253ff04: 00bb16e4 00000000 00bb16d0 009f8f79 ............y...
0x0253ff14: 00bb16d8 00000000 00000000 016ce400 ..............l.
0x0253ff24: 00bb92f0 016ce424 00000000 0097b43e ....$.l.....>...
0x0253ff34: 00000000 016ce400 00b900f8 016b4f48 ......l.....HOk.
0x0253ff44: 0097b6c3 016ce400 0097b5f0 00000000 ......l.........
0x0253ff54: 0012fd18 009f94e6 016ce400 7c911086 ..........l....|
0x0253ff64: 7c9101db 0253ffac 00365658 00000010 ...|..S.XV6.....
0x0253ff74: 00bb30b8 781329bb 00bb12d0 08eda414 .0...).x........
0x0253ff84: 7c911086 7c9101db 00365658 0253ff80 ...|...|XV6...S.
0x0253ff94: 0253ff80 0253ffdc 0253ffdc 78138ced ..S...S...S....x
0x0253ffa4: 72a51000 00000000 0253ffec 78132a47 ...r......S.G*.x
0x0253ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0253ffc4: 7c9101db 00365658 7ffa9000 8a6ed600 ...|XV6.......n.
0x0253ffd4: 0253ffc0 875c0760 ffffffff 7c839ad8 ..S.`.\........|
0x0253ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0253fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 18
Thread ID: 0x00000d40
Context:
EDI: 0x00000000  ESI: 0x000006ec  EAX: 0x04c73ff5
EBX: 0x00000000  ECX: 0x04c73ffc  EDX: 0x00000007
EIP: 0x7c90e514  EBP: 0x0263fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0263fe78  SegSs: 0x00000023
Stack:
0x0263fe74: 00000000 7c90df5a 7c8025db 000006ec ....Z..|.%.|....
0x0263fe84: 00000000 00000000 00bb1718 00000032 ............2...
0x0263fe94: 00000000 00000014 00000001 00000000 ................
0x0263fea4: 00000000 00000010 000006ec ffffffff ................
0x0263feb4: 7ffde000 7ffa8000 00000000 009f7f31 ............1...
0x0263fec4: 0263fe8c 00bb1718 0263ff9c 7c839ad8 ..c.......c....|
0x0263fed4: 7c802608 00000000 0263fef0 7c802542 ...|......c.B%.|
0x0263fee4: 000006ec ffffffff 00000000 7c802446 ............F$.|
0x0263fef4: 009fa576 000006ec ffffffff 016ce47c v...........|.l.
0x0263ff04: 00bb1724 00000000 00bb1710 009f8f79 $...........y...
0x0263ff14: 00bb1718 00000000 00000000 016ce458 ............X.l.
0x0263ff24: 00ba2798 016ce47c 00000000 0097b43e .'..|.l.....>...
0x0263ff34: 00000000 016ce458 00b904a0 016b8690 ....X.l.......k.
0x0263ff44: 0097b6c3 016ce458 0097b5f0 00000000 ....X.l.........
0x0263ff54: 0012fd18 009f94e6 016ce458 7c911086 ........X.l....|
0x0263ff64: 7c9101db 0263ffac 00365658 00000011 ...|..c.XV6.....
0x0263ff74: 00bb30d8 781329bb 00bb12d0 08dda414 .0...).x........
0x0263ff84: 7c911086 7c9101db 00365658 0263ff80 ...|...|XV6...c.
0x0263ff94: 0263ff80 0263ffdc 0263ffdc 78138ced ..c...c...c....x
0x0263ffa4: 72a51000 00000000 0263ffec 78132a47 ...r......c.G*.x
0x0263ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0263ffc4: 7c9101db 00365658 7ffa8000 8a6eb600 ...|XV6.......n.
0x0263ffd4: 0263ffc0 89967bf0 ffffffff 7c839ad8 ..c..{.........|
0x0263ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0263fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 19
Thread ID: 0x00001150
Context:
EDI: 0x00000000  ESI: 0x000006e4  EAX: 0x0a46fff1
EBX: 0x00000000  ECX: 0x0a46fff1  EDX: 0x016b5118
EIP: 0x7c90e514  EBP: 0x0273fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0273fe78  SegSs: 0x00000023
Stack:
0x0273fe74: 00000000 7c90df5a 7c8025db 000006e4 ....Z..|.%.|....
0x0273fe84: 00000000 00000000 00bb1758 00000032 ........X...2...
0x0273fe94: 00000000 00000014 00000001 00000000 ................
0x0273fea4: 00000000 00000010 0273fed4 06713440 ..........s. at 4q.
0x0273feb4: 7ffde000 7ffa7000 00000000 00000000 .....p..........
0x0273fec4: 0273fe8c 016b5118 0273ff9c 7c839ad8 ..s..Qk...s....|
0x0273fed4: 7c802608 00000000 0273fef0 7c802542 ...|......s.B%.|
0x0273fee4: 000006e4 ffffffff 00000000 7c802446 ............F$.|
0x0273fef4: 009fa576 000006e4 ffffffff 016ce4d4 v.............l.
0x0273ff04: 00bb1764 00000000 00bb1750 009f8f79 d.......P...y...
0x0273ff14: 00bb1758 00000000 00000000 016ce4b0 X.............l.
0x0273ff24: 00ba26c0 016ce4d4 01724738 0097b43e ......l.8Gr.>...
0x0273ff34: 00000000 016ce4b0 00b900f8 016b5118 ......l......Qk.
0x0273ff44: 0097b6c3 016ce4b0 0097b5f0 00000000 ......l.........
0x0273ff54: 0012fd18 009f94e6 016ce4b0 7c911086 ..........l....|
0x0273ff64: 7c9101db 0273ffac 00365658 00000012 ...|..s.XV6.....
0x0273ff74: 00bb30f8 781329bb 00bb12d0 08cda414 .0...).x........
0x0273ff84: 7c911086 7c9101db 00365658 0273ff80 ...|...|XV6...s.
0x0273ff94: 0273ff80 0273ffdc 0273ffdc 78138ced ..s...s...s....x
0x0273ffa4: 72a51000 00000000 0273ffec 78132a47 ...r......s.G*.x
0x0273ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0273ffc4: 7c9101db 00365658 7ffa7000 8a6ed600 ...|XV6..p....n.
0x0273ffd4: 0273ffc0 89967bf0 ffffffff 7c839ad8 ..s..{.........|
0x0273ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0273fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 20
Thread ID: 0x000011ec
Context:
EDI: 0x00000000  ESI: 0x000006dc  EAX: 0x110200c8
EBX: 0x00000000  ECX: 0x0283fcb4  EDX: 0x00010000
EIP: 0x7c90e514  EBP: 0x0283fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0283fe78  SegSs: 0x00000023
Stack:
0x0283fe74: 00000000 7c90df5a 7c8025db 000006dc ....Z..|.%.|....
0x0283fe84: 00000000 00000000 00bb1798 00000032 ............2...
0x0283fe94: 00000000 00000014 00000001 00000000 ................
0x0283fea4: 00000000 00000010 000006dc ffffffff ................
0x0283feb4: 7ffde000 7ffa6000 00000000 009f7f31 .....`......1...
0x0283fec4: 0283fe8c 00bb1798 0283ff9c 7c839ad8 ...............|
0x0283fed4: 7c802608 00000000 0283fef0 7c802542 ...|........B%.|
0x0283fee4: 000006dc ffffffff 00000000 7c802446 ............F$.|
0x0283fef4: 009fa576 000006dc ffffffff 016ce52c v...........,.l.
0x0283ff04: 00bb17a4 00000000 00bb1790 009f8f79 ............y...
0x0283ff14: 00bb1798 00000000 00000000 016ce508 ..............l.
0x0283ff24: 00bb8f60 016ce52c 0420d588 0097b43e `...,.l... .>...
0x0283ff34: 00000000 016ce508 00b900f8 016b5200 ......l......Rk.
0x0283ff44: 0097b6c3 016ce508 0097b5f0 00000000 ......l.........
0x0283ff54: 0012fd18 009f94e6 016ce508 7c911086 ..........l....|
0x0283ff64: 7c9101db 0283ffac 00365658 00000013 ...|....XV6.....
0x0283ff74: 00bb3118 781329bb 00bb12d0 083da414 .1...).x......=.
0x0283ff84: 7c911086 7c9101db 00365658 0283ff80 ...|...|XV6.....
0x0283ff94: 0283ff80 0283ffdc 0283ffdc 78138ced ...............x
0x0283ffa4: 72a51000 00000000 0283ffec 78132a47 ...r........G*.x
0x0283ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0283ffc4: 7c9101db 00365658 7ffa6000 8a6eb600 ...|XV6..`....n.
0x0283ffd4: 0283ffc0 86e9e580 ffffffff 7c839ad8 ...............|
0x0283ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0283fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 21
Thread ID: 0x00000cf8
Context:
EDI: 0x00000000  ESI: 0x000006d4  EAX: 0x0293ff0c
EBX: 0x00000000  ECX: 0x001000a0  EDX: 0x082d0049
EIP: 0x7c90e514  EBP: 0x0293fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x0293fe78  SegSs: 0x00000023
Stack:
0x0293fe74: 00000000 7c90df5a 7c8025db 000006d4 ....Z..|.%.|....
0x0293fe84: 00000000 00000000 00bb17d8 00000032 ............2...
0x0293fe94: 00000000 00000014 00000001 00000000 ................
0x0293fea4: 00000000 00000010 000006d4 ffffffff ................
0x0293feb4: 7ffde000 7ffa5000 00000000 009f7f31 .....P......1...
0x0293fec4: 0293fe8c 00bb17d8 0293ff9c 7c839ad8 ...............|
0x0293fed4: 7c802608 00000000 0293fef0 7c802542 ...|........B%.|
0x0293fee4: 000006d4 ffffffff 00000000 7c802446 ............F$.|
0x0293fef4: 009fa576 000006d4 ffffffff 016ce584 v.............l.
0x0293ff04: 00bb17e4 00000000 00bb17d0 009f8f79 ............y...
0x0293ff14: 00bb17d8 00000000 00000000 016ce560 ............`.l.
0x0293ff24: 00bb4898 016ce584 00000000 0097b43e .H....l.....>...
0x0293ff34: 00000000 016ce560 00b800d8 016b8948 ....`.l.....H.k.
0x0293ff44: 0097b6c3 016ce560 0097b5f0 00000000 ....`.l.........
0x0293ff54: 0012fd18 009f94e6 016ce560 7c911086 ........`.l....|
0x0293ff64: 7c9101db 0293ffac 00365658 00000014 ...|....XV6.....
0x0293ff74: 00bb3138 781329bb 00bb12d0 082da414 81...).x......-.
0x0293ff84: 7c911086 7c9101db 00365658 0293ff80 ...|...|XV6.....
0x0293ff94: 0293ff80 0293ffdc 0293ffdc 78138ced ...............x
0x0293ffa4: 72a51000 00000000 0293ffec 78132a47 ...r........G*.x
0x0293ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x0293ffc4: 7c9101db 00365658 7ffa5000 8a6ed600 ...|XV6..P....n.
0x0293ffd4: 0293ffc0 86e9e580 ffffffff 7c839ad8 ...............|
0x0293ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x0293fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 22
Thread ID: 0x00001544
Context:
EDI: 0x00000000  ESI: 0x000006cc  EAX: 0x042d53d0
EBX: 0x00000000  ECX: 0x00000004  EDX: 0x000fac50
EIP: 0x7c90e514  EBP: 0x02a3fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x02a3fe78  SegSs: 0x00000023
Stack:
0x02a3fe74: 00000000 7c90df5a 7c8025db 000006cc ....Z..|.%.|....
0x02a3fe84: 00000000 00000000 00bb1818 00000032 ............2...
0x02a3fe94: 00000000 00000014 00000001 00000000 ................
0x02a3fea4: 00000000 00000010 000006cc 00000020 ............ ...
0x02a3feb4: 7ffde000 7ffa4000 00000000 00000000 ..... at ..........
0x02a3fec4: 02a3fe8c 00ea38d0 02a3ff9c 7c839ad8 .....8.........|
0x02a3fed4: 7c802608 00000000 02a3fef0 7c802542 ...|........B%.|
0x02a3fee4: 000006cc ffffffff 00000000 7c802446 ............F$.|
0x02a3fef4: 009fa576 000006cc ffffffff 016ce5dc v.............l.
0x02a3ff04: 00bb1824 00000000 00bb1810 009f8f79 $...........y...
0x02a3ff14: 00bb1818 00000000 00000000 016ce5b8 ..............l.
0x02a3ff24: 00bb48d8 016ce5dc 00000000 0097b43e .H....l.....>...
0x02a3ff34: 00000000 016ce5b8 00b900f8 016b38a0 ......l......8k.
0x02a3ff44: 0097b6c3 016ce5b8 0097b5f0 00000000 ......l.........
0x02a3ff54: 0012fd18 009f94e6 016ce5b8 7c911086 ..........l....|
0x02a3ff64: 7c9101db 02a3ffac 00365658 00000015 ...|....XV6.....
0x02a3ff74: 00bb3158 781329bb 00bb12d0 081da414 X1...).x........
0x02a3ff84: 7c911086 7c9101db 00365658 02a3ff80 ...|...|XV6.....
0x02a3ff94: 02a3ff80 02a3ffdc 02a3ffdc 78138ced ...............x
0x02a3ffa4: 72a51000 00000000 02a3ffec 78132a47 ...r........G*.x
0x02a3ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x02a3ffc4: 7c9101db 00365658 7ffa4000 8a6eb600 ...|XV6.. at ....n.
0x02a3ffd4: 02a3ffc0 883d1fd0 ffffffff 7c839ad8 ......=........|
0x02a3ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x02a3fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 23
Thread ID: 0x00001540
Context:
EDI: 0x00000000  ESI: 0x000006c4  EAX: 0x80000000
EBX: 0x00000000  ECX: 0x0ccfbde3  EDX: 0x00ea2a8c
EIP: 0x7c90e514  EBP: 0x02b3fedc  SegCs: 0x0000001b
EFlags: 0x00000246  ESP: 0x02b3fe78  SegSs: 0x00000023
Stack:
0x02b3fe74: 00000000 7c90df5a 7c8025db 000006c4 ....Z..|.%.|....
0x02b3fe84: 00000000 00000000 00bb1858 00000032 ........X...2...
0x02b3fe94: 00000000 00000014 00000001 00000000 ................
0x02b3fea4: 00000000 00000010 000006c4 ffffffff ................
0x02b3feb4: 7ffde000 7ffa3000 00000000 009f7f31 .....0......1...
0x02b3fec4: 02b3fe8c 00bb1858 02b3ff9c 7c839ad8 ....X..........|
0x02b3fed4: 7c802608 00000000 02b3fef0 7c802542 ...|........B%.|
0x02b3fee4: 000006c4 ffffffff 00000000 7c802446 ............F$.|
0x02b3fef4: 009fa576 000006c4 ffffffff 016ce634 v...........4.l.
0x02b3ff04: 00bb1864 00000000 00bb1850 009f8f79 d.......P...y...
0x02b3ff14: 00bb1858 00000000 00000000 016ce610 X.............l.
0x02b3ff24: 00bb47c0 016ce634 00000000 0097b43e .G..4.l.....>...
0x02b3ff34: 00000000 016ce610 00b800d8 016b8b18 ......l.......k.
0x02b3ff44: 0097b6c3 016ce610 0097b5f0 00000000 ......l.........
0x02b3ff54: 0012fd18 009f94e6 016ce610 7c911086 ..........l....|
0x02b3ff64: 7c9101db 02b3ffac 00365658 00000016 ...|....XV6.....
0x02b3ff74: 00bb3178 781329bb 00bb12d0 080da414 x1...).x........
0x02b3ff84: 7c911086 7c9101db 00365658 02b3ff80 ...|...|XV6.....
0x02b3ff94: 02b3ff80 02b3ffdc 02b3ffdc 78138ced ...............x
0x02b3ffa4: 72a51000 00000000 02b3ffec 78132a47 ...r........G*.x
0x02b3ffb4: 7c9101db 7c80b729 00365658 7c911086 ...|)..|XV6....|
0x02b3ffc4: 7c9101db 00365658 7ffa3000 8a6ed600 ...|XV6..0....n.
0x02b3ffd4: 02b3ffc0 883d1fd0 ffffffff 7c839ad8 ......=........|
0x02b3ffe4: 7c80b730 00000000 00000000 00000000 0..|............
0x02b3fff4: 781329e1 00365658 00000000          .).xXV6.....

Thread 24
Thread ID: 0x000001cc
Context:
EDI: 0x00000000  ESI: 0x000006bc  EAX: 0x043ecb30
EBX: 0x00000000  ECX: 0x00000004  EDX: 0x000f34f0
EIP: 0x7c90e514  EBP: 0x02c3fedc  SegCs: 0x0000001b

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110621/dff42337/attachment-0001.htm>

From aaron at agoragames.com  Tue Jun 21 20:50:40 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 21 Jun 2011 15:50:40 -0400
Subject: [rabbitmq-discuss] haigha 0.3.0
Message-ID: <BANLkTimNAs2X_YvR8XG6be4rZOXts6rBFg@mail.gmail.com>

We've released haigha 0.3.0, our "formal" release. Packages are up on
pypy, and you can read the whole story on our blog.

cheers,
Aaron

http://blog.agoragames.com/blog/2011/06/21/introducing-haigha/


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From fearsome.lucidity at gmail.com  Tue Jun 21 23:51:43 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 21 Jun 2011 15:51:43 -0700
Subject: [rabbitmq-discuss] Persistent messages and durable queue questions
Message-ID: <BANLkTinehFtF17CT6koQ-W_kUV-7fdJWSw@mail.gmail.com>

Good day,

I was wondering whether someone my know the answer to the following
questions.  I've read the FAQ and manuals, but they are not completely
clear.

The first question is does a persistent message will hit the disk even if
there is a consumer on the queue the message is being delivered to, and do
automatic acknowledgements (i.e. no-wait) make a difference?

We are in a situation where writing to disk is expensive, and usually there
will be a waiting and willing consumer attached to the queue, but we are not
using automatic acks, rather we ack the message when the consumer has
processed it, which may take a second or two.  So we'd like to know whether
in the common case in this situation messages will be written to disk or
not.

The docs are unclear.  One could interpret them to mean that if there is a
willing consumer the message will not be written to disk, but its unclear if
this requires no-wait to be true.


The second question is what happens to persistent messages coming in through
a node that are to be routed to a durable queue attached to a different
node?

I believe this is answered by a question in the FAQ, "What happens to
messages when a network outage removes the route between an exchange and a
bound queue?", which states that the messages will be silently dropped
unless I set the mandatory flag on basic.publish.

Alas, that is not feasible in our use-case.  We are publishing to a topic
exchange and creating bindings to to match a subset of the published
messages to some durable queues.  Thus, we actually expect many messages to
be routed to no queue.  Even if we set the mandatory flag, we'd not be able
to tell whether the error received by the publisher was a result of no
binding matching the message (a normal condition) or the loss a node, along
with all the queues and bindings associated with it (an exceptional
condition).

Any suggestions on how to handle this issue and distinguish between these
two conditions?

Thanks,

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110621/4232fec2/attachment.htm>

From pshomov at gmail.com  Wed Jun 22 02:19:32 2011
From: pshomov at gmail.com (Petar Shomov)
Date: Wed, 22 Jun 2011 01:19:32 +0000
Subject: [rabbitmq-discuss] queue subscription + sending to some exchange
In-Reply-To: <4E006709.6030804@rabbitmq.com>
References: <BANLkTinBYxFQKFLEJF8VMT2gpuASwKaDiw@mail.gmail.com>
	<BANLkTinGihLGRMLadn+QsC_s_m9thfSv4w@mail.gmail.com>
	<BANLkTinY87p-tibCVvKfd-MFA-V+eJJQ7g@mail.gmail.com>
	<4E006709.6030804@rabbitmq.com>
Message-ID: <BANLkTim3aE=RpJF_PbyHOc2WDy9Tj=xDAw@mail.gmail.com>

Hi Emile,

What a great suggestion: look into the log file ;). Indeed I looked
and found the problem: the exchange I was posting to did not exist.
Somehow the first posting succeeded but on the second attempt did not
go through or something like that.

I am going to post the mini-example just in case since I prepared it
anyways so it might be useful to someone. I find the error message in
the rabbitmq server log very helpful but the one that I got in the
client was very confusing - The AMQP operation was interrupted: AMQP
close-reason, initiated by Library, code=504, text="Frame received for
invalid channel 2", classId=0, methodId=0,
cause=RabbitMQ.Client.Impl.ChannelErrorException: Frame received for
invalid channel 2

Thank you and Simone for reaching out!

---------------------------------
Regards,

Petar



On Tue, Jun 21, 2011 at 9:40 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Petar,
>
> I assume that queueHandlers in your snippet establishes a new channel
> when the error occurs. Is it possible that queueHandlers is using the
> wrong channel by mistake? Can you supply a minimal self-contained
> example that illustrates the problem? Is there any additional
> information in the broker logfile at the time of the error?
>
>
> -Emile
>
>
> On 21/06/11 01:17, Petar Shomov wrote:
>> Hi Simone,
>>
>> Thanx for the suggestion! I have read that section about threading
>> many times but my understanding is that channels can be shared among
>> threads as long as they are not used concurrently. I am not doing that
>> and I even went ahead and created that channel in the thread that is
>> doing the consumption just to be on the safe side. No dice, same
>> error.
>>
>> What worries me in that section is this paragraph:
>>
>> "Application callback handlers must not invoke blocking AMQP operations (such as
>> IModel.QueueDeclare, IModel.BasicCancel or IModel.BasicPublish). If
>> they do, the channel
>> will deadlock"
>>
>> Now, does that mean I should not be doing what I intended to be doing
>> (I use IModel.BasicPublish)? I find that hard to believe.
>> I am taking care to open a different channel for the publishing of my
>> messages but I wonder is that enough?
>> My channel did not deadlock just looks like things got mixed up ;(
>>
>> ---------------------------------
>> Regards,
>>
>> Petar
>>
>>
>>
>> On Mon, Jun 20, 2011 at 9:57 PM, Simone Busoli <simone.busoli at gmail.com> wrote:
>>> Hi Petar,
>>>
>>> I think you are violating one of the assumption that the C# client does on
>>> channel usage. Channels should not be shared among threads (read the pdf
>>> user guide for details), and it appears you are using the channel on a
>>> different thread than that where the channel was created.
>>>
>>> On Mon, Jun 20, 2011 at 23:41, Petar Shomov <pshomov at gmail.com> wrote:
>>>>
>>>> Hi guys,
>>>>
>>>> I have a situation which I do not completely understand and I was
>>>> hoping someone more acquainted with AMQP and RabbitMQ might point me
>>>> in the right direction.
>>>>
>>>> I have a console app that needs to subscribe to a message queue where
>>>> the process of handling a message is rather lengthy. During this
>>>> lengthy process I need to send out messages to some exchange which
>>>> represent information about the progress of the operation.
>>>> The subscription to the queue has to be asynchronous too, since I am
>>>> doing something else on the main thread. So I have running in a thread
>>>> this code (C#):
>>>>
>>>> ? ? ? ? ? ? ? ?var job = new Thread(() =>
>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {
>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? var consumer = new
>>>> QueueingBasicConsumer(channel);
>>>>
>>>> channel.BasicConsume(queueName, false, consumer);
>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? while (true)
>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {
>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? BasicDeliverEventArgs e =
>>>> null;
>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? e =
>>>> (BasicDeliverEventArgs) consumer.Queue.Dequeue();
>>>>
>>>> queueHandlers[queueName][e.Exchange](e);
>>>>
>>>> channel.BasicAck(e.DeliveryTag, false);
>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?}
>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? }
>>>>
>>>> ?Unfortunately when I try to send messages within the message handler
>>>> (I am opening a different channel on the same connection, tried even
>>>> opening a different connection with no better luck) I am getting these
>>>> kind of exceptions, usually when attempting to send the *second*
>>>> message:
>>>>
>>>> - ? ? ? ? ? ? ? $exception ? ? ?{"The AMQP operation was interrupted: AMQP
>>>> close-reason,
>>>> initiated by Library, code=504, text=\"Frame received for invalid
>>>> channel 2\", classId=0, methodId=0,
>>>> cause=RabbitMQ.Client.Impl.ChannelErrorException: Frame received for
>>>> invalid channel 2\r\n ? at ...
>>>>
>>>>
>>>> Thoughts, ideas, anything?
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Sample.Test.zip
Type: application/zip
Size: 4034 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110622/98273bde/attachment.zip>

From rob at rabbitmq.com  Wed Jun 22 09:15:24 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Wed, 22 Jun 2011 09:15:24 +0100
Subject: [rabbitmq-discuss] Persistent messages and durable queue
	questions
In-Reply-To: <BANLkTinehFtF17CT6koQ-W_kUV-7fdJWSw@mail.gmail.com>
References: <BANLkTinehFtF17CT6koQ-W_kUV-7fdJWSw@mail.gmail.com>
Message-ID: <4E01A49C.9010402@rabbitmq.com>



Elias Levy wrote:
> Good day,
>
> I was wondering whether someone my know the answer to the following
> questions.  I've read the FAQ and manuals, but they are not completely
> clear.
>
> The first question is does a persistent message will hit the disk even
> if there is a consumer on the queue the message is being delivered to,
> and do automatic acknowledgements (i.e. no-wait) make a difference?
>
> We are in a situation where writing to disk is expensive, and usually
> there will be a waiting and willing consumer attached to the queue, but
> we are not using automatic acks, rather we ack the message when the
> consumer has processed it, which may take a second or two.  So we'd like
> to know whether in the common case in this situation messages will be
> written to disk or not.
>
> The docs are unclear.  One could interpret them to mean that if there is
> a willing consumer the message will not be written to disk, but its
> unclear if this requires no-wait to be true.

When there is a consumer ready to receive the message, the message will 
only be written to disk if:

1. The queue is durable
2. The message is peristent
3. Automatic ack is disabled

>
>
> The second question is what happens to persistent messages coming in
> through a node that are to be routed to a durable queue attached to a
> different node?
>
> I believe this is answered by a question in the FAQ, "What happens to
> messages when a network outage removes the route between an exchange and
> a bound queue?", which states that the messages will be silently dropped
> unless I set the mandatory flag on basic.publish.
>
> Alas, that is not feasible in our use-case.  We are publishing to a
> topic exchange and creating bindings to to match a subset of the
> published messages to some durable queues.  Thus, we actually expect
> many messages to be routed to no queue.  Even if we set the mandatory
> flag, we'd not be able to tell whether the error received by the
> publisher was a result of no binding matching the message (a normal
> condition) or the loss a node, along with all the queues and bindings
> associated with it (an exceptional condition).
>

You can use publisher confirms to allow your application code to know 
when a message has successfully been routed or when it has been lost.

See: http://www.rabbitmq.com/extensions.html#confirms

> Any suggestions on how to handle this issue and distinguish between
> these two conditions?
>
> Thanks,
>
> Elias Levy
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Simone.Busoli at ferrari.com  Wed Jun 22 09:44:41 2011
From: Simone.Busoli at ferrari.com (Busoli, Simone)
Date: Wed, 22 Jun 2011 08:44:41 +0000
Subject: [rabbitmq-discuss] queue subscription + sending to some exchange
In-Reply-To: <BANLkTim3aE=RpJF_PbyHOc2WDy9Tj=xDAw@mail.gmail.com>
References: <BANLkTinBYxFQKFLEJF8VMT2gpuASwKaDiw@mail.gmail.com><BANLkTinGihLGRMLadn+QsC_s_m9thfSv4w@mail.gmail.com><BANLkTinY87p-tibCVvKfd-MFA-V+eJJQ7g@mail.gmail.com><4E006709.6030804@rabbitmq.com>
	<BANLkTim3aE=RpJF_PbyHOc2WDy9Tj=xDAw@mail.gmail.com>
Message-ID: <88E590DC4586974D825FC82AE798294E52010DEE@GSVCLU03.ges.ferlan.it>

Hi Petar,

looking at the code I am under the impression that you may have a race condition between the subscription and the first publish, in that the second may try to publish to the exchange before the first declares it, although I believed the exchange declaration was a synchronous operation.

Side note: instead of your assertion helpers, you can leverage NUnit's support for delayed (polling) assertions:

Assert.That(() => done, Is.EqualTo(3).After(delay))

NUnit will verify the assertion at intervals until delay has expired, at which point it will fail if the constraint is not satisfied yet.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Petar Shomov
Sent: Wednesday, June 22, 2011 3:20 AM
To: Emile Joubert
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] queue subscription + sending to some exchange

Hi Emile,

What a great suggestion: look into the log file ;). Indeed I looked and found the problem: the exchange I was posting to did not exist.
Somehow the first posting succeeded but on the second attempt did not go through or something like that.

I am going to post the mini-example just in case since I prepared it anyways so it might be useful to someone. I find the error message in the rabbitmq server log very helpful but the one that I got in the client was very confusing - The AMQP operation was interrupted: AMQP close-reason, initiated by Library, code=504, text="Frame received for invalid channel 2", classId=0, methodId=0,
cause=RabbitMQ.Client.Impl.ChannelErrorException: Frame received for invalid channel 2

Thank you and Simone for reaching out!

---------------------------------
Regards,

Petar



On Tue, Jun 21, 2011 at 9:40 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Petar,
>
> I assume that queueHandlers in your snippet establishes a new channel 
> when the error occurs. Is it possible that queueHandlers is using the 
> wrong channel by mistake? Can you supply a minimal self-contained 
> example that illustrates the problem? Is there any additional 
> information in the broker logfile at the time of the error?
>
>
> -Emile
>
>
> On 21/06/11 01:17, Petar Shomov wrote:
>> Hi Simone,
>>
>> Thanx for the suggestion! I have read that section about threading 
>> many times but my understanding is that channels can be shared among 
>> threads as long as they are not used concurrently. I am not doing 
>> that and I even went ahead and created that channel in the thread 
>> that is doing the consumption just to be on the safe side. No dice, 
>> same error.
>>
>> What worries me in that section is this paragraph:
>>
>> "Application callback handlers must not invoke blocking AMQP 
>> operations (such as IModel.QueueDeclare, IModel.BasicCancel or 
>> IModel.BasicPublish). If they do, the channel will deadlock"
>>
>> Now, does that mean I should not be doing what I intended to be doing 
>> (I use IModel.BasicPublish)? I find that hard to believe.
>> I am taking care to open a different channel for the publishing of my 
>> messages but I wonder is that enough?
>> My channel did not deadlock just looks like things got mixed up ;(
>>
>> ---------------------------------
>> Regards,
>>
>> Petar
>>
>>
>>
>> On Mon, Jun 20, 2011 at 9:57 PM, Simone Busoli <simone.busoli at gmail.com> wrote:
>>> Hi Petar,
>>>
>>> I think you are violating one of the assumption that the C# client 
>>> does on channel usage. Channels should not be shared among threads 
>>> (read the pdf user guide for details), and it appears you are using 
>>> the channel on a different thread than that where the channel was created.
>>>
>>> On Mon, Jun 20, 2011 at 23:41, Petar Shomov <pshomov at gmail.com> wrote:
>>>>
>>>> Hi guys,
>>>>
>>>> I have a situation which I do not completely understand and I was 
>>>> hoping someone more acquainted with AMQP and RabbitMQ might point 
>>>> me in the right direction.
>>>>
>>>> I have a console app that needs to subscribe to a message queue 
>>>> where the process of handling a message is rather lengthy. During 
>>>> this lengthy process I need to send out messages to some exchange 
>>>> which represent information about the progress of the operation.
>>>> The subscription to the queue has to be asynchronous too, since I 
>>>> am doing something else on the main thread. So I have running in a 
>>>> thread this code (C#):
>>>>
>>>>                var job = new Thread(() =>
>>>>                                         {
>>>>                                             var consumer = new 
>>>> QueueingBasicConsumer(channel);
>>>>
>>>> channel.BasicConsume(queueName, false, consumer);
>>>>                                             while (true)
>>>>                                             {
>>>>                                                 
>>>> BasicDeliverEventArgs e = null;
>>>>                                                 e =
>>>> (BasicDeliverEventArgs) consumer.Queue.Dequeue();
>>>>
>>>> queueHandlers[queueName][e.Exchange](e);
>>>>
>>>> channel.BasicAck(e.DeliveryTag, false);
>>>>                                              }
>>>>                                         }
>>>>
>>>>  Unfortunately when I try to send messages within the message 
>>>> handler (I am opening a different channel on the same connection, 
>>>> tried even opening a different connection with no better luck) I am 
>>>> getting these kind of exceptions, usually when attempting to send 
>>>> the *second*
>>>> message:
>>>>
>>>> -               $exception      {"The AMQP operation was 
>>>> interrupted: AMQP close-reason, initiated by Library, code=504, 
>>>> text=\"Frame received for invalid channel 2\", classId=0, 
>>>> methodId=0,
>>>> cause=RabbitMQ.Client.Impl.ChannelErrorException: Frame received 
>>>> for invalid channel 2\r\n   at ...
>>>>
>>>>
>>>> Thoughts, ideas, anything?
>

_________________________________________________________________________________________________________________
Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ? 
strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
_________________________________________________________________________________________________________________
This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from 
disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the 
message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly 
prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from 
your system.
_________________________________________________________________________________________________________________



From emile at rabbitmq.com  Wed Jun 22 10:23:15 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 22 Jun 2011 10:23:15 +0100
Subject: [rabbitmq-discuss] queue subscription + sending to some exchange
In-Reply-To: <BANLkTim3aE=RpJF_PbyHOc2WDy9Tj=xDAw@mail.gmail.com>
References: <BANLkTinBYxFQKFLEJF8VMT2gpuASwKaDiw@mail.gmail.com>	<BANLkTinGihLGRMLadn+QsC_s_m9thfSv4w@mail.gmail.com>	<BANLkTinY87p-tibCVvKfd-MFA-V+eJJQ7g@mail.gmail.com>	<4E006709.6030804@rabbitmq.com>
	<BANLkTim3aE=RpJF_PbyHOc2WDy9Tj=xDAw@mail.gmail.com>
Message-ID: <4E01B483.30601@rabbitmq.com>

Hi Petar,

On 22/06/11 02:19, Petar Shomov wrote:
> Hi Emile,
> 
> What a great suggestion: look into the log file ;). Indeed I looked
> and found the problem: the exchange I was posting to did not exist.
> Somehow the first posting succeeded but on the second attempt did not
> go through or something like that.

I'm glad you found the problem. The first posting would not have
succeeded, but since publishing is asynchronous, the problem manifests
later from the client's perspective.

You should consider using publisher confirms in tests that publish
messages. That would have made this error apparent earlier and avoids
racy time-outs.



-Emile

From matthias at rabbitmq.com  Wed Jun 22 11:20:31 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 22 Jun 2011 11:20:31 +0100
Subject: [rabbitmq-discuss] rabbitmq-lvc-plugin broken with 2.5.0 release
In-Reply-To: <BANLkTinyhHMxmmM6dMEUkdFtd34T81PuMA@mail.gmail.com>
References: <BANLkTim_19Ah2ttNuZmk2SpEaE2N+1FkEg@mail.gmail.com>	<4DFB19FA.5080800@rabbitmq.com>
	<BANLkTinyhHMxmmM6dMEUkdFtd34T81PuMA@mail.gmail.com>
Message-ID: <4E01C1EF.7080207@rabbitmq.com>

Fabio,

On 20/06/11 20:05, Fabio Margarido wrote:
> On Fri, Jun 17, 2011 at 06:10, Michael Bridgen <mikeb at rabbitmq.com
> <mailto:mikeb at rabbitmq.com>> wrote:
>
>     I've updated it. There were yet more changes to how exchange type
>     callbacks are called, a change to a record definition
>     (basic_message), the boot sequence, and a different plugin build
>     system.  Just about the only thing that hasn't changed is the name!
>       Oh actually no that had to change too.
>
>
> Thank you very much. It's working now.
>   A little bit off topic: any news on whether this type of non-pure AMQP
> scenario will be more officially supported by RabbitMQ?

We have no concrete plans for that at present, but it is certainly an 
area we want to revisit in the future.

Regards,

Matthias.

From matthew at rabbitmq.com  Wed Jun 22 11:25:04 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Jun 2011 11:25:04 +0100
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
In-Reply-To: <ABA42E48EC654326B9E2F059573DA9BE@gmail.com>
References: <mailman.555.1308639242.2898.rabbitmq-discuss@lists.rabbitmq.com>
	<ABA42E48EC654326B9E2F059573DA9BE@gmail.com>
Message-ID: <20110622102503.GB2780@rabbitmq.com>

Hi Chris,

On Tue, Jun 21, 2011 at 11:18:36AM -0400, Chris Madden wrote:
>  I upgraded our erlang version to R14B03, but the LATEST.LOG still continues to be growing, albeit, more slowly perhaps? 

Curious.

> I'm kind of suspicious of one of the queue usage models I'm using. When one of the processes needs to make a one-off request (rpc like), it creates a queue dedicated to that request, and expects the reply to come back on that queue. After a timeout or the response is delivered, the queue is taken down. As a result, we have queues come and go a few times a minute... not really ideal, but it helps with debugging. Beyond this, I think the rabbit setup is pretty standard. Any ideas?

How is the timeout done? Are you using our queue expiry timeout
extension or some other mechanism? This might require some mnesia
tuning, but I'm amazed if it does and you're the first person to run
into this - it's such a common scenario I'm sure we'd have heard about
it earlier.

Matthew

From matthew at rabbitmq.com  Wed Jun 22 11:25:28 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Jun 2011 11:25:28 +0100
Subject: [rabbitmq-discuss] rabbitmq-messagepatterns
In-Reply-To: <BANLkTimEtE+KSQDgGpj8iy9==n-w42Z+AA@mail.gmail.com>
References: <BANLkTimEtE+KSQDgGpj8iy9==n-w42Z+AA@mail.gmail.com>
Message-ID: <20110622102528.GC2780@rabbitmq.com>

On Mon, Jun 20, 2011 at 04:31:39PM -0500, James Carr wrote:
> Is there a maven repository that I can find the rabbitmq-messagepatterns jar in?

We've not done one. I doubt anyone else has.

Matthew

From matthew at rabbitmq.com  Wed Jun 22 11:32:20 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Jun 2011 11:32:20 +0100
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <A4563130-D976-458A-AE5E-249A65F79BAE@gmail.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
	<20110619193229.GA2535@rabbitmq.com>
	<92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>
	<20110619205630.GB2535@rabbitmq.com>
	<A4563130-D976-458A-AE5E-249A65F79BAE@gmail.com>
Message-ID: <20110622103220.GD2780@rabbitmq.com>

Hi Alvaro,

On Sun, Jun 19, 2011 at 11:46:04PM +0200, Alvaro Videla wrote:
> I've extracted the boot steps logic into its own module. I think in
> this way it might get easier to use by projects outside RabbitMQ.
> 
> So far it depends on rabbit_misc:all_module_attributes/1 and
> rabbit_misc:build_acyclic_graph/3 but they are used in other parts of
> Rabbit's code so I don't know what's the best approach here.
> 
> I've added some specs, I hope they are correct, since is the first
> time I write those. Also I added extra functionality. So it's possible
> to have boot steps like -my_app_boot_step and so on. In this way, the
> prefix can be customized. There's a function boot_steps/1 that will
> look for the <prefix>_boot_step attributes. If prefix is omitted, then
> the current application name will be used.
> 
> My idea is to extract this module to some library via a Make target in
> the same way rabbit_common is extracted today.
> 
> I've attached the patch and the new module, let me know what you
> think.

Many thanks for your efforts.

Because the functionality is now completely non rabbit-specific, they
should not really be in a module with a rabbit_ prefix. The more
reusable parts of rabbit's code base tend to follow this rule.

We'd probably need you to sign a contributor agreement to accept these
changes, which I'll send to you off list - I don't think you've already
signed one.

Matthew

From matthias at rabbitmq.com  Wed Jun 22 11:32:40 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 22 Jun 2011 11:32:40 +0100
Subject: [rabbitmq-discuss] erl.exe crash
In-Reply-To: <17393167.1984.1308669610314.JavaMail.geo-discussion-forums@vbpv16>
References: <17393167.1984.1308669610314.JavaMail.geo-discussion-forums@vbpv16>
Message-ID: <4E01C4C8.3080005@rabbitmq.com>

On 21/06/11 16:20, bradrover wrote:
> Running on an older Win XP desktop. I
> installed everything fresh from the Windows bundle, including erlang.
> (2.5.0/R14B02). I then ran the Perf

What is "Perf"?

> I'm not even approaching any resource limits I can see in the
> management plug-in. Handles were at 46/1024, memory at 422M. This is
> concerning to me that any client could actually crash the server,
> regardless of OS installed on. We would run production on Linux, but
> that doesn't explain this issue.

Your test managed to crash the Erlang VM. That certainly shouldn't 
happen. However, the Erlang VM on Linux is quite different from the one 
on Windows and is much more battle hardened. I'd be amazed if your tests 
managed to crash it there. So please give that a try.

Also, if you can really reproducibly crash the Windows Erlang VM then 
please try the latest version of Erlang (R14B03 at present) and if it 
still crashes file a bug with the Erlang folks (erlang-bugs at erlang.org).

Regards,

Matthias

From matthias at rabbitmq.com  Wed Jun 22 11:37:31 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 22 Jun 2011 11:37:31 +0100
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
In-Reply-To: <20110622102503.GB2780@rabbitmq.com>
References: <mailman.555.1308639242.2898.rabbitmq-discuss@lists.rabbitmq.com>	<ABA42E48EC654326B9E2F059573DA9BE@gmail.com>
	<20110622102503.GB2780@rabbitmq.com>
Message-ID: <4E01C5EB.3070504@rabbitmq.com>

Chris,

On 22/06/11 11:25, Matthew Sackman wrote:
> On Tue, Jun 21, 2011 at 11:18:36AM -0400, Chris Madden wrote:
>> I upgraded our erlang version to R14B03, but the LATEST.LOG still
>> continues to be growing, albeit, more slowly perhaps?
>
> Curious.

Are you sure that you haven't perhaps got a growing list of queues? 
Check with 'rabbitmqctl list_queues'. Or, even better, use the fancy new 
'rabbitmqctl report' to produce a complete report of the server status 
and send that to us.

>> I'm kind of suspicious of one of the queue usage models I'm using.
>> When one of the processes needs to make a one-off request (rpc
>> like), it creates a queue dedicated to that request, and expects
>> the reply to come back on that queue.

Generally, "queue per request" is a design anti pattern. Though if your 
processes are short-lived and don't make many requests it's ok.


Matthias.

From videlalvaro at gmail.com  Wed Jun 22 12:05:20 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 22 Jun 2011 13:05:20 +0200
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <20110622103220.GD2780@rabbitmq.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
	<20110619193229.GA2535@rabbitmq.com>
	<92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>
	<20110619205630.GB2535@rabbitmq.com>
	<A4563130-D976-458A-AE5E-249A65F79BAE@gmail.com>
	<20110622103220.GD2780@rabbitmq.com>
Message-ID: <976DFE93-4ACF-407D-A5D1-76BE1429EF16@gmail.com>

Hi Matthew,

> Because the functionality is now completely non rabbit-specific, they
> should not really be in a module with a rabbit_ prefix. The more
> reusable parts of rabbit's code base tend to follow this rule.

What about the calls to: rabbit_misc:build_acyclic_graph/3 and rabbit_misc:all_module_attributes/1 ? Have you factored those out too?

> We'd probably need you to sign a contributor agreement to accept these
> changes, which I'll send to you off list - I don't think you've already
> signed one.

I signed one once, when I contributed back some PHP examples for http://www.rabbitmq.com/getstarted.html

Cheers,

Alvaro

From matthew at rabbitmq.com  Wed Jun 22 12:09:54 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Jun 2011 12:09:54 +0100
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <976DFE93-4ACF-407D-A5D1-76BE1429EF16@gmail.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
	<20110619193229.GA2535@rabbitmq.com>
	<92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>
	<20110619205630.GB2535@rabbitmq.com>
	<A4563130-D976-458A-AE5E-249A65F79BAE@gmail.com>
	<20110622103220.GD2780@rabbitmq.com>
	<976DFE93-4ACF-407D-A5D1-76BE1429EF16@gmail.com>
Message-ID: <20110622110954.GE2780@rabbitmq.com>

On Wed, Jun 22, 2011 at 01:05:20PM +0200, Alvaro Videla wrote:
> > Because the functionality is now completely non rabbit-specific, they
> > should not really be in a module with a rabbit_ prefix. The more
> > reusable parts of rabbit's code base tend to follow this rule.
> 
> What about the calls to: rabbit_misc:build_acyclic_graph/3 and
> rabbit_misc:all_module_attributes/1 ? Have you factored those out too?

Ahh well if those aren't going to be pulled out then there's little
sense pulling out the boot steps. And we do use the acyclic graph stuff
elsewhere too, and it's non-sensical for the other call sites to expect
to find that functionality in a module concerning boot.

> > We'd probably need you to sign a contributor agreement to accept these
> > changes, which I'll send to you off list - I don't think you've already
> > signed one.
> 
> I signed one once, when I contributed back some PHP examples for http://www.rabbitmq.com/getstarted.html

Ahh ok, thanks. I had a look but couldn't find it. I'm sure it must be
somewhere around.

Matthew

From videlalvaro at gmail.com  Wed Jun 22 12:21:57 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 22 Jun 2011 13:21:57 +0200
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <20110622110954.GE2780@rabbitmq.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
	<20110619193229.GA2535@rabbitmq.com>
	<92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>
	<20110619205630.GB2535@rabbitmq.com>
	<A4563130-D976-458A-AE5E-249A65F79BAE@gmail.com>
	<20110622103220.GD2780@rabbitmq.com>
	<976DFE93-4ACF-407D-A5D1-76BE1429EF16@gmail.com>
	<20110622110954.GE2780@rabbitmq.com>
Message-ID: <79C15914-3F72-4517-83A6-96437CD13BA2@gmail.com>

Hi,

> Ahh well if those aren't going to be pulled out then there's little
> sense pulling out the boot steps. And we do use the acyclic graph stuff
> elsewhere too, and it's non-sensical for the other call sites to expect
> to find that functionality in a module concerning boot.

I agree with that. I think a boot module should only be concerned about what its module name says, but since I didn't know what was the right solution for the acyclic graph thing I left it there.

As I said before, I think the boot idea is pretty useful so it might be worth the effort of moving those two functions out of rabbit_misc to some other place. But again I don't know what to call that "such other place" module that also fits well with rabbit's current source structure.

I know that projects like Riak are using the gen_server2.erl even with the old LShift copyright?

Cheers,

Alvaro

From matthew at rabbitmq.com  Wed Jun 22 12:36:42 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 22 Jun 2011 12:36:42 +0100
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <79C15914-3F72-4517-83A6-96437CD13BA2@gmail.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
	<20110619193229.GA2535@rabbitmq.com>
	<92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>
	<20110619205630.GB2535@rabbitmq.com>
	<A4563130-D976-458A-AE5E-249A65F79BAE@gmail.com>
	<20110622103220.GD2780@rabbitmq.com>
	<976DFE93-4ACF-407D-A5D1-76BE1429EF16@gmail.com>
	<20110622110954.GE2780@rabbitmq.com>
	<79C15914-3F72-4517-83A6-96437CD13BA2@gmail.com>
Message-ID: <20110622113642.GF2780@rabbitmq.com>

On Wed, Jun 22, 2011 at 01:21:57PM +0200, Alvaro Videla wrote:
> I know that projects like Riak are using the gen_server2.erl even with the old LShift copyright?

Yeah, they shouldn't, and I've told them in the past that they're using
old and buggy versions... However, if it works for them; open-source and
all that stuff.

Matthew

From videlalvaro at gmail.com  Wed Jun 22 12:56:23 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 22 Jun 2011 13:56:23 +0200
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <20110622113642.GF2780@rabbitmq.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
	<20110619193229.GA2535@rabbitmq.com>
	<92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>
	<20110619205630.GB2535@rabbitmq.com>
	<A4563130-D976-458A-AE5E-249A65F79BAE@gmail.com>
	<20110622103220.GD2780@rabbitmq.com>
	<976DFE93-4ACF-407D-A5D1-76BE1429EF16@gmail.com>
	<20110622110954.GE2780@rabbitmq.com>
	<79C15914-3F72-4517-83A6-96437CD13BA2@gmail.com>
	<20110622113642.GF2780@rabbitmq.com>
Message-ID: <EFE1912B-BF7A-467D-8D94-1F74AD9030F3@gmail.com>

Hi,

So all_module_attributes/1 and module_attributes/1 can be extracted of rabbit_misc without problems.

Then build_acyclic_graph/3 doesn't depends on other rabbit modules but its spec does depends on rabbit_types:ok_or_error2 which is trivial to change for it's own independent spec.

If you want I can try to extract those and submit a new patch with all the changes.

-Alvaro

From dhinesh.ravi at gmail.com  Wed Jun 22 13:00:52 2011
From: dhinesh.ravi at gmail.com (Dhinesh Kumar)
Date: Wed, 22 Jun 2011 17:30:52 +0530
Subject: [rabbitmq-discuss] RabbitMQ broker behind an ELB
Message-ID: <BANLkTikf+=iJOoaFkqaKudnc4bCs2JP0JQ@mail.gmail.com>

Hi,

I am trying to run a RabbitMQ broker behind an ELB.
The amqp connection gets established but it is getting closed after
sometime.

with this kind of message:

=ERROR REPORT==== 22-Jun-2011::11:27:59 ===
** Generic server <0.149.0> terminating
** Last message in was socket_closed
** When Server state == {state,amqp_network_connection,

{state,#Port<0.651>,0,<0.153.0>,131072,undefined,
                                false},
                            <0.148.0>,<0.151.0>,
                            {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,
                                "*BrokerHostname*",

                                5672,nonode at nohost,0,0,0,none,
                                [#Fun<amqp_auth_mechanisms.plain.3>,
                                 #Fun<amqp_auth_mechanisms.amqplain.3>],
                                none,[]},
                            0,
                            [{<<"capabilities">>,table,
                              [{<<"publisher_confirms">>,bool,true},
                               {<<"exchange_exchange_bindings">>,bool,true},
                               {<<"basic.nack">>,bool,true},
                               {<<"consumer_cancel_notify">>,bool,true}]},
                             {<<"copyright">>,longstr,
                              <<"Copyright (C) 2007-2011 VMware, Inc.">>},
                             {<<"information">>,longstr,
                              <<"Licensed under the MPL.  See
http://www.rabbitmq.com/">>},
                             {<<"platform">>,longstr,<<"Erlang/OTP">>},
                             {<<"product">>,longstr,<<"RabbitMQ">>},
                             {<<"version">>,longstr,<<"2.4.1">>}],
                            #Fun<amqp_connection_sup.0.110528238>,
                            #Fun<amqp_connection_sup.2.116782220>,false}
** Reason for termination ==
** socket_closed_unexpectedly


If i do the same without ELB, the connection is stable.
Is there any setting which i am missing?

Thanks in advance,
Dhinesh Kumar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110622/ff4a1330/attachment-0001.htm>

From gurpreet.1629 at gmail.com  Wed Jun 22 13:18:51 2011
From: gurpreet.1629 at gmail.com (gurpreet_09)
Date: Wed, 22 Jun 2011 05:18:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Lose messages between restarts of broker
In-Reply-To: <5D226D9E05A7E342B774D1881408C3EB013CB97ED4@34093-MBX-C15.mex07a.mlsrvr.com>
References: <AANLkTi=HnKQgcTJ=nNQw3Kj66pbBp5XY5Br9_Dz8637o@mail.gmail.com>
	<20101027222357.GC18601@wellquite.org>
	<5D226D9E05A7E342B774D1881408C3EB013B4B5B56@34093-MBX-C15.mex07a.mlsrvr.com>
	<4CCEC5CD.4020701@rabbitmq.com>
	<5D226D9E05A7E342B774D1881408C3EB013CB97ED4@34093-MBX-C15.mex07a.mlsrvr.com>
Message-ID: <31902724.post@talk.nabble.com>


Using "tx" the performance is reduced much, use of "setConfirmListener" is a
lot better option than that. See http://www.rabbitmq.com/blog/2011/02/ for
more details..
-- 
View this message in context: http://old.nabble.com/Lose-messages-between-restarts-of-broker-tp30071809p31902724.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From chris.madden at gmail.com  Wed Jun 22 15:11:40 2011
From: chris.madden at gmail.com (Chris Madden)
Date: Wed, 22 Jun 2011 10:11:40 -0400
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
In-Reply-To: <4E01C5EB.3070504@rabbitmq.com>
References: <mailman.555.1308639242.2898.rabbitmq-discuss@lists.rabbitmq.com>
	<ABA42E48EC654326B9E2F059573DA9BE@gmail.com>
	<20110622102503.GB2780@rabbitmq.com> <4E01C5EB.3070504@rabbitmq.com>
Message-ID: <8B318EED9EB440B4A988304A651FB99C@gmail.com>

Yeah, my queue list seems to be stable. Below I've attached my rabbitmqctl report output (which I had to change some names in, but should be the complete except for that).

As for queue-per-request, it is on the agenda to get rid of... just need some more time.

Currently, the ram node has been up for about 18 hours, LATEST.LOG is currently north of 45 megabytes

Here is the rabbitmqctl report:

Reporting server status on {{2011,6,22},{13,42,19}}
Status of node rabbit at controller ...
[{pid,1830},
{running_applications,[{rabbit,"RabbitMQ","2.5.0"},
{os_mon,"CPO CXC 138 46","2.2.6"},
{sasl,"SASL CXC 138 11","2.1.9.4"},
{mnesia,"MNESIA CXC 138 12","4.4.19"},
{stdlib,"ERTS CXC 138 10","1.17.4"},
{kernel,"ERTS CXC 138 10","2.14.4"}]},
{os,{unix,linux}},
{erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
{memory,[{total,71146096},
{processes,25544656},
{processes_used,25505984},
{system,45601440},
{atom,1416329},
{atom_used,1393242},
{binary,6167824},
{code,10984170},
{ets,25034304}]}]
Cluster status of node rabbit at controller ...
[{nodes,[{disc,[rabbit at controller]},{ram,[rabbit at drone]}]},
{running_nodes,[rabbit at drone,rabbit at controller]}]
Application environment of node rabbit at controller ...
[{auth_backends,[rabbit_auth_backend_internal]},
{auth_mechanisms,['PLAIN','AMQPLAIN']},
{backing_queue_module,rabbit_variable_queue},
{cluster_nodes,[]},
{collect_statistics,none},
{default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
{default_user,<<"guest">>},
{default_user_is_admin,true},
{default_vhost,<<"/">>},
{delegate_count,16},
{frame_max,131072},
{included_applications,[]},
{msg_store_file_size_limit,16777216},
{msg_store_index_module,rabbit_msg_store_ets_index},
{persister_hibernate_after,10000},
{persister_max_wrap_entries,500},
{queue_index_max_journal_entries,262144},
{server_properties,[]},
{ssl_listeners,[]},
{ssl_options,[]},
{tcp_listen_options,[binary,
{packet,raw},
{reuseaddr,true},
{backlog,128},
{nodelay,true},
{exit_on_close,false}]},
{tcp_listeners,[5672]},
{trace_vhosts,[]},
{vm_memory_high_watermark,0.08}]
Status of node rabbit at drone ...
[{pid,1816},
{running_applications,[{rabbit,"RabbitMQ","2.5.0"},
{os_mon,"CPO CXC 138 46","2.2.6"},
{sasl,"SASL CXC 138 11","2.1.9.4"},
{mnesia,"MNESIA CXC 138 12","4.4.19"},
{stdlib,"ERTS CXC 138 10","1.17.4"},
{kernel,"ERTS CXC 138 10","2.14.4"}]},
{os,{unix,linux}},
{erlang_version,"Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [hipe] [kernel-poll:true]\n"},
{memory,[{total,30815144},
{processes,11450224},
{processes_used,11427656},
{system,19364920},
{atom,1334153},
{atom_used,1326101},
{binary,3202208},
{code,10984170},
{ets,1866904}]}]
Cluster status of node rabbit at drone ...
[{nodes,[{disc,[rabbit at controller]},{ram,[rabbit at drone]}]},
{running_nodes,[rabbit at controller,rabbit at drone]}]
Application environment of node rabbit at drone ...
[{auth_backends,[rabbit_auth_backend_internal]},
{auth_mechanisms,['PLAIN','AMQPLAIN']},
{backing_queue_module,rabbit_variable_queue},
{cluster_nodes,[]},
{collect_statistics,none},
{default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
{default_user,<<"guest">>},
{default_user_is_admin,true},
{default_vhost,<<"/">>},
{delegate_count,16},
{frame_max,131072},
{included_applications,[]},
{msg_store_file_size_limit,16777216},
{msg_store_index_module,rabbit_msg_store_ets_index},
{persister_hibernate_after,10000},
{persister_max_wrap_entries,500},
{queue_index_max_journal_entries,262144},
{server_properties,[]},
{ssl_listeners,[]},
{ssl_options,[]},
{tcp_listen_options,[binary,
{packet,raw},
{reuseaddr,true},
{backlog,128},
{nodelay,true},
{exit_on_close,false}]},
{tcp_listeners,[5672]},
{trace_vhosts,[]},
{vm_memory_high_watermark,0.14}]
Connections:
pid address port peer_address peer_port ssl peer_cert_subject peer_cert_issuer peer_cert_validity auth_mechanism ssl_protocol ssl_key_exchange ssl_cipher ssl_hash protocol user vhost timeout frame_max client_properties recv_oct recv_cnt send_oct send_cnt send_pend state channels
<rabbit at controller.2.1597.6> 127.0.0.1 5672 127.0.0.1 37268 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 679040714 480320 384 4 0 running 1
<rabbit at controller.2.968.6> 127.0.0.1 5672 127.0.0.1 34908 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 93883820 402448 73175294 384910 0 running 0
<rabbit at controller.2.937.6> 127.0.0.1 5672 127.0.0.1 34904 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 105280 452 384 4 0 running 1
<rabbit at controller.2.1416.6> 127.0.0.1 5672 127.0.0.1 37264 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 388 4 384 4 0 running 1
<rabbit at controller.2.1137.6> 127.0.0.1 5672 127.0.0.1 37254 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 74069739 158463 83606920 134436 0 running 1
<rabbit at controller.2.1369.6> 127.0.0.1 5672 127.0.0.1 37261 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 6095432 33922 9124252 36203 0 running 0
<rabbit at controller.2.13952.0> 127.0.0.1 5672 127.0.0.1 58419 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"platform","Java"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"copyright","Copyright (C) 2007-2008 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd."},{"version","2.2.0"}] 3939165 21115 14575925 19596 0 running 0
<rabbit at controller.2.1075.6> 127.0.0.1 5672 127.0.0.1 34918 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 388 5 384 4 0 running 1
<rabbit at controller.2.4001.6> 127.0.0.1 5672 127.0.0.1 38002 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 437 5 1432152649 24684 0 running 1
<rabbit at controller.2.941.6> 127.0.0.1 5672 127.0.0.1 34905 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 643 5 384 4 0 running 1
<rabbit at controller.2.1420.6> 127.0.0.1 5672 127.0.0.1 37265 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 432 6 430 5 0 running 1
<rabbit at controller.2.1295.6> 127.0.0.1 5672 127.0.0.1 37260 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 245539007 801610 2465991959 754123 0 running 0
<rabbit at controller.2.1144.6> 127.0.0.1 5672 127.0.0.1 37255 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 8132196 13220 4287324 10869 0 running 1
<rabbit at controller.2.1082.6> 127.0.0.1 5672 127.0.0.1 34919 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 435 6 430 5 0 running 1
<rabbit at controller.2.1050.6> 127.0.0.1 5672 127.0.0.1 34915 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 30929757 23307 384 4 0 running 1
<rabbit at controller.2.980.6> 127.0.0.1 5672 127.0.0.1 34909 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 1426635583 988608 4662902 10098 0 running 1
<rabbit at controller.2.1395.6> 127.0.0.1 5672 127.0.0.1 37262 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 12306728 57153 10270868 54363 0 running 0
<rabbit at controller.2.933.6> 127.0.0.1 5672 127.0.0.1 34903 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 927 10 400 5 0 running 2
<rabbit at controller.2.5492.6> 127.0.0.1 5672 127.0.0.1 38182 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 1542496 8532 1624362 9033 0 running 0
<rabbit at controller.2.998.6> 127.0.0.1 5672 127.0.0.1 34910 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 901791 3488 384 4 0 running 1
<rabbit at controller.2.1054.6> 127.0.0.1 5672 127.0.0.1 34916 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 440 6 2086512417 35278 0 running 1
<rabbit at drone.3.396.0> 127.0.0.1 5672 127.0.0.1 21308 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 7589272 39572 1714718956 56320 0 running 0
<rabbit at drone.3.532.0> 127.0.0.1 5672 127.0.0.1 21314 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 388 4 384 4 0 running 1
<rabbit at drone.3.550.0> 127.0.0.1 5672 127.0.0.1 21317 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 1684538810 1169551 384 4 0 running 1
<rabbit at drone.3.336.0> 127.0.0.1 5672 127.0.0.1 21302 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 690 7 384 4 0 running 1
<rabbit at drone.3.554.0> 127.0.0.1 5672 127.0.0.1 21318 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 437 5 335809059 8567 0 running 1
<rabbit at drone.3.388.0> 127.0.0.1 5672 127.0.0.1 21307 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 1554367 6720 2466953 6422 0 running 0
<rabbit at drone.3.324.0> 127.0.0.1 5672 127.0.0.1 21299 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 3161712253 2411550 253176665 268551 0 running 1
<rabbit at drone.3.328.0> 127.0.0.1 5672 127.0.0.1 21300 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 53151 195 384 4 0 running 1
<rabbit at drone.3.528.0> 127.0.0.1 5672 127.0.0.1 21313 false PLAIN {0,9,1} u / 0 131072 [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2011 VMware, Inc."},{"version","2.5.0"}] 432 5 430 5 0 running 1
Channels:
pid connection number user vhost transactional confirm consumer_count messages_unacknowledged messages_unconfirmed acks_uncommitted prefetch_count client_flow_blocked
<rabbit at drone.3.340.0> <rabbit at drone.3.324.0> 1 u / false false 1 0 0 0 0 false
<rabbit at drone.3.342.0> <rabbit at drone.3.328.0> 1 u / false false 0 0 0 0 0 false
<rabbit at drone.3.348.0> <rabbit at drone.3.336.0> 1 u / false false 0 0 0 0 0 false
<rabbit at drone.3.535.0> <rabbit at drone.3.528.0> 1 u / false false 1 0 0 0 0 false
<rabbit at drone.3.542.0> <rabbit at drone.3.532.0> 1 u / false false 0 0 0 0 0 false
<rabbit at drone.3.557.0> <rabbit at drone.3.550.0> 1 u / false false 0 0 0 0 0 false
<rabbit at drone.3.560.0> <rabbit at drone.3.554.0> 1 u / false false 1 0 0 0 0 false
Queues on /:
pid name durable auto_delete arguments owner_pid exclusive_consumer_pid exclusive_consumer_tag messages_ready messages_unacknowledged messages consumers memory backing_queue_status
<rabbit at controller.2.665.0> broadcaster1.module1 false false [{"x-message-ttl",3600000}] 0 0 0 1 68192 [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,50}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at controller.2.1145.6> controllerServiceQueue false false [] 0 0 0 1 34744 [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at controller.2.1149.6> exchange2ServiceQueue false false [] 0 0 0 1 68192 [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at drone.3.349.0> exchange1ServiceQueue false false [] 0 0 0 1 21968 [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at controller.2.639.0> broadcaster2.module1 false false [{"x-message-ttl",3600000}] 0 0 0 1 21968 [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at controller.2.664.0> broadcaster1.module3 false false [{"x-message-ttl",3600000}] 0 0 0 1 68192 [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,27}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at controller.2.666.0> broadcaster1.module2 false false [{"x-message-ttl",3600000}] 0 0 0 1 29944 [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at controller.2.984.6> exchange3ServiceQueue false false [] 0 0 0 1 21968 [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at controller.2.640.0> broadcaster2.module3 false false [{"x-message-ttl",3600000}] 0 0 0 1 21968 [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at controller.2.641.0> broadcaster2.module2 false false [{"x-message-ttl",3600000}] 0 0 0 1 22048 [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {outstanding_txns,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {ram_index_count,0}, {next_seq_id,0}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
Exchanges on /:
name type durable auto_delete internal arguments
amq.direct direct true false false []
amq.topic topic true false false []
appController topic false true false []
broadcaster1 topic false false false []
amq.rabbitmq.trace topic true false false []
exchange1 topic false true false []
amq.rabbitmq.log topic true false false []
amq.fanout fanout true false false []
amq.headers headers true false false []
exchange2 topic false true false []
direct true false false []
amq.match headers true false false []
exchange3 topic false true false []
broadcaster2 topic false false false []
Bindings on /:
source_name source_kind destination_name destination_kind routing_key arguments
exchange exchange3ServiceQueue queue exchange3ServiceQueue []
exchange exchange2ServiceQueue queue exchange2ServiceQueue []
exchange controllerServiceQueue queue controllerServiceQueue []
exchange exchange1ServiceQueue queue exchange1ServiceQueue []
exchange broadcaster1.module1 queue broadcaster1.module1 []
exchange broadcaster1.module2 queue broadcaster1.module2 []
exchange broadcaster1.module3 queue broadcaster1.module3 []
exchange broadcaster2.module1 queue broadcaster2.module1 []
exchange broadcaster2.module2 queue broadcaster2.module2 []
exchange broadcaster2.module3 queue broadcaster2.module3 []
appController exchange controllerServiceQueue queue controller.request []
exchange2 exchange exchange2ServiceQueue queue exchange2.request []
exchange1 exchange exchange1ServiceQueue queue exchange1.request []
broadcaster1 exchange broadcaster1.module1 queue values.basedata []
broadcaster1 exchange broadcaster1.module3 queue values.basedata []
broadcaster1 exchange broadcaster1.module1 queue values.calculated_flush []
broadcaster1 exchange broadcaster1.module2 queue values.calculated_flush []
broadcaster1 exchange broadcaster1.module1 queue values.calculated_intermediate []
broadcaster1 exchange broadcaster1.module2 queue values.pending_flush []
broadcaster1 exchange broadcaster1.module3 queue values.pending_flush []
broadcaster1 exchange broadcaster1.module3 queue values.pending_intermediate []
broadcaster2 exchange broadcaster2.module2 queue system.options []
broadcaster2 exchange broadcaster2.module3 queue system.options []
exchange3 exchange exchange3ServiceQueue queue module3.request []
Consumers on /:
queue_name channel_pid consumer_tag ack_required
broadcaster1.module1 <rabbit at controller.2.4004.6> amq.ctag-PVN5XyJ4QPorqqyE/5HnBA== false
controllerServiceQueue <rabbit at controller.2.1140.6> amq.ctag-XxBFNOFkhrDcPbtptZ7Nvw== false
exchange2ServiceQueue <rabbit at controller.2.1148.6> amq.ctag-dqh1qbfXhYypDRv8X67CCQ== false
exchange1ServiceQueue <rabbit at drone.3.340.0> amq.ctag-3ZofayOMYay35WDNCKrH9A== false
broadcaster2.module1 <rabbit at controller.2.1423.6> amq.ctag-TIPAseQ+E8s/rW11C4WJ6Q== false
broadcaster1.module3 <rabbit at controller.2.1060.6> amq.ctag-ASACcGoydZ+UfZhdYE8IQA== false
broadcaster1.module2 <rabbit at drone.3.560.0> amq.ctag-VGPw77M0WptkPvwBO519kQ== false
exchange3ServiceQueue <rabbit at controller.2.983.6> amq.ctag-t3pbYjoIx4fjZ/ep8KFkyA== false
broadcaster2.module3 <rabbit at controller.2.1085.6> amq.ctag-kIkZatK5xzXpcy8M2FL0nw== false
broadcaster2.module2 <rabbit at drone.3.535.0> amq.ctag-6bcgsQVrQGK/hP9kIMbaBw== false
Permissions on /:
user configure write read
u .* .* .*
End of server status report
...done.

-- 
Chris Madden

On Wednesday, June 22, 2011 at 6:37 AM, Matthias Radestock wrote:

> Chris,
> 
> On 22/06/11 11:25, Matthew Sackman wrote:
> > On Tue, Jun 21, 2011 at 11:18:36AM -0400, Chris Madden wrote:
> > > I upgraded our erlang version to R14B03, but the LATEST.LOG still
> > > continues to be growing, albeit, more slowly perhaps?
> > 
> > Curious.
> 
> Are you sure that you haven't perhaps got a growing list of queues? 
> Check with 'rabbitmqctl list_queues'. Or, even better, use the fancy new 
> 'rabbitmqctl report' to produce a complete report of the server status 
> and send that to us.
> 
> > > I'm kind of suspicious of one of the queue usage models I'm using.
> > > When one of the processes needs to make a one-off request (rpc
> > > like), it creates a queue dedicated to that request, and expects
> > > the reply to come back on that queue.
> 
> Generally, "queue per request" is a design anti pattern. Though if your 
> processes are short-lived and don't make many requests it's ok.
> 
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From chris.madden at gmail.com  Wed Jun 22 15:14:43 2011
From: chris.madden at gmail.com (Chris Madden)
Date: Wed, 22 Jun 2011 10:14:43 -0400
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
In-Reply-To: <20110622102503.GB2780@rabbitmq.com>
References: <mailman.555.1308639242.2898.rabbitmq-discuss@lists.rabbitmq.com>
	<ABA42E48EC654326B9E2F059573DA9BE@gmail.com>
	<20110622102503.GB2780@rabbitmq.com>
Message-ID: <BANLkTin8F4sFVQC7Z=dGP5SJB6rpNfZvmw@mail.gmail.com>

On Wed, Jun 22, 2011 at 6:25 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi Chris,
>
> On Tue, Jun 21, 2011 at 11:18:36AM -0400, Chris Madden wrote:
> >  I upgraded our erlang version to R14B03, but the LATEST.LOG still
> continues to be growing, albeit, more slowly perhaps?
>
> Curious.
>
> > I'm kind of suspicious of one of the queue usage models I'm using. When
> one of the processes needs to make a one-off request (rpc like), it creates
> a queue dedicated to that request, and expects the reply to come back on
> that queue. After a timeout or the response is delivered, the queue is taken
> down. As a result, we have queues come and go a few times a minute... not
> really ideal, but it helps with debugging. Beyond this, I think the rabbit
> setup is pretty standard. Any ideas?
>
> How is the timeout done? Are you using our queue expiry timeout
> extension or some other mechanism? This might require some mnesia
> tuning, but I'm amazed if it does and you're the first person to run
> into this - it's such a common scenario I'm sure we'd have heard about
> it earlier.


I use the rabbit max message lifetime option on some queues, but in general,
the timeout is in the application layer, where if a response isn't received
in a certain amount of time, the application assumes it is lost
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110622/2296059e/attachment.htm>

From brking at gmail.com  Wed Jun 22 15:51:42 2011
From: brking at gmail.com (bradrover)
Date: Wed, 22 Jun 2011 07:51:42 -0700 (PDT)
Subject: [rabbitmq-discuss] erl.exe crash
In-Reply-To: <4E01C4C8.3080005@rabbitmq.com>
References: <17393167.1984.1308669610314.JavaMail.geo-discussion-forums@vbpv16>
	<4E01C4C8.3080005@rabbitmq.com>
Message-ID: <4807077f-02aa-42a7-bb81-07b359284f8e@q1g2000vbj.googlegroups.com>

> What is "Perf"?

Sorry. like the original poster on this topic, I'm usinng the .Net
client example: RabbitMQ.Client.Examples.PerfTest.

Thanks for the insight on the erlang vm. I'll try the upgrade.


On Jun 22, 6:32?am, Matthias Radestock <matth... at rabbitmq.com> wrote:
> On 21/06/11 16:20, bradrover wrote:
>
> > Running on an older Win XP desktop. I
> > installed everything fresh from the Windows bundle, including erlang.
> > (2.5.0/R14B02). I then ran the Perf
>
> What is "Perf"?
>
> > I'm not even approaching any resource limits I can see in the
> > management plug-in. Handles were at 46/1024, memory at 422M. This is
> > concerning to me that any client could actually crash the server,
> > regardless of OS installed on. We would run production on Linux, but
> > that doesn't explain this issue.
>
> Your test managed to crash the Erlang VM. That certainly shouldn't
> happen. However, the Erlang VM on Linux is quite different from the one
> on Windows and is much more battle hardened. I'd be amazed if your tests
> managed to crash it there. So please give that a try.
>
> Also, if you can really reproducibly crash the Windows Erlang VM then
> please try the latest version of Erlang (R14B03 at present) and if it
> still crashes file a bug with the Erlang folks (erlang-b... at erlang.org).
>
> Regards,
>
> Matthias
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Wed Jun 22 17:10:55 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 22 Jun 2011 17:10:55 +0100
Subject: [rabbitmq-discuss] Federation plugin preview release
Message-ID: <4E02140F.8080807@rabbitmq.com>

The federation plugin is now merged; it'll be in the next release. But 
if you're curious, I've made a version available that's compatible with 
2.5.0. Read all about it here:

http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dbecker at cpicorp.com  Wed Jun 22 18:11:10 2011
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Wed, 22 Jun 2011 12:11:10 -0500
Subject: [rabbitmq-discuss] Federation plugin preview release
In-Reply-To: <4E02140F.8080807@rabbitmq.com>
References: <4E02140F.8080807@rabbitmq.com>
Message-ID: <4E02222E.4000100@cpicorp.com>

On 06/22/2011 11:10 AM, Simon MacMullen wrote:
> The federation plugin is now merged; it'll be in the next release. But 
> if you're curious, I've made a version available that's compatible with 
> 2.5.0. Read all about it here:
> 
> http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/
> 
> Cheers, Simon
> 

Looks very interesting. We're doing our own in-house federation using a
shovel-like agent to do hub-and-spoke routing for about 3000 spokes and
2 hubs. I've discussed it a bit with Alexis but this looks like it might
also be an option. I'm going to have to sit down and play with it/digest
how it works but I'll provide some feedback based on whether or not this
is feasible for our (probably unusual) scenario :)

Cheers,

Derek

-- 
----------------------------------------------------------------------
Derek Chen-Becker
Senior Network Engineer, Security Architect
CPI Corp, Inc.
1706 Washington Ave
St. Louis, MO 63103
Phone: 314-231-7711 x6455
Fax:   314-613-6724
dbecker at cpicorp.com
PGP Key available from public key servers
Fingerprint: E4C4 26C0 8588 E80A C29F  636D 1FBE 0FE3 2871 4AE8
----------------------------------------------------------------------

From pshomov at gmail.com  Wed Jun 22 22:41:30 2011
From: pshomov at gmail.com (Petar Shomov)
Date: Wed, 22 Jun 2011 21:41:30 +0000
Subject: [rabbitmq-discuss] queue subscription + sending to some exchange
In-Reply-To: <BANLkTimysGTVeeqG1yOHX9xOmi0JG63Q5A@mail.gmail.com>
References: <BANLkTinBYxFQKFLEJF8VMT2gpuASwKaDiw@mail.gmail.com>
	<BANLkTinGihLGRMLadn+QsC_s_m9thfSv4w@mail.gmail.com>
	<BANLkTinY87p-tibCVvKfd-MFA-V+eJJQ7g@mail.gmail.com>
	<4E006709.6030804@rabbitmq.com>
	<BANLkTim3aE=RpJF_PbyHOc2WDy9Tj=xDAw@mail.gmail.com>
	<88E590DC4586974D825FC82AE798294E52010DEE@GSVCLU03.ges.ferlan.it>
	<BANLkTimysGTVeeqG1yOHX9xOmi0JG63Q5A@mail.gmail.com>
Message-ID: <BANLkTin1yKDA9oy5BX43rvwnuP-WR+CYvw@mail.gmail.com>

forgot to CC the mailing list
---------------------------------
Regards,

Petar



On Wed, Jun 22, 2011 at 9:39 PM, Petar Shomov <pshomov at gmail.com> wrote:
> Hi Simone,
>
> I assumed (based on the .NET API) that the operations were
> synchronous. I will verify that assumption.
> Thanx for the tip on NUnit delayed polling! I did not know that.
> Although my helper does more then catching assertion exceptions (in my
> "full" version of the test) I will definitely check it out.
>
> ---------------------------------
> Regards,
>
> Petar
>
>
>
> On Wed, Jun 22, 2011 at 8:44 AM, Busoli, Simone
> <Simone.Busoli at ferrari.com> wrote:
>> Hi Petar,
>>
>> looking at the code I am under the impression that you may have a race condition between the subscription and the first publish, in that the second may try to publish to the exchange before the first declares it, although I believed the exchange declaration was a synchronous operation.
>>
>> Side note: instead of your assertion helpers, you can leverage NUnit's support for delayed (polling) assertions:
>>
>> Assert.That(() => done, Is.EqualTo(3).After(delay))
>>
>> NUnit will verify the assertion at intervals until delay has expired, at which point it will fail if the constraint is not satisfied yet.
>>
>> -----Original Message-----
>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Petar Shomov
>> Sent: Wednesday, June 22, 2011 3:20 AM
>> To: Emile Joubert
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] queue subscription + sending to some exchange
>>
>> Hi Emile,
>>
>> What a great suggestion: look into the log file ;). Indeed I looked and found the problem: the exchange I was posting to did not exist.
>> Somehow the first posting succeeded but on the second attempt did not go through or something like that.
>>
>> I am going to post the mini-example just in case since I prepared it anyways so it might be useful to someone. I find the error message in the rabbitmq server log very helpful but the one that I got in the client was very confusing - The AMQP operation was interrupted: AMQP close-reason, initiated by Library, code=504, text="Frame received for invalid channel 2", classId=0, methodId=0,
>> cause=RabbitMQ.Client.Impl.ChannelErrorException: Frame received for invalid channel 2
>>
>> Thank you and Simone for reaching out!
>>
>> ---------------------------------
>> Regards,
>>
>> Petar
>>
>>
>>
>> On Tue, Jun 21, 2011 at 9:40 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>>> Hi Petar,
>>>
>>> I assume that queueHandlers in your snippet establishes a new channel
>>> when the error occurs. Is it possible that queueHandlers is using the
>>> wrong channel by mistake? Can you supply a minimal self-contained
>>> example that illustrates the problem? Is there any additional
>>> information in the broker logfile at the time of the error?
>>>
>>>
>>> -Emile
>>>
>>>
>>> On 21/06/11 01:17, Petar Shomov wrote:
>>>> Hi Simone,
>>>>
>>>> Thanx for the suggestion! I have read that section about threading
>>>> many times but my understanding is that channels can be shared among
>>>> threads as long as they are not used concurrently. I am not doing
>>>> that and I even went ahead and created that channel in the thread
>>>> that is doing the consumption just to be on the safe side. No dice,
>>>> same error.
>>>>
>>>> What worries me in that section is this paragraph:
>>>>
>>>> "Application callback handlers must not invoke blocking AMQP
>>>> operations (such as IModel.QueueDeclare, IModel.BasicCancel or
>>>> IModel.BasicPublish). If they do, the channel will deadlock"
>>>>
>>>> Now, does that mean I should not be doing what I intended to be doing
>>>> (I use IModel.BasicPublish)? I find that hard to believe.
>>>> I am taking care to open a different channel for the publishing of my
>>>> messages but I wonder is that enough?
>>>> My channel did not deadlock just looks like things got mixed up ;(
>>>>
>>>> ---------------------------------
>>>> Regards,
>>>>
>>>> Petar
>>>>
>>>>
>>>>
>>>> On Mon, Jun 20, 2011 at 9:57 PM, Simone Busoli <simone.busoli at gmail.com> wrote:
>>>>> Hi Petar,
>>>>>
>>>>> I think you are violating one of the assumption that the C# client
>>>>> does on channel usage. Channels should not be shared among threads
>>>>> (read the pdf user guide for details), and it appears you are using
>>>>> the channel on a different thread than that where the channel was created.
>>>>>
>>>>> On Mon, Jun 20, 2011 at 23:41, Petar Shomov <pshomov at gmail.com> wrote:
>>>>>>
>>>>>> Hi guys,
>>>>>>
>>>>>> I have a situation which I do not completely understand and I was
>>>>>> hoping someone more acquainted with AMQP and RabbitMQ might point
>>>>>> me in the right direction.
>>>>>>
>>>>>> I have a console app that needs to subscribe to a message queue
>>>>>> where the process of handling a message is rather lengthy. During
>>>>>> this lengthy process I need to send out messages to some exchange
>>>>>> which represent information about the progress of the operation.
>>>>>> The subscription to the queue has to be asynchronous too, since I
>>>>>> am doing something else on the main thread. So I have running in a
>>>>>> thread this code (C#):
>>>>>>
>>>>>> ? ? ? ? ? ? ? ?var job = new Thread(() =>
>>>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {
>>>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? var consumer = new
>>>>>> QueueingBasicConsumer(channel);
>>>>>>
>>>>>> channel.BasicConsume(queueName, false, consumer);
>>>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? while (true)
>>>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? {
>>>>>>
>>>>>> BasicDeliverEventArgs e = null;
>>>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? e =
>>>>>> (BasicDeliverEventArgs) consumer.Queue.Dequeue();
>>>>>>
>>>>>> queueHandlers[queueName][e.Exchange](e);
>>>>>>
>>>>>> channel.BasicAck(e.DeliveryTag, false);
>>>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?}
>>>>>> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? }
>>>>>>
>>>>>> ?Unfortunately when I try to send messages within the message
>>>>>> handler (I am opening a different channel on the same connection,
>>>>>> tried even opening a different connection with no better luck) I am
>>>>>> getting these kind of exceptions, usually when attempting to send
>>>>>> the *second*
>>>>>> message:
>>>>>>
>>>>>> - ? ? ? ? ? ? ? $exception ? ? ?{"The AMQP operation was
>>>>>> interrupted: AMQP close-reason, initiated by Library, code=504,
>>>>>> text=\"Frame received for invalid channel 2\", classId=0,
>>>>>> methodId=0,
>>>>>> cause=RabbitMQ.Client.Impl.ChannelErrorException: Frame received
>>>>>> for invalid channel 2\r\n ? at ...
>>>>>>
>>>>>>
>>>>>> Thoughts, ideas, anything?
>>>
>>
>> _________________________________________________________________________________________________________________
>> Questo messaggio ? da intendersi esclusivamente ad uso del destinatario e pu? contenere informazioni che sono di natura privilegiata, confidenziale
>> o non divulgabile secondo le leggi vigenti. Se il lettore del presente messaggio non ? il destinatario designato, o il dipendente/agente responsabile
>> per la consegna del messaggio al destinatario designato, si informa che ogni disseminazione, distribuzione o copiatura di questa comunicazione ?
>> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
>> immediatamente a mezzo e-mail di risposta e successivamente di procedere alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
>> _________________________________________________________________________________________________________________
>> This message is intended only for the use of the addressee and may contain information that is privileged, confidential and exempt from
>> disclosure under applicable law. If the reader of this message is not the intended recipient, or the employee or agent responsible for delivering the
>> message to the intended recipient, you are hereby notified that any dissemination, distribution or copying of this communication is strictly
>> prohibited. If you have received this e-mail in error, please notify us immediately by return e-mail and delete this e-mail and all attachments from
>> your system.
>> _________________________________________________________________________________________________________________
>>
>>
>>
>

From pshomov at gmail.com  Wed Jun 22 22:43:02 2011
From: pshomov at gmail.com (Petar Shomov)
Date: Wed, 22 Jun 2011 21:43:02 +0000
Subject: [rabbitmq-discuss] queue subscription + sending to some exchange
In-Reply-To: <4E01B483.30601@rabbitmq.com>
References: <BANLkTinBYxFQKFLEJF8VMT2gpuASwKaDiw@mail.gmail.com>
	<BANLkTinGihLGRMLadn+QsC_s_m9thfSv4w@mail.gmail.com>
	<BANLkTinY87p-tibCVvKfd-MFA-V+eJJQ7g@mail.gmail.com>
	<4E006709.6030804@rabbitmq.com>
	<BANLkTim3aE=RpJF_PbyHOc2WDy9Tj=xDAw@mail.gmail.com>
	<4E01B483.30601@rabbitmq.com>
Message-ID: <BANLkTi=pe-jbFk=t8Ee8OTjGW7G6sDen9A@mail.gmail.com>

Hi Emile,

Thanx for the suggestion I will google "rabbitmq publisher confirm"
right away ;)

---------------------------------
Regards,

Petar



On Wed, Jun 22, 2011 at 9:23 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> Hi Petar,
>
> On 22/06/11 02:19, Petar Shomov wrote:
>> Hi Emile,
>>
>> What a great suggestion: look into the log file ;). Indeed I looked
>> and found the problem: the exchange I was posting to did not exist.
>> Somehow the first posting succeeded but on the second attempt did not
>> go through or something like that.
>
> I'm glad you found the problem. The first posting would not have
> succeeded, but since publishing is asynchronous, the problem manifests
> later from the client's perspective.
>
> You should consider using publisher confirms in tests that publish
> messages. That would have made this error apparent earlier and avoids
> racy time-outs.
>
>
>
> -Emile
>

From james.r.carr at gmail.com  Thu Jun 23 03:23:18 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 22 Jun 2011 22:23:18 -0400
Subject: [rabbitmq-discuss] rabbitmq-messagepatterns
In-Reply-To: <20110622102528.GC2780@rabbitmq.com>
References: <BANLkTimEtE+KSQDgGpj8iy9==n-w42Z+AA@mail.gmail.com>
	<20110622102528.GC2780@rabbitmq.com>
Message-ID: <BANLkTinivprMEY2ZP=9oNDxL-h51uqy1TQ@mail.gmail.com>

I figured as much. No big deal though, I added it to our company's
internal maven repo. I found a project on github that referenced it in
their pom and was just curious if they were using some super secret
maven repo. ;)

Thanks,
James


On Wed, Jun 22, 2011 at 6:25 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Mon, Jun 20, 2011 at 04:31:39PM -0500, James Carr wrote:
>> Is there a maven repository that I can find the rabbitmq-messagepatterns jar in?
>
> We've not done one. I doubt anyone else has.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From james.r.carr at gmail.com  Thu Jun 23 03:27:07 2011
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 22 Jun 2011 22:27:07 -0400
Subject: [rabbitmq-discuss] Single Point of Failure
Message-ID: <BANLkTikyw-dOYHd_9G7_Q6UE_TJ3Xdy+MA@mail.gmail.com>

Hi All,

Had a half day of architecture meetings where we discussed rabbitMQ as
an essential component to a new large scale project and one of the
attendees mentioned that they had used RabbitMQ at his previous job
awhile back. He said it worked great but one concern was that it had a
single point of failure and it couldn't be placed behind a load
balancer. He didn't know if that had changed but was just curious as
it was something that had concerned him.

However, he also added that they had been using it for a year by the
time he left and no problems had cropped up. :)

So has this changed any? Do clusters rely on a master node to be running?


Thanks,
James

From Alister.Morton at tradition.com  Thu Jun 23 09:54:05 2011
From: Alister.Morton at tradition.com (Alister Morton)
Date: Thu, 23 Jun 2011 09:54:05 +0100
Subject: [rabbitmq-discuss] Federation plugin preview release
In-Reply-To: <4E02140F.8080807@rabbitmq.com>
References: <4E02140F.8080807@rabbitmq.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E789106A98C1179DC@SVR-2K3-BH-EMC.tradition.int>

>>>
The federation plugin is now merged; it'll be in the next release. But
if you're curious, I've made a version available that's compatible with
2.5.0. Read all about it here:
<<<

That looks very interesting. I'm sure we'll be finding uses for it. Excellent work, thanks.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.

From sustrik at 250bpm.com  Thu Jun 23 10:03:49 2011
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Thu, 23 Jun 2011 11:03:49 +0200
Subject: [rabbitmq-discuss] Federation plugin preview release
In-Reply-To: <4E02140F.8080807@rabbitmq.com>
References: <4E02140F.8080807@rabbitmq.com>
Message-ID: <4E030175.3030009@250bpm.com>

On 06/22/2011 06:10 PM, Simon MacMullen wrote:
> The federation plugin is now merged; it'll be in the next release. But
> if you're curious, I've made a version available that's compatible with
> 2.5.0. Read all about it here:
>
> http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/

Nice! This is publish/subscribe federation rather than request/reply 
federation, right?

Martin

From mikeb at rabbitmq.com  Thu Jun 23 10:19:18 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 23 Jun 2011 10:19:18 +0100
Subject: [rabbitmq-discuss] Federation plugin preview release
In-Reply-To: <4E030175.3030009@250bpm.com>
References: <4E02140F.8080807@rabbitmq.com> <4E030175.3030009@250bpm.com>
Message-ID: <4E030516.9050304@rabbitmq.com>


>> http://www.rabbitmq.com/blog/2011/06/22/federation-plugin-preview-release/
>>
>
> Nice! This is publish/subscribe federation rather than request/reply
> federation, right?

Yes -- it's based on the OpenAMQ subscriber federation.

mkb

From sustrik at 250bpm.com  Thu Jun 23 11:58:13 2011
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Thu, 23 Jun 2011 12:58:13 +0200
Subject: [rabbitmq-discuss] Federation plugin preview release
In-Reply-To: <4E030516.9050304@rabbitmq.com>
References: <4E02140F.8080807@rabbitmq.com> <4E030175.3030009@250bpm.com>
	<4E030516.9050304@rabbitmq.com>
Message-ID: <4E031C45.9070202@250bpm.com>

On 06/23/2011 11:19 AM, Michael Bridgen wrote:

>> Nice! This is publish/subscribe federation rather than request/reply
>> federation, right?
>
> Yes -- it's based on the OpenAMQ subscriber federation.

I would be interesting to know a bit about how it works internally. 
Niether the blog nor the README file says much about that.

For comparison, I've written a similar document for 0MQ: 
http://www.250bpm.com/pubsub

 From what I see different products are gradually moving towards 
basically the same model (e.g. PubSubHubbub) which opens interesting 
possibilities for standardisation.

Martin

From simon at rabbitmq.com  Thu Jun 23 12:00:17 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 23 Jun 2011 12:00:17 +0100
Subject: [rabbitmq-discuss] Federation plugin preview release
In-Reply-To: <4E031C45.9070202@250bpm.com>
References: <4E02140F.8080807@rabbitmq.com>
	<4E030175.3030009@250bpm.com>	<4E030516.9050304@rabbitmq.com>
	<4E031C45.9070202@250bpm.com>
Message-ID: <4E031CC1.6040701@rabbitmq.com>

On 23/06/11 11:58, Martin Sustrik wrote:
> On 06/23/2011 11:19 AM, Michael Bridgen wrote:
>
>>> Nice! This is publish/subscribe federation rather than request/reply
>>> federation, right?
>>
>> Yes -- it's based on the OpenAMQ subscriber federation.
>
> I would be interesting to know a bit about how it works internally.
> Niether the blog nor the README file says much about that.

Does the README-hacking tell you anything useful?

http://hg.rabbitmq.com/rabbitmq-federation/file/default/README-hacking

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From sustrik at 250bpm.com  Thu Jun 23 12:06:43 2011
From: sustrik at 250bpm.com (Martin Sustrik)
Date: Thu, 23 Jun 2011 13:06:43 +0200
Subject: [rabbitmq-discuss] Federation plugin preview release
In-Reply-To: <4E031CC1.6040701@rabbitmq.com>
References: <4E02140F.8080807@rabbitmq.com>	<4E030175.3030009@250bpm.com>	<4E030516.9050304@rabbitmq.com>	<4E031C45.9070202@250bpm.com>
	<4E031CC1.6040701@rabbitmq.com>
Message-ID: <4E031E43.3040601@250bpm.com>

On 06/23/2011 01:00 PM, Simon MacMullen wrote:

> http://hg.rabbitmq.com/rabbitmq-federation/file/default/README-hacking

Yes. That's it. Thanks!

Martin

From alexis at rabbitmq.com  Thu Jun 23 12:11:51 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 23 Jun 2011 12:11:51 +0100
Subject: [rabbitmq-discuss] Single Point of Failure
In-Reply-To: <BANLkTikyw-dOYHd_9G7_Q6UE_TJ3Xdy+MA@mail.gmail.com>
References: <BANLkTikyw-dOYHd_9G7_Q6UE_TJ3Xdy+MA@mail.gmail.com>
Message-ID: <BANLkTinZWSQ1Vu+EupJruogv9JKumkdKPA@mail.gmail.com>

James

It's good to hear that your colleague had good experiences with RabbitMQ.

I'm confused by the statement "couldn't be placed behind a
load-balancer".  That's not the case for RabbitMQ which *can* be used
with a load balancer.  Here's Josh from the Nokia team talking about
their set-up: http://www.joshdevins.net/2010/04/16/rabbitmq-ha-testing-with-haproxy/

See also our HA page here: http://www.rabbitmq.com/pacemaker.html
This an 'active/passive' set-up.

I think that perhaps your colleague meant that RabbitMQ lacks an
'active/active' style HA set-up.  In this set-up there can be two
'live' copies of the broker state, so that if one fails, the other is
available immediately.  It is correct that RabbitMQ cannot do this
today, but we have a solution in the works which has been discussed on
this list recently.  If you can't find it in the archives let us know.

BTW, if you look at Josh's blog post above you can also click through
the the Beetle project from Xing.  This provides an active/active dual
redundant type set-up by running two brokers and sending all messages
to both.  It's an application layer solution, specific to Ruby and
using the consumers to de-dup.  One reason many people shy away from
such a set up is that you need to have a thorough understanding of
what can go wrong.  By contrast the new Rabbit HA will provide the
capability within the broker itself, which should make it easier to
manage and generally more predictable...

In the new HA there *will* be a concept of a master.  This is
described in the draft documentation which Matthew posted to this list
recently.

alexis



On Thu, Jun 23, 2011 at 3:27 AM, James Carr <james.r.carr at gmail.com> wrote:
> Hi All,
>
> Had a half day of architecture meetings where we discussed rabbitMQ as
> an essential component to a new large scale project and one of the
> attendees mentioned that they had used RabbitMQ at his previous job
> awhile back. He said it worked great but one concern was that it had a
> single point of failure and it couldn't be placed behind a load
> balancer. He didn't know if that had changed but was just curious as
> it was something that had concerned him.
>
> However, he also added that they had been using it for a year by the
> time he left and no problems had cropped up. :)
>
> So has this changed any? Do clusters rely on a master node to be running?
>
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alfonso.pantoja at gmail.com  Thu Jun 23 12:49:44 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 23 Jun 2011 04:49:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit 2.2 does not report connected consumers
Message-ID: <9a1eb85a-f323-40a6-be30-2bf3aa42b996@e17g2000prj.googlegroups.com>

Hi,

We are using RabbitMQ 2.2 and I've noticed that in some queues the
number of consumers is always reported as "0"
(these queues really have consumers attached to them because when
sending messages to them they are processed by the consumers)

This happens in the web management and also in the shell command.
The strange thing is that this behavior does not happen in all queues.

Any idea?

Thanks in advance.

Regards,

Alfonso

From maxence.cordier at gmail.com  Thu Jun 23 14:59:41 2011
From: maxence.cordier at gmail.com (Max C)
Date: Thu, 23 Jun 2011 06:59:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Exchange performance
In-Reply-To: <4DFB5A78.9030209@rabbitmq.com>
References: <95a152d1-af26-4879-8dee-0f2bea5ce303@h7g2000yqa.googlegroups.com>
	<BANLkTi=8cwOUZ7JYgodw2HNZ=2nN4MZLbA@mail.gmail.com>
	<4DFB42C2.6070001@rabbitmq.com>
	<46c90c7c-49cc-4cbd-8605-860749cb0da4@r2g2000vbj.googlegroups.com>
	<4DFB5A78.9030209@rabbitmq.com>
Message-ID: <21c1718b-8ee0-4b66-85b9-370f47674f24@e17g2000prj.googlegroups.com>

Yes sorry, the mistake was mine. My choice is not between either 100
direct exchanges or one headers exchange
but between 100 direct exchanges (1 per device) or 1 direct exchange
(with 1 tag per device), knowing that the number of bindings is not
very high.


Cheers, Max.

From pierre-marie.padiou at morpho.com  Thu Jun 23 15:16:29 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Thu, 23 Jun 2011 16:16:29 +0200
Subject: [rabbitmq-discuss] publish/suscribe model with typed consumers
In-Reply-To: <BANLkTim9to+B6KAB2q4dRz1iTcMzwbPkag@mail.gmail.com>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C509126B73A729@Y000IMRV01.rd1.rf1>
	<4DF1F963.7080603@rabbitmq.com>
	<BANLkTim9to+B6KAB2q4dRz1iTcMzwbPkag@mail.gmail.com>
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C50912704F2209@Y000IMRV01.rd1.rf1>

Thank you all for your answers.

I didn't know a single consumer could subscribe to multiple queues (like Matthias said) : it works perfectly and that's the best solution!

Pierre-Marie


From: David Young [mailto:d.young at cabinfeversoftware.com]
Sent: Friday, June 10, 2011 8:08 PM
To: PADIOU Pierre-Marie (MORPHO); rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] publish/suscribe model with typed consumers

The AMQP gem in ruby can also subscribe to multiple queues using a single thread.
On Fri, Jun 10, 2011 at 6:00 AM, Matthias Radestock <matthias at rabbitmq.com<mailto:matthias at rabbitmq.com>> wrote:
Pierre-Marie,


On 10/06/11 11:15, PADIOU Pierre-Marie (MORPHO) wrote:
For now, the only solution I see would be to create as many queues as requests
types (queueA, queueB, etc), and make consumer listen to the appropriate
queues.

Thing is:

- this implies that consumers create as many threads as queues there are
listening from (more than a hundred in my case), which I would like to
avoid.

Which client are you using? Java? If so, a single consumer thread can happily consume from multiple queues. E.g. you can pass a single QueuingConsumer instance to multiple ch.basicConsume(...) invocations.


Regards,

Matthias.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110623/d6b9cf92/attachment-0001.htm>

From cal.leeming at simplicitymedialtd.co.uk  Thu Jun 23 15:34:20 2011
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 23 Jun 2011 15:34:20 +0100
Subject: [rabbitmq-discuss] Removing "INFO REPORT" from logs (due to 30gb
	log file in 1 day)
Message-ID: <BANLkTinfoUtR3LMGEGLf8L7Mys_qsVMCgw@mail.gmail.com>

So my server died a horrible death when all the disk space was used due to
this:

 root at mysql01 [/var/log/rabbitmq] > ls -lah
total 38G
drwxr-xr-x  2 sshd ssh  4.0K Jun 19 07:25 .
drwxr-xr-x 10 root root 4.0K Jun 23 07:25 ..
-rw-r--r--  1 sshd ssh   38G Jun 23 01:45 rabbit at mysql01.log

 root at mysql01 [/var/log/rabbitmq] > head rabbit at mysql01.log -n 2

=INFO REPORT==== 19-Jun-2011::06:25:19 ===

So, is there any way to actually stop those "INFO REPORT" messages from
being logged, but keep the error logs? I saw the thing about patching the
start up scripts (but that disables all logging, including errors, and seems
terribly hacky :S)

Cal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110623/f152f789/attachment.htm>

From matthew at rabbitmq.com  Thu Jun 23 15:38:29 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 23 Jun 2011 15:38:29 +0100
Subject: [rabbitmq-discuss] Removing "INFO REPORT" from logs (due to
 30gb log file in 1 day)
In-Reply-To: <BANLkTinfoUtR3LMGEGLf8L7Mys_qsVMCgw@mail.gmail.com>
References: <BANLkTinfoUtR3LMGEGLf8L7Mys_qsVMCgw@mail.gmail.com>
Message-ID: <20110623143829.GC23435@rabbitmq.com>

On Thu, Jun 23, 2011 at 03:34:20PM +0100, Cal Leeming [Simplicity Media Ltd] wrote:
> So my server died a horrible death when all the disk space was used due to
> this:
> 
>  root at mysql01 [/var/log/rabbitmq] > ls -lah
> total 38G
> drwxr-xr-x  2 sshd ssh  4.0K Jun 19 07:25 .
> drwxr-xr-x 10 root root 4.0K Jun 23 07:25 ..
> -rw-r--r--  1 sshd ssh   38G Jun 23 01:45 rabbit at mysql01.log
> 
>  root at mysql01 [/var/log/rabbitmq] > head rabbit at mysql01.log -n 2
> 
> =INFO REPORT==== 19-Jun-2011::06:25:19 ===
> 
> So, is there any way to actually stop those "INFO REPORT" messages from
> being logged, but keep the error logs? I saw the thing about patching the
> start up scripts (but that disables all logging, including errors, and seems
> terribly hacky :S)

I'm afraid there's no solution to this atm merely by configuration. If
you're happy compiling from source then in rabbit_log.erl, you should
find some lines:

handle_cast({info, Fmt}, State) ->
    error_logger:info_msg(Fmt),
    {noreply, State};
handle_cast({info, Fmt, Args}, State) ->
    error_logger:info_msg(Fmt, Args),
    {noreply, State};


If you just entirely remove the error_logger:info_msg lines and
recompile then you'll lose info messages (you'll get warnings when
compiling about unused vars, but don't worry about that).

Matthew

From cal.leeming at simplicitymedialtd.co.uk  Thu Jun 23 15:40:59 2011
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 23 Jun 2011 15:40:59 +0100
Subject: [rabbitmq-discuss] Removing "INFO REPORT" from logs (due to
 30gb log file in 1 day)
In-Reply-To: <20110623143829.GC23435@rabbitmq.com>
References: <BANLkTinfoUtR3LMGEGLf8L7Mys_qsVMCgw@mail.gmail.com>
	<20110623143829.GC23435@rabbitmq.com>
Message-ID: <BANLkTi=mq0N0XuhEStE6UNNL-qc0hwjYwg@mail.gmail.com>

Hmm, are there any plans to make this easier for a user to change via the
config?? Almost every other daemon I know has support for this, so it makes
RabbitMQ terribly unfriendly :(

On Thu, Jun 23, 2011 at 3:38 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Jun 23, 2011 at 03:34:20PM +0100, Cal Leeming [Simplicity Media
> Ltd] wrote:
> > So my server died a horrible death when all the disk space was used due
> to
> > this:
> >
> >  root at mysql01 [/var/log/rabbitmq] > ls -lah
> > total 38G
> > drwxr-xr-x  2 sshd ssh  4.0K Jun 19 07:25 .
> > drwxr-xr-x 10 root root 4.0K Jun 23 07:25 ..
> > -rw-r--r--  1 sshd ssh   38G Jun 23 01:45 rabbit at mysql01.log
> >
> >  root at mysql01 [/var/log/rabbitmq] > head rabbit at mysql01.log -n 2
> >
> > =INFO REPORT==== 19-Jun-2011::06:25:19 ===
> >
> > So, is there any way to actually stop those "INFO REPORT" messages from
> > being logged, but keep the error logs? I saw the thing about patching the
> > start up scripts (but that disables all logging, including errors, and
> seems
> > terribly hacky :S)
>
> I'm afraid there's no solution to this atm merely by configuration. If
> you're happy compiling from source then in rabbit_log.erl, you should
> find some lines:
>
> handle_cast({info, Fmt}, State) ->
>    error_logger:info_msg(Fmt),
>    {noreply, State};
> handle_cast({info, Fmt, Args}, State) ->
>    error_logger:info_msg(Fmt, Args),
>    {noreply, State};
>
>
> If you just entirely remove the error_logger:info_msg lines and
> recompile then you'll lose info messages (you'll get warnings when
> compiling about unused vars, but don't worry about that).
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110623/222042e0/attachment.htm>

From matthew at rabbitmq.com  Thu Jun 23 15:43:34 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 23 Jun 2011 15:43:34 +0100
Subject: [rabbitmq-discuss] Removing "INFO REPORT" from logs (due to
 30gb log file in 1 day)
In-Reply-To: <BANLkTi=mq0N0XuhEStE6UNNL-qc0hwjYwg@mail.gmail.com>
References: <BANLkTinfoUtR3LMGEGLf8L7Mys_qsVMCgw@mail.gmail.com>
	<20110623143829.GC23435@rabbitmq.com>
	<BANLkTi=mq0N0XuhEStE6UNNL-qc0hwjYwg@mail.gmail.com>
Message-ID: <20110623144334.GD23435@rabbitmq.com>

On Thu, Jun 23, 2011 at 03:40:59PM +0100, Cal Leeming [Simplicity Media Ltd] wrote:
> Hmm, are there any plans to make this easier for a user to change via the
> config?? Almost every other daemon I know has support for this, so it makes
> RabbitMQ terribly unfriendly :(

Yes, we have been thinking about this on and off for quite some time.
I'm not sure what the current plans are wrt this, but you're not the
first person to point out this problem, and we do have a bug open to
look at sorting this out.

Matthew

From cal.leeming at simplicitymedialtd.co.uk  Thu Jun 23 15:47:08 2011
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 23 Jun 2011 15:47:08 +0100
Subject: [rabbitmq-discuss] Removing "INFO REPORT" from logs (due to
 30gb log file in 1 day)
In-Reply-To: <20110623144334.GD23435@rabbitmq.com>
References: <BANLkTinfoUtR3LMGEGLf8L7Mys_qsVMCgw@mail.gmail.com>
	<20110623143829.GC23435@rabbitmq.com>
	<BANLkTi=mq0N0XuhEStE6UNNL-qc0hwjYwg@mail.gmail.com>
	<20110623144334.GD23435@rabbitmq.com>
Message-ID: <BANLkTimpu522YY6Hgxf+ADadaSQZ8bFp2Q@mail.gmail.com>

Alright great :) Thanks for the advice on how to resolve the problem in the
mean time.

Ironically, it's actually a good thing that this happened, because it's
notified me of a 'looping' bug in my code (in a round abouts way), which
caused a DoS :)

Cal

On Thu, Jun 23, 2011 at 3:43 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Thu, Jun 23, 2011 at 03:40:59PM +0100, Cal Leeming [Simplicity Media
> Ltd] wrote:
> > Hmm, are there any plans to make this easier for a user to change via the
> > config?? Almost every other daemon I know has support for this, so it
> makes
> > RabbitMQ terribly unfriendly :(
>
> Yes, we have been thinking about this on and off for quite some time.
> I'm not sure what the current plans are wrt this, but you're not the
> first person to point out this problem, and we do have a bug open to
> look at sorting this out.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110623/64e46765/attachment.htm>

From videlalvaro at gmail.com  Thu Jun 23 16:48:05 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 23 Jun 2011 17:48:05 +0200
Subject: [rabbitmq-discuss] Removing "INFO REPORT" from logs (due to
	30gb log file in 1 day)
In-Reply-To: <BANLkTimpu522YY6Hgxf+ADadaSQZ8bFp2Q@mail.gmail.com>
References: <BANLkTinfoUtR3LMGEGLf8L7Mys_qsVMCgw@mail.gmail.com>
	<20110623143829.GC23435@rabbitmq.com>
	<BANLkTi=mq0N0XuhEStE6UNNL-qc0hwjYwg@mail.gmail.com>
	<20110623144334.GD23435@rabbitmq.com>
	<BANLkTimpu522YY6Hgxf+ADadaSQZ8bFp2Q@mail.gmail.com>
Message-ID: <FEC91EE9-0FB6-4278-B722-13D92604BA0A@gmail.com>

Hi,

According to the Erlang docs you can disable both SASL and rabbit logs by passing the following parameters to the rabbitmq-server init script:

sbin/rabbitmq-server -kernel error_logger silent -sasl sasl_error_logger false

More docs on the topic here: 

SASL Logs: http://www.erlang.org/doc/man/sasl_app.html
Erlang Kernel Docs: http://www.erlang.org/doc/man/kernel_app.html

Regarding specifying those parameters in a config file, that's possible too.

You can add them to this file for example: http://www.rabbitmq.com/configure.html#config-file

So there you could add an entry like this:

{sasl, [
	{sasl_error_logger, false}
]}

For the SASL logs

And another one like:

{kernel [
	{error_logger, silent}
]}

The problem with this approach is that the command line arguments passed inside the rabbitmq-server script will override what you put on those .config files, as explained here: http://www.erlang.org/doc/man/config.html

"Configuration parameter values in the configuration file will override the values in the application resource files (see app(4)). The values in the configuration file can be overridden by command line flags (see erl(1))."

 I think some tweaking of the rabbitmq-server script will do to solve this problem, specifically this lines:

    -sasl errlog_type error \
    -kernel error_logger '{file,"'${RABBITMQ_LOGS}'"}' \
    -sasl sasl_error_logger '{file,"'${RABBITMQ_SASL_LOGS}'"}' \

Hope this helps,

Alvaro

On Jun 23, 2011, at 4:47 PM, Cal Leeming [Simplicity Media Ltd] wrote:

> Alright great :) Thanks for the advice on how to resolve the problem in the mean time.
> 
> Ironically, it's actually a good thing that this happened, because it's notified me of a 'looping' bug in my code (in a round abouts way), which caused a DoS :)
> 
> Cal
> 
> On Thu, Jun 23, 2011 at 3:43 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Thu, Jun 23, 2011 at 03:40:59PM +0100, Cal Leeming [Simplicity Media Ltd] wrote:
> > Hmm, are there any plans to make this easier for a user to change via the
> > config?? Almost every other daemon I know has support for this, so it makes
> > RabbitMQ terribly unfriendly :(
> 
> Yes, we have been thinking about this on and off for quite some time.
> I'm not sure what the current plans are wrt this, but you're not the
> first person to point out this problem, and we do have a bug open to
> look at sorting this out.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110623/a7f9202c/attachment-0001.htm>

From cal.leeming at simplicitymedialtd.co.uk  Thu Jun 23 16:49:38 2011
From: cal.leeming at simplicitymedialtd.co.uk (Cal Leeming [Simplicity Media Ltd])
Date: Thu, 23 Jun 2011 16:49:38 +0100
Subject: [rabbitmq-discuss] Removing "INFO REPORT" from logs (due to
 30gb log file in 1 day)
In-Reply-To: <FEC91EE9-0FB6-4278-B722-13D92604BA0A@gmail.com>
References: <BANLkTinfoUtR3LMGEGLf8L7Mys_qsVMCgw@mail.gmail.com>
	<20110623143829.GC23435@rabbitmq.com>
	<BANLkTi=mq0N0XuhEStE6UNNL-qc0hwjYwg@mail.gmail.com>
	<20110623144334.GD23435@rabbitmq.com>
	<BANLkTimpu522YY6Hgxf+ADadaSQZ8bFp2Q@mail.gmail.com>
	<FEC91EE9-0FB6-4278-B722-13D92604BA0A@gmail.com>
Message-ID: <BANLkTinc4V9VOXPib-DS9nXV6C-gu8_=zw@mail.gmail.com>

Hi Alvaro,

I had seen a similar post on the list (I think from Matthias) which explains
how to fix using this approach, but thank you for taking the time to explain
this anyway!

Cal



On Thu, Jun 23, 2011 at 4:48 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> According to the Erlang docs you can disable both SASL and rabbit logs by
> passing the following parameters to the rabbitmq-server init script:
>
> sbin/rabbitmq-server -kernel error_logger silent -sasl sasl_error_logger
> false
>
> More docs on the topic here:
>
> SASL Logs: http://www.erlang.org/doc/man/sasl_app.html
> Erlang Kernel Docs: http://www.erlang.org/doc/man/kernel_app.html
>
> Regarding specifying those parameters in a config file, that's possible
> too.
>
> You can add them to this file for example:
> http://www.rabbitmq.com/configure.html#config-file
>
> So there you could add an entry like this:
>
> {sasl, [
> {sasl_error_logger, false}
> ]}
>
> For the SASL logs
>
> And another one like:
>
> {kernel [
> {error_logger, silent}
> ]}
>
> The problem with this approach is that the command line arguments passed
> inside the rabbitmq-server script will override what you put on those
> .config files, as explained here:
> http://www.erlang.org/doc/man/config.html
>
> "Configuration parameter values in the configuration file will override
> the values in the application resource files (see app(4)). The values in
> the configuration file can be overridden by command line flags (see erl(1)
> )."
>
>  I think some tweaking of the rabbitmq-server script will do to solve this
> problem, specifically this lines:
>
>     -sasl errlog_type error \
>     -kernel error_logger '{file,"'${RABBITMQ_LOGS}'"}' \
>     -sasl sasl_error_logger '{file,"'${RABBITMQ_SASL_LOGS}'"}' \
>
> Hope this helps,
>
> Alvaro
>
> On Jun 23, 2011, at 4:47 PM, Cal Leeming [Simplicity Media Ltd] wrote:
>
> Alright great :) Thanks for the advice on how to resolve the problem in the
> mean time.
>
> Ironically, it's actually a good thing that this happened, because it's
> notified me of a 'looping' bug in my code (in a round abouts way), which
> caused a DoS :)
>
> Cal
>
> On Thu, Jun 23, 2011 at 3:43 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:
>
>> On Thu, Jun 23, 2011 at 03:40:59PM +0100, Cal Leeming [Simplicity Media
>> Ltd] wrote:
>> > Hmm, are there any plans to make this easier for a user to change via
>> the
>> > config?? Almost every other daemon I know has support for this, so it
>> makes
>> > RabbitMQ terribly unfriendly :(
>>
>> Yes, we have been thinking about this on and off for quite some time.
>> I'm not sure what the current plans are wrt this, but you're not the
>> first person to point out this problem, and we do have a bug open to
>> look at sorting this out.
>>
>> Matthew
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> Sent form my Nokia 1100
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110623/c9a8d0f4/attachment.htm>

From videlalvaro at gmail.com  Thu Jun 23 20:08:46 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 23 Jun 2011 21:08:46 +0200
Subject: [rabbitmq-discuss] Rabbit Boot Steps
In-Reply-To: <20110622113642.GF2780@rabbitmq.com>
References: <F959DC49-6E7A-4F28-A8AC-7890AA3EAC95@gmail.com>
	<20110619193229.GA2535@rabbitmq.com>
	<92F4C9A8-A037-425D-8BD1-91835521D5C1@gmail.com>
	<20110619205630.GB2535@rabbitmq.com>
	<A4563130-D976-458A-AE5E-249A65F79BAE@gmail.com>
	<20110622103220.GD2780@rabbitmq.com>
	<976DFE93-4ACF-407D-A5D1-76BE1429EF16@gmail.com>
	<20110622110954.GE2780@rabbitmq.com>
	<79C15914-3F72-4517-83A6-96437CD13BA2@gmail.com>
	<20110622113642.GF2780@rabbitmq.com>
Message-ID: <55EE3066-8DB0-498C-80CB-A4B4537FC516@gmail.com>

Hi Matthew,

I've just created a new version of the patch. In this case the extracted files have no dependencies with rabbit's source code.

The files are:

boot_step.erl     //logic related to the boot steps
digraph_utils2.erl  //the build_acyclic_graph/3 function and types lives there. The 2 is because there already exists a digraph_utils.erl module in the Erlang distribution
module_utils.erl  // contains all_module_attributes/1 and helpers.

Cheers,

-Alvaro

-------------- next part --------------
A non-text attachment was scrubbed...
Name: files.tgz
Type: application/octet-stream
Size: 4292 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110623/6ea290cc/attachment.obj>
-------------- next part --------------


On Jun 22, 2011, at 1:36 PM, Matthew Sackman wrote:

> On Wed, Jun 22, 2011 at 01:21:57PM +0200, Alvaro Videla wrote:
>> I know that projects like Riak are using the gen_server2.erl even with the old LShift copyright?
> 
> Yeah, they shouldn't, and I've told them in the past that they're using
> old and buggy versions... However, if it works for them; open-source and
> all that stuff.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Sent form my Nokia 1100




From matthias at rabbitmq.com  Thu Jun 23 20:22:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 23 Jun 2011 20:22:34 +0100
Subject: [rabbitmq-discuss] Removing "INFO REPORT" from logs (due to
 30gb log file in 1 day)
In-Reply-To: <BANLkTinfoUtR3LMGEGLf8L7Mys_qsVMCgw@mail.gmail.com>
References: <BANLkTinfoUtR3LMGEGLf8L7Mys_qsVMCgw@mail.gmail.com>
Message-ID: <4E03927A.4020005@rabbitmq.com>

Cal,

On 23/06/11 15:34, Cal Leeming [Simplicity Media Ltd] wrote:
> So my server died a horrible death when all the disk space was used due
> to this:
>  [...]
> =INFO REPORT==== 19-Jun-2011::06:25:19 ===
>
> So, is there any way to actually stop those "INFO REPORT" messages from
> being logged, but keep the error logs?

An alternative to tweaking the config (as described elsewhere in this 
thread),  you could rotate and zip the logs to conserve space.

Matthias.

From brking at gmail.com  Thu Jun 23 21:56:58 2011
From: brking at gmail.com (bradrover)
Date: Thu, 23 Jun 2011 13:56:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustering and client reconnection on node
	failure
Message-ID: <2fe360c4-6b7b-4f90-bb2c-0d00dbbce5e4@u19g2000vbi.googlegroups.com>

I know there are several topics on this in the list already but still
not totally clear on this. If I am only using non-durable queues, and
I have a 2 node cluster, if node A fails, a client connected to queues
on node A will (I assume) get a connection failure of some kind. At
that time, is my correct recovery path to reconnect to the other node,
and re-declare my queues and bindings ? Seems simple enough, I just
need to maintain a list somewhere of all hosts and their availability
status.

From michael.s.klishin at gmail.com  Thu Jun 23 22:33:51 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 24 Jun 2011 01:33:51 +0400
Subject: [rabbitmq-discuss] Clustering and client reconnection on node
 failure
In-Reply-To: <2fe360c4-6b7b-4f90-bb2c-0d00dbbce5e4@u19g2000vbi.googlegroups.com>
References: <2fe360c4-6b7b-4f90-bb2c-0d00dbbce5e4@u19g2000vbi.googlegroups.com>
Message-ID: <0739D9F210394BB786F6340216ED37B8@gmail.com>


bradrover escribi?:

> If I am only using non-durable queues, and
> I have a 2 node cluster, if node A fails, a client connected to queues
> on node A will (I assume) get a connection failure of some kind. At
> that time, is my correct recovery path to reconnect to the other node,
> and re-declare my queues and bindings ?
Yes, this should be sufficient for many cases. 

MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin


From peter at cacoethes.co.uk  Fri Jun 24 10:25:40 2011
From: peter at cacoethes.co.uk (Peter Ledbrook)
Date: Fri, 24 Jun 2011 10:25:40 +0100
Subject: [rabbitmq-discuss] Grails Plugin failed to fetch groovy Objects.
In-Reply-To: <BANLkTikNb6Ay6mfUdeFaVPD=9FKRTwmoxg@mail.gmail.com>
References: <BANLkTikNb6Ay6mfUdeFaVPD=9FKRTwmoxg@mail.gmail.com>
Message-ID: <BANLkTikELOkiFKcVsj+x9W9HPFjRLXThPQ@mail.gmail.com>

> Our problem is that, We created two Grails applications and one application trying to post messages and it is posting successfully. And another application has to fetch it and needs to process it. But, The messages are not getting fetched and processed. Dont know whats happening there. And if we are using java objects it is working fine(both producer and consumer). But the Groovy objects are not getting fetched. We need some urgent solution to this problem. We are using RabbitMQ Grails plugin version 0.3.

What does your listener service look like? In particular, are you
specifying a type in the handeMessage() method? Are your Groovy
objects serializable?

Don't forget you can also increase the logging level to see what's
happening. I recommend monitoring the "org.grails.rabbitmq" and
"org.springframework.amqp" packages.

Hope that helps,

Peter

--
Peter Ledbrook
Grails Advocate
SpringSource - A Division of VMware

From a2alt at ya.ru  Fri Jun 24 10:56:16 2011
From: a2alt at ya.ru (Groshev Dmitry)
Date: Fri, 24 Jun 2011 13:56:16 +0400
Subject: [rabbitmq-discuss] Timeouts in erlang client
Message-ID: <750181308909376@web149.yandex.ru>

Why all timeouts in erlang client are set to infinity? When I'm using direct connection and remote server disconnects, rabbitmq-client's gen_server hangs waiting for answer from remote pid and stopping to receive messages, so its mailbox grows until node crash.

From matthew at rabbitmq.com  Fri Jun 24 11:56:11 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 24 Jun 2011 11:56:11 +0100
Subject: [rabbitmq-discuss] Timeouts in erlang client
In-Reply-To: <750181308909376@web149.yandex.ru>
References: <750181308909376@web149.yandex.ru>
Message-ID: <20110624105611.GA31249@rabbitmq.com>

On Fri, Jun 24, 2011 at 01:56:16PM +0400, Groshev Dmitry wrote:
> Why all timeouts in erlang client are set to infinity?

Any other number is equally as arbitrary and wrong.

> When I'm using direct connection and remote server disconnects,
> rabbitmq-client's gen_server hangs waiting for answer from remote pid
> and stopping to receive messages, so its mailbox grows until node
> crash.

That should not be the case: the amqp_client's channels should be
monitoring or linked to the remote channel and thus when the remote goes
away, the local should also go away. Which version of the client are you
using and could you post example code please?

Matthew

From abinesh.s at gmail.com  Fri Jun 24 12:46:13 2011
From: abinesh.s at gmail.com (abinesh s)
Date: Fri, 24 Jun 2011 17:16:13 +0530
Subject: [rabbitmq-discuss] Grails Plugin failed to fetch groovy Objects.
In-Reply-To: <BANLkTikELOkiFKcVsj+x9W9HPFjRLXThPQ@mail.gmail.com>
References: <BANLkTikNb6Ay6mfUdeFaVPD=9FKRTwmoxg@mail.gmail.com>
	<BANLkTikELOkiFKcVsj+x9W9HPFjRLXThPQ@mail.gmail.com>
Message-ID: <BANLkTikraGbv92o0UWrL8GAND5yj8Osb=A@mail.gmail.com>

Hi Peter,

Many Thanks for your reply. my handleMessage() looks like the following one.

void handleMessage(Map message) {
        try {
            User employee = message.msg
            println("Employee Id:"+employee.getId()+"Employee
Name::"+employee.getName())
        }
        catch (Exception e) {
            e.printStackTrace()
        }

The Object is serializable and then I place it in a Map object and then I
produced it into the queue. But, the messages are not yet getting fetched.
Please help me to get rid of this please. Thanks in advance.


On Fri, Jun 24, 2011 at 2:55 PM, Peter Ledbrook <peter at cacoethes.co.uk>wrote:

> > Our problem is that, We created two Grails applications and one
> application trying to post messages and it is posting successfully. And
> another application has to fetch it and needs to process it. But, The
> messages are not getting fetched and processed. Dont know whats happening
> there. And if we are using java objects it is working fine(both producer and
> consumer). But the Groovy objects are not getting fetched. We need some
> urgent solution to this problem. We are using RabbitMQ Grails plugin version
> 0.3.
>
> What does your listener service look like? In particular, are you
> specifying a type in the handeMessage() method? Are your Groovy
> objects serializable?
>
> Don't forget you can also increase the logging level to see what's
> happening. I recommend monitoring the "org.grails.rabbitmq" and
> "org.springframework.amqp" packages.
>
> Hope that helps,
>
> Peter
>
> --
> Peter Ledbrook
> Grails Advocate
> SpringSource - A Division of VMware
>



-- 
Thanks and Regards
Abinesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/836fbc2b/attachment.htm>

From simon at rabbitmq.com  Fri Jun 24 13:00:59 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Jun 2011 13:00:59 +0100
Subject: [rabbitmq-discuss] BUG: Upgrades from 2.1.1 or 2.2.0 directly to
	2.5.0 don't work
Message-ID: <4E047C7B.7060607@rabbitmq.com>

Hi all.

Just wanted to let you know that we've determined that upgrading 
directly from 2.1.1 or 2.2.0 directly to 2.5.0 will not work, and leave 
you with a failed upgrade.

Upgrading from 2.1.1 or 2.2.0 to 2.4.1, and then to 2.5.0 will work.

We'll probably spin a 2.5.1 release early next week that just corrects 
this issue, and I'm going to start enhancing our automated tests now :)

If you've already done the upgrade and it's failed you can either:

* Delete your mnesia directory and start again

or

* Revert to 2.4.1
* Move the directory mnesia/$NODENAME out of the way
* Rename mnesia/$NODENAME-upgrade-backup to mnesia/$NODENAME
* Start Rabbit
* Upgrade to 2.5.0

Thanks to Josh Geisser for the bug report, and apologies to everyone for 
the inconvenience.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From abinesh.s at gmail.com  Fri Jun 24 14:04:26 2011
From: abinesh.s at gmail.com (abinesh s)
Date: Fri, 24 Jun 2011 18:34:26 +0530
Subject: [rabbitmq-discuss] Grails Plugin failed to fetch groovy Objects.
In-Reply-To: <BANLkTimJPD=5badj-Vw98U_5Hj6_x+=RdQ@mail.gmail.com>
References: <BANLkTikNb6Ay6mfUdeFaVPD=9FKRTwmoxg@mail.gmail.com>
	<BANLkTikELOkiFKcVsj+x9W9HPFjRLXThPQ@mail.gmail.com>
	<BANLkTikraGbv92o0UWrL8GAND5yj8Osb=A@mail.gmail.com>
	<BANLkTimJPD=5badj-Vw98U_5Hj6_x+=RdQ@mail.gmail.com>
Message-ID: <BANLkTimnA1WDPzO7PWF_PBKHJFYXgna9-Q@mail.gmail.com>

Hi Peter,

Thanks for your reply. As I am new to this technologies, I dont know how to
change the logging level in a Grails Project could you please guide me how
to do that.

On Fri, Jun 24, 2011 at 5:54 PM, Peter Ledbrook <peter at cacoethes.co.uk>wrote:

> The Object is serializable and then I place it in a Map object and then I
>> produced it into the queue. But, the messages are not yet getting fetched.
>> Please help me to get rid of this please. Thanks in advance.
>
>
> Try a signature of:
>
>     void handeMessage(message)
>
> If that works, then there is something odd about the Groovy map you're
> using.
>
>  Also, please change the logging level for the packages I mentioned before
> to 'debug' and attach the output in a text file.
>
> Thanks,
>
> Peter
>
> --
> Peter Ledbrook
> Grails Advocate
> SpringSource - A Division of VMware
>
>


-- 
Thanks and Regards
Abinesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/06e97bc3/attachment.htm>

From rob at rabbitmq.com  Fri Jun 24 14:33:48 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 24 Jun 2011 14:33:48 +0100
Subject: [rabbitmq-discuss] Feedback on STOMP changes
Message-ID: <4E04923C.4090307@rabbitmq.com>

All,

We're thinking of making some changes to the STOMP adapter and would 
like to get some feedback before we do.

----------
Motivation
----------

We're making these changes to support two main use cases:

* SUBSCRIBE and SEND to queues created outside of STOMP with arbitrary 
queue properties (durable, auto-delete, x-message-ttl etc.)

* Allow STOMP clients to create queues with arbitrary queue properties

----------------
Proposed Changes
----------------

Currently, the STOMP adapter automatically creates the necessary queues 
when issuing SEND and SUBSCRIBE frames. Queues are created with a 
hard-coded set of properties that depends on the destination type.

Change 1: Allow extra headers on SUBSCRIBE to control queue properties

We'll add support for durable, exclusive, auto-delete and everything 
else as headers on the SUBSCRIBE frame.

Change 2: Stop creating queues on SEND

Because queue.declare requires queue attributes to be semantically 
equivalent, issuing a queue.declare on SEND means that each SEND frame 
would also need to carry the queue attributes in the header

------------
Consequences
------------

+ Support for all queue attributes
+ Subscribe and send to existing queues
+ Improved SEND performance (no need to ensure queues exist)
- Need to issue a SUBSCRIBE to ensure queues exist

Please give any feedback you have.

Regards,

Rob

From Massimo.Paladin at cern.ch  Fri Jun 24 15:16:53 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Fri, 24 Jun 2011 16:16:53 +0200
Subject: [rabbitmq-discuss] Feedback on STOMP changes
In-Reply-To: <4E04923C.4090307@rabbitmq.com>
References: <4E04923C.4090307@rabbitmq.com>
Message-ID: <BANLkTint7bzKAk3Pid82BMez2=T7HfMj1w@mail.gmail.com>

Hello,

I was right looking at RabbitMQ and STOMP support.

I have some recommendations which could be useful.

I find that change 2 might be a problem in some of the cases.
Producers usually don't have a notion of creating the destination, they just
like to send a message.
Removing the possibility to create queues would mean to add the notion of
creating queues on producers.
If this notion wouldn't be added the messages sent before the subscription
of a consumers will be discarded.

I find which it would be nice to extend a little the flexibility of the
stomp support.
For instance, correct me if I am wrong please, I wasn't able to do the
following via pure stomp:
- create an exchange of type topic and name X
- create a queue of name Y (durable and not auto-delete)
- add binding between X and Y
This is translated in what in JMS is called durable subscriber,
it would be nice to be able to do something like this.

Stomp component increases interoperability with other messaging brokers,
it would be great to try to have similar behaviors for some of the basic
messaging blocks.
People might be interested in changing messaging broker if similar
functionality would be supported.

Change 1 adds flexibility, however I would keep auto creation in SEND
phase with a default set of parameters.
These default parameters could be the most obvious or the one which would
allow easy interoperability between different products.

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Fri, Jun 24, 2011 at 3:33 PM, Rob Harrop <rob at rabbitmq.com> wrote:

> All,
>
> We're thinking of making some changes to the STOMP adapter and would like
> to get some feedback before we do.
>
> ----------
> Motivation
> ----------
>
> We're making these changes to support two main use cases:
>
> * SUBSCRIBE and SEND to queues created outside of STOMP with arbitrary
> queue properties (durable, auto-delete, x-message-ttl etc.)
>
> * Allow STOMP clients to create queues with arbitrary queue properties
>
> ----------------
> Proposed Changes
> ----------------
>
> Currently, the STOMP adapter automatically creates the necessary queues
> when issuing SEND and SUBSCRIBE frames. Queues are created with a hard-coded
> set of properties that depends on the destination type.
>
> Change 1: Allow extra headers on SUBSCRIBE to control queue properties
>
> We'll add support for durable, exclusive, auto-delete and everything else
> as headers on the SUBSCRIBE frame.
>
> Change 2: Stop creating queues on SEND
>
> Because queue.declare requires queue attributes to be semantically
> equivalent, issuing a queue.declare on SEND means that each SEND frame would
> also need to carry the queue attributes in the header
>
> ------------
> Consequences
> ------------
>
> + Support for all queue attributes
> + Subscribe and send to existing queues
> + Improved SEND performance (no need to ensure queues exist)
> - Need to issue a SUBSCRIBE to ensure queues exist
>
> Please give any feedback you have.
>
> Regards,
>
> Rob
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/93d919f1/attachment-0001.htm>

From michael.s.klishin at gmail.com  Fri Jun 24 15:48:23 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 24 Jun 2011 18:48:23 +0400
Subject: [rabbitmq-discuss] Cannot update public-umbrella
Message-ID: <DAF36E18621348CABFC405E2928DBE24@gmail.com>

Hi,

I am trying to update rabbitmq public umbrella and getting this:

~/Development/Opensource/rabbitmq-public-umbrella.hg make up

hg clone http://hg.rabbitmq.com/rabbitmq-ha-test
abort: HTTP Error 404: Not Found
make: *** [rabbitmq-ha-test] Error 255

Is there a reference to a repo that isn't public yet, or was removed?


MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin




From matthew at rabbitmq.com  Fri Jun 24 16:02:18 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 24 Jun 2011 16:02:18 +0100
Subject: [rabbitmq-discuss] Cannot update public-umbrella
In-Reply-To: <DAF36E18621348CABFC405E2928DBE24@gmail.com>
References: <DAF36E18621348CABFC405E2928DBE24@gmail.com>
Message-ID: <20110624150218.GF31249@rabbitmq.com>

On Fri, Jun 24, 2011 at 06:48:23PM +0400, Michael Klishin wrote:
> I am trying to update rabbitmq public umbrella and getting this:
> 
> ~/Development/Opensource/rabbitmq-public-umbrella.hg make up
> 
> hg clone http://hg.rabbitmq.com/rabbitmq-ha-test
> abort: HTTP Error 404: Not Found
> make: *** [rabbitmq-ha-test] Error 255
> 
> Is there a reference to a repo that isn't public yet, or was removed?

Ah ha, good point. I'll make that one public. Sorry.

Matthew

From matthew at rabbitmq.com  Fri Jun 24 16:29:26 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 24 Jun 2011 16:29:26 +0100
Subject: [rabbitmq-discuss] Cannot update public-umbrella
In-Reply-To: <20110624150218.GF31249@rabbitmq.com>
References: <DAF36E18621348CABFC405E2928DBE24@gmail.com>
	<20110624150218.GF31249@rabbitmq.com>
Message-ID: <20110624152925.GG31249@rabbitmq.com>

On Fri, Jun 24, 2011 at 04:02:18PM +0100, Matthew Sackman wrote:
> > hg clone http://hg.rabbitmq.com/rabbitmq-ha-test
> > abort: HTTP Error 404: Not Found
> Ah ha, good point. I'll make that one public. Sorry.

Done.

Matthew

From Byron.Albert at dealer.com  Fri Jun 24 17:35:37 2011
From: Byron.Albert at dealer.com (Byron Albert)
Date: Fri, 24 Jun 2011 16:35:37 +0000
Subject: [rabbitmq-discuss] problems upgrading from 2.1.1 -> 2.5.0
Message-ID: <E84B542096D9F5469A7CA1F600F59B9D1C61A3CB@vtmbx2.dealerdotcom.corp>

Hello,

I just tried to upgrade a broker from 2.1.1 -> 2.5.0 and it would not start, it broke in the upgrade.  I was able to restore from the backup it makes and then step through all the versions and make it work. But I have a bunch of brokers that need to updated so was wondering if there was a better solution?

Thanks
Byron

_____________________________________
Byron Albert | Systems Architect
[Description: Description: Description: cid:part1.01070402.03060807 at dealer.com]
V 877-327-8422 x496 F 802.658.0926
1 Howard St., Burlington, VT 05401
Byron.Albert at dealer.com<mailto:Byron.Albert at dealer.com> | www.dealer.com<http://www.dealer.com>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/ccdee802/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1658 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/ccdee802/attachment.gif>

From simon at rabbitmq.com  Fri Jun 24 17:37:50 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 24 Jun 2011 17:37:50 +0100
Subject: [rabbitmq-discuss] problems upgrading from 2.1.1 -> 2.5.0
In-Reply-To: <E84B542096D9F5469A7CA1F600F59B9D1C61A3CB@vtmbx2.dealerdotcom.corp>
References: <E84B542096D9F5469A7CA1F600F59B9D1C61A3CB@vtmbx2.dealerdotcom.corp>
Message-ID: <4E04BD5E.4080003@rabbitmq.com>

On 24/06/11 17:35, Byron Albert wrote:
> I just tried to upgrade a broker from 2.1.1 -> 2.5.0 and it would not
> start, it broke in the upgrade. I was able to restore from the backup it
> makes and then step through all the versions and make it work. But I
> have a bunch of brokers that need to updated so was wondering if there
> was a better solution?

See:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-June/013423.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From fearsome.lucidity at gmail.com  Fri Jun 24 18:33:06 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Fri, 24 Jun 2011 10:33:06 -0700
Subject: [rabbitmq-discuss] Persistent messages and durable queue
	questions
In-Reply-To: <4E01A49C.9010402@rabbitmq.com>
References: <BANLkTinehFtF17CT6koQ-W_kUV-7fdJWSw@mail.gmail.com>
	<4E01A49C.9010402@rabbitmq.com>
Message-ID: <BANLkTikBasN97dpS2XaPxh-Mr9rz4Ft-Xg@mail.gmail.com>

On Wed, Jun 22, 2011 at 1:15 AM, Rob Harrop <rob at rabbitmq.com> wrote:

>
> When there is a consumer ready to receive the message, the message will
> only be written to disk if:
>
> 1. The queue is durable
> 2. The message is peristent
> 3. Automatic ack is disabled


Rob,

Thanks for your response.  I was afraid that might be the case.  That said,
I've read with interest the discussion on the upcoming HA queue feature.
 It's exactly what we are looking for.  Hopefully it will be release in not
too long a time.


> You can use publisher confirms to allow your application code to know when
> a message has successfully been routed or when it has been lost.
>
> See: http://www.rabbitmq.com/**extensions.html#confirms<http://www.rabbitmq.com/extensions.html#confirms>


Alas, I believe, publisher confirms do not solve the problem. As I stated, I
expect only a subset of the messages published to the topic exchange to have
matching bindings.  Most messages will not be routed anywhere.  Publisher
confirms will return basic.ack for such messages.  That is all well and good
under normal conditions.

But if there is a node with a queue with a binding that matches the message,
and that node goes down, then it is my understanding that the rest of the
cluster will discard the binding since the queue is no longer reachable.  If
that is the case, then publisher confirms will return a basic.ack rather
than a basic.nack.  Thus the publisher will not know that there was a queue
with a binding that matched the message, but its just not available at this
time.

Is my understanding incorrect?

This becomes less of an issue once the HA queues feature is shipped, as I
configure the cluster the deliver the message to a queue even in the face a
configurable number of nodes being down.

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/7f65acee/attachment-0001.htm>

From amarjinder.sandhu at kno.com  Fri Jun 24 19:46:56 2011
From: amarjinder.sandhu at kno.com (Amarjinder Sandhu)
Date: Fri, 24 Jun 2011 11:46:56 -0700
Subject: [rabbitmq-discuss] code compile error while upgrading rabbitmq
	2.4.1 to 2.5.0.
Message-ID: <BANLkTi=ONLY2-vXx9q10OXYCwKroB=Dd=Q@mail.gmail.com>

Please advise Code Compile error while upgrading rabbitmq 2.4.1 to 2.5.0.

[INFO] Compilation failure

/home/asandhu/kno-workflow/agents/wf-content/src/main/java/com/kno/consumer/ContentProducer.java:[57,51]
<anonymous com.kno.consumer.ContentProducer$1> is not abstract and does not
override abstract method
handleReturn(int,java.lang.String,java.lang.String,java.lang.String,com.rabbitmq.client.AMQP.BasicProperties,byte[])
in com.rabbitmq.client.ReturnListener

/home/asandhu/kno-workflow/agents/wf-content/src/main/java/com/kno/consumer/ContentDownloadConsumer.java:[617,55]
<anonymous com.kno.consumer.ContentDownloadConsumer$1> is not abstract and
does not override abstract method
handleReturn(int,java.lang.String,java.lang.String,java.lang.String,com.rabbitmq.client.AMQP.BasicProperties,byte[])
in com.rabbitmq.client.ReturnListener

/home/asandhu/kno-workflow/agents/wf-content/src/main/java/com/kno/consumer/ContentDownloadConsumer.java:[618,12]
method does not override or implement a method from a supertype


Thanks,
Amarjinder
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/9981210e/attachment.htm>

From joseph.a.marlin at gmail.com  Fri Jun 24 20:36:07 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Fri, 24 Jun 2011 12:36:07 -0700 (PDT)
Subject: [rabbitmq-discuss] code compile error while upgrading rabbitmq
 2.4.1 to 2.5.0.
In-Reply-To: <BANLkTi=ONLY2-vXx9q10OXYCwKroB=Dd=Q@mail.gmail.com>
Message-ID: <21116276.3376.1308944167457.JavaMail.geo-discussion-forums@vboe28>

I'm not sure of the exact issue here, but I did have some issues with the 
update and the BasicProperties parts of my code as well when I went from 
2.4.1 to 2.5.0.

http://www.rabbitmq.com/javadoc/com/rabbitmq/client/BasicProperties.html
http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/AMQBasicProperties.html
http://www.rabbitmq.com/javadoc/com/rabbitmq/client/AMQP.BasicProperties.html

These pages helped me through it though, my problem seems to be something 
similar to what you are facing.
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/8bc695f6/attachment.htm>

From joseph.a.marlin at gmail.com  Fri Jun 24 20:39:08 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Fri, 24 Jun 2011 12:39:08 -0700 (PDT)
Subject: [rabbitmq-discuss] problems upgrading from 2.1.1 -> 2.5.0
In-Reply-To: <E84B542096D9F5469A7CA1F600F59B9D1C61A3CB@vtmbx2.dealerdotcom.corp>
Message-ID: <4255112.3391.1308944348573.JavaMail.geo-discussion-forums@vboe28>

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-June/013423.html

In a nutshell: wait until next week. Cheers!
Joseph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/025ea5a6/attachment.htm>

From joseph.a.marlin at gmail.com  Fri Jun 24 20:39:54 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Fri, 24 Jun 2011 12:39:54 -0700 (PDT)
Subject: [rabbitmq-discuss] problems upgrading from 2.1.1 -> 2.5.0
In-Reply-To: <4255112.3391.1308944348573.JavaMail.geo-discussion-forums@vboe28>
Message-ID: <32225915.2653.1308944394013.JavaMail.geo-discussion-forums@vbxe21>

Anddddddd I didn't see Simon's message there. Apologies. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/3bda81af/attachment.htm>

From aaron at agoragames.com  Fri Jun 24 21:37:06 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Fri, 24 Jun 2011 16:37:06 -0400
Subject: [rabbitmq-discuss] Rabbit and NUMA
Message-ID: <BANLkTikZ2WWYOTXNSLutsC_oJc7pNLov8g@mail.gmail.com>

I wrote a blog post on our experience configuring RabbitMQ for AMD and
Intel NUMA architectures.

http://blog.agoragames.com/blog/2011/06/24/of-penguins-rabbits-and-buses/

-Aaron

-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From james.r.carr at gmail.com  Sat Jun 25 00:12:09 2011
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 24 Jun 2011 19:12:09 -0400
Subject: [rabbitmq-discuss] Grails Plugin failed to fetch groovy Objects.
In-Reply-To: <BANLkTimnA1WDPzO7PWF_PBKHJFYXgna9-Q@mail.gmail.com>
References: <BANLkTikNb6Ay6mfUdeFaVPD=9FKRTwmoxg@mail.gmail.com>
	<BANLkTikELOkiFKcVsj+x9W9HPFjRLXThPQ@mail.gmail.com>
	<BANLkTikraGbv92o0UWrL8GAND5yj8Osb=A@mail.gmail.com>
	<BANLkTimJPD=5badj-Vw98U_5Hj6_x+=RdQ@mail.gmail.com>
	<BANLkTimnA1WDPzO7PWF_PBKHJFYXgna9-Q@mail.gmail.com>
Message-ID: <BANLkTi=U0GLjOiU5fZAf0J3SqL64hWVnYw@mail.gmail.com>

One thing to note is that the gtails plugin uses spring amqp under the hood
and defaults to the message converter that sends serialized objects.

I'd need to see some sample code to help out.

Thanks,
James

On Jun 24, 2011 8:05 AM, "abinesh s" <abinesh.s at gmail.com> wrote:

Hi Peter,

Thanks for your reply. As I am new to this technologies, I dont know how to
change the logging level in a Grails Project could you please guide me how
to do that.

On Fri, Jun 24, 2011 at 5:54 PM, Peter Ledbrook <peter at cacoethes.co.uk>
wrote:

> >> >> The Object is serializable and then I place it in a Map object and
> then I produced it into the...
> Try a signature of:
>
>     void handeMessage(message)
>
> If that works, then there is something odd about the Groovy map you're
> using.
>
>  Also, please change the logging level for the packages I mentioned before
> to 'debug' and attach the output in a text file.
>
> Thanks,
>
> Peter
>
> > > -- > Peter Ledbrook > Grails Advocate > SpringSource - A Division of
> VMware >
>



-- 
Thanks and Regards
Abinesh




_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110624/c597dbf9/attachment.htm>

From michael.justin at gmx.net  Sat Jun 25 11:43:57 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Sat, 25 Jun 2011 12:43:57 +0200
Subject: [rabbitmq-discuss] Feedback on STOMP changes
In-Reply-To: <4E04923C.4090307@rabbitmq.com>
References: <4E04923C.4090307@rabbitmq.com>
Message-ID: <iu4e5e$3dc$1@dough.gmane.org>

Am 24.06.2011 15:33, Rob Harrop wrote:

> We'll add support for durable, exclusive, auto-delete and everything
> else as headers on the SUBSCRIBE frame.

The Stomp+JMS bindings page http://stomp.codehaus.org/Stomp+JMS has a 
implementation recommendation for durable subscribers (more ore less 
implemented in this way in other brokers):

quote:
"
If you wish to create a durable topic subscriber you will need to do the 
following

*    set the client-id header on the CONNECT to a globally unique String 
for the Stomp connection
*    set the durable-subscriber-name header on the SUBSCRIBE command.

The combination of the client-id and durable-subscriber-name uniquely 
identifies the durable topic subscription. i.e. after you restart your 
program and re-subscribe, the Broker will know which messages you need 
that were published while you were away"


For compatibility of Stomp client implementations, RabbitMQ could 
implement it following this specification.

Regards,
Michael Justin


From videlalvaro at gmail.com  Sat Jun 25 22:35:41 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 25 Jun 2011 23:35:41 +0200
Subject: [rabbitmq-discuss] Rabbit Internals - Boot Process
Message-ID: <E427F625-C73E-43C0-A0B6-D3D930A8B495@gmail.com>

Hi,

I started a project to document Rabbit's internals. The idea is to make the process of discovering how rabbit internals works easier to understand for me and for others.

So far I have documented the boot step process. You can find the docs in the link below:

https://github.com/videlalvaro/rabbit-internals/blob/master/rabbit_boot_process.md

Please feel free to fork the project and add your own documents to it. Also if you find any typos please let me know so i can correct them.

Cheers,

Alvaro

From nmqhoan at gmail.com  Sun Jun 26 17:41:19 2011
From: nmqhoan at gmail.com (Nguyen Mau Quoc Hoan)
Date: Sun, 26 Jun 2011 17:41:19 +0100
Subject: [rabbitmq-discuss] How to create new BasicProperties()
Message-ID: <BANLkTi=nCghuJk-nriLrzcRkO3QvcVCeWg@mail.gmail.com>

I tried to do the example about RPC call but I can not create a new
BasicProperties object by using the command:

>     BasicProperties props = new BasicProperties();
>
The warning I got is this function is undefined although I imported needed
library.
What's problem I got here?Anyone can help me. I install the newest version
of RabbitMQ.
Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110626/a2e3acd7/attachment.htm>

From emile at rabbitmq.com  Mon Jun 27 00:00:32 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 27 Jun 2011 00:00:32 +0100
Subject: [rabbitmq-discuss] How to create new BasicProperties()
In-Reply-To: <BANLkTi=nCghuJk-nriLrzcRkO3QvcVCeWg@mail.gmail.com>
References: <BANLkTi=nCghuJk-nriLrzcRkO3QvcVCeWg@mail.gmail.com>
Message-ID: <4E07BA10.6060302@rabbitmq.com>

Hi,

Op 26/06/11 17:41, het Nguyen Mau Quoc Hoan geskryf:
> I tried to do the example about RPC call but I can not create a new
> BasicProperties object by using the command:
> 
>         BasicProperties props = new BasicProperties();
> 
> The warning I got is this function is undefined although I imported
> needed library.
> What's problem I got here?Anyone can help me. I install the newest
> version of RabbitMQ.
> Thanks in advance.

If you are making use of the .net client library then see the
IModel.CreateBasicProperties() method.

If you are using the Java client library then see the examples in
com.rabbitmq.client.RpcClient and com.rabbitmq.client.RpcServer().



Regards


Emile

From matthias at rabbitmq.com  Mon Jun 27 10:22:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Jun 2011 10:22:01 +0100
Subject: [rabbitmq-discuss] code compile error while upgrading rabbitmq
 2.4.1 to 2.5.0.
In-Reply-To: <BANLkTi=ONLY2-vXx9q10OXYCwKroB=Dd=Q@mail.gmail.com>
References: <BANLkTi=ONLY2-vXx9q10OXYCwKroB=Dd=Q@mail.gmail.com>
Message-ID: <4E084BB9.8030100@rabbitmq.com>

Amarjinder,

On 24/06/11 19:46, Amarjinder Sandhu wrote:
> Please advise Code Compile error while upgrading rabbitmq 2.4.1 to 2.5.0.
>
> [INFO] Compilation failure
>
> /home/asandhu/kno-workflow/agents/wf-content/src/main/java/com/kno/consumer/ContentProducer.java:[57,51]
> <anonymous com.kno.consumer.ContentProducer$1> is not abstract and does
> not override abstract method
> handleReturn(int,java.lang.String,java.lang.String,java.lang.String,com.rabbitmq.client.AMQP.BasicProperties,byte[])
> in com.rabbitmq.client.ReturnListener

I suspect you get the above because ReturnListener.handleBasicReturn got 
renamed to handleReturn. But that happened in 2.4.0, so it's strange 
that you are running into this only now.

Regards,

Matthias.

From kuleshovmail at gmail.com  Mon Jun 27 11:32:00 2011
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Mon, 27 Jun 2011 10:32:00 +0000
Subject: [rabbitmq-discuss] Can't find amqp_params record
Message-ID: <BANLkTinsXzHDV7uOCduTswFQeZ2uQRWrMw@mail.gmail.com>

Hello,

I install rabbitmq-server and rabbitmq-erlanc-client from
rabbitmq-public-umbrella. I try to run simple example:
(https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/erlang/send.erl)

But get error:

./send.erl:8: record amqp_params undefined

How can i fix it?

Thank you.

From matthew at rabbitmq.com  Mon Jun 27 11:39:41 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 27 Jun 2011 11:39:41 +0100
Subject: [rabbitmq-discuss] Can't find amqp_params record
In-Reply-To: <BANLkTinsXzHDV7uOCduTswFQeZ2uQRWrMw@mail.gmail.com>
References: <BANLkTinsXzHDV7uOCduTswFQeZ2uQRWrMw@mail.gmail.com>
Message-ID: <20110627103941.GC7904@rabbitmq.com>

On Mon, Jun 27, 2011 at 10:32:00AM +0000, Alexander Kuleshov wrote:
> I install rabbitmq-server and rabbitmq-erlanc-client from
> rabbitmq-public-umbrella. I try to run simple example:
> (https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/erlang/send.erl)
> 
> But get error:
> 
> ./send.erl:8: record amqp_params undefined
> 
> How can i fix it?

Ahh, the tutorials have broken. Or have fallen behind somehow. The
amqp_params have been split to amqp_params_network and
amqp_params_direct and there's only connection:start/1 now.

Sorry, I'll raise a bug to get the tutorials fixed up. Thanks for the
report.

Matthew

From emile at rabbitmq.com  Mon Jun 27 13:47:40 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 27 Jun 2011 13:47:40 +0100
Subject: [rabbitmq-discuss] Can't find amqp_params record
In-Reply-To: <20110627103941.GC7904@rabbitmq.com>
References: <BANLkTinsXzHDV7uOCduTswFQeZ2uQRWrMw@mail.gmail.com>
	<20110627103941.GC7904@rabbitmq.com>
Message-ID: <4E087BEC.9030709@rabbitmq.com>

Hi Alexander,

Op 27/06/11 11:39, het Matthew Sackman geskryf:
> On Mon, Jun 27, 2011 at 10:32:00AM +0000, Alexander Kuleshov wrote:
>> I install rabbitmq-server and rabbitmq-erlanc-client from
>> rabbitmq-public-umbrella. I try to run simple example:
>> (https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/erlang/send.erl)
>>
>> But get error:
>>
>> ./send.erl:8: record amqp_params undefined
>>
>> How can i fix it?
> 
> Ahh, the tutorials have broken. Or have fallen behind somehow. The
> amqp_params have been split to amqp_params_network and
> amqp_params_direct and there's only connection:start/1 now.
> 
> Sorry, I'll raise a bug to get the tutorials fixed up. Thanks for the
> report.

This correction is now available on the master branch.


-Emile

From majek04 at gmail.com  Mon Jun 27 13:48:59 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 27 Jun 2011 13:48:59 +0100
Subject: [rabbitmq-discuss] Rabbit and NUMA
In-Reply-To: <BANLkTikZ2WWYOTXNSLutsC_oJc7pNLov8g@mail.gmail.com>
References: <BANLkTikZ2WWYOTXNSLutsC_oJc7pNLov8g@mail.gmail.com>
Message-ID: <BANLkTimo-pgoD+g2mXSwKRx7yCLfB-6LEQ@mail.gmail.com>

On Fri, Jun 24, 2011 at 21:37, Aaron Westendorf <aaron at agoragames.com> wrote:
> I wrote a blog post on our experience configuring RabbitMQ for AMD and
> Intel NUMA architectures.
>
> http://blog.agoragames.com/blog/2011/06/24/of-penguins-rabbits-and-buses/

Very interesting. Thanks for sharing it.

Marek

From matthias at rabbitmq.com  Mon Jun 27 16:02:33 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Jun 2011 16:02:33 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
Message-ID: <4E089B89.4080009@rabbitmq.com>

What use, if any, are RabbitMQ users finding for AMQP's tx class?

The predominant application of tx we have seen in the past is as a means 
for the client to ensure that the server has accepted responsibility for 
a published message (or, conversely, be told of any failure to do so). 
Publisher confirms, which we introduced in 2.3.0, handle this much 
better. I suppose there might be still be users that haven't switched 
from 'tx' to 'confirm'. If so I'd like to know what is holding you back.

What else are people using tx for with RabbitMQ? And what aspects of tx 
semantics are you relying on? (Note, for example, that the tx specified 
in AMQP 0-9-1 is very limited. For example, atomicity is not guaranteed 
for transactions affecting more than one queue.)

Our current thinking is that tx, as it stands, is of very limited 
utility and that we are probably better off without it - it adds 
significant code complexity, slows down implementation of new features 
and is generally curtailing the evolution of RabbitMQ.


Regards,

Matthias.

From simon at rabbitmq.com  Mon Jun 27 16:11:07 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 27 Jun 2011 16:11:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.5.1 Release - stage
Message-ID: <4E089D8B.5020304@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 2.5.1.

This release correctly upgrades from RabbitMQ 2.1.1 and 2.2.0. There are 
no other changes compared with 2.5.0.

See the attached release notes for more details.

Binary and source distributions of the new release can be found in the
usual place at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.

Regards,
            The RabbitMQ Team

-- 
Simon MacMullen
RabbitMQ, VMware

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.5.1.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110627/714d2c51/attachment.txt>

From simon at rabbitmq.com  Mon Jun 27 16:13:07 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 27 Jun 2011 16:13:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.5.1 Release
In-Reply-To: <4E089D8B.5020304@rabbitmq.com>
References: <4E089D8B.5020304@rabbitmq.com>
Message-ID: <4E089E03.5020205@rabbitmq.com>

On 27/06/11 16:11, Simon MacMullen wrote:
> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.5.1.

It's very hot in London today. Please ignore the word "stage" in the 
subject!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Mon Jun 27 16:19:39 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Mon, 27 Jun 2011 16:19:39 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E089B89.4080009@rabbitmq.com>
References: <4E089B89.4080009@rabbitmq.com>
Message-ID: <4E089F8B.4020504@rabbitmq.com>

On 27/06/11 16:02, Matthias Radestock wrote:
> What use, if any, are RabbitMQ users finding for AMQP's tx class?
>
> The predominant application of tx we have seen in the past is as a 
> means for the client to ensure that the server has accepted 
> responsibility for a published message (or, conversely, be told of any 
> failure to do so). Publisher confirms, which we introduced in 2.3.0, 
> handle this much better. I suppose there might be still be users that 
> haven't switched from 'tx' to 'confirm'. If so I'd like to know what 
> is holding you back.
The semantics of tx and confirms are somewhat different (atomicity)

An example would be an order that contains several order items. Each 
order item is represented by a message sent to an order queue. If all 
order items for a particular order are sent in a transaction, then we 
know that if the tx committed ok, all items will hit the server and can 
be processed, otherwise no items (no partial order) will be available on 
the server.

With confirms, if a failure occurs mid way through sending the items you 
could end up with an incomplete order on the server, resulting in the 
customer only receiving some of the items they ordered.

You might say, just resend the items we didn't get confirms for when the 
system restarts after failure. Problem with that is it requires the 
client to store every item persistently, so it can resend them after 
crashing. This is a lot more work for the client to do.

Another issue is if you want to implement JMS on top of AMQP you 
wouldn't be able to do that with tx.




From tim at rabbitmq.com  Mon Jun 27 16:25:23 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Mon, 27 Jun 2011 16:25:23 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E089F8B.4020504@rabbitmq.com>
References: <4E089B89.4080009@rabbitmq.com> <4E089F8B.4020504@rabbitmq.com>
Message-ID: <4E08A0E3.3010403@rabbitmq.com>

On 27/06/11 16:19, Tim Fox wrote:
>
> Another issue is if you want to implement JMS on top of AMQP you 
> wouldn't be able to do that with tx.
s/with tx/without tx

From rtrlists at googlemail.com  Mon Jun 27 16:33:47 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Mon, 27 Jun 2011 16:33:47 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E089B89.4080009@rabbitmq.com>
References: <4E089B89.4080009@rabbitmq.com>
Message-ID: <BANLkTikc=Wk4PDxbEX34pX=He1JKoqS0Fw@mail.gmail.com>

On Mon, Jun 27, 2011 at 4:02 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> What use, if any, are RabbitMQ users finding for AMQP's tx class?
>
> The predominant application of tx we have seen in the past is as a means
> for the client to ensure that the server has accepted responsibility for a
> published message (or, conversely, be told of any failure to do so).
> Publisher confirms, which we introduced in 2.3.0, handle this much better. I
> suppose there might be still be users that haven't switched from 'tx' to
> 'confirm'. If so I'd like to know what is holding you back.
>
> What else are people using tx for with RabbitMQ? And what aspects of tx
> semantics are you relying on? (Note, for example, that the tx specified in
> AMQP 0-9-1 is very limited. For example, atomicity is not guaranteed for
> transactions affecting more than one queue.)
>
> Our current thinking is that tx, as it stands, is of very limited utility
> and that we are probably better off without it - it adds significant code
> complexity, slows down implementation of new features and is generally
> curtailing the evolution of RabbitMQ.
>
>
> Regards,
>
> Matthias.
>
>
I do not have high throughput requirements. But I do have reasonably strong
"never lose a message" requirements. For this I use durable queues and
persitant messages. And I use tx to tell the producer that the message has
been persisted.

I haven't yet looked at confirm.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110627/fe9c2610/attachment-0001.htm>

From matthias at rabbitmq.com  Mon Jun 27 16:45:05 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Jun 2011 16:45:05 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <BANLkTikc=Wk4PDxbEX34pX=He1JKoqS0Fw@mail.gmail.com>
References: <4E089B89.4080009@rabbitmq.com>
	<BANLkTikc=Wk4PDxbEX34pX=He1JKoqS0Fw@mail.gmail.com>
Message-ID: <4E08A581.9000408@rabbitmq.com>

Robert,

thanks for the quick response...

On 27/06/11 16:33, Robert Raschke wrote:
> I haven't yet looked at confirm.

Any particular reason? Or is it just a case of "if it ain't broken don't 
fix it?"

Matthias.

From rtrlists at googlemail.com  Mon Jun 27 16:50:25 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Mon, 27 Jun 2011 16:50:25 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E08A581.9000408@rabbitmq.com>
References: <4E089B89.4080009@rabbitmq.com>
	<BANLkTikc=Wk4PDxbEX34pX=He1JKoqS0Fw@mail.gmail.com>
	<4E08A581.9000408@rabbitmq.com>
Message-ID: <BANLkTinOeoRLZsUwyg4sbswOXieiQEcijQ@mail.gmail.com>

On Mon, Jun 27, 2011 at 4:45 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Robert,
>
> thanks for the quick response...
>
>
> On 27/06/11 16:33, Robert Raschke wrote:
>
>> I haven't yet looked at confirm.
>>
>
> Any particular reason? Or is it just a case of "if it ain't broken don't
> fix it?"
>
> Matthias.
>

Mostly because I'm still on 2.3. (And I've got too much else on to look at
upgrading at the mo'.)
But also a bit of wanting to stick to a standard, for whatever that's worth
;-)

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110627/bbea07dc/attachment.htm>

From thomas.kant at gmail.com  Mon Jun 27 18:23:06 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Mon, 27 Jun 2011 10:23:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Moving ActiveMQ to RabbitMQ
Message-ID: <6850ec10-f790-44fe-9190-59c91a9c039b@v11g2000prk.googlegroups.com>

I want to migrate a project using ActiveMq to RabbitMQ.
Any one could help me out this problem?

Thanks,
+++
thomas.kant

From aar at cpan.org  Mon Jun 27 18:29:19 2011
From: aar at cpan.org (Alessandro Ranellucci)
Date: Mon, 27 Jun 2011 19:29:19 +0200
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E089B89.4080009@rabbitmq.com>
Message-ID: <r422Ps-1067i-7150EA67C06B43B8A0312548605C1734@thelonious.lan>

On 27-06-2011 at 17:02, Matthias Radestock wrote:

  >The predominant application of tx we have seen in the past is 
as a
  >means for the client to ensure that the server has accepted
  >responsibility for a published message (or, conversely, be 
told of any
  >failure to do so). Publisher confirms, which we introduced in 2.3.0,
  >handle this much better. I suppose there might be still be 
users that
  >haven't switched from 'tx' to 'confirm'. If so I'd like to 
know what
  >is holding you back.

Rollback!

I have daemons processing external events and writing to a RDMS, 
filesystem and RabbitMQ. If something fails -sort of a 
distributed transaction- I can just rollback everything on RabbitMQ.

Plus, what Tim Fox said about atomicity.

al.


From oyvind at tjervaag.com  Mon Jun 27 18:36:20 2011
From: oyvind at tjervaag.com (Oyvind Tjervaag)
Date: Mon, 27 Jun 2011 19:36:20 +0200
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E089B89.4080009@rabbitmq.com>
References: <4E089B89.4080009@rabbitmq.com>
Message-ID: <2D89F230-659E-41D8-BBBF-70C870BBA219@tjervaag.com>

On Jun 27, 2011, at 5:02 PM, Matthias Radestock wrote:

> What use, if any, are RabbitMQ users finding for AMQP's tx class?
> 
> The predominant application of tx we have seen in the past is as a means for the client to ensure that the server has accepted responsibility for a published message (or, conversely, be told of any failure to do so). Publisher confirms, which we introduced in 2.3.0, handle this much better. I suppose there might be still be users that haven't switched from 'tx' to 'confirm'. If so I'd like to know what is holding you back.
> 
> What else are people using tx for with RabbitMQ? And what aspects of tx semantics are you relying on? (Note, for example, that the tx specified in AMQP 0-9-1 is very limited. For example, atomicity is not guaranteed for transactions affecting more than one queue.)
> 
> Our current thinking is that tx, as it stands, is of very limited utility and that we are probably better off without it - it adds significant code complexity, slows down implementation of new features and is generally curtailing the evolution of RabbitMQ.

Hi Matthias!

We use the tx class. Just because we can't afford to lose any messages. For our case we only use it for a single connection/channel/queue (and for a single message...) This, of course, makes publishing fairly slow..

There is no real reason for us not switching to confirms. It's planned, but I simply haven't had time to do the necessary changes yet. I did however do a quick branch-and-hack-test to just to try it out, and it seems to cover our use case fine (..think streaming analog values..) :)

regards,
?yvind

From matthias at rabbitmq.com  Mon Jun 27 18:51:49 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Jun 2011 18:51:49 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <r422Ps-1067i-7150EA67C06B43B8A0312548605C1734@thelonious.lan>
References: <r422Ps-1067i-7150EA67C06B43B8A0312548605C1734@thelonious.lan>
Message-ID: <4E08C335.5080205@rabbitmq.com>

Al,

On 27/06/11 18:29, Alessandro Ranellucci wrote:
> I have daemons processing external events and writing to a RDMS,
> filesystem and RabbitMQ. If something fails -sort of a distributed
> transaction- I can just rollback everything on RabbitMQ.

Interesting. What guarantees are you getting out of this? Presumably you 
cannot (easily) roll back the file system write. And since the RDBMS 
transaction and RabbitMQ transaction are separate, how do you undo the 
first one when the second one fails?

More broadly, what is the recovery strategy, i.e. what do you after 
you've done the rolling back? Retry again after a while?

> Plus, what Tim Fox said about atomicity.

Are you relying on tx atomicity at the moment? If so, can you elaborate 
on the specific use case? Also is the "only atomic for a single queue" 
restriction of AMQP's tx ok for your app?


Regards,

Matthias.

From gsim at redhat.com  Mon Jun 27 19:21:47 2011
From: gsim at redhat.com (Gordon Sim)
Date: Mon, 27 Jun 2011 19:21:47 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E08C335.5080205@rabbitmq.com>
References: <r422Ps-1067i-7150EA67C06B43B8A0312548605C1734@thelonious.lan>
	<4E08C335.5080205@rabbitmq.com>
Message-ID: <4E08CA3B.8070406@redhat.com>

On 06/27/2011 06:51 PM, Matthias Radestock wrote:
> Also is the "only atomic for a single queue" restriction of AMQP's tx ok
> for your app?

Its not really fair to say that that is a limitation of AMQP.

The intention behind tx in AMQP was to provide full atomicity, though 
the language in the original specification did not make this clear. Full 
atomicity is offered in other implementations.

From matthias at rabbitmq.com  Mon Jun 27 19:30:58 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Jun 2011 19:30:58 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E08CA3B.8070406@redhat.com>
References: <r422Ps-1067i-7150EA67C06B43B8A0312548605C1734@thelonious.lan>	<4E08C335.5080205@rabbitmq.com>
	<4E08CA3B.8070406@redhat.com>
Message-ID: <4E08CC62.102@rabbitmq.com>

On 27/06/11 19:21, Gordon Sim wrote:
> On 06/27/2011 06:51 PM, Matthias Radestock wrote:
>> Also is the "only atomic for a single queue" restriction of AMQP's tx ok
>> for your app?
>
> Its not really fair to say that that is a limitation of AMQP.

I am trying to ascertain to what degree people rely on (just) what is 
guaranteed by the AMQP 0-9-1. Implementations are of course free to go 
beyond that.

Matthias.

From mabrek at gmail.com  Mon Jun 27 19:35:44 2011
From: mabrek at gmail.com (Anton Lebedevich)
Date: Mon, 27 Jun 2011 22:35:44 +0400
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E089B89.4080009@rabbitmq.com>
References: <4E089B89.4080009@rabbitmq.com>
Message-ID: <4E08CD80.5080801@gmail.com>

On 06/27/2011 07:02 PM, Matthias Radestock wrote:
> What use, if any, are RabbitMQ users finding for AMQP's tx class?

As a mean to force fsync on queue server.
Does receiving 'confirm' mean that server have written message to disk
and it won't be lost on kill -9 rabbitmq?

Regards,
Anton Lebedevich.

From matthias at rabbitmq.com  Mon Jun 27 19:40:50 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 27 Jun 2011 19:40:50 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E08CD80.5080801@gmail.com>
References: <4E089B89.4080009@rabbitmq.com> <4E08CD80.5080801@gmail.com>
Message-ID: <4E08CEB2.4050606@rabbitmq.com>

On 27/06/11 19:35, Anton Lebedevich wrote:
> Does receiving 'confirm' mean that server have written message to disk
> and it won't be lost on kill -9 rabbitmq?

Yes, it does.

Matthias.

From gsim at redhat.com  Mon Jun 27 19:44:29 2011
From: gsim at redhat.com (Gordon Sim)
Date: Mon, 27 Jun 2011 19:44:29 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E08CC62.102@rabbitmq.com>
References: <r422Ps-1067i-7150EA67C06B43B8A0312548605C1734@thelonious.lan>	<4E08C335.5080205@rabbitmq.com>
	<4E08CA3B.8070406@redhat.com> <4E08CC62.102@rabbitmq.com>
Message-ID: <4E08CF8D.6070807@redhat.com>

On 06/27/2011 07:30 PM, Matthias Radestock wrote:
> On 27/06/11 19:21, Gordon Sim wrote:
>> On 06/27/2011 06:51 PM, Matthias Radestock wrote:
>>> Also is the "only atomic for a single queue" restriction of AMQP's tx ok
>>> for your app?
>>
>> Its not really fair to say that that is a limitation of AMQP.
>
> I am trying to ascertain to what degree people rely on (just) what is
> guaranteed by the AMQP 0-9-1. Implementations are of course free to go
> beyond that.

Yes, but as you know the reason that the full atomicity guarantee was 
not clarified in 0-9-1 was that RabbitMQ did not support it.

I'm certainly not saying you should, either. It's entirely reasonable to 
consider whether any additional feature is in fact used and needed.

I just think its a little unfair to portray it as a question of 
inadequate guarantees in the specification since that guarantee was in 
fact limited by implementation.

From tim at rabbitmq.com  Mon Jun 27 20:26:55 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Mon, 27 Jun 2011 20:26:55 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E08CEB2.4050606@rabbitmq.com>
References: <4E089B89.4080009@rabbitmq.com> <4E08CD80.5080801@gmail.com>
	<4E08CEB2.4050606@rabbitmq.com>
Message-ID: <4E08D97F.7060402@rabbitmq.com>

On 27/06/11 19:40, Matthias Radestock wrote:
> On 27/06/11 19:35, Anton Lebedevich wrote:
>> Does receiving 'confirm' mean that server have written message to disk
>> and it won't be lost on kill -9 rabbitmq?
>
> Yes, it does.
You'll also need to make sure you don't have disk write cache enabled in 
the OS (unless you have a battery backed cache), or even fsync won't 
guarantee the changes have made it to disk.

Many OSes by default will have disk write cache enabled by default 
(especially on desktop type machines).
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Mon Jun 27 21:47:58 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Mon, 27 Jun 2011 21:47:58 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E08CF8D.6070807@redhat.com>
References: <r422Ps-1067i-7150EA67C06B43B8A0312548605C1734@thelonious.lan>	<4E08C335.5080205@rabbitmq.com>	<4E08CA3B.8070406@redhat.com>
	<4E08CC62.102@rabbitmq.com> <4E08CF8D.6070807@redhat.com>
Message-ID: <4E08EC7E.40305@rabbitmq.com>

On 27/06/2011 19:44, Gordon Sim wrote:
> On 06/27/2011 07:30 PM, Matthias Radestock wrote:
>> On 27/06/11 19:21, Gordon Sim wrote:
>>> On 06/27/2011 06:51 PM, Matthias Radestock wrote:
>>>> Also is the "only atomic for a single queue" restriction of AMQP's 
>>>> tx ok
>>>> for your app?
>>>
>>> Its not really fair to say that that is a limitation of AMQP.
>>
>> I am trying to ascertain to what degree people rely on (just) what is
>> guaranteed by the AMQP 0-9-1. Implementations are of course free to go
>> beyond that.
>
> Yes, but as you know the reason that the full atomicity guarantee was 
> not clarified in 0-9-1 was that RabbitMQ did not support it.
>
> I'm certainly not saying you should, either. It's entirely reasonable 
> to consider whether any additional feature is in fact used and needed.
>
> I just think its a little unfair to portray it as a question of 
> inadequate guarantees in the specification since that guarantee was in 
> fact limited by implementation.
Gordon,

Last time I looked I looked at MRG it was using separate journals for 
each queue and, in case of failure, couldn't guarantee atomic 
transactions with publishes or acks across multiple queues. This was 
common knowledge when I worked at Red Hat and something the MRG team, 
unsurprisingly, liked to keep quiet about. Customers tend not to be 
happy if they're told their transactions aren't really transactions.

Maybe you've fixed your implementation by now (although it's hard to see 
how you could do it without resorting to some slow, clunky, hand rolled 
2PC protocol), but please bear in mind that by pointing your finger at 
Rabbit, when you're own implementation was no different in that regard 
smacks of hypocrisy.









From james.r.carr at gmail.com  Tue Jun 28 00:57:22 2011
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 27 Jun 2011 19:57:22 -0400
Subject: [rabbitmq-discuss] Republishing messages when a broker is
	unreachable
Message-ID: <BANLkTi=jvfPwVwHrds7vqyTG+STv=EFvyg@mail.gmail.com>

Hi All,

Although I can think of several homebrew strategies, what are some
existing strategies/libraries/frameworks for retrying messages that
were unpublishable due to the broker being unreachable (network
outage, maintenance, etc)?

Thanks,
James

From adam at middleware360.com  Tue Jun 28 01:23:41 2011
From: adam at middleware360.com (extoa)
Date: Mon, 27 Jun 2011 17:23:41 -0700 (PDT)
Subject: [rabbitmq-discuss]  JMS audit/logging/resubmission web tool
Message-ID: <31942507.post@talk.nabble.com>


Hey everyone, I am hoping this email might stir some good conversation, I
would love to hear what everyone else is doing in this space.

I'm searching around to see if a particular tool exists, I can't seem to
find one so I thought I would see what everyone else is doing.  I plan on
posting this in a few of the open source projects around to get the best
feedback.

I am looking for a software tool which I will primarily use to audit,
monitor and resubmit messages sent to a JMS message broker.  Ideally this
tool has the following features:

 - Open Source with a good community
 - Web based console to view and search messages
 - Messages are persisted in a database (SQL/NoSQL)
 - Ability to add custom "Action" buttons so that you could easily write a
plugin that "resubmits" a message back to a JMS queue/topic as well as write
whatever else you need.   Would also need the ability to "edit" the message
before resubmitting.
 - Ability to acknowledge/comment on failed messages
 - Support for displaying/viewing Java objects, (probably limits me to Java
based tools...)
 - Have the ability to send email alerts based on user defined conditions
 - Graphing, statistics and reporting regarding how many messages we're sent
to each queue/topic in 5 minute intervals grouped by topic/message type.
 - Does not need to have a JMS adaptor, as long as their is an API to get
the data into the tool, i'm sure this would be easy to write/contribute.
 - Supports millions of messages/day
 - BAM style dashboard

I would really like to have a tool like this to monitor/audit/log/replay
messages in my JMS environment.  I see a lot of similarities with what I
want in the tools like Zenoss/OpenNMS/syslog-ng/splunk etc.. as they all
have "Eventing/Syslog" capabilities.  

I would prefer to add/contribute to an existing project as opposed to
building something custom myself...

- What is everyone else out there doing for auditing and tracking of failed
messages in your JMS environment?
- Which open source tool do you think is the closest to what i'm looking
for?  
-- 
View this message in context: http://old.nabble.com/JMS-audit-logging-resubmission-web-tool-tp31942507p31942507.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From james.r.carr at gmail.com  Tue Jun 28 02:18:33 2011
From: james.r.carr at gmail.com (James Carr)
Date: Mon, 27 Jun 2011 20:18:33 -0500
Subject: [rabbitmq-discuss] Republishing messages when a broker is
	unreachable
In-Reply-To: <BANLkTi=jvfPwVwHrds7vqyTG+STv=EFvyg@mail.gmail.com>
References: <BANLkTi=jvfPwVwHrds7vqyTG+STv=EFvyg@mail.gmail.com>
Message-ID: <BANLkTi=in2Sb=PvmE-DjK6wZQG0pW32iqw@mail.gmail.com>

After some googling I see that one recommended strategy is to install
rabbitmq on the clients and use the shovel plugin to push messages
from local queues to other exchanges. I like the approach but at the
same time if an organization requires support contracts on anything
used in a production quality revenue generating way that can shoot the
support costs to the stratosphere. ;)

Another problem that comes to mind is the fact that quite few clients
in our webfarm are already approaching their limits on memory and CPU
usage... installing rabbitmq on each of them feels a bit heavy.

Any other recommended solutions?

Thanks,
James

On Mon, Jun 27, 2011 at 6:57 PM, James Carr <james.r.carr at gmail.com> wrote:
> Hi All,
>
> Although I can think of several homebrew strategies, what are some
> existing strategies/libraries/frameworks for retrying messages that
> were unpublishable due to the broker being unreachable (network
> outage, maintenance, etc)?
>
> Thanks,
> James
>

From chris.madden at gmail.com  Tue Jun 28 02:55:26 2011
From: chris.madden at gmail.com (Chris Madden)
Date: Mon, 27 Jun 2011 21:55:26 -0400
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
In-Reply-To: <4E01C5EB.3070504@rabbitmq.com>
References: <mailman.555.1308639242.2898.rabbitmq-discuss@lists.rabbitmq.com>
	<ABA42E48EC654326B9E2F059573DA9BE@gmail.com>
	<20110622102503.GB2780@rabbitmq.com>
	<4E01C5EB.3070504@rabbitmq.com>
Message-ID: <BANLkTikHRU8bUZBgetW2=BYTH3yRg1RbQQ@mail.gmail.com>

I've whipped up a pair of python scripts that demonstrate the issue.
 They're using the queue-per-request anti-pattern, as that is what my
production code is using  (if I can only get more time...)

My test environment is 2 ubuntu 11.04 server boxes with erlang R14b03.  I
have no plugins on a clean install of rabbit 2.5.0.  There are  2 nodes in
my cluster, A and B.  A is a disc node, B is a ram node.  I run echo.py on
the ram node, and spew.py on the disc node.  Each python script connects to
its local broker.  I'm using python-amqplib 0.6.1-1 for these scripts,
though my production code is java based.  The "guest" account is set as an
administrator on vhost /.  On my setup, the LATEST.LOG grows decently fast,
maybe 15 meg an hour.

If there is something pathological in my scripts, I'd love to hear it
(beyond the aforementioned anti-pattern)... it is entirely possible I'm not
releasing a resource I guess.  Also, I'm using basic_get() as it avoids the
complexity of threading logic in the example, in production I use consumers.

tarball md5 is 1591ebbb1e9cffa06e6aec1c1ecb7b1d



On Wed, Jun 22, 2011 at 6:37 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Chris,
>
>
> On 22/06/11 11:25, Matthew Sackman wrote:
>
>> On Tue, Jun 21, 2011 at 11:18:36AM -0400, Chris Madden wrote:
>>
>>> I upgraded our erlang version to R14B03, but the LATEST.LOG still
>>> continues to be growing, albeit, more slowly perhaps?
>>>
>>
>> Curious.
>>
>
> Are you sure that you haven't perhaps got a growing list of queues? Check
> with 'rabbitmqctl list_queues'. Or, even better, use the fancy new
> 'rabbitmqctl report' to produce a complete report of the server status and
> send that to us.
>
>
>  I'm kind of suspicious of one of the queue usage models I'm using.
>>> When one of the processes needs to make a one-off request (rpc
>>> like), it creates a queue dedicated to that request, and expects
>>> the reply to come back on that queue.
>>>
>>
> Generally, "queue per request" is a design anti pattern. Though if your
> processes are short-lived and don't make many requests it's ok.
>
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110627/b49fdf42/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: repro.tar.gz
Type: application/x-gzip
Size: 952 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110627/b49fdf42/attachment-0001.bin>

From jasonjwwilliams at gmail.com  Tue Jun 28 04:07:17 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 27 Jun 2011 21:07:17 -0600
Subject: [rabbitmq-discuss] Republishing messages when a broker is
	unreachable
In-Reply-To: <BANLkTi=in2Sb=PvmE-DjK6wZQG0pW32iqw@mail.gmail.com>
References: <BANLkTi=jvfPwVwHrds7vqyTG+STv=EFvyg@mail.gmail.com>
	<BANLkTi=in2Sb=PvmE-DjK6wZQG0pW32iqw@mail.gmail.com>
Message-ID: <B8E9F3C4-0203-49F3-AF31-A6153C6A5C02@gmail.com>

Seems like you're just moving the point of failure around. Granted it's closer to the app, but what if your local broker fails in such a way that your app is still running (e.g. oom, out of disk, etc)? I would either make the action that is generating the publish not return until it gets a publisher confirm from RMQ or implement a separate thread/process to handle the publishing to RMQ and implementing a simple disk-based persistency (don't accept the message to publish until you've gotten it written to a file on the disk, then publish out of memory and only hit the disk again to reap the message lazily after it's been marked "dirty"). We've used the latter approach very successfully. When the app restarts, the publisher thread/process reads it's "backup" directory and publishes the existing (and non-dirty) messages to RMQ. 

Running multiple RMQ brokers in a loose federation with Shovel adds a lot of moving parts that can be difficult to debug. Just my 2 cents. 

-J

Sent via iPhone

Is your email Premiere?

On Jun 27, 2011, at 19:18, James Carr <james.r.carr at gmail.com> wrote:

> After some googling I see that one recommended strategy is to install
> rabbitmq on the clients and use the shovel plugin to push messages
> from local queues to other exchanges. I like the approach but at the
> same time if an organization requires support contracts on anything
> used in a production quality revenue generating way that can shoot the
> support costs to the stratosphere. ;)
> 
> Another problem that comes to mind is the fact that quite few clients
> in our webfarm are already approaching their limits on memory and CPU
> usage... installing rabbitmq on each of them feels a bit heavy.
> 
> Any other recommended solutions?
> 
> Thanks,
> James
> 
> On Mon, Jun 27, 2011 at 6:57 PM, James Carr <james.r.carr at gmail.com> wrote:
>> Hi All,
>> 
>> Although I can think of several homebrew strategies, what are some
>> existing strategies/libraries/frameworks for retrying messages that
>> were unpublishable due to the broker being unreachable (network
>> outage, maintenance, etc)?
>> 
>> Thanks,
>> James
>> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Tue Jun 28 05:18:16 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 Jun 2011 05:18:16 +0100
Subject: [rabbitmq-discuss] LATEST.LOG growth on clustered ram node
In-Reply-To: <BANLkTikHRU8bUZBgetW2=BYTH3yRg1RbQQ@mail.gmail.com>
References: <mailman.555.1308639242.2898.rabbitmq-discuss@lists.rabbitmq.com>	<ABA42E48EC654326B9E2F059573DA9BE@gmail.com>	<20110622102503.GB2780@rabbitmq.com>	<4E01C5EB.3070504@rabbitmq.com>
	<BANLkTikHRU8bUZBgetW2=BYTH3yRg1RbQQ@mail.gmail.com>
Message-ID: <4E095608.3040507@rabbitmq.com>

Chris,

On 28/06/11 02:55, Chris Madden wrote:
> I've whipped up a pair of python scripts that demonstrate the issue.
> [...] the LATEST.LOG grows decently fast, maybe 15 meg an hour.

I can reproduce this.

> If there is something pathological in my scripts, I'd love to hear it
> (beyond the aforementioned anti-pattern)...

There is nothing pathological in the scripts, though they are an 
exercise in AMQP anti-patterns ;) (you really shouldn't be using a topic 
exchange; a direct exchange, in fact the default exchange, should do 
just fine; take a look at 
http://www.rabbitmq.com/tutorials/tutorial-six-python.html when you have 
a spare moment).

I've filed a bug. My investigation so far indicates that this may well 
be a problem in mnesia. We have a somewhat unusual configuration in that 
that our 'ram' nodes aren't really ram nodes in the mnesia sense - they 
are fully-fledged disk nodes which happen to have no local disk copies 
of tables. It is conceivable that this induces a faulty code path in the 
log handling code.

Until we fix that... I am pretty sure that in your setup the disk usage 
growth rate will be proportional to the queue creation rate. So if you 
eliminated the "one queue per request" anti-pattern that would probably 
give you plenty of headroom before bumping into any disk space limits.

Thanks for reporting this problem and taking the time constructing a 
reproducible test. Much appreciated.


Regards,

Matthias.

From abinesh.s at gmail.com  Tue Jun 28 05:21:51 2011
From: abinesh.s at gmail.com (abinesh s)
Date: Tue, 28 Jun 2011 09:51:51 +0530
Subject: [rabbitmq-discuss] Grails Plugin failed to fetch groovy Objects.
In-Reply-To: <BANLkTi=U0GLjOiU5fZAf0J3SqL64hWVnYw@mail.gmail.com>
References: <BANLkTikNb6Ay6mfUdeFaVPD=9FKRTwmoxg@mail.gmail.com>
	<BANLkTikELOkiFKcVsj+x9W9HPFjRLXThPQ@mail.gmail.com>
	<BANLkTikraGbv92o0UWrL8GAND5yj8Osb=A@mail.gmail.com>
	<BANLkTimJPD=5badj-Vw98U_5Hj6_x+=RdQ@mail.gmail.com>
	<BANLkTimnA1WDPzO7PWF_PBKHJFYXgna9-Q@mail.gmail.com>
	<BANLkTi=U0GLjOiU5fZAf0J3SqL64hWVnYw@mail.gmail.com>
Message-ID: <BANLkTinzLOsnf9Px5hrEzAQu+U3GUjP2bg@mail.gmail.com>

Hi All,

Thanks for your help. I have been fixed that issue by using the
SerialVersionUID in the groovy class. Now, my listeners were able to fetch
the messages without any loss in it. Thanks for your assistance.

One thing to note is that the gtails plugin uses spring amqp under the hood
> and defaults to the message converter that sends serialized objects.
>
> I'd need to see some sample code to help out.
>
> Thanks,
> James
>
> On Jun 24, 2011 8:05 AM, "abinesh s" <abinesh.s at gmail.com> wrote:
>
> Hi Peter,
>
> Thanks for your reply. As I am new to this technologies, I dont know how to
> change the logging level in a Grails Project could you please guide me how
> to do that.
>
> On Fri, Jun 24, 2011 at 5:54 PM, Peter Ledbrook <peter at cacoethes.co.uk>
> wrote:
>
>> >> >> The Object is serializable and then I place it in a Map object and
>> then I produced it into the...
>> Try a signature of:
>>
>>     void handeMessage(message)
>>
>> If that works, then there is something odd about the Groovy map you're
>> using.
>>
>>  Also, please change the logging level for the packages I mentioned
>> before to 'debug' and attach the output in a text file.
>>
>> Thanks,
>>
>> Peter
>>
>> > > -- > Peter Ledbrook > Grails Advocate > SpringSource - A Division of
>> VMware >
>>
>
>
>
> --
> Thanks and Regards
> Abinesh
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Thanks and Regards
Abinesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/0ba337ac/attachment.htm>

From james.r.carr at gmail.com  Tue Jun 28 06:17:03 2011
From: james.r.carr at gmail.com (James Carr)
Date: Tue, 28 Jun 2011 00:17:03 -0500
Subject: [rabbitmq-discuss] Republishing messages when a broker is
	unreachable
In-Reply-To: <B8E9F3C4-0203-49F3-AF31-A6153C6A5C02@gmail.com>
References: <BANLkTi=jvfPwVwHrds7vqyTG+STv=EFvyg@mail.gmail.com>
	<BANLkTi=in2Sb=PvmE-DjK6wZQG0pW32iqw@mail.gmail.com>
	<B8E9F3C4-0203-49F3-AF31-A6153C6A5C02@gmail.com>
Message-ID: <BANLkTik24MSUGo6URGka_Yp3WE1J-H+-+A@mail.gmail.com>

Yeah, that was along a similar idea I was considering. In node.js I
already do this by having a webworker (which runs in a separate
process) be responsible for publishing and retrying. In java we could
probably do something similar and use a simple ehcache based solution
(since it already overflows to disk when a certain memory threshold is
reached), caching and retrying messages that are published while the
broker is down. We could then use ehcache's write to disk on crash if
that process crashes.

Sigh... it does feel like a bit of shuffling the point of failure around. :)

Thanks,
James

On Mon, Jun 27, 2011 at 10:07 PM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
> Seems like you're just moving the point of failure around. Granted it's closer to the app, but what if your local broker fails in such a way that your app is still running (e.g. oom, out of disk, etc)? I would either make the action that is generating the publish not return until it gets a publisher confirm from RMQ or implement a separate thread/process to handle the publishing to RMQ and implementing a simple disk-based persistency (don't accept the message to publish until you've gotten it written to a file on the disk, then publish out of memory and only hit the disk again to reap the message lazily after it's been marked "dirty"). We've used the latter approach very successfully. When the app restarts, the publisher thread/process reads it's "backup" directory and publishes the existing (and non-dirty) messages to RMQ.
>
> Running multiple RMQ brokers in a loose federation with Shovel adds a lot of moving parts that can be difficult to debug. Just my 2 cents.
>
> -J
>
> Sent via iPhone
>
> Is your email Premiere?
>
> On Jun 27, 2011, at 19:18, James Carr <james.r.carr at gmail.com> wrote:
>
>> After some googling I see that one recommended strategy is to install
>> rabbitmq on the clients and use the shovel plugin to push messages
>> from local queues to other exchanges. I like the approach but at the
>> same time if an organization requires support contracts on anything
>> used in a production quality revenue generating way that can shoot the
>> support costs to the stratosphere. ;)
>>
>> Another problem that comes to mind is the fact that quite few clients
>> in our webfarm are already approaching their limits on memory and CPU
>> usage... installing rabbitmq on each of them feels a bit heavy.
>>
>> Any other recommended solutions?
>>
>> Thanks,
>> James
>>
>> On Mon, Jun 27, 2011 at 6:57 PM, James Carr <james.r.carr at gmail.com> wrote:
>>> Hi All,
>>>
>>> Although I can think of several homebrew strategies, what are some
>>> existing strategies/libraries/frameworks for retrying messages that
>>> were unpublishable due to the broker being unreachable (network
>>> outage, maintenance, etc)?
>>>
>>> Thanks,
>>> James
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From alexis at rabbitmq.com  Tue Jun 28 08:11:51 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 28 Jun 2011 08:11:51 +0100
Subject: [rabbitmq-discuss] JMS audit/logging/resubmission web tool
In-Reply-To: <31942507.post@talk.nabble.com>
References: <31942507.post@talk.nabble.com>
Message-ID: <BANLkTi=qAj2NGFw6EOAEVdJbZRzNddH7TQ@mail.gmail.com>

Adam,

I think HermesJMS might be a good starting point: http://www.hermesjms.com/

I have bcc'd the author.

alexis


On Tue, Jun 28, 2011 at 1:23 AM, extoa <adam at middleware360.com> wrote:
>
> Hey everyone, I am hoping this email might stir some good conversation, I
> would love to hear what everyone else is doing in this space.
>
> I'm searching around to see if a particular tool exists, I can't seem to
> find one so I thought I would see what everyone else is doing. ?I plan on
> posting this in a few of the open source projects around to get the best
> feedback.
>
> I am looking for a software tool which I will primarily use to audit,
> monitor and resubmit messages sent to a JMS message broker. ?Ideally this
> tool has the following features:
>
> ?- Open Source with a good community
> ?- Web based console to view and search messages
> ?- Messages are persisted in a database (SQL/NoSQL)
> ?- Ability to add custom "Action" buttons so that you could easily write a
> plugin that "resubmits" a message back to a JMS queue/topic as well as write
> whatever else you need. ? Would also need the ability to "edit" the message
> before resubmitting.
> ?- Ability to acknowledge/comment on failed messages
> ?- Support for displaying/viewing Java objects, (probably limits me to Java
> based tools...)
> ?- Have the ability to send email alerts based on user defined conditions
> ?- Graphing, statistics and reporting regarding how many messages we're sent
> to each queue/topic in 5 minute intervals grouped by topic/message type.
> ?- Does not need to have a JMS adaptor, as long as their is an API to get
> the data into the tool, i'm sure this would be easy to write/contribute.
> ?- Supports millions of messages/day
> ?- BAM style dashboard
>
> I would really like to have a tool like this to monitor/audit/log/replay
> messages in my JMS environment. ?I see a lot of similarities with what I
> want in the tools like Zenoss/OpenNMS/syslog-ng/splunk etc.. as they all
> have "Eventing/Syslog" capabilities.
>
> I would prefer to add/contribute to an existing project as opposed to
> building something custom myself...
>
> - What is everyone else out there doing for auditing and tracking of failed
> messages in your JMS environment?
> - Which open source tool do you think is the closest to what i'm looking
> for?
> --
> View this message in context: http://old.nabble.com/JMS-audit-logging-resubmission-web-tool-tp31942507p31942507.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From aar at cpan.org  Tue Jun 28 08:54:03 2011
From: aar at cpan.org (Alessandro Ranellucci)
Date: Tue, 28 Jun 2011 09:54:03 +0200
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E08C335.5080205@rabbitmq.com>
Message-ID: <r422Ps-1067i-571E4352F4DB4C5CA909E2C02690B8F4@thelonious.lan>

On 27-06-2011 at 19:51, Matthias Radestock wrote:

  >>I have daemons processing external events and writing to a RDMS,
  >>filesystem and RabbitMQ. If something fails -sort of a distributed
  >>transaction- I can just rollback everything on RabbitMQ.
  >
  >Interesting. What guarantees are you getting out of this? Presumably
  >you cannot (easily) roll back the file system write. And 
since the
  >RDBMS transaction and RabbitMQ transaction are separate, how 
do you
  >undo the first one when the second one fails?

If a filesystem write fails, I rollback both the RDBMS and 
RabbitMQ transactions. Then I send a tx.commit to RabbitMQ; if 
this fails I rollback the RDBMS. Finally, I commit the RDBMS.

My message consumers are idempotent and always check object 
status in RDBMS before processing messages, so should I fail to 
commit to RDBMS after having committed to RabbitMQ, those 
messages will be ignored.
I don't care about filesystem, as I have periodic daemons 
removing old or unused files anyway.

  >More broadly, what is the recovery strategy, i.e. what do you after
  >you've done the rolling back? Retry again after a while?

If the external event is synchronous, I just return a temporary 
error and have the external client re-submit its request. If 
it's asynchronous (like a message consumed from an internal 
queue) I just close the AMQP channel without acking the message 
and restart consuming later.

  >>Plus, what Tim Fox said about atomicity.
  >
  >Are you relying on tx atomicity at the moment? If so, can you
  >elaborate on the specific use case? Also is the "only atomic 
for a
  >single queue" restriction of AMQP's tx ok for your app?

Hmm. Er... that limitation sounds new to me. Didn't pay 
attention :-)

I'm not totally relying on disk-level atomicity; however the 
ability to commit or rollback a bunch of messages with a single 
command sounds still more 'atomic' than submitting, say, 5 
messages one by one (I might lose network connection to RabbitMQ 
between those submits).

Alessandro


From gsim at redhat.com  Tue Jun 28 09:14:16 2011
From: gsim at redhat.com (Gordon Sim)
Date: Tue, 28 Jun 2011 09:14:16 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E08EC7E.40305@rabbitmq.com>
References: <r422Ps-1067i-7150EA67C06B43B8A0312548605C1734@thelonious.lan>	<4E08C335.5080205@rabbitmq.com>	<4E08CA3B.8070406@redhat.com>	<4E08CC62.102@rabbitmq.com>
	<4E08CF8D.6070807@redhat.com> <4E08EC7E.40305@rabbitmq.com>
Message-ID: <4E098D58.6070603@redhat.com>

On 06/27/2011 09:47 PM, Tim Fox wrote:
> please bear in mind that by pointing your finger at
> Rabbit, when you're own implementation was no different in that regard
> smacks of hypocrisy.

I am certainly not pointing fingers at Rabbit and apologies if that is 
the way it came across. My point, again, is simply that it is not the 
specification that is limited here.

From matthias at rabbitmq.com  Tue Jun 28 09:25:25 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 Jun 2011 09:25:25 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <r422Ps-1067i-571E4352F4DB4C5CA909E2C02690B8F4@thelonious.lan>
References: <r422Ps-1067i-571E4352F4DB4C5CA909E2C02690B8F4@thelonious.lan>
Message-ID: <4E098FF5.2080701@rabbitmq.com>

Alessandro,

thanks for elaborating on your design...

On 28/06/11 08:54, Alessandro Ranellucci wrote:
> If a filesystem write fails, I rollback both the RDBMS and RabbitMQ
> transactions. Then I send a tx.commit to RabbitMQ; if this fails I
> rollback the RDBMS. Finally, I commit the RDBMS.
>
> My message consumers are idempotent and always check object status in
> RDBMS before processing messages, so should I fail to commit to RDBMS
> after having committed to RabbitMQ, those messages will be ignored.

Idempotence is certainly a good thing.

How does the "check object status before processing" work? Couldn't a 
consumer get the message(s) before the rdbms transaction has committed, 
thus not see the up to date status and erroneously ignore the message?

>  >Are you relying on tx atomicity at the moment? If so, can you
>  >elaborate on the specific use case? Also is the "only atomic for a
>  >single queue" restriction of AMQP's tx ok for your app?
>
> Hmm. Er... that limitation sounds new to me. Didn't pay attention :-)

So in your app, can the messages inside a tx can end up in multiple queues?

I doubt many people are aware of the that limitation. In fact in 
RabbitMQ not even single queue transactions are atomic, i.e. in the 
event of a failure during the commit phase you may end up with a sub-set 
of the published messages in the queue. It's highly unlikely, but 
certainly possible.


Regards,

Matthias

From colincrist at messageforge.org  Tue Jun 28 11:32:58 2011
From: colincrist at messageforge.org (Colin Crist)
Date: Tue, 28 Jun 2011 06:32:58 -0400
Subject: [rabbitmq-discuss] JMS audit/logging/resubmission web tool
In-Reply-To: <BANLkTi=qAj2NGFw6EOAEVdJbZRzNddH7TQ@mail.gmail.com>
Message-ID: <CA2F6C6A.A88F%colincrist@messageforge.org>


Hi Adam,

No such tool exists as far as I am aware. Hermes covers some of this but what it is not is any kind of enterprise bus monitoring solution, it is a developent/test/support desktop application.

At a client I am currently building a solution that covers the bus monitoring side of things and for this we are using a mixture of  http://www.codestreet.com/template.php?page=replay, Tibco Business Works for the CEP engine and some custom tooling to build the dashboards using GWT with a simple server tier containing the history of "reconstituted workflows" with "pointers" into the message (replay) store for their content.

You could swap out BW for sure and use Esper but I've not seen any open source equivalent of the replay server (i.e. A Tivo for your message bus) - its incredibly useful.

The dashboards are quite custom to the workflow at this company as are the CEP rules to monitor the message flows. Using GWT has made the dash boards very functional and quick to develop - more so than a product that needs configuring and tweaking and never reaching the sophistication of one coded properly. Using a CEP engine externalizes the business logic nicely in a way discussable with the more technical business folk.

For the more straightforward requirements of browsing queues and subscriptions and their manipulation, we use Hermes.

Hope this helps.

Colin.

On 28/06/2011 08:11, "Alexis Richardson" <alexis at rabbitmq.com> wrote:

Adam,

I think HermesJMS might be a good starting point: http://www.hermesjms.com/

I have bcc'd the author.

alexis


On Tue, Jun 28, 2011 at 1:23 AM, extoa <adam at middleware360.com> wrote:
>
> Hey everyone, I am hoping this email might stir some good conversation, I
> would love to hear what everyone else is doing in this space.
>
> I'm searching around to see if a particular tool exists, I can't seem to
> find one so I thought I would see what everyone else is doing.  I plan on
> posting this in a few of the open source projects around to get the best
> feedback.
>
> I am looking for a software tool which I will primarily use to audit,
> monitor and resubmit messages sent to a JMS message broker.  Ideally this
> tool has the following features:
>
>  - Open Source with a good community
>  - Web based console to view and search messages
>  - Messages are persisted in a database (SQL/NoSQL)
>  - Ability to add custom "Action" buttons so that you could easily write a
> plugin that "resubmits" a message back to a JMS queue/topic as well as write
> whatever else you need.   Would also need the ability to "edit" the message
> before resubmitting.
>  - Ability to acknowledge/comment on failed messages
>  - Support for displaying/viewing Java objects, (probably limits me to Java
> based tools...)
>  - Have the ability to send email alerts based on user defined conditions
>  - Graphing, statistics and reporting regarding how many messages we're sent
> to each queue/topic in 5 minute intervals grouped by topic/message type.
>  - Does not need to have a JMS adaptor, as long as their is an API to get
> the data into the tool, i'm sure this would be easy to write/contribute.
>  - Supports millions of messages/day
>  - BAM style dashboard
>
> I would really like to have a tool like this to monitor/audit/log/replay
> messages in my JMS environment.  I see a lot of similarities with what I
> want in the tools like Zenoss/OpenNMS/syslog-ng/splunk etc.. as they all
> have "Eventing/Syslog" capabilities.
>
> I would prefer to add/contribute to an existing project as opposed to
> building something custom myself...
>
> - What is everyone else out there doing for auditing and tracking of failed
> messages in your JMS environment?
> - Which open source tool do you think is the closest to what i'm looking
> for?
> --
> View this message in context: http://old.nabble.com/JMS-audit-logging-resubmission-web-tool-tp31942507p31942507.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/2f377ce0/attachment.htm>

From pieter.baele at gmail.com  Tue Jun 28 12:15:44 2011
From: pieter.baele at gmail.com (Pieter Baele)
Date: Tue, 28 Jun 2011 13:15:44 +0200
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 setting STOMP plugin port (bug?)
Message-ID: <BANLkTimWEfSkBqPSsDzkcguFVkgjE7RWqg@mail.gmail.com>

Hi,

I installed RabbitMQ to use it with mcollective, but I've a little
problem with version 2.5.0,
the stomp server port is not set right (someone else reported this
problem as wel, see mcollective-users mailing list)

/etc/rabbitmq/rabbitmq-env.conf
RABBITMQ_CONFIG_FILE=/etc/rabbitmq/rabbitmq.conf

/etc/rabbitmq/rabbitmq.conf
[ {rabbit_stomp, [{tcp_listeners, [6163]} ]} ]


but still....

broker running
starting STOMP Adapter (binding to {[61613],[]})  ...done
** Found 0 name clashes in code paths


service rabbitmq-server status
-------------------------------------------
Status of node rabbit@ ...
[{pid,32000},
 {running_applications,
...
      {amqp_client,"RabbitMQ AMQP Client","2.5.0"},
      {rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","2.5.0"},

 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B (erts-5.8.1) [source] [64-bit] [smp:2:2] [rq:2]
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,32521808},
      {processes,12841784},
      {processes_used,12810768},
      {system,19680024},
      {atom,1317993},
      {atom_used,1286331},
      {binary,134920},
      {code,15265818},
      {ets,1141032}]}]
...done.

From pieter.baele at gmail.com  Tue Jun 28 12:26:57 2011
From: pieter.baele at gmail.com (Pieter Baele)
Date: Tue, 28 Jun 2011 13:26:57 +0200
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 setting STOMP plugin port
	(bug?)
In-Reply-To: <BANLkTimWEfSkBqPSsDzkcguFVkgjE7RWqg@mail.gmail.com>
References: <BANLkTimWEfSkBqPSsDzkcguFVkgjE7RWqg@mail.gmail.com>
Message-ID: <BANLkTi=TFKGYD3uT_fZiiKcfWsP5AuvM1g@mail.gmail.com>

On Tue, Jun 28, 2011 at 13:15, Pieter Baele <pieter.baele at gmail.com> wrote:
>
> /etc/rabbitmq/rabbitmq.conf
> [ {rabbit_stomp, [{tcp_listeners, [6163]} ]} ]
>

Also not working if I use
{rabbitmq_stomp, [ {tcp_listeners, [6163]} ]}

Maybe i've put this in the wrong place?

From Massimo.Paladin at cern.ch  Tue Jun 28 12:28:50 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 28 Jun 2011 13:28:50 +0200
Subject: [rabbitmq-discuss] rabbitmq.config mnesia settings
Message-ID: <BANLkTi=TZKGGqbrKR7qEURAaRz_3eYC65g@mail.gmail.com>

Hello,

is there a page with the available mnesia settings for rabbitmq.config file?

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/b047bd2e/attachment.htm>

From pieter.baele at gmail.com  Tue Jun 28 12:37:41 2011
From: pieter.baele at gmail.com (Pieter Baele)
Date: Tue, 28 Jun 2011 13:37:41 +0200
Subject: [rabbitmq-discuss] RabbitMQ 2.5.0 setting STOMP plugin port
	(bug?)
In-Reply-To: <BANLkTi=TFKGYD3uT_fZiiKcfWsP5AuvM1g@mail.gmail.com>
References: <BANLkTimWEfSkBqPSsDzkcguFVkgjE7RWqg@mail.gmail.com>
	<BANLkTi=TFKGYD3uT_fZiiKcfWsP5AuvM1g@mail.gmail.com>
Message-ID: <BANLkTi=rYuu_akD-Kw1CM++thgYG53zL2Q@mail.gmail.com>

Ok, it's working with
[{rabbitmq_stomp, [ {tcp_listeners, [6163]} ]}].

in rabbitmq.config



On Tue, Jun 28, 2011 at 13:26, Pieter Baele <pieter.baele at gmail.com> wrote:
> On Tue, Jun 28, 2011 at 13:15, Pieter Baele <pieter.baele at gmail.com> wrote:
>>
>> /etc/rabbitmq/rabbitmq.conf
>> [ {rabbit_stomp, [{tcp_listeners, [6163]} ]} ]
>>
>
> Also not working if I use
> {rabbitmq_stomp, [ {tcp_listeners, [6163]} ]}
>
> Maybe i've put this in the wrong place?
>

From thomas.kant at gmail.com  Tue Jun 28 12:42:39 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Tue, 28 Jun 2011 04:42:39 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Spring
Message-ID: <ea8a0eab-6ea8-4291-9287-1c06a7d3d4b1@z7g2000prh.googlegroups.com>


Hi All,

Can I use RabbitMQ in Spring without spring-amqp.

thanks
+++
thomas.kant

From Massimo.Paladin at cern.ch  Tue Jun 28 12:52:41 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 28 Jun 2011 13:52:41 +0200
Subject: [rabbitmq-discuss] RabbitMQ and log settings
Message-ID: <BANLkTikxaAnN8-cjrK7v4W1GR9DVAJa+vA@mail.gmail.com>

Hello,

through the environment variables it is possible to specify the log base
folder.

How are log files generated? How are they rotated, etc...?

Is this documented somewhere?
Is it possible to customize log rotation by date, size, etc..?

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/d7170431/attachment.htm>

From Massimo.Paladin at cern.ch  Tue Jun 28 12:58:45 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Tue, 28 Jun 2011 13:58:45 +0200
Subject: [rabbitmq-discuss] RabbitMQ and groups of users
Message-ID: <BANLkTinpX8BU1xfcxsteO3Q6feg42dsX6Q@mail.gmail.com>

Hello,

correct me if I am wrong but I haven't seen the possibility to specify
groups of users in RabbitMQ.

It would be great to have this feature.
In an environment with many users it would simplify quite a lot the
permission definition and modification.

Users could be grouped and groups could have their own settings.

Regards,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/e29cb4c2/attachment.htm>

From jim at rabbitmq.com  Tue Jun 28 13:29:39 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Tue, 28 Jun 2011 13:29:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <ea8a0eab-6ea8-4291-9287-1c06a7d3d4b1@z7g2000prh.googlegroups.com>
References: <ea8a0eab-6ea8-4291-9287-1c06a7d3d4b1@z7g2000prh.googlegroups.com>
Message-ID: <BANLkTikus_dES0wFik8brvEWiWxUMk3J=A@mail.gmail.com>

Thomas,

There are some bookmarked links here that provide some alternatives, but
they haven't been updated for a while.
http://www.delicious.com/alexisrichardson/rabbitmq+spring

<http://www.delicious.com/alexisrichardson/rabbitmq+usecase+spring>Jim

On 28 June 2011 12:42, scorpiovn <thomas.kant at gmail.com> wrote:

>
> Hi All,
>
> Can I use RabbitMQ in Spring without spring-amqp.
>
> thanks
> +++
> thomas.kant
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/c1a3deb4/attachment.htm>

From markfisher at vmware.com  Tue Jun 28 14:08:26 2011
From: markfisher at vmware.com (Mark Fisher)
Date: Tue, 28 Jun 2011 06:08:26 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <BANLkTikus_dES0wFik8brvEWiWxUMk3J=A@mail.gmail.com>
Message-ID: <1895784675.72280.1309266505990.JavaMail.root@zimbra-prod-mbox-2.vmware.com>

Thomas, 

Can you please let us know why you want to avoid Spring AMQP? 

FYI, the Open Credo team (creators of the other option listed in Alexis' bookmarks) have been collaborating with us on Spring AMQP. 

Regards, 
Mark 

----- Original Message -----

From: "Jim Apperly" <jim at rabbitmq.com> 
To: "scorpiovn" <thomas.kant at gmail.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Tuesday, June 28, 2011 8:29:39 AM 
Subject: Re: [rabbitmq-discuss] RabbitMQ and Spring 

Thomas, 


There are some bookmarked links here that provide some alternatives, but they haven't been updated for a while. 
http://www.delicious.com/alexisrichardson/rabbitmq+spring 


Jim 


On 28 June 2011 12:42, scorpiovn < thomas.kant at gmail.com > wrote: 



Hi All, 

Can I use RabbitMQ in Spring without spring-amqp. 

thanks 
+++ 
thomas.kant 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 




_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/f6537ff8/attachment-0001.htm>

From matthias at rabbitmq.com  Tue Jun 28 16:14:23 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 Jun 2011 16:14:23 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E089B89.4080009@rabbitmq.com>
References: <4E089B89.4080009@rabbitmq.com>
Message-ID: <4E09EFCF.4010108@rabbitmq.com>

On 27/06/11 16:02, Matthias Radestock wrote:
> What use, if any, are RabbitMQ users finding for AMQP's tx class?

24 hours later and the answers so far are:

- 3 people use tx for publish confirmation
- 1 person uses tx for batching (and, to a degree, atomicity)

Thanks to all respondents.

Surely there must be more than four people using tx though. Don't be 
shy! Speak up!


Matthias.

From michael.s.klishin at gmail.com  Tue Jun 28 18:04:19 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 28 Jun 2011 21:04:19 +0400
Subject: [rabbitmq-discuss] RabbitMQ and log settings
In-Reply-To: <BANLkTikxaAnN8-cjrK7v4W1GR9DVAJa+vA@mail.gmail.com>
References: <BANLkTikxaAnN8-cjrK7v4W1GR9DVAJa+vA@mail.gmail.com>
Message-ID: <BANLkTi=rAHPhk=CoUQgQHWnDz3c6D3zniA@mail.gmail.com>

2011/6/28 Massimo Paladin <Massimo.Paladin at cern.ch>

> How are log files generated? How are they rotated, etc...?
>
> Is this documented somewhere?
> Is it possible to customize log rotation by date, size, etc..?
>

Massimo,

Take a look at http://www.rabbitmq.com/install.html#logging-generic-unix
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/833cca37/attachment.htm>

From michael.s.klishin at gmail.com  Tue Jun 28 18:26:44 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 28 Jun 2011 21:26:44 +0400
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E09EFCF.4010108@rabbitmq.com>
References: <4E089B89.4080009@rabbitmq.com> <4E09EFCF.4010108@rabbitmq.com>
Message-ID: <BANLkTikXEVEDc2LGa0vQ2eSKqNoY6Tf05Q@mail.gmail.com>

2011/6/28 Matthias Radestock <matthias at rabbitmq.com>

> Surely there must be more than four people using tx though. Don't be shy!
> Speak up!


Matthias,

I have been using RabbitMQ since Jan 2009 or so and still do not use
transactions, however, I have one use case that is much easier to
implement with transactions.

Imagine a fairly large (a few terabytes) collection of documents that are
clustered. Clustering can happen around different attributes, lets use date
as example.
Application that does clustering is an AMQP consumer. Because of the nature
of clustering by date, it needs to process N documents at once
(so again, batching), and only then acknowledge RabbitMQ and possibly other
apps.

Prefetching plus message acknowledgements kinda let me build something like
this, however, it will require some extra care on app developer's side.
Note that if consumer app would use RDBMS, there is always a possibility of
doing a rollback there and at least not having inconsistent/incorrect (w.r.t
clustering) data,
but graph databases today typically do not offer transactions and RDBMSes
aren't very good at graph walking.

I hope this counts as useful feedback.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/3d4da000/attachment.htm>

From thomas.kant at gmail.com  Tue Jun 28 19:03:40 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Tue, 28 Jun 2011 11:03:40 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <1895784675.72280.1309266505990.JavaMail.root@zimbra-prod-mbox-2.vmware.com>
References: <1895784675.72280.1309266505990.JavaMail.root@zimbra-prod-mbox-2.vmware.com>
Message-ID: <dcd3fb1c-033a-438c-9bea-632e83eaa772@e17g2000prj.googlegroups.com>

Jim,

Some one said that Spring AMOP make application slow down than pure
ActiveMQ.

On Jun 28, 8:08?pm, Mark Fisher <markfis... at vmware.com> wrote:
> Thomas,
>
> Can you please let us know why you want to avoid Spring AMQP?
>
> FYI, the Open Credo team (creators of the other option listed in Alexis' bookmarks) have been collaborating with us on Spring AMQP.
>
> Regards,
> Mark
>
>
>
>
>
>
>
> ----- Original Message -----
>
> From: "Jim Apperly" <j... at rabbitmq.com>
> To: "scorpiovn" <thomas.k... at gmail.com>
>
> Cc: rabbitmq-disc... at lists.rabbitmq.com
> Sent: Tuesday, June 28, 2011 8:29:39 AM
> Subject: Re: [rabbitmq-discuss] RabbitMQ and Spring
>
> Thomas,
>
> There are some bookmarked links here that provide some alternatives, but they haven't been updated for a while.http://www.delicious.com/alexisrichardson/rabbitmq+spring
>
> Jim
>
> On 28 June 2011 12:42, scorpiovn < thomas.k... at gmail.com > wrote:
>
> Hi All,
>
> Can I use RabbitMQ in Spring without spring-amqp.
>
> thanks
> +++
> thomas.kant
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Tue Jun 28 19:07:35 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 28 Jun 2011 19:07:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <dcd3fb1c-033a-438c-9bea-632e83eaa772@e17g2000prj.googlegroups.com>
References: <1895784675.72280.1309266505990.JavaMail.root@zimbra-prod-mbox-2.vmware.com>
	<dcd3fb1c-033a-438c-9bea-632e83eaa772@e17g2000prj.googlegroups.com>
Message-ID: <CACOPnvdHs-EN-S2VWR-V3jdz_g_y6VUUNb3TiXmM99hNaMehFw@mail.gmail.com>

Thomas

What problem are you trying to solve?

alexis


On Tue, Jun 28, 2011 at 7:03 PM, scorpiovn <thomas.kant at gmail.com> wrote:
> Jim,
>
> Some one said that Spring AMOP make application slow down than pure
> ActiveMQ.
>
> On Jun 28, 8:08?pm, Mark Fisher <markfis... at vmware.com> wrote:
>> Thomas,
>>
>> Can you please let us know why you want to avoid Spring AMQP?
>>
>> FYI, the Open Credo team (creators of the other option listed in Alexis' bookmarks) have been collaborating with us on Spring AMQP.
>>
>> Regards,
>> Mark
>>
>>
>>
>>
>>
>>
>>
>> ----- Original Message -----
>>
>> From: "Jim Apperly" <j... at rabbitmq.com>
>> To: "scorpiovn" <thomas.k... at gmail.com>
>>
>> Cc: rabbitmq-disc... at lists.rabbitmq.com
>> Sent: Tuesday, June 28, 2011 8:29:39 AM
>> Subject: Re: [rabbitmq-discuss] RabbitMQ and Spring
>>
>> Thomas,
>>
>> There are some bookmarked links here that provide some alternatives, but they haven't been updated for a while.http://www.delicious.com/alexisrichardson/rabbitmq+spring
>>
>> Jim
>>
>> On 28 June 2011 12:42, scorpiovn < thomas.k... at gmail.com > wrote:
>>
>> Hi All,
>>
>> Can I use RabbitMQ in Spring without spring-amqp.
>>
>> thanks
>> +++
>> thomas.kant
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From bmurphy1976 at gmail.com  Tue Jun 28 19:48:33 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Tue, 28 Jun 2011 13:48:33 -0500
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E098FF5.2080701@rabbitmq.com>
References: <r422Ps-1067i-571E4352F4DB4C5CA909E2C02690B8F4@thelonious.lan>
	<4E098FF5.2080701@rabbitmq.com>
Message-ID: <BANLkTi=D4oJhBiK0jGAkpB1YxTPt3e83ug@mail.gmail.com>

On Tue, Jun 28, 2011 at 3:25 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
>> My message consumers are idempotent and always check object status in
>> RDBMS before processing messages, so should I fail to commit to RDBMS
>> after having committed to RabbitMQ, those messages will be ignored.
>
> Idempotence is certainly a good thing.
>
> How does the "check object status before processing" work? Couldn't a
> consumer get the message(s) before the rdbms transaction has committed, thus
> not see the up to date status and erroneously ignore the message?

You can do this with some nasty and slow serialized database locks.
We've done something similar to this in the past but it always makes
me question when we are doing something akin to this if RabbitMQ is
the right solution for this particular problem.

We don't use RabbitMQ transactions.  They were too slow and we ended
up having to build other higher level abstractions anyway so they
really aren't all that useful for us.

Bryan

From aar at cpan.org  Tue Jun 28 21:13:45 2011
From: aar at cpan.org (Alessandro Ranellucci)
Date: Tue, 28 Jun 2011 22:13:45 +0200
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E098FF5.2080701@rabbitmq.com>
Message-ID: <r422Ps-1067i-EE8DEA8A85624DA4B8ACBDFC01C9757C@thelonious.lan>

On 28-06-2011 at 10:25, Matthias Radestock wrote:

  >How does the "check object status before processing" work? 
Couldn't a
  >consumer get the message(s) before the rdbms transaction has
  >committed, thus not see the up to date status and erroneously ignore
  >the message?

Message age is a good way to catch that. If it's too recent 
(10s? 30s?), I just reject it to have it redelivered few seconds 
later. When a message becomes too old and the database hasn't 
been updated with a correct status yet, I discard the message. 
Staff is notified then, to check why a RDBMS commit failed or 
why did it take more than 30 seconds.

Actually, by looking at my application logs, no messages were 
ever rejected because of early arrival, so it's a very edge case 
and I can live with the possible overhead of having a message 
delivered twice while the RDBMS commits its transaction.

  >> >Are you relying on tx atomicity at the moment? If so, can you
  >> >elaborate on the specific use case? Also is the "only 
atomic for a
  >> >single queue" restriction of AMQP's tx ok for your app?
  >>
  >>Hmm. Er... that limitation sounds new to me. Didn't pay 
attention :-)
  >
  >So in your app, can the messages inside a tx can end up in multiple
  >queues?

Yes, and I think it could be a common case. For example, a 
transaction in my system may contain:
- a message to "deliver.product.to.customer";
- a message to "charge.prepaid.account";
- a message to "notify.customer.by.sms".

How could I handle that without AMQP transactions?

Alessandro


From matthias at rabbitmq.com  Tue Jun 28 21:41:16 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 28 Jun 2011 21:41:16 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <r422Ps-1067i-EE8DEA8A85624DA4B8ACBDFC01C9757C@thelonious.lan>
References: <r422Ps-1067i-EE8DEA8A85624DA4B8ACBDFC01C9757C@thelonious.lan>
Message-ID: <4E0A3C6C.6040806@rabbitmq.com>

Alessandro,

On 28/06/11 21:13, Alessandro Ranellucci wrote:
> On 28-06-2011 at 10:25, Matthias Radestock wrote:
>  >So in your app, can the messages inside a tx can end up in multiple
>  >queues?
>
> Yes, and I think it could be a common case. For example, a transaction
> in my system may contain:
> - a message to "deliver.product.to.customer";
> - a message to "charge.prepaid.account";
> - a message to "notify.customer.by.sms".
>
> How could I handle that without AMQP transactions?

Well, you cannot actually handle that directly *with* an AMQP 
transaction *as defined in the spec*, since they guarantee atomicity for 
single-queue transactions only (though, as Gordon pointed out, 
implementations are free to extend that to multiple queues, which would 
then be sufficient to do the above).

One way to handle this scenario in RabbitMQ is to put the channel in 
'confirm' mode, send all three messages and wait for the confirmations. 
If there is a failure then re-send the messages that didn't get 
confirmed. That may result in duplicate messages (e.g. if a confirmation 
was lost due to a connection failure), so you'd need to make the 
messages idempotent / do dup detection at the consumer end. But then 
again message duplication is quite prevalent in messaging systems, so an 
app will likely have to deal with that anyway.

This technique is of course is not a direct replacements for 
fully-fledged transactions, but it works remarkably well in many situations.

Looking at your example though makes me wonder why an app would want 
these messages to be delivered atomically anyway. Surely one would want 
to charge the prepaid account first, then, *if that succeeds*, deliver 
the product, then *if that succeeds*, notify the customer. No?


Regards,

Matthias.

From keith at krue.gr  Tue Jun 28 23:44:47 2011
From: keith at krue.gr (Keith Krueger)
Date: Tue, 28 Jun 2011 15:44:47 -0700
Subject: [rabbitmq-discuss] How can I set socket timeouts in PHP using the
	AMQP PHP extension?
Message-ID: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>

I am using the PHP AMQP extension, as described here:

  http://php.net/manual/en/book.amqp.php

This PHP extension uses the rabbitmq-c library as its underlying
implementation.

I would like to set socket timeouts for connection establishment and for
each of my enqueues and dequeues. I want to do this in case our server
performance degrades, to allow the clients to fail quickly rather than hang.

Does anyone have experience doing this in a PHP environment?  I have tried
setting the PHP socket timeout as follows.

  ini_set('default_socket_timeout', 5);

This appears to have no impact on the PHP extension's timeout settings. I am
still able to enqueue a multi-megabyte MQ message to rabbitmq without losing
the socket connection. It takes about 75 seconds to enqueue this message,
but the socket is kept open the entire time.

Is there any support either in the PHP AMQP extension or in a different PHP
setting that I can use to reduce the timeouts for our interactions with
RabbitMQ?  I'd rather not live with a potential problem of hanging client
processes if I can avoid it.

Thanks,

-Keith
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/996b475d/attachment.htm>

From simone.busoli at gmail.com  Wed Jun 29 01:20:51 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 29 Jun 2011 02:20:51 +0200
Subject: [rabbitmq-discuss] RabbitMQ and log settings
In-Reply-To: <BANLkTi=rAHPhk=CoUQgQHWnDz3c6D3zniA@mail.gmail.com>
References: <BANLkTikxaAnN8-cjrK7v4W1GR9DVAJa+vA@mail.gmail.com>
	<BANLkTi=rAHPhk=CoUQgQHWnDz3c6D3zniA@mail.gmail.com>
Message-ID: <BANLkTikjCh=tqZq+C4o0aCQgm4TAxbFD+A@mail.gmail.com>

What about poor Windows guys? ;-)
On Jun 28, 2011 7:05 PM, "Michael Klishin" <michael.s.klishin at gmail.com>
wrote:
> 2011/6/28 Massimo Paladin <Massimo.Paladin at cern.ch>
>
>> How are log files generated? How are they rotated, etc...?
>>
>> Is this documented somewhere?
>> Is it possible to customize log rotation by date, size, etc..?
>>
>
> Massimo,
>
> Take a look at http://www.rabbitmq.com/install.html#logging-generic-unix
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/7aa3acd3/attachment.htm>

From habtdemis at gmail.com  Wed Jun 29 03:02:50 2011
From: habtdemis at gmail.com (Demiss Zike)
Date: Tue, 28 Jun 2011 21:02:50 -0500
Subject: [rabbitmq-discuss] Error while compiling Send.cs from hello world
	tutorial
Message-ID: <BANLkTin5W4zcz1uhfTwVoKH5GRG-0W_Qfg@mail.gmail.com>

When I try to compile a sample C# program in command line I get the error:

CS2005: Missing file specification for `/r:' option

Any ideas on how it happens? I have successfully installed the RabbitMQ
server, the RabbitMQ .NET/C# AMQP client library and copied the
RabbitMQ.Client.dll into my working folder and this is how I tried to
compile Send.cs:

csc '/r:' "RabbitMQ.Client.dll"  Send.cs


Regards,
Demi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110628/3535e844/attachment.htm>

From thomas.kant at gmail.com  Wed Jun 29 03:39:06 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Tue, 28 Jun 2011 19:39:06 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <CACOPnvdHs-EN-S2VWR-V3jdz_g_y6VUUNb3TiXmM99hNaMehFw@mail.gmail.com>
References: <1895784675.72280.1309266505990.JavaMail.root@zimbra-prod-mbox-2.vmware.com>
	<dcd3fb1c-033a-438c-9bea-632e83eaa772@e17g2000prj.googlegroups.com>
	<CACOPnvdHs-EN-S2VWR-V3jdz_g_y6VUUNb3TiXmM99hNaMehFw@mail.gmail.com>
Message-ID: <526f548d-5bee-48e3-ac51-0d5958c5b43d@j14g2000prn.googlegroups.com>

Alexis,

Some one said that Spring AMOP make application slow down than pure
ActiveMQ.

On Jun 29, 1:07?am, Alexis Richardson <ale... at rabbitmq.com> wrote:
> Thomas
>
> What problem are you trying to solve?
>
> alexis
>
>
>
>
>
>
>
>
>
> On Tue, Jun 28, 2011 at 7:03 PM, scorpiovn <thomas.k... at gmail.com> wrote:
> > Jim,
>
> > Some one said that Spring AMOP make application slow down than pure
> > ActiveMQ.
>
> > On Jun 28, 8:08?pm, Mark Fisher <markfis... at vmware.com> wrote:
> >> Thomas,
>
> >> Can you please let us know why you want to avoid Spring AMQP?
>
> >> FYI, the Open Credo team (creators of the other option listed in Alexis' bookmarks) have been collaborating with us on Spring AMQP.
>
> >> Regards,
> >> Mark
>
> >> ----- Original Message -----
>
> >> From: "Jim Apperly" <j... at rabbitmq.com>
> >> To: "scorpiovn" <thomas.k... at gmail.com>
>
> >> Cc: rabbitmq-disc... at lists.rabbitmq.com
> >> Sent: Tuesday, June 28, 2011 8:29:39 AM
> >> Subject: Re: [rabbitmq-discuss] RabbitMQ and Spring
>
> >> Thomas,
>
> >> There are some bookmarked links here that provide some alternatives, but they haven't been updated for a while.http://www.delicious.com/alexisrichardson/rabbitmq+spring
>
> >> Jim
>
> >> On 28 June 2011 12:42, scorpiovn < thomas.k... at gmail.com > wrote:
>
> >> Hi All,
>
> >> Can I use RabbitMQ in Spring without spring-amqp.
>
> >> thanks
> >> +++
> >> thomas.kant
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gmr at myyearbook.com  Wed Jun 29 04:08:36 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 28 Jun 2011 23:08:36 -0400
Subject: [rabbitmq-discuss] How can I set socket timeouts in PHP using
 the AMQP PHP extension?
In-Reply-To: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>
References: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>
Message-ID: <A03783F8664B4022A4094188D8A718E7@myyearbook.com>

While not directly related to your question and you've not specified your use case, I have found trying to use native AMQP drivers in my PHP application as having too much overhead for connection management and iirc the existing implementations do not have connection pooling. This means lots of startup time and overhead on every request. To get around this we created a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all you are doing is publishing, you might want to check out VorpalBunny:
https://github.com/myyearbook/VorpalBunny/
As far as the underlying implementation, it's worth noting that the rabbitmq-c library is considered experimental. While we use it in our C applications in production, I can't say that we use the PHP extension on top of it. The PHP site has fatal errors for me right now so I can't look up to see which PHP extension the code is based on, otherwise I'd poke into the code and let you know if there are any timeout settings.
Gavin
On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
> I am using the PHP AMQP extension, as described here:
> 
> http://php.net/manual/en/book.amqp.php
> 
> This PHP extension uses the rabbitmq-c library as its underlying implementation.
> 
> I would like to set socket timeouts for connection establishment and for each of my enqueues and dequeues. I want to do this in case our server performance degrades, to allow the clients to fail quickly rather than hang.
> 
> Does anyone have experience doing this in a PHP environment? I have tried setting the PHP socket timeout as follows.
> 
>  ini_set('default_socket_timeout', 5);
> 
> This appears to have no impact on the PHP extension's timeout settings. I am still able to enqueue a multi-megabyte MQ message to rabbitmq without losing the socket connection. It takes about 75 seconds to enqueue this message, but the socket is kept open the entire time.
> 
> Is there any support either in the PHP AMQP extension or in a different PHP setting that I can use to reduce the timeouts for our interactions with RabbitMQ? I'd rather not live with a potential problem of hanging client processes if I can avoid it. 
> 
> Thanks,
> 
> -Keith
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From Jason.Klassen at protegra.com  Wed Jun 29 06:02:21 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Wed, 29 Jun 2011 05:02:21 +0000
Subject: [rabbitmq-discuss] accessRequest?
Message-ID: <676E1597FDBED54694CBA16B69DE71C303351A@PTGMAIL02v.protegra.com>

I'm upgrading a project from the Rabbit 1.4 java client to 2.5.1.  I used to do

val ticket = channel.accessRequest( "/data" )

and get an int back.   What is the equivalent that I can do in 2.5.1?

________________________________
Jason Klassen
Protegra
   Business. Technology. Solutions.

Office:   204-272-2290
www.protegra.com<http://www.protegra.com>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/ba33664c/attachment-0001.htm>

From Jason.Klassen at protegra.com  Wed Jun 29 06:07:34 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Wed, 29 Jun 2011 05:07:34 +0000
Subject: [rabbitmq-discuss] examples of using basicPublish, basicConsume?
Message-ID: <676E1597FDBED54694CBA16B69DE71C3033530@PTGMAIL02v.protegra.com>

Another question about upgrading from Rabbit 1.4 java client to 2.5.1.  I used to do

      channel.basicPublish(ticket, exchange, routingKey, null, bytes.toByteArray )

and

    channel.basicConsume( ticket, false, queueName, myDefaultConsumer)

Is it appropriate to just omit ticket?  If not, what is the equivalent that I can do in 2.5.1 for these methods?

Also where can I find information about basicPublish, basicConsume? The javadoc for channel http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.0/rabbitmq-java-client-javadoc-2.5.0/com/rabbitmq/client/AMQP.Channel.html does not seem to indicate available methods so I'm doing some guessing here.

Thanks,
Jason Klassen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/a4a23f8d/attachment.htm>

From simone.busoli at gmail.com  Wed Jun 29 06:51:34 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Wed, 29 Jun 2011 07:51:34 +0200
Subject: [rabbitmq-discuss] Error while compiling Send.cs from hello
	world tutorial
In-Reply-To: <BANLkTin5W4zcz1uhfTwVoKH5GRG-0W_Qfg@mail.gmail.com>
References: <BANLkTin5W4zcz1uhfTwVoKH5GRG-0W_Qfg@mail.gmail.com>
Message-ID: <BANLkTi=jcYUY_RU+kHeU8kYOwDTw9freAA@mail.gmail.com>

Hi Demi, they are not the official tutorials but I've rewritten the ones you
find on rabbitmq website in C#, you can find them here:
http://code.google.com/p/mexexp/source/browse/#svn%2Ftrunk%2FRabbitMQ
On Jun 29, 2011 4:03 AM, "Demiss Zike" <habtdemis at gmail.com> wrote:
> When I try to compile a sample C# program in command line I get the error:
>
> CS2005: Missing file specification for `/r:' option
>
> Any ideas on how it happens? I have successfully installed the RabbitMQ
> server, the RabbitMQ .NET/C# AMQP client library and copied the
> RabbitMQ.Client.dll into my working folder and this is how I tried to
> compile Send.cs:
>
> csc '/r:' "RabbitMQ.Client.dll" Send.cs
>
>
> Regards,
> Demi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/475ed7dc/attachment.htm>

From irmo.manie at gmail.com  Wed Jun 29 07:02:55 2011
From: irmo.manie at gmail.com (Irmo Manie)
Date: Wed, 29 Jun 2011 08:02:55 +0200
Subject: [rabbitmq-discuss] RabbitMQ and Spring
In-Reply-To: <526f548d-5bee-48e3-ac51-0d5958c5b43d@j14g2000prn.googlegroups.com>
References: <1895784675.72280.1309266505990.JavaMail.root@zimbra-prod-mbox-2.vmware.com>
	<dcd3fb1c-033a-438c-9bea-632e83eaa772@e17g2000prj.googlegroups.com>
	<CACOPnvdHs-EN-S2VWR-V3jdz_g_y6VUUNb3TiXmM99hNaMehFw@mail.gmail.com>
	<526f548d-5bee-48e3-ac51-0d5958c5b43d@j14g2000prn.googlegroups.com>
Message-ID: <BANLkTimfU50FrhEfEK1fNwyN3=KYOkRyJQ@mail.gmail.com>

But as Alexis said:
What problem are you trying to solve?
How much does spring amqp slow you down? Do you have a comparison or
is it just 'something you've heared'?

In any case, the rabbit java library is just java code and as any java
code this is of course also usable via spring.
No rocket science there ;-)

- Irmo

On Wed, Jun 29, 2011 at 4:39 AM, scorpiovn <thomas.kant at gmail.com> wrote:
> Alexis,
>
> Some one said that Spring AMOP make application slow down than pure
> ActiveMQ.
>
> On Jun 29, 1:07?am, Alexis Richardson <ale... at rabbitmq.com> wrote:
>> Thomas
>>
>> What problem are you trying to solve?
>>
>> alexis
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> On Tue, Jun 28, 2011 at 7:03 PM, scorpiovn <thomas.k... at gmail.com> wrote:
>> > Jim,
>>
>> > Some one said that Spring AMOP make application slow down than pure
>> > ActiveMQ.
>>
>> > On Jun 28, 8:08?pm, Mark Fisher <markfis... at vmware.com> wrote:
>> >> Thomas,
>>
>> >> Can you please let us know why you want to avoid Spring AMQP?
>>
>> >> FYI, the Open Credo team (creators of the other option listed in Alexis' bookmarks) have been collaborating with us on Spring AMQP.
>>
>> >> Regards,
>> >> Mark
>>
>> >> ----- Original Message -----
>>
>> >> From: "Jim Apperly" <j... at rabbitmq.com>
>> >> To: "scorpiovn" <thomas.k... at gmail.com>
>>
>> >> Cc: rabbitmq-disc... at lists.rabbitmq.com
>> >> Sent: Tuesday, June 28, 2011 8:29:39 AM
>> >> Subject: Re: [rabbitmq-discuss] RabbitMQ and Spring
>>
>> >> Thomas,
>>
>> >> There are some bookmarked links here that provide some alternatives, but they haven't been updated for a while.http://www.delicious.com/alexisrichardson/rabbitmq+spring
>>
>> >> Jim
>>
>> >> On 28 June 2011 12:42, scorpiovn < thomas.k... at gmail.com > wrote:
>>
>> >> Hi All,
>>
>> >> Can I use RabbitMQ in Spring without spring-amqp.
>>
>> >> thanks
>> >> +++
>> >> thomas.kant
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-disc... at lists.rabbitmq.com
>> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Wed Jun 29 07:17:59 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 Jun 2011 07:17:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ and log settings
In-Reply-To: <BANLkTikjCh=tqZq+C4o0aCQgm4TAxbFD+A@mail.gmail.com>
References: <BANLkTikxaAnN8-cjrK7v4W1GR9DVAJa+vA@mail.gmail.com>	<BANLkTi=rAHPhk=CoUQgQHWnDz3c6D3zniA@mail.gmail.com>
	<BANLkTikjCh=tqZq+C4o0aCQgm4TAxbFD+A@mail.gmail.com>
Message-ID: <4E0AC397.5000204@rabbitmq.com>

On 29/06/11 01:20, Simone Busoli wrote:
> What about poor Windows guys? ;-)

rabbitmqctl rotate_logs {suffix}


Matthias.

From emile at rabbitmq.com  Wed Jun 29 08:30:31 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 29 Jun 2011 08:30:31 +0100
Subject: [rabbitmq-discuss] accessRequest?
In-Reply-To: <676E1597FDBED54694CBA16B69DE71C303351A@PTGMAIL02v.protegra.com>
References: <676E1597FDBED54694CBA16B69DE71C303351A@PTGMAIL02v.protegra.com>
Message-ID: <4E0AD497.4060803@rabbitmq.com>

Hi Jason,

Op 29/06/11 06:02, het Jason Klassen geskryf:
> I?m upgrading a project from the Rabbit 1.4 java client to 2.5.1.  I
> used to do
> 
>  
> 
> val ticket = channel.accessRequest( "/data" )
> 
>  
> 
> and get an int back.   What is the equivalent that I can do in 2.5.1?

Upgrading is a very good idea. You will probably find that the client
API's have also changed a bit since 1.4 .

The "Access" class was deprecated in AMQP 0-9-1 - see
http://www.rabbitmq.com/specification.html#deprecated-classes

RabbitMQ still implements access.request as a no-op for
backwards-compatibility, but you should not rely on it to be present in
future versions. You don't need tickets anymore, so remove the call.

VHosts play a similar role to realms. The admin guide has information on
how to set them up: http://www.rabbitmq.com/admin-guide.html#access-control




-Emile



From harvey.robin at gmail.com  Wed Jun 29 09:03:44 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Wed, 29 Jun 2011 09:03:44 +0100
Subject: [rabbitmq-discuss] How can I set socket timeouts in PHP using
 the AMQP PHP extension?
In-Reply-To: <BANLkTi=guqWeRyYU4ZiPYg_jhL3Wtz-3Cw@mail.gmail.com>
References: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>
	<A03783F8664B4022A4094188D8A718E7@myyearbook.com>
	<BANLkTi=guqWeRyYU4ZiPYg_jhL3Wtz-3Cw@mail.gmail.com>
Message-ID: <BANLkTi=6jdXYFjhj8RntfubZ9GqnBqoaBQ@mail.gmail.com>

Hi,


My own PHP / AMQP library has an API that lets you set timeouts on the
socket select function:

https://github.com/BraveSirRobin/amqphp

There's documentation here:

https://github.com/BraveSirRobin/amqphp/wiki/Documentation


If you look at the demo consumer demo file it shows you how to do this:

https://github.com/BraveSirRobin/amqphp/blob/master/demos/demo-consumer.php#L93

The easiest way to install the library is to download the 0.9.0 tag, which
includes all generated code needed to get up and running quickly.


Thanks,
--Robin



On Wed, Jun 29, 2011 at 4:08 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> While not directly related to your question and you've not specified your
> use case, I have found trying to use native AMQP drivers in my PHP
> application as having too much overhead for connection management and iirc
> the existing implementations do not have connection pooling. This means lots
> of startup time and overhead on every request. To get around this we created
> a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all
> you are doing is publishing, you might want to check out VorpalBunny:
> https://github.com/myyearbook/VorpalBunny/
> As far as the underlying implementation, it's worth noting that the
> rabbitmq-c library is considered experimental. While we use it in our C
> applications in production, I can't say that we use the PHP extension on top
> of it. The PHP site has fatal errors for me right now so I can't look up to
> see which PHP extension the code is based on, otherwise I'd poke into the
> code and let you know if there are any timeout settings.
> Gavin
> On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
> > I am using the PHP AMQP extension, as described here:
> >
> > http://php.net/manual/en/book.amqp.php
> >
> > This PHP extension uses the rabbitmq-c library as its underlying
> implementation.
> >
> > I would like to set socket timeouts for connection establishment and for
> each of my enqueues and dequeues. I want to do this in case our server
> performance degrades, to allow the clients to fail quickly rather than hang.
> >
> > Does anyone have experience doing this in a PHP environment? I have tried
> setting the PHP socket timeout as follows.
> >
> >  ini_set('default_socket_timeout', 5);
> >
> > This appears to have no impact on the PHP extension's timeout settings. I
> am still able to enqueue a multi-megabyte MQ message to rabbitmq without
> losing the socket connection. It takes about 75 seconds to enqueue this
> message, but the socket is kept open the entire time.
> >
> > Is there any support either in the PHP AMQP extension or in a different
> PHP setting that I can use to reduce the timeouts for our interactions with
> RabbitMQ? I'd rather not live with a potential problem of hanging client
> processes if I can avoid it.
> >
> > Thanks,
> >
> > -Keith
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:
> rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/34b2e7de/attachment-0001.htm>

From harvey.robin at gmail.com  Wed Jun 29 09:08:33 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Wed, 29 Jun 2011 09:08:33 +0100
Subject: [rabbitmq-discuss] How can I set socket timeouts in PHP using
 the AMQP PHP extension?
In-Reply-To: <A03783F8664B4022A4094188D8A718E7@myyearbook.com>
References: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>
	<A03783F8664B4022A4094188D8A718E7@myyearbook.com>
Message-ID: <BANLkTinRG2rQ8Rv9Tsma=M_cnW1cEq2wug@mail.gmail.com>

BTW, Gavin, on this point:

> iirc the existing implementations do not have connection pooling

I've recently updated amqphp so that you can manage multiple connections at
the same time, so for example you can connect to and consume from 2 or more
different brokers at the same time.  There's a demo here:

https://github.com/BraveSirRobin/amqphp/blob/master/demos/demo-multi-consumer.php

Thanks,
--Robin

On Wed, Jun 29, 2011 at 4:08 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> While not directly related to your question and you've not specified your
> use case, I have found trying to use native AMQP drivers in my PHP
> application as having too much overhead for connection management and iirc
> the existing implementations do not have connection pooling. This means lots
> of startup time and overhead on every request. To get around this we created
> a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all
> you are doing is publishing, you might want to check out VorpalBunny:
> https://github.com/myyearbook/VorpalBunny/
> As far as the underlying implementation, it's worth noting that the
> rabbitmq-c library is considered experimental. While we use it in our C
> applications in production, I can't say that we use the PHP extension on top
> of it. The PHP site has fatal errors for me right now so I can't look up to
> see which PHP extension the code is based on, otherwise I'd poke into the
> code and let you know if there are any timeout settings.
> Gavin
> On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
> > I am using the PHP AMQP extension, as described here:
> >
> > http://php.net/manual/en/book.amqp.php
> >
> > This PHP extension uses the rabbitmq-c library as its underlying
> implementation.
> >
> > I would like to set socket timeouts for connection establishment and for
> each of my enqueues and dequeues. I want to do this in case our server
> performance degrades, to allow the clients to fail quickly rather than hang.
> >
> > Does anyone have experience doing this in a PHP environment? I have tried
> setting the PHP socket timeout as follows.
> >
> >  ini_set('default_socket_timeout', 5);
> >
> > This appears to have no impact on the PHP extension's timeout settings. I
> am still able to enqueue a multi-megabyte MQ message to rabbitmq without
> losing the socket connection. It takes about 75 seconds to enqueue this
> message, but the socket is kept open the entire time.
> >
> > Is there any support either in the PHP AMQP extension or in a different
> PHP setting that I can use to reduce the timeouts for our interactions with
> RabbitMQ? I'd rather not live with a potential problem of hanging client
> processes if I can avoid it.
> >
> > Thanks,
> >
> > -Keith
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:
> rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/620f929c/attachment.htm>

From matthew at rabbitmq.com  Wed Jun 29 09:18:45 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 29 Jun 2011 09:18:45 +0100
Subject: [rabbitmq-discuss] examples of using basicPublish, basicConsume?
In-Reply-To: <676E1597FDBED54694CBA16B69DE71C3033530@PTGMAIL02v.protegra.com>
References: <676E1597FDBED54694CBA16B69DE71C3033530@PTGMAIL02v.protegra.com>
Message-ID: <20110629081845.GA2654@rabbitmq.com>

Morning Jason,

On Wed, Jun 29, 2011 at 05:07:34AM +0000, Jason Klassen wrote:
> Another question about upgrading from Rabbit 1.4 java client to 2.5.1.  I used to do
> 
>       channel.basicPublish(ticket, exchange, routingKey, null, bytes.toByteArray )
> 
> and
> 
>     channel.basicConsume( ticket, false, queueName, myDefaultConsumer)
> 
> Is it appropriate to just omit ticket?

Yes.

> Also where can I find information about basicPublish, basicConsume? The javadoc for channel http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.0/rabbitmq-java-client-javadoc-2.5.0/com/rabbitmq/client/AMQP.Channel.html does not seem to indicate available methods so I'm doing some guessing here.

http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.0/rabbitmq-java-client-javadoc-2.5.0/com/rabbitmq/client/Channel.html

Best wishes,

Matthew

From emile at rabbitmq.com  Wed Jun 29 09:24:21 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 29 Jun 2011 09:24:21 +0100
Subject: [rabbitmq-discuss] Error while compiling Send.cs from hello
 world tutorial
In-Reply-To: <BANLkTin5W4zcz1uhfTwVoKH5GRG-0W_Qfg@mail.gmail.com>
References: <BANLkTin5W4zcz1uhfTwVoKH5GRG-0W_Qfg@mail.gmail.com>
Message-ID: <4E0AE135.6070001@rabbitmq.com>

Hi Demiss,

Op 29/06/11 03:02, het Demiss Zike geskryf:
> When I try to compile a sample C# program in command line I get the error:
> 
> CS2005: Missing file specification for `/r:' option
> 
> Any ideas on how it happens? I have successfully installed the RabbitMQ
> server, the RabbitMQ .NET/C# AMQP client library and copied the
> RabbitMQ.Client.dll into my working folder and this is how I tried to
> compile Send.cs:
> 
> csc '/r:' "RabbitMQ.Client.dll"  Send.cs

This works for me:

csc /r:RabbitMQ.Client.dll  Send.cs

You need to make sure that RabbitMQ.Client.dll can be found by the
linker by installing in the GAC or at least temporarily placing it in
the same folder as the source.


-Emile

From arno.puschmann at acodeas.de  Wed Jun 29 14:34:08 2011
From: arno.puschmann at acodeas.de (Arno Puschmann)
Date: Wed, 29 Jun 2011 15:34:08 +0200
Subject: [rabbitmq-discuss] reading time extending on persistent messages
Message-ID: <27D6B27DB616654BBEF4DDB8B31EAF916B590E951E@vs-msx01.IT-NG.local>

I'm using rabbitmq 2.4.1 on a Ubuntu 10.04. I tested to write  a large number (300k) of messages to an persistent queue. Alle messages are the same and have a size of 1KB. After this I restartet my system and rabbitmq, to go save that nothing is on the memory but all on disk. After restarting all, I startet a consumer to readout the messages. Now I noticed that reading out the persistent messages took always longer. I measured the time for reading out every interval of 3k messages. For example, to readout the first 3k messages it took under 1sec. After 45k messages it took over 10sec. to readout the next 3k messages. After reading 165k messages it took about 30sec. to read the next 3000 messages. I have repeat these test several times always with a similar result.

Can anybody explain these behaviour or have a solution for this problem?
I tried also ActiveMQ and HornetQ under the same requirements without such behaviour.
Thanks.

Here my programmcode

	ConnectionFactory factory = new ConnectionFactory();
	factory.setHost("localhost");

	Connection connection = factory.newConnection();
	Channel channel = connection.createChannel();

	QueueingConsumer consumer = new QueueingConsumer(channel);
	channel.exchangeDeclare(EXCHANGE_NAME, "direct", true);
	channel.queueDeclare(QUEUE_NAME, true, false, false, null);
	channel.basicConsume(QUEUE_NAME, true, consumer);
	channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, "111");

	System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

	int i=0;
	long start = System.currentTimeMillis();
	while (true)
	{

		QueueingConsumer.Delivery delivery = consumer.nextDelivery();
		String message = new String(delivery.getBody());

		i++;
		if(i == 3000)
		{
			System.out.println("The last 3000 Messages needed " + (System.currentTimeMillis() - start));
			start = System.currentTimeMillis();
			i=0;
		}
	}

From gmr at myyearbook.com  Wed Jun 29 14:47:17 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 29 Jun 2011 09:47:17 -0400
Subject: [rabbitmq-discuss] How can I set socket timeouts in PHP using
 the AMQP PHP extension?
In-Reply-To: <BANLkTinRG2rQ8Rv9Tsma=M_cnW1cEq2wug@mail.gmail.com>
References: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>
	<A03783F8664B4022A4094188D8A718E7@myyearbook.com>
	<BANLkTinRG2rQ8Rv9Tsma=M_cnW1cEq2wug@mail.gmail.com>
Message-ID: <BANLkTik=U3-nTTxivnWmm5SB0sXW0__aUA@mail.gmail.com>

Cool, I meant persistent, such as with the mysql_pconnect or pgsql_pconnect.

Thanks for the work on amqphp, will look deeper at it for use in other
areas. I'm glad there is an active, maintained client!

Gavin

On Wed, Jun 29, 2011 at 4:08 AM, Robin Harvey <harvey.robin at gmail.com>wrote:

> BTW, Gavin, on this point:
>
>
> > iirc the existing implementations do not have connection pooling
>
> I've recently updated amqphp so that you can manage multiple connections at
> the same time, so for example you can connect to and consume from 2 or more
> different brokers at the same time.  There's a demo here:
>
>
> https://github.com/BraveSirRobin/amqphp/blob/master/demos/demo-multi-consumer.php
>
> Thanks,
> --Robin
>
> On Wed, Jun 29, 2011 at 4:08 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>
>> While not directly related to your question and you've not specified your
>> use case, I have found trying to use native AMQP drivers in my PHP
>> application as having too much overhead for connection management and iirc
>> the existing implementations do not have connection pooling. This means lots
>> of startup time and overhead on every request. To get around this we created
>> a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all
>> you are doing is publishing, you might want to check out VorpalBunny:
>> https://github.com/myyearbook/VorpalBunny/
>> As far as the underlying implementation, it's worth noting that the
>> rabbitmq-c library is considered experimental. While we use it in our C
>> applications in production, I can't say that we use the PHP extension on top
>> of it. The PHP site has fatal errors for me right now so I can't look up to
>> see which PHP extension the code is based on, otherwise I'd poke into the
>> code and let you know if there are any timeout settings.
>> Gavin
>> On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
>> > I am using the PHP AMQP extension, as described here:
>> >
>> > http://php.net/manual/en/book.amqp.php
>> >
>> > This PHP extension uses the rabbitmq-c library as its underlying
>> implementation.
>> >
>> > I would like to set socket timeouts for connection establishment and for
>> each of my enqueues and dequeues. I want to do this in case our server
>> performance degrades, to allow the clients to fail quickly rather than hang.
>> >
>> > Does anyone have experience doing this in a PHP environment? I have
>> tried setting the PHP socket timeout as follows.
>> >
>> >  ini_set('default_socket_timeout', 5);
>> >
>> > This appears to have no impact on the PHP extension's timeout settings.
>> I am still able to enqueue a multi-megabyte MQ message to rabbitmq without
>> losing the socket connection. It takes about 75 seconds to enqueue this
>> message, but the socket is kept open the entire time.
>> >
>> > Is there any support either in the PHP AMQP extension or in a different
>> PHP setting that I can use to reduce the timeouts for our interactions with
>> RabbitMQ? I'd rather not live with a potential problem of hanging client
>> processes if I can avoid it.
>> >
>> > Thanks,
>> >
>> > -Keith
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com (mailto:
>> rabbitmq-discuss at lists.rabbitmq.com)
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/e89cbb43/attachment.htm>

From kuleshovmail at gmail.com  Wed Jun 29 14:57:41 2011
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Wed, 29 Jun 2011 13:57:41 +0000
Subject: [rabbitmq-discuss] Send message from erlang client problem
Message-ID: <BANLkTik5=cYpv9t1LvPdZtkNdvXKtgpbYQ@mail.gmail.com>

Hello,

I try to send messsage to rabbitmq-server:

send_message(Channel, Host, Password, Message) ->
    % TODO maybe change routing_key on sit_in_reply
    amqp_channel:cast(Channel, #'basic.publish'{exchange = <<"">>},
routing_key = <<"test">>,
		      #amqp_msg{payload = Message}).

But get error:

Error in process <0.431.0> with exit value:
{function_clause,[{gen_server,cast, [2,{cast,{'basic.publish',0,<<0
bytes>>,<<7 bytes>>,false,false},
{amqp_msg,{'P_basic',undefined,undefined,undefined,undefined,undefined,undefined,
undefined,undefined,undefined,undefined,undefined...

How can i fix it? How can i correctly send message to rabbitmq-server?

Thank you.

From habtdemis at gmail.com  Wed Jun 29 14:53:20 2011
From: habtdemis at gmail.com (Demiss Zike)
Date: Wed, 29 Jun 2011 08:53:20 -0500
Subject: [rabbitmq-discuss] Error while compiling Send.cs from hello
	world tutorial
In-Reply-To: <4E0AE135.6070001@rabbitmq.com>
References: <BANLkTin5W4zcz1uhfTwVoKH5GRG-0W_Qfg@mail.gmail.com>
	<4E0AE135.6070001@rabbitmq.com>
Message-ID: <BANLkTi=fYFwSHerqat2psSkYZE7H9xXdKg@mail.gmail.com>

Great! Thanks, it compiled now. But I am encountered with the following
error:



Regards,
Demi

On Wed, Jun 29, 2011 at 3:24 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Demiss,
>
> Op 29/06/11 03:02, het Demiss Zike geskryf:
> > When I try to compile a sample C# program in command line I get the
> error:
> >
> > CS2005: Missing file specification for `/r:' option
> >
> > Any ideas on how it happens? I have successfully installed the RabbitMQ
> > server, the RabbitMQ .NET/C# AMQP client library and copied the
> > RabbitMQ.Client.dll into my working folder and this is how I tried to
> > compile Send.cs:
> >
> > csc '/r:' "RabbitMQ.Client.dll"  Send.cs
>
> This works for me:
>
> csc /r:RabbitMQ.Client.dll  Send.cs
>
> You need to make sure that RabbitMQ.Client.dll can be found by the
> linker by installing in the GAC or at least temporarily placing it in
> the same folder as the source.
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/5e1efc05/attachment-0001.htm>

From cory.maksymchuk at protegra.com  Wed Jun 29 14:53:44 2011
From: cory.maksymchuk at protegra.com (Cory Maksymchuk)
Date: Wed, 29 Jun 2011 13:53:44 +0000
Subject: [rabbitmq-discuss] examples of using basicPublish, basicConsume?
In-Reply-To: <676E1597FDBED54694CBA16B69DE71C3033530@PTGMAIL02v.protegra.com>
References: <676E1597FDBED54694CBA16B69DE71C3033530@PTGMAIL02v.protegra.com>
Message-ID: <EC895F226501DD43BAC4DFEBC226F85901C6F4@PTGMAIL02v.protegra.com>

Hi Jason,



Try here for the javadoc:



http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.0/rabbitmq-java-client-javadoc-2.5.0/com/rabbitmq/client/Channel.html

Cheers,

Cory



________________________________
From: Jason Klassen
Sent: Wednesday, June 29, 2011 12:07 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: examples of using basicPublish, basicConsume?

Another question about upgrading from Rabbit 1.4 java client to 2.5.1.  I used to do

      channel.basicPublish(ticket, exchange, routingKey, null, bytes.toByteArray )

and

    channel.basicConsume( ticket, false, queueName, myDefaultConsumer)

Is it appropriate to just omit ticket?  If not, what is the equivalent that I can do in 2.5.1 for these methods?

Also where can I find information about basicPublish, basicConsume? The javadoc for channel http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.0/rabbitmq-java-client-javadoc-2.5.0/com/rabbitmq/client/AMQP.Channel.html does not seem to indicate available methods so I?m doing some guessing here.

Thanks,
Jason Klassen

From habtdemis at gmail.com  Wed Jun 29 14:55:43 2011
From: habtdemis at gmail.com (Demiss Zike)
Date: Wed, 29 Jun 2011 08:55:43 -0500
Subject: [rabbitmq-discuss] Error while compiling Send.cs from hello
	world tutorial
In-Reply-To: <4E0AE135.6070001@rabbitmq.com>
References: <BANLkTin5W4zcz1uhfTwVoKH5GRG-0W_Qfg@mail.gmail.com>
	<4E0AE135.6070001@rabbitmq.com>
Message-ID: <BANLkTi=Om9nP7Sw-JFbTLrBsMEsRwysVuQ@mail.gmail.com>

Great! Thanks, it compiled now. But I am encountered with the following
error:

Regards,
Demi

On Wed, Jun 29, 2011 at 3:24 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Demiss,
>
> Op 29/06/11 03:02, het Demiss Zike geskryf:
> > When I try to compile a sample C# program in command line I get the
> error:
> >
> > CS2005: Missing file specification for `/r:' option
> >
> > Any ideas on how it happens? I have successfully installed the RabbitMQ
> > server, the RabbitMQ .NET/C# AMQP client library and copied the
> > RabbitMQ.Client.dll into my working folder and this is how I tried to
> > compile Send.cs:
> >
> > csc '/r:' "RabbitMQ.Client.dll"  Send.cs
>
> This works for me:
>
> csc /r:RabbitMQ.Client.dll  Send.cs
>
> You need to make sure that RabbitMQ.Client.dll can be found by the
> linker by installing in the GAC or at least temporarily placing it in
> the same folder as the source.
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/f9fa382c/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: New Picture (9).bmp
Type: image/bmp
Size: 1509654 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/f9fa382c/attachment-0001.bin>

From gswallow at exacttarget.com  Wed Jun 29 15:28:35 2011
From: gswallow at exacttarget.com (Greg Swallow)
Date: Wed, 29 Jun 2011 10:28:35 -0400
Subject: [rabbitmq-discuss] Plugin filenames
Message-ID: <567A8770-35D1-4B31-9DC2-C0D01B32F576@exacttarget.com>

Hi,

I brought this up on IRC, and was asked to bring it up on the mailing list.  I have written a pedestrian little cookbook for chef that installs RabbitMQ plugins.  It does something like this:

node[:rabbitmq_plugins][:plugin_list].each do |plugin|
  remote_file "#{plugin}" do
    source ( "#{node[:rabbitmq_plugins][:remote_file_uri]}" + "#{plugin}" + "-" + "#{node[:rabbitmq][:version]}" + ".ez" )
    path ( "#{node[:rabbitmq][:prefixdir]}" + "/plugins/" + "#{plugin}" + "-" + "#{node[:rabbitmq][:version]}" + ".ez" )
    backup false
    owner "rabbitmq"
    group "rabbitmq"
    action :create_if_missing
    notifies :restart, "service[rabbitmq-server]"
  end
end

where the remote_file_uri is http://www.rabbitmq.com/releases/plugins/v2.5.0/ and the plugin name is expected to be plugin-2.5.0.ez.

The first plugin I try to install is mochiweb.  It fails because the mochiweb plugin is named mochiweb-1.3-rmq2.5.0-git9a53dbd.ez<http://www.rabbitmq.com/releases/plugins/v2.5.0/mochiweb-1.3-rmq2.5.0-git9a53dbd.ez>.

I can modify my cookbook to store plugins and their filenames as a hash.  However, could you guys consider creating predictable plugin filenames in the future?

Thanks, and please send cc: me with any feedback.  I don't subscribe to the list.

ExactTarget
Greg Swallow
System Administrator
Phone | 317 524-5250
Yahoo IM | gswallow01
Email  | gswallow at exacttarget.com<mailto:gswallow at exacttarget.com>



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/661cedec/attachment.htm>

From Jason.Klassen at protegra.com  Wed Jun 29 15:50:23 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Wed, 29 Jun 2011 14:50:23 +0000
Subject: [rabbitmq-discuss] examples of using basicPublish, basicConsume?
In-Reply-To: <20110629081845.GA2654@rabbitmq.com>
References: <676E1597FDBED54694CBA16B69DE71C3033530@PTGMAIL02v.protegra.com>
	<20110629081845.GA2654@rabbitmq.com>
Message-ID: <676E1597FDBED54694CBA16B69DE71C303362C@PTGMAIL02v.protegra.com>

Hi Matthew,

Thanks much for the advice and the javadoc link helps greatly as well.

Jason

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew Sackman
Sent: June-29-11 3:19 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] examples of using basicPublish, basicConsume?

Morning Jason,

On Wed, Jun 29, 2011 at 05:07:34AM +0000, Jason Klassen wrote:
> Another question about upgrading from Rabbit 1.4 java client to 2.5.1.  I used to do
> 
>       channel.basicPublish(ticket, exchange, routingKey, null, bytes.toByteArray )
> 
> and
> 
>     channel.basicConsume( ticket, false, queueName, myDefaultConsumer)
> 
> Is it appropriate to just omit ticket?

Yes.

> Also where can I find information about basicPublish, basicConsume? The javadoc for channel http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.0/rabbitmq-java-client-javadoc-2.5.0/com/rabbitmq/client/AMQP.Channel.html does not seem to indicate available methods so I'm doing some guessing here.

http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.5.0/rabbitmq-java-client-javadoc-2.5.0/com/rabbitmq/client/Channel.html

Best wishes,

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Jason.Klassen at protegra.com  Wed Jun 29 15:53:31 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Wed, 29 Jun 2011 14:53:31 +0000
Subject: [rabbitmq-discuss] accessRequest?
In-Reply-To: <4E0AD497.4060803@rabbitmq.com>
References: <676E1597FDBED54694CBA16B69DE71C303351A@PTGMAIL02v.protegra.com>
	<4E0AD497.4060803@rabbitmq.com>
Message-ID: <676E1597FDBED54694CBA16B69DE71C3033640@PTGMAIL02v.protegra.com>

Hi Emile,

Good to know, I'll omit ticket then.

Thanks,
Jason

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: June-29-11 2:31 AM
To: Jason Klassen
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] accessRequest?

Hi Jason,

Op 29/06/11 06:02, het Jason Klassen geskryf:
> I'm upgrading a project from the Rabbit 1.4 java client to 2.5.1.  I 
> used to do
> 
>  
> 
> val ticket = channel.accessRequest( "/data" )
> 
>  
> 
> and get an int back.   What is the equivalent that I can do in 2.5.1?

Upgrading is a very good idea. You will probably find that the client API's have also changed a bit since 1.4 .

The "Access" class was deprecated in AMQP 0-9-1 - see http://www.rabbitmq.com/specification.html#deprecated-classes

RabbitMQ still implements access.request as a no-op for backwards-compatibility, but you should not rely on it to be present in future versions. You don't need tickets anymore, so remove the call.

VHosts play a similar role to realms. The admin guide has information on how to set them up: http://www.rabbitmq.com/admin-guide.html#access-control




-Emile



From harvey.robin at gmail.com  Wed Jun 29 15:56:56 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Wed, 29 Jun 2011 15:56:56 +0100
Subject: [rabbitmq-discuss] How can I set socket timeouts in PHP using
 the AMQP PHP extension?
In-Reply-To: <BANLkTik=U3-nTTxivnWmm5SB0sXW0__aUA@mail.gmail.com>
References: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>
	<A03783F8664B4022A4094188D8A718E7@myyearbook.com>
	<BANLkTinRG2rQ8Rv9Tsma=M_cnW1cEq2wug@mail.gmail.com>
	<BANLkTik=U3-nTTxivnWmm5SB0sXW0__aUA@mail.gmail.com>
Message-ID: <BANLkTimdmY3DAzgV-+=0+ZXdGnuj1NexFQ@mail.gmail.com>

OK, I understand.  AFAIK, there's no way to do that in PHP without writing
an extension in C, is there?


On Wed, Jun 29, 2011 at 2:47 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> Cool, I meant persistent, such as with the mysql_pconnect or
> pgsql_pconnect.
>
> Thanks for the work on amqphp, will look deeper at it for use in other
> areas. I'm glad there is an active, maintained client!
>
> Gavin
>
>
> On Wed, Jun 29, 2011 at 4:08 AM, Robin Harvey <harvey.robin at gmail.com>wrote:
>
>> BTW, Gavin, on this point:
>>
>>
>> > iirc the existing implementations do not have connection pooling
>>
>> I've recently updated amqphp so that you can manage multiple connections
>> at the same time, so for example you can connect to and consume from 2 or
>> more different brokers at the same time.  There's a demo here:
>>
>>
>> https://github.com/BraveSirRobin/amqphp/blob/master/demos/demo-multi-consumer.php
>>
>> Thanks,
>> --Robin
>>
>> On Wed, Jun 29, 2011 at 4:08 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>>
>>> While not directly related to your question and you've not specified your
>>> use case, I have found trying to use native AMQP drivers in my PHP
>>> application as having too much overhead for connection management and iirc
>>> the existing implementations do not have connection pooling. This means lots
>>> of startup time and overhead on every request. To get around this we created
>>> a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all
>>> you are doing is publishing, you might want to check out VorpalBunny:
>>> https://github.com/myyearbook/VorpalBunny/
>>> As far as the underlying implementation, it's worth noting that the
>>> rabbitmq-c library is considered experimental. While we use it in our C
>>> applications in production, I can't say that we use the PHP extension on top
>>> of it. The PHP site has fatal errors for me right now so I can't look up to
>>> see which PHP extension the code is based on, otherwise I'd poke into the
>>> code and let you know if there are any timeout settings.
>>> Gavin
>>> On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
>>> > I am using the PHP AMQP extension, as described here:
>>> >
>>> > http://php.net/manual/en/book.amqp.php
>>> >
>>> > This PHP extension uses the rabbitmq-c library as its underlying
>>> implementation.
>>> >
>>> > I would like to set socket timeouts for connection establishment and
>>> for each of my enqueues and dequeues. I want to do this in case our server
>>> performance degrades, to allow the clients to fail quickly rather than hang.
>>> >
>>> > Does anyone have experience doing this in a PHP environment? I have
>>> tried setting the PHP socket timeout as follows.
>>> >
>>> >  ini_set('default_socket_timeout', 5);
>>> >
>>> > This appears to have no impact on the PHP extension's timeout settings.
>>> I am still able to enqueue a multi-megabyte MQ message to rabbitmq without
>>> losing the socket connection. It takes about 75 seconds to enqueue this
>>> message, but the socket is kept open the entire time.
>>> >
>>> > Is there any support either in the PHP AMQP extension or in a different
>>> PHP setting that I can use to reduce the timeouts for our interactions with
>>> RabbitMQ? I'd rather not live with a potential problem of hanging client
>>> processes if I can avoid it.
>>> >
>>> > Thanks,
>>> >
>>> > -Keith
>>> >
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com (mailto:
>>> rabbitmq-discuss at lists.rabbitmq.com)
>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/2b9c80dc/attachment.htm>

From rtrlists at googlemail.com  Wed Jun 29 16:20:12 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 29 Jun 2011 16:20:12 +0100
Subject: [rabbitmq-discuss] Send message from erlang client problem
In-Reply-To: <BANLkTik5=cYpv9t1LvPdZtkNdvXKtgpbYQ@mail.gmail.com>
References: <BANLkTik5=cYpv9t1LvPdZtkNdvXKtgpbYQ@mail.gmail.com>
Message-ID: <BANLkTik3duNxdD0JUMvjhemZek+dZ=YXaw@mail.gmail.com>

On Wed, Jun 29, 2011 at 2:57 PM, Alexander Kuleshov
<kuleshovmail at gmail.com>wrote:

> Hello,
>
> I try to send messsage to rabbitmq-server:
>
> send_message(Channel, Host, Password, Message) ->
>    % TODO maybe change routing_key on sit_in_reply
>    amqp_channel:cast(Channel, #'basic.publish'{exchange = <<"">>},
> routing_key = <<"test">>,
>                      #amqp_msg{payload = Message}).
>
> But get error:
>
> Error in process <0.431.0> with exit value:
> {function_clause,[{gen_server,cast, [2,{cast,{'basic.publish',0,<<0
> bytes>>,<<7 bytes>>,false,false},
>
> {amqp_msg,{'P_basic',undefined,undefined,undefined,undefined,undefined,undefined,
> undefined,undefined,undefined,undefined,undefined...
>
> How can i fix it? How can i correctly send message to rabbitmq-server?
>
>
It looks like the closing curly brace is in the wrong place. The following
should work (I tend to use call instead of cast, but I think they're
equivalent in this case):

send_message(Channel, Host, Password, Message) ->
    amqp_channel:call(Channel,
        #'basic.publish'{exchange = <<"">>, routing_key = <<"test">>},
        #amqp_msg{payload = Message}
    ).


Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/5ae0a971/attachment-0001.htm>

From videlalvaro at gmail.com  Wed Jun 29 16:21:46 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 29 Jun 2011 17:21:46 +0200
Subject: [rabbitmq-discuss] How can I set socket timeouts in PHP using
	the AMQP PHP extension?
In-Reply-To: <BANLkTimdmY3DAzgV-+=0+ZXdGnuj1NexFQ@mail.gmail.com>
References: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>
	<A03783F8664B4022A4094188D8A718E7@myyearbook.com>
	<BANLkTinRG2rQ8Rv9Tsma=M_cnW1cEq2wug@mail.gmail.com>
	<BANLkTik=U3-nTTxivnWmm5SB0sXW0__aUA@mail.gmail.com>
	<BANLkTimdmY3DAzgV-+=0+ZXdGnuj1NexFQ@mail.gmail.com>
Message-ID: <317EF942-70AB-4646-8DFF-0CFAC6BA8C5D@gmail.com>

I know there's function called pfsockopen or something like that. It might help to achieve persistent connections, but I haven't used it.

-Alvaro

Sent from my iFad

On Jun 29, 2011, at 4:56 PM, Robin Harvey <harvey.robin at gmail.com> wrote:

> OK, I understand.  AFAIK, there's no way to do that in PHP without writing an extension in C, is there?
> 
> 
> On Wed, Jun 29, 2011 at 2:47 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
> Cool, I meant persistent, such as with the mysql_pconnect or pgsql_pconnect.
> 
> Thanks for the work on amqphp, will look deeper at it for use in other areas. I'm glad there is an active, maintained client!
> 
> Gavin
> 
> 
> On Wed, Jun 29, 2011 at 4:08 AM, Robin Harvey <harvey.robin at gmail.com> wrote:
> BTW, Gavin, on this point:
> 
> 
> > iirc the existing implementations do not have connection pooling
> 
> I've recently updated amqphp so that you can manage multiple connections at the same time, so for example you can connect to and consume from 2 or more different brokers at the same time.  There's a demo here:
> 
> https://github.com/BraveSirRobin/amqphp/blob/master/demos/demo-multi-consumer.php
> 
> Thanks,
> --Robin
> 
> On Wed, Jun 29, 2011 at 4:08 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:
> While not directly related to your question and you've not specified your use case, I have found trying to use native AMQP drivers in my PHP application as having too much overhead for connection management and iirc the existing implementations do not have connection pooling. This means lots of startup time and overhead on every request. To get around this we created a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all you are doing is publishing, you might want to check out VorpalBunny:
> https://github.com/myyearbook/VorpalBunny/
> As far as the underlying implementation, it's worth noting that the rabbitmq-c library is considered experimental. While we use it in our C applications in production, I can't say that we use the PHP extension on top of it. The PHP site has fatal errors for me right now so I can't look up to see which PHP extension the code is based on, otherwise I'd poke into the code and let you know if there are any timeout settings.
> Gavin
> On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
> > I am using the PHP AMQP extension, as described here:
> >
> > http://php.net/manual/en/book.amqp.php
> >
> > This PHP extension uses the rabbitmq-c library as its underlying implementation.
> >
> > I would like to set socket timeouts for connection establishment and for each of my enqueues and dequeues. I want to do this in case our server performance degrades, to allow the clients to fail quickly rather than hang.
> >
> > Does anyone have experience doing this in a PHP environment? I have tried setting the PHP socket timeout as follows.
> >
> >  ini_set('default_socket_timeout', 5);
> >
> > This appears to have no impact on the PHP extension's timeout settings. I am still able to enqueue a multi-megabyte MQ message to rabbitmq without losing the socket connection. It takes about 75 seconds to enqueue this message, but the socket is kept open the entire time.
> >
> > Is there any support either in the PHP AMQP extension or in a different PHP setting that I can use to reduce the timeouts for our interactions with RabbitMQ? I'd rather not live with a potential problem of hanging client processes if I can avoid it.
> >
> > Thanks,
> >
> > -Keith
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/cb2cbf15/attachment.htm>

From emile at rabbitmq.com  Wed Jun 29 16:33:23 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 29 Jun 2011 16:33:23 +0100
Subject: [rabbitmq-discuss] Error while compiling Send.cs from hello
 world tutorial
In-Reply-To: <BANLkTi=fYFwSHerqat2psSkYZE7H9xXdKg@mail.gmail.com>
References: <BANLkTin5W4zcz1uhfTwVoKH5GRG-0W_Qfg@mail.gmail.com>	<4E0AE135.6070001@rabbitmq.com>
	<BANLkTi=fYFwSHerqat2psSkYZE7H9xXdKg@mail.gmail.com>
Message-ID: <4E0B45C3.4020706@rabbitmq.com>

Hi Demiss,

Op 29/06/11 14:53, het Demiss Zike geskryf:
> Great! Thanks, it compiled now. But I am encountered with the following
> error:

That picture is consistent with a missing broker. You need to have a
RabbitMQ broker listening on localhost:5672 . If you have not done so
already, download and run the windows installer from

http://www.rabbitmq.com/server.html

Alternatively you can set up a broker on another host and modify the
tutorial source code accordingly.

Regards

Emile

From gmr at myyearbook.com  Wed Jun 29 16:42:29 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 29 Jun 2011 11:42:29 -0400
Subject: [rabbitmq-discuss] How can I set socket timeouts in PHP using
 the AMQP PHP extension?
In-Reply-To: <BANLkTimdmY3DAzgV-+=0+ZXdGnuj1NexFQ@mail.gmail.com>
References: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>
	<A03783F8664B4022A4094188D8A718E7@myyearbook.com>
	<BANLkTinRG2rQ8Rv9Tsma=M_cnW1cEq2wug@mail.gmail.com>
	<BANLkTik=U3-nTTxivnWmm5SB0sXW0__aUA@mail.gmail.com>
	<BANLkTimdmY3DAzgV-+=0+ZXdGnuj1NexFQ@mail.gmail.com>
Message-ID: <BANLkTimLFTZpciYPH9cjt8DSDxkUBcUVuw@mail.gmail.com>

http://php.net/manual/en/function.pfsockopen.php

The important thing of course will be wrapping this in an intelligent way
keeping track of your channels and connections. In your class structure
you'd want to know about the connection and authenticated session, channels
and such for subsequent requests for reuse

Regards,

Gavin

On Wed, Jun 29, 2011 at 10:56 AM, Robin Harvey <harvey.robin at gmail.com>wrote:

> OK, I understand.  AFAIK, there's no way to do that in PHP without writing
> an extension in C, is there?
>
>
>
> On Wed, Jun 29, 2011 at 2:47 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>
>> Cool, I meant persistent, such as with the mysql_pconnect or
>> pgsql_pconnect.
>>
>> Thanks for the work on amqphp, will look deeper at it for use in other
>> areas. I'm glad there is an active, maintained client!
>>
>> Gavin
>>
>>
>> On Wed, Jun 29, 2011 at 4:08 AM, Robin Harvey <harvey.robin at gmail.com>wrote:
>>
>>> BTW, Gavin, on this point:
>>>
>>>
>>> > iirc the existing implementations do not have connection pooling
>>>
>>> I've recently updated amqphp so that you can manage multiple connections
>>> at the same time, so for example you can connect to and consume from 2 or
>>> more different brokers at the same time.  There's a demo here:
>>>
>>>
>>> https://github.com/BraveSirRobin/amqphp/blob/master/demos/demo-multi-consumer.php
>>>
>>> Thanks,
>>> --Robin
>>>
>>> On Wed, Jun 29, 2011 at 4:08 AM, Gavin M. Roy <gmr at myyearbook.com>wrote:
>>>
>>>> While not directly related to your question and you've not specified
>>>> your use case, I have found trying to use native AMQP drivers in my PHP
>>>> application as having too much overhead for connection management and iirc
>>>> the existing implementations do not have connection pooling. This means lots
>>>> of startup time and overhead on every request. To get around this we created
>>>> a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all
>>>> you are doing is publishing, you might want to check out VorpalBunny:
>>>> https://github.com/myyearbook/VorpalBunny/
>>>> As far as the underlying implementation, it's worth noting that the
>>>> rabbitmq-c library is considered experimental. While we use it in our C
>>>> applications in production, I can't say that we use the PHP extension on top
>>>> of it. The PHP site has fatal errors for me right now so I can't look up to
>>>> see which PHP extension the code is based on, otherwise I'd poke into the
>>>> code and let you know if there are any timeout settings.
>>>> Gavin
>>>> On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
>>>> > I am using the PHP AMQP extension, as described here:
>>>> >
>>>> > http://php.net/manual/en/book.amqp.php
>>>> >
>>>> > This PHP extension uses the rabbitmq-c library as its underlying
>>>> implementation.
>>>> >
>>>> > I would like to set socket timeouts for connection establishment and
>>>> for each of my enqueues and dequeues. I want to do this in case our server
>>>> performance degrades, to allow the clients to fail quickly rather than hang.
>>>> >
>>>> > Does anyone have experience doing this in a PHP environment? I have
>>>> tried setting the PHP socket timeout as follows.
>>>> >
>>>> >  ini_set('default_socket_timeout', 5);
>>>> >
>>>> > This appears to have no impact on the PHP extension's timeout
>>>> settings. I am still able to enqueue a multi-megabyte MQ message to rabbitmq
>>>> without losing the socket connection. It takes about 75 seconds to enqueue
>>>> this message, but the socket is kept open the entire time.
>>>> >
>>>> > Is there any support either in the PHP AMQP extension or in a
>>>> different PHP setting that I can use to reduce the timeouts for our
>>>> interactions with RabbitMQ? I'd rather not live with a potential problem of
>>>> hanging client processes if I can avoid it.
>>>> >
>>>> > Thanks,
>>>> >
>>>> > -Keith
>>>> >
>>>> > _______________________________________________
>>>> > rabbitmq-discuss mailing list
>>>> > rabbitmq-discuss at lists.rabbitmq.com (mailto:
>>>> rabbitmq-discuss at lists.rabbitmq.com)
>>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/daaa5b12/attachment-0001.htm>

From Jason.Klassen at protegra.com  Wed Jun 29 16:45:58 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Wed, 29 Jun 2011 15:45:58 +0000
Subject: [rabbitmq-discuss] FW: rabbit upgrade - liftweb amqp problems
Message-ID: <676E1597FDBED54694CBA16B69DE71C30336AD@PTGMAIL02v.protegra.com>

We've been using the package net.liftweb.amqp from the lift framework in our project.  I've  done the upgrade from the 1.4 rabbit java client to the 2.5.1 client and understandably now the lift package generates a lot of compiler errors.  Primarily we use JSONAMQPSender and JSONAMQPDispatcher from lift.  Near as I can tell the latest net.liftweb.amqp package of 2.4-M2 only has a dependency to the rabbit 1.7.2 client.

Does anyone know of a lift framework version with amqp that I can use with the rabbit 2.5.1 java client?  Any alternate suggestions to lift?

Thanks,
Jason Klassen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/bf9ef3c5/attachment.htm>

From matthias at rabbitmq.com  Wed Jun 29 16:46:44 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 Jun 2011 16:46:44 +0100
Subject: [rabbitmq-discuss] Rabbit 2.2 does not report connected
	consumers
In-Reply-To: <9a1eb85a-f323-40a6-be30-2bf3aa42b996@e17g2000prj.googlegroups.com>
References: <9a1eb85a-f323-40a6-be30-2bf3aa42b996@e17g2000prj.googlegroups.com>
Message-ID: <4E0B48E4.60409@rabbitmq.com>

Alfonso,

On 23/06/11 12:49, Alfonso Pantoja wrote:
> We are using RabbitMQ 2.2 and I've noticed that in some queues the
> number of consumers is always reported as "0"
> (these queues really have consumers attached to them because when
> sending messages to them they are processed by the consumers)

How are the consumers consuming the messages? Can you post some sample 
code? And how reproducible is this?

Regards,

Matthias.

From alexis at rabbitmq.com  Wed Jun 29 16:47:43 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 29 Jun 2011 16:47:43 +0100
Subject: [rabbitmq-discuss] FW: rabbit upgrade - liftweb amqp problems
In-Reply-To: <676E1597FDBED54694CBA16B69DE71C30336AD@PTGMAIL02v.protegra.com>
References: <676E1597FDBED54694CBA16B69DE71C30336AD@PTGMAIL02v.protegra.com>
Message-ID: <CACOPnvdHK5onyqk9Bh1YSHnaR=6cjNfhnVE4_B+BzCxAdaBq=Q@mail.gmail.com>

Jason

I suggest you also ask the Lift folks to update...

alexis


On Wed, Jun 29, 2011 at 4:45 PM, Jason Klassen
<Jason.Klassen at protegra.com> wrote:
> We?ve been using the package net.liftweb.amqp from the lift framework in our
> project.? I?ve ?done the upgrade from the 1.4 rabbit java client to the
> 2.5.1 client and understandably now the lift package generates a lot of
> compiler errors.? Primarily we use JSONAMQPSender and JSONAMQPDispatcher
> from lift.? Near as I can tell the latest net.liftweb.amqp package of 2.4-M2
> only has a dependency to the rabbit 1.7.2 client.
>
>
>
> Does anyone know of a lift framework version with amqp that I can use with
> the rabbit 2.5.1 java client?? Any alternate suggestions to lift?
>
>
>
> Thanks,
>
> Jason Klassen
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From jeffh at delasco.com  Wed Jun 29 16:53:21 2011
From: jeffh at delasco.com (Jeff Hinrichs)
Date: Wed, 29 Jun 2011 10:53:21 -0500
Subject: [rabbitmq-discuss] rabbitmq fails on start
Message-ID: <BANLkTimECqbwf6G7_S+L6JnGMbwfFkdD3Q@mail.gmail.com>

[jlh at hydra ~]$ sudo /usr/local/etc/rc.d/rabbitmq start
Starting all nodes...
Starting node rabbit at hydra...
Activating RabbitMQ plugins ...
0 plugins activated:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.3.1  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at hydra
app descriptor :
/usr/local/sbin/../lib/erlang/lib/rabbitmq_server-2.3.1/sbin/../ebin/rabbit.app
home dir       : /var/db/rabbitmq
config file(s) : (none)
cookie hash    : +5sKmojC5RpkPIWY1ICaBQ==
log            : /var/log/rabbitmq/rabbit at hydra.log
sasl log       : /var/log/rabbitmq/rabbit at hydra-sasl.log
database dir   : /var/db/rabbitmq/mnesia/rabbit at hydra
erlang version : 5.8.4

starting file handle cache server
...done
starting worker pool
 ...done
starting database
...done
starting codec correctness check
 ...done
-- external infrastructure ready
starting plugin registry
 ...done
starting auth mechanism cr-demo
...done
starting auth mechanism amqplain
 ...done
starting auth mechanism plain
...done
starting statistics event manager
...done
starting logging server
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
 ...done
starting exchange type topic
 ...done
-- kernel ready
starting alarm handler
 ...done
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting exchange recovery
 ...done
starting queue supervisor and queue recovery
 ...done
-- message delivery logic ready
starting error log relay
 ...done
starting networking
...BOOT ERROR: FAILED
Reason: badarg
Stacktrace: [{inet6_tcp,listen,2},
             {rabbit_networking,ipv6_status,1},
             {rabbit_networking,port_to_listeners,1},
             {rabbit_networking,check_tcp_listener_address_auto,2},
             {rabbit_networking,start_listener,4},
             {rabbit_networking,'-boot_tcp/0-lc$^0/1-0-',1},
             {rabbit_networking,boot_tcp,0},
             {rabbit_networking,boot,0}]
{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
Error: {node_start_failed,normal}
Kernel pid terminated (application_controller)
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})

versions...
rabbitmq-2.3.1_2
erlang-lite-r14b03,1
FreeBSD 8.1


I tried restarting the rabbitmq service and it failed out with this message.
 (It had been running for some time without problem prior.)  I noticed that
erlang and rabbitmq were both moving along so I updated my ports but no joy.


--rc.con snippet----
# fire up RabbitMQ, la rasion d'etre
rabbitmq_enable="YES"
RABBITMQ_NODE_IP_ADDRESS="172.16.1.104"

#epmd for erlang network processes
epmd_enable="YES"


I don't comprehend the error message and where I should start looking.
Ideas?

Best,
-Jeff
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/b6f5e93d/attachment.htm>

From adam at middleware360.com  Wed Jun 29 16:55:50 2011
From: adam at middleware360.com (extoa)
Date: Wed, 29 Jun 2011 08:55:50 -0700 (PDT)
Subject: [rabbitmq-discuss] JMS audit/logging/resubmission web tool
In-Reply-To: <CA2F6C6A.A88F%colincrist@messageforge.org>
References: <31942507.post@talk.nabble.com>
	<BANLkTi=qAj2NGFw6EOAEVdJbZRzNddH7TQ@mail.gmail.com>
	<CA2F6C6A.A88F%colincrist@messageforge.org>
Message-ID: <31955798.post@talk.nabble.com>


Thanks for your reply everyone.

I also use HermesJMS, I agree it is more of a developer tool and does not
really have the operational focus I would like.  Also it would need a fancy
new web gui. ;-)  

 The web gui is the part i was hoping to get away with no writing.   
Ideally I would like to find a product that displays "events" which is
written in java and allows for custom plugins to be added for user defined
actions.

That product from codestreet looks interesting, I also found it in my
googling.

Colin, your dashboards written in GWT sound very interesting, is there any
chance you could post a screenshot or two.  



Colin Crist-2 wrote:
> 
> 
> Hi Adam,
> 
> No such tool exists as far as I am aware. Hermes covers some of this but
> what it is not is any kind of enterprise bus monitoring solution, it is a
> developent/test/support desktop application.
> 
> At a client I am currently building a solution that covers the bus
> monitoring side of things and for this we are using a mixture of 
> http://www.codestreet.com/template.php?page=replay, Tibco Business Works
> for the CEP engine and some custom tooling to build the dashboards using
> GWT with a simple server tier containing the history of "reconstituted
> workflows" with "pointers" into the message (replay) store for their
> content.
> 
> You could swap out BW for sure and use Esper but I've not seen any open
> source equivalent of the replay server (i.e. A Tivo for your message bus)
> - its incredibly useful.
> 
> The dashboards are quite custom to the workflow at this company as are the
> CEP rules to monitor the message flows. Using GWT has made the dash boards
> very functional and quick to develop - more so than a product that needs
> configuring and tweaking and never reaching the sophistication of one
> coded properly. Using a CEP engine externalizes the business logic nicely
> in a way discussable with the more technical business folk.
> 
> For the more straightforward requirements of browsing queues and
> subscriptions and their manipulation, we use Hermes.
> 
> Hope this helps.
> 
> Colin.
> 
> On 28/06/2011 08:11, "Alexis Richardson" <alexis at rabbitmq.com> wrote:
> 
> Adam,
> 
> I think HermesJMS might be a good starting point:
> http://www.hermesjms.com/
> 
> I have bcc'd the author.
> 
> alexis
> 
> 
> On Tue, Jun 28, 2011 at 1:23 AM, extoa <adam at middleware360.com> wrote:
>>
>> Hey everyone, I am hoping this email might stir some good conversation, I
>> would love to hear what everyone else is doing in this space.
>>
>> I'm searching around to see if a particular tool exists, I can't seem to
>> find one so I thought I would see what everyone else is doing.  I plan on
>> posting this in a few of the open source projects around to get the best
>> feedback.
>>
>> I am looking for a software tool which I will primarily use to audit,
>> monitor and resubmit messages sent to a JMS message broker.  Ideally this
>> tool has the following features:
>>
>>  - Open Source with a good community
>>  - Web based console to view and search messages
>>  - Messages are persisted in a database (SQL/NoSQL)
>>  - Ability to add custom "Action" buttons so that you could easily write
>> a
>> plugin that "resubmits" a message back to a JMS queue/topic as well as
>> write
>> whatever else you need.   Would also need the ability to "edit" the
>> message
>> before resubmitting.
>>  - Ability to acknowledge/comment on failed messages
>>  - Support for displaying/viewing Java objects, (probably limits me to
>> Java
>> based tools...)
>>  - Have the ability to send email alerts based on user defined conditions
>>  - Graphing, statistics and reporting regarding how many messages we're
>> sent
>> to each queue/topic in 5 minute intervals grouped by topic/message type.
>>  - Does not need to have a JMS adaptor, as long as their is an API to get
>> the data into the tool, i'm sure this would be easy to write/contribute.
>>  - Supports millions of messages/day
>>  - BAM style dashboard
>>
>> I would really like to have a tool like this to monitor/audit/log/replay
>> messages in my JMS environment.  I see a lot of similarities with what I
>> want in the tools like Zenoss/OpenNMS/syslog-ng/splunk etc.. as they all
>> have "Eventing/Syslog" capabilities.
>>
>> I would prefer to add/contribute to an existing project as opposed to
>> building something custom myself...
>>
>> - What is everyone else out there doing for auditing and tracking of
>> failed
>> messages in your JMS environment?
>> - Which open source tool do you think is the closest to what i'm looking
>> for?
>> --
>> View this message in context:
>> http://old.nabble.com/JMS-audit-logging-resubmission-web-tool-tp31942507p31942507.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/JMS-audit-logging-resubmission-web-tool-tp31942507p31955798.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From majek04 at gmail.com  Wed Jun 29 17:01:55 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 29 Jun 2011 17:01:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ broker behind an ELB
In-Reply-To: <BANLkTikf+=iJOoaFkqaKudnc4bCs2JP0JQ@mail.gmail.com>
References: <BANLkTikf+=iJOoaFkqaKudnc4bCs2JP0JQ@mail.gmail.com>
Message-ID: <BANLkTimuwWArPF9TCu31jws1hPARjBWuBA@mail.gmail.com>

I'm afraid we don't have much experience with Amazon ELB. Maybe there
is some kind of timeout after which the connection is broken?

Cheers,
 Marek


On Wed, Jun 22, 2011 at 13:00, Dhinesh Kumar <dhinesh.ravi at gmail.com> wrote:
> Hi,
>
> I am trying to run a RabbitMQ broker behind an ELB.
> The amqp connection gets established but it is getting closed after
> sometime.
>
> with this kind of message:
>
> =ERROR REPORT==== 22-Jun-2011::11:27:59 ===
> ** Generic server <0.149.0> terminating
> ** Last message in was socket_closed
> ** When Server state == {state,amqp_network_connection,
>
> {state,#Port<0.651>,0,<0.153.0>,131072,undefined,
> ??????????????????????????????? false},
> ??????????????????????????? <0.148.0>,<0.151.0>,
> ??????????????????????????? {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,
>
> "BrokerHostname",
> ??????????????????????????????? 5672,nonode at nohost,0,0,0,none,
> ??????????????????????????????? [#Fun<amqp_auth_mechanisms.plain.3>,
> ???????????????????????????????? #Fun<amqp_auth_mechanisms.amqplain.3>],
> ??????????????????????????????? none,[]},
> ??????????????????????????? 0,
> ??????????????????????????? [{<<"capabilities">>,table,
> ????????????????????????????? [{<<"publisher_confirms">>,bool,true},
> ?????????????????????????????? {<<"exchange_exchange_bindings">>,bool,true},
> ?????????????????????????????? {<<"basic.nack">>,bool,true},
> ?????????????????????????????? {<<"consumer_cancel_notify">>,bool,true}]},
> ???????????????????????????? {<<"copyright">>,longstr,
> ????????????????????????????? <<"Copyright (C) 2007-2011 VMware, Inc.">>},
> ???????????????????????????? {<<"information">>,longstr,
> ????????????????????????????? <<"Licensed under the MPL.? See
> http://www.rabbitmq.com/">>},
> ???????????????????????????? {<<"platform">>,longstr,<<"Erlang/OTP">>},
> ???????????????????????????? {<<"product">>,longstr,<<"RabbitMQ">>},
> ???????????????????????????? {<<"version">>,longstr,<<"2.4.1">>}],
> ??????????????????????????? #Fun<amqp_connection_sup.0.110528238>,
> ??????????????????????????? #Fun<amqp_connection_sup.2.116782220>,false}
> ** Reason for termination ==
> ** socket_closed_unexpectedly
>
>
> If i do the same without ELB, the connection is stable.
> Is there any setting which i am missing?
>
> Thanks in advance,
> Dhinesh Kumar
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From simon at rabbitmq.com  Wed Jun 29 17:10:31 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Jun 2011 17:10:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ and groups of users
In-Reply-To: <BANLkTinpX8BU1xfcxsteO3Q6feg42dsX6Q@mail.gmail.com>
References: <BANLkTinpX8BU1xfcxsteO3Q6feg42dsX6Q@mail.gmail.com>
Message-ID: <4E0B4E77.3000600@rabbitmq.com>

On 28/06/11 12:58, Massimo Paladin wrote:
> correct me if I am wrong but I haven't seen the possibility to specify
> groups of users in RabbitMQ.
>
> It would be great to have this feature.
> In an environment with many users it would simplify quite a lot the
> permission definition and modification.

That's correct, the internal database does not have groups.

> Users could be grouped and groups could have their own settings.

In my (humble!) opinion, if you have a lot of users to manage you should 
either be using some plugin that lets you get users from an external 
source (e.g. the rabbitmq-auth-backend-ldap or 
rabbitmq-auth-backend-http plugins), which allow you to implement 
groups, or you should be managing them using something like Puppet or 
Chef, or rolling your own script that talks to mgmt so you can define 
these things en masse.

That's what I'd do, anyway.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From harvey.robin at gmail.com  Wed Jun 29 17:20:50 2011
From: harvey.robin at gmail.com (Robin Harvey)
Date: Wed, 29 Jun 2011 17:20:50 +0100
Subject: [rabbitmq-discuss] How can I set socket timeouts in PHP using
 the AMQP PHP extension?
In-Reply-To: <BANLkTimLFTZpciYPH9cjt8DSDxkUBcUVuw@mail.gmail.com>
References: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>
	<A03783F8664B4022A4094188D8A718E7@myyearbook.com>
	<BANLkTinRG2rQ8Rv9Tsma=M_cnW1cEq2wug@mail.gmail.com>
	<BANLkTik=U3-nTTxivnWmm5SB0sXW0__aUA@mail.gmail.com>
	<BANLkTimdmY3DAzgV-+=0+ZXdGnuj1NexFQ@mail.gmail.com>
	<BANLkTimLFTZpciYPH9cjt8DSDxkUBcUVuw@mail.gmail.com>
Message-ID: <BANLkTimA4hV197FMHD64Gc+pdQLtnxUNsA@mail.gmail.com>

Cool, I'll check this out and see what I can do.

--Robin

On Wed, Jun 29, 2011 at 4:42 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> http://php.net/manual/en/function.pfsockopen.php
>
> The important thing of course will be wrapping this in an intelligent way
> keeping track of your channels and connections. In your class structure
> you'd want to know about the connection and authenticated session, channels
> and such for subsequent requests for reuse
>
> Regards,
>
> Gavin
>
> On Wed, Jun 29, 2011 at 10:56 AM, Robin Harvey <harvey.robin at gmail.com>wrote:
>
>> OK, I understand.  AFAIK, there's no way to do that in PHP without writing
>> an extension in C, is there?
>>
>>
>>
>> On Wed, Jun 29, 2011 at 2:47 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>>
>>> Cool, I meant persistent, such as with the mysql_pconnect or
>>> pgsql_pconnect.
>>>
>>> Thanks for the work on amqphp, will look deeper at it for use in other
>>> areas. I'm glad there is an active, maintained client!
>>>
>>> Gavin
>>>
>>>
>>> On Wed, Jun 29, 2011 at 4:08 AM, Robin Harvey <harvey.robin at gmail.com>wrote:
>>>
>>>> BTW, Gavin, on this point:
>>>>
>>>>
>>>> > iirc the existing implementations do not have connection pooling
>>>>
>>>> I've recently updated amqphp so that you can manage multiple connections
>>>> at the same time, so for example you can connect to and consume from 2 or
>>>> more different brokers at the same time.  There's a demo here:
>>>>
>>>>
>>>> https://github.com/BraveSirRobin/amqphp/blob/master/demos/demo-multi-consumer.php
>>>>
>>>> Thanks,
>>>> --Robin
>>>>
>>>> On Wed, Jun 29, 2011 at 4:08 AM, Gavin M. Roy <gmr at myyearbook.com>wrote:
>>>>
>>>>> While not directly related to your question and you've not specified
>>>>> your use case, I have found trying to use native AMQP drivers in my PHP
>>>>> application as having too much overhead for connection management and iirc
>>>>> the existing implementations do not have connection pooling. This means lots
>>>>> of startup time and overhead on every request. To get around this we created
>>>>> a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all
>>>>> you are doing is publishing, you might want to check out VorpalBunny:
>>>>> https://github.com/myyearbook/VorpalBunny/
>>>>> As far as the underlying implementation, it's worth noting that the
>>>>> rabbitmq-c library is considered experimental. While we use it in our C
>>>>> applications in production, I can't say that we use the PHP extension on top
>>>>> of it. The PHP site has fatal errors for me right now so I can't look up to
>>>>> see which PHP extension the code is based on, otherwise I'd poke into the
>>>>> code and let you know if there are any timeout settings.
>>>>> Gavin
>>>>> On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
>>>>> > I am using the PHP AMQP extension, as described here:
>>>>> >
>>>>> > http://php.net/manual/en/book.amqp.php
>>>>> >
>>>>> > This PHP extension uses the rabbitmq-c library as its underlying
>>>>> implementation.
>>>>> >
>>>>> > I would like to set socket timeouts for connection establishment and
>>>>> for each of my enqueues and dequeues. I want to do this in case our server
>>>>> performance degrades, to allow the clients to fail quickly rather than hang.
>>>>> >
>>>>> > Does anyone have experience doing this in a PHP environment? I have
>>>>> tried setting the PHP socket timeout as follows.
>>>>> >
>>>>> >  ini_set('default_socket_timeout', 5);
>>>>> >
>>>>> > This appears to have no impact on the PHP extension's timeout
>>>>> settings. I am still able to enqueue a multi-megabyte MQ message to rabbitmq
>>>>> without losing the socket connection. It takes about 75 seconds to enqueue
>>>>> this message, but the socket is kept open the entire time.
>>>>> >
>>>>> > Is there any support either in the PHP AMQP extension or in a
>>>>> different PHP setting that I can use to reduce the timeouts for our
>>>>> interactions with RabbitMQ? I'd rather not live with a potential problem of
>>>>> hanging client processes if I can avoid it.
>>>>> >
>>>>> > Thanks,
>>>>> >
>>>>> > -Keith
>>>>> >
>>>>> > _______________________________________________
>>>>> > rabbitmq-discuss mailing list
>>>>> > rabbitmq-discuss at lists.rabbitmq.com (mailto:
>>>>> rabbitmq-discuss at lists.rabbitmq.com)
>>>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/c3654367/attachment.htm>

From simon at rabbitmq.com  Wed Jun 29 17:21:13 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Jun 2011 17:21:13 +0100
Subject: [rabbitmq-discuss] rabbitmq.config mnesia settings
In-Reply-To: <BANLkTi=TZKGGqbrKR7qEURAaRz_3eYC65g@mail.gmail.com>
References: <BANLkTi=TZKGGqbrKR7qEURAaRz_3eYC65g@mail.gmail.com>
Message-ID: <4E0B50F9.5050701@rabbitmq.com>

On 28/06/11 12:28, Massimo Paladin wrote:
> is there a page with the available mnesia settings for rabbitmq.config file?

There's nothing RabbitMQ-specific that I'm aware of.

The generic settings documentation for Mnesia is here:

http://www.erlang.org/doc/man/mnesia.html#id66592

I would be very wary of changing any of the following:

access_module
auto_repair
backup_module
core_dir
dir
event_module
extra_db_nodes
max_wait_for_decision
schema_location

What are you trying to do?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthew at rabbitmq.com  Wed Jun 29 16:19:06 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 29 Jun 2011 16:19:06 +0100
Subject: [rabbitmq-discuss] Plugin filenames
In-Reply-To: <567A8770-35D1-4B31-9DC2-C0D01B32F576@exacttarget.com>
References: <567A8770-35D1-4B31-9DC2-C0D01B32F576@exacttarget.com>
Message-ID: <20110629151905.GA5894@rabbitmq.com>

On Wed, Jun 29, 2011 at 10:28:35AM -0400, Greg Swallow wrote:
> The first plugin I try to install is mochiweb.  It fails because the
> mochiweb plugin is named
> mochiweb-1.3-rmq2.5.0-git9a53dbd.ez<http://www.rabbitmq.com/releases/plugins/v2.5.0/mochiweb-1.3-rmq2.5.0-git9a53dbd.ez>.
> 
> I can modify my cookbook to store plugins and their filenames as a
> hash.  However, could you guys consider creating predictable plugin
> filenames in the future?

Ahh, but they are entirely predictable.

Things like mochiweb present a problem because to give them just the
Rabbit version is misleading. Equally we can't just use the upstream
version because in some cases we patch some upstream code. So as a
result we do -$upstream_ver-rmq$rabbit_ver-$hg_or_git$short_hash where
the hash is grabbed from hg or git, as per:

ifdef UPSTREAM_GIT
	echo UPSTREAM_SHORT_HASH:=`git --git-dir=$(CLONE_DIR)/.git log -n 1 HEAD | grep commit | cut -b 8-14` >$$@
endif
ifdef UPSTREAM_HG
	echo UPSTREAM_SHORT_HASH:=`hg id -R $(CLONE_DIR) -i | cut -c -7` >$$@
endif

This allows us to make it clear which versions of upstream projects
we're shipping, which is important for many reasons, not least of which
is the ability to identify the status of bugs uncovered and so forth.

Really, I wonder whether you might be better off trying to semantically
understand http://www.rabbitmq.com/plugins.html such that by scraping
that, you can figure out what plugins are available, and what their
dependencies are. Utterly gross, I know, but I can't think of a better
solution atm.

Matthew

From simon at rabbitmq.com  Wed Jun 29 18:00:35 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Jun 2011 18:00:35 +0100
Subject: [rabbitmq-discuss] rabbitmq fails on start
In-Reply-To: <BANLkTimECqbwf6G7_S+L6JnGMbwfFkdD3Q@mail.gmail.com>
References: <BANLkTimECqbwf6G7_S+L6JnGMbwfFkdD3Q@mail.gmail.com>
Message-ID: <4E0B5A33.3080109@rabbitmq.com>

On 29/06/11 16:53, Jeff Hinrichs wrote:
> ...BOOT ERROR: FAILED
> Reason: badarg
> Stacktrace: [{inet6_tcp,listen,2},
>               {rabbit_networking,ipv6_status,1},

So RabbitMQ is failing while trying to figure out the IPv6 status of 
your machine (basically, does it need to explicitly open an IPv4 socket 
as well as IPv6 or is IPv4 considered part of IPv6).

Assuming you're not using IPv6, the simplest way to get over this would 
be to disable it. A complete rabbitmq.config file that would do so looks 
like:

   [
     {rabbit, [{tcp_listeners, [{"0.0.0.0", 5672}]}]}
   ].

You would also need to change ssl_listeners too if you're using SSL.

However, this really *should* work. Could your machine be in a weird 
state with respect to IPv6 (or have changed recently)? Have you 
configured anything about Erlang socket options? (e.g. 
inet_default_listen_options)?

What does:

erl -noinput  -eval 'io:format("~p~n", 
[inet:listen_options([{port,10000}, inet6, {ip, {0,0,0,0,0,0,0,0}}], 
inet6)]), halt().'

(all one line) say?


> versions...
> rabbitmq-2.3.1_2
> erlang-lite-r14b03,1
> FreeBSD 8.1

I was initially rather suspicious of erlang-lite, but looking at the 
port file it seems to just exclude Java, X11 and ODBC, which should be fine.

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From kuleshovmail at gmail.com  Wed Jun 29 18:05:12 2011
From: kuleshovmail at gmail.com (Alexander Kuleshov)
Date: Wed, 29 Jun 2011 17:05:12 +0000
Subject: [rabbitmq-discuss] Message receiving
Message-ID: <BANLkTimqL9W-kfWD2NfRyg=Mt8yVCQM+Vw@mail.gmail.com>

Hello,

I try to receive message from rabbitmq server. At the start i connect to server:

main() ->
    {ok, Connection} =
        amqp_connection:start(#amqp_params_network{host = "myhost.com",
						   password = <<"pasword">>}),

    {ok, Channel} = amqp_connection:open_channel(Connection),
    % remember pid
    ok = gen_fsm:sync_send_all_state_event({global, "game1"},
{set_channel, self()}),
    amqp_channel:call(Channel, #'queue.declare'{queue = <<"test">>}),
    amqp_channel:subscribe(Channel, #'basic.consume'{queue =
<<"test">>}, self()),

    receive
        #'basic.consume_ok'{} ->
	    ok
    end,
    loop(Channel).

My loop function:

loop(Channel) ->
        receive
        {#'basic.deliver'{delivery_tag = Tag}, #amqp_msg{payload = Body}} ->
            amqp_channel:cast(Channel, #'basic.ack'{delivery_tag = Tag}),
            loop(Channel);
	{ok, Message} ->
	    amqp_channel:cast(Channel, #'basic.publish'{routing_key =
<<"test">>}, #amqp_msg{payload = Message}),
	    loop(Channel)
    end.

I send message in {ok, Message} tuple from another code:

Chanel ! {ok, Message}.

Chanel i get from (  ok = gen_fsm:sync_send_all_state_event({global,
"game1"}, {set_channel, self()}), ) in main function. Then
amqp_channel:cast send message Message, but the answer does not come.
First lopp/1 clause not execute.

How can i send message from another module and receive answer in
loop/1 correctly?

Thank you.

From jeffh at delasco.com  Wed Jun 29 19:10:01 2011
From: jeffh at delasco.com (Jeff Hinrichs)
Date: Wed, 29 Jun 2011 13:10:01 -0500
Subject: [rabbitmq-discuss] rabbitmq fails on start
In-Reply-To: <4E0B5A33.3080109@rabbitmq.com>
References: <BANLkTimECqbwf6G7_S+L6JnGMbwfFkdD3Q@mail.gmail.com>
	<4E0B5A33.3080109@rabbitmq.com>
Message-ID: <BANLkTi=-Sa-E1ujB8tf3XMP=Sj2Mt4=cgA@mail.gmail.com>

[jlh at hydra ~]$ erl -noinput  -eval 'io:format("~p~n",
[inet:listen_options([{port,10000}, inet6, {ip, {0,0,0,0,0,0,0,0}}],
inet6)]), halt().'
{ok,{listen_opts,{0,0,0,0,0,0,0,0},10000,5,-1,[{active,true}]}}
[jlh at hydra ~]$


Best,

-Jeff



On Wed, Jun 29, 2011 at 12:00 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> erl -noinput  -eval 'io:format("~p~n", [inet:listen_options([{port,**10000},
> inet6, {ip, {0,0,0,0,0,0,0,0}}], inet6)]), halt().'
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/68a17fd5/attachment.htm>

From jeffh at delasco.com  Wed Jun 29 19:14:56 2011
From: jeffh at delasco.com (Jeff Hinrichs)
Date: Wed, 29 Jun 2011 13:14:56 -0500
Subject: [rabbitmq-discuss] rabbitmq fails on start
In-Reply-To: <BANLkTi=-Sa-E1ujB8tf3XMP=Sj2Mt4=cgA@mail.gmail.com>
References: <BANLkTimECqbwf6G7_S+L6JnGMbwfFkdD3Q@mail.gmail.com>
	<4E0B5A33.3080109@rabbitmq.com>
	<BANLkTi=-Sa-E1ujB8tf3XMP=Sj2Mt4=cgA@mail.gmail.com>
Message-ID: <BANLkTim-uNrTcUR3ZOi9p7-bvqfY3tGvug@mail.gmail.com>

Just for giggles, after I ran the one liner, I created a rabbitmq.config
file (there wasn't one before, as it hadn't been necessary) and populated it
with your

 [
   {rabbit, [{tcp_listeners, [{"0.0.0.0", 5672}]}]}
 ].

I then fired up  rabbitmq and it started up without error.


hmmm.

-Jeff



On Wed, Jun 29, 2011 at 1:10 PM, Jeff Hinrichs <jeffh at delasco.com> wrote:

> [jlh at hydra ~]$ erl -noinput  -eval 'io:format("~p~n",
> [inet:listen_options([{port,10000}, inet6, {ip, {0,0,0,0,0,0,0,0}}],
> inet6)]), halt().'
> {ok,{listen_opts,{0,0,0,0,0,0,0,0},10000,5,-1,[{active,true}]}}
> [jlh at hydra ~]$
>
>
> Best,
>
> -Jeff
>
>
>
>
> On Wed, Jun 29, 2011 at 12:00 PM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> erl -noinput  -eval 'io:format("~p~n", [inet:listen_options([{port,**10000},
>> inet6, {ip, {0,0,0,0,0,0,0,0}}], inet6)]), halt().'
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/02e476e4/attachment.htm>

From aar at cpan.org  Wed Jun 29 20:08:15 2011
From: aar at cpan.org (Alessandro Ranellucci)
Date: Wed, 29 Jun 2011 21:08:15 +0200
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E0A3C6C.6040806@rabbitmq.com>
Message-ID: <r422Ps-1067i-706A8FADA280473E9268D6C05E244E22@thelonious.lan>

Matthias,

On 28-06-2011 at 22:41, Matthias Radestock wrote:
  >Well, you cannot actually handle that directly *with* an AMQP
  >transaction *as defined in the spec*, since they guarantee atomicity
  >for single-queue transactions only

you're right. I paid poor attention to that limitation.

  >One way to handle this scenario in RabbitMQ is to put the 
channel in
  >'confirm' mode, send all three messages and wait for the
  >confirmations. If there is a failure then re-send the 
messages that
  >didn't get confirmed. That may result in duplicate messages 
(e.g. if a
  >confirmation was lost due to a connection failure), so you'd 
need to
  >make the messages idempotent / do dup detection at the 
consumer end.

What if I'm not able to resend the messages that didn't get 
confirmed? Say, RabbitMQ stops working after I got confirmation 
of only two messages out of three. What should my application 
do? What response should I return to my external process? I 
can't return success because RabbitMQ only accepted some of the 
messages, and I can't even return a temporary error because some 
messages were actually accepted. Should I return "partial 
success" and implement a local queue to retry messages to 
RabbitMQ? :-)

  >Looking at your example though makes me wonder why an app 
would want
  >these messages to be delivered atomically anyway. Surely one would
  >want to charge the prepaid account first, then, *if that succeeds*,
  >deliver the product, then *if that succeeds*, notify the 
customer. No?

That's the case if your operations are blocking each other and 
can return success or failure. However, many designs involve 
asynchronous operations which can't fail and have no impact on others.

Say that you had already reserved some credit: you only need to 
settle that reservation. There's no hurry to do that, and no 
chance for it to fail. At worse, your billing database could be 
temporarily unavailable, but there's no reason to block product 
delivery. You might support less concurrency, or put less 
resources, on your billing database than you do for product 
delivery. Otherwise, if I chain all components in my workflow, I 
will put a lot of bottlenecks and make everything critical.

Cheers,

Alessandro


From Jason.Klassen at protegra.com  Wed Jun 29 20:48:45 2011
From: Jason.Klassen at protegra.com (Jason Klassen)
Date: Wed, 29 Jun 2011 19:48:45 +0000
Subject: [rabbitmq-discuss] management plugin 2.5.1 - using
 RABBITMQ_SERVER_START_ARGS to control port in batch file
Message-ID: <676E1597FDBED54694CBA16B69DE71C30337FE@PTGMAIL02v.protegra.com>

Hi,

How can I modify rabbitmq-server.bat to launch the management plugin on a specific port that is not 55672?  I want to accomplish this in the batch file and not in a config file.

I'm running rabbitmq 2.5.1 server on windows 7.  The server and client are both happily running and so I'm turning my attention to the management plugin.  I modified rabbitmq-server.bat to include some commands for mochiweb plugin,  the important part being "-rabbitmq_mochiweb port 55673 ^" in place of  RABBITMQ_SERVER_START_ARGS.  When the batch is run it fires the plugin up but on 55672 as if it's ignoring the parameters.  I am using the 2.5.1 version of the 6 plugin files need for the management plugin.   The modified part looks like below:

"!ERLANG_HOME!\bin\erl.exe" ^
!RABBITMQ_EBIN_PATH! ^
-noinput ^
-boot "!RABBITMQ_BOOT_FILE!" ^
!RABBITMQ_CONFIG_ARG! ^
-sname !RABBITMQ_NODENAME! ^
-s rabbit ^
+W w ^
+A30 ^
+P 1048576 ^
-kernel inet_default_connect_options "[{nodelay, true}]" ^
!RABBITMQ_LISTEN_ARG! ^
-kernel error_logger {file,\""!LOGS:\=/!"\"} ^
!RABBITMQ_SERVER_ERL_ARGS! ^
-sasl errlog_type error ^
-sasl sasl_error_logger {file,\""!SASL_LOGS:\=/!"\"} ^
-os_mon start_cpu_sup true ^
-os_mon start_disksup false ^
-os_mon start_memsup false ^
-mnesia dir \""!RABBITMQ_MNESIA_DIR!"\" ^
-rabbitmq_mochiweb port 55673 ^
!STAR!

When I was running server 2.4.1 the command used was "-rabbit_mochiweb port 55673 ^" which would correctly launch the management plugin on http://localhost:55673/

Thanks,
Jason Klassen

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/1c566d8b/attachment-0001.htm>

From keith at krue.gr  Wed Jun 29 21:03:23 2011
From: keith at krue.gr (Keith Krueger)
Date: Wed, 29 Jun 2011 13:03:23 -0700
Subject: [rabbitmq-discuss] How can I set socket timeouts in PHP using
 the AMQP PHP extension?
In-Reply-To: <BANLkTimA4hV197FMHD64Gc+pdQLtnxUNsA@mail.gmail.com>
References: <BANLkTinVJHCHHSP2a==YxG+PaUpND0F4dQ@mail.gmail.com>
	<A03783F8664B4022A4094188D8A718E7@myyearbook.com>
	<BANLkTinRG2rQ8Rv9Tsma=M_cnW1cEq2wug@mail.gmail.com>
	<BANLkTik=U3-nTTxivnWmm5SB0sXW0__aUA@mail.gmail.com>
	<BANLkTimdmY3DAzgV-+=0+ZXdGnuj1NexFQ@mail.gmail.com>
	<BANLkTimLFTZpciYPH9cjt8DSDxkUBcUVuw@mail.gmail.com>
	<BANLkTimA4hV197FMHD64Gc+pdQLtnxUNsA@mail.gmail.com>
Message-ID: <BANLkTikZyu-AMD6f3up9_yxoZwcMueeT8w@mail.gmail.com>

Thanks for all the replies. At this time, I am not interested in connection
pooling for my application.  I just would like to set some lower client
timeouts on the socket connections made to RabbitMQ in case of server
overload, etc.

I do like the look of Robin's amqphp library, although I'm restricted to PHP
5.2.4 for the foreseeable future and can't make use of it.

The source code for the C language rabbitmq-c library I'm using is the
following:

  http://hg.rabbitmq.com/rabbitmq-c/rev/3c549bb09c16 rabbitmq-c

In the C code, the connection is described here:
http://hg.rabbitmq.com/rabbitmq-c/file/3c549bb09c16/librabbitmq/amqp_connection.c

The source code for the PHP extension implemented on top of that library
(documented here: http://www.php.net/manual/en/book.amqp.php) is this:

   http://hg.rabbitmq.com/rabbitmq-codegen/rev/f8b34141e6cb

I don't see any property or configuration setting in the AMQPConnection
constructor.  I tried the following construction call, but I think it's
ignoring the two timeout args (as if I even know what to call them without
documentation).

        $connectionConfig = array(
            'host' => RABBITMQ_HOST,
            'port' => RABBITMQ_PORT,
            'vhost' => RABBITMQ_VHOST,
            'login' => RABBITMQ_LOGIN,
            'password' => RABBITMQ_PASSWORD,

            'connection_timeout' => 10,
            'read_write_timeout' => 3
            );

        $this->connection = new AMQPConnection($connectionConfig);

It sure would be nice if those timeout configurations would work and could
be passed into the underlying C implementation.

-Keith

On Wed, Jun 29, 2011 at 9:20 AM, Robin Harvey <harvey.robin at gmail.com>wrote:

> Cool, I'll check this out and see what I can do.
>
> --Robin
>
>
> On Wed, Jun 29, 2011 at 4:42 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>
>> http://php.net/manual/en/function.pfsockopen.php
>>
>> The important thing of course will be wrapping this in an intelligent way
>> keeping track of your channels and connections. In your class structure
>> you'd want to know about the connection and authenticated session, channels
>> and such for subsequent requests for reuse
>>
>> Regards,
>>
>> Gavin
>>
>> On Wed, Jun 29, 2011 at 10:56 AM, Robin Harvey <harvey.robin at gmail.com>wrote:
>>
>>> OK, I understand.  AFAIK, there's no way to do that in PHP without
>>> writing an extension in C, is there?
>>>
>>>
>>>
>>> On Wed, Jun 29, 2011 at 2:47 PM, Gavin M. Roy <gmr at myyearbook.com>wrote:
>>>
>>>> Cool, I meant persistent, such as with the mysql_pconnect or
>>>> pgsql_pconnect.
>>>>
>>>>  Thanks for the work on amqphp, will look deeper at it for use in other
>>>> areas. I'm glad there is an active, maintained client!
>>>>
>>>> Gavin
>>>>
>>>>
>>>> On Wed, Jun 29, 2011 at 4:08 AM, Robin Harvey <harvey.robin at gmail.com>wrote:
>>>>
>>>>> BTW, Gavin, on this point:
>>>>>
>>>>>
>>>>> > iirc the existing implementations do not have connection pooling
>>>>>
>>>>> I've recently updated amqphp so that you can manage multiple
>>>>> connections at the same time, so for example you can connect to and consume
>>>>> from 2 or more different brokers at the same time.  There's a demo here:
>>>>>
>>>>>
>>>>> https://github.com/BraveSirRobin/amqphp/blob/master/demos/demo-multi-consumer.php
>>>>>
>>>>> Thanks,
>>>>> --Robin
>>>>>
>>>>> On Wed, Jun 29, 2011 at 4:08 AM, Gavin M. Roy <gmr at myyearbook.com>wrote:
>>>>>
>>>>>> While not directly related to your question and you've not specified
>>>>>> your use case, I have found trying to use native AMQP drivers in my PHP
>>>>>> application as having too much overhead for connection management and iirc
>>>>>> the existing implementations do not have connection pooling. This means lots
>>>>>> of startup time and overhead on every request. To get around this we created
>>>>>> a HTTP library that talks to the RabbitMQ JSON RPC Channel plugin. If all
>>>>>> you are doing is publishing, you might want to check out VorpalBunny:
>>>>>> https://github.com/myyearbook/VorpalBunny/
>>>>>> As far as the underlying implementation, it's worth noting that the
>>>>>> rabbitmq-c library is considered experimental. While we use it in our C
>>>>>> applications in production, I can't say that we use the PHP extension on top
>>>>>> of it. The PHP site has fatal errors for me right now so I can't look up to
>>>>>> see which PHP extension the code is based on, otherwise I'd poke into the
>>>>>> code and let you know if there are any timeout settings.
>>>>>> Gavin
>>>>>> On Tuesday, June 28, 2011 at 6:44 PM, Keith Krueger wrote:
>>>>>> > I am using the PHP AMQP extension, as described here:
>>>>>> >
>>>>>> > http://php.net/manual/en/book.amqp.php
>>>>>> >
>>>>>> > This PHP extension uses the rabbitmq-c library as its underlying
>>>>>> implementation.
>>>>>> >
>>>>>> > I would like to set socket timeouts for connection establishment and
>>>>>> for each of my enqueues and dequeues. I want to do this in case our server
>>>>>> performance degrades, to allow the clients to fail quickly rather than hang.
>>>>>> >
>>>>>> > Does anyone have experience doing this in a PHP environment? I have
>>>>>> tried setting the PHP socket timeout as follows.
>>>>>> >
>>>>>> >  ini_set('default_socket_timeout', 5);
>>>>>> >
>>>>>> > This appears to have no impact on the PHP extension's timeout
>>>>>> settings. I am still able to enqueue a multi-megabyte MQ message to rabbitmq
>>>>>> without losing the socket connection. It takes about 75 seconds to enqueue
>>>>>> this message, but the socket is kept open the entire time.
>>>>>> >
>>>>>> > Is there any support either in the PHP AMQP extension or in a
>>>>>> different PHP setting that I can use to reduce the timeouts for our
>>>>>> interactions with RabbitMQ? I'd rather not live with a potential problem of
>>>>>> hanging client processes if I can avoid it.
>>>>>> >
>>>>>> > Thanks,
>>>>>> >
>>>>>> > -Keith
>>>>>> >
>>>>>> > _______________________________________________
>>>>>> > rabbitmq-discuss mailing list
>>>>>> > rabbitmq-discuss at lists.rabbitmq.com (mailto:
>>>>>> rabbitmq-discuss at lists.rabbitmq.com)
>>>>>> >
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>
>>>>>>
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>
>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/6a3c121b/attachment.htm>

From Massimo.Paladin at cern.ch  Wed Jun 29 21:04:58 2011
From: Massimo.Paladin at cern.ch (Massimo Paladin)
Date: Wed, 29 Jun 2011 22:04:58 +0200
Subject: [rabbitmq-discuss] rabbitmq.config mnesia settings
In-Reply-To: <4E0B50F9.5050701@rabbitmq.com>
References: <BANLkTi=TZKGGqbrKR7qEURAaRz_3eYC65g@mail.gmail.com>
	<4E0B50F9.5050701@rabbitmq.com>
Message-ID: <BANLkTikTep34c6rT_9Ok+5H9A1qBqDzzwg@mail.gmail.com>

Nothing in particular, I was curious to see the available options and
possible tuning of mnesia.

Cheers,
---
Massimo Paladin

email: massimo.paladin at gmail.com
website: http://www.mpaladin.com
flickr's page: http://flickr.com/photos/massimop


On Wed, Jun 29, 2011 at 6:21 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 28/06/11 12:28, Massimo Paladin wrote:
>
>> is there a page with the available mnesia settings for rabbitmq.config
>> file?
>>
>
> There's nothing RabbitMQ-specific that I'm aware of.
>
> The generic settings documentation for Mnesia is here:
>
> http://www.erlang.org/doc/man/**mnesia.html#id66592<http://www.erlang.org/doc/man/mnesia.html#id66592>
>
> I would be very wary of changing any of the following:
>
> access_module
> auto_repair
> backup_module
> core_dir
> dir
> event_module
> extra_db_nodes
> max_wait_for_decision
> schema_location
>
> What are you trying to do?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/1346f182/attachment.htm>

From simon at rabbitmq.com  Wed Jun 29 21:26:31 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 29 Jun 2011 21:26:31 +0100
Subject: [rabbitmq-discuss] rabbitmq.config mnesia settings
In-Reply-To: <BANLkTikTep34c6rT_9Ok+5H9A1qBqDzzwg@mail.gmail.com>
References: <BANLkTi=TZKGGqbrKR7qEURAaRz_3eYC65g@mail.gmail.com>
	<4E0B50F9.5050701@rabbitmq.com>
	<BANLkTikTep34c6rT_9Ok+5H9A1qBqDzzwg@mail.gmail.com>
Message-ID: <4E0B8A77.1040709@rabbitmq.com>

On 29/06/2011 9:04PM, Massimo Paladin wrote:
> Nothing in particular, I was curious to see the available options and
> possible tuning of mnesia.

Ah, right :) I think in general tuning Mnesia for Rabbit is quite rare...

Cheers, Simon

From matthias at rabbitmq.com  Wed Jun 29 22:17:26 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 Jun 2011 22:17:26 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <r422Ps-1067i-706A8FADA280473E9268D6C05E244E22@thelonious.lan>
References: <r422Ps-1067i-706A8FADA280473E9268D6C05E244E22@thelonious.lan>
Message-ID: <4E0B9666.2060903@rabbitmq.com>

Alessandro,

On 29/06/11 20:08, Alessandro Ranellucci wrote:
> [snip]

This discussion seems to have moved beyond real world examples of AMQP 
tx usage. In order to keep this thread on topic, I shall continue the 
discussion of your latest scenario off-list.

Regards,

Matthias.

From gmr at myyearbook.com  Wed Jun 29 23:17:03 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 29 Jun 2011 18:17:03 -0400
Subject: [rabbitmq-discuss] RabbitMQ ACL suggestions?
Message-ID: <BANLkTinkdVGOvbk0LkOHUvu8navTQuNi8Q@mail.gmail.com>

I wanted to see what the current thinking about the state of ACL's in
RabbitMQ are. I've been trying to lock down my clusters and have run into
some quirks:

We've looked at doing passive queue declares to get queue depths for
alerting, reporting and auto-scaling of our consumers. Unfortunately passive
queue declares appear to require configure access. I can see why
queue.declare requires this but passive commands perhaps should have a
different bit setting?

Another one that seems a bit strange is in order to acknowledge message
receipt (i.e. Basic.Ack) it appears that one has to have the write
permission set for the given user+queue. I wanted to lock consumers to read
and publishers to write but at least in the case of consuming without using
autoAck, this is not possible.

In addition, we are currently doing all of our monitoring via the Management
Plugin's API. Unfortunately to get any data, the user calling the API to
list information requires administration access. I'd love to be able to let
Nagios/Your_Monitoring_Solution_Here poll the Rabbit node and get data
without giving it access to change all of the configuration state and remove
users.

Are there any changes related to these areas planned for future releases?

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/8a063c21/attachment.htm>

From jasonjwwilliams at gmail.com  Wed Jun 29 23:25:20 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 29 Jun 2011 16:25:20 -0600
Subject: [rabbitmq-discuss] RabbitMQ ACL suggestions?
In-Reply-To: <BANLkTinkdVGOvbk0LkOHUvu8navTQuNi8Q@mail.gmail.com>
References: <BANLkTinkdVGOvbk0LkOHUvu8navTQuNi8Q@mail.gmail.com>
Message-ID: <BANLkTinpZY72yP4EWAb9XTy5a70OrAyw5w@mail.gmail.com>

>
> We've looked at doing passive queue declares to get queue depths for
> alerting, reporting and auto-scaling of our consumers. Unfortunately passive
> queue declares appear to require configure access. I can see why
> queue.declare requires this but passive commands perhaps should have a
> different bit setting?
>

We've moved to monitoring this with custom checks to the web API.


> In addition, we are currently doing all of our monitoring via the
> Management Plugin's API. Unfortunately to get any data, the user calling the
> API to list information requires administration access. I'd love to be able
> to let Nagios/Your_Monitoring_Solution_Here poll the Rabbit node and get
> data without giving it access to change all of the configuration state and
> remove users.
>

That's actually something I've been wanting to bring up on the list.
Currently, we give Nagios it's own user with admin access so it can use the
REST API. We also have a provisioning user that is used to create (via the
REST API) the various users our apps need in the individual Chef recipes (we
wrote a Chef "library" to abstract out the API). It would be nice to have a
"read only" admin type that doesn't allow that type of admin to
create/change permissions, because it looks like outside of being able to
change permissions that standard RMQ permissions apply to the API.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/82c25708/attachment.htm>

From maxjwarnock at gmail.com  Wed Jun 29 23:28:59 2011
From: maxjwarnock at gmail.com (Max Warnock)
Date: Wed, 29 Jun 2011 18:28:59 -0400
Subject: [rabbitmq-discuss] precondition_failed error with amqp_client for
	erlang
Message-ID: <BANLkTimEPWwHhza=v_6bP98a2JPuo64j9Q@mail.gmail.com>

I've built a behavior in erlang to subscribe to a given topic exchange and
farm out message handling.  I'm using the rabbitmq amqp_client library for
erlang and when I put the system under heavy load I get, on occasion, the
following error:

=ERROR REPORT==== 29-Jun-2011::18:02:18 ===
** Generic server <0.1117.0> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'channel.close',406,
                                   <<"PRECONDITION_FAILED - unknown delivery
tag 856">>,
                                   60,80},
                               none}}
** When Server state == {state,1,<0.1116.0>,network,
                               {[],[]},
                               {[],[]},
                               {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                       [],[],[]}}},
                               false,<0.1118.0>,none,none,0,true,none,
                               {dict,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]},

{{[[<<"amq.ctag-1sViVE9Y/wIKyAliWqjeCA==">>|
                                         etl_dispatch]],

[],[],[],[],[],[],[],[],[],[],[],[],[],
                                       [],[]}}},
                               none,#Fun<amqp_channel_sup.1.53915388>}
** Reason for termination ==
** {server_initiated_close,406,
                           <<"PRECONDITION_FAILED - unknown delivery tag
856">>}

The server receive loop where the ack happens looks like this:
receive
...
{#'basic.deliver'{delivery_tag = Tag, routing_key = RoutingKey},
#amqp_msg{payload = Payload}} ->
    amqp_channel:cast(get(amqp_channel_pid), #'basic.ack'{delivery_tag =
Tag}),
    spawn_and_queue(spawn_handle_message, Module, RoutingKey, Payload),
    loop(Module);
...
end

The amqp_client_sup can't seem to bring back the the client either and dies
from the retry intensity being reached.  I've done a hefty amount of
googling and can't seem to find where things could be going wrong.  Before
jumping into the amqp_client code I thought I'd ask the mailing list if they
have any ideas.  The only thing I can think is that there is a race
condition within the client library.  I will be double checking my code to
be sure it isn't sending the ack twice, but given the simplicity of the ack
the only way it could is if it receives the same message (with identical
delivery tag) from the amqp_client library twice.

Thanks,
-Max
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/df8095b9/attachment.htm>

From gmr at myyearbook.com  Wed Jun 29 23:28:51 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 29 Jun 2011 18:28:51 -0400
Subject: [rabbitmq-discuss] RabbitMQ ACL suggestions?
In-Reply-To: <BANLkTinpZY72yP4EWAb9XTy5a70OrAyw5w@mail.gmail.com>
References: <BANLkTinkdVGOvbk0LkOHUvu8navTQuNi8Q@mail.gmail.com>
	<BANLkTinpZY72yP4EWAb9XTy5a70OrAyw5w@mail.gmail.com>
Message-ID: <BANLkTimVms=dAR-7m=f4jvfSwVQg0=M_Bg@mail.gmail.com>

On Wed, Jun 29, 2011 at 6:25 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> We've looked at doing passive queue declares to get queue depths for
>> alerting, reporting and auto-scaling of our consumers. Unfortunately passive
>> queue declares appear to require configure access. I can see why
>> queue.declare requires this but passive commands perhaps should have a
>> different bit setting?
>>
>
> We've moved to monitoring this with custom checks to the web API.
>

Same here, our main use case is auto-scaling with our consumer code, i.e.
app looks to see how many messages are pending and if thresholds are met,
will kick off new threads if allowed.

That's actually something I've been wanting to bring up on the list.
> Currently, we give Nagios it's own user with admin access so it can use the
> REST API. We also have a provisioning user that is used to create (via the
> REST API) the various users our apps need in the individual Chef recipes (we
> wrote a Chef "library" to abstract out the API). It would be nice to have a
> "read only" admin type that doesn't allow that type of admin to
> create/change permissions, because it looks like outside of being able to
> change permissions that standard RMQ permissions apply to the API.
>

Read-only admin or more granular ACL controls with R/W bits for each
setting? either would satisfy my needs.

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/337d8b1f/attachment.htm>

From matthias at rabbitmq.com  Wed Jun 29 23:29:04 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 29 Jun 2011 23:29:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ ACL suggestions?
In-Reply-To: <BANLkTinkdVGOvbk0LkOHUvu8navTQuNi8Q@mail.gmail.com>
References: <BANLkTinkdVGOvbk0LkOHUvu8navTQuNi8Q@mail.gmail.com>
Message-ID: <4E0BA730.7020608@rabbitmq.com>

Gavin,

On 29/06/11 23:17, Gavin M. Roy wrote:
> We've looked at doing passive queue declares to get queue depths for
> alerting, reporting and auto-scaling of our consumers. Unfortunately
> passive queue declares appear to require configure access. I can see why
> queue.declare requires this but passive commands perhaps should have a
> different bit setting?

That will change in the next release - passive declare won't require any 
permissions. The code change for that is already on 'default'.

> Another one that seems a bit strange is in order to acknowledge message
> receipt (i.e. Basic.Ack) it appears that one has to have the write
> permission set for the given user+queue.

That can't be right. basic.ack requires no permissions whatsoever.

> In addition, we are currently doing all of our monitoring via the
> Management Plugin's API. Unfortunately to get any data, the user calling
> the API to list information requires administration access. I'd love to
> be able to let Nagios/Your_Monitoring_Solution_Here poll the Rabbit node
> and get data without giving it access to change all of the configuration
> state and remove users.

Again, that should change in the next release. The code for it is going 
through qa atm.


Regards,

Matthias.

From gmr at myyearbook.com  Wed Jun 29 23:31:00 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 29 Jun 2011 18:31:00 -0400
Subject: [rabbitmq-discuss] RabbitMQ ACL suggestions?
In-Reply-To: <4E0BA730.7020608@rabbitmq.com>
References: <BANLkTinkdVGOvbk0LkOHUvu8navTQuNi8Q@mail.gmail.com>
	<4E0BA730.7020608@rabbitmq.com>
Message-ID: <BANLkTi=3urWWqb84RP0i6=pdPftZC=gHNg@mail.gmail.com>

On Wed, Jun 29, 2011 at 6:29 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

>
> On 29/06/11 23:17, Gavin M. Roy wrote:
>
>> We've looked at doing passive queue declares to get queue depths for
>> alerting, reporting and auto-scaling of our consumers. Unfortunately
>> passive queue declares appear to require configure access. I can see why
>> queue.declare requires this but passive commands perhaps should have a
>> different bit setting?
>>
>
> That will change in the next release - passive declare won't require any
> permissions. The code change for that is already on 'default'.


Great :)


> Another one that seems a bit strange is in order to acknowledge message
>> receipt (i.e. Basic.Ack) it appears that one has to have the write
>> permission set for the given user+queue.
>>
>
> That can't be right. basic.ack requires no permissions whatsoever.


Hmm ok, will take a look then, I could be thinking of something else then,
it's been fuzzy sitting in the back of my head on my "to send an email
about" list when I came across the passive declare bit today when locking
that down.


> In addition, we are currently doing all of our monitoring via the
>> Management Plugin's API. Unfortunately to get any data, the user calling
>> the API to list information requires administration access. I'd love to
>> be able to let Nagios/Your_Monitoring_**Solution_Here poll the Rabbit
>> node
>> and get data without giving it access to change all of the configuration
>> state and remove users.
>>
>
> Again, that should change in the next release. The code for it is going
> through qa atm.
>

Awesome, thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110629/cc4d0633/attachment.htm>

From jesus at omniti.com  Thu Jun 30 03:54:48 2011
From: jesus at omniti.com (Theo Schlossnagle)
Date: Wed, 29 Jun 2011 22:54:48 -0400
Subject: [rabbitmq-discuss] Use of tx in AMQP
Message-ID: <BANLkTikgeFKL=NUDH8A4Tz6Mg_v1E_TEew@mail.gmail.com>

We use it in the PostgreSQL AMQP integration to rollback AMQP
publishes within the context of a database transaction. It's not XA,
but it's better than nothing:

https://github.com/omniti-labs/pg_amqp

-- 
Theo Schlossnagle

http://omniti.com/is/theo-schlossnagle

From dhinesh.ravi at gmail.com  Thu Jun 30 06:02:15 2011
From: dhinesh.ravi at gmail.com (Dhinesh Kumar)
Date: Thu, 30 Jun 2011 10:32:15 +0530
Subject: [rabbitmq-discuss] RabbitMQ broker behind an ELB
In-Reply-To: <BANLkTimuwWArPF9TCu31jws1hPARjBWuBA@mail.gmail.com>
References: <BANLkTikf+=iJOoaFkqaKudnc4bCs2JP0JQ@mail.gmail.com>
	<BANLkTimuwWArPF9TCu31jws1hPARjBWuBA@mail.gmail.com>
Message-ID: <BANLkTim8o=VLgccTT=Rd0UZ6QY2pcNYE4A@mail.gmail.com>

Hi Marek,

Later i found out that the Amazon ELB has a 60 seconds period of inactivity.
So the connection was getting closed after 60 seconds.
Setting the heartbeat in the connection factory helped in not losing the
connection.

Thanks,
Dhinesh Kumar

On Wed, Jun 29, 2011 at 9:31 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> I'm afraid we don't have much experience with Amazon ELB. Maybe there
> is some kind of timeout after which the connection is broken?
>
> Cheers,
>  Marek
>
>
> On Wed, Jun 22, 2011 at 13:00, Dhinesh Kumar <dhinesh.ravi at gmail.com>
> wrote:
> > Hi,
> >
> > I am trying to run a RabbitMQ broker behind an ELB.
> > The amqp connection gets established but it is getting closed after
> > sometime.
> >
> > with this kind of message:
> >
> > =ERROR REPORT==== 22-Jun-2011::11:27:59 ===
> > ** Generic server <0.149.0> terminating
> > ** Last message in was socket_closed
> > ** When Server state == {state,amqp_network_connection,
> >
> > {state,#Port<0.651>,0,<0.153.0>,131072,undefined,
> >                                 false},
> >                             <0.148.0>,<0.151.0>,
> >                             {amqp_params,<<"guest">>,<<"guest">>,<<"/">>,
> >
> > "BrokerHostname",
> >                                 5672,nonode at nohost,0,0,0,none,
> >                                 [#Fun<amqp_auth_mechanisms.plain.3>,
> >                                  #Fun<amqp_auth_mechanisms.amqplain.3>],
> >                                 none,[]},
> >                             0,
> >                             [{<<"capabilities">>,table,
> >                               [{<<"publisher_confirms">>,bool,true},
> >
> {<<"exchange_exchange_bindings">>,bool,true},
> >                                {<<"basic.nack">>,bool,true},
> >
> {<<"consumer_cancel_notify">>,bool,true}]},
> >                              {<<"copyright">>,longstr,
> >                               <<"Copyright (C) 2007-2011 VMware,
> Inc.">>},
> >                              {<<"information">>,longstr,
> >                               <<"Licensed under the MPL.  See
> > http://www.rabbitmq.com/">>},
> >                              {<<"platform">>,longstr,<<"Erlang/OTP">>},
> >                              {<<"product">>,longstr,<<"RabbitMQ">>},
> >                              {<<"version">>,longstr,<<"2.4.1">>}],
> >                             #Fun<amqp_connection_sup.0.110528238>,
> >                             #Fun<amqp_connection_sup.2.116782220>,false}
> > ** Reason for termination ==
> > ** socket_closed_unexpectedly
> >
> >
> > If i do the same without ELB, the connection is stable.
> > Is there any setting which i am missing?
> >
> > Thanks in advance,
> > Dhinesh Kumar
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/cd49e401/attachment.htm>

From matthias at rabbitmq.com  Thu Jun 30 06:49:45 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 Jun 2011 06:49:45 +0100
Subject: [rabbitmq-discuss] Use of tx in AMQP
In-Reply-To: <BANLkTikgeFKL=NUDH8A4Tz6Mg_v1E_TEew@mail.gmail.com>
References: <BANLkTikgeFKL=NUDH8A4Tz6Mg_v1E_TEew@mail.gmail.com>
Message-ID: <4E0C0E79.9090608@rabbitmq.com>

On 30/06/11 03:54, Theo Schlossnagle wrote:
> We use it in the PostgreSQL AMQP integration to rollback AMQP
> publishes within the context of a database transaction. It's not XA,
> but it's better than nothing:
>
> https://github.com/omniti-labs/pg_amqp

Thanks Theo. That's pretty neat. And I see why you mention XA since the 
code makes it possible to hit multiple brokers in a single PG transaction.

Btw, 
https://github.com/omniti-labs/pg_amqp/blob/master/src/pg_amqp.c#L122 
should probably say "rollback" instead of "commit".


Matthias.

From guyboertje at gmail.com  Thu Jun 30 06:51:04 2011
From: guyboertje at gmail.com (Guy Boertje)
Date: Thu, 30 Jun 2011 06:51:04 +0100
Subject: [rabbitmq-discuss] Java client QueueingConsumer question about
	nextDelivery(long timeout)
Message-ID: <4E0C0EC8.8020406@gmail.com>

Hi

Just need to confirm this...

My testing using the Java client via jruby
shows that using, for example,
nextDelivery(500) will always take at least
500 milliseconds and not return early if
a delivery could be take from the queue
immediately.

Ta Guy.

From matthias at rabbitmq.com  Thu Jun 30 07:14:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 Jun 2011 07:14:48 +0100
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <BANLkTikXEVEDc2LGa0vQ2eSKqNoY6Tf05Q@mail.gmail.com>
References: <4E089B89.4080009@rabbitmq.com> <4E09EFCF.4010108@rabbitmq.com>
	<BANLkTikXEVEDc2LGa0vQ2eSKqNoY6Tf05Q@mail.gmail.com>
Message-ID: <4E0C1458.4080608@rabbitmq.com>

Michael,

On 28/06/11 18:26, Michael Klishin wrote:
> Imagine a fairly large (a few terabytes) collection of documents that
> are clustered. Clustering can happen around different attributes, lets
> use date as example.
> Application that does clustering is an AMQP consumer. Because of the
> nature of clustering by date, it needs to process N documents at once
> (so again, batching), and only then acknowledge RabbitMQ and possibly
> other apps.

This is employing tx on the consuming/ack'ing side. Interesting; we 
don't see that very often.

> Prefetching plus message acknowledgements kinda let me build something
> like this, however, it will require some extra care on app developer's side.

The app would need to keep track of the delivery tags of processed 
messages and delay sending the ack until the end. So yes, some 
additional book keeping and care would be needed.

> I hope this counts as useful feedback.

Definitely. Thanks!

Matthias.

From matthias at rabbitmq.com  Thu Jun 30 07:56:54 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 30 Jun 2011 07:56:54 +0100
Subject: [rabbitmq-discuss] Cluster with Single Message queue
In-Reply-To: <BANLkTik-VOqv6kKYjy-AxOjCt7zJhR+kxQ@mail.gmail.com>
References: <BANLkTimLxtUXRecp4AsyAitP-2PE2Fht2g@mail.gmail.com>	<BANLkTim=zqRbYc0PH-h9zfkA_nssvqwOcA@mail.gmail.com>	<1568a687-7cb7-4ccf-8320-01eac2fd1a9a@v31g2000vbs.googlegroups.com>
	<BANLkTik-VOqv6kKYjy-AxOjCt7zJhR+kxQ@mail.gmail.com>
Message-ID: <4E0C1E36.9080303@rabbitmq.com>

On 17/06/11 19:58, Mark Steele wrote:
> Are there timelines on when such a mirrored queue implementation might
> make it out the door?

Within weeks. Or if the "door" is the 'default' branch of the hg repo 
then last week ;)

Usual caveats apply.

Matthias.

From simon at rabbitmq.com  Thu Jun 30 11:49:55 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 30 Jun 2011 11:49:55 +0100
Subject: [rabbitmq-discuss] management plugin 2.5.1 - using
 RABBITMQ_SERVER_START_ARGS to control port in batch file
In-Reply-To: <676E1597FDBED54694CBA16B69DE71C30337FE@PTGMAIL02v.protegra.com>
References: <676E1597FDBED54694CBA16B69DE71C30337FE@PTGMAIL02v.protegra.com>
Message-ID: <4E0C54D3.70601@rabbitmq.com>

On 29/06/11 20:48, Jason Klassen wrote:
> How can I modify rabbitmq-server.bat to launch the management plugin on
> a specific port that is not 55672? I want to accomplish this in the
> batch file and not in a config file.

Hi Jason. The config for 2.5.1 is more verbose (but more flexible). I 
just added this to the .bat file and it worked for me:

-rabbitmq_mochiweb listeners [{mgmt,[{port,55673}]},{'*',[{port,55670}]}]

(The 55670 part is needed but unless you're running a web plugin that 
isn't management it won't actually open that port.)

Cheer, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthew at rabbitmq.com  Thu Jun 30 12:48:22 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 30 Jun 2011 12:48:22 +0100
Subject: [rabbitmq-discuss] precondition_failed error with amqp_client
 for erlang
In-Reply-To: <BANLkTimEPWwHhza=v_6bP98a2JPuo64j9Q@mail.gmail.com>
References: <BANLkTimEPWwHhza=v_6bP98a2JPuo64j9Q@mail.gmail.com>
Message-ID: <20110630114821.GB18064@rabbitmq.com>

Hi Max,

On Wed, Jun 29, 2011 at 06:28:59PM -0400, Max Warnock wrote:
> I've built a behavior in erlang to subscribe to a given topic exchange and
> farm out message handling.  I'm using the rabbitmq amqp_client library for
> erlang and when I put the system under heavy load I get, on occasion, the
> following error:

Could you let us know which version of Rabbit, Erlang and the Erlang
client you're using?

> =ERROR REPORT==== 29-Jun-2011::18:02:18 ===
> ** Generic server <0.1117.0> terminating
> ** Last message in was {'$gen_cast',
>                            {method,
>                                {'channel.close',406,
>                                    <<"PRECONDITION_FAILED - unknown delivery
> tag 856">>,
>                                    60,80},

That's a double-ack (probably). Sadly, the AMQP 0-9-1 spec says that
acking is not idempotent, thus it's a fault to ack the same message
multiple times...

> The server receive loop where the ack happens looks like this:
> receive
> ...
> {#'basic.deliver'{delivery_tag = Tag, routing_key = RoutingKey},
> #amqp_msg{payload = Payload}} ->
>     amqp_channel:cast(get(amqp_channel_pid), #'basic.ack'{delivery_tag =
> Tag}),
>     spawn_and_queue(spawn_handle_message, Module, RoutingKey, Payload),
>     loop(Module);
> ...
> end

...hmmm, which is so simple that I can't see how it could go wrong: if
you're not double acking then something else must be going on to make
the broker think that it's not expecting an ack for that message, hence
the error. If you're doing some sort of reject operation - either
basic.nack or basic.reject on messages and you then subsequently ack one
of those messages then that would also cause this error. There may be
other cases as well.

> The amqp_client_sup can't seem to bring back the the client either and dies
> from the retry intensity being reached.  I've done a hefty amount of
> googling and can't seem to find where things could be going wrong.  Before
> jumping into the amqp_client code I thought I'd ask the mailing list if they
> have any ideas.  The only thing I can think is that there is a race
> condition within the client library.  I will be double checking my code to
> be sure it isn't sending the ack twice, but given the simplicity of the ack
> the only way it could is if it receives the same message (with identical
> delivery tag) from the amqp_client library twice.

It could be a bug in the client library, but I'd be a little surprised
if we're managing to duplicate messages somehow - that would be a new
level of fail for us. ;) However, the fact that the entire connection
dies is alarming and almost certainly a bug: PRECONDITION_FAILED is a
soft error and should only tear down the channel, not the whole
connection. After that, all you should have to do is create a new
channel and everything else should be ok. If that's not the case please
let us know.

Best wishes,

Matthew

From matthew at rabbitmq.com  Thu Jun 30 13:05:53 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 30 Jun 2011 13:05:53 +0100
Subject: [rabbitmq-discuss] Message receiving
In-Reply-To: <BANLkTimqL9W-kfWD2NfRyg=Mt8yVCQM+Vw@mail.gmail.com>
References: <BANLkTimqL9W-kfWD2NfRyg=Mt8yVCQM+Vw@mail.gmail.com>
Message-ID: <20110630120552.GC18064@rabbitmq.com>

Hi,

On Wed, Jun 29, 2011 at 05:05:12PM +0000, Alexander Kuleshov wrote:
> I try to receive message from rabbitmq server. At the start i connect to server:
[snip]
> I send message in {ok, Message} tuple from another code:
> 
> Chanel ! {ok, Message}.
> 
> Chanel i get from (  ok = gen_fsm:sync_send_all_state_event({global,
> "game1"}, {set_channel, self()}), ) in main function. Then
> amqp_channel:cast send message Message, but the answer does not come.
> First lopp/1 clause not execute.
> 
> How can i send message from another module and receive answer in
> loop/1 correctly?

I assume you're doing an io:format or some dbg:trace to determine that
you never hit the first branch of loop/1? It certainly should work, and
indeed does work for me.

I've removed the gen_fsm stuff, and just spawn it from the shell:

main() ->
    {ok, Connection} = amqp_connection:start(#amqp_params_network{}),
    {ok, Channel} = amqp_connection:open_channel(Connection),
    amqp_channel:call(Channel, #'queue.declare'{queue = <<"test">>}),
    amqp_channel:subscribe(Channel, #'basic.consume'{queue = <<"test">>}, self()),

    receive
        #'basic.consume_ok'{} ->
            ok
    end,
    loop(Channel).

loop(Channel) ->
    receive
        {#'basic.deliver'{delivery_tag = Tag}, #amqp_msg{payload = Body}} ->
            amqp_channel:cast(Channel, #'basic.ack'{delivery_tag = Tag}),
            loop(Channel);
        {ok, Message} ->
            amqp_channel:cast(Channel,
                              #'basic.publish'{routing_key = <<"test">>},
                              #amqp_msg{payload = Message}),
            loop(Channel)
    end.

(amqp_client at hazel)1> Pid = spawn(test, www_main, []).
<0.40.0>

  Then turn on tracing to amqp_channel:cast:

(amqp_client at hazel)2> dbg:tracer(), dbg:p(all,c), dbg:tp(amqp_channel, cast, []).
{ok,[{matched,amqp_client at hazel,2}]}

  Now send a message to Pid:

(amqp_client at hazel)7> Pid ! {ok, <<"blah2">>}.                                   
{ok,<<"blah2">>}

(<0.40.0>) call amqp_channel:cast(<0.56.0>,{'basic.publish',0,<<>>,<<"test">>,false,false},{amqp_msg,{'P_basic',undefined,undefined,undefined,undefined,undefined,
                     undefined,undefined,undefined,undefined,undefined,
                     undefined,undefined,undefined,undefined},
          <<"blah2">>})
(<0.40.0>) call amqp_channel:cast(<0.56.0>,{'basic.ack',3,false})

So we can see that the publish was indeed sent, and then it was received
and an ack was sent too. Sure enough, rabbitmqctl list_queues shows the
test queue is empty.

In your case, is the test queue not empty?

Matthew

From jon at jbrisbin.com  Thu Jun 30 13:55:43 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 30 Jun 2011 07:55:43 -0500 (CDT)
Subject: [rabbitmq-discuss] Routing key match algorithms
In-Reply-To: <e275581d-7525-4f74-8698-ad2861b49cd7@jbrisbin.local>
Message-ID: <cd23cb25-8fbf-49be-b3dc-d716291a1abb@jbrisbin.local>

I'm just trying to scratch an intellectual itch here, but I'm trying to figure out how to match routing keys using regexes. 

The problem I see is that, if a consumer issues a regex as a pattern for a subscription, when a message gets published, how do I find out all the regexes I know about that match? Do I loop over all the consumers, asking each one if they match or not? Seems kind of inefficient. 

Just wondering if this problem was known and passed over early on, and the */# mechanism used to get around this problem. 

I also thought about using some text indexing engine (a la lucene) to solve this problem, but if a message gets published with a specific routing key, you'd have to re-run the search attached to the consumers to get an updated list of messages that match a given regex. So there's no benefit from doing that either, so far as I can tell. 


Thanks! 

Jon Brisbin 
http//jbrisbin.com 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/76e1baae/attachment.htm>

From matthew at rabbitmq.com  Thu Jun 30 13:58:47 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 30 Jun 2011 13:58:47 +0100
Subject: [rabbitmq-discuss] reading time extending on persistent messages
In-Reply-To: <27D6B27DB616654BBEF4DDB8B31EAF916B590E951E@vs-msx01.IT-NG.local>
References: <27D6B27DB616654BBEF4DDB8B31EAF916B590E951E@vs-msx01.IT-NG.local>
Message-ID: <20110630125847.GD18064@rabbitmq.com>

Hi Arno,

On Wed, Jun 29, 2011 at 03:34:08PM +0200, Arno Puschmann wrote:
> I'm using rabbitmq 2.4.1 on a Ubuntu 10.04. I tested to write  a large
> number (300k) of messages to an persistent queue. Alle messages are
> the same and have a size of 1KB. After this I restartet my system and
> rabbitmq, to go save that nothing is on the memory but all on disk.
> After restarting all, I startet a consumer to readout the messages.
> Now I noticed that reading out the persistent messages took always
> longer. I measured the time for reading out every interval of 3k
> messages. For example, to readout the first 3k messages it took under
> 1sec. After 45k messages it took over 10sec. to readout the next 3k
> messages. After reading 165k messages it took about 30sec. to read the
> next 3000 messages. I have repeat these test several times always with
> a similar result.

I've used your consuming code that you supplied and repeated your test.
I did not reboot, but I did shut down rabbit and cleared out the caches.
I checked and Rabbit does sit there reading at 20MB/s off disk on
consuming.

I sent in 300,000 1KB persistent messages to a durable queue, then
safely shutdown Rabbit and restarted it, after clearing caches. I used
the Erlang client to publish and the Java client (with your code) to
consume the messages. The output I see is below.

Note that this is with the latest from default which will pretty much be
the same as 2.5.1. There haven't been any performance impacting changes
to the persistence layer for a little while. That said, there was quite
a gap between 2.4.1 and 2.5.0 so it may be something came in there.
Checking the release notes for 2.5.0 -
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-June/013249.html
- there are a number of performance related items but nothing that
strikes as relevant to your test.

Are there any indicators in your RabbitMQ logs that suggest Rabbit's
under memory pressure? Is there contention for the disk drive? Maybe try
upgrading to 2.5.1 and see if that helps?

Best wishes,

Matthew

The last 3000 Messages needed 332
The last 3000 Messages needed 314
The last 3000 Messages needed 310
The last 3000 Messages needed 383
The last 3000 Messages needed 449
The last 3000 Messages needed 436
The last 3000 Messages needed 309
The last 3000 Messages needed 320
The last 3000 Messages needed 363
The last 3000 Messages needed 340
The last 3000 Messages needed 377
The last 3000 Messages needed 369
The last 3000 Messages needed 404
The last 3000 Messages needed 379
The last 3000 Messages needed 408
The last 3000 Messages needed 445
The last 3000 Messages needed 379
The last 3000 Messages needed 357
The last 3000 Messages needed 434
The last 3000 Messages needed 325
The last 3000 Messages needed 327
The last 3000 Messages needed 508
The last 3000 Messages needed 334
The last 3000 Messages needed 360
The last 3000 Messages needed 326
The last 3000 Messages needed 339
The last 3000 Messages needed 313
The last 3000 Messages needed 458
The last 3000 Messages needed 355
The last 3000 Messages needed 341
The last 3000 Messages needed 358
The last 3000 Messages needed 331
The last 3000 Messages needed 514
The last 3000 Messages needed 339
The last 3000 Messages needed 363
The last 3000 Messages needed 355
The last 3000 Messages needed 353
The last 3000 Messages needed 372
The last 3000 Messages needed 417
The last 3000 Messages needed 375
The last 3000 Messages needed 350
The last 3000 Messages needed 438
The last 3000 Messages needed 339
The last 3000 Messages needed 554
The last 3000 Messages needed 342
The last 3000 Messages needed 340
The last 3000 Messages needed 368
The last 3000 Messages needed 372
The last 3000 Messages needed 372
The last 3000 Messages needed 420
The last 3000 Messages needed 392
The last 3000 Messages needed 358
The last 3000 Messages needed 362
The last 3000 Messages needed 347
The last 3000 Messages needed 509
The last 3000 Messages needed 402
The last 3000 Messages needed 441
The last 3000 Messages needed 437
The last 3000 Messages needed 373
The last 3000 Messages needed 359
The last 3000 Messages needed 657
The last 3000 Messages needed 345
The last 3000 Messages needed 461
The last 3000 Messages needed 384
The last 3000 Messages needed 459
The last 3000 Messages needed 648
The last 3000 Messages needed 361
The last 3000 Messages needed 369
The last 3000 Messages needed 396
The last 3000 Messages needed 407
The last 3000 Messages needed 436
The last 3000 Messages needed 376
The last 3000 Messages needed 369
The last 3000 Messages needed 409
The last 3000 Messages needed 407
The last 3000 Messages needed 378
The last 3000 Messages needed 542
The last 3000 Messages needed 391
The last 3000 Messages needed 430
The last 3000 Messages needed 389
The last 3000 Messages needed 384
The last 3000 Messages needed 480
The last 3000 Messages needed 391
The last 3000 Messages needed 434
The last 3000 Messages needed 417
The last 3000 Messages needed 387
The last 3000 Messages needed 409
The last 3000 Messages needed 609
The last 3000 Messages needed 411
The last 3000 Messages needed 472
The last 3000 Messages needed 388
The last 3000 Messages needed 399
The last 3000 Messages needed 456
The last 3000 Messages needed 430
The last 3000 Messages needed 400
The last 3000 Messages needed 420
The last 3000 Messages needed 394
The last 3000 Messages needed 426
The last 3000 Messages needed 434
The last 3000 Messages needed 416


From maxjwarnock at gmail.com  Thu Jun 30 14:23:29 2011
From: maxjwarnock at gmail.com (Max Warnock)
Date: Thu, 30 Jun 2011 09:23:29 -0400
Subject: [rabbitmq-discuss] precondition_failed error with amqp_client
	for erlang
In-Reply-To: <20110630114821.GB18064@rabbitmq.com>
References: <BANLkTimEPWwHhza=v_6bP98a2JPuo64j9Q@mail.gmail.com>
	<20110630114821.GB18064@rabbitmq.com>
Message-ID: <BANLkTi=feh3MPQxQ6vfBnwiaN1TqYsHAkg@mail.gmail.com>

Thanks, that's very helpful from both the possible issues to chase and
sanity check perspectives.

I'm using erlang R13B04 with a rabbitmq server installed via gentoo's
portage at version 2.4.1. I pulled the client library from github (tag
2.3.0, commit: 844738f9b56d34104c1ea2ac5700d0898126c5b4).

I'm going to write some debug code to store all the tags I try to ack on and
see if I can get this error to where it's easily reproducible. Thanks for
narrowing my search, it's very helpful.  I'll keep you updated. I must be
doing something wrong somewhere.  I have a hard time believing such a widely
used library could fail so hard myself.

One thing that would be extremely helpful is if you could point me to some
documentation which I haven't been able to find:  I'm looking for a listing
of all the events/messages that are sent out by the amqp client to a
subscriber.  What does it send when it goes down, what other soft errors
will it send out, etc.  Additionally, is there a doc somewhere for best
practices in connecting a listener to another server/long-running process?
 Not having either of those there has been some struggle to know how to
restart the subscription/listening process if my server dies.  The
amqp_client tutorial has been a great help, but when it comes to error
handling from the listening module perspective it doesn't tell me what the
library is expecting me to do.  I don't want to have to do a bunch of
engineering because I'm square peg, round hole-ing the library.  The primary
issues I'm concerned with are when my server dies hard and is destined to be
restarted by its supervisor what should I send to the amqp client process?
Should I send it close messages and then start a new one? Or should I
reconnect to the client library.  This wouldn't be as big of an issue but I
need to use durable/persistent queues and if I still have a listener hanging
around with the same bindings on the same queue it will eat all my messages
and send them nowhere.

Thanks,
-Max

On Thu, Jun 30, 2011 at 7:48 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi Max,
>
> On Wed, Jun 29, 2011 at 06:28:59PM -0400, Max Warnock wrote:
> > I've built a behavior in erlang to subscribe to a given topic exchange
> and
> > farm out message handling.  I'm using the rabbitmq amqp_client library
> for
> > erlang and when I put the system under heavy load I get, on occasion, the
> > following error:
>
> Could you let us know which version of Rabbit, Erlang and the Erlang
> client you're using?
>
> > =ERROR REPORT==== 29-Jun-2011::18:02:18 ===
> > ** Generic server <0.1117.0> terminating
> > ** Last message in was {'$gen_cast',
> >                            {method,
> >                                {'channel.close',406,
> >                                    <<"PRECONDITION_FAILED - unknown
> delivery
> > tag 856">>,
> >                                    60,80},
>
> That's a double-ack (probably). Sadly, the AMQP 0-9-1 spec says that
> acking is not idempotent, thus it's a fault to ack the same message
> multiple times...
>
> > The server receive loop where the ack happens looks like this:
> > receive
> > ...
> > {#'basic.deliver'{delivery_tag = Tag, routing_key = RoutingKey},
> > #amqp_msg{payload = Payload}} ->
> >     amqp_channel:cast(get(amqp_channel_pid), #'basic.ack'{delivery_tag =
> > Tag}),
> >     spawn_and_queue(spawn_handle_message, Module, RoutingKey, Payload),
> >     loop(Module);
> > ...
> > end
>
> ...hmmm, which is so simple that I can't see how it could go wrong: if
> you're not double acking then something else must be going on to make
> the broker think that it's not expecting an ack for that message, hence
> the error. If you're doing some sort of reject operation - either
> basic.nack or basic.reject on messages and you then subsequently ack one
> of those messages then that would also cause this error. There may be
> other cases as well.
>
> > The amqp_client_sup can't seem to bring back the the client either and
> dies
> > from the retry intensity being reached.  I've done a hefty amount of
> > googling and can't seem to find where things could be going wrong.
>  Before
> > jumping into the amqp_client code I thought I'd ask the mailing list if
> they
> > have any ideas.  The only thing I can think is that there is a race
> > condition within the client library.  I will be double checking my code
> to
> > be sure it isn't sending the ack twice, but given the simplicity of the
> ack
> > the only way it could is if it receives the same message (with identical
> > delivery tag) from the amqp_client library twice.
>
> It could be a bug in the client library, but I'd be a little surprised
> if we're managing to duplicate messages somehow - that would be a new
> level of fail for us. ;) However, the fact that the entire connection
> dies is alarming and almost certainly a bug: PRECONDITION_FAILED is a
> soft error and should only tear down the channel, not the whole
> connection. After that, all you should have to do is create a new
> channel and everything else should be ok. If that's not the case please
> let us know.
>
> Best wishes,
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/ef964c26/attachment.htm>

From mikeb at rabbitmq.com  Thu Jun 30 14:26:31 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 30 Jun 2011 14:26:31 +0100
Subject: [rabbitmq-discuss] Routing key match algorithms
In-Reply-To: <cd23cb25-8fbf-49be-b3dc-d716291a1abb@jbrisbin.local>
References: <cd23cb25-8fbf-49be-b3dc-d716291a1abb@jbrisbin.local>
Message-ID: <4E0C7987.3070708@rabbitmq.com>

> The problem I see is that, if a consumer issues a regex as a pattern for
> a subscription, when a message gets published, how do I find out all the
> regexes I know about that match? Do I loop over all the consumers,
> asking each one if they match or not? Seems kind of inefficient.

Indeed.  Building an FSM with bindings as transitions states would be a 
start.  "Collecting" states after binding deletion is likely to be the 
tricky bit.

> Just wondering if this problem was known and passed over early on, and
> the */# mechanism used to get around this problem.

I suspect the */# mechanism was made to match JMS implementations, and I 
suspect those used it because it was fairly easy to implement and to 
grasp as a user.

Regular expressions are not tougher in kind than globbing, since they 
both describe regular languages.  They are more fiddly to implement however.

> I also thought about using some text indexing engine (a la lucene) to
> solve this problem, but if a message gets published with a specific
> routing key, you'd have to re-run the search attached to the consumers
> to get an updated list of messages that match a given regex. So there's
> no benefit from doing that either, so far as I can tell.

One approach to implementing topic matching is to keep something a bit 
like a reverse index: http://www.openamq.org/doc:fast-topic-matching

Vlad at Rabbit tried this among other techniques, and posted his results:
http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1/ 
and 
http://www.rabbitmq.com/blog/2011/03/28/very-fast-and-scalable-topic-routing-part-2/


mkb

From james.r.carr at gmail.com  Thu Jun 30 14:53:43 2011
From: james.r.carr at gmail.com (James Carr)
Date: Thu, 30 Jun 2011 08:53:43 -0500
Subject: [rabbitmq-discuss] Synchronizing on Channel
Message-ID: <BANLkTin+sjvjOfzUJ-tZouqqMS1d0Pq0UQ@mail.gmail.com>

Hi All,

We're currently integrating amqp-client into one of our legacy batch
systems (to give you an idea, the project name has the word "threader"
in it) and we've sadly discovered that reworking it to create a
channel per thread will be extremely difficult. This has led me to
wonder what the overhead costs are associated with sycnhronizing on
channel? I don't want to do it, but it's one of those situations where
reworking the legacy system might prove more expensive than the
requirements need. :)


Thanks,
James

From ekirpichov at gmail.com  Thu Jun 30 15:07:52 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 30 Jun 2011 18:07:52 +0400
Subject: [rabbitmq-discuss] rabbitmq_mnesia:wait_for_tables() - make timeout
	of 30 sec configurable?
Message-ID: <BANLkTi=ETsxUWbLZWvj-Hevapj4y5xLSQA@mail.gmail.com>

Hi,

I'm facing an issue where upon restart of a whole rabbitmq cluster, it
is sometimes the case that the current "main" node of the cluster (if
I'm understanding correctly, there exists a notion of leadership in a
RabbitMQ cluster?) takes longer to restart (e.g. the machine takes
longer to reboot) and all other nodes fail to start up with an error
like the one described below.

I looked into the source and found this:

wait_for_tables(TableNames) ->
    case mnesia:wait_for_tables(TableNames, 30000) of
        ok ->
            ok;
        {timeout, BadTabs} ->
            throw({error, {timeout_waiting_for_tables, BadTabs}});
        {error, Reason} ->
            throw({error, {failed_waiting_for_tables, Reason}})
    end.

So, there's a hard-coded value of 30 seconds.

I propose to replace that line with:
WaitTimeout = case application:get_env(mnesia_wait_for_tables_timeout)
of {ok,T} -> t; _ -> 30000),
case mnesia:wait_for_tables(TableNames, WaitTimeout) of ...

Is my understanding of what's going on right? Does it make sense to
make this setting configurable in this way?


=ERROR REPORT==== 30-Jun-2011::06:01:28 ===
FAILED
Reason: {error,
            {timeout_waiting_for_tables,
                [rabbit_user,rabbit_user_permission,rabbit_vhost,
                 rabbit_durable_route,rabbit_durable_exchange,
                 rabbit_durable_queue]}}
Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
             {rabbit_mnesia,check_schema_integrity,0},
             {rabbit_mnesia,ensure_schema_integrity,0},
             {rabbit_mnesia,init_db,3},
             {rabbit_mnesia,init,0},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
             {rabbit,run_boot_step,1},
             {rabbit,'-start/2-lc$^0/1-0-',1}]

=INFO REPORT==== 30-Jun-2011::06:01:29 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From aaron at agoragames.com  Thu Jun 30 15:26:02 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 30 Jun 2011 10:26:02 -0400
Subject: [rabbitmq-discuss] is anybody using tx?
In-Reply-To: <4E089B89.4080009@rabbitmq.com>
References: <4E089B89.4080009@rabbitmq.com>
Message-ID: <BANLkTimNOEibxxH01rt01xuGGx3PLz53yw@mail.gmail.com>

I've only read part of the thread, but we are making use of
transactions for all of our publishing. We haven't switched to
'confirms' because it's a feature were weren't aware of and it would
need to be thoroughly integrated into our stack.

For us, transactions allow both high throughput and message delivery
reliability. Before transactions, we'd be pushing messages through a
channel and if there was an error, the channel would be closed with
some number of messages lost on that channel. Worse, "frames in
flight" would cause RabbitMQ to close the connection entirely because
it would receive frames on a channel after closing it.

To ensure throughput, we used a pooling scheme that's now abstracted
into haigha's ChannelPool.

We're not overly concerned about compliance with strict adherence to
the AMQP spec as we intend to use RabbitMQ for a long time to come,
but it is beneficial for us to stay within spec to ensure that both
the broker and client are coded to a similar standard.

-Aaron


On Mon, Jun 27, 2011 at 11:02 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> What use, if any, are RabbitMQ users finding for AMQP's tx class?
>
> The predominant application of tx we have seen in the past is as a means for
> the client to ensure that the server has accepted responsibility for a
> published message (or, conversely, be told of any failure to do so).
> Publisher confirms, which we introduced in 2.3.0, handle this much better. I
> suppose there might be still be users that haven't switched from 'tx' to
> 'confirm'. If so I'd like to know what is holding you back.
>
> What else are people using tx for with RabbitMQ? And what aspects of tx
> semantics are you relying on? (Note, for example, that the tx specified in
> AMQP 0-9-1 is very limited. For example, atomicity is not guaranteed for
> transactions affecting more than one queue.)
>
> Our current thinking is that tx, as it stands, is of very limited utility
> and that we are probably better off without it - it adds significant code
> complexity, slows down implementation of new features and is generally
> curtailing the evolution of RabbitMQ.
>
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From abeming.sf at gmail.com  Thu Jun 30 15:17:32 2011
From: abeming.sf at gmail.com (Abeming Sf)
Date: Thu, 30 Jun 2011 22:17:32 +0800
Subject: [rabbitmq-discuss] Management Plugins Not Activated
Message-ID: <CAL5L6UhOH8FWsA4rBWbK-nWtc4pYaJfqn=nZWCicJey7cbVSQw@mail.gmail.com>

Hi,

I'm not able to activate management plugins. All required files copied to
plugins directory but after a restart only amqp_client plugin activated.

Activating RabbitMQ plugins ...
1 plugins activated:
* amqp_client-2.3.1

What am I missing here?Using default rabbitmq from ubuntu (11.04) apt-get.

-Abe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/c2bba3e8/attachment.htm>

From aaron at agoragames.com  Thu Jun 30 15:31:00 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 30 Jun 2011 10:31:00 -0400
Subject: [rabbitmq-discuss] Synchronizing on Channel
In-Reply-To: <BANLkTin+sjvjOfzUJ-tZouqqMS1d0Pq0UQ@mail.gmail.com>
References: <BANLkTin+sjvjOfzUJ-tZouqqMS1d0Pq0UQ@mail.gmail.com>
Message-ID: <BANLkTi=F0ytoaWqZAE5zKqLmmy7oV1X-og@mail.gmail.com>

If you're using transactions, that's not out of the question. If
you're using Python you can use or adapt haigha's ChannelPool and
frame queuing to see how that's done. In other languages or
situations, you could use a thread-safe queue and use the transaction
commit event to pull the next job off.

-Aaron

On Thu, Jun 30, 2011 at 9:53 AM, James Carr <james.r.carr at gmail.com> wrote:
> Hi All,
>
> We're currently integrating amqp-client into one of our legacy batch
> systems (to give you an idea, the project name has the word "threader"
> in it) and we've sadly discovered that reworking it to create a
> channel per thread will be extremely difficult. This has led me to
> wonder what the overhead costs are associated with sycnhronizing on
> channel? I don't want to do it, but it's one of those situations where
> reworking the legacy system might prove more expensive than the
> requirements need. :)
>
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From alfonso.pantoja at gmail.com  Thu Jun 30 16:39:22 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 30 Jun 2011 08:39:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Default Virtual Host and HTTP API problem
Message-ID: <f317ef14-4c73-4877-a84d-27e9717dfeb4@l14g2000pro.googlegroups.com>

Hi,


Is it possible to rename the default virtual host name "/" without
affecting the queues and exchanges
or to assign an alias to it?

I've found a problem using the HTTP API. Using .NET you should use
sockets or a hack to make a webrequest using the character %2F
because .NET replaces that %2F by "/"
so http://server/api/%2F/queues becomes always http://server/api///queues
and a not found is get.

Thank you in advance,

Regards,

Alfonso

From vbernard42 at gmail.com  Thu Jun 30 16:58:52 2011
From: vbernard42 at gmail.com (Valentin Bernard)
Date: Thu, 30 Jun 2011 08:58:52 -0700 (PDT)
Subject: [rabbitmq-discuss] Default Virtual Host and HTTP API problem
In-Reply-To: <f317ef14-4c73-4877-a84d-27e9717dfeb4@l14g2000pro.googlegroups.com>
References: <f317ef14-4c73-4877-a84d-27e9717dfeb4@l14g2000pro.googlegroups.com>
Message-ID: <82a9476f-1f2f-4680-a9e7-b8cb8386d957@q29g2000prj.googlegroups.com>

Hi,

Maybe you could try escaping the '%' character as well, e.g. :
http://server/api/%252F/queues

Regards,

Valentin.

On Jun 30, 5:39?pm, Alfonso Pantoja <alfonso.pant... at gmail.com> wrote:
> Hi,
>
> Is it possible to rename the default virtual host name "/" without
> affecting the queues and exchanges
> or to assign an alias to it?
>
> I've found a problem using the HTTP API. Using .NET you should use
> sockets or a hack to make a webrequest using the character %2F
> because .NET replaces that %2F by "/"
> sohttp://server/api/%2F/queuesbecomes alwayshttp://server/api///queues
> and a not found is get.
>
> Thank you in advance,
>
> Regards,
>
> Alfonso
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From steve at rabbitmq.com  Thu Jun 30 17:06:18 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 30 Jun 2011 17:06:18 +0100
Subject: [rabbitmq-discuss] Feedback on STOMP changes
In-Reply-To: <iu4e5e$3dc$1@dough.gmane.org>
References: <4E04923C.4090307@rabbitmq.com> <iu4e5e$3dc$1@dough.gmane.org>
Message-ID: <5519FF1E-FA79-4A6D-8A0D-165C0F2E0B8A@rabbitmq.com>

May I point out to readers of this thread that the changes described by Rob's note apply only to queues.
The present case (where we create a queue on SEND) is where the destination is of the form /queue/*.

So the proposal will not affect topic pubSub applications, but only point-to-point queue SEND/SUBSCRIBEs.

It is pertinent that if a publisher sends to a topic for which there are no subscribers, then the message is discarded anyway; so the negative case here is only for SEND before SUBSCRIBE to a specific queue. If that queue was created (and not deleted) beforehand, then all would be well.

If we continue to create queues on SENDs to non-existent queue destinations, then we have the knotty problem of what properties those queues should have. Leaving this problem to the SUBSCRIBER seems to be natural and predictable as well as having the advantages outlined in Rob's note.

We anticipate a STOMP requirement to create a queue (which might be durable, shared, etc) explicitly, just in case some non-subscriber (e.g. a SENDer ?) needs to ensure it exists.  This would probably be a non-standard frame command added to our STOMP support, but it could be done, with our proposed changes, by SUBSCRIBE-ing with the appropriate properties, and then UNSUBSCRIBE-ing immediately afterwards.  If the queue was NOT auto-deleted then subsequent SENDs could operate successfully.

No-one seems to have  reacted to the throughput performance advantages of the proposal, which might be considerable.

Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 25 Jun 2011, at 11:43, Michael Justin wrote:

> Am 24.06.2011 15:33, Rob Harrop wrote:
> 
>> We'll add support for durable, exclusive, auto-delete and everything
>> else as headers on the SUBSCRIBE frame.
> 
> The Stomp+JMS bindings page http://stomp.codehaus.org/Stomp+JMS has a implementation recommendation for durable subscribers (more ore less implemented in this way in other brokers):
> 
> quote:
> "
> If you wish to create a durable topic subscriber you will need to do the following
> 
> *    set the client-id header on the CONNECT to a globally unique String for the Stomp connection
> *    set the durable-subscriber-name header on the SUBSCRIBE command.
> 
> The combination of the client-id and durable-subscriber-name uniquely identifies the durable topic subscription. i.e. after you restart your program and re-subscribe, the Broker will know which messages you need that were published while you were away"
> 
> 
> For compatibility of Stomp client implementations, RabbitMQ could implement it following this specification.
> 
> Regards,
> Michael Justin
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/1ead428c/attachment.htm>

From joseph.a.marlin at gmail.com  Thu Jun 30 17:24:01 2011
From: joseph.a.marlin at gmail.com (Joseph Marlin)
Date: Thu, 30 Jun 2011 09:24:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Management Plugins Not Activated
In-Reply-To: <CAL5L6UhOH8FWsA4rBWbK-nWtc4pYaJfqn=nZWCicJey7cbVSQw@mail.gmail.com>
Message-ID: <24863890.3400.1309451041722.JavaMail.geo-discussion-forums@yqad28>

Can you list the complete names of your other .ez files in your plugins 
directory, which should be something 
like /usr/lib/rabbitmq/lib/rabbitmq_server-version/plugins on 11.04?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/3813e808/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Thu Jun 30 17:37:17 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 30 Jun 2011 12:37:17 -0400
Subject: [rabbitmq-discuss] Default Virtual Host and HTTP API problem
In-Reply-To: <f317ef14-4c73-4877-a84d-27e9717dfeb4@l14g2000pro.googlegroups.com>
References: <f317ef14-4c73-4877-a84d-27e9717dfeb4@l14g2000pro.googlegroups.com>
Message-ID: <CAM8fPiRKF0ifrFDJ9MgPiLaJj2s6tCub=7uoyR_DRPqd4aY+aw@mail.gmail.com>

Hi Alfonso,

On 30 June 2011 11:39, Alfonso Pantoja <alfonso.pantoja at gmail.com> wrote:

> I've found a problem using the HTTP API. Using .NET you should use
> sockets or a hack to make a webrequest using the character %2F
> because .NET replaces that %2F by "/"
> so http://server/api/%2F/queues becomes always http://server/api///queues
> and a not found is get.
>

I recommend avoiding the broken Microsoft HTTP client library, and using a
better third-party library. A few minutes googling produced
http://www.codescales.com/, which looks plausible.

(It seems that MS have actually willfully crippled their client: see, for
instance, this bug
report<http://connect.microsoft.com/VisualStudio/feedback/details/94109/system-uri-constructor-evaluates-escaped-slashes-and-removes-double-slashes>.
"We are not aware of any such real world scenarios currently."?good grief!)

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/a4935cb5/attachment.htm>

From simone.busoli at gmail.com  Thu Jun 30 19:04:25 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Thu, 30 Jun 2011 20:04:25 +0200
Subject: [rabbitmq-discuss] Default Virtual Host and HTTP API problem
Message-ID: <BANLkTimmhXQJBkjXDuynrNHbTKTQtADM=g@mail.gmail.com>

Alfonso, the workaround is quite simple, and btw it's flaw in MS
implementation. If you need ideas about how to solve it you can check out
what I did in the rest API wrapper for .NET I created here (the workaround
comes from stackoverflow btw):
http://code.google.com/p/mexexp/source/browse/trunk/RabbitMQ/Resbit/ResbitClient.cs
On Jun 30, 2011 5:39 PM, "Alfonso Pantoja" <alfonso.pantoja at gmail.com>
wrote:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/cb26c13a/attachment.htm>

From habtdemis at gmail.com  Thu Jun 30 19:43:37 2011
From: habtdemis at gmail.com (Demiss Zike)
Date: Thu, 30 Jun 2011 13:43:37 -0500
Subject: [rabbitmq-discuss] How to add libraries to GAC
Message-ID: <BANLkTinSearwo7G+gJYeEQzeBP5d2r1TqQ@mail.gmail.com>

My .NET 4.0 doesn't have gacutil. How can I include my RabbitMQ.Client.dll
so that I don't have to append it to the command every time I compile?

Demi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/ce142bb6/attachment.htm>

From chris.madden at gmail.com  Thu Jun 30 20:47:21 2011
From: chris.madden at gmail.com (Chris Madden)
Date: Thu, 30 Jun 2011 15:47:21 -0400
Subject: [rabbitmq-discuss] Issue with rabbit starting up every time
Message-ID: <068C0966A93143AA93D90B5720231FA4@gmail.com>

I have 2 nodes in a cluster, both are disc nodes. Occasionally, following a reboot, rabbit will not start.  The error I get is the dreaded timeout_waiting_for_tables. The googles indicate that this can happen when host names change, but that isn't happening. Further, when I get this problem, one node is always up and stable, and network connectivity appears fine.

Interestingly, it seems to correct itself if I continue to restart rabbit. Sometimes it can take 15-20 attempts to get it to start correctly. It *feels* like a race internal to rabbit to me, as I see it more on single processor systems than I do on multi-processor systems. I don't have any durable or persistent queues for it to have to load or anything, just 1 user in the database and a couple permissions.

I'm suspicious of http://hg.rabbitmq.com/rabbitmq-server/file/5f84b55205fd/src/rabbit_mnesia.erl#l610, with a hard coded timeout a heavily loaded system (which this is definitely at boot time) may take more than 30 seconds (assuming I'm reading that correctly).

I've rabbit 2.5.0 on linux on erlang R14B03

Looking at the log files I see:

+---+ +---+
| | | |
| | | |
| | | |
| +---+ +-------+
| |
| RabbitMQ +---+ |
| | | |
| v2.5.0 +---+ |
| |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL. See http://www.rabbitmq.com/

node : rabbit at halfoat (mailto:rabbit at halfoat)
app descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.5.0/sbin/../ebin/rabbit.app
home dir : /var/lib/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash : nwwpVc1h/mTYt75nAmVI0A==
log : /var/log/rabbitmq/rabbit at halfoat.log (mailto:/var/log/rabbitmq/rabbit at halfoat.log)
sasl log : /var/log/rabbitmq/rabbit at halfoat-sasl.log (mailto:/var/log/rabbitmq/rabbit at halfoat-sasl.log)
database dir : /var/db/rabbitmq/rabbit at halfoat (mailto:/var/db/rabbitmq/rabbit at halfoat)
erlang version : 5.8.4

-- rabbit boot start
starting file handle cache server ...
=INFO REPORT==== 30-Jun-2011::19:09:41 ===
Limiting to approx 924 file handles (829 sockets)
done
starting worker pool ...done
starting database ...

At this point it pauses, then times out, dumping:

Reason: {error,
 {timeout_waiting_for_tables,
 [rabbit_user,rabbit_user_permission,rabbit_vhost,
rabbit_durable_route,rabbit_durable_exchange,
rabbit_durable_queue]}}
Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
{rabbit_mnesia,check_schema_integrity,0},
{rabbit_mnesia,ensure_schema_integrity,0},
{rabbit_mnesia,init_db,3},
{rabbit_mnesia,init,0},
{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
{rabbit,run_boot_step,1},
{rabbit,'-start/2-lc$^0/1-0-',1}]
Erlang has closed
{"Kernel pid terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}



From Lowell.Boggs at emc.com  Thu Jun 30 22:27:37 2011
From: Lowell.Boggs at emc.com (Lowell.Boggs at emc.com)
Date: Thu, 30 Jun 2011 17:27:37 -0400
Subject: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same
	message
Message-ID: <8A1A883E3F171B42A81817DEC138352C1DB3305A9B@MX06A.corp.emc.com>

I am confused by my experiments with rabbitmq-c.

I was trying to follow the task worker tutorial:

    http://www.rabbitmq.com/tutorials/tutorial-two-python.html

Of course, I'm using C interfaces not the python or Java interfaces.

Being a newbie it is probable that I'm doing something wrong, but:

The tutorial implies to me that if I have:

 *   one exchange+topic
 *   two worker executables that read from it

 then

 *   due to round-robin processing, some messages will go to one executable
 *   other messages will go to the other

However, I am seeing that both exectuables receive all the messages -- which is not at all what I want.

Is this supposed to work with the default version of rabbitmq-c?

Immediately upon logging into the channel, in the consumers, I am setting

   basic_qos(conn, 1, 0, 1, 0);

Also, I am calling basic_consume like this:

       amqp_basic_consume(conn,
                         1,
                         amqp_cstring_bytes(queuename),
                         amqp_empty_bytes,
                         0,
                         0,
                         0,
                         amqp_empty_table
                        );


The exchange that i am using is amq.direct.  I have tried an empty string queue name as well as "hello".

I am calling basic_ack() as soon as I receive the messages in both worker executables -- well, after I log their reception.

Any ideas?

Thanks,
  Lowell




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/e5c236eb/attachment.htm>

From simone.busoli at gmail.com  Thu Jun 30 23:06:18 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Fri, 1 Jul 2011 00:06:18 +0200
Subject: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving
 same message
Message-ID: <BANLkTin7FmyKm3m5OxESkAZKVbp5HXs0sA@mail.gmail.com>

Hi Lowell,

The second tutorial does not use a topic exchange, but even with a topic
exchange the situation would be the same. The key point here is that your
workers are reading messages from the same queue. The exchange, topic or
anything else, as soon as it has delivered a message to a queue is out of
the game. The queue receives the message because it's bound to the exchange.
Then you have two or more workers reading from the same queue, thereby
receiving each one message in a round-robin fashion.
On Jun 30, 2011 11:29 PM, <Lowell.Boggs at emc.com> wrote:
> I am confused by my experiments with rabbitmq-c.
>
> I was trying to follow the task worker tutorial:
>
> http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
> Of course, I'm using C interfaces not the python or Java interfaces.
>
> Being a newbie it is probable that I'm doing something wrong, but:
>
> The tutorial implies to me that if I have:
>
> * one exchange+topic
> * two worker executables that read from it
>
> then
>
> * due to round-robin processing, some messages will go to one executable
> * other messages will go to the other
>
> However, I am seeing that both exectuables receive all the messages --
which is not at all what I want.
>
> Is this supposed to work with the default version of rabbitmq-c?
>
> Immediately upon logging into the channel, in the consumers, I am setting
>
> basic_qos(conn, 1, 0, 1, 0);
>
> Also, I am calling basic_consume like this:
>
> amqp_basic_consume(conn,
> 1,
> amqp_cstring_bytes(queuename),
> amqp_empty_bytes,
> 0,
> 0,
> 0,
> amqp_empty_table
> );
>
>
> The exchange that i am using is amq.direct. I have tried an empty string
queue name as well as "hello".
>
> I am calling basic_ack() as soon as I receive the messages in both worker
executables -- well, after I log their reception.
>
> Any ideas?
>
> Thanks,
> Lowell
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110701/7f6a7ce8/attachment.htm>

From mpietrek at skytap.com  Thu Jun 30 23:13:10 2011
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 30 Jun 2011 15:13:10 -0700
Subject: [rabbitmq-discuss] First Python sample (send.py) gives error:
 AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'
Message-ID: <CA324306.80D7%mpietrek@skytap.com>

I've just now followed the directions verbatim from here:
http://www.rabbitmq.com/tutorials/tutorial-one-python.html
<http://www.rabbitmq.com/tutorials/tutorial-one-python.html>

I've copied/pasted the sample code for send.py and receive.py directly from
the web page so as to eliminate errors. Unfortunately, I'm getting the
following error:

foo at foo-desktop:~/rabbitmq-test$ python send.py
Traceback (most recent call last):
  File "send.py", line 4, in <module>
    connection = 
pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
  File "/home/foo/src/pika-v0.9.5/pika/adapters/blocking_connection.py",
line 32, in __init__
    BaseConnection.__init__(self, parameters, None, reconnection_strategy)
  File "/home/foo/src/pika-v0.9.5/pika/adapters/base_connection.py", line
50, in __init__
    reconnection_strategy)
  File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 170, in __init__
    self._connect()
  File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 228, in _connect
    self.parameters.port or spec.PORT)
  File "/home/foo/src/pika-v0.9.5/pika/adapters/blocking_connection.py",
line 44, in _adapter_connect
    self._handle_read()
  File "/home/foo/src/pika-v0.9.5/pika/adapters/base_connection.py", line
162, in _handle_read
    self._on_data_available(data)
  File "/home/foo/src/pika-v0.9.5/pika/connection.py", line 597, in
_on_data_available
    elif frame.channel_number > 0:
AttributeError: 'ProtocolHeader' object has no attribute 'channel_number'


Python version is 2.6.5. I'm running this on an ubuntu 10.4 system. Pip and
Pika were downloaded today per the web site instructions.


I've searched everywhere and can't see the error referenced.


Many thanks to anybody that can help me.


Matt Pietrek.





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110630/ff91d0e8/attachment.htm>

