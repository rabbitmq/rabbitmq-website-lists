<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Federation connections, VIPs, and queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20connections%2C%20VIPs%2C%20and%20queues&In-Reply-To=%3CCACLE7ix%2BHfLUkVrvP_u%3Dc2T-xM5Di%2BJSAFaoFZGs00ffkq%2BOXw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024426.html">
   <LINK REL="Next"  HREF="024475.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Federation connections, VIPs, and queues</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20connections%2C%20VIPs%2C%20and%20queues&In-Reply-To=%3CCACLE7ix%2BHfLUkVrvP_u%3Dc2T-xM5Di%2BJSAFaoFZGs00ffkq%2BOXw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Federation connections, VIPs, and queues">mpietrek at skytap.com
       </A><BR>
    <I>Wed Dec 12 17:06:23 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024426.html">[rabbitmq-discuss] Federation connections, VIPs, and queues
</A></li>
        <LI>Next message: <A HREF="024475.html">[rabbitmq-discuss] Federation connections, VIPs, and queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24473">[ date ]</a>
              <a href="thread.html#24473">[ thread ]</a>
              <a href="subject.html#24473">[ subject ]</a>
              <a href="author.html#24473">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ping on this question - My guess it that it just got lost in the shuffle.

Also, just realized in the above question that I transposed something. The
two lines that say:


federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slave</A>
federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slave-alternate</A>

Should instead be:

federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at master</A>
federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at master-alternate</A>

Thanks,

Matt


On Mon, Dec 10, 2012 at 1:17 PM, Matt Pietrek &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mpietrek at skytap.com</A>&gt; wrote:

&gt;<i> I realize this is a somewhat esoteric question and apologize for the
</I>&gt;<i> complexity. We're still on 2.8.7 for a while, although my guess is that
</I>&gt;<i> federation in 3.0 won't drastically change the answer.
</I>&gt;<i>
</I>&gt;<i> In our setup, we have bidirectionally federated nodes, i.e.  'slave' &lt;-&gt;
</I>&gt;<i> 'master' with an exchange named 'skytap'.  To this mix I add a set of
</I>&gt;<i> alternate nodes to enable non-stopping upgrades: 'master-alternate' and
</I>&gt;<i> 'slave-alternate'. The primary and alternate nodes are identically
</I>&gt;<i> configured.
</I>&gt;<i>
</I>&gt;<i> I'm using VIPs (keepalive based) for connections between nodes. There's a
</I>&gt;<i> vip-master and a vip-slave. Most of the time vip-master points at the
</I>&gt;<i> 'master&quot; node, but occasionally points at the 'master-alternate&quot; node. In
</I>&gt;<i> the rabbitmq.config, I specify the VIP names everywhere (i.e vip-master,
</I>&gt;<i> vip-alternate), and never mention the actual node names.
</I>&gt;<i>
</I>&gt;<i> When I first start this up, I see a federation support queue like this:
</I>&gt;<i>
</I>&gt;<i> federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at master</A>
</I>&gt;<i>
</I>&gt;<i> This is what I'd expect based on my understanding of federation.
</I>&gt;<i>
</I>&gt;<i> However, after doing an upgrade process (i.e., vip-master goes from
</I>&gt;<i> 'master' to 'master-alternate' and back to 'master'), I have two queues now:
</I>&gt;<i>
</I>&gt;<i> federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slave</A>
</I>&gt;<i> federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slave-alternate</A>
</I>&gt;<i>
</I>&gt;<i> This isn't so good. The vast majority of the time the slave-alternate node
</I>&gt;<i> isn't around. Messages sent to the skytap exchange just pile up in the
</I>&gt;<i> second queue. (The do of course get delivered to the non-alternate slave
</I>&gt;<i> node.)
</I>&gt;<i>
</I>&gt;<i> *Question 1:*
</I>&gt;<i> I'm trying to understand this behavior. It's almost as if the federation
</I>&gt;<i> logic is burrowing underneath my VIP and discovering the actual node names.
</I>&gt;<i> In my naive understanding, I'd expect that the use of VIPs would hide away
</I>&gt;<i> the primary/alternate nodes.
</I>&gt;<i>
</I>&gt;<i> That said, I do notice in the connections list that incoming connections
</I>&gt;<i> come from the 'regular' node IP, not from the VIP that's assigned to the
</I>&gt;<i> same node. Not sure if this is relevant or not.
</I>&gt;<i>
</I>&gt;<i> *Question 2:*
</I>&gt;<i> In a related vein, looking at the Exchanges I see exchanges like this:
</I>&gt;<i>
</I>&gt;<i> federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slave</A> A
</I>&gt;<i> federation: skytap -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at slave-alternate</A> B
</I>&gt;<i>
</I>&gt;<i> What do the A/B signify?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Matt
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121212/8ac60434/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121212/8ac60434/attachment.htm</A>&gt;
</PRE>














































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024426.html">[rabbitmq-discuss] Federation connections, VIPs, and queues
</A></li>
	<LI>Next message: <A HREF="024475.html">[rabbitmq-discuss] Federation connections, VIPs, and queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24473">[ date ]</a>
              <a href="thread.html#24473">[ thread ]</a>
              <a href="subject.html#24473">[ subject ]</a>
              <a href="author.html#24473">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
