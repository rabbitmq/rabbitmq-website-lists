<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RMQ performance between high MHz/low core vs lower MHz/high core servers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RMQ%20performance%20between%20high%20MHz/low%20core%20vs%0A%20lower%20MHz/high%20core%20servers&In-Reply-To=%3CCAJ1JW0ea1zEG_9%2BiJLW%2BWjey0rjmJyijJ-KB9i4L2ezVpJwfEA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024623.html">
   <LINK REL="Next"  HREF="024657.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RMQ performance between high MHz/low core vs lower MHz/high core servers</H1>
    <B>Matthias Reik</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RMQ%20performance%20between%20high%20MHz/low%20core%20vs%0A%20lower%20MHz/high%20core%20servers&In-Reply-To=%3CCAJ1JW0ea1zEG_9%2BiJLW%2BWjey0rjmJyijJ-KB9i4L2ezVpJwfEA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RMQ performance between high MHz/low core vs lower MHz/high core servers">matthias.reik at gmail.com
       </A><BR>
    <I>Fri Dec 21 10:03:54 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024623.html">[rabbitmq-discuss] RMQ performance between high MHz/low core vs	lower MHz/high core servers
</A></li>
        <LI>Next message: <A HREF="024657.html">[rabbitmq-discuss] RMQ performance between high MHz/low core vs lower MHz/high core servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24629">[ date ]</a>
              <a href="thread.html#24629">[ thread ]</a>
              <a href="subject.html#24629">[ subject ]</a>
              <a href="author.html#24629">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>One thing we found out is that disk-IO is the bottleneck in our setup (most
queues are ACK-ed, HA- queues). Our solutions:
1) batching of messages improved performance (message size bigger, but less
messages)
2) Faster disks (10k spinners RAIDed) improved performance

So make sure you also look at that part of the system.

Cheers
Maze


On Thu, Dec 20, 2012 at 6:27 PM, Chris Schmidt &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cischmidt77 at gmail.com</A>&gt;wrote:

&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> On Dec 20, 2012, at 9:07 AM, Matthias Radestock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Chris,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 20/12/12 16:18, Chris Schmidt wrote:
</I>&gt;<i> &gt;&gt; There are 22 queues
</I>&gt;<i> &gt; &gt; [...]
</I>&gt;<i> &gt;&gt; A vendor let us borrow the 40-core machine to see if it would work
</I>&gt;<i> &gt;&gt; better.  [...] Each core is only 11-15% utilized.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You may not be able to saturate 40 cores with 22 queues. Depends on how
</I>&gt;<i> many producers and consumers there are.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The other constraint could be scheduling and general Erlang multi-core
</I>&gt;<i> performance. This has improved *considerably* over the last few years. So
</I>&gt;<i> please make sure you are running the latest Erlang/OTP release - R15B03.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You may also want to tweak the various smp/scheduling related settings
</I>&gt;<i> in Erlang. In particular I have seen massive performance differences when
</I>&gt;<i> adjusting the +swt setting.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> RHEL 6.2 doesn't seem to have the latest version of Erlang available in
</I>&gt;<i> the repositories. Does anyone have experience with manually building Erlang
</I>&gt;<i> on that platform with success? We're on R14B04 right now. There are a huge
</I>&gt;<i> number of erlang related rpms that get installed I'm not certain if a
</I>&gt;<i> single Erlang version for CentOS would work properly or not.
</I>&gt;<i>
</I>&gt;<i> I had +K true -smp enable +native +sbtps plus the other RMQ defaults set
</I>&gt;<i> on the 40 core machine while testing. I also removed everything to use
</I>&gt;<i> plain vanilla RMQ settings to see how that impacted performance.
</I>&gt;<i>
</I>&gt;<i> I also had 15 consumers running against the initial queue that was having
</I>&gt;<i> problems. I also tried sending the data into 2 - 40 exchanges (and updated
</I>&gt;<i> the queue to read from those exchanges) in order to see if I could spread
</I>&gt;<i> the load that way. Does a single process manage each queue? If so I can see
</I>&gt;<i> that being a potential bottleneck due to the core's speed difference.
</I>&gt;<i>
</I>&gt;<i> Is there an erlang or rabbitmqctl command that I can run against the RMQ
</I>&gt;<i> server to determine if the queues themselves are the bottleneck?
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; I've tried HiPE in the past, but the system % jumped considerably
</I>&gt;<i> &gt;&gt; and we actually got poorer performance and instability.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That's odd. Again, please make sure you are runninng the latest Erlang;
</I>&gt;<i> HiPE is another area that has improved considerably recently.
</I>&gt;<i>
</I>&gt;<i> I'd definitely like to try HiPE again since we're CPU bound on the
</I>&gt;<i> existing production server.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; I know the cores are slower in overall speed, but I would have bet
</I>&gt;<i> &gt;&gt; money that in  aggregate this machine would outperform our other one.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Depends on the workload. e.g. if queues are the bottleneck then having
</I>&gt;<i> many more (slow) cores than queues won't help.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Matthias.
</I>&gt;<i>
</I>&gt;<i> I appreciate the pointers, thanks Matthias!
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121221/d7a4338e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121221/d7a4338e/attachment.htm</A>&gt;
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024623.html">[rabbitmq-discuss] RMQ performance between high MHz/low core vs	lower MHz/high core servers
</A></li>
	<LI>Next message: <A HREF="024657.html">[rabbitmq-discuss] RMQ performance between high MHz/low core vs lower MHz/high core servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24629">[ date ]</a>
              <a href="thread.html#24629">[ thread ]</a>
              <a href="subject.html#24629">[ subject ]</a>
              <a href="author.html#24629">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
