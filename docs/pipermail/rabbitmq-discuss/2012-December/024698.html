<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] HA Queue declaration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20Queue%20declaration&In-Reply-To=%3C0A43D5F6-2457-485C-9291-135F02ED097E%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024697.html">
   <LINK REL="Next"  HREF="024699.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] HA Queue declaration</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20Queue%20declaration&In-Reply-To=%3C0A43D5F6-2457-485C-9291-135F02ED097E%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] HA Queue declaration">tim at rabbitmq.com
       </A><BR>
    <I>Fri Dec 28 14:35:50 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024697.html">[rabbitmq-discuss] HA Queue declaration
</A></li>
        <LI>Next message: <A HREF="024699.html">[rabbitmq-discuss] HA Queue declaration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24698">[ date ]</a>
              <a href="thread.html#24698">[ thread ]</a>
              <a href="subject.html#24698">[ subject ]</a>
              <a href="author.html#24698">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

On 28 Dec 2012, at 14:29, Austin Buckner wrote:

&gt;<i> When I try pushing it out to our test env I get this error from the rabbit logs:
</I>&gt;<i> 
</I>&gt;<i> connection &lt;0.15043.4&gt;, channel 1 - error:
</I>&gt;<i> {amqp_error,precondition_failed,
</I>&gt;<i>             &quot;inequivalent arg 'x-ha-policy'for queue 'queue.name' in vhost '/': received the value 'all' of type 'longstr' but current is none&quot;,
</I>&gt;<i>             'queue.declare'}
</I>&gt;<i> 
</I>
This error is quite explicit - there is already a queue with the same name in that vhost, for which the x-ha-policy is set to 'none' - declaring it with a different policy is an error.

&gt;<i> 
</I>&gt;<i> I've tried pushing it out with the non HA queues still up, and also with deleting them before trying to spin up the new ones and no dice still can't create these queues. 
</I>
If you've completely deleted the queues first, and redeclared them for the first time with x-ha-policy=all then it should work. If that's not the case, please post a transcript so we can reproduce the problem.

&gt;<i> I don't know if its worth noting that the queue names are still the same all I'm trying to do is simply declare them with the x-ha-policy = all
</I>&gt;<i> 
</I>
If they already exist with a different x-ha-policy then that won't work. Otherwise, you should be fine!

&gt;<i> Map&lt;String,Object&gt; params = new HashMap&lt;String, Object&gt;();
</I>&gt;<i> params.put(&quot;x-ha-policy&quot;, &quot;all&quot;);
</I>&gt;<i> params.put(&quot;x-expires&quot;, TimeUnit.HOURS.toMillis(24));
</I>&gt;<i> 
</I>&gt;<i> Has anyone else run into this problem? I realize I can upgrade to 3.0.1 and implement HA queues at the broker level but at this point I want to try and get this to work without having to go through and upgrade all of our envs.
</I>&gt;<i> 
</I>
Whilst we always suggest upgrading where possible, this *should* work on 2.x series brokers as long as the declaration doesn't clash with an existing object (having different parameters).

Cheers
Tim

</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024697.html">[rabbitmq-discuss] HA Queue declaration
</A></li>
	<LI>Next message: <A HREF="024699.html">[rabbitmq-discuss] HA Queue declaration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24698">[ date ]</a>
              <a href="thread.html#24698">[ thread ]</a>
              <a href="subject.html#24698">[ subject ]</a>
              <a href="author.html#24698">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
