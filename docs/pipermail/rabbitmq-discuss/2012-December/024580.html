<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] BIGIP/F5 and Connection resets
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20BIGIP/F5%20and%20Connection%20resets&In-Reply-To=%3C50D066FA.3090300%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024562.html">
   <LINK REL="Next"  HREF="024598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] BIGIP/F5 and Connection resets</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20BIGIP/F5%20and%20Connection%20resets&In-Reply-To=%3C50D066FA.3090300%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] BIGIP/F5 and Connection resets">emile at rabbitmq.com
       </A><BR>
    <I>Tue Dec 18 12:52:10 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024562.html">[rabbitmq-discuss] BIGIP/F5 and Connection resets
</A></li>
        <LI>Next message: <A HREF="024598.html">[rabbitmq-discuss] BIGIP/F5 and Connection resets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24580">[ date ]</a>
              <a href="thread.html#24580">[ thread ]</a>
              <a href="subject.html#24580">[ subject ]</a>
              <a href="author.html#24580">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Jason,

On 17/12/12 22:53, Jason McIntosh wrote:

&gt;<i> From what I've been told, most network devices drop TCP/IP
</I>&gt;<i> connections after an hour automatically (i.e. switches, routers,
</I>&gt;<i> etc.) and force a reconnect - not sure if Rabbit handles this?
</I>
The broker handles a closed connection by logging the event.

&gt;<i> There is a work around at the moment we're looking into.  It looks like
</I>&gt;<i> most (if not all) Rabbit interfaces have a heartbeat setting that would
</I>&gt;<i> allow connections to be maintained
</I>
Yes, AMQP heartbeats are a suitable solution if intermediate network
devices are closing idle connections too eagerly. Heartbeats are enabled
by default in v3.0.0 if the client supports them.

Another options is to write client applications to re-establish closed
connections after a suitable delay.

If consumers receive messages asynchronously instead of polling the
broker for messages, and there are no messages to deliver then the TCP
connection will carry no traffic.

&gt;<i> Other questions related to the above:  Is the AMQP protocol designed to
</I>&gt;<i> have the clients just sit idle, no communication with the servers until
</I>&gt;<i> a message comes in
</I>
Rabbit does not impose limits on connection duration and idle
connections are permitted to remain so indefinitely.

&gt;<i> If there is no check, and the client hasn't received a message in a
</I>&gt;<i> day at what point do you retry your connection to verify you're even
</I>&gt;<i> still connected? It sounds like in this case you could have a
</I>&gt;<i> consumer of a queue lose it's connection and never realize
</I>
If connections are being severed silently without notification from the
network stack then you must use AMQP heartbeats so that both sides of
the connection become aware of it. Otherwise the network stack should
provide notification that the connection has been interrupted.

&gt;<i> Then you'd have a server just sitting backlogging messages waiting
</I>&gt;<i> for a client (or worse depending on configuration, just dropping all
</I>&gt;<i> the messages).
</I>
The broker will not drop messages due to broken connections and the
protocol is designed so that a guarantee of message delivery can be
offered even in the face of an unreliable transport.

&gt;<i> Looked at the AMQP 0-9-1 specifications and not seeing a whole lot
</I>&gt;<i> defined on how AMQP implementers are supposed to work with TCP/IP
</I>&gt;<i> traffic (other than some heartbeat definitions).
</I>
The &quot;connection&quot; class relates to the transport, which must be
stream-oriented.


-Emile










</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024562.html">[rabbitmq-discuss] BIGIP/F5 and Connection resets
</A></li>
	<LI>Next message: <A HREF="024598.html">[rabbitmq-discuss] BIGIP/F5 and Connection resets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24580">[ date ]</a>
              <a href="thread.html#24580">[ thread ]</a>
              <a href="subject.html#24580">[ subject ]</a>
              <a href="author.html#24580">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
