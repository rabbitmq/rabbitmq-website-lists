<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Measuring end-to-end message delivery time
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Measuring%20end-to-end%20message%20delivery%20time&In-Reply-To=%3C4f030e84-ff70-453d-912d-4c502eabf2b8%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024669.html">
   <LINK REL="Next"  HREF="024671.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Measuring end-to-end message delivery time</H1>
    <B>Eric Mill</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Measuring%20end-to-end%20message%20delivery%20time&In-Reply-To=%3C4f030e84-ff70-453d-912d-4c502eabf2b8%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Measuring end-to-end message delivery time">konklone at gmail.com
       </A><BR>
    <I>Sat Dec 29 00:25:56 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024669.html">[rabbitmq-discuss] Measuring end-to-end message delivery time
</A></li>
        <LI>Next message: <A HREF="024671.html">[rabbitmq-discuss] Amqp Gem and Unicorn
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24710">[ date ]</a>
              <a href="thread.html#24710">[ thread ]</a>
              <a href="subject.html#24710">[ subject ]</a>
              <a href="author.html#24710">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What I'd do is snapshot the time, down to the millisecond, on both servers, 
both before and after the message goes through the pipeline (to verify that 
they didn't drift apart or closer during the message sending event). Then 
timestamp the message and use the time delta between the two servers to 
adjust the message sent and receive timestamps to figure out the true time 
it took to send the message.

-- Eric

On Saturday, December 22, 2012 11:01:34 PM UTC-5, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dbu... at peopleanswers.com</A> 
wrote:
&gt;<i>
</I>&gt;<i> Firstly, kudos to the RabbitMQ team for an astonishingly good product. We 
</I>&gt;<i> are using it as the messaging bus backbone for our flagship application and 
</I>&gt;<i> have had literally zero problems with it. Can't say enough good things.
</I>&gt;<i>
</I>&gt;<i> I'm hoping someone can help me figure out a solution for this. When we 
</I>&gt;<i> send a message, it generally goes through a pipeline something like this:
</I>&gt;<i>
</I>&gt;<i> 1. (Sending JVM) A Java thread will push the message into a 
</I>&gt;<i> ThreadPoolExecutor queue.
</I>&gt;<i> 2. (Sending JVM) The ThreadPoolExecutor sends the message to RabbitMQ.
</I>&gt;<i> 3. RabbitMQ delivers the message to the consumer.
</I>&gt;<i> 4. (Receiving JVM) The consumer receives the message and pushes it into a 
</I>&gt;<i> ThreadPoolExecutor queue
</I>&gt;<i> 5. (Receiving JVM) The ThreadPoolExecutor handles the message
</I>&gt;<i>
</I>&gt;<i> My goal is to measure the total time spent, per message, with millisecond 
</I>&gt;<i> accuracy, from one end of this pipeline to the other. I want to be able to 
</I>&gt;<i> calculate this for every message sent through our message bus, so then I 
</I>&gt;<i> can do analysis on those times, in real-time, and draw useful conclusions.
</I>&gt;<i>
</I>&gt;<i> The trouble is that the part pre-RabbitMQ (1-2) could be in a different 
</I>&gt;<i> JVM on a different physical server than the part post-RabbitMQ (4-5). So I 
</I>&gt;<i> can measure the time for steps 1, 2, 4, and 5. But how do I measure the 
</I>&gt;<i> time it took for the message to actually travel through RabbitMQ (step 3)?
</I>&gt;<i>
</I>&gt;<i> I can't just time-stamp the message because the local time on the two 
</I>&gt;<i> physical servers cannot be guaranteed to be synchronized to the 
</I>&gt;<i> millisecond. We use NTP but it does not keep the two servers that closely 
</I>&gt;<i> synchronized.
</I>&gt;<i>
</I>&gt;<i> So my question is: does RabbitMQ offer anything I can use that will allow 
</I>&gt;<i> me to figure out how long step 4 took for each message I send through 
</I>&gt;<i> RabbitMQ, or at least approximate it closely? Or is there some other clever 
</I>&gt;<i> technoloogy I could use to accomplish the same thing?
</I>&gt;<i>
</I>&gt;<i> Thanks in advance,
</I>&gt;<i> Darrell Burgan
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121228/da1ee576/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121228/da1ee576/attachment.htm</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024669.html">[rabbitmq-discuss] Measuring end-to-end message delivery time
</A></li>
	<LI>Next message: <A HREF="024671.html">[rabbitmq-discuss] Amqp Gem and Unicorn
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24710">[ date ]</a>
              <a href="thread.html#24710">[ thread ]</a>
              <a href="subject.html#24710">[ subject ]</a>
              <a href="author.html#24710">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
