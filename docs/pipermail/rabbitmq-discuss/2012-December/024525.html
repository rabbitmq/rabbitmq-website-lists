<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Crash when purging or deleting a queue with	10k messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Crash%20when%20purging%20or%20deleting%20a%20queue%20with%0A%0910k%20messages&In-Reply-To=%3C2A8515A2-38FF-4751-8740-5721AB52E19B%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024524.html">
   <LINK REL="Next"  HREF="024531.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Crash when purging or deleting a queue with	10k messages</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Crash%20when%20purging%20or%20deleting%20a%20queue%20with%0A%0910k%20messages&In-Reply-To=%3C2A8515A2-38FF-4751-8740-5721AB52E19B%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Crash when purging or deleting a queue with	10k messages">tim at rabbitmq.com
       </A><BR>
    <I>Sat Dec 15 15:44:46 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024524.html">[rabbitmq-discuss] The rabbitmq-server stop command hangs
</A></li>
        <LI>Next message: <A HREF="024531.html">[rabbitmq-discuss] crash in a two node RabbitMQ cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24525">[ date ]</a>
              <a href="thread.html#24525">[ thread ]</a>
              <a href="subject.html#24525">[ subject ]</a>
              <a href="author.html#24525">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sidnei,

Did you try upgrading in the end? You can, of course, copy the mnesia directory to another box and test the upgrade there.

Cheers,
Tim

On 22 Nov 2012, at 16:02, Sidnei da Silva wrote:

&gt;<i> On Thu, Nov 22, 2012 at 1:52 PM, Matthias Radestock
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:
</I>&gt;&gt;<i> On 22/11/12 15:06, Sidnei da Silva wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> We're currently experiencing a crash while trying to either purge or
</I>&gt;&gt;&gt;<i> delete a persistent queue that's not in use anymore but contains about
</I>&gt;&gt;&gt;<i> 10k messages still.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thanks for reporting this and including all the logs etc. This looks like a
</I>&gt;&gt;<i> bug - the queue asks the message store to remove its messages but for some
</I>&gt;&gt;<i> reason the message store knows nothing about them.
</I>&gt;<i> 
</I>&gt;<i> Ah, very interesting.
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> I'm tempted to upgrade to 3.0.x to see if the problem goes away
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> We haven't seen this bug before. Nor have we touched the code in that area
</I>&gt;&gt;<i> since 2.8.4. So I'm afraid an upgrade is unlikely to improve matters.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Btw, are you saying that after restarting the broker, a renewed attempt at
</I>&gt;&gt;<i> purging the queue fails again? If so then it would be incredibly useful if
</I>&gt;&gt;<i> you sent us a copy of the entire rabbitmq mnesia dir (usually under
</I>&gt;&gt;<i> /var/lib/rabbitmq/mnesia/&lt;nodename&gt;) since that should allow us to reproduce
</I>&gt;&gt;<i> the problem.
</I>&gt;<i> 
</I>&gt;<i> I'm afraid that wouldn't be possible due to queued messages containing
</I>&gt;<i> private information, but if you have any debugging script to collect
</I>&gt;<i> only the information needed to diagnose the issue, I might be able to
</I>&gt;<i> get that run for you.
</I>&gt;<i> 
</I>&gt;<i> -- Sidnei
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>

















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024524.html">[rabbitmq-discuss] The rabbitmq-server stop command hangs
</A></li>
	<LI>Next message: <A HREF="024531.html">[rabbitmq-discuss] crash in a two node RabbitMQ cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24525">[ date ]</a>
              <a href="thread.html#24525">[ thread ]</a>
              <a href="subject.html#24525">[ subject ]</a>
              <a href="author.html#24525">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
