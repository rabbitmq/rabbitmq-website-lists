<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] crash in a two node RabbitMQ cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20crash%20in%20a%20two%20node%20RabbitMQ%20cluster&In-Reply-To=%3C50CEFAF6.9090104%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024531.html">
   <LINK REL="Next"  HREF="024534.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] crash in a two node RabbitMQ cluster</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20crash%20in%20a%20two%20node%20RabbitMQ%20cluster&In-Reply-To=%3C50CEFAF6.9090104%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] crash in a two node RabbitMQ cluster">simon at rabbitmq.com
       </A><BR>
    <I>Mon Dec 17 10:59:02 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024531.html">[rabbitmq-discuss] crash in a two node RabbitMQ cluster
</A></li>
        <LI>Next message: <A HREF="024534.html">[rabbitmq-discuss] Backup message and state at a point of time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24543">[ date ]</a>
              <a href="thread.html#24543">[ thread ]</a>
              <a href="subject.html#24543">[ subject ]</a>
              <a href="author.html#24543">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/12/2012 8:22PM, Aravindh S wrote:
&gt;<i> Hi
</I>
Hi.

&gt;<i> we are running RabbitMQ v 2.8.4 in a two node cluster configuration.
</I>&gt;<i>
</I>&gt;<i> we had an unplanned power outage and both the servers went down. when we
</I>&gt;<i> tried to restart the rabbitmq servers, only rabbit2 node starts up and
</I>&gt;<i> the node rabbit1 crashes on start.
</I>&gt;<i> we are running several mirrored queues between these nodes.one such
</I>&gt;<i> queue &quot;Aiken&quot; contained more than 65K messages before the outage.Now
</I>&gt;<i> rabbit1 wont start and rabbit2 starts fine but shows that there are only
</I>&gt;<i> 109 old messages in the &quot;Aiken&quot; Queue.We are afraid if we have lost the
</I>&gt;<i> messages from the rabbit1 crash.
</I>
At the risk of asking something obvious: were all the messages published 
to &quot;Aiken&quot; published with delivery_mode=2 (persistent)? And 
non-persistent messages will be removed from the queue after restart.

&gt;<i> Rabbit1 node crashes on startup on both conditions where rabbit2 was
</I>&gt;<i> down and also when rabbit2 was up.
</I>&gt;<i>
</I>&gt;<i> we could see the following message in the startup log,
</I>&gt;<i>
</I>&gt;<i> BOOT FAILED
</I>&gt;<i> ===========
</I>&gt;<i>
</I>&gt;<i> Error description:
</I>&gt;<i>
</I>&gt;<i>   {badmatch,{error,{&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit1</A>/queues/1NGZF3JZJR0SU2C0VE2S25JRP/clean.dot&quot;,
</I>&gt;<i>                       eacces}}}
</I>
&quot;eacces&quot; is the key here - for some reason the server is not being 
permitted to read the file by the operating system. Assuming you have 
installed via debs / RPMs, all files under /var/lib/rabbitmq/mnesia 
should be owned by the &quot;rabbitmq&quot; user - are they?

&gt;<i> logs are available here:
</I>
Looking at the logs it looks like you had several attempts to start 
rabbit1 before that error message showed up, but they were stymied by a 
bug in the management plugin startup code that had been fixed since 2.8.4...

&gt;<i> Can anyone help me with ideas to recover rabbit1 ??
</I>&gt;<i> Is there a way to tweak the startup of Rabbit1 so that it would start as
</I>&gt;<i> an independent node ?
</I>
...however, even if you start rabbit1 as part of the cluster it will 
start its mirrored queues from scratch (see 
<A HREF="http://www.rabbitmq.com/ha.html#unsynchronised-slaves">http://www.rabbitmq.com/ha.html#unsynchronised-slaves</A>).

It's not easy to start such a node independently in 2.x I'm afraid (this 
was improved in 3.0). I wrote some rather ad-hoc instructions here: 
<A HREF="http://rabbitmq.1065348.n5.nabble.com/Repairing-a-a-crashed-cluster-td22466.html">http://rabbitmq.1065348.n5.nabble.com/Repairing-a-a-crashed-cluster-td22466.html</A>

But I'm afraid that if the messages were originally published in 
non-persistent mode you won't get them back - they would never even have 
made it to disc.

Cheers, Simon
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024531.html">[rabbitmq-discuss] crash in a two node RabbitMQ cluster
</A></li>
	<LI>Next message: <A HREF="024534.html">[rabbitmq-discuss] Backup message and state at a point of time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24543">[ date ]</a>
              <a href="thread.html#24543">[ thread ]</a>
              <a href="subject.html#24543">[ subject ]</a>
              <a href="author.html#24543">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
