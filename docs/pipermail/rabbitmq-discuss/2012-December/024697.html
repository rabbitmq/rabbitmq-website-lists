<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] HA Queue declaration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20Queue%20declaration&In-Reply-To=%3CC227FF6D2C5F79468FCA15037EEA65CF42FFB2%40BL2PRD0810MB385.namprd08.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024706.html">
   <LINK REL="Next"  HREF="024698.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] HA Queue declaration</H1>
    <B>Austin Buckner</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20Queue%20declaration&In-Reply-To=%3CC227FF6D2C5F79468FCA15037EEA65CF42FFB2%40BL2PRD0810MB385.namprd08.prod.outlook.com%3E"
       TITLE="[rabbitmq-discuss] HA Queue declaration">abuckner at homeaway.com
       </A><BR>
    <I>Fri Dec 28 14:29:58 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024706.html">[rabbitmq-discuss] Additional fields returned via /api/overview?
</A></li>
        <LI>Next message: <A HREF="024698.html">[rabbitmq-discuss] HA Queue declaration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24697">[ date ]</a>
              <a href="thread.html#24697">[ thread ]</a>
              <a href="subject.html#24697">[ subject ]</a>
              <a href="author.html#24697">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm currently running 2.8.7 in a cluster of 2 disk nodes and 1 ram node with a load balancer.
We have a dev and a test env pointing at the same rabbit cluster using '/dev' and '/' for vhosts.
In test we have long lived queues (per app) to start simulating our prod env and in dev we spin up auto delete queues(differing queue names based on the appVimId) to avoid the clutter of multiple people testing.
I'm trying to push HA queues out and am running into a start up error.
For /dev it works great, the app spins up the HA queues, finishes the tests and then they auto delete themselves.
When I try pushing it out to our test env I get this error from the rabbit logs:

connection &lt;0.15043.4&gt;, channel 1 - error:
{amqp_error,precondition_failed,
            &quot;inequivalent arg 'x-ha-policy'for queue 'queue.name' in vhost '/': received the value 'all' of type 'longstr' but current is none&quot;,
            'queue.declare'}


I've tried pushing it out with the non HA queues still up, and also with deleting them before trying to spin up the new ones and no dice still can't create these queues.
I don't know if its worth noting that the queue names are still the same all I'm trying to do is simply declare them with the x-ha-policy = all


Map&lt;String,Object&gt; params = new HashMap&lt;String, Object&gt;();

params.put(&quot;x-ha-policy&quot;, &quot;all&quot;);

params.put(&quot;x-expires&quot;, TimeUnit.HOURS.toMillis(24));


Queue queue = new Queue(queueName, true, false, isAutoDelete, params);


Has anyone else run into this problem? I realize I can upgrade to 3.0.1 and implement HA queues at the broker level but at this point I want to try and get this to work without having to go through and upgrade all of our envs.


Let me know if you need any more log info or code snippets or elaboration.

Thanks

-Quinn

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121228/4b7401d4/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121228/4b7401d4/attachment.htm</A>&gt;
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024706.html">[rabbitmq-discuss] Additional fields returned via /api/overview?
</A></li>
	<LI>Next message: <A HREF="024698.html">[rabbitmq-discuss] HA Queue declaration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24697">[ date ]</a>
              <a href="thread.html#24697">[ thread ]</a>
              <a href="subject.html#24697">[ subject ]</a>
              <a href="author.html#24697">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
