<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Automating a RabbitMQ 3.0 cluster on EC2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Automating%20a%20RabbitMQ%203.0%20cluster%20on%20EC2&In-Reply-To=%3C2E46CFA181E247DDAC9AB06CFBBC9720%40paperplanes.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024721.html">
   <LINK REL="Next"  HREF="024723.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Automating a RabbitMQ 3.0 cluster on EC2</H1>
    <B>Mathias Meyer</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Automating%20a%20RabbitMQ%203.0%20cluster%20on%20EC2&In-Reply-To=%3C2E46CFA181E247DDAC9AB06CFBBC9720%40paperplanes.de%3E"
       TITLE="[rabbitmq-discuss] Automating a RabbitMQ 3.0 cluster on EC2">meyer at paperplanes.de
       </A><BR>
    <I>Sat Dec 29 14:12:06 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024721.html">[rabbitmq-discuss] Automating a RabbitMQ 3.0 cluster on EC2
</A></li>
        <LI>Next message: <A HREF="024723.html">[rabbitmq-discuss] Automating a RabbitMQ 3.0 cluster on EC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24722">[ date ]</a>
              <a href="thread.html#24722">[ thread ]</a>
              <a href="subject.html#24722">[ subject ]</a>
              <a href="author.html#24722">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Saturday, 29. December 2012 at 14:51, Francesco Mazzoli wrote:
&gt;<i> I&#8217;m not sure what you mean here. What does &#8220;RabbitMQ package&#8221; refers to? Can
</I>&gt;<i> you be more clear on why &#8220;they converge into the same issue&#8221;?
</I>&gt;<i>  
</I>The package I mention refers to the package available on the RabbitMQ website. In this case I'm installing a Ubuntu package, which generates all its configuration files when installed and starts the service too.

The problems outlined converge into the same issue because of this last bit. It might seem like a useful feature of the package, but given that a node that should enter the cluster needs to be fresh and untouched, this is practically impossible to achieve with the cluster_nodes section in the configuration, at least when trying to avoid hacks that generate the configuration beforehand, where users and directories don't yet exist.

After the package installation, the node that was just freshly installed needs to be reset for these things to fully work.
&gt;<i>  
</I>&gt;<i> Well, here to change clustering behavior you would probably have to force
</I>&gt;<i> things a bit, either with &#8220;dangerous&#8221; commands or by `eval'ing Erlang
</I>&gt;<i> expressions - so you&#8217;d be delving into clustering internals that, as
</I>&gt;<i> implementation details, are not documented.
</I>&gt;<i>  
</I>&gt;<i> Note that you can also deploy some gentler measures like &#8220;check that the node
</I>&gt;<i> has clustered, try again in 5 minutes if it didn&#8217;t&#8221;, but those would be ad-hoc
</I>&gt;<i> measures that we can&#8217;t generalize as default behaviour.
</I>&gt;<i>  
</I>Sure, but I'm still interested in these, as odd as they may seem. My intent is to have an automated cluster setup, and for that to fully work, I need to know the oddities and ways to work around them. A lot of the documentation is aimed at setting up a cluster manually, which to me is a practice to be avoided in production.
&gt;<i>  
</I>&gt;<i> Netsplits are tolerated to a certain extent, but currently we don&#8217;t precisely
</I>&gt;<i> specify the semantics of the recovery mechanisms. What&#8217;s surely the case is
</I>&gt;<i> that to use `join_cluster' both nodes have to be online - this is not that much
</I>&gt;<i> about netsplits but about `join_cluster' being an operation that requires
</I>&gt;<i> agreement from 2 parties.
</I>&gt;<i>  
</I>That's understandable behaviour, though I'd suggest considering some sort of retry in either scenario. Which might reduce the issues with the overall setup I've described here so far significantly.  
&gt;<i>  
</I>&gt;<i> I&#8217;m still not sure what your problem is exactly. If the above makes sense,
</I>&gt;<i> `join_cluster' should serve your needs. For what concerns the hostname
</I>&gt;<i> problems, I&#8217;m waiting for more details.
</I>&gt;<i>  
</I>join_cluster does fit my needs, but in an automated environment, e.g. with Chef, that command would be triggered every 30 minutes. Would you consider that a good practice to do?

Hence me asking about experiences of automating a cluster setup in production. How people work to make it work, how people make sure a node joins the cluster, how to make sure resources aren't overused where not necessary, e.g. by triggering commands that don't need to be triggered, et.c

Cheers, Mathias
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121229/a493413e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121229/a493413e/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024721.html">[rabbitmq-discuss] Automating a RabbitMQ 3.0 cluster on EC2
</A></li>
	<LI>Next message: <A HREF="024723.html">[rabbitmq-discuss] Automating a RabbitMQ 3.0 cluster on EC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24722">[ date ]</a>
              <a href="thread.html#24722">[ thread ]</a>
              <a href="subject.html#24722">[ subject ]</a>
              <a href="author.html#24722">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
