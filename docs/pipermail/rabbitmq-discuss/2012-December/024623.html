<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RMQ performance between high MHz/low core vs	lower MHz/high core servers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RMQ%20performance%20between%20high%20MHz/low%20core%20vs%0A%09lower%20MHz/high%20core%20servers&In-Reply-To=%3C91DCE58C-EB72-4556-AE70-4AD8B0F7AFBE%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024622.html">
   <LINK REL="Next"  HREF="024629.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RMQ performance between high MHz/low core vs	lower MHz/high core servers</H1>
    <B>Chris Schmidt</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RMQ%20performance%20between%20high%20MHz/low%20core%20vs%0A%09lower%20MHz/high%20core%20servers&In-Reply-To=%3C91DCE58C-EB72-4556-AE70-4AD8B0F7AFBE%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] RMQ performance between high MHz/low core vs	lower MHz/high core servers">cischmidt77 at gmail.com
       </A><BR>
    <I>Thu Dec 20 17:27:39 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024622.html">[rabbitmq-discuss] RMQ performance between high MHz/low core vs lower MHz/high core servers
</A></li>
        <LI>Next message: <A HREF="024629.html">[rabbitmq-discuss] RMQ performance between high MHz/low core vs lower MHz/high core servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24623">[ date ]</a>
              <a href="thread.html#24623">[ thread ]</a>
              <a href="subject.html#24623">[ subject ]</a>
              <a href="author.html#24623">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

On Dec 20, 2012, at 9:07 AM, Matthias Radestock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:

&gt;<i> Chris,
</I>&gt;<i> 
</I>&gt;<i> On 20/12/12 16:18, Chris Schmidt wrote:
</I>&gt;&gt;<i> There are 22 queues
</I>&gt;<i> &gt; [...]
</I>&gt;&gt;<i> A vendor let us borrow the 40-core machine to see if it would work
</I>&gt;&gt;<i> better.  [...] Each core is only 11-15% utilized.
</I>&gt;<i> 
</I>&gt;<i> You may not be able to saturate 40 cores with 22 queues. Depends on how many producers and consumers there are.
</I>&gt;<i> 
</I>&gt;<i> The other constraint could be scheduling and general Erlang multi-core performance. This has improved *considerably* over the last few years. So please make sure you are running the latest Erlang/OTP release - R15B03.
</I>&gt;<i> 
</I>&gt;<i> You may also want to tweak the various smp/scheduling related settings in Erlang. In particular I have seen massive performance differences when adjusting the +swt setting.
</I>&gt;<i> 
</I>
RHEL 6.2 doesn't seem to have the latest version of Erlang available in the repositories. Does anyone have experience with manually building Erlang on that platform with success? We're on R14B04 right now. There are a huge number of erlang related rpms that get installed I'm not certain if a single Erlang version for CentOS would work properly or not.

I had +K true -smp enable +native +sbtps plus the other RMQ defaults set on the 40 core machine while testing. I also removed everything to use plain vanilla RMQ settings to see how that impacted performance.

I also had 15 consumers running against the initial queue that was having problems. I also tried sending the data into 2 - 40 exchanges (and updated the queue to read from those exchanges) in order to see if I could spread the load that way. Does a single process manage each queue? If so I can see that being a potential bottleneck due to the core's speed difference.

Is there an erlang or rabbitmqctl command that I can run against the RMQ server to determine if the queues themselves are the bottleneck?

&gt;&gt;<i> I've tried HiPE in the past, but the system % jumped considerably
</I>&gt;&gt;<i> and we actually got poorer performance and instability.
</I>&gt;<i> 
</I>&gt;<i> That's odd. Again, please make sure you are runninng the latest Erlang; HiPE is another area that has improved considerably recently.
</I>
I'd definitely like to try HiPE again since we're CPU bound on the existing production server. 
&gt;<i> 
</I>&gt;&gt;<i> I know the cores are slower in overall speed, but I would have bet
</I>&gt;&gt;<i> money that in  aggregate this machine would outperform our other one.
</I>&gt;<i> 
</I>&gt;<i> Depends on the workload. e.g. if queues are the bottleneck then having many more (slow) cores than queues won't help.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Matthias.
</I>
I appreciate the pointers, thanks Matthias!

</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024622.html">[rabbitmq-discuss] RMQ performance between high MHz/low core vs lower MHz/high core servers
</A></li>
	<LI>Next message: <A HREF="024629.html">[rabbitmq-discuss] RMQ performance between high MHz/low core vs lower MHz/high core servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24623">[ date ]</a>
              <a href="thread.html#24623">[ thread ]</a>
              <a href="subject.html#24623">[ subject ]</a>
              <a href="author.html#24623">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
