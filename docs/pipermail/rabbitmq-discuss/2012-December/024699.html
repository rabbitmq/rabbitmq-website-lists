<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] HA Queue declaration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20Queue%20declaration&In-Reply-To=%3CC227FF6D2C5F79468FCA15037EEA65CF4300D2%40BL2PRD0810MB385.namprd08.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024698.html">
   <LINK REL="Next"  HREF="024700.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] HA Queue declaration</H1>
    <B>Austin Buckner</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20Queue%20declaration&In-Reply-To=%3CC227FF6D2C5F79468FCA15037EEA65CF4300D2%40BL2PRD0810MB385.namprd08.prod.outlook.com%3E"
       TITLE="[rabbitmq-discuss] HA Queue declaration">abuckner at homeaway.com
       </A><BR>
    <I>Fri Dec 28 16:13:29 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024698.html">[rabbitmq-discuss] HA Queue declaration
</A></li>
        <LI>Next message: <A HREF="024700.html">[rabbitmq-discuss] question regarding topic routes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24699">[ date ]</a>
              <a href="thread.html#24699">[ thread ]</a>
              <a href="subject.html#24699">[ subject ]</a>
              <a href="author.html#24699">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It seems I should read the errors more closely. In each env we have 2
queues per app. 
I deleted the 01s for all except one in which case I deleted the 02 and
thus the name collision on startup.
Thanks for making me read what I type all is well now, I had the right
notion but not a comprehensive execution.
-Quinn

On 12/28/12 8:35 AM, &quot;Tim Watson&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>&gt; wrote:

&gt;<i>Hi
</I>&gt;<i>
</I>&gt;<i>On 28 Dec 2012, at 14:29, Austin Buckner wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> When I try pushing it out to our test env I get this error from the
</I>&gt;&gt;<i>rabbit logs:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> connection &lt;0.15043.4&gt;, channel 1 - error:
</I>&gt;&gt;<i> {amqp_error,precondition_failed,
</I>&gt;&gt;<i>             &quot;inequivalent arg 'x-ha-policy'for queue 'queue.name' in
</I>&gt;&gt;<i>vhost '/': received the value 'all' of type 'longstr' but current is
</I>&gt;&gt;<i>none&quot;,
</I>&gt;&gt;<i>             'queue.declare'}
</I>&gt;&gt;<i> 
</I>&gt;<i>
</I>&gt;<i>This error is quite explicit - there is already a queue with the same
</I>&gt;<i>name in that vhost, for which the x-ha-policy is set to 'none' -
</I>&gt;<i>declaring it with a different policy is an error.
</I>&gt;<i>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've tried pushing it out with the non HA queues still up, and also
</I>&gt;&gt;<i>with deleting them before trying to spin up the new ones and no dice
</I>&gt;&gt;<i>still can't create these queues.
</I>&gt;<i>
</I>&gt;<i>If you've completely deleted the queues first, and redeclared them for
</I>&gt;<i>the first time with x-ha-policy=all then it should work. If that's not
</I>&gt;<i>the case, please post a transcript so we can reproduce the problem.
</I>&gt;<i>
</I>&gt;&gt;<i> I don't know if its worth noting that the queue names are still the
</I>&gt;&gt;<i>same all I'm trying to do is simply declare them with the x-ha-policy =
</I>&gt;&gt;<i>all
</I>&gt;&gt;<i> 
</I>&gt;<i>
</I>&gt;<i>If they already exist with a different x-ha-policy then that won't work.
</I>&gt;<i>Otherwise, you should be fine!
</I>&gt;<i>
</I>&gt;&gt;<i> Map&lt;String,Object&gt; params = new HashMap&lt;String, Object&gt;();
</I>&gt;&gt;<i> params.put(&quot;x-ha-policy&quot;, &quot;all&quot;);
</I>&gt;&gt;<i> params.put(&quot;x-expires&quot;, TimeUnit.HOURS.toMillis(24));
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Has anyone else run into this problem? I realize I can upgrade to 3.0.1
</I>&gt;&gt;<i>and implement HA queues at the broker level but at this point I want to
</I>&gt;&gt;<i>try and get this to work without having to go through and upgrade all of
</I>&gt;&gt;<i>our envs.
</I>&gt;&gt;<i> 
</I>&gt;<i>
</I>&gt;<i>Whilst we always suggest upgrading where possible, this *should* work on
</I>&gt;<i>2.x series brokers as long as the declaration doesn't clash with an
</I>&gt;<i>existing object (having different parameters).
</I>&gt;<i>
</I>&gt;<i>Cheers
</I>&gt;<i>Tim
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>rabbitmq-discuss mailing list
</I>&gt;<i><A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i><A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>

</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024698.html">[rabbitmq-discuss] HA Queue declaration
</A></li>
	<LI>Next message: <A HREF="024700.html">[rabbitmq-discuss] question regarding topic routes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24699">[ date ]</a>
              <a href="thread.html#24699">[ thread ]</a>
              <a href="subject.html#24699">[ subject ]</a>
              <a href="author.html#24699">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
