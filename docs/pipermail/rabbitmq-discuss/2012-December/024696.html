<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Creating an auth plugin (Kerberos)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Creating%20an%20auth%20plugin%20%28Kerberos%29&In-Reply-To=%3C05223E0E-9BBE-4842-AC20-DBEB330791BD%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024636.html">
   <LINK REL="Next"  HREF="024272.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Creating an auth plugin (Kerberos)</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Creating%20an%20auth%20plugin%20%28Kerberos%29&In-Reply-To=%3C05223E0E-9BBE-4842-AC20-DBEB330791BD%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Creating an auth plugin (Kerberos)">tim at rabbitmq.com
       </A><BR>
    <I>Fri Dec 28 14:10:25 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="024636.html">[rabbitmq-discuss] Creating an auth plugin (Kerberos)
</A></li>
        <LI>Next message: <A HREF="024272.html">[rabbitmq-discuss] Cluster issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24696">[ date ]</a>
              <a href="thread.html#24696">[ thread ]</a>
              <a href="subject.html#24696">[ subject ]</a>
              <a href="author.html#24696">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Simon - this works for me! Ha ha.

Here's what I did. Firstly, I tweaked the package.mk so that the plugin got included in the release bundle, plus I had to add some noise to the compiler flags in order to build the native library on 64bit Mac OS (Lion). Then I made sure that the hard coded path which the on_load function uses to locate the image was exactly where $RABBITMQ_PLUGINS_EXPAND_DIR points to, plus the app+vsn/priv/.... etc.

After this, the plugin loads correctly, the NIF is instantiated properly and I can interact with the kinit module as expected:

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">t4 at iske</A>:rabbitmq-server $ RABBITMQ_ALLOW_INPUT=1 ~/.bash/utilities/start-rabbit-noconf rabbit 5672 15672
Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:4:4] [async-threads:30] [hipe] [kernel-poll:true] [lock-counting]

Eshell V5.9.1  (abort with ^G)
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iske</A>)1&gt; 
+---+   +---+
|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   +---+   +-------+
</I>|<i>                   |
</I>|<i> RabbitMQ  +---+   |
</I>|<i>           |   |   |
</I>|<i> v%%VSN%%  +---+   |
</I>|<i>                   |
</I>+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>

node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iske</A>
app descriptor : /Users/t4/work/vmware/rabbitmq-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /Users/t4
config file(s) : /tmp/etc/rabbit.config
cookie hash    : s5K3NR4kyNZMeKMtaQLkvQ==
log            : /tmp/rabbit.log
sasl log       : /tmp/rabbit-sasl.log
database dir   : /tmp/rabbitmq-rabbit-mnesia
erlang version : 5.9.1

[SNIP]

broker running

-- plugins running
amqp_client                                                             0.0.0
rabbitmq_auth_backend_kerberos                                          0.0.0
rabbitmq_shovel                                                         0.0.0

(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iske</A>)1&gt; 
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iske</A>)1&gt; 
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iske</A>)1&gt; kinit:module_info().
[{exports,[{init,0},
           {kinit,2},
           {module_info,0},
           {module_info,1}]},
 {imports,[]},
 {attributes,[{vsn,[179147207627583207794822872273379546429]}]},
 {compile,[{options,[{outdir,&quot;/Users/t4/work/vmware/rabbitmq-umbrella/rabbitmq-public-umbrella/rabbitmq-auth-backend-kerberos/ebin&quot;},
                     {i,&quot;/Users/t4/work/vmware/rabbitmq-umbrella/rabbitmq-public-umbrella/rabbitmq-auth-backend-kerberos/include&quot;},
                     debug_info]},
           {version,&quot;4.8.1&quot;},
           {time,{2012,12,28,14,4,2}},
           {source,&quot;/Users/t4/work/vmware/rabbitmq-umbrella/rabbitmq-public-umbrella/rabbitmq-auth-backend-kerberos/src/kinit.erl&quot;}]}]
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iske</A>)2&gt; kinit:kinit(&lt;&lt;&quot;foo&quot;&gt;&gt;, &lt;&lt;&quot;bar&quot;&gt;&gt;).
true
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iske</A>)3&gt; 
BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
       (v)ersion (k)ill (D)b-tables (d)istribution
a

I suspect your problem is that you're not calculating the location of the directory into which the plugins are exploded properly. Take a look at rabbit_plugins:setup/0 to see how all these things are calculated, then try and mimic this behaviour to locate your target directory dynamically (and correctly!) at runtime.

Cheers,
Tim

On 21 Dec 2012, at 10:21, Tim Watson wrote:

&gt;<i> On 21 Dec 2012, at 09:40, Simon Lundstr&#246;m wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> No worries, I'm on holiday and paternity leave until end of january.
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Great, because I'm not likely to spend much time on it for next couple of week either! :)
</I>&gt;<i> 
</I>&gt;&gt;<i> Happy holidays!
</I>&gt;<i> 
</I>&gt;<i> You too!
</I>&gt;<i> 
</I>&gt;&gt;<i> - Simon
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On Fri, 2012-12-14 at 19:28:24 +0000, Tim Watson wrote:
</I>&gt;&gt;&gt;<i> Sorry I haven't managed to look at this yet. I will take a look at some point soon and see if I can debug the problem though.
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024636.html">[rabbitmq-discuss] Creating an auth plugin (Kerberos)
</A></li>
	<LI>Next message: <A HREF="024272.html">[rabbitmq-discuss] Cluster issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24696">[ date ]</a>
              <a href="thread.html#24696">[ thread ]</a>
              <a href="subject.html#24696">[ subject ]</a>
              <a href="author.html#24696">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
