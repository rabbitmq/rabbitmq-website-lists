<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Initial cluster set-up questoin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Initial%20cluster%20set-up%20questoin&In-Reply-To=%3C4EE8769D.7010307%40tele2.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016852.html">
   <LINK REL="Next"  HREF="016854.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Initial cluster set-up questoin</H1>
    <B>Simon Loewenthal/NL/Tele2</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Initial%20cluster%20set-up%20questoin&In-Reply-To=%3C4EE8769D.7010307%40tele2.com%3E"
       TITLE="[rabbitmq-discuss] Initial cluster set-up questoin">simon.loewenthal at tele2.com
       </A><BR>
    <I>Wed Dec 14 10:12:45 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016852.html">[rabbitmq-discuss] Initial cluster set-up questoin
</A></li>
        <LI>Next message: <A HREF="016854.html">[rabbitmq-discuss] Initial cluster set-up questoin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16853">[ date ]</a>
              <a href="thread.html#16853">[ thread ]</a>
              <a href="subject.html#16853">[ subject ]</a>
              <a href="author.html#16853">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/12/11 09:47, Simon Loewenthal/NL/Tele2 wrote:
&gt;<i> 	
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> 	I have installed Rabbit &amp; Erlang and followed these instruction
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/clustering.html">http://www.rabbitmq.com/clustering.html</A> to set-up a two node cluster.
</I>&gt;<i> Both nodes are be started, but when node 2 attempts to join node 1 it
</I>&gt;<i> fails.
</I>&gt;<i>
</I>&gt;<i> There are no firewalls between each other. Both are on the same vlan and
</I>&gt;<i> a /22 subnet.
</I>&gt;<i>
</I>&gt;<i> O/S: RHEL 6.2  Fully patched from RHN.
</I>&gt;<i>
</I>&gt;<i> Node 1:
</I>&gt;<i>
</I>&gt;<i> # rabbitmq-server --detached
</I>&gt;<i> Activating RabbitMQ plugins ...
</I>&gt;<i> 6 plugins activated:
</I>&gt;<i> * amqp_client-2.7.0
</I>&gt;<i> * mochiweb-1.3-rmq2.7.0-git
</I>&gt;<i> * rabbitmq_management-2.7.0
</I>&gt;<i> * rabbitmq_management_agent-2.7.0
</I>&gt;<i> * rabbitmq_mochiweb-2.7.0
</I>&gt;<i> * webmachine-1.7.0-rmq2.7.0-hg
</I>&gt;<i>
</I>&gt;<i> ** Found 0 name clashes in code paths
</I>&gt;<i>
</I>&gt;<i> +---+   +---+
</I>&gt;<i> |   |   |   |
</I>&gt;<i> |   |   |   |
</I>&gt;<i> |   |   |   |
</I>&gt;<i> |   +---+   +-------+
</I>&gt;<i> |                   |
</I>&gt;<i> | RabbitMQ  +---+   |
</I>&gt;<i> |           |   |   |
</I>&gt;<i> |   v2.7.0  +---+   |
</I>&gt;<i> |                   |
</I>&gt;<i> +-------------------+
</I>&gt;<i> AMQP 0-9-1 / 0-9 / 0-8
</I>&gt;<i> Copyright (C) 2007-2011 VMware, Inc.
</I>&gt;<i> Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>
</I>&gt;<i>
</I>&gt;<i> node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>
</I>&gt;<i> app descriptor :
</I>&gt;<i> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.0/sbin/../ebin/rabbit.app
</I>&gt;<i> home dir       : /var/lib/rabbitmq
</I>&gt;<i> config file(s) : (none)
</I>&gt;<i> cookie hash    : Fm+somLGFoQYy1H+2FUteQ==
</I>&gt;<i> log            : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007.log</A>
</I>&gt;<i> sasl log       : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007-sasl.log</A>
</I>&gt;<i> database dir   : /var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>
</I>&gt;<i> erlang version : 5.8.5
</I>&gt;<i>
</I>&gt;<i> -- rabbit boot start
</I>&gt;<i> starting file handle cache server
</I>&gt;<i> ...done
</I>&gt;<i> starting worker pool
</I>&gt;<i> ...done
</I>&gt;<i> starting database
</I>&gt;<i> ...done
</I>&gt;<i> starting codec correctness check
</I>&gt;<i> ...done
</I>&gt;<i> -- external infrastructure ready
</I>&gt;<i> starting statistics event manager
</I>&gt;<i> ...done
</I>&gt;<i> starting logging server
</I>&gt;<i> ...done
</I>&gt;<i> starting plugin registry
</I>&gt;<i> ...done
</I>&gt;<i> starting auth mechanism amqplain
</I>&gt;<i> ...done
</I>&gt;<i> starting auth mechanism cr-demo
</I>&gt;<i> ...done
</I>&gt;<i> starting auth mechanism plain
</I>&gt;<i> ...done
</I>&gt;<i> starting exchange type direct
</I>&gt;<i> ...done
</I>&gt;<i> starting exchange type fanout
</I>&gt;<i> ...done
</I>&gt;<i> starting exchange type headers
</I>&gt;<i> ...done
</I>&gt;<i> starting exchange type topic
</I>&gt;<i> ...done
</I>&gt;<i> -- kernel ready
</I>&gt;<i> starting node monitor
</I>&gt;<i> ...done
</I>&gt;<i> starting cluster delegate
</I>&gt;<i> ...done
</I>&gt;<i> starting guid generator
</I>&gt;<i> ...done
</I>&gt;<i> starting alarm handler
</I>&gt;<i> ...done
</I>&gt;<i> starting memory monitor
</I>&gt;<i> ...done
</I>&gt;<i> -- core initialized
</I>&gt;<i> starting empty DB check
</I>&gt;<i> ...done
</I>&gt;<i> starting management agent
</I>&gt;<i> ...done
</I>&gt;<i> starting exchange, queue and binding recovery
</I>&gt;<i> ...done
</I>&gt;<i> starting mirror queue slave sup
</I>&gt;<i> ...done
</I>&gt;<i> starting adding mirrors to queues
</I>&gt;<i> ...done
</I>&gt;<i> -- message delivery logic ready
</I>&gt;<i> starting error log relay
</I>&gt;<i> ...done
</I>&gt;<i> starting networking
</I>&gt;<i> ...done
</I>&gt;<i> starting notify cluster nodes
</I>&gt;<i> ...done
</I>&gt;<i> starting direct_client
</I>&gt;<i> ...done
</I>&gt;<i>
</I>&gt;<i> broker running
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # rabbitmqctl cluster_status
</I>&gt;<i> Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>' ...
</I>&gt;<i> [{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>']}]},{running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>']}]
</I>&gt;<i> ...done.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Node 2:
</I>&gt;<i> # rabbitmq-server --detached
</I>&gt;<i> Activating RabbitMQ plugins ...
</I>&gt;<i> 6 plugins activated:
</I>&gt;<i> * amqp_client-2.7.0
</I>&gt;<i> * mochiweb-1.3-rmq2.7.0-git
</I>&gt;<i> * rabbitmq_management-2.7.0
</I>&gt;<i> * rabbitmq_management_agent-2.7.0
</I>&gt;<i> * rabbitmq_mochiweb-2.7.0
</I>&gt;<i> * webmachine-1.7.0-rmq2.7.0-hg
</I>&gt;<i>
</I>&gt;<i> ** Found 0 name clashes in code paths
</I>&gt;<i> [SNIP]
</I>&gt;<i> node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008</A>
</I>&gt;<i> app descriptor :
</I>&gt;<i> /usr/lib/rabbitmq/lib/rabbitmq_server-2.7.0/sbin/../ebin/rabbit.app
</I>&gt;<i> home dir       : /var/lib/rabbitmq
</I>&gt;<i> config file(s) : (none)
</I>&gt;<i> cookie hash    : VOYILJRa2vmMlRly95DYQw==
</I>&gt;<i> log            : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008.log</A>
</I>&gt;<i> sasl log       : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008-sasl.log</A>
</I>&gt;<i> database dir   : /var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008</A>
</I>&gt;<i> erlang version : 5.8.5
</I>&gt;<i> [SNIP]
</I>&gt;<i> broker running
</I>&gt;<i> Erlang has closed
</I>&gt;<i>
</I>&gt;<i> # rabbitmqctl stop_app
</I>&gt;<i> Stopping node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008</A>' ...
</I>&gt;<i> ...done.
</I>&gt;<i> [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at iuu-app008</A> ~]# rabbitmqctl reset
</I>&gt;<i> Resetting node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008</A>' ...
</I>&gt;<i> ...done.
</I>&gt;<i>
</I>&gt;<i> # rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>
</I>&gt;<i> Clustering node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008</A>' with ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>'] ...
</I>&gt;<i> Error:
</I>&gt;<i> {no_running_cluster_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>'],['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>']}
</I>&gt;<i>
</I>&gt;<i> I have tried the command above with the FQDN and had the same error
</I>&gt;<i> returned.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Any ideas where I could look?
</I>&gt;<i>
</I>&gt;<i> Simon.
</I>&gt;<i>
</I>Hi,

    Problem solved by copying the Erlang cookie from Node 1 onto Node 2.
Successfully joined two nodes in a disc cluster.


I createdthe  /etc/rabbitmq/rabbitmq-env.conf with this content:

[{rabbit, [{cluster_nodes, ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008</A>']}]}].

#  rabbitmqctl cluster_status
/etc/rabbitmq/rabbitmq-env.conf: line 1: [{rabbit,: command not found
Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008</A>' ...
[{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>']}]},
 {running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app007</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at iuu-app008</A>']}]
...done.

The syntax of the file looks fine to us, and also according to the
documentation. :~(

1) Is the syntax correct?
2) Should the rabbitmq-env.conf be placed on both nodes?

Regards, S.

-- 
Simon Loewenthal/Tele2
GSM: +31 6 2000 5427

******** IMPORTANT NOTICE ********
This e-mail (including any attachments) may contain information 
that is confidential or otherwise protected from disclosure and
it is intended only for the addressees. If you are not the intended
recipient, please kindly refrain from copying or distribution.
Other use of information contained in this e-mail (and its attachments)
is frowned upon. If you have received this e-mail in error, kindly
notify us immediately by telephone or e-mail and, if possible, kindly
delete the message (including any attachments) from your system. Of
course, this is not legal advice, nor is it a contract. If it were a
contract, it would have an exchange of value and affirmative agreement
by both parties. If it were legal advice, it should be written by a
lawyer and would have a bill attached.

It ought to be obvious my views in this Email might not represent my
employer's views, &amp; vice-verse. Please note that e-mail messages may
contain computer viruses or other defects. I presume that you understand
the concept of a computer virus, and took reasonable precautions.

</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016852.html">[rabbitmq-discuss] Initial cluster set-up questoin
</A></li>
	<LI>Next message: <A HREF="016854.html">[rabbitmq-discuss] Initial cluster set-up questoin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16853">[ date ]</a>
              <a href="thread.html#16853">[ thread ]</a>
              <a href="subject.html#16853">[ subject ]</a>
              <a href="author.html#16853">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
