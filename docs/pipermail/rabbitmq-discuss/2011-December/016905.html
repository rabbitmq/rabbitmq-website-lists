<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] dotnet client background thread
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20dotnet%20client%20background%20thread&In-Reply-To=%3CCAM8fPiQmTTXfLxriq5NUhF93RBkh3o5H3K-p4FRLQV74zbQ7og%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016903.html">
   <LINK REL="Next"  HREF="016906.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] dotnet client background thread</H1>
    <B>Tony Garnock-Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20dotnet%20client%20background%20thread&In-Reply-To=%3CCAM8fPiQmTTXfLxriq5NUhF93RBkh3o5H3K-p4FRLQV74zbQ7og%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] dotnet client background thread">tonygarnockjones+rabbitmq at gmail.com
       </A><BR>
    <I>Fri Dec 16 14:43:52 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016903.html">[rabbitmq-discuss] dotnet client background thread
</A></li>
        <LI>Next message: <A HREF="016906.html">[rabbitmq-discuss] dotnet client background thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16905">[ date ]</a>
              <a href="thread.html#16905">[ thread ]</a>
              <a href="subject.html#16905">[ subject ]</a>
              <a href="author.html#16905">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This is a really interesting point. Lots of systems have a &quot;vetoable
shutdown about to happen&quot;, &quot;non-vetoable shutdown about to happen&quot;,
&quot;non-vetoable shutdown imminent&quot; set of events:

   - Unix traditionally used wall(1)
   - Windows and OS X apps ask you &quot;Save this document before quitting?&quot;
   - OS X on shutdown or restart gives apps a chance to abandon or delay
   the shutdown

Stepping back from the immediate problem, the &quot;real&quot; solution is to have
the JVM and .NET virtual machines grow up and behave like proper systems,
complete with lifecycle events. Then, AMQP connections have a chance to
clean up and disconnect on their own, without special action on the part of
the programmer and without unduly delaying or preventing VM shutdown.

Thinking on it, lifecycle events like these are probably already present in
the .NET world actually. Does anyone know where to look?

Cheers,
  Tony

On 16 December 2011 08:27, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> We've had this argument back and forth a bit for both the Java and .NET
</I>&gt;<i> clients. The reason why we've been reluctant to do this is that by making
</I>&gt;<i> connections use daemon / background threads we encourage a situation where
</I>&gt;<i> connections don't get properly closed when your application shuts down.
</I>&gt;<i>
</I>&gt;<i> So for example if your application publishes a load of messages and then
</I>&gt;<i> exits, if we used background threads then things would appear to work but
</I>&gt;<i> there would be no guarantee that all the messages would reach the broker.
</I>&gt;<i>
</I>&gt;<i> So really the right thing to do is explicitly close connections at shut
</I>&gt;<i> down - then you know that everything you thought the connections were doing
</I>&gt;<i> is actually done.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 15/12/11 20:53, Eyal Post wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> We have an issue with a .net client application that creates a
</I>&gt;&gt;<i> connection in order to publish message and caches this connection in a
</I>&gt;&gt;<i> variable. The problem is that when the program exits, it gets stuck in
</I>&gt;&gt;<i> memory because there is an AMQP thread that doesn&#8217;t exit.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I&#8217;m not sure how the RabbitMQ threads are created but in .net there is
</I>&gt;&gt;<i> an option to set a thread as a background thread and in this case when
</I>&gt;&gt;<i> the application closes it will not wait for background threads to stop.
</I>&gt;&gt;<i> Is the .net client setting the background threads it creates background?
</I>&gt;&gt;<i> If not, can you change that?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> See here for more details:
</I>&gt;&gt;<i> <A HREF="http://msdn.microsoft.com/en-**us/library/system.threading.**">http://msdn.microsoft.com/en-**us/library/system.threading.**</A>
</I>&gt;&gt;<i> thread.isbackground.aspx&lt;<A HREF="http://msdn.microsoft.com/en-us/library/system.threading.thread.isbackground.aspx">http://msdn.microsoft.com/en-us/library/system.threading.thread.isbackground.aspx</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Eyal Post
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ______________________________**______________________________**
</I>&gt;&gt;<i> __________
</I>&gt;&gt;<i> This email has been scanned by the Symantec Email Security.cloud service.
</I>&gt;&gt;<i> For more information please visit <A HREF="http://www.symanteccloud.com">http://www.symanteccloud.com</A>
</I>&gt;&gt;<i> ______________________________**______________________________**
</I>&gt;&gt;<i> __________
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ______________________________**_________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i> ______________________________**_________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/4c491181/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111216/4c491181/attachment.htm</A>&gt;
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016903.html">[rabbitmq-discuss] dotnet client background thread
</A></li>
	<LI>Next message: <A HREF="016906.html">[rabbitmq-discuss] dotnet client background thread
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16905">[ date ]</a>
              <a href="thread.html#16905">[ thread ]</a>
              <a href="subject.html#16905">[ subject ]</a>
              <a href="author.html#16905">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
