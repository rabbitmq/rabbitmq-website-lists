<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Prevent to deliver a message to a certain consumer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Prevent%20to%20deliver%20a%20message%20to%20a%20certain%0A%20consumer&In-Reply-To=%3C4EE8D62B.5000809%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016864.html">
   <LINK REL="Next"  HREF="016874.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Prevent to deliver a message to a certain consumer</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Prevent%20to%20deliver%20a%20message%20to%20a%20certain%0A%20consumer&In-Reply-To=%3C4EE8D62B.5000809%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Prevent to deliver a message to a certain consumer">simon at rabbitmq.com
       </A><BR>
    <I>Wed Dec 14 17:00:27 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016864.html">[rabbitmq-discuss] Prevent to deliver a message to a certain	consumer
</A></li>
        <LI>Next message: <A HREF="016874.html">[rabbitmq-discuss] Prevent to deliver a message to a certain consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16873">[ date ]</a>
              <a href="thread.html#16873">[ thread ]</a>
              <a href="subject.html#16873">[ subject ]</a>
              <a href="author.html#16873">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here is one approach you could use. Let's stick with the idea that 
you're using routing keys for the chat room name. Furthermore each 
client publishes messages with a &quot;user&quot; header set to the user name.

So you have some top level exchange (presumably direct or topic) for 
chat room routing. When a new user comes on line, rather than just 
declaring a queue and binding to that exchange, they:

* Declare a fanout exchange.

* Declare a headers exchange and bind that to the top level exchange. 
The headers exchange should have its alternate-exchange set to point to 
the fanout exchange.

* Declare a &quot;junk&quot; queue, with message TTL 0, and bind this to their 
headers exchange with arguments [&quot;user&quot;: &lt;their username&gt;].

* Declare a &quot;message&quot; queue and bind this to the fanout exchange.

So when they publish a message it goes to the headers exchange. This 
routes it to the junk queue where it expires immediately.

When someone else publishes a message it goes to the headers exchange. 
This can't route it, which makes it go to the alternate fanout exchange. 
This then routes it to the message queue.

The key point is the use of alternate-exchange for negation.

It's a tiny bit fiddly though, so an alternate approach would be to 
write your own exchange type.

Cheers, Simon

On 14/12/11 14:18, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">bill_martin at freenet.de</A> wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I am writing an application which allows users to communicate with each
</I>&gt;<i> other via RabbitMQ.
</I>&gt;<i>
</I>&gt;<i> Each user-application contains a producer and a receiver to publish or
</I>&gt;<i> receive messages to/from a direct exchange. Each user can bind to a
</I>&gt;<i> &quot;chat-room&quot;.
</I>&gt;<i>
</I>&gt;<i> Imagine two users (UserA and UserB). UserA binds to &quot;chatRoom1&quot; and
</I>&gt;<i> UserB binds to &quot;chatRoom1&quot;.
</I>&gt;<i>
</I>&gt;<i> If UserA publishes a message in &quot;chatRoom1&quot; the consumer of the
</I>&gt;<i> user-application from UserB and the consumer of the user-application
</I>&gt;<i> from UserA gets the message.
</I>&gt;<i>
</I>&gt;<i> I want to prevent that a user gets his own messages to reduce network
</I>&gt;<i> traffic.
</I>&gt;<i>
</I>&gt;<i> Is it possible?
</I>&gt;<i>
</I>&gt;<i> Thanks in advance for your help!
</I>&gt;<i>
</I>&gt;<i> Kind regards,
</I>&gt;<i>
</I>&gt;<i> Bill
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i> *E-Mail ist da wo du bist!* Jetzt mit freenetMail ganz bequem auch
</I>&gt;<i> unterwegs E-Mails verschicken.
</I>&gt;<i> Am besten gleich informieren unter
</I>&gt;<i> <A HREF="http://mail.freenet.de/mobile-email/index.html">http://mail.freenet.de/mobile-email/index.html</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016864.html">[rabbitmq-discuss] Prevent to deliver a message to a certain	consumer
</A></li>
	<LI>Next message: <A HREF="016874.html">[rabbitmq-discuss] Prevent to deliver a message to a certain consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16873">[ date ]</a>
              <a href="thread.html#16873">[ thread ]</a>
              <a href="subject.html#16873">[ subject ]</a>
              <a href="author.html#16873">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
