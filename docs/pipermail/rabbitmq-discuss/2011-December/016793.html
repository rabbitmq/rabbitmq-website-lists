<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Using RabbitMQ for desktop-style messaging	in a web app
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Using%20RabbitMQ%20for%20desktop-style%20messaging%0A%09in%20a%20web%20app&In-Reply-To=%3C7FFE5AC1-969D-4611-875F-9A322D956495%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016749.html">
   <LINK REL="Next"  HREF="016756.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Using RabbitMQ for desktop-style messaging	in a web app</H1>
    <B>Ask Solem</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Using%20RabbitMQ%20for%20desktop-style%20messaging%0A%09in%20a%20web%20app&In-Reply-To=%3C7FFE5AC1-969D-4611-875F-9A322D956495%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Using RabbitMQ for desktop-style messaging	in a web app">ask at rabbitmq.com
       </A><BR>
    <I>Thu Dec  8 12:11:29 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016749.html">[rabbitmq-discuss] Using RabbitMQ for desktop-style messaging in a	web app
</A></li>
        <LI>Next message: <A HREF="016756.html">[rabbitmq-discuss] auto-delete exchange kills connections on	consumer close?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16793">[ date ]</a>
              <a href="thread.html#16793">[ thread ]</a>
              <a href="subject.html#16793">[ subject ]</a>
              <a href="author.html#16793">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 6 Dec 2011, at 05:04, Bill Moseley wrote:

&gt;<i> We have a lot of background processing that happens in a web app and investigating ways to message users when a background task is complete.  I'm wondering if anyone is using RabbitMQ for something like this and can describe their architecture.
</I>&gt;<i> 
</I>&gt;<i> We might have 20K concurrent users &quot;logged in&quot; at any given time.  Some background tasks are important and the user must be notified, and for those we use the database.  But, there's a number of other tasks that user can trigger where it's not critical that the user is notified, but would be nice to see.  These would be very similar to &quot;you have new mail&quot; in a mail client, for example.
</I>
As I see it you have two major options,

1) Use reply-to queues and have the clients browser be a consumer,
using something like amqp-js, Comet, websockets or polling.

  This would be rather experimental, hic sunt dracones.

2) Have the background tasks write notifications to the database,
   which the browsers poll using XMLHttpRequests (or Comet/websockets).


Reply queues may not work well in a web context: the browsers/backend
must be actively consuming to receive the messages, and since the web is stateless
and connections are unreliable it may only be suitable if losing a notification
here and then is acceptable.

You can do like Celery's &quot;amqp result backend&quot; and use a unique id for every
background task, and declare one &quot;result&quot; queue for every task: once when
you publish the task, and then later when you start consuming the result.
That way the browsers query the results using the id, and the messages
will be delivered.  The problem with this approach is that you can end
up with a lot of queues, which can be remedied somewhat by using the x-expires
argument to queue_declare.  (also if you have multiple processes
waiting for the same result, it will only be delivered once, if this is a
problem you can republish the result once you receive it, though this may be prone
to race conditions).

I would go for option 2.


&gt;<i> 
</I>&gt;<i> Questions that have come up is should message queues be session based or user based -- that is if you log into the web app with two browsers (or on two machines) would messages be broadcasted to all sessions for a give user or be session-specific, and how to deal with the non-persistent connections in web apps.
</I>&gt;<i> 
</I>&gt;<i>  Anyone using RabbitMQ for this type of application?
</I>&gt;<i> 
</I></PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016749.html">[rabbitmq-discuss] Using RabbitMQ for desktop-style messaging in a	web app
</A></li>
	<LI>Next message: <A HREF="016756.html">[rabbitmq-discuss] auto-delete exchange kills connections on	consumer close?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16793">[ date ]</a>
              <a href="thread.html#16793">[ thread ]</a>
              <a href="subject.html#16793">[ subject ]</a>
              <a href="author.html#16793">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
