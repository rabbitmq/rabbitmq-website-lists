<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20hangs%2C%20does%20not%20accept%20connections&In-Reply-To=%3C4EFDAA72.9090605%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017065.html">
   <LINK REL="Next"  HREF="017067.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ hangs, does not accept connections</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20hangs%2C%20does%20not%20accept%20connections&In-Reply-To=%3C4EFDAA72.9090605%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ hangs, does not accept connections">matthias at rabbitmq.com
       </A><BR>
    <I>Fri Dec 30 12:11:30 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="017065.html">[rabbitmq-discuss] RabbitMQ hangs, does not accept connections
</A></li>
        <LI>Next message: <A HREF="017067.html">[rabbitmq-discuss] RabbitMQ hangs, does not accept connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17066">[ date ]</a>
              <a href="thread.html#17066">[ thread ]</a>
              <a href="subject.html#17066">[ subject ]</a>
              <a href="author.html#17066">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dmitri,

On 30/12/11 08:27, Dmitri Minaev wrote:
&gt;<i> I would be most grateful if you could have a look at our server.
</I>
I have done this now.

Rabbit indeed wasn't accepting connections - it wasn't refusing them 
either, i.e. it was behaving as if 'accept' hadn't been called.

The Erlang process tasked with accepting AMQP connections was alive and 
well. It was simply sitting there waiting for the tcp subsystem to 
notify it of new connections. Alas that never happened.

So either the acceptor process forgot to tell Erlang's tcp stack to be 
notified of new connections, or Erlang's tcp stack forgot that it was 
supposed to tell the acceptor process...

...and it looks like there is a path in the tcp_acceptor.erl that would 
trigger the former. When the tcp stack notifies the acceptor of an error 
other than 'closed', the acceptor carries on but does not invoke 
prim_inet:async_accept/2 to be notified of the next connection attempt.

I will file a bug for this. Should be easy to fix, though we cannot be 
certain that this is definitely the problem.

Obviously if this was happening frequently we would have heard about the 
issue a long time ago - the code in question hasn't changed for &gt;3 
years. So there must be some rare circumstances triggering this.


I got the acceptor process to issue another async_accept, so rabbit is 
happy for the moment. But no doubt the problem will re-occur.


Regards,

Matthias.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017065.html">[rabbitmq-discuss] RabbitMQ hangs, does not accept connections
</A></li>
	<LI>Next message: <A HREF="017067.html">[rabbitmq-discuss] RabbitMQ hangs, does not accept connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17066">[ date ]</a>
              <a href="thread.html#17066">[ thread ]</a>
              <a href="subject.html#17066">[ subject ]</a>
              <a href="author.html#17066">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
