<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Cluster - Please Help !
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Cluster%20-%20Please%20Help%20%21&In-Reply-To=%3C20111228105655.GA2863%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017033.html">
   <LINK REL="Next"  HREF="017034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Cluster - Please Help !</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Cluster%20-%20Please%20Help%20%21&In-Reply-To=%3C20111228105655.GA2863%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Cluster - Please Help !">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Dec 28 10:56:55 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="017033.html">[rabbitmq-discuss] RabbitMQ Cluster - Please Help !
</A></li>
        <LI>Next message: <A HREF="017034.html">[rabbitmq-discuss] Using rabbitmq_auth_mechanism_ssl with the .NET	client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17039">[ date ]</a>
              <a href="thread.html#17039">[ thread ]</a>
              <a href="subject.html#17039">[ subject ]</a>
              <a href="author.html#17039">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On Tue, Dec 27, 2011 at 04:20:36PM +0200, ran mizrachi wrote:
&gt;<i> My two nodes cluster in production are breaking with these error messages:
</I>&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 23-Dec-2011::04:21:34 ===
</I>&gt;<i> ** Node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbitmq02</A> not responding **
</I>&gt;<i> ** Removing (timedout) connection **
</I>&gt;<i> 
</I>&gt;<i> =INFO REPORT==== 23-Dec-2011::04:21:35 ===
</I>&gt;<i> node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbitmq02</A> lost 'rabbit'
</I>
Ok, you might like to experiment by increasing the net tick time which
is the period after which erlang assumes the cluster has failed.
Something like SERVER_START_ARGS=&quot;-kernel net_ticktime 500&quot; in your
rabbitmq-env.conf file might help.

&gt;<i> I tried to simulate the problem by killing the connection between the two
</I>&gt;<i> nodes using &quot;tcpkill&quot;,
</I>&gt;<i> the cluster has disconnected,and surprisingly the two nodes are not trying
</I>&gt;<i> to reconnect !
</I>
That's not surprising. Rabbit does not try to heal clusters - at least
not automatically.

The fact that the cluster is breaking up suggests something else is
wrong - a networking issue or some such which is causing packet loss.

&gt;<i> 1. If the nodes are configured to work as a cluster, when I get a network
</I>&gt;<i> failure , why aren't they trying to reconnect after ?
</I>
<A HREF="http://en.wikipedia.org/wiki/CAP_theorem">http://en.wikipedia.org/wiki/CAP_theorem</A>
Rabbit does C and A. Not P. Thus a failure of a node is permanent,
without manual intervention.

&gt;<i> 2. How can I identify broken cluster and automatic shutdown one of the
</I>&gt;<i> nodes ?
</I>
Ahh well, assume you have a cluster of N nodes, and a network partion
splits them all apart, and now you have N clusters, each of 1 node.
Which cluster is the &quot;right&quot; cluster? In general, this is a very hard
problem - it's not always right to just take the biggest remaining
cluster, even if there is one. It's often very application specific too.
You'd probably be best off looking at things like Pacemaker for this
stuff seeing as it's really built to help solve these sorts of problems
and supports STONITH and other such devices.

Matthew
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017033.html">[rabbitmq-discuss] RabbitMQ Cluster - Please Help !
</A></li>
	<LI>Next message: <A HREF="017034.html">[rabbitmq-discuss] Using rabbitmq_auth_mechanism_ssl with the .NET	client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17039">[ date ]</a>
              <a href="thread.html#17039">[ thread ]</a>
              <a href="subject.html#17039">[ subject ]</a>
              <a href="author.html#17039">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
