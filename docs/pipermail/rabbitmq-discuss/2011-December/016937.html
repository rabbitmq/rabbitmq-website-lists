<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] auto-delete exchange kills connections on	consumer close?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20auto-delete%20exchange%20kills%20connections%20on%0A%09consumer%20close%3F&In-Reply-To=%3CED8BBF3F-78B8-49F6-8EEB-E179630E4A1F%40zentrope.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016779.html">
   <LINK REL="Next"  HREF="016750.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] auto-delete exchange kills connections on	consumer close?</H1>
    <B>Keith Irwin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20auto-delete%20exchange%20kills%20connections%20on%0A%09consumer%20close%3F&In-Reply-To=%3CED8BBF3F-78B8-49F6-8EEB-E179630E4A1F%40zentrope.com%3E"
       TITLE="[rabbitmq-discuss] auto-delete exchange kills connections on	consumer close?">keith at zentrope.com
       </A><BR>
    <I>Tue Dec 20 00:12:03 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016779.html">[rabbitmq-discuss] auto-delete exchange kills connections on consumer close?
</A></li>
        <LI>Next message: <A HREF="016750.html">[rabbitmq-discuss] Socket leak in java client library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16937">[ date ]</a>
              <a href="thread.html#16937">[ thread ]</a>
              <a href="subject.html#16937">[ subject ]</a>
              <a href="author.html#16937">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Emile--

A belated things for your notes on this topic. Sure enough, the problem was that when I closed down a consumer, the exchange got take down with it. I managed to get things working, so it's all good.

Regards,

Keith

On Dec 7, 2011, at 3:47 AM, Emile Joubert wrote:

&gt;<i> Hi Keith,
</I>&gt;<i> 
</I>&gt;<i> On 06/12/11 06:00, Keith Irwin wrote:
</I>&gt;&gt;<i> Folks--
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I'm using RabbitMQ (2.7.0 all around + java with Clojure) to send small
</I>&gt;&gt;<i> little status messages around here and there. It works great for that.
</I>&gt;&gt;<i> Because I don't care if these messages get dropped if, say, RabbitMQ
</I>&gt;&gt;<i> goes down, or if some client messes up here or there, I want to keep
</I>&gt;&gt;<i> everything temporary. When all the clients are stopped, I'm thinking,
</I>&gt;&gt;<i> RabbitMQ should be back to its default state.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> So, when I use exchangeDeclare, I set auto-delete for the exchange to
</I>&gt;&gt;<i> true. Here are my expectations:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> - When there are no more clients consuming or publishing to that
</I>&gt;&gt;<i> particular exchange, it'll disappear.
</I>&gt;<i> 
</I>&gt;<i> Your description applies better to queues than exchanges. When the last
</I>&gt;<i> client consuming from an auto-delete *queue* unsubscribes, the queue
</I>&gt;<i> auto-deletes.
</I>&gt;<i> 
</I>&gt;<i> An auto-delete exchange self-destructs when the last binding is removed.
</I>&gt;<i> (If you are using exchange-to-exchange bindings then the exchange must
</I>&gt;<i> be the source.) The binding might be removed as the result of an
</I>&gt;<i> auto-delete queue disappearing, which in turn might happen as the result
</I>&gt;<i> of a consumer unsubscribing, but that is incidental.
</I>&gt;<i> 
</I>&gt;<i> Remember that consumers don't consume from an exchange directly.
</I>&gt;<i> 
</I>&gt;&gt;<i> What ACTUALLY happens is that when the first user of that exchange is
</I>&gt;&gt;<i> closed (by calling close on a channel), the exchange is deleted, and all
</I>&gt;&gt;<i> other users of that exchange get disconnected.
</I>&gt;<i> 
</I>&gt;<i> As described earlier, a subscriber that unsubscribes can cause a cascade
</I>&gt;<i> of auto-deletions to occur that removes an exchange. Publishers that
</I>&gt;<i> attempt to publish to an absent exchange will then fail. Is this what is
</I>&gt;<i> happening?
</I>&gt;<i> 
</I>&gt;&gt;<i> Is this a bug?
</I>&gt;<i> 
</I>&gt;<i> If my interpretation is correct then no.
</I>&gt;<i> 
</I>&gt;&gt;<i> Should you always set autoDelete to false if there is ever going to be
</I>&gt;&gt;<i> more than one client using an exchange? And isn't there always going to
</I>&gt;&gt;<i> be another client using that exchange given there's no point in using an
</I>&gt;&gt;<i> MQ system otherwise?
</I>&gt;<i> 
</I>&gt;<i> Don't use auto-delete exchanges if you will have more than one publisher
</I>&gt;<i> for that exchange. There are use-cases where an exchange has a single
</I>&gt;<i> publisher.
</I>&gt;<i> 
</I>&gt;<i> Also consider whether the default exchange is sufficient for your needs.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -Emile
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016779.html">[rabbitmq-discuss] auto-delete exchange kills connections on consumer close?
</A></li>
	<LI>Next message: <A HREF="016750.html">[rabbitmq-discuss] Socket leak in java client library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16937">[ date ]</a>
              <a href="thread.html#16937">[ thread ]</a>
              <a href="subject.html#16937">[ subject ]</a>
              <a href="author.html#16937">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
