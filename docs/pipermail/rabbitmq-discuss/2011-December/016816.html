<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Outage, brokers refuse to start back up
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Outage%2C%20brokers%20refuse%20to%20start%20back%20up&In-Reply-To=%3C4EE22DF8.4070407%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016814.html">
   <LINK REL="Next"  HREF="016817.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Outage, brokers refuse to start back up</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Outage%2C%20brokers%20refuse%20to%20start%20back%20up&In-Reply-To=%3C4EE22DF8.4070407%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Outage, brokers refuse to start back up">simon at rabbitmq.com
       </A><BR>
    <I>Fri Dec  9 15:49:12 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016814.html">[rabbitmq-discuss] Outage, brokers refuse to start back up
</A></li>
        <LI>Next message: <A HREF="016817.html">[rabbitmq-discuss] Outage, brokers refuse to start back up
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16816">[ date ]</a>
              <a href="thread.html#16816">[ thread ]</a>
              <a href="subject.html#16816">[ subject ]</a>
              <a href="author.html#16816">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>When you start a cluster up again after it's entirely shut down, any 
node other than the last one to be shut down will wait at startup for 
the last one to reappear (since the last node to shut down is 
authoritative). If the last node does not reappear in 30s then the error 
message you quote is shown. Did you get the same error on both nodes?

Cheers, Simon

On 09/12/11 15:03, James Carr wrote:
&gt;<i> Okay, so I backed up our mnesia dir and wiped it clean on both boxes.
</I>&gt;<i> Brokers started fine. I then copied the DCD and DCL files back over
</I>&gt;<i> and my users, exchanges, and queues were back.
</I>&gt;<i>
</I>&gt;<i> Is there a recommended way to protect against such an outage?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> James
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, Dec 9, 2011 at 8:41 AM, James Carr&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">james.r.carr at gmail.com</A>&gt;  wrote:
</I>&gt;&gt;<i> So our datacenter had a power failure yesterday and the brokers now
</I>&gt;&gt;<i> REFUSE to start back up. I can send the erl_crash.dump as needed (it
</I>&gt;&gt;<i> is quite large) but here are the other logs.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any ideas?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> James
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Rabbitmq log:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =INFO REPORT==== 9-Dec-2011::08:35:32 ===
</I>&gt;&gt;<i> Limiting to approx 924 file handles (829 sockets)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =ERROR REPORT==== 9-Dec-2011::08:36:02 ===
</I>&gt;&gt;<i> FAILED
</I>&gt;&gt;<i> Reason: {error,
</I>&gt;&gt;<i>             {timeout_waiting_for_tables,
</I>&gt;&gt;<i>                 [rabbit_user,rabbit_user_permission,rabbit_vhost,
</I>&gt;&gt;<i>                  rabbit_durable_route,rabbit_durable_exchange,
</I>&gt;&gt;<i>                  rabbit_durable_queue]}}
</I>&gt;&gt;<i> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
</I>&gt;&gt;<i>              {rabbit_mnesia,check_schema_integrity,0},
</I>&gt;&gt;<i>              {rabbit_mnesia,ensure_schema_integrity,0},
</I>&gt;&gt;<i>              {rabbit_mnesia,init,0},
</I>&gt;&gt;<i>              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
</I>&gt;&gt;<i>              {rabbit,run_boot_step,1},
</I>&gt;&gt;<i>              {rabbit,'-start/2-lc$^0/1-0-',1},
</I>&gt;&gt;<i>              {rabbit,start,2}]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =INFO REPORT==== 9-Dec-2011::08:36:03 ===
</I>&gt;&gt;<i>     application: rabbit
</I>&gt;&gt;<i>     exited: {bad_return,{{rabbit,start,[normal,[]]},
</I>&gt;&gt;<i>                          {'EXIT',{rabbit,failure_during_boot}}}}
</I>&gt;&gt;<i>     type: permanent
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> startup_log:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Activating RabbitMQ plugins ...
</I>&gt;&gt;<i> 11 plugins activated:
</I>&gt;&gt;<i> * amqp_client-2.6.1
</I>&gt;&gt;<i> * erlando-2.6.1
</I>&gt;&gt;<i> * mochiweb-1.3-rmq2.6.1-git9a53dbd
</I>&gt;&gt;<i> * rabbitmq_federation-2.6.1
</I>&gt;&gt;<i> * rabbitmq_management-2.6.1
</I>&gt;&gt;<i> * rabbitmq_management_agent-2.6.1
</I>&gt;&gt;<i> * rabbitmq_management_visualiser-2.6.1
</I>&gt;&gt;<i> * rabbitmq_mochiweb-2.6.1
</I>&gt;&gt;<i> * rabbitmq_shovel-2.6.1
</I>&gt;&gt;<i> * rabbitmq_shovel_management-2.6.1
</I>&gt;&gt;<i> * webmachine-1.7.0-rmq2.6.1-hg0c4b60a
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> +---+   +---+
</I>&gt;&gt;<i> |   |   |   |
</I>&gt;&gt;<i> |   |   |   |
</I>&gt;&gt;<i> |   |   |   |
</I>&gt;&gt;<i> |   +---+   +-------+
</I>&gt;&gt;<i> |                   |
</I>&gt;&gt;<i> | RabbitMQ  +---+   |
</I>&gt;&gt;<i> |           |   |   |
</I>&gt;&gt;<i> |   v2.6.1  +---+   |
</I>&gt;&gt;<i> |                   |
</I>&gt;&gt;<i> +-------------------+
</I>&gt;&gt;<i> AMQP 0-9-1 / 0-9 / 0-8
</I>&gt;&gt;<i> Copyright (C) 2007-2011 VMware, Inc.
</I>&gt;&gt;<i> Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at brokerm02p</A>
</I>&gt;&gt;<i> app descriptor :
</I>&gt;&gt;<i> /usr/lib/rabbitmq/lib/rabbitmq_server-2.6.1/sbin/../ebin/rabbit.app
</I>&gt;&gt;<i> home dir       : /var/lib/rabbitmq
</I>&gt;&gt;<i> config file(s) : /etc/rabbitmq/rabbitmq.config
</I>&gt;&gt;<i> cookie hash    : Mg6GXWPn9Lrj9HC/D14CWA==
</I>&gt;&gt;<i> log            : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at brokerm02p.log</A>
</I>&gt;&gt;<i> sasl log       : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at brokerm02p-sasl.log</A>
</I>&gt;&gt;<i> database dir   : /var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at brokerm02p</A>
</I>&gt;&gt;<i> erlang version : 5.8.4
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -- rabbit boot start
</I>&gt;&gt;<i> starting file handle cache server                                     ...done
</I>&gt;&gt;<i> starting worker pool                                                  ...done
</I>&gt;&gt;<i> starting database
</I>&gt;&gt;<i> ...BOOT ERROR: FAILED
</I>&gt;&gt;<i> Reason: {error,
</I>&gt;&gt;<i>             {timeout_waiting_for_tables,
</I>&gt;&gt;<i>                 [rabbit_user,rabbit_user_permission,rabbit_vhost,
</I>&gt;&gt;<i>                  rabbit_durable_route,rabbit_durable_exchange,
</I>&gt;&gt;<i>                  rabbit_durable_queue]}}
</I>&gt;&gt;<i> Stacktrace: [{rabbit_mnesia,wait_for_tables,1},
</I>&gt;&gt;<i>              {rabbit_mnesia,check_schema_integrity,0},
</I>&gt;&gt;<i>              {rabbit_mnesia,ensure_schema_integrity,0},
</I>&gt;&gt;<i>              {rabbit_mnesia,init,0},
</I>&gt;&gt;<i>              {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
</I>&gt;&gt;<i>              {rabbit,run_boot_step,1},
</I>&gt;&gt;<i>              {rabbit,'-start/2-lc$^0/1-0-',1},
</I>&gt;&gt;<i>              {rabbit,start,2}]
</I>&gt;&gt;<i> {&quot;Kernel pid terminated&quot;,application_controller,&quot;{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}&quot;}
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> startup_err:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Erlang has closed
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Crash dump was written to: erl_crash.dump
</I>&gt;&gt;<i> Kernel pid terminated (application_controller)
</I>&gt;&gt;<i> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016814.html">[rabbitmq-discuss] Outage, brokers refuse to start back up
</A></li>
	<LI>Next message: <A HREF="016817.html">[rabbitmq-discuss] Outage, brokers refuse to start back up
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16816">[ date ]</a>
              <a href="thread.html#16816">[ thread ]</a>
              <a href="subject.html#16816">[ subject ]</a>
              <a href="author.html#16816">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
