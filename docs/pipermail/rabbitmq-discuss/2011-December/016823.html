<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] timeout_waiting_for_tables on node that has	not changed node name
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20timeout_waiting_for_tables%20on%20node%20that%20has%0A%09not%20changed%20node%20name&In-Reply-To=%3CCAFDmHdPM2uic5gp6jffh5%3Diye04RvnacoQHY4pQv2N%3DARr76bg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016821.html">
   <LINK REL="Next"  HREF="016843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] timeout_waiting_for_tables on node that has	not changed node name</H1>
    <B>Elias Levy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20timeout_waiting_for_tables%20on%20node%20that%20has%0A%09not%20changed%20node%20name&In-Reply-To=%3CCAFDmHdPM2uic5gp6jffh5%3Diye04RvnacoQHY4pQv2N%3DARr76bg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] timeout_waiting_for_tables on node that has	not changed node name">fearsome.lucidity at gmail.com
       </A><BR>
    <I>Fri Dec  9 22:33:47 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016821.html">[rabbitmq-discuss] timeout_waiting_for_tables on node that has not	changed node name
</A></li>
        <LI>Next message: <A HREF="016843.html">[rabbitmq-discuss] timeout_waiting_for_tables on node that has not changed node name
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16823">[ date ]</a>
              <a href="thread.html#16823">[ thread ]</a>
              <a href="subject.html#16823">[ subject ]</a>
              <a href="author.html#16823">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We figured it out on our own.  The cluster is using short names for node
names.  For some reason the EC2 DHCP client failed to set the domain entry
in resolv.conf, thus the restarted node's mnesia could not communicate with
other nodes.

Yet the errors and logs made no mention of the fact that the node's IP
could not be resolved.  Had such an error been printed the problem could
have been diagnosed and fixed in a couple of minutes.

Can someone please open a trouble ticket to get some sort of error logged
for this cases?

I have to imagine many of the issues reported as timeout_waiting_for_tables
errors are of similar origin.



On Fri, Dec 9, 2011 at 12:33 PM, Elias Levy &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">fearsome.lucidity at gmail.com</A>&gt;wrote:

&gt;<i> Last night we had to reboot a RabbitMQ node in a 3 node cluster within
</I>&gt;<i> EC2.  The node failed to restart with the
</I>&gt;<i> dreaded timeout_waiting_for_tables error.
</I>&gt;<i>
</I>&gt;<i> Looking as past discussion on that topic it is clear that the most common
</I>&gt;<i> reason for it is a node name change, either because the node name contains
</I>&gt;<i> the IP address, the hostname changed, or a new node is being provisioned on
</I>&gt;<i> an image with an old mnesia DB with some other nodename.
</I>&gt;<i>
</I>&gt;<i> None of those appears to apply in our current situation.  The node name
</I>&gt;<i> does not include the IP address and the node name did not change, as can be
</I>&gt;<i> seen in the start up logs.  Just to be sure we set the node name in the
</I>&gt;<i> /etc/rabbitmq/rabbitmq-env.conf file and attempted to restart, again
</I>&gt;<i> without success.
</I>&gt;<i>
</I>&gt;<i> I enabled mnesia debugging at the trace level and it does not provide any
</I>&gt;<i> useful information as to what is causing the timeout.  The cluster has
</I>&gt;<i> developed a backlog of persistent messages in two of the queues (about 70K
</I>&gt;<i> in total), but from looking at what tables the system complains about it
</I>&gt;<i> does not appear those are the tables its trying to sync.  All the other
</I>&gt;<i> metadata (users, exchanges, bindings, queues) is of very small size, so 30
</I>&gt;<i> seconds should be sufficient time.
</I>&gt;<i>
</I>&gt;<i> While we could wipe the mnesia state from the node, we'd like to find out
</I>&gt;<i> why this happens and whether it can be repaired, for future reference.
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111209/b468af3e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111209/b468af3e/attachment.htm</A>&gt;
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016821.html">[rabbitmq-discuss] timeout_waiting_for_tables on node that has not	changed node name
</A></li>
	<LI>Next message: <A HREF="016843.html">[rabbitmq-discuss] timeout_waiting_for_tables on node that has not changed node name
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16823">[ date ]</a>
              <a href="thread.html#16823">[ thread ]</a>
              <a href="subject.html#16823">[ subject ]</a>
              <a href="author.html#16823">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
