<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 2.6.1 hangs on start after corrupt (?)	database
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.6.1%20hangs%20on%20start%20after%20corrupt%20%28%3F%29%0A%09database&In-Reply-To=%3CCANVKUrU_4g7-c09Sc5vPpg6WUEa0C7fA%2BbUCn_ZJMM-FYUQXng%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016871.html">
   <LINK REL="Next"  HREF="016870.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 2.6.1 hangs on start after corrupt (?)	database</H1>
    <B>Eugene Kirpichov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.6.1%20hangs%20on%20start%20after%20corrupt%20%28%3F%29%0A%09database&In-Reply-To=%3CCANVKUrU_4g7-c09Sc5vPpg6WUEa0C7fA%2BbUCn_ZJMM-FYUQXng%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 2.6.1 hangs on start after corrupt (?)	database">ekirpichov at gmail.com
       </A><BR>
    <I>Wed Dec 14 15:26:51 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016871.html">[rabbitmq-discuss] Erlang R15B and RabbitMQ 2.7.0
</A></li>
        <LI>Next message: <A HREF="016870.html">[rabbitmq-discuss] RabbitMQ 2.6.1 hangs on start after corrupt (?)	database
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16869">[ date ]</a>
              <a href="thread.html#16869">[ thread ]</a>
              <a href="subject.html#16869">[ subject ]</a>
              <a href="author.html#16869">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

The following sad story happened on my colleague's computer, which is on
Windows btw.

He had RabbitMQ running, then ran out of hard drive space, cleaned up some
of it, but after that RabbitMQ wouldn't start.

It would hang at &quot;starting exchange, queue and binding recovery
            ...(never writes 'done')&quot;
It didn't eat CPU or disk or anything.
The erl.exe process had a win32sysinfo.exe subprocess.

RabbitMQ started fine after he cleaned the mnesia database directory.

I'm attaching the output of rabbitmqctl start, a bunch of logs, and
rabbitmqctl report.
Looks like the logs have some failing stack traces, so I believe this
should be enough to diagnose the problem.

Is this a known issue that's been fixed in later versions?

Thanks.

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. <A HREF="http://www.mirantis.com/">http://www.mirantis.com/</A>
Editor, <A HREF="http://fprog.ru/">http://fprog.ru/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment.htm</A>&gt;
-------------- next part --------------
Activating RabbitMQ plugins ...
6 plugins activated:
* amqp_client-2.6.1
* mochiweb-1.3-rmq2.6.1-git9a53dbd
* rabbitmq_management-2.6.1
* rabbitmq_management_agent-2.6.1
* rabbitmq_mochiweb-2.6.1
* webmachine-1.7.0-rmq2.6.1-hg0c4b60a


+---+   +---+
|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   +---+   +-------+
</I>|<i>                   |
</I>|<i> RabbitMQ  +---+   |
</I>|<i>           |   |   |
</I>|<i>   v2.6.1  +---+   |
</I>|<i>                   |
</I>+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>

node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX</A>
app descriptor : c:/Program Files/RabbitMQ Server/rabbitmq_server-2.6.1/sbin/../
ebin/rabbit.app
home dir       : C:\Documents and Settings\xxxx
config file(s) : (none)
cookie hash    : Hhk3jEOtwmGJum0J9RhHuA==
log            : C:/Documents and Settings/xxxx/Application Data/RabbitMQ/l
og/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX.log</A>
sasl log       : C:/Documents and Settings/xxxx/Application Data/RabbitMQ/l
og/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX-sasl.log</A>
database dir   : c:/Documents and Settings/xxxx/Application Data/RabbitMQ/d
b/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX-mnesia</A>
erlang version : 5.8.1.1

-- rabbit boot start
starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting plugin registry                                              ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism plain                                         ...done
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting alarm handler                                                ...done
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting management agent                                             ...done
starting exchange, queue and binding recovery                         ...&lt;hangs here&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX.log</A>
Type: application/octet-stream
Size: 1172 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment.obj</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX.log.1</A>
Type: application/octet-stream
Size: 1171 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment-0001.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment-0001.obj</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX-sasl.log</A>
Type: application/octet-stream
Size: 3426 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment-0002.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment-0002.obj</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX-sasl.log.1</A>
Type: application/octet-stream
Size: 3423 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment-0003.obj">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20111214/cc6d96b4/attachment-0003.obj</A>&gt;
-------------- next part --------------
Reporting server status on {{2011,12,14},{15,8,12}}

Status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX</A>' ...
[{pid,3700},
 {running_applications,
     [{os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.5&quot;},
      {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.9.2&quot;},
      {rabbitmq_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;2.6.1&quot;},
      {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;1.3-rmq2.6.1-git9a53dbd&quot;},
      {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.5&quot;},
      {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.4.15&quot;},
      {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.17.1&quot;},
      {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.14.1&quot;}]},
 {os,{win32,nt}},
 {erlang_version,
     &quot;Erlang R14B (erts-5.8.1.1) [smp:4:4] [rq:4] [async-threads:30]\n&quot;},
 {memory,
     [{total,16613712},
      {processes,5623444},
      {processes_used,5618028},
      {system,10990268},
      {atom,888869},
      {atom_used,860516},
      {binary,155328},
      {code,7981680},
      {ets,621700}]}]

Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX</A>' ...
[{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX</A>']}]},
 {running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX</A>']}]

Application environment of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at PC-XXXX</A>' ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[&lt;&lt;&quot;.*&quot;&gt;&gt;,&lt;&lt;&quot;.*&quot;&gt;&gt;,&lt;&lt;&quot;.*&quot;&gt;&gt;]},
 {default_user,&lt;&lt;&quot;guest&quot;&gt;&gt;},
 {default_user_tags,[administrator]},
 {default_vhost,&lt;&lt;&quot;/&quot;&gt;&gt;},
 {delegate_count,16},
 {frame_max,131072},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:

Channels:

Queues on /:

Exchanges on /:
name	type	durable	auto_delete	internal	arguments
amq.direct	direct	true	false	false	[]
amq.topic	topic	true	false	false	[]
amq.rabbitmq.trace	topic	true	false	false	[]
amq.rabbitmq.log	topic	true	false	false	[]
amq.fanout	fanout	true	false	false	[]
amq.headers	headers	true	false	false	[]
	direct	true	false	false	[]
amq.match	headers	true	false	false	[]

Bindings on /:

Consumers on /:

Permissions on /:
user	configure	write	read
guest	.*	.*	.*

End of server status report
...done.
</PRE>









































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016871.html">[rabbitmq-discuss] Erlang R15B and RabbitMQ 2.7.0
</A></li>
	<LI>Next message: <A HREF="016870.html">[rabbitmq-discuss] RabbitMQ 2.6.1 hangs on start after corrupt (?)	database
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16869">[ date ]</a>
              <a href="thread.html#16869">[ thread ]</a>
              <a href="subject.html#16869">[ subject ]</a>
              <a href="author.html#16869">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
