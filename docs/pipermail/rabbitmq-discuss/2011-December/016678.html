<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster and nodes shutdown: not_found, &quot;no queue 'XXXX' in vhost 'YYY'&quot;, 'queue.declare'
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20and%20nodes%20shutdown%3A%20not_found%2C%0A%20%22no%20queue%20%27XXXX%27%20in%20vhost%20%27YYY%27%22%2C%20%27queue.declare%27&In-Reply-To=%3C4ED75463.9050309%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016677.html">
   <LINK REL="Next"  HREF="016681.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster and nodes shutdown: not_found, &quot;no queue 'XXXX' in vhost 'YYY'&quot;, 'queue.declare'</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20and%20nodes%20shutdown%3A%20not_found%2C%0A%20%22no%20queue%20%27XXXX%27%20in%20vhost%20%27YYY%27%22%2C%20%27queue.declare%27&In-Reply-To=%3C4ED75463.9050309%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Cluster and nodes shutdown: not_found, &quot;no queue 'XXXX' in vhost 'YYY'&quot;, 'queue.declare'">simon at rabbitmq.com
       </A><BR>
    <I>Thu Dec  1 10:18:11 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016677.html">[rabbitmq-discuss] Debugging AD
</A></li>
        <LI>Next message: <A HREF="016681.html">[rabbitmq-discuss]  one queue - two consumers with prefetch 100
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16678">[ date ]</a>
              <a href="thread.html#16678">[ thread ]</a>
              <a href="subject.html#16678">[ subject ]</a>
              <a href="author.html#16678">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/11/11 20:18, Tiago Cruz wrote:
&gt;<i> I'm using  rabbitMQ 2.6.1's mirror queue without 'x-ha-policy' (yet!),
</I>&gt;<i> and I just found a weird situation.
</I>&gt;<i>
</I>&gt;<i> I'm using keepalived to exchange IP address from clients, and my queues
</I>&gt;<i> are &quot;Durable=True&quot;
</I>
&lt;snip&gt;

If you're not using x-ha-policy, then you are not using mirrored queues. 
By default queues only exist on one node (qwc1 in your case).

&gt;<i> If I shutdown the _qwc2_ everything works as well.
</I>&gt;<i>
</I>&gt;<i> If I shutdown the _qwc1_ the cluster stop to work, and I got this errors
</I>&gt;<i> messages on log:
</I>
&lt;snip&gt;

&gt;<i> When the node qwc1 turn back to live, everything works as well.
</I>&gt;<i>
</I>&gt;<i> If, before the shutdown, I delete the queue 'videos' and 'sender',
</I>&gt;<i> everything works as well.
</I>&gt;<i>
</I>&gt;<i> Is the behaviour correct? I thought that everything was still working as
</I>&gt;<i> well even with a crash of one of nodes of cluster :)
</I>
The behaviour is as designed. If you declare a queue on a single node, 
and then that node goes down, attempts to redeclare it return not_found. 
The idea is that when the node comes back up we want the queue to still 
be there - so while it is down Rabbit won't just recreate it on one of 
the other nodes, since then when the node does come back up again you 
would have two copies of the same queue.

But it sounds like you want mirrored queues, so use 'x-ha-policy'.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016677.html">[rabbitmq-discuss] Debugging AD
</A></li>
	<LI>Next message: <A HREF="016681.html">[rabbitmq-discuss]  one queue - two consumers with prefetch 100
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16678">[ date ]</a>
              <a href="thread.html#16678">[ thread ]</a>
              <a href="subject.html#16678">[ subject ]</a>
              <a href="author.html#16678">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
