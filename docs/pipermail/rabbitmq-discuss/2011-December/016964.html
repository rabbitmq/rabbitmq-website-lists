<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq-server crashes hard while consuming 31GB of RAM
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-server%20crashes%20hard%20while%20consuming%0A%2031GB%20of%20RAM&In-Reply-To=%3C4EF1BDB7.6020304%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016963.html">
   <LINK REL="Next"  HREF="016965.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq-server crashes hard while consuming 31GB of RAM</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-server%20crashes%20hard%20while%20consuming%0A%2031GB%20of%20RAM&In-Reply-To=%3C4EF1BDB7.6020304%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmq-server crashes hard while consuming 31GB of RAM">matthias at rabbitmq.com
       </A><BR>
    <I>Wed Dec 21 11:06:31 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016963.html">[rabbitmq-discuss] rabbitmq-server crashes hard while consuming 31GB of RAM
</A></li>
        <LI>Next message: <A HREF="016965.html">[rabbitmq-discuss] rabbitmq-server crashes hard while consuming 31GB of RAM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16964">[ date ]</a>
              <a href="thread.html#16964">[ thread ]</a>
              <a href="subject.html#16964">[ subject ]</a>
              <a href="author.html#16964">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Muharem,

On 21/12/11 10:19, Muharem Hrnjadovic wrote:
&gt;<i> Just before getting into the stuck state I ran &quot;rabbitmqctl report&quot;
</I>&gt;<i> (please see <A HREF="https://bugs.launchpad.net/openquake/+bug/894024/comments/6">https://bugs.launchpad.net/openquake/+bug/894024/comments/6</A>)
</I>&gt;<i> and the RAM usage command ypou kindly supplied (please see
</I>&gt;<i> <A HREF="https://bugs.launchpad.net/openquake/+bug/894024/comments/7">https://bugs.launchpad.net/openquake/+bug/894024/comments/7</A>).
</I>
The latter report doesn't show all that much memory being used by the 
top 30 processes.

Btw, as of 2.7.1 you should be able to produce that report with

rabbitmqctl eval
'[{Mem, Pid, process_info(Pid)} || {Mem, Pid} &lt;- 
lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory), Pid} 
||<i> Pid &lt;- processes()])), 30)].'
</I>
(this is tweaked slightly to be more efficient when there are lots of 
processes, which I suspect is the case in your rabbit)

Try doing that *while* it is wedged. And also send us the output of 
'rabbitmqctl report'. Again, while rabbit is wedged.

My hunch is that you probably have many thousands of celery result queue 
processes.

Regards,

Matthias.
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016963.html">[rabbitmq-discuss] rabbitmq-server crashes hard while consuming 31GB of RAM
</A></li>
	<LI>Next message: <A HREF="016965.html">[rabbitmq-discuss] rabbitmq-server crashes hard while consuming 31GB of RAM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16964">[ date ]</a>
              <a href="thread.html#16964">[ thread ]</a>
              <a href="subject.html#16964">[ subject ]</a>
              <a href="author.html#16964">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
