<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Can't get rabbitMQ to restart after switching machines -- some kind of DB error...?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Can%27t%20get%20rabbitMQ%20to%20restart%20after%0A%20switching%20machines%20--%20some%20kind%20of%20DB%20error...%3F&In-Reply-To=%3C20111206164421.GA4221%40southbank%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016761.html">
   <LINK REL="Next"  HREF="016769.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Can't get rabbitMQ to restart after switching machines -- some kind of DB error...?</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Can%27t%20get%20rabbitMQ%20to%20restart%20after%0A%20switching%20machines%20--%20some%20kind%20of%20DB%20error...%3F&In-Reply-To=%3C20111206164421.GA4221%40southbank%3E"
       TITLE="[rabbitmq-discuss] Can't get rabbitMQ to restart after switching machines -- some kind of DB error...?">alexandru at rabbitmq.com
       </A><BR>
    <I>Tue Dec  6 16:44:21 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016761.html">[rabbitmq-discuss] Can't get rabbitMQ to restart after switching	machines -- some kind of DB error...?
</A></li>
        <LI>Next message: <A HREF="016769.html">[rabbitmq-discuss] why run cpu_sup?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16768">[ date ]</a>
              <a href="thread.html#16768">[ thread ]</a>
              <a href="subject.html#16768">[ subject ]</a>
              <a href="author.html#16768">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Abe,

&gt;<i> But since switching to the
</I>&gt;<i> new machine, I haven't been able to get rabbitmq-server to start up.
</I>
The database RabbitMQ uses is bound to the machine's hostname, so if you
copied the database dir to another machine, it won't work.  If this is
the case, you have to set up a machine with the same hostname as before
and transfer any outstanding messages to the new machine.  If there's
nothing important in rabbit, you could just clear everything by removing
the RabbitMQ files in /var/lib/rabbitmq.

&gt;<i>   /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app
</I>
1.7.2 is a *very* old version of the broker.  You should really upgrade,
as a lot of new features and a lot of bugfixes have gone in since then.

&gt;<i> {&quot;init terminating in do_boot&quot;, {{nocatch, {error,{cannot_start_application,
</I>&gt;<i> rabbit, {bad_return, {{rabbit,start,[normal,[]]},{'EXIT',
</I>&gt;<i> {{case_clause,{error,{timeout_waiting_for_tables, [rabbit_user,
</I>&gt;<i> rabbit_user_permission, rabbit_vhost, rabbit_config, rabbit_listener,
</I>&gt;<i> rabbit_durable_route, rabbit_route, rabbit_reverse_route,
</I>&gt;<i> rabbit_durable_exchange, rabbit_exchange, rabbit_durable_queue,
</I>&gt;<i> rabbit_queue]}}}, [{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
</I>&gt;<i> {rabbit,run_boot_step,1}, {rabbit,'-start/2-lc$^0/1-0-',1}, {rabbit,start,2},
</I>&gt;<i> {application_master, start_it_old,4}]}}}}}}}, [{init,start_it,1},
</I>&gt;<i> {init,start_em,1}]}}
</I>
So, it's timing out waiting for the distributed tables.  I suspect this
is because of the hostname change.  If you had a cluster set up before,
that may also cause this to happen.

&gt;<i> There's also an erlang daemon process running in the background.  I'm not sure
</I>&gt;<i> if this is important or not.
</I>&gt;<i> 
</I>&gt;<i> $ ps aux | grep rabbit
</I>&gt;<i> rabbitmq   714  0.0  0.0   1980   412 ?        S    Dec04   0:01
</I>&gt;<i> /usr/lib/erlang/erts-5.7.4/bin/epmd -daemon
</I>
That's perfectly normal.  It starts up with RabbitMQ (and a few other
Erlang apps) and remains running even after they stop.  You can kill it
if you really want to and RabbitMQ isn't running.

Hope this helps.

Cheers,
Alex

On Tue, Dec 06, 2011 at 03:34:32PM +0000, Abe wrote:
&gt;<i> I'm running a django/celery app on EC2, with rabbitmq as the broker. The machine
</I>&gt;<i> I was using failed, so I fired up another instance. But since switching to the
</I>&gt;<i> new machine, I haven't been able to get rabbitmq-server to start up.
</I>&gt;<i> 
</I>&gt;<i> Here's the output:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> $ sudo rabbitmq-server start
</I>&gt;<i> [Rabbit logo and info...]
</I>&gt;<i> 
</I>&gt;<i> AMQP 8-0
</I>&gt;<i> Copyright (C) 2007-2010 LShift Ltd., Cohesive Financial Technologies LLC., and
</I>&gt;<i> Rabbit Technologies Ltd.
</I>&gt;<i> Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>
</I>&gt;<i> 
</I>&gt;<i> node          : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-212-66-181</A>
</I>&gt;<i> app descriptor:
</I>&gt;<i>   /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.2/sbin/../ebin/rabbit.app
</I>&gt;<i> home dir      : /var/lib/rabbitmq
</I>&gt;<i> cookie hash   : 5+uQ077En5bpvle3HJCQMg==
</I>&gt;<i> log           : /var/log/rabbitmq/rabbit.log
</I>&gt;<i> sasl log      : /var/log/rabbitmq/rabbit-sasl.log
</I>&gt;<i> database dir  : /var/lib/rabbitmq/mnesia/rabbit
</I>&gt;<i> 
</I>&gt;<i> starting internal event notification system                           ...done
</I>&gt;<i> starting logging server                                               ...done
</I>&gt;<i> starting database                                                     ...Erlang
</I>&gt;<i> has closed
</I>&gt;<i> {&quot;init terminating in do_boot&quot;, {{nocatch, {error,{cannot_start_application,
</I>&gt;<i> rabbit, {bad_return, {{rabbit,start,[normal,[]]},{'EXIT',
</I>&gt;<i> {{case_clause,{error,{timeout_waiting_for_tables, [rabbit_user,
</I>&gt;<i> rabbit_user_permission, rabbit_vhost, rabbit_config, rabbit_listener,
</I>&gt;<i> rabbit_durable_route, rabbit_route, rabbit_reverse_route,
</I>&gt;<i> rabbit_durable_exchange, rabbit_exchange, rabbit_durable_queue,
</I>&gt;<i> rabbit_queue]}}}, [{rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
</I>&gt;<i> {rabbit,run_boot_step,1}, {rabbit,'-start/2-lc$^0/1-0-',1}, {rabbit,start,2},
</I>&gt;<i> {application_master, start_it_old,4}]}}}}}}}, [{init,start_it,1},
</I>&gt;<i> {init,start_em,1}]}}
</I>&gt;<i> 
</I>&gt;<i> Crash dump was written to: erl_crash.dump
</I>&gt;<i> init terminating in do_boot ()
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> There's also an erlang daemon process running in the background.  I'm not sure
</I>&gt;<i> if this is important or not.
</I>&gt;<i> 
</I>&gt;<i> $ ps aux | grep rabbit
</I>&gt;<i> rabbitmq   714  0.0  0.0   1980   412 ?        S    Dec04   0:01
</I>&gt;<i> /usr/lib/erlang/erts-5.7.4/bin/epmd -daemon
</I>&gt;<i> 
</I>&gt;<i> Any ideas on how to further diagnose/solve this problem?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Thanks in advance!
</I>&gt;<i> - Abe
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> PS: I posted this question to serverfault before realizing that this might be a
</I>&gt;<i> better place to ask it:<A HREF="http://serverfault.com/questions/337982/">http://serverfault.com/questions/337982/</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016761.html">[rabbitmq-discuss] Can't get rabbitMQ to restart after switching	machines -- some kind of DB error...?
</A></li>
	<LI>Next message: <A HREF="016769.html">[rabbitmq-discuss] why run cpu_sup?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16768">[ date ]</a>
              <a href="thread.html#16768">[ thread ]</a>
              <a href="subject.html#16768">[ subject ]</a>
              <a href="author.html#16768">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
