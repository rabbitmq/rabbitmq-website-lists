<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] auto-delete exchange kills connections on consumer close?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20auto-delete%20exchange%20kills%20connections%20on%0A%20consumer%20close%3F&In-Reply-To=%3C4EDF5253.4020405%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016756.html">
   <LINK REL="Next"  HREF="016937.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] auto-delete exchange kills connections on consumer close?</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20auto-delete%20exchange%20kills%20connections%20on%0A%20consumer%20close%3F&In-Reply-To=%3C4EDF5253.4020405%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] auto-delete exchange kills connections on consumer close?">emile at rabbitmq.com
       </A><BR>
    <I>Wed Dec  7 11:47:31 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016756.html">[rabbitmq-discuss] auto-delete exchange kills connections on	consumer close?
</A></li>
        <LI>Next message: <A HREF="016937.html">[rabbitmq-discuss] auto-delete exchange kills connections on	consumer close?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16779">[ date ]</a>
              <a href="thread.html#16779">[ thread ]</a>
              <a href="subject.html#16779">[ subject ]</a>
              <a href="author.html#16779">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Keith,

On 06/12/11 06:00, Keith Irwin wrote:
&gt;<i> Folks--
</I>&gt;<i> 
</I>&gt;<i> I'm using RabbitMQ (2.7.0 all around + java with Clojure) to send small
</I>&gt;<i> little status messages around here and there. It works great for that.
</I>&gt;<i> Because I don't care if these messages get dropped if, say, RabbitMQ
</I>&gt;<i> goes down, or if some client messes up here or there, I want to keep
</I>&gt;<i> everything temporary. When all the clients are stopped, I'm thinking,
</I>&gt;<i> RabbitMQ should be back to its default state.
</I>&gt;<i> 
</I>&gt;<i> So, when I use exchangeDeclare, I set auto-delete for the exchange to
</I>&gt;<i> true. Here are my expectations:
</I>&gt;<i> 
</I>&gt;<i>  - When there are no more clients consuming or publishing to that
</I>&gt;<i> particular exchange, it'll disappear.
</I>
Your description applies better to queues than exchanges. When the last
client consuming from an auto-delete *queue* unsubscribes, the queue
auto-deletes.

An auto-delete exchange self-destructs when the last binding is removed.
(If you are using exchange-to-exchange bindings then the exchange must
be the source.) The binding might be removed as the result of an
auto-delete queue disappearing, which in turn might happen as the result
of a consumer unsubscribing, but that is incidental.

Remember that consumers don't consume from an exchange directly.

&gt;<i> What ACTUALLY happens is that when the first user of that exchange is
</I>&gt;<i> closed (by calling close on a channel), the exchange is deleted, and all
</I>&gt;<i> other users of that exchange get disconnected.
</I>
As described earlier, a subscriber that unsubscribes can cause a cascade
of auto-deletions to occur that removes an exchange. Publishers that
attempt to publish to an absent exchange will then fail. Is this what is
happening?

&gt;<i> Is this a bug?
</I>
If my interpretation is correct then no.

&gt;<i> Should you always set autoDelete to false if there is ever going to be
</I>&gt;<i> more than one client using an exchange? And isn't there always going to
</I>&gt;<i> be another client using that exchange given there's no point in using an
</I>&gt;<i> MQ system otherwise?
</I>
Don't use auto-delete exchanges if you will have more than one publisher
for that exchange. There are use-cases where an exchange has a single
publisher.

Also consider whether the default exchange is sufficient for your needs.



-Emile
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016756.html">[rabbitmq-discuss] auto-delete exchange kills connections on	consumer close?
</A></li>
	<LI>Next message: <A HREF="016937.html">[rabbitmq-discuss] auto-delete exchange kills connections on	consumer close?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16779">[ date ]</a>
              <a href="thread.html#16779">[ thread ]</a>
              <a href="subject.html#16779">[ subject ]</a>
              <a href="author.html#16779">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
