<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] x509 Authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20x509%20Authentication&In-Reply-To=%3C4B5D885B77E8CC43852B8F0315AD03BA0D4BFB46%40EXMBX03.austin.utexas.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016950.html">
   <LINK REL="Next"  HREF="016962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] x509 Authentication</H1>
    <B>Warren Smith</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20x509%20Authentication&In-Reply-To=%3C4B5D885B77E8CC43852B8F0315AD03BA0D4BFB46%40EXMBX03.austin.utexas.edu%3E"
       TITLE="[rabbitmq-discuss] x509 Authentication">wsmith at tacc.utexas.edu
       </A><BR>
    <I>Tue Dec 20 22:35:14 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="016950.html">[rabbitmq-discuss] x509 Authentication
</A></li>
        <LI>Next message: <A HREF="016962.html">[rabbitmq-discuss] x509 Authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16951">[ date ]</a>
              <a href="thread.html#16951">[ thread ]</a>
              <a href="subject.html#16951">[ subject ]</a>
              <a href="author.html#16951">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I haven't checked back with the developers, but what I ended up doing was hacking the rabbit_auth_mechanism_ssl plugin to do what I want (I should have created a new plugin, but...). I replaced the init() function in rabbit_auth_mechanism_ssl.erl with:

init(Sock) -&gt;
    Username = case rabbit_net:peercert(Sock) of
		   {ok, C} -&gt;
                       DNWithQuotes = lists:flatten(rabbit_ssl:peer_cert_subject(C)),
                       DN = list_to_binary([E || E &lt;- DNWithQuotes, E =/= $&quot;]),
                       rabbit_log:info(&quot;  subject: ~p~n&quot;, [DN]),
                       case config_sane() of
                           true  -&gt; DN;
                           false -&gt; {refused, &quot;configuration unsafe&quot;, []}
                       end;
                   {error, no_peercert} -&gt;
                       {refused, &quot;no peer certificate&quot;, []};
                   nossl -&gt;
                       {refused, &quot;not SSL connection&quot;, []}
               end,
    #state{username = Username}.

And built the plugin (look at <A HREF="http://www.rabbitmq.com/plugin-development.html,">http://www.rabbitmq.com/plugin-development.html,</A> in particular Getting Started).

I was having some issues with quotes in DNs and how erlang does them vs how openssl does them (I'm using openssl to get DN strings from X.509 certificates before calling rabbitmqctl set_permissions). So the code above just removes quotes from DNs when creating user names.

This was with rabbitmq 2.4.1, so I can't guarantee that the modification above works with the current version.


Warren


-----Original Message-----
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of John Ruiz
Sent: Tuesday, December 20, 2011 4:07 PM
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: [rabbitmq-discuss] x509 Authentication

Have there been any changes since this thread?

<A HREF="https://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/3d4c11d3b9a58d3c/5a93c4460ec3e351?lnk=gst&amp;q=+ssl+authentication#5a93c4460ec3e351">https://groups.google.com/group/rabbitmq-discuss/browse_thread/thread/3d4c11d3b9a58d3c/5a93c4460ec3e351?lnk=gst&amp;q=+ssl+authentication#5a93c4460ec3e351</A>

Like the original author, I would like to be able to use the DN of the
certificate's subject as the identity of the user connecting to
rabbitmq.
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</PRE>









































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016950.html">[rabbitmq-discuss] x509 Authentication
</A></li>
	<LI>Next message: <A HREF="016962.html">[rabbitmq-discuss] x509 Authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16951">[ date ]</a>
              <a href="thread.html#16951">[ thread ]</a>
              <a href="subject.html#16951">[ subject ]</a>
              <a href="author.html#16951">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
