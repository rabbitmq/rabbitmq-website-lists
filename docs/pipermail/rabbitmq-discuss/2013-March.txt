From steve at dnsbed.com  Fri Mar  1 02:06:14 2013
From: steve at dnsbed.com (Steve)
Date: Fri, 01 Mar 2013 10:06:14 +0800
Subject: [rabbitmq-discuss] Can't create queues
In-Reply-To: <512F2CFE.7020303@rabbitmq.com>
References: <512F1D0A.60900@dnsbed.com> <512F2CFE.7020303@rabbitmq.com>
Message-ID: <51300D16.8060905@dnsbed.com>

? 2013-2-28 18:10, Emile Joubert ??:
> Have you checked the logfile? I assume you copied the code from the
> tutorials. Do the original versions run correctly, and can you see the
> queues while they run?

Hi Emile,

The rabbitmq port 5672 on localhost is a HAProxy, there are two real 
rabbitmq servers behind HAProxy on other hosts.

This is the sending script:

require "rubygems"
require "amqp"

AMQP.start(:host => "localhost") do |connection|
   channel  = AMQP::Channel.new(connection)
   exchange = channel.fanout("logs")
   message  =  "info: Hello World!"
   i = 0

   while true
       exchange.publish(message)
       puts " [x] Sent #{message} #{i}"
       i+=1
       sleep 1
   end
end


And the receiving script is the one I have posted.

require "rubygems"
require "amqp"

while true
   begin
     AMQP.start(:host => "localhost") do |connection|
       channel  = AMQP::Channel.new(connection)
       exchange = channel.fanout("logs", :durable => true)
       queue    = channel.queue("test_logs", :durable => true)
       queue.bind(exchange)

       puts " [*] Waiting for logs."

       queue.subscribe do |body|
         puts " [x] #{body}"
       end
     end

   rescue Exception => e
     puts e.message
   end
end


I didn't see queues were created on rabbitmq servers, and I checked the 
log, it says nothing but the HAproxy connection info:


=INFO REPORT==== 1-Mar-2013::10:00:41 ===
accepting AMQP connection <0.9170.4> (58.215.191.*:45615 -> 
58.215.191.*:5672)

=WARNING REPORT==== 1-Mar-2013::10:00:41 ===
closing AMQP connection <0.9170.4> (58.215.191.*:45615 -> 
58.215.191.*:5672):
connection_closed_abruptly



This is the rabbitmq status:

# rabbitmqctl status
Status of node rabbit at rabbit65 ...
[{pid,7404},
  {running_applications,[{rabbit,"RabbitMQ","3.0.2"},
                         {os_mon,"CPO  CXC 138 46","2.2.4"},
                         {mnesia,"MNESIA  CXC 138 12","4.4.12"},
                         {sasl,"SASL  CXC 138 11","2.1.8"},
                         {stdlib,"ERTS  CXC 138 10","1.16.4"},
                         {kernel,"ERTS  CXC 138 10","2.13.4"}]},
  {os,{unix,linux}},
  {erlang_version,"Erlang R13B03 (erts-5.7.4) [source] [64-bit] 
[smp:8:8] [rq:8] [async-threads:30] [hipe] [kernel-poll:true]\n"},
  {memory,[{total,62813800},
           {connection_procs,24608},
           {queue_procs,5568},
           {plugins,0},
           {other_proc,9246520},
           {mnesia,63512},
           {mgmt_db,0},
           {msg_index,24576},
           {other_ets,787400},
           {binary,66928},
           {code,12360466},
           {atom,1189649},
           {other_system,39044573}]},
  {vm_memory_high_watermark,0.4},
  {vm_memory_limit,6742995763},
  {disk_free_limit,1000000000},
  {disk_free,13672947712},
  {file_descriptors,[{total_limit,65435},
                     {total_used,3},
                     {sockets_limit,58889},
                     {sockets_used,1}]},
  {processes,[{limit,1048576},{used,131}]},
  {run_queue,0},
  {uptime,68579}]
...done.


Can you give future helps? Thanks.

Regards.

From videlalvaro at gmail.com  Fri Mar  1 08:58:57 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 1 Mar 2013 09:58:57 +0100
Subject: [rabbitmq-discuss] RabbitMQ message ordering
Message-ID: <CAMcAHLUcj3Gm5YQTLdOzYMnuZ1ZSg+zyn1kyeCy8daXr+taZ2w@mail.gmail.com>

Hi,

Since which version RabbitMQ supports message ordering?

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130301/c5c48bd9/attachment.htm>

From simlu at su.se  Fri Mar  1 09:03:33 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Fri, 1 Mar 2013 10:03:33 +0100
Subject: [rabbitmq-discuss] reliability guide
In-Reply-To: <512F93B8.7060308@rabbitmq.com>
References: <512F93B8.7060308@rabbitmq.com>
Message-ID: <20130301090333.GQ22971@kaka.it.su.se>

On Thu, 2013-02-28 at 17:28:24 +0000, Matthias Radestock wrote:
> The RabbitMQ web site now has guide on reliable delivery:
> http://www.rabbitmq.com/reliability.html. Feedback welcome.

Looks good! Saves me time not having to create and update the exact
document in our internal wiki = )

Have a great weekend!
- Simon

From matthias at rabbitmq.com  Fri Mar  1 09:07:06 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Mar 2013 09:07:06 +0000
Subject: [rabbitmq-discuss] RabbitMQ message ordering
In-Reply-To: <CAMcAHLUcj3Gm5YQTLdOzYMnuZ1ZSg+zyn1kyeCy8daXr+taZ2w@mail.gmail.com>
References: <CAMcAHLUcj3Gm5YQTLdOzYMnuZ1ZSg+zyn1kyeCy8daXr+taZ2w@mail.gmail.com>
Message-ID: <51306FBA.80109@rabbitmq.com>

On 01/03/13 08:58, Alvaro Videla wrote:
> Since which version RabbitMQ supports message ordering?

Since forever. Or do you mean preservation of message order on requeue? 
See http://www.rabbitmq.com/changelog.html, i.e. 2.7.0 (Nov'11).

Matthias.

From videlalvaro at gmail.com  Fri Mar  1 10:12:15 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 1 Mar 2013 11:12:15 +0100
Subject: [rabbitmq-discuss] RabbitMQ message ordering
In-Reply-To: <51306FBA.80109@rabbitmq.com>
References: <CAMcAHLUcj3Gm5YQTLdOzYMnuZ1ZSg+zyn1kyeCy8daXr+taZ2w@mail.gmail.com>
	<51306FBA.80109@rabbitmq.com>
Message-ID: <CAMcAHLXXrVmTuFCEo3Fi+=g0GpMozhaLi_8TWbOQCcrCiDEAHQ@mail.gmail.com>

On Fri, Mar 1, 2013 at 10:07 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:
>
> Since forever. Or do you mean preservation of message order on requeue?
> See http://www.rabbitmq.com/**changelog.html<http://www.rabbitmq.com/changelog.html>,
> i.e. 2.7.0 (Nov'11).


Yes, that's what I wanted to know, thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130301/492187ef/attachment.htm>

From emile at rabbitmq.com  Fri Mar  1 10:33:41 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 01 Mar 2013 10:33:41 +0000
Subject: [rabbitmq-discuss] Can't create queues
In-Reply-To: <51300D16.8060905@dnsbed.com>
References: <512F1D0A.60900@dnsbed.com> <512F2CFE.7020303@rabbitmq.com>
	<51300D16.8060905@dnsbed.com>
Message-ID: <51308405.8060108@rabbitmq.com>


Hi Steve,

On 01/03/13 02:06, Steve wrote:
> ? 2013-2-28 18:10, Emile Joubert ??:

> The rabbitmq port 5672 on localhost is a HAProxy, there are two real 
> rabbitmq servers behind HAProxy on other hosts.

Do your scripts produce the expected results if you do not use HAProxy?
If connection attempts are not even reaching the broker then it points
to the problem being outside the broker, most likely HAProxy.





-Emile






From xzhang84 at gmail.com  Fri Mar  1 14:39:55 2013
From: xzhang84 at gmail.com (xzhang84 at gmail.com)
Date: Fri, 1 Mar 2013 22:39:55 +0800
Subject: [rabbitmq-discuss] rabbitmq connections blocking but memory is blow
	watermark
Message-ID: <DAA6050191B145279520BCC228E950B9@gmail.com>


we are use rabbitmq in our application,  two hours ago, one of our app server is blocked when try to connect to rabbitmq, after check rabbitmq server ,  we found one node's memory is over watermark, a few minutes later, this node is down. after restart this node, the whole cluster sames work fine, but i notice there's a lot of connection in blocking and blocked state from web management?but use  `rabbitmqctl list_connections pid name peer_address state` in all nodes shows there is no connection in blocking/blocked?so this really make me confuse:  
1.  after  one node of whole cluster over watermark, but other node is work fine, my application can't connect to rabbitmq cluster?  ps:  we use spring.amqp & spring-rabbit with version 1.1.0.RELEASE
2.  node will down for what reason when over watermark?
3.  why after restart node, there is still blocking connection, but with rabbitmqctl they all in running state?

here is some logs from my rabbitmq server:

=INFO REPORT==== 1-Mar-2013::19:36:21 === vm_memory_high_watermark clear. Memory used:1656590680 allowed:1658778419 =INFO REPORT==== 1-Mar-2013::19:36:21 === alarm_handler: {clear,{resource_limit,memory,rabbit at cos22}}

when i try to close blocked connection from web management, it goes error:

=INFO REPORT==== 1-Mar-2013::20:55:24 === Closing connection <0.17197.115> because "Closed via management plugin" =ERROR REPORT==== 1-Mar-2013::20:55:24 === webmachine error: path="/api/connections/10.64.13.200%3A45891%20-%3E%2010.64.12.226%3A5672" {throw, {error,{not_a_connection_pid,<0.17197.115>}}, [{rabbit_networking,close_connection,2, [{file,"src/rabbit_networking.erl"},{line,317}]}, {rabbit_mgmt_wm_connection,delete_resource,2, [{file,"rabbitmq-management/src/rabbit_mgmt_wm_connection.erl"}, {line,52}]}, {webmachine_resource,resource_call,3, [{file, "webmachine-wrapper/webmachine-git/src/webmachine_resource.erl"}, {line,169}]}, {webmachine_resource,do,3, [{file, "webmachine-wrapper/webmachine-git/src/webmachine_resource.erl"}, {line,128}]}, {webmachine_decision_core,resource_call,1, [{file, "webmachine-wrapper/webmachine-git/src/webmachine_decision_core.erl"}, {line,48}]}, {webmachine_decision_core,decision,1, [{file, "webmachine-wrapper/webmachine-git/src/webmachine_decision_core.erl"}, {line,416}]}, {webmachine_decision_core,handle_request,2, [{file, "webmachine-wrapper/webmachine-git/src/webmachine_decision_core.erl"}, {line,33}]}, {rabbit_webmachine,'-makeloop/1-fun-0-',3, [{file,"rabbitmq-mochiweb/src/rabbit_webmachine.erl"},{line,75}]}]}


use rabbitmqctl shows all in running state:

rabbitmqctl list_connections pid name peer_address state
Listing connections ...
<rabbit at cos23.1.1271.51>        10.64.13.197:57321 -> 10.64.12.225:5672 10.64.13.197    running
<rabbit at cos23.1.1100.51>        10.64.13.196:57240 -> 10.64.12.225:5672 10.64.13.196    running
<rabbit at cos23.1.1056.51>        10.64.12.196:58608 -> 10.64.12.225:5672 10.64.12.196    running
<rabbit at cos23.1.1079.51>        10.64.11.235:48962 -> 10.64.12.225:5672 10.64.11.235    running
<rabbit at cos23.1.1419.51>        10.64.13.228:49857 -> 10.64.12.225:5672 10.64.13.228    running
<rabbit at cos23.1.1049.51>        10.64.11.193:36387 -> 10.64.12.225:5672 10.64.11.193    running
<rabbit at cos23.1.1159.51>        10.64.10.123:52017 -> 10.64.12.225:5672 10.64.10.123    running
<rabbit at cos23.1.26289.45>       10.64.12.247:38504 -> 10.64.12.225:5672 10.64.12.247    running
<rabbit at cos23.1.1121.51>        10.64.10.29:51483 -> 10.64.12.225:5672  10.64.10.29     running
<rabbit at cos23.1.1067.51>        10.64.11.234:50244 -> 10.64.12.225:5672 10.64.11.234    running
<rabbit at cos23.1.1149.51>        10.64.11.178:33795 -> 10.64.12.225:5672 10.64.11.178    running
<rabbit at cos23.1.1136.51>        10.64.10.28:39557 -> 10.64.12.225:5672  10.64.10.28     running
<rabbit at cos23.1.1370.51>        10.64.13.233:38766 -> 10.64.12.225:5672 10.64.13.233    running
<rabbit at cos23.1.1388.51>        10.64.13.229:50932 -> 10.64.12.225:5672 10.64.13.229    running
<rabbit at cos23.1.1254.51>        10.64.13.241:49311 -> 10.64.12.225:5672 10.64.13.241    running
<rabbit at cos23.1.1031.51>        10.64.11.195:39455 -> 10.64.12.225:5672 10.64.11.195    running
<rabbit at cos23.1.1038.51>        10.64.10.27:58938 -> 10.64.12.225:5672  10.64.10.27     running
<rabbit at cos23.1.1167.51>        10.64.13.240:37777 -> 10.64.12.225:5672 10.64.13.240    running
<rabbit at cos23.1.1442.51>        10.64.10.130:37251 -> 10.64.12.225:5672 10.64.10.130    running
<rabbit at cos22.3.2659.0> 10.64.13.200:54840 -> 10.64.12.226:5672 10.64.13.200    running
...done.



and there is a connection with a lot of channel is in blocked state, but i can't find this connection by use rabbitctl list_connections:

AMQP 0-9-1
10.64.13.200:45891 -> 10.64.12.226:5672 (http://10.64.12.226:55672/#/connections/10.64.13.200%3A45891%20-%3E%2010.64.12.226%3A5672)
rabbit at cos22
0B/s(49.2MB total)
0B/s(2.4MB total)
0s
60920





thanks a lot for any help and suggestion.

--  
xzhang84 at gmail.com
??? Sparrow (http://www.sparrowmailapp.com/?sig)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130301/da22c7ab/attachment.htm>

From james.r.carr at gmail.com  Fri Mar  1 16:12:31 2013
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 1 Mar 2013 10:12:31 -0600
Subject: [rabbitmq-discuss] EC2 and Availability Zones
Message-ID: <CAJreXKCKrD-K7ekYV5hV+MpxCKek79MEfie8MEmYqx6xKJnDNA@mail.gmail.com>

Hey All,

We've been re-architecting our infrastructure to be evenly distributed
across availability zones and I'm curious if there are some general
guidelines for clustering rabbitmq across availability zones. I've
been thinking about this quite a bit and am wondering if you can
cluster across the zones (iirc this wouldn't be a good idea due to
network partitioning). Federation comes to mind but then each node in
the federated cluster would get a copy of a message when only one
consumer needs to grab it.

Anyone have more experience with this?

Thanks,
James

From simon at rabbitmq.com  Fri Mar  1 17:21:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 01 Mar 2013 17:21:45 +0000
Subject: [rabbitmq-discuss] rabbitmq connections blocking but memory is
 blow watermark
In-Reply-To: <DAA6050191B145279520BCC228E950B9@gmail.com>
References: <DAA6050191B145279520BCC228E950B9@gmail.com>
Message-ID: <5130E3A9.5060109@rabbitmq.com>

On 01/03/13 14:39, xzhang84 at gmail.com wrote:
> 1.  after  one node of whole cluster over watermark, but other node is
> work fine, my application can't connect to rabbitmq cluster?  ps:  we
> use spring.amqp & spring-rabbit with version 1.1.0.RELEASE

Yes. When *any* node of the cluster goes over the watermark, *all* nodes 
in the cluster stop accepting messages. This is because any node can 
accept messages which will be queued (and hence contribute to memory 
pressure) in the node which is under pressure.

> 2. node will down for what reason when over watermark?

Well, it shouldn't. I would guess the node went down because it was out 
of memory - while blocking publishes is a good way to stop using more 
memory, it's not perfect - a node could still use memory for other 
reasons, and other operating system processes could exhaust memory 
anyway. The (sasl?) logs may give a hint.

> 3.  why after restart node, there is still blocking connection, but with
> rabbitmqctl they all in running state?

Oh gosh.

So it looks like when a cluster node that is *not* running the 
management database crashes, the management database does not clean up 
records of connections and channels that were on that node. That's quite 
an obvious bug, and has existed since RabbitMQ 2.2.0 without anyone 
before you complaining, so congratulations.

Most of the effects you talk about are caused by management listing 
connections which no longer really exist, hence why you saw a 
discrepancy between management and rabbitmqctl.

We'll fix this bug in the next release, but in the mean time you can invoke:

$ rabbitmqctl eval 'exit(global:whereis_name(rabbit_mgmt_db), bang).'

This will forcibly kill the management database, after which it will 
then restart and reconstruct itself, thus clearing the ghost connections.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From kelly.elias at gmail.com  Fri Mar  1 17:04:50 2013
From: kelly.elias at gmail.com (Kelly Elias)
Date: Fri, 1 Mar 2013 09:04:50 -0800 (PST)
Subject: [rabbitmq-discuss] Reconnecting to RabbitMQ after disconnection not
	working?
Message-ID: <7d034019-df42-432c-bb2f-a3271a1ec1a0@googlegroups.com>

I have a class that connects to RabbitMQ like this: (C# code)

private static ConnectionFactory factory;
private static IConnection connection;
private static IModel model;
private static EventingBasicConsumer consumer;

...


factory = new ConnectionFactory {HostName = address};
factory.RequestedHeartbeat = 30;
connection = factory.CreateConnection();

connection.ConnectionShutdown += connection_ConnectionShutdown;

model = connection.CreateModel();

lock (model)
{
    model.ExchangeDeclare(EXCHANGE_NAME, "topic");
    queueName = model.QueueDeclare();
    consumer = new EventingBasicConsumer();
    consumer.Received += consumer_Received;
    model.BasicConsume(queueName, true, consumer);
}

It all works fine. If I unplug my network connection and wait that 30 
seconds for the heartbeat the code will realize it's no longer connected 
and attempt to reconnect by running the code above again. I don't get any 
errors, but after the re-connection I never get a message from RabbitMQ.

I've tried to dispose the objects I'm using but if I try with the 
connection it hangs and never returns.

Any ideas what I can try?


I'm using server version 2.4.1

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130301/68f7f48f/attachment.htm>

From kelly.elias at gmail.com  Fri Mar  1 17:26:34 2013
From: kelly.elias at gmail.com (Kelly Elias)
Date: Fri, 1 Mar 2013 09:26:34 -0800 (PST)
Subject: [rabbitmq-discuss] Reconnecting to RabbitMQ after disconnection
	not working?
In-Reply-To: <7d034019-df42-432c-bb2f-a3271a1ec1a0@googlegroups.com>
References: <7d034019-df42-432c-bb2f-a3271a1ec1a0@googlegroups.com>
Message-ID: <b9e8c626-54e0-47eb-be8e-15d148b712f7@googlegroups.com>

Ignore this, the issue was in my code and not RabbitMQ. 



On Friday, March 1, 2013 10:04:50 AM UTC-7, Kelly Elias wrote:
>
> I have a class that connects to RabbitMQ like this: (C# code)
>
> private static ConnectionFactory factory;
> private static IConnection connection;
> private static IModel model;
> private static EventingBasicConsumer consumer;
>
> ...
>
>
> factory = new ConnectionFactory {HostName = address};
> factory.RequestedHeartbeat = 30;
> connection = factory.CreateConnection();
>
> connection.ConnectionShutdown += connection_ConnectionShutdown;
>
> model = connection.CreateModel();
>
> lock (model)
> {
>     model.ExchangeDeclare(EXCHANGE_NAME, "topic");
>     queueName = model.QueueDeclare();
>     consumer = new EventingBasicConsumer();
>     consumer.Received += consumer_Received;
>     model.BasicConsume(queueName, true, consumer);
> }
>
> It all works fine. If I unplug my network connection and wait that 30 
> seconds for the heartbeat the code will realize it's no longer connected 
> and attempt to reconnect by running the code above again. I don't get any 
> errors, but after the re-connection I never get a message from RabbitMQ.
>
> I've tried to dispose the objects I'm using but if I try with the 
> connection it hangs and never returns.
>
> Any ideas what I can try?
>
>
> I'm using server version 2.4.1
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130301/efdeb3e1/attachment.htm>

From bmurphy1976 at gmail.com  Mon Mar  4 01:48:15 2013
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Sun, 3 Mar 2013 19:48:15 -0600
Subject: [rabbitmq-discuss] EC2 and Availability Zones
In-Reply-To: <CAJreXKCKrD-K7ekYV5hV+MpxCKek79MEfie8MEmYqx6xKJnDNA@mail.gmail.com>
References: <CAJreXKCKrD-K7ekYV5hV+MpxCKek79MEfie8MEmYqx6xKJnDNA@mail.gmail.com>
Message-ID: <CAP+1M2eCzWUZdvj5MTmmbbSPomEqM+0hPBf814Tq2wbh+FVVqg@mail.gmail.com>

On Fri, Mar 1, 2013 at 10:12 AM, James Carr <james.r.carr at gmail.com> wrote:

> Hey All,
>
> We've been re-architecting our infrastructure to be evenly distributed
> across availability zones and I'm curious if there are some general
> guidelines for clustering rabbitmq across availability zones. I've
> been thinking about this quite a bit and am wondering if you can
> cluster across the zones (iirc this wouldn't be a good idea due to
> network partitioning). Federation comes to mind but then each node in
> the federated cluster would get a copy of a message when only one
> consumer needs to grab it.
>
> Anyone have more experience with this?
>

We cluster across availability zones and haven't run into any problems
(yet).  I think federation is overkill.  You'd probably want to use
federation if you wanted to cluster across regions.  My only recommendation
is to run inside a VPC if you can that way you have control over private IP
addresses and hostnames.  That makes things a lot easier.

Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130303/21a872b0/attachment.htm>

From james.r.carr at gmail.com  Mon Mar  4 05:37:54 2013
From: james.r.carr at gmail.com (James Carr)
Date: Sun, 3 Mar 2013 23:37:54 -0600
Subject: [rabbitmq-discuss] EC2 and Availability Zones
In-Reply-To: <CAP+1M2eCzWUZdvj5MTmmbbSPomEqM+0hPBf814Tq2wbh+FVVqg@mail.gmail.com>
References: <CAJreXKCKrD-K7ekYV5hV+MpxCKek79MEfie8MEmYqx6xKJnDNA@mail.gmail.com>
	<CAP+1M2eCzWUZdvj5MTmmbbSPomEqM+0hPBf814Tq2wbh+FVVqg@mail.gmail.com>
Message-ID: <CAJreXKBeNVG6_1eH5pM3G1p7+pMF4_0uVprMXbfVhcH2pDMrdw@mail.gmail.com>

So with a cluster across availability zones how do you handle
consumers? do they connect to the node in their zone directly or
through a proxy?


Thanks,
James


On Sun, Mar 3, 2013 at 7:48 PM, Bryan Murphy <bmurphy1976 at gmail.com> wrote:
> On Fri, Mar 1, 2013 at 10:12 AM, James Carr <james.r.carr at gmail.com> wrote:
>>
>> Hey All,
>>
>> We've been re-architecting our infrastructure to be evenly distributed
>> across availability zones and I'm curious if there are some general
>> guidelines for clustering rabbitmq across availability zones. I've
>> been thinking about this quite a bit and am wondering if you can
>> cluster across the zones (iirc this wouldn't be a good idea due to
>> network partitioning). Federation comes to mind but then each node in
>> the federated cluster would get a copy of a message when only one
>> consumer needs to grab it.
>>
>> Anyone have more experience with this?
>
>
> We cluster across availability zones and haven't run into any problems
> (yet).  I think federation is overkill.  You'd probably want to use
> federation if you wanted to cluster across regions.  My only recommendation
> is to run inside a VPC if you can that way you have control over private IP
> addresses and hostnames.  That makes things a lot easier.
>
> Bryan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From dave at nexttolast.com  Mon Mar  4 06:18:48 2013
From: dave at nexttolast.com (David Goehrig)
Date: Mon, 4 Mar 2013 01:18:48 -0500
Subject: [rabbitmq-discuss] [ANN] AMQP for LuaJIT
Message-ID: <CAPhD6FFn_fOhsD=iw11M88aX1ua3s7McJ9r_RC-buf_AFTGhtA@mail.gmail.com>

Lua Programmers & RabbitMQ Users,

I'm pleased to announce RabbitMQ bindings for LuaJIT.   AMQP provides a
wonderful opportunity for building cross-language distributed applications
that interoperate well.  RabbitMQ provides enterprise grade (well we use it
in our enterprise :) message queuing.  LuaJIT brings the speed of compiled
code and the easiest programming environment around.  I'd pretty much
describe that as pure win...

If you'd like to checkout the code it is available from Github:

https://github.com/cthulhuology/amqp.lua

I'll warn you that while it contains an almost complete binding for
librabbitmq-c, it still has a lot of rough edges, and I'm working on a more
user friendly Lua interface to avoid a lot of the type conversion
headaches.  There is also currently ample opportunity to create memory
leaks (unless you take on librabbitmq memory pool management yourself), so
please do not put this into production as of yet.

If you care to know more about my plans for it I'll be writing more on my
blog here:

http://dloh.org/

Other than that, the code is licensed under a BSD license, and patches
welcome!

PS. I'm aware the packaging is not yet useful to anyone, once it reaches
closer to a 1.0 release I'll fix that.

Dave Goehrig
dave at dloh.org

-- 
-=-=-=-=-=-=-=-=-=-=- http://blog.dloh.org/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130304/a785b25a/attachment.htm>

From carl.hoerberg at gmail.com  Mon Mar  4 02:59:17 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sun, 3 Mar 2013 18:59:17 -0800 (PST)
Subject: [rabbitmq-discuss] Management user can only see it's own
	connections/channels
Message-ID: <1362365957666-25262.post@n5.nabble.com>

If a user has the "management" tag, it can only see it's own connections and
channels, not all within that vhost. 

If a user has the "monitoring" tag, it can see connections to all vhosts,
not just the vhost it has access to. 




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Management-user-can-only-see-it-s-own-connections-channels-tp25262.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Mon Mar  4 05:06:30 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sun, 3 Mar 2013 21:06:30 -0800 (PST)
Subject: [rabbitmq-discuss] Management interface and vhost filtering
Message-ID: <1362373590546-25263.post@n5.nabble.com>

The overview, connections and channels tabs doesn't respect the vhost
filtering (vhost dropdown to the upper right). 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Management-interface-and-vhost-filtering-tp25263.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Mon Mar  4 08:36:42 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 04 Mar 2013 08:36:42 +0000
Subject: [rabbitmq-discuss] Management user can only see it's own
	connections/channels
In-Reply-To: <1362365957666-25262.post@n5.nabble.com>
References: <1362365957666-25262.post@n5.nabble.com>
Message-ID: <51345D1A.10407@rabbitmq.com>

On 04/03/13 02:59, carlhoerberg wrote:
> If a user has the "management" tag, it can only see it's own connections and
> channels, not all within that vhost.
>
> If a user has the "monitoring" tag, it can see connections to all vhosts,
> not just the vhost it has access to.

...which is exactly as documented at 
http://www.rabbitmq.com/management.html#permissions

Matthias.

From matthias at rabbitmq.com  Mon Mar  4 08:38:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 04 Mar 2013 08:38:12 +0000
Subject: [rabbitmq-discuss] Management interface and vhost filtering
In-Reply-To: <1362373590546-25263.post@n5.nabble.com>
References: <1362373590546-25263.post@n5.nabble.com>
Message-ID: <51345D74.5060706@rabbitmq.com>

On 04/03/13 05:06, carlhoerberg wrote:
> The overview, connections and channels tabs doesn't respect the vhost
> filtering (vhost dropdown to the upper right).

What tags does the logged in user have? The above behaviour is expected 
when the user has the 'monitoring' tag, as per 
http://www.rabbitmq.com/management.html#permissions

Matthias.

From tim at rabbitmq.com  Mon Mar  4 11:11:29 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 4 Mar 2013 11:11:29 +0000
Subject: [rabbitmq-discuss] Cluster not running - getting Error:
	{cannot_discover_cluster,
	"The nodes provided are either offline or not running" error
In-Reply-To: <589c03be-aa02-4086-81c8-350afb250106@googlegroups.com>
References: <589c03be-aa02-4086-81c8-350afb250106@googlegroups.com>
Message-ID: <A0CD8D5D-FFAE-41E0-B64D-48553C83065C@rabbitmq.com>

Hi,

On 28 Feb 2013, at 15:40, shankaralingegowda Singonahalli Chikkarevanna wrote:
> and I have enabled ssh entry for both master and slave
> slave can access master using ssh master
> 

Enabling ssh has nothing to do with clustering, so I'm not sure why that's relevant. Are you trying to provide connectivity using ssh tunnels or something? 

> after that I stopped rabbitmq slave machine
> and run join cluster command like join_cluster rabbitmq at master    ---{here rabbitmq is master setup user name and I{p)
> 
> but getting
> Error: {cannot_discover_cluster,"The nodes provided are either offline or not running"
> error

This error means that Erlang cannot connect to the rabbitmq at master node. The individual nodes need to be able to contact one another over TCP/IP using port 4369 and both hosts need to be able to resolve the other's hostname via dns. You should be able to `ping master` from slave and vice versa. If you can ping from one machine to another, you should also be able to telnet to the epmd port (4369) successfully.

> please help me to resolve the issue
> 

Please confirm that TCP/IP connectivity between the two machines works over port 4369. If this *does* work then please confirm that both machines have been configured with the same erlang cookie. If you've followed the transcript at http://www.rabbitmq.com/clustering.html and are still unable to get join_cluster working then let me know and I'll try to assist you further.

Cheers,
Tim


From simon at rabbitmq.com  Mon Mar  4 13:26:42 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Mar 2013 13:26:42 +0000
Subject: [rabbitmq-discuss] esl-erlang support from rpms
In-Reply-To: <268FE869-38A3-4E93-934E-398A58D6646F@gmail.com>
References: <CAD6m6fEMSsn+5FCXpr+ZPngbTApcYGOhi55etkaqFhKLz05BSg@mail.gmail.com>
	<1361978790756-25221.post@n5.nabble.com>
	<512E2821.6040200@rabbitmq.com>
	<268FE869-38A3-4E93-934E-398A58D6646F@gmail.com>
Message-ID: <5134A112.1030601@rabbitmq.com>

Fab, thank you!

I have updated http://www.rabbitmq.com/install-rpm.html to suggest esl 
and this RPM as an alternative to EPEL.

Cheers, Simon

On 28/02/13 02:04, McIntosh Jason wrote:
> Sorry for the delayed response - been working to get my company to
> show some interest in the open source world as more than a "we can
> use these for free" and instead "we can join the community" ;)
>
> Anyways, I've posted source code and some RPM's here:
> https://github.com/jasonmcintosh/esl-erlang-compat
>
> Simon, I put you as a contributor on the project as well.  This is a
> pretty simple release - just creates a version file:
> /etc/esl-erlang-compat/version.txt
>
> That contains the supported version, and updates the RPM database to
> say we provide support.  I require esl-erlang R14B or newer, and
> provide erlang R14B as a result :)  I've got the source for
> everything and RPM's built.  Note, this is my first time trying to
> really do much with github, so I'm still learning how to setup stuff
> there but hopefully this is functional for people now.
>
> Jason
>
>
> On Feb 27, 2013, at 9:37 AM, Simon MacMullen wrote:
>
>> On 27/02/13 15:26, cbush wrote:
>>> Have you tried installing the RPM with the flag "--nodeps"?
>>
>> Well, yes, that would work in the short term. But I like this quote
>> from the yum wiki:
>>
>> "As a general rule if you find you cannot put the screw in the hole
>> with a screw driver you should not go get a hammer." -
>> http://yum.baseurl.org/wiki/NoDeps
>>
>> In the end Jason wrote an adapter RPM which required "esl-erlang"
>> and provided "erlang" - Jason, did you get the chance to post that
>> anywhere?
>>
>> Cheers, Simon
>>
>> -- Simon MacMullen RabbitMQ, VMware
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar  4 13:29:04 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Mar 2013 13:29:04 +0000
Subject: [rabbitmq-discuss] EC2 and Availability Zones
In-Reply-To: <CAP+1M2eCzWUZdvj5MTmmbbSPomEqM+0hPBf814Tq2wbh+FVVqg@mail.gmail.com>
References: <CAJreXKCKrD-K7ekYV5hV+MpxCKek79MEfie8MEmYqx6xKJnDNA@mail.gmail.com>
	<CAP+1M2eCzWUZdvj5MTmmbbSPomEqM+0hPBf814Tq2wbh+FVVqg@mail.gmail.com>
Message-ID: <5134A1A0.1060200@rabbitmq.com>

On 04/03/13 01:48, Bryan Murphy wrote:
> We cluster across availability zones and haven't run into any problems
> (yet).

I don't know how reliable Amazon's networking is, but I would suggest 
you keep some monitoring tool checking in case RabbitMQ reports a 
partition. But I can certainly see why you'd do this...

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From Michael.Laing at nytimes.com  Mon Mar  4 19:11:30 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Mon, 4 Mar 2013 14:11:30 -0500
Subject: [rabbitmq-discuss] EC2 and Availability Zones
In-Reply-To: <5134A1A0.1060200@rabbitmq.com>
Message-ID: <CD5A2675.8434%Michael.Laing@nytimes.com>

We are running now with clusters across zones using VPCs in AWS. It hasn't
caused any problems? yet.

However, though convenient and familiar, we don't really NEED clustering?

So to avoid the horrors (though possibly remote) of network partitions, we
have re-architected using shovels for our next release.

We also use shovels between regions. Typically we run in 3 zones in each
of 3 regions.

Michael Laing
NYTimes Digital

On 3/4/13 8:29 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>On 04/03/13 01:48, Bryan Murphy wrote:
>> We cluster across availability zones and haven't run into any problems
>> (yet).
>
>I don't know how reliable Amazon's networking is, but I would suggest
>you keep some monitoring tool checking in case RabbitMQ reports a
>partition. But I can certainly see why you'd do this...
>
>Cheers, Simon
>
>
>-- 
>Simon MacMullen
>RabbitMQ, VMware
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From nathannis at gmail.com  Tue Mar  5 03:14:33 2013
From: nathannis at gmail.com (Nathan Shirlberg)
Date: Mon, 4 Mar 2013 19:14:33 -0800 (PST)
Subject: [rabbitmq-discuss] Error: unable to connect to node
	rabbit@host: nodedown
In-Reply-To: <26422afb-7e1a-4afd-b09e-538594b2d387@googlegroups.com>
References: <26422afb-7e1a-4afd-b09e-538594b2d387@googlegroups.com>
Message-ID: <74cd5a49-1e1b-481b-8d4f-862d7d4efd17@googlegroups.com>

I cant remember if this the right error message or not, but the erlang 
cookies need to match on all rabbit nodes in the same cluster.

On Tuesday, February 26, 2013 2:06:02 PM UTC-6, Chris Chambers wrote:
>
> Greetings. I have searched, found and read many posts on this same similar 
> subject but am not able to get going.
> Background - installing the rabbitmq as a requirement for standalone chef 
> server.
> All other components/requirements seem to have installed ok.
> When using any argument to the rabbitmqctl command, I get the same message:
> Status of node rabbit at s2cchef ...
> Error: unable to connect to node rabbit at s2cchef: nodedown
> diagnostics:
> - nodes and their ports on s2cchef: [{rabbitmqctl22520,12034}]
> - current node: rabbitmqctl22520 at s2cchef
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: 7HQZbBfzsJc7oLvzbEsqwA==
>
> Read up on the rabbitmq and tried reset as well as force_reset to ensure 
> at defaults. Still not able to get running.
> Adding the s2cchef in /etc/hosts on the 127.0.0.1 also does not work.
> Validate that erlang is running as well.
>
> Can someone please provide some assistance?
> Thanks in advance.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130304/016cb983/attachment.htm>

From emile at rabbitmq.com  Tue Mar  5 09:36:23 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 05 Mar 2013 09:36:23 +0000
Subject: [rabbitmq-discuss] Error: unable to connect to node
 rabbit@host: nodedown
In-Reply-To: <74cd5a49-1e1b-481b-8d4f-862d7d4efd17@googlegroups.com>
References: <26422afb-7e1a-4afd-b09e-538594b2d387@googlegroups.com>
	<74cd5a49-1e1b-481b-8d4f-862d7d4efd17@googlegroups.com>
Message-ID: <5135BC97.1010207@rabbitmq.com>


Hi,


On 05/03/13 03:14, Nathan Shirlberg wrote:
> I cant remember if this the right error message or not, but the erlang
> cookies need to match on all rabbit nodes in the same cluster.

> On Tuesday, February 26, 2013 2:06:02 PM UTC-6, Chris Chambers wrote:
>     Status of node rabbit at s2cchef ...
>     Error: unable to connect to node rabbit at s2cchef: nodedown
>     diagnostics:
>     - nodes and their ports on s2cchef: [{rabbitmqctl22520,12034}]
>     - current node: rabbitmqctl22520 at s2cchef
>     - current node home dir: /var/lib/rabbitmq
>     - current node cookie hash: 7HQZbBfzsJc7oLvzbEsqwA==

This problem can indeed be caused by mismatched erlang cookies if the
broker logfile contains an entry starting with
"Connection attempt from disallowed node..."
The solution is to verify that the cookies (or their hashes) match and
synchronise them if not.

The troubleshooting page lists other possible causes and solutions:
http://www.rabbitmq.com/troubleshooting.html



-Emile








From michael.s.klishin at gmail.com  Tue Mar  5 10:15:53 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 5 Mar 2013 14:15:53 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 0.9.10 is released
Message-ID: <CAE3HoVRtv_EyEtO6JT=OBH-_YGoVVD3e0paEL8q8O2sow=kiJg@mail.gmail.com>

amqp gem 0.9.10 [1] is released to rubygems.org.

It includes one bug fix and is 100% backwards-compatible.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/03/05/amqp-gem-0-dot-9-10-is-released/

1. https://rubygems.org/gems/amqp/versions/0.9.10
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/4bd372b8/attachment.htm>

From bison_art at o2.pl  Tue Mar  5 12:43:23 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 5 Mar 2013 04:43:23 -0800 (PST)
Subject: [rabbitmq-discuss] Multiple connections performance
Message-ID: <1362487403922-25275.post@n5.nabble.com>

Hi, could you tell me why many connections are faster than one connection ?
I read that better is to use many channels, but only one connection.
Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Multiple-connections-performance-tp25275.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Tue Mar  5 14:41:10 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 5 Mar 2013 14:41:10 +0000
Subject: [rabbitmq-discuss] Multiple connections performance
In-Reply-To: <1362487403922-25275.post@n5.nabble.com>
References: <1362487403922-25275.post@n5.nabble.com>
Message-ID: <5E100D92-8078-4387-9EE7-250279D1F883@rabbitmq.com>

Hi Artur

On 5 Mar 2013, at 12:43, rabbit15 wrote:
> Hi, could you tell me why many connections are faster than one connection ?

If your server is processing multiple connections concurrently then it is possible that you will be able to take advantage of parallelism and gain a performance boost. This may *not* happen of course, if for example the connections are writing to the same queue (in which case input has to be serialised), so it depends on how your application(s) will be structured and the topology your using and so on.

> I read that better is to use many channels, but only one connection.

Connections are much more resource intensive that channels, both on the client and the server. Connection use constrained resources (i.e., file descriptors) which channels do not. Multiplexing channels over a single connections is pretty much transparent to the application. Connections which are publishing can become blocked when the server is overloaded (i.e., hits the memory high watermark) however, so if you're publishing and consuming in the same client application then using separate connections might be advantageous (so that flow control doesn't block the consumer).

Cheers,
Tim

From tim at rabbitmq.com  Tue Mar  5 14:44:58 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 5 Mar 2013 14:44:58 +0000
Subject: [rabbitmq-discuss] Multiple connections performance
In-Reply-To: <5E100D92-8078-4387-9EE7-250279D1F883@rabbitmq.com>
References: <1362487403922-25275.post@n5.nabble.com>
	<5E100D92-8078-4387-9EE7-250279D1F883@rabbitmq.com>
Message-ID: <94EA10D7-428F-4375-97AB-B4166ACEF768@rabbitmq.com>

On 5 Mar 2013, at 14:41, Tim Watson wrote:
> so it depends on how your application(s) will be structured and the topology your using and so on.

I'm having a bad spelling day today: s/your/you're/

From bison_art at o2.pl  Tue Mar  5 14:53:03 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 5 Mar 2013 06:53:03 -0800 (PST)
Subject: [rabbitmq-discuss] Multiple connections performance
In-Reply-To: <94EA10D7-428F-4375-97AB-B4166ACEF768@rabbitmq.com>
References: <1362487403922-25275.post@n5.nabble.com>
	<5E100D92-8078-4387-9EE7-250279D1F883@rabbitmq.com>
	<94EA10D7-428F-4375-97AB-B4166ACEF768@rabbitmq.com>
Message-ID: <1362495183465-25278.post@n5.nabble.com>

Thank you !
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Multiple-connections-performance-tp25275p25278.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jesper.louis.andersen at gmail.com  Tue Mar  5 14:58:46 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Tue, 5 Mar 2013 15:58:46 +0100
Subject: [rabbitmq-discuss] How does one handle a large amount of queues in
	the web interface?
Message-ID: <CAGrdgiU1Utb7J5dEiuUZHQvnX8zTXxvFzOZSgR=aT6px1q_CHg@mail.gmail.com>

We have a setup here where we could easily end up with some thousands of
queues very quickly. This means that the web interface becomes less usable
since a lot of those queues will "mess it up".

What are the usual way to handle this problem? Is it to restructure the
application to use less queues, or is there another way?

-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/36a19da4/attachment.htm>

From simon at rabbitmq.com  Tue Mar  5 15:09:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 05 Mar 2013 15:09:36 +0000
Subject: [rabbitmq-discuss] How does one handle a large amount of queues
 in the web interface?
In-Reply-To: <CAGrdgiU1Utb7J5dEiuUZHQvnX8zTXxvFzOZSgR=aT6px1q_CHg@mail.gmail.com>
References: <CAGrdgiU1Utb7J5dEiuUZHQvnX8zTXxvFzOZSgR=aT6px1q_CHg@mail.gmail.com>
Message-ID: <51360AB0.9040904@rabbitmq.com>

On 05/03/13 14:58, Jesper Louis Andersen wrote:
> We have a setup here where we could easily end up with some thousands of
> queues very quickly. This means that the web interface becomes less
> usable since a lot of those queues will "mess it up".
>
> What are the usual way to handle this problem? Is it to restructure the
> application to use less queues, or is there another way?

Yes, allowing pagination and / or filtering in the web UI has been on 
the TODO list for some time. It feels excessive to have to restructure 
your application just to deal with the management web UI.

Until pagination / filtering appear, the best advice I can offer is "use 
rabbitmqadmin" I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From gdanycan at slip-software.com  Tue Mar  5 15:32:19 2013
From: gdanycan at slip-software.com (Gilles Danycan)
Date: Tue, 5 Mar 2013 16:32:19 +0100 (CET)
Subject: [rabbitmq-discuss] flow control threshold
In-Reply-To: <5113C573.9020602@rabbitmq.com>
Message-ID: <1683772357.115973.1362497539121.JavaMail.root@ns22265.ovh.net>

Hi Simon, 

sorry to answering late, 
yes, it's a very strange thing, i have to admit that i'm lost.. 

it`s happen only with this queue... a network issue could be the source of the problem? may be due to the high volume of data ? 
the problem occur also without having the connection in state: flow. (the pid of the script is in state running) and we have nothing in logs.. 

the last time (friday), i restarted the rabbitmq server (i restarted the server because its was not possible to stop the rabbitmq process..) and it back working. 
i use an older library for php: amqp-0.2.2 , may be something in relation with? 

about the script, i have to clean it before ;) 

Cheers, 
Gilles Danycan 


From: "Simon MacMullen" <simon at rabbitmq.com> 
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com> 
Cc: "Gilles Danycan" <gdanycan at slip-software.com> 
Sent: Thursday, February 7, 2013 4:17:07 PM 
Subject: Re: [rabbitmq-discuss] flow control threshold 

The flow control should only be restricting the rate at which you can 
publish into a queue to the rate at which the queue can accept messages 
- in other words it should only ever slow publishing down, and not by 
too much. 

If you have seen it block publishing altogether that would be a serious 
bug. Can you post your script somewhere? 

Cheers, Simon 

On 07/02/13 12:35, Gilles Danycan wrote: 
> Hi All, 
> 
> I have a serious problem to consume and requeue messages on a specific 
> queue. i think the flow control is blocking connection... 
> I'm using RabbitMQ 3.0.2, Erlang R15B03 on a debian server : 64go ram , 
> 8 cpu. 
> 
> i have a script (named consumer) consuming and requeue messages on a 
> queue named "mainQueue" (actually 900 000 messages into this queue) and 
> another one publishing messages on the same queue (arround 200mess/s). 
> each message is arroung 15kbytes and deliverymode =2 and durable. 
> 
> usually the script consumer is able to get and requeue messages at 
> 1000mess/s, sometimes the same script is in hold, it doesn't consumer 
> messages.., i see in connections that the connection is in state : flow 
> 
> i found documentation about flow control but i would like more advices 
> about how to determine the flow control specificaly with my 
> configuration and how to change the threshold. 
> 
> 
> i send you below more details about the rabbitmq server status.. 
> 
> 
> Connections: *328* 
> Channels: *328* 
> Exchanges: *120* 
> Queues: *111* 
> Consumers: *0 
> 
> * 
> File descriptors (?) Socket descriptors (?) Erlang processes Memory 
> Disk space Uptime Type 
> 527 
> _1048576 available 
> 
> 330 
> _943626 available 
> 
> 2937 
> _1048576 available 
> 
> 2.7GB 
> _25.2GB high watermark 
> 
> 1.7TB 
> _953.7MB low watermark 
> 2h 32m Disc Stats * 
> 
> 
> 
> Thanks for your help, 
> 
> Regards, 
> 
> *Gilles* 
> 
> 
> 
> 
> 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> rabbitmq-discuss at lists.rabbitmq.com 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
> 


-- 
Simon MacMullen 
RabbitMQ, VMware 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/817a2625/attachment.htm>

From CLefevre at Transparent.com  Tue Mar  5 16:07:36 2013
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 5 Mar 2013 16:07:36 +0000
Subject: [rabbitmq-discuss] Remotely destroy/create Vhost automatically?
Message-ID: <5798631D5F355D4C99FDF23580295AF81A071480@TLMAIL1.Transparent.local>

Hello RMQ List,
I have hopefully a quick and easy question.

We have a RabbitMQ instance on a Windows server, but the clients are running a mix of Windows/Ubuntu. We were looking to make a remote call to delete a VHOST, and then recreate the same VHOST.

For example, we have a VHOST named "Test-Service". We want to delete "Test-Service" to wipe out all of its queues, and messages, and then start anew, recreating the "Test-Service" for automated testing purposes.

We currently are doing this on a local RabbitMQ instance via the rabbitmqctl  command line tool, but would like to use a centralized RabbitMQ server. The queues are being recreated programmatically already, but we're looking for a solution, something that can be hopefully used with Gradle, to recreate the VHOST before running our service.

Thank you for your time,
-Christopher Lefevre

The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/1decd6a7/attachment.htm>

From michael.s.klishin at gmail.com  Tue Mar  5 16:10:18 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 5 Mar 2013 20:10:18 +0400
Subject: [rabbitmq-discuss] Remotely destroy/create Vhost automatically?
In-Reply-To: <5798631D5F355D4C99FDF23580295AF81A071480@TLMAIL1.Transparent.local>
References: <5798631D5F355D4C99FDF23580295AF81A071480@TLMAIL1.Transparent.local>
Message-ID: <CAE3HoVQ5Whq-WajtV=fyTEEcbHFH7A6LK6-e1H0qVg7DWK8jmw@mail.gmail.com>

2013/3/5 Christopher Lefevre <CLefevre at transparent.com>

> We currently are doing this on a local RabbitMQ instance via the
> rabbitmqctl  command line tool, but would like to use a centralized
> RabbitMQ server. The queues are being recreated programmatically already,
> but we?re looking for a solution, something that can be hopefully used with
> Gradle, to recreate the VHOST before running our service.


Christopher,

Take a look at the HTTP API that comes with the management plugin:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/3646dee55e02/priv/www-api/help.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/795bb610/attachment.htm>

From CLefevre at Transparent.com  Tue Mar  5 16:14:22 2013
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 5 Mar 2013 16:14:22 +0000
Subject: [rabbitmq-discuss] Remotely destroy/create Vhost automatically?
Message-ID: <5798631D5F355D4C99FDF23580295AF81A071496@TLMAIL1.Transparent.local>

I actually just found my answer.

I wanted to share just in case someone else has this query, you can do all of this via the Management Plugin's API. The documentation for the API can be found here:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_0_2/priv/www/api/index.html

Thank you for your time,
-Christopher Lefevre

From: Christopher Lefevre
Sent: Tuesday, March 05, 2013 11:08 AM
To: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: Remotely destroy/create Vhost automatically?

Hello RMQ List,
I have hopefully a quick and easy question.

We have a RabbitMQ instance on a Windows server, but the clients are running a mix of Windows/Ubuntu. We were looking to make a remote call to delete a VHOST, and then recreate the same VHOST.

For example, we have a VHOST named "Test-Service". We want to delete "Test-Service" to wipe out all of its queues, and messages, and then start anew, recreating the "Test-Service" for automated testing purposes.

We currently are doing this on a local RabbitMQ instance via the rabbitmqctl  command line tool, but would like to use a centralized RabbitMQ server. The queues are being recreated programmatically already, but we're looking for a solution, something that can be hopefully used with Gradle, to recreate the VHOST before running our service.

Thank you for your time,
-Christopher Lefevre

The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/80a21c80/attachment.htm>

From jerryk at rbcon.com  Tue Mar  5 16:35:33 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Tue, 5 Mar 2013 08:35:33 -0800
Subject: [rabbitmq-discuss] Error: unable to connect to node
	rabbit@host: nodedown
In-Reply-To: <5135BC97.1010207@rabbitmq.com>
References: <26422afb-7e1a-4afd-b09e-538594b2d387@googlegroups.com>
	<74cd5a49-1e1b-481b-8d4f-862d7d4efd17@googlegroups.com>
	<5135BC97.1010207@rabbitmq.com>
Message-ID: <CAE0Sz=xL7Pnkoz0VeDpawZWkWTHXsB4EJn_kOuZ8ne-cw1Hmnw@mail.gmail.com>

Another small observation on mismatched Erlang cookies:  Be very sure they
actually match, and don't just *look* like they match.  Some editors, which
will remain nameless, can be a bit eager to stick whitespace in the file if
one capriciously saves it during an inspection visit...

On Tue, Mar 5, 2013 at 1:36 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
>
> On 05/03/13 03:14, Nathan Shirlberg wrote:
> > I cant remember if this the right error message or not, but the erlang
> > cookies need to match on all rabbit nodes in the same cluster.
>
> > On Tuesday, February 26, 2013 2:06:02 PM UTC-6, Chris Chambers wrote:
> >     Status of node rabbit at s2cchef ...
> >     Error: unable to connect to node rabbit at s2cchef: nodedown
> >     diagnostics:
> >     - nodes and their ports on s2cchef: [{rabbitmqctl22520,12034}]
> >     - current node: rabbitmqctl22520 at s2cchef
> >     - current node home dir: /var/lib/rabbitmq
> >     - current node cookie hash: 7HQZbBfzsJc7oLvzbEsqwA==
>
> This problem can indeed be caused by mismatched erlang cookies if the
> broker logfile contains an entry starting with
> "Connection attempt from disallowed node..."
> The solution is to verify that the cookies (or their hashes) match and
> synchronise them if not.
>
> The troubleshooting page lists other possible causes and solutions:
> http://www.rabbitmq.com/troubleshooting.html
>
>
>
> -Emile
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/a62607b5/attachment.htm>

From eliao at seegrid.com  Tue Mar  5 16:52:27 2013
From: eliao at seegrid.com (Elizabeth Liao)
Date: Tue, 5 Mar 2013 16:52:27 +0000
Subject: [rabbitmq-discuss] corrupt or missing cluster file
Message-ID: <E94F626F5C43D14F8B8479C5EBD79038F4E458B0@vmexchange02.seegrid.local>

Hi,

On RabbitMQ 3.0.2, when I use the command rabbitmqctl reset, I occasionally get this error message:

Error: {corrupt_or_missing_cluster_files,{error,enoent},{error,enoent}}

I do not have a cluster set up so I'm not sure why I'm getting the message.  Also, I haven't been able to reproduce the error consistently so any help would be appreciated.

Thanks.

Liz
Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From tim at rabbitmq.com  Tue Mar  5 20:35:11 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 5 Mar 2013 20:35:11 +0000
Subject: [rabbitmq-discuss] corrupt or missing cluster file
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038F4E458B0@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD79038F4E458B0@vmexchange02.seegrid.local>
Message-ID: <8F4C8AFA-C8DF-4764-81CD-F6C66F503F0B@rabbitmq.com>

Hi Liz,

On 5 Mar 2013, at 16:52, Elizabeth Liao wrote:
> On RabbitMQ 3.0.2, when I use the command rabbitmqctl reset, I occasionally get this error message:
> 
> Error: {corrupt_or_missing_cluster_files,{error,enoent},{error,enoent}}
> 
> I do not have a cluster set up so I'm not sure why I'm getting the message.  Also, I haven't been able to reproduce the error consistently so any help would be appreciated.
> 

That sounds like a bug, though I'm not able to reproduce it locally. Is this a restarted RAM node by any chance? The reset command does query mnesia for the cluster status and if the mnesia table's aren't present it does try to read from this 'cluster status file' - even if you're not clustered. But I can't see how that would happen unless the rabbit mnesia tables were missing.

Cheers,
Tim

From richard at raseley.com  Tue Mar  5 22:25:50 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 5 Mar 2013 14:25:50 -0800
Subject: [rabbitmq-discuss] Disabling Default Exchange Creation
Message-ID: <CAO=6ox8zW-KSW8mqDAfVe=C+ggKxd3dhfHEiykBiUjhufFVLPg@mail.gmail.com>

By default a new (or recently reset) RabbitMQ instance creates many default
objects (e.g. exchanges with names amq.fanout and amq.headers).

Is there a method to disable the creation of these objects? Right now my
options are to let them be there (doing nothing but annoying me) or go
through and delete each one manually.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/4492daf1/attachment.htm>

From videlalvaro at gmail.com  Tue Mar  5 22:30:01 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 5 Mar 2013 23:30:01 +0100
Subject: [rabbitmq-discuss] Disabling Default Exchange Creation
In-Reply-To: <CAO=6ox8zW-KSW8mqDAfVe=C+ggKxd3dhfHEiykBiUjhufFVLPg@mail.gmail.com>
References: <CAO=6ox8zW-KSW8mqDAfVe=C+ggKxd3dhfHEiykBiUjhufFVLPg@mail.gmail.com>
Message-ID: <CAMcAHLU-EK_07eFzXW6mwXx=Np=x-U+apDib+8Az4UkTL1H96w@mail.gmail.com>

As far as I recall those exchanges are there because they are mandated by
the AMQP spec. Besides that exchanges just take a tiny bit of memory, so
nothing to worry about.

Why do you want to delete them?


On Tue, Mar 5, 2013 at 11:25 PM, Richard Raseley <richard at raseley.com>wrote:

> By default a new (or recently reset) RabbitMQ instance creates many
> default objects (e.g. exchanges with names amq.fanout and amq.headers).
>
> Is there a method to disable the creation of these objects? Right now my
> options are to let them be there (doing nothing but annoying me) or go
> through and delete each one manually.
>
> Regards,
>
> Richard
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/e9d04ca3/attachment.htm>

From eliao at seegrid.com  Tue Mar  5 22:30:48 2013
From: eliao at seegrid.com (Elizabeth Liao)
Date: Tue, 5 Mar 2013 22:30:48 +0000
Subject: [rabbitmq-discuss] corrupt or missing cluster file
In-Reply-To: <8F4C8AFA-C8DF-4764-81CD-F6C66F503F0B@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD79038F4E458B0@vmexchange02.seegrid.local>,
	<8F4C8AFA-C8DF-4764-81CD-F6C66F503F0B@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD79038F4E46A4B@vmexchange02.seegrid.local>

Hi Tim,

That was very helpful!   We had an instance where the rabbitmq server needed to be restarted instead of just started following the deletion of the mnesia directory.

Thanks.

Liz
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Tim Watson [tim at rabbitmq.com]
Sent: Tuesday, March 05, 2013 3:35 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] corrupt or missing cluster file

Hi Liz,

On 5 Mar 2013, at 16:52, Elizabeth Liao wrote:
> On RabbitMQ 3.0.2, when I use the command rabbitmqctl reset, I occasionally get this error message:
>
> Error: {corrupt_or_missing_cluster_files,{error,enoent},{error,enoent}}
>
> I do not have a cluster set up so I'm not sure why I'm getting the message.  Also, I haven't been able to reproduce the error consistently so any help would be appreciated.
>

That sounds like a bug, though I'm not able to reproduce it locally. Is this a restarted RAM node by any chance? The reset command does query mnesia for the cluster status and if the mnesia table's aren't present it does try to read from this 'cluster status file' - even if you're not clustered. But I can't see how that would happen unless the rabbit mnesia tables were missing.

Cheers,
Tim
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From richard at raseley.com  Tue Mar  5 22:32:36 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 5 Mar 2013 14:32:36 -0800
Subject: [rabbitmq-discuss] Disabling Default Exchange Creation
In-Reply-To: <CAMcAHLU-EK_07eFzXW6mwXx=Np=x-U+apDib+8Az4UkTL1H96w@mail.gmail.com>
References: <CAO=6ox8zW-KSW8mqDAfVe=C+ggKxd3dhfHEiykBiUjhufFVLPg@mail.gmail.com>
	<CAMcAHLU-EK_07eFzXW6mwXx=Np=x-U+apDib+8Az4UkTL1H96w@mail.gmail.com>
Message-ID: <CAO=6ox9Nb3md+L9nXQ=7hGgi=yjZOJ1A0trAzTbU9PUMHBO3GA@mail.gmail.com>

Thank you for your reply. I want to delete them because my OCD demands it,
no practical reason. =]

Regards,

Richard


On Tue, Mar 5, 2013 at 2:30 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:

> As far as I recall those exchanges are there because they are mandated by
> the AMQP spec. Besides that exchanges just take a tiny bit of memory, so
> nothing to worry about.
>
> Why do you want to delete them?
>
>
> On Tue, Mar 5, 2013 at 11:25 PM, Richard Raseley <richard at raseley.com>wrote:
>
>> By default a new (or recently reset) RabbitMQ instance creates many
>> default objects (e.g. exchanges with names amq.fanout and amq.headers).
>>
>> Is there a method to disable the creation of these objects? Right now my
>> options are to let them be there (doing nothing but annoying me) or go
>> through and delete each one manually.
>>
>> Regards,
>>
>> Richard
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/08202099/attachment.htm>

From watson.timothy at gmail.com  Wed Mar  6 07:57:47 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 6 Mar 2013 07:57:47 +0000
Subject: [rabbitmq-discuss] corrupt or missing cluster file
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038F4E46A4B@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD79038F4E458B0@vmexchange02.seegrid.local>
	<8F4C8AFA-C8DF-4764-81CD-F6C66F503F0B@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038F4E46A4B@vmexchange02.seegrid.local>
Message-ID: <5E909AE2-37CA-401C-8EE2-CFB1DC93C5CE@rabbitmq.com>

Hi Liz,

On 5 Mar 2013, at 22:30, Elizabeth Liao <eliao at seegrid.com> wrote:
> We had an instance where the rabbitmq server needed to be restarted instead of just started following the deletion of the mnesia directory.
> 

So you (accidentally?) deleted the mnesia directory whilst the broker was running? 

> Thanks.
> 
> Liz
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Tim Watson [tim at rabbitmq.com]
> Sent: Tuesday, March 05, 2013 3:35 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] corrupt or missing cluster file
> 
> Hi Liz,
> 
> On 5 Mar 2013, at 16:52, Elizabeth Liao wrote:
>> On RabbitMQ 3.0.2, when I use the command rabbitmqctl reset, I occasionally get this error message:
>> 
>> Error: {corrupt_or_missing_cluster_files,{error,enoent},{error,enoent}}
>> 
>> I do not have a cluster set up so I'm not sure why I'm getting the message.  Also, I haven't been able to reproduce the error consistently so any help would be appreciated.
>> 
> 
> That sounds like a bug, though I'm not able to reproduce it locally. Is this a restarted RAM node by any chance? The reset command does query mnesia for the cluster status and if the mnesia table's aren't present it does try to read from this 'cluster status file' - even if you're not clustered. But I can't see how that would happen unless the rabbit mnesia tables were missing.
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> Email Confidentiality Notice
> 
> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Ameya.Patil at servicenow.com  Tue Mar  5 23:14:45 2013
From: Ameya.Patil at servicenow.com (Ameya Patil)
Date: Tue, 5 Mar 2013 23:14:45 +0000
Subject: [rabbitmq-discuss] Difference between async connection using ioloop
 and blocking connection for rabbitmq
Message-ID: <AE61A943249BE64497342A426F24C2985FB1A2@SJC4EXDAG01-01.corp.service-now.com>

Hi,

Ioloops in async connection is exhibiting blocking semantics. I am trying to understand how this is different than a blocking connection


The documentation (https://pika.readthedocs.org/en/latest/connecting.html#io-and-event-looping ) states:

These IOLoops are blocking methods which loop and listen for events.


In a experiment I conducted, I publish 2 messages, each 5 times: message 'test' published by AsyncPublisher and 'test1' by AsyncPublisher1.py.


In the consumer I have an if block stating:

If body == test:

    Time.sleep(10)


I run AsyncPublisher.py first, and after it has sent 5 test messages I run AsyncPublisher1.py.


The output I expect is :

Test

test1

test1

test1

tes1

Test

Test

Test

Test


Instead I get:

Test

Tes

Test

Test

Test

test1

test1

test1

test1

test1


This is the same as if I would run the sender and receiver using a blocking connection.

My question is how does a blocking connection different than ioloop.start ? Does it differ only on multithreading ?


Thanks,

Ameya

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/5d85a199/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: AsyncConsumer.py
Type: text/x-python-script
Size: 12690 bytes
Desc: AsyncConsumer.py
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/5d85a199/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: AsyncPublisher.py
Type: text/x-python-script
Size: 12927 bytes
Desc: AsyncPublisher.py
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/5d85a199/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: AsyncPublisher1.py
Type: text/x-python-script
Size: 12928 bytes
Desc: AsyncPublisher1.py
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130305/5d85a199/attachment-0002.bin>

From watson.timothy at gmail.com  Wed Mar  6 07:58:54 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 6 Mar 2013 07:58:54 +0000
Subject: [rabbitmq-discuss] Disabling Default Exchange Creation
In-Reply-To: <CAO=6ox9Nb3md+L9nXQ=7hGgi=yjZOJ1A0trAzTbU9PUMHBO3GA@mail.gmail.com>
References: <CAO=6ox8zW-KSW8mqDAfVe=C+ggKxd3dhfHEiykBiUjhufFVLPg@mail.gmail.com>
	<CAMcAHLU-EK_07eFzXW6mwXx=Np=x-U+apDib+8Az4UkTL1H96w@mail.gmail.com>
	<CAO=6ox9Nb3md+L9nXQ=7hGgi=yjZOJ1A0trAzTbU9PUMHBO3GA@mail.gmail.com>
Message-ID: <565848D4-6CDE-4E04-9A22-C061B31F653E@rabbitmq.com>

I would suggest not doing that. Things might break in unexpected ways. :)

On 5 Mar 2013, at 22:32, Richard Raseley <richard at raseley.com> wrote:

> Thank you for your reply. I want to delete them because my OCD demands it, no practical reason. =]
> 
> Regards,
> 
> Richard
> 
> 
> On Tue, Mar 5, 2013 at 2:30 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> As far as I recall those exchanges are there because they are mandated by the AMQP spec. Besides that exchanges just take a tiny bit of memory, so nothing to worry about.
> 
> Why do you want to delete them?
> 
> 
> On Tue, Mar 5, 2013 at 11:25 PM, Richard Raseley <richard at raseley.com> wrote:
> By default a new (or recently reset) RabbitMQ instance creates many default objects (e.g. exchanges with names amq.fanout and amq.headers).
> 
> Is there a method to disable the creation of these objects? Right now my options are to let them be there (doing nothing but annoying me) or go through and delete each one manually.
> 
> Regards,
> 
> Richard
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130306/b192765b/attachment.htm>

From bison_art at o2.pl  Wed Mar  6 08:30:58 2013
From: bison_art at o2.pl (rabbit15)
Date: Wed, 6 Mar 2013 00:30:58 -0800 (PST)
Subject: [rabbitmq-discuss] Multiple connections performance
In-Reply-To: <1362495183465-25278.post@n5.nabble.com>
References: <1362487403922-25275.post@n5.nabble.com>
	<5E100D92-8078-4387-9EE7-250279D1F883@rabbitmq.com>
	<94EA10D7-428F-4375-97AB-B4166ACEF768@rabbitmq.com>
	<1362495183465-25278.post@n5.nabble.com>
Message-ID: <1362558658734-25296.post@n5.nabble.com>

Hi, I have question about channels and connections. 
Why flow control doesn't block channel instead of connection ? My
application performs the best when I'm using one connection per one channel.
Why flow control of one channel degraded speed of other channels in the
connection ? What is the idea of using channels if I have to use connection
per channel for optimal performance?
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Multiple-connections-performance-tp25275p25296.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed Mar  6 09:10:24 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 6 Mar 2013 09:10:24 +0000
Subject: [rabbitmq-discuss] Multiple connections performance
In-Reply-To: <1362558658734-25296.post@n5.nabble.com>
References: <1362487403922-25275.post@n5.nabble.com>
	<5E100D92-8078-4387-9EE7-250279D1F883@rabbitmq.com>
	<94EA10D7-428F-4375-97AB-B4166ACEF768@rabbitmq.com>
	<1362495183465-25278.post@n5.nabble.com>
	<1362558658734-25296.post@n5.nabble.com>
Message-ID: <18FF3AD4-C013-41E9-A74C-960CF2990EE4@rabbitmq.com>

Hi Artur,

On 6 Mar 2013, at 08:30, rabbit15 wrote:
> Hi, I have question about channels and connections. 
> Why flow control doesn't block channel instead of connection ?

Due to the limitations of the AMQP protocol, it can't be done on per-channel basis.

> My
> application performs the best when I'm using one connection per one channel.
> Why flow control of one channel degraded speed of other channels in the
> connection ?

Rabbit's flow control mechanism applies TCP back-pressure to producers to give the broker (and/or consumers) time to catch up. Doing it that way on a per-channel basis wouldn't work, because all the channels are multiplexed over a single TCP connection.

> What is the idea of using channels if I have to use connection
> per channel for optimal performance?

As the documentation points out...

<quote>
.. it is undesirable to keep many TCP connections open at the same time because doing so consumes system resources and makes it more difficult to 	configure firewalls.. 
</quote>

Cheers,
Tim

> Artur
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Multiple-connections-performance-tp25275p25296.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From bison_art at o2.pl  Wed Mar  6 09:23:10 2013
From: bison_art at o2.pl (rabbit15)
Date: Wed, 6 Mar 2013 01:23:10 -0800 (PST)
Subject: [rabbitmq-discuss] Multiple connections performance
In-Reply-To: <18FF3AD4-C013-41E9-A74C-960CF2990EE4@rabbitmq.com>
References: <1362487403922-25275.post@n5.nabble.com>
	<5E100D92-8078-4387-9EE7-250279D1F883@rabbitmq.com>
	<94EA10D7-428F-4375-97AB-B4166ACEF768@rabbitmq.com>
	<1362495183465-25278.post@n5.nabble.com>
	<1362558658734-25296.post@n5.nabble.com>
	<18FF3AD4-C013-41E9-A74C-960CF2990EE4@rabbitmq.com>
Message-ID: <1362561790594-25298.post@n5.nabble.com>

Thanks a lot!
Cheers,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Multiple-connections-performance-tp25275p25298.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed Mar  6 11:02:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Mar 2013 11:02:49 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.3 released
Message-ID: <51372259.4010704@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.0.3.

This release fixes a small number of bugs in 3.0.2 and earlier versions.

See the release notes at:

http://www.rabbitmq.com/release-notes/README-3.0.3.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                      The RabbitMQ Team
                      (http://www.rabbitmq.com)

From simon at rabbitmq.com  Wed Mar  6 11:10:03 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Mar 2013 11:10:03 +0000
Subject: [rabbitmq-discuss] flow control threshold
In-Reply-To: <1683772357.115973.1362497539121.JavaMail.root@ns22265.ovh.net>
References: <1683772357.115973.1362497539121.JavaMail.root@ns22265.ovh.net>
Message-ID: <5137240B.2070207@rabbitmq.com>

I don't think it's the use of an older library. There is a bug fixed in 
the latest 3.0.3 release which you might be seeing - I suggest you give 
it a try.

Cheers, Simon

On 05/03/13 15:32, Gilles Danycan wrote:
> Hi Simon,
>
> sorry to answering late,
> yes, it's a very strange thing, i have to admit that i'm lost..
>
> it`s happen only with this queue... a network issue could be the source
> of the problem? may be due to the high volume of data ?
> the problem occur also without having the connection in state: flow.
> (the pid of the script is in state running)  and we have nothing in logs..
>
> the last time (friday), i restarted the rabbitmq server (i restarted the
> server because its was not possible to stop the rabbitmq process..) and
> it back working.
> i use an older library for php: amqp-0.2.2 , may be something in
> relation with?
>
> about the script, i have to clean it before ;)
>
> Cheers,
>
>      *Gilles Danycan*
>
>
> ------------------------------------------------------------------------
> *From: *"Simon MacMullen" <simon at rabbitmq.com>
> *To: *"Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
> *Cc: *"Gilles Danycan" <gdanycan at slip-software.com>
> *Sent: *Thursday, February 7, 2013 4:17:07 PM
> *Subject: *Re: [rabbitmq-discuss] flow control threshold
>
> The flow control should only be restricting the rate at which you can
> publish into a queue to the rate at which the queue can accept messages
> - in other words it should only ever slow publishing down, and not by
> too much.
>
> If you have seen it block publishing altogether that would be a serious
> bug. Can you post your script somewhere?
>
> Cheers, Simon
>
> On 07/02/13 12:35, Gilles Danycan wrote:
>  > Hi All,
>  >
>  > I have a serious problem to consume and requeue messages on a specific
>  > queue. i think the flow control is blocking connection...
>  > I'm using RabbitMQ 3.0.2, Erlang R15B03 on a debian server : 64go ram ,
>  > 8 cpu.
>  >
>  > i have a script (named consumer) consuming and requeue messages on a
>  > queue named "mainQueue" (actually 900 000 messages into this queue) and
>  > another one publishing messages on the same queue (arround 200mess/s).
>  > each message is arroung 15kbytes and deliverymode =2 and durable.
>  >
>  > usually the script consumer is able to get and requeue messages at
>  > 1000mess/s, sometimes the same script is in hold, it doesn't consumer
>  > messages.., i see in connections that the connection is in state : flow
>  >
>  > i found documentation about flow control but i would like more advices
>  > about how to determine the flow control specificaly with my
>  > configuration and how to change the threshold.
>  >
>  >
>  > i send you below more details about the rabbitmq server status..
>  >
>  >
>  > Connections: *328*
>  > Channels: *328*
>  > Exchanges: *120*
>  > Queues: *111*
>  > Consumers: *0
>  >
>  > *
>  > File descriptors (?)         Socket descriptors (?)         Erlang
> processes         Memory
>  > Disk space         Uptime         Type
>  > 527
>  > _1048576 available
>  >
>  > 330
>  > _943626 available
>  >
>  > 2937
>  > _1048576 available
>  >
>  > 2.7GB
>  > _25.2GB high watermark
>  >
>  > 1.7TB
>  > _953.7MB low watermark
>  >         2h 32m         Disc Stats *
>  >
>  >
>  >
>  > Thanks for your help,
>  >
>  > Regards,
>  >
>  >      *Gilles*
>  >
>  >
>  >
>  >
>  >
>  > _______________________________________________
>  > rabbitmq-discuss mailing list
>  > rabbitmq-discuss at lists.rabbitmq.com
>  > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  >
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware


-- 
Simon MacMullen
RabbitMQ, VMware

From francois at teksol.info  Wed Mar  6 13:51:44 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Wed, 6 Mar 2013 08:51:44 -0500
Subject: [rabbitmq-discuss] Multiple connections performance
In-Reply-To: <1362558658734-25296.post@n5.nabble.com>
References: <1362487403922-25275.post@n5.nabble.com>
	<5E100D92-8078-4387-9EE7-250279D1F883@rabbitmq.com>
	<94EA10D7-428F-4375-97AB-B4166ACEF768@rabbitmq.com>
	<1362495183465-25278.post@n5.nabble.com>
	<1362558658734-25296.post@n5.nabble.com>
Message-ID: <C9946C0B-6846-41C0-8587-258B75F06B5C@teksol.info>


Le 2013-03-06 ? 03:30, rabbit15 a ?crit :

> Hi, I have question about channels and connections. 
> Why flow control doesn't block channel instead of connection ? My
> application performs the best when I'm using one connection per one channel.
> Why flow control of one channel degraded speed of other channels in the
> connection ? What is the idea of using channels if I have to use connection
> per channel for optimal performance?

I keep two connections open per process: one for producing and another for consuming. I essentially use one-way connections. Works great for us, and prevents consumers from being blocked because of flow control.

Bye!
Fran?ois

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130306/ae82d184/attachment.bin>

From simon at rabbitmq.com  Wed Mar  6 15:21:38 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Mar 2013 15:21:38 +0000
Subject: [rabbitmq-discuss] How does one handle a large amount of queues
 in the web interface?
In-Reply-To: <51360AB0.9040904@rabbitmq.com>
References: <CAGrdgiU1Utb7J5dEiuUZHQvnX8zTXxvFzOZSgR=aT6px1q_CHg@mail.gmail.com>
	<51360AB0.9040904@rabbitmq.com>
Message-ID: <51375F02.9090504@rabbitmq.com>

On 05/03/13 15:09, Simon MacMullen wrote:
> Yes, allowing pagination and / or filtering in the web UI has been on
> the TODO list for some time.

And your mail prompted me to work on it, so RabbitMQ 3.1 will have some 
list-filtering thing in the management plugin.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Wed Mar  6 15:26:20 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 6 Mar 2013 19:26:20 +0400
Subject: [rabbitmq-discuss] ANN Hot Bunnies 1.5.0 is released
Message-ID: <CAE3HoVSeuBkb1LbZJ9J1Gf0vPiGn8PNX9+5imHVwBqS3vKE-ww@mail.gmail.com>

Hot Bunnies 1.5.0 is released to rubygems.org [1].

The only change in this version is RabbitMQ Java client
upgrade to 3.0.

1. https://rubygems.org/gems/hot_bunnies/versions/1.5.0-java
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130306/677dbd2e/attachment.htm>

From jesper.louis.andersen at gmail.com  Wed Mar  6 16:55:57 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Wed, 6 Mar 2013 17:55:57 +0100
Subject: [rabbitmq-discuss] How does one handle a large amount of queues
 in the web interface?
In-Reply-To: <51375F02.9090504@rabbitmq.com>
References: <CAGrdgiU1Utb7J5dEiuUZHQvnX8zTXxvFzOZSgR=aT6px1q_CHg@mail.gmail.com>
	<51360AB0.9040904@rabbitmq.com> <51375F02.9090504@rabbitmq.com>
Message-ID: <CAGrdgiVicD6me59XxMZMFWAbDhEahgqa_D6ajzo+AC7LZifyug@mail.gmail.com>

This is awesome work, thank you so much!


On Wed, Mar 6, 2013 at 4:21 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 05/03/13 15:09, Simon MacMullen wrote:
>
>> Yes, allowing pagination and / or filtering in the web UI has been on
>> the TODO list for some time.
>>
>
> And your mail prompted me to work on it, so RabbitMQ 3.1 will have some
> list-filtering thing in the management plugin.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130306/4cd370dd/attachment.htm>

From michael.s.klishin at gmail.com  Wed Mar  6 17:30:08 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 6 Mar 2013 21:30:08 +0400
Subject: [rabbitmq-discuss] ANN Langohr 1.0.0-beta13 is released
Message-ID: <CAE3HoVRzi7GRpVWPhQj5OyK+4CTmuWwAff4wwWwRvRqnmgdVSg@mail.gmail.com>

Langohr [1] is a Clojure RabbitMQ client that embraces AMQP 0.9.1 Model [2].

1.0.0-beta13 is a development release that has *breaking API changes*.
Release notes:

http://blog.clojurewerkz.org/blog/2013/03/06/langohr-1-dot-0-0-beta13-is-released/

1. http://clojurerabbitmq.info
2. http://www.rabbitmq.com/tutorials/amqp-concepts.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130306/65b0693e/attachment.htm>

From jerryk at rbcon.com  Wed Mar  6 20:02:01 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 6 Mar 2013 12:02:01 -0800
Subject: [rabbitmq-discuss] Disabling Default Exchange Creation
In-Reply-To: <CAO=6ox9Nb3md+L9nXQ=7hGgi=yjZOJ1A0trAzTbU9PUMHBO3GA@mail.gmail.com>
References: <CAO=6ox8zW-KSW8mqDAfVe=C+ggKxd3dhfHEiykBiUjhufFVLPg@mail.gmail.com>
	<CAMcAHLU-EK_07eFzXW6mwXx=Np=x-U+apDib+8Az4UkTL1H96w@mail.gmail.com>
	<CAO=6ox9Nb3md+L9nXQ=7hGgi=yjZOJ1A0trAzTbU9PUMHBO3GA@mail.gmail.com>
Message-ID: <CAE0Sz=yRs6B4982few3qzsqtBtioc4fj-aF9hk5kFHOi-3NPpw@mail.gmail.com>

I would let your OCD work itself out against the permissions granted to
your broker's users rather than the default AMQP-spec demanded thingies...
:-)

On Tue, Mar 5, 2013 at 2:32 PM, Richard Raseley <richard at raseley.com> wrote:

> Thank you for your reply. I want to delete them because my OCD demands it,
> no practical reason. =]
>
> Regards,
>
> Richard
>
>
> On Tue, Mar 5, 2013 at 2:30 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>
>> As far as I recall those exchanges are there because they are mandated by
>> the AMQP spec. Besides that exchanges just take a tiny bit of memory, so
>> nothing to worry about.
>>
>> Why do you want to delete them?
>>
>>
>> On Tue, Mar 5, 2013 at 11:25 PM, Richard Raseley <richard at raseley.com>wrote:
>>
>>> By default a new (or recently reset) RabbitMQ instance creates many
>>> default objects (e.g. exchanges with names amq.fanout and amq.headers).
>>>
>>> Is there a method to disable the creation of these objects? Right now my
>>> options are to let them be there (doing nothing but annoying me) or go
>>> through and delete each one manually.
>>>
>>> Regards,
>>>
>>> Richard
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130306/70980283/attachment.htm>

From woqimingweipeng at gmail.com  Thu Mar  7 08:14:22 2013
From: woqimingweipeng at gmail.com (Xie Yunpeng)
Date: Thu, 7 Mar 2013 16:14:22 +0800
Subject: [rabbitmq-discuss] rabbitmq cpu usage can not be more than 700%
Message-ID: <CAAjbVJDPKbZK5QD+C+95f=0aafP+iYQmP3xp26au1NPHeqsJdw@mail.gmail.com>

rabbitmq version: 3.0.2
cpu: 24 cores
memory: 64G
i deploy a rabbitmq service on the server above and do a stress testing ,
use 150 threads for send and 300 threads for recv on 150 queues on the
service, per queue with 1 send/ 2 recv.
the cpu useage is always below 700%, no matter i increase queues and
threads or not.

how to use more than 7 cores in rabbitmq?

i find smp is set to 24:24
[rabbitmq]$ erl
Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:24:24]
[async-threads:0] [hipe] [kernel-poll:false]

Eshell V5.9.3.1  (abort with ^G)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/babade54/attachment.htm>

From napylov at mail.ru  Thu Mar  7 10:10:22 2013
From: napylov at mail.ru (AlexanderN)
Date: Thu, 7 Mar 2013 02:10:22 -0800 (PST)
Subject: [rabbitmq-discuss] Plugin rabbitmq-auth-backend-http receiving
 "allow *" from web-server, but authorization is not successful.
Message-ID: <1362651022855-25308.post@n5.nabble.com>

Hello.

rabbitmq-auth-backend-http receiving "allow *" from web-server, but
authorization is not successful.
 In log written:
 closing AMQP connection (127.0.0.1:34028 -> 127.0.0.1:5672):
 {handshake_error,opening,0,
 {amqp_error,access_refused,
 "access to vhost 'vhost_name' refused for user 'user_name'",
 'connection.open'}}

Plugin sending HTTP-request to user_path URI only.

I have this problem in Debian 7 only, but in Debian 6 all OK.

Server configuration:
Used "wheezy" x86_64 distribution of Debian GNU/Linux operation system. It's
testing distribution.
On server with current stable distrubution "squeeze" I have not the problem.

/etc/rabbitmq/enabled-plugins file content
[rabbitmq_auth_backend_http,rabbitmq_management].

/etc/rabbitmq/rabbitmq.config file content
[
 {rabbit, [{auth_backends, [rabbit_auth_backend_http]}]},
 {rabbitmq_auth_backend_http,
 [{user_path, "http://127.0.0.1:84/auth/user.php"},
 {vhost_path, "http://127.0.0.1:84/auth/vhost.php"},
 {resource_path, "http://127.0.0.1:84/auth/resource.php"}]}
].


Used web-server nginx 1.2.1. Configuration of site:

server {
    listen   127.0.0.1:84; ## listen for ipv4
    server_name  localhost;
    access_log  /home/rabbitmq/log/access.log;
    error_log   /home/rabbitmq/log/error.log;
    charset off;
    chunked_transfer_encoding off;
    location ~ \.php$ {
    root   /home/rabbitmq/htdocs;
    include /etc/nginx/fastcgi_params;
    fastcgi_intercept_errors off;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_pass php_unix;
    }
    location / {
    root   /home/rabbitmq/htdocs;
    index  index.php;
    }
}

In nginx log written:
127.0.0.1 - - [07/Mar/2013:12:07:35 +0400] "GET
/auth/user.php?username=user&password=pass HTTP/1.0" 200 7 "-" "-"

HTTP-response:
HTTP/1.1 200 OK
Server: nginx
Date: Thu, 07 Mar 2013 08:07:35 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/5.4.4-13

allow *



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Plugin-rabbitmq-auth-backend-http-receiving-allow-from-web-server-but-authorization-is-not-successfu-tp25308.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu Mar  7 12:03:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Mar 2013 12:03:28 +0000
Subject: [rabbitmq-discuss] rabbitmq cpu usage can not be more than 700%
In-Reply-To: <CAAjbVJDPKbZK5QD+C+95f=0aafP+iYQmP3xp26au1NPHeqsJdw@mail.gmail.com>
References: <CAAjbVJDPKbZK5QD+C+95f=0aafP+iYQmP3xp26au1NPHeqsJdw@mail.gmail.com>
Message-ID: <51388210.20505@rabbitmq.com>

Hi.

First of all, the biggest machine I have available to test with is 8 
cores, so 24 cores is somewhat unknown territory for me. Is this a NUMA 
machine? However, with that in mind I did some quick tests.

I was able to get 797% CPU usage with only 4 producer / queue / consumer 
sets. So it is possible to get past 700%. Interestingly, I got stuck at 
~700% when using HiPE - do you have HiPE switched on?

If not, there are a few things to test:

* Just to check - you didn't say how many connections you used. If you 
are running all those send / receive threads through one or two 
connections you may find that is limiting you.

* Check you really are CPU-bound - if you are publishing persistent 
messages or your queues are becoming large you are probably disk-bound. 
If you are publishing large messages you may be network-bound. One way 
to test this is with the run queue length, exposed in "rabbitmqctl 
status" or "Overview" > <node name> > "Advanced" in the management 
plugin. If this is non-zero you are CPU-bound.

* You may wish to experiment with adding some the scheduler flags 
documented at http://www.erlang.org/doc/man/erl.html to 
RABBITMQ_SERVER_ERL_ARGS, although this feels rather magical.

* As a last resort, it is possible to run a cluster on a single machine; 
this might hwelp you use more cores. See 
http://www.rabbitmq.com/clustering.html#single-machine

Cheers, Simon

On 07/03/13 08:14, Xie Yunpeng wrote:
> rabbitmq version: 3.0.2
> cpu: 24 cores
> memory: 64G
> i deploy a rabbitmq service on the server above and do a stress testing
> , use 150 threads for send and 300 threads for recv on 150 queues on the
> service, per queue with 1 send/ 2 recv.
> the cpu useage is always below 700%, no matter i increase queues and
> threads or not.
>
> how to use more than 7 cores in rabbitmq?
>
> i find smp is set to 24:24
> [rabbitmq]$ erl
> Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:24:24]
> [async-threads:0] [hipe] [kernel-poll:false]
>
> Eshell V5.9.3.1  (abort with ^G)
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From ask at rabbitmq.com  Thu Mar  7 13:25:15 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 7 Mar 2013 13:25:15 +0000
Subject: [rabbitmq-discuss] Difference between async connection using
	ioloop and blocking connection for rabbitmq
In-Reply-To: <AE61A943249BE64497342A426F24C2985FB1A2@SJC4EXDAG01-01.corp.service-now.com>
References: <AE61A943249BE64497342A426F24C2985FB1A2@SJC4EXDAG01-01.corp.service-now.com>
Message-ID: <6152B0E1-6349-46AC-BC9C-96DF8A606A22@rabbitmq.com>


On Mar 5, 2013, at 11:14 PM, Ameya Patil <Ameya.Patil at servicenow.com> wrote:

> Hi, 
> 
> Ioloops in async connection is exhibiting blocking semantics. I am trying to understand how this is different than a blocking connection
> 
> The documentation (https://pika.readthedocs.org/en/latest/connecting.html#io-and-event-looping ) states:
> These IOLoops are blocking methods which loop and listen for events.
> 
> In a experiment I conducted, I publish 2 messages, each 5 times: message 'test' published by AsyncPublisher and 'test1' by AsyncPublisher1.py.  
> 
> In the consumer I have an if block stating:
> If body == test: 
>    Time.sleep(10)
> 
> I run AsyncPublisher.py first, and after it has sent 5 test messages I run AsyncPublisher1.py.
> 
> The output I expect is :
> Test
> test1
> test1
> test1
> tes1
> Test
> Test
> Test
> Test
> 

Why do you expect this particular order?

> Instead I get:
> Test
> Tes
> Test
> Test
> Test
> test1
> test1
> test1
> test1
> test1
> 
> This is the same as if I would run the sender and receiver using a blocking connection.
> My question is how does a blocking connection different than ioloop.start ? Does it differ only on multithreading ? 
> 

It uses Async I/O, not multithreading, so a single process would not run anything in parallel, but it enables you to do multiple I/O operations at the same time by scheduling
the callbacks for when the operation can be completed.  See http://en.wikipedia.org/wiki/Asynchronous_I/O

From ioannis.foukarakis at gmail.com  Thu Mar  7 13:28:26 2013
From: ioannis.foukarakis at gmail.com (Ioannis Foukarakis)
Date: Thu, 7 Mar 2013 15:28:26 +0200
Subject: [rabbitmq-discuss] Recovery after heartbeat error
Message-ID: <CAM=53QwLN7AKk0vQLkjf7Cj=nvgs-vTovgzEffd84OiGJZb2uw@mail.gmail.com>

Hi,

I am trying to setup a simple application using Java client (v3.0.2), where
a single consumer receives messages from a queue and recovers on failure. I
added a heartbeat to my connection, as the network between the client and
RabbitMQ is not very reliable. I also implemented ShutdownListener and
attached the listener to my connection and channel. When I receive a
shutdown signal, I close the connection and the channel, and then attempt
to create a new connection and channel. If I fail, I retry after a few
seconds. I tested this logic by starting the client and shutting down
RabbitMQ, and this works perfectly. However, if I disconnect from the
network, channel.close() blocks. I've tried the following two cases:

   - Attempt calling channel.close() before the shutdown signal is passed
   to shutdownCompleted(...).
   - Attempt calling channel.close() after the shutdown signal is passed to
   shutdownCompleted(...).

In both cases channel.close() blocks. In the second one, I can add a flag
and avoid calling channel.close(), but in the first case I'm not able to
detect if there's a network problem or not.

Should I avoid trying to close channels? Is there a better solution for
handling network errors?

Thank you in advance for your time!

Kind regards,

Yiannis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/de438838/attachment.htm>

From tim at rabbitmq.com  Thu Mar  7 13:58:19 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 7 Mar 2013 13:58:19 +0000
Subject: [rabbitmq-discuss] Recovery after heartbeat error
In-Reply-To: <CAM=53QwLN7AKk0vQLkjf7Cj=nvgs-vTovgzEffd84OiGJZb2uw@mail.gmail.com>
References: <CAM=53QwLN7AKk0vQLkjf7Cj=nvgs-vTovgzEffd84OiGJZb2uw@mail.gmail.com>
Message-ID: <E42EAC7E-CB38-4245-AC18-F0EED4974088@rabbitmq.com>

On 7 Mar 2013, at 13:28, Ioannis Foukarakis wrote:
> [snip]
>  However, if I disconnect from the network, channel.close() blocks.

Yes, this is *normal* behaviour for a networked application... When you pull the network cable (or take whatever equivalent action disconnects from the network) then the AMQP channel.close protocol has a slight problem. The client sends 'close' and waits for the server to respond with 'close-ok' - but if the server is gone, what then!? Usually the client then blocks until the operating system 'notices' that the peer socket is gone (because transmission retry limits have been exhausted, tcp keep-alives are enabled, etc). There are various conditions that determine this 'delay' and it can take up to 30 mins with some operating systems' default TCP configuration, before the application is notified with ETIMEDOUT. This exception occurs on the connection object, i.e., when the network failure is finally noticed it forces the connection to close. The channels will also be closed by the client (when it notices that the connection has been terminated).

> Should I avoid trying to close channels? Is there a better solution for handling network errors?
> 

Yes, if you knew for certain there has been a network failure, then you should skip closing channels. The shutdown signal means that the 'other end' has closed so calling a synchronous AMQP method like channel.close after than is always going to block.

If you have a very unreliable network then just rely on the heartbeats to terminate the connection (and therefore the channels) in a timely fashion. If you *need* to close channels more often than that, then you might need to put some kind of timeout around the channel.close() call.

Cheers,
Tim

From tim at rabbitmq.com  Thu Mar  7 13:59:32 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 7 Mar 2013 13:59:32 +0000
Subject: [rabbitmq-discuss] Recovery after heartbeat error
In-Reply-To: <E42EAC7E-CB38-4245-AC18-F0EED4974088@rabbitmq.com>
References: <CAM=53QwLN7AKk0vQLkjf7Cj=nvgs-vTovgzEffd84OiGJZb2uw@mail.gmail.com>
	<E42EAC7E-CB38-4245-AC18-F0EED4974088@rabbitmq.com>
Message-ID: <8F88806A-D3FC-4677-ABD6-90795AAED9CA@rabbitmq.com>

And .... looking at the title of the post (I got lost in the details and forgot) ....

If a heartbeat error/timeout has occurred, then definitely just throw away all the channels for the connection - they're done and attempting to close them is the wrong thing to do in that situation.

Cheers,
Tim 

On 7 Mar 2013, at 13:58, Tim Watson wrote:

> On 7 Mar 2013, at 13:28, Ioannis Foukarakis wrote:
>> [snip]
>> However, if I disconnect from the network, channel.close() blocks.
> 
> Yes, this is *normal* behaviour for a networked application... When you pull the network cable (or take whatever equivalent action disconnects from the network) then the AMQP channel.close protocol has a slight problem. The client sends 'close' and waits for the server to respond with 'close-ok' - but if the server is gone, what then!? Usually the client then blocks until the operating system 'notices' that the peer socket is gone (because transmission retry limits have been exhausted, tcp keep-alives are enabled, etc). There are various conditions that determine this 'delay' and it can take up to 30 mins with some operating systems' default TCP configuration, before the application is notified with ETIMEDOUT. This exception occurs on the connection object, i.e., when the network failure is finally noticed it forces the connection to close. The channels will also be closed by the client (when it notices that the connection has been terminated).
> 
>> Should I avoid trying to close channels? Is there a better solution for handling network errors?
>> 
> 
> Yes, if you knew for certain there has been a network failure, then you should skip closing channels. The shutdown signal means that the 'other end' has closed so calling a synchronous AMQP method like channel.close after than is always going to block.
> 
> If you have a very unreliable network then just rely on the heartbeats to terminate the connection (and therefore the channels) in a timely fashion. If you *need* to close channels more often than that, then you might need to put some kind of timeout around the channel.close() call.
> 
> Cheers,
> Tim


From ioannis.foukarakis at gmail.com  Thu Mar  7 14:15:32 2013
From: ioannis.foukarakis at gmail.com (Ioannis Foukarakis)
Date: Thu, 7 Mar 2013 16:15:32 +0200
Subject: [rabbitmq-discuss] Recovery after heartbeat error
In-Reply-To: <8F88806A-D3FC-4677-ABD6-90795AAED9CA@rabbitmq.com>
References: <CAM=53QwLN7AKk0vQLkjf7Cj=nvgs-vTovgzEffd84OiGJZb2uw@mail.gmail.com>
	<E42EAC7E-CB38-4245-AC18-F0EED4974088@rabbitmq.com>
	<8F88806A-D3FC-4677-ABD6-90795AAED9CA@rabbitmq.com>
Message-ID: <CAM=53QzGxsoVgR0xtrhfY_r6CpkRjJ6TRnsTQpYtfpoeg+PMaw@mail.gmail.com>

Thank you for the prompt reply Tim!

Yes, I expected that the channel would wait for a proper close and then
shut down. I was concerned whether that might leave "garbage" in memory,
but if I can just throw away all connections and channels it won't be a
problem.

Again, thank you very much!

On Thu, Mar 7, 2013 at 3:59 PM, Tim Watson <tim at rabbitmq.com> wrote:

> And .... looking at the title of the post (I got lost in the details and
> forgot) ....
>
> If a heartbeat error/timeout has occurred, then definitely just throw away
> all the channels for the connection - they're done and attempting to close
> them is the wrong thing to do in that situation.
>
> Cheers,
> Tim
>
> On 7 Mar 2013, at 13:58, Tim Watson wrote:
>
> > On 7 Mar 2013, at 13:28, Ioannis Foukarakis wrote:
> >> [snip]
> >> However, if I disconnect from the network, channel.close() blocks.
> >
> > Yes, this is *normal* behaviour for a networked application... When you
> pull the network cable (or take whatever equivalent action disconnects from
> the network) then the AMQP channel.close protocol has a slight problem. The
> client sends 'close' and waits for the server to respond with 'close-ok' -
> but if the server is gone, what then!? Usually the client then blocks until
> the operating system 'notices' that the peer socket is gone (because
> transmission retry limits have been exhausted, tcp keep-alives are enabled,
> etc). There are various conditions that determine this 'delay' and it can
> take up to 30 mins with some operating systems' default TCP configuration,
> before the application is notified with ETIMEDOUT. This exception occurs on
> the connection object, i.e., when the network failure is finally noticed it
> forces the connection to close. The channels will also be closed by the
> client (when it notices that the connection has been terminated).
> >
> >> Should I avoid trying to close channels? Is there a better solution for
> handling network errors?
> >>
> >
> > Yes, if you knew for certain there has been a network failure, then you
> should skip closing channels. The shutdown signal means that the 'other
> end' has closed so calling a synchronous AMQP method like channel.close
> after than is always going to block.
> >
> > If you have a very unreliable network then just rely on the heartbeats
> to terminate the connection (and therefore the channels) in a timely
> fashion. If you *need* to close channels more often than that, then you
> might need to put some kind of timeout around the channel.close() call.
> >
> > Cheers,
> > Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/fd84c0af/attachment.htm>

From gmr at meetme.com  Thu Mar  7 14:55:04 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Thu, 7 Mar 2013 09:55:04 -0500
Subject: [rabbitmq-discuss] Difference between async connection using
 ioloop and blocking connection for rabbitmq
In-Reply-To: <6152B0E1-6349-46AC-BC9C-96DF8A606A22@rabbitmq.com>
References: <AE61A943249BE64497342A426F24C2985FB1A2@SJC4EXDAG01-01.corp.service-now.com>
	<6152B0E1-6349-46AC-BC9C-96DF8A606A22@rabbitmq.com>
Message-ID: <8A65CF8681F942BCA31828CD8733DCE9@meetme.com>

You should not use time.sleep, in pika, use connection.sleep():

https://pika.readthedocs.org/en/0.9.9/adapters.html#module-pika.adapters.blocking_connection

That will likely change what you're seeing. You're freezing the whole process when you use time.sleep while connection.sleep will block your python app for that time while processing communication with RabbitMQ in the background. 


On Thursday, March 7, 2013 at 8:25 AM, Ask Solem wrote:

> 
> On Mar 5, 2013, at 11:14 PM, Ameya Patil <Ameya.Patil at servicenow.com (mailto:Ameya.Patil at servicenow.com)> wrote:
> 
> > Hi, 
> > 
> > Ioloops in async connection is exhibiting blocking semantics. I am trying to understand how this is different than a blocking connection
> > 
> > The documentation (https://pika.readthedocs.org/en/latest/connecting.html#io-and-event-looping ) states:
> > These IOLoops are blocking methods which loop and listen for events.
> > 
> > In a experiment I conducted, I publish 2 messages, each 5 times: message 'test' published by AsyncPublisher and 'test1' by AsyncPublisher1.py. 
> > 
> > In the consumer I have an if block stating:
> > If body == test: 
> > Time.sleep(10)
> > 
> > I run AsyncPublisher.py first, and after it has sent 5 test messages I run AsyncPublisher1.py.
> > 
> > The output I expect is :
> > Test
> > test1
> > test1
> > test1
> > tes1
> > Test
> > Test
> > Test
> > Test
> > 
> 
> 
> Why do you expect this particular order?
> 
> > Instead I get:
> > Test
> > Tes
> > Test
> > Test
> > Test
> > test1
> > test1
> > test1
> > test1
> > test1
> > 
> > This is the same as if I would run the sender and receiver using a blocking connection.
> > My question is how does a blocking connection different than ioloop.start ? Does it differ only on multithreading ? 
> > 
> 
> 
> It uses Async I/O, not multithreading, so a single process would not run anything in parallel, but it enables you to do multiple I/O operations at the same time by scheduling
> the callbacks for when the operation can be completed. See http://en.wikipedia.org/wiki/Asynchronous_I/O
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/12b0ee0d/attachment.htm>

From simon at rabbitmq.com  Thu Mar  7 15:20:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Mar 2013 15:20:18 +0000
Subject: [rabbitmq-discuss] Plugin rabbitmq-auth-backend-http receiving
 "allow *" from web-server, but authorization is not successful.
In-Reply-To: <1362651022855-25308.post@n5.nabble.com>
References: <1362651022855-25308.post@n5.nabble.com>
Message-ID: <5138B032.3090009@rabbitmq.com>

My suspicion is that your web server is not giving the result you think 
it is. What does 
http://127.0.0.1:84/auth/vhost.php?username=user&vhost=%2f return?

Really rabbitmq-auth-backend-http needs a debug mode like 
rabbitmq-auth-backend-ldap does. I will probably add one soon, now that 
you've reminded me it is necessary. In the mean time, you could 
uncomment line 92 of rabbit_auth_backend_http.erl to get it to display 
(on standard output) the HTTP requests it is making.

Cheers, Simon

On 07/03/13 10:10, AlexanderN wrote:
> Hello.
>
> rabbitmq-auth-backend-http receiving "allow *" from web-server, but
> authorization is not successful.
>   In log written:
>   closing AMQP connection (127.0.0.1:34028 -> 127.0.0.1:5672):
>   {handshake_error,opening,0,
>   {amqp_error,access_refused,
>   "access to vhost 'vhost_name' refused for user 'user_name'",
>   'connection.open'}}
>
> Plugin sending HTTP-request to user_path URI only.
>
> I have this problem in Debian 7 only, but in Debian 6 all OK.
>
> Server configuration:
> Used "wheezy" x86_64 distribution of Debian GNU/Linux operation system. It's
> testing distribution.
> On server with current stable distrubution "squeeze" I have not the problem.
>
> /etc/rabbitmq/enabled-plugins file content
> [rabbitmq_auth_backend_http,rabbitmq_management].
>
> /etc/rabbitmq/rabbitmq.config file content
> [
>   {rabbit, [{auth_backends, [rabbit_auth_backend_http]}]},
>   {rabbitmq_auth_backend_http,
>   [{user_path, "http://127.0.0.1:84/auth/user.php"},
>   {vhost_path, "http://127.0.0.1:84/auth/vhost.php"},
>   {resource_path, "http://127.0.0.1:84/auth/resource.php"}]}
> ].
>
>
> Used web-server nginx 1.2.1. Configuration of site:
>
> server {
>      listen   127.0.0.1:84; ## listen for ipv4
>      server_name  localhost;
>      access_log  /home/rabbitmq/log/access.log;
>      error_log   /home/rabbitmq/log/error.log;
>      charset off;
>      chunked_transfer_encoding off;
>      location ~ \.php$ {
>      root   /home/rabbitmq/htdocs;
>      include /etc/nginx/fastcgi_params;
>      fastcgi_intercept_errors off;
>      fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
>      fastcgi_pass php_unix;
>      }
>      location / {
>      root   /home/rabbitmq/htdocs;
>      index  index.php;
>      }
> }
>
> In nginx log written:
> 127.0.0.1 - - [07/Mar/2013:12:07:35 +0400] "GET
> /auth/user.php?username=user&password=pass HTTP/1.0" 200 7 "-" "-"
>
> HTTP-response:
> HTTP/1.1 200 OK
> Server: nginx
> Date: Thu, 07 Mar 2013 08:07:35 GMT
> Content-Type: text/html; charset=UTF-8
> Connection: close
> X-Powered-By: PHP/5.4.4-13
>
> allow *
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Plugin-rabbitmq-auth-backend-http-receiving-allow-from-web-server-but-authorization-is-not-successfu-tp25308.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From Scott.Chapman at servicenow.com  Thu Mar  7 18:16:10 2013
From: Scott.Chapman at servicenow.com (Scott Chapman)
Date: Thu, 7 Mar 2013 18:16:10 +0000
Subject: [rabbitmq-discuss] Turning off prefetch in the
	asynchronous_consumer_example
Message-ID: <CC28B25FDAC5D943B606F46369686C2A243622A6@SJC4EXDAG01-02.corp.service-now.com>

Code from here:
https://github.com/pika/pika/blob/master/docs/examples/asynchronous_consumer_example.rst

I've tried putting the qos call here:

    def on_channel_open(self, channel):
        """This method is invoked by pika when the channel has been opened.
        The channel object is passed in so we can make use of it.

        Since the channel is now open, we'll declare the exchange to use.

        :param pika.channel.Channel channel: The channel object

        """
        LOGGER.debug('Channel opened')
        channel.basic_qos(prefetch_count=1)
        self._channel = channel
        self.add_on_channel_close_callback()
        self.setup_exchange(self.EXCHANGE)

It did not turn off prefetching.  Messages still show up in RabbitMQ as Unacknowledged rather than Ready when I send one and send a 2nd before the 1st is done processing.

What am I missing?

I want to turn off prefetching.
I can't figure out how to turn it off on the Connection. That would be preferable, or turn it off globally.

Any clues GREATLY appreciated.

Thanks,
Scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/0841a31b/attachment.htm>

From Eugene.Alterman at infogroup.com  Thu Mar  7 19:39:42 2013
From: Eugene.Alterman at infogroup.com (Alterman, Eugene)
Date: Thu, 7 Mar 2013 19:39:42 +0000
Subject: [rabbitmq-discuss] Client implementation in C++
Message-ID: <480C257864F5C14CB8CFC2824CF62CF1500DBE@clcemlmbp01.intra.infousa.com>

I started writing a rabbitmq C++ client library. It is of course layered on top of rabbitmq-c and utilizes boost meta state machine to process incoming protocol frames. Processing of each incoming frame returns an instance of a boost variant. The static visitor is applied to each result. When a message is delivered, the instance of the visitor will store all the information.

Is there any interest in a library based on such an approach?

A very preliminary sources with a consumer example is here: https://github.com/eugene-a/amqcpp.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/e96b4a65/attachment.htm>

From briankcook at gmail.com  Thu Mar  7 21:34:51 2013
From: briankcook at gmail.com (Brian Cook)
Date: Thu, 7 Mar 2013 13:34:51 -0800 (PST)
Subject: [rabbitmq-discuss] centos 6.3 rabbitmq install
Message-ID: <af48cfd3-f6c6-4ebd-bd80-de823a9c2dff@googlegroups.com>

I am having a time trying to install rabbitmq on centos 6.3 
I followed the instructions here
http://www.rabbitmq.com/install-rpm.html

When I start it I get 
[root at mx rabbitmq]# /sbin/service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
_err}
rabbitmq-server.

I check the startup_log and get this
Activating RabbitMQ plugins ...
0 plugins activated:

node with name "rabbit" already running on "mx"
diagnostics:
- nodes and their ports on mx: [{rabbit,39037}]
- current node: rabbitmqprelaunch3428 at mx
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: IPCqsVajl4UdR/jTgmyvfA==
~
~

So I found something post in the forums that the process is running. Not 
matter how many time I do it is not running. 

I check it with 
[root at mx rabbitmq]# ps aux|grep rabbit
rabbitmq  3152  0.0  0.0  10824   424 ?        S    13:33   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
root      3308  0.0  0.0 103236   860 pts/0    S+   13:34   0:00 grep rabbit
[root at mx rabbitmq]# skill -p 3152
[root at mx rabbitmq]# ps aux|grep rabbit
root      3311  0.0  0.0 103236   860 pts/0    S+   13:35   0:00 grep rabbit
[root at mx rabbitmq]# /sbin/service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
_err}
rabbitmq-server.
[root at mx rabbitmq]# ps aux|grep rabbit
rabbitmq  3335  0.0  0.0  10824   424 ?        S    13:35   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
root      3388  0.0  0.0 103236   856 pts/0    S+   13:35   0:00 grep rabbit
[root at mx rabbitmq]# /sbin/service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
_err}
rabbitmq-server.


So I try to pass commands and I get nodedown.

Not sure what to do next. 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/1c32eac1/attachment.htm>

From jeremy at fluxlabs.net  Thu Mar  7 21:44:38 2013
From: jeremy at fluxlabs.net (Jeremy McSpadden)
Date: Thu, 7 Mar 2013 21:44:38 +0000
Subject: [rabbitmq-discuss] centos 6.3 rabbitmq install
In-Reply-To: <af48cfd3-f6c6-4ebd-bd80-de823a9c2dff@googlegroups.com>
References: <af48cfd3-f6c6-4ebd-bd80-de823a9c2dff@googlegroups.com>
Message-ID: <8C482214-89AB-4D57-87F7-402FCC3DE317@fluxlabs.net>

You need to kill the running daemon.

--
Jeremy McSpadden
Flux Labs, Inc | http://www.fluxlabs.net<http://www.fluxlabs.net/> | Endless Solutions
Office : 850-250-5590x101<tel:850-250-5590;101> | Cell : 850-890-2543<tel:850-890-2543> | Fax : 850-254-2955<tel:850-254-2955>

On Mar 7, 2013, at 3:42 PM, "Brian Cook" <briankcook at gmail.com<mailto:briankcook at gmail.com>> wrote:

I am having a time trying to install rabbitmq on centos 6.3
I followed the instructions here
http://www.rabbitmq.com/install-rpm.html

When I start it I get
[root at mx rabbitmq]# /sbin/service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
rabbitmq-server.

I check the startup_log and get this
Activating RabbitMQ plugins ...
0 plugins activated:

node with name "rabbit" already running on "mx"
diagnostics:
- nodes and their ports on mx: [{rabbit,39037}]
- current node: rabbitmqprelaunch3428 at mx
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: IPCqsVajl4UdR/jTgmyvfA==
~
~

So I found something post in the forums that the process is running. Not matter how many time I do it is not running.

I check it with
[root at mx rabbitmq]# ps aux|grep rabbit
rabbitmq  3152  0.0  0.0  10824   424 ?        S    13:33   0:00 /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
root      3308  0.0  0.0 103236   860 pts/0    S+   13:34   0:00 grep rabbit
[root at mx rabbitmq]# skill -p 3152
[root at mx rabbitmq]# ps aux|grep rabbit
root      3311  0.0  0.0 103236   860 pts/0    S+   13:35   0:00 grep rabbit
[root at mx rabbitmq]# /sbin/service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
rabbitmq-server.
[root at mx rabbitmq]# ps aux|grep rabbit
rabbitmq  3335  0.0  0.0  10824   424 ?        S    13:35   0:00 /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
root      3388  0.0  0.0 103236   856 pts/0    S+   13:35   0:00 grep rabbit
[root at mx rabbitmq]# /sbin/service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
rabbitmq-server.


So I try to pass commands and I get nodedown.

Not sure what to do next.


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/e11b2458/attachment.htm>

From jerryk at rbcon.com  Thu Mar  7 21:46:22 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 7 Mar 2013 13:46:22 -0800
Subject: [rabbitmq-discuss] centos 6.3 rabbitmq install
In-Reply-To: <8C482214-89AB-4D57-87F7-402FCC3DE317@fluxlabs.net>
References: <af48cfd3-f6c6-4ebd-bd80-de823a9c2dff@googlegroups.com>
	<8C482214-89AB-4D57-87F7-402FCC3DE317@fluxlabs.net>
Message-ID: <CAE0Sz=x+yVEM0c6eUDvzUe4RgOuKnJsOFcUSnCht0+c7XAEqEQ@mail.gmail.com>

Also, be mindful of who that other node is running as... sometimes this
happens if a Rabbit gets started in a non-standard way...

On Thu, Mar 7, 2013 at 1:44 PM, Jeremy McSpadden <jeremy at fluxlabs.net>wrote:

>  You need to kill the running daemon.
>
> --
> Jeremy McSpadden
> Flux Labs, Inc | http://www.fluxlabs.net | Endless Solutions
> Office : 850-250-5590x101 <850-250-5590;101> | Cell : 850-890-2543 | Fax
> : 850-254-2955
>
> On Mar 7, 2013, at 3:42 PM, "Brian Cook" <briankcook at gmail.com> wrote:
>
>  I am having a time trying to install rabbitmq on centos 6.3
> I followed the instructions here
> http://www.rabbitmq.com/install-rpm.html
>
>  When I start it I get
>  [root at mx rabbitmq]# /sbin/service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
> _err}
> rabbitmq-server.
>
>  I check the startup_log and get this
>  Activating RabbitMQ plugins ...
> 0 plugins activated:
>
>  node with name "rabbit" already running on "mx"
> diagnostics:
> - nodes and their ports on mx: [{rabbit,39037}]
> - current node: rabbitmqprelaunch3428 at mx
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: IPCqsVajl4UdR/jTgmyvfA==
> ~
> ~
>
>  So I found something post in the forums that the process is running. Not
> matter how many time I do it is not running.
>
>  I check it with
>  [root at mx rabbitmq]# ps aux|grep rabbit
> rabbitmq  3152  0.0  0.0  10824   424 ?        S    13:33   0:00
> /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
> root      3308  0.0  0.0 103236   860 pts/0    S+   13:34   0:00 grep
> rabbit
> [root at mx rabbitmq]# skill -p 3152
> [root at mx rabbitmq]# ps aux|grep rabbit
> root      3311  0.0  0.0 103236   860 pts/0    S+   13:35   0:00 grep
> rabbit
> [root at mx rabbitmq]# /sbin/service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
> _err}
> rabbitmq-server.
> [root at mx rabbitmq]# ps aux|grep rabbit
> rabbitmq  3335  0.0  0.0  10824   424 ?        S    13:35   0:00
> /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
> root      3388  0.0  0.0 103236   856 pts/0    S+   13:35   0:00 grep
> rabbit
> [root at mx rabbitmq]# /sbin/service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
> _err}
> rabbitmq-server.
>
>
>  So I try to pass commands and I get nodedown.
>
>  Not sure what to do next.
>
>
>   _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/2ea8da63/attachment.htm>

From triton.genocide at gmail.com  Thu Mar  7 22:09:00 2013
From: triton.genocide at gmail.com (mikel)
Date: Thu, 7 Mar 2013 22:09:00 +0000
Subject: [rabbitmq-discuss] Is heartbeat option working in C-client?
In-Reply-To: <CAAt2poJqOb3UfOxDHWc_qEUUh71h=yMy+TuKwh=XouEuvLGWkw@mail.gmail.com>
References: <1354437874.6889.YahooMailNeo@web161201.mail.bf1.yahoo.com>
	<CAAt2poLz0jqwHsV8H=ORgOHse7P=Hc8BLq+u34dVfMpWCUTJYg@mail.gmail.com>
	<50BBAA53.1030809@rabbitmq.com>
	<CAAt2poJqOb3UfOxDHWc_qEUUh71h=yMy+TuKwh=XouEuvLGWkw@mail.gmail.com>
Message-ID: <CADXMcw1R5XTY1iAPCkHPNFT28-rvhKr3kUth_4Yt4eMFyEJ-wQ@mail.gmail.com>

Hello,

I'm very interested on knowing if Dawn finally resolved that issue related
with the heartbeat handle from rabbitmq-c driver. I think it's a important
issue. The hack I'm using is sending an automatic message to the broker
every x minutes from the rabbitmq-c client, but I would like to solve that
situation in a correct way.

Any kind of informatin would be really appreciate.

On Mon, Dec 3, 2012 at 2:42 PM, Alan Antonuk <alan.antonuk at gmail.com> wrote:

> Sorry I didn't read Dawn's email all the way through the first time I read
> it, so Matthais is correct:
>
> The library will not do any kind of automatic sending of heartbeats to the
> broker.
>
> The library should be able to be used in such a way that you could
> correctly implement heartbeats, though I have not seen it been done with
> rabbitmq-c.
>
> -Alan
>
>
> On Sun, Dec 2, 2012 at 2:21 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:
>
>> Alan,
>>
>>
>> On 02/12/12 19:04, Alan Antonuk wrote:
>>
>>> The rabbitmq-c client does not support AMQP heartbeats.
>>>
>>
>> In the sense that it is not automatically sending heartbeats in the
>> absence of other traffic, and is not automatically monitoring inbound
>> traffic/heartbeats? Sure.
>>
>> But if an app sends/receives heartbeats explicitly, as Dawn appears to be
>> doing, that should work, shouldn't it?
>>
>> Matthias.
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/d5217754/attachment.htm>

From nishanth at urbanmapping.com  Thu Mar  7 22:13:42 2013
From: nishanth at urbanmapping.com (Nishanth Babu Achuthan)
Date: Thu, 7 Mar 2013 14:13:42 -0800
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
Message-ID: <CACkkimmifeZdqEUJN20qgorSL8JErrWAW9Fsfu8esP_eGXgLTA@mail.gmail.com>

Hi,

I have workers running in EC2. The message processing time for every worker
is very high like several hours.

While they process the message, rabbitmq drops their connection silently as
it considers them to have been idle for a long time.

When the workers try to send ACK after message processing, they fail and
crash.

I tried to set up heartbeat interval in worker connections but it didn't
resolve the issue. It keeps timing out. I am not able to understand how
this heartbeat work or how to debug to find out why its timing out.

Will having tcp_connection keepalive as yes in  rabbitmq.config help?


Thanks
Nishanth
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/31031593/attachment.htm>

From nishanth at urbanmapping.com  Thu Mar  7 22:59:03 2013
From: nishanth at urbanmapping.com (Nishanth)
Date: Thu, 7 Mar 2013 14:59:03 -0800 (PST)
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
Message-ID: <63db12af-2bc2-4f7a-a413-5303201822f5@googlegroups.com>

Hi,

I have workers running in EC2. The message processing time for every worker 
is very high like several hours.

While they process the message, rabbitmq drops their connection silently as 
it considers them to have been idle for a long time.

When the workers try to send ACK after message processing, they fail and 
crash.

I tried to set up heartbeat interval in worker connections but it didn't 
resolve the issue. It keeps timing out. I am not able to understand how 
this heartbeat work or how to debug to find out why its timing out. 


Thanks
Nishanth
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/91e7cca7/attachment.htm>

From nishanth at urbanmapping.com  Thu Mar  7 23:25:42 2013
From: nishanth at urbanmapping.com (Nishanth)
Date: Thu, 7 Mar 2013 15:25:42 -0800 (PST)
Subject: [rabbitmq-discuss] default timeout on server
In-Reply-To: <4F1D79D1.2020004@rabbitmq.com>
References: <CAG2rwuOzJRT6=BfzTHLCsV9Qc17SXxTG8HwVH7rxH1oitJAGnw@mail.gmail.com>
	<4F1D79D1.2020004@rabbitmq.com>
Message-ID: <18cb523a-cbb3-4ffc-bcb6-c7238691f7e2@googlegroups.com>

Hi Simon,

Would you please help me understand how to turn on heartbeats?

Should I turn it on in the client? My code looks like below.

But, after 60 seconds, rabbitmq closes the connection saying heartbeat 
timeout. 

parameters      =       
pika.ConnectionParameters(host=RABBITMQ_HOSTNAME,heartbeat_interval=60,credentials=pika.PlainCredentials(RABBITMQ_USERNAME,RABBITMQ_PASSWORD))
connection      =       pika.SelectConnection(parameters,on_connected)

Thanks
Nishanth
On Monday, January 23, 2012 7:16:33 AM UTC-8, Simon MacMullen wrote:
>
> On 23/01/12 15:13, S Ahmed wrote:
> > Does rabbit server have a default time-out for connections that has to
> > be overridden?
>
> No.
>
> > i.e. Our clients are opening connections for x days (persistant
> > connections into rabbit), and connections are timing out on our client
> > applications within a few minutes.
>
> Whenever this question has come up in the past it turns out that some 
> piece of networking hardware is causing the problem.
>
> You may find that turning on AMQP heartbeats in your clients creates 
> enough network traffic to fool your infrastructure...
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/4435bd8a/attachment.htm>

From nishanth at urbanmapping.com  Thu Mar  7 23:25:42 2013
From: nishanth at urbanmapping.com (Nishanth)
Date: Thu, 7 Mar 2013 15:25:42 -0800 (PST)
Subject: [rabbitmq-discuss] default timeout on server
In-Reply-To: <4F1D79D1.2020004@rabbitmq.com>
References: <CAG2rwuOzJRT6=BfzTHLCsV9Qc17SXxTG8HwVH7rxH1oitJAGnw@mail.gmail.com>
	<4F1D79D1.2020004@rabbitmq.com>
Message-ID: <18cb523a-cbb3-4ffc-bcb6-c7238691f7e2@googlegroups.com>

Hi Simon,

Would you please help me understand how to turn on heartbeats?

Should I turn it on in the client? My code looks like below.

But, after 60 seconds, rabbitmq closes the connection saying heartbeat 
timeout. 

parameters      =       
pika.ConnectionParameters(host=RABBITMQ_HOSTNAME,heartbeat_interval=60,credentials=pika.PlainCredentials(RABBITMQ_USERNAME,RABBITMQ_PASSWORD))
connection      =       pika.SelectConnection(parameters,on_connected)

Thanks
Nishanth
On Monday, January 23, 2012 7:16:33 AM UTC-8, Simon MacMullen wrote:
>
> On 23/01/12 15:13, S Ahmed wrote:
> > Does rabbit server have a default time-out for connections that has to
> > be overridden?
>
> No.
>
> > i.e. Our clients are opening connections for x days (persistant
> > connections into rabbit), and connections are timing out on our client
> > applications within a few minutes.
>
> Whenever this question has come up in the past it turns out that some 
> piece of networking hardware is causing the problem.
>
> You may find that turning on AMQP heartbeats in your clients creates 
> enough network traffic to fool your infrastructure...
>
> Cheers, Simon
>
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/4435bd8a/attachment-0001.htm>

From t.otoda.freemail at gmail.com  Thu Mar  7 23:31:58 2013
From: t.otoda.freemail at gmail.com (t.otoda.freemail at gmail.com)
Date: Thu, 7 Mar 2013 15:31:58 -0800 (PST)
Subject: [rabbitmq-discuss] How to configure RabbitMQ cluster to get out of
	the scale.
Message-ID: <ffd0377c-e660-4663-b638-bd83470aff1c@googlegroups.com>



Hi

I want to configure RabbitMQ cluster to get out of the scale.


1) What kind of point should I be careful about?

   the number of nodes of the cluster, 
   the number of nodes mirrored queues, 
   the number of queues which nodes of the cluster have, etc.

2) What kind of procedure should I let RabbitMQ get out of the scale in?

   I think RabbitMQ does not seem to get out of the scale only by having 
added a node.
   Because it doesn't do re-balance of queues between nodes automatically.
   
   If anyone know how to do re-balance of queues, please tell me.
   


 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/81a6e4ef/attachment.htm>

From steveolivier22 at gmail.com  Thu Mar  7 23:52:54 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Thu, 7 Mar 2013 15:52:54 -0800 (PST)
Subject: [rabbitmq-discuss] Per-queue/exchange ACL via LDAP plugin
Message-ID: <1362700374991-25328.post@n5.nabble.com>

Greetings- 

I was curious how to accomplish a per-queue/exchange ACL method while using
the LDAP auth plugin. I was looking to do something similar to the example
provided: 

http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#Access%20control
<http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#Access%20control>  

*rabbitmqctl set_permissions -p /myvhost tonyg "^tonyg-.*" ".*" ".*"*

/This command instructs the RabbitMQ broker to grant the user named tonyg
access to the virtual host called /myvhost, with configure permissions on
all resources whose names starts with "tonyg-", and write and read
permissions on all resources/

Better yet, I was looking to do a config that equated to, "Users in
Group-Test1 can consume from queues starting with the name Test1, but no one
else can". 

I have the general "User in Group-Test1 can consume from queues", but not
the rest. 

Thanks 

s



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Per-queue-exchange-ACL-via-LDAP-plugin-tp25328.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mcintoshj at gmail.com  Fri Mar  8 03:03:50 2013
From: mcintoshj at gmail.com (McIntosh Jason)
Date: Thu, 7 Mar 2013 21:03:50 -0600
Subject: [rabbitmq-discuss] Performance tests and a warning on HIPE
Message-ID: <B4A058E2-17EC-4669-B46E-286B9DDB8511@gmail.com>

So I was doing some load testing against several boxes to test things like performance against a single exchange to fanout queues, multiple exchanges dedicated to a single queue, server topologies, etc.  One of the things I'd tested was performance improvements with HIPE.  I wanted to share a few discoveries over the last few days.

First, let me start out my configuration.  I'd been trying transactions but after reading about publishConfirm settings, I switched to that immediately (losing messages otherwise is a bad deal for us).  Wish I'd seen that before.  Anyways, I'm publishing from a java client remotely on a 1GB network to a rabbit box with about 64GB Ram, 24 cores of CPU (Intel), 900GB SCSI Disks in a RAID 1 configuration.  I'm starting up multiple threads, each thread with it's own channel, and publishConfirm every 500 messages (I tried 5000 to 1000 to 50 and found 500 about optimal, though that may vary).  Each message is a static 800 byte random message.  I'm using something very similar to the code here:
http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/examples/ConfirmDontLoseMessages.java

I'm consuming with a spring SimpleMessageConsumerListener, with 16 threads against all the available queues.  I've got a transaction size of 50, prefetch of 50, and am using the RabbitTransactionManager transaction handler.  I increment a local message counter and move on in the message.


Here are some of my findings:
NOTE - all messages/queues are durable and persistent.  

With publishes only going, I'm seeing about 15k messages a second go through the system, and maxing out disk IO on the box at about 14MB/sec.  CPU load was about 20-40% at various times.  This is consistent whether it's five queue or twenty five queues.  Disk IO is the limiting factor here.  With messages about 1k a piece, and 15k of those going through, this implies that each message is hitting disk at a pretty straight 1-1 rate.  Note, this was the same whether against a fanout to multiple queues or direct exchanges with a single queue backing them. 

With ONLY consumers going, I was able to receive at nearly 65k messages a second.  I was pretty danged impressed by that.  If I DON'T set the txSize that performance goes down to about 25k messages a second - big improvement when you tweak your settings there.  Note, I've not spent a whole lot of time working on this section, so I'm NOT sure about the reliability and handling of messages, but overall it seems pretty impressive.

With both publishers and consumers going, the messages even out where the consumers eventually match the publishing rates (surprise surprise).  What was surprising a bit was that this rate with both going was about the same rate as publishing alone.  I'd have figured that the disk I/O might have actually increased due to having to modify the database to confirm (ack) the consume.  This and the consumer performance tells me that consuming data from the database is a LOT less intensive than getting it in there.  I do want to run more tests to see how intensive Consumes are to the disk.


Now for the warnings:
1)  TURN OFF HIPE.  This was testing with Erlang R15B03 - the latest release and RabbitMQ 3.0.2.  With HIPE and the load we were putting on the system, Rabbit crashes bad, no errors, no warning, it's just suddenly dead.  It seems to happen a few minutes into the load.  I've not enabled any kind of debugging to trace this down, but this was scary enough that we immediately turned off HIPE everywhere.  HIPE DOES give you a good 20-50% boost in message rates, but be prepared to have it crash.  Note, this was our experience on multiple boxes, running CentOS 6.2 (well, really Oracle's Enterprise Linux).  I'm going to hopefully at some point turn on some debugging and see if I can trace this down, but it's not a priority right now.  It ONLY seems to happen under a load though - I've got multiple systems that have HIPE turned on with the same hardware configurations that don't show this, but they aren't under the load I've put on while testing.  Note your mileage may vary with this.  I'd also want to test against different Erlang releases than R15B03.

2)  These numbers are very preliminary and should be taken with a grain of salt.  Still, it's pretty interesting to see what Rabbit can handle under a load, and that it seems (at least from publishing) to be much more IO bound than CPU bound.  I'd love to hit a smaller CPU system that has more IO capacity to see if I can bottle neck on CPU and see performance there.

3)  Tests were done from a remote system to the server.  I used about 30% of a 1GB connection - there IS a possibility there's some bottle necking on the network due to frame sizes and other settings.

4)  I've not tested a whole lot of variations on this test yet, as I've not had the time, but it'd be interesting to test with different settings (i.e. async:1, A:0 settings, changing to XFS file system from EXT4, etc.).  This is currently a very default install of Rabbit.


Good luck to anyone out there!  Will see if I can share my sample code of my publisher/consumer stuff out at some point.  If people have more questions on hardware configurations, server configs, etc. let me know!

Jason




From mcintoshj at gmail.com  Fri Mar  8 04:12:18 2013
From: mcintoshj at gmail.com (McIntosh Jason)
Date: Thu, 7 Mar 2013 22:12:18 -0600
Subject: [rabbitmq-discuss] Turning off prefetch in the
	asynchronous_consumer_example
In-Reply-To: <CC28B25FDAC5D943B606F46369686C2A243622A6@SJC4EXDAG01-02.corp.service-now.com>
References: <CC28B25FDAC5D943B606F46369686C2A243622A6@SJC4EXDAG01-02.corp.service-now.com>
Message-ID: <32F37E49-CB56-4119-BE93-691CCA6265A5@gmail.com>

Are you sure you're not seeing it as an auto-ack issue?  Not sure enough of what's going on, but if you're only seeing one un-ack'd message when the second comes in, it's just checked out the message and waiting for an ack.  If you want to auto-acknowledge the messages, I believe that's an option to the consumer. 

Jason

On Mar 7, 2013, at 12:16 PM, Scott Chapman wrote:

> Code from here:
> https://github.com/pika/pika/blob/master/docs/examples/asynchronous_consumer_example.rst
> 
> I've tried putting the qos call here:
> 
>     def on_channel_open(self, channel):
>         """This method is invoked by pika when the channel has been opened.
>         The channel object is passed in so we can make use of it.
> 
>         Since the channel is now open, we'll declare the exchange to use.
> 
>         :param pika.channel.Channel channel: The channel object
> 
>         """
>         LOGGER.debug('Channel opened')
>         channel.basic_qos(prefetch_count=1)
>         self._channel = channel
>         self.add_on_channel_close_callback()
>         self.setup_exchange(self.EXCHANGE)
> 
> It did not turn off prefetching.  Messages still show up in RabbitMQ as Unacknowledged rather than Ready when I send one and send a 2nd before the 1st is done processing.
> 
> What am I missing?
> 
> I want to turn off prefetching.
> I can't figure out how to turn it off on the Connection. That would be preferable, or turn it off globally.
> 
> Any clues GREATLY appreciated.
> 
> Thanks,
> Scott
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/d27be711/attachment.htm>

From steveolivier22 at gmail.com  Thu Mar  7 23:24:51 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Thu, 7 Mar 2013 15:24:51 -0800 (PST)
Subject: [rabbitmq-discuss] Per-queue/exchange ACL via LDAP plugin
Message-ID: <1362698691958-25325.post@n5.nabble.com>

Greetings-

I was curious how to accomplish a per-queue/exchange ACL method while using
the LDAP auth plugin. I was looking to do something similar to the example
provided: 

http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#Access%20control
<http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#Access%20control>  

*rabbitmqctl set_permissions -p /myvhost tonyg "^tonyg-.*" ".*" ".*"*

/This command instructs the RabbitMQ broker to grant the user named tonyg
access to the virtual host called /myvhost, with configure permissions on
all resources whose names starts with "tonyg-", and write and read
permissions on all resources/

Better yet, I was looking to do a config that equated to, "Users in
Group-Test1 can consume from queues starting with the name Test1, but no one
else can".

I have the general "User in Group-Test1 can consume from queues", but not
the rest.

Thanks

s



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Per-queue-exchange-ACL-via-LDAP-plugin-tp25325.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From sender.eric at gmail.com  Fri Mar  8 07:24:26 2013
From: sender.eric at gmail.com (Eric Sender)
Date: Thu, 7 Mar 2013 23:24:26 -0800 (PST)
Subject: [rabbitmq-discuss] Running RPC across two separate Virtual Machines?
Message-ID: <91825fcc-3afc-44f9-9858-ac8dc27dc8d2@googlegroups.com>

I have been going through the RabbitMQ tutorial step by step and making 
sure I can do all the basics. Rabbit seems very interesting and promising, 
but I am having some issues getting RabbitMQ to talk to other machines.

My current set up is:

Host OS: Windows 7 --- not relevant here, I am only running RabbitMQ on the 
Guest OS's
Guest OS 1 (VMWare Player): CentOS 6.3
Guest OS 2 (VirtualBox): CentOS 6.3

I have RabbitMQ service working on both Guest OS's and I have Guest OS 1 
running rpc_server.py and Guest OS 2 running rpc_client.py. 

But I am unsure how to get those separate VMs talking to each other with 
the rpc_server.py.

I have tried editing the following line in rpc_client.py

Line 7: self.connection = 
pika.BlockingConnection(pika.ConnectionParameters(host='192.168.1.84')) #changed 
from 'localhost'

So that it reflects the IP address of the server VM, but it I get 
"socket.error: [Errno 113] No route to host"

How should I set it up properly to have RabbitMQ talking to separate VMs?


Thanks
Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130307/817a6209/attachment.htm>

From emile at rabbitmq.com  Fri Mar  8 09:56:12 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 08 Mar 2013 09:56:12 +0000
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <63db12af-2bc2-4f7a-a413-5303201822f5@googlegroups.com>
References: <63db12af-2bc2-4f7a-a413-5303201822f5@googlegroups.com>
Message-ID: <5139B5BC.5030404@rabbitmq.com>


Hi,

On 07/03/13 22:59, Nishanth wrote:

> While they process the message, rabbitmq drops their connection silently
> as it considers them to have been idle for a long time.

The broker will not drop connections silently. The culprit is more
likely a firewall and enabling heartbeats is the correct way to solve
the problem.

> I tried to set up heartbeat interval in worker connections but it didn't
> resolve the issue. It keeps timing out. I am not able to understand how
> this heartbeat work or how to debug to find out why its timing out. 

You can check that the heartbeat is indeed recognised in the broker by
issuing "rabbitmqctl list_connections timeout".

If the heartbeat is set too long then connections may of course still be
dropped, e.g. if an intervening firewall has a 10 minute timeout and the
AMQP heartbeats are exchanged every 15 minutes then connections will
still be dropped.



-Emile









From emile at rabbitmq.com  Fri Mar  8 10:12:20 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 08 Mar 2013 10:12:20 +0000
Subject: [rabbitmq-discuss] Running RPC across two separate Virtual
	Machines?
In-Reply-To: <91825fcc-3afc-44f9-9858-ac8dc27dc8d2@googlegroups.com>
References: <91825fcc-3afc-44f9-9858-ac8dc27dc8d2@googlegroups.com>
Message-ID: <5139B984.7070400@rabbitmq.com>


Hi Eric,

On 08/03/13 07:24, Eric Sender wrote:
> I have RabbitMQ service working on both Guest OS's 

You only need one broker. Both the RPC server and client must use the
same broker.

> How should I set it up properly to have RabbitMQ talking to separate VMs?
You must first make sure that the broker VM can accept connections. If
you see a routing error then that VM might be using NAT. As soon as you
have the VMs able to communicate the tutorial examples should work. You
should consult the hypervisor documentation on how to set up networking.



-Emile






From simon at rabbitmq.com  Fri Mar  8 13:40:33 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Mar 2013 13:40:33 +0000
Subject: [rabbitmq-discuss] Performance tests and a warning on HIPE
In-Reply-To: <B4A058E2-17EC-4669-B46E-286B9DDB8511@gmail.com>
References: <B4A058E2-17EC-4669-B46E-286B9DDB8511@gmail.com>
Message-ID: <5139EA51.8020200@rabbitmq.com>

Thanks for a thoughtful message. On a couple of points:

On 08/03/13 03:03, McIntosh Jason wrote:
> What was surprising a bit was that this rate with both
> going was about the same rate as publishing alone.  I'd have figured
> that the disk I/O might have actually increased due to having to
> modify the database to confirm (ack) the consume.  This and the
> consumer performance tells me that consuming data from the database
> is a LOT less intensive than getting it in there.  I do want to run
> more tests to see how intensive Consumes are to the disk.

There is an optimisation in RabbitMQ that should account for this - when 
a message first reaches a queue, it is sent to the persister to go to 
disc. If the persister is busy it will join an (internal, non-AMQP) 
queue there. It can be sent out to consumers *before* it has been 
persisted - and if the consumer is autoack, or the consumer acks the 
message before it has made it to disc, we may end up never persisting 
the message at all - it's no longer relevant. Needless to say, we will 
only issue a confirm once either the message is persisted or a consumer 
has acknowledged it.

> Now for the warnings: 1)  TURN OFF HIPE.  This was testing with
> Erlang R15B03 - the latest release and RabbitMQ 3.0.2.  With HIPE and
> the load we were putting on the system, Rabbit crashes bad, no
> errors, no warning, it's just suddenly dead.  It seems to happen a
> few minutes into the load.  I've not enabled any kind of debugging to
> trace this down, but this was scary enough that we immediately turned
> off HIPE everywhere.

That certainly is scary, and unlike our experiences - we've generally 
seen HiPE crash immediately or work fine. I suspect the platform is an 
issue here. But yes, you should be cautious turning on HiPE in production...

> 2)  These numbers are very preliminary and should be taken with a
> grain of salt.  Still, it's pretty interesting to see what Rabbit can
> handle under a load, and that it seems (at least from publishing) to
> be much more IO bound than CPU bound.  I'd love to hit a smaller CPU
> system that has more IO capacity to see if I can bottle neck on CPU
> and see performance there.

Sure. Alternatively turn off persistence and you will become CPU-bound 
quite easily :-)

> 3)  Tests were done from a remote system to the server.  I used about
> 30% of a 1GB connection - there IS a possibility there's some bottle
> necking on the network due to frame sizes and other settings.
>
> 4)  I've not tested a whole lot of variations on this test yet, as
> I've not had the time, but it'd be interesting to test with different
> settings (i.e. async:1, A:0 settings, changing to XFS file system
> from EXT4, etc.).  This is currently a very default install of
> Rabbit.

At a guess, the biggest change is likely to be using an SSD.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar  8 14:19:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Mar 2013 14:19:46 +0000
Subject: [rabbitmq-discuss] Per-queue/exchange ACL via LDAP plugin
In-Reply-To: <1362698691958-25325.post@n5.nabble.com>
References: <1362698691958-25325.post@n5.nabble.com>
Message-ID: <5139F382.4090705@rabbitmq.com>

On 07/03/13 23:24, SteveO wrote:
> Better yet, I was looking to do a config that equated to, "Users in
> Group-Test1 can consume from queues starting with the name Test1, but no one
> else can".

Hmm. Do you mean that you want to specify "Test1" in the config, or that 
you want to express that as a more general pattern and "Test1" is just 
an example?

Because I'm not sure the more general pattern thing works very well on a 
conceptual level - first we need to look at the prefix of the queue, and 
then go and look for the corresponding group and see if the user is in 
it - but what defines the prefix of the queue?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar  8 14:25:03 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Mar 2013 14:25:03 +0000
Subject: [rabbitmq-discuss] How to configure RabbitMQ cluster to get out
 of the scale.
In-Reply-To: <ffd0377c-e660-4663-b638-bd83470aff1c@googlegroups.com>
References: <ffd0377c-e660-4663-b638-bd83470aff1c@googlegroups.com>
Message-ID: <5139F4BF.6030509@rabbitmq.com>

On 07/03/13 23:31, t.otoda.freemail at gmail.com wrote:
> 1) What kind of point should I be careful about?
>
>     the number of nodes of the cluster,
>     the number of nodes mirrored queues,
>     the number of queues which nodes of the cluster have, etc.

What do you mean by "be careful about"?

> 2) What kind of procedure should I let RabbitMQ get out of the scale in?
>
>     I think RabbitMQ does not seem to get out of the scale only by
> having added a node.
>     Because it doesn't do re-balance of queues between nodes automatically.

Yes, currently the expectation is you have a load balancer out front, or 
that you have some other way to make your clients select nodes evenly. 
Then new queues are declared on the node that the client declaring them 
was connected to.

>     If anyone know how to do re-balance of queues, please tell me.

This is something that comes up occasionally - in 3.1 it will be 
possible to manually migrate queues around by using the HA "nodes" 
policy, but doing so will involve deliberately making the queue fail 
over, with attendant consumer cancellation. It's possible something 
could be scripted on top of that for automatic queue balancing - is this 
something for which there would be demand?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Michael.Laing at nytimes.com  Fri Mar  8 15:50:19 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Fri, 8 Mar 2013 10:50:19 -0500
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <5139B5BC.5030404@rabbitmq.com>
Message-ID: <CD5F7169.86BB%Michael.Laing@nytimes.com>

We keep connections alive for long periods in EC2.

We set the heartbeat to 25 secs to achieve this, as elastic load
balancers, in particular, have short timeouts.

I would recommend upgrading to the latest rabbitmq and setting the
heartbeat in the configuration.

Look to see that it shows up in the management console. It's possible for
client interface code to not agree to heartbeat w the server.

Michael

On 3/8/13 4:56 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>
>Hi,
>
>On 07/03/13 22:59, Nishanth wrote:
>
>> While they process the message, rabbitmq drops their connection silently
>> as it considers them to have been idle for a long time.
>
>The broker will not drop connections silently. The culprit is more
>likely a firewall and enabling heartbeats is the correct way to solve
>the problem.
>
>> I tried to set up heartbeat interval in worker connections but it didn't
>> resolve the issue. It keeps timing out. I am not able to understand how
>> this heartbeat work or how to debug to find out why its timing out.
>
>You can check that the heartbeat is indeed recognised in the broker by
>issuing "rabbitmqctl list_connections timeout".
>
>If the heartbeat is set too long then connections may of course still be
>dropped, e.g. if an intervening firewall has a 10 minute timeout and the
>AMQP heartbeats are exchanged every 15 minutes then connections will
>still be dropped.
>
>
>
>-Emile
>
>
>
>
>
>
>
>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gmr at meetme.com  Fri Mar  8 15:53:01 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 8 Mar 2013 10:53:01 -0500
Subject: [rabbitmq-discuss] Performance tests and a warning on HIPE
In-Reply-To: <5139EA51.8020200@rabbitmq.com>
References: <B4A058E2-17EC-4669-B46E-286B9DDB8511@gmail.com>
	<5139EA51.8020200@rabbitmq.com>
Message-ID: <877D18CC56424BE7B7ACBBBE19C5D33A@meetme.com>



On Friday, March 8, 2013 at 8:40 AM, Simon MacMullen wrote:

> > Now for the warnings: 1) TURN OFF HIPE. This was testing with
> > Erlang R15B03 - the latest release and RabbitMQ 3.0.2. With HIPE and
> > the load we were putting on the system, Rabbit crashes bad, no
> > errors, no warning, it's just suddenly dead. It seems to happen a
> > few minutes into the load. I've not enabled any kind of debugging to
> > trace this down, but this was scary enough that we immediately turned
> > off HIPE everywhere.
> > 
> 
> 
> That certainly is scary, and unlike our experiences - we've generally 
> seen HiPE crash immediately or work fine. I suspect the platform is an 
> issue here. But yes, you should be cautious turning on HiPE in production...
> 
> 

This is my experience as well on both CentOS 5.3 and 6.3 with R15B0 (and previous versions) with all versions of RabbitMQ we run (Everything from 2.7.1 -> 3.0.2)

Cheers,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130308/52394198/attachment.htm>

From tim at rabbitmq.com  Fri Mar  8 15:58:08 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 8 Mar 2013 15:58:08 +0000
Subject: [rabbitmq-discuss] Performance tests and a warning on HIPE
In-Reply-To: <877D18CC56424BE7B7ACBBBE19C5D33A@meetme.com>
References: <B4A058E2-17EC-4669-B46E-286B9DDB8511@gmail.com>
	<5139EA51.8020200@rabbitmq.com>
	<877D18CC56424BE7B7ACBBBE19C5D33A@meetme.com>
Message-ID: <79C33499-637D-402C-9F48-99B7E2BA0B37@rabbitmq.com>

Can anyone assist with either reproducing this, or providing either an erlang crash_dump or (if the emulator dies 'badly' enough) a core dump? I would be very good to pass this on to the hipe team so they can figure out what's wrong and fix it for future releases. Using hipe can potentially improve performance a lot, so not being able to trust it when using rabbit under load is a real shame, but this won't get fixed unless we provide the hipe team with some tangible evidence they can use to investigate.

Cheers,
Tim

On 8 Mar 2013, at 15:53, Gavin M. Roy wrote:

> 
> On Friday, March 8, 2013 at 8:40 AM, Simon MacMullen wrote:
> 
>>> Now for the warnings: 1) TURN OFF HIPE. This was testing with
>>> Erlang R15B03 - the latest release and RabbitMQ 3.0.2. With HIPE and
>>> the load we were putting on the system, Rabbit crashes bad, no
>>> errors, no warning, it's just suddenly dead. It seems to happen a
>>> few minutes into the load. I've not enabled any kind of debugging to
>>> trace this down, but this was scary enough that we immediately turned
>>> off HIPE everywhere.
>> 
>> That certainly is scary, and unlike our experiences - we've generally
>> seen HiPE crash immediately or work fine. I suspect the platform is an
>> issue here. But yes, you should be cautious turning on HiPE in production...
> This is my experience as well on both CentOS 5.3 and 6.3 with R15B0 (and previous versions) with all versions of RabbitMQ we run (Everything from 2.7.1 -> 3.0.2)
> 
> Cheers,
> 
> Gavin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gmr at meetme.com  Fri Mar  8 16:06:12 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 8 Mar 2013 11:06:12 -0500
Subject: [rabbitmq-discuss] Performance tests and a warning on HIPE
In-Reply-To: <79C33499-637D-402C-9F48-99B7E2BA0B37@rabbitmq.com>
References: <B4A058E2-17EC-4669-B46E-286B9DDB8511@gmail.com>
	<5139EA51.8020200@rabbitmq.com>
	<877D18CC56424BE7B7ACBBBE19C5D33A@meetme.com>
	<79C33499-637D-402C-9F48-99B7E2BA0B37@rabbitmq.com>
Message-ID: <CAKwdTWeGEDDyULB2dUjOQjFTTqtxo=urMpg9xfrdVSCpSdY+Eg@mail.gmail.com>

Sorry, to be clear, I run HiPE in production under heavy load without
issues.


On Fri, Mar 8, 2013 at 10:58 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Can anyone assist with either reproducing this, or providing either an
> erlang crash_dump or (if the emulator dies 'badly' enough) a core dump? I
> would be very good to pass this on to the hipe team so they can figure out
> what's wrong and fix it for future releases. Using hipe can potentially
> improve performance a lot, so not being able to trust it when using rabbit
> under load is a real shame, but this won't get fixed unless we provide the
> hipe team with some tangible evidence they can use to investigate.
>
> Cheers,
> Tim
>
> On 8 Mar 2013, at 15:53, Gavin M. Roy wrote:
>
> >
> > On Friday, March 8, 2013 at 8:40 AM, Simon MacMullen wrote:
> >
> >>> Now for the warnings: 1) TURN OFF HIPE. This was testing with
> >>> Erlang R15B03 - the latest release and RabbitMQ 3.0.2. With HIPE and
> >>> the load we were putting on the system, Rabbit crashes bad, no
> >>> errors, no warning, it's just suddenly dead. It seems to happen a
> >>> few minutes into the load. I've not enabled any kind of debugging to
> >>> trace this down, but this was scary enough that we immediately turned
> >>> off HIPE everywhere.
> >>
> >> That certainly is scary, and unlike our experiences - we've generally
> >> seen HiPE crash immediately or work fine. I suspect the platform is an
> >> issue here. But yes, you should be cautious turning on HiPE in
> production...
> > This is my experience as well on both CentOS 5.3 and 6.3 with R15B0 (and
> previous versions) with all versions of RabbitMQ we run (Everything from
> 2.7.1 -> 3.0.2)
> >
> > Cheers,
> >
> > Gavin
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130308/40783901/attachment.htm>

From briankcook at gmail.com  Fri Mar  8 16:37:17 2013
From: briankcook at gmail.com (Brian Cook)
Date: Fri, 8 Mar 2013 16:37:17 +0000 (UTC)
Subject: [rabbitmq-discuss] centos 6.3 rabbitmq install
References: <af48cfd3-f6c6-4ebd-bd80-de823a9c2dff@googlegroups.com>
	<8C482214-89AB-4D57-87F7-402FCC3DE317@fluxlabs.net>
	<CAE0Sz=x+yVEM0c6eUDvzUe4RgOuKnJsOFcUSnCht0+c7XAEqEQ@mail.gmail.com>
Message-ID: <loom.20130308T173625-566@post.gmane.org>

Jerry Kuch <jerryk at ...> writes:

> 
> 
> Also, be mindful of who that other node is running as... sometimes this 
happens if a Rabbit gets started in a non-standard way...
> On Thu, Mar 7, 2013 at 1:44 PM, Jeremy McSpadden <jeremy <at> fluxlabs.net> 
wrote:
> 
> 
> 
> 
> You need to kill the running daemon.?--
> Jeremy McSpadden
> Flux Labs, Inc |?http://www.fluxlabs.net?| Endless Solutions
> Office :?850-250-5590x101?| Cell :?850-890-2543?|
>  Fax :?850-254-2955
> 
> 
> 
> 
> On Mar 7, 2013, at 3:42 PM, "Brian Cook" <briankcook-
Re5JQEeQqe8AvxtiuMwx3w at public.gmane.org> wrote:
> 
> 
> I am having a time trying to install rabbitmq on centos 6.3?
> I followed the instructions here
> 
> http://www.rabbitmq.com/install-rpm.html
> 
> 
> When I start it I get?
> 
> [root <at> mx rabbitmq]# /sbin/service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
> rabbitmq-server.
> 
> 
> I check the startup_log and get this
> 
> Activating RabbitMQ plugins ...
> 0 plugins activated:
> 
> node with name "rabbit" already running on "mx"
> diagnostics:
> - nodes and their ports on mx: [{rabbit,39037}]
> - current node: rabbitmqprelaunch3428 <at> mx
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: IPCqsVajl4UdR/jTgmyvfA==
> ~
> ~
> 
> 
> So I found something post in the forums that the process is running. Not 
matter how many time I do it is not running.?
> 
> I check it with?
> 
> [root <at> mx rabbitmq]# ps aux|grep rabbit
> rabbitmq ?3152 ?0.0 ?0.0 ?10824 ? 424 ? ? ? ? ?S ? ?13:33 ? 0:00 
/usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
> root ? ? ?3308 ?0.0 ?0.0 103236 ? 860 pts/0 ? ?S+ ? 13:34 ? 0:00 grep rabbit
> [root <at> mx rabbitmq]# skill -p 3152
> [root <at> mx rabbitmq]# ps aux|grep rabbit
> root ? ? ?3311 ?0.0 ?0.0 103236 ? 860 pts/0 ? ?S+ ? 13:35 ? 0:00 grep rabbit
> [root <at> mx rabbitmq]# /sbin/service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
> rabbitmq-server.
> [root <at> mx rabbitmq]# ps aux|grep rabbit
> rabbitmq ?3335 ?0.0 ?0.0 ?10824 ? 424 ? ? ? ? ?S ? ?13:35 ? 0:00 
/usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
> root ? ? ?3388 ?0.0 ?0.0 103236 ? 856 pts/0 ? ?S+ ? 13:35 ? 0:00 grep rabbit
> [root <at> mx rabbitmq]# /sbin/service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
> rabbitmq-server.
> 
> 
> 
> So I try to pass commands and I get nodedown.
> 
> Not sure what to do next.?
> 
> 
> 
> 
> 
> 
> 
> _______________________________________________rabbitmq-discuss mailing 
listrabbitmq-discuss-
ETbvJ2rUIr4qBm01orBoR9BPR1lH4CV8 at public.gmane.orghttps://lists.rabbitmq.com/cgi-
bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss <at> 
lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-
discuss
> 
> 
> 
> 
I tired the following and still getting the error
[root at mx rabbitmq]# sudo -u rabbitmq rabbitmqctl stop
Stopping and halting node rabbit at mx ...
Error: unable to connect to node rabbit at mx: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at mx]

hosts, their running nodes and ports:
- mx: [{rabbit,39037}]

current node details:
- node name: rabbitmqctl9227 at mx
- home dir: /var/lib/rabbitmq
- cookie hash: Jwz5wITnEUynZnx5gAFlSQ==

[root at mx rabbitmq]#





From steveolivier22 at gmail.com  Fri Mar  8 16:53:23 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Fri, 8 Mar 2013 08:53:23 -0800 (PST)
Subject: [rabbitmq-discuss] Per-queue/exchange ACL via LDAP plugin
In-Reply-To: <5139F382.4090705@rabbitmq.com>
References: <1362698691958-25325.post@n5.nabble.com>
	<5139F382.4090705@rabbitmq.com>
Message-ID: <1362761603852-25343.post@n5.nabble.com>

Assuming I had local database users named Test1 and Test2, I could ensure
that only user Test1 could consume from queues starting with the name
"Test1" and only user Test2 could consume from queues starting with the name
"Test2" by doing the following...

rabbitmqctl set_permissions -p /myvhost Test1 ".*" ".*" "^Test1.*"
rabbitmqctl set_permissions -p /myvhost Test2 ".*" ".*" "^Test2.*"

Hopefully my understanding is correct. Please let me know if I am way off :)
It seems to be working to my understanding with the tests I have ran.

What I wanted to to do was apply similar logic when using LDAP A/A. If the
user was matched by user_dn or by group membership, that's fine. I preferred
the group membership, but would settle for user_dn. The "Test1" queue name
was certainly an example. If "Test1" was considered a prefix to the queue
name or the queue name itself, that's fine as well. 

Under the "resource_access_query" section in the readme here...

https://github.com/rabbitmq/rabbitmq-auth-backend-ldap/blob/master/README-authorisation
<https://github.com/rabbitmq/rabbitmq-auth-backend-ldap/blob/master/README-authorisation>  

...how does the ${name} parameter work? That's how I though I'd make this
happen, but my attempts have flailed so far.

thanks

s








--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Per-queue-exchange-ACL-via-LDAP-plugin-tp25331p25343.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jerryk at rbcon.com  Fri Mar  8 16:56:44 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 8 Mar 2013 08:56:44 -0800
Subject: [rabbitmq-discuss] centos 6.3 rabbitmq install
In-Reply-To: <loom.20130308T173625-566@post.gmane.org>
References: <af48cfd3-f6c6-4ebd-bd80-de823a9c2dff@googlegroups.com>
	<8C482214-89AB-4D57-87F7-402FCC3DE317@fluxlabs.net>
	<CAE0Sz=x+yVEM0c6eUDvzUe4RgOuKnJsOFcUSnCht0+c7XAEqEQ@mail.gmail.com>
	<loom.20130308T173625-566@post.gmane.org>
Message-ID: <CAE0Sz=zSe4Ak=s88wWdGiJy6FFMKdn+HLzAH05tk26LyZ7rZyA@mail.gmail.com>

Hi, Brian:

What do you see if you try:

ps auxwww | grep -y beam

or:

ps auxwww | grep -y rabbit

The "beam" is the name of the Erlang VM that Rabbit runs in, analogous to
"java" being the name of the JVM a Java application would be running in.
 When you spot a running rabbit broker you'll seem a beam process (the name
may vary slightly depending on platform) whose very long command line
contains a bunch of parameters that will implicate rabbit.

If you "kill -9" that process you should have things shut down and in a
known state where you can get back to starting/stopping with /sbin/service,
run sudo'ed in the usual way...

Best regards,
Jerry


On Fri, Mar 8, 2013 at 8:37 AM, Brian Cook <briankcook at gmail.com> wrote:

> Jerry Kuch <jerryk at ...> writes:
>
> >
> >
> > Also, be mindful of who that other node is running as... sometimes this
> happens if a Rabbit gets started in a non-standard way...
> > On Thu, Mar 7, 2013 at 1:44 PM, Jeremy McSpadden <jeremy <at>
> fluxlabs.net>
> wrote:
> >
> >
> >
> >
> > You need to kill the running daemon. --
> > Jeremy McSpadden
> > Flux Labs, Inc | http://www.fluxlabs.net | Endless Solutions
> > Office : 850-250-5590x101 | Cell : 850-890-2543 |
> >  Fax : 850-254-2955
> >
> >
> >
> >
> > On Mar 7, 2013, at 3:42 PM, "Brian Cook" <briankcook-
> Re5JQEeQqe8AvxtiuMwx3w at public.gmane.org> wrote:
> >
> >
> > I am having a time trying to install rabbitmq on centos 6.3
> > I followed the instructions here
> >
> > http://www.rabbitmq.com/install-rpm.html
> >
> >
> > When I start it I get
> >
> > [root <at> mx rabbitmq]# /sbin/service rabbitmq-server start
> > Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
> _err}
> > rabbitmq-server.
> >
> >
> > I check the startup_log and get this
> >
> > Activating RabbitMQ plugins ...
> > 0 plugins activated:
> >
> > node with name "rabbit" already running on "mx"
> > diagnostics:
> > - nodes and their ports on mx: [{rabbit,39037}]
> > - current node: rabbitmqprelaunch3428 <at> mx
> > - current node home dir: /var/lib/rabbitmq
> > - current node cookie hash: IPCqsVajl4UdR/jTgmyvfA==
> > ~
> > ~
> >
> >
> > So I found something post in the forums that the process is running. Not
> matter how many time I do it is not running.
> >
> > I check it with
> >
> > [root <at> mx rabbitmq]# ps aux|grep rabbit
> > rabbitmq  3152  0.0  0.0  10824   424 ?        S    13:33   0:00
> /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
> > root      3308  0.0  0.0 103236   860 pts/0    S+   13:34   0:00 grep
> rabbit
> > [root <at> mx rabbitmq]# skill -p 3152
> > [root <at> mx rabbitmq]# ps aux|grep rabbit
> > root      3311  0.0  0.0 103236   860 pts/0    S+   13:35   0:00 grep
> rabbit
> > [root <at> mx rabbitmq]# /sbin/service rabbitmq-server start
> > Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
> _err}
> > rabbitmq-server.
> > [root <at> mx rabbitmq]# ps aux|grep rabbit
> > rabbitmq  3335  0.0  0.0  10824   424 ?        S    13:35   0:00
> /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
> > root      3388  0.0  0.0 103236   856 pts/0    S+   13:35   0:00 grep
> rabbit
> > [root <at> mx rabbitmq]# /sbin/service rabbitmq-server start
> > Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log,
> _err}
> > rabbitmq-server.
> >
> >
> >
> > So I try to pass commands and I get nodedown.
> >
> > Not sure what to do next.
> >
> >
> >
> >
> >
> >
> >
> > _______________________________________________rabbitmq-discuss mailing
> listrabbitmq-discuss-
> ETbvJ2rUIr4qBm01orBoR9BPR1lH4CV8 at public.gmane.orghttps://
> lists.rabbitmq.com/cgi-
> bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing listrabbitmq-discuss <at>
> lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-
> discuss
> >
> >
> >
> >
> I tired the following and still getting the error
> [root at mx rabbitmq]# sudo -u rabbitmq rabbitmqctl stop
> Stopping and halting node rabbit at mx ...
> Error: unable to connect to node rabbit at mx: nodedown
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at mx]
>
> hosts, their running nodes and ports:
> - mx: [{rabbit,39037}]
>
> current node details:
> - node name: rabbitmqctl9227 at mx
> - home dir: /var/lib/rabbitmq
> - cookie hash: Jwz5wITnEUynZnx5gAFlSQ==
>
> [root at mx rabbitmq]#
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130308/028bb2a9/attachment.htm>

From briankcook at gmail.com  Fri Mar  8 17:16:36 2013
From: briankcook at gmail.com (Brian Cook)
Date: Fri, 8 Mar 2013 17:16:36 +0000 (UTC)
Subject: [rabbitmq-discuss] centos 6.3 rabbitmq install
References: <af48cfd3-f6c6-4ebd-bd80-de823a9c2dff@googlegroups.com>
	<8C482214-89AB-4D57-87F7-402FCC3DE317@fluxlabs.net>
	<CAE0Sz=x+yVEM0c6eUDvzUe4RgOuKnJsOFcUSnCht0+c7XAEqEQ@mail.gmail.com>
	<loom.20130308T173625-566@post.gmane.org>
	<CAE0Sz=zSe4Ak=s88wWdGiJy6FFMKdn+HLzAH05tk26LyZ7rZyA@mail.gmail.com>
Message-ID: <loom.20130308T181451-838@post.gmane.org>

Jerry Kuch <jerryk at ...> writes:

> 
> 
> Hi, Brian:
> 
> What do you see if you try:
> 
> ps auxwww | grep -y beam
> 
> or:
> 
> ps auxwww | grep -y rabbit
> 
> 
> The "beam" is the name of the Erlang VM that Rabbit runs in, analogous to 
"java" being the name of the JVM a Java application would be running in. ?When 
you spot a running rabbit broker you'll seem a beam process (the name may vary 
slightly depending on platform) whose very long command line contains a bunch of 
parameters that will implicate rabbit.
> 
> If you "kill -9" that process you should have things shut down and in a known 
state where you can get back to starting/stopping with /sbin/service, run 
sudo'ed in the usual way...
> 
> 
> 
> Best regards,
> Jerry

Hey Jerry
I got this below 
rabbitmq-server.
[root at mx ~]# ps auxwww | grep -y beam
root      3944  0.0  0.0 103236   880 pts/0    S+   14:55   0:00 grep -y beam
[root at mx ~]# ps auxwww | grep -y rabbit
rabbitmq  3030  0.0  0.0  10824   432 ?        S    14:41   0:00 
/usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
root      3947  0.0  0.0 103236   880 pts/0    S+   14:55   0:00 grep -y rabbit
[root at mx ~]# kill -9 3030
[root at mx ~]# ps auxwww | grep -y rabbit
root      3952  0.0  0.0 103236   880 pts/0    S+   14:55   0:00 grep -y rabbit
[root at mx ~]# service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, _err}
rabbitmq-server.





From briankcook at gmail.com  Fri Mar  8 17:56:48 2013
From: briankcook at gmail.com (Brian Cook)
Date: Fri, 8 Mar 2013 17:56:48 +0000 (UTC)
Subject: [rabbitmq-discuss] centos 6.3 rabbitmq install
References: <af48cfd3-f6c6-4ebd-bd80-de823a9c2dff@googlegroups.com>
	<8C482214-89AB-4D57-87F7-402FCC3DE317@fluxlabs.net>
	<CAE0Sz=x+yVEM0c6eUDvzUe4RgOuKnJsOFcUSnCht0+c7XAEqEQ@mail.gmail.com>
	<loom.20130308T173625-566@post.gmane.org>
	<CAE0Sz=zSe4Ak=s88wWdGiJy6FFMKdn+HLzAH05tk26LyZ7rZyA@mail.gmail.com>
	<loom.20130308T181451-838@post.gmane.org>
Message-ID: <loom.20130308T185431-665@post.gmane.org>

Brian Cook <briankcook at ...> writes:


> _
I wanted to follow up. I named this server the same as my old server I am going 
to replace. The rabbitmq service when I tried to start it saw the other server 
on the network. I have added my local address to the host file for the FQDN of 
the server and it fixxed the problem. Thanks for the help.
______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss <at> lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 





From nishanth at urbanmapping.com  Fri Mar  8 18:13:39 2013
From: nishanth at urbanmapping.com (Nishanth Babu Achuthan)
Date: Fri, 8 Mar 2013 10:13:39 -0800
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <CD5F7169.86BB%Michael.Laing@nytimes.com>
References: <5139B5BC.5030404@rabbitmq.com>
	<CD5F7169.86BB%Michael.Laing@nytimes.com>
Message-ID: <CACkkimmgs4ge3Mij5wxrDB9bvq34q352tLhmpKBuuhzOMsrAKQ@mail.gmail.com>

Hi Michael & Emile,

Thank you very much for the inputs.

I set the heartbeat interval to 25 seconds as below in the client.

parameters      =
pika.ConnectionParameters(host=RABBITMQ_HOSTNAME,heartbeat_interval=25,credentials=pika.PlainCredentials(RABBITMQ_USERNAME,RABBITMQ_PASSWORD))

connection      =       pika.SelectConnection(parameters,on_connected)


My rabbitmq conifg looks like below

[

        {rabbit,

                [

                        {heartbeat,25},

                        {tcp_listen_options,    [binary,        {packet,
     raw},

                                                {reuseaddr,     true},

                                                {backlog,       128},

                                                {nodelay,       true},

                                                {keepalive,     true}]}

                ]

        }

].


I ran the rabbitmqctl list_connections timeout as below

root at ip-10-78-237-240:/mnt# rabbitmqctl list_connections timeout

Listing connections ...

25

...done.


After 25 seconds, the connection dropped off. It says heartbeat_timeout in
the logs

=INFO REPORT==== 8-Mar-2013::17:59:03 ===

accepting AMQP connection <0.542.0> (10.79.18.130:60527 ->
10.78.237.240:5672)


=ERROR REPORT==== 8-Mar-2013::18:00:18 ===

closing AMQP connection <0.542.0> (10.79.18.130:60527 -> 10.78.237.240:5672
):

{heartbeat_timeout,running}



I am not sure why the connection is dropped here. Am I doing anything wrong?


Thanks
Nishanth


On Fri, Mar 8, 2013 at 7:50 AM, Laing, Michael P. <Michael.Laing at nytimes.com
> wrote:

> We keep connections alive for long periods in EC2.
>
> We set the heartbeat to 25 secs to achieve this, as elastic load
> balancers, in particular, have short timeouts.
>
> I would recommend upgrading to the latest rabbitmq and setting the
> heartbeat in the configuration.
>
> Look to see that it shows up in the management console. It's possible for
> client interface code to not agree to heartbeat w the server.
>
> Michael
>
> On 3/8/13 4:56 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:
>
> >
> >Hi,
> >
> >On 07/03/13 22:59, Nishanth wrote:
> >
> >> While they process the message, rabbitmq drops their connection silently
> >> as it considers them to have been idle for a long time.
> >
> >The broker will not drop connections silently. The culprit is more
> >likely a firewall and enabling heartbeats is the correct way to solve
> >the problem.
> >
> >> I tried to set up heartbeat interval in worker connections but it didn't
> >> resolve the issue. It keeps timing out. I am not able to understand how
> >> this heartbeat work or how to debug to find out why its timing out.
> >
> >You can check that the heartbeat is indeed recognised in the broker by
> >issuing "rabbitmqctl list_connections timeout".
> >
> >If the heartbeat is set too long then connections may of course still be
> >dropped, e.g. if an intervening firewall has a 10 minute timeout and the
> >AMQP heartbeats are exchanged every 15 minutes then connections will
> >still be dropped.
> >
> >
> >
> >-Emile
> >
> >
> >
> >
> >
> >
> >
> >
> >_______________________________________________
> >rabbitmq-discuss mailing list
> >rabbitmq-discuss at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130308/f360033f/attachment.htm>

From Scott.Chapman at servicenow.com  Fri Mar  8 19:02:07 2013
From: Scott.Chapman at servicenow.com (Scott Chapman)
Date: Fri, 8 Mar 2013 19:02:07 +0000
Subject: [rabbitmq-discuss] Turning off prefetch in the
 asynchronous_consumer_example
In-Reply-To: <32F37E49-CB56-4119-BE93-691CCA6265A5@gmail.com>
Message-ID: <CC28B25FDAC5D943B606F46369686C2A35EA9218@SJC4EXDAG01-02.corp.service-now.com>

It's not auto-ack. That's disabled. I don't want them auto-ack'd.

I don?t want it to "check out the message". That's prefetching. I want it to leave the message alone until it's ready to be processed.

Scott

From: McIntosh Jason <mcintoshj at gmail.com<mailto:mcintoshj at gmail.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Thursday, March 7, 2013 8:12 PM
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] Turning off prefetch in the asynchronous_consumer_example

Are you sure you're not seeing it as an auto-ack issue?  Not sure enough of what's going on, but if you're only seeing one un-ack'd message when the second comes in, it's just checked out the message and waiting for an ack.  If you want to auto-acknowledge the messages, I believe that's an option to the consumer.

Jason

On Mar 7, 2013, at 12:16 PM, Scott Chapman wrote:

Code from here:
https://github.com/pika/pika/blob/master/docs/examples/asynchronous_consumer_example.rst

I've tried putting the qos call here:

    def on_channel_open(self, channel):
        """This method is invoked by pika when the channel has been opened.
        The channel object is passed in so we can make use of it.

        Since the channel is now open, we'll declare the exchange to use.

        :param pika.channel.Channel channel: The channel object

        """
        LOGGER.debug('Channel opened')
        channel.basic_qos(prefetch_count=1)
        self._channel = channel
        self.add_on_channel_close_callback()
        self.setup_exchange(self.EXCHANGE)

It did not turn off prefetching.  Messages still show up in RabbitMQ as Unacknowledged rather than Ready when I send one and send a 2nd before the 1st is done processing.

What am I missing?

I want to turn off prefetching.
I can't figure out how to turn it off on the Connection. That would be preferable, or turn it off globally.

Any clues GREATLY appreciated.

Thanks,
Scott
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130308/62e51210/attachment.htm>

From matthias at rabbitmq.com  Fri Mar  8 19:22:40 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Mar 2013 19:22:40 +0000
Subject: [rabbitmq-discuss] Turning off prefetch in the
	asynchronous_consumer_example
In-Reply-To: <CC28B25FDAC5D943B606F46369686C2A35EA9218@SJC4EXDAG01-02.corp.service-now.com>
References: <CC28B25FDAC5D943B606F46369686C2A35EA9218@SJC4EXDAG01-02.corp.service-now.com>
Message-ID: <513A3A80.3090900@rabbitmq.com>

Scott,

On 08/03/13 19:02, Scott Chapman wrote:
> I don?t want it to "check out the message". That's prefetching. I want
> it to leave the message alone until it's ready to be processed.

If the prefetch count is set to 1 then you should see at most one 
unacknowledged message when looking at a channel in the management UI / 
with rabbitmqctl.

Check in the management UI, or with 'rabbitmqctl list_channels name 
prefetch_count', whether your basic.qos prefetch setting is taking effect.

Matthias.

From gmr at meetme.com  Fri Mar  8 19:44:27 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 8 Mar 2013 14:44:27 -0500
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <CACkkimmgs4ge3Mij5wxrDB9bvq34q352tLhmpKBuuhzOMsrAKQ@mail.gmail.com>
References: <5139B5BC.5030404@rabbitmq.com>
	<CD5F7169.86BB%Michael.Laing@nytimes.com>
	<CACkkimmgs4ge3Mij5wxrDB9bvq34q352tLhmpKBuuhzOMsrAKQ@mail.gmail.com>
Message-ID: <D697A60108BC4649818263D60CB973CF@meetme.com>

Depends on your code. Do you use time.sleep in your app? If you enable logging in your app, set pika to INFO -- do you see any messages on the Pika side? Are you consuming messages when it times out?


On Friday, March 8, 2013 at 1:13 PM, Nishanth Babu Achuthan wrote:

> Hi Michael & Emile,
> 
> > Thank you very much for the inputs.
> > 
> > I set the heartbeat interval to 25 seconds as below in the client. 
> > 
> > > parameters      =       pika.ConnectionParameters(host=RABBITMQ_HOSTNAME,heartbeat_interval=25,credentials=pika.PlainCredentials(RABBITMQ_USERNAME,RABBITMQ_PASSWORD)) 
> > > connection      =       pika.SelectConnection(parameters,on_connected)
> > > 
> > 
> > 
> > My rabbitmq conifg looks like below
> > 
> > > [
> > >         {rabbit,
> > > 
> > > 
> > 
> > >                 [
> > > 
> > > 
> > 
> > >                         {heartbeat,25},
> > > 
> > > 
> > 
> > >                         {tcp_listen_options,    [binary,        {packet,        raw},
> > > 
> > > 
> > 
> > >                                                 {reuseaddr,     true},
> > > 
> > > 
> > 
> > >                                                 {backlog,       128},
> > > 
> > > 
> > 
> > >                                                 {nodelay,       true},
> > > 
> > > 
> > 
> > >                                                 {keepalive,     true}]}
> > > 
> > > 
> > 
> > >                 ]
> > > 
> > > 
> > 
> > >         }
> > > 
> > > 
> > 
> > > ].
> > > 
> > > 
> > 
> > 
> > I ran the rabbitmqctl list_connections timeout as below 
> > 
> > > root at ip-10-78-237-240:/mnt# rabbitmqctl list_connections timeout 
> > > Listing connections ...
> > > 
> > > 
> > > 
> > 
> > > 25
> > > 
> > > 
> > > 
> > 
> > > ...done.
> > > 
> > > 
> > > 
> > 
> > 
> > After 25 seconds, the connection dropped off. It says heartbeat_timeout in the logs 
> > 
> > > =INFO REPORT==== 8-Mar-2013::17:59:03 === 
> > > accepting AMQP connection <0.542.0> (10.79.18.130:60527 (http://10.79.18.130:60527) -> 10.78.237.240:5672 (http://10.78.237.240:5672))
> > > 
> > > 
> > > 
> > > 
> > 
> > > 
> > > =ERROR REPORT==== 8-Mar-2013::18:00:18 ===
> > > closing AMQP connection <0.542.0> (10.79.18.130:60527 (http://10.79.18.130:60527) -> 10.78.237.240:5672 (http://10.78.237.240:5672)):
> > > 
> > > 
> > > 
> > > 
> > 
> > > {heartbeat_timeout,running}
> > > 
> > > 
> > > 
> > > 
> > 
> > 
> > 
> > I am not sure why the connection is dropped here. Am I doing anything wrong? 
> 
> Thanks
> Nishanth
> 
> 
> 
> 
> On Fri, Mar 8, 2013 at 7:50 AM, Laing, Michael P. <Michael.Laing at nytimes.com (mailto:Michael.Laing at nytimes.com)> wrote:
> > We keep connections alive for long periods in EC2.
> > 
> > We set the heartbeat to 25 secs to achieve this, as elastic load
> > balancers, in particular, have short timeouts.
> > 
> > I would recommend upgrading to the latest rabbitmq and setting the
> > heartbeat in the configuration.
> > 
> > Look to see that it shows up in the management console. It's possible for
> > client interface code to not agree to heartbeat w the server.
> > 
> > Michael
> > 
> > On 3/8/13 4:56 AM, "Emile Joubert" <emile at rabbitmq.com (mailto:emile at rabbitmq.com)> wrote:
> > 
> > >
> > >Hi,
> > >
> > >On 07/03/13 22:59, Nishanth wrote:
> > >
> > >> While they process the message, rabbitmq drops their connection silently
> > >> as it considers them to have been idle for a long time.
> > >
> > >The broker will not drop connections silently. The culprit is more
> > >likely a firewall and enabling heartbeats is the correct way to solve
> > >the problem.
> > >
> > >> I tried to set up heartbeat interval in worker connections but it didn't
> > >> resolve the issue. It keeps timing out. I am not able to understand how
> > >> this heartbeat work or how to debug to find out why its timing out.
> > >
> > >You can check that the heartbeat is indeed recognised in the broker by
> > >issuing "rabbitmqctl list_connections timeout".
> > >
> > >If the heartbeat is set too long then connections may of course still be
> > >dropped, e.g. if an intervening firewall has a 10 minute timeout and the
> > >AMQP heartbeats are exchanged every 15 minutes then connections will
> > >still be dropped.
> > >
> > >
> > >
> > >-Emile
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > >
> > >_______________________________________________
> > >rabbitmq-discuss mailing list
> > >rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130308/fd72eca0/attachment.htm>

From nishanth at urbanmapping.com  Fri Mar  8 19:59:41 2013
From: nishanth at urbanmapping.com (Nishanth Babu Achuthan)
Date: Fri, 8 Mar 2013 11:59:41 -0800
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <D697A60108BC4649818263D60CB973CF@meetme.com>
References: <5139B5BC.5030404@rabbitmq.com>
	<CD5F7169.86BB%Michael.Laing@nytimes.com>
	<CACkkimmgs4ge3Mij5wxrDB9bvq34q352tLhmpKBuuhzOMsrAKQ@mail.gmail.com>
	<D697A60108BC4649818263D60CB973CF@meetme.com>
Message-ID: <CACkkimmfEoxEJNKhZT=p7b7_5Wd+Uyb=-3_H2kbBWb=SvJaThw@mail.gmail.com>

Hi Roy,

I am not using time.sleep in my app.

Worker consumes message from the queue. It then starts processing it which
takes several hours to complete. In the meantime, the connection is dropped
off due to timeout. Once the processing is complete, the worker tries to
send ACK. While doing so, it fails with the error below and the worker
shuts down.

render_jobs_consumer - INFO -
tableau-classic-admin0-borders-en-us-extent-101.mbtiles published for
merging
render_jobs_consumer - INFO -
tableau-classic-admin0-borders-en-us-extent-101.mbtiles rendering completed
in 334.802966833. Sending acknowledgement
pika.adapters.base_connection - ERROR - Read empty data, calling disconnect
pika.adapters.base_connection - WARNING - Unknown state on disconnect: 5
pika.connection - WARNING - Disconnected from RabbitMQ at
192.168.2.182:5672(0):
pika.adapters.select_connection - INFO - Unregistering poller on fd 3


Thanks
Nishanth


On Fri, Mar 8, 2013 at 11:44 AM, Gavin M. Roy <gmr at meetme.com> wrote:

>  Depends on your code. Do you use time.sleep in your app? If you enable
> logging in your app, set pika to INFO -- do you see any messages on the
> Pika side? Are you consuming messages when it times out?
>
>  On Friday, March 8, 2013 at 1:13 PM, Nishanth Babu Achuthan wrote:
>
> Hi Michael & Emile,
>
> Thank you very much for the inputs.
>
> I set the heartbeat interval to 25 seconds as below in the client.
>
> parameters      =
> pika.ConnectionParameters(host=RABBITMQ_HOSTNAME,heartbeat_interval=25,credentials=pika.PlainCredentials(RABBITMQ_USERNAME,RABBITMQ_PASSWORD))
>
> connection      =       pika.SelectConnection(parameters,on_connected)
>
>
> My rabbitmq conifg looks like below
>
> [
>
>         {rabbit,
>
>                 [
>
>                         {heartbeat,25},
>
>                         {tcp_listen_options,    [binary,        {packet,
>      raw},
>
>                                                 {reuseaddr,     true},
>
>                                                 {backlog,       128},
>
>                                                 {nodelay,       true},
>
>                                                 {keepalive,     true}]}
>
>                 ]
>
>         }
>
> ].
>
>
> I ran the rabbitmqctl list_connections timeout as below
>
> root at ip-10-78-237-240:/mnt# rabbitmqctl list_connections timeout
>
> Listing connections ...
>
> 25
>
> ...done.
>
>
> After 25 seconds, the connection dropped off. It says heartbeat_timeout in
> the logs
>
> =INFO REPORT==== 8-Mar-2013::17:59:03 ===
>
> accepting AMQP connection <0.542.0> (10.79.18.130:60527 ->
> 10.78.237.240:5672)
>
>
> =ERROR REPORT==== 8-Mar-2013::18:00:18 ===
>
> closing AMQP connection <0.542.0> (10.79.18.130:60527 ->
> 10.78.237.240:5672):
>
> {heartbeat_timeout,running}
>
>
>
> I am not sure why the connection is dropped here. Am I doing anything
> wrong?
>
>
> Thanks
> Nishanth
>
>
> On Fri, Mar 8, 2013 at 7:50 AM, Laing, Michael P. <
> Michael.Laing at nytimes.com> wrote:
>
> We keep connections alive for long periods in EC2.
>
> We set the heartbeat to 25 secs to achieve this, as elastic load
> balancers, in particular, have short timeouts.
>
> I would recommend upgrading to the latest rabbitmq and setting the
> heartbeat in the configuration.
>
> Look to see that it shows up in the management console. It's possible for
> client interface code to not agree to heartbeat w the server.
>
> Michael
>
> On 3/8/13 4:56 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:
>
> >
> >Hi,
> >
> >On 07/03/13 22:59, Nishanth wrote:
> >
> >> While they process the message, rabbitmq drops their connection silently
> >> as it considers them to have been idle for a long time.
> >
> >The broker will not drop connections silently. The culprit is more
> >likely a firewall and enabling heartbeats is the correct way to solve
> >the problem.
> >
> >> I tried to set up heartbeat interval in worker connections but it didn't
> >> resolve the issue. It keeps timing out. I am not able to understand how
> >> this heartbeat work or how to debug to find out why its timing out.
> >
> >You can check that the heartbeat is indeed recognised in the broker by
> >issuing "rabbitmqctl list_connections timeout".
> >
> >If the heartbeat is set too long then connections may of course still be
> >dropped, e.g. if an intervening firewall has a 10 minute timeout and the
> >AMQP heartbeats are exchanged every 15 minutes then connections will
> >still be dropped.
> >
> >
> >
> >-Emile
> >
> >
> >
> >
> >
> >
> >
> >
> >_______________________________________________
> >rabbitmq-discuss mailing list
> >rabbitmq-discuss at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130308/8f227308/attachment.htm>

From gmr at meetme.com  Fri Mar  8 20:13:20 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 8 Mar 2013 15:13:20 -0500
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <CACkkimmfEoxEJNKhZT=p7b7_5Wd+Uyb=-3_H2kbBWb=SvJaThw@mail.gmail.com>
References: <5139B5BC.5030404@rabbitmq.com>
	<CD5F7169.86BB%Michael.Laing@nytimes.com>
	<CACkkimmgs4ge3Mij5wxrDB9bvq34q352tLhmpKBuuhzOMsrAKQ@mail.gmail.com>
	<D697A60108BC4649818263D60CB973CF@meetme.com>
	<CACkkimmfEoxEJNKhZT=p7b7_5Wd+Uyb=-3_H2kbBWb=SvJaThw@mail.gmail.com>
Message-ID: <CAKwdTWdGN0idPVoiwb2VswHZUpb+rprAg-bUb7vAmFEg1ndrhw@mail.gmail.com>

On Fri, Mar 8, 2013 at 2:59 PM, Nishanth Babu Achuthan <
nishanth at urbanmapping.com> wrote:

> Hi Roy,
>
> I am not using time.sleep in my app.
>
> Worker consumes message from the queue. It then starts processing it which
> takes several hours to complete.
>

Perhaps this is a key point.


> In the meantime, the connection is dropped off due to timeout. Once the
> processing is complete, the worker tries to send ACK. While doing so, it
> fails with the error below and the worker shuts down.
>
> render_jobs_consumer - INFO -
> tableau-classic-admin0-borders-en-us-extent-101.mbtiles published for
> merging
> render_jobs_consumer - INFO -
> tableau-classic-admin0-borders-en-us-extent-101.mbtiles rendering completed
> in 334.802966833. Sending acknowledgement
>
>
I think this shows it takes over 5 minutes to process a message. If
heartbeats are less than that, it will time out unless your consumer app
that is doing rendering is making pika process data events.

Since pika is not running in a thread or isolated runtime, the things your
consumer does impact its ability to read and respond to frames from
RabbitMQ.

Quick fix is most likely to turn heartbeats off (forcing a heartbeat=0 in
your connection parameters) or set it to 4-5x your average processing time.


> pika.adapters.base_connection - ERROR - Read empty data, calling disconnect
> pika.adapters.base_connection - WARNING - Unknown state on disconnect: 5
> pika.connection - WARNING - Disconnected from RabbitMQ at
> 192.168.2.182:5672 (0):
> pika.adapters.select_connection - INFO - Unregistering poller on fd 3
>
>
Please let us know if this addresses your issue,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130308/9ac227db/attachment.htm>

From Scott.Chapman at servicenow.com  Fri Mar  8 21:51:02 2013
From: Scott.Chapman at servicenow.com (Scott Chapman)
Date: Fri, 8 Mar 2013 21:51:02 +0000
Subject: [rabbitmq-discuss] Turning off prefetch in the
 asynchronous_consumer_example
In-Reply-To: <513A3A80.3090900@rabbitmq.com>
Message-ID: <5a13b591-2a03-463d-b653-092208ea6135@SJC4EXHTCAS01.corp.service-now.com>

I did not expect to see any in unacknowledged state.

So if my consumer dies and that message is there in unpack state and I
restart the client, will it grab that message or will it do something else?

Scott

On 3/8/13 11:22 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Scott,
>
>On 08/03/13 19:02, Scott Chapman wrote:
>> I don?t want it to "check out the message". That's prefetching. I want
>> it to leave the message alone until it's ready to be processed.
>
>If the prefetch count is set to 1 then you should see at most one
>unacknowledged message when looking at a channel in the management UI /
>with rabbitmqctl.
>
>Check in the management UI, or with 'rabbitmqctl list_channels name
>prefetch_count', whether your basic.qos prefetch setting is taking effect.
>
>Matthias.


From nishanth at urbanmapping.com  Fri Mar  8 21:52:17 2013
From: nishanth at urbanmapping.com (Nishanth Babu Achuthan)
Date: Fri, 8 Mar 2013 13:52:17 -0800
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <CAKwdTWdGN0idPVoiwb2VswHZUpb+rprAg-bUb7vAmFEg1ndrhw@mail.gmail.com>
References: <5139B5BC.5030404@rabbitmq.com>
	<CD5F7169.86BB%Michael.Laing@nytimes.com>
	<CACkkimmgs4ge3Mij5wxrDB9bvq34q352tLhmpKBuuhzOMsrAKQ@mail.gmail.com>
	<D697A60108BC4649818263D60CB973CF@meetme.com>
	<CACkkimmfEoxEJNKhZT=p7b7_5Wd+Uyb=-3_H2kbBWb=SvJaThw@mail.gmail.com>
	<CAKwdTWdGN0idPVoiwb2VswHZUpb+rprAg-bUb7vAmFEg1ndrhw@mail.gmail.com>
Message-ID: <CACkkimnGouDs55uBRWM=FoSTZE3L6-7PgVoDWXbVbXL976sAuQ@mail.gmail.com>

Hi Roy,

Typical job processing time is 24 hours. I set up heartbeat_interval =
432000 (5 days) . When I tried this earlier, connection dropped off
approximately after 10 mins.

I tried with heartbeat=0 and looks like it is working. I find the
connection active after 90 minutes since the message processing started.

I am now testing with jobs that would take about 1-2 days to complete
processing. Will update you once the testing is complete.

Thank you so much for your help!

Nishanth


On Fri, Mar 8, 2013 at 12:13 PM, Gavin M. Roy <gmr at meetme.com> wrote:

>
> On Fri, Mar 8, 2013 at 2:59 PM, Nishanth Babu Achuthan <
> nishanth at urbanmapping.com> wrote:
>
>> Hi Roy,
>>
>> I am not using time.sleep in my app.
>>
>> Worker consumes message from the queue. It then starts processing it
>> which takes several hours to complete.
>>
>
> Perhaps this is a key point.
>
>
>> In the meantime, the connection is dropped off due to timeout. Once the
>> processing is complete, the worker tries to send ACK. While doing so, it
>> fails with the error below and the worker shuts down.
>>
>> render_jobs_consumer - INFO -
>> tableau-classic-admin0-borders-en-us-extent-101.mbtiles published for
>> merging
>> render_jobs_consumer - INFO -
>> tableau-classic-admin0-borders-en-us-extent-101.mbtiles rendering completed
>> in 334.802966833. Sending acknowledgement
>>
>>
> I think this shows it takes over 5 minutes to process a message. If
> heartbeats are less than that, it will time out unless your consumer app
> that is doing rendering is making pika process data events.
>
> Since pika is not running in a thread or isolated runtime, the things your
> consumer does impact its ability to read and respond to frames from
> RabbitMQ.
>
> Quick fix is most likely to turn heartbeats off (forcing a heartbeat=0 in
> your connection parameters) or set it to 4-5x your average processing time.
>
>
>> pika.adapters.base_connection - ERROR - Read empty data, calling
>> disconnect
>> pika.adapters.base_connection - WARNING - Unknown state on disconnect: 5
>> pika.connection - WARNING - Disconnected from RabbitMQ at
>> 192.168.2.182:5672 (0):
>> pika.adapters.select_connection - INFO - Unregistering poller on fd 3
>>
>>
> Please let us know if this addresses your issue,
>
> Gavin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130308/6fd1f9bf/attachment.htm>

From matthias at rabbitmq.com  Fri Mar  8 22:40:45 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Mar 2013 22:40:45 +0000
Subject: [rabbitmq-discuss] Turning off prefetch in the
	asynchronous_consumer_example
In-Reply-To: <5a13b591-2a03-463d-b653-092208ea6135@SJC4EXHTCAS01.corp.service-now.com>
References: <5a13b591-2a03-463d-b653-092208ea6135@SJC4EXHTCAS01.corp.service-now.com>
Message-ID: <513A68ED.80402@rabbitmq.com>

Scott,

On 08/03/13 21:51, Scott Chapman wrote:
> I did not expect to see any in unacknowledged state.

Unacked messages are messages that have been sent to a consumer but not 
yet acknowledged. The prefetch count puts an upper bound on the number 
of such messages sent on a given channel.

> So if my consumer dies and that message is there in unack state and I
> restart the client, will it grab that message

Yes. Unless there are other consumers on the same queue that grab that 
message first.

Matthias.

From carl.hoerberg at gmail.com  Sat Mar  9 13:24:01 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sat, 9 Mar 2013 05:24:01 -0800 (PST)
Subject: [rabbitmq-discuss] 3.0.3 upgrade problems
Message-ID: <1362835441863-25356.post@n5.nabble.com>

Tried to do a rolling upgrade on a 3.0.2 cluster, the normal apt-get upgrade
procedure, but the node1 got stuck at "starting adding mirrors to queues",
for hours, and node2 which is still alive doesn't respond to any rabbitmqctl
commands. Nothing unusual in the logs.. Erlang 14B02. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-0-3-upgrade-problems-tp25356.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Sat Mar  9 13:40:41 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sat, 9 Mar 2013 05:40:41 -0800 (PST)
Subject: [rabbitmq-discuss] 3.0.3 upgrade problems
In-Reply-To: <1362835441863-25356.post@n5.nabble.com>
References: <1362835441863-25356.post@n5.nabble.com>
Message-ID: <1362836441790-25357.post@n5.nabble.com>

after a restart of node2, node1 was able to start too.. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-0-3-upgrade-problems-tp25356p25357.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From timrobertson100 at gmail.com  Sat Mar  9 16:03:53 2013
From: timrobertson100 at gmail.com (Tim Robertson)
Date: Sat, 9 Mar 2013 17:03:53 +0100
Subject: [rabbitmq-discuss] Huge queues - memory alarm going off
Message-ID: <CAMsy_NhTyEoiukBV2D6c_qN-qrbtEjcZ7=KGqsegeO6st4QKUw@mail.gmail.com>

Hi all,

I've got the following going on (version 2.8.4):

- My consumers all stop (e.g. imagine a failure scenario / upgrade), but
producers keep on producing
- Queues start backing up
- Memory increases with queue size
- The high water mark gets hit and the node memory alarm goes off

There are a couple of things I'd like to understand that I can't seem to
find in the docs:

- with this being a durable queue, I anticipated RMQ would flush to disk
and free memory.  Could someone please explain the memory overhead for
messages sitting on a queue?  I guess there is a something in memory for
each message on a queue - is there a way to work around that? (we
anticipate deliberately getting into this state from time to time, when we
e.g. upgrade HBase)

- I'm kind of in a deadlock I think now as when the consumers start, they
won't ack a message until they have successfully sent a message on (it's a
multihop process) but that is blocked.  Should the per connection flow
control not have kicked in and blocked the producers before the whole lot
just blocked?  (have I missed some setting to enable that, as the docs say
it is on by default).

Also please know I am a newbie, running on default config, so please don't
be shy at pointing out the obvious to me.  Chances are I could have missed
something, but I did try and read all the docs before posting.

Thanks for any pointers!
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130309/cf11af69/attachment.htm>

From sapelzin at icontrol.com  Sat Mar  9 14:46:41 2013
From: sapelzin at icontrol.com (sapelzin at icontrol.com)
Date: Sat, 9 Mar 2013 06:46:41 -0800 (PST)
Subject: [rabbitmq-discuss] Low impact statistics gathering for queues
Message-ID: <dfed3b04-c5df-4fc2-bda3-2199525b8b4a@googlegroups.com>

Hello,

Our application can utilize a lot of queues, as many as 100k.  We would 
like to regularly query a queue count, and message counts for specific 
queues.  The overhead for calling rabbitmqctl -list_queues with a large 
number of queues is too high.  Is there an alternative for just querying 
the stats we need?

Thank you,
stew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130309/68360fa7/attachment.htm>

From jerryk at rbcon.com  Sat Mar  9 21:33:56 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Sat, 9 Mar 2013 13:33:56 -0800
Subject: [rabbitmq-discuss] Huge queues - memory alarm going off
In-Reply-To: <CAMsy_NhTyEoiukBV2D6c_qN-qrbtEjcZ7=KGqsegeO6st4QKUw@mail.gmail.com>
References: <CAMsy_NhTyEoiukBV2D6c_qN-qrbtEjcZ7=KGqsegeO6st4QKUw@mail.gmail.com>
Message-ID: <CAE0Sz=xRrgX9tdTh8QCnWzOMKxHpEo4V-HGYQ3f--jQfvhORpw@mail.gmail.com>

Hi, Tim:

I've got the following going on (version 2.8.4):

>
> - My consumers all stop (e.g. imagine a failure scenario / upgrade), but
> producers keep on producing
> - Queues start backing up
> - Memory increases with queue size
> - The high water mark gets hit and the node memory alarm goes off
>

So far, that's all what's supposed to happen.  The idea is that if the
broker has a lot of messages stacking up in memory then, regardless of
whether you asked for them to be durable or not, it will move them to the
disk to free up RAM and avoid Erlang VM GC or allocation failure disasters
that might occur due to RAM exhaustion.


> - with this being a durable queue, I anticipated RMQ would flush to disk
> and free memory.
>

One thing to note:  If the broker is under severe memory pressure, the
pushing of messages to disk will happen regardless of the queue's
durability status (also, recall that the description *durable queue* just
means that the queue's definition will survive a broker restart, it doesn't
by itself guarantee anything about the queue's *contained messages*) or
whether you published the messages with the persistent delivery mode set.


>  Could someone please explain the memory overhead for messages sitting on
> a queue?
>

The body of the message itself, plus some bookkeeping overhead the broker
uses to keep track of it.


>  I guess there is a something in memory for each message on a queue - is
> there a way to work around that? (we anticipate deliberately getting into
> this state from time to time, when we e.g. upgrade HBase)
>

Yes, the message itself will be in memory unless it's swapped out.  Indeed,
even if the message is swapped out due to memory pressure there's a tiny
bit of overhead corresponding to it that lurks in the Erlang Term Service
store that Rabbit uses...  in rare cases this latter overhead can cause
grief on its own, if things are allowed to stay out of balance too long.

As for something being in memory for each message on a queue, modulo the
ETS bit that you can't do anything about, the ways to work around this are
to:

   - Let the broker swap messages out to disk in order to get below the
   configured memory watermark, at which point the TCP back pressure that will
   be stiff arming publishers will relent and they'll start publishing again
   - Catch up on consuming your messages, perhaps by starting more
   consumers in response to the demand

- I'm kind of in a deadlock I think now as when the consumers start, they
> won't ack a message until they have successfully sent a message on (it's a
> multihop process) but that is blocked.  Should the per connection flow
> control not have kicked in and blocked the producers before the whole lot
> just blocked?  (have I missed some setting to enable that, as the docs say
> it is on by default).
>

Are these consumers doing something else with the message before
republishing it, say taking some real world action or doing something to a
database elsewhere?  If your app design has a case where publishes could be
blocked (say due to over eager producers, or failure or slowdown of
consumers) you might consider doing something like making your routing
fabric a bit richer so that virtual copies of the message might move around
in the broker without an explicit consume/do-stuff/ack/re-publish cycle
which, as you point out, can get jammed up if the re-publishes are being
held.  That said, modulo the rare ETS catastrophe, the broker's default
swapping mechanism should catch up and obviate some of the memory pressure
that's causing the trouble.

Does that make sense?

BTW, there's a nice description of what various entities in Rabbit cost in
the Manning book "RabbitMQ in Action," in Chapter 11, IIRC.  Giving that a
read will be very helpful for building intuition on what happens where,
what it costs, etc...

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130309/63734e12/attachment.htm>

From timrobertson100 at gmail.com  Sun Mar 10 12:14:04 2013
From: timrobertson100 at gmail.com (Tim Robertson)
Date: Sun, 10 Mar 2013 13:14:04 +0100
Subject: [rabbitmq-discuss] Huge queues - memory alarm going off
In-Reply-To: <CAE0Sz=xRrgX9tdTh8QCnWzOMKxHpEo4V-HGYQ3f--jQfvhORpw@mail.gmail.com>
References: <CAMsy_NhTyEoiukBV2D6c_qN-qrbtEjcZ7=KGqsegeO6st4QKUw@mail.gmail.com>
	<CAE0Sz=xRrgX9tdTh8QCnWzOMKxHpEo4V-HGYQ3f--jQfvhORpw@mail.gmail.com>
Message-ID: <CAMsy_NjLWwpWzkQbsK6K=nYh0iwYgn_EmgeXVsjpOUZtXDmfhg@mail.gmail.com>

Thanks for taking the time for the detailed response Jerry,

Regarding the deadlock it makes good sense to rethink that scenario along
the lines that you suggest.

I've read the chapter 11 having downloaded the ebook version, and if I
understand correctly then, it is really not good practice to deliberately
use RMQ as a large buffering technology for queues, due to the memory
management.  Namely, that if one queue is hugely backed up, we'll get into
a oscillation of:
  i) memory limit hit
  ii) block everything while flush partially to disk
  iii) repeat immediately (while the disabled consumer remains)
While it will work, we'll likely cripple other parts of the system if they
are going through the same broker.

I think this was probably a lack of understanding on our part, as we
anticipated using it as a queue (to do large buffering) whereas I presume
it is (?) really intended to be a messaging system and targeting zero queue
sizes is the expected behavior (consumer throughput matched to producer).

Are there alternative configurations that you are aware of that would allow
it to back up large queues, without hitting memory limits?  (the tokyo
cabinet plugin perhaps?)

We can work around this in our design of course by either swapping out to
another messaging/queuing system completely, or having consumers that pull
from Rabbit and then back up a buffer in another queue (perhaps Kafka or
similar).

Thanks,
Tim




On Sat, Mar 9, 2013 at 10:33 PM, Jerry Kuch <jerryk at rbcon.com> wrote:

> Hi, Tim:
>
> I've got the following going on (version 2.8.4):
>
>>
>> - My consumers all stop (e.g. imagine a failure scenario / upgrade), but
>> producers keep on producing
>> - Queues start backing up
>> - Memory increases with queue size
>> - The high water mark gets hit and the node memory alarm goes off
>>
>
> So far, that's all what's supposed to happen.  The idea is that if the
> broker has a lot of messages stacking up in memory then, regardless of
> whether you asked for them to be durable or not, it will move them to the
> disk to free up RAM and avoid Erlang VM GC or allocation failure disasters
> that might occur due to RAM exhaustion.
>
>
>> - with this being a durable queue, I anticipated RMQ would flush to disk
>> and free memory.
>>
>
> One thing to note:  If the broker is under severe memory pressure, the
> pushing of messages to disk will happen regardless of the queue's
> durability status (also, recall that the description *durable queue* just
> means that the queue's definition will survive a broker restart, it doesn't
> by itself guarantee anything about the queue's *contained messages*) or
> whether you published the messages with the persistent delivery mode set.
>
>
>>  Could someone please explain the memory overhead for messages sitting on
>> a queue?
>>
>
> The body of the message itself, plus some bookkeeping overhead the broker
> uses to keep track of it.
>
>
>>  I guess there is a something in memory for each message on a queue - is
>> there a way to work around that? (we anticipate deliberately getting into
>> this state from time to time, when we e.g. upgrade HBase)
>>
>
> Yes, the message itself will be in memory unless it's swapped out.
>  Indeed, even if the message is swapped out due to memory pressure there's
> a tiny bit of overhead corresponding to it that lurks in the Erlang Term
> Service store that Rabbit uses...  in rare cases this latter overhead can
> cause grief on its own, if things are allowed to stay out of balance too
> long.
>
> As for something being in memory for each message on a queue, modulo the
> ETS bit that you can't do anything about, the ways to work around this are
> to:
>
>    - Let the broker swap messages out to disk in order to get below the
>    configured memory watermark, at which point the TCP back pressure that will
>    be stiff arming publishers will relent and they'll start publishing again
>    - Catch up on consuming your messages, perhaps by starting more
>    consumers in response to the demand
>
> - I'm kind of in a deadlock I think now as when the consumers start, they
>> won't ack a message until they have successfully sent a message on (it's a
>> multihop process) but that is blocked.  Should the per connection flow
>> control not have kicked in and blocked the producers before the whole lot
>> just blocked?  (have I missed some setting to enable that, as the docs say
>> it is on by default).
>>
>
> Are these consumers doing something else with the message before
> republishing it, say taking some real world action or doing something to a
> database elsewhere?  If your app design has a case where publishes could be
> blocked (say due to over eager producers, or failure or slowdown of
> consumers) you might consider doing something like making your routing
> fabric a bit richer so that virtual copies of the message might move around
> in the broker without an explicit consume/do-stuff/ack/re-publish cycle
> which, as you point out, can get jammed up if the re-publishes are being
> held.  That said, modulo the rare ETS catastrophe, the broker's default
> swapping mechanism should catch up and obviate some of the memory pressure
> that's causing the trouble.
>
> Does that make sense?
>
> BTW, there's a nice description of what various entities in Rabbit cost in
> the Manning book "RabbitMQ in Action," in Chapter 11, IIRC.  Giving that a
> read will be very helpful for building intuition on what happens where,
> what it costs, etc...
>
> Best regards,
> Jerry
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130310/6a16e03d/attachment.htm>

From matthias at rabbitmq.com  Sun Mar 10 13:17:33 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 10 Mar 2013 13:17:33 +0000
Subject: [rabbitmq-discuss] Huge queues - memory alarm going off
In-Reply-To: <CAMsy_NjLWwpWzkQbsK6K=nYh0iwYgn_EmgeXVsjpOUZtXDmfhg@mail.gmail.com>
References: <CAMsy_NhTyEoiukBV2D6c_qN-qrbtEjcZ7=KGqsegeO6st4QKUw@mail.gmail.com>
	<CAE0Sz=xRrgX9tdTh8QCnWzOMKxHpEo4V-HGYQ3f--jQfvhORpw@mail.gmail.com>
	<CAMsy_NjLWwpWzkQbsK6K=nYh0iwYgn_EmgeXVsjpOUZtXDmfhg@mail.gmail.com>
Message-ID: <513C87ED.4030301@rabbitmq.com>

Tim,

On 10/03/13 12:14, Tim Robertson wrote:
> it is really not good practice to
> deliberately use RMQ as a large buffering technology for queues, due to
> the memory management.  Namely, that if one queue is hugely backed up,
> we'll get into a oscillation of:
>    i) memory limit hit
>    ii) block everything while flush partially to disk
>    iii) repeat immediately (while the disabled consumer remains)
> While it will work, we'll likely cripple other parts of the system if
> they are going through the same broker.

Rabbit will start paging to disk *before* the memory limit is hit, in 
order to prevent precisely the stop-start scenario you describe above.

Obviously if the publishing happens at a faster rate than rabbit can 
write to disk then eventually the memory limit will still be hit and 
producers blocked while rabbit catches up.

Furthermore, as Jerry says, messages do have a non-zero memory footprint 
even when paged to disk. As a consequence, when "filling" rabbit with 
messages, the paging becomes more and more aggressive over time to the 
point where all memory is taken up by the residual footprint of paged 
messages, and publishing even a small number of messages will trigger a 
memory alarm. And eventually *all* memory is consumed that way and 
publishers are blocked indefinitely until some messages are removed from 
the queues.

> I think this was probably a lack of understanding on our part, as we
> anticipated using it as a queue (to do large buffering) whereas I
> presume it is (?) really intended to be a messaging system and targeting
> zero queue sizes is the expected behavior (consumer throughput matched
> to producer).

We used to say that "an empty rabbit is a healthy rabbit", but that 
statement predates many improvements to persistence and flow-control 
that have happened since. So nowadays I'd rephrase that as "a non-obese 
rabbit is a healthy rabbit".

> Are there alternative configurations that you are aware of that would
> allow it to back up large queues, without hitting memory limits?  (the
> tokyo cabinet plugin perhaps?)

Exactly that. With the tokyo cabinet plugin, messages that have been 
paged to disk leave zero memory footprint, allowing rabbit to hold on to 
as much message data as will fit on disk.

Note however that the plugin is rarely used and is not included in our 
distributions due to the dependency on non-Erlang, platform-specific code.

Alternatively, increase the amount of memory on your rabbit machine.

Regards,

Matthias.

From timrobertson100 at gmail.com  Sun Mar 10 13:28:29 2013
From: timrobertson100 at gmail.com (Tim Robertson)
Date: Sun, 10 Mar 2013 14:28:29 +0100
Subject: [rabbitmq-discuss] Huge queues - memory alarm going off
In-Reply-To: <513C87ED.4030301@rabbitmq.com>
References: <CAMsy_NhTyEoiukBV2D6c_qN-qrbtEjcZ7=KGqsegeO6st4QKUw@mail.gmail.com>
	<CAE0Sz=xRrgX9tdTh8QCnWzOMKxHpEo4V-HGYQ3f--jQfvhORpw@mail.gmail.com>
	<CAMsy_NjLWwpWzkQbsK6K=nYh0iwYgn_EmgeXVsjpOUZtXDmfhg@mail.gmail.com>
	<513C87ED.4030301@rabbitmq.com>
Message-ID: <CAMsy_Ngm=8NV8M=uUM2bquWtKj1eG7rUw8SQU6AokmWNVweguQ@mail.gmail.com>

Thanks Matthias,

Knowing that the tokyo plugin is not often used is useful info.  I've spent
the weekend reading as much as I can and some of the blogs on the rabbit
site [e.g. 1,2 were particularly useful].  I don't claim to get all this,
but I think I am beginning to get a general understanding and realising we
do indeed need a buffer to decouple those consumers that we know are
inherently slow or will be taken offline periodically (e.g. the map tile
renderers which are maintaining Billions of tiles in HBase in large
queue-draining batch operations).

Really appreciate the helpful pointers from both you and Jerry - cheers
guys,
Tim

[1]
http://www.rabbitmq.com/blog/2012/04/25/rabbitmq-performance-measurements-part-2/
[2]
http://www.rabbitmq.com/blog/2011/10/27/performance-of-queues-when-less-is-more/

On Sun, Mar 10, 2013 at 2:17 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Tim,
>
>
> On 10/03/13 12:14, Tim Robertson wrote:
>
>> it is really not good practice to
>> deliberately use RMQ as a large buffering technology for queues, due to
>> the memory management.  Namely, that if one queue is hugely backed up,
>> we'll get into a oscillation of:
>>    i) memory limit hit
>>    ii) block everything while flush partially to disk
>>    iii) repeat immediately (while the disabled consumer remains)
>> While it will work, we'll likely cripple other parts of the system if
>> they are going through the same broker.
>>
>
> Rabbit will start paging to disk *before* the memory limit is hit, in
> order to prevent precisely the stop-start scenario you describe above.
>
> Obviously if the publishing happens at a faster rate than rabbit can write
> to disk then eventually the memory limit will still be hit and producers
> blocked while rabbit catches up.
>
> Furthermore, as Jerry says, messages do have a non-zero memory footprint
> even when paged to disk. As a consequence, when "filling" rabbit with
> messages, the paging becomes more and more aggressive over time to the
> point where all memory is taken up by the residual footprint of paged
> messages, and publishing even a small number of messages will trigger a
> memory alarm. And eventually *all* memory is consumed that way and
> publishers are blocked indefinitely until some messages are removed from
> the queues.
>
>
>  I think this was probably a lack of understanding on our part, as we
>> anticipated using it as a queue (to do large buffering) whereas I
>> presume it is (?) really intended to be a messaging system and targeting
>> zero queue sizes is the expected behavior (consumer throughput matched
>> to producer).
>>
>
> We used to say that "an empty rabbit is a healthy rabbit", but that
> statement predates many improvements to persistence and flow-control that
> have happened since. So nowadays I'd rephrase that as "a non-obese rabbit
> is a healthy rabbit".
>
>
>  Are there alternative configurations that you are aware of that would
>> allow it to back up large queues, without hitting memory limits?  (the
>> tokyo cabinet plugin perhaps?)
>>
>
> Exactly that. With the tokyo cabinet plugin, messages that have been paged
> to disk leave zero memory footprint, allowing rabbit to hold on to as much
> message data as will fit on disk.
>
> Note however that the plugin is rarely used and is not included in our
> distributions due to the dependency on non-Erlang, platform-specific code.
>
> Alternatively, increase the amount of memory on your rabbit machine.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130310/80ffaeca/attachment.htm>

From napylov at mail.ru  Mon Mar 11 08:58:19 2013
From: napylov at mail.ru (AlexanderN)
Date: Mon, 11 Mar 2013 01:58:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Plugin rabbitmq-auth-backend-http receiving
 "allow *" from web-server, but authorization is not successful.
In-Reply-To: <5138B032.3090009@rabbitmq.com>
References: <1362651022855-25308.post@n5.nabble.com>
	<5138B032.3090009@rabbitmq.com>
Message-ID: <1362992299366-25364.post@n5.nabble.com>

rabbitmq-auth-backend-http don't sending request to
http://127.0.0.1:84/auth/vhost.php

For testing of script I use Wget for send request.
If user have access to vhost, vhost.php returning "allow", else it returning
"deny".

I uncomment line 92 of rabbit_auth_backend_http.erl.
On output written
Q: "http://127.0.0.1:84/auth/user.php?username=user&password=pass"


Then I add logging to line 83.

78            case Code of
79                200 -> case parse_resp(Body) of
80                           {error, _} = E -> E;
81                           Resp           -> Resp
82                       end,
83                       error_logger:error_msg("200!", Code, Body);
84                _   -> {error, {Code, Body}}
85
86            end;

In RabbitMQ log was written:

=ERROR REPORT==== 11-Mar-2013::12:08:21 ===
closing AMQP connection <0.297.0> (127.0.0.1:34533 -> 127.0.0.1:5672):
{handshake_error,starting,0,
    {error,undef,'connection.start_ok',
        [{error_logger,error_msg,["200!",200,"allow *"],[]},
         {rabbit_auth_backend_http,check_user_login,2,
             [{file,"src/rabbit_auth_backend_http.erl"},{line,37}]},
         {rabbit_access_control,'-check_user_login/2-fun-0-',4,[]},
         {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
         {rabbit_reader,auth_phase,2,[]},
         {rabbit_reader,handle_method0,3,[]},
         {rabbit_reader,handle_input,3,[]},
         {rabbit_reader,recvloop,2,[]}]}}




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Plugin-rabbitmq-auth-backend-http-receiving-allow-from-web-server-but-authorization-is-not-successfu-tp25308p25364.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Mon Mar 11 09:41:52 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 11 Mar 2013 09:41:52 +0000
Subject: [rabbitmq-discuss] Plugin rabbitmq-auth-backend-http receiving
	"allow *" from web-server, but authorization is not successful.
In-Reply-To: <1362992299366-25364.post@n5.nabble.com>
References: <1362651022855-25308.post@n5.nabble.com>
	<5138B032.3090009@rabbitmq.com>
	<1362992299366-25364.post@n5.nabble.com>
Message-ID: <100B088E-54C6-4195-9886-F5F8DB2BCEEB@rabbitmq.com>

Alexander,

On 11 Mar 2013, at 08:58, AlexanderN wrote:
> Then I add logging to line 83.
> 83                       error_logger:error_msg("200!", Code, Body);

error_logger:error_msg takes 2 arguments, not 3. Try this instead: `error_logger:error_msg("Response ~p: ~p~n", [Code, Body]);'


From napylov at mail.ru  Mon Mar 11 10:01:50 2013
From: napylov at mail.ru (AlexanderN)
Date: Mon, 11 Mar 2013 03:01:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Plugin rabbitmq-auth-backend-http receiving
 "allow *" from web-server, but authorization is not successful.
In-Reply-To: <100B088E-54C6-4195-9886-F5F8DB2BCEEB@rabbitmq.com>
References: <1362651022855-25308.post@n5.nabble.com>
	<5138B032.3090009@rabbitmq.com>
	<1362992299366-25364.post@n5.nabble.com>
	<100B088E-54C6-4195-9886-F5F8DB2BCEEB@rabbitmq.com>
Message-ID: <1362996110567-25366.post@n5.nabble.com>

Thanks, Tim.

I never used the Erlang.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Plugin-rabbitmq-auth-backend-http-receiving-allow-from-web-server-but-authorization-is-not-successfu-tp25308p25366.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Mon Mar 11 10:43:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 11 Mar 2013 10:43:30 +0000
Subject: [rabbitmq-discuss] Low impact statistics gathering for queues
In-Reply-To: <dfed3b04-c5df-4fc2-bda3-2199525b8b4a@googlegroups.com>
References: <dfed3b04-c5df-4fc2-bda3-2199525b8b4a@googlegroups.com>
Message-ID: <513DB552.9030704@rabbitmq.com>


Hi,

On 09/03/13 14:46, sapelzin at icontrol.com wrote:
> Our application can utilize a lot of queues, as many as 100k.  We would
> like to regularly query a queue count, and message counts for specific
> queues.  The overhead for calling rabbitmqctl -list_queues with a large
> number of queues is too high.  Is there an alternative for just querying
> the stats we need?

You can get a quick queue count with this command:

rabbitmqctl eval 'mnesia:table_info(rabbit_queue, size).'

rabbitmqctl is not the best way of getting the message count for just a
few queues if there are many queues, because it will query all queues.
If the queue permissions and parameters allow it then it may be possible
to get this information by using an AMQP library and the passive queue
declare method, which reports message count:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok

The management plugin can also be used to obtain this information using
the HTTP API. For details see http://www.rabbitmq.com/management.html
and the HTTP API documentation linked from there.


It is possible to use a complicated rabbitmqctl eval parameter to return
the number of messages in a particular queue (queue_name in this
example), but this is a fragile option that is may stop working when you
upgrade:

rabbitmqctl eval '{ok, [{messages, Count}]} =
rabbit_amqqueue:with(rabbit_misc:r(<<"/">>, queue, <<"queue_name">>),
fun(Q) ->  gen_server2:call(element(7, Q), {info, [messages]}) end), Count.'





-Emile






From simon at rabbitmq.com  Mon Mar 11 10:51:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Mar 2013 10:51:49 +0000
Subject: [rabbitmq-discuss] Low impact statistics gathering for queues
In-Reply-To: <513DB552.9030704@rabbitmq.com>
References: <dfed3b04-c5df-4fc2-bda3-2199525b8b4a@googlegroups.com>
	<513DB552.9030704@rabbitmq.com>
Message-ID: <513DB745.3070307@rabbitmq.com>

On 11/03/13 10:43, Emile Joubert wrote:
> The management plugin can also be used to obtain this information using
> the HTTP API. For details see http://www.rabbitmq.com/management.html
> and the HTTP API documentation linked from there.

This is perhaps the key point. Whereas rabbitmqctl list_queues will go 
and synchronously communicate with each queue in the list, the 
management API maintains its own database of queue information based on 
events that queues emit, so querying the management API is cheaper.

There are still costs associated; generating a large JSON document is 
surprisingly expensive, so limiting the number of columns you request 
when listing all queues can help quite a bit.

Furthermore the management API lets you query details for individual queues.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Mon Mar 11 12:00:58 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 11 Mar 2013 12:00:58 +0000
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <CACkkimnGouDs55uBRWM=FoSTZE3L6-7PgVoDWXbVbXL976sAuQ@mail.gmail.com>
References: <5139B5BC.5030404@rabbitmq.com>
	<CD5F7169.86BB%Michael.Laing@nytimes.com>
	<CACkkimmgs4ge3Mij5wxrDB9bvq34q352tLhmpKBuuhzOMsrAKQ@mail.gmail.com>
	<D697A60108BC4649818263D60CB973CF@meetme.com>
	<CACkkimmfEoxEJNKhZT=p7b7_5Wd+Uyb=-3_H2kbBWb=SvJaThw@mail.gmail.com>
	<CAKwdTWdGN0idPVoiwb2VswHZUpb+rprAg-bUb7vAmFEg1ndrhw@mail.gmail.com>
	<CACkkimnGouDs55uBRWM=FoSTZE3L6-7PgVoDWXbVbXL976sAuQ@mail.gmail.com>
Message-ID: <513DC77A.5090403@rabbitmq.com>

On 08/03/13 21:52, Nishanth Babu Achuthan wrote:
> Typical job processing time is 24 hours. I set up heartbeat_interval =
> 432000 (5 days) . When I tried this earlier, connection dropped off
> approximately after 10 mins.
>
> I tried with heartbeat=0 and looks like it is working. I find the
> connection active after 90 minutes since the message processing started.

Setting heartbeat=0 when connections are expected to be be idle for many 
hours seems less than ideal. The risk of the connection getting nuked by 
some idle-timeout on a firewall etc must be fairly high with such a setup.

Gavin, is there no better way to deal with this? Could an app perhaps 
invoke some pika API function at reasonably regular intervals that would 
deal with any inbound/outbound heartbeats received/due since the last 
invocation?

Regards,

Matthias.

From simlu at su.se  Mon Mar 11 12:54:10 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Mon, 11 Mar 2013 13:54:10 +0100
Subject: [rabbitmq-discuss] How to configure RabbitMQ cluster to get out
 of the scale.
In-Reply-To: <5139F4BF.6030509@rabbitmq.com>
References: <ffd0377c-e660-4663-b638-bd83470aff1c@googlegroups.com>
	<5139F4BF.6030509@rabbitmq.com>
Message-ID: <20130311125410.GB366@kaka.it.su.se>

On Fri, 2013-03-08 at 14:25:03 +0000, Simon MacMullen wrote:
> On 07/03/13 23:31, t.otoda.freemail at gmail.com wrote:
> >    If anyone know how to do re-balance of queues, please tell me.
> 
> This is something that comes up occasionally - in 3.1 it will be
> possible to manually migrate queues around by using the HA "nodes"
> policy, but doing so will involve deliberately making the queue fail
> over, with attendant consumer cancellation. It's possible something
> could be scripted on top of that for automatic queue balancing - is
> this something for which there would be demand?

Well, nicest thing would be for messages to be replicated out to the new
node (if that is the configured HA policy). But I get that this is
hardish and costly.

But having an API-function to be able to migrate all HA-queues from one
node to another node would be awesome when the need for maintenance or
upgrade comes up.

When using HA-queues CCN is a must anyway, right?

Br,
- Simon

____________________________________

Simon Lundstr?m

IT Services
Stockholm University
SE-106 91 Stockholm, Sweden

www.su.se/it

____________________________________

From mcintoshj at gmail.com  Mon Mar 11 14:16:19 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 11 Mar 2013 09:16:19 -0500
Subject: [rabbitmq-discuss] Performance tests and a warning on HIPE
In-Reply-To: <79C33499-637D-402C-9F48-99B7E2BA0B37@rabbitmq.com>
References: <B4A058E2-17EC-4669-B46E-286B9DDB8511@gmail.com>
	<5139EA51.8020200@rabbitmq.com>
	<877D18CC56424BE7B7ACBBBE19C5D33A@meetme.com>
	<79C33499-637D-402C-9F48-99B7E2BA0B37@rabbitmq.com>
Message-ID: <CAD6m6fE81Bh1+hqhhTdERYQmSU_bgS_YkS-007SrNeZD7G0ADQ@mail.gmail.com>

I'd love to be able to provide you more details but I've not gotten a crash
dump yet on any of the systems I've seen this (that's 3 in total, one VM,
two different physical boxes).  Any suggestions on how to get some more
data out of erlang/rabbit for this?

Thanks!
Jason


On Fri, Mar 8, 2013 at 9:58 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Can anyone assist with either reproducing this, or providing either an
> erlang crash_dump or (if the emulator dies 'badly' enough) a core dump? I
> would be very good to pass this on to the hipe team so they can figure out
> what's wrong and fix it for future releases. Using hipe can potentially
> improve performance a lot, so not being able to trust it when using rabbit
> under load is a real shame, but this won't get fixed unless we provide the
> hipe team with some tangible evidence they can use to investigate.
>
> Cheers,
> Tim
>
> On 8 Mar 2013, at 15:53, Gavin M. Roy wrote:
>
> >
> > On Friday, March 8, 2013 at 8:40 AM, Simon MacMullen wrote:
> >
> >>> Now for the warnings: 1) TURN OFF HIPE. This was testing with
> >>> Erlang R15B03 - the latest release and RabbitMQ 3.0.2. With HIPE and
> >>> the load we were putting on the system, Rabbit crashes bad, no
> >>> errors, no warning, it's just suddenly dead. It seems to happen a
> >>> few minutes into the load. I've not enabled any kind of debugging to
> >>> trace this down, but this was scary enough that we immediately turned
> >>> off HIPE everywhere.
> >>
> >> That certainly is scary, and unlike our experiences - we've generally
> >> seen HiPE crash immediately or work fine. I suspect the platform is an
> >> issue here. But yes, you should be cautious turning on HiPE in
> production...
> > This is my experience as well on both CentOS 5.3 and 6.3 with R15B0 (and
> previous versions) with all versions of RabbitMQ we run (Everything from
> 2.7.1 -> 3.0.2)
> >
> > Cheers,
> >
> > Gavin
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/4b4378d1/attachment.htm>

From mcintoshj at gmail.com  Mon Mar 11 14:18:13 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 11 Mar 2013 09:18:13 -0500
Subject: [rabbitmq-discuss] How does one handle a large amount of queues
 in the web interface?
In-Reply-To: <CAGrdgiVicD6me59XxMZMFWAbDhEahgqa_D6ajzo+AC7LZifyug@mail.gmail.com>
References: <CAGrdgiU1Utb7J5dEiuUZHQvnX8zTXxvFzOZSgR=aT6px1q_CHg@mail.gmail.com>
	<51360AB0.9040904@rabbitmq.com> <51375F02.9090504@rabbitmq.com>
	<CAGrdgiVicD6me59XxMZMFWAbDhEahgqa_D6ajzo+AC7LZifyug@mail.gmail.com>
Message-ID: <CAD6m6fHR-xM-KxsSjY4RBZYE9yTOjngus5z_As==Ky8PdU0b-Q@mail.gmail.com>

What we do at the moment is setup virtual hosts.  Makes it easier to at
least group queues/exchanges together.

Jason


On Wed, Mar 6, 2013 at 10:55 AM, Jesper Louis Andersen <
jesper.louis.andersen at gmail.com> wrote:

> This is awesome work, thank you so much!
>
>
> On Wed, Mar 6, 2013 at 4:21 PM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 05/03/13 15:09, Simon MacMullen wrote:
>>
>>> Yes, allowing pagination and / or filtering in the web UI has been on
>>> the TODO list for some time.
>>>
>>
>> And your mail prompted me to work on it, so RabbitMQ 3.1 will have some
>> list-filtering thing in the management plugin.
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
>
> --
> J.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/c22b4244/attachment.htm>

From tim at rabbitmq.com  Mon Mar 11 14:31:28 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 11 Mar 2013 14:31:28 +0000
Subject: [rabbitmq-discuss] Performance tests and a warning on HIPE
In-Reply-To: <CAD6m6fE81Bh1+hqhhTdERYQmSU_bgS_YkS-007SrNeZD7G0ADQ@mail.gmail.com>
References: <B4A058E2-17EC-4669-B46E-286B9DDB8511@gmail.com>
	<5139EA51.8020200@rabbitmq.com>
	<877D18CC56424BE7B7ACBBBE19C5D33A@meetme.com>
	<79C33499-637D-402C-9F48-99B7E2BA0B37@rabbitmq.com>
	<CAD6m6fE81Bh1+hqhhTdERYQmSU_bgS_YkS-007SrNeZD7G0ADQ@mail.gmail.com>
Message-ID: <3BE0A297-0616-413F-BD3E-90A700186823@rabbitmq.com>

Hi Jason,

On 11 Mar 2013, at 14:16, Jason McIntosh wrote:
> I'd love to be able to provide you more details but I've not gotten a crash dump yet on any of the systems I've seen this (that's 3 in total, one VM, two different physical boxes).  Any suggestions on how to get some more data out of erlang/rabbit for this?
> 

As you're not getting crash dump, I'd suggest going for a core dump of the emulator instead. First you'll want to try (not as root) to change the max core dump file size to unlimited

$ ulimit -c unlimited

That'll likely fail on permissions, then check, that you don't set ulimit -c 0 in any shell configuration files for the account under which the broker will run - this should be the rabbitmq user.

Globally enabling core dumps must be done as root, usually in /etc/security/limits.conf, e.g.,

# /etc/security/limits.conf
#
# Each line describes a limit for a user in the form:
#
# <domain> <type> <item> <value>
#
*  soft  core  unlimited

Note that there are other places you might need to look such as /etc/profile (on RHEL/OEL)

# No core files by default
# ulimit -S -c 0 > /dev/null 2>&1

... and /etc/init.d/functions (RHEL/OEL)

# make sure it doesn't core dump anywhere unless requested
# ulimit -S -c ${DAEMON_COREFILE_LIMIT:-0} >/dev/null 2>&1

And so on. You can check it has worked like so:

$ ulimit -a

core file size          (blocks, -c) unlimited
data seg size           (kbytes, -d) unlimited
[etc...]

To read the core properly, it might be necessary to get the binaries as well (i.e., beam.smp etc). Depending on how you've installed Erlang, that could be interesting, but we can cross that bridge when we come to it.

More likely than not, we'd be keen to get that whole core dump over to the OTP team, so in the first instance once if/when you've got a core dump just get in touch and we'll head over to the erlang-bugs list together and engage them from there. Bare in mind that a core dump may contain all manner of sensitive information. The OTP team will usually sign a relevant legal document to protect your rights if that's necessary.

Cheers,
Tim



From matthias at rabbitmq.com  Mon Mar 11 14:35:13 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 11 Mar 2013 14:35:13 +0000
Subject: [rabbitmq-discuss] Performance tests and a warning on HIPE
In-Reply-To: <CAD6m6fE81Bh1+hqhhTdERYQmSU_bgS_YkS-007SrNeZD7G0ADQ@mail.gmail.com>
References: <B4A058E2-17EC-4669-B46E-286B9DDB8511@gmail.com>
	<5139EA51.8020200@rabbitmq.com>
	<877D18CC56424BE7B7ACBBBE19C5D33A@meetme.com>
	<79C33499-637D-402C-9F48-99B7E2BA0B37@rabbitmq.com>
	<CAD6m6fE81Bh1+hqhhTdERYQmSU_bgS_YkS-007SrNeZD7G0ADQ@mail.gmail.com>
Message-ID: <513DEBA1.8080509@rabbitmq.com>

Jason,

On 11/03/13 14:16, Jason McIntosh wrote:
> I'd love to be able to provide you more details but I've not gotten a
> crash dump yet on any of the systems I've seen this (that's 3 in total,
> one VM, two different physical boxes).  Any suggestions on how to get
> some more data out of erlang/rabbit for this?

The lack of crash dumps might be due to a bug in R15B03, which was fixed 
in R15B03-1. See 
http://erlang.org/pipermail/erlang-questions/2012-December/071001.html.

However, I'd recommend testing with R16B; hipe is one area of Erlang/OTP 
which is improving in every release, so there is a fair chance that the 
problem you are running into has been fixed.

Regards,

Matthias.

From simon at rabbitmq.com  Mon Mar 11 14:53:40 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Mar 2013 14:53:40 +0000
Subject: [rabbitmq-discuss] Per-queue/exchange ACL via LDAP plugin
In-Reply-To: <1362761603852-25343.post@n5.nabble.com>
References: <1362698691958-25325.post@n5.nabble.com>
	<5139F382.4090705@rabbitmq.com>
	<1362761603852-25343.post@n5.nabble.com>
Message-ID: <513DEFF4.8080306@rabbitmq.com>

(By the way, that README is out of date, check 
http://www.rabbitmq.com/ldap.html now.)

On 08/03/13 16:53, SteveO wrote:
> Assuming I had local database users named Test1 and Test2, I could ensure
> that only user Test1 could consume from queues starting with the name
> "Test1" and only user Test2 could consume from queues starting with the name
> "Test2" by doing the following...
>
> rabbitmqctl set_permissions -p /myvhost Test1 ".*" ".*" "^Test1.*"
> rabbitmqctl set_permissions -p /myvhost Test2 ".*" ".*" "^Test2.*"
>
> Hopefully my understanding is correct. Please let me know if I am way off :)
> It seems to be working to my understanding with the tests I have ran.

Yes, that's correct.

> What I wanted to to do was apply similar logic when using LDAP A/A. If the
> user was matched by user_dn or by group membership, that's fine. I preferred
> the group membership, but would settle for user_dn.

Group membership is definitely problematic.

> The "Test1" queue name
> was certainly an example. If "Test1" was considered a prefix to the queue
> name or the queue name itself, that's fine as well.
>
> Under the "resource_access_query" section in the readme here...
>
> https://github.com/rabbitmq/rabbitmq-auth-backend-ldap/blob/master/README-authorisation
> <https://github.com/rabbitmq/rabbitmq-auth-backend-ldap/blob/master/README-authorisation>
>
> ...how does the ${name} parameter work? That's how I though I'd make this
> happen, but my attempts have flailed so far.

${name} will substitute in for the name of the resource being queried.

So something like this:

{resource_access_query,
  {for,
   [{resource, exchange, {constant, false}},
    {resource, queue,
     {for, [{permission, configure, {constant, false}},
            {permission, write,     {constant, false}},
            {permission, read,
             {match, {string, "${name}"}, {string, "^${username}.*"}}
            }
           ]}}
   ]}
}

might work for you. The first parameter to the {match} test is a string 
(in this case evaluating to the name of the queue), the second is a 
regular expression matching the username.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar 11 14:55:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Mar 2013 14:55:46 +0000
Subject: [rabbitmq-discuss] 3.0.3 upgrade problems
In-Reply-To: <1362835441863-25356.post@n5.nabble.com>
References: <1362835441863-25356.post@n5.nabble.com>
Message-ID: <513DF072.4080809@rabbitmq.com>

On 09/03/13 13:24, carlhoerberg wrote:
> Tried to do a rolling upgrade on a 3.0.2 cluster, the normal apt-get upgrade
> procedure, but the node1 got stuck at "starting adding mirrors to queues",
> for hours, and node2 which is still alive doesn't respond to any rabbitmqctl
> commands. Nothing unusual in the logs.. Erlang 14B02.

Hmm. I have tested this this and can't replicate (two 3.0.2 nodes with 
mirrored queues, upgrade one of them to 3.0.3). I will stare at the code 
to try to think of anything that could have caused this, but is there 
anything unusual in your use of mirrored queues?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tuure.laurinolli at portalify.com  Mon Mar 11 14:58:55 2013
From: tuure.laurinolli at portalify.com (Tuure Laurinolli)
Date: Mon, 11 Mar 2013 16:58:55 +0200
Subject: [rabbitmq-discuss] Unable to delete queues,
	purge messages etc. through admin
Message-ID: <DE0EB884-9B7F-4970-BFBE-2F3D8152E9F8@portalify.com>

Hi,

I have run into problems purging and deleting queues through rabbitmqadmin on one host. The error message shown on command line is pasted below. The system runs RabbitMQ 2.8.2.

iac-pgis:~ # ./rabbitmqadmin delete queue name=queue.taskmgr.location
Traceback (most recent call last):
  File "./rabbitmqadmin", line 828, in <module>
    main()
  File "./rabbitmqadmin", line 325, in main
    method()
  File "./rabbitmqadmin", line 485, in invoke_delete
    self.delete(uri)
  File "./rabbitmqadmin", line 357, in delete
    return self.http("DELETE", path, "")
  File "./rabbitmqadmin", line 386, in http
    % (resp.status, resp.reason, path, resp.read()))
Exception: Received 500 Internal Server Error for path /queues/%2F/queue.taskmgr.location
<html><head><title>500 Internal Server Error</title></head><body><h1>Internal Server Error</h1>The server encountered an error while processing this request:<br><pre>{error,
    {case_clause,
        {amqp_params_direct,<<"guest">>,<<"/">>,'rabbit at iac-pgis',none,[]}},
    [{amqp_connection,start,2,[]},
     {rabbit_mgmt_util,with_channel,5,[]},
     {webmachine_resource,resource_call,3,[]},
     {webmachine_resource,do,3,[]},
     {webmachine_decision_core,resource_call,1,[]},
     {webmachine_decision_core,decision,1,[]},
     {webmachine_decision_core,handle_request,2,[]},
     {rabbit_webmachine,'-makeloop/1-fun-0-',3,[]}]}</pre><P><HR><ADDRESS>mochiweb+webmachine web server</ADDRESS></body></html>

and the server logs only show the same information:

=ERROR REPORT==== 11-Mar-2013::16:54:29 ===
webmachine error: path="/api/queues/%2F/queue.taskmgr.location"
{error,
    {case_clause,
        {amqp_params_direct,<<"guest">>,<<"/">>,'rabbit at iac-pgis',none,[]}},
    [{amqp_connection,start,2,[]},
     {rabbit_mgmt_util,with_channel,5,[]},
     {webmachine_resource,resource_call,3,[]},
     {webmachine_resource,do,3,[]},
     {webmachine_decision_core,resource_call,1,[]},
     {webmachine_decision_core,decision,1,[]},
     {webmachine_decision_core,handle_request,2,[]},
     {rabbit_webmachine,'-makeloop/1-fun-0-',3,[]}]}

From carl.hoerberg at gmail.com  Mon Mar 11 15:00:56 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 11 Mar 2013 08:00:56 -0700 (PDT)
Subject: [rabbitmq-discuss] 3.0.3 upgrade problems
In-Reply-To: <513DF072.4080809@rabbitmq.com>
References: <1362835441863-25356.post@n5.nabble.com>
	<513DF072.4080809@rabbitmq.com>
Message-ID: <6052D8D752E0467AACF239688E0CD955@gmail.com>

don't think so, only that there's about 100 users and vhosts and about 1000 queues.



On Monday 11 March 2013 at 22:56, Simon MacMullen-2 [via RabbitMQ] wrote:

> On 09/03/13 13:24, carlhoerberg wrote: 
> > Tried to do a rolling upgrade on a 3.0.2 cluster, the normal apt-get upgrade 
> > procedure, but the node1 got stuck at "starting adding mirrors to queues", 
> > for hours, and node2 which is still alive doesn't respond to any rabbitmqctl 
> > commands. Nothing unusual in the logs.. Erlang 14B02. 
> 
> 
> Hmm. I have tested this this and can't replicate (two 3.0.2 nodes with 
> mirrored queues, upgrade one of them to 3.0.3). I will stare at the code 
> to try to think of anything that could have caused this, but is there 
> anything unusual in your use of mirrored queues? 
> 
> Cheers, Simon 
> 
> -- 
> Simon MacMullen 
> RabbitMQ, VMware 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=25376&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/3-0-3-upgrade-problems-tp25356p25376.html 
> To unsubscribe from 3.0.3 upgrade problems, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25356&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjUzNTZ8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/3-0-3-upgrade-problems-tp25356p25378.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/b80aace0/attachment.htm>

From simon at rabbitmq.com  Mon Mar 11 15:08:26 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Mar 2013 15:08:26 +0000
Subject: [rabbitmq-discuss] Unable to delete queues,
 purge messages etc. through admin
In-Reply-To: <DE0EB884-9B7F-4970-BFBE-2F3D8152E9F8@portalify.com>
References: <DE0EB884-9B7F-4970-BFBE-2F3D8152E9F8@portalify.com>
Message-ID: <513DF36A.9060102@rabbitmq.com>

Somehow you are running RabbitMQ server with a different, incompatible 
version of the RabbitMQ Erlang client loaded. We've seen this in two 
scenarios:

1) (Partially) self-compiled plugins mixed with a packaged server
2) SuSE linux (with the broken package "erlang-rabbitmq-client"
    installed)

Do either of those two sound like possibilities?

Cheers, Simon

On 11/03/13 14:58, Tuure Laurinolli wrote:
> Hi,
>
> I have run into problems purging and deleting queues through rabbitmqadmin on one host. The error message shown on command line is pasted below. The system runs RabbitMQ 2.8.2.
>
> iac-pgis:~ # ./rabbitmqadmin delete queue name=queue.taskmgr.location
> Traceback (most recent call last):
>    File "./rabbitmqadmin", line 828, in <module>
>      main()
>    File "./rabbitmqadmin", line 325, in main
>      method()
>    File "./rabbitmqadmin", line 485, in invoke_delete
>      self.delete(uri)
>    File "./rabbitmqadmin", line 357, in delete
>      return self.http("DELETE", path, "")
>    File "./rabbitmqadmin", line 386, in http
>      % (resp.status, resp.reason, path, resp.read()))
> Exception: Received 500 Internal Server Error for path /queues/%2F/queue.taskmgr.location
> <html><head><title>500 Internal Server Error</title></head><body><h1>Internal Server Error</h1>The server encountered an error while processing this request:<br><pre>{error,
>      {case_clause,
>          {amqp_params_direct,<<"guest">>,<<"/">>,'rabbit at iac-pgis',none,[]}},
>      [{amqp_connection,start,2,[]},
>       {rabbit_mgmt_util,with_channel,5,[]},
>       {webmachine_resource,resource_call,3,[]},
>       {webmachine_resource,do,3,[]},
>       {webmachine_decision_core,resource_call,1,[]},
>       {webmachine_decision_core,decision,1,[]},
>       {webmachine_decision_core,handle_request,2,[]},
>       {rabbit_webmachine,'-makeloop/1-fun-0-',3,[]}]}</pre><P><HR><ADDRESS>mochiweb+webmachine web server</ADDRESS></body></html>
>
> and the server logs only show the same information:
>
> =ERROR REPORT==== 11-Mar-2013::16:54:29 ===
> webmachine error: path="/api/queues/%2F/queue.taskmgr.location"
> {error,
>      {case_clause,
>          {amqp_params_direct,<<"guest">>,<<"/">>,'rabbit at iac-pgis',none,[]}},
>      [{amqp_connection,start,2,[]},
>       {rabbit_mgmt_util,with_channel,5,[]},
>       {webmachine_resource,resource_call,3,[]},
>       {webmachine_resource,do,3,[]},
>       {webmachine_decision_core,resource_call,1,[]},
>       {webmachine_decision_core,decision,1,[]},
>       {webmachine_decision_core,handle_request,2,[]},
>       {rabbit_webmachine,'-makeloop/1-fun-0-',3,[]}]}
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From steveolivier22 at gmail.com  Mon Mar 11 15:35:45 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Mon, 11 Mar 2013 08:35:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Per-queue/exchange ACL via LDAP plugin
In-Reply-To: <513DEFF4.8080306@rabbitmq.com>
References: <1362698691958-25325.post@n5.nabble.com>
	<5139F382.4090705@rabbitmq.com>
	<1362761603852-25343.post@n5.nabble.com>
	<513DEFF4.8080306@rabbitmq.com>
Message-ID: <1363016145681-25380.post@n5.nabble.com>

Simon-

Thank you so much. I think I can make that work.

s



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Per-queue-exchange-ACL-via-LDAP-plugin-tp25331p25380.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matt at soupmatt.com  Mon Mar 11 16:51:55 2013
From: matt at soupmatt.com (Matt Campbell)
Date: Mon, 11 Mar 2013 09:51:55 -0700 (PDT)
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre7 is released
In-Reply-To: <CAE3HoVR9C1GktkQMET8Yg0jRMrpjKY1VJ6h4wvcLjV-bHSmvhg@mail.gmail.com>
References: <CAE3HoVR9C1GktkQMET8Yg0jRMrpjKY1VJ6h4wvcLjV-bHSmvhg@mail.gmail.com>
Message-ID: <e1bfb04c-e444-4da2-acb9-e0fa309d8c8c@googlegroups.com>

It looks like 0.9.0.pre7 never got tagged on github.

--
Matt

On Tuesday, February 12, 2013 9:57:13 AM UTC-6, Michael Klishin wrote:
>
> Bunny 0.9.0.pre7 is released to rubygems.org [1].
>
> See [2] for release notes.
>
> 1. https://rubygems.org/gems/bunny/versions/0.9.0.pre7
> 2. 
> http://blog.rubyrabbitmq.info/blog/2013/02/12/bunny-0-dot-9-0-dot-pre7-is-released/
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/7e636410/attachment.htm>

From michael.s.klishin at gmail.com  Mon Mar 11 16:54:45 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 11 Mar 2013 20:54:45 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre7 is released
In-Reply-To: <e1bfb04c-e444-4da2-acb9-e0fa309d8c8c@googlegroups.com>
References: <CAE3HoVR9C1GktkQMET8Yg0jRMrpjKY1VJ6h4wvcLjV-bHSmvhg@mail.gmail.com>
	<e1bfb04c-e444-4da2-acb9-e0fa309d8c8c@googlegroups.com>
Message-ID: <CAE3HoVTn+4ajn_Es0XEneKx3qx6=fNWDgD1Mzw18hN=V+tvGmQ@mail.gmail.com>

2013/3/11 Matt Campbell <matt at soupmatt.com>

> It looks like 0.9.0.pre7 never got tagged on github.


The tag was never pushed, should be good now.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/27083f8b/attachment.htm>

From tuure.laurinolli at portalify.com  Mon Mar 11 16:58:38 2013
From: tuure.laurinolli at portalify.com (Tuure Laurinolli)
Date: Mon, 11 Mar 2013 18:58:38 +0200
Subject: [rabbitmq-discuss] Unable to delete queues,
	purge messages etc. through admin
In-Reply-To: <513DF36A.9060102@rabbitmq.com>
References: <DE0EB884-9B7F-4970-BFBE-2F3D8152E9F8@portalify.com>
	<513DF36A.9060102@rabbitmq.com>
Message-ID: <B3423C61-3293-4E08-8F94-D03D6FEA7D43@portalify.com>

The latter seems to be the case. Thank you for such quick response!

On Mar 11, 2013, at 17:08 , Simon MacMullen wrote:

> Somehow you are running RabbitMQ server with a different, incompatible version of the RabbitMQ Erlang client loaded. We've seen this in two scenarios:
> 
> 1) (Partially) self-compiled plugins mixed with a packaged server
> 2) SuSE linux (with the broken package "erlang-rabbitmq-client"
>   installed)
> 
> Do either of those two sound like possibilities?
> 
> Cheers, Simon
> 
> On 11/03/13 14:58, Tuure Laurinolli wrote:
>> Hi,
>> 
>> I have run into problems purging and deleting queues through rabbitmqadmin on one host. The error message shown on command line is pasted below. The system runs RabbitMQ 2.8.2.
>> 
>> iac-pgis:~ # ./rabbitmqadmin delete queue name=queue.taskmgr.location
>> Traceback (most recent call last):
>>   File "./rabbitmqadmin", line 828, in <module>
>>     main()
>>   File "./rabbitmqadmin", line 325, in main
>>     method()
>>   File "./rabbitmqadmin", line 485, in invoke_delete
>>     self.delete(uri)
>>   File "./rabbitmqadmin", line 357, in delete
>>     return self.http("DELETE", path, "")
>>   File "./rabbitmqadmin", line 386, in http
>>     % (resp.status, resp.reason, path, resp.read()))
>> Exception: Received 500 Internal Server Error for path /queues/%2F/queue.taskmgr.location
>> <html><head><title>500 Internal Server Error</title></head><body><h1>Internal Server Error</h1>The server encountered an error while processing this request:<br><pre>{error,
>>     {case_clause,
>>         {amqp_params_direct,<<"guest">>,<<"/">>,'rabbit at iac-pgis',none,[]}},
>>     [{amqp_connection,start,2,[]},
>>      {rabbit_mgmt_util,with_channel,5,[]},
>>      {webmachine_resource,resource_call,3,[]},
>>      {webmachine_resource,do,3,[]},
>>      {webmachine_decision_core,resource_call,1,[]},
>>      {webmachine_decision_core,decision,1,[]},
>>      {webmachine_decision_core,handle_request,2,[]},
>>      {rabbit_webmachine,'-makeloop/1-fun-0-',3,[]}]}</pre><P><HR><ADDRESS>mochiweb+webmachine web server</ADDRESS></body></html>
>> 
>> and the server logs only show the same information:
>> 
>> =ERROR REPORT==== 11-Mar-2013::16:54:29 ===
>> webmachine error: path="/api/queues/%2F/queue.taskmgr.location"
>> {error,
>>     {case_clause,
>>         {amqp_params_direct,<<"guest">>,<<"/">>,'rabbit at iac-pgis',none,[]}},
>>     [{amqp_connection,start,2,[]},
>>      {rabbit_mgmt_util,with_channel,5,[]},
>>      {webmachine_resource,resource_call,3,[]},
>>      {webmachine_resource,do,3,[]},
>>      {webmachine_decision_core,resource_call,1,[]},
>>      {webmachine_decision_core,decision,1,[]},
>>      {webmachine_decision_core,handle_request,2,[]},
>>      {rabbit_webmachine,'-makeloop/1-fun-0-',3,[]}]}
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware


From 0x6e6562 at gmail.com  Mon Mar 11 17:15:26 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 11 Mar 2013 17:15:26 +0000
Subject: [rabbitmq-discuss] make up_c
Message-ID: <36FB63F336514D25911E2C7E0A88F2AA@gmail.com>

Hi, 

I was wondering whether every sub repo in the umbrella should have a tag of every release.

For example, if you do:

$ make BRANCH=rabbitmq_v3_0_3 up_c

This works fine until the Makefile hits rabbitmq-test, when the absence of the revision 'rabbitmq_v3_0_3' causes the Makefile to halt.

Should this tag exist for this repo?

Cheers,

Ben

  

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/14637ea5/attachment.htm>

From james.gardner at noaa.gov  Mon Mar 11 17:22:05 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Mon, 11 Mar 2013 12:22:05 -0500
Subject: [rabbitmq-discuss] Leaking upstream credentials into federated
 messages' x-received-from header
Message-ID: <513E12BD.5000602@noaa.gov>


Hi,

First if I may, I would like to extend my personal thanks to the 
RabbitMQ team for what I consider an exceptionally well-designed and 
generally very well documented piece of open source software. It really 
has been a pleasure to set up, configure and learn about, and I am 
excited about all the possible uses for a deployment here. Clearly a 
great deal of thought has gone into it, which I am always grateful for 
in any software I have to deal with :).
Having just experimented with federation while investigating RabbitMQ 
for a possible deployment, all has gone very well, with one important 
and uncharacteristic exception; I was frankly shocked to see that in the 
x-received-from header that is inserted into the re-published messages, 
one of the subcomponents (in addition to virtual_host and exchange which 
I can see might be useful) is called 'uri' and states verbatim the URI 
that was used to connect to the upstream server. This might be useful 
to, if it weren't for the fact that it includes the username and most 
worryingly, the plain text password!
This is one of those occasions where it seems so wrong I think there 
must be something I'm not getting :) and perhaps there is. But I don't 
see what I could be doing to invoke this behavior, nor do I see a way to 
switch it off.
I would be grateful if you could help me understand the rationale behind 
this feature and more importantly let me know how I can make sure 
credentials are not leaked into message headers, with all the obvious 
implications thereof.

I am using RabbitMQ version 3.0.3 on RHEL 6.4. To do the federation I am 
using a simple amqp:// style URI upstream definition mentioning 
username, password, hostname and vhost, and a policy which applies to 
one exchange using the 'all' upstream-set.
Let me know if you need any more info.

Thanks!

James Gardner
- NWS Internet Dissemination System


From simon at rabbitmq.com  Mon Mar 11 18:02:19 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Mar 2013 18:02:19 +0000
Subject: [rabbitmq-discuss] make up_c
In-Reply-To: <36FB63F336514D25911E2C7E0A88F2AA@gmail.com>
References: <36FB63F336514D25911E2C7E0A88F2AA@gmail.com>
Message-ID: <513E1C2B.5090707@rabbitmq.com>

On 11/03/13 17:15, Ben Hood wrote:
> Hi,
>
> I was wondering whether every sub repo in the umbrella should have a tag
> of every release.

No, only the ones that have actually formed part of that release.

> For example, if you do:
>
> $ make BRANCH=rabbitmq_v3_0_3 up_c
>
> This works fine until the Makefile hits rabbitmq-test, when the absence
> of the revision 'rabbitmq_v3_0_3' causes the Makefile to halt.
>
> Should this tag exist for this repo?

The problem you have is that you are updating using the Makefile for 
default (which includes rabbitmq-test). Try:

$ hg up rabbitmq_v3_0_3
$ make BRANCH=rabbitmq_v3_0_3 up_c

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Mar 11 18:03:57 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Mar 2013 18:03:57 +0000
Subject: [rabbitmq-discuss] Leaking upstream credentials into federated
 messages' x-received-from header
In-Reply-To: <513E12BD.5000602@noaa.gov>
References: <513E12BD.5000602@noaa.gov>
Message-ID: <513E1C8D.1060403@rabbitmq.com>

On 11/03/13 17:22, James Gardner wrote:
> Having just experimented with federation while investigating RabbitMQ
> for a possible deployment, all has gone very well, with one important
> and uncharacteristic exception; I was frankly shocked to see that in the
> x-received-from header that is inserted into the re-published messages,
> one of the subcomponents (in addition to virtual_host and exchange which
> I can see might be useful) is called 'uri' and states verbatim the URI
> that was used to connect to the upstream server. This might be useful
> to, if it weren't for the fact that it includes the username and most
> worryingly, the plain text password!

That noise you can hear is me banging my head against the desk. I can't 
believe we didn't think of that.

Needless to say, a fix will be forthcoming. Rapidly.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From 0x6e6562 at gmail.com  Mon Mar 11 18:04:42 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 11 Mar 2013 18:04:42 +0000
Subject: [rabbitmq-discuss] Syslog
Message-ID: <A489503F99B641C58553D411EEA6B6EE@gmail.com>

Hi, 

I was wondering whether there is well defined way of forwarding all Rabbit logs to syslog.

Cheers,

Ben 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/64450cbb/attachment.htm>

From 0x6e6562 at gmail.com  Mon Mar 11 18:08:34 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 11 Mar 2013 18:08:34 +0000
Subject: [rabbitmq-discuss] make up_c
In-Reply-To: <513E1C2B.5090707@rabbitmq.com>
References: <36FB63F336514D25911E2C7E0A88F2AA@gmail.com>
	<513E1C2B.5090707@rabbitmq.com>
Message-ID: <C50E66B635CC4C3D9A74E641C5810414@gmail.com>



On Monday, 11 March 2013 at 18:02, Simon MacMullen wrote:

> The problem you have is that you are updating using the Makefile for 
> default (which includes rabbitmq-test). Try:
> 
> $ hg up rabbitmq_v3_0_3
> $ make BRANCH=rabbitmq_v3_0_3 up_c
> 
> 


OK, my bad - now this is working as you describe.

Thanks for the heads up.

Cheers,

Ben 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/27ace395/attachment.htm>

From matthias at rabbitmq.com  Mon Mar 11 18:10:54 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 11 Mar 2013 18:10:54 +0000
Subject: [rabbitmq-discuss] Leaking upstream credentials into federated
 messages' x-received-from header
In-Reply-To: <513E1C8D.1060403@rabbitmq.com>
References: <513E12BD.5000602@noaa.gov> <513E1C8D.1060403@rabbitmq.com>
Message-ID: <513E1E2E.4090206@rabbitmq.com>

On 11/03/13 18:03, Simon MacMullen wrote:
> On 11/03/13 17:22, James Gardner wrote:
>> I was frankly shocked to see that in the x-received-from header
>> that is inserted into the re-published messages, one of the
>> subcomponents is called 'uri' and [...] includes the
>> username and most worryingly, the plain text password!
>
> That noise you can hear is me banging my head against the desk. I can't
> believe we didn't think of that.

FWIW, this bug was introduced in 3.0.0. Prior versions are fine.

Matthias.

From james.gardner at noaa.gov  Mon Mar 11 18:39:50 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Mon, 11 Mar 2013 13:39:50 -0500
Subject: [rabbitmq-discuss] Leaking upstream credentials into federated
 messages' x-received-from header
In-Reply-To: <513E1E2E.4090206@rabbitmq.com>
References: <513E12BD.5000602@noaa.gov> <513E1C8D.1060403@rabbitmq.com>
	<513E1E2E.4090206@rabbitmq.com>
Message-ID: <513E24F6.8090508@noaa.gov>


Your candor and speedy response have restored my faith and my sanity :)
In my view this issue was the only obstacle stopping us from deploying 
so I am looking forward to proceeding once a fix is released.
Thanks again to all,
James.


On 03/11/2013 01:10 PM, Matthias Radestock wrote:
> On 11/03/13 18:03, Simon MacMullen wrote:
>> On 11/03/13 17:22, James Gardner wrote:
>>> I was frankly shocked to see that in the x-received-from header
>>> that is inserted into the re-published messages, one of the
>>> subcomponents is called 'uri' and [...] includes the
>>> username and most worryingly, the plain text password!
>>
>> That noise you can hear is me banging my head against the desk. I can't
>> believe we didn't think of that.
>
> FWIW, this bug was introduced in 3.0.0. Prior versions are fine.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mcintoshj at gmail.com  Mon Mar 11 20:29:40 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 11 Mar 2013 15:29:40 -0500
Subject: [rabbitmq-discuss] Syslog
In-Reply-To: <A489503F99B641C58553D411EEA6B6EE@gmail.com>
References: <A489503F99B641C58553D411EEA6B6EE@gmail.com>
Message-ID: <CAD6m6fHuCqnVj_=HOEh9Sv570DAWA0YQ9n9uMFaoCbyb+BNQ2g@mail.gmail.com>

Two notes on this:

imfile in rsyslog
http://www.rsyslog.com/doc/imfile.html

and logstash:
http://logstash.net/docs/1.1.9/outputs/syslog

Though off hand if you're just wanting to redirect to a local syslog file,
the rsyslog imfile parameter is probably what you're looking for.  If you
want a more "log strategy" solution, look at logstash.  Logstash even has
AMQP input/output adapters and a pretty nice interface in Kibana.

Jason


On Mon, Mar 11, 2013 at 1:04 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

>  Hi,
>
> I was wondering whether there is well defined way of forwarding all Rabbit
> logs to syslog.
>
> Cheers,
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/be0f40b0/attachment.htm>

From richard at raseley.com  Mon Mar 11 20:55:51 2013
From: richard at raseley.com (Richard Raseley)
Date: Mon, 11 Mar 2013 13:55:51 -0700
Subject: [rabbitmq-discuss] Guidance on Using F5 Load Balancer with RabbitMQ
Message-ID: <CAO=6ox_prftz1q9pB5U5QKzNNgoKbV=uMJ0eu+G=WqEEinr_ug@mail.gmail.com>

Is anyone able to share some "best practices" as it relates to using a F5
load balancer to distribute load between nodes of a RabbitMQ cluster?

I have been able to find some forum / mailing list posts online, but
nothing that could be considered "comprehensive".

I am most interested in the persistence and timeout settings which we
should be using in conjunction with RabbitMQ.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/09564e04/attachment.htm>

From alan.antonuk at gmail.com  Mon Mar 11 21:57:45 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 11 Mar 2013 14:57:45 -0700
Subject: [rabbitmq-discuss] Is heartbeat option working in C-client?
In-Reply-To: <CADXMcw1R5XTY1iAPCkHPNFT28-rvhKr3kUth_4Yt4eMFyEJ-wQ@mail.gmail.com>
References: <1354437874.6889.YahooMailNeo@web161201.mail.bf1.yahoo.com>
	<CAAt2poLz0jqwHsV8H=ORgOHse7P=Hc8BLq+u34dVfMpWCUTJYg@mail.gmail.com>
	<50BBAA53.1030809@rabbitmq.com>
	<CAAt2poJqOb3UfOxDHWc_qEUUh71h=yMy+TuKwh=XouEuvLGWkw@mail.gmail.com>
	<CADXMcw1R5XTY1iAPCkHPNFT28-rvhKr3kUth_4Yt4eMFyEJ-wQ@mail.gmail.com>
Message-ID: <CAAt2poK8WMe7-6bU-rxtqffcV+t_C8yjY3QvbiO_dsTxjaRvyg@mail.gmail.com>

While I cannot comment on what Dawn ended up doing, I can say a few words
about the rabbitmq-c library.

Currently the rabbitmq-c only has partial support for AMQP heartbeats: the
library understands AMQP hearbeats at a protocol level, the library
provides an interface for sending and receiving frames that allows
heartbeat frames to be sent, however the library does not have an event
loop that will automatically handle heartbeats for you.

To use heartbeats with rabbitmq-c you would need to provide your own event
loop/logic to send and receive heartbeat frames.

HTH
-Alan



On Thu, Mar 7, 2013 at 2:09 PM, mikel <triton.genocide at gmail.com> wrote:

> Hello,
>
> I'm very interested on knowing if Dawn finally resolved that issue related
> with the heartbeat handle from rabbitmq-c driver. I think it's a important
> issue. The hack I'm using is sending an automatic message to the broker
> every x minutes from the rabbitmq-c client, but I would like to solve that
> situation in a correct way.
>
> Any kind of informatin would be really appreciate.
>
> On Mon, Dec 3, 2012 at 2:42 PM, Alan Antonuk <alan.antonuk at gmail.com>wrote:
>
>> Sorry I didn't read Dawn's email all the way through the first time I
>> read it, so Matthais is correct:
>>
>> The library will not do any kind of automatic sending of heartbeats to
>> the broker.
>>
>> The library should be able to be used in such a way that you could
>> correctly implement heartbeats, though I have not seen it been done with
>> rabbitmq-c.
>>
>> -Alan
>>
>>
>> On Sun, Dec 2, 2012 at 2:21 PM, Matthias Radestock <matthias at rabbitmq.com
>> > wrote:
>>
>>> Alan,
>>>
>>>
>>> On 02/12/12 19:04, Alan Antonuk wrote:
>>>
>>>> The rabbitmq-c client does not support AMQP heartbeats.
>>>>
>>>
>>> In the sense that it is not automatically sending heartbeats in the
>>> absence of other traffic, and is not automatically monitoring inbound
>>> traffic/heartbeats? Sure.
>>>
>>> But if an app sends/receives heartbeats explicitly, as Dawn appears to
>>> be doing, that should work, shouldn't it?
>>>
>>> Matthias.
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/49da0c32/attachment.htm>

From alan.antonuk at gmail.com  Mon Mar 11 22:51:31 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 11 Mar 2013 15:51:31 -0700
Subject: [rabbitmq-discuss] Client implementation in C++
In-Reply-To: <480C257864F5C14CB8CFC2824CF62CF1500DBE@clcemlmbp01.intra.infousa.com>
References: <480C257864F5C14CB8CFC2824CF62CF1500DBE@clcemlmbp01.intra.infousa.com>
Message-ID: <CAAt2poK0y-RUKRgQ9DKEOQjjc2CcpqsfAXGZt+3C1NtVFshX4A@mail.gmail.com>

Interesting concept.

Care to give a few words (or examples) on the benefits of using the design
patterns you choose to use? E.g., What advantages or situations might this
API design be more suitable than say SimpleAmqpClient (
https://github.com/alanxz/SimpleAmqpClient).

-Alan


On Thu, Mar 7, 2013 at 11:39 AM, Alterman, Eugene <
Eugene.Alterman at infogroup.com> wrote:

>  I started writing a rabbitmq C++ client library. It is of course layered
> on top of rabbitmq-c and utilizes boost meta state machine to process
> incoming protocol frames. Processing of each incoming frame returns an
> instance of a boost variant. The static visitor is applied to each result.
> When a message is delivered, the instance of the visitor will store all the
> information.
>
> Is there any interest in a library based on such an approach?
>
> A very preliminary sources with a consumer example is here:
> https://github.com/eugene-a/amqcpp.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130311/0efa2885/attachment.htm>

From dave.lambley at gmail.com  Mon Mar 11 23:14:52 2013
From: dave.lambley at gmail.com (Dave Lambley)
Date: Mon, 11 Mar 2013 23:14:52 +0000
Subject: [rabbitmq-discuss] Syslog
In-Reply-To: <A489503F99B641C58553D411EEA6B6EE@gmail.com>
References: <A489503F99B641C58553D411EEA6B6EE@gmail.com>
Message-ID: <CAKze8wtkAoub2zdibb8piygknjVXK1TYfC3HvFqEG3t4bUrGBA@mail.gmail.com>

On 11 March 2013 18:04, Ben Hood <0x6e6562 at gmail.com> wrote:
> I was wondering whether there is well defined way of forwarding all Rabbit
> logs to syslog.

We're using a bit of Perl to forward our messages into logstash and
eventually Kibana,

http://search.cpan.org/dist/Message-Passing-Syslog/lib/Message/Passing/Syslog.pm
http://search.cpan.org/dist/Message-Passing-AMQP/lib/Message/Passing/AMQP.pm

We tried the logstash agent, but found it too memory hungry to run on
all our hosts.

Dave

From alttagil at gmail.com  Tue Mar 12 07:05:29 2013
From: alttagil at gmail.com (Alex Hudich)
Date: Tue, 12 Mar 2013 11:05:29 +0400
Subject: [rabbitmq-discuss] RMQ Erlang Client: Auto reconnections
Message-ID: <C0FF0DEF-2864-4609-8748-311A30960870@gmail.com>

Hi!

I have some process which handling consumed messages and sending some messages on demand. It breaks with exception if I try to send message if process is already disconnected  from rmq server (by any reason, for example network problems) and I could wait for ages messages on disconnected channel. So I wonder if there any way to handle disconnects and automatically reconnect process to rmq server. I can't afford to crash the entire application because of rmq disconnects because it perform a lot of tasks beside rmq messages handling.


Alex.

From tim at rabbitmq.com  Tue Mar 12 09:29:38 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 12 Mar 2013 09:29:38 +0000
Subject: [rabbitmq-discuss] RMQ Erlang Client: Auto reconnections
In-Reply-To: <C0FF0DEF-2864-4609-8748-311A30960870@gmail.com>
References: <C0FF0DEF-2864-4609-8748-311A30960870@gmail.com>
Message-ID: <6FF70A2E-F101-4BE6-85B0-5397254FEB8A@rabbitmq.com>

Hi Alex,

On 12 Mar 2013, at 07:05, Alex Hudich wrote:
> ... I can't afford to crash the entire application because of rmq disconnects because it perform a lot of tasks beside rmq messages handling.
> 

That's quite understandable. In the title of the post you've said 'RMQ Erlang Client' so I'm a little confused. If you have an Erlang 'process' that fails, it will not 'crash the entire application' - only if the top level supervisor fails and the application restart_type is permanent will the whole Erlang node stop. So why is your top level supervisor failing, and if you've made connectivity a pre-requisite for starting a process that sits directly beneath the top level supervisor then this is going to continue to happen. After all, if the network is down and the process keeps trying to restart and failing because it cannot establish a connection, what should we expect to happen? You need to decide how your application will cope with this, and more likely than not write some code to deal with it.

Going back to your previous point...

> ... I wonder if there any way to handle disconnects and automatically reconnect process to rmq server. 


The canonical approach to noticing disconnection is to enable heartbeats, ensuring timely discovery of network disruptions. This will terminate your gen_connection process if the heartbeat request times out. As for automatic disconnection, regardless of why a gen_connection (or other) process dies, what's wrong with having one of your supervisors restart the relevant process in order to re-establish connectivity? As I mentioned earlier, it might be useful to use a timer to periodically try to re-connect in case you want to prevent network disruption from bringing your application down, since successive restarts by the supervisor will eventually reach max intensity and cause the supervisor to shut down.

Cheers,
Tim

From 9110666 at qq.com  Tue Mar 12 02:33:39 2013
From: 9110666 at qq.com (zhaodawei)
Date: Mon, 11 Mar 2013 19:33:39 -0700 (PDT)
Subject: [rabbitmq-discuss] can't set log_levels?
Message-ID: <1363055619617-25397.post@n5.nabble.com>

Hello,My rabbitmq rabbitmq.conf is that ,but when I stop rabbitmq and
"rabbitmq-server -detached",It's don't work.
[
        {rabbit, [
                {log_levels, [{connection, error}]}
        ]}
].

The rabbitmq.log all like this :=INFO REPORT==== 12-Mar-2013::10:31:58 === 
why?Thinks!





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/can-t-set-log-levels-tp25397.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Tue Mar 12 09:56:54 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 12 Mar 2013 09:56:54 +0000
Subject: [rabbitmq-discuss] can't set log_levels?
In-Reply-To: <1363055619617-25397.post@n5.nabble.com>
References: <1363055619617-25397.post@n5.nabble.com>
Message-ID: <513EFBE6.6030502@rabbitmq.com>


Hi,

On 12/03/13 02:33, zhaodawei wrote:
> Hello,My rabbitmq rabbitmq.conf is that ,but when I stop rabbitmq and
> "rabbitmq-server -detached",It's don't work.
> [
>         {rabbit, [
>                 {log_levels, [{connection, error}]}
>         ]}
> ].
> 
> The rabbitmq.log all like this :=INFO REPORT==== 12-Mar-2013::10:31:58 === 

If this info report pertains to a connection event then the config file
might not have been read. Make sure it is available in the correct
location. Use "rabbitmqctl environment" to make sure your config has
taken effect or check the startup banner for a line starting "config
file(s)".

If this info report does not pertain to a connection then the
description of log_levels from http://www.rabbitmq.com/configure.html
has the explanation:

 "At present there is just one category defined - 'connection', for all
 events relating to network connections. Other, currently
 uncategorised, events are always logged.




-Emile













From 0x6e6562 at gmail.com  Tue Mar 12 10:40:24 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 12 Mar 2013 10:40:24 +0000
Subject: [rabbitmq-discuss] Syslog
In-Reply-To: <CAKze8wtkAoub2zdibb8piygknjVXK1TYfC3HvFqEG3t4bUrGBA@mail.gmail.com>
References: <A489503F99B641C58553D411EEA6B6EE@gmail.com>
	<CAKze8wtkAoub2zdibb8piygknjVXK1TYfC3HvFqEG3t4bUrGBA@mail.gmail.com>
Message-ID: <60A80A0E95BF4107B9F56FD87DE4AC0F@gmail.com>

On Monday, 11 March 2013 at 23:14, Dave Lambley wrote:
> On 11 March 2013 18:04, Ben Hood <0x6e6562 at gmail.com (mailto:0x6e6562 at gmail.com)> wrote:
> > I was wondering whether there is well defined way of forwarding all Rabbit
> > logs to syslog.
> > 
> 
> 
> We're using a bit of Perl to forward our messages into logstash and
> eventually Kibana,
> 
> http://search.cpan.org/dist/Message-Passing-Syslog/lib/Message/Passing/Syslog.pm
> http://search.cpan.org/dist/Message-Passing-AMQP/lib/Message/Passing/AMQP.pm
> 
> We tried the logstash agent, but found it too memory hungry to run on
> all our hosts.
> 
> 


Hi Jason and Dave,

Thanks for the pointers to log stash, imfile and message passing - they are certainly all good options. I guess there is currently no out of the box way to get Rabbit to send stuff directly to syslog without having to deploy a separate moving part.

Cheers,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/ac124293/attachment.htm>

From 9110666 at qq.com  Tue Mar 12 11:39:29 2013
From: 9110666 at qq.com (zhaodawei)
Date: Tue, 12 Mar 2013 04:39:29 -0700 (PDT)
Subject: [rabbitmq-discuss] can't set log_levels?
In-Reply-To: <513EFBE6.6030502@rabbitmq.com>
References: <1363055619617-25397.post@n5.nabble.com>
	<513EFBE6.6030502@rabbitmq.com>
Message-ID: <1363088369189-25402.post@n5.nabble.com>

Thinks!I have found the reason for the error.It's rabbitmq.config not
rabbitmq.conf.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/can-t-set-log-levels-tp25397p25402.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From raphael.degiusti at guardis.com  Tue Mar 12 12:29:20 2013
From: raphael.degiusti at guardis.com (=?ISO-8859-1?Q?Rapha=EBl_De_GIUSTI?=)
Date: Tue, 12 Mar 2013 13:29:20 +0100
Subject: [rabbitmq-discuss] Keeping idle connections alive in EC2
In-Reply-To: <513DC77A.5090403@rabbitmq.com>
References: <5139B5BC.5030404@rabbitmq.com>
	<CD5F7169.86BB%Michael.Laing@nytimes.com>
	<CACkkimmgs4ge3Mij5wxrDB9bvq34q352tLhmpKBuuhzOMsrAKQ@mail.gmail.com>
	<D697A60108BC4649818263D60CB973CF@meetme.com>
	<CACkkimmfEoxEJNKhZT=p7b7_5Wd+Uyb=-3_H2kbBWb=SvJaThw@mail.gmail.com>
	<CAKwdTWdGN0idPVoiwb2VswHZUpb+rprAg-bUb7vAmFEg1ndrhw@mail.gmail.com>
	<CACkkimnGouDs55uBRWM=FoSTZE3L6-7PgVoDWXbVbXL976sAuQ@mail.gmail.com>
	<513DC77A.5090403@rabbitmq.com>
Message-ID: <CAFw-dimyGhNqW9H5t3fMUM4Nh=+6jf-bG4w-pKF=y1MDZicj-w@mail.gmail.com>

Why not running pika's IOLoop in a thread and communicate with it with
python queues ?

You can then leave heartbeats on, and the main thread could continue
processing your tasks.

Raphael

On Mon, Mar 11, 2013 at 1:00 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 08/03/13 21:52, Nishanth Babu Achuthan wrote:
>
>> Typical job processing time is 24 hours. I set up heartbeat_interval =
>> 432000 (5 days) . When I tried this earlier, connection dropped off
>> approximately after 10 mins.
>>
>> I tried with heartbeat=0 and looks like it is working. I find the
>> connection active after 90 minutes since the message processing started.
>>
>
> Setting heartbeat=0 when connections are expected to be be idle for many
> hours seems less than ideal. The risk of the connection getting nuked by
> some idle-timeout on a firewall etc must be fairly high with such a setup.
>
> Gavin, is there no better way to deal with this? Could an app perhaps
> invoke some pika API function at reasonably regular intervals that would
> deal with any inbound/outbound heartbeats received/due since the last
> invocation?
>
> Regards,
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/78171ebc/attachment.htm>

From brett.r.cameron at gmail.com  Tue Mar 12 14:47:21 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 13 Mar 2013 03:47:21 +1300
Subject: [rabbitmq-discuss] Syslog
In-Reply-To: <60A80A0E95BF4107B9F56FD87DE4AC0F@gmail.com>
References: <A489503F99B641C58553D411EEA6B6EE@gmail.com>
	<CAKze8wtkAoub2zdibb8piygknjVXK1TYfC3HvFqEG3t4bUrGBA@mail.gmail.com>
	<60A80A0E95BF4107B9F56FD87DE4AC0F@gmail.com>
Message-ID: <CALPqkirMdoozNnehJN5a70Ocmb87sCf78MVsKxV0y0mRDj8aFg@mail.gmail.com>

Could you write a little client that leverages the amq.rabbitmq.log
exchange? Log file entries are published to this exchange, using the
severity level of log messages as the routing key (severity levels are
?info?, ?warning?, and ?error?), so if you bind a queue or three to this
exchange you can have clients consume the log messages. A client could then
call syslog() to poke stuff into syslog, etc.



Although I suppose this still equates to having to deploy another moving
part, albeit a small one.




On Tue, Mar 12, 2013 at 11:40 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> On Monday, 11 March 2013 at 23:14, Dave Lambley wrote:
>
> On 11 March 2013 18:04, Ben Hood <0x6e6562 at gmail.com> wrote:
>
> I was wondering whether there is well defined way of forwarding all Rabbit
> logs to syslog.
>
>
> We're using a bit of Perl to forward our messages into logstash and
> eventually Kibana,
>
>
> http://search.cpan.org/dist/Message-Passing-Syslog/lib/Message/Passing/Syslog.pm
>
> http://search.cpan.org/dist/Message-Passing-AMQP/lib/Message/Passing/AMQP.pm
>
> We tried the logstash agent, but found it too memory hungry to run on
> all our hosts.
>
>
> Hi Jason and Dave,
>
> Thanks for the pointers to log stash, imfile and message passing - they
> are certainly all good options. I guess there is currently no out of the
> box way to get Rabbit to send stuff directly to syslog without having to
> deploy a separate moving part.
>
> Cheers,
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/9abc03a7/attachment.htm>

From james.gardner at noaa.gov  Tue Mar 12 14:49:31 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Tue, 12 Mar 2013 09:49:31 -0500
Subject: [rabbitmq-discuss] Strange reaction to publishing message with
	invalid expiration.
Message-ID: <513F407B.2040403@noaa.gov>


Hi,
I found a behavior which, to me at least, acts more like a bug than a 
feature...
It seems that when you publish a message with an invalid expiration 
string (eg. "blah"), it renders that channel inoperable for consume 
operations afterwards. I would think it should just discard the message.
In the official Java client, something closes the channel, although I 
don't get any exception until I try to use it for the ensuing consume 
operation.
In the PHP AMQP client (this one: 
http://www.php.net/manual/en/book.amqp.php), the channel stays open but 
when you execute $queue->consume(...) and look in the management 
interface you can see it has not registered as a consumer on the queue 
of interest.
Given the commonalities, I assume these are different client 
interpretations of the same broker behavior. I am not using transactions 
or publisher confirms or anything fancy. I am less familiar with the 
Java client so perhaps I am missing some sort of error handling?

RabbitMQ version: RabbitMQ 3.0.3, Erlang R14B04 on RHEL 6.4
PHP AMQP version is 1.0.1 (admittedly a little outdated)
Java client is version: 3.0.3

I can provide code for either client if you would like but I imagine you 
can replicate it easily just by establishing a connection, then a single 
channel, then publishing the 'bad' msg to a topic exchange, then trying 
to consume off a queue bound to that exchange with '#'.
When you change expiration to a valid string integer, everything works 
as you would wish.

Of course one answer, as the doctor joke goes, is to not 'move your arm 
like that'. Which is fine so long as there's a choice, but if I were 
creating messages and taking the expiration from a source outside my 
program (eg. database), this error might occur at some point if the data 
were bad. I could/should(?) sanitize/verify first of course, the point 
is more that I thought the typical broker reaction to illegal data was 
to deal with it 'silently' (as it does with an illegal user_id, for 
example) rather than effectively make the channel unusable.
Is there a different way I (or the client code) should be handling this 
or is this an unexpected broker behavior?
Thanks,

James Gardner
NWS - Internet Dissemination System



From simon at rabbitmq.com  Tue Mar 12 15:48:09 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Mar 2013 15:48:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.4 released
Message-ID: <513F4E39.40108@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.0.4.

This release fixes a bug in the federation plugin where upstream 
credentials were leaked in the x-received-from header. This bug had been 
in the federation plugin since RabbitMQ 3.0.0. There are no other 
changes from RabbitMQ 3.0.3.

See the release notes at:

http://www.rabbitmq.com/release-notes/README-3.0.4.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                      The RabbitMQ Team
                      (http://www.rabbitmq.com)


From simon at rabbitmq.com  Tue Mar 12 16:12:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Mar 2013 16:12:27 +0000
Subject: [rabbitmq-discuss] Strange reaction to publishing message with
 invalid expiration.
In-Reply-To: <513F407B.2040403@noaa.gov>
References: <513F407B.2040403@noaa.gov>
Message-ID: <513F53EB.7070400@rabbitmq.com>

Well, the channel is getting closed with an error message (same as it 
would be for an illegal user_id in fact). That's AMQP's approach to 
error handling.

You should be able to see an IOException getting thrown in the Java 
client, with a more descriptive cause property, or you can register a 
ShutdownListener. I have no idea how the PHP client signals errors I'm 
afraid.

Cheers, Simon

On 12/03/13 14:49, James Gardner wrote:
>
> Hi,
> I found a behavior which, to me at least, acts more like a bug than a
> feature...
> It seems that when you publish a message with an invalid expiration
> string (eg. "blah"), it renders that channel inoperable for consume
> operations afterwards. I would think it should just discard the message.
> In the official Java client, something closes the channel, although I
> don't get any exception until I try to use it for the ensuing consume
> operation.
> In the PHP AMQP client (this one:
> http://www.php.net/manual/en/book.amqp.php), the channel stays open but
> when you execute $queue->consume(...) and look in the management
> interface you can see it has not registered as a consumer on the queue
> of interest.
> Given the commonalities, I assume these are different client
> interpretations of the same broker behavior. I am not using transactions
> or publisher confirms or anything fancy. I am less familiar with the
> Java client so perhaps I am missing some sort of error handling?
>
> RabbitMQ version: RabbitMQ 3.0.3, Erlang R14B04 on RHEL 6.4
> PHP AMQP version is 1.0.1 (admittedly a little outdated)
> Java client is version: 3.0.3
>
> I can provide code for either client if you would like but I imagine you
> can replicate it easily just by establishing a connection, then a single
> channel, then publishing the 'bad' msg to a topic exchange, then trying
> to consume off a queue bound to that exchange with '#'.
> When you change expiration to a valid string integer, everything works
> as you would wish.
>
> Of course one answer, as the doctor joke goes, is to not 'move your arm
> like that'. Which is fine so long as there's a choice, but if I were
> creating messages and taking the expiration from a source outside my
> program (eg. database), this error might occur at some point if the data
> were bad. I could/should(?) sanitize/verify first of course, the point
> is more that I thought the typical broker reaction to illegal data was
> to deal with it 'silently' (as it does with an illegal user_id, for
> example) rather than effectively make the channel unusable.
> Is there a different way I (or the client code) should be handling this
> or is this an unexpected broker behavior?
> Thanks,
>
> James Gardner
> NWS - Internet Dissemination System
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar 12 16:14:44 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Mar 2013 16:14:44 +0000
Subject: [rabbitmq-discuss] rabbitmq cpu usage can not be more than 700%
In-Reply-To: <CAAjbVJAetDdjXwfU_RUin=_77Lacg8bzwXw6vDK-AwU9sZnXyA@mail.gmail.com>
References: <CAAjbVJDPKbZK5QD+C+95f=0aafP+iYQmP3xp26au1NPHeqsJdw@mail.gmail.com>
	<51388210.20505@rabbitmq.com>
	<CAAjbVJAetDdjXwfU_RUin=_77Lacg8bzwXw6vDK-AwU9sZnXyA@mail.gmail.com>
Message-ID: <513F5474.3020806@rabbitmq.com>

You will not be using HiPE if your configuration contains 
{hipe_compile,false}.

It might also be worth trying Erlang R16B - I believe they've been 
working on better support for more cores.

Cheers, Simon

On 12/03/13 02:51, Xie Yunpeng wrote:
> Hi.
>
> the server is a pc server,not a NUMA,
> i think the case is using HiPE,becase it exactly 700%, just occasionally
> surpass 1~3%,  but it shows me
> $ ./rabbitmqctl environment | grep hipe
>   {hipe_compile,false},
>
> * in my test one thread is create one connection,so i use hunderd of
> connection to send/recv messages.
> * it really cpu-bound, memory/disk/network is not bound, the system 1
> min load is only 9~10
> * add RABBITMQ_SERVER_ERL_ARGS args is not work
>
> i think the best method is to run a cluster on a single machine
>
> thanks
>
>
> 2013/3/7 Simon MacMullen <simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>
>     Hi.
>
>     First of all, the biggest machine I have available to test with is 8
>     cores, so 24 cores is somewhat unknown territory for me. Is this a
>     NUMA machine? However, with that in mind I did some quick tests.
>
>     I was able to get 797% CPU usage with only 4 producer / queue /
>     consumer sets. So it is possible to get past 700%. Interestingly, I
>     got stuck at ~700% when using HiPE - do you have HiPE switched on?
>
>     If not, there are a few things to test:
>
>     * Just to check - you didn't say how many connections you used. If
>     you are running all those send / receive threads through one or two
>     connections you may find that is limiting you.
>
>     * Check you really are CPU-bound - if you are publishing persistent
>     messages or your queues are becoming large you are probably
>     disk-bound. If you are publishing large messages you may be
>     network-bound. One way to test this is with the run queue length,
>     exposed in "rabbitmqctl status" or "Overview" > <node name> >
>     "Advanced" in the management plugin. If this is non-zero you are
>     CPU-bound.
>
>     * You may wish to experiment with adding some the scheduler flags
>     documented at http://www.erlang.org/doc/man/__erl.html
>     <http://www.erlang.org/doc/man/erl.html> to
>     RABBITMQ_SERVER_ERL_ARGS, although this feels rather magical.
>
>     * As a last resort, it is possible to run a cluster on a single
>     machine; this might hwelp you use more cores. See
>     http://www.rabbitmq.com/__clustering.html#single-machine
>     <http://www.rabbitmq.com/clustering.html#single-machine>
>
>     Cheers, Simon
>
>
>     On 07/03/13 08:14, Xie Yunpeng wrote:
>
>         rabbitmq version: 3.0.2
>         cpu: 24 cores
>         memory: 64G
>         i deploy a rabbitmq service on the server above and do a stress
>         testing
>         , use 150 threads for send and 300 threads for recv on 150
>         queues on the
>         service, per queue with 1 send/ 2 recv.
>         the cpu useage is always below 700%, no matter i increase queues and
>         threads or not.
>
>         how to use more than 7 cores in rabbitmq?
>
>         i find smp is set to 24:24
>         [rabbitmq]$ erl
>         Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:24:24]
>         [async-threads:0] [hipe] [kernel-poll:false]
>
>         Eshell V5.9.3.1  (abort with ^G)
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Mar 12 16:15:29 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Mar 2013 16:15:29 +0000
Subject: [rabbitmq-discuss] Leaking upstream credentials into federated
 messages' x-received-from header
In-Reply-To: <513E24F6.8090508@noaa.gov>
References: <513E12BD.5000602@noaa.gov> <513E1C8D.1060403@rabbitmq.com>
	<513E1E2E.4090206@rabbitmq.com> <513E24F6.8090508@noaa.gov>
Message-ID: <513F54A1.5050008@rabbitmq.com>

On 11/03/13 18:39, James Gardner wrote:
> I am looking forward to proceeding once a fix is released.

See RabbitMQ 3.0.4. And thanks very much for reporting this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From daniel at whitehouse.id.au  Tue Mar 12 16:19:22 2013
From: daniel at whitehouse.id.au (Daniel White)
Date: Tue, 12 Mar 2013 09:19:22 -0700 (PDT)
Subject: [rabbitmq-discuss] [PATCH] base64 encode correlation_id in rpc
	requests
Message-ID: <389b0a36-2dd6-4f21-9326-a4ee7e8bb2b0@googlegroups.com>

We ran into a problem where our RPC requests were failing
occasionally.  It turns out that we were interacting with other
clients that conformed more strictly to the AMQP specification.
"Short strings" should be valid UTF-8 strings.

Encoding to base64 means we can keep the incrementing ids and avoid
introducing any complex dependencies (like uuid).

Cheers,
Daniel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/9dfa67f8/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: encode_correlation_id.diff
Type: text/x-diff
Size: 5643 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/9dfa67f8/attachment.diff>

From andrei.seredenko at gmail.com  Tue Mar 12 17:22:40 2013
From: andrei.seredenko at gmail.com (=?KOI8-R?B?4c7E0sXKIPPF0sXExc7Lzw==?=)
Date: Tue, 12 Mar 2013 20:22:40 +0300
Subject: [rabbitmq-discuss] custom installation directory.
Message-ID: <CAK1EO=XJNM7k-=h0P5uKgm10Kgh82j_yJ6nZamULhRbPoawUJg@mail.gmail.com>

Hello, guys!

Can anyone help me: in our production was installed old version of RMQ -
2.1.0. A long time ago we've build it from sources in custom dir, for ex.
/opt/custom-rmq/
I want to introduce a new version of RabbitMQ such as 3.0.3, but i have no
any ideas how to do this: rpm package doesn't support "prefix" option;
build from src  with "make prefix=/.. install" i just can't too - i've got
message:

...

Please set TARGET_DIR.
Please set SBIN_DIR.
Please set MAN_DIR.
make: *** [install_dirs] Error 1

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/629416d7/attachment.htm>

From jesper.louis.andersen at gmail.com  Tue Mar 12 17:36:20 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Tue, 12 Mar 2013 18:36:20 +0100
Subject: [rabbitmq-discuss] rabbitmq cpu usage can not be more than 700%
In-Reply-To: <CAAjbVJDPKbZK5QD+C+95f=0aafP+iYQmP3xp26au1NPHeqsJdw@mail.gmail.com>
References: <CAAjbVJDPKbZK5QD+C+95f=0aafP+iYQmP3xp26au1NPHeqsJdw@mail.gmail.com>
Message-ID: <CAGrdgiX1d1jRVa-4JiFUzqGraxJHAHPyXUcDdSLTAO=e5f-BYw@mail.gmail.com>

It is due to the way Erlang spins up more cores. The Erlang VM decides at
certain intervals how many cores it needs to satisfy the work it has. If it
never needs more than 7 cores to satisfy work, it will never spin up more.
Also note that it will keep a core "awake" even if there is no work to do
in the hope that work will arrive soon. So you cannot use a command like
top(1) to get any idea of what is happening.

The way is to get a shell on an erlang node and then use

http://erlang.org/doc/man/erlang.html#statistics-1

in particular the scheduler_wall_time stats to get a grip on scheduler
utilization.

My guess would be that you are bound by something else than CPU.


On Thu, Mar 7, 2013 at 9:14 AM, Xie Yunpeng <woqimingweipeng at gmail.com>wrote:

> rabbitmq version: 3.0.2
> cpu: 24 cores
> memory: 64G
> i deploy a rabbitmq service on the server above and do a stress testing ,
> use 150 threads for send and 300 threads for recv on 150 queues on the
> service, per queue with 1 send/ 2 recv.
> the cpu useage is always below 700%, no matter i increase queues and
> threads or not.
>
> how to use more than 7 cores in rabbitmq?
>
> i find smp is set to 24:24
> [rabbitmq]$ erl
> Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:24:24]
> [async-threads:0] [hipe] [kernel-poll:false]
>
> Eshell V5.9.3.1  (abort with ^G)
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/5e2c1512/attachment.htm>

From james.gardner at noaa.gov  Tue Mar 12 17:48:42 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Tue, 12 Mar 2013 12:48:42 -0500
Subject: [rabbitmq-discuss] Strange reaction to publishing message with
 invalid expiration.
In-Reply-To: <513F53EB.7070400@rabbitmq.com>
References: <513F407B.2040403@noaa.gov> <513F53EB.7070400@rabbitmq.com>
Message-ID: <513F6A7A.60304@noaa.gov>


Ok thanks, good to know. If that's how AMQP handles errors, that part's 
fine, and I'm used to PHP extensions not dealing with things correctly 
:), but I don't appear to be getting an exception when my Java code reaches:
channel.basicPublish("e.test", "", props, "Hi!!!".getBytes());
That statement, along with everything else (including the call to 
consume, which *does* throw an exception just fine) is inside a try 
{...} catch (Exception e) {...} .
If you say I should be getting an exception, then I cannot explain why I 
am not.
Here, I'll just include the code. All of this is just inside a main 
function in a Test class (I took out the consume part):

try {
             ConnectionFactory factory = new ConnectionFactory();
factory.setUri("amqp://user:pwd at amqp1.ourserver.gov/ourvhost");
             Connection conn = factory.newConnection();

             Channel channel = conn.createChannel();

             BasicProperties props = new BasicProperties
                                     .Builder()
                                     .expiration("trete")
                                     .build();

             channel.basicPublish("e.test", "", props, "Hi!!!".getBytes());


         }
         catch (Exception e) {
             System.out.println("Threw exception: ");
             e.printStackTrace(System.out);
         }

My Java is a little rusty so forgive me if I am missing something. Am I 
supposed to get an IOException if the publish fails due to the bad 
header, or only if the channel had been closed before I do the publish 
or if I tried to use the channel again after the bad publish?

- James


On 03/12/2013 11:12 AM, Simon MacMullen wrote:
> Well, the channel is getting closed with an error message (same as it 
> would be for an illegal user_id in fact). That's AMQP's approach to 
> error handling.
>
> You should be able to see an IOException getting thrown in the Java 
> client, with a more descriptive cause property, or you can register a 
> ShutdownListener. I have no idea how the PHP client signals errors I'm 
> afraid.
>
> Cheers, Simon
>
> On 12/03/13 14:49, James Gardner wrote:
>>
>> Hi,
>> I found a behavior which, to me at least, acts more like a bug than a
>> feature...
>> It seems that when you publish a message with an invalid expiration
>> string (eg. "blah"), it renders that channel inoperable for consume
>> operations afterwards. I would think it should just discard the message.
>> In the official Java client, something closes the channel, although I
>> don't get any exception until I try to use it for the ensuing consume
>> operation.
>> In the PHP AMQP client (this one:
>> http://www.php.net/manual/en/book.amqp.php), the channel stays open but
>> when you execute $queue->consume(...) and look in the management
>> interface you can see it has not registered as a consumer on the queue
>> of interest.
>> Given the commonalities, I assume these are different client
>> interpretations of the same broker behavior. I am not using transactions
>> or publisher confirms or anything fancy. I am less familiar with the
>> Java client so perhaps I am missing some sort of error handling?
>>
>> RabbitMQ version: RabbitMQ 3.0.3, Erlang R14B04 on RHEL 6.4
>> PHP AMQP version is 1.0.1 (admittedly a little outdated)
>> Java client is version: 3.0.3
>>
>> I can provide code for either client if you would like but I imagine you
>> can replicate it easily just by establishing a connection, then a single
>> channel, then publishing the 'bad' msg to a topic exchange, then trying
>> to consume off a queue bound to that exchange with '#'.
>> When you change expiration to a valid string integer, everything works
>> as you would wish.
>>
>> Of course one answer, as the doctor joke goes, is to not 'move your arm
>> like that'. Which is fine so long as there's a choice, but if I were
>> creating messages and taking the expiration from a source outside my
>> program (eg. database), this error might occur at some point if the data
>> were bad. I could/should(?) sanitize/verify first of course, the point
>> is more that I thought the typical broker reaction to illegal data was
>> to deal with it 'silently' (as it does with an illegal user_id, for
>> example) rather than effectively make the channel unusable.
>> Is there a different way I (or the client code) should be handling this
>> or is this an unexpected broker behavior?
>> Thanks,
>>
>> James Gardner
>> NWS - Internet Dissemination System
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


From triton.genocide at gmail.com  Tue Mar 12 18:49:34 2013
From: triton.genocide at gmail.com (mikel)
Date: Tue, 12 Mar 2013 18:49:34 +0000
Subject: [rabbitmq-discuss] Is heartbeat option working in C-client?
In-Reply-To: <CAAt2poK8WMe7-6bU-rxtqffcV+t_C8yjY3QvbiO_dsTxjaRvyg@mail.gmail.com>
References: <1354437874.6889.YahooMailNeo@web161201.mail.bf1.yahoo.com>
	<CAAt2poLz0jqwHsV8H=ORgOHse7P=Hc8BLq+u34dVfMpWCUTJYg@mail.gmail.com>
	<50BBAA53.1030809@rabbitmq.com>
	<CAAt2poJqOb3UfOxDHWc_qEUUh71h=yMy+TuKwh=XouEuvLGWkw@mail.gmail.com>
	<CADXMcw1R5XTY1iAPCkHPNFT28-rvhKr3kUth_4Yt4eMFyEJ-wQ@mail.gmail.com>
	<CAAt2poK8WMe7-6bU-rxtqffcV+t_C8yjY3QvbiO_dsTxjaRvyg@mail.gmail.com>
Message-ID: <CADXMcw3-DOjCgEa56qRu9i5hebBGPOoifQ0YdR2ccn0vCgwReg@mail.gmail.com>

Ok Alan thanks!

That's what I was expecting to hear!



On Mon, Mar 11, 2013 at 9:57 PM, Alan Antonuk <alan.antonuk at gmail.com>wrote:

> While I cannot comment on what Dawn ended up doing, I can say a few words
> about the rabbitmq-c library.
>
> Currently the rabbitmq-c only has partial support for AMQP heartbeats: the
> library understands AMQP hearbeats at a protocol level, the library
> provides an interface for sending and receiving frames that allows
> heartbeat frames to be sent, however the library does not have an event
> loop that will automatically handle heartbeats for you.
>
> To use heartbeats with rabbitmq-c you would need to provide your own event
> loop/logic to send and receive heartbeat frames.
>
> HTH
> -Alan
>
>
>
> On Thu, Mar 7, 2013 at 2:09 PM, mikel <triton.genocide at gmail.com> wrote:
>
>> Hello,
>>
>> I'm very interested on knowing if Dawn finally resolved that issue
>> related with the heartbeat handle from rabbitmq-c driver. I think it's a
>> important issue. The hack I'm using is sending an automatic message to the
>> broker every x minutes from the rabbitmq-c client, but I would like to
>> solve that situation in a correct way.
>>
>> Any kind of informatin would be really appreciate.
>>
>> On Mon, Dec 3, 2012 at 2:42 PM, Alan Antonuk <alan.antonuk at gmail.com>wrote:
>>
>>> Sorry I didn't read Dawn's email all the way through the first time I
>>> read it, so Matthais is correct:
>>>
>>> The library will not do any kind of automatic sending of heartbeats to
>>> the broker.
>>>
>>> The library should be able to be used in such a way that you could
>>> correctly implement heartbeats, though I have not seen it been done with
>>> rabbitmq-c.
>>>
>>> -Alan
>>>
>>>
>>> On Sun, Dec 2, 2012 at 2:21 PM, Matthias Radestock <
>>> matthias at rabbitmq.com> wrote:
>>>
>>>> Alan,
>>>>
>>>>
>>>> On 02/12/12 19:04, Alan Antonuk wrote:
>>>>
>>>>> The rabbitmq-c client does not support AMQP heartbeats.
>>>>>
>>>>
>>>> In the sense that it is not automatically sending heartbeats in the
>>>> absence of other traffic, and is not automatically monitoring inbound
>>>> traffic/heartbeats? Sure.
>>>>
>>>> But if an app sends/receives heartbeats explicitly, as Dawn appears to
>>>> be doing, that should work, shouldn't it?
>>>>
>>>> Matthias.
>>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/ef6dc092/attachment.htm>

From michael.s.klishin at gmail.com  Tue Mar 12 19:48:14 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 12 Mar 2013 23:48:14 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre8
Message-ID: <CAE3HoVT0g7fOfm4WyeHQ1xsPK6WCBkbehRk5CoLs+A4oKtoAPA@mail.gmail.com>

Bunny 0.9.0.pre8 is released to rubygems.org.

This release contains bug fixes and publishing throughput improvements.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/03/12/bunny-0-dot-9-0-dot-pre8-is-released/
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/ea78d177/attachment.htm>

From jay0555 at hotmail.com  Tue Mar 12 22:16:59 2013
From: jay0555 at hotmail.com (9ners)
Date: Tue, 12 Mar 2013 15:16:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Python Pika Unicode error
Message-ID: <1363126619567-25416.post@n5.nabble.com>

getting the following while trying to receive raw data (from UDP source
routed to rabbitmq exchange). Text or Syslog format works alright but errors
out with raw message types. Please help

Exit press CTRL+C
Traceback (most recent call last):
  File "receive_logs.py", line 27, in <module>
    channel.start_consuming()
  File
"/usr/lib/python2.6/site-packages/pika/adapters/blocking_connection.py",
line 771, in start_consuming
    self.connection.process_data_events()
  File
"/usr/lib/python2.6/site-packages/pika/adapters/blocking_connection.py",
line 129, in process_data_events
    if self._handle_read():
  File
"/usr/lib/python2.6/site-packages/pika/adapters/blocking_connection.py",
line 232, in _handle_read
    super(BlockingConnection, self)._handle_read()
  File "/usr/lib/python2.6/site-packages/pika/adapters/base_connection.py",
line 307, in _handle_read
    self._on_data_available(data)
  File "/usr/lib/python2.6/site-packages/pika/connection.py", line 1141, in
_on_data_available
    consumed_count, frame_value = self._read_frame()
  File "/usr/lib/python2.6/site-packages/pika/connection.py", line 1208, in
_read_frame
    return frame.decode_frame(self._frame_buffer)
  File "/usr/lib/python2.6/site-packages/pika/frame.py", line 240, in
decode_frame
    method.decode(frame_data, 4)
  File "/usr/lib/python2.6/site-packages/pika/spec.py", line 1902, in decode
    self.routing_key = encoded[offset:offset + length].decode('utf8')
  File "/usr/lib64/python2.6/encodings/utf_8.py", line 16, in decode
    return codecs.utf_8_decode(input, errors, True)
UnicodeDecodeError: 'utf8' codec can't decode bytes in position 26-27:
invalid continuation byte


Code :
#!/usr/bin/env python
import pika
import sys

connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='localhost'))
channel = connection.channel()

#channel.exchange_declare(exchange='topic_logs',type='topic')

result = channel.queue_declare(exclusive=False)
queue_name = result.method.queue

channel.queue_bind(exchange='collector.raw',
                       queue=queue_name,
                       routing_key="#")

print ' [*] Waiting for logs. To exit press CTRL+C'

def callback(ch, method, properties, body):
    print " [x] %r:%r" % (method.routing_key, body,)

channel.basic_consume(callback,
                      queue=queue_name,
                      no_ack=True)

channel.start_consuming()






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Python-Pika-Unicode-error-tp25416.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From fmeshkinpour at fonality.com  Wed Mar 13 05:22:53 2013
From: fmeshkinpour at fonality.com (Farshad Meshkinpour)
Date: Tue, 12 Mar 2013 22:22:53 -0700
Subject: [rabbitmq-discuss] queue.declare error
Message-ID: <CAO4q6_8PpCVXR5+Oy9FzpKNS9qyMZ+rN45dnd=8AJyaKUEqP5A@mail.gmail.com>

Hello,

As a result of queue.declare, got this error using rmq 2.8.6.  Any idea
what went wrong and what are conditions that causes this?

Thanks,

*=ERROR REPORT==== 11-Mar-2013::12:37:06 ===
** Generic server <0.32401.1890> terminating
** Last message in was {gm_deaths,[<0.32402.1890>,<7525.29166.1356>,
                                  <7525.4207.0>,<7526.2841.0>,<0.14310.179>]}
** When Server state == {state,
                        {amqqueue,
                         {resource,<<"/fonsyncd/prod/">>,queue,
                          <<"Q-SID.10128.fonsyncd">>},
                         true,false,none,
                         [{<<"x-message-ttl">>,signedint,100000},
                          {<<"x-dead-letter-exchange">>,longstr,
                           <<"EX-fonsyncd-Exception">>},
                          {<<"x-ha-policy">>,longstr,<<"all">>}],
                         <7525.29164.1356>,[],all},
                        <0.32402.1890>,<7525.29164.1356>,
                        rabbit_variable_queue,
                        {vqstate,
                         {0,{[],[]}},
                         {0,{[],[]}},
                         {delta,undefined,0,undefined},
                         {0,{[],[]}},
                         {0,{[],[]}},
                         0,
                         {0,nil},
                         undefined,
                         {0,nil},

                         {qistate,
                          "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/queues/1JEOTA5X3U1SLANYUDANOFSPN",
                          {{dict,0,16,16,8,80,48,
                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                              []}}},
                           []},
                          undefined,0,262144,
                          #Fun<rabbit_variable_queue.2.36908642>,
                          {0,nil}},
                         {{client_msstate,msg_store_persistent,
                           <<95,238,177,151,202,70,226,247,210,200,75,177,175,
                             92,253,12>>,
                           {dict,0,16,16,8,80,48,
                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                              []}}},
                           {state,540745,
                            "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent"},
                           rabbit_msg_store_ets_index,
                           "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_persistent",
                           <0.261.0>,544842,536648,548939,553036},
                          {client_msstate,msg_store_transient,
                           <<241,211,16,104,233,93,185,46,148,201,15,147,59,
                             149,242,159>>,
                           {dict,0,16,16,8,80,48,
                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                              []}}},

                        {state,520260,
                            "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient"},
                           rabbit_msg_store_ets_index,
                           "/var/lib/rabbitmq/mnesia/rabbit at rmq1
/msg_store_transient",
                           <0.256.0>,524357,516147,528454,532551}},
                         true,0,#Fun<rabbit_mirror_queue_slave.1.52898136>,0,
                         0,infinity,0,0,0,0,0,
                         {rates,
                          {{1363,30626,718768},0},
                          {{1363,30626,718768},0},
                          0.0,0.0,
                          {1363,30626,718768}},
                         {0,nil},
                         {0,nil},
                         {0,nil},
                         {0,nil},
                         0,0,
                         {rates,
                          {{1363,30626,718768},0},
                          {{1363,30626,718768},0},
                          0.0,0.0,
                          {1363,30626,718768}}},
                        undefined,undefined,
                        {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                        {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                        0,
                        {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},

                       {dict,0,16,16,8,80,48,
                         {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                         {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                        false}
** Reason for termination ==
** {bad_return_value,
      {error,
          {{badmatch,[]},
           [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2},
            {mnesia_tm,apply_fun,3},
            {mnesia_tm,execute_transaction,5},
            {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
            {worker_pool_worker,handle_call,3},
            {gen_server2,handle_msg,2},
            {proc_lib,wake_up,3}]}}}*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/ee9e1465/attachment.htm>

From matthias at rabbitmq.com  Wed Mar 13 07:34:41 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 13 Mar 2013 07:34:41 +0000
Subject: [rabbitmq-discuss] queue.declare error
In-Reply-To: <CAO4q6_8PpCVXR5+Oy9FzpKNS9qyMZ+rN45dnd=8AJyaKUEqP5A@mail.gmail.com>
References: <CAO4q6_8PpCVXR5+Oy9FzpKNS9qyMZ+rN45dnd=8AJyaKUEqP5A@mail.gmail.com>
Message-ID: <51402C11.2070104@rabbitmq.com>

On 13/03/13 05:22, Farshad Meshkinpour wrote:
> As a result of queue.declare, got this error using rmq 2.8.6.
> [...]
>            {{badmatch,[]},
>             [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2},
>              {mnesia_tm,apply_fun,3},
>              {mnesia_tm,execute_transaction,5},
>              {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>              {worker_pool_worker,handle_call,3},
>              {gen_server2,handle_msg,2},
>              {proc_lib,wake_up,3}]}}}*

We fixed a bug with the above signature in 2.8.5, so it's strange that 
you are still seeing this in 2.8.6. However, a number of other bugs in 
the queue mirroring code got fixed since then so I suggest you upgrade 
to the latest RabbitMQ version.

Regards,

Matthias.

From psl88506 at gmail.com  Wed Mar 13 09:28:26 2013
From: psl88506 at gmail.com (PSL 88506)
Date: Wed, 13 Mar 2013 14:58:26 +0530
Subject: [rabbitmq-discuss]  Calling unbind() without calling bind()
Message-ID: <CANPBPZ=CNyEWNhOX5ef_P6yQTxuJHtmyQFBXSGcAoMJN7kQUOw@mail.gmail.com>

Hi,


When we are calling Channel. queueUnbind() without calling
Channel.queueBind(), An exception is thrown.


If this is the expected RabbitMQ behavior, is there any error code or
message so that we'll suppress such messages and will not allow to
propagate.


 Please let us know the error code or message which will occur when
Channel. queueUnbind() is called without calling Channel. queueBind().


Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/6f900e5d/attachment.htm>

From tim at rabbitmq.com  Wed Mar 13 09:35:21 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 13 Mar 2013 09:35:21 +0000
Subject: [rabbitmq-discuss] Calling unbind() without calling bind()
In-Reply-To: <CANPBPZ=CNyEWNhOX5ef_P6yQTxuJHtmyQFBXSGcAoMJN7kQUOw@mail.gmail.com>
References: <CANPBPZ=CNyEWNhOX5ef_P6yQTxuJHtmyQFBXSGcAoMJN7kQUOw@mail.gmail.com>
Message-ID: <51404859.3020701@rabbitmq.com>

Hi

On 03/13/2013 09:28 AM, PSL 88506 wrote:
>
> When we are calling Channel. queueUnbind() without calling 
> Channel.queueBind(), An exception is thrown.
>
>

This is expected, normal behaviour.

> If this is the expected RabbitMQ behavior, is there any error code or 
> message so that we'll suppress such messages and will not allow to 
> propagate.
>
>

This exception *has* to be thrown, according to the AMQP specification: 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.queue - if you 
wish to handle the exception, you may do so, but I'd recommend simply 
enforcing the presence of the binding beforehand, so as to ensure unbind 
does not fail. Bind operations are idempotent in the specification:

"A server MUST allow [and] ignore duplicate bindings - that is, two or 
more bind methods for a specific queue, with identical arguments - 
without treating these as an error. "

>  Please let us know the error code or message which will occur when 
> Channel. queueUnbind() is called without calling Channel. queueBind().
>
>

 From the spec (viz 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.queue) the 
relevant bits of unbind are:

1. "If a unbind fails, the server MUST raise a connection exception."
2. "The client MUST either specify a queue name or have previously 
declared a queue on the same channel Error code: not-found"
3. "The client MUST NOT attempt to unbind a queue that does not exist. 
Error code: not-found"
4. "The client MUST NOT attempt to unbind a queue from an exchange that 
does not exist. Error code: not-found"

Cheers,
Tim

From baniu.yao at gmail.com  Wed Mar 13 03:49:31 2013
From: baniu.yao at gmail.com (=?UTF-8?B?5aea5LuB5o23?=)
Date: Tue, 12 Mar 2013 20:49:31 -0700 (PDT)
Subject: [rabbitmq-discuss] distributed cluster questions about performance
Message-ID: <71285c61-ba0b-457f-9e45-d984b4ad7c92@googlegroups.com>

I'm using 6 servers to make a cluster and they are all disk nodes. I use 
rabbitmq for collecting log file for our website. Now at the peak hour, the 
publish rate is about 30k message per second. There are 2 main 
consumers(hdfs and elasticsearch) and each one need to handle all message, 
so the delivery rate hit about 60k per second.

In my scenario, a single server can hold 10k delivery rate and I use 6 node 
to load balance the pressure. My solution is that I created 2 queues on 
each node. Each message is with a random routing-key(something like 
message.0, message.1, etc) to distribute the pressure to every node. 

What confused me is:


   1. All message send to one node. Should I use a HA Proxy to load balance 
   this publish pressure?
   2. Is there any performance difference between Durable Queues and 
   Transient Queues?
   3. Is there any performance difference between Memory Node and Disk 
   Node? What I know is the difference between memory node and disk node is 
   only about the meta data such as queue configuration.
   4. How can I import the performance in publish and delivery codes? I've 
   researched and I know several methods:
      - disable the confirm mechanism(in publish codes?)
      - enable HiPE(I've done that and it helped a lot)
   5. For example, input is 1w mps(message per second), there are two 
   consumers to consume all message. Then the output is 2w mps. If my server 
   can handle 1w mps, I need two server to handle the 2w-mps-pressure. Now a 
   new consumer need to consume all message, too. As a result, output hits 3w 
   mps, so I need another one more server. For a conclusion, one more consumer 
   for all message, one more server?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/7e769327/attachment.htm>

From andrea.rosa at hp.com  Wed Mar 13 09:59:42 2013
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Wed, 13 Mar 2013 09:59:42 +0000
Subject: [rabbitmq-discuss] rabbitmq_mochiweb timeout fix is in rabbitmq
	2.7.1?
Message-ID: <5F389C517756284F80239F55BCA5DDDD67F0245F@G4W3295.americas.hpqcorp.net>

Hi all,

Sometime I get errors (reported at the bottom of this message) and, browsing the mailing list archive, I found that a possibly cause for that is when mochiweb takes more than 5 seconds to start.
That appeared in the 2.5.1 version and there was a fix proposed for it:

http://www.rabbitmq.com/releases/plugins/v2.5.1/rabbitmq_mochiweb-2.5.1-registry-timeout-fix.ez
is that fix included in the 2.7.1 version?
That error happens to me when I run "service rabbitmq-server restart" command  2 -3 times in a row, but unfortunately I am not able to reproduce it.

Regards
--
Andrea Rosa


=ERROR REPORT==== 11-Feb-2013::15:44:13 ===
** Generic server rabbit_mochiweb_registry terminating 
** Last message in was {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,
                            #Fun<rabbit_mochiweb.0.51174676>,
                            {[],"RabbitMQ Management"}}
** When Server state == undefined
** Reason for termination == 
** {{case_clause,
        {error,
            {eaddrinuse,
                {child,undefined,
                    {rabbit_mochiweb_web,mgmt},
                    {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
                    transient,5000,worker,dynamic}}}},
    [{rabbit_mochiweb_sup,ensure_listener,1},
     {rabbit_mochiweb_registry,handle_call,3},
     {gen_server,handle_msg,5},
     {proc_lib,init_p_do_apply,3}]}

=INFO REPORT==== 11-Feb-2013::15:44:13 ===
    application: rabbitmq_management
    exited: {bad_return,
             {{rabbit_mgmt_app,start,[normal,[]]},
              {'EXIT',
               {{{case_clause,
                  {error,
                   {eaddrinuse,
                    {child,undefined,
                     {rabbit_mochiweb_web,mgmt},
                     {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
                     transient,5000,worker,dynamic}}}},
                 [{rabbit_mochiweb_sup,ensure_listener,1},
                  {rabbit_mochiweb_registry,handle_call,3},
                  {gen_server,handle_msg,5},
                  {proc_lib,init_p_do_apply,3}]},
                {gen_server,call,
                 [rabbit_mochiweb_registry,
                  {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,
                   #Fun<rabbit_mochiweb.0.51174676>,
                   {[],"RabbitMQ Management"}},
                  infinity]}}}}}
    type: permanent


from sasl log
=CRASH REPORT==== 11-Feb-2013::16:45:27 ===
  crasher:
    initial call: rabbit_mochiweb_registry:init/1
    pid: <0.2051.0>
    registered_name: []
    exception exit: {timeout,
                        {gen_server,call,
                            [application_controller,
                             {set_env,rabbitmq_mochiweb,
                                 {dispatch,'*'},
                                 {[],
                                  #Fun<rabbit_mochiweb_registry.0.32312211>}}]}}
      in function  gen_server:init_it/6
    ancestors: [rabbit_mochiweb_sup,<0.133.0>]
    messages: []
    links: [<0.134.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 377
    stack_size: 24
    reductions: 115
  neighbours:

From simon at rabbitmq.com  Wed Mar 13 10:54:17 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Mar 2013 10:54:17 +0000
Subject: [rabbitmq-discuss] rabbitmq cpu usage can not be more than 700%
In-Reply-To: <CAGrdgiX1d1jRVa-4JiFUzqGraxJHAHPyXUcDdSLTAO=e5f-BYw@mail.gmail.com>
References: <CAAjbVJDPKbZK5QD+C+95f=0aafP+iYQmP3xp26au1NPHeqsJdw@mail.gmail.com>
	<CAGrdgiX1d1jRVa-4JiFUzqGraxJHAHPyXUcDdSLTAO=e5f-BYw@mail.gmail.com>
Message-ID: <51405AD9.7090700@rabbitmq.com>

Just to follow up - Xie told me that an upgrade to R16B got them to 
2300% utilisation.

Cheers, Simon

On 12/03/13 17:36, Jesper Louis Andersen wrote:
> It is due to the way Erlang spins up more cores. The Erlang VM decides
> at certain intervals how many cores it needs to satisfy the work it has.
> If it never needs more than 7 cores to satisfy work, it will never spin
> up more. Also note that it will keep a core "awake" even if there is no
> work to do in the hope that work will arrive soon. So you cannot use a
> command like top(1) to get any idea of what is happening.
>
> The way is to get a shell on an erlang node and then use
>
> http://erlang.org/doc/man/erlang.html#statistics-1
>
> in particular the scheduler_wall_time stats to get a grip on scheduler
> utilization.
>
> My guess would be that you are bound by something else than CPU.
>
>
> On Thu, Mar 7, 2013 at 9:14 AM, Xie Yunpeng <woqimingweipeng at gmail.com
> <mailto:woqimingweipeng at gmail.com>> wrote:
>
>     rabbitmq version: 3.0.2
>     cpu: 24 cores
>     memory: 64G
>     i deploy a rabbitmq service on the server above and do a stress
>     testing , use 150 threads for send and 300 threads for recv on 150
>     queues on the service, per queue with 1 send/ 2 recv.
>     the cpu useage is always below 700%, no matter i increase queues and
>     threads or not.
>
>     how to use more than 7 cores in rabbitmq?
>
>     i find smp is set to 24:24
>     [rabbitmq]$ erl
>     Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:24:24]
>     [async-threads:0] [hipe] [kernel-poll:false]
>
>     Eshell V5.9.3.1  (abort with ^G)
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> --
> J.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From jesper.louis.andersen at gmail.com  Wed Mar 13 10:57:50 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Wed, 13 Mar 2013 11:57:50 +0100
Subject: [rabbitmq-discuss] rabbitmq cpu usage can not be more than 700%
In-Reply-To: <51405AD9.7090700@rabbitmq.com>
References: <CAAjbVJDPKbZK5QD+C+95f=0aafP+iYQmP3xp26au1NPHeqsJdw@mail.gmail.com>
	<CAGrdgiX1d1jRVa-4JiFUzqGraxJHAHPyXUcDdSLTAO=e5f-BYw@mail.gmail.com>
	<51405AD9.7090700@rabbitmq.com>
Message-ID: <CAGrdgiU3jYGq2ehEaDJ5_Uv+4+BaPbCHOvYXsenLqR2Z6uJfRA@mail.gmail.com>

Highly plausible. The aggressiveness with which to start new cores changed
along the R15 path and R16 also has some very cool speedups w.r.t. message
passing. So it is nice to see that the efforts paid off.


On Wed, Mar 13, 2013 at 11:54 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> Just to follow up - Xie told me that an upgrade to R16B got them to 2300%
> utilisation.
>
> Cheers, Simon
>
>
> On 12/03/13 17:36, Jesper Louis Andersen wrote:
>
>> It is due to the way Erlang spins up more cores. The Erlang VM decides
>> at certain intervals how many cores it needs to satisfy the work it has.
>> If it never needs more than 7 cores to satisfy work, it will never spin
>> up more. Also note that it will keep a core "awake" even if there is no
>> work to do in the hope that work will arrive soon. So you cannot use a
>> command like top(1) to get any idea of what is happening.
>>
>> The way is to get a shell on an erlang node and then use
>>
>> http://erlang.org/doc/man/**erlang.html#statistics-1<http://erlang.org/doc/man/erlang.html#statistics-1>
>>
>> in particular the scheduler_wall_time stats to get a grip on scheduler
>> utilization.
>>
>> My guess would be that you are bound by something else than CPU.
>>
>>
>> On Thu, Mar 7, 2013 at 9:14 AM, Xie Yunpeng <woqimingweipeng at gmail.com
>> <mailto:woqimingweipeng at gmail.**com <woqimingweipeng at gmail.com>>> wrote:
>>
>>     rabbitmq version: 3.0.2
>>     cpu: 24 cores
>>     memory: 64G
>>     i deploy a rabbitmq service on the server above and do a stress
>>     testing , use 150 threads for send and 300 threads for recv on 150
>>     queues on the service, per queue with 1 send/ 2 recv.
>>     the cpu useage is always below 700%, no matter i increase queues and
>>     threads or not.
>>
>>     how to use more than 7 cores in rabbitmq?
>>
>>     i find smp is set to 24:24
>>     [rabbitmq]$ erl
>>     Erlang R15B03 (erts-5.9.3.1) [source] [64-bit] [smp:24:24]
>>     [async-threads:0] [hipe] [kernel-poll:false]
>>
>>     Eshell V5.9.3.1  (abort with ^G)
>>
>>     ______________________________**_________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>     <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>
>>     https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>>
>>
>> --
>> J.
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/b042dfcd/attachment.htm>

From demius at gmail.com  Wed Mar 13 10:53:04 2013
From: demius at gmail.com (Alexis Van Der Merwe)
Date: Wed, 13 Mar 2013 03:53:04 -0700 (PDT)
Subject: [rabbitmq-discuss] High-availability: Unsynchronised mirrors
	questions (3.0.2)
Message-ID: <3291d346-e249-458e-99dc-ff6a65a10379@googlegroups.com>

Hi there,

I'm testing out the HA features using server version 3.0.2 and it seems to 
fulfill my requirements.
There's one thing I don't really understand, and I was hoping someone would 
be able to enlighten me.

I have a two (2) node HA cluster, for convenience, let's call them *
NODE-MASTER* and *NODE-SLAVE*.


   1. I publish 100k messages to NODE-MASTER, and they are replicated to *
   NODE-SLAVE*.
   2. I take down *NODE-MASTER* using *rabbitmqctl*.
   3. NODE-SLAVE is promoted to master and retains the messages it 
   previously received.
   4. Bring *NODE-MASTER* back up and into the cluster

This all works as I expect it to, but after the former master node rejoins 
the cluster, 
I see a message in the web-management console saying that one of the nodes 
is unsynchronised (see screenshot).

Why does this occur, and more importantly, what does it mean in this 
scenario?

Regards,

A

<https://lh6.googleusercontent.com/-bFcdaf1LZHU/UUBaaQiwPqI/AAAAAAAAA-0/JxUjiQWpbDc/s1600/unsynchronised_mirrors.jpg>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/f2bde38b/attachment.htm>

From simon at rabbitmq.com  Wed Mar 13 11:07:20 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Mar 2013 11:07:20 +0000
Subject: [rabbitmq-discuss] High-availability: Unsynchronised mirrors
 questions (3.0.2)
In-Reply-To: <3291d346-e249-458e-99dc-ff6a65a10379@googlegroups.com>
References: <3291d346-e249-458e-99dc-ff6a65a10379@googlegroups.com>
Message-ID: <51405DE8.6050809@rabbitmq.com>

See http://www.rabbitmq.com/ha.html#unsynchronised-slaves

And note that we will be making improvements in this area in 3.1.

Cheers, Simon

On 13/03/13 10:53, Alexis Van Der Merwe wrote:
> Hi there,
>
> I'm testing out the HA features using server version 3.0.2 and it seems
> to fulfill my requirements.
> There's one thing I don't really understand, and I was hoping someone
> would be able to enlighten me.
>
> I have a two (2) node HA cluster, for convenience, let's call them
> /NODE-MASTER/ and /NODE-SLAVE/.
>
>  1. I publish 100k messages to NODE-MASTER, and they are replicated to
>     /NODE-SLAVE/.
>  2. I take down /NODE-MASTER/ using *rabbitmqctl*.
>  3. NODE-SLAVE is promoted to master and retains the messages it
>     previously received.
>  4. Bring /NODE-MASTER/ back up and into the cluster
>
> This all works as I expect it to, but after the former master node
> rejoins the cluster,
> I see a message in the web-management console saying that one of the
> nodes is unsynchronised (see screenshot).
>
> Why does this occur, and more importantly, what does it mean in this
> scenario?
>
> Regards,
>
> A
>
> <https://lh6.googleusercontent.com/-bFcdaf1LZHU/UUBaaQiwPqI/AAAAAAAAA-0/JxUjiQWpbDc/s1600/unsynchronised_mirrors.jpg>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Mar 13 11:10:50 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Mar 2013 11:10:50 +0000
Subject: [rabbitmq-discuss] rabbitmq_mochiweb timeout fix is in rabbitmq
 2.7.1?
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD67F0245F@G4W3295.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD67F0245F@G4W3295.americas.hpqcorp.net>
Message-ID: <51405EBA.3050402@rabbitmq.com>

That fix is in 2.7.1 (and indeed all versions >= 2.6.0) but you're not 
seeing that problem - you are getting eaddrinuse, i.e. the port is 
already taken.

Later versions of RabbitMQ than 2.7.1 report this error in a more 
readable way :-)

Cheers, Simon

On 13/03/13 09:59, Rosa, Andrea (HP Cloud Services) wrote:
> Hi all,
>
> Sometime I get errors (reported at the bottom of this message) and, browsing the mailing list archive, I found that a possibly cause for that is when mochiweb takes more than 5 seconds to start.
> That appeared in the 2.5.1 version and there was a fix proposed for it:
>
> http://www.rabbitmq.com/releases/plugins/v2.5.1/rabbitmq_mochiweb-2.5.1-registry-timeout-fix.ez
> is that fix included in the 2.7.1 version?
> That error happens to me when I run "service rabbitmq-server restart" command  2 -3 times in a row, but unfortunately I am not able to reproduce it.
>
> Regards
> --
> Andrea Rosa
>
>
> =ERROR REPORT==== 11-Feb-2013::15:44:13 ===
> ** Generic server rabbit_mochiweb_registry terminating
> ** Last message in was {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,
>                              #Fun<rabbit_mochiweb.0.51174676>,
>                              {[],"RabbitMQ Management"}}
> ** When Server state == undefined
> ** Reason for termination ==
> ** {{case_clause,
>          {error,
>              {eaddrinuse,
>                  {child,undefined,
>                      {rabbit_mochiweb_web,mgmt},
>                      {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
>                      transient,5000,worker,dynamic}}}},
>      [{rabbit_mochiweb_sup,ensure_listener,1},
>       {rabbit_mochiweb_registry,handle_call,3},
>       {gen_server,handle_msg,5},
>       {proc_lib,init_p_do_apply,3}]}
>
> =INFO REPORT==== 11-Feb-2013::15:44:13 ===
>      application: rabbitmq_management
>      exited: {bad_return,
>               {{rabbit_mgmt_app,start,[normal,[]]},
>                {'EXIT',
>                 {{{case_clause,
>                    {error,
>                     {eaddrinuse,
>                      {child,undefined,
>                       {rabbit_mochiweb_web,mgmt},
>                       {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
>                       transient,5000,worker,dynamic}}}},
>                   [{rabbit_mochiweb_sup,ensure_listener,1},
>                    {rabbit_mochiweb_registry,handle_call,3},
>                    {gen_server,handle_msg,5},
>                    {proc_lib,init_p_do_apply,3}]},
>                  {gen_server,call,
>                   [rabbit_mochiweb_registry,
>                    {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,
>                     #Fun<rabbit_mochiweb.0.51174676>,
>                     {[],"RabbitMQ Management"}},
>                    infinity]}}}}}
>      type: permanent
>
>
> from sasl log
> =CRASH REPORT==== 11-Feb-2013::16:45:27 ===
>    crasher:
>      initial call: rabbit_mochiweb_registry:init/1
>      pid: <0.2051.0>
>      registered_name: []
>      exception exit: {timeout,
>                          {gen_server,call,
>                              [application_controller,
>                               {set_env,rabbitmq_mochiweb,
>                                   {dispatch,'*'},
>                                   {[],
>                                    #Fun<rabbit_mochiweb_registry.0.32312211>}}]}}
>        in function  gen_server:init_it/6
>      ancestors: [rabbit_mochiweb_sup,<0.133.0>]
>      messages: []
>      links: [<0.134.0>]
>      dictionary: []
>      trap_exit: false
>      status: running
>      heap_size: 377
>      stack_size: 24
>      reductions: 115
>    neighbours:
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From vladislav.pernin at gmail.com  Wed Mar 13 11:11:57 2013
From: vladislav.pernin at gmail.com (Vladislav Pernin)
Date: Wed, 13 Mar 2013 12:11:57 +0100
Subject: [rabbitmq-discuss] High-availability: Unsynchronised mirrors
 questions (3.0.2)
In-Reply-To: <51405DE8.6050809@rabbitmq.com>
References: <3291d346-e249-458e-99dc-ff6a65a10379@googlegroups.com>
	<51405DE8.6050809@rabbitmq.com>
Message-ID: <CAE8ERyzXExmrCkyCXMcPwf0069koEm6v5WcpY4_nJXT+tisosQ@mail.gmail.com>

Hi,

I'd like to hear more about these planned improvements ?
Will it be something like joining the cluster and filling in the queue with
existing messages to have a fully synchronised state ?

Vladislav

2013/3/13 Simon MacMullen <simon at rabbitmq.com>

> See http://www.rabbitmq.com/ha.**html#unsynchronised-slaves<http://www.rabbitmq.com/ha.html#unsynchronised-slaves>
>
> And note that we will be making improvements in this area in 3.1.
>
> Cheers, Simon
>
>
> On 13/03/13 10:53, Alexis Van Der Merwe wrote:
>
>> Hi there,
>>
>> I'm testing out the HA features using server version 3.0.2 and it seems
>> to fulfill my requirements.
>> There's one thing I don't really understand, and I was hoping someone
>> would be able to enlighten me.
>>
>> I have a two (2) node HA cluster, for convenience, let's call them
>> /NODE-MASTER/ and /NODE-SLAVE/.
>>
>>  1. I publish 100k messages to NODE-MASTER, and they are replicated to
>>     /NODE-SLAVE/.
>>  2. I take down /NODE-MASTER/ using *rabbitmqctl*.
>>  3. NODE-SLAVE is promoted to master and retains the messages it
>>     previously received.
>>  4. Bring /NODE-MASTER/ back up and into the cluster
>>
>>
>> This all works as I expect it to, but after the former master node
>> rejoins the cluster,
>> I see a message in the web-management console saying that one of the
>> nodes is unsynchronised (see screenshot).
>>
>> Why does this occur, and more importantly, what does it mean in this
>> scenario?
>>
>> Regards,
>>
>> A
>>
>> <https://lh6.**googleusercontent.com/-**bFcdaf1LZHU/UUBaaQiwPqI/**
>> AAAAAAAAA-0/JxUjiQWpbDc/s1600/**unsynchronised_mirrors.jpg<https://lh6.googleusercontent.com/-bFcdaf1LZHU/UUBaaQiwPqI/AAAAAAAAA-0/JxUjiQWpbDc/s1600/unsynchronised_mirrors.jpg>
>> >
>>
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/1a3c6fd0/attachment.htm>

From simon at rabbitmq.com  Wed Mar 13 11:13:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Mar 2013 11:13:39 +0000
Subject: [rabbitmq-discuss] custom installation directory.
In-Reply-To: <CAK1EO=XJNM7k-=h0P5uKgm10Kgh82j_yJ6nZamULhRbPoawUJg@mail.gmail.com>
References: <CAK1EO=XJNM7k-=h0P5uKgm10Kgh82j_yJ6nZamULhRbPoawUJg@mail.gmail.com>
Message-ID: <51405F63.1010003@rabbitmq.com>

Directory locations are determined not at compilation time but at run 
time using environment variables - see 
http://www.rabbitmq.com/relocate.html.

Cheers, Simon

On 12/03/13 17:22, ?????? ????????? wrote:
> Hello, guys!
>
> Can anyone help me: in our production was installed old version of RMQ -
> 2.1.0. A long time ago we've build it from sources in custom dir, for
> ex. /opt/custom-rmq/
> I want to introduce a new version of RabbitMQ such as 3.0.3, but i have
> no any ideas how to do this: rpm package doesn't support "prefix"
> option; build from src  with "make prefix=/.. install" i just can't too
> - i've got message:
>
> ...
>
> Please set TARGET_DIR.
> Please set SBIN_DIR.
> Please set MAN_DIR.
> make: *** [install_dirs] Error 1
>
> Thanks!
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Mar 13 11:14:17 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Mar 2013 11:14:17 +0000
Subject: [rabbitmq-discuss] High-availability: Unsynchronised mirrors
 questions (3.0.2)
In-Reply-To: <CAE8ERyzXExmrCkyCXMcPwf0069koEm6v5WcpY4_nJXT+tisosQ@mail.gmail.com>
References: <3291d346-e249-458e-99dc-ff6a65a10379@googlegroups.com>
	<51405DE8.6050809@rabbitmq.com>
	<CAE8ERyzXExmrCkyCXMcPwf0069koEm6v5WcpY4_nJXT+tisosQ@mail.gmail.com>
Message-ID: <51405F89.8040501@rabbitmq.com>

Yes, with some limitations. See http://next.rabbitmq.com/ha.html

Cheers, Simon

On 13/03/13 11:11, Vladislav Pernin wrote:
> Hi,
>
> I'd like to hear more about these planned improvements ?
> Will it be something like joining the cluster and filling in the queue
> with existing messages to have a fully synchronised state ?
>
> Vladislav
>
> 2013/3/13 Simon MacMullen <simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>
>     See http://www.rabbitmq.com/ha.__html#unsynchronised-slaves
>     <http://www.rabbitmq.com/ha.html#unsynchronised-slaves>
>
>     And note that we will be making improvements in this area in 3.1.
>
>     Cheers, Simon
>
>
>     On 13/03/13 10:53, Alexis Van Der Merwe wrote:
>
>         Hi there,
>
>         I'm testing out the HA features using server version 3.0.2 and
>         it seems
>         to fulfill my requirements.
>         There's one thing I don't really understand, and I was hoping
>         someone
>         would be able to enlighten me.
>
>         I have a two (2) node HA cluster, for convenience, let's call them
>         /NODE-MASTER/ and /NODE-SLAVE/.
>
>           1. I publish 100k messages to NODE-MASTER, and they are
>         replicated to
>              /NODE-SLAVE/.
>           2. I take down /NODE-MASTER/ using *rabbitmqctl*.
>           3. NODE-SLAVE is promoted to master and retains the messages it
>              previously received.
>           4. Bring /NODE-MASTER/ back up and into the cluster
>
>
>         This all works as I expect it to, but after the former master node
>         rejoins the cluster,
>         I see a message in the web-management console saying that one of the
>         nodes is unsynchronised (see screenshot).
>
>         Why does this occur, and more importantly, what does it mean in this
>         scenario?
>
>         Regards,
>
>         A
>
>         <https://lh6.__googleusercontent.com/-__bFcdaf1LZHU/UUBaaQiwPqI/__AAAAAAAAA-0/JxUjiQWpbDc/s1600/__unsynchronised_mirrors.jpg
>         <https://lh6.googleusercontent.com/-bFcdaf1LZHU/UUBaaQiwPqI/AAAAAAAAA-0/JxUjiQWpbDc/s1600/unsynchronised_mirrors.jpg>>
>
>
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _________________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.__rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From andrea.rosa at hp.com  Wed Mar 13 11:49:30 2013
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Wed, 13 Mar 2013 11:49:30 +0000
Subject: [rabbitmq-discuss] rabbitmq_mochiweb timeout fix is in rabbitmq
 2.7.1?
In-Reply-To: <51405EBA.3050402@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD67F0245F@G4W3295.americas.hpqcorp.net>
	<51405EBA.3050402@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD67F025B4@G4W3295.americas.hpqcorp.net>


>-----Original Message-----
>From: Simon MacMullen [mailto:simon at rabbitmq.com]
>Sent: 13 March 2013 11:11

Thank Simon for your reply,
>
>That fix is in 2.7.1 (and indeed all versions >= 2.6.0) but you're not seeing that
>problem - you are getting eaddrinuse, i.e. the port is already taken.

I saw the "eaddrinuse" error, and I was wondering if the problem could be that the mochiweb is restarting slowly:
if it takes long to stop and then I ask for a new start the address+port are already taken.
Does that make sense?

>
>Later versions of RabbitMQ than 2.7.1 report this error in a more readable way
>:-)

I see... :-) 

Regards
--
Andrea
>
>Cheers, Simon
>
>On 13/03/13 09:59, Rosa, Andrea (HP Cloud Services) wrote:
>> Hi all,
>>
>> Sometime I get errors (reported at the bottom of this message) and,
>browsing the mailing list archive, I found that a possibly cause for that is when
>mochiweb takes more than 5 seconds to start.
>> That appeared in the 2.5.1 version and there was a fix proposed for it:
>>
>> http://www.rabbitmq.com/releases/plugins/v2.5.1/rabbitmq_mochiweb-
>2.5.
>> 1-registry-timeout-fix.ez is that fix included in the 2.7.1 version?
>> That error happens to me when I run "service rabbitmq-server restart"
>command  2 -3 times in a row, but unfortunately I am not able to reproduce it.
>>
>> Regards
>> --
>> Andrea Rosa
>>
>>
>> =ERROR REPORT==== 11-Feb-2013::15:44:13 ===
>> ** Generic server rabbit_mochiweb_registry terminating
>> ** Last message in was
>{add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,
>>                              #Fun<rabbit_mochiweb.0.51174676>,
>>                              {[],"RabbitMQ Management"}}
>> ** When Server state == undefined
>> ** Reason for termination ==
>> ** {{case_clause,
>>          {error,
>>              {eaddrinuse,
>>                  {child,undefined,
>>                      {rabbit_mochiweb_web,mgmt},
>>                      {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
>>                      transient,5000,worker,dynamic}}}},
>>      [{rabbit_mochiweb_sup,ensure_listener,1},
>>       {rabbit_mochiweb_registry,handle_call,3},
>>       {gen_server,handle_msg,5},
>>       {proc_lib,init_p_do_apply,3}]}
>>
>> =INFO REPORT==== 11-Feb-2013::15:44:13 ===
>>      application: rabbitmq_management
>>      exited: {bad_return,
>>               {{rabbit_mgmt_app,start,[normal,[]]},
>>                {'EXIT',
>>                 {{{case_clause,
>>                    {error,
>>                     {eaddrinuse,
>>                      {child,undefined,
>>                       {rabbit_mochiweb_web,mgmt},
>>                       {rabbit_mochiweb_web,start,[{mgmt,[{port,55672}]}]},
>>                       transient,5000,worker,dynamic}}}},
>>                   [{rabbit_mochiweb_sup,ensure_listener,1},
>>                    {rabbit_mochiweb_registry,handle_call,3},
>>                    {gen_server,handle_msg,5},
>>                    {proc_lib,init_p_do_apply,3}]},
>>                  {gen_server,call,
>>                   [rabbit_mochiweb_registry,
>>                    {add,rabbit_mgmt,#Fun<rabbit_mochiweb.2.75707079>,
>>                     #Fun<rabbit_mochiweb.0.51174676>,
>>                     {[],"RabbitMQ Management"}},
>>                    infinity]}}}}}
>>      type: permanent
>>
>>
>> from sasl log
>> =CRASH REPORT==== 11-Feb-2013::16:45:27 ===
>>    crasher:
>>      initial call: rabbit_mochiweb_registry:init/1
>>      pid: <0.2051.0>
>>      registered_name: []
>>      exception exit: {timeout,
>>                          {gen_server,call,
>>                              [application_controller,
>>                               {set_env,rabbitmq_mochiweb,
>>                                   {dispatch,'*'},
>>                                   {[],
>>                                    #Fun<rabbit_mochiweb_registry.0.32312211>}}]}}
>>        in function  gen_server:init_it/6
>>      ancestors: [rabbit_mochiweb_sup,<0.133.0>]
>>      messages: []
>>      links: [<0.134.0>]
>>      dictionary: []
>>      trap_exit: false
>>      status: running
>>      heap_size: 377
>>      stack_size: 24
>>      reductions: 115
>>    neighbours:
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>--
>Simon MacMullen
>RabbitMQ, VMware

From 0x6e6562 at gmail.com  Wed Mar 13 12:37:30 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 13 Mar 2013 12:37:30 +0000
Subject: [rabbitmq-discuss] Overriding rabbit_auth_mechanism_plain
Message-ID: <D3B7D2D3828146A3940CB8FFB848FCD1@gmail.com>

Hey, 

I've been overriding the vanilla rabbit_auth_mechanism_plain with a plugin that implements SASL/PLAIN.

It seems that if I shadow the registry of the rabbit_auth_mechanism_plain with my custom mechanism with the same key, because the plugin loader boots my stuff after the core stuff, my definition overrides the previous definition.

Though this behaviour is cool, I was wondering how stable it would remain over time, and whether this particular boot sequence was just happenstance.

So what I've done is to define a boot step that first unregisters the vanilla rabbit_auth_mechanism_plain. If I add this step as a dependency for a second step that registers my custom mechanism this seems to work well.

But I'm wondering if I'm going about this in the wrong way.

Also, I've added a third boot step to kick off some custom initialization for my plugin - so I was also wondering whether this is idiomatic or not.

Cheers,

Ben 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/75f493a0/attachment.htm>

From 0x6e6562 at gmail.com  Wed Mar 13 12:43:26 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 13 Mar 2013 12:43:26 +0000
Subject: [rabbitmq-discuss] Syslog
In-Reply-To: <CALPqkirMdoozNnehJN5a70Ocmb87sCf78MVsKxV0y0mRDj8aFg@mail.gmail.com>
References: <A489503F99B641C58553D411EEA6B6EE@gmail.com>
	<CAKze8wtkAoub2zdibb8piygknjVXK1TYfC3HvFqEG3t4bUrGBA@mail.gmail.com>
	<60A80A0E95BF4107B9F56FD87DE4AC0F@gmail.com>
	<CALPqkirMdoozNnehJN5a70Ocmb87sCf78MVsKxV0y0mRDj8aFg@mail.gmail.com>
Message-ID: <23FA7A09512D498F88098A9D32C78366@gmail.com>

This would certainly be a possibility.  

I was thinking I might intercept the OTP error_logger during the Rabbit boot sequence and add a syslogd client as a report handler, so that I'm only injecting code into an existing execution as opposed to having to run an extra moving part. But I haven't looked into this in detail yet.  


On Tuesday, 12 March 2013 at 14:47, Brett Cameron wrote:

> Could you write a little client that leverages the amq.rabbitmq.log exchange? Log file entries are published to this exchange, using the severity level of log messages as the routing key (severity levels are ?info?, ?warning?, and ?error?), so if you bind a queue or three to this exchange you can have clients consume the log messages. A client could then call syslog() to poke stuff into syslog, etc.  
>   
> Although I suppose this still equates to having to deploy another moving part, albeit a small one.
>   
>  
>  
> On Tue, Mar 12, 2013 at 11:40 PM, Ben Hood <0x6e6562 at gmail.com (mailto:0x6e6562 at gmail.com)> wrote:
> > On Monday, 11 March 2013 at 23:14, Dave Lambley wrote:
> > > On 11 March 2013 18:04, Ben Hood <0x6e6562 at gmail.com (mailto:0x6e6562 at gmail.com)> wrote:
> > > > I was wondering whether there is well defined way of forwarding all Rabbit
> > > > logs to syslog.
> > > >  
> > >  
> > >  
> > > We're using a bit of Perl to forward our messages into logstash and
> > > eventually Kibana,
> > >  
> > > http://search.cpan.org/dist/Message-Passing-Syslog/lib/Message/Passing/Syslog.pm  
> > > http://search.cpan.org/dist/Message-Passing-AMQP/lib/Message/Passing/AMQP.pm
> > >  
> > > We tried the logstash agent, but found it too memory hungry to run on  
> > > all our hosts.
> > >  
> > >  
> > >  
> >  
> >  
> > Hi Jason and Dave,
> >  
> > Thanks for the pointers to log stash, imfile and message passing - they are certainly all good options. I guess there is currently no out of the box way to get Rabbit to send stuff directly to syslog without having to deploy a separate moving part.  
> >  
> > Cheers,
> >  
> > Ben  
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >  
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
>  


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/e5d0e2cf/attachment.htm>

From simon at rabbitmq.com  Wed Mar 13 12:53:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Mar 2013 12:53:08 +0000
Subject: [rabbitmq-discuss] Syslog
In-Reply-To: <23FA7A09512D498F88098A9D32C78366@gmail.com>
References: <A489503F99B641C58553D411EEA6B6EE@gmail.com>
	<CAKze8wtkAoub2zdibb8piygknjVXK1TYfC3HvFqEG3t4bUrGBA@mail.gmail.com>
	<60A80A0E95BF4107B9F56FD87DE4AC0F@gmail.com>
	<CALPqkirMdoozNnehJN5a70Ocmb87sCf78MVsKxV0y0mRDj8aFg@mail.gmail.com>
	<23FA7A09512D498F88098A9D32C78366@gmail.com>
Message-ID: <514076B4.8090508@rabbitmq.com>

On 13/03/13 12:43, Ben Hood wrote:
> This would certainly be a possibility.
>
> I was thinking I might intercept the OTP error_logger during the Rabbit
> boot sequence and add a syslogd client as a report handler, so that I'm
> only injecting code into an existing execution as opposed to having to
> run an extra moving part. But I haven't looked into this in detail yet.

Yeah, that would be my preference too. That gets you essentially the 
same thing as binding to amq.rabbitmq.log but at a lower level.

One reason I haven't written such a plugin yet myself (lack of time of 
course being another) is that the Erlang syslog clients that I saw used 
native code, making the whole thing harder to release as a binary, or 
required syslog-over-UDP which might count as "more moving parts".

Cheers, Simon

> On Tuesday, 12 March 2013 at 14:47, Brett Cameron wrote:
>
>> Could you write a little client that leverages the amq.rabbitmq.log
>> exchange? Log file entries are published to this exchange, using the
>> severity level of log messages as the routing key (severity levels are
>> ?info?, ?warning?, and ?error?), so if you bind a queue or three to
>> this exchange you can have clients consume the log messages. A client
>> could then call syslog() to poke stuff into syslog, etc.
>>
>> Although I suppose this still equates to having to deploy another
>> moving part, albeit a small one.
>>
>>
>>
>> On Tue, Mar 12, 2013 at 11:40 PM, Ben Hood <0x6e6562 at gmail.com
>> <mailto:0x6e6562 at gmail.com>> wrote:
>>> On Monday, 11 March 2013 at 23:14, Dave Lambley wrote:
>>>> On 11 March 2013 18:04, Ben Hood <0x6e6562 at gmail.com
>>>> <mailto:0x6e6562 at gmail.com>> wrote:
>>>>> I was wondering whether there is well defined way of forwarding all
>>>>> Rabbit
>>>>> logs to syslog.
>>>>
>>>> We're using a bit of Perl to forward our messages into logstash and
>>>> eventually Kibana,
>>>>
>>>> http://search.cpan.org/dist/Message-Passing-Syslog/lib/Message/Passing/Syslog.pm
>>>> http://search.cpan.org/dist/Message-Passing-AMQP/lib/Message/Passing/AMQP.pm
>>>>
>>>> We tried the logstash agent, but found it too memory hungry to run on
>>>> all our hosts.
>>>
>>> Hi Jason and Dave,
>>>
>>> Thanks for the pointers to log stash, imfile and message passing -
>>> they are certainly all good options. I guess there is currently no
>>> out of the box way to get Rabbit to send stuff directly to syslog
>>> without having to deploy a separate moving part.
>>>
>>> Cheers,
>>>
>>> Ben
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Mar 13 13:01:04 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Mar 2013 13:01:04 +0000
Subject: [rabbitmq-discuss] Overriding rabbit_auth_mechanism_plain
In-Reply-To: <D3B7D2D3828146A3940CB8FFB848FCD1@gmail.com>
References: <D3B7D2D3828146A3940CB8FFB848FCD1@gmail.com>
Message-ID: <51407890.80804@rabbitmq.com>

On 13/03/13 12:37, Ben Hood wrote:
> Hey,
>
> I've been overriding the vanilla rabbit_auth_mechanism_plain with a
> plugin that implements SASL/PLAIN.
>
> It seems that if I shadow the registry of
> the rabbit_auth_mechanism_plain with my custom mechanism with the same
> key, because the plugin loader boots my stuff after the core stuff, my
> definition overrides the previous definition.
>
> Though this behaviour is cool, I was wondering how stable it would
> remain over time, and whether this particular boot sequence was just
> happenstance.

That feels a bit like happenstance - both if you are not declaring the 
dependencies and just happening to get your registration step invoked 
afterwards, and also relying on registering the same thing twice leading 
to the second invocation winning.

> So what I've done is to define a boot step that first unregisters the
> vanilla rabbit_auth_mechanism_plain. If I add this step as a dependency
> for a second step that registers my custom mechanism this seems to work
> well.

That feels safer. The key point is that we only guarantee that ordering 
will happen according to the dependencies you declare; any other 
ordering is coincidence.

> But I'm wondering if I'm going about this in the wrong way.

Hmm, I don't think we really imagined people would be overriding what 
existing mechanisms did, we mainly thought people might write new ones.

But I don't think what you're doing is too evil.

> Also, I've added a third boot step to kick off some custom
> initialization for my plugin - so I was also wondering whether this is
> idiomatic or not.

Well, I don't see why you shouldn't combine registration and 
initialisation in one boot step. But that's really a style thing.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From 0x6e6562 at gmail.com  Wed Mar 13 13:06:58 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 13 Mar 2013 13:06:58 +0000
Subject: [rabbitmq-discuss] Overriding rabbit_auth_mechanism_plain
In-Reply-To: <51407890.80804@rabbitmq.com>
References: <D3B7D2D3828146A3940CB8FFB848FCD1@gmail.com>
	<51407890.80804@rabbitmq.com>
Message-ID: <E28FE24C13FC4AFD883C1C6035BB69E5@gmail.com>



On Wednesday, 13 March 2013 at 13:01, Simon MacMullen wrote:

> Hmm, I don't think we really imagined people would be overriding what 
> existing mechanisms did, we mainly thought people might write new ones.
> 
> But I don't think what you're doing is too evil.

Yes, it does feel a bit strange to want to override an existing mechanism. However, I'd like the SASL handling to be transparent to clients so ideally I need to replace the default handler for SASL/PLAIN. 

So given that it doesn't sound too evil, I think I'll proceed with this for now.

Thanks for the review,

Ben 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/240da29e/attachment.htm>

From 0x6e6562 at gmail.com  Wed Mar 13 13:16:36 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 13 Mar 2013 13:16:36 +0000
Subject: [rabbitmq-discuss] Syslog
In-Reply-To: <514076B4.8090508@rabbitmq.com>
References: <A489503F99B641C58553D411EEA6B6EE@gmail.com>
	<CAKze8wtkAoub2zdibb8piygknjVXK1TYfC3HvFqEG3t4bUrGBA@mail.gmail.com>
	<60A80A0E95BF4107B9F56FD87DE4AC0F@gmail.com>
	<CALPqkirMdoozNnehJN5a70Ocmb87sCf78MVsKxV0y0mRDj8aFg@mail.gmail.com>
	<23FA7A09512D498F88098A9D32C78366@gmail.com>
	<514076B4.8090508@rabbitmq.com>
Message-ID: <9436DE73B2C4489484CD82C8C0F69558@gmail.com>



On Wednesday, 13 March 2013 at 12:53, Simon MacMullen wrote:

> Yeah, that would be my preference too. That gets you essentially the 
> same thing as binding to amq.rabbitmq.log but at a lower level.
> 
> One reason I haven't written such a plugin yet myself (lack of time of 
> course being another) is that the Erlang syslog clients that I saw used 
> native code, making the whole thing harder to release as a binary, or 
> required syslog-over-UDP which might count as "more moving parts".
> 
> 


That's a fair point.

Until now, I've been using lager_syslog, which under the covers is using Vagabond's port driver for syslog. Because I've been using rebar, it just compiles the driver as part of the build, but this is only fine if you either build on the machine you deploy to or if your binaries are only targeting one architecture.

As for sending via gen_udp, I wouldn't see this code as being an extra moving part per se, it's just that you'd have to write the code to format the datagrams appropriately.

Cheers,

Ben

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/223b3ed0/attachment.htm>

From simon at rabbitmq.com  Wed Mar 13 13:54:11 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Mar 2013 13:54:11 +0000
Subject: [rabbitmq-discuss] Syslog
In-Reply-To: <9436DE73B2C4489484CD82C8C0F69558@gmail.com>
References: <A489503F99B641C58553D411EEA6B6EE@gmail.com>
	<CAKze8wtkAoub2zdibb8piygknjVXK1TYfC3HvFqEG3t4bUrGBA@mail.gmail.com>
	<60A80A0E95BF4107B9F56FD87DE4AC0F@gmail.com>
	<CALPqkirMdoozNnehJN5a70Ocmb87sCf78MVsKxV0y0mRDj8aFg@mail.gmail.com>
	<23FA7A09512D498F88098A9D32C78366@gmail.com>
	<514076B4.8090508@rabbitmq.com>
	<9436DE73B2C4489484CD82C8C0F69558@gmail.com>
Message-ID: <51408503.2050803@rabbitmq.com>

On 13/03/13 13:16, Ben Hood wrote:
> Until now, I've been using lager_syslog, which under the covers is using
> Vagabond's port driver for syslog. Because I've been using rebar, it
> just compiles the driver as part of the build, but this is only fine if
> you either build on the machine you deploy to or if your binaries are
> only targeting one architecture.

Oh sure, the building is no huge problem, it's just that ATM we only 
release arch-independent artefacts...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From swills at FreeBSD.org  Wed Mar 13 14:15:25 2013
From: swills at FreeBSD.org (Steve Wills)
Date: Wed, 13 Mar 2013 10:15:25 -0400
Subject: [rabbitmq-discuss] init script issues
Message-ID: <f4571ea381a371223cda6e532bbe9f7a.squirrel@mouf.net>

Hi,

I was just discussing an init script issue and asked to send a mail here
regarding the issue and referencing this irc chat:

http://dev.rabbitmq.com/irclog/index.php?date=2013-03-13

Looking forward to a fix! :)

Steve



From simon at rabbitmq.com  Wed Mar 13 15:17:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Mar 2013 15:17:07 +0000
Subject: [rabbitmq-discuss] init script issues
In-Reply-To: <f4571ea381a371223cda6e532bbe9f7a.squirrel@mouf.net>
References: <f4571ea381a371223cda6e532bbe9f7a.squirrel@mouf.net>
Message-ID: <51409873.4060106@rabbitmq.com>

So this looks like a bug in the MQTT plugin. It's failing if there are 
any open MQTT connections :(

A fix will be forthcoming. In the mean time you should be able to work 
around the bug by getting puppet to invoke "rabbitmqctl cluster_status" 
instead of "rabbitmqctl status" to test if the server is alive.

Cheers, Simon

On 13/03/13 14:15, Steve Wills wrote:
> Hi,
>
> I was just discussing an init script issue and asked to send a mail here
> regarding the issue and referencing this irc chat:
>
> http://dev.rabbitmq.com/irclog/index.php?date=2013-03-13
>
> Looking forward to a fix! :)
>
> Steve
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Mar 13 15:23:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Mar 2013 15:23:46 +0000
Subject: [rabbitmq-discuss] rabbitmq_mochiweb timeout fix is in rabbitmq
 2.7.1?
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD67F025B4@G4W3295.americas.hpqcorp.net>
References: <5F389C517756284F80239F55BCA5DDDD67F0245F@G4W3295.americas.hpqcorp.net>
	<51405EBA.3050402@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD67F025B4@G4W3295.americas.hpqcorp.net>
Message-ID: <51409A02.5030409@rabbitmq.com>

On 13/03/13 11:49, Rosa, Andrea (HP Cloud Services) wrote:
> I saw the "eaddrinuse" error, and I was wondering if the problem could be that the mochiweb is restarting slowly:
> if it takes long to stop and then I ask for a new start the address+port are already taken.
> Does that make sense?

Yes it does - but we fixed that in 2.6.0!

However, you may be encountering the bug which made us change the 
management port from 55672 to 15672 - 55672 is in the transient range on 
most operating systems and it's quite possible to find some other random 
process has already opened the port for an outgoing connection. We only 
saw this happen when running a web browser pointing at the management 
plugin on localhost, but that's probably not the only way to trigger it. 
So upgrade to 3.x, or move the management port as described at 
http://previous.rabbitmq.com/mochiweb.html

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From andrea.rosa at hp.com  Wed Mar 13 16:32:09 2013
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Wed, 13 Mar 2013 16:32:09 +0000
Subject: [rabbitmq-discuss] rabbitmq_mochiweb timeout fix is in rabbitmq
 2.7.1?
In-Reply-To: <51409A02.5030409@rabbitmq.com>
References: <5F389C517756284F80239F55BCA5DDDD67F0245F@G4W3295.americas.hpqcorp.net>
	<51405EBA.3050402@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD67F025B4@G4W3295.americas.hpqcorp.net>
	<51409A02.5030409@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD67F026DA@G4W3295.americas.hpqcorp.net>

Thank you very much!

>-----Original Message-----
>From: Simon MacMullen [mailto:simon at rabbitmq.com]
>Sent: 13 March 2013 15:24
>To: Rosa, Andrea (HP Cloud Services)
>Cc: Discussions about RabbitMQ
>Subject: Re: [rabbitmq-discuss] rabbitmq_mochiweb timeout fix is in rabbitmq
>2.7.1?
>
>On 13/03/13 11:49, Rosa, Andrea (HP Cloud Services) wrote:
>> I saw the "eaddrinuse" error, and I was wondering if the problem could be
>that the mochiweb is restarting slowly:
>> if it takes long to stop and then I ask for a new start the address+port are
>already taken.
>> Does that make sense?
>
>Yes it does - but we fixed that in 2.6.0!
>
>However, you may be encountering the bug which made us change the
>management port from 55672 to 15672 - 55672 is in the transient range on
>most operating systems and it's quite possible to find some other random
>process has already opened the port for an outgoing connection. We only saw
>this happen when running a web browser pointing at the management plugin
>on localhost, but that's probably not the only way to trigger it.
>So upgrade to 3.x, or move the management port as described at
>http://previous.rabbitmq.com/mochiweb.html
>
>Cheers, Simon
>
>
>--
>Simon MacMullen
>RabbitMQ, VMware

From tim at rabbitmq.com  Wed Mar 13 17:15:48 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 13 Mar 2013 17:15:48 +0000
Subject: [rabbitmq-discuss] [PATCH] base64 encode correlation_id in rpc
	requests
In-Reply-To: <389b0a36-2dd6-4f21-9326-a4ee7e8bb2b0@googlegroups.com>
References: <389b0a36-2dd6-4f21-9326-a4ee7e8bb2b0@googlegroups.com>
Message-ID: <D422EB7E-3DF1-4A29-85D4-EF853C14DC2A@rabbitmq.com>

Hi Daniel,

We're happy to accept this patch, however you will need to sign a VMWare issued contributor agreement before we can merge it. If that's something you're comfortable doing, please contact me off-list and I'll send you a blank copy in pdf format.

Many thanks!

Tim Watson
Staff Engineer
RabbitMQ/VMWare

On 12 Mar 2013, at 16:19, Daniel White wrote:

> We ran into a problem where our RPC requests were failing
> occasionally.  It turns out that we were interacting with other
> clients that conformed more strictly to the AMQP specification.
> "Short strings" should be valid UTF-8 strings.
> 
> Encoding to base64 means we can keep the incrementing ids and avoid
> introducing any complex dependencies (like uuid).
> 
> Cheers,
> Daniel
> <encode_correlation_id.diff>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Wed Mar 13 17:23:33 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 13 Mar 2013 17:23:33 +0000
Subject: [rabbitmq-discuss] Python Pika Unicode error
In-Reply-To: <1363126619567-25416.post@n5.nabble.com>
References: <1363126619567-25416.post@n5.nabble.com>
Message-ID: <81A33261-723C-4A0E-9F57-86A231B10327@rabbitmq.com>

Hi,

On 12 Mar 2013, at 22:16, 9ners wrote:
> getting the following while trying to receive raw data (from UDP source
> routed to rabbitmq exchange). Text or Syslog format works alright but errors
> out with raw message types. Please help
> 

[snip]

> 
> UnicodeDecodeError: 'utf8' codec can't decode bytes in position 26-27:
> invalid continuation byte
> 

This indicates that the sender needs to ensure that the relevant parts of the payload (i.e., the routing key in this case) are encoded as valid UTF-8. Rabbit is not changing this, so you need to fix up the sender.

Cheers,
Tim

From Andrew.Ochsner at csgi.com  Wed Mar 13 17:51:15 2013
From: Andrew.Ochsner at csgi.com (Ochsner, Andrew)
Date: Wed, 13 Mar 2013 12:51:15 -0500
Subject: [rabbitmq-discuss] Windows vs Linux
Message-ID: <771C375058E4E54CADE84C237C1BB3E61088EF0476@odcexch03.csg.csgsystems.com>

Hello:

We are trying to decide on what OS to target our brokers on.   Our consumers (at least initially) will be written in .NET so the initial preference is to have the brokers sit side-by-side with the consumers.  We'll be interested in taking advantage of HA capabilities as well as high throughput.  I know Windows and Linux are both supported, but I'm just curious if there's a general preference one way or the other that might help lead us down a good path.  We're building a centralized logging system so resiliency and throughput are pretty important.  Obviously we'll need to do our own benchmarking down the road and adjust based on those findings, but we need to start somewhere.

Thanks

Andrew Ochsner  |  Intentional Architecture
T +01 402 431 7583
A 18020 Burt St, Omaha, NE  68022
E andrew.ochsner at csgi.com

[cid:image001.gif at 01CE1FE5.B48BDD80]


________________________________
All emails in this message string and any attachments are the confidential information of CSG Systems International, Inc. (CSG), or its affiliates and subsidiaries, and may contain privileged and/or confidential material. If you are not an intended recipient, please delete it immediately and notify the sender; unintended recipients are not authorized to read or otherwise use the information contained herein.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/a8d7be75/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 1364 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/a8d7be75/attachment.gif>

From watson.timothy at gmail.com  Wed Mar 13 18:08:43 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 13 Mar 2013 18:08:43 +0000
Subject: [rabbitmq-discuss] Windows vs Linux
In-Reply-To: <771C375058E4E54CADE84C237C1BB3E61088EF0476@odcexch03.csg.csgsystems.com>
References: <771C375058E4E54CADE84C237C1BB3E61088EF0476@odcexch03.csg.csgsystems.com>
Message-ID: <3F682EA4-A4A8-4284-A592-F35319837C94@rabbitmq.com>

Hi Andy,

My general exp with erlang is that it's better behaved on Linux, with regards performance (overlapping I/O on Windows wasn't well handled in prior versions, though > R14/R15 may have improved those stories). Also widows imposes limits on the maximum available memory for a process and even on 64bit windows a 32bit emulator is limited to 2Gb - the 64bit emulator does better but is still limited compared to Linux.

Having said that, I understand that we have many happy customers running rabbit on windows! Matthias or Simon will probably be able to say more about those - not sure if there are any case studies available?

Cheers,
Tim

On 13 Mar 2013, at 17:51, "Ochsner, Andrew" <Andrew.Ochsner at csgi.com> wrote:

> Hello:
> 
> We are trying to decide on what OS to target our brokers on.   Our consumers (at least initially) will be written in .NET so the initial preference is to have the brokers sit side-by-side with the consumers.  We?ll be interested in taking advantage of HA capabilities as well as high throughput.  I know Windows and Linux are both supported, but I?m just curious if there?s a general preference one way or the other that might help lead us down a good path.  We?re building a centralized logging system so resiliency and throughput are pretty important.  Obviously we?ll need to do our own benchmarking down the road and adjust based on those findings, but we need to start somewhere.
>  
> Thanks
>  
> Andrew Ochsner  |  Intentional Architecture
> T +01 402 431 7583
> A 18020 Burt St, Omaha, NE  68022
> E andrew.ochsner at csgi.com
>  
> <image001.gif>
>  
> 
> All emails in this message string and any attachments are the confidential information of CSG Systems International, Inc. (CSG), or its affiliates and subsidiaries, and may contain privileged and/or confidential material. If you are not an intended recipient, please delete it immediately and notify the sender; unintended recipients are not authorized to read or otherwise use the information contained herein.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/bd6fceed/attachment.htm>

From adunar at gmail.com  Thu Mar 14 02:16:57 2013
From: adunar at gmail.com (Jesse Young)
Date: Wed, 13 Mar 2013 19:16:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Feature request - automatic recovery from
 network partitions in simple case
Message-ID: <866a324c-27cf-4164-bf19-7d173fb15f6d@googlegroups.com>

Hi,

I run a simple cluster of two RabbitMQ 3.0.x nodes with mirrored 
high-availability queues. Only one of the two nodes is actively used at any 
given time; the other node is a "hot spare" that can be ready in case the 
first node goes offline.

Occasionally, my cloud hosting provider has network interruptions within 
their internal network. RabbitMQ then detects a network partition, and 
stops mirroring queues until I manually restart the nodes. In order to 
avoid losing all queued messages, I have to manually stop the spare node, 
then restart the active node, then start the spare node again. 

I understand the reasoning given in http://www.rabbitmq.com/partitions.html 
for why recovery doesn't happen automatically in the general case.

However, in my simple case, only one of the nodes has any activity during 
the network partition, so there isn't any ambiguity about what should 
happen when the network starts working again: The "spare" node should 
simply restore its state from the "active" node without me having to 
manually restart them in the correct order. 

I don't know how feasible this request is, but it would be great if 
RabbitMQ's partition recovery could be slightly more intelligent so that 
having a spare RabbitMQ node doesn't require as much handholding.

Apologies in advance if this has already been discussed or if this is the 
wrong forum. I'd also like to thank the developers for such a great product!

-Jesse
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130313/1546c3b2/attachment.htm>

From cursosmx at boletinmail.info  Tue Mar 12 08:40:52 2013
From: cursosmx at boletinmail.info (Nohemi Sanchez)
Date: Tue, 12 Mar 2013 05:40:52 -0300
Subject: [rabbitmq-discuss] Invitacion: Cursos Redes Sociales,
	Email Marketing, Posicionamiento web...
Message-ID: <926944755fde00072101ab8c43ae72ca@boletinmail.info>

Your email client cannot read this email.
To view it online, please go here:
http://boletinmail.info/send/display.php?M=451453&C=6256050c4fb087d6ff78b7afa92db354&S=22&L=1&N=6


To stop receiving these
emails:http://boletinmail.info/send/unsubscribe.php?M=451453&C=6256050c4fb087d6ff78b7afa92db354&L=1&N=22
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130312/133a1be5/attachment.htm>

From svyatopolk13 at rambler.ru  Thu Mar 14 05:58:34 2013
From: svyatopolk13 at rambler.ru (=?windows-1251?B?w+Dr5en35e3q7g==?=)
Date: Thu, 14 Mar 2013 09:58:34 +0400
Subject: [rabbitmq-discuss] =?windows-1251?b?IMXx8vwg8fXl7Psg5O7h4OLo8vwg?=
	=?windows-1251?b?ODAgJSDv8Ojh++vr6A==?=
Message-ID: <E75F956914524B59B05820D8C4EDE361@guzq>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130314/a5254fe0/attachment.htm>

From simon at rabbitmq.com  Thu Mar 14 10:36:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 14 Mar 2013 10:36:27 +0000
Subject: [rabbitmq-discuss] Feature request - automatic recovery from
 network partitions in simple case
In-Reply-To: <866a324c-27cf-4164-bf19-7d173fb15f6d@googlegroups.com>
References: <866a324c-27cf-4164-bf19-7d173fb15f6d@googlegroups.com>
Message-ID: <5141A82B.2070208@rabbitmq.com>

Hi.

You'll be pleased to hear that we are already working on improving the 
handling of partitions for 3.1, broadly along these lines. I'm not quite 
sure how we would define the "active" node in the general case though. 
Mind you, maybe you could just put something in the config to tell us.

Cheers, Simon

On 14/03/13 02:16, Jesse Young wrote:
> Hi,
>
> I run a simple cluster of two RabbitMQ 3.0.x nodes with mirrored
> high-availability queues. Only one of the two nodes is actively used at
> any given time; the other node is a "hot spare" that can be ready in
> case the first node goes offline.
>
> Occasionally, my cloud hosting provider has network interruptions within
> their internal network. RabbitMQ then detects a network partition, and
> stops mirroring queues until I manually restart the nodes. In order to
> avoid losing all queued messages, I have to manually stop the spare
> node, then restart the active node, then start the spare node again.
>
> I understand the reasoning given
> in http://www.rabbitmq.com/partitions.html for why recovery doesn't
> happen automatically in the general case.
>
> However, in my simple case, only one of the nodes has any activity
> during the network partition, so there isn't any ambiguity about what
> should happen when the network starts working again: The "spare" node
> should simply restore its state from the "active" node without me having
> to manually restart them in the correct order.
>
> I don't know how feasible this request is, but it would be great if
> RabbitMQ's partition recovery could be slightly more intelligent so that
> having a spare RabbitMQ node doesn't require as much handholding.
>
> Apologies in advance if this has already been discussed or if this is
> the wrong forum. I'd also like to thank the developers for such a great
> product!
>
> -Jesse
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Thu Mar 14 11:56:24 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 14 Mar 2013 11:56:24 +0000
Subject: [rabbitmq-discuss] Windows vs Linux
In-Reply-To: <3F682EA4-A4A8-4284-A592-F35319837C94@rabbitmq.com>
References: <771C375058E4E54CADE84C237C1BB3E61088EF0476@odcexch03.csg.csgsystems.com>
	<3F682EA4-A4A8-4284-A592-F35319837C94@rabbitmq.com>
Message-ID: <D65EA806-F5E4-4149-A4ED-1FE5D2443532@rabbitmq.com>

Just to follow up, I've been provided with an internal (VMWare) blog post indicating that Rabbit can perform fantastically on Windows, so you can probably ignore my fud below. Take a look for yourself: http://blogs.vmware.com/vfabric/2012/12/net-rabbitmq-scales-to-100s-of-millions-of-passenger-messages-at-15below.html

Cheers,
Tim

On 13 Mar 2013, at 18:08, Tim Watson wrote:

> Hi Andy,
> 
> My general exp with erlang is that it's better behaved on Linux, with regards performance (overlapping I/O on Windows wasn't well handled in prior versions, though > R14/R15 may have improved those stories). Also widows imposes limits on the maximum available memory for a process and even on 64bit windows a 32bit emulator is limited to 2Gb - the 64bit emulator does better but is still limited compared to Linux.
> 
> Having said that, I understand that we have many happy customers running rabbit on windows! Matthias or Simon will probably be able to say more about those - not sure if there are any case studies available?
> 
> Cheers,
> Tim
> 
> On 13 Mar 2013, at 17:51, "Ochsner, Andrew" <Andrew.Ochsner at csgi.com> wrote:
> 
>> Hello:
>> 
>> We are trying to decide on what OS to target our brokers on.   Our consumers (at least initially) will be written in .NET so the initial preference is to have the brokers sit side-by-side with the consumers.  We?ll be interested in taking advantage of HA capabilities as well as high throughput.  I know Windows and Linux are both supported, but I?m just curious if there?s a general preference one way or the other that might help lead us down a good path.  We?re building a centralized logging system so resiliency and throughput are pretty important.  Obviously we?ll need to do our own benchmarking down the road and adjust based on those findings, but we need to start somewhere.
>>  
>> Thanks
>>  
>> Andrew Ochsner  |  Intentional Architecture
>> T +01 402 431 7583
>> A 18020 Burt St, Omaha, NE  68022
>> E andrew.ochsner at csgi.com
>>  
>> <image001.gif>
>>  
>> 
>> All emails in this message string and any attachments are the confidential information of CSG Systems International, Inc. (CSG), or its affiliates and subsidiaries, and may contain privileged and/or confidential material. If you are not an intended recipient, please delete it immediately and notify the sender; unintended recipients are not authorized to read or otherwise use the information contained herein.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From stuff at moesel.net  Thu Mar 14 12:53:31 2013
From: stuff at moesel.net (Chris)
Date: Thu, 14 Mar 2013 08:53:31 -0400
Subject: [rabbitmq-discuss] node-amqp: { [Error: COMMAND_INVALID - second
 'channel.open' seen] code: 503 }
Message-ID: <CAHEpgBD+Q9AmP=kVCHd-xxQeOKYYdSyLoJwE+k5hAUGr82=OZw@mail.gmail.com>

When starting our node.js application, sometimes we see the following error
one or more times:

{ [Error: COMMAND_INVALID - second 'channel.open' seen] code: 503 }

First, the non-node-specific question:  Does anyone have any pointers on
how to debug such an issue?  I've already looked at logs and found which
channel is the problem-- but if I comment out the code that creates that
channel, then it just fails on a different channel the next time (btw-- you
don't explicitly create channels in node-amqp, they are created for you
when you subscribe to queues, declare exchanges, etc.).

And the more node-specific question:  RabbitMQ docs seem to indicate it is
usually an error in the client (node-amqp in our case), but I wonder if
perhaps we are making some newbie node-amqp mistake that might lead to this
503 error?  Is there anyone with node-amqp experience that has been through
this before?

We've had a couple of people working on this bug full time for several
days, but we still haven't figured it out.  I've posted a question on the
node-amqp github page too, but so far have no responses.  Any help is VERY
appreciated.

RabbitMQ 3.0.1, node-amqp 0.16, node 0.8.11

Thanks,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130314/729e28d7/attachment.htm>

From hiram at hiramchirino.com  Thu Mar 14 13:56:29 2013
From: hiram at hiramchirino.com (Hiram Chirino)
Date: Thu, 14 Mar 2013 09:56:29 -0400
Subject: [rabbitmq-discuss] Error attaching link via AMQP 1.0
Message-ID: <CAGZ-RDL+bG9D=KJiEtYmEsZc8ZOzsNdfvc84EUP9EcvyFBG0GA@mail.gmail.com>

I was trying to attach a link via AMQP and it failed.  I was hoping some
one around here might be able to interpret the following error message:


** Generic server <0.1161.0> terminating
** Last message in was {'$gen_cast',
                           {frame,
                               {'v1_0.attach',
                                   {utf8,<<"producer 0 => /queue/-0">>},
                                   {uint,0},
                                   false,
                                   {ubyte,1},
                                   {ubyte,0},
                                   undefined,
                                   {'v1_0.target',
                                       {utf8,<<"/queue/-0">>},
                                       undefined,undefined,undefined,
                                       undefined,undefined,undefined},
                                   undefined,false,
                                   {uint,0},
                                   undefined,undefined,undefined,undefined},
                               <0.1156.0>}}
** When Server state == {state,<0.1163.0>,<0.1170.0>,unlimited,<0.1156.0>,
                            <0.1160.0>,
                            {[],[]},

{session,0,1024,1024,1,65535,65535,0,65535,65535,
                                0,0,
                                {0,nil},
                                {0,nil}}}
** Reason for termination ==
** {function_clause,
       [{rabbit_amqp1_0_link_util,durable,
            [undefined],
            [{file,"src/rabbit_amqp1_0_link_util.erl"},{line,69}]},
        {rabbit_amqp1_0_incoming_link,ensure_target,3,
            [{file,"src/rabbit_amqp1_0_incoming_link.erl"},{line,196}]},
        {rabbit_amqp1_0_incoming_link,attach,3,
            [{file,"src/rabbit_amqp1_0_incoming_link.erl"},{line,47}]},
        {rabbit_amqp1_0_session_process,with_disposable_channel,2,
            [{file,"src/rabbit_amqp1_0_session_process.erl"},{line,371}]},
        {rabbit_amqp1_0_session_process,handle_control,2,
            [{file,"src/rabbit_amqp1_0_session_process.erl"},{line,182}]},
        {rabbit_amqp1_0_session_process,handle_cast,2,
            [{file,"src/rabbit_amqp1_0_session_process.erl"},{line,133}]},

{gen_server2,handle_msg,2,[{file,"src/gen_server2.erl"},{line,905}]},
        {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

-- 

**

*Hiram Chirino*

*Engineering | Red Hat, Inc.*

*hchirino at redhat.com <hchirino at redhat.com> | fusesource.com | redhat.com*

*skype: hiramchirino | twitter: @hiramchirino<http://twitter.com/hiramchirino>
*

*blog: Hiram Chirino's Bit Mojo <http://hiramchirino.com/blog/>*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130314/f527fc7e/attachment.htm>

From simon at rabbitmq.com  Thu Mar 14 14:06:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 14 Mar 2013 14:06:25 +0000
Subject: [rabbitmq-discuss] Error attaching link via AMQP 1.0
In-Reply-To: <CAGZ-RDL+bG9D=KJiEtYmEsZc8ZOzsNdfvc84EUP9EcvyFBG0GA@mail.gmail.com>
References: <CAGZ-RDL+bG9D=KJiEtYmEsZc8ZOzsNdfvc84EUP9EcvyFBG0GA@mail.gmail.com>
Message-ID: <5141D961.1020100@rabbitmq.com>

On 14/03/13 13:56, Hiram Chirino wrote:
> I was trying to attach a link via AMQP and it failed.  I was hoping some
> one around here might be able to interpret the following error message:

<snip>

> ** {function_clause,
>         [{rabbit_amqp1_0_link_util,durable,
>              [undefined],
>              [{file,"src/rabbit_amqp1_0_link_util.erl"},{line,69}]},

Ah, we were assuming the durable field in source / target would always 
be there. Fixed, try now.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Thu Mar 14 14:08:52 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 14 Mar 2013 18:08:52 +0400
Subject: [rabbitmq-discuss] node-amqp: { [Error: COMMAND_INVALID -
 second 'channel.open' seen] code: 503 }
In-Reply-To: <CAHEpgBD+Q9AmP=kVCHd-xxQeOKYYdSyLoJwE+k5hAUGr82=OZw@mail.gmail.com>
References: <CAHEpgBD+Q9AmP=kVCHd-xxQeOKYYdSyLoJwE+k5hAUGr82=OZw@mail.gmail.com>
Message-ID: <CAE3HoVS0wZ=V3Uqky1D0Ae6EsO=Oc59gnTvGwVQS5LVAs4LMgQ@mail.gmail.com>

2013/3/14 Chris <stuff at moesel.net>

> First, the non-node-specific question:  Does anyone have any pointers on
> how to debug such an issue?  I've already looked at logs and found which
> channel is the problem-- but if I comment out the code that creates that
> channel, then it just fails on a different channel the next time (btw-- you
> don't explicitly create channels in node-amqp, they are created for you
> when you subscribe to queues, declare exchanges, etc.).
>

Using Wireshark or RabbitMQ tracer [1].


>
> And the more node-specific question:  RabbitMQ docs seem to indicate it is
> usually an error in the client (node-amqp in our case), but I wonder if
> perhaps we are making some newbie node-amqp mistake that might lead to this
> 503 error?  Is there anyone with node-amqp experience that has been through
> this before?
>

This issue indicates a race condition when a library assumes it need to
automatically open a channel after channel.open
has been sent. Or it may be because channel ids are not incremented
properly in the client so two channels end up
having the same id.

Finally, race conditions can originate in your own code but it's impossible
to tell without
seeing the code.

1. See at the bottom of http://www.rabbitmq.com/api-guide.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130314/57ea8681/attachment.htm>

From hassanyossi at gmail.com  Thu Mar 14 13:26:05 2013
From: hassanyossi at gmail.com (Yossi Hassan)
Date: Thu, 14 Mar 2013 06:26:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Security issues in RabbitMQ
Message-ID: <e88735f0-e6b0-45f2-9b56-663c7c13f42c@googlegroups.com>

Hey everyone

Im new to RabbitMQ and wanted to know if any of you is familiar with any 
Known security issues in RabbitMQ ?

Thanks
Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130314/9559f7ce/attachment.html>

From jerryk at rbcon.com  Thu Mar 14 16:38:45 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 14 Mar 2013 09:38:45 -0700
Subject: [rabbitmq-discuss] Security issues in RabbitMQ
In-Reply-To: <e88735f0-e6b0-45f2-9b56-663c7c13f42c@googlegroups.com>
References: <e88735f0-e6b0-45f2-9b56-663c7c13f42c@googlegroups.com>
Message-ID: <CAE0Sz=xD52xCf0Ooezjjn4EqApqSip4NnTvkLW1ePoCuUPLv7Q@mail.gmail.com>

Joe:

Can you be more specific about what you're interested in?

For general rabbit security considerations you might want to look at the
following:

http://www.rabbitmq.com/access-control.html

http://www.rabbitmq.com/blog/2011/02/07/who-are-you-authentication-and-authorisation-in-rabbitmq-231/

http://www.rabbitmq.com/ssl.html


and see what questions are on your mind afterward.

Best regards,
Jerry

On Thu, Mar 14, 2013 at 6:26 AM, Yossi Hassan <hassanyossi at gmail.com> wrote:

> Hey everyone
>
> Im new to RabbitMQ and wanted to know if any of you is familiar with any
> Known security issues in RabbitMQ ?
>
> Thanks
> Joe
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130314/301ed134/attachment.htm>

From steveolivier22 at gmail.com  Thu Mar 14 17:07:56 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Thu, 14 Mar 2013 10:07:56 -0700 (PDT)
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
Message-ID: <1363280876356-25458.post@n5.nabble.com>

Greetings-

I wanted to get some clarification on CHX hash key routing to a queue. Let's
say I have Queue1 and Queue2 bound with equal weight to a CHX. I produce a
message with the routing key "Car.Color.Blue" to the CHX and it is routed to
Queue2. All is well. I delete Queue2. I produce another message with the
routing key "Car.Color.Blue" to the CHX and it is now routed to Queue1. All
is well. I re-create and bind Queue2 to the CHX. I produce another message
with the routing key "Car.Color.Blue" to the CHX and it is routed back to
Queue2. That's the part that seemed odd. 

The design requirements I have is that all messages with the same
routing-key be present in only one queue. I can't meet those requirements by
that queue deletion/re-creation with the same name. So, I'd have to avoid
doing that or find out if this is expected behavior.

The set up I have is this...

P ---> TopicExchange --->CHX ---> Q1, Q2

Producers send messages with routing keys like "Car.Color.<some color>".
The CHX is bound to the TopicExchange with a routing key of "Car.Color.#".
Queues 1 and 2 are bound to the CHX with equal weight.

I am at Rabbit 3.0.1. 

Thanks.

s 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Confirm-consistent-hash-exchange-behavior-tp25458.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From nicolas.menoux at nickyintheclouds.com  Thu Mar 14 15:56:57 2013
From: nicolas.menoux at nickyintheclouds.com (Nicolas Menoux)
Date: Thu, 14 Mar 2013 08:56:57 -0700 (PDT)
Subject: [rabbitmq-discuss] how to tell to pika to switch from one node to
 another during a cluster node failure ?
Message-ID: <4c3f6a15-9bc7-49c1-bcc9-32329e2a9fcc@googlegroups.com>

Hi,

I have a 2 node rabbitmq cluster which is working and I would like to know 
if there is any directive with pika to indicate all the nodes names and 
ports in the connection parameters to manage node failure.
I mean if one node is down, the script will automatically switch from one 
node to another node in the cluster. I think it could be possible with some 
HAproxy but maybe in the pika module itself (as what we could find with 
some MongoDB driver) we could set all nodes parameters in the connection 
string. I do not find anything about that in the documentation. Am I 
missing something ? thanks.

My environment:

   - Ubuntu 12.04 with RabbitMQ 2.71.
   - Broker instances are all disk nodes.
   - Queues are declared as durable and x-ha-policy:all
   - Clients are written in Python using Pika 0.9.9.

Nicolas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130314/69e95f8f/attachment.htm>

From francois at teksol.info  Thu Mar 14 19:15:26 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Thu, 14 Mar 2013 15:15:26 -0400
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <1363280876356-25458.post@n5.nabble.com>
References: <1363280876356-25458.post@n5.nabble.com>
Message-ID: <19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>


Le 2013-03-14 ? 13:07, SteveO a ?crit :

> Greetings-
> 
> I wanted to get some clarification on CHX hash key routing to a queue. Let's
> say I have Queue1 and Queue2 bound with equal weight to a CHX. I produce a
> message with the routing key "Car.Color.Blue" to the CHX and it is routed to
> Queue2. All is well. I delete Queue2. I produce another message with the
> routing key "Car.Color.Blue" to the CHX and it is now routed to Queue1. All
> is well. I re-create and bind Queue2 to the CHX. I produce another message
> with the routing key "Car.Color.Blue" to the CHX and it is routed back to
> Queue2. That's the part that seemed odd. 

I find it odd that you find it odd. My expectations were exactly as you described above: the routing decision is taken in light of the bound queues at the time the routing decision is taken.

You expected that once a routing key was routed to a queue, it continued routing to that specific queue until the queue is unbound?

Bye,
Fran?ois
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130314/5f399547/attachment.bin>

From stuff at moesel.net  Thu Mar 14 20:07:53 2013
From: stuff at moesel.net (Chris)
Date: Thu, 14 Mar 2013 16:07:53 -0400
Subject: [rabbitmq-discuss] node-amqp: { [Error: COMMAND_INVALID -
 second 'channel.open' seen] code: 503 }
In-Reply-To: <CAE3HoVS0wZ=V3Uqky1D0Ae6EsO=Oc59gnTvGwVQS5LVAs4LMgQ@mail.gmail.com>
References: <CAHEpgBD+Q9AmP=kVCHd-xxQeOKYYdSyLoJwE+k5hAUGr82=OZw@mail.gmail.com>
	<CAE3HoVS0wZ=V3Uqky1D0Ae6EsO=Oc59gnTvGwVQS5LVAs4LMgQ@mail.gmail.com>
Message-ID: <CAHEpgBAGsppidMDcteLUWnccJ_f1-9N8rmawnCKnp-UvDAM37w@mail.gmail.com>

Thank you, Michael.  The Tracer is a very cool tool.  Thanks for pointing
it out!  It definitely confirms the issue regarding multiple opens:

1363291338032: <Tracer-0> ch#8 -> {#method<channel.open>(out-of-band=),
null, ""}
1363291338032: <Tracer-0> ch#8 -> {#method<channel.open>(out-of-band=),
null, ""}
1363291338070: <Tracer-0> ch#8 -> {#method<channel.open>(out-of-band=),
null, ""}
1363291338070: <Tracer-0> ch#8 -> {#method<channel.open>(out-of-band=),
null, ""}

Now I still just have to figure out how/why they are being sent!

-Chris


On Thu, Mar 14, 2013 at 10:08 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
> 2013/3/14 Chris <stuff at moesel.net>
>
>> First, the non-node-specific question:  Does anyone have any pointers on
>> how to debug such an issue?  I've already looked at logs and found which
>> channel is the problem-- but if I comment out the code that creates that
>> channel, then it just fails on a different channel the next time (btw-- you
>> don't explicitly create channels in node-amqp, they are created for you
>> when you subscribe to queues, declare exchanges, etc.).
>>
>
> Using Wireshark or RabbitMQ tracer [1].
>
>
>>
>> And the more node-specific question:  RabbitMQ docs seem to indicate it
>> is usually an error in the client (node-amqp in our case), but I wonder if
>> perhaps we are making some newbie node-amqp mistake that might lead to this
>> 503 error?  Is there anyone with node-amqp experience that has been through
>> this before?
>>
>
> This issue indicates a race condition when a library assumes it need to
> automatically open a channel after channel.open
> has been sent. Or it may be because channel ids are not incremented
> properly in the client so two channels end up
> having the same id.
>
> Finally, race conditions can originate in your own code but it's
> impossible to tell without
> seeing the code.
>
> 1. See at the bottom of http://www.rabbitmq.com/api-guide.html
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130314/32ad3d95/attachment.htm>

From steveolivier22 at gmail.com  Thu Mar 14 20:42:16 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Thu, 14 Mar 2013 13:42:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
Message-ID: <1363293736579-25462.post@n5.nabble.com>

"You expected that once a routing key was routed to a queue, it continued
routing to that specific queue until the queue is unbound? "

Yeah, not sure why I - but that is what I expected. I probably started
thinking that because that's what I wanted it to do :) 

We wanted to guarantee that at any given time, messages would only be
delivered to one queue even if the bindings to other queues changed - like
other queues being added. Processing messages in order is important for us
and if we create a condition where messages exist in multiple queues, we
can't guarantee that order. Over time, if we create and bind more queues to
the same CHX, then we could create that condition - so we don't want to do
that.

If we run into an issue where we need to add more queues, it sounds like
with a slightly more sophisticated producer and routing scheme, we could
just add another CHX. Something like this...

                             |--->CHX1--->Q1, Q2
P ---> TopicExchange
                             |--->CHX2--->Q1, Q2

Thanks.

s



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Confirm-consistent-hash-exchange-behavior-tp25458p25462.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From gmr at meetme.com  Fri Mar 15 06:03:28 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Thu, 14 Mar 2013 23:03:28 -0700
Subject: [rabbitmq-discuss] Pika connection negotiation behavior
Message-ID: <CAKwdTWdMGdL7QwKrRDApWubQxcKbm0CNH6k6T=Ar7TmGth8PcA@mail.gmail.com>

In Pika, currently and pre-dating my involvement, when tuning the
connection, it uses the *minimum* value above 0 that either the server or
client provides for the heartbeat interval:

https://github.com/pika/pika/blob/v0.5/pika/connection.py#L359
https://github.com/pika/pika/blob/v0.5/pika/connection.py#L411

Since introducing a heartbeat interval sent by the server of 600, this has
set a *maximum* heartbeat interval of 600 regardless of what the client
sets upon creation.

In reading the 0.9.1 spec, I did not see anything dictating any behavior of
this sort for heartbeat interval negotiation.

I'm inclined to allow the client to always overwrite the server, but since
this behavior both pre-dates my involvement and is clearly intentional, I
wanted to get some feedback before making the change.

I currently have an open ticket tied to this that I would like to resolve
before releasing 0.9.10: https://github.com/pika/pika/issues/303

So, any thoughts?

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130314/885b7865/attachment.htm>

From gmr at meetme.com  Fri Mar 15 08:02:49 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 15 Mar 2013 01:02:49 -0700
Subject: [rabbitmq-discuss] how to tell to pika to switch from one node
 to another during a cluster node failure ?
In-Reply-To: <4c3f6a15-9bc7-49c1-bcc9-32329e2a9fcc@googlegroups.com>
References: <4c3f6a15-9bc7-49c1-bcc9-32329e2a9fcc@googlegroups.com>
Message-ID: <CAKwdTWdfGQ_LAG8xOG6AbiUJXnTiY2HLBLcJ7Mg-2MEcM5V-pA@mail.gmail.com>

Here's an example that is working against 0.9.10p0 -- 0.9.10 should in the
next 24-48 hours:

https://gist.github.com/gmr/5168207


On Thu, Mar 14, 2013 at 8:56 AM, Nicolas Menoux <
nicolas.menoux at nickyintheclouds.com> wrote:

> Hi,
>
> I have a 2 node rabbitmq cluster which is working and I would like to know
> if there is any directive with pika to indicate all the nodes names and
> ports in the connection parameters to manage node failure.
> I mean if one node is down, the script will automatically switch from one
> node to another node in the cluster. I think it could be possible with some
> HAproxy but maybe in the pika module itself (as what we could find with
> some MongoDB driver) we could set all nodes parameters in the connection
> string. I do not find anything about that in the documentation. Am I
> missing something ? thanks.
>
> My environment:
>
>    - Ubuntu 12.04 with RabbitMQ 2.71.
>    - Broker instances are all disk nodes.
>    - Queues are declared as durable and x-ha-policy:all
>    - Clients are written in Python using Pika 0.9.9.
>
> Nicolas
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130315/16297831/attachment.htm>

From nicolas.menoux at nickyintheclouds.com  Fri Mar 15 08:20:39 2013
From: nicolas.menoux at nickyintheclouds.com (Nicolas Menoux)
Date: Fri, 15 Mar 2013 01:20:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster not running - getting Error:
 {cannot_discover_cluster,
 "The nodes provided are either offline or not running" error
In-Reply-To: <589c03be-aa02-4086-81c8-350afb250106@googlegroups.com>
References: <589c03be-aa02-4086-81c8-350afb250106@googlegroups.com>
Message-ID: <279bd2d1-b01e-4a7b-8001-d11e5f90b910@googlegroups.com>

Hi,

I think ssh is not the problem as it is completely outside from the scope. 
Did you check that you could ping the nodes each other. As you mentioned, 
you got a 2 node cluster so you have hostname1 and hostname2. In your slave 
hostname2 node, when you launch the join_cluster command, the node is 
trying to contact the instance rabbit at hostname1. Please check the instance 
is running on the master node (hostname1) and check you could ping it. You 
could edit your /etc/hosts to set the IP of the two nodes and try your 
join_cluster again.

Regards,

Nicolas

Le jeudi 28 f?vrier 2013 16:40:56 UTC+1, shankaralingegowda Singonahalli 
Chikkarevanna a ?crit :
>
> Hi,
> I am running Cluster setup of rabbitmq. 
> the single node at both the machines are running fine in the same network
>
> and I have enabled ssh entry for both master and slave
> slave can access master using ssh master
>
> after that I stopped rabbitmq slave machine
> and run join cluster command like join_cluster rabbitmq at master    ---{here 
> rabbitmq is master setup user name and I{p)
>
> but getting
> Error: {cannot_discover_cluster,"The nodes provided are either offline or 
> not running"
> error
> please help me to resolve the issue
>
> Thanks in advance
>
> shankarlaingegowda
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130315/0e147357/attachment.htm>

From tim at rabbitmq.com  Fri Mar 15 10:46:38 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 15 Mar 2013 10:46:38 +0000
Subject: [rabbitmq-discuss] Guidance on Using F5 Load Balancer with
	RabbitMQ
In-Reply-To: <CAO=6ox_prftz1q9pB5U5QKzNNgoKbV=uMJ0eu+G=WqEEinr_ug@mail.gmail.com>
References: <CAO=6ox_prftz1q9pB5U5QKzNNgoKbV=uMJ0eu+G=WqEEinr_ug@mail.gmail.com>
Message-ID: <5F33CA66-73A7-4F2D-B474-7FD02491ABB5@rabbitmq.com>

Hi Richard,

On 11 Mar 2013, at 20:55, Richard Raseley wrote:
> Is anyone able to share some "best practices" as it relates to using a F5 load balancer to distribute load between nodes of a RabbitMQ cluster?
> 

Can you explain a bit more clearly what you're trying to achieve please? Using a load balancer to maintain connectivity to a cluster is recommended and quite common, but that isn't going to 'distribute load between nodes' per se. Are you trying to distribute the load of publishing over multiple nodes, or consuming, or what? There are various things to consider depending on your goals.

> I am most interested in the persistence and timeout settings which we should be using in conjunction with RabbitMQ.
> 

There cannot be any specific settings that will work for all deployments - this will be application specific I would've thought. The only advice that springs to mind is if you are setting AMQP heartbeats on your connections, then make sure the proxy timeout is aligned with (i.e., greater than) these to avoid disturbing connections unnecessarily - but that's pretty obvious.

Cheers,
Tim

From simon at rabbitmq.com  Fri Mar 15 10:48:44 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Mar 2013 10:48:44 +0000
Subject: [rabbitmq-discuss] Pika connection negotiation behavior
In-Reply-To: <CAKwdTWdMGdL7QwKrRDApWubQxcKbm0CNH6k6T=Ar7TmGth8PcA@mail.gmail.com>
References: <CAKwdTWdMGdL7QwKrRDApWubQxcKbm0CNH6k6T=Ar7TmGth8PcA@mail.gmail.com>
Message-ID: <5142FC8C.4040006@rabbitmq.com>

Well, the max(client, server) behaviour is also what our clients do so 
the precedent is there. But ultimately the server will accept whatever 
the client asks for.

Cheers, Simon

On 15/03/13 06:03, Gavin M. Roy wrote:
> In Pika, currently and pre-dating my involvement, when tuning the
> connection, it uses the /*minimum*/ value above 0 that either the server
> or client provides for the heartbeat interval:
>
> https://github.com/pika/pika/blob/v0.5/pika/connection.py#L359
> https://github.com/pika/pika/blob/v0.5/pika/connection.py#L411
>
> Since introducing a heartbeat interval sent by the server of 600, this
> has set a */maximum/* heartbeat interval of 600 regardless of what the
> client sets upon creation.
>
> In reading the 0.9.1 spec, I did not see anything dictating any behavior
> of this sort for heartbeat interval negotiation.
>
> I'm inclined to allow the client to always overwrite the server, but
> since this behavior both pre-dates my involvement and is clearly
> intentional, I wanted to get some feedback before making the change.
>
> I currently have an open ticket tied to this that I would like to
> resolve before releasing 0.9.10: https://github.com/pika/pika/issues/303
>
> So, any thoughts?
>
> Gavin
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Fri Mar 15 11:49:49 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 15 Mar 2013 11:49:49 +0000
Subject: [rabbitmq-discuss] distributed cluster questions about
	performance
In-Reply-To: <71285c61-ba0b-457f-9e45-d984b4ad7c92@googlegroups.com>
References: <71285c61-ba0b-457f-9e45-d984b4ad7c92@googlegroups.com>
Message-ID: <231BA2D8-7098-4BEA-9131-C1E158CB7570@rabbitmq.com>

Hi,

On 13 Mar 2013, at 03:49, ??? wrote:
> In my scenario, a single server can hold 10k delivery rate and I use 6 node to load balance the pressure. My solution is that I created 2 queues on each node. Each message is with a random routing-key(something like message.0, message.1, etc) to distribute the pressure to every node. 
> 

I'm a bit confused here. You have two queues on each node - presumably one for hdfs and one for elastic-search - and you're sending messages to all of these. If the messages have a random routing key, how are your queues and bindings set up so that this works? Have I understood that properly? Also, have you looked at the consistent-hash-exchange plugin (https://github.com/rabbitmq/rabbitmq-consistent-hash-exchange) at all? It might fit your scenario.

> What confused me is:
> 
> 	? All message send to one node. Should I use a HA Proxy to load balance this publish pressure?

A queue always resides on just one node. If you have set up a cluster, then the queue is 'known' by all the nodes, but the actual worker (which enqueues and dequeues messages) still only resides on one node. In the cluster then, you can connect to any node and publish, but the messages you publish will *still* have to arrive at the node on which the queue resides (i.e., the node on which it was created) regardless of where the message originated.

If you use HA Proxy to balance the publishes, but you're also using a random routing key to distribute messages across multiple queues, then isn't there a fairly high change that HA Proxy will route the message to node1, but the routing key will end up requiring that node to forward the message to node2. I'm not entirely convinced that this will result in a more even distribution of work, but I could be wrong.

What might make a lot more sense, would be to divide up the publishing and publish messages directly to each node in parallel, instead of using the routing key to forward some messages to some nodes. Of course that makes publishing a bit harder.

> 	? Is there any performance difference between Durable Queues and Transient Queues?

Only when declaring them, afaik. Typically a transient queue will not receive persistent messages (remember - a durable queue will survive a restart, but messages delivered to it will not be persisted unless they're marked with delivery-mode=2), and non-persistent messages will yield higher throughput when they're not being written to disk. Even non-persistent messages may be paged to disk when the server is under load (i.e., is experiencing memory pressure).

> 	? Is there any performance difference between Memory Node and Disk Node? What I know is the difference between memory node and disk node is only about the meta data such as queue configuration.

That's correct. Disk nodes should perform a little better, as they do not have to fsync meta-data. Of course if you're not declaring queues/exchange/bindings very often but are publishing persistent messages, then that benefit may not be noticeable.

> 	? How can I import the performance in publish and delivery codes? I've researched and I know several methods:
> 		? disable the confirm mechanism(in publish codes?)

And disable message persistence. If you don't need persistent messages, then the cost of confirms may seem less onerous.

> 	? For example, input is 1w mps(message per second), there are two consumers to consume all message. Then the output is 2w mps. If my server can handle 1w mps, I need two server to handle the 2w-mps-pressure. Now a new consumer need to consume all message, too. As a result, output hits 3w mps, so I need another one more server. For a conclusion, one more consumer for all message, one more server?

I'm not quite sure if I've followed this at all and those assumptions don't look right to me. Here are some things to consider though: In general, adding more consumers to a single queue will increase throughput, possibly to the point where they can match publishing rates. Given an initially empty queue however, the consumption rate is not going to exceed the publishing rate. If you have two consumers and one publisher and you want both consumers to receive a copy of each message, then you'll have two queues bound to one exchange and the consumption rate for each queue will never exceed that of a single consumer. If you want to increase the consumption rate for a single queue, you can add more consumers to that queue and process messages in parallel.

If you want to distribute consumers across multiple nodes then as you've realised, the topology needs to change so that different queues reside on different nodes. Distributing the load of publishing across multiple nodes might help a bit, but I suspect that the cost of having to forward messages will reduce the benefits somewhat. Reworking your application design so that messages can be consumed in parallel from each queue will likely increase throughput quite a bit.

Cheers,
Tim



From simon at rabbitmq.com  Fri Mar 15 13:06:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Mar 2013 13:06:31 +0000
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <1363293736579-25462.post@n5.nabble.com>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
	<1363293736579-25462.post@n5.nabble.com>
Message-ID: <51431CD7.2040500@rabbitmq.com>

If we were to build the CHX this way, wouldn't that mean that as soon as 
you bound the first queue to it, all messages would have to get routed 
to that queue - and therefore subsequent bindings would have no effect 
since we can't change any routing?

Cheers, Simon

On 14/03/13 20:42, SteveO wrote:
> "You expected that once a routing key was routed to a queue, it continued
> routing to that specific queue until the queue is unbound? "
>
> Yeah, not sure why I - but that is what I expected. I probably started
> thinking that because that's what I wanted it to do :)
>
> We wanted to guarantee that at any given time, messages would only be
> delivered to one queue even if the bindings to other queues changed - like
> other queues being added. Processing messages in order is important for us
> and if we create a condition where messages exist in multiple queues, we
> can't guarantee that order. Over time, if we create and bind more queues to
> the same CHX, then we could create that condition - so we don't want to do
> that.
>
> If we run into an issue where we need to add more queues, it sounds like
> with a slightly more sophisticated producer and routing scheme, we could
> just add another CHX. Something like this...
>
>                               |--->CHX1--->Q1, Q2
> P ---> TopicExchange
>                               |--->CHX2--->Q1, Q2
>
> Thanks.
>
> s
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Confirm-consistent-hash-exchange-behavior-tp25458p25462.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From steveolivier22 at gmail.com  Fri Mar 15 15:46:58 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Fri, 15 Mar 2013 08:46:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <51431CD7.2040500@rabbitmq.com>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
	<1363293736579-25462.post@n5.nabble.com>
	<51431CD7.2040500@rabbitmq.com>
Message-ID: <1363362418350-25471.post@n5.nabble.com>

Subsequent bindings would have no affect on routing keys that have already
been seen. When a message with a new routing key arrives, new bindings (or
even existing ones) could be used for the new routing key.

Once I looked beyond the specific requirements of our application, and
thinking about distribution, I completely realize the behavior I seek breaks
the nature of the CHX. I understand why it's not doing what I want. So I
guess what I am looking at is some crazy feature or a completely different
exchange altogether.

Here are the high level requirements:
1. Need to scale
2. Need to process messages with the same routing key in order

Here is what is highly desired:
1. Elastic scaling of queues
2. No back-channel consumer/producer communication

A single queue with multiple consumers gives me req1, but not req2. A single
queue with a single consumer gives me req2, but not req1. By way of a CHX,
multiple queues and multiple consumers gets me both req1 and req2. However
with the CHX, if I accomplish scaling up by adding another queue and
consumer, I can run into situations where I can't guarantee req2. That's
because I can get messages with the same routing key in more than one queue.
For an alternative method of scale, I can accomplish req1 and req2 by adding
another CHX. However, with our application that would require some
back-channel communication between producers and consumers which is highly
undesirable.

A type of "pick and stick" method could work well for us. Our application is
processing messages for events that span a finite duration of time. These
events could last a few minutes, a few hours or a few days. Messages
pertaining to a specific event are signified by a GUID in the routing key.
Once the event is done, messages are consumed and processed, the routing key
for that event is never seen again. I just can't trust the timeliness of my
consumers, and I have to guarantee message processing order. That's why I
have to ensure that messages with the same routing key only exist in one
queue at a time.

I suspect I could have discussed this situation much better if had simply
stated that rather than questioning the CHX : )

Is this a crazy feature request for a switch to turn this on in the CHX?
Am I looking at a custom exchange?
Something else?

Thanks again.

s



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Confirm-consistent-hash-exchange-behavior-tp25458p25471.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From richard at raseley.com  Fri Mar 15 20:04:15 2013
From: richard at raseley.com (Richard Raseley)
Date: Fri, 15 Mar 2013 13:04:15 -0700
Subject: [rabbitmq-discuss] Guidance on Using F5 Load Balancer with
	RabbitMQ
In-Reply-To: <5F33CA66-73A7-4F2D-B474-7FD02491ABB5@rabbitmq.com>
References: <CAO=6ox_prftz1q9pB5U5QKzNNgoKbV=uMJ0eu+G=WqEEinr_ug@mail.gmail.com>
	<5F33CA66-73A7-4F2D-B474-7FD02491ABB5@rabbitmq.com>
Message-ID: <CAO=6ox-MHwuLj5DPKj=2WOi7N4cYVq5Q5za6MMRQ0AhZvkLxng@mail.gmail.com>

Tim,

Thank you for your reply. In regard to your comments:

The intent is to abstract all production and consumption operations via the
VIP (which itself is mapped to a pool which contains all of our RabbitMQ
nodes) so that there is a single configured endpoint. With regard to load
balancing, it will load balance across the nodes so that if (for example)
10 producer instances opened up 10 channels to the VIP, 5 would have one
node as an endpoint and 5 would have the other (assuming a 2 node cluster
and round-robin configuration).

I understand that any timeout settings would have to be tuned for the
application, but I was looking for some high level general guidelines (e.g.
"in situation x, consider y and z"). We've ensured that our timeout is
greater than the heartbeat interval.

Regards,

Richard


On Fri, Mar 15, 2013 at 3:46 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Richard,
>
> On 11 Mar 2013, at 20:55, Richard Raseley wrote:
> > Is anyone able to share some "best practices" as it relates to using a
> F5 load balancer to distribute load between nodes of a RabbitMQ cluster?
> >
>
> Can you explain a bit more clearly what you're trying to achieve please?
> Using a load balancer to maintain connectivity to a cluster is recommended
> and quite common, but that isn't going to 'distribute load between nodes'
> per se. Are you trying to distribute the load of publishing over multiple
> nodes, or consuming, or what? There are various things to consider
> depending on your goals.
>
> > I am most interested in the persistence and timeout settings which we
> should be using in conjunction with RabbitMQ.
> >
>
> There cannot be any specific settings that will work for all deployments -
> this will be application specific I would've thought. The only advice that
> springs to mind is if you are setting AMQP heartbeats on your connections,
> then make sure the proxy timeout is aligned with (i.e., greater than) these
> to avoid disturbing connections unnecessarily - but that's pretty obvious.
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130315/c201c8ea/attachment.htm>

From videlalvaro at gmail.com  Fri Mar 15 21:56:52 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 15 Mar 2013 22:56:52 +0100
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <1363362418350-25471.post@n5.nabble.com>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
	<1363293736579-25462.post@n5.nabble.com>
	<51431CD7.2040500@rabbitmq.com>
	<1363362418350-25471.post@n5.nabble.com>
Message-ID: <CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>

Hi,

I think this solution can address your problem:

- Create queues 1, 2, .... N
- Bind queues to the CHX
- publish the queue names to a queue called "lock" for example.

Start consumer A, and make it consume _just one message_ from queue "lock",
in ack mode. That message will contain the queue name from where that
consumer needs to get messages.

Then you can start consumer B and do the same, so you get the name of the
next queue where to get the messages.

Because you are using the CH exchange, messages witch certain routing key
will always end up in the same queue. Therefore you can also process
messages in order.

If you need to stop one of those consumers, they need to
basic_reject(requeue=true) the message they first got from the "lock" queue
so another consumer can use that queue. If one of those consumers crashes
then the message with the queue name will get requeued. NOTE: you never ack
any message from the "lock" queue.

Does this help?

Regards,

Alvaro



On Fri, Mar 15, 2013 at 4:46 PM, SteveO <steveolivier22 at gmail.com> wrote:

> Subsequent bindings would have no affect on routing keys that have already
> been seen. When a message with a new routing key arrives, new bindings (or
> even existing ones) could be used for the new routing key.
>
> Once I looked beyond the specific requirements of our application, and
> thinking about distribution, I completely realize the behavior I seek
> breaks
> the nature of the CHX. I understand why it's not doing what I want. So I
> guess what I am looking at is some crazy feature or a completely different
> exchange altogether.
>
> Here are the high level requirements:
> 1. Need to scale
> 2. Need to process messages with the same routing key in order
>
> Here is what is highly desired:
> 1. Elastic scaling of queues
> 2. No back-channel consumer/producer communication
>
> A single queue with multiple consumers gives me req1, but not req2. A
> single
> queue with a single consumer gives me req2, but not req1. By way of a CHX,
> multiple queues and multiple consumers gets me both req1 and req2. However
> with the CHX, if I accomplish scaling up by adding another queue and
> consumer, I can run into situations where I can't guarantee req2. That's
> because I can get messages with the same routing key in more than one
> queue.
> For an alternative method of scale, I can accomplish req1 and req2 by
> adding
> another CHX. However, with our application that would require some
> back-channel communication between producers and consumers which is highly
> undesirable.
>
> A type of "pick and stick" method could work well for us. Our application
> is
> processing messages for events that span a finite duration of time. These
> events could last a few minutes, a few hours or a few days. Messages
> pertaining to a specific event are signified by a GUID in the routing key.
> Once the event is done, messages are consumed and processed, the routing
> key
> for that event is never seen again. I just can't trust the timeliness of my
> consumers, and I have to guarantee message processing order. That's why I
> have to ensure that messages with the same routing key only exist in one
> queue at a time.
>
> I suspect I could have discussed this situation much better if had simply
> stated that rather than questioning the CHX : )
>
> Is this a crazy feature request for a switch to turn this on in the CHX?
> Am I looking at a custom exchange?
> Something else?
>
> Thanks again.
>
> s
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Confirm-consistent-hash-exchange-behavior-tp25458p25471.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130315/57182ffe/attachment.htm>

From gmr at meetme.com  Fri Mar 15 22:18:27 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 15 Mar 2013 15:18:27 -0700
Subject: [rabbitmq-discuss] Pika connection negotiation behavior
In-Reply-To: <5142FC8C.4040006@rabbitmq.com>
References: <CAKwdTWdMGdL7QwKrRDApWubQxcKbm0CNH6k6T=Ar7TmGth8PcA@mail.gmail.com>
	<5142FC8C.4040006@rabbitmq.com>
Message-ID: <CAKwdTWePaMh5=+yWJn6MbdB4unGW=oRNizy1jbeYZb8avTBmaQ@mail.gmail.com>

So for the point of clarity, this is the behavior of the Java, .net and
erlang client libraries -- is it the proper behavior? Should it be changed?

The documentation for RabbitMQ's server configuration does not specify that
this is (can be for some clients) the max value.

I'm inclined to change it in pika due to the non-documented and
non-specified behavior.

Gavin


On Fri, Mar 15, 2013 at 3:48 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Well, the max(client, server) behaviour is also what our clients do so the
> precedent is there. But ultimately the server will accept whatever the
> client asks for.
>
> Cheers, Simon
>
>
> On 15/03/13 06:03, Gavin M. Roy wrote:
>
>> In Pika, currently and pre-dating my involvement, when tuning the
>> connection, it uses the /*minimum*/ value above 0 that either the server
>>
>> or client provides for the heartbeat interval:
>>
>> https://github.com/pika/pika/**blob/v0.5/pika/connection.py#**L359<https://github.com/pika/pika/blob/v0.5/pika/connection.py#L359>
>> https://github.com/pika/pika/**blob/v0.5/pika/connection.py#**L411<https://github.com/pika/pika/blob/v0.5/pika/connection.py#L411>
>>
>> Since introducing a heartbeat interval sent by the server of 600, this
>> has set a */maximum/* heartbeat interval of 600 regardless of what the
>>
>> client sets upon creation.
>>
>> In reading the 0.9.1 spec, I did not see anything dictating any behavior
>> of this sort for heartbeat interval negotiation.
>>
>> I'm inclined to allow the client to always overwrite the server, but
>> since this behavior both pre-dates my involvement and is clearly
>> intentional, I wanted to get some feedback before making the change.
>>
>> I currently have an open ticket tied to this that I would like to
>> resolve before releasing 0.9.10: https://github.com/pika/pika/**
>> issues/303 <https://github.com/pika/pika/issues/303>
>>
>> So, any thoughts?
>>
>> Gavin
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130315/fd62ddad/attachment.htm>

From matthias at rabbitmq.com  Fri Mar 15 22:37:51 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 15 Mar 2013 22:37:51 +0000
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
	<1363293736579-25462.post@n5.nabble.com>
	<51431CD7.2040500@rabbitmq.com>
	<1363362418350-25471.post@n5.nabble.com>
	<CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
Message-ID: <5143A2BF.6060805@rabbitmq.com>

On 15/03/13 21:56, Alvaro Videla wrote:
> - Create queues 1, 2, .... N
> - Bind queues to the CHX
> - publish the queue names to a queue called "lock" for example.
> [etc]

With that approach the number of consumers must be exactly the same as 
the number of queues; if you have fewer then some messages won't get 
consumed, and if you have more then some consumers won't process any 
messages.

Furthermore, you cannot add/remove queues since that will cause some 
subsequent messages to get routed to different queues than prior to the 
queue addition/removal. They will then be picked up by different consumers.

Matthias.

From brett.r.cameron at gmail.com  Fri Mar 15 22:49:45 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Sat, 16 Mar 2013 11:49:45 +1300
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <5143A2BF.6060805@rabbitmq.com>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
	<1363293736579-25462.post@n5.nabble.com>
	<51431CD7.2040500@rabbitmq.com>
	<1363362418350-25471.post@n5.nabble.com>
	<CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
	<5143A2BF.6060805@rabbitmq.com>
Message-ID: <CALPqkip_SPy2VB+-J6FVMGs_8FwAa8LPhosOvKFLwEcWL2wUbA@mail.gmail.com>

Could you possibly get around this by extending Alvaro's idea a little bit,
and have consumers do a basic.reject with requeue=true on messages (queue
names) consumed from the "lock" queue?

On Sat, Mar 16, 2013 at 11:37 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 15/03/13 21:56, Alvaro Videla wrote:
>
>> - Create queues 1, 2, .... N
>> - Bind queues to the CHX
>> - publish the queue names to a queue called "lock" for example.
>> [etc]
>>
>
> With that approach the number of consumers must be exactly the same as the
> number of queues; if you have fewer then some messages won't get consumed,
> and if you have more then some consumers won't process any messages.
>
> Furthermore, you cannot add/remove queues since that will cause some
> subsequent messages to get routed to different queues than prior to the
> queue addition/removal. They will then be picked up by different consumers.
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130316/c063cffc/attachment.htm>

From matthias at rabbitmq.com  Fri Mar 15 22:57:19 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 15 Mar 2013 22:57:19 +0000
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <CALPqkip_SPy2VB+-J6FVMGs_8FwAa8LPhosOvKFLwEcWL2wUbA@mail.gmail.com>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
	<1363293736579-25462.post@n5.nabble.com>
	<51431CD7.2040500@rabbitmq.com>
	<1363362418350-25471.post@n5.nabble.com>
	<CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
	<5143A2BF.6060805@rabbitmq.com>
	<CALPqkip_SPy2VB+-J6FVMGs_8FwAa8LPhosOvKFLwEcWL2wUbA@mail.gmail.com>
Message-ID: <5143A74F.6080000@rabbitmq.com>

On 15/03/13 22:49, Brett Cameron wrote:
> Could you possibly get around this by extending Alvaro's idea a little
> bit, and have consumers do a basic.reject with requeue=true on messages
> (queue names) consumed from the "lock" queue?

The whole point of the "lock" queue is to ensure that at most one 
consumer consumes from a given queue. Requeueing messages there, and 
thus releasing the lock, would break that.

Matthias.

From steveolivier22 at gmail.com  Sat Mar 16 00:17:57 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Fri, 15 Mar 2013 17:17:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <5143A74F.6080000@rabbitmq.com>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
	<1363293736579-25462.post@n5.nabble.com>
	<51431CD7.2040500@rabbitmq.com>
	<1363362418350-25471.post@n5.nabble.com>
	<CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
	<5143A2BF.6060805@rabbitmq.com>
	<CALPqkip_SPy2VB+-J6FVMGs_8FwAa8LPhosOvKFLwEcWL2wUbA@mail.gmail.com>
	<5143A74F.6080000@rabbitmq.com>
Message-ID: <1363393077582-25478.post@n5.nabble.com>

Thanks all for the feedback.

I'm not certain how to handle my basic "elastic scale up" scenario. That
would be where I have 4 queues bound to the CHX, and my consumers aren't
keeping up. I add a 5th without removing any of the other 4. I think that is
a condition where I could wind up with messages with the same routing key in
multiple queues.

Our application will have producers sending messages with new GUIDs in the
routing key throughout the course of any given day. The frequency of just
how many new GUIDs over a set duration of time will vary throughout the
course of the day. Business hours would have more new GUIDs than
off-business hours, for example. That's why I thought it would be in my best
interest to have a mechanism for scaling up and down. That just gets really
tricky when I have that "must process everything in order" requirement.

s



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Confirm-consistent-hash-exchange-behavior-tp25458p25478.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Sat Mar 16 10:27:07 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 16 Mar 2013 10:27:07 +0000
Subject: [rabbitmq-discuss] Pika connection negotiation behavior
In-Reply-To: <CAKwdTWePaMh5=+yWJn6MbdB4unGW=oRNizy1jbeYZb8avTBmaQ@mail.gmail.com>
References: <CAKwdTWdMGdL7QwKrRDApWubQxcKbm0CNH6k6T=Ar7TmGth8PcA@mail.gmail.com>
	<5142FC8C.4040006@rabbitmq.com>
	<CAKwdTWePaMh5=+yWJn6MbdB4unGW=oRNizy1jbeYZb8avTBmaQ@mail.gmail.com>
Message-ID: <514448FB.3060707@rabbitmq.com>

Gavin,

On 15/03/13 22:18, Gavin M. Roy wrote:
> So for the point of clarity, this is the behavior of the Java, .net and
> erlang client libraries -- is it the proper behavior? Should it be changed?

It's reasonably sensible behaviour, imo. The spec is silent on the matter.

> The documentation for RabbitMQ's server configuration does not specify
> that this is (can be for some clients) the max value.

The server doesn't know or care what the clients do. It simply sends out 
a suggested value and accepts whatever comes back.

> I'm inclined to change it in pika due to the non-documented and
> non-specified behavior.

What is the motivation for that? I can't think of many circumstances 
where it might be desirable to exceed the default interval of 10 minutes.

Regards,

Matthias.

From rikeshgupta at gmail.com  Sat Mar 16 07:42:30 2013
From: rikeshgupta at gmail.com (Rikesh Gupta)
Date: Sat, 16 Mar 2013 00:42:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Starting rabbitmq-server: FAILED
In-Reply-To: <CANL-a0KHtWid83S_obQbsW7Ft3Y6C2gFT4=C4NbD5oV+ccOT-Q@mail.gmail.com>
References: <CANL-a0KHtWid83S_obQbsW7Ft3Y6C2gFT4=C4NbD5oV+ccOT-Q@mail.gmail.com>
Message-ID: <6df67d09-41ba-485b-9373-bbd88d07b09b@googlegroups.com>

how do i stop any previous rabbitmq if running...

On Tuesday, February 21, 2012 2:51:47 AM UTC+5:30, Abhishek Singh Bailoo 
wrote:
>
> Greetings!
>
> I am a newb to RabbitMQ and the whole Erlang thing :) 
>
> I compiled from source and installed RabbitMQ on my server (an Amazon EC2 
> instance). It was configured to run with CouchDB. 
>
> After that I tried to upgrade by using apt-get install. It did warn me 
> that it was upgrading from lesser than version 1.5.4 to version 1.6.0 and 
> since my database was different, it will take a backup but old settings 
> will be lost. I was fine with it. 
>
> Now rabbitmq-server does not start, complaining
>
> Setting up rabbitmq-server (1.7.2-1ubuntu1) ...
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, 
> _err
> rabbitmq-server.
> invoke-rc.d: initscript rabbitmq-server, action "start" failed.
> dpkg: error processing rabbitmq-server (--configure):
>  subprocess installed post-installation script returned error exit status 1
> Errors were encountered while processing:
>  rabbitmq-server
> E: Sub-process /usr/bin/dpkg returned an error code (1)
>
> I tried apt-get remove rabbitmq-server and manually deleted the directory 
> /var/lib/rabbitmq and then again tried to do apt-get install but it gives 
> the same error. 
>
> Any help will be much appreciated!
>
> startup logs are ...
>
> # cat /var/log/rabbitmq/startup_err 
> Error: {node_start_failed,normal}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) 
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>
>
> # cat /var/log/rabbitmq/startup_log
> Starting all nodes...
> Starting node rabbit at ip-10-252-17-24...
> {error_logger,{{2012,2,20},{21,12,19}},"Protocol: ~p: register error: 
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>
> {error_logger,{{2012,2,20},{21,12,19}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.107>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,484}],[]]}
>
> {error_logger,{{2012,2,20},{21,12,19}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>
> {error_logger,{{2012,2,20},{21,12,19}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>
> {error_logger,{{2012,2,20},{21,12,19}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid 
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>
>
>
>
> regards,
> Abhishek Singh Bailoo,
> Platform Team
> Knowlus, FreeSWITCH.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130316/98609f3e/attachment.htm>

From watson.timothy at gmail.com  Sat Mar 16 11:32:29 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 16 Mar 2013 11:32:29 +0000
Subject: [rabbitmq-discuss] Starting rabbitmq-server: FAILED
In-Reply-To: <6df67d09-41ba-485b-9373-bbd88d07b09b@googlegroups.com>
References: <CANL-a0KHtWid83S_obQbsW7Ft3Y6C2gFT4=C4NbD5oV+ccOT-Q@mail.gmail.com>
	<6df67d09-41ba-485b-9373-bbd88d07b09b@googlegroups.com>
Message-ID: <524ED3E1-4778-4759-9FA1-BFD389298CC1@rabbitmq.com>

You should issue the command like so:

'sudo rabbitmqctl stop'

Version 1.6 is ancient - use should consider downloading 3.0.4 from the website an installing that instead. Rea the upgrade instructions from the release notes carefully though.

Cheers,
Tim

On 16 Mar 2013, at 07:42, Rikesh Gupta <rikeshgupta at gmail.com> wrote:

> how do i stop any previous rabbitmq if running...
> 
> On Tuesday, February 21, 2012 2:51:47 AM UTC+5:30, Abhishek Singh Bailoo wrote:
> Greetings!
> 
> I am a newb to RabbitMQ and the whole Erlang thing :) 
> 
> I compiled from source and installed RabbitMQ on my server (an Amazon EC2 instance). It was configured to run with CouchDB. 
> 
> After that I tried to upgrade by using apt-get install. It did warn me that it was upgrading from lesser than version 1.5.4 to version 1.6.0 and since my database was different, it will take a backup but old settings will be lost. I was fine with it. 
> 
> Now rabbitmq-server does not start, complaining
> 
> Setting up rabbitmq-server (1.7.2-1ubuntu1) ...
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_log, _err
> rabbitmq-server.
> invoke-rc.d: initscript rabbitmq-server, action "start" failed.
> dpkg: error processing rabbitmq-server (--configure):
>  subprocess installed post-installation script returned error exit status 1
> Errors were encountered while processing:
>  rabbitmq-server
> E: Sub-process /usr/bin/dpkg returned an error code (1)
> 
> I tried apt-get remove rabbitmq-server and manually deleted the directory /var/lib/rabbitmq and then again tried to do apt-get install but it gives the same error. 
> 
> Any help will be much appreciated!
> 
> startup logs are ...
> 
> # cat /var/log/rabbitmq/startup_err 
> Error: {node_start_failed,normal}
> 
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> 
> 
> # cat /var/log/rabbitmq/startup_log
> Starting all nodes...
> Starting node rabbit at ip-10-252-17-24...
> {error_logger,{{2012,2,20},{21,12,19}},"Protocol: ~p: register error: ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
> {error_logger,{{2012,2,20},{21,12,19}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[#Port<0.107>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,484}],[]]}
> {error_logger,{{2012,2,20},{21,12,19}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2012,2,20},{21,12,19}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2012,2,20},{21,12,19}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
> 
> 
> 
> 
> regards,
> Abhishek Singh Bailoo,
> Platform Team
> Knowlus, FreeSWITCH.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130316/9d4a60e5/attachment.htm>

From tim at rabbitmq.com  Sat Mar 16 15:27:16 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Sat, 16 Mar 2013 15:27:16 +0000
Subject: [rabbitmq-discuss] Guidance on Using F5 Load Balancer with
	RabbitMQ
In-Reply-To: <CAO=6ox-MHwuLj5DPKj=2WOi7N4cYVq5Q5za6MMRQ0AhZvkLxng@mail.gmail.com>
References: <CAO=6ox_prftz1q9pB5U5QKzNNgoKbV=uMJ0eu+G=WqEEinr_ug@mail.gmail.com>
	<5F33CA66-73A7-4F2D-B474-7FD02491ABB5@rabbitmq.com>
	<CAO=6ox-MHwuLj5DPKj=2WOi7N4cYVq5Q5za6MMRQ0AhZvkLxng@mail.gmail.com>
Message-ID: <16B51C4C-0EFE-47BE-825B-E84D21DA19BE@rabbitmq.com>

Hi Richard,

On 15 Mar 2013, at 20:04, Richard Raseley wrote:
> The intent is to abstract all production and consumption operations via the VIP (which itself is mapped to a pool which contains all of our RabbitMQ nodes) so that there is a single configured endpoint. With regard to load balancing, it will load balance across the nodes so that if (for example) 10 producer instances opened up 10 channels to the VIP, 5 would have one node as an endpoint and 5 would have the other (assuming a 2 node cluster and round-robin configuration).
> 

Ok, but you do realise that a single queue will reside on only one node, and therefore messages sent to other nodes in the cluster will still have to be routed/forwarded to the node on which the queue resides?

> I understand that any timeout settings would have to be tuned for the application, but I was looking for some high level general guidelines (e.g. "in situation x, consider y and z"). We've ensured that our timeout is greater than the heartbeat interval.
> 

I think heartbeats are the main (general) thing to be considered. Perhaps other users who're more familiar with production configurations such as these will have more to add though.

Cheers,
Tim

> Regards,
> 
> Richard
> 
> 
> On Fri, Mar 15, 2013 at 3:46 AM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi Richard,
> 
> On 11 Mar 2013, at 20:55, Richard Raseley wrote:
> > Is anyone able to share some "best practices" as it relates to using a F5 load balancer to distribute load between nodes of a RabbitMQ cluster?
> >
> 
> Can you explain a bit more clearly what you're trying to achieve please? Using a load balancer to maintain connectivity to a cluster is recommended and quite common, but that isn't going to 'distribute load between nodes' per se. Are you trying to distribute the load of publishing over multiple nodes, or consuming, or what? There are various things to consider depending on your goals.
> 
> > I am most interested in the persistence and timeout settings which we should be using in conjunction with RabbitMQ.
> >
> 
> There cannot be any specific settings that will work for all deployments - this will be application specific I would've thought. The only advice that springs to mind is if you are setting AMQP heartbeats on your connections, then make sure the proxy timeout is aligned with (i.e., greater than) these to avoid disturbing connections unnecessarily - but that's pretty obvious.
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From carl.hoerberg at gmail.com  Sat Mar 16 16:37:50 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sat, 16 Mar 2013 09:37:50 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
Message-ID: <1363451870687-25483.post@n5.nabble.com>

If you specify this chipers:
{ciphers,[{rsa,rc4_128,sha},{rsa,aes_128_cbc,sha}]}]}
and a client connects with rsa,rc4_128,sha, RabbitMQ 3.0 memory usage will
grow indefinitely until i crashes. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Sat Mar 16 17:25:09 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 16 Mar 2013 17:25:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <1363451870687-25483.post@n5.nabble.com>
References: <1363451870687-25483.post@n5.nabble.com>
Message-ID: <5144AAF5.4030500@rabbitmq.com>

On 16/03/13 16:37, carlhoerberg wrote:
> If you specify this chipers:
> {ciphers,[{rsa,rc4_128,sha},{rsa,aes_128_cbc,sha}]}]}
> and a client connects with rsa,rc4_128,sha, RabbitMQ 3.0 memory usage will
> grow indefinitely until i crashes.

Works fine for me:

$ ./scripts/rabbitmqctl status
Status of node rabbit at i ...
[{pid,5015},
  {running_applications,[{rabbit,"RabbitMQ","%%VSN%%"},
                         {ssl,"Erlang/OTP SSL application","5.2.1"},
                         {public_key,"Public key infrastructure","0.18"},
                         {crypto,"CRYPTO version 2","2.3"},
                         {mnesia,"MNESIA  CXC 138 12","4.8"},
                         {os_mon,"CPO  CXC 138 46","2.2.11"},
                         {xmerl,"XML parser","1.3.3"},
                         {sasl,"SASL  CXC 138 11","2.3.1"},
                         {stdlib,"ERTS  CXC 138 10","1.19.1"},
                         {kernel,"ERTS  CXC 138 10","2.16.1"}]},
  {os,{unix,linux}},
  {erlang_version,"Erlang R16B (erts-5.10.1) [source] [64-bit] [smp:8:8] 
[async-threads:30] [hipe] [kernel-poll:true]\n"},
...]
...done.

$ ./scripts/rabbitmqctl environment
Application environment of node rabbit at i ...
[...
  {ssl_options,[{cacertfile,"certs/testca/cacert.pem"},
                {certfile,"certs/server/cert.pem"},
                {keyfile,"certs/server/key.pem"},
                {verify_code,1},
                {ciphers,[{rsa,rc4_128,sha},{rsa,aes_128_cbc,sha}]}]},
  ...]
...done.

$ ./scripts/rabbitmqctl list_connections name ssl_key_exchange 
ssl_cipher ssl_hash
Listing connections ...
127.0.0.1:51467 -> 127.0.0.1:5671	rsa	rc4_128	sha
...done.

That connection is from an Erlang client.


So presumably there is something different in your environment. Any idea 
what that might be?


Regards,

Matthias.

From carl.hoerberg at gmail.com  Sat Mar 16 17:34:50 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sat, 16 Mar 2013 10:34:50 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <5144AAF5.4030500@rabbitmq.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
Message-ID: <1363455290957-25485.post@n5.nabble.com>

Actually all ciphers gives the same result, memory just grows and grows. But
by rejecting port 5671 it immediately  drops down to normal level. 

Ubuntu 12.04, RabbitMQ 3.0.4, Erlang R14B04

[
  {rabbit, [
     {log_levels, [{connection, error}]},
     {tcp_listeners, [{"0.0.0.0", 5672}]},
     {ssl_listeners, [{"0.0.0.0", 5671}]},
     {ssl_options, [{cacertfile,"/etc/rabbitmq/ca.pem"},
                    {certfile,"/etc/rabbitmq/key.pem"}
                   ]}
   ]},
{rabbitmq_management,
  [{listener, [{port, 15672},
               {ip, "0.0.0.0"},
                {ssl,      true}
              ]}
  ]}
].




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25485.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Sat Mar 16 17:38:59 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 16 Mar 2013 17:38:59 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <1363455290957-25485.post@n5.nabble.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
	<1363455290957-25485.post@n5.nabble.com>
Message-ID: <5144AE33.1070502@rabbitmq.com>

On 16/03/13 17:34, carlhoerberg wrote:
> Actually all ciphers gives the same result, memory just grows and grows. But
> by rejecting port 5671 it immediately  drops down to normal level.
>
> Ubuntu 12.04, RabbitMQ 3.0.4, Erlang R14B04

Give R16B a try.

Matthias.

From carl.hoerberg at gmail.com  Sat Mar 16 17:48:32 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sat, 16 Mar 2013 10:48:32 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <5144AE33.1070502@rabbitmq.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
	<1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
Message-ID: <55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>

Yes, a non clustered 3.0.1 works fine with ssl, but not this clustered 3.0.4 :( can try with R16B tmrw. 



On Sunday 17 March 2013 at 01:40, Matthias Radestock-3 [via RabbitMQ] wrote:

> On 16/03/13 17:34, carlhoerberg wrote: 
> > Actually all ciphers gives the same result, memory just grows and grows. But 
> > by rejecting port 5671 it immediately drops down to normal level. 
> > 
> > Ubuntu 12.04, RabbitMQ 3.0.4, Erlang R14B04 
> 
> Give R16B a try. 
> 
> Matthias. 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=25486&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25486.html 
> To unsubscribe from RabbitMQ 3.0, SSL and rc4, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25483&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU0ODN8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25487.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130316/6a9e3bd6/attachment.htm>

From matthias at rabbitmq.com  Sat Mar 16 18:29:09 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 16 Mar 2013 18:29:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
	<1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
	<55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
Message-ID: <5144B9F5.9070008@rabbitmq.com>

On 16/03/13 17:48, carlhoerberg wrote:
> Yes, a non clustered 3.0.1 works fine with ssl, but not this clustered
> 3.0.4 :( can try with R16B tmrw.

Can't see why clustering would make a difference, unless you are running 
distributed Erlang over SSL, which presumably you aren't.

FWIW, I have a clustered 3.0.4 running here, on R14B04 on Ubuntu 12.04, 
and SSL connections work just fine.

Matthias.

From carl.hoerberg at gmail.com  Sat Mar 16 23:48:16 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sat, 16 Mar 2013 16:48:16 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <5144B9F5.9070008@rabbitmq.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
	<1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
	<55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
	<5144B9F5.9070008@rabbitmq.com>
Message-ID: <DE0603B04256494BA7049D92B15132CA@gmail.com>

You're right, it's a user, which happened to use SSL, that's is doing something that makes the server use a lot of memory, within minutes it makes the memory consumption go up to over 7GB. As soon as that connection is closed the memory falls back to normal levels, ~200mb. Will try to figure out what that user is doing.. 



On Sunday 17 March 2013 at 02:30, Matthias Radestock-3 [via RabbitMQ] wrote:

> On 16/03/13 17:48, carlhoerberg wrote: 
> > Yes, a non clustered 3.0.1 works fine with ssl, but not this clustered 
> > 3.0.4 :( can try with R16B tmrw. 
> 
> 
> Can't see why clustering would make a difference, unless you are running 
> distributed Erlang over SSL, which presumably you aren't. 
> 
> FWIW, I have a clustered 3.0.4 running here, on R14B04 on Ubuntu 12.04, 
> and SSL connections work just fine. 
> 
> Matthias. 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=25488&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25488.html 
> To unsubscribe from RabbitMQ 3.0, SSL and rc4, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25483&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU0ODN8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25489.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130316/17766cb8/attachment.htm>

From carl.hoerberg at gmail.com  Sun Mar 17 03:05:42 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sat, 16 Mar 2013 20:05:42 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <5144B9F5.9070008@rabbitmq.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
	<1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
	<55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
	<5144B9F5.9070008@rabbitmq.com>
Message-ID: <BE879CAB47B74E62A8A201303B4196A6@gmail.com>

The client in question is using Langohr 1.0.0-beta10-SNAPSHOT.

The users says he's just consuming, but the mgmt interface shows that's he's both sending and receiving traffic in ~20kb/s, but only receiving 0.5msg/sec and not delivering any messages. When the connection if force closed this is returned:

{exit, {channel_termination_timeout, {gen_server,call, [<0.27132.1>,{shutdown,"Closed via management plugin"},infinity]}}, [{gen_server,call,3}, {rabbit_mgmt_wm_connection,delete_resource,2}, {webmachine_resource,resource_call,3}, {webmachine_resource,do,3}, {webmachine_decision_core,resource_call,1}, {webmachine_decision_core,decision,1}, {webmachine_decision_core,handle_request,2}, {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}

We hadn't this problems with 2.8.7, but maybe it's a user error. I've encouraged the user to upgrade to the latest langohr.   


On Sunday 17 March 2013 at 07:47, Carl H?rberg wrote:

> You're right, it's a user, which happened to use SSL, that's is doing something that makes the server use a lot of memory, within minutes it makes the memory consumption go up to over 7GB. As soon as that connection is closed the memory falls back to normal levels, ~200mb. Will try to figure out what that user is doing..  
>  
>  
>  
> On Sunday 17 March 2013 at 02:30, Matthias Radestock-3 [via RabbitMQ] wrote:
>  
> > On 16/03/13 17:48, carlhoerberg wrote:  
> > > Yes, a non clustered 3.0.1 works fine with ssl, but not this clustered  
> > > 3.0.4 :( can try with R16B tmrw.  
> >  
> >  
> >  
> >  
> > Can't see why clustering would make a difference, unless you are running  
> > distributed Erlang over SSL, which presumably you aren't.  
> >  
> > FWIW, I have a clustered 3.0.4 running here, on R14B04 on Ubuntu 12.04,  
> > and SSL connections work just fine.  
> >  
> > Matthias.  
> > _______________________________________________  
> > rabbitmq-discuss mailing list  
> > [hidden email] (/user/SendEmail.jtp?type=node&node=25488&i=0)  
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >  
> >  
> > If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25488.html  
> > To unsubscribe from RabbitMQ 3.0, SSL and rc4, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25483&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU0ODN8LTEyNDcxMDc4NjM=).
> > NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml)  
>  







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25490.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130316/e9a9d7cc/attachment.htm>

From gmr at meetme.com  Sun Mar 17 04:57:29 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Sat, 16 Mar 2013 21:57:29 -0700
Subject: [rabbitmq-discuss] pika 0.9.10 Released
Message-ID: <CAKwdTWcB8Aa6Hf17v0CDqmBg3AjO4LsRQfDnH47rrge4Ey=WvA@mail.gmail.com>

Pika 0.9.10 is a bugfix release addressing multiple issues including a
issue with BlockingConnection causing heavy CPU usage in Linux
environments. All pika users are urged to upgrade to 0.9.10.

Special thanks to Jan Urba?ski, Richard Boulton, cellscape, patcpsc, Mik
Kocikowski, and Nathan Lundquist for their multiple contributions.

The documentation has been updated with a few more examples and edits for
clarification and can found at *http://pika.readthedocs.org/*

*Bugfixes*

   - Fix timeout in twisted adapter (Submitted by cellscape)
   - Fix blocking_connection poll timer resolution to milliseconds
   (Submitted by cellscape)
   - Fix channel._on_close() without a method frame (Submitted by Richard
   Boulton)
   - Addressed exception on close (Issue #279 - fix by patcpsc)
   - 'messages' not initialized in BlockingConnection.cancel() (Issue #289
   - fix by Mik Kocikowski)
   - Make queue_unbind behave like queue_bind (Issue #277)
   - Address closing behavioral issues for connections and channels (Issue
   #275, patches by )
   - Pass a Method frame to Channel._on_close in Connection._on_disconnect
   (Submitted by Jan Urba?ski)
   - Fix channel closed callback signature in the Twisted adapter
   (Submitted by Jan Urba?ski)
   - Don't stop the IOLoop on connection close for in the Twisted adapter
   (Submitted by Jan Urba?ski)
   - Update the asynchronous examples to fix reconnecting and have it work
   - Warn if the socket was closed such as if RabbitMQ dies without a Close
   frame
   - Fix URLParameters ssl_options (Issue #296)
   - Add state to BlockingConnection addressing (Issue #301)
   - Encode unicode body content prior to publishing (Issue #282)
   - Fix an issue with unicode keys in BasicProperties headers key (Issue
   #280)
   - Change how timeout ids are generated (Issue #254)
   - Address post close state issues in Channel (Issue #302)

*Behavior changes*

   - Change core connection communication behavior to prefer outbound
   writes over reads, addressing a recursion issue
   - Update connection on close callbacks, changing callback method
   signature
   - Update channel on close callbacks, changing callback method signature
   - Give more info in the ChannelClosed exception
   - Change the constructor signature for BlockingConnection, block
   open/close callbacks
   - Disable the use of add_on_open_callback/add_on_close_callback methods
   in BlockingConnection

If you happen across any bugs, please report them at https://github.com/pika
/pika/issues

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130316/abd82da4/attachment.htm>

From matthias at rabbitmq.com  Sun Mar 17 09:18:26 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 17 Mar 2013 09:18:26 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <BE879CAB47B74E62A8A201303B4196A6@gmail.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
	<1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
	<55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
	<5144B9F5.9070008@rabbitmq.com>
	<BE879CAB47B74E62A8A201303B4196A6@gmail.com>
Message-ID: <51458A62.3080802@rabbitmq.com>

On 17/03/13 03:05, carlhoerberg wrote:
> The users says he's just consuming, but the mgmt interface shows that's
> he's both sending and receiving traffic in ~20kb/s, but only receiving
> 0.5msg/sec and not delivering any messages.

Are you saying there's 20kb/s traffic each way on the connection, but 
the publishing rate is 0 msg/s and the consuming rate is 0.5 msg/s?

Perhaps there is some weird ssl chatter going on. Could you ask the user 
to connect without SSL?

It would be good to see a screen shot of the connection details for the 
connection(s) by that user, so we can see both the data rates on the 
connection and message rates on that connection's channels all on one 
screen.

Also, you said before that "memory usage will grow indefinitely until 
[rabbit] crashes". Please post the output of 'rabbitmqctl status' when 
you see the high memory usage, which should give us some idea where the 
memory is going.

> When the connection if force closed this is returned:
>
> {exit, {channel_termination_timeout, {gen_server,call,
> [<0.27132.1>,{shutdown,"Closed via management plugin"},infinity]}},
> [{gen_server,call,3}, {rabbit_mgmt_wm_connection,delete_resource,2},
> {webmachine_resource,resource_call,3}, {webmachine_resource,do,3},
> {webmachine_decision_core,resource_call,1},
> {webmachine_decision_core,decision,1},
> {webmachine_decision_core,handle_request,2},
> {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}

Is that on a really busy server? There is a grace period of 3 seconds x 
number_of_channels during which rabbit tries to terminate connection 
gracefully. If that time threshold is exceeded then the connection is 
terminated regardless. The above message is a symptom of that. I have 
filed a a bug to clean up the error reporting in the management UI for that.

Regards,

Matthias.

From gmr at meetme.com  Mon Mar 18 03:42:35 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Sun, 17 Mar 2013 20:42:35 -0700
Subject: [rabbitmq-discuss] pika 0.9.11 Released
Message-ID: <CAKwdTWdY_Mbg-iu6Tuh4wJF377fL8xBDFaodgyjkohXR=hZfUA@mail.gmail.com>

Pika 0.9.11 is a bugfix release addressing two issues, one with timeouts in
SelectConnection and AsyncoreConnection, the second is an issue with the on
channel close callback signature in TwistedChannel.

All pika users are urged to upgrade to 0.9.11, but should be cautious as it
does contain the callback signature change for both connections and
channels when closing.

*Bugfixes*

   - Address inconsistent channel close callback documentation and add the
   signature change to the TwistedChannel class (#305)
   - Address a missed timeout related internal data structure name change
   introduced in the SelectConnection 0.9.10 release. Update all connection
   adapters to use same signature and docstring (#306).

If you happen across any bugs, please report them at
https://github.com/pika/pika/issues

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130317/3593d5fc/attachment.htm>

From dev440 at gmail.com  Mon Mar 18 07:51:14 2013
From: dev440 at gmail.com (chetan dev)
Date: Mon, 18 Mar 2013 13:21:14 +0530
Subject: [rabbitmq-discuss] User Not able to login
Message-ID: <CAB0ZxM5i3ZHUpVJ+0q5Zfy7Rpxh3kg1BgQfFhoJOTsfw=uK9SQ@mail.gmail.com>

Hi,

I created a user and granted him all the permissions required .
But i am not able to log in with this newly created user .Default user
guest gets logged in successfully.
am i missing something here or what other permissions do i need to grant ?

Thanks

-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/ebf0f4c5/attachment.htm>

From steve.flitcroft at gmail.com  Mon Mar 18 08:13:55 2013
From: steve.flitcroft at gmail.com (steve flitcroft)
Date: Mon, 18 Mar 2013 08:13:55 +0000
Subject: [rabbitmq-discuss] User Not able to login
In-Reply-To: <CAB0ZxM5i3ZHUpVJ+0q5Zfy7Rpxh3kg1BgQfFhoJOTsfw=uK9SQ@mail.gmail.com>
References: <CAB0ZxM5i3ZHUpVJ+0q5Zfy7Rpxh3kg1BgQfFhoJOTsfw=uK9SQ@mail.gmail.com>
Message-ID: <CADP7R6DRRth4zkFzW9B4iSCYZJFtnTZcBWuUBq4Q8w9H-Y3sfA@mail.gmail.com>

Are you talking about the admin ui or the ability to connect to rmq and
send/receive messages. If the admin ui did you grant the user admin tag, if
the latter has the user been granted any vhost permissions?
On 18 Mar 2013 07:52, "chetan dev" <dev440 at gmail.com> wrote:

> Hi,
>
> I created a user and granted him all the permissions required .
> But i am not able to log in with this newly created user .Default user
> guest gets logged in successfully.
> am i missing something here or what other permissions do i need to grant ?
>
> Thanks
>
> --
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/679fc218/attachment.htm>

From simon at rabbitmq.com  Mon Mar 18 10:20:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 18 Mar 2013 10:20:25 +0000
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <1363393077582-25478.post@n5.nabble.com>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
	<1363293736579-25462.post@n5.nabble.com>
	<51431CD7.2040500@rabbitmq.com>
	<1363362418350-25471.post@n5.nabble.com>
	<CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
	<5143A2BF.6060805@rabbitmq.com>
	<CALPqkip_SPy2VB+-J6FVMGs_8FwAa8LPhosOvKFLwEcWL2wUbA@mail.gmail.com>
	<5143A74F.6080000@rabbitmq.com>
	<1363393077582-25478.post@n5.nabble.com>
Message-ID: <5146EA69.6010904@rabbitmq.com>

Thanks for explaining your use case!

Of course, the whole point of the hashing part of the CHX is to ensure 
that the broker does not need to maintain a routing key -> queue 
mapping. It sounds like your case would require that. Which is not an 
inconceivable thing to do, but it would mean we would need to think 
about how that mapping can be prevented from constituting a memory leak.

I assume that you see new GUIDs quite frequently; is there a point at 
which you know you won't see a certain GUID again? Or can you say 
something like "if I haven't seen a certain GUID for 5 min, we can 
forget about it?"

Cheers, Simon

On 16/03/2013 12:17AM, SteveO wrote:
> Thanks all for the feedback.
>
> I'm not certain how to handle my basic "elastic scale up" scenario. That
> would be where I have 4 queues bound to the CHX, and my consumers aren't
> keeping up. I add a 5th without removing any of the other 4. I think that is
> a condition where I could wind up with messages with the same routing key in
> multiple queues.
>
> Our application will have producers sending messages with new GUIDs in the
> routing key throughout the course of any given day. The frequency of just
> how many new GUIDs over a set duration of time will vary throughout the
> course of the day. Business hours would have more new GUIDs than
> off-business hours, for example. That's why I thought it would be in my best
> interest to have a mechanism for scaling up and down. That just gets really
> tricky when I have that "must process everything in order" requirement.
>
> s
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Confirm-consistent-hash-exchange-behavior-tp25458p25478.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From videlalvaro at gmail.com  Mon Mar 18 10:42:15 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 18 Mar 2013 11:42:15 +0100
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <5146EA69.6010904@rabbitmq.com>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
	<1363293736579-25462.post@n5.nabble.com>
	<51431CD7.2040500@rabbitmq.com>
	<1363362418350-25471.post@n5.nabble.com>
	<CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
	<5143A2BF.6060805@rabbitmq.com>
	<CALPqkip_SPy2VB+-J6FVMGs_8FwAa8LPhosOvKFLwEcWL2wUbA@mail.gmail.com>
	<5143A74F.6080000@rabbitmq.com>
	<1363393077582-25478.post@n5.nabble.com>
	<5146EA69.6010904@rabbitmq.com>
Message-ID: <CAMcAHLVteHePrhWyfC0jDhBr0Mb=EJ=wejp6xX_J_sFPn1D2bA@mail.gmail.com>

Why then not just have one queue per GUID and use the anon exchange to do
the routing? Then remove the queue when the GUID is not needed anymore.

Or here are we talking about of mapping several GUIDs to the same queue?

BTW, for a use case similar to this one is why I proposed the interval
exchange.

Regards,

Alvaro



On Mon, Mar 18, 2013 at 11:20 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> Thanks for explaining your use case!
>
> Of course, the whole point of the hashing part of the CHX is to ensure
> that the broker does not need to maintain a routing key -> queue mapping.
> It sounds like your case would require that. Which is not an inconceivable
> thing to do, but it would mean we would need to think about how that
> mapping can be prevented from constituting a memory leak.
>
> I assume that you see new GUIDs quite frequently; is there a point at
> which you know you won't see a certain GUID again? Or can you say something
> like "if I haven't seen a certain GUID for 5 min, we can forget about it?"
>
> Cheers, Simon
>
>
> On 16/03/2013 12:17AM, SteveO wrote:
>
>> Thanks all for the feedback.
>>
>> I'm not certain how to handle my basic "elastic scale up" scenario. That
>> would be where I have 4 queues bound to the CHX, and my consumers aren't
>> keeping up. I add a 5th without removing any of the other 4. I think that
>> is
>> a condition where I could wind up with messages with the same routing key
>> in
>> multiple queues.
>>
>> Our application will have producers sending messages with new GUIDs in the
>> routing key throughout the course of any given day. The frequency of just
>> how many new GUIDs over a set duration of time will vary throughout the
>> course of the day. Business hours would have more new GUIDs than
>> off-business hours, for example. That's why I thought it would be in my
>> best
>> interest to have a mechanism for scaling up and down. That just gets
>> really
>> tricky when I have that "must process everything in order" requirement.
>>
>> s
>>
>>
>>
>> --
>> View this message in context: http://rabbitmq.1065348.n5.**
>> nabble.com/Confirm-consistent-**hash-exchange-behavior-**
>> tp25458p25478.html<http://rabbitmq.1065348.n5.nabble.com/Confirm-consistent-hash-exchange-behavior-tp25458p25478.html>
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>  ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/eaa27068/attachment.htm>

From simon at rabbitmq.com  Mon Mar 18 10:48:20 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 18 Mar 2013 10:48:20 +0000
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <CAMcAHLVteHePrhWyfC0jDhBr0Mb=EJ=wejp6xX_J_sFPn1D2bA@mail.gmail.com>
References: <1363280876356-25458.post@n5.nabble.com>
	<19D51D6F-FB8F-4FC5-B3CB-BF0FF9CAEDBA@teksol.info>
	<1363293736579-25462.post@n5.nabble.com>
	<51431CD7.2040500@rabbitmq.com>
	<1363362418350-25471.post@n5.nabble.com>
	<CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
	<5143A2BF.6060805@rabbitmq.com>
	<CALPqkip_SPy2VB+-J6FVMGs_8FwAa8LPhosOvKFLwEcWL2wUbA@mail.gmail.com>
	<5143A74F.6080000@rabbitmq.com>
	<1363393077582-25478.post@n5.nabble.com>
	<5146EA69.6010904@rabbitmq.com>
	<CAMcAHLVteHePrhWyfC0jDhBr0Mb=EJ=wejp6xX_J_sFPn1D2bA@mail.gmail.com>
Message-ID: <5146F0F4.8060801@rabbitmq.com>

On 18/03/2013 10:42AM, Alvaro Videla wrote:
> Why then not just have one queue per GUID and use the anon exchange to
> do the routing? Then remove the queue when the GUID is not needed anymore.

I am assuming the use case involves large numbers of GUIDs with a few 
messages each. Keeping track of all those queues and ensuring consumers 
each get their share would not be fun.

> BTW, for a use case similar to this one is why I proposed the interval
> exchange.

But don't you have the same problem as with the CHX? When you want to 
add a new queue, you have to rearrange the intervals somehow in order 
for the new queue to receive any work... at which point you just broke 
per-GUID message ordering.

Cheers, Simon

From desoxyrebonukleinsaure at gmail.com  Mon Mar 18 08:53:49 2013
From: desoxyrebonukleinsaure at gmail.com (Oluf Lorenzen)
Date: Mon, 18 Mar 2013 01:53:49 -0700 (PDT)
Subject: [rabbitmq-discuss] additional architectures on APT repository
Message-ID: <131752b9-8e0f-40fb-95f0-9441d794be45@googlegroups.com>

Hi,

i tried to use rabbitmqs' apt-repository with my armhf-based 
debian-installation, but was informed by apt-get, that 'armhf' was not 
supported. :-/

Could you add all debian ports [1] to your apt-repo, as rabbitmq is a 
arch-independent package?


[1] <http://www.debian.org/ports/>

Best regards,
Oluf Lorenzen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/9bbb62c1/attachment.htm>

From simon at rabbitmq.com  Mon Mar 18 10:56:26 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 18 Mar 2013 10:56:26 +0000
Subject: [rabbitmq-discuss] additional architectures on APT repository
In-Reply-To: <131752b9-8e0f-40fb-95f0-9441d794be45@googlegroups.com>
References: <131752b9-8e0f-40fb-95f0-9441d794be45@googlegroups.com>
Message-ID: <5146F2DA.2070300@rabbitmq.com>

Ah yes, that probably hasn't been looked at since we introduced the apt 
repo in 2008 or so. Will fix.

Cheers, Simon

On 18/03/2013 8:53AM, Oluf Lorenzen wrote:
> Hi,
>
> i tried to use rabbitmqs' apt-repository with my armhf-based
> debian-installation, but was informed by apt-get, that 'armhf' was not
> supported. :-/
>
> Could you add all debian ports [1] to your apt-repo, as rabbitmq is a
> arch-independent package?
>
>
> [1] <http://www.debian.org/ports/>
>
> Best regards,
> Oluf Lorenzen
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From carl.hoerberg at gmail.com  Mon Mar 18 11:29:49 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 18 Mar 2013 04:29:49 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <51458A62.3080802@rabbitmq.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
	<1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
	<55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
	<5144B9F5.9070008@rabbitmq.com>
	<BE879CAB47B74E62A8A201303B4196A6@gmail.com>
	<51458A62.3080802@rabbitmq.com>
Message-ID: <33177CD37CAC4B3DAEA72E2FAF9FB297@gmail.com>

The same thing even without SSL. Screenhosts of both a user connection and the node memory status page:

https://www.dropbox.com/s/4xoye3uilej53z9/Screen%20Shot%202013-03-16%20at%2022.48.50.png
https://www.dropbox.com/s/dbousjdaccvqgj8/Screen%20Shot%202013-03-18%20at%2012.22.32.png


On Sunday 17 March 2013 at 17:19, Matthias Radestock-3 [via RabbitMQ] wrote:

> On 17/03/13 03:05, carlhoerberg wrote: 
> > The users says he's just consuming, but the mgmt interface shows that's 
> > he's both sending and receiving traffic in ~20kb/s, but only receiving 
> > 0.5msg/sec and not delivering any messages. 
> > 
> 
> 
> Are you saying there's 20kb/s traffic each way on the connection, but 
> the publishing rate is 0 msg/s and the consuming rate is 0.5 msg/s? 
> 
> Perhaps there is some weird ssl chatter going on. Could you ask the user 
> to connect without SSL? 
> 
> It would be good to see a screen shot of the connection details for the 
> connection(s) by that user, so we can see both the data rates on the 
> connection and message rates on that connection's channels all on one 
> screen. 
> 
> Also, you said before that "memory usage will grow indefinitely until 
> [rabbit] crashes". Please post the output of 'rabbitmqctl status' when 
> you see the high memory usage, which should give us some idea where the 
> memory is going. 
> 
> > When the connection if force closed this is returned: 
> > 
> > {exit, {channel_termination_timeout, {gen_server,call, 
> > [<0.27132.1>,{shutdown,"Closed via management plugin"},infinity]}}, 
> > [{gen_server,call,3}, {rabbit_mgmt_wm_connection,delete_resource,2}, 
> > {webmachine_resource,resource_call,3}, {webmachine_resource,do,3}, 
> > {webmachine_decision_core,resource_call,1}, 
> > {webmachine_decision_core,decision,1}, 
> > {webmachine_decision_core,handle_request,2}, 
> > {rabbit_webmachine,'-makeloop/1-fun-0-',2}]} 
> > 
> 
> Is that on a really busy server? There is a grace period of 3 seconds x 
> number_of_channels during which rabbit tries to terminate connection 
> gracefully. If that time threshold is exceeded then the connection is 
> terminated regardless. The above message is a symptom of that. I have 
> filed a a bug to clean up the error reporting in the management UI for that. 
> 
> Regards, 
> 
> Matthias. 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=25492&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25492.html 
> To unsubscribe from RabbitMQ 3.0, SSL and rc4, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25483&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU0ODN8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 
> 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25501.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/06bef2cd/attachment.htm>

From matthias at rabbitmq.com  Mon Mar 18 12:02:07 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Mar 2013 12:02:07 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <33177CD37CAC4B3DAEA72E2FAF9FB297@gmail.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
	<1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
	<55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
	<5144B9F5.9070008@rabbitmq.com>
	<BE879CAB47B74E62A8A201303B4196A6@gmail.com>
	<51458A62.3080802@rabbitmq.com>
	<33177CD37CAC4B3DAEA72E2FAF9FB297@gmail.com>
Message-ID: <5147023F.8030508@rabbitmq.com>

On 18/03/13 11:29, carlhoerberg wrote:
> The same thing even without SSL. Screenhosts of both a user
> connection and the node memory status page

Can you get us a full 'rabbitmqctl report' when the above is happening? 
Please send it off-list to info at rabbitmq.com.

Also, it would be very helpful to find out what traffic is passing over 
those connections. Can you insert the tracer 
(http://www.rabbitmq.com/api-guide.html#tracer) in the connection path? 
Or, failing that, get a wireshark capture?

Regards,

Matthias.

From Andrew.Ochsner at csgi.com  Mon Mar 18 14:15:13 2013
From: Andrew.Ochsner at csgi.com (Ochsner, Andrew)
Date: Mon, 18 Mar 2013 09:15:13 -0500
Subject: [rabbitmq-discuss] Windows vs Linux
Message-ID: <771C375058E4E54CADE84C237C1BB3E6108908EAA5@odcexch03.csg.csgsystems.com>

Thanks Tim!  I'll explore this a bit but sounds like either platform is solid and unlikely to cause us much grief.





>Just to follow up, I've been provided with an internal (VMWare) blog post indicating that Rabbit can perform fantastically on Windows, so you can probably ignore my fud below. Take a look for yourself: http://blogs.vmware.com/vfabric/2012/12/net-rabbitmq-scales-to-100s-of-millions-of-passenger-messages-at-15below.html

>

>Cheers,

>Tim

>

>On 13 Mar 2013, at 18:08, Tim Watson wrote:

>

> Hi Andy,

>

> My general exp with erlang is that it's better behaved on Linux, with regards performance (overlapping I/O on Windows wasn't well handled in prior versions, though > R14/R15 may have improved those stories). Also widows imposes limits on the maximum available memory for a process and even on 64bit windows a 32bit emulator is limited to 2Gb - the 64bit emulator does better but is still limited compared to Linux.

>

> Having said that, I understand that we have many happy customers running rabbit on windows! Matthias or Simon will probably be able to say more about those - not sure if there are any case studies available?

>

> Cheers,

> Tim

>

> On 13 Mar 2013, at 17:51, "Ochsner, Andrew" <Andrew.Ochsner at csgi.com<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>> wrote:

>

>> Hello:

>>

>> We are trying to decide on what OS to target our brokers on.   Our consumers (at least initially) will be written in .NET so the initial preference is to have the brokers sit side-by-side with the consumers.  We'll be interested in taking advantage of HA capabilities as well as high throughput.  I know Windows and Linux are both supported, but I'm just curious if there's a general preference one way or the other that might help lead us down a good path.  We're building a centralized logging system so resiliency and throughput are pretty important.  Obviously we'll need to do our own benchmarking down the road and adjust based on those findings, but we need to start somewhere.

>>

>> Thanks

>>

>> Andrew Ochsner  |  Intentional Architecture

>> T +01 402 431 7583

>> A 18020 Burt St, Omaha, NE  68022

>> E andrew.ochsner at csgi.com<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>

>>

>> <image001.gif>

>>

>>

>> All emails in this message string and any attachments are the confidential information of CSG Systems International, Inc. (CSG), or its affiliates and subsidiaries, and may contain privileged and/or confidential material. If you are not an intended recipient, please delete it immediately and notify the sender; unintended recipients are not authorized to read or otherwise use the information contained herein.

>> _______________________________________________

>> rabbitmq-discuss mailing list

>> rabbitmq-discuss at lists.rabbitmq.com<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>

>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/87ef7e57/attachment.htm>

From tim at rabbitmq.com  Mon Mar 18 14:29:34 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 18 Mar 2013 14:29:34 +0000
Subject: [rabbitmq-discuss] Windows vs Linux
In-Reply-To: <771C375058E4E54CADE84C237C1BB3E6108908EAA5@odcexch03.csg.csgsystems.com>
References: <771C375058E4E54CADE84C237C1BB3E6108908EAA5@odcexch03.csg.csgsystems.com>
Message-ID: <E8099544-1322-45E9-A502-760E55FE7B83@rabbitmq.com>

You're welcome - good luck with it and feel free to drop by here or #rabbitmq on freenode if you need to chat about anything.

Cheers,
Tim

On 18 Mar 2013, at 14:15, Ochsner, Andrew wrote:

> Thanks Tim!  I?ll explore this a bit but sounds like either platform is solid and unlikely to cause us much grief.
>  
>  
> >Just to follow up, I've been provided with an internal (VMWare) blog post indicating that Rabbit can perform fantastically on Windows, so you can probably ignore my fud below. Take a look for yourself: http://blogs.vmware.com/vfabric/2012/12/net-rabbitmq-scales-to-100s-of-millions-of-passenger-messages-at-15below.html
> > 
> >Cheers,
> >Tim
> > 
> >On 13 Mar 2013, at 18:08, Tim Watson wrote:
> > 
> > Hi Andy,
> > 
> > My general exp with erlang is that it's better behaved on Linux, with regards performance (overlapping I/O on Windows wasn't well handled in prior versions, though > R14/R15 may have improved those stories). Also widows imposes limits on the maximum available memory for a process and even on 64bit windows a 32bit emulator is limited to 2Gb - the 64bit emulator does better but is still limited compared to Linux.
> > 
> > Having said that, I understand that we have many happy customers running rabbit on windows! Matthias or Simon will probably be able to say more about those - not sure if there are any case studies available?
> > 
> > Cheers,
> > Tim
> > 
> > On 13 Mar 2013, at 17:51, "Ochsner, Andrew" <Andrew.Ochsner at csgi.com> wrote:
> > 
> >> Hello:
> >> 
> >> We are trying to decide on what OS to target our brokers on.   Our consumers (at least initially) will be written in .NET so the initial preference is to have the brokers sit side-by-side with the consumers.  We?ll be interested in taking advantage of HA capabilities as well as high throughput.  I know Windows and Linux are both supported, but I?m just curious if there?s a general preference one way or the other that might help lead us down a good path.  We?re building a centralized logging system so resiliency and throughput are pretty important.  Obviously we?ll need to do our own benchmarking down the road and adjust based on those findings, but we need to start somewhere.
> >>  
> >> Thanks
> >>  
> >> Andrew Ochsner  |  Intentional Architecture
> >> T +01 402 431 7583
> >> A 18020 Burt St, Omaha, NE  68022
> >> E andrew.ochsner at csgi.com
> >>  
> >> <image001.gif>
> >>  
> >> 
> >> All emails in this message string and any attachments are the confidential information of CSG Systems International, Inc. (CSG), or its affiliates and subsidiaries, and may contain privileged and/or confidential material. If you are not an intended recipient, please delete it immediately and notify the sender; unintended recipients are not authorized to read or otherwise use the information contained herein.
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Mon Mar 18 15:02:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 18 Mar 2013 15:02:25 +0000
Subject: [rabbitmq-discuss] additional architectures on APT repository
In-Reply-To: <131752b9-8e0f-40fb-95f0-9441d794be45@googlegroups.com>
References: <131752b9-8e0f-40fb-95f0-9441d794be45@googlegroups.com>
Message-ID: <51472C81.5000506@rabbitmq.com>

On 18/03/13 08:53, Oluf Lorenzen wrote:
> Could you add all debian ports [1] to your apt-repo, as rabbitmq is a
> arch-independent package?

Due to the way our apt repo is managed I don't think we'll be able to 
update this until the next release... But it will get fixed then.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steveolivier22 at gmail.com  Mon Mar 18 15:29:45 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Mon, 18 Mar 2013 08:29:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <5146F0F4.8060801@rabbitmq.com>
References: <51431CD7.2040500@rabbitmq.com>
	<1363362418350-25471.post@n5.nabble.com>
	<CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
	<5143A2BF.6060805@rabbitmq.com>
	<CALPqkip_SPy2VB+-J6FVMGs_8FwAa8LPhosOvKFLwEcWL2wUbA@mail.gmail.com>
	<5143A74F.6080000@rabbitmq.com>
	<1363393077582-25478.post@n5.nabble.com>
	<5146EA69.6010904@rabbitmq.com>
	<CAMcAHLVteHePrhWyfC0jDhBr0Mb=EJ=wejp6xX_J_sFPn1D2bA@mail.gmail.com>
	<5146F0F4.8060801@rabbitmq.com>
Message-ID: <1363620585484-25506.post@n5.nabble.com>

Simon-

Earlier you had asked...

/I assume that you see new GUIDs quite frequently; is there a point at 
which you know you won't see a certain GUID again? Or can you say 
something like "if I haven't seen a certain GUID for 5 min, we can 
forget about it?"/

Yes, that assumption could be made. I'd have to work through some use cases
to see what the timer should be. I suspect if it were configurable, the more
flexible it could be if others find this useful. Thanks.

s



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Confirm-consistent-hash-exchange-behavior-tp25458p25506.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From desoxyrebonukleinsaure at gmail.com  Mon Mar 18 16:05:49 2013
From: desoxyrebonukleinsaure at gmail.com (Finkregh)
Date: Mon, 18 Mar 2013 17:05:49 +0100
Subject: [rabbitmq-discuss] additional architectures on APT repository
In-Reply-To: <51472C81.5000506@rabbitmq.com>
References: <131752b9-8e0f-40fb-95f0-9441d794be45@googlegroups.com>
	<51472C81.5000506@rabbitmq.com>
Message-ID: <CA+_yQybyVUY9UMYc3tOBdwT5MsA1jMdoAxstVTZFpbs-MD0XKg@mail.gmail.com>

Hi Simon,

> Due to the way our apt repo is managed I don't think we'll be able to update
> this until the next release... But it will get fixed then.

When will that be? :-)
What tools do you use to mange the apt-repository?

Regards,
Oluf

From simon at rabbitmq.com  Mon Mar 18 16:13:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 18 Mar 2013 16:13:28 +0000
Subject: [rabbitmq-discuss] additional architectures on APT repository
In-Reply-To: <CA+_yQybyVUY9UMYc3tOBdwT5MsA1jMdoAxstVTZFpbs-MD0XKg@mail.gmail.com>
References: <131752b9-8e0f-40fb-95f0-9441d794be45@googlegroups.com>
	<51472C81.5000506@rabbitmq.com>
	<CA+_yQybyVUY9UMYc3tOBdwT5MsA1jMdoAxstVTZFpbs-MD0XKg@mail.gmail.com>
Message-ID: <51473D28.6080106@rabbitmq.com>

On 18/03/13 16:05, Finkregh wrote:
> Hi Simon,
>
>> Due to the way our apt repo is managed I don't think we'll be able to update
>> this until the next release... But it will get fixed then.
>
> When will that be? :-)

Hopefully April some time.

> What tools do you use to mange the apt-repository?

reprepro. I'm... not an expert.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.gardner at noaa.gov  Mon Mar 18 16:22:23 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Mon, 18 Mar 2013 11:22:23 -0500
Subject: [rabbitmq-discuss] Missing ^ on access control doc page regex
	example?
Message-ID: <51473F3F.70606@noaa.gov>

In the RabbitMQ.com documentation, under Access Control, paragraph six, 
it gives this as an example of a regex:
'^amq\.gen.*|amq\.default$'

to 'give a user access to server-generated names and the default exchange.'
But this would give access to any entity that ended in 'amq.default', 
not just 'amq.default'.

Shouldn't it be
'^amq\.gen.*|^amq\.default$'
or
'^(amq\.gen.*|amq\.default)$'

It's an unlikely name for a user entity, so although it's not a big deal 
in that way, the way it's written is misleading; it might throw someone 
who is not quite as familiar with regex; I am reasonably familiar and I 
started writing some permission expressions the same way without 
thinking about it :)
Am I wrong?
Thanks,
James Gardner

From gmr at meetme.com  Mon Mar 18 16:35:55 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Mon, 18 Mar 2013 09:35:55 -0700
Subject: [rabbitmq-discuss] lager vs sasl error log
Message-ID: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>

Any plans to move rabbitmq.log to lager (and allow for lager-syslog) while
keeping rabbit-sasl.log for crash dumps?

Would be nice to be able to get the plugable loggers and improvements to
logging performance lager purports to provide, as well as a more modern,
*NIXy logging output.

Cheers,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/dc023777/attachment.htm>

From richard at raseley.com  Mon Mar 18 16:55:20 2013
From: richard at raseley.com (Richard Raseley)
Date: Mon, 18 Mar 2013 09:55:20 -0700
Subject: [rabbitmq-discuss] Guidance on Using F5 Load Balancer with
	RabbitMQ
In-Reply-To: <16B51C4C-0EFE-47BE-825B-E84D21DA19BE@rabbitmq.com>
References: <CAO=6ox_prftz1q9pB5U5QKzNNgoKbV=uMJ0eu+G=WqEEinr_ug@mail.gmail.com>
	<5F33CA66-73A7-4F2D-B474-7FD02491ABB5@rabbitmq.com>
	<CAO=6ox-MHwuLj5DPKj=2WOi7N4cYVq5Q5za6MMRQ0AhZvkLxng@mail.gmail.com>
	<16B51C4C-0EFE-47BE-825B-E84D21DA19BE@rabbitmq.com>
Message-ID: <CAO=6ox8kznOpbPVCfJYm42A6ABZE=b5ZU71k-=QF0j1zF890Fw@mail.gmail.com>

Tim,

With regard to your comment:

"Ok, but you do realise that a single queue will reside on only one node,
and therefore messages sent to other nodes in the cluster will still have
to be routed/forwarded to the node on which the queue resides?"

We are using highly available queues, so this wouldn't be the case
(right?). I understand that there is intra-node communication required to
support this.

Regards,

Richard


On Sat, Mar 16, 2013 at 8:27 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Richard,
>
> On 15 Mar 2013, at 20:04, Richard Raseley wrote:
> > The intent is to abstract all production and consumption operations via
> the VIP (which itself is mapped to a pool which contains all of our
> RabbitMQ nodes) so that there is a single configured endpoint. With regard
> to load balancing, it will load balance across the nodes so that if (for
> example) 10 producer instances opened up 10 channels to the VIP, 5 would
> have one node as an endpoint and 5 would have the other (assuming a 2 node
> cluster and round-robin configuration).
> >
>
> Ok, but you do realise that a single queue will reside on only one node,
> and therefore messages sent to other nodes in the cluster will still have
> to be routed/forwarded to the node on which the queue resides?
>
> > I understand that any timeout settings would have to be tuned for the
> application, but I was looking for some high level general guidelines (e.g.
> "in situation x, consider y and z"). We've ensured that our timeout is
> greater than the heartbeat interval.
> >
>
> I think heartbeats are the main (general) thing to be considered. Perhaps
> other users who're more familiar with production configurations such as
> these will have more to add though.
>
> Cheers,
> Tim
>
> > Regards,
> >
> > Richard
> >
> >
> > On Fri, Mar 15, 2013 at 3:46 AM, Tim Watson <tim at rabbitmq.com> wrote:
> > Hi Richard,
> >
> > On 11 Mar 2013, at 20:55, Richard Raseley wrote:
> > > Is anyone able to share some "best practices" as it relates to using a
> F5 load balancer to distribute load between nodes of a RabbitMQ cluster?
> > >
> >
> > Can you explain a bit more clearly what you're trying to achieve please?
> Using a load balancer to maintain connectivity to a cluster is recommended
> and quite common, but that isn't going to 'distribute load between nodes'
> per se. Are you trying to distribute the load of publishing over multiple
> nodes, or consuming, or what? There are various things to consider
> depending on your goals.
> >
> > > I am most interested in the persistence and timeout settings which we
> should be using in conjunction with RabbitMQ.
> > >
> >
> > There cannot be any specific settings that will work for all deployments
> - this will be application specific I would've thought. The only advice
> that springs to mind is if you are setting AMQP heartbeats on your
> connections, then make sure the proxy timeout is aligned with (i.e.,
> greater than) these to avoid disturbing connections unnecessarily - but
> that's pretty obvious.
> >
> > Cheers,
> > Tim
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/35fa26a7/attachment.htm>

From emile at rabbitmq.com  Mon Mar 18 17:04:05 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 18 Mar 2013 17:04:05 +0000
Subject: [rabbitmq-discuss] Missing ^ on access control doc page regex
 example?
In-Reply-To: <51473F3F.70606@noaa.gov>
References: <51473F3F.70606@noaa.gov>
Message-ID: <51474905.7010903@rabbitmq.com>


Hi James,

On 18/03/13 16:22, James Gardner wrote:
> In the RabbitMQ.com documentation, under Access Control, paragraph six, 
> it gives this as an example of a regex:
> '^amq\.gen.*|amq\.default$'

The regular expression syntax and semantics available in RabbitMQ
resemble those of Perl and is based on PCRE. In that flavour of RE the
example is correct - the alternate options are all subject to the
anchors while matching.

> Shouldn't it be
> '^(amq\.gen.*|amq\.default)$'

The expression is already equivalent to this one.



-Emile




From pjasiulewicz at gmail.com  Mon Mar 18 16:18:09 2013
From: pjasiulewicz at gmail.com (pejot)
Date: Mon, 18 Mar 2013 09:18:09 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ not binding on anything
Message-ID: <ac029b36-b63c-465d-ad97-6b9ca5bf767d@googlegroups.com>

Hi,

having a problem with RabbitMQ on amazon. I'm trying to make it listen on 
all external interfaces (which seams not to work by default neither on 
amazon or my local machine, but bound to network interface IP). 
I'm running it on Ubuntu. the problem is, the managemenet console on :55672 
seams to be thinking, that rabbitmq is listening on 

amqp
::5672
but when I do >netstat -a | grep LISTEN

there is nothing listening on 5672.

Tried to set the rabbitmq-env.conf, which has (that's the whole config)
RABBITMQ_NODE_PORT=5672
RABBITMQ_NODE_IP_ADDRESS=[tried: interface IP, private dns, public dns]

nothing seams to work, some advice would be highly appreciated.

best,
pejot

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/e5011a42/attachment.htm>

From emile at rabbitmq.com  Mon Mar 18 17:26:41 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 18 Mar 2013 17:26:41 +0000
Subject: [rabbitmq-discuss] RabbitMQ not binding on anything
In-Reply-To: <ac029b36-b63c-465d-ad97-6b9ca5bf767d@googlegroups.com>
References: <ac029b36-b63c-465d-ad97-6b9ca5bf767d@googlegroups.com>
Message-ID: <51474E51.1010008@rabbitmq.com>



Hi,

On 18/03/13 16:18, pejot wrote:
> managemenet console on :55672 seams to be thinking, that rabbitmq is
> listening on
> 
> amqp ::	5672
> 
> 
> but when I do >netstat -a | grep LISTEN
> 
> there is nothing listening on 5672.


RabbitMQ will listen on all interfaces by default.
Are any processes named "beam" or "beam.smp" running?
Can AMQP clients connect to TCP port 5672?
What does "rabbitmqct status" report?
Do the logfiles report any errors?


-Emile









From watson.timothy at gmail.com  Mon Mar 18 17:47:59 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 18 Mar 2013 17:47:59 +0000
Subject: [rabbitmq-discuss] Guidance on Using F5 Load Balancer with
	RabbitMQ
In-Reply-To: <CAO=6ox8kznOpbPVCfJYm42A6ABZE=b5ZU71k-=QF0j1zF890Fw@mail.gmail.com>
References: <CAO=6ox_prftz1q9pB5U5QKzNNgoKbV=uMJ0eu+G=WqEEinr_ug@mail.gmail.com>
	<5F33CA66-73A7-4F2D-B474-7FD02491ABB5@rabbitmq.com>
	<CAO=6ox-MHwuLj5DPKj=2WOi7N4cYVq5Q5za6MMRQ0AhZvkLxng@mail.gmail.com>
	<16B51C4C-0EFE-47BE-825B-E84D21DA19BE@rabbitmq.com>
	<CAO=6ox8kznOpbPVCfJYm42A6ABZE=b5ZU71k-=QF0j1zF890Fw@mail.gmail.com>
Message-ID: <E11C6E22-FE84-402E-B066-61F4AD6FAEDA@rabbitmq.com>

Richard,

On 18 Mar 2013, at 16:55, Richard Raseley <richard at raseley.com> wrote:

> Tim,
> 
> With regard to your comment:
> 
> "Ok, but you do realise that a single queue will reside on only one node, and therefore messages sent to other nodes in the cluster will still have to be routed/forwarded to the node on which the queue resides?"
> 
> We are using highly available queues, so this wouldn't be the case (right?).

Even with HA the master queue process still resides on just one node an all messages will be sent to it.

Cheers,
Tim

> I understand that there is intra-node communication required to support this.
> 
> Regards,
> 
> Richard
> 
> 
> On Sat, Mar 16, 2013 at 8:27 AM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi Richard,
> 
> On 15 Mar 2013, at 20:04, Richard Raseley wrote:
> > The intent is to abstract all production and consumption operations via the VIP (which itself is mapped to a pool which contains all of our RabbitMQ nodes) so that there is a single configured endpoint. With regard to load balancing, it will load balance across the nodes so that if (for example) 10 producer instances opened up 10 channels to the VIP, 5 would have one node as an endpoint and 5 would have the other (assuming a 2 node cluster and round-robin configuration).
> >
> 
> Ok, but you do realise that a single queue will reside on only one node, and therefore messages sent to other nodes in the cluster will still have to be routed/forwarded to the node on which the queue resides?
> 
> > I understand that any timeout settings would have to be tuned for the application, but I was looking for some high level general guidelines (e.g. "in situation x, consider y and z"). We've ensured that our timeout is greater than the heartbeat interval.
> >
> 
> I think heartbeats are the main (general) thing to be considered. Perhaps other users who're more familiar with production configurations such as these will have more to add though.
> 
> Cheers,
> Tim
> 
> > Regards,
> >
> > Richard
> >
> >
> > On Fri, Mar 15, 2013 at 3:46 AM, Tim Watson <tim at rabbitmq.com> wrote:
> > Hi Richard,
> >
> > On 11 Mar 2013, at 20:55, Richard Raseley wrote:
> > > Is anyone able to share some "best practices" as it relates to using a F5 load balancer to distribute load between nodes of a RabbitMQ cluster?
> > >
> >
> > Can you explain a bit more clearly what you're trying to achieve please? Using a load balancer to maintain connectivity to a cluster is recommended and quite common, but that isn't going to 'distribute load between nodes' per se. Are you trying to distribute the load of publishing over multiple nodes, or consuming, or what? There are various things to consider depending on your goals.
> >
> > > I am most interested in the persistence and timeout settings which we should be using in conjunction with RabbitMQ.
> > >
> >
> > There cannot be any specific settings that will work for all deployments - this will be application specific I would've thought. The only advice that springs to mind is if you are setting AMQP heartbeats on your connections, then make sure the proxy timeout is aligned with (i.e., greater than) these to avoid disturbing connections unnecessarily - but that's pretty obvious.
> >
> > Cheers,
> > Tim
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/4fdabb09/attachment.htm>

From richard at raseley.com  Mon Mar 18 18:06:27 2013
From: richard at raseley.com (Richard Raseley)
Date: Mon, 18 Mar 2013 11:06:27 -0700
Subject: [rabbitmq-discuss] Guidance on Using F5 Load Balancer with
	RabbitMQ
In-Reply-To: <E11C6E22-FE84-402E-B066-61F4AD6FAEDA@rabbitmq.com>
References: <CAO=6ox_prftz1q9pB5U5QKzNNgoKbV=uMJ0eu+G=WqEEinr_ug@mail.gmail.com>
	<5F33CA66-73A7-4F2D-B474-7FD02491ABB5@rabbitmq.com>
	<CAO=6ox-MHwuLj5DPKj=2WOi7N4cYVq5Q5za6MMRQ0AhZvkLxng@mail.gmail.com>
	<16B51C4C-0EFE-47BE-825B-E84D21DA19BE@rabbitmq.com>
	<CAO=6ox8kznOpbPVCfJYm42A6ABZE=b5ZU71k-=QF0j1zF890Fw@mail.gmail.com>
	<E11C6E22-FE84-402E-B066-61F4AD6FAEDA@rabbitmq.com>
Message-ID: <CAO=6ox-F9gjN1z=xC64Weu_RMnG2eNFbW9CJuCMbT=tScrdCzw@mail.gmail.com>

Tim,

Thank you for that information - I hadn't realized that was the case with
HA queues. So, in our situation we may be better off configuring the load
balanced pool to be Active / Passive so that messages will always be
flowing directly to the node that is running the master queue process
(thereby eliminating the intra-node network overhead)?

Regards,

Richard


On Mon, Mar 18, 2013 at 10:47 AM, Tim Watson <watson.timothy at gmail.com>wrote:

> Richard,
>
> On 18 Mar 2013, at 16:55, Richard Raseley <richard at raseley.com> wrote:
>
> Tim,
>
> With regard to your comment:
>
> "Ok, but you do realise that a single queue will reside on only one node,
> and therefore messages sent to other nodes in the cluster will still have
> to be routed/forwarded to the node on which the queue resides?"
>
> We are using highly available queues, so this wouldn't be the case
> (right?).
>
>
> Even with HA the master queue process still resides on just one node an
> all messages will be sent to it.
>
> Cheers,
> Tim
>
> I understand that there is intra-node communication required to support
> this.
>
> Regards,
>
> Richard
>
>
> On Sat, Mar 16, 2013 at 8:27 AM, Tim Watson <tim at rabbitmq.com> wrote:
>
>> Hi Richard,
>>
>> On 15 Mar 2013, at 20:04, Richard Raseley wrote:
>> > The intent is to abstract all production and consumption operations via
>> the VIP (which itself is mapped to a pool which contains all of our
>> RabbitMQ nodes) so that there is a single configured endpoint. With regard
>> to load balancing, it will load balance across the nodes so that if (for
>> example) 10 producer instances opened up 10 channels to the VIP, 5 would
>> have one node as an endpoint and 5 would have the other (assuming a 2 node
>> cluster and round-robin configuration).
>> >
>>
>> Ok, but you do realise that a single queue will reside on only one node,
>> and therefore messages sent to other nodes in the cluster will still have
>> to be routed/forwarded to the node on which the queue resides?
>>
>> > I understand that any timeout settings would have to be tuned for the
>> application, but I was looking for some high level general guidelines (e.g.
>> "in situation x, consider y and z"). We've ensured that our timeout is
>> greater than the heartbeat interval.
>> >
>>
>> I think heartbeats are the main (general) thing to be considered. Perhaps
>> other users who're more familiar with production configurations such as
>> these will have more to add though.
>>
>> Cheers,
>> Tim
>>
>> > Regards,
>> >
>> > Richard
>> >
>> >
>> > On Fri, Mar 15, 2013 at 3:46 AM, Tim Watson <tim at rabbitmq.com> wrote:
>> > Hi Richard,
>> >
>> > On 11 Mar 2013, at 20:55, Richard Raseley wrote:
>> > > Is anyone able to share some "best practices" as it relates to using
>> a F5 load balancer to distribute load between nodes of a RabbitMQ cluster?
>> > >
>> >
>> > Can you explain a bit more clearly what you're trying to achieve
>> please? Using a load balancer to maintain connectivity to a cluster is
>> recommended and quite common, but that isn't going to 'distribute load
>> between nodes' per se. Are you trying to distribute the load of publishing
>> over multiple nodes, or consuming, or what? There are various things to
>> consider depending on your goals.
>> >
>> > > I am most interested in the persistence and timeout settings which we
>> should be using in conjunction with RabbitMQ.
>> > >
>> >
>> > There cannot be any specific settings that will work for all
>> deployments - this will be application specific I would've thought. The
>> only advice that springs to mind is if you are setting AMQP heartbeats on
>> your connections, then make sure the proxy timeout is aligned with (i.e.,
>> greater than) these to avoid disturbing connections unnecessarily - but
>> that's pretty obvious.
>> >
>> > Cheers,
>> > Tim
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/add4026c/attachment.htm>

From matthias at rabbitmq.com  Mon Mar 18 18:30:29 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Mar 2013 18:30:29 +0000
Subject: [rabbitmq-discuss] basic.qos prefetch across multiple queues -
	useful?
Message-ID: <51475D45.2070806@rabbitmq.com>

Is anybody setting a basic.qos prefetch limit on channels with consumers 
on multiple queues?

If so, are you relying on the fact that the prefetch limit applies 
*across* queues rather than *per* queue?

That feature entails considerable implementation complexity and has a 
substantial performance impact on consuming from basic.qos-limited 
channels in general. And I've just found a bug in that area of the code, 
fixing of which will make the implementation even more complex and hurt 
performance even more.

Hence I am trying to gauge people's opinion on whether we could make the 
prefetch limit apply per-queue instead.

Regards,

Matthias.

From videlalvaro at gmail.com  Mon Mar 18 18:36:10 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 18 Mar 2013 19:36:10 +0100
Subject: [rabbitmq-discuss] basic.qos prefetch across multiple queues -
	useful?
In-Reply-To: <51475D45.2070806@rabbitmq.com>
References: <51475D45.2070806@rabbitmq.com>
Message-ID: <CAMcAHLVkA79e4TumKRZv3S7jPhmD67Q5Ri09AQXCbMn_Veej0g@mail.gmail.com>

Hi,

I think per-queue would be better, at least for the PHP people. Since PHP
doesn't support threads is not common to have multiple channels in one
process. So basic.qos as is today limits every queue in the channel for
most PHP scripts.

I guess other languages like Python are in the same area.

Regards,

Alvaro


On Mon, Mar 18, 2013 at 7:30 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Is anybody setting a basic.qos prefetch limit on channels with consumers
> on multiple queues?
>
> If so, are you relying on the fact that the prefetch limit applies
> *across* queues rather than *per* queue?
>
> That feature entails considerable implementation complexity and has a
> substantial performance impact on consuming from basic.qos-limited channels
> in general. And I've just found a bug in that area of the code, fixing of
> which will make the implementation even more complex and hurt performance
> even more.
>
> Hence I am trying to gauge people's opinion on whether we could make the
> prefetch limit apply per-queue instead.
>
> Regards,
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/1a57ba0d/attachment.htm>

From Michael.Laing at nytimes.com  Mon Mar 18 19:00:53 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Mon, 18 Mar 2013 15:00:53 -0400
Subject: [rabbitmq-discuss] basic.qos prefetch across multiple queues -
 useful?
In-Reply-To: <CAMcAHLVkA79e4TumKRZv3S7jPhmD67Q5Ri09AQXCbMn_Veej0g@mail.gmail.com>
Message-ID: <CD6CDAFD.89B8%Michael.Laing@nytimes.com>

We use python - a process normally has several channels open, using pika.SelectConnection and the continuation (event-driven) programming style.

However, we typically use a channel per queue partly so that we can set prefetch on a per queue basis.

So I think it would make more sense for the prefetch limit to be associated directly with the queue.

Michael

From: Alvaro Videla <videlalvaro at gmail.com<mailto:videlalvaro at gmail.com>>
Reply-To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Monday, March 18, 2013 1:36 PM
To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] basic.qos prefetch across multiple queues - useful?

Hi,

I think per-queue would be better, at least for the PHP people. Since PHP doesn't support threads is not common to have multiple channels in one process. So basic.qos as is today limits every queue in the channel for most PHP scripts.

I guess other languages like Python are in the same area.

Regards,

Alvaro


On Mon, Mar 18, 2013 at 7:30 PM, Matthias Radestock <matthias at rabbitmq.com<mailto:matthias at rabbitmq.com>> wrote:
Is anybody setting a basic.qos prefetch limit on channels with consumers on multiple queues?

If so, are you relying on the fact that the prefetch limit applies *across* queues rather than *per* queue?

That feature entails considerable implementation complexity and has a substantial performance impact on consuming from basic.qos-limited channels in general. And I've just found a bug in that area of the code, fixing of which will make the implementation even more complex and hurt performance even more.

Hence I am trying to gauge people's opinion on whether we could make the prefetch limit apply per-queue instead.

Regards,

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/e70e95ff/attachment.htm>

From alan.antonuk at gmail.com  Mon Mar 18 19:23:50 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 18 Mar 2013 12:23:50 -0700
Subject: [rabbitmq-discuss] basic.qos prefetch across multiple queues -
	useful?
In-Reply-To: <51475D45.2070806@rabbitmq.com>
References: <51475D45.2070806@rabbitmq.com>
Message-ID: <CAAt2poLsF0RrVsAVCy=q5-EeZH1VOhdwF22HkoGjTD7orcrd3A@mail.gmail.com>

The SimpleAmqpClient implicitly does basic.qos on a per-queue basis by only
allowing one consumer per channel.  This change would not have an effect on
the usage of this library.

-Alan


On Mon, Mar 18, 2013 at 11:30 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Is anybody setting a basic.qos prefetch limit on channels with consumers
> on multiple queues?
>
> If so, are you relying on the fact that the prefetch limit applies
> *across* queues rather than *per* queue?
>
> That feature entails considerable implementation complexity and has a
> substantial performance impact on consuming from basic.qos-limited channels
> in general. And I've just found a bug in that area of the code, fixing of
> which will make the implementation even more complex and hurt performance
> even more.
>
> Hence I am trying to gauge people's opinion on whether we could make the
> prefetch limit apply per-queue instead.
>
> Regards,
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/ce3c6722/attachment.htm>

From matthias at rabbitmq.com  Mon Mar 18 19:24:27 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Mar 2013 19:24:27 +0000
Subject: [rabbitmq-discuss] basic.qos prefetch across multiple queues -
 useful?
In-Reply-To: <CD6CDAFD.89B8%Michael.Laing@nytimes.com>
References: <CD6CDAFD.89B8%Michael.Laing@nytimes.com>
Message-ID: <514769EB.9020603@rabbitmq.com>

On 18/03/13 19:00, Laing, Michael P. wrote:
> We use python - a process normally has several channels open, using
> pika.SelectConnection and the continuation (event-driven) programming style.
>
> However, we typically use a channel per queue partly so that we can set
> prefetch on a per queue basis.

Interesting. Why is it important to you to set prefetch per queue consumer?

The existing basic.qos prefetch cross-queue limiting behaviour caters 
for scenarios where a client is consuming from multiple queues but can 
only process one message at a time and wants to limit the number of 
messages in-flight so they can processes by other consumers instead.

E.g. if a client is consuming from a hundred queues, and takes one 
minute to process each message, then with the current behaviour they can 
limit the backlog to 1 minute, whereas with per-queue prefetch the 
backlog could only be limited to 100 minutes or more.


Regards,

Matthias.

From sandy33 at gmail.com  Mon Mar 18 17:52:04 2013
From: sandy33 at gmail.com (Sandy Lin)
Date: Mon, 18 Mar 2013 10:52:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Getting error when starting database
In-Reply-To: <20110110155531.GB20637@rabbitmq.com>
References: <379d4f51-7909-4783-969e-87d595153437@n2g2000pre.googlegroups.com>
	<20110110155531.GB20637@rabbitmq.com>
Message-ID: <b2e52de1-993f-4d66-b8a0-71932d02d75a@googlegroups.com>

This solved my problem too. Thanks for posting the answer!

On Monday, January 10, 2011 10:55:31 AM UTC-5, Matthew Sackman wrote:
>
> On Mon, Jan 10, 2011 at 07:48:58AM -0800, Oscar Del Ben wrote:
> > Hello guys,
> > 
> > I'm a bit unexperienced with Erlang and rabbitmq. I was able to
> > install rabbitmq on my local machine and it was running ok since
> > today, when I started to get this error:
>
> My guess is that you clustered it and now it's waiting for the master to
> come up before it can resync.
>
> The simplest thing for you to do is to
> rm -rf '/usr/local/var/lib/rabbitmq/mnesia/rabbit at oscar'
> though you'll lose all messages, queues, exchanges, bindings and users
> you've created so far. If you're just experimenting atm though, that's
> unlikely to be important to you.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/6167bdf5/attachment.htm>

From nslowes at overdrive.com  Mon Mar 18 18:02:43 2013
From: nslowes at overdrive.com (Nick Slowes)
Date: Mon, 18 Mar 2013 14:02:43 -0400
Subject: [rabbitmq-discuss] Diagnosing RabbitMQ Network Partition Problem
Message-ID: <87ECD7D4440F46428FED954BB43A39BF05D58B0C@EXCHANGE.hq.overdrive.com>

Hi,

 

I am running a RabbitMQ cluster with two nodes and they continue to
periodically experience a network partition.  They are physically
located in the same data center and their network should be reliable.
When I check their logs, both servers report the
"running_partitioned_network" error at about the same time and both
nodes continue running, so I don't think it is a hardware failure or one
of the nodes terminating unexpectedly.  I modified the net_ticktime to
120 seconds to try to mitigate the problem, and it stopped occurring for
almost a month, but it recently started occurring again once every few
days.  Now I am not sure if the net_ticktime helped or if it was just
coincidence.

 

In order to troubleshoot further, I started a rolling network trace
using Wireshark and used a scheduled task to halt the trace when the
nodes became partitioned again.  My goal is to determine whether the
partition is caused by unreliable network, or if the application failed
to respond.  Nothing in the packet trace jumps out as showing a network
failure, there are only a handful of TCP retransmissions and plenty of
other packets are sent successfully between them.  

 

At this point I am not sure what else to look at in the packet trace to
either prove or disprove that the network caused the failure.  Wireshark
can identify and decode the Erlang Distribution Protocol, but I don't
know how to interpret the messages to know what would cause nodes to
detect a partition.  Also, the net_ticktime is set to 120 seconds, and I
do not see a 120 second gap in the servers receiving messages from each
other.  The longest gap in which no Erlang messages are received from
the other server is 22 seconds (much less if you count the TCP
acknowledgements).  My only other thought is that if a particular "ping"
type message needs to be sent between the nodes and that particular
messages was interrupted, but I don't know what that would look like in
the trace.

 

Any ideas on how to diagnose the cause of a network partition would be
appreciated.

 

Thanks,

-Nick Slowes

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/d41dddfb/attachment.htm>

From desoxyrebonukleinsaure at gmail.com  Mon Mar 18 20:08:59 2013
From: desoxyrebonukleinsaure at gmail.com (Finkregh)
Date: Mon, 18 Mar 2013 21:08:59 +0100
Subject: [rabbitmq-discuss] additional architectures on APT repository
In-Reply-To: <51473D28.6080106@rabbitmq.com>
References: <131752b9-8e0f-40fb-95f0-9441d794be45@googlegroups.com>
	<51472C81.5000506@rabbitmq.com>
	<CA+_yQybyVUY9UMYc3tOBdwT5MsA1jMdoAxstVTZFpbs-MD0XKg@mail.gmail.com>
	<51473D28.6080106@rabbitmq.com>
Message-ID: <CA+_yQybJDjwmtW=K2pODJpoqp48j6F0tXU3r_OjchMr==5x_Aw@mail.gmail.com>

>> What tools do you use to mange the apt-repository?
>
> reprepro. I'm... not an expert.

 - (make a backup ;-) )
 - add the needed architectures to your 'conf/distributions'
 - run 'reprepro list testing' do get a overview of the current status
 - run 'reprepro --ignore=wrongdistribution. -A all -Vb . include
testing path/to/pkg_ver_arch.changes' to add the package to the new
architectures
 - run 'reprepro list wheezy' again to check the result

Regards,
Oluf

From Michael.Laing at nytimes.com  Mon Mar 18 20:24:09 2013
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Mon, 18 Mar 2013 16:24:09 -0400
Subject: [rabbitmq-discuss] basic.qos prefetch across multiple queues -
 useful?
In-Reply-To: <514769EB.9020603@rabbitmq.com>
Message-ID: <CD6CEE23.89D0%Michael.Laing@nytimes.com>

It's not particularly important, but we have processes that consume from
multiple queues with different characteristics.

For some queues the processing is multi-threaded and we want higher
prefetch. For others, we want prefetch of 1.

We don't have the use case you describe.

ml

On 3/18/13 3:24 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 18/03/13 19:00, Laing, Michael P. wrote:
>> We use python - a process normally has several channels open, using
>> pika.SelectConnection and the continuation (event-driven) programming
>>style.
>>
>> However, we typically use a channel per queue partly so that we can set
>> prefetch on a per queue basis.
>
>Interesting. Why is it important to you to set prefetch per queue
>consumer?
>
>The existing basic.qos prefetch cross-queue limiting behaviour caters
>for scenarios where a client is consuming from multiple queues but can
>only process one message at a time and wants to limit the number of
>messages in-flight so they can processes by other consumers instead.
>
>E.g. if a client is consuming from a hundred queues, and takes one
>minute to process each message, then with the current behaviour they can
>limit the backlog to 1 minute, whereas with per-queue prefetch the
>backlog could only be limited to 100 minutes or more.
>
>
>Regards,
>
>Matthias.


From prabodh.upreti at vce.com  Mon Mar 18 20:25:13 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Mon, 18 Mar 2013 13:25:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory usage and total allowed connections
Message-ID: <1363638313153-25525.post@n5.nabble.com>

Hello

I have a system with 8G RAM.  I have set the vm_memory_high_watermark to .1
hence around 800K mem to play with I believe.

I am getting questioned how many concurrent connections can I support in
this environment.  I am going with the assumption that each connected user
is only going to create a single temporary queue. I believe the overhead for
a temporary queue is 4k.  There is very little events flowing through the
system.  What would be a reasonable number to say for total number of  users
that can be support in this environment?  I know there are various factors
and accurate answer is not possible.  Maybe 100 users?  I would appreciate
your input. Thank you.

Regards




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-usage-and-total-allowed-connections-tp25525.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ask at rabbitmq.com  Mon Mar 18 20:39:29 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 18 Mar 2013 20:39:29 +0000
Subject: [rabbitmq-discuss] basic.qos prefetch across multiple queues -
	useful?
In-Reply-To: <51475D45.2070806@rabbitmq.com>
References: <51475D45.2070806@rabbitmq.com>
Message-ID: <CA84ED3F-5E2F-4A06-ABAD-24A7EA6BC395@rabbitmq.com>


On Mar 18, 2013, at 6:30 PM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Is anybody setting a basic.qos prefetch limit on channels with consumers on multiple queues?
> 
> If so, are you relying on the fact that the prefetch limit applies *across* queues rather than *per* queue?


Celery is relying on it, but only because that's how QoS is defined in the spec.
It does sound like we'd end up with a lot more messages in memory if it was per queue.  Some users like to configure workers so that they will only consume
as many messages as there are available workers in the execution pool, and so I
guess for this to still work we would need another semaphore/barrier if the prefetch count behavior changes.  It can probably be solved either way.


> 
> That feature entails considerable implementation complexity and has a substantial performance impact on consuming from basic.qos-limited channels in general. And I've just found a bug in that area of the code, fixing of which will make the implementation even more complex and hurt performance even more.

Strange, I would've guessed implementing it on a per-queue basis would be more complex



> 
> Hence I am trying to gauge people's opinion on whether we could make the prefetch limit apply per-queue instead.
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From partha-saradhi.govind at hp.com  Mon Mar 18 21:48:55 2013
From: partha-saradhi.govind at hp.com (Govind, Partha)
Date: Mon, 18 Mar 2013 21:48:55 +0000
Subject: [rabbitmq-discuss] Unable to cluster rabbitmq
Message-ID: <5CD6C5926DC7B640853489AAD2571DA4060269CE@G9W0717.americas.hpqcorp.net>

I see below error when I try to cluster rabbitmq.

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.0.3\sbin>rabbitmqctl.bat join_cluster rabbit at WIN-GOVIND1
Clustering node 'rabbit at WIN-GOVIND2' with 'rabbit at WIN-GOVIND1' ...
Error: {cannot_discover_cluster,"The nodes provided are either offline or not running"}

a) Node GOVIND1 is up
b) Can ping each other machine with name
c) Can telnet to 5672 and 4369 (empd) ports from each box prior to running stop_app on GOVIND2.
d) Synced up erlang cookie

What else did I miss for this not to work?

I get GOVIND1 as node down. why?

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.0.3\sbin>rabbitmqctl.bat -n rabbit at WIN-GOVIND1status
Status of node 'rabbit at WIN-GOVIND1' ...
Error: unable to connect to node 'rabbit at WIN-GOVIND1': nodedown

DIAGNOSTICS
===========

nodes in question: ['rabbit at WIN-GOVIND1']

hosts, their running nodes and ports:
- WIN-GOVIND1: [{rabbit,49283}]

current node details:
- node name: 'rabbitmqctl2221614 at WIN-GOVIND1'
- home dir: C:\Users\Administrator
- cookie hash: IgPbUHwN5LE8HjnJYwYTiA==


C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.0.3\sbin>

I didn't change default port (5672) but what is 49283 from above status?

I appreciate any help to cluster rabbit nodes.

Thanks,
Govind

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/aa9ceba3/attachment.htm>

From james.gardner at noaa.gov  Mon Mar 18 22:02:53 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Mon, 18 Mar 2013 17:02:53 -0500
Subject: [rabbitmq-discuss] Missing ^ on access control doc page regex
 example?
In-Reply-To: <51474905.7010903@rabbitmq.com>
References: <51473F3F.70606@noaa.gov> <51474905.7010903@rabbitmq.com>
Message-ID: <51478F0D.9080301@noaa.gov>


Thanks, but...I just tested this and if you set, say, the config 
permission using the regex in the example:

^amq\.gen.*|amq\.default$

it will allow me to create a queue, for example, with the name:

testamq.default

so it is clearly not equivalent to
'^(amq\.gen.*|amq\.default)$'

which does /not/ allow me to create the above queue.

Again, although granting someone permission as in that particular doc 
example is unlikely to accidentally grant permission since the entity 
would have to be named <something>amq.default, it is still a misleading 
example to give to people who might use that pattern to form other more 
dangerously permissive regex's, under the false assumption that later 
alternations are anchored at the beginning.



On 03/18/2013 12:04 PM, Emile Joubert wrote:
> Hi James,
>
> On 18/03/13 16:22, James Gardner wrote:
>> In the RabbitMQ.com documentation, under Access Control, paragraph six,
>> it gives this as an example of a regex:
>> '^amq\.gen.*|amq\.default$'
> The regular expression syntax and semantics available in RabbitMQ
> resemble those of Perl and is based on PCRE. In that flavour of RE the
> example is correct - the alternate options are all subject to the
> anchors while matching.
>
>> Shouldn't it be
>> '^(amq\.gen.*|amq\.default)$'
> The expression is already equivalent to this one.
>
>
>
> -Emile
>
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/341c0a41/attachment.htm>

From carl.hoerberg at gmail.com  Tue Mar 19 03:41:21 2013
From: carl.hoerberg at gmail.com (=?utf-8?Q?Carl_H=C3=B6rberg?=)
Date: Tue, 19 Mar 2013 11:41:21 +0800
Subject: [rabbitmq-discuss] Bring cluster up after node crash
Message-ID: <A674608A754C4DDB8CCD0643F9A192C2@gmail.com>

Have a 3 node cluster, node 2 and 3 went down due to OOM, but node 1 survived, clients could push new messages but non were delivered, node 1 had plenty of memory left so no blocking were (or at least shouldn't have been) in action due to that.  

I then tried to bring node 2 and 3 back online by simply restarting them, this is what happened:  

Node1 floods the logs for a while at a rate of 20-100/sec:
=ERROR REPORT==== 18-Mar-2013::07:10:40 ===
Discarding message {'$gen_call',{<0.17965.1>,#Ref<0.0.1.90282>},stat} from <0.17965.1> to <0.5037.1> in an old incarnation (1) of this node (2)

Start up node 3
Floods
=ERROR REPORT==== 18-Mar-2013::08:23:15 ===
Discarding message {'$gen_call',{<0.7609.0>,#Ref<0.0.1.142489>},stat} from <0.7609.0> to <0.25515.26> in an old incarnation (1) of this node (3)
and is stuck at  
"starting exchange, queue and binding recovery ..."

rabbitmqctl status hangs for ever on node 1

Start up node 2, starts fast, says "Broker started" in startup_log, but doesn't list the plugins, "service rabbitmq-server start" never returns and  rabbitmqctl status and  never returns

node 2 then runs out of memory again, without client connections this time:  
=INFO REPORT==== 18-Mar-2013::09:09:35 ===
vm_memory_high_watermark set. Memory used:7336394640 allowed:7031336140
=WARNING REPORT==== 18-Mar-2013::09:09:35 ===
memory resource limit alarm set on node rabbit at tiger02

Querying /api/overview at node1 gives:
{error,{error,{badmatch,false},
[{rabbit_mgmt_wm_overview,version,1},
{rabbit_mgmt_wm_overview,to_json,2},
{webmachine_resource,resource_call,3},
{webmachine_resource,do,3},
{webmachine_decision_core,resource_call,1},
{webmachine_decision_core,decision,1},
{webmachine_decision_core,handle_request,2},
{rabbit_webmachine,'-makeloop/1-fun-0-',2}]}}

node 3 starts eventually.  
kills node 2, starts again, stops at "starting database ?"
nothing in the log or startup_err, cpu usage 0%
kills after 30min and starts again, same thing.  

node 3 can now output rabbitmqctl status, node 1 still cannot.
node 1 can't be shutdown, force kills
with node1 down, node 2 now comes pass "starting database" and starts
neither node 2 or node 3 responds to rabbitmqctl status
shutting down node 2, but doesn't respond, have to do kill -9
node 3 still doesn't respond to rabbitmqctl status
shutdowns node 3, doesnt respond, killing it instead, now all nodes are down.

note: When rabbitmqctl status doesnt work other stuff like list_users, cluster_status etc. works.  

Starting up node3, log now gets flooded with:
=ERROR REPORT==== 18-Mar-2013::11:09:04 ===
** Generic server <0.629.0> terminating
** Last message in was {init,<0.182.0>}
** When Server state == {q,{amqqueue,
{resource,<<"vhost1">>,queue,
<<"tmp_topic-0.9934227485209703">>},
true,true,<0.21310.24>,[],<0.629.0>,[],[],
[{vhost,<<"vhost1">>},
{name,<<"HA">>},
{pattern,<<".*">>},
{definition,[{<<"ha-mode">>,<<"all">>}]},
{priority,0}],
[{<6868.7071.0>,<6868.7070.0>},
{<6867.19845.80>,<6867.19844.80>},
{<0.21601.24>,<0.21548.24>}]},
none,false,undefined,undefined,
{[],[]},
undefined,undefined,undefined,undefined,
{state,fine,5000,undefined},
{0,nil},
undefined,undefined,undefined,
{dict,0,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]}}},
1,
{{0,nil},{0,nil}},
undefined,
{dict,0,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]}}},
undefined,undefined}
** Reason for termination ==  
** {'module could not be loaded',
[{undefined,init,
[{amqqueue,
{resource,<<"vhost1">>,queue,
<<"tmp_topic-0.9934227485209703">>},
true,true,<0.21310.24>,[],<0.629.0>,[],[],
[{vhost,<<"vhost1">>},
{name,<<"HA">>},
{pattern,<<".*">>},
{definition,[{<<"ha-mode">>,<<"all">>}]},
{priority,0}],
[{<6868.7071.0>,<6868.7070.0>},
{<6867.19845.80>,<6867.19844.80>},
{<0.21601.24>,<0.21548.24>}]},
true,#Fun<rabbit_amqqueue_process.5.64830354>]},
{rabbit_amqqueue_process,handle_call,3},
{gen_server2,handle_msg,2},
{proc_lib,wake_up,3}]}

but comes online eventually and can do "rabbitmqctl status"

starts up node2, also reports a lot of:
=ERROR REPORT==== 18-Mar-2013::11:11:06 ===
** Generic server <0.640.0> terminating
** Last message in was {init,<0.152.0>}
** When Server state == {q,{amqqueue,
{resource,<<"vhost1">>,queue,
<<"tmp_topic-0.1019297200255096">>},
true,true,<0.977.11>,[],<0.640.0>,[],[],
undefined,[]},
none,false,undefined,undefined,
{[],[]},
undefined,undefined,undefined,undefined,
{state,fine,5000,undefined},
{0,nil},
undefined,undefined,undefined,
{dict,0,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]}}},
1,
{{0,nil},{0,nil}},
undefined,
{dict,0,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]}}},
undefined,undefined}
** Reason for termination ==  
** {'module could not be loaded',
[{undefined,init,
[{amqqueue,
{resource,<<"vhost1">>,queue,
<<"tmp_topic-0.1019297200255096">>},
true,true,<0.977.11>,[],<0.640.0>,[],[],undefined,[]},
true,#Fun<rabbit_amqqueue_process.5.64830354>]},
{rabbit_amqqueue_process,handle_call,3},
{gen_server2,handle_msg,2},
{proc_lib,wake_up,3}]}
=ERROR REPORT==== 18-Mar-2013::11:11:06 ===
** Generic server <0.645.0> terminating
** Last message in was {init,<0.152.0>}
** When Server state == {q,{amqqueue,
{resource,<<"vhost1">>,queue,
<<"tmp_topic-0.8794151877518743">>},
true,true,<0.30538.0>,[],<0.645.0>,[],[],
[{vhost,<<"vhost1">>},
{name,<<"HA">>},
{pattern,<<".*">>},
{definition,[{<<"ha-mode">>,<<"all">>}]},
{priority,0}],
[{<6872.28270.5>,<6872.28269.5>},
{<0.32304.1>,<0.30804.0>}]},
none,false,undefined,undefined,
{[],[]},
undefined,undefined,undefined,undefined,
{state,fine,5000,undefined},
{0,nil},
undefined,undefined,undefined,
{dict,0,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]}}},
1,
{{0,nil},{0,nil}},
undefined,
{dict,0,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
[]}}},
undefined,undefined}
** Reason for termination ==  
** {'module could not be loaded',
[{undefined,init,
[{amqqueue,
{resource,<<"vhost1">>,queue,
<<"tmp_topic-0.8794151877518743">>},
true,true,<0.30538.0>,[],<0.645.0>,[],[],
[{vhost,<<"vhost1">>},
{name,<<"HA">>},
{pattern,<<".*">>},
{definition,[{<<"ha-mode">>,<<"all">>}]},
{priority,0}],
[{<6872.28270.5>,<6872.28269.5>},{<0.32304.1>,<0.30804.0>}]},
true,#Fun<rabbit_amqqueue_process.5.64830354>]},
{rabbit_amqqueue_process,handle_call,3},
{gen_server2,handle_msg,2},
{proc_lib,wake_up,3}]}

node 2 comes online i can now query rabbitmqctl status
starting up node 1, comes online
the cluster is now working again but several durables queues are gone(!)





From partha.govind at gmail.com  Mon Mar 18 21:39:13 2013
From: partha.govind at gmail.com (Govind)
Date: Mon, 18 Mar 2013 14:39:13 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to cluster rabbit nodes
Message-ID: <fce8ec32-c4f2-4356-ae37-a2d502bd1d62@googlegroups.com>

I see below error when I try to cluster rabbitmq.

C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-3.0.3\sbin>rabbitmqctl.bat join_cluster 
rabbit at WIN-GOVIND1
Clustering node 'rabbit at WIN-GOVIND2' with 'rabbit at WIN-GOVIND1' ...
Error: {cannot_discover_cluster,"The nodes provided are either offline or 
not running"}

a) Node GOVIND1 is up
b) Can ping each other machine with name
c) Can telnet to 5672 and 4369 (empd) ports from each box prior to running 
stop_app on GOVIND2.
d) Synced up erlang cookie

What else did I miss for this not to work?

I get GOVIND1 as node down. why?

C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-3.0.3\sbin>rabbitmqctl.bat -n 
rabbit at WIN-GOVIND1status
Status of node 'rabbit at WIN-GOVIND1' ...
Error: unable to connect to node 'rabbit at WIN-GOVIND1': nodedown

DIAGNOSTICS
===========

nodes in question: ['rabbit at WIN-GOVIND1']

hosts, their running nodes and ports:
- WIN-GOVIND1: [{rabbit,49283}]

current node details:
- node name: 'rabbitmqctl2221614 at WIN-GOVIND1'
- home dir: C:\Users\Administrator
- cookie hash: IgPbUHwN5LE8HjnJYwYTiA==


C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.0.3\sbin>

I didn't change default port (5672) but what is 49283 from above status?

I appreciate any help to cluster rabbit nodes.

Thanks,
Govind
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/7a8eb2b7/attachment.htm>

From david at bluesunrise.com  Mon Mar 18 22:14:08 2013
From: david at bluesunrise.com (David S Taylor)
Date: Mon, 18 Mar 2013 15:14:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrade Java Driver 2.8.7 to 3.0.4 required?
Message-ID: <f2cf0d98-10a3-42bb-8342-303c222de771@googlegroups.com>

We are in the process of upgrading our server to 3.0.4. We have several 
older Java applications running with the 2.8.7 client. Will we need to 
upgrade the Java driver to talk to 3.0.4, or can we just continue to run 
those apps as is with the 2.8.7 driver talking to a 3.0.4 Rabbit server? 
Sorry to bother, just couldn't find much information on APIs changes or 
requirements for running 2.x Java client against 3.x....
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/92d696ad/attachment.htm>

From carl.hoerberg at gmail.com  Tue Mar 19 07:30:28 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 19 Mar 2013 00:30:28 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <5147023F.8030508@rabbitmq.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
	<1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
	<55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
	<5144B9F5.9070008@rabbitmq.com>
	<BE879CAB47B74E62A8A201303B4196A6@gmail.com>
	<51458A62.3080802@rabbitmq.com>
	<33177CD37CAC4B3DAEA72E2FAF9FB297@gmail.com>
	<5147023F.8030508@rabbitmq.com>
Message-ID: <0BC7697E780244B18C30B4E4CEF02A9E@gmail.com>

The trace log is sent. The weird thing is that the problem with memory explosion didn't occur when connecting through the trace proxy! 



On Monday 18 March 2013 at 20:03, Matthias Radestock-3 [via RabbitMQ] wrote:

> On 18/03/13 11:29, carlhoerberg wrote: 
> > The same thing even without SSL. Screenhosts of both a user 
> > connection and the node memory status page 
> 
> 
> Can you get us a full 'rabbitmqctl report' when the above is happening? 
> Please send it off-list to [hidden email] (/user/SendEmail.jtp?type=node&node=25502&i=0). 
> 
> Also, it would be very helpful to find out what traffic is passing over 
> those connections. Can you insert the tracer 
> (http://www.rabbitmq.com/api-guide.html#tracer) in the connection path? 
> Or, failing that, get a wireshark capture? 
> 
> Regards, 
> 
> Matthias. 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=25502&i=1) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25502.html 
> To unsubscribe from RabbitMQ 3.0, SSL and rc4, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25483&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU0ODN8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25533.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/0b03d2ad/attachment.htm>

From viksvampire19 at gmail.com  Tue Mar 19 08:36:48 2013
From: viksvampire19 at gmail.com (VIKALP HANDA)
Date: Tue, 19 Mar 2013 14:06:48 +0530
Subject: [rabbitmq-discuss] RabbitMQ Consumer stops responding after some
	time
Message-ID: <CAMGaxfihTYsYaiJgWG170y74_7t9gO6moZmkLvwoowULi-8d6w@mail.gmail.com>

Hi all,
Actually I am new to Rabbitmq and am using amqp-c client as a base for my
C++ wrapper.
I have created a consumer which stops responding after some time as well as
after bulk of messages being sent to it.
I have heartbeat count =0 and in the management plugin view its showing
that the connections are still live.
Could you please help me  in rectifying the issue.



Thanks,
Vikalp Handa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/28f709b3/attachment.htm>

From Petr.Gotthard at Honeywell.com  Tue Mar 19 08:48:59 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Tue, 19 Mar 2013 08:48:59 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>

Correct me if I'm wrong, but I don't think that moving to lager requires any changes inside rabbitmq. Since rabbitmq (as far as I know) uses standard Erlang's logging and since standard logs are redirected to lager, all rabbitmq related logs are processed by lager. Wihout many filtering possibilities though.

Petr

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
Sent: 18. b?ezna 2013 17:36
To: Discussions about RabbitMQ
Subject: [rabbitmq-discuss] lager vs sasl error log

Any plans to move rabbitmq.log to lager (and allow for lager-syslog) while keeping rabbit-sasl.log for crash dumps?

Would be nice to be able to get the plugable loggers and improvements to logging performance lager purports to provide, as well as a more modern, *NIXy logging output.

Cheers,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/8030ec20/attachment.htm>

From michael.s.klishin at gmail.com  Tue Mar 19 08:51:03 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 19 Mar 2013 12:51:03 +0400
Subject: [rabbitmq-discuss] Upgrade Java Driver 2.8.7 to 3.0.4 required?
In-Reply-To: <f2cf0d98-10a3-42bb-8342-303c222de771@googlegroups.com>
References: <f2cf0d98-10a3-42bb-8342-303c222de771@googlegroups.com>
Message-ID: <CAE3HoVRsbtOGDfanQz-Z95Ns4LZA=zv-GvU7MXfRX_ESe-reJA@mail.gmail.com>

2013/3/19 David S Taylor <david at bluesunrise.com>

> Will we need to upgrade the Java driver to talk to 3.0.4, or can we just
> continue to run those apps as is with the 2.8.7 driver talking to a 3.0.4
> Rabbit server?


RabbitMQ Java client 2.8.x will work with RabbitMQ 3.x just fine but I also
don't think there were any breaking API changes so upgrading to 3.x may be
as straightforward as bumping the version.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/43ea9d03/attachment.htm>

From simon at rabbitmq.com  Tue Mar 19 09:09:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Mar 2013 09:09:01 +0000
Subject: [rabbitmq-discuss] Unable to cluster rabbitmq
In-Reply-To: <5CD6C5926DC7B640853489AAD2571DA4060269CE@G9W0717.americas.hpqcorp.net>
References: <5CD6C5926DC7B640853489AAD2571DA4060269CE@G9W0717.americas.hpqcorp.net>
Message-ID: <51482B2D.8010406@rabbitmq.com>

On 18/03/2013 9:48PM, Govind, Partha wrote:
> I didn't change default port (5672) but what is 49283 from above status?

This is the port that is being used for intra-cluster communication. The 
epmd port 4369 is just used to locate nodes; this is the port used to 
communicate between them.

See http://www.rabbitmq.com/clustering.html#firewall

Cheers, Simon

From tim at rabbitmq.com  Tue Mar 19 09:27:51 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 19 Mar 2013 09:27:51 +0000
Subject: [rabbitmq-discuss] RabbitMQ Consumer stops responding after
	some time
In-Reply-To: <CAMGaxfihTYsYaiJgWG170y74_7t9gO6moZmkLvwoowULi-8d6w@mail.gmail.com>
References: <CAMGaxfihTYsYaiJgWG170y74_7t9gO6moZmkLvwoowULi-8d6w@mail.gmail.com>
Message-ID: <130E5FD7-BEBD-4659-BE55-A230C217FD66@rabbitmq.com>

Hi,

On 19 Mar 2013, at 08:36, VIKALP HANDA wrote:
> Actually I am new to Rabbitmq and am using amqp-c client as a base for my C++ wrapper.
> I have created a consumer which stops responding after some time as well as after bulk of messages being sent to it.

What does 'stops responding' actually mean? Does the consumer cease processing messages (when there are still un-acked messages in the queue(s) it is consuming from) or is the problem something else. 

> I have heartbeat count =0 and in the management plugin view its showing that the connections are still live.

Just because the server still sees a connection, doesn't mean that the physical network link remains - operating systems can take 'quite some time' to notice unresponsive peers. Also, I didn't realise that the amqp-c client had support for heartbeats? Perhaps the maintainer can clear that up though, as it's quite possible it does but I've simply forgotten.

> Could you please help me  in rectifying the issue.
> 

We'll do our best to help. If you could clarify what specific (and unexpected) behaviour your seeing in the consumer, then we'll take it from there.

Cheers!
Tim

From tim at rabbitmq.com  Tue Mar 19 09:50:06 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 19 Mar 2013 09:50:06 +0000
Subject: [rabbitmq-discuss] Memory usage and total allowed connections
In-Reply-To: <1363638313153-25525.post@n5.nabble.com>
References: <1363638313153-25525.post@n5.nabble.com>
Message-ID: <6E83C4C8-D98C-4F59-BE36-D0CAC66E6215@rabbitmq.com>

Hi,

On 18 Mar 2013, at 20:25, Prabodh Upreti wrote:
> I have a system with 8G RAM.  I have set the vm_memory_high_watermark to .1
> hence around 800K mem to play with I believe.
> 
[snip]
> I am getting questioned how many concurrent connections can I support in
> this environment.  I am going with the assumption that each connected user
> is only going to create a single temporary queue. I believe the overhead for
> a temporary queue is 4k.  There is very little events flowing through the
> system.  What would be a reasonable number to say for total number of  users
> that can be support in this environment?  I know there are various factors
> and accurate answer is not possible.  
> 

I think the best thing for you to do here is to use the MulticastMain class that ships with the java client to run some tests and investigate yourself, based on the kind of usage you're expecting to see in production. There are memory overheads for queues/exchanges/etc, and also for messages flowing through the system (though messages larger than 64bytes will be shared across all parts of the system due to Erlang's use of a shared heap for 'large' binaries), and even when messages hit the disk, there is some overhead for in-memory indexes etc. Also each TCP connection will cost something too, and the space usage will vary depending on how busy various Erlang processes are and whether or not they're able to go into hibernation and so on.

> Maybe 100 users?  I would appreciate your input. Thank you.

Personally I would expect a bit more than that if system isn't busy - you said "There is very little events flowing through the system" after all - but you should experiment and see. Matthias and/or Simon may have better (or more specific) figures to share based on their experience over the years, but in any case measuring system performance with realistic samples before going in to production is a *very good* habit for you to get into! :)

Cheers,
Tim  


From viksvampire19 at gmail.com  Tue Mar 19 09:54:16 2013
From: viksvampire19 at gmail.com (VIKALP HANDA)
Date: Tue, 19 Mar 2013 15:24:16 +0530
Subject: [rabbitmq-discuss] RabbitMQ Consumer stops responding after
	some time
In-Reply-To: <130E5FD7-BEBD-4659-BE55-A230C217FD66@rabbitmq.com>
References: <CAMGaxfihTYsYaiJgWG170y74_7t9gO6moZmkLvwoowULi-8d6w@mail.gmail.com>
	<130E5FD7-BEBD-4659-BE55-A230C217FD66@rabbitmq.com>
Message-ID: <CAMGaxfgpqBKEB_ongySP4Te3d4HUUsR_aQpHJ_g8iJkPDTREbw@mail.gmail.com>

The messages are not arriving at the queue though being sent by the
producer. That means, no messages no processing. I think it might be the
case of peer connection being closed. Is there any parameter or something
that sets the connection timeout? I am using rabbitmq version 3.0.3.

You can think of it as the producer consumer problem with each module
behaving both consumer as well as producer but queue for writing as well as
reading are different.

With respect to attached image, numbers are showing the message progress
flow and arrows are showing the queues with arrow pointed end showing the
consumer.

PFA the implementation image.


On Tue, Mar 19, 2013 at 2:57 PM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi,
>
> On 19 Mar 2013, at 08:36, VIKALP HANDA wrote:
> > Actually I am new to Rabbitmq and am using amqp-c client as a base for
> my C++ wrapper.
> > I have created a consumer which stops responding after some time as well
> as after bulk of messages being sent to it.
>
> What does 'stops responding' actually mean? Does the consumer cease
> processing messages (when there are still un-acked messages in the queue(s)
> it is consuming from) or is the problem something else.
>
> > I have heartbeat count =0 and in the management plugin view its showing
> that the connections are still live.
>
> Just because the server still sees a connection, doesn't mean that the
> physical network link remains - operating systems can take 'quite some
> time' to notice unresponsive peers. Also, I didn't realise that the amqp-c
> client had support for heartbeats? Perhaps the maintainer can clear that up
> though, as it's quite possible it does but I've simply forgotten.
>
> > Could you please help me  in rectifying the issue.
> >
>
> We'll do our best to help. If you could clarify what specific (and
> unexpected) behaviour your seeing in the consumer, then we'll take it from
> there.
>
> Cheers!
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/7512242f/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rabbitmq.png
Type: image/png
Size: 7836 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/7512242f/attachment.png>

From tim at rabbitmq.com  Tue Mar 19 09:58:16 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 19 Mar 2013 09:58:16 +0000
Subject: [rabbitmq-discuss] Diagnosing RabbitMQ Network Partition Problem
In-Reply-To: <87ECD7D4440F46428FED954BB43A39BF05D58B0C@EXCHANGE.hq.overdrive.com>
References: <87ECD7D4440F46428FED954BB43A39BF05D58B0C@EXCHANGE.hq.overdrive.com>
Message-ID: <472B84F0-426E-4D2A-BF05-37A58FABCB68@rabbitmq.com>

Hi Nick,

On 18 Mar 2013, at 18:02, Nick Slowes wrote:
> I am running a RabbitMQ cluster with two nodes and they continue to periodically experience a network partition.  They are physically located in the same data center and their network should be reliable.  When I check their logs, both servers report the ?running_partitioned_network? error at about the same time and both nodes continue running, so I don?t think it is a hardware failure or one of the nodes terminating unexpectedly.

That is almost certainly due to a 'perceived' loss of connectivity - that is to say the Erlang VM thinks there was a partition.

>  I modified the net_ticktime to 120 seconds to try to mitigate the problem, and it stopped occurring for almost a month, but it recently started occurring again once every few days.  Now I am not sure if the net_ticktime helped or if it was just coincidence.
>  
> In order to troubleshoot further, I started a rolling network trace using Wireshark and used a scheduled task to halt the trace when the nodes became partitioned again.  My goal is to determine whether the partition is caused by unreliable network, or if the application failed to respond.  Nothing in the packet trace jumps out as showing a network failure, there are only a handful of TCP retransmissions and plenty of other packets are sent successfully between them. 

Whether or not other packets are sent successfully doesn't determine the outcome of a retry though does it. And the operating system configuration will determine the point at which retransmission failure (as the OS deems it) should result in ETIMEDOUT being returned from socket operations.

>  
> At this point I am not sure what else to look at in the packet trace to either prove or disprove that the network caused the failure.  Wireshark can identify and decode the Erlang Distribution Protocol, but I don?t know how to interpret the messages to know what would cause nodes to detect a partition.  Also, the net_ticktime is set to 120 seconds, and I do not see a 120 second gap in the servers receiving messages from each other.

It's tricky to assist with this diagnosis without seeing the trace output. Are you able to post it, or does it contain private data? If the latter, we (RabbitMQ/VMWare) might be able to sign a confidentiality agreement if that helps. 

>  The longest gap in which no Erlang messages are received from the other server is 22 seconds (much less if you count the TCP acknowledgements).  My only other thought is that if a particular ?ping? type message needs to be sent between the nodes and that particular messages was interrupted, but I don?t know what that would look like in the trace.
>  

Also bare in mind that in a RabbitMQ cluster, Erlang nodes may communicate with one another using AMQP and the Erlang distribution protocol and will likely communicate with epmd as well.

> Any ideas on how to diagnose the cause of a network partition would be appreciated.
>  

Without looking at the packet trace, it's hard to suggest anything specific. If you'd like to continue diagnosing this yourself, it might be a good idea to head over to the erlang-questions mailing list and ask about sniffing the distribution protocol using wireshark. If you decide to go down that route, I'll follow you over there and try to assist as best I can.

Cheers,
Tim


> Thanks,
> -Nick Slowes
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Tue Mar 19 10:02:48 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Mar 2013 10:02:48 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <0BC7697E780244B18C30B4E4CEF02A9E@gmail.com>
References: <1363451870687-25483.post@n5.nabble.com>
	<5144AAF5.4030500@rabbitmq.com>
	<1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
	<55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
	<5144B9F5.9070008@rabbitmq.com>
	<BE879CAB47B74E62A8A201303B4196A6@gmail.com>
	<51458A62.3080802@rabbitmq.com>
	<33177CD37CAC4B3DAEA72E2FAF9FB297@gmail.com>
	<5147023F.8030508@rabbitmq.com>
	<0BC7697E780244B18C30B4E4CEF02A9E@gmail.com>
Message-ID: <514837C8.9080401@rabbitmq.com>

On 19/03/13 07:30, carlhoerberg wrote:
> The trace log is sent. The weird thing is that the problem with memory
> explosion didn't occur when connecting through the trace proxy!

Cheers.

Looking at the trace, we can see that there are two connections with one 
channel each that create *lots* of consumers, all on the same two 
queues. More than 20,000 consumers in ~15 minutes.

These consumers are never cancelled; the client just keeps creating more 
and more of them.

You should be able to confirm this by looking at the consumer count in 
the management UI overview.

This looks like a bug in the application or client library, and explains 
why rabbit is consuming increasing amounts of memory, since each of 
these consumers requires some bookkeeping.

Regards,

Matthias.

From tim at rabbitmq.com  Tue Mar 19 10:05:54 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 19 Mar 2013 10:05:54 +0000
Subject: [rabbitmq-discuss] RabbitMQ Consumer stops responding after
	some time
In-Reply-To: <CAMGaxfgpqBKEB_ongySP4Te3d4HUUsR_aQpHJ_g8iJkPDTREbw@mail.gmail.com>
References: <CAMGaxfihTYsYaiJgWG170y74_7t9gO6moZmkLvwoowULi-8d6w@mail.gmail.com>
	<130E5FD7-BEBD-4659-BE55-A230C217FD66@rabbitmq.com>
	<CAMGaxfgpqBKEB_ongySP4Te3d4HUUsR_aQpHJ_g8iJkPDTREbw@mail.gmail.com>
Message-ID: <4F674C32-853E-4024-9937-B3273777E83F@rabbitmq.com>

Hi,

On 19 Mar 2013, at 09:54, VIKALP HANDA wrote:
> The messages are not arriving at the queue though being sent by the producer. That means, no messages no processing. I think it might be the case of peer connection being closed. Is there any parameter or something that sets the connection timeout? I am using rabbitmq version 3.0.3. 
> 

Connection timeouts are mostly determined by the underlying TCP stack and operating system configuration. If you have sent a message and it is not arriving at the queue, can you see it arriving at the exchange it is being sent to? If it *does* arrive at the exchange, this is probably indicative of an error in your bindings (between the published-to exchange and the queue from which you wish to receive messages sent to that exchange). If it does *not* arrive at the exchange, then you should check that the network link is established and working at the time of sending. There are various ways to do this, but a simple mechanism to ensure messages arrive is to enable publisher confirms (see http://rabbitmq.com/confirms.html for details) which will ensure that the brokers sends an ACK for each message it has taken responsibility for - the reliability guide (http://www.rabbitmq.com/reliability.html) has some more information about this too.

I have no idea if the amqp-c client has any support for publisher confirms. If it does not, then you can verify the state of the connection(s) using the management plugin and/or a tool such as wireshark. You can also use the firehose tracer (http://www.rabbitmq.com/firehose.html) to trace message routing through your topology. 

Cheers,
Tim

> 
> On Tue, Mar 19, 2013 at 2:57 PM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi,
> 
> On 19 Mar 2013, at 08:36, VIKALP HANDA wrote:
> > Actually I am new to Rabbitmq and am using amqp-c client as a base for my C++ wrapper.
> > I have created a consumer which stops responding after some time as well as after bulk of messages being sent to it.
> 
> What does 'stops responding' actually mean? Does the consumer cease processing messages (when there are still un-acked messages in the queue(s) it is consuming from) or is the problem something else.
> 
> > I have heartbeat count =0 and in the management plugin view its showing that the connections are still live.
> 
> Just because the server still sees a connection, doesn't mean that the physical network link remains - operating systems can take 'quite some time' to notice unresponsive peers. Also, I didn't realise that the amqp-c client had support for heartbeats? Perhaps the maintainer can clear that up though, as it's quite possible it does but I've simply forgotten.
> 
> > Could you please help me  in rectifying the issue.
> >
> 
> We'll do our best to help. If you could clarify what specific (and unexpected) behaviour your seeing in the consumer, then we'll take it from there.
> 
> Cheers!
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> <Rabbitmq.png>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Tue Mar 19 10:28:06 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 19 Mar 2013 10:28:06 +0000
Subject: [rabbitmq-discuss] Missing ^ on access control doc page regex
 example?
In-Reply-To: <51478F0D.9080301@noaa.gov>
References: <51473F3F.70606@noaa.gov> <51474905.7010903@rabbitmq.com>
	<51478F0D.9080301@noaa.gov>
Message-ID: <51483DB6.1080308@rabbitmq.com>


James,

On 18/03/13 22:02, James Gardner wrote:
> ^amq\.gen.*|amq\.default$
> 
> it will allow me to create a queue, for example, with the name:
> 
> testamq.default
> 
> so it is clearly not equivalent to
> '^(amq\.gen.*|amq\.default)$'

Thanks for pointing out the error - the test that I performed to check
this was incorrect. You are quite right that the parentheses are needed.
I'd update the documentation.


-Emile





From carl.hoerberg at gmail.com  Tue Mar 19 11:28:23 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 19 Mar 2013 04:28:23 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <514837C8.9080401@rabbitmq.com>
References: <1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
	<55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
	<5144B9F5.9070008@rabbitmq.com>
	<BE879CAB47B74E62A8A201303B4196A6@gmail.com>
	<51458A62.3080802@rabbitmq.com>
	<33177CD37CAC4B3DAEA72E2FAF9FB297@gmail.com>
	<5147023F.8030508@rabbitmq.com>
	<0BC7697E780244B18C30B4E4CEF02A9E@gmail.com>
	<514837C8.9080401@rabbitmq.com>
Message-ID: <0433B403D8FD4352BE752571FBD7FD0A@gmail.com>

Thanks a lot Matthias! Yes, I can see it now. Weird though that it don't happens when connected through the tracer proxy or with rabbitmq 2.8.7. Continuing the discussion with the user and the langohr ppl.



On Tuesday 19 March 2013 at 18:04, Matthias Radestock-3 [via RabbitMQ] wrote:

> On 19/03/13 07:30, carlhoerberg wrote: 
> > The trace log is sent. The weird thing is that the problem with memory 
> > explosion didn't occur when connecting through the trace proxy! 
> 
> 
> Cheers. 
> 
> Looking at the trace, we can see that there are two connections with one 
> channel each that create *lots* of consumers, all on the same two 
> queues. More than 20,000 consumers in ~15 minutes. 
> 
> These consumers are never cancelled; the client just keeps creating more 
> and more of them. 
> 
> You should be able to confirm this by looking at the consumer count in 
> the management UI overview. 
> 
> This looks like a bug in the application or client library, and explains 
> why rabbit is consuming increasing amounts of memory, since each of 
> these consumers requires some bookkeeping. 
> 
> Regards, 
> 
> Matthias. 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=25542&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25542.html 
> To unsubscribe from RabbitMQ 3.0, SSL and rc4, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25483&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU0ODN8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-3-0-SSL-and-rc4-tp25483p25545.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/3d6b991e/attachment.htm>

From matthias at rabbitmq.com  Tue Mar 19 11:38:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Mar 2013 11:38:12 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0, SSL and rc4
In-Reply-To: <0433B403D8FD4352BE752571FBD7FD0A@gmail.com>
References: <1363455290957-25485.post@n5.nabble.com>
	<5144AE33.1070502@rabbitmq.com>
	<55AF4BC282964DD994BECB5FE3E4BAA1@gmail.com>
	<5144B9F5.9070008@rabbitmq.com>
	<BE879CAB47B74E62A8A201303B4196A6@gmail.com>
	<51458A62.3080802@rabbitmq.com>
	<33177CD37CAC4B3DAEA72E2FAF9FB297@gmail.com>
	<5147023F.8030508@rabbitmq.com>
	<0BC7697E780244B18C30B4E4CEF02A9E@gmail.com>
	<514837C8.9080401@rabbitmq.com>
	<0433B403D8FD4352BE752571FBD7FD0A@gmail.com>
Message-ID: <51484E24.6010605@rabbitmq.com>

On 19/03/13 11:28, carlhoerberg wrote:
> Thanks a lot Matthias! Yes, I can see it now. Weird though that it don't
> happens when connected through the tracer proxy or with rabbitmq 2.8.7.
> Continuing the discussion with the user and the langohr ppl.

Could just differences in performance. Certainly if the management UI / 
'rabbitmqctl list_consumers' show a growing number of consumers then 
memory usage will grow correspondingly. Running through the tracer 
introduces some latency, so will slow things down a bit and hence reduce 
the growth rate. And 2.8.7 is generally slower than 3.0, so will exhibit 
a slower growth rate.

Matthias.

From prabodh.upreti at vce.com  Tue Mar 19 12:16:44 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Tue, 19 Mar 2013 05:16:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory usage and total allowed connections
In-Reply-To: <6E83C4C8-D98C-4F59-BE36-D0CAC66E6215@rabbitmq.com>
References: <1363638313153-25525.post@n5.nabble.com>
	<6E83C4C8-D98C-4F59-BE36-D0CAC66E6215@rabbitmq.com>
Message-ID: <1363695404031-25547.post@n5.nabble.com>

Thanks for the info Tim. 

I will look into MulticastMain and build some test cases. I am just doing
some preliminary investigation.

regards



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Memory-usage-and-total-allowed-connections-tp25525p25547.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Tue Mar 19 12:29:09 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 19 Mar 2013 05:29:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Give explanation when killing connection from
	the mgmt API
Message-ID: <1363696149533-25548.post@n5.nabble.com>

With the mgmt http api, is it possible to give a custom disconnection message
when you force close a connection (DELETE /api/connections/<name>)? like
with "rabbitmqctl close_connection <pid> <explanation>"



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Give-explanation-when-killing-connection-from-the-mgmt-API-tp25548.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Tue Mar 19 12:35:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Mar 2013 12:35:41 +0000
Subject: [rabbitmq-discuss] Give explanation when killing connection
 from the mgmt API
In-Reply-To: <1363696149533-25548.post@n5.nabble.com>
References: <1363696149533-25548.post@n5.nabble.com>
Message-ID: <51485B9D.6080506@rabbitmq.com>

On 19/03/13 12:29, carlhoerberg wrote:
> With the mgmt http api, is it possible to give a custom disconnection message
> when you force close a connection (DELETE /api/connections/<name>)? like
> with "rabbitmqctl close_connection <pid> <explanation>"

It's not in 3.0. It will be in 3.1.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From desoxyrebonukleinsaure at gmail.com  Tue Mar 19 12:42:39 2013
From: desoxyrebonukleinsaure at gmail.com (Finkregh)
Date: Tue, 19 Mar 2013 13:42:39 +0100
Subject: [rabbitmq-discuss] additional architectures on APT repository
In-Reply-To: <CA+_yQybJDjwmtW=K2pODJpoqp48j6F0tXU3r_OjchMr==5x_Aw@mail.gmail.com>
References: <131752b9-8e0f-40fb-95f0-9441d794be45@googlegroups.com>
	<51472C81.5000506@rabbitmq.com>
	<CA+_yQybyVUY9UMYc3tOBdwT5MsA1jMdoAxstVTZFpbs-MD0XKg@mail.gmail.com>
	<51473D28.6080106@rabbitmq.com>
	<CA+_yQybJDjwmtW=K2pODJpoqp48j6F0tXU3r_OjchMr==5x_Aw@mail.gmail.com>
Message-ID: <CA+_yQyZge8WOTGssg1vcpKeEAkgK3RQZJkqabOO+2nMe9Aw8hQ@mail.gmail.com>

>  - run 'reprepro list wheezy' again to check the result
my fault, run 'reprepro list testing'...

From carl.hoerberg at gmail.com  Tue Mar 19 12:57:28 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 19 Mar 2013 05:57:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Give explanation when killing connection
	from the mgmt API
In-Reply-To: <51485B9D.6080506@rabbitmq.com>
References: <1363696149533-25548.post@n5.nabble.com>
	<51485B9D.6080506@rabbitmq.com>
Message-ID: <CC4CD25DDD72423BA35F1BA2ED11251A@gmail.com>

Cool, thanks! :)



On Tuesday 19 March 2013 at 20:37, Simon MacMullen-2 [via RabbitMQ] wrote:

> On 19/03/13 12:29, carlhoerberg wrote: 
> > With the mgmt http api, is it possible to give a custom disconnection message 
> > when you force close a connection (DELETE /api/connections/<name>)? like 
> > with "rabbitmqctl close_connection <pid> <explanation>" 
> 
> 
> It's not in 3.0. It will be in 3.1. 
> 
> Cheers, Simon 
> 
> -- 
> Simon MacMullen 
> RabbitMQ, VMware 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=25549&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/Give-explanation-when-killing-connection-from-the-mgmt-API-tp25548p25549.html 
> To unsubscribe from Give explanation when killing connection from the mgmt API, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25548&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU1NDh8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Give-explanation-when-killing-connection-from-the-mgmt-API-tp25548p25551.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/b0c256c8/attachment.htm>

From james.gardner at noaa.gov  Tue Mar 19 14:52:08 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Tue, 19 Mar 2013 09:52:08 -0500
Subject: [rabbitmq-discuss] Missing ^ on access control doc page regex
 example?
In-Reply-To: <51483DB6.1080308@rabbitmq.com>
References: <51473F3F.70606@noaa.gov> <51474905.7010903@rabbitmq.com>
	<51478F0D.9080301@noaa.gov> <51483DB6.1080308@rabbitmq.com>
Message-ID: <51487B98.2010102@noaa.gov>


Glad to help.
Thanks!
James

On 03/19/2013 05:28 AM, Emile Joubert wrote:
> James,
>
> On 18/03/13 22:02, James Gardner wrote:
>> ^amq\.gen.*|amq\.default$
>>
>> it will allow me to create a queue, for example, with the name:
>>
>> testamq.default
>>
>> so it is clearly not equivalent to
>> '^(amq\.gen.*|amq\.default)$'
> Thanks for pointing out the error - the test that I performed to check
> this was incorrect. You are quite right that the parentheses are needed.
> I'd update the documentation.
>
>
> -Emile
>
>
>
>


From james.gardner at noaa.gov  Tue Mar 19 14:59:59 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Tue, 19 Mar 2013 09:59:59 -0500
Subject: [rabbitmq-discuss] Strange reaction to publishing message with
 invalid expiration.
In-Reply-To: <513F53EB.7070400@rabbitmq.com>
References: <513F407B.2040403@noaa.gov> <513F53EB.7070400@rabbitmq.com>
Message-ID: <51487D6F.8090703@noaa.gov>

Didn't get a response to email below, sending again in hopes someone can 
answer...

==============

Ok thanks, good to know. If that's how AMQP handles errors, that part's 
fine, and I'm used to PHP extensions not dealing with things correctly 
:), but I don't appear to be getting an exception when my Java code reaches:
channel.basicPublish("e.test", "", props, "Hi!!!".getBytes());
That statement, along with everything else (including the call to 
consume, which *does* throw an exception just fine) is inside a try 
{...} catch (Exception e) {...} .
If you say I should be getting an exception, then I cannot explain why I 
am not.
Here, I'll just include the code. All of this is just inside a main 
function in a Test class (I took out the consume part):

try {
             ConnectionFactory factory = new ConnectionFactory();
factory.setUri("amqp://user:pwd at amqp1.ourserver.gov/ourvhost");
             Connection conn = factory.newConnection();

             Channel channel = conn.createChannel();

             BasicProperties props = new BasicProperties
                                     .Builder()
                                     .expiration("trete")
                                     .build();

             channel.basicPublish("e.test", "", props, "Hi!!!".getBytes());


         }
         catch (Exception e) {
             System.out.println("Threw exception: ");
             e.printStackTrace(System.out);
         }

My Java is a little rusty so forgive me if I am missing something.
Am I supposed to get an IOException if the publish fails due to the bad 
header, or only if the channel had been closed before I do the publish 
or if I tried to use the channel again after the bad publish? The 
Javadocs seem vague on this.

- James


On 03/12/2013 11:12 AM, Simon MacMullen wrote:
> Well, the channel is getting closed with an error message (same as it
> would be for an illegal user_id in fact). That's AMQP's approach to
> error handling.
>
> You should be able to see an IOException getting thrown in the Java
> client, with a more descriptive cause property, or you can register a
> ShutdownListener. I have no idea how the PHP client signals errors I'm
> afraid.
>
> Cheers, Simon
>
> On 12/03/13 14:49, James Gardner wrote:
>>
>> Hi,
>> I found a behavior which, to me at least, acts more like a bug than a
>> feature...
>> It seems that when you publish a message with an invalid expiration
>> string (eg. "blah"), it renders that channel inoperable for consume
>> operations afterwards. I would think it should just discard the message.
>> In the official Java client, something closes the channel, although I
>> don't get any exception until I try to use it for the ensuing consume
>> operation.
>> In the PHP AMQP client (this one:
>> http://www.php.net/manual/en/book.amqp.php), the channel stays open but
>> when you execute $queue->consume(...) and look in the management
>> interface you can see it has not registered as a consumer on the queue
>> of interest.
>> Given the commonalities, I assume these are different client
>> interpretations of the same broker behavior. I am not using transactions
>> or publisher confirms or anything fancy. I am less familiar with the
>> Java client so perhaps I am missing some sort of error handling?
>>
>> RabbitMQ version: RabbitMQ 3.0.3, Erlang R14B04 on RHEL 6.4
>> PHP AMQP version is 1.0.1 (admittedly a little outdated)
>> Java client is version: 3.0.3
>>
>> I can provide code for either client if you would like but I imagine you
>> can replicate it easily just by establishing a connection, then a single
>> channel, then publishing the 'bad' msg to a topic exchange, then trying
>> to consume off a queue bound to that exchange with '#'.
>> When you change expiration to a valid string integer, everything works
>> as you would wish.
>>
>> Of course one answer, as the doctor joke goes, is to not 'move your arm
>> like that'. Which is fine so long as there's a choice, but if I were
>> creating messages and taking the expiration from a source outside my
>> program (eg. database), this error might occur at some point if the data
>> were bad. I could/should(?) sanitize/verify first of course, the point
>> is more that I thought the typical broker reaction to illegal data was
>> to deal with it 'silently' (as it does with an illegal user_id, for
>> example) rather than effectively make the channel unusable.
>> Is there a different way I (or the client code) should be handling this
>> or is this an unexpected broker behavior?
>> Thanks,
>>
>> James Gardner
>> NWS - Internet Dissemination System
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


From simon at rabbitmq.com  Tue Mar 19 15:13:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Mar 2013 15:13:34 +0000
Subject: [rabbitmq-discuss] Strange reaction to publishing message with
 invalid expiration.
In-Reply-To: <51487D6F.8090703@noaa.gov>
References: <513F407B.2040403@noaa.gov> <513F53EB.7070400@rabbitmq.com>
	<51487D6F.8090703@noaa.gov>
Message-ID: <5148809E.5040904@rabbitmq.com>

Hi James. Yes, the basicPublish() invocation is not guaranteed to throw 
an exception, since it's not synchronous - the message may not have 
reached the server (or even left the client) by the time the method 
returns. An exception will get thrown at some point later. If you need 
to ensure that you find out about errors immediately you can close the 
channel (and create a new one), invoke any synchronous AMQP method 
(almost anything apart from basic.publish), or wait for confirms.

Cheers, Simon

On 19/03/13 14:59, James Gardner wrote:
> Didn't get a response to email below, sending again in hopes someone can
> answer...
>
> ==============
>
> Ok thanks, good to know. If that's how AMQP handles errors, that part's
> fine, and I'm used to PHP extensions not dealing with things correctly
> :), but I don't appear to be getting an exception when my Java code
> reaches:
> channel.basicPublish("e.test", "", props, "Hi!!!".getBytes());
> That statement, along with everything else (including the call to
> consume, which *does* throw an exception just fine) is inside a try
> {...} catch (Exception e) {...} .
> If you say I should be getting an exception, then I cannot explain why I
> am not.
> Here, I'll just include the code. All of this is just inside a main
> function in a Test class (I took out the consume part):
>
> try {
>              ConnectionFactory factory = new ConnectionFactory();
> factory.setUri("amqp://user:pwd at amqp1.ourserver.gov/ourvhost");
>              Connection conn = factory.newConnection();
>
>              Channel channel = conn.createChannel();
>
>              BasicProperties props = new BasicProperties
>                                      .Builder()
>                                      .expiration("trete")
>                                      .build();
>
>              channel.basicPublish("e.test", "", props, "Hi!!!".getBytes());
>
>
>          }
>          catch (Exception e) {
>              System.out.println("Threw exception: ");
>              e.printStackTrace(System.out);
>          }
>
> My Java is a little rusty so forgive me if I am missing something.
> Am I supposed to get an IOException if the publish fails due to the bad
> header, or only if the channel had been closed before I do the publish
> or if I tried to use the channel again after the bad publish? The
> Javadocs seem vague on this.
>
> - James
>
>
> On 03/12/2013 11:12 AM, Simon MacMullen wrote:
>> Well, the channel is getting closed with an error message (same as it
>> would be for an illegal user_id in fact). That's AMQP's approach to
>> error handling.
>>
>> You should be able to see an IOException getting thrown in the Java
>> client, with a more descriptive cause property, or you can register a
>> ShutdownListener. I have no idea how the PHP client signals errors I'm
>> afraid.
>>
>> Cheers, Simon
>>
>> On 12/03/13 14:49, James Gardner wrote:
>>>
>>> Hi,
>>> I found a behavior which, to me at least, acts more like a bug than a
>>> feature...
>>> It seems that when you publish a message with an invalid expiration
>>> string (eg. "blah"), it renders that channel inoperable for consume
>>> operations afterwards. I would think it should just discard the message.
>>> In the official Java client, something closes the channel, although I
>>> don't get any exception until I try to use it for the ensuing consume
>>> operation.
>>> In the PHP AMQP client (this one:
>>> http://www.php.net/manual/en/book.amqp.php), the channel stays open but
>>> when you execute $queue->consume(...) and look in the management
>>> interface you can see it has not registered as a consumer on the queue
>>> of interest.
>>> Given the commonalities, I assume these are different client
>>> interpretations of the same broker behavior. I am not using transactions
>>> or publisher confirms or anything fancy. I am less familiar with the
>>> Java client so perhaps I am missing some sort of error handling?
>>>
>>> RabbitMQ version: RabbitMQ 3.0.3, Erlang R14B04 on RHEL 6.4
>>> PHP AMQP version is 1.0.1 (admittedly a little outdated)
>>> Java client is version: 3.0.3
>>>
>>> I can provide code for either client if you would like but I imagine you
>>> can replicate it easily just by establishing a connection, then a single
>>> channel, then publishing the 'bad' msg to a topic exchange, then trying
>>> to consume off a queue bound to that exchange with '#'.
>>> When you change expiration to a valid string integer, everything works
>>> as you would wish.
>>>
>>> Of course one answer, as the doctor joke goes, is to not 'move your arm
>>> like that'. Which is fine so long as there's a choice, but if I were
>>> creating messages and taking the expiration from a source outside my
>>> program (eg. database), this error might occur at some point if the data
>>> were bad. I could/should(?) sanitize/verify first of course, the point
>>> is more that I thought the typical broker reaction to illegal data was
>>> to deal with it 'silently' (as it does with an illegal user_id, for
>>> example) rather than effectively make the channel unusable.
>>> Is there a different way I (or the client code) should be handling this
>>> or is this an unexpected broker behavior?
>>> Thanks,
>>>
>>> James Gardner
>>> NWS - Internet Dissemination System
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From David.Buckingham at cbeyond.net  Tue Mar 19 15:25:42 2013
From: David.Buckingham at cbeyond.net (David Buckingham)
Date: Tue, 19 Mar 2013 11:25:42 -0400
Subject: [rabbitmq-discuss] RabbitMQ crashes just after start...
Message-ID: <E07AC664B6693B4BA9410CE04AAFF673063FF2DD04@CRPMBX01.corp.cbeyond.net>

I am trying to install RabbitMQ on a new server in our lab environment.  Here are the specs:

Microsoft Windows Server 2008 R2 Standard Edition, SP1
Erlang R15B01
RabbitMQ v2.8.4

I have installed both Erlang and RabbitMQ to a non-system drive (i.e., not C:\).  I have the identical versions and configurations running on other machines in our lab, and in production.

Whenever I try to start the RabbitMQ service, it crashes immediately.  The contents of the RabbitMQ.debug file are below:

{"Kernel pid terminated",application_controller,"{application_start_failure,os_mon,{shutdown,{os_mon,start,[normal,[]]}}}"}

Crash dump was written to: M:/Program Files (x86)/RabbitMQ Server/RabbitMQ/erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,os_mon,{shutdown,{os_mon,start,[normal,[]]}}})

(I have set the RABBITMQ_BASE environment variable to M:\Program Files (x86)\RabbitMQ Server\RabbitMQ.)

I have also attached the erl_crash.dump file.  I am not familiar with Erlang, so I'm not sure what it tells me.  The RabbitMQ log files appear to duplicate the info in the debug file, but I can forward those along as well, if they can offer any more help.

When I try to run the broker separately (rabbitmq-server.bat), it too crashes with the same information as the debug file.

I am trying to install 3 servers total.  On 1 server, the installation/configuration works perfectly.  On the other 2 servers, however, RabbitMQ crashes.

Any ideas?

Thank you so much!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/c402a0fc/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 399485 bytes
Desc: erl_crash.dump
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/c402a0fc/attachment.obj>

From james.gardner at noaa.gov  Tue Mar 19 15:27:09 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Tue, 19 Mar 2013 10:27:09 -0500
Subject: [rabbitmq-discuss] Strange reaction to publishing message with
 invalid expiration.
In-Reply-To: <5148809E.5040904@rabbitmq.com>
References: <513F407B.2040403@noaa.gov> <513F53EB.7070400@rabbitmq.com>
	<51487D6F.8090703@noaa.gov> <5148809E.5040904@rabbitmq.com>
Message-ID: <514883CD.4000802@noaa.gov>


Simon,
That helps me understand - thank you!
Cheers, James


On 03/19/2013 10:13 AM, Simon MacMullen wrote:
> Hi James. Yes, the basicPublish() invocation is not guaranteed to 
> throw an exception, since it's not synchronous - the message may not 
> have reached the server (or even left the client) by the time the 
> method returns. An exception will get thrown at some point later. If 
> you need to ensure that you find out about errors immediately you can 
> close the channel (and create a new one), invoke any synchronous AMQP 
> method (almost anything apart from basic.publish), or wait for confirms.
>
> Cheers, Simon
>
> On 19/03/13 14:59, James Gardner wrote:
>> Didn't get a response to email below, sending again in hopes someone can
>> answer...
>>
>> ==============
>>
>> Ok thanks, good to know. If that's how AMQP handles errors, that part's
>> fine, and I'm used to PHP extensions not dealing with things correctly
>> :), but I don't appear to be getting an exception when my Java code
>> reaches:
>> channel.basicPublish("e.test", "", props, "Hi!!!".getBytes());
>> That statement, along with everything else (including the call to
>> consume, which *does* throw an exception just fine) is inside a try
>> {...} catch (Exception e) {...} .
>> If you say I should be getting an exception, then I cannot explain why I
>> am not.
>> Here, I'll just include the code. All of this is just inside a main
>> function in a Test class (I took out the consume part):
>>
>> try {
>>              ConnectionFactory factory = new ConnectionFactory();
>> factory.setUri("amqp://user:pwd at amqp1.ourserver.gov/ourvhost");
>>              Connection conn = factory.newConnection();
>>
>>              Channel channel = conn.createChannel();
>>
>>              BasicProperties props = new BasicProperties
>>                                      .Builder()
>>                                      .expiration("trete")
>>                                      .build();
>>
>>              channel.basicPublish("e.test", "", props, 
>> "Hi!!!".getBytes());
>>
>>
>>          }
>>          catch (Exception e) {
>>              System.out.println("Threw exception: ");
>>              e.printStackTrace(System.out);
>>          }
>>
>> My Java is a little rusty so forgive me if I am missing something.
>> Am I supposed to get an IOException if the publish fails due to the bad
>> header, or only if the channel had been closed before I do the publish
>> or if I tried to use the channel again after the bad publish? The
>> Javadocs seem vague on this.
>>
>> - James
>>
>>
>> On 03/12/2013 11:12 AM, Simon MacMullen wrote:
>>> Well, the channel is getting closed with an error message (same as it
>>> would be for an illegal user_id in fact). That's AMQP's approach to
>>> error handling.
>>>
>>> You should be able to see an IOException getting thrown in the Java
>>> client, with a more descriptive cause property, or you can register a
>>> ShutdownListener. I have no idea how the PHP client signals errors I'm
>>> afraid.
>>>
>>> Cheers, Simon
>>>
>>> On 12/03/13 14:49, James Gardner wrote:
>>>>
>>>> Hi,
>>>> I found a behavior which, to me at least, acts more like a bug than a
>>>> feature...
>>>> It seems that when you publish a message with an invalid expiration
>>>> string (eg. "blah"), it renders that channel inoperable for consume
>>>> operations afterwards. I would think it should just discard the 
>>>> message.
>>>> In the official Java client, something closes the channel, although I
>>>> don't get any exception until I try to use it for the ensuing consume
>>>> operation.
>>>> In the PHP AMQP client (this one:
>>>> http://www.php.net/manual/en/book.amqp.php), the channel stays open 
>>>> but
>>>> when you execute $queue->consume(...) and look in the management
>>>> interface you can see it has not registered as a consumer on the queue
>>>> of interest.
>>>> Given the commonalities, I assume these are different client
>>>> interpretations of the same broker behavior. I am not using 
>>>> transactions
>>>> or publisher confirms or anything fancy. I am less familiar with the
>>>> Java client so perhaps I am missing some sort of error handling?
>>>>
>>>> RabbitMQ version: RabbitMQ 3.0.3, Erlang R14B04 on RHEL 6.4
>>>> PHP AMQP version is 1.0.1 (admittedly a little outdated)
>>>> Java client is version: 3.0.3
>>>>
>>>> I can provide code for either client if you would like but I 
>>>> imagine you
>>>> can replicate it easily just by establishing a connection, then a 
>>>> single
>>>> channel, then publishing the 'bad' msg to a topic exchange, then 
>>>> trying
>>>> to consume off a queue bound to that exchange with '#'.
>>>> When you change expiration to a valid string integer, everything works
>>>> as you would wish.
>>>>
>>>> Of course one answer, as the doctor joke goes, is to not 'move your 
>>>> arm
>>>> like that'. Which is fine so long as there's a choice, but if I were
>>>> creating messages and taking the expiration from a source outside my
>>>> program (eg. database), this error might occur at some point if the 
>>>> data
>>>> were bad. I could/should(?) sanitize/verify first of course, the point
>>>> is more that I thought the typical broker reaction to illegal data was
>>>> to deal with it 'silently' (as it does with an illegal user_id, for
>>>> example) rather than effectively make the channel unusable.
>>>> Is there a different way I (or the client code) should be handling 
>>>> this
>>>> or is this an unexpected broker behavior?
>>>> Thanks,
>>>>
>>>> James Gardner
>>>> NWS - Internet Dissemination System
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
>


From emile at rabbitmq.com  Tue Mar 19 16:03:50 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 19 Mar 2013 16:03:50 +0000
Subject: [rabbitmq-discuss] RabbitMQ crashes just after start...
In-Reply-To: <E07AC664B6693B4BA9410CE04AAFF673063FF2DD04@CRPMBX01.corp.cbeyond.net>
References: <E07AC664B6693B4BA9410CE04AAFF673063FF2DD04@CRPMBX01.corp.cbeyond.net>
Message-ID: <51488C66.2040102@rabbitmq.com>


Hi David,

On 19/03/13 15:25, David Buckingham wrote:

> RabbitMQ v2.8.4

We recommend using the latest version, though that probably won't solve
the problem you describe.

> I have installed both Erlang and RabbitMQ to a non-system drive (i.e.,
> not C:\).

It is not immediately clear what the cause of the problem is, but if you
can answer some questions then we can narrow it down:

Does it work if you perform a default installation using the installer?
If you are installing manually make sure you follow the instructions
meticulously: http://www.rabbitmq.com/install-windows-manual.html

Do you get the same error if you install on C: (i.e. don't set
RABBITMQ_BASE)?

Do you have permissions on the installation directory?

Which plugins do you have installed?

Does the "WorkDir" row in the output of "rabbitmq-service.bat list"
contain the expected value?

Does Erlang start normally without RabbitMQ? (erl -sname foo)

Does the hostname route properly?

> I have also attached the erl_crash.dump file.  I am not familiar with
> Erlang, so I?m not sure what it tells me.

I'm afraid it doesn't tell me much either. It is rarely useful.





-Emile








From David.Buckingham at cbeyond.net  Tue Mar 19 16:32:47 2013
From: David.Buckingham at cbeyond.net (David Buckingham)
Date: Tue, 19 Mar 2013 12:32:47 -0400
Subject: [rabbitmq-discuss] RabbitMQ crashes just after start...
In-Reply-To: <51488C66.2040102@rabbitmq.com>
References: <E07AC664B6693B4BA9410CE04AAFF673063FF2DD04@CRPMBX01.corp.cbeyond.net>
	<51488C66.2040102@rabbitmq.com>
Message-ID: <E07AC664B6693B4BA9410CE04AAFF673063FF2DEEA@CRPMBX01.corp.cbeyond.net>

Emile,

> Does it work if you perform a default installation using the installer?
>
> If you are installing manually make sure you follow the instructions
> meticulously: http://www.rabbitmq.com/install-windows-manual.html
> 
> Do you get the same error if you install on C: (i.e. don't set
> RABBITMQ_BASE)?

I am installing using the installer, not installing manually.  If I install both Erlang and RabbitMQ to C:\, and do not set RABBITMQ_BASE, then yes it appears to install and operate properly.

> Do you have permissions on the installation directory?

Yes. 

> Which plugins do you have installed?

None, yet.  The service never starts after the default installation completes, so I do not proceed to configure any plugins.

> Does the "WorkDir" row in the output of "rabbitmq-service.bat list"
> contain the expected value?

Yes.  (M:\Program Files (x86)\RabbitMQ Server\RabbitMQ)

> Does Erlang start normally without RabbitMQ? (erl -sname foo)

Yes, I believe so:

M:\Program Files\erl5.9.1\bin>erl -sname foo
Eshell V5.9.1  (abort with ^G)
(foo at SCCS004LAB)1>

> Does the hostname route properly?

Yes.

> I'm afraid it doesn't tell me much either. It is rarely useful.

Good to know ;-)

From eliao at seegrid.com  Tue Mar 19 19:49:25 2013
From: eliao at seegrid.com (Elizabeth Liao)
Date: Tue, 19 Mar 2013 19:49:25 +0000
Subject: [rabbitmq-discuss] socket_error
Message-ID: <E94F626F5C43D14F8B8479C5EBD79038FEB810C3@vmexchange02.seegrid.local>

Hi,

We're seeing the following errors in the sasl logs on some of our systems. Any idea on what's going on?  We've seen this on both 2.8.6 and 2.8.7 and running with and without a shovel configuration.  Also our machines are not clustered.

Thanks!

Liz

=ERROR REPORT==== 18-Mar-2013::03:40:20 ===
** Generic server <0.7769.12> terminating
** Last message in was {inet_async,#Port<0.141701>,9384,
                                   {ok,<<65,77,81,80,1,1,8>>}}
** When Server state == {state,#Port<0.141701>,<0.7764.12>,<0.7766.12>,
                               {method,rabbit_framing_amqp_0_9_1},
                               {65,19793,1342243080}}
** Reason for termination ==
** {socket_error,enomem}

=ERROR REPORT==== 18-Mar-2013::03:40:20 ===
** Generic server <0.7750.12> terminating
** Last message in was {'$gen_cast',init}
** When Server state == {state,undefined,undefined,undefined,undefined,
                         robot_to_server,
                         {shovel,
                          {endpoint,
                           [{amqp_params_direct,<<"guest">>,<<"/">>,
                             'host2 at host2',none,[]}],
                           [{'exchange.declare',0,
                             <<"broadcastExchange">>,<<"topic">>,
                             false,true,false,false,false,[]},
                            {'queue.declare',0,<<"ClientToServer">>,false,
                             true,false,false,false,[]},
                            {'queue.bind',0,<<"ClientToServer">>,
                             <<"broadcastExchange">>,
                             <<"server.#">>,false,[]}]},
                          {endpoint,
                           [{amqp_params_network,<<"user2">>,
                             <<"pass2">>,<<"/">>,"server.local",
                             undefined,0,0,5,infinity,none,
                             [#Fun<amqp_auth_mechanisms.plain.3>,
                              #Fun<amqp_auth_mechanisms.amqplain.3>],
                             [],[]}],
                           []},
                          1000,on_confirm,#Fun<rabbit_shovel_sup.16.91344538>,
                          #Fun<rabbit_shovel_sup.16.91344538>,
                          <<"clientToServer">>,1},
                         undefined,undefined,undefined,undefined,undefined}
** Reason for termination ==
** {{badmatch,{error,{{socket_error,enomem},{expecting,'connection.start'}}}},
    [{rabbit_shovel_worker,make_conn_and_chan,1,[]},
     {rabbit_shovel_worker,handle_cast,2,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From richard at raseley.com  Tue Mar 19 20:40:40 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 19 Mar 2013 13:40:40 -0700
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available Queues
Message-ID: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>

I am hoping that someone can confirm my understanding on the proper
methodology for scaling throughput when using highly available queues.

Is it correct to say that adding nodes to a cluster in which you are
exclusively using highly available queues will not increase performance
(and in fact me degrade it) but will instead simply increase resiliency? My
thought is that the overhead for each message publish would increase
linearly as you added nodes for a cluster, as each of those messages have
to be replicated to each node (e.g. there is going to be more latency in
acknowledging the publishing of a 1KB message to a 2 node cluster vs. a 10
node cluster.

Furthermore, if there is a desire to add throughput capacity while still
utilizing highly available queues, would it be best to add additional
clusters with mirrored configurations (e.g. 2x 2-node clusters) and put
them behind the same load balancer?

Any affirmation of, or correction to, this understanding would be greatly
appreciated.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/c91ed0d5/attachment.htm>

From matthias at rabbitmq.com  Tue Mar 19 20:49:03 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Mar 2013 20:49:03 +0000
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
Message-ID: <5148CF3F.1070903@rabbitmq.com>

Richard,

On 19/03/13 20:40, Richard Raseley wrote:
> Is it correct to say that adding nodes to a cluster in which you are
> exclusively using highly available queues will not increase performance
> (and in fact me degrade it) but will instead simply increase resiliency?
> My thought is that the overhead for each message publish would increase
> linearly as you added nodes for a cluster, as each of those messages
> have to be replicated to each node (e.g. there is going to be more
> latency in acknowledging the publishing of a 1KB message to a 2 node
> cluster vs. a 10 node cluster.

That's about right. For the 'all' ha-mode. However, ...

> Furthermore, if there is a desire to add throughput capacity while still
> utilizing highly available queues, would it be best to add additional
> clusters with mirrored configurations (e.g. 2x 2-node clusters) and put
> them behind the same load balancer?

You could switch to the 'exactly' ha-mode - see 
http://www.rabbitmq.com/ha.html#genesis - where queues are mirrored on a 
given number of nodes, regardless of how many nodes there are in the 
cluster in total.

Regards,

Matthias.

From richard at raseley.com  Tue Mar 19 20:56:43 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 19 Mar 2013 13:56:43 -0700
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <5148CF3F.1070903@rabbitmq.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
Message-ID: <CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>

Matthias,

Thank you for your quick response. With regard to your suggestion on using
a specific replica count via the "exactly" ha-mode - wouldn't there still
be a bottleneck in the master node of the cluster? My understanding is that
it has a hand in all operations (obviously true in a cluster with ha
queues), but that it is in-line with all non-publishing operation. Is this
a correct understanding?

Regards,

Richard


On Tue, Mar 19, 2013 at 1:49 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Richard,
>
>
> On 19/03/13 20:40, Richard Raseley wrote:
>
>> Is it correct to say that adding nodes to a cluster in which you are
>> exclusively using highly available queues will not increase performance
>> (and in fact me degrade it) but will instead simply increase resiliency?
>> My thought is that the overhead for each message publish would increase
>> linearly as you added nodes for a cluster, as each of those messages
>> have to be replicated to each node (e.g. there is going to be more
>> latency in acknowledging the publishing of a 1KB message to a 2 node
>> cluster vs. a 10 node cluster.
>>
>
> That's about right. For the 'all' ha-mode. However, ...
>
>
>  Furthermore, if there is a desire to add throughput capacity while still
>> utilizing highly available queues, would it be best to add additional
>> clusters with mirrored configurations (e.g. 2x 2-node clusters) and put
>> them behind the same load balancer?
>>
>
> You could switch to the 'exactly' ha-mode - see
> http://www.rabbitmq.com/ha.**html#genesis<http://www.rabbitmq.com/ha.html#genesis>- where queues are mirrored on a given number of nodes, regardless of how
> many nodes there are in the cluster in total.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/500717d2/attachment.htm>

From matthias at rabbitmq.com  Tue Mar 19 20:59:19 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Mar 2013 20:59:19 +0000
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
Message-ID: <5148D1A7.90106@rabbitmq.com>

On 19/03/13 20:56, Richard Raseley wrote:
> Thank you for your quick response. With regard to your suggestion on
> using a specific replica count via the "exactly" ha-mode - wouldn't
> there still be a bottleneck in the master node of the cluster? My
> understanding is that it has a hand in all operations (obviously true in
> a cluster with ha queues), but that it is in-line with all
> non-publishing operation. Is this a correct understanding?

There's no such thing as a master node for a *cluster*. There is for 
individual queues. Different queues can have their masters on different 
nodes.

Matthias.

From richard at raseley.com  Tue Mar 19 21:16:53 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 19 Mar 2013 14:16:53 -0700
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <5148D1A7.90106@rabbitmq.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
Message-ID: <CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>

Matthias,

Sorry, I meant to say the master queue process. Can you comment on my
previous question assuming that correction?

Regards,

Richard


On Tue, Mar 19, 2013 at 1:59 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 19/03/13 20:56, Richard Raseley wrote:
>
>> Thank you for your quick response. With regard to your suggestion on
>> using a specific replica count via the "exactly" ha-mode - wouldn't
>> there still be a bottleneck in the master node of the cluster? My
>> understanding is that it has a hand in all operations (obviously true in
>> a cluster with ha queues), but that it is in-line with all
>> non-publishing operation. Is this a correct understanding?
>>
>
> There's no such thing as a master node for a *cluster*. There is for
> individual queues. Different queues can have their masters on different
> nodes.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/04f7f7af/attachment.htm>

From brettflitter at gmail.com  Tue Mar 19 21:20:15 2013
From: brettflitter at gmail.com (nybras)
Date: Tue, 19 Mar 2013 14:20:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Error after attempting SSL tutorial
Message-ID: <1363728015001-25565.post@n5.nabble.com>

I was attempting the SSL tutorial and when I went to restart RabbitMQ I got
the following:

Error: unable to connect to node rabbit at h2093796: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at h2093796]

hosts, their running nodes and ports:
- h2093796: [{rabbitmqctl14922,34865}]

current node details:
- node name: rabbitmqctl14922 at h2093796
- home dir: /var/lib/rabbitmq
- cookie hash: cXy70uavVk97ENIqkfUwBQ==


I panicked big time and tried to uninstall and then re-install but still
have the same problem. I really haven't got a clue what to do..

Your help would be most appreciated!




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-after-attempting-SSL-tutorial-tp25565.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Tue Mar 19 21:30:44 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Mar 2013 21:30:44 +0000
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
	<CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
Message-ID: <5148D904.7040300@rabbitmq.com>

On 19/03/13 21:16, Richard Raseley wrote:
> Sorry, I meant to say the master queue process. Can you comment on my
> previous question assuming that correction?

Yes, all queue operations go via the queue's master.

However, I fail to see what relevance that has to your question about 
scaling throughput via either adding nodes to a single cluster or 
creating new clusters. In either case you are only going to get 
additional scalability at the queue level by having more than one queue 
and distributing those queues them over the available nodes.

Matthias.

From richard at raseley.com  Tue Mar 19 21:55:31 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 19 Mar 2013 14:55:31 -0700
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <5148D904.7040300@rabbitmq.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
	<CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
	<5148D904.7040300@rabbitmq.com>
Message-ID: <CAO=6ox884+wUux8dFDWjaUw9iFU19eeVTKGX86q2_OaTq3JHxg@mail.gmail.com>

Matthias,

The relevance lies in the fact that the design of this particular
application component relies on a single highly available queue bound to a
single exchange. My thought (which you've mostly confirmed) was that if I
create multiple clusters with mirrored configurations (e.g. same exchanges,
queues, users, etc.) and place those in a single load balanced pool I will
be able to scale my performance (while maintaining high availability for
all messages) whereas if I add additional nodes to a cluster I will not -
as all operations will happen via the mater queue process which resides on
exactly one node.

Thank you very much for your quick replies.

Regards,

Richard




On Tue, Mar 19, 2013 at 2:30 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 19/03/13 21:16, Richard Raseley wrote:
>
>> Sorry, I meant to say the master queue process. Can you comment on my
>> previous question assuming that correction?
>>
>
> Yes, all queue operations go via the queue's master.
>
> However, I fail to see what relevance that has to your question about
> scaling throughput via either adding nodes to a single cluster or creating
> new clusters. In either case you are only going to get additional
> scalability at the queue level by having more than one queue and
> distributing those queues them over the available nodes.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/e506c94a/attachment.htm>

From david at bluesunrise.com  Tue Mar 19 21:57:25 2013
From: david at bluesunrise.com (David S Taylor)
Date: Tue, 19 Mar 2013 14:57:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrade Java Driver 2.8.7 to 3.0.4 required?
In-Reply-To: <f2cf0d98-10a3-42bb-8342-303c222de771@googlegroups.com>
References: <f2cf0d98-10a3-42bb-8342-303c222de771@googlegroups.com>
Message-ID: <d37c1a7c-4fda-4fc9-a952-df39132a9bf9@googlegroups.com>


On Monday, March 18, 2013 3:14:08 PM UTC-7, David S Taylor wrote:
>
> We are in the process of upgrading our server to 3.0.4. We have several 
> older Java applications running with the 2.8.7 client. Will we need to 
> upgrade the Java driver to talk to 3.0.4, or can we just continue to run 
> those apps as is with the 2.8.7 driver talking to a 3.0.4 Rabbit server? 
> Sorry to bother, just couldn't find much information on APIs changes or 
> requirements for running 2.x Java client against 3.x....


Well, I just tried it. 2.8.7 Java client seems to work fine with 3.0.4 
server. 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/8e7ce285/attachment.htm>

From david at bluesunrise.com  Tue Mar 19 21:57:25 2013
From: david at bluesunrise.com (David S Taylor)
Date: Tue, 19 Mar 2013 14:57:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Upgrade Java Driver 2.8.7 to 3.0.4 required?
In-Reply-To: <f2cf0d98-10a3-42bb-8342-303c222de771@googlegroups.com>
References: <f2cf0d98-10a3-42bb-8342-303c222de771@googlegroups.com>
Message-ID: <d37c1a7c-4fda-4fc9-a952-df39132a9bf9@googlegroups.com>


On Monday, March 18, 2013 3:14:08 PM UTC-7, David S Taylor wrote:
>
> We are in the process of upgrading our server to 3.0.4. We have several 
> older Java applications running with the 2.8.7 client. Will we need to 
> upgrade the Java driver to talk to 3.0.4, or can we just continue to run 
> those apps as is with the 2.8.7 driver talking to a 3.0.4 Rabbit server? 
> Sorry to bother, just couldn't find much information on APIs changes or 
> requirements for running 2.x Java client against 3.x....


Well, I just tried it. 2.8.7 Java client seems to work fine with 3.0.4 
server. 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/8e7ce285/attachment-0001.htm>

From matthias at rabbitmq.com  Tue Mar 19 21:59:55 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Mar 2013 21:59:55 +0000
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <CAO=6ox884+wUux8dFDWjaUw9iFU19eeVTKGX86q2_OaTq3JHxg@mail.gmail.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
	<CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
	<5148D904.7040300@rabbitmq.com>
	<CAO=6ox884+wUux8dFDWjaUw9iFU19eeVTKGX86q2_OaTq3JHxg@mail.gmail.com>
Message-ID: <5148DFDB.4040209@rabbitmq.com>

On 19/03/13 21:55, Richard Raseley wrote:
> The relevance lies in the fact that the design of this particular
> application component relies on a single highly available queue bound to
> a single exchange. My thought (which you've mostly confirmed) was that
> if I create multiple clusters with mirrored configurations (e.g. same
> exchanges, queues, users, etc.) and place those in a single load
> balanced pool I will be able to scale my performance (while maintaining
> high availability for all messages) whereas if I add additional nodes to
> a cluster I will not - as all operations will happen via the mater queue
> process which resides on exactly one node.

But your "*single* highly available queue", can only live in one 
cluster, since it's a *single* queue. So I don't see how extra clusters 
help here.

Matthias.

From matthias at rabbitmq.com  Tue Mar 19 22:02:18 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Mar 2013 22:02:18 +0000
Subject: [rabbitmq-discuss] Upgrade Java Driver 2.8.7 to 3.0.4 required?
In-Reply-To: <d37c1a7c-4fda-4fc9-a952-df39132a9bf9@googlegroups.com>
References: <f2cf0d98-10a3-42bb-8342-303c222de771@googlegroups.com>
	<d37c1a7c-4fda-4fc9-a952-df39132a9bf9@googlegroups.com>
Message-ID: <5148E06A.5030109@rabbitmq.com>

On 19/03/13 21:57, David S Taylor wrote:
> On Monday, March 18, 2013 3:14:08 PM UTC-7, David S Taylor wrote:
>
>     We are in the process of upgrading our server to 3.0.4. We have
>     several older Java applications running with the 2.8.7 client. Will
>     we need to upgrade the Java driver to talk to 3.0.4, or can we just
>     continue to run those apps as is with the 2.8.7 driver talking to a
>     3.0.4 Rabbit server? Sorry to bother, just couldn't find much
>     information on APIs changes or requirements for running 2.x Java
>     client against 3.x....
>
> Well, I just tried it. 2.8.7 Java client seems to work fine with 3.0.4
> server.

Michael had answered your original question. 
http://rabbitmq.1065348.n5.nabble.com/Upgrade-Java-Driver-2-8-7-to-3-0-4-required-tp25532p25536.html. 
Did you not see that response?

Regards,

Matthias.

From brettflitter at gmail.com  Tue Mar 19 22:05:36 2013
From: brettflitter at gmail.com (nybras)
Date: Tue, 19 Mar 2013 15:05:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Error after attempting SSL tutorial
In-Reply-To: <1363728015001-25565.post@n5.nabble.com>
References: <1363728015001-25565.post@n5.nabble.com>
Message-ID: <1363730736487-25571.post@n5.nabble.com>

I've also got this in my .log

=INFO REPORT==== 19-Mar-2013::21:39:04 ===
Halting Erlang VM

and this:

ERROR: node with name "rabbit" already running on "h2093796"



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-after-attempting-SSL-tutorial-tp25565p25571.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From richard at raseley.com  Tue Mar 19 22:12:51 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 19 Mar 2013 15:12:51 -0700
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <5148DFDB.4040209@rabbitmq.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
	<CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
	<5148D904.7040300@rabbitmq.com>
	<CAO=6ox884+wUux8dFDWjaUw9iFU19eeVTKGX86q2_OaTq3JHxg@mail.gmail.com>
	<5148DFDB.4040209@rabbitmq.com>
Message-ID: <CAO=6ox8TQV_Z9tTS94yVyrooCsjkdnuLPhDkVA20U7K7ry_Jcw@mail.gmail.com>

Matthias,

Imagine the following scenario:

There are four servers named rmq01, rmq02, rmq03, and rmq04. Servers rmq01
and rmq02 are clustered; servers rmq03 and rmq04 are clustered (so we now
have 2x two node clusters).

On both clusters we create a vhost named "default", a direct exchange named
"default", a queue named "default", a user "default" (which has read, write
and config access to the aforementioned objects) with a password of
"default" and apply the ha-all mode to the "default" vhost.

We place these two identically configured clusters inside of a load
balanced pool with a "least queue depth" configuration. We then configure
the consumers and producers associated with this app to connect to the VIP
(which maps to the load balanced pool) to send messages to the "default"
exchange and consume messages from the "default" queue.

Assuming we have more producers and consumers than we do RabbitMQ nodes
(and they get distributed properly), we've now increased our throughput -
as we now have two master queue processes to work with on this "single"
queue.

Regards,

Richard


On Tue, Mar 19, 2013 at 2:59 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 19/03/13 21:55, Richard Raseley wrote:
>
>> The relevance lies in the fact that the design of this particular
>> application component relies on a single highly available queue bound to
>> a single exchange. My thought (which you've mostly confirmed) was that
>> if I create multiple clusters with mirrored configurations (e.g. same
>> exchanges, queues, users, etc.) and place those in a single load
>> balanced pool I will be able to scale my performance (while maintaining
>> high availability for all messages) whereas if I add additional nodes to
>> a cluster I will not - as all operations will happen via the mater queue
>> process which resides on exactly one node.
>>
>
> But your "*single* highly available queue", can only live in one cluster,
> since it's a *single* queue. So I don't see how extra clusters help here.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/af1f5ce8/attachment.htm>

From matthias at rabbitmq.com  Tue Mar 19 22:27:38 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Mar 2013 22:27:38 +0000
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <CAO=6ox8TQV_Z9tTS94yVyrooCsjkdnuLPhDkVA20U7K7ry_Jcw@mail.gmail.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
	<CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
	<5148D904.7040300@rabbitmq.com>
	<CAO=6ox884+wUux8dFDWjaUw9iFU19eeVTKGX86q2_OaTq3JHxg@mail.gmail.com>
	<5148DFDB.4040209@rabbitmq.com>
	<CAO=6ox8TQV_Z9tTS94yVyrooCsjkdnuLPhDkVA20U7K7ry_Jcw@mail.gmail.com>
Message-ID: <5148E65A.7000602@rabbitmq.com>

On 19/03/13 22:12, Richard Raseley wrote:
> There are four servers named rmq01, rmq02, rmq03, and rmq04. Servers
> rmq01 and rmq02 are clustered; servers rmq03 and rmq04 are clustered (so
> we now have 2x two node clusters).
>
> On both clusters we create a vhost named "default", a direct exchange
> named "default", a queue named "default", a user "default" (which has
> read, write and config access to the aforementioned objects) with a
> password of "default" and apply the ha-all mode to the "default" vhost.
>
> We place these two identically configured clusters inside of a load
> balanced pool with a "least queue depth" configuration. We then
> configure the consumers and producers associated with this app to
> connect to the VIP (which maps to the load balanced pool) to send
> messages to the "default" exchange and consume messages from the
> "default" queue.
>
> Assuming we have more producers and consumers than we do RabbitMQ nodes
> (and they get distributed properly), we've now increased our throughput
> - as we now have two master queue processes to work with on this
> "single" queue.

I thought that's where you were heading :)

You really have two queues in the above. Message order is no longer 
preserved between messages ending up in different (real) queues. And 
consumers on one (real) queue will never see the messages published to 
the other. If that is ok in your use case then fine.

You could get the same effect by just having two queues in the same 
cluster, though obviously that requires them to be named differently and 
hence is not transparent to clients.

Matthias.

From ehberg at gmail.com  Tue Mar 19 16:18:17 2013
From: ehberg at gmail.com (Eric Berg)
Date: Tue, 19 Mar 2013 09:18:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Many RabbitMQ Status Processes
Message-ID: <07414569-2ad1-4704-9f5c-c69191c3f2ba@googlegroups.com>

Hi! I have a 2 node cluster running for a prototype we are developing, it 
handles over 1000 queues and over 1000 msg/s when running at full speed. We 
had an issue recently with some run away processes that published messages 
from production app servers vi the php library:

https://github.com/videlalvaro/php-amqplib

The cause of that is still under investigation, but it left many thousands 
of 'stale' idle connections that rabbit was maintaining. Attempting to 
stop/start each node hangs indefinitely, the only way get a full restart of 
the server is to actually restart the hardware. I see 58 'status' processes 
attributed to rabbit:

rabbitmq 16066 16033  0 Mar18 ?        00:00:00 inet_gethost 4
rabbitmq 16067 16066  0 Mar18 ?        00:00:00 inet_gethost 4
root     17713 20340  0 05:27 ?        00:00:00 /bin/sh 
/etc/init.d/rabbitmq-server status
root     17716 17713  0 05:27 ?        00:00:00 /bin/sh 
/usr/sbin/rabbitmqctl status
root     17725 17716  0 05:27 ?        00:00:00 su rabbitmq -s /bin/sh -c 
/usr/lib/rabbitmq/bin/rabbitmqctl  "status"
rabbitmq 17726 17725  0 05:27 ?        00:00:00 
/usr/lib64/erlang/erts-5.8.5/bin/beam.smp -- -root /usr/lib64/erlang 
-progname erl -- -home /var/lib/rabbitmq -- -pa 
/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/sbin/../ebin -noshell -noinput 
-hidden -sname rabbitmqctl17726 -s rabbit_control_main -nodename 
rabbit at rabbit -extra status


When stopping the node I see this in the log file:
=INFO REPORT==== 19-Mar-2013::11:18:32 ===
Stopping RabbitMQ

=INFO REPORT==== 19-Mar-2013::11:18:32 ===
    application: rabbitmq_management_visualiser
    exited: stopped
    type: temporary

=INFO REPORT==== 19-Mar-2013::11:18:32 ===
    application: rabbitmq_federation_management
    exited: stopped
    type: temporary


Has anyone see issues with many thousands of stale connections, in 
combination with many status processes and hanging stop/start? Currently 
there are are no producers or consumers connected to this box.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/913080b9/attachment.htm>

From matthias at rabbitmq.com  Tue Mar 19 22:35:17 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Mar 2013 22:35:17 +0000
Subject: [rabbitmq-discuss] Guidance on Using F5 Load Balancer with
	RabbitMQ
In-Reply-To: <CAO=6ox-F9gjN1z=xC64Weu_RMnG2eNFbW9CJuCMbT=tScrdCzw@mail.gmail.com>
References: <CAO=6ox_prftz1q9pB5U5QKzNNgoKbV=uMJ0eu+G=WqEEinr_ug@mail.gmail.com>
	<5F33CA66-73A7-4F2D-B474-7FD02491ABB5@rabbitmq.com>
	<CAO=6ox-MHwuLj5DPKj=2WOi7N4cYVq5Q5za6MMRQ0AhZvkLxng@mail.gmail.com>
	<16B51C4C-0EFE-47BE-825B-E84D21DA19BE@rabbitmq.com>
	<CAO=6ox8kznOpbPVCfJYm42A6ABZE=b5ZU71k-=QF0j1zF890Fw@mail.gmail.com>
	<E11C6E22-FE84-402E-B066-61F4AD6FAEDA@rabbitmq.com>
	<CAO=6ox-F9gjN1z=xC64Weu_RMnG2eNFbW9CJuCMbT=tScrdCzw@mail.gmail.com>
Message-ID: <5148E825.8070900@rabbitmq.com>

Richard,

On 18/03/13 18:06, Richard Raseley wrote:
> Thank you for that information - I hadn't realized that was the case
> with HA queues. So, in our situation we may be better off configuring
> the load balanced pool to be Active / Passive so that messages will
> always be flowing directly to the node that is running the master queue
> process (thereby eliminating the intra-node network overhead)?

Probably, but not necessarily. Queues aren't the only entities 
performing work. In particular the entire protocol handling, both 
inbound and outbound, also takes a fair chunk of effort. And system 
resources (memory, sockets). So while getting publishers and consumers 
to connect to the 'home' node of a queue (*) saves an internode message 
transfer, it does put more load on that node.

(*) if that is possible; in general a published message may get routed 
to several queues, which may not all have the same home node.


Matthias.

From richard at raseley.com  Tue Mar 19 22:35:51 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 19 Mar 2013 15:35:51 -0700
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <5148E65A.7000602@rabbitmq.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
	<CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
	<5148D904.7040300@rabbitmq.com>
	<CAO=6ox884+wUux8dFDWjaUw9iFU19eeVTKGX86q2_OaTq3JHxg@mail.gmail.com>
	<5148DFDB.4040209@rabbitmq.com>
	<CAO=6ox8TQV_Z9tTS94yVyrooCsjkdnuLPhDkVA20U7K7ry_Jcw@mail.gmail.com>
	<5148E65A.7000602@rabbitmq.com>
Message-ID: <CAO=6ox-KkDbxj9v_oCmpz04pfNF7cge-FMXb6KMj_D2S_xVR_g@mail.gmail.com>

Matthias,

I am glad that you were able to anticipate where I was heading - that means
I am not completely insane (at least as it relates to this). =]

Yes, I understand that they are actually two separate queues (I am treating
them as one logical one for purposes of discussion). In this case the lack
of order preservation and visibility from one cluster to the other isn't an
issue for us. We decided not to go with two queues for the transparency
reasons you mentioned.

Thanks so much for your time today.

Regards,

Richard


On Tue, Mar 19, 2013 at 3:27 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 19/03/13 22:12, Richard Raseley wrote:
>
>> There are four servers named rmq01, rmq02, rmq03, and rmq04. Servers
>> rmq01 and rmq02 are clustered; servers rmq03 and rmq04 are clustered (so
>> we now have 2x two node clusters).
>>
>> On both clusters we create a vhost named "default", a direct exchange
>> named "default", a queue named "default", a user "default" (which has
>> read, write and config access to the aforementioned objects) with a
>> password of "default" and apply the ha-all mode to the "default" vhost.
>>
>> We place these two identically configured clusters inside of a load
>> balanced pool with a "least queue depth" configuration. We then
>> configure the consumers and producers associated with this app to
>> connect to the VIP (which maps to the load balanced pool) to send
>> messages to the "default" exchange and consume messages from the
>> "default" queue.
>>
>> Assuming we have more producers and consumers than we do RabbitMQ nodes
>> (and they get distributed properly), we've now increased our throughput
>> - as we now have two master queue processes to work with on this
>> "single" queue.
>>
>
> I thought that's where you were heading :)
>
> You really have two queues in the above. Message order is no longer
> preserved between messages ending up in different (real) queues. And
> consumers on one (real) queue will never see the messages published to the
> other. If that is ok in your use case then fine.
>
> You could get the same effect by just having two queues in the same
> cluster, though obviously that requires them to be named differently and
> hence is not transparent to clients.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/83571012/attachment.htm>

From richard at raseley.com  Tue Mar 19 22:38:21 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 19 Mar 2013 15:38:21 -0700
Subject: [rabbitmq-discuss] Guidance on Using F5 Load Balancer with
	RabbitMQ
In-Reply-To: <5148E825.8070900@rabbitmq.com>
References: <CAO=6ox_prftz1q9pB5U5QKzNNgoKbV=uMJ0eu+G=WqEEinr_ug@mail.gmail.com>
	<5F33CA66-73A7-4F2D-B474-7FD02491ABB5@rabbitmq.com>
	<CAO=6ox-MHwuLj5DPKj=2WOi7N4cYVq5Q5za6MMRQ0AhZvkLxng@mail.gmail.com>
	<16B51C4C-0EFE-47BE-825B-E84D21DA19BE@rabbitmq.com>
	<CAO=6ox8kznOpbPVCfJYm42A6ABZE=b5ZU71k-=QF0j1zF890Fw@mail.gmail.com>
	<E11C6E22-FE84-402E-B066-61F4AD6FAEDA@rabbitmq.com>
	<CAO=6ox-F9gjN1z=xC64Weu_RMnG2eNFbW9CJuCMbT=tScrdCzw@mail.gmail.com>
	<5148E825.8070900@rabbitmq.com>
Message-ID: <CAO=6ox8OiZ23M5tkX_rccQghLGtYDNy5yf87ioUJ02Nf2-BGNg@mail.gmail.com>

That makes sense. I hadn't considered the overhead of the protocol handling
vs. the cost of internode message transfer. Thank you (again) for your
assistance.

Regards,

Richard


On Tue, Mar 19, 2013 at 3:35 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Richard,
>
> On 18/03/13 18:06, Richard Raseley wrote:
>
>> Thank you for that information - I hadn't realized that was the case
>> with HA queues. So, in our situation we may be better off configuring
>> the load balanced pool to be Active / Passive so that messages will
>> always be flowing directly to the node that is running the master queue
>> process (thereby eliminating the intra-node network overhead)?
>>
>
> Probably, but not necessarily. Queues aren't the only entities performing
> work. In particular the entire protocol handling, both inbound and
> outbound, also takes a fair chunk of effort. And system resources (memory,
> sockets). So while getting publishers and consumers to connect to the
> 'home' node of a queue (*) saves an internode message transfer, it does put
> more load on that node.
>
> (*) if that is possible; in general a published message may get routed to
> several queues, which may not all have the same home node.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/b4d7cf8c/attachment.htm>

From Ron.Cordell at RelayHealth.com  Tue Mar 19 22:48:23 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron)
Date: Tue, 19 Mar 2013 22:48:23 +0000
Subject: [rabbitmq-discuss] Scaling Throughput with Highly
	Available	Queues
In-Reply-To: <CAO=6ox-KkDbxj9v_oCmpz04pfNF7cge-FMXb6KMj_D2S_xVR_g@mail.gmail.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
	<CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
	<5148D904.7040300@rabbitmq.com>
	<CAO=6ox884+wUux8dFDWjaUw9iFU19eeVTKGX86q2_OaTq3JHxg@mail.gmail.com>
	<5148DFDB.4040209@rabbitmq.com>
	<CAO=6ox8TQV_Z9tTS94yVyrooCsjkdnuLPhDkVA20U7K7ry_Jcw@mail.gmail.com>
	<5148E65A.7000602@rabbitmq.com>
	<CAO=6ox-KkDbxj9v_oCmpz04pfNF7cge-FMXb6KMj_D2S_xVR_g@mail.gmail.com>
Message-ID: <0B8CD6850421B745BE39BC5C7601923271F3B23C@DDCEP50015.na.corp.mckesson.com>

Sorry for jumping in here, but I'm a little confused on how to scale throughput in the HA scenario. If I assume that all queue are mirrored queues on a single cluster then what are my options to adding more throughput should I need to?

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Richard Raseley
Sent: Tuesday, March 19, 2013 3:36 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Scaling Throughput with Highly Available Queues

Matthias,

I am glad that you were able to anticipate where I was heading - that means I am not completely insane (at least as it relates to this). =]

Yes, I understand that they are actually two separate queues (I am treating them as one logical one for purposes of discussion). In this case the lack of order preservation and visibility from one cluster to the other isn't an issue for us. We decided not to go with two queues for the transparency reasons you mentioned.

Thanks so much for your time today.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/34e34046/attachment.htm>

From richard at raseley.com  Tue Mar 19 23:06:40 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 19 Mar 2013 16:06:40 -0700
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <0B8CD6850421B745BE39BC5C7601923271F3B23C@DDCEP50015.na.corp.mckesson.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
	<CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
	<5148D904.7040300@rabbitmq.com>
	<CAO=6ox884+wUux8dFDWjaUw9iFU19eeVTKGX86q2_OaTq3JHxg@mail.gmail.com>
	<5148DFDB.4040209@rabbitmq.com>
	<CAO=6ox8TQV_Z9tTS94yVyrooCsjkdnuLPhDkVA20U7K7ry_Jcw@mail.gmail.com>
	<5148E65A.7000602@rabbitmq.com>
	<CAO=6ox-KkDbxj9v_oCmpz04pfNF7cge-FMXb6KMj_D2S_xVR_g@mail.gmail.com>
	<0B8CD6850421B745BE39BC5C7601923271F3B23C@DDCEP50015.na.corp.mckesson.com>
Message-ID: <CAO=6ox86CV5DnGLwZvXQJmtZhohRr9i2LxafsdroOaXszUG9Pg@mail.gmail.com>

Ron,

You have a couple options (that I know of) if your requirements include a
*single* cluster (which was not my case):

1) Increase the resources (CPU, disk, memory, network, etc.) which are
available to the nodes which are hosting the master queue processes.

2) Ensure that the master queue processes are spread out evenly across the
available nodes.

Regards,

Richard


On Tue, Mar 19, 2013 at 3:48 PM, Cordell, Ron
<Ron.Cordell at relayhealth.com>wrote:

>  Sorry for jumping in here, but I?m a little confused on how to scale
> throughput in the HA scenario. If I assume that all queue are mirrored
> queues on a single cluster then what are my options to adding more
> throughput should I need to?****
>
> ** **
>
> *From:* rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Richard
> Raseley
> *Sent:* Tuesday, March 19, 2013 3:36 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Scaling Throughput with Highly
> Available Queues****
>
> ** **
>
> Matthias,****
>
> ** **
>
> I am glad that you were able to anticipate where I was heading - that
> means I am not completely insane (at least as it relates to this). =]****
>
> ** **
>
> Yes, I understand that they are actually two separate queues (I am
> treating them as one logical one for purposes of discussion). In this case
> the lack of order preservation and visibility from one cluster to the other
> isn't an issue for us. We decided not to go with two queues for the
> transparency reasons you mentioned. ****
>
> ** **
>
> Thanks so much for your time today.****
>
> ** **
>
> Regards,****
>
> ** **
>
> Richard****
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/ad55ff26/attachment.htm>

From Ron.Cordell at RelayHealth.com  Tue Mar 19 23:10:25 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron)
Date: Tue, 19 Mar 2013 23:10:25 +0000
Subject: [rabbitmq-discuss] Scaling Throughput with Highly
	Available	Queues
In-Reply-To: <CAO=6ox86CV5DnGLwZvXQJmtZhohRr9i2LxafsdroOaXszUG9Pg@mail.gmail.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
	<CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
	<5148D904.7040300@rabbitmq.com>
	<CAO=6ox884+wUux8dFDWjaUw9iFU19eeVTKGX86q2_OaTq3JHxg@mail.gmail.com>
	<5148DFDB.4040209@rabbitmq.com>
	<CAO=6ox8TQV_Z9tTS94yVyrooCsjkdnuLPhDkVA20U7K7ry_Jcw@mail.gmail.com>
	<5148E65A.7000602@rabbitmq.com>
	<CAO=6ox-KkDbxj9v_oCmpz04pfNF7cge-FMXb6KMj_D2S_xVR_g@mail.gmail.com>
	<0B8CD6850421B745BE39BC5C7601923271F3B23C@DDCEP50015.na.corp.mckesson.com>
	<CAO=6ox86CV5DnGLwZvXQJmtZhohRr9i2LxafsdroOaXszUG9Pg@mail.gmail.com>
Message-ID: <0B8CD6850421B745BE39BC5C7601923271F3B2EE@DDCEP50015.na.corp.mckesson.com>

That's what I was thinking - the master queue processes are spread across the nodes in the cluster. I will have to go back and take a look at what it takes to ensure that happens...

Thanks!

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Richard Raseley
Sent: Tuesday, March 19, 2013 4:07 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Scaling Throughput with Highly Available Queues

Ron,

You have a couple options (that I know of) if your requirements include a *single* cluster (which was not my case):

1) Increase the resources (CPU, disk, memory, network, etc.) which are available to the nodes which are hosting the master queue processes.

2) Ensure that the master queue processes are spread out evenly across the available nodes.

Regards,

Richard

On Tue, Mar 19, 2013 at 3:48 PM, Cordell, Ron <Ron.Cordell at relayhealth.com<mailto:Ron.Cordell at relayhealth.com>> wrote:
Sorry for jumping in here, but I'm a little confused on how to scale throughput in the HA scenario. If I assume that all queue are mirrored queues on a single cluster then what are my options to adding more throughput should I need to?

From: rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Richard Raseley
Sent: Tuesday, March 19, 2013 3:36 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Scaling Throughput with Highly Available Queues

Matthias,

I am glad that you were able to anticipate where I was heading - that means I am not completely insane (at least as it relates to this). =]

Yes, I understand that they are actually two separate queues (I am treating them as one logical one for purposes of discussion). In this case the lack of order preservation and visibility from one cluster to the other isn't an issue for us. We decided not to go with two queues for the transparency reasons you mentioned.

Thanks so much for your time today.

Regards,

Richard

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/bff7462d/attachment.htm>

From jerryk at rbcon.com  Tue Mar 19 23:12:37 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Tue, 19 Mar 2013 16:12:37 -0700
Subject: [rabbitmq-discuss] Error after attempting SSL tutorial
In-Reply-To: <1363730736487-25571.post@n5.nabble.com>
References: <1363728015001-25565.post@n5.nabble.com>
	<1363730736487-25571.post@n5.nabble.com>
Message-ID: <CAE0Sz=wbivBTnNwC1_uxZ+=tiSXHiW=qeYWMdf9-Hy13QJ23_w@mail.gmail.com>

I was just going to ask if you already had one running.

Check your machine for processes with beam in the process name, and command
lines where lots of rabbity stuff appears, using 'ps'.  Then kill the
stragglers if you've got some that for some reason aren't responding to the
proper shutdown method (the most common causes of which are running one
thing or another as the wrong user).

On Tue, Mar 19, 2013 at 3:05 PM, nybras <brettflitter at gmail.com> wrote:

> I've also got this in my .log
>
> =INFO REPORT==== 19-Mar-2013::21:39:04 ===
> Halting Erlang VM
>
> and this:
>
> ERROR: node with name "rabbit" already running on "h2093796"
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Error-after-attempting-SSL-tutorial-tp25565p25571.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/4e4811e1/attachment.htm>

From matthias at rabbitmq.com  Tue Mar 19 23:21:16 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Mar 2013 23:21:16 +0000
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
In-Reply-To: <CAO=6ox86CV5DnGLwZvXQJmtZhohRr9i2LxafsdroOaXszUG9Pg@mail.gmail.com>
References: <CAO=6ox_V+jFzj631QGHnFtVoghUu_LucGU_ikJwDKEub28fbBQ@mail.gmail.com>
	<5148CF3F.1070903@rabbitmq.com>
	<CAO=6ox-UoN1akS91qf1sj+=5t+OABbkx09=LAkz5PxzWHEaHHg@mail.gmail.com>
	<5148D1A7.90106@rabbitmq.com>
	<CAO=6ox90WjK3GhZjBpdOGMJqDBLu+G+VezV+-yv_t1YtjmBnXg@mail.gmail.com>
	<5148D904.7040300@rabbitmq.com>
	<CAO=6ox884+wUux8dFDWjaUw9iFU19eeVTKGX86q2_OaTq3JHxg@mail.gmail.com>
	<5148DFDB.4040209@rabbitmq.com>
	<CAO=6ox8TQV_Z9tTS94yVyrooCsjkdnuLPhDkVA20U7K7ry_Jcw@mail.gmail.com>
	<5148E65A.7000602@rabbitmq.com>
	<CAO=6ox-KkDbxj9v_oCmpz04pfNF7cge-FMXb6KMj_D2S_xVR_g@mail.gmail.com>
	<0B8CD6850421B745BE39BC5C7601923271F3B23C@DDCEP50015.na.corp.mckesson.com>
	<CAO=6ox86CV5DnGLwZvXQJmtZhohRr9i2LxafsdroOaXszUG9Pg@mail.gmail.com>
Message-ID: <5148F2EC.8050601@rabbitmq.com>

On 19/03/13 23:06, Richard Raseley wrote:
> You have a couple options (that I know of) if your requirements include
> a *single* cluster (which was not my case):
>
> 1) Increase the resources (CPU, disk, memory, network, etc.) which are
> available to the nodes which are hosting the master queue processes.
>
> 2) Ensure that the master queue processes are spread out evenly across
> the available nodes.

...in combination with ensuring that there are no more mirrors than you 
actually need in order to get the desired level of redundancy. I.e. use 
the 'exactly' ha-mode rather than 'all'. Otherwise you are wasting 
valuable resources on keeping superfluous slaves up to date.

Matthias.

From 0x6e6562 at gmail.com  Tue Mar 19 23:59:19 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 19 Mar 2013 23:59:19 +0000
Subject: [rabbitmq-discuss] Autohealing
Message-ID: <D3AB112462244459AE7D80BB5214D290@gmail.com>

Hi, 

I appreciate the development is still speculative, but I was wondering what the initial scope of partition autohealing is likely to be.

Cheers,

Ben 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130319/a0c8d457/attachment.htm>

From brettflitter at gmail.com  Wed Mar 20 08:33:32 2013
From: brettflitter at gmail.com (nybras)
Date: Wed, 20 Mar 2013 01:33:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Error after attempting SSL tutorial
In-Reply-To: <CAE0Sz=wbivBTnNwC1_uxZ+=tiSXHiW=qeYWMdf9-Hy13QJ23_w@mail.gmail.com>
References: <1363728015001-25565.post@n5.nabble.com>
	<1363730736487-25571.post@n5.nabble.com>
	<CAE0Sz=wbivBTnNwC1_uxZ+=tiSXHiW=qeYWMdf9-Hy13QJ23_w@mail.gmail.com>
Message-ID: <1363768412033-25584.post@n5.nabble.com>

I've tried killing the processes using PS but still not working. What's beam
though?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-after-attempting-SSL-tutorial-tp25565p25584.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From brettflitter at gmail.com  Wed Mar 20 09:22:57 2013
From: brettflitter at gmail.com (nybras)
Date: Wed, 20 Mar 2013 02:22:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Error after attempting SSL tutorial
In-Reply-To: <1363768412033-25584.post@n5.nabble.com>
References: <1363728015001-25565.post@n5.nabble.com>
	<1363730736487-25571.post@n5.nabble.com>
	<CAE0Sz=wbivBTnNwC1_uxZ+=tiSXHiW=qeYWMdf9-Hy13QJ23_w@mail.gmail.com>
	<1363768412033-25584.post@n5.nabble.com>
Message-ID: <1363771377144-25585.post@n5.nabble.com>

In my erl_crash.dump I'm getting: init terminating in do_boot ()



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-after-attempting-SSL-tutorial-tp25565p25585.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Wed Mar 20 09:27:32 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 20 Mar 2013 13:27:32 +0400
Subject: [rabbitmq-discuss] Error after attempting SSL tutorial
In-Reply-To: <1363768412033-25584.post@n5.nabble.com>
References: <1363728015001-25565.post@n5.nabble.com>
	<1363730736487-25571.post@n5.nabble.com>
	<CAE0Sz=wbivBTnNwC1_uxZ+=tiSXHiW=qeYWMdf9-Hy13QJ23_w@mail.gmail.com>
	<1363768412033-25584.post@n5.nabble.com>
Message-ID: <CAE3HoVSNUu0FCkxM1F-GbmkPjTKrb1JmwRKEVVajNWT5j+Pugg@mail.gmail.com>

2013/3/20 nybras <brettflitter at gmail.com>

> I've tried killing the processes using PS but still not working. What's
> beam
> though?
>

This suggests it is running as root and you run kill w/o sudo.

BEAM is Erlang VM.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/7268be9f/attachment.htm>

From brettflitter at gmail.com  Wed Mar 20 09:40:07 2013
From: brettflitter at gmail.com (nybras)
Date: Wed, 20 Mar 2013 02:40:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Error after attempting SSL tutorial
In-Reply-To: <CAE3HoVSNUu0FCkxM1F-GbmkPjTKrb1JmwRKEVVajNWT5j+Pugg@mail.gmail.com>
References: <1363728015001-25565.post@n5.nabble.com>
	<1363730736487-25571.post@n5.nabble.com>
	<CAE0Sz=wbivBTnNwC1_uxZ+=tiSXHiW=qeYWMdf9-Hy13QJ23_w@mail.gmail.com>
	<1363768412033-25584.post@n5.nabble.com>
	<CAE3HoVSNUu0FCkxM1F-GbmkPjTKrb1JmwRKEVVajNWT5j+Pugg@mail.gmail.com>
Message-ID: <1363772407940-25587.post@n5.nabble.com>

Yeah I've been killing the only rabbitmq process that ever exists with 'kill
203022' etc. I've seen no signs of BEAM.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-after-attempting-SSL-tutorial-tp25565p25587.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From watson.timothy at gmail.com  Wed Mar 20 09:56:06 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 20 Mar 2013 09:56:06 +0000
Subject: [rabbitmq-discuss] Error after attempting SSL tutorial
In-Reply-To: <1363772407940-25587.post@n5.nabble.com>
References: <1363728015001-25565.post@n5.nabble.com>
	<1363730736487-25571.post@n5.nabble.com>
	<CAE0Sz=wbivBTnNwC1_uxZ+=tiSXHiW=qeYWMdf9-Hy13QJ23_w@mail.gmail.com>
	<1363768412033-25584.post@n5.nabble.com>
	<CAE3HoVSNUu0FCkxM1F-GbmkPjTKrb1JmwRKEVVajNWT5j+Pugg@mail.gmail.com>
	<1363772407940-25587.post@n5.nabble.com>
Message-ID: <9B1BA506-145D-4A6E-8CE8-DC621705FB7D@rabbitmq.com>

On 20 Mar 2013, at 09:40, nybras <brettflitter at gmail.com> wrote:

> Yeah I've been killing the only rabbitmq process that ever exists with 'kill
> 203022' etc.

You might want to try -9 with that kill!?

> I've seen no signs of BEAM.
> 

Then what are you killing!? If there is no beam/beam.smp process then the broker isn't running.

> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-after-attempting-SSL-tutorial-tp25565p25587.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From brettflitter at gmail.com  Wed Mar 20 09:56:30 2013
From: brettflitter at gmail.com (nybras)
Date: Wed, 20 Mar 2013 02:56:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Error after attempting SSL tutorial
In-Reply-To: <1363772407940-25587.post@n5.nabble.com>
References: <1363728015001-25565.post@n5.nabble.com>
	<1363730736487-25571.post@n5.nabble.com>
	<CAE0Sz=wbivBTnNwC1_uxZ+=tiSXHiW=qeYWMdf9-Hy13QJ23_w@mail.gmail.com>
	<1363768412033-25584.post@n5.nabble.com>
	<CAE3HoVSNUu0FCkxM1F-GbmkPjTKrb1JmwRKEVVajNWT5j+Pugg@mail.gmail.com>
	<1363772407940-25587.post@n5.nabble.com>
Message-ID: <1363773390300-25588.post@n5.nabble.com>

Well whatever the problem was, after re-installing AGAIN it now works, thank
god! This is my university final year project I'm working on, I was starting
to freak out.

Thanks for your help anyways guys! cheers



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-after-attempting-SSL-tutorial-tp25565p25588.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed Mar 20 10:30:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Mar 2013 10:30:39 +0000
Subject: [rabbitmq-discuss] Autohealing
In-Reply-To: <D3AB112462244459AE7D80BB5214D290@gmail.com>
References: <D3AB112462244459AE7D80BB5214D290@gmail.com>
Message-ID: <51498FCF.5040306@rabbitmq.com>

On 19/03/13 23:59, Ben Hood wrote:
> I appreciate the development is still speculative, but I was wondering
> what the initial scope of partition autohealing is likely to be.

My current aim (aims subject to change) is to have three modes for 
dealing with partitions. One mode is "manual intervention required" and 
is essentially the same as 3.0.

The second mode is "pause the minority". In this mode, if any nodes look 
at the cluster and see that only a minority of nodes are up (from their 
point of view) they essentially hibernate (refusing to accept 
connections or do any other work) until they see they are in a majority 
again. Thus partitions can never form, at the cost of availability (ie. 
it's CP in CAP terms).

The idea is that "pause the minority" mode would be useful if you were 
to have a cluster in something like EC2, spread across three or more 
AZs. Your expected failure mode is for a single AZ to go completely 
offline - in which case you don't really care whether the cluster nodes 
within that AZ are running or not, so taking them down is an easy way to 
ensure we have no partitions.

Obviously "pause the minority" mode is a bad idea with only two cluster 
nodes (or AZs). "Pause the minority" mode is already complete and will 
be in 3.1.

The third mode (currently under development; hopefully in 3.1) is 
autohealing. In this mode partitions can still form, but once the 
cluster becomes connected again a winning partition is chosen and all 
non-winning nodes restarted to heal the partition - in other words 
mimicking what a sysadmin would do with 3.0. The interesting question is 
how to choose the winning node; my current thinking is some heuristic 
based on the number of nodes in the partition, the number of open AMQP 
connections at the moment we decide to heal, and possibly the number of 
changes that have been made in Mnesia (if we can get hold of that 
information sanely).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From myheimu at gmail.com  Wed Mar 20 08:09:16 2013
From: myheimu at gmail.com (Chen ZHONG)
Date: Wed, 20 Mar 2013 01:09:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Why the rates of deliver/ack has problem in
	RabbitMQ management?
Message-ID: <22950a8c-48b1-45df-9f96-c19528d377ef@googlegroups.com>



Just as the image.

I have a RabbitMQ cluster with some nodes, such as hdl0001, hdl0002...

This queue has a incoming rate of 4.0/s. It has a deliver rate of 4.0/s in 
fact. But it only show 0.63/s here.

Just before this problem, I reset the hdl0002's node, and join it to the 
cluster again.

Then, all the consumers which connected to hdl0002's node has no rate now. 
The consumers which connected to hdl0001's node is still OK.

<https://lh4.googleusercontent.com/-wTQ6It2prgE/UUltaP5mtzI/AAAAAAAAMs0/83SunXjj3lA/s1600/2013-03-20+15%3A59%3A02.png>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/e10843df/attachment.htm>

From myheimu at gmail.com  Wed Mar 20 08:25:28 2013
From: myheimu at gmail.com (Chen ZHONG)
Date: Wed, 20 Mar 2013 01:25:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Why ack rates don't show in RabbitMQ management?
Message-ID: <d8d55950-0d23-44c9-b959-4ac65f08e607@googlegroups.com>



Just as the image shows.

I have some consumers to consume a queue. All of them are set "Ack 
required" in programming code.

I can only see deliver rates, but not ack rates.

This problem doesn't happen in other queue, other same code consumer. Only 
here.

<https://lh3.googleusercontent.com/-xg92T1aWPek/UUlxygYfi3I/AAAAAAAAMs8/h9cjMvYrQ4w/s1600/%E9%80%89%E5%8C%BA_020.png>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/28225273/attachment.htm>

From emile at rabbitmq.com  Wed Mar 20 11:11:01 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 20 Mar 2013 11:11:01 +0000
Subject: [rabbitmq-discuss] RabbitMQ crashes just after start...
In-Reply-To: <E07AC664B6693B4BA9410CE04AAFF673063FF2DEEA@CRPMBX01.corp.cbeyond.net>
References: <E07AC664B6693B4BA9410CE04AAFF673063FF2DD04@CRPMBX01.corp.cbeyond.net>
	<51488C66.2040102@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FF2DEEA@CRPMBX01.corp.cbeyond.net>
Message-ID: <51499945.5030605@rabbitmq.com>


Hi David,

On 19/03/13 16:32, David Buckingham wrote:
>> Does the "WorkDir" row in the output of "rabbitmq-service.bat list"
>> contain the expected value?
> 
> Yes.  (M:\Program Files (x86)\RabbitMQ Server\RabbitMQ)

Is M: a network drive? The Erlang documentation forbids that:
http://www.erlang.org/doc/man/erlsrv.html
I don't get exactly the same error as the one you reported when
installing on a network drive, but it's worth checking that.

You mentioned that 2 installations suffered from a failure to start. Can
you think of anything relevant in the operating environment that those
instances have in common?


-Emile





From bison_art at o2.pl  Wed Mar 20 12:10:18 2013
From: bison_art at o2.pl (rabbit15)
Date: Wed, 20 Mar 2013 05:10:18 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET channel Thread safe
Message-ID: <1363781418180-25594.post@n5.nabble.com>

Hi I have question if .NET client channel is thread safe ?
Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/NET-channel-Thread-safe-tp25594.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From David.Buckingham at cbeyond.net  Wed Mar 20 12:14:00 2013
From: David.Buckingham at cbeyond.net (David Buckingham)
Date: Wed, 20 Mar 2013 08:14:00 -0400
Subject: [rabbitmq-discuss] RabbitMQ crashes just after start...
In-Reply-To: <51499945.5030605@rabbitmq.com>
References: <E07AC664B6693B4BA9410CE04AAFF673063FF2DD04@CRPMBX01.corp.cbeyond.net>
	<51488C66.2040102@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FF2DEEA@CRPMBX01.corp.cbeyond.net>
	<51499945.5030605@rabbitmq.com>
Message-ID: <E07AC664B6693B4BA9410CE04AAFF673063FF2EA06@CRPMBX01.corp.cbeyond.net>

> Is M: a network drive? The Erlang documentation forbids that:
> http://www.erlang.org/doc/man/erlsrv.html
> I don't get exactly the same error as the one you reported when installing on
> a network drive, but it's worth checking that.

No, it's a local drive.  It's actually a virtual machine with an VHD attached.

> You mentioned that 2 installations suffered from a failure to start. Can you
> think of anything relevant in the operating environment that those instances
> have in common?

I spent yesterday comparing those VMs in question with a good installation in the lab.  All 3 were identically configured.  As a matter of fact, all 3 were built from the same initial VM image.

Thanks for your help!

From emile at rabbitmq.com  Wed Mar 20 12:39:02 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 20 Mar 2013 12:39:02 +0000
Subject: [rabbitmq-discuss] socket_error
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038FEB810C3@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD79038FEB810C3@vmexchange02.seegrid.local>
Message-ID: <5149ADE6.1060809@rabbitmq.com>

Hi,

On 19/03/13 19:49, Elizabeth Liao wrote:

> We're seeing the following errors in the sasl logs on some of our
> systems. Any idea on what's going on?  We've seen this on both 2.8.6
> and 2.8.7 and running with and without a shovel configuration.  Also
> our machines are not clustered.

There have been potentially relevant improvements to the shovel in
v3.0.1 and v3.0.2. Are you able to check whether the problem can be
reproduced with the latest version of the plugin?

> {{badmatch,{error,{{socket_error,enomem},{expecting,'connection.start'}}}},

What operating system produced this error? Can you easily reproduce it?



-Emile

From 0x6e6562 at gmail.com  Wed Mar 20 13:32:17 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 20 Mar 2013 13:32:17 +0000
Subject: [rabbitmq-discuss] Getting connections by port
Message-ID: <83593AEEC04E48D6BF1429F99001CDAD@gmail.com>

Hi, 

If I want to query rabbit_mgmt_db:get_connections/1 for a specific port, what should the argument be?

Cheers,

Ben 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/28b964ee/attachment.htm>

From wladiwostok10 at ymail.com  Wed Mar 20 13:33:11 2013
From: wladiwostok10 at ymail.com (groover)
Date: Wed, 20 Mar 2013 06:33:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Windows vs Linux
In-Reply-To: <771C375058E4E54CADE84C237C1BB3E61088EF0476@odcexch03.csg.csgsystems.com>
References: <771C375058E4E54CADE84C237C1BB3E61088EF0476@odcexch03.csg.csgsystems.com>
Message-ID: <1363786391958-25597.post@n5.nabble.com>

dotnet is a Microsoft programming language so I would say you need Windows.
More information on the differences between Windows and Linux can be found
on this  page <http://weloveourhost.com/linux-windows.html>  . Good luck!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Windows-vs-Linux-tp25445p25597.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Wed Mar 20 13:38:48 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 20 Mar 2013 13:38:48 +0000
Subject: [rabbitmq-discuss] Windows vs Linux
In-Reply-To: <1363786391958-25597.post@n5.nabble.com>
References: <771C375058E4E54CADE84C237C1BB3E61088EF0476@odcexch03.csg.csgsystems.com>
	<1363786391958-25597.post@n5.nabble.com>
Message-ID: <03D3A7FB-EAF4-4A84-830A-A62C9DE339F0@rabbitmq.com>

On 20 Mar 2013, at 13:33, groover wrote:
> dotnet is a Microsoft programming language so I would say you need Windows.

Whilst Windows is well supported by rabbit, it is not necessary to run the broker on the same operating system as its clients, therefore the use of .NET as an application programming platform does not specifically require users to choose to run the broker on Windows.



From simon at rabbitmq.com  Wed Mar 20 13:40:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Mar 2013 13:40:01 +0000
Subject: [rabbitmq-discuss] Getting connections by port
In-Reply-To: <83593AEEC04E48D6BF1429F99001CDAD@gmail.com>
References: <83593AEEC04E48D6BF1429F99001CDAD@gmail.com>
Message-ID: <5149BC31.3040400@rabbitmq.com>

On 20/03/13 13:32, Ben Hood wrote:
> If I want to query rabbit_mgmt_db:get_connections/1 for a specific port,
> what should the argument be?

Really get_connections([Name]) is a misfeature and will become 
get_connection(Name) in a future release. There's no way to query the 
mgmt db filtering on an arbitrary value; it's probably not too expensive 
to ask for all connections then filter yourself.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From 0x6e6562 at gmail.com  Wed Mar 20 13:45:10 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 20 Mar 2013 13:45:10 +0000
Subject: [rabbitmq-discuss] Getting connections by port
In-Reply-To: <5149BC31.3040400@rabbitmq.com>
References: <83593AEEC04E48D6BF1429F99001CDAD@gmail.com>
	<5149BC31.3040400@rabbitmq.com>
Message-ID: <0D83DF60C76A4238BE270C60DBAF08B2@gmail.com>



On Wednesday, 20 March 2013 at 13:40, Simon MacMullen wrote: 

> Really get_connections([Name]) is a misfeature and will become 
> get_connection(Name) in a future release. There's no way to query the 
> mgmt db filtering on an arbitrary value; it's probably not too expensive 
> to ask for all connections then filter yourself.
> 
> 


OK, I'll filter them myself - thanks for the heads up.

Cheers,

Ben

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/9c349818/attachment.htm>

From emile at rabbitmq.com  Wed Mar 20 13:55:47 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 20 Mar 2013 13:55:47 +0000
Subject: [rabbitmq-discuss] RabbitMQ crashes just after start...
In-Reply-To: <E07AC664B6693B4BA9410CE04AAFF673063FF2EA06@CRPMBX01.corp.cbeyond.net>
References: <E07AC664B6693B4BA9410CE04AAFF673063FF2DD04@CRPMBX01.corp.cbeyond.net>
	<51488C66.2040102@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FF2DEEA@CRPMBX01.corp.cbeyond.net>
	<51499945.5030605@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FF2EA06@CRPMBX01.corp.cbeyond.net>
Message-ID: <5149BFE3.8080200@rabbitmq.com>


Hi,

On 20/03/13 12:14, David Buckingham wrote:
> I spent yesterday comparing those VMs in question with a good
> installation in the lab.  All 3 were identically configured.  As a
> matter of fact, all 3 were built from the same initial VM image.

I can confirm that the RabbitMQ service installation and startup
proceeds normally when installed to a VHD drive, even when the backing
file resides on a network drive.

The problem you report probably relates to logging. If the log handler
fails for any reason then the boot process halts very early. Can you try
to change the logging behaviour by changing the lines in the
rabbit-service.bat that read

-rabbit error_logger {file,\""!LOGS:\=/!"\"} ^
-rabbit sasl_error_logger {file,\""!SASL_LOGS:\=/!"\"} ^

to read

-rabbit error_logger false ^
-rabbit sasl_error_logger false ^

instead and see if that makes any difference?



-Emile








From emile at rabbitmq.com  Wed Mar 20 13:59:12 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 20 Mar 2013 13:59:12 +0000
Subject: [rabbitmq-discuss] .NET channel Thread safe
In-Reply-To: <1363781418180-25594.post@n5.nabble.com>
References: <1363781418180-25594.post@n5.nabble.com>
Message-ID: <5149C0B0.2020905@rabbitmq.com>

On 20/03/13 12:10, rabbit15 wrote:
> Hi I have question if .NET client channel is thread safe ?
> Best Regards,
> Artur


Please see section 2.9 and 2.10 in the .net library user guide for
restrictions that apply:

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v3.0.4/rabbitmq-dotnet-client-3.0.4-user-guide.pdf



-Emile







From emanuele.aliberti at fitb.eu  Wed Mar 20 14:10:11 2013
From: emanuele.aliberti at fitb.eu (Emanuele Aliberti)
Date: Wed, 20 Mar 2013 15:10:11 +0100
Subject: [rabbitmq-discuss] Windows vs Linux
In-Reply-To: <03D3A7FB-EAF4-4A84-830A-A62C9DE339F0@rabbitmq.com>
References: <771C375058E4E54CADE84C237C1BB3E61088EF0476@odcexch03.csg.csgsystems.com>
	<1363786391958-25597.post@n5.nabble.com>
	<03D3A7FB-EAF4-4A84-830A-A62C9DE339F0@rabbitmq.com>
Message-ID: <5149C343.1080107@fitb.eu>

Also assuming (.NET == Windows) is like assuming (Spanish == Spain)...


On 20/03/2013 14:38, Tim Watson wrote:
> On 20 Mar 2013, at 13:33, groover wrote:
>> dotnet is a Microsoft programming language so I would say you need Windows.
> Whilst Windows is well supported by rabbit, it is not necessary to run the broker on the same operating system as its clients, therefore the use of .NET as an application programming platform does not specifically require users to choose to run the broker on Windows.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Emanuele Aliberti



From David.Buckingham at cbeyond.net  Wed Mar 20 14:13:35 2013
From: David.Buckingham at cbeyond.net (David Buckingham)
Date: Wed, 20 Mar 2013 10:13:35 -0400
Subject: [rabbitmq-discuss] RabbitMQ crashes just after start...
In-Reply-To: <5149BFE3.8080200@rabbitmq.com>
References: <E07AC664B6693B4BA9410CE04AAFF673063FF2DD04@CRPMBX01.corp.cbeyond.net>
	<51488C66.2040102@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FF2DEEA@CRPMBX01.corp.cbeyond.net>
	<51499945.5030605@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FF2EA06@CRPMBX01.corp.cbeyond.net>
	<5149BFE3.8080200@rabbitmq.com>
Message-ID: <E07AC664B6693B4BA9410CE04AAFF673063FFC01C0@CRPMBX01.corp.cbeyond.net>

> instead and see if that makes any difference?

No change.  I've copied the messages from the Rabbit log files below.  Maybe they can offer some help, after all???

Here are the contents of rabbit at SCCS004LAB.log:

=INFO REPORT==== 20-Mar-2013::10:05:47 ===
    application: os_mon
    exited: {shutdown,{os_mon,start,[normal,[]]}}
    type: permanent

And rabbit at SCCS004LAB-sasl.log:

=CRASH REPORT==== 20-Mar-2013::10:05:47 ===
  crasher:
    initial call: os_mon_sysinfo:init/1
    pid: <0.67.0>
    registered_name: []
    exception exit: {enoent,
                        [{erlang,open_port,
                             [{spawn,
                                  "m:/Program Files/erl5.9.1/lib/os_mon-2.2.9/priv/bin/win32sysinfo.exe"},
                              [{packet,1}]],
                             []},
                         {os_mon,open_port,2,[{file,"os_mon.erl"},{line,88}]},
                         {os_mon_sysinfo,start_portprogram,0,
                             [{file,"os_mon_sysinfo.erl"},{line,111}]},
                         {os_mon_sysinfo,init,1,
                             [{file,"os_mon_sysinfo.erl"},{line,60}]},
                         {gen_server,init_it,6,
                             [{file,"gen_server.erl"},{line,304}]},
                         {proc_lib,init_p_do_apply,3,
                             [{file,"proc_lib.erl"},{line,227}]}]}
      in function  gen_server:init_it/6 (gen_server.erl, line 328)
    ancestors: [os_mon_sup,<0.65.0>]
    messages: []
    links: [<0.66.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 500
  neighbours:

=SUPERVISOR REPORT==== 20-Mar-2013::10:05:47 ===
     Supervisor: {local,os_mon_sup}
     Context:    start_error
     Reason:     {enoent,
                     [{erlang,open_port,
                          [{spawn,
                               "m:/Program Files/erl5.9.1/lib/os_mon-2.2.9/priv/bin/win32sysinfo.exe"},
                           [{packet,1}]],
                          []},
                      {os_mon,open_port,2,[{file,"os_mon.erl"},{line,88}]},
                      {os_mon_sysinfo,start_portprogram,0,
                          [{file,"os_mon_sysinfo.erl"},{line,111}]},
                      {os_mon_sysinfo,init,1,
                          [{file,"os_mon_sysinfo.erl"},{line,60}]},
                      {gen_server,init_it,6,
                          [{file,"gen_server.erl"},{line,304}]},
                      {proc_lib,init_p_do_apply,3,
                          [{file,"proc_lib.erl"},{line,227}]}]}
     Offender:   [{pid,undefined},
                  {name,os_mon_sysinfo},
                  {mfargs,{os_mon_sysinfo,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,2000},
                  {child_type,worker}]


Thanks, again!

From emile at rabbitmq.com  Wed Mar 20 14:43:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 20 Mar 2013 14:43:30 +0000
Subject: [rabbitmq-discuss] RabbitMQ crashes just after start...
In-Reply-To: <E07AC664B6693B4BA9410CE04AAFF673063FFC01C0@CRPMBX01.corp.cbeyond.net>
References: <E07AC664B6693B4BA9410CE04AAFF673063FF2DD04@CRPMBX01.corp.cbeyond.net>
	<51488C66.2040102@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FF2DEEA@CRPMBX01.corp.cbeyond.net>
	<51499945.5030605@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FF2EA06@CRPMBX01.corp.cbeyond.net>
	<5149BFE3.8080200@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FFC01C0@CRPMBX01.corp.cbeyond.net>
Message-ID: <5149CB12.8030509@rabbitmq.com>

On 20/03/13 14:13, David Buckingham wrote:
> No change.  I've copied the messages from the Rabbit log files below.
> Maybe they can offer some help, after all???

Um, yes. The logfiles normally contain the reason for errors. You should
consult them when you see errors.

> exception exit: {enoent, "m:/Program
> Files/erl5.9.1/lib/os_mon-2.2.9/priv/bin/win32sysinfo.exe"},

Does that file exist? If not then Make sure your ERLANG_HOME variable is
set correctly. If it does exist then the problem probably relates to the
NTFS 8.3 attributes for the VHD volume. Make sure 8.3 creation is not
disabled. See http://support.microsoft.com/kb/121007/en-us



-Emile








From simon at rabbitmq.com  Wed Mar 20 14:51:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Mar 2013 14:51:27 +0000
Subject: [rabbitmq-discuss] Autohealing
In-Reply-To: <4068397F2AF841309E33C78B0C88FE26@gmail.com>
References: <D3AB112462244459AE7D80BB5214D290@gmail.com>
	<51498FCF.5040306@rabbitmq.com>
	<4068397F2AF841309E33C78B0C88FE26@gmail.com>
Message-ID: <5149CCEF.7030000@rabbitmq.com>

On 20/03/13 11:57, Ben Hood wrote:
> A hand wavy alternative to electing a categorical winner would be to
> declare a tie on the partition or node level, and then kick off a
> process of fine grained reconciliation of the state between the nodes,
> such that having to make a political guess about who gets killed off is
> restricted to individual objects within the broker. That way you might
> be able to auto-reconcile and merge a good portion of the disconnected
> state.

Yeah, we've talked a bit about this; my initial thoughts about cluster 
healing were in that direction. But suppose we see partition A has a 
queue Q, and partition B does not - does that mean that it didn't exist 
before the partition and was created on partition A, or it did and was 
deleted on partition B? There are ways round that, but it gets messy 
quickly...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From bison_art at o2.pl  Wed Mar 20 15:49:38 2013
From: bison_art at o2.pl (rabbit15)
Date: Wed, 20 Mar 2013 08:49:38 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET channel Thread safe
In-Reply-To: <5149C0B0.2020905@rabbitmq.com>
References: <1363781418180-25594.post@n5.nabble.com>
	<5149C0B0.2020905@rabbitmq.com>
Message-ID: <1363794578511-25608.post@n5.nabble.com>

Thank you!
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/NET-channel-Thread-safe-tp25594p25608.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From eliao at seegrid.com  Wed Mar 20 16:02:16 2013
From: eliao at seegrid.com (Elizabeth Liao)
Date: Wed, 20 Mar 2013 16:02:16 +0000
Subject: [rabbitmq-discuss] socket_error
In-Reply-To: <5149ADE6.1060809@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD79038FEB810C3@vmexchange02.seegrid.local>,
	<5149ADE6.1060809@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD79038FEB8436A@vmexchange02.seegrid.local>

We are currently running on Fedora 11 and have not been able to figure out how to reproduce the issue.  The actual problem that we're chasing down is that our hard disks are getting hammered but we can't find the root cause.  We're essentially wondering if the errors are cause or effect.

We're currently testing v3.0.3 but it has not been subject to the same operating conditions as systems running with 2.8.6 and 2.8.7 yet.  Also, we're seeing these errors in configurations without the use of the shovel as well.

Liz

________________________________________
From: Emile Joubert [emile at rabbitmq.com]
Sent: Wednesday, March 20, 2013 8:38 AM
To: Discussions about RabbitMQ
Cc: Elizabeth Liao
Subject: Re: [rabbitmq-discuss] socket_error

Hi,

On 19/03/13 19:49, Elizabeth Liao wrote:

> We're seeing the following errors in the sasl logs on some of our
> systems. Any idea on what's going on?  We've seen this on both 2.8.6
> and 2.8.7 and running with and without a shovel configuration.  Also
> our machines are not clustered.

There have been potentially relevant improvements to the shovel in
v3.0.1 and v3.0.2. Are you able to check whether the problem can be
reproduced with the latest version of the plugin?

> {{badmatch,{error,{{socket_error,enomem},{expecting,'connection.start'}}}},

What operating system produced this error? Can you easily reproduce it?



-Emile
Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From richard at raseley.com  Wed Mar 20 16:05:25 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 20 Mar 2013 09:05:25 -0700
Subject: [rabbitmq-discuss] Federation with SSL Support
Message-ID: <CAO=6ox_0cNgGmcMgEkEzstwgDYdOnKnwp+oV3s1yuuya4iqPuA@mail.gmail.com>

I have been looking for detailed instructions on configuring federation
between two exchanges using SSL. I have found and understand both the
federation instructions and the SSL instructions but I haven't seen
anything that talks about using the two together.

Is it simply a matter of instantiating the federated link on the port
designated as being used for SSL?

Thank you in avance.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/f9686295/attachment.htm>

From hamsterready at gmail.com  Wed Mar 20 15:11:11 2013
From: hamsterready at gmail.com (Maciej Lopacinski)
Date: Wed, 20 Mar 2013 08:11:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Dead-Lettering Performance
Message-ID: <1ac86207-f897-47a6-bad5-ec9a9569d778@googlegroups.com>

Hi lads,

I am designing and implementing RabbitMQ-based solution which main 
requirement is around delayed delivery.

Main use case is:
 - I have message source which generates messages anytime during the day,
 - depending on message content - delay time is computed,
 - message expiration time is set (per message TTL, not x-message-ttl nor 
x-expires)
 - message dead-letter-routing-key is set and dead-letter-exchange is set 
(on queues: q60, q120, q180, ...)
 - based on delay time (60s, 120s, 180s, 240s, ...) message is routed to 
dedicated queue (q60, q120, q180, ...)



<https://lh6.googleusercontent.com/-H5t-FmvvlXg/UUnQHy9lOUI/AAAAAAAANsM/xI2R87Y1AS0/s1600/woof.png>












My question:
 - is it valid use of message expiration time?
 - are there any caveats around dead-lettering performance?
 - are there any guarantees around dead-lettering performance?
 - does dead-lettering has same "priority" as others "internal operations" 
in RabbitMQ broker?

Any comments would be great.

Cheers,
Maciej


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/87e42b9a/attachment.htm>

From tim at rabbitmq.com  Wed Mar 20 16:25:58 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 20 Mar 2013 16:25:58 +0000
Subject: [rabbitmq-discuss] Bring cluster up after node crash
In-Reply-To: <A674608A754C4DDB8CCD0643F9A192C2@gmail.com>
References: <A674608A754C4DDB8CCD0643F9A192C2@gmail.com>
Message-ID: <59E427F8-BE70-429B-873F-C6CE2632DCA4@rabbitmq.com>

Hi Carl,

What version of rabbit are you running? A number of bugs pertaining to the 'Discarding message ... in an old incarnation .. of this node' were fixed in recent(ish) releases.

Cheers,
Tim 

On 19 Mar 2013, at 03:41, Carl H?rberg wrote:

> Have a 3 node cluster, node 2 and 3 went down due to OOM, but node 1 survived, clients could push new messages but non were delivered, node 1 had plenty of memory left so no blocking were (or at least shouldn't have been) in action due to that.  
> 
> I then tried to bring node 2 and 3 back online by simply restarting them, this is what happened:  
> 
> Node1 floods the logs for a while at a rate of 20-100/sec:
> =ERROR REPORT==== 18-Mar-2013::07:10:40 ===
> Discarding message {'$gen_call',{<0.17965.1>,#Ref<0.0.1.90282>},stat} from <0.17965.1> to <0.5037.1> in an old incarnation (1) of this node (2)
> 
> Start up node 3
> Floods
> =ERROR REPORT==== 18-Mar-2013::08:23:15 ===
> Discarding message {'$gen_call',{<0.7609.0>,#Ref<0.0.1.142489>},stat} from <0.7609.0> to <0.25515.26> in an old incarnation (1) of this node (3)
> and is stuck at  
> "starting exchange, queue and binding recovery ..."
> 
> rabbitmqctl status hangs for ever on node 1
> 
> Start up node 2, starts fast, says "Broker started" in startup_log, but doesn't list the plugins, "service rabbitmq-server start" never returns and  rabbitmqctl status and  never returns
> 
> node 2 then runs out of memory again, without client connections this time:  
> =INFO REPORT==== 18-Mar-2013::09:09:35 ===
> vm_memory_high_watermark set. Memory used:7336394640 allowed:7031336140
> =WARNING REPORT==== 18-Mar-2013::09:09:35 ===
> memory resource limit alarm set on node rabbit at tiger02
> 
> Querying /api/overview at node1 gives:
> {error,{error,{badmatch,false},
> [{rabbit_mgmt_wm_overview,version,1},
> {rabbit_mgmt_wm_overview,to_json,2},
> {webmachine_resource,resource_call,3},
> {webmachine_resource,do,3},
> {webmachine_decision_core,resource_call,1},
> {webmachine_decision_core,decision,1},
> {webmachine_decision_core,handle_request,2},
> {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}}
> 
> node 3 starts eventually.  
> kills node 2, starts again, stops at "starting database ?"
> nothing in the log or startup_err, cpu usage 0%
> kills after 30min and starts again, same thing.  
> 
> node 3 can now output rabbitmqctl status, node 1 still cannot.
> node 1 can't be shutdown, force kills
> with node1 down, node 2 now comes pass "starting database" and starts
> neither node 2 or node 3 responds to rabbitmqctl status
> shutting down node 2, but doesn't respond, have to do kill -9
> node 3 still doesn't respond to rabbitmqctl status
> shutdowns node 3, doesnt respond, killing it instead, now all nodes are down.
> 
> note: When rabbitmqctl status doesnt work other stuff like list_users, cluster_status etc. works.  
> 
> Starting up node3, log now gets flooded with:
> =ERROR REPORT==== 18-Mar-2013::11:09:04 ===
> ** Generic server <0.629.0> terminating
> ** Last message in was {init,<0.182.0>}
> ** When Server state == {q,{amqqueue,
> {resource,<<"vhost1">>,queue,
> <<"tmp_topic-0.9934227485209703">>},
> true,true,<0.21310.24>,[],<0.629.0>,[],[],
> [{vhost,<<"vhost1">>},
> {name,<<"HA">>},
> {pattern,<<".*">>},
> {definition,[{<<"ha-mode">>,<<"all">>}]},
> {priority,0}],
> [{<6868.7071.0>,<6868.7070.0>},
> {<6867.19845.80>,<6867.19844.80>},
> {<0.21601.24>,<0.21548.24>}]},
> none,false,undefined,undefined,
> {[],[]},
> undefined,undefined,undefined,undefined,
> {state,fine,5000,undefined},
> {0,nil},
> undefined,undefined,undefined,
> {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []},
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []}}},
> 1,
> {{0,nil},{0,nil}},
> undefined,
> {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []},
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []}}},
> undefined,undefined}
> ** Reason for termination ==  
> ** {'module could not be loaded',
> [{undefined,init,
> [{amqqueue,
> {resource,<<"vhost1">>,queue,
> <<"tmp_topic-0.9934227485209703">>},
> true,true,<0.21310.24>,[],<0.629.0>,[],[],
> [{vhost,<<"vhost1">>},
> {name,<<"HA">>},
> {pattern,<<".*">>},
> {definition,[{<<"ha-mode">>,<<"all">>}]},
> {priority,0}],
> [{<6868.7071.0>,<6868.7070.0>},
> {<6867.19845.80>,<6867.19844.80>},
> {<0.21601.24>,<0.21548.24>}]},
> true,#Fun<rabbit_amqqueue_process.5.64830354>]},
> {rabbit_amqqueue_process,handle_call,3},
> {gen_server2,handle_msg,2},
> {proc_lib,wake_up,3}]}
> 
> but comes online eventually and can do "rabbitmqctl status"
> 
> starts up node2, also reports a lot of:
> =ERROR REPORT==== 18-Mar-2013::11:11:06 ===
> ** Generic server <0.640.0> terminating
> ** Last message in was {init,<0.152.0>}
> ** When Server state == {q,{amqqueue,
> {resource,<<"vhost1">>,queue,
> <<"tmp_topic-0.1019297200255096">>},
> true,true,<0.977.11>,[],<0.640.0>,[],[],
> undefined,[]},
> none,false,undefined,undefined,
> {[],[]},
> undefined,undefined,undefined,undefined,
> {state,fine,5000,undefined},
> {0,nil},
> undefined,undefined,undefined,
> {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []},
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []}}},
> 1,
> {{0,nil},{0,nil}},
> undefined,
> {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []},
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []}}},
> undefined,undefined}
> ** Reason for termination ==  
> ** {'module could not be loaded',
> [{undefined,init,
> [{amqqueue,
> {resource,<<"vhost1">>,queue,
> <<"tmp_topic-0.1019297200255096">>},
> true,true,<0.977.11>,[],<0.640.0>,[],[],undefined,[]},
> true,#Fun<rabbit_amqqueue_process.5.64830354>]},
> {rabbit_amqqueue_process,handle_call,3},
> {gen_server2,handle_msg,2},
> {proc_lib,wake_up,3}]}
> =ERROR REPORT==== 18-Mar-2013::11:11:06 ===
> ** Generic server <0.645.0> terminating
> ** Last message in was {init,<0.152.0>}
> ** When Server state == {q,{amqqueue,
> {resource,<<"vhost1">>,queue,
> <<"tmp_topic-0.8794151877518743">>},
> true,true,<0.30538.0>,[],<0.645.0>,[],[],
> [{vhost,<<"vhost1">>},
> {name,<<"HA">>},
> {pattern,<<".*">>},
> {definition,[{<<"ha-mode">>,<<"all">>}]},
> {priority,0}],
> [{<6872.28270.5>,<6872.28269.5>},
> {<0.32304.1>,<0.30804.0>}]},
> none,false,undefined,undefined,
> {[],[]},
> undefined,undefined,undefined,undefined,
> {state,fine,5000,undefined},
> {0,nil},
> undefined,undefined,undefined,
> {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []},
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []}}},
> 1,
> {{0,nil},{0,nil}},
> undefined,
> {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []},
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> []}}},
> undefined,undefined}
> ** Reason for termination ==  
> ** {'module could not be loaded',
> [{undefined,init,
> [{amqqueue,
> {resource,<<"vhost1">>,queue,
> <<"tmp_topic-0.8794151877518743">>},
> true,true,<0.30538.0>,[],<0.645.0>,[],[],
> [{vhost,<<"vhost1">>},
> {name,<<"HA">>},
> {pattern,<<".*">>},
> {definition,[{<<"ha-mode">>,<<"all">>}]},
> {priority,0}],
> [{<6872.28270.5>,<6872.28269.5>},{<0.32304.1>,<0.30804.0>}]},
> true,#Fun<rabbit_amqqueue_process.5.64830354>]},
> {rabbit_amqqueue_process,handle_call,3},
> {gen_server2,handle_msg,2},
> {proc_lib,wake_up,3}]}
> 
> node 2 comes online i can now query rabbitmqctl status
> starting up node 1, comes online
> the cluster is now working again but several durables queues are gone(!)
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alan.antonuk at gmail.com  Wed Mar 20 16:41:30 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 20 Mar 2013 09:41:30 -0700
Subject: [rabbitmq-discuss] RabbitMQ Consumer stops responding after
	some time
In-Reply-To: <4F674C32-853E-4024-9937-B3273777E83F@rabbitmq.com>
References: <CAMGaxfihTYsYaiJgWG170y74_7t9gO6moZmkLvwoowULi-8d6w@mail.gmail.com>
	<130E5FD7-BEBD-4659-BE55-A230C217FD66@rabbitmq.com>
	<CAMGaxfgpqBKEB_ongySP4Te3d4HUUsR_aQpHJ_g8iJkPDTREbw@mail.gmail.com>
	<4F674C32-853E-4024-9937-B3273777E83F@rabbitmq.com>
Message-ID: <CAAt2po+jkBjRGmis_KW=UNRLiiaMc_5zCOcFQ3tadyV0ehcB_Q@mail.gmail.com>

rabbitmq-c does support publisher confirms.  (they can be enabled with
amqp_confirm_select() on a per-channel basis)/

rabbitmq-c has partial support for AMQP heartbeats. The library understands
heartbeats from an AMQP protocol level, and can properly send and receive
heartbeat frames, however rabbitmq-c does not provide an event loop to send
and receive these heartbeat frames, it is up to the application to provide
that logic.

-Alan



On Tue, Mar 19, 2013 at 3:05 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi,
>
> On 19 Mar 2013, at 09:54, VIKALP HANDA wrote:
> > The messages are not arriving at the queue though being sent by the
> producer. That means, no messages no processing. I think it might be the
> case of peer connection being closed. Is there any parameter or something
> that sets the connection timeout? I am using rabbitmq version 3.0.3.
> >
>
> Connection timeouts are mostly determined by the underlying TCP stack and
> operating system configuration. If you have sent a message and it is not
> arriving at the queue, can you see it arriving at the exchange it is being
> sent to? If it *does* arrive at the exchange, this is probably indicative
> of an error in your bindings (between the published-to exchange and the
> queue from which you wish to receive messages sent to that exchange). If it
> does *not* arrive at the exchange, then you should check that the network
> link is established and working at the time of sending. There are various
> ways to do this, but a simple mechanism to ensure messages arrive is to
> enable publisher confirms (see http://rabbitmq.com/confirms.html for
> details) which will ensure that the brokers sends an ACK for each message
> it has taken responsibility for - the reliability guide (
> http://www.rabbitmq.com/reliability.html) has some more information about
> this too.
>
> I have no idea if the amqp-c client has any support for publisher
> confirms. If it does not, then you can verify the state of the
> connection(s) using the management plugin and/or a tool such as wireshark.
> You can also use the firehose tracer (
> http://www.rabbitmq.com/firehose.html) to trace message routing through
> your topology.
>
> Cheers,
> Tim
>
> >
> > On Tue, Mar 19, 2013 at 2:57 PM, Tim Watson <tim at rabbitmq.com> wrote:
> > Hi,
> >
> > On 19 Mar 2013, at 08:36, VIKALP HANDA wrote:
> > > Actually I am new to Rabbitmq and am using amqp-c client as a base for
> my C++ wrapper.
> > > I have created a consumer which stops responding after some time as
> well as after bulk of messages being sent to it.
> >
> > What does 'stops responding' actually mean? Does the consumer cease
> processing messages (when there are still un-acked messages in the queue(s)
> it is consuming from) or is the problem something else.
> >
> > > I have heartbeat count =0 and in the management plugin view its
> showing that the connections are still live.
> >
> > Just because the server still sees a connection, doesn't mean that the
> physical network link remains - operating systems can take 'quite some
> time' to notice unresponsive peers. Also, I didn't realise that the amqp-c
> client had support for heartbeats? Perhaps the maintainer can clear that up
> though, as it's quite possible it does but I've simply forgotten.
> >
> > > Could you please help me  in rectifying the issue.
> > >
> >
> > We'll do our best to help. If you could clarify what specific (and
> unexpected) behaviour your seeing in the consumer, then we'll take it from
> there.
> >
> > Cheers!
> > Tim
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > <Rabbitmq.png>_______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/0307a818/attachment.htm>

From emile at rabbitmq.com  Wed Mar 20 16:43:02 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 20 Mar 2013 16:43:02 +0000
Subject: [rabbitmq-discuss] socket_error
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038FEB8436A@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD79038FEB810C3@vmexchange02.seegrid.local>,
	<5149ADE6.1060809@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038FEB8436A@vmexchange02.seegrid.local>
Message-ID: <5149E716.10601@rabbitmq.com>


Hi,

On 20/03/13 16:02, Elizabeth Liao wrote:
> We are currently running on Fedora 11 and have not been able to
> figure out how to reproduce the issue.  The actual problem that we're
> chasing down is that our hard disks are getting hammered but we can't
> find the root cause.  We're essentially wondering if the errors are
> cause or effect.

The {socket_error,enomem} error relates to networking rather than disk.
I would be surprised if this was the cause of disk use.

I've not come across the same error, but it would seem to indicate
resource exhaustion of some kind in the network stack.

If you are not using the latest version of Erlang (R16B at the time of
writing) then try upgrading.

You could also check with a network analyser whether the broker is
exposed to network traffic with unusually large TCP packets.

The only other suggestion is to make sure all your TCP/IP kernel
parameters are set to sane values, or to try more conservative values.
You will need to refer to your OS documentation.

If you do discover a way of reproducing the problem then please get back
to us.



-Emile





From fearsome.lucidity at gmail.com  Wed Mar 20 17:37:07 2013
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Wed, 20 Mar 2013 10:37:07 -0700
Subject: [rabbitmq-discuss] Scaling Throughput with Highly Available
	Queues
Message-ID: <CAFDmHdO8KCBEf-17YzHTbN8aN_0L=3aemwnh6q9V_XFTUtXG0g@mail.gmail.com>

On Wed, Mar 20, 2013 at 5:00 AM, <
rabbitmq-discuss-request at lists.rabbitmq.com> wrote:

>
> > 2) Ensure that the master queue processes are spread out evenly across
> > the available nodes.
>
> ...in combination with ensuring that there are no more mirrors than you
> actually need in order to get the desired level of redundancy. I.e. use
> the 'exactly' ha-mode rather than 'all'. Otherwise you are wasting
> valuable resources on keeping superfluous slaves up to date.
>
>
It would be useful to automate the intelligent placement of queue mirrors
for such multi-queue set ups so that related HA queues are spread across
nodes in the cluster while minimizing their overlap.

You could add an argument to queue declaration that is a queue meta-name.
 Related queues would share the same meta-name.  E.g. if you wanted to
created HA queues using the "exactly" ha-mode named incoming1 and
incoming2, you could use a meta-name of "incoming".  RMQ would then attempt
to place the mirrors on different nodes.  E.g. in a four node cluster with
exactly == 2, it would place one mirrors on each node without any overlap.

As it is, I don't believe exactly provides any guarantee as to where
mirrors will be located, so the mirrors of your two queues could be placed
on the same nodes creating hot spots.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/7cc82c51/attachment.htm>

From emile at rabbitmq.com  Wed Mar 20 17:40:55 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 20 Mar 2013 17:40:55 +0000
Subject: [rabbitmq-discuss] socket_error
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038FEB810C3@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD79038FEB810C3@vmexchange02.seegrid.local>
Message-ID: <5149F4A7.6090903@rabbitmq.com>


Hi Elizabeth,

On 19/03/13 19:49, Elizabeth Liao wrote:
> ** When Server state == {state,#Port<0.141701>,<0.7764.12>,<0.7766.12>,
>                                {method,rabbit_framing_amqp_0_9_1},
>                                {65,19793,1342243080}}
Having looked at this in more detail we have a better hypothesis for
what's happening. You are probably connecting to a pre v2.0.0 version of
the broker supporting only AMQP 0.8. The older broker reports that it
does not understand AMQP 0.9.1. Its response is misinterpreted by the
shovel and goes on to cause framing errors and a request to allocate too
much memory.

I will file a bug so that the shovel interprets the response from old
brokers correctly. This will lead to a more intelligible error message.
There is no way of downgrading the shovel to AMQP 0.8, so the solution
is for you to upgrade the AMQP 0.8 broker to at least v2.0.0.

If you are trying to extract messages from an old broker without
upgrading then you may be able to do that with a modern .net client or a
pre v2.0.0 Java client. See
http://www.rabbitmq.com/specification.html for the compatibility matrix.



-Emile







From tim at rabbitmq.com  Wed Mar 20 18:03:45 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 20 Mar 2013 18:03:45 +0000
Subject: [rabbitmq-discuss] Bring cluster up after node crash
In-Reply-To: <59E427F8-BE70-429B-873F-C6CE2632DCA4@rabbitmq.com>
References: <A674608A754C4DDB8CCD0643F9A192C2@gmail.com>
	<59E427F8-BE70-429B-873F-C6CE2632DCA4@rabbitmq.com>
Message-ID: <C2115F08-6BB0-413A-A4CF-A81CFC7D97DD@rabbitmq.com>

Hi Carl,

On 20 Mar 2013, at 16:25, Tim Watson wrote:
> What version of rabbit are you running? A number of bugs pertaining to the 'Discarding message ... in an old incarnation .. of this node' were fixed in recent(ish) releases.
> 

And another couple of questions if that's ok. Firstly - how did you install RabbitMQ on each of these nodes? It's possible one or more installs is corrupted somehow - have you made any modifications to the installs? What does the config look like for each of the nodes?  

> On 19 Mar 2013, at 03:41, Carl H?rberg wrote:
>> Node1 floods the logs for a while at a rate of 20-100/sec:
>> =ERROR REPORT==== 18-Mar-2013::07:10:40 ===
>> Discarding message {'$gen_call',{<0.17965.1>,#Ref<0.0.1.90282>},stat} from <0.17965.1> to <0.5037.1> in an old incarnation (1) of this node (2)
>> 
>> Start up node 3
>> Floods
>> =ERROR REPORT==== 18-Mar-2013::08:23:15 ===
>> Discarding message {'$gen_call',{<0.7609.0>,#Ref<0.0.1.142489>},stat} from <0.7609.0> to <0.25515.26> in an old incarnation (1) of this node (3)
>> and is stuck at  
>> "starting exchange, queue and binding recovery ..."
>> 

This 'old incarnation of ... ' stuff indicates that we have a process id for a queue that is no longer valid. In theory, the only way (I can see) for this to happen is if a queue master restarts faster than any of the slaves can detect it's death (we have an outstanding bug to look at that, but it may not be relevant since recent releases have included several HA bug fixes) - but regardless, that kind of problem ought to present far earlier than the 'stat' request that's failing...

>> Start up node 2, starts fast, says "Broker started" in startup_log, but doesn't list the plugins, "service rabbitmq-server start" never returns and  rabbitmqctl status and  never returns
>> 

That sounds suspicious - are you sure the enabled-plugins file and configuration for that node are intact?

>> node 2 then runs out of memory again, without client connections this time:  
>> =INFO REPORT==== 18-Mar-2013::09:09:35 ===
>> vm_memory_high_watermark set. Memory used:7336394640 allowed:7031336140
>> =WARNING REPORT==== 18-Mar-2013::09:09:35 ===
>> memory resource limit alarm set on node rabbit at tiger02
>> 

Is this happening whilst node 1 is still stuck? How long does it take (roughly) to reach this state?

>> Querying /api/overview at node1 gives:
>> {error,{error,{badmatch,false},
>> [{rabbit_mgmt_wm_overview,version,1},
>> {rabbit_mgmt_wm_overview,to_json,2},
>> {webmachine_resource,resource_call,3},
>> {webmachine_resource,do,3},
>> {webmachine_decision_core,resource_call,1},
>> {webmachine_decision_core,decision,1},
>> {webmachine_decision_core,handle_request,2},
>> {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}}
>> 

What version of Erlang are you running? Upgrading to a recent version of Erlang would be a good idea due to bug fixes and the fact that line numbers in exception stack traces would make it easier to identify where things are going wrong.

For that matter, what OS/Platform are you running on? How did you install Erlang?

>> node 3 starts eventually.  
>> kills node 2, starts again, stops at "starting database ?"

What do you mean 'kills node 2' exactly? A node will never kill another node. Do you mean that 'you' killed node 2? If so, how did you do this?

>> nothing in the log or startup_err, cpu usage 0%
>> kills after 30min and starts again, same thing.  
>> 

Again, what do you mean 'kills after 30min and starts again' - is this something you're doing? How are you 'killing' these nodes?

>> node 3 can now output rabbitmqctl status, node 1 still cannot.
>> node 1 can't be shutdown, force kills

Right - so at this point you've done something like `kill -9` right?

>> with node1 down, node 2 now comes pass "starting database" and starts
>> neither node 2 or node 3 responds to rabbitmqctl status

For how long do they not respond? I wonder if it could be that all these 'kill' signals you're issuing have left the mnesia database in an inconsistent state somehow.

>> shutting down node 2, but doesn't respond, have to do kill -9

'shutting down node 2' how - are you issuing `sudo rabbitmqctl stop` to do that?

>> node 3 still doesn't respond to rabbitmqctl status
>> shutdowns node 3, doesnt respond, killing it instead, now all nodes are down.
>> 

The same approach right?

>> note: When rabbitmqctl status doesnt work other stuff like list_users, cluster_status etc. works.  
>> 

Sounds like a process is stuck somewhere - the status call attempts to list all running erlang applications on the node, with the timeout set to 'infinity'. If an application has got stuck during startup (or shutdown!) that can be one of the symptoms. Again, please tell us which version of rabbit you're running. We've fixed bugs in (relatively) recent releases that presented as supervision trees getting stuck during shutdown/restart, which might (possibly) explain some of this.

>> Starting up node3, log now gets flooded with:
>> =ERROR REPORT==== 18-Mar-2013::11:09:04 ===
>> ** Generic server <0.629.0> terminating
>> ** Last message in was {init,<0.182.0>}
>> ** When Server state == {q,{amqqueue,
[snip]
>> ** Reason for termination ==  
>> ** {'module could not be loaded',
>> [{undefined,init,
[snip]

This error has occurred because the backing queue module for the queue process is set to 'undefined' - have you made any configuration changes, such as setting the name of the backing queue module by any chance?

Please let us know the answers to these queries and we'll try to figure out what's going on.

Cheers,
Tim

 

From David.Buckingham at cbeyond.net  Wed Mar 20 18:10:25 2013
From: David.Buckingham at cbeyond.net (David Buckingham)
Date: Wed, 20 Mar 2013 14:10:25 -0400
Subject: [rabbitmq-discuss] RabbitMQ crashes just after start...
In-Reply-To: <5149CB12.8030509@rabbitmq.com>
References: <E07AC664B6693B4BA9410CE04AAFF673063FF2DD04@CRPMBX01.corp.cbeyond.net>
	<51488C66.2040102@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FF2DEEA@CRPMBX01.corp.cbeyond.net>
	<51499945.5030605@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FF2EA06@CRPMBX01.corp.cbeyond.net>
	<5149BFE3.8080200@rabbitmq.com>
	<E07AC664B6693B4BA9410CE04AAFF673063FFC01C0@CRPMBX01.corp.cbeyond.net>
	<5149CB12.8030509@rabbitmq.com>
Message-ID: <E07AC664B6693B4BA9410CE04AAFF673063FFC08DB@CRPMBX01.corp.cbeyond.net>

> Does that file exist? If not then Make sure your ERLANG_HOME variable is
> set correctly. If it does exist then the problem probably relates to the NTFS
> 8.3 attributes for the VHD volume. Make sure 8.3 creation is not disabled.
> See http://support.microsoft.com/kb/121007/en-us

Fantastic!

The file did exist, and your link to the support article helped me to determine that 8.3 file naming was indeed disabled on the VM in question!  I compared the settings with the VM running the known working configuration, and sure enough the settings were opposite!

After enabling the 8.3 on this particular volume, I had to uninstall Erlang and RabbitMQ, and then delete the entire folder structure where they were installed (M:\Program Files\... and M:\Program Files (x86)\...)  No big deal, as these are the only apps installed on this volume.

Then, after re-installing both Erlang and RabbitMQ I found that the RabbitMQ service was indeed running!

Thank you so much for your help!  I would have never have found this.

From richmiller167 at gmail.com  Wed Mar 20 17:40:27 2013
From: richmiller167 at gmail.com (Rich Miller)
Date: Wed, 20 Mar 2013 10:40:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Connecting to RabbitMQ on Windows Server Using
 Wildcard Cert with .NET Client Using SSL
Message-ID: <d1e237d1-fdbe-47af-9772-eef3111c6a20@googlegroups.com>

The title pretty much says it all. I'm trying quite unsuccessfully to get 
to a RabbitMQ server running as a service on Windows Server 2008 R2 using a 
.NET client.  Server is using a wildcard certificate issued by GeoTrust. 
 GeoTrust is listed in my Trusted Root Certificate Authorities on the 
client box.  I'm simply trying to set up an SSL connection between the 
client and the server, not trying to authenticate using a certificate. 
 I've read the docs on the RabbitMQ website and several other blog posts 
about setting this up, but I've had no success.

Typical error messages reported by the client include "Authentication 
failed because the remote party has closed the transport stream" and 
"Cannot find the requested object" (after trying to pass a .key file in as 
the cert file).

RabbitMQ Server is 2.7.1 and Erlang is R15B03-1.  Client code looks 
basically like this:

            ' configure the connection factory
            Me.Factory.HostName = hostName
            Me.Factory.VirtualHost = virtualHostName
            Me.Factory.UserName = userName
            Me.Factory.Password = password
            Me.Factory.Protocol = Protocols.AMQP_0_9_1
            Me.Factory.Port = AmqpTcpEndpoint.DefaultAmqpSslPort
            Me.Factory.Ssl.ServerName = hostName
            Me.Factory.Ssl.CertPath = 
"C:\Gravic\Development\TestRabbitMQSSL\TestRabbitMQSSL\bin\Debug\Clientcert.pfx"
            Me.Factory.Ssl.CertPassphrase = "thepassphrase"
            Me.Factory.Ssl.Enabled = True

            ' create the connection using the factory
            Return Me.Factory.CreateConnection()

I'd appreciate any tips or pointers from anyone who has successfully made 
the SSL connection from .NET client to RabbitMQ server running on Windows.

Thanks!

Rich
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/057fb7f2/attachment.htm>

From reddylast at gmail.com  Wed Mar 20 19:39:35 2013
From: reddylast at gmail.com (reddylast)
Date: Wed, 20 Mar 2013 12:39:35 -0700 (PDT)
Subject: [rabbitmq-discuss] MYSQL not getting disconnected Consumer
Message-ID: <1363808375050-25619.post@n5.nabble.com>

Hi,

I've recently started to work on RabbitMQ. I'm using rabbitmq to fulfill
cronjob like mechanism. I have a jobs table (in mysql) which have fields :
id, status, category, start_time and end_time. The producer script reads all
the records from jobs table which have status='queued' and then push them to
multiple rabbitmq queues (according to the category). Now at consumer site
my script read those jobs from the rabbitmq queues and do some processing
and updates status='in-progress' and start_time=CURRENT_TIME() in DB. Once
consumer script finish all processing the jobs table is updated with
status='completed' and end_time=CURRENT_TIME and also sends acknowledgment.

So far everything works fine, but, one thing I've noticed is that consumer
script never kills mysql threads/processes, even if I close mysql connection
after executing each query. In this way it generate "too many connections"
error.

In Idea ? where is the exact problem exits ?

Thanks
Reddy



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/MYSQL-not-getting-disconnected-Consumer-tp25619.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From richmiller167 at gmail.com  Wed Mar 20 21:04:09 2013
From: richmiller167 at gmail.com (Rich Miller)
Date: Wed, 20 Mar 2013 14:04:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Connecting to RabbitMQ on Windows Server
 Using Wildcard Cert with .NET Client Using SSL
In-Reply-To: <d1e237d1-fdbe-47af-9772-eef3111c6a20@googlegroups.com>
References: <d1e237d1-fdbe-47af-9772-eef3111c6a20@googlegroups.com>
Message-ID: <c6686834-145e-4e08-bbe3-579056e6948d@googlegroups.com>

We were successful in getting the SSL communications between our .NET 
client and RabbitMQ working by following the steps described on the 
RabbitMQ website to use OpenSSL to self-generate certificates and keys.  We 
will be spending a bit more time researching how we can incorporate our 
wildcard certificate at some point, but I don't believe our requirements 
will be broken if we go to production with the self-generated certificate, 
as this server is non-Internet-facing.  I'd be happy to share some of our 
experiences and what we discovered if anyone needs any information.

Thanks.

Rich

On Wednesday, March 20, 2013 1:40:27 PM UTC-4, Rich Miller wrote:
>
> The title pretty much says it all. I'm trying quite unsuccessfully to get 
> to a RabbitMQ server running as a service on Windows Server 2008 R2 using a 
> .NET client.  Server is using a wildcard certificate issued by GeoTrust. 
>  GeoTrust is listed in my Trusted Root Certificate Authorities on the 
> client box.  I'm simply trying to set up an SSL connection between the 
> client and the server, not trying to authenticate using a certificate. 
>  I've read the docs on the RabbitMQ website and several other blog posts 
> about setting this up, but I've had no success.
>
> Typical error messages reported by the client include "Authentication 
> failed because the remote party has closed the transport stream" and 
> "Cannot find the requested object" (after trying to pass a .key file in as 
> the cert file).
>
> RabbitMQ Server is 2.7.1 and Erlang is R15B03-1.  Client code looks 
> basically like this:
>
>             ' configure the connection factory
>             Me.Factory.HostName = hostName
>             Me.Factory.VirtualHost = virtualHostName
>             Me.Factory.UserName = userName
>             Me.Factory.Password = password
>             Me.Factory.Protocol = Protocols.AMQP_0_9_1
>             Me.Factory.Port = AmqpTcpEndpoint.DefaultAmqpSslPort
>             Me.Factory.Ssl.ServerName = hostName
>             Me.Factory.Ssl.CertPath = 
> "C:\Gravic\Development\TestRabbitMQSSL\TestRabbitMQSSL\bin\Debug\Clientcert.pfx"
>             Me.Factory.Ssl.CertPassphrase = "thepassphrase"
>             Me.Factory.Ssl.Enabled = True
>
>             ' create the connection using the factory
>             Return Me.Factory.CreateConnection()
>
> I'd appreciate any tips or pointers from anyone who has successfully made 
> the SSL connection from .NET client to RabbitMQ server running on Windows.
>
> Thanks!
>
> Rich
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/64021d19/attachment.htm>

From jdamon at gmail.com  Wed Mar 20 22:02:18 2013
From: jdamon at gmail.com (James Damon)
Date: Wed, 20 Mar 2013 15:02:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Does  rabbitmqadmin have any issues using SSL
Message-ID: <a0631bca-709f-4d80-a930-87151a978353@googlegroups.com>

Hi ,

So, I'm setting up my server to accept connections using SSL. My dilemma is 
that I can connect to the server just fine using the following ruby script.

===============
#!/usr/bin/ruby
require 'rubygems'
require 'amqp'

AMQP.start(:port => 5671, 
           :ssl => { 
             :cert_chain_file => "clientcert1.pem", 
             :private_key_file => "key1.pem"}
           ) do |con| 
  puts "ok"
  con.disconnect { puts "dont need to continue"; EventMachine.stop }
end


However, I want to use the existing rabbitmqadmin script to connect because 
I just want to insert simple JSON messages without writing my own code.

When I run rabbitmqadmin from the command line I get the same error: 

STDERR
========
Traceback (most recent call last):
  File "/home/jdamon/Scripts/rabbitmqadmin", line 914, in <module>
    main()
  File "/home/jdamon/Scripts/rabbitmqadmin", line 354, in main
    method()
  File "/home/jdamon/Scripts/rabbitmqadmin", line 496, in invoke_list
    format_list(self.get(uri), cols, obj_info, self.options)
  File "/home/jdamon/Scripts/rabbitmqadmin", line 612, in format_list
    formatter_instance.display(json_list)
  File "/home/jdamon/Scripts/rabbitmqadmin", line 623, in display
    (columns, table) = self.list_to_table(json.loads(json_list), depth)
  File "/usr/lib/python2.7/json/__init__.py", line 326, in loads
    return _default_decoder.decode(s)
  File "/usr/lib/python2.7/json/decoder.py", line 366, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
  File "/usr/lib/python2.7/json/decoder.py", line 384, in raw_decode
    raise ValueError("No JSON object could be decoded")
ValueError: No JSON object could be decoded


rabbitmq at server.log
=================
=INFO REPORT==== 20-Mar-2013::14:56:42 ===
accepting AMQP connection <0.2781.0> ([::1]:59661 -> [::1]:5671)

=ERROR REPORT==== 20-Mar-2013::14:56:42 ===
closing AMQP connection <0.2781.0> ([::1]:59661 -> [::1]:5671):
{bad_header,<<"GET /api">>}



The command I used to generate these errors was 

rabbitmqadmin -P 5671 --ssl  --ssl-key-file $SOME_PATH/key1.pem 
--ssl-cert-file=$SOME_PATH/clientcert1.pem  list users

or 

rabbitmqadmin -c rabbitmqadmin.conf -N host_ssl list queues

where

rabbitmqadmin.conf
===================
[host_normal]
hostname = localhost
port = 15672
username = guest
password = guest
declare_vhost = / # Used as default for declare / delete only
vhost = /         # Used as default for declare / delete / list

[host_ssl]
hostname = localhost
port = 5671
username = guest
password = guest
ssl = True
ssl_key_file = $SOME_PATH/key1.pem
ssl_cert_file = $SOME_PATH/clientcert1.pem



Anyone have any ideas why I can't connect to SSL using rabbitmqadmin ? Has 
anyone else been able to connect correctly using Rabbitmqadmin to the SSL 
port ? 


Thanks

-Jimi











-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/28e3c020/attachment.htm>

From abiramipattar at gmail.com  Thu Mar 21 06:37:25 2013
From: abiramipattar at gmail.com (Sankarasubramanian Subramanian)
Date: Wed, 20 Mar 2013 23:37:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Issue Starting RabbitMQ service
Message-ID: <b3f2f033-f509-4baf-b659-4fece1e48423@googlegroups.com>

Hi All,

   I have a problem starting the rabbitMQ service. Please find below the 
error. Any idea why this could be happening? But, when i start the RabbitMQ 
server from the command-line, it works without any problems. I have changed 
the actual IP address to xx.xx.xx.xx

BOOT FAILED
===========

Error description:
   {could_not_start,rabbit,
    {bad_return,
     {{rabbit,start,[normal,[]]},
      {'EXIT',
       {rabbit,failure_during_boot,
        {case_clause,
         {error,
          {{shutdown,
            {failed_to_start_child,tcp_listener,
             {could_not_start_server,inet_gethost_native}}},
           {child,undefined,'rabbit_tcp_listener_sup_xx.xx.xx.xx:5677',
            {tcp_listener_sup,start_link,
             [{xx,xx,xx,xx},
              5677,
              [inet,binary,
               {packet,raw},
               {reuseaddr,true},
               {backlog,128},
               {nodelay,true},
               {linger,{true,0}},
               {exit_on_close,false}],
              {rabbit_networking,tcp_listener_started,[amqp]},
              {rabbit_networking,tcp_listener_stopped,[amqp]},
              {rabbit_networking,start_client,[]},
              "TCP Listener"]},
            transient,infinity,supervisor,
            [tcp_listener_sup]}}}}}}}}}

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130320/b4e1f562/attachment.htm>

From tim at rabbitmq.com  Thu Mar 21 09:31:35 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 21 Mar 2013 09:31:35 +0000
Subject: [rabbitmq-discuss] MYSQL not getting disconnected Consumer
In-Reply-To: <1363808375050-25619.post@n5.nabble.com>
References: <1363808375050-25619.post@n5.nabble.com>
Message-ID: <636D6819-9660-4429-A1A9-926FF2013BF7@rabbitmq.com>

Hi,

On 20 Mar 2013, at 19:39, reddylast wrote:
> So far everything works fine, but, one thing I've noticed is that consumer
> script never kills mysql threads/processes, even if I close mysql connection
> after executing each query. In this way it generate "too many connections"
> error.
> 
> In Idea ? where is the exact problem exits ?
> 

I can hazard a guess that the problem is in the consumer script and has something to do with not releasing MySQL connections properly. I can't imagine that you'll find what you're after on the RabbitMQ mailing list though - I'd suggest trying the MySQL support forums or Stack Overflow instead.

Best of luck!

Cheers,
Tim

From tim at rabbitmq.com  Thu Mar 21 09:36:58 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 21 Mar 2013 09:36:58 +0000
Subject: [rabbitmq-discuss] Does rabbitmqadmin have any issues using SSL
In-Reply-To: <a0631bca-709f-4d80-a930-87151a978353@googlegroups.com>
References: <a0631bca-709f-4d80-a930-87151a978353@googlegroups.com>
Message-ID: <4CC3ABF7-9F67-446A-AF26-25B12151300C@rabbitmq.com>

Hi James,

On 20 Mar 2013, at 22:02, James Damon wrote:
> So, I'm setting up my server to accept connections using SSL. My dilemma is that I can connect to the server just fine using the following ruby script.

The reason for that is in the following line...

> AMQP.start(:port => 5671, 
> 

This is making an AMQP connection, rather than an HTTP connection to the management web API.

> However, I want to use the existing rabbitmqadmin script to connect because I just want to insert simple JSON messages without writing my own code.
> 

In that case you'll need to point the rabbitmqadmin script to a port that is listening for SSL connections.

> When I run rabbitmqadmin from the command line I get the same error: 
[snip]
> rabbitmq at server.log
> =================
> =INFO REPORT==== 20-Mar-2013::14:56:42 ===
> accepting AMQP connection <0.2781.0> ([::1]:59661 -> [::1]:5671)
> 

As you can see, the broker thinks that this is an AMQP connection (as it's connecting to an AMQP port).

> =ERROR REPORT==== 20-Mar-2013::14:56:42 ===
> closing AMQP connection <0.2781.0> ([::1]:59661 -> [::1]:5671):
> {bad_header,<<"GET /api">>}
> 

Likewise, the HTTP protocol isn't understood by an AMQP protocol handler.

> [host_ssl]
> hostname = localhost
> port = 5671
> username = guest
> password = guest
> ssl = True
> ssl_key_file = $SOME_PATH/key1.pem
> ssl_cert_file = $SOME_PATH/clientcert1.pem
> 

You'll need to change that ssl port to an HTTP one, and you'll need to configure the management web API to enable ssl and listen on an available port. See http://www.rabbitmq.com/mochiweb.html for details. HTH!

Cheers,
Tim



From tim at rabbitmq.com  Thu Mar 21 09:58:51 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 21 Mar 2013 09:58:51 +0000
Subject: [rabbitmq-discuss] Federation with SSL Support
In-Reply-To: <CAO=6ox_0cNgGmcMgEkEzstwgDYdOnKnwp+oV3s1yuuya4iqPuA@mail.gmail.com>
References: <CAO=6ox_0cNgGmcMgEkEzstwgDYdOnKnwp+oV3s1yuuya4iqPuA@mail.gmail.com>
Message-ID: <213B80C6-5B20-4035-9A45-0B2830BBD3CB@rabbitmq.com>

Hi Richard,

Sorry for the delay!

On 20 Mar 2013, at 16:05, Richard Raseley wrote:
> Is it simply a matter of instantiating the federated link on the port designated as being used for SSL?
> 

Yes, exactly. Just specify the SSL port in the URI and you're done. :) 

Cheers,
Tim



From watson.timothy at gmail.com  Thu Mar 21 11:34:17 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 21 Mar 2013 11:34:17 +0000
Subject: [rabbitmq-discuss] Issue Starting RabbitMQ service
In-Reply-To: <b3f2f033-f509-4baf-b659-4fece1e48423@googlegroups.com>
References: <b3f2f033-f509-4baf-b659-4fece1e48423@googlegroups.com>
Message-ID: <347D872A-080B-4AE4-AACE-03AC14199491@rabbitmq.com>

Hi

On 21 Mar 2013, at 06:37, Sankarasubramanian Subramanian <abiramipattar at gmail.com> wrote:
> 
>    I have a problem starting the rabbitMQ service.

What platform/os are you on?

> But, when i start the RabbitMQ server from the command-line, it works without any problems.

Is this a windows machine then? How're you starting/stopping the service in that case?

> I have changed the actual IP address to xx.xx.xx.xx
> 
> BOOT FAILED
> ===========
> 
> Error description:
>    {could_not_start,rabbit,
>     {bad_return,
>      {{rabbit,start,[normal,[]]},
>       {'EXIT',
>        {rabbit,failure_during_boot,
>         {case_clause,
>          {error,
>           {{shutdown,
>             {failed_to_start_child,tcp_listener,
>              {could_not_start_server,inet_gethost_native}}},
>            {child,undefined,'rabbit_tcp_listener_sup_xx.xx.xx.xx:5677',
>             {tcp_listener_sup,start_link,
>              [{xx,xx,xx,xx},
>               5677,
>               [inet,binary,
>                {packet,raw},
>                {reuseaddr,true},
>                {backlog,128},
>                {nodelay,true},
>                {linger,{true,0}},
>                {exit_on_close,false}],
>               {rabbit_networking,tcp_listener_started,[amqp]},
>               {rabbit_networking,tcp_listener_stopped,[amqp]},
>               {rabbit_networking,start_client,[]},
>               "TCP Listener"]},
>             transient,infinity,supervisor,
>             [tcp_listener_sup]}}}}}}}}}
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Thu Mar 21 11:38:33 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 21 Mar 2013 11:38:33 +0000
Subject: [rabbitmq-discuss] Issue Starting RabbitMQ service
In-Reply-To: <b3f2f033-f509-4baf-b659-4fece1e48423@googlegroups.com>
References: <b3f2f033-f509-4baf-b659-4fece1e48423@googlegroups.com>
Message-ID: <514AF139.10304@rabbitmq.com>


Hi

On 21/03/13 06:37, Sankarasubramanian Subramanian wrote:
>              {could_not_start_server,inet_gethost_native}}},

This indicates a problem with hostname resolution. Can you confirm that
DNS is working correctly, or that some form of name resolution is in
place for the local hostname and all the other node names that may
appear in the cluster config?





-Emile






From tim at rabbitmq.com  Thu Mar 21 12:00:08 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 21 Mar 2013 12:00:08 +0000
Subject: [rabbitmq-discuss] Many RabbitMQ Status Processes
In-Reply-To: <07414569-2ad1-4704-9f5c-c69191c3f2ba@googlegroups.com>
References: <07414569-2ad1-4704-9f5c-c69191c3f2ba@googlegroups.com>
Message-ID: <1C1E42D0-F36D-4E70-A311-C4798F5E53CB@rabbitmq.com>

Hi Eric,

On 19 Mar 2013, at 16:18, Eric Berg wrote:
> Hi! I have a 2 node cluster running for a prototype we are developing, it handles over 1000 queues and over 1000 msg/s when running at full speed. We had an issue recently with some run away processes that published messages from production app servers vi the php library:
[snip]
> The cause of that is still under investigation, but it left many thousands of 'stale' idle connections that rabbit was maintaining.

How did you identify that - using the management UI? What version of rabbit are you running and on which os/platform?

> Attempting to stop/start each node hangs indefinitely, the only way get a full restart of the server is to actually restart the hardware. I see 58 'status' processes attributed to rabbit:
> 
> rabbitmq 16066 16033  0 Mar18 ?        00:00:00 inet_gethost 4
> rabbitmq 16067 16066  0 Mar18 ?        00:00:00 inet_gethost 4
> root     17713 20340  0 05:27 ?        00:00:00 /bin/sh /etc/init.d/rabbitmq-server status
> root     17716 17713  0 05:27 ?        00:00:00 /bin/sh /usr/sbin/rabbitmqctl status
> root     17725 17716  0 05:27 ?        00:00:00 su rabbitmq -s /bin/sh -c /usr/lib/rabbitmq/bin/rabbitmqctl  "status"
> rabbitmq 17726 17725  0 05:27 ?        00:00:00 /usr/lib64/erlang/erts-5.8.5/bin/beam.smp -- -root /usr/lib64/erlang -progname erl -- -home /var/lib/rabbitmq -- -pa /usr/lib/rabbitmq/lib/rabbitmq_server-3.0.1/sbin/../ebin -noshell -noinput -hidden -sname rabbitmqctl17726 -s rabbit_control_main -nodename rabbit at rabbit -extra status
> 

Where's the 58 coming from?

> 
> When stopping the node I see this in the log file:
> =INFO REPORT==== 19-Mar-2013::11:18:32 ===
> Stopping RabbitMQ
> 
> =INFO REPORT==== 19-Mar-2013::11:18:32 ===
>     application: rabbitmq_management_visualiser
>     exited: stopped
>     type: temporary
> 
> =INFO REPORT==== 19-Mar-2013::11:18:32 ===
>     application: rabbitmq_federation_management
>     exited: stopped
>     type: temporary
> 

Those look perfectly normal. I thought you said you couldn't stop the node(s) at all?

> 
> Has anyone see issues with many thousands of stale connections, in combination with many status processes and hanging stop/start? Currently there are are no producers or consumers connected to this box.

The 'status' processes are only ever launched by the init daemon or by a user issuing `rabbitmq-server status` - are you sure you don't have some monitoring infrastructure that is triggering these commands?

Cheers,
Tim

> 
> Thanks!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Thu Mar 21 12:03:17 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 21 Mar 2013 12:03:17 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
Message-ID: <6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>

Hi all,

We've discussed moving to a different (non-standard) logging provider before, and I'll raise the issue again. Afaik we've not run into the issues with error_logger very often (i.e., the reasons why lager was invented, viz massive memory consumption due to serialisation of large terms in logging output). The 'filtering possibilities' with lager don't necessarily require the parse_transforms to be used iirc - you can submit a logging request direct to lager and specify the log level at the call site. Again, I'll raise the discussion with the rest of the team and let's see what comes of that.

Cheers,
Tim

On 19 Mar 2013, at 08:48, Gotthard, Petr wrote:

> Correct me if I?m wrong, but I don?t think that moving to lager requires any changes inside rabbitmq. Since rabbitmq (as far as I know) uses standard Erlang?s logging and since standard logs are redirected to lager, all rabbitmq related logs are processed by lager. Wihout many filtering possibilities though.
>  
> Petr
>  
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
> Sent: 18. b?ezna 2013 17:36
> To: Discussions about RabbitMQ
> Subject: [rabbitmq-discuss] lager vs sasl error log
>  
> Any plans to move rabbitmq.log to lager (and allow for lager-syslog) while keeping rabbit-sasl.log for crash dumps?
>  
> Would be nice to be able to get the plugable loggers and improvements to logging performance lager purports to provide, as well as a more modern, *NIXy logging output.
>  
> Cheers,
> 
> Gavin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From 0x6e6562 at gmail.com  Thu Mar 21 12:13:26 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 21 Mar 2013 12:13:26 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
Message-ID: <20DEDA735697450B9CE2A5A1020B81F1@gmail.com>

Hey Tim,  

I think a good start would be to implement Gavin's suggestion about having a more UNIXy output, since you could do this without having to change the transport.

If you are aggregating lots of Rabbit logs, this results in lots of double entries such as

Mar 21 12:05:30 a logger:  : =INFO REPORT==== 21-Mar-2013::12:05:29 ===  
Mar 21 12:05:30 a logger:  : started TCP Listener on [::]:5672


If I understand Gavin correctly, you could improve the SNR by putting this on one line.

Cheers,

Ben


On Thursday, 21 March 2013 at 12:03, Tim Watson wrote:

> Hi all,
>  
> We've discussed moving to a different (non-standard) logging provider before, and I'll raise the issue again. Afaik we've not run into the issues with error_logger very often (i.e., the reasons why lager was invented, viz massive memory consumption due to serialisation of large terms in logging output). The 'filtering possibilities' with lager don't necessarily require the parse_transforms to be used iirc - you can submit a logging request direct to lager and specify the log level at the call site. Again, I'll raise the discussion with the rest of the team and let's see what comes of that.
>  
> Cheers,
> Tim
>  
> On 19 Mar 2013, at 08:48, Gotthard, Petr wrote:
>  
> > Correct me if I?m wrong, but I don?t think that moving to lager requires any changes inside rabbitmq. Since rabbitmq (as far as I know) uses standard Erlang?s logging and since standard logs are redirected to lager, all rabbitmq related logs are processed by lager. Wihout many filtering possibilities though.
> >  
> > Petr
> >  
> > From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
> > Sent: 18. b?ezna 2013 17:36
> > To: Discussions about RabbitMQ
> > Subject: [rabbitmq-discuss] lager vs sasl error log
> >  
> > Any plans to move rabbitmq.log to lager (and allow for lager-syslog) while keeping rabbit-sasl.log for crash dumps?
> >  
> > Would be nice to be able to get the plugable loggers and improvements to logging performance lager purports to provide, as well as a more modern, *NIXy logging output.
> >  
> > Cheers,
> >  
> > Gavin
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >  
>  
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
>  


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130321/7d209da5/attachment.htm>

From emile at rabbitmq.com  Thu Mar 21 12:19:03 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 21 Mar 2013 12:19:03 +0000
Subject: [rabbitmq-discuss] Dead-Lettering Performance
In-Reply-To: <1ac86207-f897-47a6-bad5-ec9a9569d778@googlegroups.com>
References: <1ac86207-f897-47a6-bad5-ec9a9569d778@googlegroups.com>
Message-ID: <514AFAB7.4050704@rabbitmq.com>

On 20/03/13 15:11, Maciej Lopacinski wrote:
> My question:
>  - is it valid use of message expiration time?

It is valid to use TTL to implement delayed delivery. Whether it will
meet your expectations in this case is hard to say. If a message (to be
delayed by 110s) is published before another message (to be delayed by
10s) to the same queue then they will be expired almost simultaneously
after 110s.

>  - are there any caveats around dead-lettering performance?

Dead-lettering a large number of messages could cause a spike in memory use.

>  - are there any guarantees around dead-lettering performance?

I'm not sure what kind of guarantee you require. The possible memory
spike will be fixed in a future release.

>  - does dead-lettering has same "priority" as others "internal
> operations" in RabbitMQ broker?

The Erlang scheduler treats processes performing dead-lettering the same
as all the other broker processes.



-Emile








From tim at rabbitmq.com  Thu Mar 21 12:36:01 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 21 Mar 2013 12:36:01 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
Message-ID: <8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>

Hi Ben,

On 21 Mar 2013, at 12:13, Ben Hood wrote:
> I think a good start would be to implement Gavin's suggestion about having a more UNIXy output, since you could do this without having to change the transport.
> 

That's an understand-able requirement, however...

> If you are aggregating lots of Rabbit logs, this results in lots of double entries such as
> 
> Mar 21 12:05:30 a logger:  : =INFO REPORT==== 21-Mar-2013::12:05:29 === 
> Mar 21 12:05:30 a logger:  : started TCP Listener on [::]:5672
> 

Sure - that multi-line output is what Erlang's built in error_logger generates. 

> If I understand Gavin correctly, you could improve the SNR by putting this on one line.
> 

To do that, we'd have to change from the built-in error_logger to something else, such as lager. That idea's been up for discussion before and as I said, I'll raise it again.

Cheers,
Tim

> Cheers,
> 
> Ben
> 
> On Thursday, 21 March 2013 at 12:03, Tim Watson wrote:
> 
>> Hi all,
>> 
>> We've discussed moving to a different (non-standard) logging provider before, and I'll raise the issue again. Afaik we've not run into the issues with error_logger very often (i.e., the reasons why lager was invented, viz massive memory consumption due to serialisation of large terms in logging output). The 'filtering possibilities' with lager don't necessarily require the parse_transforms to be used iirc - you can submit a logging request direct to lager and specify the log level at the call site. Again, I'll raise the discussion with the rest of the team and let's see what comes of that.
>> 
>> Cheers,
>> Tim
>> 
>> On 19 Mar 2013, at 08:48, Gotthard, Petr wrote:
>> 
>>> Correct me if I?m wrong, but I don?t think that moving to lager requires any changes inside rabbitmq. Since rabbitmq (as far as I know) uses standard Erlang?s logging and since standard logs are redirected to lager, all rabbitmq related logs are processed by lager. Wihout many filtering possibilities though.
>>> Petr
>>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
>>> Sent: 18. b?ezna 2013 17:36
>>> To: Discussions about RabbitMQ
>>> Subject: [rabbitmq-discuss] lager vs sasl error log
>>> Any plans to move rabbitmq.log to lager (and allow for lager-syslog) while keeping rabbit-sasl.log for crash dumps?
>>> Would be nice to be able to get the plugable loggers and improvements to logging performance lager purports to provide, as well as a more modern, *NIXy logging output.
>>> Cheers,
>>> 
>>> Gavin
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From 0x6e6562 at gmail.com  Thu Mar 21 12:40:21 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 21 Mar 2013 12:40:21 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
Message-ID: <8DA946A6DD634687888CF50A0FE84263@gmail.com>

Hey Tim,  

Thanks for the heads up.

Cheers,

Ben  


On Thursday, 21 March 2013 at 12:36, Tim Watson wrote:

> Hi Ben,
>  
> On 21 Mar 2013, at 12:13, Ben Hood wrote:
> > I think a good start would be to implement Gavin's suggestion about having a more UNIXy output, since you could do this without having to change the transport.
>  
>  
> That's an understand-able requirement, however...
>  
> > If you are aggregating lots of Rabbit logs, this results in lots of double entries such as
> >  
> > Mar 21 12:05:30 a logger: : =INFO REPORT==== 21-Mar-2013::12:05:29 ===  
> > Mar 21 12:05:30 a logger: : started TCP Listener on [::]:5672
> >  
>  
>  
> Sure - that multi-line output is what Erlang's built in error_logger generates.  
>  
> > If I understand Gavin correctly, you could improve the SNR by putting this on one line.
>  
> To do that, we'd have to change from the built-in error_logger to something else, such as lager. That idea's been up for discussion before and as I said, I'll raise it again.
>  
> Cheers,
> Tim
>  
> > Cheers,
> >  
> > Ben
> >  
> > On Thursday, 21 March 2013 at 12:03, Tim Watson wrote:
> >  
> > > Hi all,
> > >  
> > > We've discussed moving to a different (non-standard) logging provider before, and I'll raise the issue again. Afaik we've not run into the issues with error_logger very often (i.e., the reasons why lager was invented, viz massive memory consumption due to serialisation of large terms in logging output). The 'filtering possibilities' with lager don't necessarily require the parse_transforms to be used iirc - you can submit a logging request direct to lager and specify the log level at the call site. Again, I'll raise the discussion with the rest of the team and let's see what comes of that.
> > >  
> > > Cheers,
> > > Tim
> > >  
> > > On 19 Mar 2013, at 08:48, Gotthard, Petr wrote:
> > >  
> > > > Correct me if I?m wrong, but I don?t think that moving to lager requires any changes inside rabbitmq. Since rabbitmq (as far as I know) uses standard Erlang?s logging and since standard logs are redirected to lager, all rabbitmq related logs are processed by lager. Wihout many filtering possibilities though.
> > > > Petr
> > > > From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
> > > > Sent: 18. b?ezna 2013 17:36
> > > > To: Discussions about RabbitMQ
> > > > Subject: [rabbitmq-discuss] lager vs sasl error log
> > > > Any plans to move rabbitmq.log to lager (and allow for lager-syslog) while keeping rabbit-sasl.log for crash dumps?
> > > > Would be nice to be able to get the plugable loggers and improvements to logging performance lager purports to provide, as well as a more modern, *NIXy logging output.
> > > > Cheers,
> > > >  
> > > > Gavin
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > >  
> > >  
> > >  
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > >  
> >  
> >  
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >  
>  
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
>  


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130321/2458283e/attachment.htm>

From tim at rabbitmq.com  Thu Mar 21 13:16:56 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 21 Mar 2013 13:16:56 +0000
Subject: [rabbitmq-discuss] Why ack rates don't show in RabbitMQ
	management?
In-Reply-To: <d8d55950-0d23-44c9-b959-4ac65f08e607@googlegroups.com>
References: <d8d55950-0d23-44c9-b959-4ac65f08e607@googlegroups.com>
Message-ID: <E43CFFCC-FC09-41EA-BA70-E0C60EC496CF@rabbitmq.com>

Hi,

On 20 Mar 2013, at 08:25, Chen ZHONG wrote:
> I have some consumers to consume a queue. All of them are set "Ack required" in programming code.
> 
> This problem doesn't happen in other queue, other same code consumer. Only here.

If you've set no-ack=true, then consumers have to ACK messages explicitly. If you're consuming with basic.get, you can set auto-ack, but otherwise it's up to you to send acknowledgements. Are you sure that your consumers are sending acknowledgements but the rates are not showing up? Could it be that you have consumers which are failing to act on basic.cancel after an HA master fails over to another node perhaps? Or could it be that you're setting the prefetch count with basic.qos so that multiple un-acked messages are being delivered to consumers?

Cheers,
Tim

From tim at rabbitmq.com  Thu Mar 21 13:23:04 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 21 Mar 2013 13:23:04 +0000
Subject: [rabbitmq-discuss] Why the rates of deliver/ack has problem in
	RabbitMQ management?
In-Reply-To: <22950a8c-48b1-45df-9f96-c19528d377ef@googlegroups.com>
References: <22950a8c-48b1-45df-9f96-c19528d377ef@googlegroups.com>
Message-ID: <7A0B1C2B-05FF-41C3-BE1E-DC821E170486@rabbitmq.com>

Hi

On 20 Mar 2013, at 08:09, Chen ZHONG wrote:
> This queue has a incoming rate of 4.0/s. It has a deliver rate of 4.0/s in fact. But it only show 0.63/s here.
> 

What makes you think the delivery rate is 4.0/s? I can't see anything to indicate that's the case in the image you've provided?

> Then, all the consumers which connected to hdl0002's node has no rate now. The consumers which connected to hdl0001's node is still OK.
> 
> 

The current version of the management plugin doesn't compensate for channels going away, or provide historical/time-series data for exchange/queues stats. However, a shiny new release of the management plugin has been developed which does deal with those things. It will probably be available in a release pretty soon and will be available in tonight's nightly build (so you can pick it up tomorrow morning GMT if you want to take a look).

Cheers,
Tim

From steveolivier22 at gmail.com  Thu Mar 21 15:37:32 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Thu, 21 Mar 2013 08:37:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Cross data center H/A
Message-ID: <1363880252068-25637.post@n5.nabble.com>

Anyone using Pacemaker or Pacemaker-like technology to achieve H/A for
persistent messages and durable queues across datacenters (and across the
WAN)? The thought would be to have a primary data center, but in the event
it went down, a backup data center would allow for processing of messages
that had not been drained from queues prior to the primary data center going
down. Any success/horror stories?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Cross-data-center-H-A-tp25637.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From watson.timothy at gmail.com  Thu Mar 21 16:24:03 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 21 Mar 2013 16:24:03 +0000
Subject: [rabbitmq-discuss] RabbitMQ Network Partition Diagnostics
In-Reply-To: <05F1A0E36285134EBF7A1477CB3A7DC626FAD1C3@E2K10MBOX1-CORP.eprod.com>
References: <33552759.336358.1363879179239.JavaMail.nabble@sam.nabble.com>
	<B70EAA33-259F-4E89-BF9B-59C12725507B@rabbitmq.com>
	<05F1A0E36285134EBF7A1477CB3A7DC626FAD1C3@E2K10MBOX1-CORP.eprod.com>
Message-ID: <6B4A1C1E-B597-4B42-B881-1FA0214AD736@rabbitmq.com>

Hi Steve,

On 21 Mar 2013, at 15:42, "Croy, Steve" <SCROY at eprod.com> wrote:
> 
> I have a couple more questions:
>        1.  Would you recommend that the node(s) be on the same VLAN?

If you're using clustering then the guidance is 'use a reliable network' - which is a bit fuzzy admittedly. If being on the same vlan decreases the risk of comms disruption (of any sort) then yes, though I can't comment on whether or not that's really the case.

>        2.  We are running the nodes on VM(s), would physical be better?  (Since RabbitMQ is VMWare I think I know the answer, but have to ask :)

In theory that shouldn't matter, but obviously you'll need to make sure your virtualisation setup is 'just right' - again that's not something I'm an expert with I'm afraid.

>        3.  Would running a three node cluster with the correct mnesia setting be more reliable?  Majority cluster wins vs. two node both majority?
> 

Actually it won't make any difference. If any comms breakdown occurs, it can potentially force you to restart nodes. We're planning on releasing some features to help deal with minority islands in the next release (ish).

Cheers
Tim

From watson.timothy at gmail.com  Thu Mar 21 16:41:42 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 21 Mar 2013 16:41:42 +0000
Subject: [rabbitmq-discuss] RabbitMQ Network Partition Diagnostics
In-Reply-To: <6B4A1C1E-B597-4B42-B881-1FA0214AD736@rabbitmq.com>
References: <33552759.336358.1363879179239.JavaMail.nabble@sam.nabble.com>
	<B70EAA33-259F-4E89-BF9B-59C12725507B@rabbitmq.com>
	<05F1A0E36285134EBF7A1477CB3A7DC626FAD1C3@E2K10MBOX1-CORP.eprod.com>
	<6B4A1C1E-B597-4B42-B881-1FA0214AD736@rabbitmq.com>
Message-ID: <3607E45B-76F8-4FFF-9CFD-28147F03916F@rabbitmq.com>

Oh and if you can provide me with the logs then I might be able to pin down the cause a bit more specifically.

Cheers
Tim

On 21 Mar 2013, at 16:24, Tim Watson <watson.timothy at gmail.com> wrote:

> Hi Steve,
> 
> On 21 Mar 2013, at 15:42, "Croy, Steve" <SCROY at eprod.com> wrote:
>> 
>> I have a couple more questions:
>>       1.  Would you recommend that the node(s) be on the same VLAN?
> 
> If you're using clustering then the guidance is 'use a reliable network' - which is a bit fuzzy admittedly. If being on the same vlan decreases the risk of comms disruption (of any sort) then yes, though I can't comment on whether or not that's really the case.
> 
>>       2.  We are running the nodes on VM(s), would physical be better?  (Since RabbitMQ is VMWare I think I know the answer, but have to ask :)
> 
> In theory that shouldn't matter, but obviously you'll need to make sure your virtualisation setup is 'just right' - again that's not something I'm an expert with I'm afraid.
> 
>>       3.  Would running a three node cluster with the correct mnesia setting be more reliable?  Majority cluster wins vs. two node both majority?
>> 
> 
> Actually it won't make any difference. If any comms breakdown occurs, it can potentially force you to restart nodes. We're planning on releasing some features to help deal with minority islands in the next release (ish).
> 
> Cheers
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From james.gardner at noaa.gov  Thu Mar 21 17:03:36 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Thu, 21 Mar 2013 12:03:36 -0500
Subject: [rabbitmq-discuss] AMQP, RabbitMQ and message integrity
Message-ID: <514B3D68.2040408@noaa.gov>


I would appreciate some information on whether there are any guarantees 
or safeguards in RabbitMQ against message corruption along the 
publisher->rabbitmq->consumer chain.
Perhaps that question can largely be rephrased as what guarantees does 
*AMQP* make about message integrity, although how messages are stored 
and transported within RabbitMQ would surely be a part of it too.

One reason I am trying to get a feel for this is to figure out whether 
the publisher needs to include a message body hash (eg. MD5) in the 
header, so that a receiver can check it, or whether that would be 
redundant. The concern would be about corruption due to technical 
phenomena rather than malice, ie. I'm not coming at this from a security 
perspective.
The topology in question would include federation links across a WAN as 
well as LAN.
I haven't seen this issue addressed anywhere in the docs but if I missed 
it I would be grateful if you could point me to it.
Many thanks,

James Gardner
NWS Internet Dissemination System


From emile at rabbitmq.com  Thu Mar 21 17:36:15 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 21 Mar 2013 17:36:15 +0000
Subject: [rabbitmq-discuss] AMQP, RabbitMQ and message integrity
In-Reply-To: <514B3D68.2040408@noaa.gov>
References: <514B3D68.2040408@noaa.gov>
Message-ID: <514B450F.9070207@rabbitmq.com>


Hi James,

On 21/03/13 17:03, James Gardner wrote:

> Perhaps that question can largely be rephrased as what guarantees does 
> *AMQP* make about message integrity, although how messages are stored 
> and transported within RabbitMQ would surely be a part of it too.

Yes, a hash in a header will work. The broker does not perform any
integrity test on messages (though it will notice corruption that causes
the length to change).

In theory it is possible for highly specific failure modes to cause
corruption of messages. In practice there are network checksums and
parity checks in hardware for protection. The broker is far more likely
to crash than deliver corrupt data unwittingly, but the hash you suggest
would be another line of defence against this remote possibility.


-Emile






From james.gardner at noaa.gov  Thu Mar 21 17:51:12 2013
From: james.gardner at noaa.gov (James Gardner)
Date: Thu, 21 Mar 2013 12:51:12 -0500
Subject: [rabbitmq-discuss] AMQP, RabbitMQ and message integrity
In-Reply-To: <514B450F.9070207@rabbitmq.com>
References: <514B3D68.2040408@noaa.gov> <514B450F.9070207@rabbitmq.com>
Message-ID: <514B4890.3010900@noaa.gov>


Sounds fine, thanks Emile.


On 03/21/2013 12:36 PM, Emile Joubert wrote:
> Hi James,
>
> On 21/03/13 17:03, James Gardner wrote:
>
>> Perhaps that question can largely be rephrased as what guarantees does
>> *AMQP* make about message integrity, although how messages are stored
>> and transported within RabbitMQ would surely be a part of it too.
> Yes, a hash in a header will work. The broker does not perform any
> integrity test on messages (though it will notice corruption that causes
> the length to change).
>
> In theory it is possible for highly specific failure modes to cause
> corruption of messages. In practice there are network checksums and
> parity checks in hardware for protection. The broker is far more likely
> to crash than deliver corrupt data unwittingly, but the hash you suggest
> would be another line of defence against this remote possibility.
>
>
> -Emile
>
>
>
>
>


From gmr at meetme.com  Thu Mar 21 21:02:30 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Thu, 21 Mar 2013 14:02:30 -0700
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <8DA946A6DD634687888CF50A0FE84263@gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
Message-ID: <CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>

Fwiw in some advocacy discussions, the logging output was a reason some
people have discounted or not moved forward with Rabbit. From conversations
I have had recently with people, logging and config file syntax are the
bigger approachachability issues with Rabbit.

My goal is to be able to do log aggregation for our largish count of
RabbitMQ nodes, which afaik is not possible with Rabbit out of the box.
This makes it nearly impossible to stay on top of logs for anything but
troubleshooting individual nodes when problems occur.

On Thursday, March 21, 2013, Ben Hood <0x6e6562 at gmail.com> wrote:

>  Hey Tim,
>
> Thanks for the heads up.
>
> Cheers,
>
> Ben
>
> On Thursday, 21 March 2013 at 12:36, Tim Watson wrote:
>
> Hi Ben,
>
> On 21 Mar 2013, at 12:13, Ben Hood wrote:
>
> I think a good start would be to implement Gavin's suggestion about having
> a more UNIXy output, since you could do this without having to change the
> transport.
>
>
> That's an understand-able requirement, however...
>
> If you are aggregating lots of Rabbit logs, this results in lots of double
> entries such as
>
> Mar 21 12:05:30 a logger: : =INFO REPORT==== 21-Mar-2013::12:05:29 ===
> Mar 21 12:05:30 a logger: : started TCP Listener on [::]:5672
>
>
> Sure - that multi-line output is what Erlang's built in error_logger
> generates.
>
> If I understand Gavin correctly, you could improve the SNR by putting this
> on one line.
>
>
> To do that, we'd have to change from the built-in error_logger to
> something else, such as lager. That idea's been up for discussion before
> and as I said, I'll raise it again.
>
> Cheers,
> Tim
>
> Cheers,
>
> Ben
>
> On Thursday, 21 March 2013 at 12:03, Tim Watson wrote:
>
> Hi all,
>
> We've discussed moving to a different (non-standard) logging provider
> before, and I'll raise the issue again. Afaik we've not run into the issues
> with error_logger very often (i.e., the reasons why lager was invented, viz
> massive memory consumption due to serialisation of large terms in logging
> output). The 'filtering possibilities' with lager don't necessarily require
> the parse_transforms to be used iirc - you can submit a logging request
> direct to lager and specify the log level at the call site. Again, I'll
> raise the discussion with the rest of the team and let's see what comes of
> that.
>
> Cheers,
> Tim
>
> On 19 Mar 2013, at 08:48, Gotthard, Petr wrote:
>
> Correct me if I?m wrong, but I don?t think that moving to lager requires
> any changes inside rabbitmq. Since rabbitmq (as far as I know) uses
> standard Erlang?s logging and since standard logs are redirected to lager,
> all rabbitmq related logs are processed by lager. Wihout many filtering
> possibilities though.
> Petr
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [
> mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M.
> Roy
> Sent: 18. b?ezna 2013 17:36
> To: Discussions about RabbitMQ
> Subject: [rabbitmq-discuss] lager vs sasl error log
> Any plans to move rabbitmq.log to lager (and allow for lager-syslog) while
> keeping rabbit-sasl.log for crash dumps?
> Would be nice to be able to get the plugable loggers and improvements to
> logging performance lager purports to provide, as well as a more modern,
> *NIXy logging output.
> Cheers,
>
> Gavin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>

-- 

Gavin M. Roy
Chief Technology Officer

<http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130321/107bc122/attachment.htm>

From sleibman at gmail.com  Thu Mar 21 17:17:43 2013
From: sleibman at gmail.com (Steve Leibman)
Date: Thu, 21 Mar 2013 10:17:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit client works from one machine but not
	another
Message-ID: <d214b06c-681b-432a-b5bf-3f7c285ba207@googlegroups.com>

Hi,

I have RabbitMQ client code (I've reproduced the issue with just the sample 
consumer code from http://www.rabbitmq.com/tutorials/tutorial-one-java.html 
) that works fine from one machine, but not from another (both attempting 
to connect to the same broker/server). The machine that fails to run this 
successfully is in a completely different location, with its own firewall 
rules, so the first obvious thing to check is connectivity to tcp port 5672 
on the server machine, and I have confirmed (via both "telnet <hostname> 
5672" and via a simple java program that runs new Socket("<hostname>", 5672) ) 
that basic connectivity works fine.

My exception stack trace is shown below.

Any suggestions for next steps?

Exception in thread "main" java.io.IOException
at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:360)
at 
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
at 
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
at Recv.main(Recv.java:15)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; 
reason: java.net.SocketException: Connection reset
at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
at 
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
at 
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:313)
... 3 more
Caused by: java.net.SocketException: Connection reset
at java.net.SocketInputStream.read(SocketInputStream.java:189)
at java.net.SocketInputStream.read(SocketInputStream.java:121)
at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)
at java.io.BufferedInputStream.read(BufferedInputStream.java:254)
at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:288)
at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
at 
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:131)
at 
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:515)

Thanks,
Steve Leibman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130321/835eb018/attachment.htm>

From sleibman at gmail.com  Thu Mar 21 17:28:54 2013
From: sleibman at gmail.com (Steve Leibman)
Date: Thu, 21 Mar 2013 10:28:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit client works from one machine but not
	another
In-Reply-To: <d214b06c-681b-432a-b5bf-3f7c285ba207@googlegroups.com>
References: <d214b06c-681b-432a-b5bf-3f7c285ba207@googlegroups.com>
Message-ID: <452feced-fd44-4653-a8a0-9d176b9b96a6@googlegroups.com>

Update: these same observations are true even if I point my clients to 
dev.rabbitmq.com.
I can connect to 5672 on dev.rabbitmq.com from either machine (e.g. using 
telnet), but my rabbit client fails from one of the two machines with the 
exception shown previously.

On Thursday, March 21, 2013 1:17:43 PM UTC-4, Steve Leibman wrote:
>
> Hi,
>
> I have RabbitMQ client code (I've reproduced the issue with just the 
> sample consumer code from 
> http://www.rabbitmq.com/tutorials/tutorial-one-java.html ) that works 
> fine from one machine, but not from another (both attempting to connect to 
> the same broker/server). The machine that fails to run this successfully is 
> in a completely different location, with its own firewall rules, so the 
> first obvious thing to check is connectivity to tcp port 5672 on the server 
> machine, and I have confirmed (via both "telnet <hostname> 5672" and via a 
> simple java program that runs new Socket("<hostname>", 5672) ) that basic 
> connectivity works fine.
>
> My exception stack trace is shown below.
>
> Any suggestions for next steps?
>
> Exception in thread "main" java.io.IOException
> at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
> at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
> at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:360)
> at 
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
> at 
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
> at Recv.main(Recv.java:15)
> Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; 
> reason: java.net.SocketException: Connection reset
> at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
> at 
> com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
> at 
> com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
> at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:313)
> ... 3 more
> Caused by: java.net.SocketException: Connection reset
> at java.net.SocketInputStream.read(SocketInputStream.java:189)
> at java.net.SocketInputStream.read(SocketInputStream.java:121)
> at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)
> at java.io.BufferedInputStream.read(BufferedInputStream.java:254)
> at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:288)
> at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
> at 
> com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:131)
> at 
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:515)
>
> Thanks,
> Steve Leibman
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130321/74da999b/attachment.htm>

From SCROY at eprod.com  Thu Mar 21 19:31:13 2013
From: SCROY at eprod.com (Croy, Steve)
Date: Thu, 21 Mar 2013 19:31:13 +0000
Subject: [rabbitmq-discuss] RabbitMQ Network Partition Diagnostics
In-Reply-To: <3607E45B-76F8-4FFF-9CFD-28147F03916F@rabbitmq.com>
References: <33552759.336358.1363879179239.JavaMail.nabble@sam.nabble.com>
	<B70EAA33-259F-4E89-BF9B-59C12725507B@rabbitmq.com>
	<05F1A0E36285134EBF7A1477CB3A7DC626FAD1C3@E2K10MBOX1-CORP.eprod.com>
	<6B4A1C1E-B597-4B42-B881-1FA0214AD736@rabbitmq.com>
	<3607E45B-76F8-4FFF-9CFD-28147F03916F@rabbitmq.com>
Message-ID: <05F1A0E36285134EBF7A1477CB3A7DC626FAD5A2@E2K10MBOX1-CORP.eprod.com>

Tim

We installed some software on the box that needed a restart and it triggered this failure.  We are starting to think it is related to RestartManager.  We had a look at the logs on the boxes and the occurrence seems to coincide with RestartManager running.  What do you think?

Are you asking for the Rabbit logs?

Thank you,
Steve

-----Original Message-----
From: Tim Watson [mailto:watson.timothy at gmail.com]
Sent: Thursday, March 21, 2013 11:42 AM
To: Discussions about RabbitMQ
Cc: Croy, Steve; Discussions about RabbitMQ; Vaughn, Mark
Subject: Re: [rabbitmq-discuss] RabbitMQ Network Partition Diagnostics

Oh and if you can provide me with the logs then I might be able to pin down the cause a bit more specifically.

Cheers
Tim

On 21 Mar 2013, at 16:24, Tim Watson <watson.timothy at gmail.com> wrote:

> Hi Steve,
>
> On 21 Mar 2013, at 15:42, "Croy, Steve" <SCROY at eprod.com> wrote:
>>
>> I have a couple more questions:
>>       1.  Would you recommend that the node(s) be on the same VLAN?
>
> If you're using clustering then the guidance is 'use a reliable network' - which is a bit fuzzy admittedly. If being on the same vlan decreases the risk of comms disruption (of any sort) then yes, though I can't comment on whether or not that's really the case.
>
>>       2.  We are running the nodes on VM(s), would physical be better?  (Since RabbitMQ is VMWare I think I know the answer, but have to ask :)
>
> In theory that shouldn't matter, but obviously you'll need to make sure your virtualisation setup is 'just right' - again that's not something I'm an expert with I'm afraid.
>
>>       3.  Would running a three node cluster with the correct mnesia setting be more reliable?  Majority cluster wins vs. two node both majority?
>>
>
> Actually it won't make any difference. If any comms breakdown occurs, it can potentially force you to restart nodes. We're planning on releasing some features to help deal with minority islands in the next release (ish).
>
> Cheers
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

________________________________

This message (including any attachments) is confidential and intended for a specific individual and purpose. If you are not the intended recipient, please notify the sender immediately and delete this message.

From jerryk at rbcon.com  Thu Mar 21 23:22:25 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 21 Mar 2013 16:22:25 -0700
Subject: [rabbitmq-discuss] Cross data center H/A
In-Reply-To: <1363880252068-25637.post@n5.nabble.com>
References: <1363880252068-25637.post@n5.nabble.com>
Message-ID: <CAE0Sz=wv-WiLLX2UQhwjD87FD5jV1nPXqiZM-19dT9MaKdt3zw@mail.gmail.com>

Hi, Steve...

On Thu, Mar 21, 2013 at 8:37 AM, SteveO <steveolivier22 at gmail.com> wrote:

> Anyone using Pacemaker or Pacemaker-like technology to achieve H/A for
> persistent messages and durable queues across datacenters (and across the
> WAN)? The thought would be to have a primary data center, but in the event
> it went down, a backup data center would allow for processing of messages
> that had not been drained from queues prior to the primary data center
> going
> down. Any success/horror stories?
>

If the notion of Pacemaker use you're thinking is akin to the old style
Rabbit active/passive HA, then that's almost surely something you don't
want to consider for cross-WAN geographic distribution for disaster
recovery and the like since it relies upon not only shared storage (e.g. a
SAN) but also on Pacemaker's liveness checks getting fairly timely
responses and not doing crazy things when an unexpected uptick in WAN
latency occurs.

Indeed, in general, the idea of replicating, bit for bit, everything that's
going on in a Rabbit or Rabbit cluster in one DC in another, far off one,
is probably something that's going to be harder and more costly to get
right than what you really need.

What we do see, with some regularity, is customers using Shovel or
Federation to connect DCs in geographically disparate regions, and then
passing checkpointing or roll-up information between the primary in one DC
and the other, with the rate, granularity and content send chosen carefully
with respect to what sort of pick-up/recovery they want to be able to have
happen at the second site.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130321/ad5e63c7/attachment.htm>

From pierpaolo at dropbox.com  Fri Mar 22 03:36:00 2013
From: pierpaolo at dropbox.com (Pierpaolo Baccichet)
Date: Thu, 21 Mar 2013 20:36:00 -0700
Subject: [rabbitmq-discuss] Unacked messages going back in the queue
Message-ID: <CAKZAfCXuaozfzkXU_FTNL5RJpSWVjDyrSu2G1Vh5ezpMeaTbiQ@mail.gmail.com>

Hello everybody,

I am using rabbitMQ 3.0.4 clustered and a replicated queue in memory. I
connect one consumer (using pika) in acked mode. The worker fetches the
message and processes it for very long time directly on the pika thread.

After some time, I see the message going back in ready state and the
consumer disappear from the queue in the rabbit console. I am assuming this
is due to the consumer not sending some kind of keepalive message back to
rabbit to maintain the channel in healthy state.

Is there anything I can do to change the TTL?

Best, Pierpaolo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130321/3c55db9c/attachment.htm>

From gmr at meetme.com  Fri Mar 22 04:05:30 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Thu, 21 Mar 2013 21:05:30 -0700
Subject: [rabbitmq-discuss] pamqp 1.1.0 Released
Message-ID: <CAKwdTWc3SnMOiTe3otvntyUvCR4ibyQ1W1EVx_bPJj7kS8Kv5A@mail.gmail.com>

I am pleased to announce that pamqp 1.1.0 has been released.

pamqp is a pure-python AMQP protocol library. The aim is to create a client
agnostic python encoder and decoder for the AMQP protocol. This is not a
RabbitMQ client but instead a library that is intended to be used by
RabbitMQ clients and will be used by Pika in future versions.

Version 1.1.0 adds support for Python 3.3 and is available via the Python
Package Index and on Github at https://github.com/pika/pamqp

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130321/c230fbcd/attachment.htm>

From watson.timothy at gmail.com  Fri Mar 22 07:55:57 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 22 Mar 2013 07:55:57 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
Message-ID: <5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>

Hi Gavin,

On 21 Mar 2013, at 21:02, "Gavin M. Roy" <gmr at meetme.com> wrote:
> Fwiw in some advocacy discussions, the logging output was a reason some people have discounted or not moved forward with Rabbit.
> From conversations I have had recently with people, logging and config file syntax are the bigger approachachability issues with Rabbit.
> 

That's a pity - the logging is something we could change. The config file syntax, not so much. I suppose we could bootstrap the prelaunch phase to parse and XML file (or whatever) and spew out the native format...

> My goal is to be able to do log aggregation for our largish count of RabbitMQ nodes, which afaik is not possible with Rabbit out of the box. This makes it nearly impossible to stay on top of logs for anything but troubleshooting individual nodes when problems occur.

Yeah with the current implementation you'd need to install your own log handler to make that work. In terms of changing the output format though, allowe to play devil's advocate for a moment...

The info/progress/error reports have a lot of data in them, process stats, stack traces, etc. are you wanting to see all that plonked on one single long line? Because I can see how that'd make parsing/aggregating easier, but not reading them. Does the lager output fit exactly with what you want (I've not looks at it or a couple of years)?

> 
> On Thursday, March 21, 2013, Ben Hood <0x6e6562 at gmail.com> wrote:
> Hey Tim,
> 
> Thanks for the heads up.
> 
> Cheers,
> 
> Ben
> On Thursday, 21 March 2013 at 12:36, Tim Watson wrote:
> 
>> Hi Ben,
>> 
>> On 21 Mar 2013, at 12:13, Ben Hood wrote:
>>> I think a good start would be to implement Gavin's suggestion about having a more UNIXy output, since you could do this without having to change the transport.
>> 
>> That's an understand-able requirement, however...
>> 
>>> If you are aggregating lots of Rabbit logs, this results in lots of double entries such as
>>> 
>>> Mar 21 12:05:30 a logger: : =INFO REPORT==== 21-Mar-2013::12:05:29 ===
>>> Mar 21 12:05:30 a logger: : started TCP Listener on [::]:5672
>> 
>> Sure - that multi-line output is what Erlang's built in error_logger generates.
>> 
>>> If I understand Gavin correctly, you could improve the SNR by putting this on one line.
>> 
>> To do that, we'd have to change from the built-in error_logger to something else, such as lager. That idea's been up for discussion before and as I said, I'll raise it again.
>> 
>> Cheers,
>> Tim
>> 
>>> Cheers,
>>> 
>>> Ben
>>> 
>>> On Thursday, 21 March 2013 at 12:03, Tim Watson wrote:
>>> 
>>>> Hi all,
>>>> 
>>>> We've discussed moving to a different (non-standard) logging provider before, and I'll raise the issue again. Afaik we've not run into the issues with error_logger very often (i.e., the reasons why lager was invented, viz massive memory consumption due to serialisation of large terms in logging output). The 'filtering possibilities' with lager don't necessarily require the parse_transforms to be used iirc - you can submit a logging request direct to lager and specify the log level at the call site. Again, I'll raise the discussion with the rest of the team and let's see what comes of that.
>>>> 
>>>> Cheers,
>>>> Tim
>>>> 
>>>> On 19 Mar 2013, at 08:48, Gotthard, Petr wrote:
>>>> 
>>>>> Correct me if I?m wrong, but I don?t think that moving to lager requires any changes inside rabbitmq. Since rabbitmq (as far as I know) uses standard Erlang?s logging and since standard logs are redirected to lager, all rabbitmq related logs are processed by lager. Wihout many filtering possibilities though.
>>>>> Petr
>>>>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
>>>>> Sent: 18. b?ezna 2013 17:36
>>>>> To: Discussions about RabbitMQ
>>>>> Subject: [rabbitmq-discuss] lager vs sasl error log
>>>>> Any plans to move rabbitmq.log to lager (and allow for lager-syslog) while keeping rabbit-sasl.log for crash dumps?
>>>>> Would be nice to be able to get the plugable loggers and improvements to logging performance lager purports to provide, as well as a more modern, *NIXy logging output.
>>>>> Cheers,
>>>>> 
>>>>> Gavin
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
> 
> 
> -- 
> Gavin M. Roy
> Chief Technology Officer
> 
> 100 Union Square Drive
> New Hope, PA 18938
> p. +1.215.862.1162 x263
> f. +1.215.862.0465
>       
> 
> The public market leader in social discovery. (NYSE MKT: MEET) 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/bf3364f0/attachment.htm>

From watson.timothy at gmail.com  Fri Mar 22 07:59:28 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 22 Mar 2013 07:59:28 +0000
Subject: [rabbitmq-discuss] Rabbit client works from one machine but not
	another
In-Reply-To: <452feced-fd44-4653-a8a0-9d176b9b96a6@googlegroups.com>
References: <d214b06c-681b-432a-b5bf-3f7c285ba207@googlegroups.com>
	<452feced-fd44-4653-a8a0-9d176b9b96a6@googlegroups.com>
Message-ID: <31EF352E-3D4C-4C8D-9ADC-FF260B3157A6@rabbitmq.com>

Hi,

Just because you can open a socket doesn't mean the whole protocol is going to work. Are you sure no packet filtering goes on in the troublesome location?

On 21 Mar 2013, at 17:28, Steve Leibman <sleibman at gmail.com> wrote:

> Update: these same observations are true even if I point my clients to dev.rabbitmq.com.
> I can connect to 5672 on dev.rabbitmq.com from either machine (e.g. using telnet), but my rabbit client fails from one of the two machines with the exception shown previously.
> 
> On Thursday, March 21, 2013 1:17:43 PM UTC-4, Steve Leibman wrote:
> Hi,
> 
> I have RabbitMQ client code (I've reproduced the issue with just the sample consumer code from http://www.rabbitmq.com/tutorials/tutorial-one-java.html ) that works fine from one machine, but not from another (both attempting to connect to the same broker/server). The machine that fails to run this successfully is in a completely different location, with its own firewall rules, so the first obvious thing to check is connectivity to tcp port 5672 on the server machine, and I have confirmed (via both "telnet <hostname> 5672" and via a simple java program that runs new Socket("<hostname>", 5672) ) that basic connectivity works fine.
> 
> My exception stack trace is shown below.
> 
> Any suggestions for next steps?
> 
> Exception in thread "main" java.io.IOException
> 	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
> 	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
> 	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:360)
> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
> 	at Recv.main(Recv.java:15)
> Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; reason: java.net.SocketException: Connection reset
> 	at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
> 	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
> 	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
> 	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:313)
> 	... 3 more
> Caused by: java.net.SocketException: Connection reset
> 	at java.net.SocketInputStream.read(SocketInputStream.java:189)
> 	at java.net.SocketInputStream.read(SocketInputStream.java:121)
> 	at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)
> 	at java.io.BufferedInputStream.read(BufferedInputStream.java:254)
> 	at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:288)
> 	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
> 	at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:131)
> 	at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:515)
> 
> Thanks,
> Steve Leibman
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/4304ea2e/attachment.htm>

From watson.timothy at gmail.com  Fri Mar 22 08:03:19 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 22 Mar 2013 08:03:19 +0000
Subject: [rabbitmq-discuss] RabbitMQ Network Partition Diagnostics
In-Reply-To: <05F1A0E36285134EBF7A1477CB3A7DC626FAD5A2@E2K10MBOX1-CORP.eprod.com>
References: <33552759.336358.1363879179239.JavaMail.nabble@sam.nabble.com>
	<B70EAA33-259F-4E89-BF9B-59C12725507B@rabbitmq.com>
	<05F1A0E36285134EBF7A1477CB3A7DC626FAD1C3@E2K10MBOX1-CORP.eprod.com>
	<6B4A1C1E-B597-4B42-B881-1FA0214AD736@rabbitmq.com>
	<3607E45B-76F8-4FFF-9CFD-28147F03916F@rabbitmq.com>
	<05F1A0E36285134EBF7A1477CB3A7DC626FAD5A2@E2K10MBOX1-CORP.eprod.com>
Message-ID: <B07D5351-6EB8-4EE4-B0B0-6EA6910EE339@rabbitmq.com>

Hi 

On 21 Mar 2013, at 19:31, "Croy, Steve" <SCROY at eprod.com> wrote:
> 
> We installed some software on the box that needed a restart and it triggered this failure.  We are starting to think it is related to RestartManager.  We had a look at the logs on the boxes and the occurrence seems to coincide with RestartManager running.  What do you think?

That sounds very likely to me.

> 
> Are you asking for the Rabbit logs?
> 

If you're still struggling to identify the culprit then the logs may contain more useful information. If you'd like my help in tracking down the aide then seeing the logs would speed things up. You can send/paste them somewhere and contact me privately if that helps an if they contain private data then we might be able to sign a confidentiality agreement although that might take a bit of time to arrange.

Cheers
Tim

> Thank you,
> Steve
> 
> -----Original Message-----
> From: Tim Watson [mailto:watson.timothy at gmail.com]
> Sent: Thursday, March 21, 2013 11:42 AM
> To: Discussions about RabbitMQ
> Cc: Croy, Steve; Discussions about RabbitMQ; Vaughn, Mark
> Subject: Re: [rabbitmq-discuss] RabbitMQ Network Partition Diagnostics
> 
> Oh and if you can provide me with the logs then I might be able to pin down the cause a bit more specifically.
> 
> Cheers
> Tim
> 
> On 21 Mar 2013, at 16:24, Tim Watson <watson.timothy at gmail.com> wrote:
> 
>> Hi Steve,
>> 
>> On 21 Mar 2013, at 15:42, "Croy, Steve" <SCROY at eprod.com> wrote:
>>> 
>>> I have a couple more questions:
>>>      1.  Would you recommend that the node(s) be on the same VLAN?
>> 
>> If you're using clustering then the guidance is 'use a reliable network' - which is a bit fuzzy admittedly. If being on the same vlan decreases the risk of comms disruption (of any sort) then yes, though I can't comment on whether or not that's really the case.
>> 
>>>      2.  We are running the nodes on VM(s), would physical be better?  (Since RabbitMQ is VMWare I think I know the answer, but have to ask :)
>> 
>> In theory that shouldn't matter, but obviously you'll need to make sure your virtualisation setup is 'just right' - again that's not something I'm an expert with I'm afraid.
>> 
>>>      3.  Would running a three node cluster with the correct mnesia setting be more reliable?  Majority cluster wins vs. two node both majority?
>>> 
>> 
>> Actually it won't make any difference. If any comms breakdown occurs, it can potentially force you to restart nodes. We're planning on releasing some features to help deal with minority islands in the next release (ish).
>> 
>> Cheers
>> Tim
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> ________________________________
> 
> This message (including any attachments) is confidential and intended for a specific individual and purpose. If you are not the intended recipient, please notify the sender immediately and delete this message.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From watson.timothy at gmail.com  Fri Mar 22 08:11:00 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 22 Mar 2013 08:11:00 +0000
Subject: [rabbitmq-discuss] Unacked messages going back in the queue
In-Reply-To: <CAKZAfCXuaozfzkXU_FTNL5RJpSWVjDyrSu2G1Vh5ezpMeaTbiQ@mail.gmail.com>
References: <CAKZAfCXuaozfzkXU_FTNL5RJpSWVjDyrSu2G1Vh5ezpMeaTbiQ@mail.gmail.com>
Message-ID: <1AAC2F07-0433-4BFF-BDD3-75580D8989C7@rabbitmq.com>

If the channel is disappearing (because rabbit considers the connection to have dropped) then I would suggest configuring heartbeats in your client too ensure the connection stays alive.

Cheers
Tim

On 22 Mar 2013, at 03:36, Pierpaolo Baccichet <pierpaolo at dropbox.com> wrote:

> Hello everybody,
> 
> I am using rabbitMQ 3.0.4 clustered and a replicated queue in memory. I connect one consumer (using pika) in acked mode. The worker fetches the message and processes it for very long time directly on the pika thread.
> 
> After some time, I see the message going back in ready state and the consumer disappear from the queue in the rabbit console. I am assuming this is due to the consumer not sending some kind of keepalive message back to rabbit to maintain the channel in healthy state.
> 
> Is there anything I can do to change the TTL?
> 
> Best, Pierpaolo
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Fri Mar 22 10:03:53 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 22 Mar 2013 10:03:53 +0000
Subject: [rabbitmq-discuss] Connecting to RabbitMQ on Windows Server
 Using Wildcard Cert with .NET Client Using SSL
In-Reply-To: <d1e237d1-fdbe-47af-9772-eef3111c6a20@googlegroups.com>
References: <d1e237d1-fdbe-47af-9772-eef3111c6a20@googlegroups.com>
Message-ID: <514C2C89.6010305@rabbitmq.com>


Hi Rich,

On 20/03/13 17:40, Rich Miller wrote:
> I'm trying quite unsuccessfully to get to a RabbitMQ server running
> as a service on Windows Server 2008 R2 using a .NET client.

Have you tried the tips in the SSL troubleshooting guide?
http://www.rabbitmq.com/troubleshooting-ssl.html

A diagnostic tool (not mentioned on that page) that might shed light on
the reason for failure is "ssldump".

> "Cannot find the requested object" (after trying to pass a .key file in
> as the cert file).

That won't work and an error is to be expected.

> RabbitMQ Server is 2.7.1 and Erlang is R15B03-1.  Client code looks
> basically like this:

You should consider upgrading RabbitMQ, because many bugs have been
fixed since v2.7.1. You might want to try with the latest version of
Erlang also since SSL support has been improving steadily.



-Emile

From n0th1ng-mixer at yandex.ru  Fri Mar 22 08:28:08 2013
From: n0th1ng-mixer at yandex.ru (=?koi8-r?B?7cnIwcnMIPfR3sXTzMHXz9fJ3g==?=)
Date: Fri, 22 Mar 2013 12:28:08 +0400
Subject: [rabbitmq-discuss] Increasing sending/receiving speed
Message-ID: <21291363940888@web19e.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/07782310/attachment.htm>

From tim at rabbitmq.com  Fri Mar 22 10:54:36 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 22 Mar 2013 10:54:36 +0000
Subject: [rabbitmq-discuss] Unacked messages going back in the queue
In-Reply-To: <1AAC2F07-0433-4BFF-BDD3-75580D8989C7@rabbitmq.com>
References: <CAKZAfCXuaozfzkXU_FTNL5RJpSWVjDyrSu2G1Vh5ezpMeaTbiQ@mail.gmail.com>
	<1AAC2F07-0433-4BFF-BDD3-75580D8989C7@rabbitmq.com>
Message-ID: <514C386C.2020307@rabbitmq.com>

Hi Pierpaolo!

On 03/22/2013 08:11 AM, Tim Watson wrote:
> If the channel is disappearing (because rabbit considers the connection to have dropped) then I would suggest configuring heartbeats in your client too ensure the connection stays alive.

Someone just kindly pointed out that you're using 3.0.4 - which means my 
advice isn't all that helpful as the server will negotiate heartbeats 
with the client by default (and pika has support for heartbeats). So my 
suspicion, is that if un-acked messages are disappearing and the client 
has not rejected them, that the connection must have been
disrupted somehow (network failure, packet loss, ?) causing the broker 
to re-queue them, or the consumer must have crashed or a channel error 
generated. Is there anything in the logs to indicate what might be 
happening?

Cheers,
Tim

From hamsterready at gmail.com  Fri Mar 22 11:05:15 2013
From: hamsterready at gmail.com (Hamster)
Date: Fri, 22 Mar 2013 12:05:15 +0100
Subject: [rabbitmq-discuss] Dead-Lettering Performance
In-Reply-To: <514AFAB7.4050704@rabbitmq.com>
References: <1ac86207-f897-47a6-bad5-ec9a9569d778@googlegroups.com>
	<514AFAB7.4050704@rabbitmq.com>
Message-ID: <CAO8rT0EYA4pGeDYoB9cXsrtwzKL0gaAA89avU-7o2OTCetm2mA@mail.gmail.com>

On 21 March 2013 13:19, Emile Joubert <emile at rabbitmq.com> wrote:
> On 20/03/13 15:11, Maciej Lopacinski wrote:
>> My question:
>>  - is it valid use of message expiration time?
>
> It is valid to use TTL to implement delayed delivery. Whether it will
> meet your expectations in this case is hard to say. If a message (to be
> delayed by 110s) is published before another message (to be delayed by
> 10s) to the same queue then they will be expired almost simultaneously
> after 110s.
Yes, I am aware of this and in my case I can change "queues granularity".

>>  - are there any caveats around dead-lettering performance?
>
> Dead-lettering a large number of messages could cause a spike in memory use.
Thanks for this, good to know.

>>  - are there any guarantees around dead-lettering performance?
>
> I'm not sure what kind of guarantee you require. The possible memory
> spike will be fixed in a future release.
>
>>  - does dead-lettering has same "priority" as others "internal
>> operations" in RabbitMQ broker?
>
> The Erlang scheduler treats processes performing dead-lettering the same
> as all the other broker processes.
Perfect.

Thank you for your reply Emile.

Cheers,
Maciej

From tim at rabbitmq.com  Fri Mar 22 11:24:47 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 22 Mar 2013 11:24:47 +0000
Subject: [rabbitmq-discuss] Unacked messages going back in the queue
In-Reply-To: <514C386C.2020307@rabbitmq.com>
References: <CAKZAfCXuaozfzkXU_FTNL5RJpSWVjDyrSu2G1Vh5ezpMeaTbiQ@mail.gmail.com>
	<1AAC2F07-0433-4BFF-BDD3-75580D8989C7@rabbitmq.com>
	<514C386C.2020307@rabbitmq.com>
Message-ID: <514C3F7F.1080806@rabbitmq.com>

On 03/22/2013 10:54 AM, Tim Watson wrote:
> Hi Pierpaolo!
>
> On 03/22/2013 08:11 AM, Tim Watson wrote:
>> If the channel is disappearing (because rabbit considers the 
>> connection to have dropped) then I would suggest configuring 
>> heartbeats in your client too ensure the connection stays alive.
>
> Someone just kindly pointed out that you're using 3.0.4 - which means 
> my advice isn't all that helpful as the server will negotiate 
> heartbeats with the client by default (and pika has support for 
> heartbeats). So my suspicion, is that if un-acked messages are 
> disappearing and the client has not rejected them, that the connection 
> must have been
> disrupted somehow (network failure, packet loss, ?) causing the broker 
> to re-queue them, or the consumer must have crashed or a channel error 
> generated. Is there anything in the logs to indicate what might be 
> happening?
>

In fact, depending on how you're interacting with the broker, that 
heartbeat might not get handled by pika and the broker will disconnect 
you anyway. Are you using BlockingConnection by any chance?

> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Fri Mar 22 13:07:56 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 22 Mar 2013 13:07:56 +0000
Subject: [rabbitmq-discuss] Increasing sending/receiving speed
In-Reply-To: <21291363940888@web19e.yandex.ru>
References: <21291363940888@web19e.yandex.ru>
Message-ID: <514C57AC.1030209@rabbitmq.com>

Hi,

On 22/03/13 08:28, ?????? ???????????? wrote:
> I run RabbitMQ on my local machine and the consumer receives messages
> with the speed about 2500 messages per second. Is there the way to do it
> faster?

If messages are being published in persistent mode then turning that off
may help performance.

Setting a higher QoS value may improve throughput.

If the bottleneck is in the producer, due to use of transactions or
publishing synchronously, then fixing that will help.

Using auto-acks or acknowledging larger batches of messages will improve
throughput.

Batching lots of messages together and sending them as a single message
may help throughput, assuming you count the constituent messages.

You are likely to see higher throughput if you use more than one queue,
though that sacrifices message ordering, and complicates publishing as
well as consuming.




-Emile






From simon at rabbitmq.com  Fri Mar 22 13:17:57 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 22 Mar 2013 13:17:57 +0000
Subject: [rabbitmq-discuss] Increasing sending/receiving speed
In-Reply-To: <514C57AC.1030209@rabbitmq.com>
References: <21291363940888@web19e.yandex.ru> <514C57AC.1030209@rabbitmq.com>
Message-ID: <514C5A05.2010805@rabbitmq.com>

On 22/03/13 13:07, Emile Joubert wrote:
> Setting a higher QoS value may improve throughput.

I suspect that's the main issue. With a prefetch count of 10 you don't 
need much network latency to ensure that the server sends 10 messages... 
and then has to wait before acknowledgements arrive.

In some future version of RabbitMQ it would be nice to indicate when a 
consumer is effectively being throttled by a low prefetch count. One day...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Mar 22 13:21:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 22 Mar 2013 13:21:01 +0000
Subject: [rabbitmq-discuss] Increasing sending/receiving speed
In-Reply-To: <21291363940888@web19e.yandex.ru>
References: <21291363940888@web19e.yandex.ru>
Message-ID: <514C5ABD.8070400@rabbitmq.com>

On 22/03/13 08:28, ?????? ???????????? wrote:
>                      System.out.println(" [" +  +(i++) +"] Received " +
> mess.getHeader());

Also: this is going to slow you way down! Terminal emulators are not 
that fast...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From pierpaolo at dropbox.com  Fri Mar 22 13:24:50 2013
From: pierpaolo at dropbox.com (Pierpaolo Baccichet)
Date: Fri, 22 Mar 2013 06:24:50 -0700
Subject: [rabbitmq-discuss] Unacked messages going back in the queue
In-Reply-To: <514C3F7F.1080806@rabbitmq.com>
References: <CAKZAfCXuaozfzkXU_FTNL5RJpSWVjDyrSu2G1Vh5ezpMeaTbiQ@mail.gmail.com>
	<1AAC2F07-0433-4BFF-BDD3-75580D8989C7@rabbitmq.com>
	<514C386C.2020307@rabbitmq.com> <514C3F7F.1080806@rabbitmq.com>
Message-ID: <CAKZAfCWaTNDdyoWnK2vAcfJvvg89jYfEwLPE8xpTROs3j=Vz7w@mail.gmail.com>

Hello Tim,

Thanks for the answer! I am skeptical this is due to a network event (I am
running this test extremely isolated on a local VM) and rather think it's
due to some interactions with the client code.

I should have clarified that I am running pika 0.9 with a SelectConnection.
I build a custom library on top of that to deal with my cluster
configuration but the bottom line that I think it's problematic is that I
am handling the processing of the message straight on the IOLoop thread.
This, as you hinted, prevents pika from handling/sending heartbeats
properly. I can fix this in two ways:

1) move the actual processing to a separate thread and let the ioloop go
unstuck. While this is obviously the more straightforward fix, it involves
actually a few changes to my curent structure that I am trying to punt on
2) increase the heartbeat timeout.

For option 2), what is the internal timeout set in Rabbit? Can I increase
it from the client on a per channel basis?

Best, Pier


On Fri, Mar 22, 2013 at 4:24 AM, Tim Watson <tim at rabbitmq.com> wrote:

> On 03/22/2013 10:54 AM, Tim Watson wrote:
>
>> Hi Pierpaolo!
>>
>> On 03/22/2013 08:11 AM, Tim Watson wrote:
>>
>>> If the channel is disappearing (because rabbit considers the connection
>>> to have dropped) then I would suggest configuring heartbeats in your client
>>> too ensure the connection stays alive.
>>>
>>
>> Someone just kindly pointed out that you're using 3.0.4 - which means my
>> advice isn't all that helpful as the server will negotiate heartbeats with
>> the client by default (and pika has support for heartbeats). So my
>> suspicion, is that if un-acked messages are disappearing and the client has
>> not rejected them, that the connection must have been
>> disrupted somehow (network failure, packet loss, ?) causing the broker to
>> re-queue them, or the consumer must have crashed or a channel error
>> generated. Is there anything in the logs to indicate what might be
>> happening?
>>
>>
> In fact, depending on how you're interacting with the broker, that
> heartbeat might not get handled by pika and the broker will disconnect you
> anyway. Are you using BlockingConnection by any chance?
>
>
>  Cheers,
>> Tim
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/acfbe3b2/attachment.htm>

From watson.timothy at gmail.com  Fri Mar 22 13:58:46 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 22 Mar 2013 13:58:46 +0000
Subject: [rabbitmq-discuss] Unacked messages going back in the queue
In-Reply-To: <CAKZAfCWaTNDdyoWnK2vAcfJvvg89jYfEwLPE8xpTROs3j=Vz7w@mail.gmail.com>
References: <CAKZAfCXuaozfzkXU_FTNL5RJpSWVjDyrSu2G1Vh5ezpMeaTbiQ@mail.gmail.com>
	<1AAC2F07-0433-4BFF-BDD3-75580D8989C7@rabbitmq.com>
	<514C386C.2020307@rabbitmq.com> <514C3F7F.1080806@rabbitmq.com>
	<CAKZAfCWaTNDdyoWnK2vAcfJvvg89jYfEwLPE8xpTROs3j=Vz7w@mail.gmail.com>
Message-ID: <65B5B007-0D21-49BF-A85F-B30D48E903D8@gmail.com>

Hi

On 22 Mar 2013, at 13:24, Pierpaolo Baccichet wrote:
> 
> For option 2), what is the internal timeout set in Rabbit? Can I increase it from the client on a per channel basis?
> 

I can't remember what the default is, but yes, you can increase it from the client on a per *connection* basis.

Cheers,
Tim

From tim at rabbitmq.com  Fri Mar 22 14:09:51 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 22 Mar 2013 14:09:51 +0000
Subject: [rabbitmq-discuss] Unacked messages going back in the queue
In-Reply-To: <65B5B007-0D21-49BF-A85F-B30D48E903D8@gmail.com>
References: <CAKZAfCXuaozfzkXU_FTNL5RJpSWVjDyrSu2G1Vh5ezpMeaTbiQ@mail.gmail.com>
	<1AAC2F07-0433-4BFF-BDD3-75580D8989C7@rabbitmq.com>
	<514C386C.2020307@rabbitmq.com> <514C3F7F.1080806@rabbitmq.com>
	<CAKZAfCWaTNDdyoWnK2vAcfJvvg89jYfEwLPE8xpTROs3j=Vz7w@mail.gmail.com>
	<65B5B007-0D21-49BF-A85F-B30D48E903D8@gmail.com>
Message-ID: <5E84611D-4604-4324-89BF-954BD536FAC4@rabbitmq.com>

On 22 Mar 2013, at 13:58, Tim Watson wrote:
> I can't remember what the default is, but yes, you can increase it from the client on a per *connection* basis.
> 

That's a bit lazy of me. The default is 600 seconds.

Cheers,
Tim

> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From ward.mark at gmail.com  Fri Mar 22 15:03:20 2013
From: ward.mark at gmail.com (Mark Ward)
Date: Fri, 22 Mar 2013 08:03:20 -0700 (PDT)
Subject: [rabbitmq-discuss] Timeout blocking or blocked connections
Message-ID: <1363964600553-25665.post@n5.nabble.com>

Hi,

I am running RabbitMQ 3.0.4, Erlang R16B on Ubuntu 12.04. 

Will RabbitMQ close/timeout a connection in a blocked or blocking state if
the client is no longer connected to the server?  

It appears a connection with a timeout and not properly closed does not get
cleaned up by the RabbitMQ server after the specified timeout has elapsed if
the connection is in a blocked and blocking state.  The RabbitMQ server is
still currently in a flow control state if this impacts its ability to clean
these connections.  The unacknowledged messages sent to the currently
blocked connections are also still locked up in the flow control.

I am working to improve my framework when a server invokes flow control.  I
am purposefully pushing the rabbitMQ server into a flow control state.  I
have seen this before and it appears to be repeatable.

I am concerned that during production if a client connection is closed
incorrectly while under a blocked or blocking state any unacknowledged
messages will continue to be held by these connections and would require
administration intervention to resolve the issue.  

-Mark



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Timeout-blocking-or-blocked-connections-tp25665.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From sleibman at gmail.com  Fri Mar 22 15:06:38 2013
From: sleibman at gmail.com (Steve Leibman)
Date: Fri, 22 Mar 2013 08:06:38 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit client works from one machine but not
 another
In-Reply-To: <31EF352E-3D4C-4C8D-9ADC-FF260B3157A6@rabbitmq.com>
References: <d214b06c-681b-432a-b5bf-3f7c285ba207@googlegroups.com>
	<452feced-fd44-4653-a8a0-9d176b9b96a6@googlegroups.com>
	<31EF352E-3D4C-4C8D-9ADC-FF260B3157A6@rabbitmq.com>
Message-ID: <8625ba3c-c6e2-4e47-bc19-8b3c134b4242@googlegroups.com>

Hmm. Right. There is probably some sort of packet filtering in my way, but 
I don't know how to tell, or in this case, how I can get it turned off.
Going for an ssh tunneling solution instead...

On Friday, March 22, 2013 3:59:28 AM UTC-4, hyperthunk wrote:
>
> Hi,
>
> Just because you can open a socket doesn't mean the whole protocol is 
> going to work. Are you sure no packet filtering goes on in the troublesome 
> location?
>
> On 21 Mar 2013, at 17:28, Steve Leibman <slei... at gmail.com <javascript:>> 
> wrote:
>
> Update: these same observations are true even if I point my clients to 
> dev.rabbitmq.com.
> I can connect to 5672 on dev.rabbitmq.com from either machine (e.g. using 
> telnet), but my rabbit client fails from one of the two machines with the 
> exception shown previously.
>
> On Thursday, March 21, 2013 1:17:43 PM UTC-4, Steve Leibman wrote:
>>
>> Hi,
>>
>> I have RabbitMQ client code (I've reproduced the issue with just the 
>> sample consumer code from 
>> http://www.rabbitmq.com/tutorials/tutorial-one-java.html ) that works 
>> fine from one machine, but not from another (both attempting to connect to 
>> the same broker/server). The machine that fails to run this successfully is 
>> in a completely different location, with its own firewall rules, so the 
>> first obvious thing to check is connectivity to tcp port 5672 on the server 
>> machine, and I have confirmed (via both "telnet <hostname> 5672" and via a 
>> simple java program that runs new Socket("<hostname>", 5672) ) that 
>> basic connectivity works fine.
>>
>> My exception stack trace is shown below.
>>
>> Any suggestions for next steps?
>>
>> Exception in thread "main" java.io.IOException
>> at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
>> at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
>> at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:360)
>> at 
>> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:516)
>> at 
>> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:533)
>> at Recv.main(Recv.java:15)
>> Caused by: com.rabbitmq.client.ShutdownSignalException: connection error; 
>> reason: java.net.SocketException: Connection reset
>> at 
>> com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
>> at 
>> com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
>> at 
>> com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
>> at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:313)
>> ... 3 more
>> Caused by: java.net.SocketException: Connection reset
>> at java.net.SocketInputStream.read(SocketInputStream.java:189)
>> at java.net.SocketInputStream.read(SocketInputStream.java:121)
>> at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)
>> at java.io.BufferedInputStream.read(BufferedInputStream.java:254)
>> at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:288)
>> at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
>> at 
>> com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:131)
>> at 
>> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:515)
>>
>> Thanks,
>> Steve Leibman
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/98307430/attachment.htm>

From pierpaolo at dropbox.com  Fri Mar 22 15:31:51 2013
From: pierpaolo at dropbox.com (Pierpaolo Baccichet)
Date: Fri, 22 Mar 2013 08:31:51 -0700
Subject: [rabbitmq-discuss] Unacked messages going back in the queue
In-Reply-To: <5E84611D-4604-4324-89BF-954BD536FAC4@rabbitmq.com>
References: <CAKZAfCXuaozfzkXU_FTNL5RJpSWVjDyrSu2G1Vh5ezpMeaTbiQ@mail.gmail.com>
	<1AAC2F07-0433-4BFF-BDD3-75580D8989C7@rabbitmq.com>
	<514C386C.2020307@rabbitmq.com> <514C3F7F.1080806@rabbitmq.com>
	<CAKZAfCWaTNDdyoWnK2vAcfJvvg89jYfEwLPE8xpTROs3j=Vz7w@mail.gmail.com>
	<65B5B007-0D21-49BF-A85F-B30D48E903D8@gmail.com>
	<5E84611D-4604-4324-89BF-954BD536FAC4@rabbitmq.com>
Message-ID: <CAKZAfCU-tsj3n+e42SCuaf4JyfRXC1PZGWK=5Fp7P2ceZgZ=uw@mail.gmail.com>

Thanks Tim,

I'll give it a shot!


On Fri, Mar 22, 2013 at 7:09 AM, Tim Watson <tim at rabbitmq.com> wrote:

> On 22 Mar 2013, at 13:58, Tim Watson wrote:
> > I can't remember what the default is, but yes, you can increase it from
> the client on a per *connection* basis.
> >
>
> That's a bit lazy of me. The default is 600 seconds.
>
> Cheers,
> Tim
>
> > Cheers,
> > Tim
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/9ca90b80/attachment.htm>

From emile at rabbitmq.com  Fri Mar 22 16:28:02 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 22 Mar 2013 16:28:02 +0000
Subject: [rabbitmq-discuss] Timeout blocking or blocked connections
In-Reply-To: <1363964600553-25665.post@n5.nabble.com>
References: <1363964600553-25665.post@n5.nabble.com>
Message-ID: <514C8692.3010501@rabbitmq.com>


Hi Mark,

On 22/03/13 15:03, Mark Ward wrote:
> Will RabbitMQ close/timeout a connection in a blocked or blocking state if
> the client is no longer connected to the server?  

No, this is known issue. The symptom is that connections that were shut
while blocked remain visible in the output of
"rabbitmqctl list_connections"

No workaround is known at the moment, and the problem appears very
difficult to solve so a solution is not likely to be released soon. The
release notes will contain an announcement when it gets fixed.



-Emile






From simon at rabbitmq.com  Fri Mar 22 16:55:10 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 22 Mar 2013 16:55:10 +0000
Subject: [rabbitmq-discuss] Timeout blocking or blocked connections
In-Reply-To: <1363964600553-25665.post@n5.nabble.com>
References: <1363964600553-25665.post@n5.nabble.com>
Message-ID: <514C8CEE.8030105@rabbitmq.com>

On 22/03/13 15:03, Mark Ward wrote:
> I am concerned that during production if a client connection is closed
> incorrectly while under a blocked or blocking state any unacknowledged
> messages will continue to be held by these connections and would require
> administration intervention to resolve the issue.

As Emile said, you are correct that closed connections will not get 
detected while blocked - this is just very hard to do with the sockets API.

However, connections should not stay blocked forever. As soon as the 
memory/disk alarm clears, or flow control issues more credit, the 
connection will notice that it's disconnected and terminate.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mike.dorrell at telcentris.com  Fri Mar 22 16:27:35 2013
From: mike.dorrell at telcentris.com (mike.dorrell at telcentris.com)
Date: Fri, 22 Mar 2013 09:27:35 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I get a count of messages in a queue
 with a certain correlation_id
Message-ID: <e1098241-7266-42b8-ac65-f4fc4363cc7d@googlegroups.com>

I am trying to find a way to get percentage of a batch job that is still 
pending, and I am using the correlation_id to group messages. I want to be 
able to find out how many messages in a queue have a certain 
correlation_id. I currently have a loop of Gets() that checks each message, 
but that marks the messages as viewed, and seems to be a bit inconsistent. 

Is there a better way to get a count of messages in a queue with a certain 
correlation_id?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/1a1b2729/attachment.htm>

From emile at rabbitmq.com  Fri Mar 22 17:36:13 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 22 Mar 2013 17:36:13 +0000
Subject: [rabbitmq-discuss] How can I get a count of messages in a queue
 with a certain correlation_id
In-Reply-To: <e1098241-7266-42b8-ac65-f4fc4363cc7d@googlegroups.com>
References: <e1098241-7266-42b8-ac65-f4fc4363cc7d@googlegroups.com>
Message-ID: <514C968D.9030303@rabbitmq.com>


Hi Mike,

On 22/03/13 16:27, mike.dorrell at telcentris.com wrote:
> Is there a better way to get a count of messages in a queue with a
> certain correlation_id?

RabbitMQ queues do not support queue browsing at the time of writing, so
retrieving and requeueing messages is the only way of solving the
problem with a single queue.

A possible alternative is to route messages based on correlation_id and
use the queue length.



-Emile







From jonathan.newbrough at gyregroup.com  Fri Mar 22 18:39:31 2013
From: jonathan.newbrough at gyregroup.com (jonathan.newbrough at gyregroup.com)
Date: Fri, 22 Mar 2013 11:39:31 -0700 (PDT)
Subject: [rabbitmq-discuss] one thread is consistently slower than another
Message-ID: <07cd953d-5873-4c70-bd9d-049c753269ba@googlegroups.com>

I'm seeing really odd application performance and hoping for good ideas.

My application starts lots of threads that each subscribe to a queue.  When 
they receive a message, they persist to an NFS store, then publish a new 
message back to rabbit.  As the application runs, new "pathways" of data 
are created -- additional sources of data, additional queues, additional 
threads to persist the data.  Each thread reports the time taken to process 
each message (averaged over 100 messages).

I expected a distribution of time to handle each message, with the average 
gradually increasing with increasing load.  When I look at a graph of all 
these data points (average time to process message versus clock time) it 
looks a lot as I would expect.  You can see an example here<https://confluence.oceanobservatories.org/display/CIDev/Scale+Test+Results+Mar21>(second graph on page), but this has been reproduced each time I start to 
put load on the system.

But then when I single out individual threads, they follow very distinct 
paths on this graph.  For example, if I compare two threads A and B, I see 
that one thread may always take 0.5sec longer to process messages.  The 
performance of both threads rise and fall in parallel lines, but one thread 
is consistently slower than another!  It seems that the earlier the thread 
is started within the VM, the faster it can publish.  But as the 
cloud-based system grows and starts new VMs running the same application, 
new threads on the new VM perform as fast as the first threads on an 
earlier VM (so the performance drops off as the VM has been running longer 
-- not as the system or broker load grows).

The broker VM shows very low utilization (<10% CPU used on 4-core system, 
only 25% of 2GB RAM used).  The application VM grows until it reaches about 
65% CPU, memory shows 35% of 4GB used.  Message rates are relatively low -- 
growing from 0 to ~150msgs/sec with avg size ~500bytes.

I wish I could give you a nice easy code snippet to reproduce, but it will 
take some effort to extract a faithful reproduction from our complex 
publisher/subscriber/data process OO wrappings.  I'm hoping from the 
description, someone can point me at some possible explanations.

Many thanks for any suggestions or ideas!
Jonathan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/a5ab9c39/attachment.htm>

From jonathan.newbrough at gyregroup.com  Fri Mar 22 20:48:24 2013
From: jonathan.newbrough at gyregroup.com (jonathan.newbrough at gyregroup.com)
Date: Fri, 22 Mar 2013 13:48:24 -0700 (PDT)
Subject: [rabbitmq-discuss] one thread is consistently slower than
	another
In-Reply-To: <07cd953d-5873-4c70-bd9d-049c753269ba@googlegroups.com>
References: <07cd953d-5873-4c70-bd9d-049c753269ba@googlegroups.com>
Message-ID: <0b2a310c-7965-4461-8f70-effdd2155b28@googlegroups.com>

A few details in case they matter:

> RabbitMQ  v2.7.1
> erlang 5.8.5
> client python library pika 0.9.5
> python version 2.7
> rabbit and clients running on CentOS 6.2
> rabbit VM has 2GB RAM, 8 cores (I mistakenly said 4-cores in the original 
posting)
> client VM has 4GB RAM, 4 cores
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/d9e98fbb/attachment.htm>

From carl.hoerberg at gmail.com  Sat Mar 23 02:47:28 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 22 Mar 2013 19:47:28 -0700 (PDT)
Subject: [rabbitmq-discuss] "Other process memory" growth
Message-ID: <1364006848624-25675.post@n5.nabble.com>

Have a 3 node cluster, normally it hovers around 200-300mb of ram, but
suddenly the "Other process memory" started to grow:

https://www.dropbox.com/s/lhnjvnzf2rilwox/Screen%20Shot%202013-03-23%20at%2010.32.43.png

I restarted it (when it reached 5GB) but then the other nodes also raised
their "Other process memory" use too. What may be the reason for that? The
docs (http://www.rabbitmq.com/memory-use.html) aren't too clear to me. 

I can see a very high deliver/redeliver rate, compared to publish rate, may
that be a clue? 

RabbitMQ 3.0.4, Erlang R14B04. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Other-process-memory-growth-tp25675.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Sat Mar 23 03:01:54 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 22 Mar 2013 20:01:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Bring cluster up after node crash
In-Reply-To: <C2115F08-6BB0-413A-A4CF-A81CFC7D97DD@rabbitmq.com>
References: <A674608A754C4DDB8CCD0643F9A192C2@gmail.com>
	<59E427F8-BE70-429B-873F-C6CE2632DCA4@rabbitmq.com>
	<C2115F08-6BB0-413A-A4CF-A81CFC7D97DD@rabbitmq.com>
Message-ID: <1364007714597-25676.post@n5.nabble.com>

RabbitMQ 3.0.4, Erlang R14B04. Ubuntu 12.04, installed with apt-get install
from your ppa, nothing custom at all. 

Nothing exciting in the config:
[
  {rabbit, [
     {log_levels, [{connection, error}]},
     {vm_memory_high_watermark, 0.8},
     {tcp_listeners, [{"0.0.0.0", 5672}]},
     {ssl_listeners, [{"0.0.0.0", 5671}]},
     {ssl_options, [{cacertfile,"/etc/rabbitmq/ca.pem"},
                    {certfile,"/etc/rabbitmq/key.pem"}
		   ]}
   ]},
{rabbitmq_management,
  [{listener, [{port, 15672},
               {ip, "0.0.0.0"},
		{ssl,      true}
              ]}
  ]}
].

Only the mgmt plugin enabled. 

I had no problems with file corruption as far as i know. 

Yes, I was "killing" the nodes, with kill -9

No, haven't touched the backing queue or anything like that. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Bring-cluster-up-after-node-crash-tp25530p25676.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From watson.timothy at gmail.com  Sat Mar 23 12:37:00 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 23 Mar 2013 12:37:00 +0000
Subject: [rabbitmq-discuss] Bring cluster up after node crash
In-Reply-To: <1364007714597-25676.post@n5.nabble.com>
References: <A674608A754C4DDB8CCD0643F9A192C2@gmail.com>
	<59E427F8-BE70-429B-873F-C6CE2632DCA4@rabbitmq.com>
	<C2115F08-6BB0-413A-A4CF-A81CFC7D97DD@rabbitmq.com>
	<1364007714597-25676.post@n5.nabble.com>
Message-ID: <E25720D6-9C01-47C7-BDE7-654146D03BD3@rabbitmq.com>

Hi

On 23 Mar 2013, at 03:01, carlhoerberg <carl.hoerberg at gmail.com> wrote:
> RabbitMQ 3.0.4, Erlang R14B04. Ubuntu 12.04, installed with apt-get install
> from your ppa, nothing custom at all. 
> 

I would strongly advise you to upgrade to the latest erlang if possible. Many very important bug fixed have been incorporated since R14B.

> I had no problems with file corruption as far as i know. 
> 
[snip]
> Yes, I was "killing" the nodes, with kill -9
> 

You shouldn't (have to) be doing that, obviously. It's possible (though somewhat unlikely) that a brutal kill might've let your file system in an inconsistent state.

> No, haven't touched the backing queue or anything like that. 
> 

Is there anything else in the logs you can give us to go on?

> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Bring-cluster-up-after-node-crash-tp25530p25676.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.justin at gmx.net  Sat Mar 23 14:33:17 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Sat, 23 Mar 2013 15:33:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ in Ubuntu 13.04
Message-ID: <kikefb$hcp$1@ger.gmane.org>

Hello,

I found this page which looks like Ubuntu 13.04 ("ubuntu 
raring-proposed") includes RabbitMQ 3.0.2:

https://launchpad.net/ubuntu/raring/amd64/rabbitmq-server

Is there already information about the version included in final Ubuntu 
13.04?

Regards
-- 
Michael Justin


From lars.ellebo at schneider-electric.com  Sat Mar 23 23:00:01 2013
From: lars.ellebo at schneider-electric.com (lars.ellebo at schneider-electric.com)
Date: Sun, 24 Mar 2013 00:00:01 +0100
Subject: [rabbitmq-discuss] Lars Ellebo is out of the office.
Message-ID: <OFDB4D26C9.4BEF1993-ONC1257B37.007E5832-C1257B37.007E5832@schneider-electric.com>


I will be out of the office starting  23-03-2013 and will not return until
02-04-2013.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130324/0f1cf532/attachment.htm>

From 0x6e6562 at gmail.com  Sat Mar 23 23:06:52 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 23 Mar 2013 23:06:52 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
Message-ID: <19164406BD624090AB5BF53AFC73C012@gmail.com>

Hey Tim, 


On Friday, 22 March 2013 at 07:55, Tim Watson wrote:

> Yeah with the current implementation you'd need to install your own log handler to make that work. In terms of changing the output format though, allowe to play devil's advocate for a moment...
> 
> The info/progress/error reports have a lot of data in them, process stats, stack traces, etc. are you wanting to see all that plonked on one single long line? Because I can see how that'd make parsing/aggregating easier, but not reading them. Does the lager output fit exactly with what you want (I've not looks at it or a couple of years)?
I don't think that everything needs to fit on one line. Longer traces which provide good context should probably remain as multiline entries. However, info items, for example, 

Mar 22 22:33:01 a rabbit3:  =INFO REPORT==== 22-Mar-2013::22:33:01 === 
Mar 22 22:33:01 a rabbit3:  Setting permissions for 'guest' in '/' to '.*', '.*', '.*' 


need not get split up over two lines.

With regard to longer traces, it would be nice if they could be handled in such a way that the generic portion of the call stack were trimmed down to something nearer the actual call site, rather that the entire generic call trace. As inspiration, logback mitigates the default "root cause comes last" behavior in Java with the reverse depth layout modifier (rEx{depth}). Lot's of hand waving here though.

Finally, I do have to concur with Gavin on people's perception about Rabbit due to logging - I've have many conversations with people over the years who ask why Rabbit has such bizare logging - I've generally answered that this is an Erlang-ism, and though it is strange, the server kind of serves its primary function well (i.e. delivering messages), so just put up with it.

Cheers,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130323/4afb2e48/attachment.htm>

From gmr at meetme.com  Sun Mar 24 06:18:39 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Sun, 24 Mar 2013 02:18:39 -0400
Subject: [rabbitmq-discuss] rmqid v0.2.0 released - a Python 2 & 3 client
	library (alpha)
Message-ID: <7EA0B3A1DCBA4BE5936224C967760886@meetme.com>

I am pleased to announce the alpha release of rmqid 0.2.0. 

rmqid is an experimental library designed to make interacting with RabbitMQ via python a more pleasant experience. It is BSD licensed and currently supports Python 2.6, 2.7 and 3.3. I do not consider this a replacement for Pika, which I fully intend to continue supporting, developing and maintaining. rmqid will most likely never support an asynchronous programming model and aims to create a low barrier to entry, sacrificing the more low-level API that Pika provides.

Please note that I do not consider the library stable and it is not intended for production use at this point. I consider the code alpha quality and am releasing v0.2.0 for feedback and testing. There are numerous yet to be implemented features.

You can install rmqid via the python package index: pip install rmqid

The github repo is located at https://github.com/gmr/rmqid and documentation is coming but currently not available. Be sure to checkout the README and the code in the GitHub repo for more information.

A few of the notable features:

The API for rmqid follows the AMQP specification contextually, yet does not always go back to the channel (from an API perspective) for communicating with RabbitMQ. Instead, the RPC methods are called on the Class objects themselves, only referencing the channel in the construction of the class object:

    connection = rmqid.Connection('amqp://guest:guest at localhost:5672/%2F')
    channel = connection.channel()

    exchange = rmqid.Exchange(channel, 'test-exchange', 'topic')
    exchange.bind()

    queue = rmqid.Queue(channel, 'test-channel')
    queue.declare()
    queue.bind(exchange, 'test-routing-key')
    print 'There are %i messages in the queue' % len(queue)

Connections and Channels can act as context managers:

    with rmqid.Connection('amqp://guest:guest at localhost:5672/%2F') as connection:
    with connection.channel() as channel:
      queue = rmqid.Queue(channel, 'my-test-queue')
      queue.declare()

Messages are consumed using a Queue.consumer() provided context manager that provides a Consumer.next_message() generator method:

  with queue.consumer() as consumer:
    for message in consumer.next_message():
      print message.body
      message.ack()

Messages are core objects in rmqid and interacted with like any other object, Basic.Publish is invoked by calling the publish method on the Message object itself:

  message_body = 'This is my message'
  properties = {'app_id': 'test', 'content_type': 'text/plain', 'delivery_mode': 1}
  message = rmqid.Message(channel, message_body, properties)
  message.publish('test-exchange', 'routing-key')

If you're brave enough to play around with rmqid at this point, please submit bug reports and feature requests at https://github.com/gmr/rmqid/issues.

Cheers,

Gavin 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130324/46fb1bb7/attachment.htm>

From carl.hoerberg at gmail.com  Mon Mar 25 04:55:34 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sun, 24 Mar 2013 21:55:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Bring cluster up after node crash
In-Reply-To: <E25720D6-9C01-47C7-BDE7-654146D03BD3@rabbitmq.com>
References: <A674608A754C4DDB8CCD0643F9A192C2@gmail.com>
	<59E427F8-BE70-429B-873F-C6CE2632DCA4@rabbitmq.com>
	<C2115F08-6BB0-413A-A4CF-A81CFC7D97DD@rabbitmq.com>
	<1364007714597-25676.post@n5.nabble.com>
	<E25720D6-9C01-47C7-BDE7-654146D03BD3@rabbitmq.com>
Message-ID: <1364187334769-25682.post@n5.nabble.com>

What's the recommended way of using a recent erlang version and rabbitmq in
ubuntu? 
erlang-solutions and your ubuntu package doesn't seem to play well together,
found this "hack" though, https://gist.github.com/RJ/2284940

We had to "kill" them, as rabbitmqctl stop didn't respond at all.. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Bring-cluster-up-after-node-crash-tp25530p25682.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ninuhadida at gmail.com  Mon Mar 25 07:35:04 2013
From: ninuhadida at gmail.com (Jean Paul Galea)
Date: Mon, 25 Mar 2013 08:35:04 +0100
Subject: [rabbitmq-discuss] Bring cluster up after node crash
In-Reply-To: <1364187334769-25682.post@n5.nabble.com>
References: <A674608A754C4DDB8CCD0643F9A192C2@gmail.com>
	<59E427F8-BE70-429B-873F-C6CE2632DCA4@rabbitmq.com>
	<C2115F08-6BB0-413A-A4CF-A81CFC7D97DD@rabbitmq.com>
	<1364007714597-25676.post@n5.nabble.com>
	<E25720D6-9C01-47C7-BDE7-654146D03BD3@rabbitmq.com>
	<1364187334769-25682.post@n5.nabble.com>
Message-ID: <514FFE28.5050409@gmail.com>

I ran into the same problem when installing Erlang from erlang-solutions.

The problem is with the dependency "erlang-nox" which is declared in the 
RabbitMQ package. This package is a meta-package which tries to install 
erlang packages from the Ubuntu repository, conflicting with the ones 
from erlang-solutions.

I also found the hack that you are linking to, but I think it can be 
done more elegantly.

I wrote this simple bash script; fetches rabbitmq-server package using 
apt-get, drops the erlang-nox dependency and installs it.

One thing that may bother you is that apt-get will always flag 
rabbitmq-server as "upgradeable", since the installed package differs 
from the one in the repo.

However, if you do something like `apt-get update && apt-get upgrade && 
apt-get dist-upgrade` it will __not__ automatically re-install the package.

Also note that the script does not actually remove the "erlang-nox" 
dependency, rather it simply replaces the whole line with "adduser, 
logrotate", hence if the RabbitMQ team declares a new dependency, this 
script would need to be updated.

------------------------

cat > /tmp/rabbitmq-install.sh << "EOF"
#!/bin/bash

TMPDIR1=`mktemp -d` || exit 99
TMPDIR2=`mktemp -d` || exit 99
trap 'rm -rf "$TMPDIR1" "$TMPDIR2"' 0 1 2 3 13 15

cd $TMPDIR1

/usr/bin/apt-get download rabbitmq-server || exit 1

PACKAGE=`ls -1`

/usr/bin/dpkg-deb --extract $PACKAGE $TMPDIR2
/usr/bin/dpkg-deb --control $PACKAGE ${TMPDIR2}/DEBIAN
sed --in-place 's/^Depends:.*$/Depends: adduser, logrotate/' 
${TMPDIR2}/DEBIAN/control
/usr/bin/dpkg --build $TMPDIR2 ${PACKAGE}.modified
/usr/bin/dpkg --install ${PACKAGE}.modified
EOF

/bin/bash /tmp/rabbitmq-install.sh

rm /tmp/rabbitmq-install.sh


On 03/25/2013 05:55 AM, carlhoerberg wrote:
> What's the recommended way of using a recent erlang version and rabbitmq in
> ubuntu?
> erlang-solutions and your ubuntu package doesn't seem to play well together,
> found this "hack" though, https://gist.github.com/RJ/2284940
>
> We had to "kill" them, as rabbitmqctl stop didn't respond at all..
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Bring-cluster-up-after-node-crash-tp25530p25682.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From michael.s.klishin at gmail.com  Mon Mar 25 09:06:29 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 25 Mar 2013 13:06:29 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 1.0 is released
Message-ID: <CAE3HoVQrXVvzNQT0i916Ragd6h-wcOOVvr=iKOMNhFbobhWToA@mail.gmail.com>

I'm happy to announced that amqp gem 1.0 was released to rubygems.org [1]
yesterday,
after almost 5 years in the making.

The release is based on 0.9.10 with a few long deprecated API bits removed.
So, if you
already run 0.9.10 or a reasonably recent 0.9.x release, it should be a
trivial upgrade.

You can learn more about why now is the right time to ship 1.0 and what's
ahead for
one of the oldest RabbitMQ clients:
http://blog.rubyrabbitmq.info/blog/2013/03/24/amqp-gem-1-dot-0-is-released/

I'd like to thank everyone who contributed code, documentation
improvements, bug reports,
and API design suggestions over the years. VMware for sponsoring a major
overhaul of
the library in 2010-2011. People who provided access to production machines
so that we
could investigate system-specific problems and concurrency issues that only
showed up
at scale.

I'm especially thankful to Chris Duncan and Alex Petrov who helped make
http://rubyamqp.info
as good as it is. The docs is the feature I am most proud of.

Here's to 1.1 in a few months!

1. https://rubygems.org/gems/amqp/versions/1.0.0
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130325/95419b86/attachment.htm>

From luodaidong at sina.com  Mon Mar 25 09:58:54 2013
From: luodaidong at sina.com (luodaidong)
Date: Mon, 25 Mar 2013 02:58:54 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq 2.7.1 crash
Message-ID: <1364205534973-25685.post@n5.nabble.com>

just run load testing. then crash log is as following, how can I find where
is miss configure. I knows little about rabbitMQ, who can help me?

=CRASH REPORT==== 22-Mar-2013::10:28:59 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.108.0>
    registered_name: []
    exception exit: {bad_return,{{rabbit,start,[normal,[]]},
                                 {'EXIT',{rabbit,failure_during_boot}}}}
      in function  application_master:init/4 (application_master.erl, line
138)
    ancestors: [<0.107.0>]
    messages: [{'EXIT',<0.109.0>,normal}]
    links: [<0.107.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 246
  neighbours:

=CRASH REPORT==== 22-Mar-2013::10:50:13 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.108.0>
    registered_name: []
    exception exit: {bad_return,{{rabbit,start,[normal,[]]},
                                 {'EXIT',{rabbit,failure_during_boot}}}}
      in function  application_master:init/4 (application_master.erl, line
138)
    ancestors: [<0.107.0>]
    messages: [{'EXIT',<0.109.0>,normal}]
    links: [<0.107.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 246
  neighbours:

=CRASH REPORT==== 22-Mar-2013::11:00:20 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.108.0>
    registered_name: []
    exception exit: {bad_return,{{rabbit,start,[normal,[]]},
                                 {'EXIT',{rabbit,failure_during_boot}}}}
      in function  application_master:init/4 (application_master.erl, line
138)
    ancestors: [<0.107.0>]
    messages: [{'EXIT',<0.109.0>,normal}]
    links: [<0.107.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 246
  neighbours:






=INFO REPORT==== 22-Mar-2013::10:28:28 ===
Limiting to approx 65435 file handles (58889 sockets)

=ERROR REPORT==== 22-Mar-2013::10:28:58 ===
FAILED
Reason: {error,
            {timeout_waiting_for_tables,
                [rabbit_user,rabbit_user_permission,rabbit_vhost,
                 rabbit_durable_route,rabbit_durable_exchange,
                 rabbit_durable_queue]}}
Stacktrace: [{rabbit_mnesia,wait_for_tables,1,
                            [{file,"src/rabbit_mnesia.erl"},{line,719}]},
             {rabbit_mnesia,check_schema_integrity,0,
                            [{file,"src/rabbit_mnesia.erl"},{line,387}]},
             {rabbit_mnesia,ensure_schema_integrity,0,
                            [{file,"src/rabbit_mnesia.erl"},{line,372}]},
             {rabbit_mnesia,init,0,
                            [{file,"src/rabbit_mnesia.erl"},{line,101}]},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,
                     [{file,"src/rabbit.erl"},{line,431}]},
             {rabbit,run_boot_step,1,[{file,"src/rabbit.erl"},{line,430}]},
             {rabbit,'-start/2-lc$^0/1-0-',1,
                     [{file,"src/rabbit.erl"},{line,356}]},
             {rabbit,start,2,[{file,"src/rabbit.erl"},{line,356}]}]

=INFO REPORT==== 22-Mar-2013::10:28:59 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent

=INFO REPORT==== 22-Mar-2013::10:49:41 ===
Limiting to approx 65435 file handles (58889 sockets)

=ERROR REPORT==== 22-Mar-2013::10:50:12 ===
FAILED
Reason: {error,
            {timeout_waiting_for_tables,
                [rabbit_user,rabbit_user_permission,rabbit_vhost,
                 rabbit_durable_route,rabbit_durable_exchange,
                 rabbit_durable_queue]}}
Stacktrace: [{rabbit_mnesia,wait_for_tables,1,
                            [{file,"src/rabbit_mnesia.erl"},{line,719}]},
             {rabbit_mnesia,check_schema_integrity,0,
                            [{file,"src/rabbit_mnesia.erl"},{line,387}]},
             {rabbit_mnesia,ensure_schema_integrity,0,
                            [{file,"src/rabbit_mnesia.erl"},{line,372}]},
             {rabbit_mnesia,init,0,
                            [{file,"src/rabbit_mnesia.erl"},{line,101}]},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,
                     [{file,"src/rabbit.erl"},{line,431}]},
             {rabbit,run_boot_step,1,[{file,"src/rabbit.erl"},{line,430}]},
             {rabbit,'-start/2-lc$^0/1-0-',1,
                     [{file,"src/rabbit.erl"},{line,356}]},
             {rabbit,start,2,[{file,"src/rabbit.erl"},{line,356}]}]

=INFO REPORT==== 22-Mar-2013::10:50:13 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent

=INFO REPORT==== 22-Mar-2013::10:59:49 ===
Limiting to approx 65435 file handles (58889 sockets)

=ERROR REPORT==== 22-Mar-2013::11:00:19 ===
FAILED
Reason: {error,
            {timeout_waiting_for_tables,
                [rabbit_user,rabbit_user_permission,rabbit_vhost,
                 rabbit_durable_route,rabbit_durable_exchange,
                 rabbit_durable_queue]}}
Stacktrace: [{rabbit_mnesia,wait_for_tables,1,
                            [{file,"src/rabbit_mnesia.erl"},{line,719}]},
             {rabbit_mnesia,check_schema_integrity,0,
                            [{file,"src/rabbit_mnesia.erl"},{line,387}]},
             {rabbit_mnesia,ensure_schema_integrity,0,
                            [{file,"src/rabbit_mnesia.erl"},{line,372}]},
             {rabbit_mnesia,init,0,
                            [{file,"src/rabbit_mnesia.erl"},{line,101}]},
             {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,
                     [{file,"src/rabbit.erl"},{line,431}]},
             {rabbit,run_boot_step,1,[{file,"src/rabbit.erl"},{line,430}]},
             {rabbit,'-start/2-lc$^0/1-0-',1,
                     [{file,"src/rabbit.erl"},{line,356}]},
             {rabbit,start,2,[{file,"src/rabbit.erl"},{line,356}]}]

=INFO REPORT==== 22-Mar-2013::11:00:20 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-2-7-1-crash-tp25685.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Mon Mar 25 10:11:22 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 25 Mar 2013 10:11:22 +0000
Subject: [rabbitmq-discuss] rabbitmq 2.7.1 crash
In-Reply-To: <1364205534973-25685.post@n5.nabble.com>
References: <1364205534973-25685.post@n5.nabble.com>
Message-ID: <515022CA.3030908@rabbitmq.com>


Hi,

On 25/03/13 09:58, luodaidong wrote:
> Reason: {error,
>             {timeout_waiting_for_tables,
>                 [rabbit_user,rabbit_user_permission,rabbit_vhost,
>                  rabbit_durable_route,rabbit_durable_exchange,
>                  rabbit_durable_queue]}}


If you running in a clustered configuration then this node might be
waiting for the other nodes to come up. Try starting the other nodes in
the cluster. If that's not possible then you should clear the mnesia
directory.

You should also consider upgrading.



-Emile
















From emile at rabbitmq.com  Mon Mar 25 10:26:28 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 25 Mar 2013 10:26:28 +0000
Subject: [rabbitmq-discuss] RabbitMQ in Ubuntu 13.04
In-Reply-To: <kikefb$hcp$1@ger.gmane.org>
References: <kikefb$hcp$1@ger.gmane.org>
Message-ID: <51502654.8000405@rabbitmq.com>


Hi,

On 23/03/13 14:33, Michael Justin wrote:
> Is there already information about the version included in final Ubuntu 
> 13.04?


From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.0.1364207709.3387.rabbitmq-discuss@lists.rabbitmq.com>

will be at least v3.0.2-1.


From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.1.1364207709.3387.rabbitmq-discuss@lists.rabbitmq.com>

that any newer version will be included.

https://wiki.ubuntu.com/RaringRingtail/ReleaseSchedule



-Emile






From hxx437 at gmail.com  Sun Mar 24 23:57:06 2013
From: hxx437 at gmail.com (Joshua Xu)
Date: Sun, 24 Mar 2013 16:57:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq admin console showing "no connections"
	and "no channels".
Message-ID: <b5d74d54-802b-4545-a524-a7af61d28db0@googlegroups.com>

Installed Rabbitmq 3.0.4 on windows 7 machine. Logged in as "guest" and no 
connections and no channels". 

Here is the status I got . Please help me on this. 

C:\Program Files (x86)\RabbitMQ 
Server\rabbitmq_server-3.0.4\sbin>rabbitmqctl st
atus
Status of node 'rabbit at DAVID-PC' ...
[{pid,1648},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","3.0.4"},
      {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.0.4"},
      {webmachine,"webmachine","1.9.1-rmq3.0.4-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.4-gitd541e9a"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.4"},
      {rabbit,"RabbitMQ","3.0.4"},
      {os_mon,"CPO  CXC 138 46","2.2.11"},
      {inets,"INETS  CXC 138 49","5.9.4"},
      {mnesia,"MNESIA  CXC 138 12","4.8"},
      {amqp_client,"RabbitMQ AMQP Client","3.0.4"},
      {xmerl,"XML parser","1.3.3"},
      {sasl,"SASL  CXC 138 11","2.3.1"},
      {stdlib,"ERTS  CXC 138 10","1.19.1"},
      {kernel,"ERTS  CXC 138 10","2.16.1"}]},
 {os,{win32,nt}},
 {erlang_version,
     "Erlang R16B (erts-5.10.1) [64-bit] [smp:4:4] [async-threads:30]\n"},
 {memory,
     [{total,35673040},
      {connection_procs,5392},
      {queue_procs,5392},
      {plugins,185400},
      {other_proc,9808409},
      {mnesia,60480},
      {mgmt_db,47928},
      {msg_index,22608},
      {other_ets,1200416},
      {binary,131312},
      {code,19563913},
      {atom,662409},
      {other_system,3979381}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,6834718310},
 {disk_free_limit,1000000000},
 {disk_free,10381430784},
 {file_descriptors,
     [{total_limit,8092},
      {total_used,4},
      {sockets_limit,7280},
      {sockets_used,2}]},
 {processes,[{limit,1048576},{used,196}]},
 {run_queue,0},
 {uptime,166775}]
...done.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130324/368330e0/attachment.htm>

From tim at rabbitmq.com  Mon Mar 25 11:05:43 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 25 Mar 2013 11:05:43 +0000
Subject: [rabbitmq-discuss] Rabbitmq admin console showing "no
	connections" and "no channels".
In-Reply-To: <b5d74d54-802b-4545-a524-a7af61d28db0@googlegroups.com>
References: <b5d74d54-802b-4545-a524-a7af61d28db0@googlegroups.com>
Message-ID: <EE57156E-6233-4BD0-9FFD-18F21D553958@rabbitmq.com>

Joshua,

On 24 Mar 2013, at 23:57, Joshua Xu wrote:
> Installed Rabbitmq 3.0.4 on windows 7 machine. Logged in as "guest" and no connections and no channels". 
> 

Ok...

> Here is the status I got . Please help me on this. 
> 

That status looks fine. What do you want help with? Were you expecting to see some connections and channels? Are there connections/channels showing in the web admin GUI but not rabbitmqctl, or vice versa?

> C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-3.0.4\sbin>rabbitmqctl st
> atus
> Status of node 'rabbit at DAVID-PC' ...
> [{pid,1648},
>  {running_applications,
>      [{rabbitmq_management,"RabbitMQ Management Console","3.0.4"},
>       {rabbitmq_web_dispatch,"RabbitMQ Web Dispatcher","3.0.4"},
>       {webmachine,"webmachine","1.9.1-rmq3.0.4-git52e62bc"},
>       {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.4-gitd541e9a"},
>       {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.4"},
>       {rabbit,"RabbitMQ","3.0.4"},
>       {os_mon,"CPO  CXC 138 46","2.2.11"},
>       {inets,"INETS  CXC 138 49","5.9.4"},
>       {mnesia,"MNESIA  CXC 138 12","4.8"},
>       {amqp_client,"RabbitMQ AMQP Client","3.0.4"},
>       {xmerl,"XML parser","1.3.3"},
>       {sasl,"SASL  CXC 138 11","2.3.1"},
>       {stdlib,"ERTS  CXC 138 10","1.19.1"},
>       {kernel,"ERTS  CXC 138 10","2.16.1"}]},
>  {os,{win32,nt}},
>  {erlang_version,
>      "Erlang R16B (erts-5.10.1) [64-bit] [smp:4:4] [async-threads:30]\n"},
>  {memory,
>      [{total,35673040},
>       {connection_procs,5392},
>       {queue_procs,5392},
>       {plugins,185400},
>       {other_proc,9808409},
>       {mnesia,60480},
>       {mgmt_db,47928},
>       {msg_index,22608},
>       {other_ets,1200416},
>       {binary,131312},
>       {code,19563913},
>       {atom,662409},
>       {other_system,3979381}]},
>  {vm_memory_high_watermark,0.4},
>  {vm_memory_limit,6834718310},
>  {disk_free_limit,1000000000},
>  {disk_free,10381430784},
>  {file_descriptors,
>      [{total_limit,8092},
>       {total_used,4},
>       {sockets_limit,7280},
>       {sockets_used,2}]},
>  {processes,[{limit,1048576},{used,196}]},
>  {run_queue,0},
>  {uptime,166775}]
> ...done.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From reddylast at gmail.com  Mon Mar 25 13:15:02 2013
From: reddylast at gmail.com (reddylast)
Date: Mon, 25 Mar 2013 06:15:02 -0700 (PDT)
Subject: [rabbitmq-discuss] MYSQL not getting disconnected Consumer
In-Reply-To: <636D6819-9660-4429-A1A9-926FF2013BF7@rabbitmq.com>
References: <1363808375050-25619.post@n5.nabble.com>
	<636D6819-9660-4429-A1A9-926FF2013BF7@rabbitmq.com>
Message-ID: <1364217302337-25690.post@n5.nabble.com>

Hi Tim,

Thanks for you reply.

I posted this issues also on MySQL support forums and Stack Overflow, but,
didn?t get any solution. Please see the samle code of consumer script which
have right now, hope this will help you to get an idea on this issue :

$connection = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
$channel = $connection->channel();
$channel->queue_declare($queue, false, true, false, false);
$channel->exchange_declare('myexchange', 'direct', true, true, false);
$channel->queue_bind('myqueue', $exchange, $queue);
$callback = function($msg, $db) { 

	$data = json_decode($msg->body, true); // on producer script I've send data
in json format
	$db->mysqlConnect();
	$db->mysqlQuery("update jobstable set status='in-progress' where
id=".$data['id']);
	$db->mysqlDisconnect();

	processData($data); // this will process data

	$db->mysqlConnect();
	$db->mysqlQuery("update jobstable set status='complete' where
id=".$data['id']);
	$db->mysqlDisconnect();

};

while (count($channel->callbacks)) {
	$channel->wait();
}

$channel->close();
$connection->close();

Thanks,
Reddy


function processData(){
	/* I'm also running some mysql queries. */
}










 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/MYSQL-not-getting-disconnected-at-consumer-side-tp25619p25690.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon Mar 25 13:34:20 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 25 Mar 2013 13:34:20 +0000
Subject: [rabbitmq-discuss] MYSQL not getting disconnected Consumer
In-Reply-To: <1364217302337-25690.post@n5.nabble.com>
References: <1363808375050-25619.post@n5.nabble.com>
	<636D6819-9660-4429-A1A9-926FF2013BF7@rabbitmq.com>
	<1364217302337-25690.post@n5.nabble.com>
Message-ID: <5150525C.9070808@rabbitmq.com>

On 25/03/13 13:15, reddylast wrote:
> I posted this issues also on MySQL support forums and Stack Overflow, but,
> didn?t get any solution.

I'm sorry you didn't get a response elsewhere, but this is the RabbitMQ 
list, and you have a MySQL problem. We try to be helpful, really, but we 
can't help you.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Mon Mar 25 13:46:24 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 25 Mar 2013 13:46:24 +0000
Subject: [rabbitmq-discuss] MYSQL not getting disconnected Consumer
In-Reply-To: <1364217302337-25690.post@n5.nabble.com>
References: <1363808375050-25619.post@n5.nabble.com>
	<636D6819-9660-4429-A1A9-926FF2013BF7@rabbitmq.com>
	<1364217302337-25690.post@n5.nabble.com>
Message-ID: <413B86E4-D228-404A-A223-16125817338C@rabbitmq.com>

Hi,

On 25 Mar 2013, at 13:15, reddylast wrote:
> Thanks for you reply.
> 

You're welcome.

> I posted this issues also on MySQL support forums and Stack Overflow, but,
> didn?t get any solution. Please see the samle code of consumer script which
> have right now, hope this will help you to get an idea on this issue :
> 

Perhaps I wasn't clear. I advised you to try out the MySQL forums and SO because those are the right places for you to get help with MySQL issues. The RabbitMQ mailing list is not the right place to address this problem. If there was something going on with your RabbitMQ connection/queue/channel/etc then this *would* be a good place to come and get help - and we'd be happy to give it! - but your issue is afaict with MySQL connection handling/cleanup and that is nothing to do with RabbitMQ, ergo this is not the right mailing list to ask for help, hence my suggestion to go somewhere more appropriate.

If you've not heard back from the support forums or SO then I can only suggest that you either continue to wait for a reply, or poke the question(s) again and ask if anyone's able to help. You may find that rephrasing your question or adding additional details helps - the canonical advise given to those seeking help on the internet is http://www.catb.org/esr/faqs/smart-questions.html#intro and is vital reading if you're not already familiar with it.

> 	$db->mysqlConnect();
> 	$db->mysqlQuery(...);
> 	$db->mysqlDisconnect();
> 
> 	processData($data); // this will process data
> 
> 	$db->mysqlConnect();
> 	$db->mysqlQuery(...);
> 	$db->mysqlDisconnect();
> 
> };

That section of code looks rather suspicious to me - but I know next to nothing about MySQL. I do *not* want to discourage you from asking for help here, because when it comes to questions about RabbitMQ, we're always happy to assist users both on this mailing list and on the #rabbitmq IRC channel on freenode. But if your question has nothing to do with RabbitMQ, this is not the right forum. If you suspect that RabbitMQ is at fault, then why not rewrite the script to execute the MySQL code in a tight loop using some pre-populated array of test json data and take a look if the connection cleanup is still failing without RabbitMQ being involved? If so, then you know it's nothing to do with rabbit. If the problem goes away, then it's possible that some aspect of the client library you're using (such as, for example, running callbacks in different threads or error handling mechanisms) is interacting with the MySQL code in an unhelpful manner. If that (latter situation) can be proved, then you might try contacting the author of your rabbitmq client library and asking them for help. That *is* something you can use this list for, although there's no guarantee that all client library authors follow this list, and mailing the author directly or using the project issue tracker (for the client library) might be a better approach.

HTH - as I said, *please* don't be discouraged from approaching this list for help, once you're certain that your issue actually has something to do with RabbitMQ (rather than MySQL or some other unrelated technology).

Cheers,
Tim



From carl.hoerberg at gmail.com  Mon Mar 25 14:24:22 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 25 Mar 2013 07:24:22 -0700 (PDT)
Subject: [rabbitmq-discuss] CORS in the mgmt http api
Message-ID: <1364221462089-25693.post@n5.nabble.com>

What about adding CORS headers to the mgmt HTTP API responses, so that the
API can be used from other client side apps?  

https://github.com/rabbitmq/rabbitmq-management/issues/3





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/CORS-in-the-mgmt-http-api-tp25693.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From chenglin.li at quanshi.com  Mon Mar 25 14:28:25 2013
From: chenglin.li at quanshi.com (Li, Chenglin)
Date: Mon, 25 Mar 2013 22:28:25 +0800
Subject: [rabbitmq-discuss] [SOS] About MQ server connection reset issues
Message-ID: <008401ce2965$034c4990$09e4dcb0$@li@quanshi.com>

Hi All

 

We use rabbitmq as message delivery channel to mobile client. And in our DEV
environment, all works fine, but in our QA environment, we deploy LVS as
load balance and cluster, and after server run for some time(about 2-3
hours), the server will throw below error log, can someone give us some
ideas for this issue? Thanks in advance. 

 

/***************************************************************************
****/

[Thread-9] 23 Mar 2013 19:23:17,154 ERROR
com.gnet.ms.util.MsLog.error(MsLog.java:61) - --- [MS][5][WORK_THREAD:
[id:WT_0, state:RUN]] error execute [task:mmm_up_exchange].
[error:connection error; reason: java.net.SocketException: Connection reset

com.rabbitmq.client.ShutdownSignalException: connection error; reason:
java.net.SocketException: Connection reset

         at
com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:198)

         at
com.rabbitmq.client.QueueingConsumer.nextDelivery(QueueingConsumer.java:214)

         at
com.gnet.ms.util.thread.task.impl.ActionExchangeTask.execute(ActionExchangeT
ask.java:65)

         at com.gnet.ms.util.thread.WorkThread.run(WorkThread.java:43)

Caused by: java.net.SocketException: Connection reset

         at java.net.SocketInputStream.read(SocketInputStream.java:185)

         at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)

         at java.io.BufferedInputStream.read(BufferedInputStream.java:254)

         at
java.io.DataInputStream.readUnsignedByte(DataInputStream.java:288)

         at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)

         at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.jav
a:131)

         at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:501)

/***************************************************************************
******/

 

 

Thanks,

Jack

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130325/6fa8570d/attachment.htm>

From carl.hoerberg at gmail.com  Mon Mar 25 14:29:25 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 25 Mar 2013 07:29:25 -0700 (PDT)
Subject: [rabbitmq-discuss] SIGTERM
Message-ID: <1364221765270-25695.post@n5.nabble.com>

Will RabbitMQ respond well to SIGTERM? Would like to replace the init.d
script with a upstart script but not sure if rabbitmq will gracefully stop
with a SIGTERM to the rabbitmq-server script? Or should I put "rabbitmqctl
stop" as a "pre-stop" exec? 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/SIGTERM-tp25695.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon Mar 25 14:54:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 25 Mar 2013 14:54:05 +0000
Subject: [rabbitmq-discuss] CORS in the mgmt http api
In-Reply-To: <1364221462089-25693.post@n5.nabble.com>
References: <1364221462089-25693.post@n5.nabble.com>
Message-ID: <5150650D.80206@rabbitmq.com>

On 25/03/13 14:24, carlhoerberg wrote:
> What about adding CORS headers to the mgmt HTTP API responses, so that the
> API can be used from other client side apps?
>
> https://github.com/rabbitmq/rabbitmq-management/issues/3

As I said at the issue: we don't want to add 
"Access-Control-Allow-Origin: *", this is a security thing.

Allowing you to configure mgmt so that it allows custom headers to be 
set would be OK I guess.

What is your use case though? Are you intending to write an alternate 
web UI? :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From carl.hoerberg at gmail.com  Mon Mar 25 15:00:52 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 25 Mar 2013 08:00:52 -0700 (PDT)
Subject: [rabbitmq-discuss] CORS in the mgmt http api
In-Reply-To: <5150650D.80206@rabbitmq.com>
References: <1364221462089-25693.post@n5.nabble.com>
	<5150650D.80206@rabbitmq.com>
Message-ID: <87ECA493323F4DE89FF5E0B77C3150DB@gmail.com>

i am, i find that the current interface is very sluggish (it even blocks the event loop(!)) with many users/vhosts and/or connections/channels. figured i could at least give it a try.. 



On Monday 25 March 2013 at 22:55, Simon MacMullen-2 [via RabbitMQ] wrote:

> On 25/03/13 14:24, carlhoerberg wrote: 
> > What about adding CORS headers to the mgmt HTTP API responses, so that the 
> > API can be used from other client side apps? 
> > 
> > https://github.com/rabbitmq/rabbitmq-management/issues/3
> 
> As I said at the issue: we don't want to add 
> "Access-Control-Allow-Origin: *", this is a security thing. 
> 
> Allowing you to configure mgmt so that it allows custom headers to be 
> set would be OK I guess. 
> 
> What is your use case though? Are you intending to write an alternate 
> web UI? :-) 
> 
> Cheers, Simon 
> 
> -- 
> Simon MacMullen 
> RabbitMQ, VMware 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=25696&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/CORS-in-the-mgmt-http-api-tp25693p25696.html 
> To unsubscribe from CORS in the mgmt http api, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25693&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU2OTN8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/CORS-in-the-mgmt-http-api-tp25693p25697.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130325/a0e5d202/attachment.htm>

From tim at rabbitmq.com  Mon Mar 25 15:05:29 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 25 Mar 2013 15:05:29 +0000
Subject: [rabbitmq-discuss] [SOS] About MQ server connection reset issues
In-Reply-To: <008401ce2965$034c4990$09e4dcb0$@li@quanshi.com>
References: <008401ce2965$034c4990$09e4dcb0$@li@quanshi.com>
Message-ID: <AA51FFAF-E3B3-4BEB-B7A6-C055B649BE4D@rabbitmq.com>

Hi,

On 25 Mar 2013, at 14:28, Li, Chenglin wrote:
> We use rabbitmq as message delivery channel to mobile client. And in our DEV environment, all works fine, but in our QA environment, we deploy LVS as load balance and cluster, and after server run for some time(about 2-3 hours), the server will throw below error log, can someone give us some ideas for this issue? Thanks in advance.
>  

Looking at this - "the server will throw below error log" is incorrect. That error log comes from the client, not the server.

> com.rabbitmq.client.ShutdownSignalException: connection error; reason: java.net.SocketException: Connection reset

... and the cause is pretty clear. The connection has been closed. Could this be a network disruption perhaps? Does your load balancer by any chance have some threshold after which connections it deems to be 'idle' are bounced or something like that?

Cheers,
Tim

>          at com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:198)
>          at com.rabbitmq.client.QueueingConsumer.nextDelivery(QueueingConsumer.java:214)
>          at com.gnet.ms.util.thread.task.impl.ActionExchangeTask.execute(ActionExchangeTask.java:65)
>          at com.gnet.ms.util.thread.WorkThread.run(WorkThread.java:43)
> Caused by: java.net.SocketException: Connection reset
>          at java.net.SocketInputStream.read(SocketInputStream.java:185)
>          at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)
>          at java.io.BufferedInputStream.read(BufferedInputStream.java:254)
>          at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:288)
>          at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
>          at com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:131)
>          at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:501)
> /*********************************************************************************/
>  
>  
> Thanks,
> Jack
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Mon Mar 25 15:06:58 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 25 Mar 2013 15:06:58 +0000
Subject: [rabbitmq-discuss] SIGTERM
In-Reply-To: <1364221765270-25695.post@n5.nabble.com>
References: <1364221765270-25695.post@n5.nabble.com>
Message-ID: <E05B1979-C29E-4B66-8D8C-466DC8FA2176@rabbitmq.com>

Hi,

On 25 Mar 2013, at 14:29, carlhoerberg wrote:
> Will RabbitMQ respond well to SIGTERM?

I would say probably not, or at least, not 'well' anyway.

> Would like to replace the init.d
> script with a upstart script but not sure if rabbitmq will gracefully stop
> with a SIGTERM to the rabbitmq-server script? Or should I put "rabbitmqctl
> stop" as a "pre-stop" exec? 
> 

I would strongly advise using `rabbitmqctl stop` instead of using SIGTERM.

> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/SIGTERM-tp25695.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Mon Mar 25 15:13:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 25 Mar 2013 15:13:45 +0000
Subject: [rabbitmq-discuss] SIGTERM
In-Reply-To: <E05B1979-C29E-4B66-8D8C-466DC8FA2176@rabbitmq.com>
References: <1364221765270-25695.post@n5.nabble.com>
	<E05B1979-C29E-4B66-8D8C-466DC8FA2176@rabbitmq.com>
Message-ID: <515069A9.5000308@rabbitmq.com>

On 25/03/13 15:06, Tim Watson wrote:
>> >Would like to replace the init.d
>> >script with a upstart script but not sure if rabbitmq will gracefully stop
>> >with a SIGTERM to the rabbitmq-server script? Or should I put "rabbitmqctl
>> >stop" as a "pre-stop" exec?
>> >
> I would strongly advise using `rabbitmqctl stop` instead of using SIGTERM.
>

Note in particular that "rabbitmqctl stop <pidfile>" will ensure that by 
the time the rabbitmqctl invocation exits then the RabbitMQ server will 
have shut down and the VM will have closed. SIGTERM would not give you 
that even if we trapped it (and it's not obvious Erlang lets you do that...)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dennisml at conversis.de  Mon Mar 25 15:14:24 2013
From: dennisml at conversis.de (Dennis Jacobfeuerborn)
Date: Mon, 25 Mar 2013 16:14:24 +0100
Subject: [rabbitmq-discuss] message_stats available in /api/queues but not
	/api/queues/(vhost)/(queue)?
Message-ID: <515069D0.70204@conversis.de>

Hi,
is it possible that the api data for all queues and the api data for a 
specific queue is inconsistent?
When I look unter /api/queues directly I find values for message_stats 
for a queue but when I look up the data for this specific queue that 
information doesn't seem to be available. Is this intended?

Regards,
    Dennis

From bme at saseco.dk  Mon Mar 25 15:51:25 2013
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Mon, 25 Mar 2013 15:51:25 +0000
Subject: [rabbitmq-discuss] Send problem (receiver closes exchange)
Message-ID: <C44C93396408924FBBF479F57FD429FC14A5F98F@AM2PRD0210MB361.eurprd02.prod.outlook.com>

I am having two AMQP clients, one sends and another receives. I can start the sender without the receiver and while there is no receiver to receive the messages, the sender doesn't error. Then I start the receiver and then I receive messages as intended. But when I stop the receiver, the sender throws exception on each message sent:

RabbitMQ.Client.Exceptions.AlreadyClosedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=404, text="NOT_FOUND - no exchange 'coma.event' in vhost '/'", classId=60, methodId=40, cause=

Is it possible for one client to close an exchange that another client is actively using?

Thanks,

Bernhard

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130325/192dfe2c/attachment.htm>

From tim at rabbitmq.com  Mon Mar 25 15:55:41 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 25 Mar 2013 15:55:41 +0000
Subject: [rabbitmq-discuss] Send problem (receiver closes exchange)
In-Reply-To: <C44C93396408924FBBF479F57FD429FC14A5F98F@AM2PRD0210MB361.eurprd02.prod.outlook.com>
References: <C44C93396408924FBBF479F57FD429FC14A5F98F@AM2PRD0210MB361.eurprd02.prod.outlook.com>
Message-ID: <16763DA7-F79F-46C2-BA8D-E52040399F8C@rabbitmq.com>

On 25 Mar 2013, at 15:51, Bernhard Mogens Ege wrote:
> Is it possible for one client to close an exchange that another client is actively using?

It is if the exchange was declared with auto-delete=true - see http://www.rabbitmq.com/amqp-0-9-1-reference.html#exchange.declare.auto-delete for details.

Cheers,
Tim

>  
> Thanks,
>  
> Bernhard
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From bme at saseco.dk  Mon Mar 25 15:57:36 2013
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Mon, 25 Mar 2013 15:57:36 +0000
Subject: [rabbitmq-discuss] Send problem (receiver closes exchange)
In-Reply-To: <C44C93396408924FBBF479F57FD429FC14A5F98F@AM2PRD0210MB361.eurprd02.prod.outlook.com>
References: <C44C93396408924FBBF479F57FD429FC14A5F98F@AM2PRD0210MB361.eurprd02.prod.outlook.com>
Message-ID: <C44C93396408924FBBF479F57FD429FC14A5F9A7@AM2PRD0210MB361.eurprd02.prod.outlook.com>

I'll answer my own blunder... the exchange was set to autodelete and only the subscriber was listening for messages from it. The sender only sent messages but had not other handle on it. :-P

Bernhard

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Bernhard Mogens Ege
Sent: 25. marts 2013 16:51
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] Send problem (receiver closes exchange)

I am having two AMQP clients, one sends and another receives. I can start the sender without the receiver and while there is no receiver to receive the messages, the sender doesn't error. Then I start the receiver and then I receive messages as intended. But when I stop the receiver, the sender throws exception on each message sent:

RabbitMQ.Client.Exceptions.AlreadyClosedException: The AMQP operation was interrupted: AMQP close-reason, initiated by Peer, code=404, text="NOT_FOUND - no exchange 'coma.event' in vhost '/'", classId=60, methodId=40, cause=

Is it possible for one client to close an exchange that another client is actively using?

Thanks,

Bernhard

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130325/9db01e96/attachment.htm>

From tim at rabbitmq.com  Mon Mar 25 16:00:39 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 25 Mar 2013 16:00:39 +0000
Subject: [rabbitmq-discuss] Send problem (receiver closes exchange)
In-Reply-To: <C44C93396408924FBBF479F57FD429FC14A5F9A7@AM2PRD0210MB361.eurprd02.prod.outlook.com>
References: <C44C93396408924FBBF479F57FD429FC14A5F98F@AM2PRD0210MB361.eurprd02.prod.outlook.com>
	<C44C93396408924FBBF479F57FD429FC14A5F9A7@AM2PRD0210MB361.eurprd02.prod.outlook.com>
Message-ID: <2E2FD1B8-D290-41D1-91DF-86304D592D38@rabbitmq.com>

Hi Bernhard,

On 25 Mar 2013, at 15:57, Bernhard Mogens Ege wrote:
> I?ll answer my own blunder? the exchange was set to autodelete and only the subscriber was listening for messages from it. The sender only sent messages but had not other handle on it. :-P
>  

Yes, thanks for clarifying for future readers' benefit. If there's only one consumer and he disappears, then the auto-delete exchange will go away despite the fact that someone else is trying to publish to it.

Cheers,
Tim


From steveolivier22 at gmail.com  Mon Mar 25 16:23:57 2013
From: steveolivier22 at gmail.com (SteveO)
Date: Mon, 25 Mar 2013 09:23:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <1363620585484-25506.post@n5.nabble.com>
References: <1363362418350-25471.post@n5.nabble.com>
	<CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
	<5143A2BF.6060805@rabbitmq.com>
	<CALPqkip_SPy2VB+-J6FVMGs_8FwAa8LPhosOvKFLwEcWL2wUbA@mail.gmail.com>
	<5143A74F.6080000@rabbitmq.com>
	<1363393077582-25478.post@n5.nabble.com>
	<5146EA69.6010904@rabbitmq.com>
	<CAMcAHLVteHePrhWyfC0jDhBr0Mb=EJ=wejp6xX_J_sFPn1D2bA@mail.gmail.com>
	<5146F0F4.8060801@rabbitmq.com>
	<1363620585484-25506.post@n5.nabble.com>
Message-ID: <1364228637617-25706.post@n5.nabble.com>

I was just curious if I wanted to accomplish the requirements mentioned
earlier, would I be looking at writing a custom exchange, or was there any
consideration of this as a feature request. The exact requirements felt
pretty specific to our needs, I didn't know if others found it useful or
not.

I was just trying to identify scope of work. Thanks!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Confirm-consistent-hash-exchange-behavior-tp25458p25706.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon Mar 25 16:28:33 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 25 Mar 2013 16:28:33 +0000
Subject: [rabbitmq-discuss] Confirm consistent hash exchange behavior
In-Reply-To: <1364228637617-25706.post@n5.nabble.com>
References: <1363362418350-25471.post@n5.nabble.com>
	<CAMcAHLWJRRSDOH3gL8_Vsgk-HYoePe7iWkp1cQxPTmy+W=D+yw@mail.gmail.com>
	<5143A2BF.6060805@rabbitmq.com>
	<CALPqkip_SPy2VB+-J6FVMGs_8FwAa8LPhosOvKFLwEcWL2wUbA@mail.gmail.com>
	<5143A74F.6080000@rabbitmq.com>
	<1363393077582-25478.post@n5.nabble.com>
	<5146EA69.6010904@rabbitmq.com>
	<CAMcAHLVteHePrhWyfC0jDhBr0Mb=EJ=wejp6xX_J_sFPn1D2bA@mail.gmail.com>
	<5146F0F4.8060801@rabbitmq.com>
	<1363620585484-25506.post@n5.nabble.com>
	<1364228637617-25706.post@n5.nabble.com>
Message-ID: <51507B31.6050703@rabbitmq.com>

On 25/03/13 16:23, SteveO wrote:
> I was just curious if I wanted to accomplish the requirements mentioned
> earlier, would I be looking at writing a custom exchange, or was there any
> consideration of this as a feature request. The exact requirements felt
> pretty specific to our needs, I didn't know if others found it useful or
> not.

It's being considered as a feature request; I suspect there are others 
around with similar needs.

Having said that, we're focussing on getting RabbitMQ 3.1 ready to go at 
the moment, so I wouldn't expect anything to happen imminently.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From extofer at gmail.com  Mon Mar 25 23:47:31 2013
From: extofer at gmail.com (extofer)
Date: Mon, 25 Mar 2013 17:47:31 -0600
Subject: [rabbitmq-discuss] Optimizing Tips for beginner rabbitMQ user
Message-ID: <CA+zko5k95ynxEkx6QadO-rOyE-mwnC94RTbyv=DvxSx6dnSxrw@mail.gmail.com>

Here is my setup: I've implemented rabbitMQ on a centOS environment  I have
one tomcat application publishing messages at an average of 30 msg/s. The
consumer apps are in 3 different servers running the same process, each
consuming at an average of 2~3 msg/s. I've tried optimizing our process on
the consumer applications as much as possible, now I want to look at the
queue and try to get more than 2~3 msg/s.

Here are some questions, and perhaps someone can assist me with suggestions:

I use the same user authentications on all 3 consumers.... will having
different users help bump the message rate?

I've tried using more channels, but all in all, it doesn't change a thing,
it still gets 1 or 25 messages depending on channels, but the message rate
is the same.

What are some common optimization tips for faster performance?

Thanks
The consumer application is a Tomcat application and I'm using rabbit-amqp
configured below.
<bean id="rabbitConnectionFactory"
class="org.springframework.amqp.rabbit.connection.CachingConnectionFactory"
p:username="USER" p:password="PSWD!" p:virtualHost="VHNAME"
p:port="5672">
<constructor-arg value="DOMAIN" />
<property name="channelCacheSize" value="1" />
</bean>

-- 
Thanks,
Gabriel Villa
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130325/f8adeeae/attachment.htm>

From grussell at vmware.com  Tue Mar 26 01:17:58 2013
From: grussell at vmware.com (Gary Russell)
Date: Mon, 25 Mar 2013 18:17:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Optimizing Tips for beginner rabbitMQ user
In-Reply-To: <CA+zko5k95ynxEkx6QadO-rOyE-mwnC94RTbyv=DvxSx6dnSxrw@mail.gmail.com>
References: <CA+zko5k95ynxEkx6QadO-rOyE-mwnC94RTbyv=DvxSx6dnSxrw@mail.gmail.com>
Message-ID: <690273042.9533640.1364260678280.JavaMail.root@vmware.com>

Please move this discussion to the Spring-AMQP forum 

http://forum.springsource.org/forumdisplay.php?74-AMQP 

You only show your connection factory configuration, you need to provide your consumer config as well. 

If you are using a listener container, there are a number of optimizations, including increasing the concurrency but, as I said, we need to see that configuration too before we can make suggestions. 

Please re-post your question over there, with more information. 

----- Original Message -----

From: "extofer" <extofer at gmail.com> 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, March 25, 2013 7:47:31 PM 
Subject: [rabbitmq-discuss] Optimizing Tips for beginner rabbitMQ user 

Here is my setup: I've implemented rabbitMQ on a centOS environment I have one tomcat application publishing messages at an average of 30 msg/s. The consumer apps are in 3 different servers running the same process, each consuming at an average of 2~3 msg/s. I've tried optimizing our process on the consumer applications as much as possible, now I want to look at the queue and try to get more than 2~3 msg/s. 

Here are some questions, and perhaps someone can assist me with suggestions: 

I use the same user authentications on all 3 consumers.... will having different users help bump the message rate? 

I've tried using more channels, but all in all, it doesn't change a thing, it still gets 1 or 25 messages depending on channels, but the message rate is the same. 

What are some common optimization tips for faster performance? 

Thanks 
The consumer application is a Tomcat application and I'm using rabbit-amqp configured below. 
<bean id="rabbitConnectionFactory" 
class="org.springframework.amqp.rabbit.connection.CachingConnectionFactory" 
p:username="USER" p:password="PSWD!" p:virtualHost="VHNAME" 
p:port="5672"> 
<constructor-arg value="DOMAIN" /> 
<property name="channelCacheSize" value="1" /> 
</bean> 

-- 
Thanks, 
Gabriel Villa 

_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130325/150823b9/attachment.htm>

From carl.hoerberg at gmail.com  Tue Mar 26 05:25:47 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 25 Mar 2013 22:25:47 -0700 (PDT)
Subject: [rabbitmq-discuss] SIGTERM
In-Reply-To: <515069A9.5000308@rabbitmq.com>
References: <1364221765270-25695.post@n5.nabble.com>
	<E05B1979-C29E-4B66-8D8C-466DC8FA2176@rabbitmq.com>
	<515069A9.5000308@rabbitmq.com>
Message-ID: <1364275547607-25712.post@n5.nabble.com>

Ok, thanks. This is how my upstart script looks now: 

description "RabbitMQ Server"

start on runlevel [2345]
stop on runlevel [016]
kill timeout 60
respawn
respawn limit 10 5
console log
setuid rabbitmq
setgid rabbitmq
env HOME=/var/lib/rabbitmq

exec /usr/lib/rabbitmq/bin/rabbitmq-server
post-start exec /usr/sbin/rabbitmqctl wait
pre-stop exec /usr/sbin/rabbitmqctl stop




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/SIGTERM-tp25695p25712.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From extofer at gmail.com  Mon Mar 25 23:33:18 2013
From: extofer at gmail.com (Gabriel Villa)
Date: Mon, 25 Mar 2013 16:33:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Optimizing Tips for beginner rabbitMQ user
Message-ID: <d45e53ae-d6e1-4a2b-92a0-ad5d18060cd7@googlegroups.com>

Here is my setup: I've implemented rabbitMQ on a centOS environment  I have 
one tomcat application publishing messages at an average of 30 msg/s. The 
consumer apps are in 3 different servers running the same process, each 
consuming at an average of 2~3 msg/s. I've tried optimizing our process on 
the consumer applications as much as possible, now I want to look at the 
queue and try to get more than 2~3 msg/s. 

Here are some questions, and perhaps someone can assist me with suggestions:

I use the same user authentications on all 3 consumers.... will having 
different users help bump the message rate?

I've tried using more channels, but all in all, it doesn't change a thing, 
it still gets 1 or 25 messages depending on channels, but the message rate 
is the same. 

What are some common optimization tips for faster performance?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130325/29d68d1a/attachment.htm>

From jesper.louis.andersen at gmail.com  Tue Mar 26 10:46:06 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Tue, 26 Mar 2013 11:46:06 +0100
Subject: [rabbitmq-discuss] Optimizing Tips for beginner rabbitMQ user
In-Reply-To: <CA+zko5k95ynxEkx6QadO-rOyE-mwnC94RTbyv=DvxSx6dnSxrw@mail.gmail.com>
References: <CA+zko5k95ynxEkx6QadO-rOyE-mwnC94RTbyv=DvxSx6dnSxrw@mail.gmail.com>
Message-ID: <CAGrdgiVP-BcROEmL7H_-jA+1Wm1mkDymwtKiXcuhvS6_+KO5tw@mail.gmail.com>

My primary first thing would be to drop all your processing and just accept
the messages and throw them away. That would immediately tell you where the
performance problem is. Next, I would not rule out the possibility of
something being wrong at a lower level (e.g., network). 2-3 msg/s is a
fairly low rate, which suggest something is wrong somewhere, or you are
doing some serious heavy lifting for each message.

Increasing the possible parallelism though more channels is one important
trick. The other is to eliminate latency by setting up some prefetching via
QoS. But beware of giving it too much prefetching.

Finally, do not forget to measure. Measurement can often show why something
doesn't work as expected.


On Tue, Mar 26, 2013 at 12:47 AM, extofer <extofer at gmail.com> wrote:

> Here is my setup: I've implemented rabbitMQ on a centOS environment  I
> have one tomcat application publishing messages at an average of 30 msg/s.
> The consumer apps are in 3 different servers running the same process, each
> consuming at an average of 2~3 msg/s. I've tried optimizing our process on
> the consumer applications as much as possible, now I want to look at the
> queue and try to get more than 2~3 msg/s.
>
> Here are some questions, and perhaps someone can assist me with
> suggestions:
>
> I use the same user authentications on all 3 consumers.... will having
> different users help bump the message rate?
>
> I've tried using more channels, but all in all, it doesn't change a thing,
> it still gets 1 or 25 messages depending on channels, but the message rate
> is the same.
>
> What are some common optimization tips for faster performance?
>
> Thanks
> The consumer application is a Tomcat application and I'm using rabbit-amqp
> configured below.
> <bean id="rabbitConnectionFactory"
>
> class="org.springframework.amqp.rabbit.connection.CachingConnectionFactory"
> p:username="USER" p:password="PSWD!" p:virtualHost="VHNAME"
>  p:port="5672">
> <constructor-arg value="DOMAIN" />
>  <property name="channelCacheSize" value="1" />
> </bean>
>
> --
> Thanks,
> Gabriel Villa
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130326/4a1f48dc/attachment.htm>

From chenglin.li at quanshi.com  Tue Mar 26 11:37:28 2013
From: chenglin.li at quanshi.com (Li, Chenglin)
Date: Tue, 26 Mar 2013 19:37:28 +0800
Subject: [rabbitmq-discuss] =?gb2312?b?tPC4tDogIFtTT1NdIEFib3V0IE1RIHNl?=
	=?gb2312?b?cnZlciBjb25uZWN0aW9uIHJlc2V0IGlzc3Vlcw==?=
In-Reply-To: <AA51FFAF-E3B3-4BEB-B7A6-C055B649BE4D@rabbitmq.com>
References: <008401ce2965$034c4990$09e4dcb0$@li@quanshi.com>
	<AA51FFAF-E3B3-4BEB-B7A6-C055B649BE4D@rabbitmq.com>
Message-ID: <004901ce2a16$4c3d0e80$e4b72b80$@li@quanshi.com>

Thanks Tim. 

Yes, this log comes from client, sorry.

We found this is a network issue, if network is stable, all is fine. But in
user's environment, we can not make sure network is stable, in this case,
how to handle? Try another times, or other? 


Thanks,
Jack


-----????-----
???: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] ?? Tim Watson
????: 2013?3?25? 23:05
???: Discussions about RabbitMQ
??: Re: [rabbitmq-discuss] [SOS] About MQ server connection reset issues

Hi,

On 25 Mar 2013, at 14:28, Li, Chenglin wrote:
> We use rabbitmq as message delivery channel to mobile client. And in our
DEV environment, all works fine, but in our QA environment, we deploy LVS as
load balance and cluster, and after server run for some time(about 2-3
hours), the server will throw below error log, can someone give us some
ideas for this issue? Thanks in advance.
>  

Looking at this - "the server will throw below error log" is incorrect. That
error log comes from the client, not the server.

> com.rabbitmq.client.ShutdownSignalException: connection error; reason: 
> java.net.SocketException: Connection reset

... and the cause is pretty clear. The connection has been closed. Could
this be a network disruption perhaps? Does your load balancer by any chance
have some threshold after which connections it deems to be 'idle' are
bounced or something like that?


Cheers,
Tim

>          at
com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:198)
>          at
com.rabbitmq.client.QueueingConsumer.nextDelivery(QueueingConsumer.java:214)
>          at
com.gnet.ms.util.thread.task.impl.ActionExchangeTask.execute(ActionExchangeT
ask.java:65)
>          at com.gnet.ms.util.thread.WorkThread.run(WorkThread.java:43)
> Caused by: java.net.SocketException: Connection reset
>          at java.net.SocketInputStream.read(SocketInputStream.java:185)
>          at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)
>          at java.io.BufferedInputStream.read(BufferedInputStream.java:254)
>          at
java.io.DataInputStream.readUnsignedByte(DataInputStream.java:288)
>          at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
>          at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.jav
a:131)
>          at 
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java
> :501) 
> /*********************************************************************
> ************/
>  
>  
> Thanks,
> Jack
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Tue Mar 26 12:06:50 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 26 Mar 2013 12:06:50 +0000
Subject: [rabbitmq-discuss] one thread is consistently slower than
	another
In-Reply-To: <07cd953d-5873-4c70-bd9d-049c753269ba@googlegroups.com>
References: <07cd953d-5873-4c70-bd9d-049c753269ba@googlegroups.com>
Message-ID: <51518F5A.7040903@rabbitmq.com>


Hi Jonathan,

It is not clear how the broker could be responsible for making client
threads perform better or worse, so this might be a Python threading or
perhaps a Pika issue rather than a broker issue. Do all consumers use
the same message prefetch count?

You say the client threads interact with a networked filesystem and that
they publish. Have you tried to break down which of the client subtasks
are slower? Publishing an asychronous operation, so all threads should
take the same amount of time for that subtask. When you measure publish
speed, what exactly are you measuring?




-Emile









From simon at rabbitmq.com  Tue Mar 26 12:08:28 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Mar 2013 12:08:28 +0000
Subject: [rabbitmq-discuss] CORS in the mgmt http api
In-Reply-To: <87ECA493323F4DE89FF5E0B77C3150DB@gmail.com>
References: <1364221462089-25693.post@n5.nabble.com>
	<5150650D.80206@rabbitmq.com>
	<87ECA493323F4DE89FF5E0B77C3150DB@gmail.com>
Message-ID: <51518FBC.7060808@rabbitmq.com>

Hmm, I would like to fix the existing web UI if you are having trouble 
with it. Can you give more information about how many of each type of 
object you have?

Cheers, Simon

On 25/03/13 15:00, carlhoerberg wrote:
> i am, i find that the current interface is very sluggish (it even blocks
> the event loop(!)) with many users/vhosts and/or connections/channels.
> figured i could at least give it a try..
>
>
>
> On Monday 25 March 2013 at 22:55, Simon MacMullen-2 [via RabbitMQ] wrote:
>
>  > On 25/03/13 14:24, carlhoerberg wrote:
>  > > What about adding CORS headers to the mgmt HTTP API responses, so
> that the
>  > > API can be used from other client side apps?
>  > >
>  > > https://github.com/rabbitmq/rabbitmq-management/issues/3
>  >
>  > As I said at the issue: we don't want to add
>  > "Access-Control-Allow-Origin: *", this is a security thing.
>  >
>  > Allowing you to configure mgmt so that it allows custom headers to be
>  > set would be OK I guess.
>  >
>  > What is your use case though? Are you intending to write an alternate
>  > web UI? :-)
>  >
>  > Cheers, Simon
>  >
>  > --
>  > Simon MacMullen
>  > RabbitMQ, VMware
>  > _______________________________________________
>  > rabbitmq-discuss mailing list
>  > [hidden email] (/user/SendEmail.jtp?type=node&node=25696&i=0)
>  > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  >
>  >
>  > If you reply to this email, your message will be added to the
> discussion below:
> http://rabbitmq.1065348.n5.nabble.com/CORS-in-the-mgmt-http-api-tp25693p25696.html
>
>  > To unsubscribe from CORS in the mgmt http api, click here (
>  > NAML
> (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml)
>
>
>
>
>
> ------------------------------------------------------------------------
> View this message in context: Re: CORS in the mgmt http api
> <http://rabbitmq.1065348.n5.nabble.com/CORS-in-the-mgmt-http-api-tp25693p25697.html>
> Sent from the RabbitMQ mailing list archive
> <http://rabbitmq.1065348.n5.nabble.com/> at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Tue Mar 26 12:15:11 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 26 Mar 2013 12:15:11 +0000
Subject: [rabbitmq-discuss]
 =?utf-8?b?562U5aSNOiAgW1NPU10gQWJvdXQgTVEgc2Vy?=
 =?utf-8?q?ver_connection_reset_issues?=
In-Reply-To: <004901ce2a16$4c3d0e80$e4b72b80$@li@quanshi.com>
References: <008401ce2965$034c4990$09e4dcb0$@li@quanshi.com>
	<AA51FFAF-E3B3-4BEB-B7A6-C055B649BE4D@rabbitmq.com>
	<004901ce2a16$4c3d0e80$e4b72b80$@li@quanshi.com>
Message-ID: <E00C383D-307B-40A2-B125-24EBD7C3E208@rabbitmq.com>

Hi

On 26 Mar 2013, at 11:37, Li, Chenglin wrote:
> We found this is a network issue, if network is stable, all is fine. But in
> user's environment, we can not make sure network is stable, in this case,
> how to handle? Try another times, or other? 
> 

Depends what behaviour you want. If you use AMQP heartbeats then the connections won't appear idle to intermediate network infrastructure (such as load balancers and firewalls). You'll need to handle reconnection manually (unless you have a framework that helps with this - spring might be of some use here). Consumers can delay issuing ACKs until they've fully processed messages if that helps.

Cheers,
Tim

> 
> Thanks,
> Jack
> 
> 
> -----????-----
> ???: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] ?? Tim Watson
> ????: 2013?3?25? 23:05
> ???: Discussions about RabbitMQ
> ??: Re: [rabbitmq-discuss] [SOS] About MQ server connection reset issues
> 
> Hi,
> 
> On 25 Mar 2013, at 14:28, Li, Chenglin wrote:
>> We use rabbitmq as message delivery channel to mobile client. And in our
> DEV environment, all works fine, but in our QA environment, we deploy LVS as
> load balance and cluster, and after server run for some time(about 2-3
> hours), the server will throw below error log, can someone give us some
> ideas for this issue? Thanks in advance.
>> 
> 
> Looking at this - "the server will throw below error log" is incorrect. That
> error log comes from the client, not the server.
> 
>> com.rabbitmq.client.ShutdownSignalException: connection error; reason: 
>> java.net.SocketException: Connection reset
> 
> ... and the cause is pretty clear. The connection has been closed. Could
> this be a network disruption perhaps? Does your load balancer by any chance
> have some threshold after which connections it deems to be 'idle' are
> bounced or something like that?
> 
> 
> Cheers,
> Tim
> 
>>         at
> com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:198)
>>         at
> com.rabbitmq.client.QueueingConsumer.nextDelivery(QueueingConsumer.java:214)
>>         at
> com.gnet.ms.util.thread.task.impl.ActionExchangeTask.execute(ActionExchangeT
> ask.java:65)
>>         at com.gnet.ms.util.thread.WorkThread.run(WorkThread.java:43)
>> Caused by: java.net.SocketException: Connection reset
>>         at java.net.SocketInputStream.read(SocketInputStream.java:185)
>>         at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)
>>         at java.io.BufferedInputStream.read(BufferedInputStream.java:254)
>>         at
> java.io.DataInputStream.readUnsignedByte(DataInputStream.java:288)
>>         at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:95)
>>         at
> com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.jav
> a:131)
>>         at 
>> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java
>> :501) 
>> /*********************************************************************
>> ************/
>> 
>> 
>> Thanks,
>> Jack
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Tue Mar 26 12:16:01 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 26 Mar 2013 12:16:01 +0000
Subject: [rabbitmq-discuss] SIGTERM
In-Reply-To: <1364275547607-25712.post@n5.nabble.com>
References: <1364221765270-25695.post@n5.nabble.com>
	<E05B1979-C29E-4B66-8D8C-466DC8FA2176@rabbitmq.com>
	<515069A9.5000308@rabbitmq.com>
	<1364275547607-25712.post@n5.nabble.com>
Message-ID: <15E3A057-D382-434C-A220-958987FEFF41@rabbitmq.com>

Hi

On 26 Mar 2013, at 05:25, carlhoerberg wrote:
> exec /usr/lib/rabbitmq/bin/rabbitmq-server
> post-start exec /usr/sbin/rabbitmqctl wait
> pre-stop exec /usr/sbin/rabbitmqctl stop
> 

The rabbitmqctl wait command takes the pid file as an argument. So this might not be as simple as it sounds.

> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/SIGTERM-tp25695p25712.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jorge.diz at nomasystems.com  Tue Mar 26 12:18:41 2013
From: jorge.diz at nomasystems.com (Jorge Diz Pico)
Date: Tue, 26 Mar 2013 13:18:41 +0100
Subject: [rabbitmq-discuss] Running RabbitMQ server as embedded application
Message-ID: <CAGQEY6nVkYahZyviYp=3o_CUqSXJxANE7g-f0rp+g0-XOuH5vg@mail.gmail.com>

Hi folks, I'm trying to run a RabbitMQ server the OTP way, but it's
becoming harder than I thought. I added all dependencies to my
release, but when I run application:start(rabbit), I get the following
error:

[...]
-- rabbit boot start
starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...

BOOT FAILED
===========

Error description:
   {error,{corrupt_or_missing_cluster_files,{error,enoent},{error,enoent}}}

Log files (may contain more information):
   undefined
   undefined

Stack trace:
   [{rabbit_node_monitor,read_cluster_status,0,
                         [{file,"src/rabbit_node_monitor.erl"},{line,139}]},
    {rabbit_mnesia,cluster_status,1,
                   [{file,"src/rabbit_mnesia.erl"},{line,391}]},
    {rabbit_mnesia,node_type,0,[{file,"src/rabbit_mnesia.erl"},{line,410}]},
    {rabbit_mnesia,init,0,[{file,"src/rabbit_mnesia.erl"},{line,97}]},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,
            [{file,"src/rabbit.erl"},{line,481}]},
    {rabbit,run_boot_step,1,[{file,"src/rabbit.erl"},{line,480}]},
    {rabbit,'-start/2-lc$^0/1-0-',1,[{file,"src/rabbit.erl"},{line,440}]},
    {rabbit,start,2,[{file,"src/rabbit.erl"},{line,440}]}]
[...]

But of course there are no clusters and there had never been (fresh run).

Has anybody managed to do this? There has to be a way to embed the
RabbitMQ server in your own applications.

From simon at rabbitmq.com  Tue Mar 26 12:25:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Mar 2013 12:25:45 +0000
Subject: [rabbitmq-discuss] SIGTERM
In-Reply-To: <15E3A057-D382-434C-A220-958987FEFF41@rabbitmq.com>
References: <1364221765270-25695.post@n5.nabble.com>
	<E05B1979-C29E-4B66-8D8C-466DC8FA2176@rabbitmq.com>
	<515069A9.5000308@rabbitmq.com>
	<1364275547607-25712.post@n5.nabble.com>
	<15E3A057-D382-434C-A220-958987FEFF41@rabbitmq.com>
Message-ID: <515193C9.9080403@rabbitmq.com>

On 26/03/13 12:16, Tim Watson wrote:
> Hi
>
> On 26 Mar 2013, at 05:25, carlhoerberg wrote:
>> exec /usr/lib/rabbitmq/bin/rabbitmq-server
>> post-start exec /usr/sbin/rabbitmqctl wait
>> pre-stop exec /usr/sbin/rabbitmqctl stop
>>
>
> The rabbitmqctl wait command takes the pid file as an argument. So
> this might not be as simple as it sounds.

Although if you are using the debian packages as a starting point, the 
pid file is just /var/run/rabbitmq/pid, so it's not much less simple.

Note that you are also running as root. So I would modify two lines:

post-start exec /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid
pre-stop exec /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Mar 26 12:26:17 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 26 Mar 2013 12:26:17 +0000
Subject: [rabbitmq-discuss] "Other process memory" growth
In-Reply-To: <1364006848624-25675.post@n5.nabble.com>
References: <1364006848624-25675.post@n5.nabble.com>
Message-ID: <515193E9.9040000@rabbitmq.com>


Hi Carl,

On 23/03/13 02:47, carlhoerberg wrote:
> Have a 3 node cluster, normally it hovers around 200-300mb of ram, but
> suddenly the "Other process memory" started to grow:


"Other" is all use left after connections, queues and plugins are
accounted for. This could be due to internal Erlang VM processes
consuming memory. One way to dig further is to look at the Erlang
processes using the most memory:

$ etop -sort memory

More information about use of etop is available here:
http://www.erlang.org/doc/man/etop.html




-Emile










From simon at rabbitmq.com  Tue Mar 26 12:31:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Mar 2013 12:31:06 +0000
Subject: [rabbitmq-discuss] SIGTERM
In-Reply-To: <515193C9.9080403@rabbitmq.com>
References: <1364221765270-25695.post@n5.nabble.com>
	<E05B1979-C29E-4B66-8D8C-466DC8FA2176@rabbitmq.com>
	<515069A9.5000308@rabbitmq.com>
	<1364275547607-25712.post@n5.nabble.com>
	<15E3A057-D382-434C-A220-958987FEFF41@rabbitmq.com>
	<515193C9.9080403@rabbitmq.com>
Message-ID: <5151950A.90707@rabbitmq.com>

On 26/03/13 12:25, Simon MacMullen wrote:
> post-start exec /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid
> pre-stop exec /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid

Oh, and:

env PID_FILE=/var/run/rabbitmq/pid

I forgot the existing init script sets that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From carl.hoerberg at gmail.com  Tue Mar 26 12:32:58 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 26 Mar 2013 05:32:58 -0700 (PDT)
Subject: [rabbitmq-discuss] CORS in the mgmt http api
In-Reply-To: <51518FBC.7060808@rabbitmq.com>
References: <1364221462089-25693.post@n5.nabble.com>
	<5150650D.80206@rabbitmq.com>
	<87ECA493323F4DE89FF5E0B77C3150DB@gmail.com>
	<51518FBC.7060808@rabbitmq.com>
Message-ID: <0935A2D09F4349D8988E7672F1C4150E@gmail.com>

Right now on one of my clusters: 

Vhosts: 762
Users: 762
Connections: 557 
Channels: 1256 
Exchanges: 6094 
Queues: 3426 
Consumers: 1071



The main problem seems to be "sammy", which seems to be blocking the whole event loop while waiting for stuff to load. For instance you can do nothing until the vhost drop down is populated. And at any point there's no response while clicking the tabs, until 10-30 seconds later, when the data for that page is loaded. Api requests seems to be loaded serially not in parallel, while for instance going to the users page, first /api/persmissions is loaded, first when that's done the request to /api/users is issued..  




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/CORS-in-the-mgmt-http-api-tp25693p25724.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130326/e830d0e4/attachment.htm>

From matthias at rabbitmq.com  Tue Mar 26 12:49:58 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Mar 2013 12:49:58 +0000
Subject: [rabbitmq-discuss] "Other process memory" growth
In-Reply-To: <515193E9.9040000@rabbitmq.com>
References: <1364006848624-25675.post@n5.nabble.com>
	<515193E9.9040000@rabbitmq.com>
Message-ID: <51519976.209@rabbitmq.com>

On 26/03/13 12:26, Emile Joubert wrote:
> One way to dig further is to look at the Erlang
> processes using the most memory:
>
> $ etop -sort memory

Or

rabbitmqctl eval '[[{pid, R}, M | process_info(R)] || {M, R} <- 
lists:sublist(lists:reverse(lists:sort([{process_info(P, memory), P} || 
P <- erlang:processes()])), 10)].'


Matthias.

From tim at rabbitmq.com  Tue Mar 26 13:09:33 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 26 Mar 2013 13:09:33 +0000
Subject: [rabbitmq-discuss] SIGTERM
In-Reply-To: <515193C9.9080403@rabbitmq.com>
References: <1364221765270-25695.post@n5.nabble.com>
	<E05B1979-C29E-4B66-8D8C-466DC8FA2176@rabbitmq.com>
	<515069A9.5000308@rabbitmq.com>
	<1364275547607-25712.post@n5.nabble.com>
	<15E3A057-D382-434C-A220-958987FEFF41@rabbitmq.com>
	<515193C9.9080403@rabbitmq.com>
Message-ID: <579C956E-6E5E-492A-AFA5-C57FCCD276F0@rabbitmq.com>

On 26 Mar 2013, at 12:25, Simon MacMullen wrote:
> Note that you are also running as root. So I would modify two lines:
> 
> post-start exec /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid
> pre-stop exec /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid
> 

Doesn't the previous setuid/setgid deal with that?

> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware


From tim at rabbitmq.com  Tue Mar 26 13:11:09 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 26 Mar 2013 13:11:09 +0000
Subject: [rabbitmq-discuss] Running RabbitMQ server as embedded
	application
In-Reply-To: <CAGQEY6nVkYahZyviYp=3o_CUqSXJxANE7g-f0rp+g0-XOuH5vg@mail.gmail.com>
References: <CAGQEY6nVkYahZyviYp=3o_CUqSXJxANE7g-f0rp+g0-XOuH5vg@mail.gmail.com>
Message-ID: <279073FC-FC80-4343-8B5E-164D3AC914D7@rabbitmq.com>

Take a good look at the startup scripts. There are environment variables aplenty and various things that get passed the beam as arguments - you'll need to filter through those and make sure everything is set up properly in order for the startup sequence to work.

Cheers,
Tim

On 26 Mar 2013, at 12:18, Jorge Diz Pico wrote:

> Hi folks, I'm trying to run a RabbitMQ server the OTP way, but it's
> becoming harder than I thought. I added all dependencies to my
> release, but when I run application:start(rabbit), I get the following
> error:
> 
> [...]
> -- rabbit boot start
> starting file handle cache server                                     ...done
> starting worker pool                                                  ...done
> starting database                                                     ...
> 
> BOOT FAILED
> ===========
> 
> Error description:
>   {error,{corrupt_or_missing_cluster_files,{error,enoent},{error,enoent}}}
> 
> Log files (may contain more information):
>   undefined
>   undefined
> 
> Stack trace:
>   [{rabbit_node_monitor,read_cluster_status,0,
>                         [{file,"src/rabbit_node_monitor.erl"},{line,139}]},
>    {rabbit_mnesia,cluster_status,1,
>                   [{file,"src/rabbit_mnesia.erl"},{line,391}]},
>    {rabbit_mnesia,node_type,0,[{file,"src/rabbit_mnesia.erl"},{line,410}]},
>    {rabbit_mnesia,init,0,[{file,"src/rabbit_mnesia.erl"},{line,97}]},
>    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,
>            [{file,"src/rabbit.erl"},{line,481}]},
>    {rabbit,run_boot_step,1,[{file,"src/rabbit.erl"},{line,480}]},
>    {rabbit,'-start/2-lc$^0/1-0-',1,[{file,"src/rabbit.erl"},{line,440}]},
>    {rabbit,start,2,[{file,"src/rabbit.erl"},{line,440}]}]
> [...]
> 
> But of course there are no clusters and there had never been (fresh run).
> 
> Has anybody managed to do this? There has to be a way to embed the
> RabbitMQ server in your own applications.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Tue Mar 26 13:14:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Mar 2013 13:14:30 +0000
Subject: [rabbitmq-discuss] SIGTERM
In-Reply-To: <579C956E-6E5E-492A-AFA5-C57FCCD276F0@rabbitmq.com>
References: <1364221765270-25695.post@n5.nabble.com>
	<E05B1979-C29E-4B66-8D8C-466DC8FA2176@rabbitmq.com>
	<515069A9.5000308@rabbitmq.com>
	<1364275547607-25712.post@n5.nabble.com>
	<15E3A057-D382-434C-A220-958987FEFF41@rabbitmq.com>
	<515193C9.9080403@rabbitmq.com>
	<579C956E-6E5E-492A-AFA5-C57FCCD276F0@rabbitmq.com>
Message-ID: <51519F36.4040408@rabbitmq.com>

On 26/03/13 13:09, Tim Watson wrote:
> On 26 Mar 2013, at 12:25, Simon MacMullen wrote:
>> Note that you are also running as root. So I would modify two lines:
>>
>> post-start exec /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid
>> pre-stop exec /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid
>>
>
> Doesn't the previous setuid/setgid deal with that?

Argh; I wrote the "Note that" before noticing the setuid/setgid, then 
failed to delete it. Please ignore.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Tue Mar 26 13:19:18 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 26 Mar 2013 13:19:18 +0000
Subject: [rabbitmq-discuss] Running RabbitMQ server as embedded
	application
In-Reply-To: <279073FC-FC80-4343-8B5E-164D3AC914D7@rabbitmq.com>
References: <CAGQEY6nVkYahZyviYp=3o_CUqSXJxANE7g-f0rp+g0-XOuH5vg@mail.gmail.com>
	<279073FC-FC80-4343-8B5E-164D3AC914D7@rabbitmq.com>
Message-ID: <06655E21-4CCA-49E9-A0F6-01B6F5646590@rabbitmq.com>

Another thing to consider is that you're starting the vm via a script, you might be able to get away with setting SYS_PREFIX in rabbitmq-defaults (as the generic unix packaging does). We're also working on OTP packaging (i.e., delivering rabbit as a self contained package/release), though I'm not sure what kind of timescales are involved in that.

Cheers,
Tim

On 26 Mar 2013, at 13:11, Tim Watson wrote:

> Take a good look at the startup scripts. There are environment variables aplenty and various things that get passed the beam as arguments - you'll need to filter through those and make sure everything is set up properly in order for the startup sequence to work.
> 
> Cheers,
> Tim
> 
> On 26 Mar 2013, at 12:18, Jorge Diz Pico wrote:
> 
>> Hi folks, I'm trying to run a RabbitMQ server the OTP way, but it's
>> becoming harder than I thought. I added all dependencies to my
>> release, but when I run application:start(rabbit), I get the following
>> error:
>> 
>> [...]
>> -- rabbit boot start
>> starting file handle cache server                                     ...done
>> starting worker pool                                                  ...done
>> starting database                                                     ...
>> 
>> BOOT FAILED
>> ===========
>> 
>> Error description:
>>  {error,{corrupt_or_missing_cluster_files,{error,enoent},{error,enoent}}}
>> 
>> Log files (may contain more information):
>>  undefined
>>  undefined
>> 
>> Stack trace:
>>  [{rabbit_node_monitor,read_cluster_status,0,
>>                        [{file,"src/rabbit_node_monitor.erl"},{line,139}]},
>>   {rabbit_mnesia,cluster_status,1,
>>                  [{file,"src/rabbit_mnesia.erl"},{line,391}]},
>>   {rabbit_mnesia,node_type,0,[{file,"src/rabbit_mnesia.erl"},{line,410}]},
>>   {rabbit_mnesia,init,0,[{file,"src/rabbit_mnesia.erl"},{line,97}]},
>>   {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,
>>           [{file,"src/rabbit.erl"},{line,481}]},
>>   {rabbit,run_boot_step,1,[{file,"src/rabbit.erl"},{line,480}]},
>>   {rabbit,'-start/2-lc$^0/1-0-',1,[{file,"src/rabbit.erl"},{line,440}]},
>>   {rabbit,start,2,[{file,"src/rabbit.erl"},{line,440}]}]
>> [...]
>> 
>> But of course there are no clusters and there had never been (fresh run).
>> 
>> Has anybody managed to do this? There has to be a way to embed the
>> RabbitMQ server in your own applications.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Tue Mar 26 13:23:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Mar 2013 13:23:53 +0000
Subject: [rabbitmq-discuss] Running RabbitMQ server as embedded
	application
In-Reply-To: <06655E21-4CCA-49E9-A0F6-01B6F5646590@rabbitmq.com>
References: <CAGQEY6nVkYahZyviYp=3o_CUqSXJxANE7g-f0rp+g0-XOuH5vg@mail.gmail.com>
	<279073FC-FC80-4343-8B5E-164D3AC914D7@rabbitmq.com>
	<06655E21-4CCA-49E9-A0F6-01B6F5646590@rabbitmq.com>
Message-ID: <5151A169.4060901@rabbitmq.com>

On 26/03/13 13:19, Tim Watson wrote:
> We're also
> working on OTP packaging (i.e., delivering rabbit as a self contained
> package/release), though I'm not sure what kind of timescales are
> involved in that.

We'll be delivering an experimental tarball for OS X in the next 
release; if that works well then we'll probably roll more versions.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Tue Mar 26 13:30:26 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 26 Mar 2013 14:30:26 +0100
Subject: [rabbitmq-discuss] Running RabbitMQ server as embedded
	application
In-Reply-To: <06655E21-4CCA-49E9-A0F6-01B6F5646590@rabbitmq.com>
References: <CAGQEY6nVkYahZyviYp=3o_CUqSXJxANE7g-f0rp+g0-XOuH5vg@mail.gmail.com>
	<279073FC-FC80-4343-8B5E-164D3AC914D7@rabbitmq.com>
	<06655E21-4CCA-49E9-A0F6-01B6F5646590@rabbitmq.com>
Message-ID: <CAMcAHLVY6m1Owoc8Vmz=CW8SpLF=xSumB9fZ-4s8OM7a6ukmLw@mail.gmail.com>

Hi,

The OTP packaging has been merged into default, at the moment it works for
Mac only. Some of the files involved in making the release are here:
http://hg.rabbitmq.com/rabbitmq-server/file/0271f21bd596/packaging/standalone

Then the sbin scripts have been modified to support different erlang boot
files and so on.

The related bug branch is bug25271.

Regards,

Alvaro


On Tue, Mar 26, 2013 at 2:19 PM, Tim Watson <tim at rabbitmq.com> wrote:

> Another thing to consider is that you're starting the vm via a script, you
> might be able to get away with setting SYS_PREFIX in rabbitmq-defaults (as
> the generic unix packaging does). We're also working on OTP packaging
> (i.e., delivering rabbit as a self contained package/release), though I'm
> not sure what kind of timescales are involved in that.
>
> Cheers,
> Tim
>
> On 26 Mar 2013, at 13:11, Tim Watson wrote:
>
> > Take a good look at the startup scripts. There are environment variables
> aplenty and various things that get passed the beam as arguments - you'll
> need to filter through those and make sure everything is set up properly in
> order for the startup sequence to work.
> >
> > Cheers,
> > Tim
> >
> > On 26 Mar 2013, at 12:18, Jorge Diz Pico wrote:
> >
> >> Hi folks, I'm trying to run a RabbitMQ server the OTP way, but it's
> >> becoming harder than I thought. I added all dependencies to my
> >> release, but when I run application:start(rabbit), I get the following
> >> error:
> >>
> >> [...]
> >> -- rabbit boot start
> >> starting file handle cache server
> ...done
> >> starting worker pool
>  ...done
> >> starting database
> ...
> >>
> >> BOOT FAILED
> >> ===========
> >>
> >> Error description:
> >>
>  {error,{corrupt_or_missing_cluster_files,{error,enoent},{error,enoent}}}
> >>
> >> Log files (may contain more information):
> >>  undefined
> >>  undefined
> >>
> >> Stack trace:
> >>  [{rabbit_node_monitor,read_cluster_status,0,
> >>
>  [{file,"src/rabbit_node_monitor.erl"},{line,139}]},
> >>   {rabbit_mnesia,cluster_status,1,
> >>                  [{file,"src/rabbit_mnesia.erl"},{line,391}]},
> >>
> {rabbit_mnesia,node_type,0,[{file,"src/rabbit_mnesia.erl"},{line,410}]},
> >>   {rabbit_mnesia,init,0,[{file,"src/rabbit_mnesia.erl"},{line,97}]},
> >>   {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,
> >>           [{file,"src/rabbit.erl"},{line,481}]},
> >>   {rabbit,run_boot_step,1,[{file,"src/rabbit.erl"},{line,480}]},
> >>   {rabbit,'-start/2-lc$^0/1-0-',1,[{file,"src/rabbit.erl"},{line,440}]},
> >>   {rabbit,start,2,[{file,"src/rabbit.erl"},{line,440}]}]
> >> [...]
> >>
> >> But of course there are no clusters and there had never been (fresh
> run).
> >>
> >> Has anybody managed to do this? There has to be a way to embed the
> >> RabbitMQ server in your own applications.
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130326/9e9cc630/attachment.htm>

From carl.hoerberg at gmail.com  Tue Mar 26 14:51:07 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Tue, 26 Mar 2013 07:51:07 -0700 (PDT)
Subject: [rabbitmq-discuss] SIGTERM
In-Reply-To: <51519F36.4040408@rabbitmq.com>
References: <1364221765270-25695.post@n5.nabble.com>
	<E05B1979-C29E-4B66-8D8C-466DC8FA2176@rabbitmq.com>
	<515069A9.5000308@rabbitmq.com>
	<1364275547607-25712.post@n5.nabble.com>
	<15E3A057-D382-434C-A220-958987FEFF41@rabbitmq.com>
	<515193C9.9080403@rabbitmq.com>
	<579C956E-6E5E-492A-AFA5-C57FCCD276F0@rabbitmq.com>
	<51519F36.4040408@rabbitmq.com>
Message-ID: <4F31EAD8055A4E4DB39659ED5CB68287@gmail.com>

Yes, $PID_FILE and "normal exit 0" was important, without "normal exit" the process would be respawned as soon as it was stopped in pre-stop.  

description "RabbitMQ Server"
start on runlevel [2345]
stop on runlevel [016]
kill timeout 60
respawn
respawn limit 10 5
normal exit 0 
console log
setuid rabbitmq
setgid rabbitmq
env HOME=/var/lib/rabbitmq
env PID_FILE=/var/run/rabbitmq/pid
exec /usr/lib/rabbitmq/bin/rabbitmq-server
post-start exec /usr/sbin/rabbitmqctl wait $PID_FILE
pre-stop exec /usr/sbin/rabbitmqctl stop $PID_FILE


Thanks!  


On Tuesday 26 March 2013 at 21:15, Simon MacMullen-2 [via RabbitMQ] wrote:

> On 26/03/13 13:09, Tim Watson wrote: 
> > On 26 Mar 2013, at 12:25, Simon MacMullen wrote: 
> > > Note that you are also running as root. So I would modify two lines: 
> > > 
> > > post-start exec /usr/sbin/rabbitmqctl wait /var/run/rabbitmq/pid 
> > > pre-stop exec /usr/sbin/rabbitmqctl stop /var/run/rabbitmq/pid 
> > 
> > 
> > Doesn't the previous setuid/setgid deal with that? 
> 
> Argh; I wrote the "Note that" before noticing the setuid/setgid, then 
> failed to delete it. Please ignore. 
> 
> Cheers, Simon 
> 
> -- 
> Simon MacMullen 
> RabbitMQ, VMware 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=25728&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/SIGTERM-tp25695p25728.html 
> To unsubscribe from SIGTERM, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25695&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU2OTV8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/SIGTERM-tp25695p25732.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130326/37744931/attachment.htm>

From tim at rabbitmq.com  Tue Mar 26 15:46:42 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 26 Mar 2013 15:46:42 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <19164406BD624090AB5BF53AFC73C012@gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
Message-ID: <A683AB97-232E-4AC7-AC90-37BD44156574@rabbitmq.com>

Hi Ben,

Sorry for the delayed response.

On 23 Mar 2013, at 23:06, Ben Hood wrote:
> Hey Tim,
> I don't think that everything needs to fit on one line. Longer traces which provide good context should probably remain as multiline entries. However, info items, for example,
> 
> Mar 22 22:33:01 a rabbit3:  =INFO REPORT==== 22-Mar-2013::22:33:01 === 
> Mar 22 22:33:01 a rabbit3:  Setting permissions for 'guest' in '/' to '.*', '.*', '.*' 
> 
> need not get split up over two lines.
> 

Sure I understand the desire for that. We still need to decide whether having an external dependency is something we really want to do though.

> With regard to longer traces, it would be nice if they could be handled in such a way that the generic portion of the call stack were trimmed down to something nearer the actual call site, rather that the entire generic call trace. As inspiration, logback mitigates the default "root cause comes last" behavior in Java with the reverse depth layout modifier (rEx{depth}). Lot's of hand waving here though.
> 

I agree, but that's something lager is responsible for so it's not exactly all in our hands.

> Finally, I do have to concur with Gavin on people's perception about Rabbit due to logging - I've have many conversations with people over the years who ask why Rabbit has such bizare logging - I've generally answered that this is an Erlang-ism, and though it is strange, the server kind of serves its primary function well (i.e. delivering messages), so just put up with it.
> 

Would it be sufficient to simply rely on lager's error_logger replacement (handler) instead of switching completely over to lager's API? Can we get really specific about what exactly we want to be able to do? I mean, are people asking to be able to configure the logging output (format) or add additional appenders (which was the origin request) or both?

Cheers,
Tim

> Cheers,
> 
> Ben
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From kishmiryankarlen at gmail.com  Tue Mar 26 16:20:04 2013
From: kishmiryankarlen at gmail.com (Karlen Kishmiryan)
Date: Tue, 26 Mar 2013 09:20:04 -0700 (PDT)
Subject: [rabbitmq-discuss] How to implement consumer's sequential work
	correctly?
Message-ID: <9fa44c9b-1deb-4fe9-9819-27c7c17aa315@googlegroups.com>

Hello,
Here are three steps I want to do:

   1. pull some file names and pass them to the downloader (first consumer)
   2. AFTER downloading each file pass them to the extracter (second 
   consumer)
   3. AFTER extracting pass them to the Inserter (third consumer) to push 
   the data into DB

Now I would like to know how I will manage these "AFTER"s. 
As I understand there are two solutions:

   1. each consumer must send the message to the producer back about 
   success or failure of the task. If it's done successfully, then producer 
   must send to the next consumer.
   2. each consumer must put the message to the next consumer's queue when 
   it's done

Actually I don't know how to realize both of them.
Please, help me to solve this problem. If any of my solutions is right, 
please tell me how to implement it. Or please explain me the right solution 
in this situation.

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130326/6fefb7b1/attachment.htm>

From tim at rabbitmq.com  Tue Mar 26 19:53:21 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 26 Mar 2013 19:53:21 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <19164406BD624090AB5BF53AFC73C012@gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
Message-ID: <CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>

I have set up an experimental repository at https://github.com/hyperthunk/rabbitmq-lager that supports logging to lager via its built in error_logger redirection. You enable via `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config file just like any other plugin, under the key 'lager'. In the morning I'll chat with the guys about integrating this as experimental plugin for the time being, so people can play around and see if it offers the required functionality.

Cheers,
Tim

On 23 Mar 2013, at 23:06, Ben Hood wrote:

> Hey Tim,
> On Friday, 22 March 2013 at 07:55, Tim Watson wrote:
> 
>> Yeah with the current implementation you'd need to install your own log handler to make that work. In terms of changing the output format though, allowe to play devil's advocate for a moment...
>> 
>> The info/progress/error reports have a lot of data in them, process stats, stack traces, etc. are you wanting to see all that plonked on one single long line? Because I can see how that'd make parsing/aggregating easier, but not reading them. Does the lager output fit exactly with what you want (I've not looks at it or a couple of years)?
> I don't think that everything needs to fit on one line. Longer traces which provide good context should probably remain as multiline entries. However, info items, for example,
> 
> Mar 22 22:33:01 a rabbit3:  =INFO REPORT==== 22-Mar-2013::22:33:01 === 
> Mar 22 22:33:01 a rabbit3:  Setting permissions for 'guest' in '/' to '.*', '.*', '.*' 
> 
> need not get split up over two lines.
> 
> With regard to longer traces, it would be nice if they could be handled in such a way that the generic portion of the call stack were trimmed down to something nearer the actual call site, rather that the entire generic call trace. As inspiration, logback mitigates the default "root cause comes last" behavior in Java with the reverse depth layout modifier (rEx{depth}). Lot's of hand waving here though.
> 
> Finally, I do have to concur with Gavin on people's perception about Rabbit due to logging - I've have many conversations with people over the years who ask why Rabbit has such bizare logging - I've generally answered that this is an Erlang-ism, and though it is strange, the server kind of serves its primary function well (i.e. delivering messages), so just put up with it.
> 
> Cheers,
> 
> Ben
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gmr at meetme.com  Tue Mar 26 20:51:02 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Tue, 26 Mar 2013 16:51:02 -0400
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
Message-ID: <CAKwdTWdgkWj+DWU0MxqLxMf622YWePSs3WbVkbn825Ryk5L+QA@mail.gmail.com>

That's awesome Tim, thanks!


On Tue, Mar 26, 2013 at 3:53 PM, Tim Watson <tim at rabbitmq.com> wrote:

> I have set up an experimental repository at
> https://github.com/hyperthunk/rabbitmq-lager that supports logging to
> lager via its built in error_logger redirection. You enable via
> `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config
> file just like any other plugin, under the key 'lager'. In the morning I'll
> chat with the guys about integrating this as experimental plugin for the
> time being, so people can play around and see if it offers the required
> functionality.
>
> Cheers,
> Tim
>
> On 23 Mar 2013, at 23:06, Ben Hood wrote:
>
> > Hey Tim,
> > On Friday, 22 March 2013 at 07:55, Tim Watson wrote:
> >
> >> Yeah with the current implementation you'd need to install your own log
> handler to make that work. In terms of changing the output format though,
> allowe to play devil's advocate for a moment...
> >>
> >> The info/progress/error reports have a lot of data in them, process
> stats, stack traces, etc. are you wanting to see all that plonked on one
> single long line? Because I can see how that'd make parsing/aggregating
> easier, but not reading them. Does the lager output fit exactly with what
> you want (I've not looks at it or a couple of years)?
> > I don't think that everything needs to fit on one line. Longer traces
> which provide good context should probably remain as multiline entries.
> However, info items, for example,
> >
> > Mar 22 22:33:01 a rabbit3:  =INFO REPORT==== 22-Mar-2013::22:33:01 ===
> > Mar 22 22:33:01 a rabbit3:  Setting permissions for 'guest' in '/' to
> '.*', '.*', '.*'
> >
> > need not get split up over two lines.
> >
> > With regard to longer traces, it would be nice if they could be handled
> in such a way that the generic portion of the call stack were trimmed down
> to something nearer the actual call site, rather that the entire generic
> call trace. As inspiration, logback mitigates the default "root cause comes
> last" behavior in Java with the reverse depth layout modifier (rEx{depth}).
> Lot's of hand waving here though.
> >
> > Finally, I do have to concur with Gavin on people's perception about
> Rabbit due to logging - I've have many conversations with people over the
> years who ask why Rabbit has such bizare logging - I've generally answered
> that this is an Erlang-ism, and though it is strange, the server kind of
> serves its primary function well (i.e. delivering messages), so just put up
> with it.
> >
> > Cheers,
> >
> > Ben
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130326/c4c26565/attachment.htm>

From 0x6e6562 at gmail.com  Wed Mar 27 00:19:18 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 26 Mar 2013 20:19:18 -0400
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
Message-ID: <764638297ACA469080F0C7943CA815A8@gmail.com>

On Tuesday, 26 March 2013 at 15:53, Tim Watson wrote:
> I have set up an experimental repository at https://github.com/hyperthunk/rabbitmq-lager that supports logging to lager via its built in error_logger redirection. You enable via `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config file just like any other plugin, under the key 'lager'. In the morning I'll chat with the guys about integrating this as experimental plugin for the time being, so people can play around and see if it offers the required functionality.
> 
> 

Very cool - nice one Tim!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130326/a68ecf25/attachment.htm>

From victor at boivie.com  Wed Mar 27 06:26:43 2013
From: victor at boivie.com (Victor Boivie)
Date: Wed, 27 Mar 2013 07:26:43 +0100
Subject: [rabbitmq-discuss] java-client: Reproducable "COMMAND_INVALID -
	second 'channel.open' seen"
Message-ID: <CAJ9O1RrG1CCZbh5eoWgQswaZur9yGj3FOdSSXHqasBjucVSZsA@mail.gmail.com>

I have been having some problems with the java-rabbitmq-client when stress
testing it. I frequently get "COMMAND_INVALID - second 'channel.open'
seen", which eventually closes the connection (not just the channel).

It seems that there is a race condition when channels are closed
asynchronously (due to errors), and created in other threads. The channel
that is closed (by the server) doesn't seem to be fully closed before
another thread can try to open a channel with the same number.

The code to reproduce it is at https://github.com/boivie/rmq-stress-test

A possible fix is below.

Thanks,
Victor


From victor at boivie.com  Wed Mar 27 06:22:04 2013
From: victor at boivie.com (Victor Boivie)
Date: Wed, 27 Mar 2013 07:22:04 +0100
Subject: [PATCH] Fix race-condition of asynchronously closed channels
Message-ID: <mailman.2.1364366201.3387.rabbitmq-discuss@lists.rabbitmq.com>

When a channel is closed from the server side due to errors we
have to send CloseOk before we can make it available for allocation
again. If not, we risk handing it out to a client which will open it
when it's not yet fully closed, which results in a
"COMMAND_INVALID - second 'channel.open' seen".

diff --git a/src/com/rabbitmq/client/impl/ChannelN.java
b/src/com/rabbitmq/client/impl/ChannelN.java
index 18e4f6a..9fe11c3 100644
--- a/src/com/rabbitmq/client/impl/ChannelN.java
+++ b/src/com/rabbitmq/client/impl/ChannelN.java
@@ -471,7 +471,6 @@ public class ChannelN extends AMQChannel implements
com.rabbitmq.client.Channel
     }

     private void asyncShutdown(Command command) throws IOException {
-        releaseChannel();
         ShutdownSignalException signal = new ShutdownSignalException(false,
                                                                      false,

command,
@@ -484,6 +483,7 @@ public class ChannelN extends AMQChannel implements
com.rabbitmq.client.Channel
                 notifyOutstandingRpc(signal);
             }
         }
+        releaseChannel();
         notifyListeners();
     }

--e89a8f923cfe1fa0d404d8e21fb8
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">I have been having some problems with the java-rabbitmq-cl=
ient when stress testing it. I frequently get &quot;COMMAND_INVALID - secon=
d &#39;channel.open&#39; seen&quot;, which eventually closes the connection=
 (not just the channel).<div>
<br></div><div style>It seems that there is a race condition when channels =
are closed asynchronously (due to errors), and created in other threads. Th=
e channel that is closed (by the server) doesn&#39;t seem to be fully close=
d before another thread can try to open a channel with the same number.</di=
v>
<div style><br></div><div style>The code to reproduce it is at=A0<a href=3D=
"https://github.com/boivie/rmq-stress-test">https://github.com/boivie/rmq-s=
tress-test</a></div><div style><br></div><div style>A possible fix is below=
.</div>
<div style><br></div><div style>Thanks,</div><div style>Victor</div><div st=
yle><br></div><div style><div>From 213cf8ef15a759985bc9dd74496548236b5160f2=
 Mon Sep 17 00:00:00 2001</div><div>From: Victor Boivie &lt;<a href=3D"mail=
to:victor at boivie.com">victor at boivie.com</a>&gt;</div>
<div>Date: Wed, 27 Mar 2013 07:22:04 +0100</div><div>Subject: [PATCH] Fix r=
ace-condition of asynchronously closed channels</div><div><br></div><div>Wh=
en a channel is closed from the server side due to errors we</div><div>
have to send CloseOk before we can make it available for allocation</div><d=
iv>again. If not, we risk handing it out to a client which will open it</di=
v><div>when it&#39;s not yet fully closed, which results in a</div><div>
&quot;COMMAND_INVALID - second &#39;channel.open&#39; seen&quot;.</div><div=
><br></div><div>diff --git a/src/com/rabbitmq/client/impl/ChannelN.java b/s=
rc/com/rabbitmq/client/impl/ChannelN.java</div><div>index 18e4f6a..9fe11c3 =
100644</div>
<div>--- a/src/com/rabbitmq/client/impl/ChannelN.java</div><div>+++ b/src/c=
om/rabbitmq/client/impl/ChannelN.java</div><div>@@ -471,7 +471,6 @@ public =
class ChannelN extends AMQChannel implements com.rabbitmq.client.Channel</d=
iv>
<div>=A0 =A0 =A0}</div><div>=A0</div><div>=A0 =A0 =A0private void asyncShut=
down(Command command) throws IOException {</div><div>- =A0 =A0 =A0 =A0relea=
seChannel();</div><div>=A0 =A0 =A0 =A0 =A0ShutdownSignalException signal =
=3D new ShutdownSignalException(false,</div>
<div>=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 fal=
se,</div><div>=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0=
 =A0 command,</div><div>@@ -484,6 +483,7 @@ public class ChannelN extends A=
MQChannel implements com.rabbitmq.client.Channel</div>
<div>=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0notifyOutstandingRpc(signal);</div>=
<div>=A0 =A0 =A0 =A0 =A0 =A0 =A0}</div><div>=A0 =A0 =A0 =A0 =A0}</div><div>=
+ =A0 =A0 =A0 =A0releaseChannel();</div><div>=A0 =A0 =A0 =A0 =A0notifyListe=
ners();</div><div>=A0 =A0 =A0}</div><div>=A0</div></div></div>

--e89a8f923cfe1fa0d404d8e21fb8--

From tim at rabbitmq.com  Wed Mar 27 11:08:13 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 27 Mar 2013 11:08:13 +0000
Subject: [rabbitmq-discuss] java-client: Reproducable "COMMAND_INVALID -
 second 'channel.open' seen"
In-Reply-To: <CAJ9O1RrG1CCZbh5eoWgQswaZur9yGj3FOdSSXHqasBjucVSZsA@mail.gmail.com>
References: <CAJ9O1RrG1CCZbh5eoWgQswaZur9yGj3FOdSSXHqasBjucVSZsA@mail.gmail.com>
Message-ID: <5152D31D.9070006@rabbitmq.com>

Hi Victor,

Thanks for reporting this, and for providing a test case! I've filed a 
bug to fix it and hopefully it'll be included in the next release.

Tim

On 03/27/2013 06:26 AM, Victor Boivie wrote:
> I have been having some problems with the java-rabbitmq-client when 
> stress testing it. I frequently get "COMMAND_INVALID - second 
> 'channel.open' seen", which eventually closes the connection (not just 
> the channel).
>
> It seems that there is a race condition when channels are closed 
> asynchronously (due to errors), and created in other threads. The 
> channel that is closed (by the server) doesn't seem to be fully closed 
> before another thread can try to open a channel with the same number.
>
> The code to reproduce it is at https://github.com/boivie/rmq-stress-test
>
> A possible fix is below.
>
> Thanks,
> Victor
>
> From 213cf8ef15a759985bc9dd74496548236b5160f2 Mon Sep 17 00:00:00 2001
> From: Victor Boivie <victor at boivie.com <mailto:victor at boivie.com>>
> Date: Wed, 27 Mar 2013 07:22:04 +0100
> Subject: [PATCH] Fix race-condition of asynchronously closed channels
>
> When a channel is closed from the server side due to errors we
> have to send CloseOk before we can make it available for allocation
> again. If not, we risk handing it out to a client which will open it
> when it's not yet fully closed, which results in a
> "COMMAND_INVALID - second 'channel.open' seen".
>
> diff --git a/src/com/rabbitmq/client/impl/ChannelN.java 
> b/src/com/rabbitmq/client/impl/ChannelN.java
> index 18e4f6a..9fe11c3 100644
> --- a/src/com/rabbitmq/client/impl/ChannelN.java
> +++ b/src/com/rabbitmq/client/impl/ChannelN.java
> @@ -471,7 +471,6 @@ public class ChannelN extends AMQChannel 
> implements com.rabbitmq.client.Channel
>      }
>      private void asyncShutdown(Command command) throws IOException {
> -        releaseChannel();
>          ShutdownSignalException signal = new 
> ShutdownSignalException(false,
>                                                                       
> false,
>                                                                       
> command,
> @@ -484,6 +483,7 @@ public class ChannelN extends AMQChannel 
> implements com.rabbitmq.client.Channel
>                  notifyOutstandingRpc(signal);
>              }
>          }
> +        releaseChannel();
>          notifyListeners();
>      }
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130327/980b7140/attachment.htm>

From simon at rabbitmq.com  Wed Mar 27 12:20:56 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 27 Mar 2013 12:20:56 +0000
Subject: [rabbitmq-discuss] message_stats available in /api/queues but
 not /api/queues/(vhost)/(queue)?
In-Reply-To: <515069D0.70204@conversis.de>
References: <515069D0.70204@conversis.de>
Message-ID: <5152E428.4050601@rabbitmq.com>

On 25/03/13 15:14, Dennis Jacobfeuerborn wrote:
> Hi,
> is it possible that the api data for all queues and the api data for a
> specific queue is inconsistent?
> When I look unter /api/queues directly I find values for message_stats
> for a queue but when I look up the data for this specific queue that
> information doesn't seem to be available. Is this intended?

No, you should get *more* information on an individual queue, not less 
(per-exchange and per-channel message stats via "incoming" and 
"deliveries").

However, not all queues will have a message_stats key - in particular 
those which are not doing anything might not have one. Could that be 
what you're seeing?

Cheers, simon

-- 
Simon MacMullen
RabbitMQ, VMware

From fred at dushin.net  Wed Mar 27 12:35:01 2013
From: fred at dushin.net (Dushin Fred)
Date: Wed, 27 Mar 2013 08:35:01 -0400
Subject: [rabbitmq-discuss] Suggestions for queue rename
Message-ID: <17AA4869-C04D-4D61-85D1-65EB5E875628@dushin.net>


I am implementing a solution for renaming queues, in the case of a software upgrade, where we have decided to change naming patterns for queues between releases.  This is in a non-clustered environment.  During the upgrade, I can guarantee that the broker is "isolated" (no one publishing or consuming other than the migration code).

I am implementing this as code that runs in the broker, as a plugin, and using an AMQP direct connection.  All of my exchanges are direct, but I have some queues that are bound to the same exchange with different routing keys.

My algorithm is:

input: Exchange E, Queue Q, Routing Key K, new Queue name NQ

Precondition: Q is bound to E via K and \exists Q' != Q bound to E via K

For each Queue Q bound to Exchange E with RoutingKey K
  1. Unbind Q from E
  2. Create new Queue NQ
  3. Create a temporary Exchange TE
  4. Bind NQ to TE with temporary routing key TK
  5. for each message, M, in Q, get M, publish M to TE, ack M
  6. delete exchange TE
  6. Bind E to NQ with routing key K

Postcondition: NQ is bound to E via K and !\exists Q 

Question: Is there an easier way to do this, e.g., via internal APIs in the broker?

Thanks in advance for the free consulting :)

-Fred


From emile at rabbitmq.com  Wed Mar 27 13:56:02 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 27 Mar 2013 13:56:02 +0000
Subject: [rabbitmq-discuss] Suggestions for queue rename
In-Reply-To: <17AA4869-C04D-4D61-85D1-65EB5E875628@dushin.net>
References: <17AA4869-C04D-4D61-85D1-65EB5E875628@dushin.net>
Message-ID: <5152FA72.9050103@rabbitmq.com>



Hi,


On 27/03/13 12:35, Dushin Fred wrote:
> Postcondition: NQ is bound to E via K and !\exists Q

This is a fair approximation but bear in mind that some information is
destroyed in this process. Any messages that had their redelivered flag
turned on will have that flag  reset. Information about TTL will also be
reset.

> Question: Is there an easier way to do this, e.g., via internal APIs
> in the broker?

It might be possible to perform the renaming in the Mnesia database
directly. but I wouldn't recommend it. For one, it would become very
challenging to obtain support for your installation at that point. Also,
there are various event triggers that normally fire at resource creation
time that will be bypassed if you perform a rename in the database.




-Emile




From tim at rabbitmq.com  Wed Mar 27 14:03:38 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 27 Mar 2013 14:03:38 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <764638297ACA469080F0C7943CA815A8@gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
Message-ID: <6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>

If anyone wants to try this plugin out, there are instructions in the README file on github now. You'll need at least R14B03 to use lager afaict. Please shout if you run into any difficulties.

Cheers,
Tim

On 27 Mar 2013, at 00:19, Ben Hood wrote:

> On Tuesday, 26 March 2013 at 15:53, Tim Watson wrote:
>> I have set up an experimental repository at https://github.com/hyperthunk/rabbitmq-lager that supports logging to lager via its built in error_logger redirection. You enable via `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config file just like any other plugin, under the key 'lager'. In the morning I'll chat with the guys about integrating this as experimental plugin for the time being, so people can play around and see if it offers the required functionality.
> Very cool - nice one Tim!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mak at issuu.com  Wed Mar 27 13:26:28 2013
From: mak at issuu.com (Martin Koch)
Date: Wed, 27 Mar 2013 06:26:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Randomized Round-Robin?
Message-ID: <c1d64a0e-4532-4e05-876a-363ab25df67c@googlegroups.com>

Hi Group

I have a setup with many workers on several hosts; each worker consumes 
tasks from a work queue. 

When a host is booted, all workers on that host are launched 
simultaneously. 

This seems to have the effect that messages are first rounded to worker 
1..N on host A, then worker 1..N on host B, etc. This basically means that 
only one of the hosts is doing the bulk of the work at any given time. 

What I would like to achieve is that a random worker is chosen instead of 
the deterministic round-robin.

Any ideas?

Thanks,
/Martin Koch - Senior Systems Architect - Issuu.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130327/418790bd/attachment.htm>

From tim at rabbitmq.com  Wed Mar 27 16:46:57 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 27 Mar 2013 16:46:57 +0000
Subject: [rabbitmq-discuss] Feedback On Logging Frameworks Please! (was
	lager vs sasl error log)
In-Reply-To: <6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
Message-ID: <70526DB1-3700-49B6-98FA-38D95E673733@rabbitmq.com>

Hello all!

I recently notified the mailing list that I've created a plugin providing a way to integrate the lager logging framework into RabbitMQ as a plugin: https://github.com/hyperthunk/rabbitmq-lager.

If you're interested in seeing improvements to rabbit's logging then please give this a try and give us some feedback. In particular, we'd like to know whether the approach I've taken (i.e., using lager's error_logger redirection) provides *enough* functionality for our users and/or what additional features you'd like to see. Getting decent feedback is a prerequisite to getting these changes integrated into rabbit in a permanent and supported manner, so please don't be shy!

If you're cc'ed on this email then you've piped up about logging recently/before on this list, and therefore I've kindly singled you out as a potential victim, erm... wait no... volunteer! That's right! ;)

So, feedback on a postcard please folks! We'd like to get this 'just right' so everyone has *nice* things to say about our gorgeous log files and configurable backends and whatnot.

Cheers,
Tim

From jorge.diz at nomasystems.com  Wed Mar 27 18:23:24 2013
From: jorge.diz at nomasystems.com (Jorge Diz Pico)
Date: Wed, 27 Mar 2013 19:23:24 +0100
Subject: [rabbitmq-discuss] Running RabbitMQ server as embedded
	application
In-Reply-To: <CAMcAHLVY6m1Owoc8Vmz=CW8SpLF=xSumB9fZ-4s8OM7a6ukmLw@mail.gmail.com>
References: <CAGQEY6nVkYahZyviYp=3o_CUqSXJxANE7g-f0rp+g0-XOuH5vg@mail.gmail.com>
	<279073FC-FC80-4343-8B5E-164D3AC914D7@rabbitmq.com>
	<06655E21-4CCA-49E9-A0F6-01B6F5646590@rabbitmq.com>
	<CAMcAHLVY6m1Owoc8Vmz=CW8SpLF=xSumB9fZ-4s8OM7a6ukmLw@mail.gmail.com>
Message-ID: <CAGQEY6kCS5hKGnDngvGcYkDSUjTxxHXkbyq3GURLHqytwfdB6Q@mail.gmail.com>

I tried my luck at the OTP packaging in RHEL6 and it seems to work as
fine as it did on my MacBook, so I'll take my chances with it.

Thank y'all for your replies.

On Tue, Mar 26, 2013 at 2:30 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi,
>
> The OTP packaging has been merged into default, at the moment it works for
> Mac only. Some of the files involved in making the release are here:
> http://hg.rabbitmq.com/rabbitmq-server/file/0271f21bd596/packaging/standalone
>
> Then the sbin scripts have been modified to support different erlang boot
> files and so on.
>
> The related bug branch is bug25271.
>
> Regards,
>
> Alvaro
>
>
> On Tue, Mar 26, 2013 at 2:19 PM, Tim Watson <tim at rabbitmq.com> wrote:
>>
>> Another thing to consider is that you're starting the vm via a script, you
>> might be able to get away with setting SYS_PREFIX in rabbitmq-defaults (as
>> the generic unix packaging does). We're also working on OTP packaging (i.e.,
>> delivering rabbit as a self contained package/release), though I'm not sure
>> what kind of timescales are involved in that.
>>
>> Cheers,
>> Tim
>>
>> On 26 Mar 2013, at 13:11, Tim Watson wrote:
>>
>> > Take a good look at the startup scripts. There are environment variables
>> > aplenty and various things that get passed the beam as arguments - you'll
>> > need to filter through those and make sure everything is set up properly in
>> > order for the startup sequence to work.
>> >
>> > Cheers,
>> > Tim
>> >
>> > On 26 Mar 2013, at 12:18, Jorge Diz Pico wrote:
>> >
>> >> Hi folks, I'm trying to run a RabbitMQ server the OTP way, but it's
>> >> becoming harder than I thought. I added all dependencies to my
>> >> release, but when I run application:start(rabbit), I get the following
>> >> error:
>> >>
>> >> [...]
>> >> -- rabbit boot start
>> >> starting file handle cache server
>> >> ...done
>> >> starting worker pool
>> >> ...done
>> >> starting database
>> >> ...
>> >>
>> >> BOOT FAILED
>> >> ===========
>> >>
>> >> Error description:
>> >>
>> >> {error,{corrupt_or_missing_cluster_files,{error,enoent},{error,enoent}}}
>> >>
>> >> Log files (may contain more information):
>> >>  undefined
>> >>  undefined
>> >>
>> >> Stack trace:
>> >>  [{rabbit_node_monitor,read_cluster_status,0,
>> >>
>> >> [{file,"src/rabbit_node_monitor.erl"},{line,139}]},
>> >>   {rabbit_mnesia,cluster_status,1,
>> >>                  [{file,"src/rabbit_mnesia.erl"},{line,391}]},
>> >>
>> >> {rabbit_mnesia,node_type,0,[{file,"src/rabbit_mnesia.erl"},{line,410}]},
>> >>   {rabbit_mnesia,init,0,[{file,"src/rabbit_mnesia.erl"},{line,97}]},
>> >>   {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,
>> >>           [{file,"src/rabbit.erl"},{line,481}]},
>> >>   {rabbit,run_boot_step,1,[{file,"src/rabbit.erl"},{line,480}]},
>> >>
>> >> {rabbit,'-start/2-lc$^0/1-0-',1,[{file,"src/rabbit.erl"},{line,440}]},
>> >>   {rabbit,start,2,[{file,"src/rabbit.erl"},{line,440}]}]
>> >> [...]
>> >>
>> >> But of course there are no clusters and there had never been (fresh
>> >> run).
>> >>
>> >> Has anybody managed to do this? There has to be a way to embed the
>> >> RabbitMQ server in your own applications.
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From Petr.Gotthard at Honeywell.com  Wed Mar 27 19:23:19 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Wed, 27 Mar 2013 19:23:19 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log / badarg?
In-Reply-To: <6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D2D1854@FR44EX3005.global.ds.honeywell.com>

Hi,
We used a custom lager plugin before without any troubles, but after switching to your plugin I'm getting 'badarg' when rabbit prints the name of the plugin. I disabled all plugins, except lager.

Stack trace:
   [{rabbit,'-print_plugin_info/1-lc$^0/1-0-',1,[]},
    {rabbit,'-print_plugin_info/1-fun-0-',1,[]},
    {rabbit_misc,with_local_io,1,[]},
    {rabbit,'-boot/0-fun-1-',0,[]},
    {rabbit,start_it,1,[]},
    {init,start_it,1,[]},
    {init,start_em,1,[]}]


Does it ring a bell to you?

Could it be caused by the unusual naming? The plugin is named "lager", while the directory is "rabbitmq_lager" and the .ez is called "rabbitmq_lager-2.0.0-rmq0.0.1-git9719370".


Petr

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: 27. b?ezna 2013 15:04
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] lager vs sasl error log

If anyone wants to try this plugin out, there are instructions in the README file on github now. You'll need at least R14B03 to use lager afaict. Please shout if you run into any difficulties.

Cheers,
Tim

On 27 Mar 2013, at 00:19, Ben Hood wrote:

> On Tuesday, 26 March 2013 at 15:53, Tim Watson wrote:
>> I have set up an experimental repository at https://github.com/hyperthunk/rabbitmq-lager that supports logging to lager via its built in error_logger redirection. You enable via `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config file just like any other plugin, under the key 'lager'. In the morning I'll chat with the guys about integrating this as experimental plugin for the time being, so people can play around and see if it offers the required functionality.
> Very cool - nice one Tim!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From videlalvaro at gmail.com  Wed Mar 27 20:16:38 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 27 Mar 2013 21:16:38 +0100
Subject: [rabbitmq-discuss] Running RabbitMQ server as embedded
	application
In-Reply-To: <CAGQEY6kCS5hKGnDngvGcYkDSUjTxxHXkbyq3GURLHqytwfdB6Q@mail.gmail.com>
References: <CAGQEY6nVkYahZyviYp=3o_CUqSXJxANE7g-f0rp+g0-XOuH5vg@mail.gmail.com>
	<279073FC-FC80-4343-8B5E-164D3AC914D7@rabbitmq.com>
	<06655E21-4CCA-49E9-A0F6-01B6F5646590@rabbitmq.com>
	<CAMcAHLVY6m1Owoc8Vmz=CW8SpLF=xSumB9fZ-4s8OM7a6ukmLw@mail.gmail.com>
	<CAGQEY6kCS5hKGnDngvGcYkDSUjTxxHXkbyq3GURLHqytwfdB6Q@mail.gmail.com>
Message-ID: <CAMcAHLWveW7yCG54netn7_HW3HtQH=gvkd46rsvF9jO-LQq=xg@mail.gmail.com>

That's great to hear. AFAIK there's nothing Mac specific in the OTP
packaging, the thing is for now we only integrated the build for Mac, that
is Erlang and so on is built on the Mac. So it's great to know that it also
works on RHEL


On Wed, Mar 27, 2013 at 7:23 PM, Jorge Diz Pico
<jorge.diz at nomasystems.com>wrote:

> I tried my luck at the OTP packaging in RHEL6 and it seems to work as
> fine as it did on my MacBook, so I'll take my chances with it.
>
> Thank y'all for your replies.
>
> On Tue, Mar 26, 2013 at 2:30 PM, Alvaro Videla <videlalvaro at gmail.com>
> wrote:
> > Hi,
> >
> > The OTP packaging has been merged into default, at the moment it works
> for
> > Mac only. Some of the files involved in making the release are here:
> >
> http://hg.rabbitmq.com/rabbitmq-server/file/0271f21bd596/packaging/standalone
> >
> > Then the sbin scripts have been modified to support different erlang boot
> > files and so on.
> >
> > The related bug branch is bug25271.
> >
> > Regards,
> >
> > Alvaro
> >
> >
> > On Tue, Mar 26, 2013 at 2:19 PM, Tim Watson <tim at rabbitmq.com> wrote:
> >>
> >> Another thing to consider is that you're starting the vm via a script,
> you
> >> might be able to get away with setting SYS_PREFIX in rabbitmq-defaults
> (as
> >> the generic unix packaging does). We're also working on OTP packaging
> (i.e.,
> >> delivering rabbit as a self contained package/release), though I'm not
> sure
> >> what kind of timescales are involved in that.
> >>
> >> Cheers,
> >> Tim
> >>
> >> On 26 Mar 2013, at 13:11, Tim Watson wrote:
> >>
> >> > Take a good look at the startup scripts. There are environment
> variables
> >> > aplenty and various things that get passed the beam as arguments -
> you'll
> >> > need to filter through those and make sure everything is set up
> properly in
> >> > order for the startup sequence to work.
> >> >
> >> > Cheers,
> >> > Tim
> >> >
> >> > On 26 Mar 2013, at 12:18, Jorge Diz Pico wrote:
> >> >
> >> >> Hi folks, I'm trying to run a RabbitMQ server the OTP way, but it's
> >> >> becoming harder than I thought. I added all dependencies to my
> >> >> release, but when I run application:start(rabbit), I get the
> following
> >> >> error:
> >> >>
> >> >> [...]
> >> >> -- rabbit boot start
> >> >> starting file handle cache server
> >> >> ...done
> >> >> starting worker pool
> >> >> ...done
> >> >> starting database
> >> >> ...
> >> >>
> >> >> BOOT FAILED
> >> >> ===========
> >> >>
> >> >> Error description:
> >> >>
> >> >>
> {error,{corrupt_or_missing_cluster_files,{error,enoent},{error,enoent}}}
> >> >>
> >> >> Log files (may contain more information):
> >> >>  undefined
> >> >>  undefined
> >> >>
> >> >> Stack trace:
> >> >>  [{rabbit_node_monitor,read_cluster_status,0,
> >> >>
> >> >> [{file,"src/rabbit_node_monitor.erl"},{line,139}]},
> >> >>   {rabbit_mnesia,cluster_status,1,
> >> >>                  [{file,"src/rabbit_mnesia.erl"},{line,391}]},
> >> >>
> >> >>
> {rabbit_mnesia,node_type,0,[{file,"src/rabbit_mnesia.erl"},{line,410}]},
> >> >>   {rabbit_mnesia,init,0,[{file,"src/rabbit_mnesia.erl"},{line,97}]},
> >> >>   {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,
> >> >>           [{file,"src/rabbit.erl"},{line,481}]},
> >> >>   {rabbit,run_boot_step,1,[{file,"src/rabbit.erl"},{line,480}]},
> >> >>
> >> >>
> {rabbit,'-start/2-lc$^0/1-0-',1,[{file,"src/rabbit.erl"},{line,440}]},
> >> >>   {rabbit,start,2,[{file,"src/rabbit.erl"},{line,440}]}]
> >> >> [...]
> >> >>
> >> >> But of course there are no clusters and there had never been (fresh
> >> >> run).
> >> >>
> >> >> Has anybody managed to do this? There has to be a way to embed the
> >> >> RabbitMQ server in your own applications.
> >> >> _______________________________________________
> >> >> rabbitmq-discuss mailing list
> >> >> rabbitmq-discuss at lists.rabbitmq.com
> >> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130327/a35b2866/attachment.htm>

From kishmiryankarlen at gmail.com  Wed Mar 27 19:31:31 2013
From: kishmiryankarlen at gmail.com (Karlen)
Date: Wed, 27 Mar 2013 12:31:31 -0700 (PDT)
Subject: [rabbitmq-discuss] I can't visit http://localhost:15672
In-Reply-To: <7d3d62f0-5bd7-4c11-b6c8-816367b52e64@googlegroups.com>
References: <7d3d62f0-5bd7-4c11-b6c8-816367b52e64@googlegroups.com>
Message-ID: <dd1ad4cf-d684-4371-8ac9-632304ff5be9@googlegroups.com>

You must install the management plugin of RabbitMQ server in order to use 
the 15672 port for managing the process. Here is a link which can help 
you: http://www.rabbitmq.com/management.html

On Thursday, 21 February 2013 11:37:05 UTC+4, 5344... at 163.com wrote:
>
> The rabbitm-server had been started .but when I Enter the 
> http://localhost:15672 .tips: error to connect the web. however i retry 
> ,it can't work.I need help. 
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130327/94e213c1/attachment.htm>

From watson.timothy at gmail.com  Wed Mar 27 23:27:02 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 27 Mar 2013 23:27:02 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log / badarg?
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D2D1854@FR44EX3005.global.ds.honeywell.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2D1854@FR44EX3005.global.ds.honeywell.com>
Message-ID: <72DD14D5-967F-4108-9E37-D9E7843B1AB8@rabbitmq.com>

Hi Petr,

That's probably a bug and you're probably right about the cause. I'll take a look at fixing that somehow. Other than puking on printing the plugin info, does the logging out behave as you'd expect though?

Cheers
Tim

On 27 Mar 2013, at 19:23, "Gotthard, Petr" <Petr.Gotthard at Honeywell.com> wrote:

> Hi,
> We used a custom lager plugin before without any troubles, but after switching to your plugin I'm getting 'badarg' when rabbit prints the name of the plugin. I disabled all plugins, except lager.
> 
> Stack trace:
>   [{rabbit,'-print_plugin_info/1-lc$^0/1-0-',1,[]},
>    {rabbit,'-print_plugin_info/1-fun-0-',1,[]},
>    {rabbit_misc,with_local_io,1,[]},
>    {rabbit,'-boot/0-fun-1-',0,[]},
>    {rabbit,start_it,1,[]},
>    {init,start_it,1,[]},
>    {init,start_em,1,[]}]
> 
> 
> Does it ring a bell to you?
> 
> Could it be caused by the unusual naming? The plugin is named "lager", while the directory is "rabbitmq_lager" and the .ez is called "rabbitmq_lager-2.0.0-rmq0.0.1-git9719370".
> 
> 
> Petr
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
> Sent: 27. b?ezna 2013 15:04
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] lager vs sasl error log
> 
> If anyone wants to try this plugin out, there are instructions in the README file on github now. You'll need at least R14B03 to use lager afaict. Please shout if you run into any difficulties.
> 
> Cheers,
> Tim
> 
> On 27 Mar 2013, at 00:19, Ben Hood wrote:
> 
>> On Tuesday, 26 March 2013 at 15:53, Tim Watson wrote:
>>> I have set up an experimental repository at https://github.com/hyperthunk/rabbitmq-lager that supports logging to lager via its built in error_logger redirection. You enable via `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config file just like any other plugin, under the key 'lager'. In the morning I'll chat with the guys about integrating this as experimental plugin for the time being, so people can play around and see if it offers the required functionality.
>> Very cool - nice one Tim!
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From 0x6e6562 at gmail.com  Thu Mar 28 02:03:41 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 27 Mar 2013 22:03:41 -0400
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
Message-ID: <CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>

Hey Tim,

I'm just kicking the tyres of your lager plugin with my rabbit umbrella.

Admittedly, I'm not an umbrella makefile jedi, so I just cloned your repo
into a subdir of my umbrella (maybe this was the mistake). Running make
results in the following issue:

[elided] generate deps
[elided] fix test deps
sed -e 's|build/deps.mk|$(DEPS_FILE)|' build/deps.mk > build/deps.mk.tmp &&
mv build/deps.mk.tmp build/deps.mk
rm -rf ./rabbitmq-lager-git
git clone http://github.com/basho/lager.git ./rabbitmq-lager-git
Cloning into './rabbitmq-lager-git'...
remote: Counting objects: 1822, done.
remote: Compressing objects: 100% (576/576), done.
remote: Total 1822 (delta 1330), reused 1709 (delta 1224)
Receiving objects: 100% (1822/1822), 713.54 KiB | 137 KiB/s, done.
Resolving deltas: 100% (1330/1330), done.
# Work around weird github breakage (bug 25264)
cd ./rabbitmq-lager-git && git pull
Already up-to-date.
cd ./rabbitmq-lager-git && git checkout
9719370eeaf8b64c1c3e79fb7052cb1ca29f16c8
Note: checking out '9719370eeaf8b64c1c3e79fb7052cb1ca29f16c8'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b new_branch_name

HEAD is now at 9719370... Merge pull request #120 from
basho/adt-msg-has-datetime
touch rabbitmq-lager-git/.done
echo UPSTREAM_SHORT_HASH:=`git --git-dir=./rabbitmq-lager-git/.git log -n 1
HEAD | grep commit | cut -b 8-14` >hash.mk
sed -n -e 's|^.*{vsn, *"\([^"]*\)".*$|ORIGINAL_VERSION:=\1|p'
<rabbitmq-lager-git/src/lager.app.src >build/version.mk
[elided] generate deps
/bin/sh: escript: command not found
rm -rf build/dep-ezs
mkdir -p build/dep-ezs
[elided] copy dependent ezs
touch build/dep-ezs/.done
rm -rf build/dep-apps
mkdir -p build/dep-apps
[elided] unzip ezs
touch build/dep-apps/.done
make: *** No rule to make target `build/deps.mk', needed by
`ebin/error_logger_lager_h.beam'.  Stop.

Should I maybe have created a my own subdir that points to your repo by
setting the UPSTREAM_GIT variable?

Cheers,

Ben



On Wed, Mar 27, 2013 at 10:03 AM, Tim Watson <tim at rabbitmq.com> wrote:

> If anyone wants to try this plugin out, there are instructions in the
> README file on github now. You'll need at least R14B03 to use lager afaict.
> Please shout if you run into any difficulties.
>
> Cheers,
> Tim
>
> On 27 Mar 2013, at 00:19, Ben Hood wrote:
>
> > On Tuesday, 26 March 2013 at 15:53, Tim Watson wrote:
> >> I have set up an experimental repository at
> https://github.com/hyperthunk/rabbitmq-lager that supports logging to
> lager via its built in error_logger redirection. You enable via
> `rabbitmq-plugins enable lager` and configure it in the RabbitMQ config
> file just like any other plugin, under the key 'lager'. In the morning I'll
> chat with the guys about integrating this as experimental plugin for the
> time being, so people can play around and see if it offers the required
> functionality.
> > Very cool - nice one Tim!
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130327/da7d6bbf/attachment.htm>

From 0x6e6562 at gmail.com  Thu Mar 28 02:21:04 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 27 Mar 2013 22:21:04 -0400
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
Message-ID: <CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>

Hey Tim,

On Wed, Mar 27, 2013 at 10:03 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

>
> I'm just kicking the tyres of your lager plugin with my rabbit umbrella.
>

Just to get things going, I tried using the published ez (md5:
9066ed797ca75519a68820271c79994a) but I ran into the following issue:

$ ./sbin/rabbitmq-plugins enable lager
Warning: Problem reading some plugins:
[{"./sbin/../plugins/rabbitmq_lager-2.0.0.ez",
                                         {invalid_ez,bad_eocd}}]
Error: The following plugins could not be found:
  lager

Did I maybe grab the wrong thing?

Cheers,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130327/8fcc71e1/attachment.htm>

From carl.hoerberg at gmail.com  Thu Mar 28 07:32:28 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 28 Mar 2013 00:32:28 -0700 (PDT)
Subject: [rabbitmq-discuss] "Other process memory" growth
In-Reply-To: <51519976.209@rabbitmq.com>
References: <1364006848624-25675.post@n5.nabble.com>
	<515193E9.9040000@rabbitmq.com> <51519976.209@rabbitmq.com>
Message-ID: <93297F28A9634892B9DDA889BE8611A6@gmail.com>

Thank you! 
Here's the output: https://www.dropbox.com/s/spob20fzupi14tz/rmqmem.txt
Must admit that it doesn't make much sense to me :P Do you have any clue what's taking all that memory? 



On Tuesday 26 March 2013 at 20:51, Matthias Radestock-3 [via RabbitMQ] wrote:

> On 26/03/13 12:26, Emile Joubert wrote: 
> > One way to dig further is to look at the Erlang 
> > processes using the most memory: 
> > 
> > $ etop -sort memory 
> 
> Or 
> 
> rabbitmqctl eval '[[{pid, R}, M | process_info(R)] || {M, R} <- 
> lists:sublist(lists:reverse(lists:sort([{process_info(P, memory), P} || 
> P <- erlang:processes()])), 10)].' 
> 
> 
> Matthias. 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=25725&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/Other-process-memory-growth-tp25675p25725.html 
> To unsubscribe from "Other process memory" growth, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25675&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU2NzV8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Other-process-memory-growth-tp25675p25753.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/26ac9123/attachment.htm>

From jhzhang.email at gmail.com  Thu Mar 28 07:38:00 2013
From: jhzhang.email at gmail.com (Jianhui Zhang)
Date: Thu, 28 Mar 2013 00:38:00 -0700
Subject: [rabbitmq-discuss] Can load-balancer work around consumer reconnect
	problem?
Message-ID: <CAAAYafMmaMz7NddqME2fUmJecO6Xe1UoCJaqo+N8Aps6VPv8rQ@mail.gmail.com>

Hi,

I'm new to Rabbit, just want to confirm if my understanding of
mirror-queues is correct.

Here is the scenario:

- I set up a mirrored queue, on Node1 (master) and Node2 (slave),
- have a load-balancer LB in front of both, roundrobin
- have my consumer app establish a TCP connection to the LB, which forwards
the consumer subscription requests randomly to either Node1 or Node2
- under no failure condition, the master Node1 will send messages to all my
consumers.
- if master fails, the slave Node2 will be promoted to the new master and
start sending the remaining messages to my consumers.
- since the consumer TCP connection is to the LB, the consumer wouldn't
notice anything (and don't need to reconnect), except for the "normal"
out-of-sync and message loss considerations.

Would this work?

Thanks,
James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/5d1df287/attachment.htm>

From Petr.Gotthard at Honeywell.com  Thu Mar 28 07:48:44 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 28 Mar 2013 07:48:44 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
	<CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D2D1B04@FR44EX3005.global.ds.honeywell.com>

Ben,
Did you rename the .ez file? Because mine has an usual name that probably causes rabbit to crash (see my other post), but enabling works fine for me. Could you try using the .ez file with exactly the same name as created by the makefile?

Petr

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ben Hood
Sent: 28. b?ezna 2013 3:21
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] lager vs sasl error log

Hey Tim,

On Wed, Mar 27, 2013 at 10:03 PM, Ben Hood <0x6e6562 at gmail.com<mailto:0x6e6562 at gmail.com>> wrote:

I'm just kicking the tyres of your lager plugin with my rabbit umbrella.

Just to get things going, I tried using the published ez (md5: 9066ed797ca75519a68820271c79994a) but I ran into the following issue:

$ ./sbin/rabbitmq-plugins enable lager
Warning: Problem reading some plugins: [{"./sbin/../plugins/rabbitmq_lager-2.0.0.ez",
                                         {invalid_ez,bad_eocd}}]
Error: The following plugins could not be found:
  lager

Did I maybe grab the wrong thing?

Cheers,

Ben

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/0ab9edfd/attachment.htm>

From matthias at rabbitmq.com  Thu Mar 28 08:08:19 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 28 Mar 2013 08:08:19 +0000
Subject: [rabbitmq-discuss] "Other process memory" growth
In-Reply-To: <93297F28A9634892B9DDA889BE8611A6@gmail.com>
References: <1364006848624-25675.post@n5.nabble.com>
	<515193E9.9040000@rabbitmq.com> <51519976.209@rabbitmq.com>
	<93297F28A9634892B9DDA889BE8611A6@gmail.com>
Message-ID: <5153FA73.70605@rabbitmq.com>

On 28/03/13 07:32, carlhoerberg wrote:
> Here's the output: https://www.dropbox.com/s/spob20fzupi14tz/rmqmem.txt
> Must admit that it doesn't make much sense to me :P Do you have any clue
> what's taking all that memory?

What does the Overview page in the management UI show? Should be pretty 
obvious from that.

Matthias.

From carl.hoerberg at gmail.com  Thu Mar 28 08:11:17 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 28 Mar 2013 01:11:17 -0700 (PDT)
Subject: [rabbitmq-discuss] "Other process memory" growth
In-Reply-To: <5153FA73.70605@rabbitmq.com>
References: <1364006848624-25675.post@n5.nabble.com>
	<515193E9.9040000@rabbitmq.com> <51519976.209@rabbitmq.com>
	<93297F28A9634892B9DDA889BE8611A6@gmail.com>
	<5153FA73.70605@rabbitmq.com>
Message-ID: <CAFPidkN9skoZywVLig1Ez67iSW3DrLaiGXq0EarYuEB9KOfbLQ@mail.gmail.com>

No..? What do you mean?
On Mar 28, 2013 4:09 PM, "Matthias Radestock-3 [via RabbitMQ]" <
ml-node+s1065348n25756h57 at n5.nabble.com> wrote:

> On 28/03/13 07:32, carlhoerberg wrote:
> > Here's the output: https://www.dropbox.com/s/spob20fzupi14tz/rmqmem.txt
> > Must admit that it doesn't make much sense to me :P Do you have any clue
> > what's taking all that memory?
>
> What does the Overview page in the management UI show? Should be pretty
> obvious from that.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=25756&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Other-process-memory-growth-tp25675p25756.html
>  To unsubscribe from "Other process memory" growth, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25675&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU2NzV8LTEyNDcxMDc4NjM=>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Other-process-memory-growth-tp25675p25757.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/e390d44a/attachment.htm>

From matthias at rabbitmq.com  Thu Mar 28 08:13:53 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 28 Mar 2013 08:13:53 +0000
Subject: [rabbitmq-discuss] "Other process memory" growth
In-Reply-To: <CAFPidkN9skoZywVLig1Ez67iSW3DrLaiGXq0EarYuEB9KOfbLQ@mail.gmail.com>
References: <1364006848624-25675.post@n5.nabble.com>
	<515193E9.9040000@rabbitmq.com> <51519976.209@rabbitmq.com>
	<93297F28A9634892B9DDA889BE8611A6@gmail.com>
	<5153FA73.70605@rabbitmq.com>
	<CAFPidkN9skoZywVLig1Ez67iSW3DrLaiGXq0EarYuEB9KOfbLQ@mail.gmail.com>
Message-ID: <5153FBC1.8090600@rabbitmq.com>

On 28/03/13 08:11, carlhoerberg wrote:
> No..? What do you mean?

Can you post it? I do have a theory, but it could be wrong; that's why I 
wanted to check what the overview page shows.

Matthias.

From Petr.Gotthard at Honeywell.com  Thu Mar 28 08:19:49 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 28 Mar 2013 08:19:49 +0000
Subject: [rabbitmq-discuss] Feedback On Logging Frameworks Please! (was
 lager vs sasl error log)
In-Reply-To: <70526DB1-3700-49B6-98FA-38D95E673733@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<70526DB1-3700-49B6-98FA-38D95E673733@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D2D1B5A@FR44EX3005.global.ds.honeywell.com>

Tim,

My "user story" would be:
As plug-in developers we need a logging framework that can enable severity-based log filtering from our custom plug-ins.
We need each log-record on a single line, indicating time, severity and source (PID and module name) so that we can use 'grep' for post-processing.


For this purpose the lager framework and the approach you've taken is completely sufficient.

Regards,
Petr

-----Original Message-----
From: Tim Watson [mailto:tim at rabbitmq.com] 
Sent: 27. b?ezna 2013 17:47
To: Discussions about RabbitMQ
Cc: Ben Hood; Gavin M. Roy; Gotthard, Petr; Matt Pietrek
Subject: Feedback On Logging Frameworks Please! (was lager vs sasl error log)

Hello all!

I recently notified the mailing list that I've created a plugin providing a way to integrate the lager logging framework into RabbitMQ as a plugin: https://github.com/hyperthunk/rabbitmq-lager.

If you're interested in seeing improvements to rabbit's logging then please give this a try and give us some feedback. In particular, we'd like to know whether the approach I've taken (i.e., using lager's error_logger redirection) provides *enough* functionality for our users and/or what additional features you'd like to see. Getting decent feedback is a prerequisite to getting these changes integrated into rabbit in a permanent and supported manner, so please don't be shy!

If you're cc'ed on this email then you've piped up about logging recently/before on this list, and therefore I've kindly singled you out as a potential victim, erm... wait no... volunteer! That's right! ;)

So, feedback on a postcard please folks! We'd like to get this 'just right' so everyone has *nice* things to say about our gorgeous log files and configurable backends and whatnot.

Cheers,
Tim

From carl.hoerberg at gmail.com  Thu Mar 28 09:06:11 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 28 Mar 2013 02:06:11 -0700 (PDT)
Subject: [rabbitmq-discuss] "Other process memory" growth
In-Reply-To: <5153FBC1.8090600@rabbitmq.com>
References: <1364006848624-25675.post@n5.nabble.com>
	<515193E9.9040000@rabbitmq.com> <51519976.209@rabbitmq.com>
	<93297F28A9634892B9DDA889BE8611A6@gmail.com>
	<5153FA73.70605@rabbitmq.com>
	<CAFPidkN9skoZywVLig1Ez67iSW3DrLaiGXq0EarYuEB9KOfbLQ@mail.gmail.com>
	<5153FBC1.8090600@rabbitmq.com>
Message-ID: <CAFPidkOHq6kmLGjBwS7u8uRPZj93xmdaofVJEULTdetGvFz_wg@mail.gmail.com>

Ok :) https://www.dropbox.com/sc/mb7zw9gqsrxg7to/H0x1QYwfau
On Mar 28, 2013 4:14 PM, "Matthias Radestock-3 [via RabbitMQ]" <
ml-node+s1065348n25758h19 at n5.nabble.com> wrote:

> On 28/03/13 08:11, carlhoerberg wrote:
> > No..? What do you mean?
>
> Can you post it? I do have a theory, but it could be wrong; that's why I
> wanted to check what the overview page shows.
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=25758&i=0>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
>
> http://rabbitmq.1065348.n5.nabble.com/Other-process-memory-growth-tp25675p25758.html
>  To unsubscribe from "Other process memory" growth, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=25675&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MjU2NzV8LTEyNDcxMDc4NjM=>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Other-process-memory-growth-tp25675p25760.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/78afe84a/attachment.htm>

From watson.timothy at gmail.com  Thu Mar 28 09:24:17 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 28 Mar 2013 09:24:17 +0000
Subject: [rabbitmq-discuss] Feedback On Logging Frameworks Please! (was
	lager vs sasl error log)
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D2D1B5A@FR44EX3005.global.ds.honeywell.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<70526DB1-3700-49B6-98FA-38D95E673733@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2D1B5A@FR44EX3005.global.ds.honeywell.com>
Message-ID: <CBC3EEE2-0BE7-4813-BA9B-1ACDE75A9E8C@rabbitmq.com>

Hi Petr,

Great that's just what I needed to know.

Thanks
Tim

On 28 Mar 2013, at 08:19, "Gotthard, Petr" <Petr.Gotthard at Honeywell.com> wrote:

> Tim,
> 
> My "user story" would be:
> As plug-in developers we need a logging framework that can enable severity-based log filtering from our custom plug-ins.
> We need each log-record on a single line, indicating time, severity and source (PID and module name) so that we can use 'grep' for post-processing.
> 
> 
> For this purpose the lager framework and the approach you've taken is completely sufficient.
> 
> Regards,
> Petr
> 
> -----Original Message-----
> From: Tim Watson [mailto:tim at rabbitmq.com] 
> Sent: 27. b?ezna 2013 17:47
> To: Discussions about RabbitMQ
> Cc: Ben Hood; Gavin M. Roy; Gotthard, Petr; Matt Pietrek
> Subject: Feedback On Logging Frameworks Please! (was lager vs sasl error log)
> 
> Hello all!
> 
> I recently notified the mailing list that I've created a plugin providing a way to integrate the lager logging framework into RabbitMQ as a plugin: https://github.com/hyperthunk/rabbitmq-lager.
> 
> If you're interested in seeing improvements to rabbit's logging then please give this a try and give us some feedback. In particular, we'd like to know whether the approach I've taken (i.e., using lager's error_logger redirection) provides *enough* functionality for our users and/or what additional features you'd like to see. Getting decent feedback is a prerequisite to getting these changes integrated into rabbit in a permanent and supported manner, so please don't be shy!
> 
> If you're cc'ed on this email then you've piped up about logging recently/before on this list, and therefore I've kindly singled you out as a potential victim, erm... wait no... volunteer! That's right! ;)
> 
> So, feedback on a postcard please folks! We'd like to get this 'just right' so everyone has *nice* things to say about our gorgeous log files and configurable backends and whatnot.
> 
> Cheers,
> Tim

From watson.timothy at gmail.com  Thu Mar 28 09:25:50 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 28 Mar 2013 09:25:50 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
	<CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
Message-ID: <7C92BC2D-8C62-4065-8BE0-6461E6645456@rabbitmq.com>

Hmm I didn't run into this issue. I do think however that the APP_NAME should be just lager (not rabbimq_lager) so I'll fix that this morning, test it and republish. I'll let you know once it's ready for another try.

Cheers,
Tim

On 28 Mar 2013, at 02:21, Ben Hood <0x6e6562 at gmail.com> wrote:

> Hey Tim,
> 
> On Wed, Mar 27, 2013 at 10:03 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> 
> I'm just kicking the tyres of your lager plugin with my rabbit umbrella.
> 
> Just to get things going, I tried using the published ez (md5: 9066ed797ca75519a68820271c79994a) but I ran into the following issue:
> 
> $ ./sbin/rabbitmq-plugins enable lager
> Warning: Problem reading some plugins: [{"./sbin/../plugins/rabbitmq_lager-2.0.0.ez",
>                                          {invalid_ez,bad_eocd}}]
> Error: The following plugins could not be found:
>   lager
> 
> Did I maybe grab the wrong thing?
> 
> Cheers,
> 
> Ben
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/31c808bb/attachment.htm>

From mike at weird.name  Wed Mar 27 22:36:46 2013
From: mike at weird.name (Mike Chai)
Date: Wed, 27 Mar 2013 15:36:46 -0700 (PDT)
Subject: [rabbitmq-discuss] too many connections
Message-ID: <36b85556-4749-4768-9beb-3198ba91cc9f@googlegroups.com>

I'm using CloudRabbit on Heroku and under their $20 plan with max of 6 
connections, I'm constantly hitting the connection limit. I have 1 app, and 
all I'm doing is making the connection, putting something into a queue, and 
then closing the connection. Even so, I'm still hitting that limit fairly 
easily. Is there something else I can do to stop hitting the limit? I read 
something about heartbeats, would that help?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130327/054178e0/attachment.htm>

From emile at rabbitmq.com  Thu Mar 28 10:03:34 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 28 Mar 2013 10:03:34 +0000
Subject: [rabbitmq-discuss] too many connections
In-Reply-To: <36b85556-4749-4768-9beb-3198ba91cc9f@googlegroups.com>
References: <36b85556-4749-4768-9beb-3198ba91cc9f@googlegroups.com>
Message-ID: <51541576.8030702@rabbitmq.com>


Hi Mike,

On 27/03/13 22:36, Mike Chai wrote:
> I'm using CloudRabbit on Heroku and under their $20 plan with max of 6
> connections, I'm constantly hitting the connection limit. I have 1 app,
> and all I'm doing is making the connection, putting something into a
> queue, and then closing the connection.

If you are fully and synchronously closing one connection before opening
another then you shouldn't be hitting the limit. What is the rate of
connection creation when you hit the limit? Do you still see the problem
if you lower the rate?

Does the Heroku dashboard list the 6 connections? Can you correlate that
with connections from your app? Is your app multithreaded or somehow
creating connections with overlapping lifetimes? Have you tried
maintaining a single connection and using multiple channels instead?

If none of that helps then maybe support at cloudamqp.com knows the answer.



-Emile






From 0x6e6562 at gmail.com  Thu Mar 28 12:30:13 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 28 Mar 2013 12:30:13 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D2D1B04@FR44EX3005.global.ds.honeywell.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
	<CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2D1B04@FR44EX3005.global.ds.honeywell.com>
Message-ID: <45DB8ED8-31AB-4721-84F6-33ED345F791A@gmail.com>

Hey Petr,

I pulled the ez down with curl using the link specified in the README. I did this because it wouldn't build from source for me (see previous post), but that's probably because I just cloned Tim's repo into a subdir without renaming it. Having said that, I was just doing this quickly between flights, so I didn't really look into it too deeply.

Cheers,

Ben

On Mar 28, 2013, at 7:48, "Gotthard, Petr" <Petr.Gotthard at Honeywell.com> wrote:

> Ben,
> Did you rename the .ez file? Because mine has an usual name that probably causes rabbit to crash (see my other post), but enabling works fine for me. Could you try using the .ez file with exactly the same name as created by the makefile?
>  
> Petr
>  
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ben Hood
> Sent: 28. b?ezna 2013 3:21
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] lager vs sasl error log
>  
> Hey Tim,
>  
> On Wed, Mar 27, 2013 at 10:03 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>  
> I'm just kicking the tyres of your lager plugin with my rabbit umbrella.
>  
> Just to get things going, I tried using the published ez (md5: 9066ed797ca75519a68820271c79994a) but I ran into the following issue:
>  
> $ ./sbin/rabbitmq-plugins enable lager
> Warning: Problem reading some plugins: [{"./sbin/../plugins/rabbitmq_lager-2.0.0.ez",
>                                          {invalid_ez,bad_eocd}}]
> Error: The following plugins could not be found:
>   lager
>  
> Did I maybe grab the wrong thing?
>  
> Cheers,
>  
> Ben
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/f969940e/attachment.htm>

From tim at rabbitmq.com  Thu Mar 28 12:47:56 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 28 Mar 2013 12:47:56 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <45DB8ED8-31AB-4721-84F6-33ED345F791A@gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
	<CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2D1B04@FR44EX3005.global.ds.honeywell.com>
	<45DB8ED8-31AB-4721-84F6-33ED345F791A@gmail.com>
Message-ID: <184DD272-8A24-47F0-8A68-4CD540F89905@rabbitmq.com>

Hi Guys,

Sorry for the delay - I've been chasing my tail this morning looking at what I thought was a bug, and thankfully I was wrong! :) 

So... I've just pushed a couple of fixes that should sort things out for you (Ben) I hope. The instructions in the README now specify that you should check out the git repository into a folder called 'lager' (regardless of the actual source repository name), the APPNAME variable has been reset to 'lager' and I've renamed the uploaded binary to 'lager-2.0.0.ez' - this should fix these issues for you. In the long term, if enough people really want to use lager then we'll probably come up with another (better) approach than this, but I just wanted to get folks going for the time being so we can get some feedback. 

Please do let me know if you get along better with this now. If you're building from source then do a `make clean` in the umbrella before attempting a rebuild (with the renamed rabbitmq-lager => lager directory freshly checked out) otherwise the build system will get all in a twizzy about dependencies.

As I said, we'll do this *properly* at some point soon (ish) and it won't be awkward like this when we release it into the wild.

Cheers,
Tim

On 28 Mar 2013, at 12:30, Ben Hood wrote:

> Hey Petr,
> 
> I pulled the ez down with curl using the link specified in the README. I did this because it wouldn't build from source for me (see previous post), but that's probably because I just cloned Tim's repo into a subdir without renaming it. Having said that, I was just doing this quickly between flights, so I didn't really look into it too deeply.
> 
> Cheers,
> 
> Ben
> 
> On Mar 28, 2013, at 7:48, "Gotthard, Petr" <Petr.Gotthard at Honeywell.com> wrote:
> 
>> Ben,
>> Did you rename the .ez file? Because mine has an usual name that probably causes rabbit to crash (see my other post), but enabling works fine for me. Could you try using the .ez file with exactly the same name as created by the makefile?
>>  
>> Petr
>>  
>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ben Hood
>> Sent: 28. b?ezna 2013 3:21
>> To: Discussions about RabbitMQ
>> Subject: Re: [rabbitmq-discuss] lager vs sasl error log
>>  
>> Hey Tim,
>>  
>> On Wed, Mar 27, 2013 at 10:03 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>>  
>> I'm just kicking the tyres of your lager plugin with my rabbit umbrella.
>>  
>> Just to get things going, I tried using the published ez (md5: 9066ed797ca75519a68820271c79994a) but I ran into the following issue:
>>  
>> $ ./sbin/rabbitmq-plugins enable lager
>> Warning: Problem reading some plugins: [{"./sbin/../plugins/rabbitmq_lager-2.0.0.ez",
>>                                          {invalid_ez,bad_eocd}}]
>> Error: The following plugins could not be found:
>>   lager
>>  
>> Did I maybe grab the wrong thing?
>>  
>> Cheers,
>>  
>> Ben
>>  
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From Petr.Gotthard at Honeywell.com  Thu Mar 28 13:18:14 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 28 Mar 2013 13:18:14 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <184DD272-8A24-47F0-8A68-4CD540F89905@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
	<CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2D1B04@FR44EX3005.global.ds.honeywell.com>
	<45DB8ED8-31AB-4721-84F6-33ED345F791A@gmail.com>
	<184DD272-8A24-47F0-8A68-4CD540F89905@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D2D1D94@FR44EX3005.global.ds.honeywell.com>

Thanks Tim,

It compiles, runs and works, but--- there's a trouble (at least here) with the "rmq" suffix (the name is something like lager-2.0.0-rmq0.0.0-git9719370.ez)

The RMQ numbers seem to be taken from the VERSION parameter. Which means that if multiple plug-ins have different version, different version of the lager is created for each of the plugins (rmq0.0.0, rmq0.0.1, rmq0.0.4) and these versions overwrite each other, which creates a mess.

Can various plug-ins can have different version, but still be compiled against the same rabbit?


Petr

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: 28. b?ezna 2013 13:48
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] lager vs sasl error log

Hi Guys,

Sorry for the delay - I've been chasing my tail this morning looking at what I thought was a bug, and thankfully I was wrong! :) 

So... I've just pushed a couple of fixes that should sort things out for you (Ben) I hope. The instructions in the README now specify that you should check out the git repository into a folder called 'lager' (regardless of the actual source repository name), the APPNAME variable has been reset to 'lager' and I've renamed the uploaded binary to 'lager-2.0.0.ez' - this should fix these issues for you. In the long term, if enough people really want to use lager then we'll probably come up with another (better) approach than this, but I just wanted to get folks going for the time being so we can get some feedback. 

Please do let me know if you get along better with this now. If you're building from source then do a `make clean` in the umbrella before attempting a rebuild (with the renamed rabbitmq-lager => lager directory freshly checked out) otherwise the build system will get all in a twizzy about dependencies.

As I said, we'll do this *properly* at some point soon (ish) and it won't be awkward like this when we release it into the wild.

Cheers,
Tim

On 28 Mar 2013, at 12:30, Ben Hood wrote:

> Hey Petr,
> 
> I pulled the ez down with curl using the link specified in the README. I did this because it wouldn't build from source for me (see previous post), but that's probably because I just cloned Tim's repo into a subdir without renaming it. Having said that, I was just doing this quickly between flights, so I didn't really look into it too deeply.
> 
> Cheers,
> 
> Ben
> 
> On Mar 28, 2013, at 7:48, "Gotthard, Petr" <Petr.Gotthard at Honeywell.com> wrote:
> 
>> Ben,
>> Did you rename the .ez file? Because mine has an usual name that probably causes rabbit to crash (see my other post), but enabling works fine for me. Could you try using the .ez file with exactly the same name as created by the makefile?
>>  
>> Petr
>>  
>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ben Hood
>> Sent: 28. b?ezna 2013 3:21
>> To: Discussions about RabbitMQ
>> Subject: Re: [rabbitmq-discuss] lager vs sasl error log
>>  
>> Hey Tim,
>>  
>> On Wed, Mar 27, 2013 at 10:03 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>>  
>> I'm just kicking the tyres of your lager plugin with my rabbit umbrella.
>>  
>> Just to get things going, I tried using the published ez (md5: 9066ed797ca75519a68820271c79994a) but I ran into the following issue:
>>  
>> $ ./sbin/rabbitmq-plugins enable lager
>> Warning: Problem reading some plugins: [{"./sbin/../plugins/rabbitmq_lager-2.0.0.ez",
>>                                          {invalid_ez,bad_eocd}}]
>> Error: The following plugins could not be found:
>>   lager
>>  
>> Did I maybe grab the wrong thing?
>>  
>> Cheers,
>>  
>> Ben
>>  
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tim at rabbitmq.com  Thu Mar 28 13:44:04 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 28 Mar 2013 13:44:04 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2D2D1D94@FR44EX3005.global.ds.honeywell.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
	<CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2D1B04@FR44EX3005.global.ds.honeywell.com>
	<45DB8ED8-31AB-4721-84F6-33ED345F791A@gmail.com>
	<184DD272-8A24-47F0-8A68-4CD540F89905@rabbitmq.com> <F9E8 5480F623
	49458DF67CE8BA000D8D2D2D1D94@FR44EX3005.global.ds.honeywell.com>
Message-ID: <3EBD9BB2-C68F-406D-8BF0-0663940FAC35@rabbitmq.com>


On 28 Mar 2013, at 13:18, Gotthard, Petr wrote:

> Thanks Tim,
> 
> It compiles, runs and works, but--- there's a trouble (at least here) with the "rmq" suffix (the name is something like lager-2.0.0-rmq0.0.0-git9719370.ez)
> 
> The RMQ numbers seem to be taken from the VERSION parameter. Which means that if multiple plug-ins have different version, different version of the lager is created for each of the plugins (rmq0.0.0, rmq0.0.1, rmq0.0.4) and these versions overwrite each other, which creates a mess.
> 

I'm not really sure why this would happen?

> Can various plug-ins can have different version, but still be compiled against the same rabbit?
> 

I don't think so - when you build from source, all the plugins (and the broker) should pick up the same VERSION as each other. If you're not building from source, I'm not sure which constraint you're running into. What are the symptoms (i.e., what goes wrong)?

> 
> Petr
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
> Sent: 28. b?ezna 2013 13:48
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] lager vs sasl error log
> 
> Hi Guys,
> 
> Sorry for the delay - I've been chasing my tail this morning looking at what I thought was a bug, and thankfully I was wrong! :) 
> 
> So... I've just pushed a couple of fixes that should sort things out for you (Ben) I hope. The instructions in the README now specify that you should check out the git repository into a folder called 'lager' (regardless of the actual source repository name), the APPNAME variable has been reset to 'lager' and I've renamed the uploaded binary to 'lager-2.0.0.ez' - this should fix these issues for you. In the long term, if enough people really want to use lager then we'll probably come up with another (better) approach than this, but I just wanted to get folks going for the time being so we can get some feedback. 
> 
> Please do let me know if you get along better with this now. If you're building from source then do a `make clean` in the umbrella before attempting a rebuild (with the renamed rabbitmq-lager => lager directory freshly checked out) otherwise the build system will get all in a twizzy about dependencies.
> 
> As I said, we'll do this *properly* at some point soon (ish) and it won't be awkward like this when we release it into the wild.
> 
> Cheers,
> Tim
> 
> On 28 Mar 2013, at 12:30, Ben Hood wrote:
> 
>> Hey Petr,
>> 
>> I pulled the ez down with curl using the link specified in the README. I did this because it wouldn't build from source for me (see previous post), but that's probably because I just cloned Tim's repo into a subdir without renaming it. Having said that, I was just doing this quickly between flights, so I didn't really look into it too deeply.
>> 
>> Cheers,
>> 
>> Ben
>> 
>> On Mar 28, 2013, at 7:48, "Gotthard, Petr" <Petr.Gotthard at Honeywell.com> wrote:
>> 
>>> Ben,
>>> Did you rename the .ez file? Because mine has an usual name that probably causes rabbit to crash (see my other post), but enabling works fine for me. Could you try using the .ez file with exactly the same name as created by the makefile?
>>> 
>>> Petr
>>> 
>>> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ben Hood
>>> Sent: 28. b?ezna 2013 3:21
>>> To: Discussions about RabbitMQ
>>> Subject: Re: [rabbitmq-discuss] lager vs sasl error log
>>> 
>>> Hey Tim,
>>> 
>>> On Wed, Mar 27, 2013 at 10:03 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>>> 
>>> I'm just kicking the tyres of your lager plugin with my rabbit umbrella.
>>> 
>>> Just to get things going, I tried using the published ez (md5: 9066ed797ca75519a68820271c79994a) but I ran into the following issue:
>>> 
>>> $ ./sbin/rabbitmq-plugins enable lager
>>> Warning: Problem reading some plugins: [{"./sbin/../plugins/rabbitmq_lager-2.0.0.ez",
>>>                                         {invalid_ez,bad_eocd}}]
>>> Error: The following plugins could not be found:
>>>  lager
>>> 
>>> Did I maybe grab the wrong thing?
>>> 
>>> Cheers,
>>> 
>>> Ben
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From priyank.patil at gmail.com  Thu Mar 28 12:33:25 2013
From: priyank.patil at gmail.com (Priyank Patil)
Date: Thu, 28 Mar 2013 18:03:25 +0530
Subject: [rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
Message-ID: <CAO43vHC4KBAAPbsVYH4DavFqJ1R2si_TAuCLAVzq=n8+sNJgbA@mail.gmail.com>

I have a durable queue which holds persistent messages. The messages arrive
into the queue at a rate of about 10 messages per second.

The client is unable to fetch those messages at that rate. As a result the
queue on the server keeps growing.

Each message is less than 1 KB and I have a healthy 2 Mbps line between the
server and my machine. Using a network monitoring utility, I found that it
is hardly using any of that bandwidth.

The client is doing nothing with the messages as of now, just printing them
to console so processing time on client is almost 0.

Some other details: I am using a java client. I have set the client to
prefetch 10000 messages. (also tried with default values) The round trip
time is about 290 - 350 ms. Messages are individually acknowledged.

The available resources are being underutilized and 10 messages per second
is hardly any load in my opinion. How do I speed up things so that messages
held up in queue are transferred faster to the client. Possibly using some
sort of batching.


Thanks,

Priyank
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/c45c153c/attachment.htm>

From emile at rabbitmq.com  Thu Mar 28 14:48:04 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 28 Mar 2013 14:48:04 +0000
Subject: [rabbitmq-discuss] "Other process memory" growth
In-Reply-To: <CAFPidkOHq6kmLGjBwS7u8uRPZj93xmdaofVJEULTdetGvFz_wg@mail.gmail.com>
References: <1364006848624-25675.post@n5.nabble.com>
	<515193E9.9040000@rabbitmq.com> <51519976.209@rabbitmq.com>
	<93297F28A9634892B9DDA889BE8611A6@gmail.com>
	<5153FA73.70605@rabbitmq.com>
	<CAFPidkN9skoZywVLig1Ez67iSW3DrLaiGXq0EarYuEB9KOfbLQ@mail.gmail.com>
	<5153FBC1.8090600@rabbitmq.com>
	<CAFPidkOHq6kmLGjBwS7u8uRPZj93xmdaofVJEULTdetGvFz_wg@mail.gmail.com>
Message-ID: <51545824.8020201@rabbitmq.com>


Hi Carl,

On 28/03/13 09:06, carlhoerberg wrote:
> Ok :) https://www.dropbox.com/sc/mb7zw9gqsrxg7to/H0x1QYwfau

Would you be able to provide some more details for us to investigate
this further? We will need to logfiles and the sasl logfiles from all 3
nodes. Please provide entries from at least a while before the memory
use on the one node started to increase.

Then we'd like you to execute a command on the node with abnormal memory
(tiger01), but take some precautions first. If you are able to bring
more swapspace online then please do so. If there are any other
non-critical processes on the machine then please stop them, as this
command has the potential to impose heavy load. Please be aware that
this command could cause the node to crash. If you have HA redundancy in
place then it shouldn't matter, but if you are not comfortable with this
prospect then don't proceed.

Otherwise please run this command:

rabbitmqctl eval 'io:put_chars(standard_error, "this should appear in
startup_err\n").'

and check that the expected text appeared in startup_err (normally in
/var/log/rabbitmq). If the text did not appear then do not proceed.

Otherwise please run this command:

rabbitmqctl eval 'erlang:process_display(element(2,
hd(lists:reverse(lists:sort([{process_info(P, memory), P} ||  P <-
erlang:processes()])))), backtrace).'

The command will return and the startup_err file should start growing
soon afterwards. It could take a long time until it stops growing. When
it does stop growing please send it to support at rabbitmq.com along with
the logfiles, preferably compressed.




-Emile








From tim at rabbitmq.com  Thu Mar 28 15:26:06 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 28 Mar 2013 15:26:06 +0000
Subject: [rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
In-Reply-To: <CAO43vHC4KBAAPbsVYH4DavFqJ1R2si_TAuCLAVzq=n8+sNJgbA@mail.gmail.com>
References: <CAO43vHC4KBAAPbsVYH4DavFqJ1R2si_TAuCLAVzq=n8+sNJgbA@mail.gmail.com>
Message-ID: <410419A1-5BDF-4B46-8A52-5BBF23F61A9E@rabbitmq.com>

Priyank,

On 28 Mar 2013, at 12:33, Priyank Patil wrote:

> The client is unable to fetch those messages at that rate. As a result the queue on the server keeps growing.
> 
[snip]
> Each message is less than 1 KB and I have a healthy 2 Mbps line between the server and my machine. Using a network monitoring utility, I found that it is hardly using any of that bandwidth.
> 
> The client is doing nothing with the messages as of now, just printing them to console so processing time on client is almost 0.
> 

So why is the client 'unable to fetch those messages at that rate' then? Printing data to the console is not 0 processing time, although I agree it shouldn't be pushing your consumers down to 10 mps. Even with explicit ACKs I'd expect a consumer to manage in the order of KHz when consuming.

> Some other details: I am using a java client. I have set the client to prefetch 10000 messages. (also tried with default values) The round trip time is about 290 - 350 ms. Messages are individually acknowledged.
> 

What do you mean 'round trip time' exactly? You are publishing and consuming from different channels right? You might find reducing the prefetch count a bit actually helps - 10k is quite a high setting. You might also like to confirm in batches (using the 'multiple' flag to indicate that all messages up to the current delivery-tag are being acknowledged.

> The available resources are being underutilized and 10 messages per second is hardly any load in my opinion. How do I speed up things so that messages held up in queue are transferred faster to the client. Possibly using some sort of batching.
> 

Batching ACKs might help, as might reducing the prefetch count to something a bit more sensible (like 100s or 1000s for example). I suspect there's something else, more fundamental that's wrong with your setup, as these figures are abysmally slow and Rabbit is perfectly capable of handling much higher throughput for both producers and consumers, even with all the guarantees and safety measures like persistence, confirms and explicit ACKs turned on.

Cheers,
Tim

From tim at rabbitmq.com  Thu Mar 28 15:32:23 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 28 Mar 2013 15:32:23 +0000
Subject: [rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
In-Reply-To: <410419A1-5BDF-4B46-8A52-5BBF23F61A9E@rabbitmq.com>
References: <CAO43vHC4KBAAPbsVYH4DavFqJ1R2si_TAuCLAVzq=n8+sNJgbA@mail.gmail.com>
	<410419A1-5BDF-4B46-8A52-5BBF23F61A9E@rabbitmq.com>
Message-ID: <AE36E3CC-8E9F-44E8-AFF7-4D7327ADA2D4@rabbitmq.com>

BTW - if you're using the java client, there is a perf test tool you can run to check out your configuration - called MulticastMain and you can run it via the 'scripts' directory of the binary distribution. Check out runperftest.sh for examples of how its used, and runjava.sh to execute it.

Please give this a try to see what kind of throughput the client can get in your environment.

Cheers,
Tim 

On 28 Mar 2013, at 15:26, Tim Watson wrote:

> Priyank,
> 
> On 28 Mar 2013, at 12:33, Priyank Patil wrote:
> 
>> The client is unable to fetch those messages at that rate. As a result the queue on the server keeps growing.
>> 
> [snip]
>> Each message is less than 1 KB and I have a healthy 2 Mbps line between the server and my machine. Using a network monitoring utility, I found that it is hardly using any of that bandwidth.
>> 
>> The client is doing nothing with the messages as of now, just printing them to console so processing time on client is almost 0.
>> 
> 
> So why is the client 'unable to fetch those messages at that rate' then? Printing data to the console is not 0 processing time, although I agree it shouldn't be pushing your consumers down to 10 mps. Even with explicit ACKs I'd expect a consumer to manage in the order of KHz when consuming.
> 
>> Some other details: I am using a java client. I have set the client to prefetch 10000 messages. (also tried with default values) The round trip time is about 290 - 350 ms. Messages are individually acknowledged.
>> 
> 
> What do you mean 'round trip time' exactly? You are publishing and consuming from different channels right? You might find reducing the prefetch count a bit actually helps - 10k is quite a high setting. You might also like to confirm in batches (using the 'multiple' flag to indicate that all messages up to the current delivery-tag are being acknowledged.
> 
>> The available resources are being underutilized and 10 messages per second is hardly any load in my opinion. How do I speed up things so that messages held up in queue are transferred faster to the client. Possibly using some sort of batching.
>> 
> 
> Batching ACKs might help, as might reducing the prefetch count to something a bit more sensible (like 100s or 1000s for example). I suspect there's something else, more fundamental that's wrong with your setup, as these figures are abysmally slow and Rabbit is perfectly capable of handling much higher throughput for both producers and consumers, even with all the guarantees and safety measures like persistence, confirms and explicit ACKs turned on.
> 
> Cheers,
> Tim


From tim at rabbitmq.com  Thu Mar 28 15:32:52 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 28 Mar 2013 15:32:52 +0000
Subject: [rabbitmq-discuss] Can load-balancer work around consumer
	reconnect problem?
In-Reply-To: <CAAAYafMmaMz7NddqME2fUmJecO6Xe1UoCJaqo+N8Aps6VPv8rQ@mail.gmail.com>
References: <CAAAYafMmaMz7NddqME2fUmJecO6Xe1UoCJaqo+N8Aps6VPv8rQ@mail.gmail.com>
Message-ID: <0FDDBF4E-C5DE-4500-A89B-00435099EC5F@rabbitmq.com>

Hi,

On 28 Mar 2013, at 07:38, Jianhui Zhang wrote:
> I'm new to Rabbit, just want to confirm if my understanding of mirror-queues is correct. 
[snip]
> - under no failure condition, the master Node1 will send messages to all my consumers. 
> - if master fails, the slave Node2 will be promoted to the new master and start sending the remaining messages to my consumers. 

That's not quite right. If there is a failover to another node, then the surviving node will bounce any existing consumers (i.e., assume they've all gone away) and they will need to reconnect.

> - since the consumer TCP connection is to the LB, the consumer wouldn't notice anything (and don't need to reconnect), except for the "normal" out-of-sync and message loss considerations. 
> 
> Would this work? 

Not AFAIK, because of the above points. Your consumers can register for a 'consumer cancel notification' to be informed of this however, and then re-establish themselves if it happens. See http://www.rabbitmq.com/consumer-cancel.html for details.

Cheers,
Tim

> 
> Thanks, 
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From francois at teksol.info  Thu Mar 28 15:33:38 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Thu, 28 Mar 2013 11:33:38 -0400
Subject: [rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
In-Reply-To: <CAO43vHC4KBAAPbsVYH4DavFqJ1R2si_TAuCLAVzq=n8+sNJgbA@mail.gmail.com>
References: <CAO43vHC4KBAAPbsVYH4DavFqJ1R2si_TAuCLAVzq=n8+sNJgbA@mail.gmail.com>
Message-ID: <3497510F-22ED-4F9E-B22A-95CBA3C768DD@teksol.info>


Le 2013-03-28 ? 08:33, Priyank Patil a ?crit :

> I have a durable queue which holds persistent messages. The messages arrive into the queue at a rate of about 10 messages per second.
> 
> The client is unable to fetch those messages at that rate. As a result the queue on the server keeps growing.
> 
> Each message is less than 1 KB and I have a healthy 2 Mbps line between the server and my machine. Using a network monitoring utility, I found that it is hardly using any of that bandwidth.
> 
> The client is doing nothing with the messages as of now, just printing them to console so processing time on client is almost 0.
> 
> Some other details: I am using a java client. I have set the client to prefetch 10000 messages. (also tried with default values) The round trip time is about 290 - 350 ms. Messages are individually acknowledged.
> 
> The available resources are being underutilized and 10 messages per second is hardly any load in my opinion. How do I speed up things so that messages held up in queue are transferred faster to the client. Possibly using some sort of batching.
> 
I regularly process 2000 messages per second from durable queues with persistent messages, with a prefetch-count of 2000. My messages are 1500 to 2000 bytes each. The RabbitMQ server and the consumer are both in the same data center. My consumer is writing the messages to disk, in a flat-file.

There must be something in the Java code which causes the slowdown. Can you post your setup and processing loop?

Bye,
Fran?ois

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/b8d62b5e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/b8d62b5e/attachment.bin>

From tim at rabbitmq.com  Thu Mar 28 15:36:44 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 28 Mar 2013 15:36:44 +0000
Subject: [rabbitmq-discuss] Randomized Round-Robin?
In-Reply-To: <c1d64a0e-4532-4e05-876a-363ab25df67c@googlegroups.com>
References: <c1d64a0e-4532-4e05-876a-363ab25df67c@googlegroups.com>
Message-ID: <9C37C866-B0F0-4EA2-8C0F-139671918021@rabbitmq.com>

Hi

On 27 Mar 2013, at 13:26, Martin Koch wrote:
> This seems to have the effect that messages are first rounded to worker 1..N on host A, then worker 1..N on host B, etc. This basically means that only one of the hosts is doing the bulk of the work at any given time. 
> 
> What I would like to achieve is that a random worker is chosen instead of the deterministic round-robin.
> 

Without randomising, you could use prefetch counts to approximate fair dispatch (as in http://www.rabbitmq.com/tutorials/tutorial-two-python.html). Would that do what you want instead of using randomness? 

> Any ideas?
> 
> Thanks,
> /Martin Koch - Senior Systems Architect - Issuu.com
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Thu Mar 28 15:44:46 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 28 Mar 2013 15:44:46 +0000
Subject: [rabbitmq-discuss] Randomized Round-Robin?
In-Reply-To: <c1d64a0e-4532-4e05-876a-363ab25df67c@googlegroups.com>
References: <c1d64a0e-4532-4e05-876a-363ab25df67c@googlegroups.com>
Message-ID: <5154656E.3070709@rabbitmq.com>


Hi Martin,

On 27/03/13 13:26, Martin Koch wrote:
> I have a setup with many workers on several hosts; each worker consumes
> tasks from a work queue. 

> What I would like to achieve is that a random worker is chosen instead
> of the deterministic round-robin.
It is not clear what this achieves - why does it matter if consumers are
initially selected in the same order that they joined?

If the number workers per host exceeds the capacity of the host to
perform work in parallel, and work arrives very slowly, and workers are
selected in sequence then you may see suboptimal throughput. The
solution then is to reduce the number of workers per host. The number of
consumers per host should not exceed the capacity of the host to perform
tasks in parallel. This is often approximated by the number of cores.





-Emile






From tim at rabbitmq.com  Thu Mar 28 15:45:07 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 28 Mar 2013 15:45:07 +0000
Subject: [rabbitmq-discuss] How to implement consumer's sequential work
	correctly?
In-Reply-To: <9fa44c9b-1deb-4fe9-9819-27c7c17aa315@googlegroups.com>
References: <9fa44c9b-1deb-4fe9-9819-27c7c17aa315@googlegroups.com>
Message-ID: <9798D103-1AD0-411F-B891-382C49BE3567@rabbitmq.com>

Hi

On 26 Mar 2013, at 16:20, Karlen Kishmiryan wrote:
> Hello,
> Here are three steps I want to do:
> 	? pull some file names and pass them to the downloader (first consumer)
> 	? AFTER downloading each file pass them to the extracter (second consumer)
> 	? AFTER extracting pass them to the Inserter (third consumer) to push the data into DB
> Now I would like to know how I will manage these "AFTER"s. 
> As I understand there are two solutions:
> 	? each consumer must send the message to the producer back about success or failure of the task. If it's done successfully, then producer must send to the next consumer.

That's the RPC style - as in http://www.rabbitmq.com/tutorials/tutorial-six-python.html

> 	? each consumer must put the message to the next consumer's queue when it's done

That should also work fine. If you've been able to publish to one queue, then you should be able to publish to another one eh!?

> Actually I don't know how to realize both of them.

Have you read the tutorials at http://www.rabbitmq.com/getstarted.html yet? That's a good place to start, after which http://www.rabbitmq.com/documentation.html and http://www.rabbitmq.com/clients.html might be a good follow-on.


From tim at rabbitmq.com  Thu Mar 28 15:48:02 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 28 Mar 2013 15:48:02 +0000
Subject: [rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
In-Reply-To: <3497510F-22ED-4F9E-B22A-95CBA3C768DD@teksol.info>
References: <CAO43vHC4KBAAPbsVYH4DavFqJ1R2si_TAuCLAVzq=n8+sNJgbA@mail.gmail.com>
	<3497510F-22ED-4F9E-B22A-95CBA3C768DD@teksol.info>
Message-ID: <067DAA52-9D75-4B22-ADE0-7CF83D51BA8F@rabbitmq.com>

On 28 Mar 2013, at 15:33, Fran?ois Beausoleil wrote:
>> The available resources are being underutilized and 10 messages per second is hardly any load in my opinion. How do I speed up things so that messages held up in queue are transferred faster to the client. Possibly using some sort of batching.
>> 
> I regularly process 2000 messages per second from durable queues with persistent messages, with a prefetch-count of 2000. My messages are 1500 to 2000 bytes each. The RabbitMQ server and the consumer are both in the same data center. My consumer is writing the messages to disk, in a flat-file.
> 
> There must be something in the Java code which causes the slowdown. Can you post your setup and processing loop?
> 

Thanks Fran?ois, this is what I was getting at in fact. I too suspect the OP might be doing something a bit odd - care to post your code somewhere so we can review it Priyank? 

From tim at rabbitmq.com  Thu Mar 28 15:48:46 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 28 Mar 2013 15:48:46 +0000
Subject: [rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
In-Reply-To: <067DAA52-9D75-4B22-ADE0-7CF83D51BA8F@rabbitmq.com>
References: <CAO43vHC4KBAAPbsVYH4DavFqJ1R2si_TAuCLAVzq=n8+sNJgbA@mail.gmail.com>
	<3497510F-22ED-4F9E-B22A-95CBA3C768DD@teksol.info>
	<067DAA52-9D75-4B22-ADE0-7CF83D51BA8F@rabbitmq.com>
Message-ID: <DD10DEE1-5ECE-40E2-B67C-8C94F90F8953@rabbitmq.com>

On 28 Mar 2013, at 15:48, Tim Watson wrote:
>> 
>> There must be something in the Java code which causes the slowdown. Can you post your setup and processing loop?
>> 
> 
> Thanks Fran?ois, this is what I was getting at in fact. I too suspect the OP might be doing something a bit odd - care to post your code somewhere so we can review it Priyank?

Oh and if you do post your code, not just the 'processing loop' please - I'd like to see how your consumers/channels are set up too.

Cheers,
Tim

From 0x6e6562 at gmail.com  Thu Mar 28 16:47:25 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 28 Mar 2013 12:47:25 -0400
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <184DD272-8A24-47F0-8A68-4CD540F89905@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
	<CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2D1B04@FR44EX3005.global.ds.honeywell.com>
	<45DB8ED8-31AB-4721-84F6-33ED345F791A@gmail.com>
	<184DD272-8A24-47F0-8A68-4CD540F89905@rabbitmq.com>
Message-ID: <CAB-G1jgCNA4+6nyacjozQvqhKk9BqGNeVX_h1ZytiPmd7b0-Bg@mail.gmail.com>

Nice one Tim - I've managed to build and run this and it seems to generate
logs :-)

Cheers,

Ben


On Thu, Mar 28, 2013 at 8:47 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Guys,
>
> Sorry for the delay - I've been chasing my tail this morning looking at
> what I thought was a bug, and thankfully I was wrong! :)
>
> So... I've just pushed a couple of fixes that should sort things out for
> you (Ben) I hope. The instructions in the README now specify that you
> should check out the git repository into a folder called 'lager'
> (regardless of the actual source repository name), the APPNAME variable has
> been reset to 'lager' and I've renamed the uploaded binary to
> 'lager-2.0.0.ez' - this should fix these issues for you. In the long term,
> if enough people really want to use lager then we'll probably come up with
> another (better) approach than this, but I just wanted to get folks going
> for the time being so we can get some feedback.
>
> Please do let me know if you get along better with this now. If you're
> building from source then do a `make clean` in the umbrella before
> attempting a rebuild (with the renamed rabbitmq-lager => lager directory
> freshly checked out) otherwise the build system will get all in a twizzy
> about dependencies.
>
> As I said, we'll do this *properly* at some point soon (ish) and it won't
> be awkward like this when we release it into the wild.
>
> Cheers,
> Tim
>
> On 28 Mar 2013, at 12:30, Ben Hood wrote:
>
> > Hey Petr,
> >
> > I pulled the ez down with curl using the link specified in the README. I
> did this because it wouldn't build from source for me (see previous post),
> but that's probably because I just cloned Tim's repo into a subdir without
> renaming it. Having said that, I was just doing this quickly between
> flights, so I didn't really look into it too deeply.
> >
> > Cheers,
> >
> > Ben
> >
> > On Mar 28, 2013, at 7:48, "Gotthard, Petr" <Petr.Gotthard at Honeywell.com>
> wrote:
> >
> >> Ben,
> >> Did you rename the .ez file? Because mine has an usual name that
> probably causes rabbit to crash (see my other post), but enabling works
> fine for me. Could you try using the .ez file with exactly the same name as
> created by the makefile?
> >>
> >> Petr
> >>
> >> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ben Hood
> >> Sent: 28. b?ezna 2013 3:21
> >> To: Discussions about RabbitMQ
> >> Subject: Re: [rabbitmq-discuss] lager vs sasl error log
> >>
> >> Hey Tim,
> >>
> >> On Wed, Mar 27, 2013 at 10:03 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> >>
> >> I'm just kicking the tyres of your lager plugin with my rabbit umbrella.
> >>
> >> Just to get things going, I tried using the published ez (md5:
> 9066ed797ca75519a68820271c79994a) but I ran into the following issue:
> >>
> >> $ ./sbin/rabbitmq-plugins enable lager
> >> Warning: Problem reading some plugins:
> [{"./sbin/../plugins/rabbitmq_lager-2.0.0.ez",
> >>                                          {invalid_ez,bad_eocd}}]
> >> Error: The following plugins could not be found:
> >>   lager
> >>
> >> Did I maybe grab the wrong thing?
> >>
> >> Cheers,
> >>
> >> Ben
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/0040d155/attachment.htm>

From tim at rabbitmq.com  Thu Mar 28 16:52:29 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 28 Mar 2013 16:52:29 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <CAB-G1jgCNA4+6nyacjozQvqhKk9BqGNeVX_h1ZytiPmd7b0-Bg@mail.gmail.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
	<CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2D1B04@FR44EX3005.global.ds.honeywell.com>
	<45DB8ED8-31AB-4721-84F6-33ED345F791A@gmail.com>
	<184DD272-8A24-47F0-8A68-4CD540F89905@rabbitmq.com> <CAB- G1jgCNA4
	+6nyacjozQvqhKk9BqGNeVX_h1ZytiPmd7b0-Bg@mail.gmail.com>
Message-ID: <070C0ECF-DD56-4102-B4E3-10B624C80909@rabbitmq.com>

On 28 Mar 2013, at 16:47, Ben Hood wrote:
> Nice one Tim - I've managed to build and run this and it seems to generate logs :-)
> 

Phew - that's a relief! :)

Let me know how you get along with it.

Cheers,
Tim

From mak at issuu.com  Thu Mar 28 16:17:33 2013
From: mak at issuu.com (Martin Koch)
Date: Thu, 28 Mar 2013 17:17:33 +0100
Subject: [rabbitmq-discuss] Randomized Round-Robin?
In-Reply-To: <5154656E.3070709@rabbitmq.com>
References: <c1d64a0e-4532-4e05-876a-363ab25df67c@googlegroups.com>
	<5154656E.3070709@rabbitmq.com>
Message-ID: <9B2F7963-7FBB-4355-A5B0-795FBBCB7173@issuu.com>

You are correct that work will tend to be evenly distributed over time but if all jobs take close to the same time, then there will be a tendency to load the hosts sequentially using only 1/N of N hosts, particularly after launching hosts. Also, if I add a new host with workers, then all workers on this host will be selected sequentially before using workers on the existing hosts. So therefore I believe that it would be useful to have a mechanism to randomly select the next worker. 

/Martin


On 28/03/2013, at 16.44, Emile Joubert <emile at rabbitmq.com> wrote:

> 
> Hi Martin,
> 
> On 27/03/13 13:26, Martin Koch wrote:
>> I have a setup with many workers on several hosts; each worker consumes
>> tasks from a work queue. 
> 
>> What I would like to achieve is that a random worker is chosen instead
>> of the deterministic round-robin.
> It is not clear what this achieves - why does it matter if consumers are
> initially selected in the same order that they joined?
> 
> If the number workers per host exceeds the capacity of the host to
> perform work in parallel, and work arrives very slowly, and workers are
> selected in sequence then you may see suboptimal throughput. The
> solution then is to reduce the number of workers per host. The number of
> consumers per host should not exceed the capacity of the host to perform
> tasks in parallel. This is often approximated by the number of cores.
> 
> 
> 
> 
> 
> -Emile
> 
> 
> 
> 
> 

From goyalk at vmware.com  Thu Mar 28 20:53:59 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Thu, 28 Mar 2013 13:53:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support change in
	hostname
Message-ID: <9915783f.00001508.000000cf@KAPILPC.vmware.com>

RabbitMQ creates a new database if hostname is changed (as documented at
http://www.rabbitmq.com/ec2.html).

 

I need to support the hostname change on my RabbitMQ server without
impacting its functioning. Can I accomplish this by setting the NODENAME
environment variable in rabbitmq-env.conf. It seems from rabbitmq-server
script that names of database, logs etc. try to use this variable before
resorting to using hostname. Is this the right approach? Are there any
side-effects to look out for?

 

Thanks

Kapil Goyal

Sr. MTS

VMware Inc.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/c7ff74c0/attachment.htm>

From fred at dushin.net  Fri Mar 29 01:43:41 2013
From: fred at dushin.net (Dushin Fred)
Date: Thu, 28 Mar 2013 21:43:41 -0400
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support change
	in	hostname
In-Reply-To: <9915783f.00001508.000000cf@KAPILPC.vmware.com>
References: <9915783f.00001508.000000cf@KAPILPC.vmware.com>
Message-ID: <95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>

See

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-February/025368.html


On Mar 28, 2013, at 4:53 PM, Kapil Goyal <goyalk at vmware.com> wrote:

> RabbitMQ creates a new database if hostname is changed (as documented at http://www.rabbitmq.com/ec2.html).
>  
> I need to support the hostname change on my RabbitMQ server without impacting its functioning. Can I accomplish this by setting the NODENAME environment variable in rabbitmq-env.conf. It seems from rabbitmq-server script that names of database, logs etc. try to use this variable before resorting to using hostname. Is this the right approach? Are there any side-effects to look out for?
>  
> Thanks
> Kapil Goyal
> Sr. MTS
> VMware Inc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130328/75962afb/attachment.htm>

From reddylast at gmail.com  Fri Mar 29 07:44:05 2013
From: reddylast at gmail.com (reddylast)
Date: Fri, 29 Mar 2013 00:44:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Same consumer getting the rejected message again
Message-ID: <1364543044995-25785.post@n5.nabble.com>

Hi,

I've set-up multiple queues and multiple consumers are processing those
queues. There is a case when a consumer receives a message , if that
consumer is not authorized  to process that message then system sent it back
to the queue (by using basic.reject method). I want to stop the same
consumer getting the same rejected message  again and again. Is there any
way that prevents a message from looping through the system forever ?

Thanks,
Reddy





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Same-consumer-getting-the-rejected-message-again-tp25785.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Petr.Gotthard at Honeywell.com  Fri Mar 29 08:12:50 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Fri, 29 Mar 2013 08:12:50 +0000
Subject: [rabbitmq-discuss] lager vs sasl error log
In-Reply-To: <3EBD9BB2-C68F-406D-8BF0-0663940FAC35@rabbitmq.com>
References: <CAKwdTWe5-U2sWPHPM+DqV4=C1FA9L3fkG1KLUxpL13Bkp=cdAQ@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2C5AA0@FR44EX3005.global.ds.honeywell.com>
	<6AB96455-452E-487B-9EB0-B618BF960EE8@rabbitmq.com>
	<20DEDA735697450B9CE2A5A1020B81F1@gmail.com>
	<8B312FFE-A21A-4068-8917-F6F7012F06EE@rabbitmq.com>
	<8DA946A6DD634687888CF50A0FE84263@gmail.com>
	<CAKwdTWdH580=AQm45m3jJL9+4tvv_J8iCO8Nmz+B97uHXL_Fvw@mail.gmail.com>
	<5FC52E55-236D-4DA0-91F4-EEC58DAB388D@rabbitmq.com>
	<19164406BD624090AB5BF53AFC73C012@gmail.com>
	<CC07BEC7-B9EE-47D6-B33E-27D32C5AE747@rabbitmq.com>
	<764638297ACA469080F0C7943CA815A8@gmail.com>
	<6CE37131-0F96-4470-BD6E-40DBC59DF906@rabbitmq.com>
	<CAB-G1jgnF49LEHg3B0bfGekLFwrY+Qb4nx1YUKrgmOwAK0EaYg@mail.gmail.com>
	<CAB-G1jiptOBU9R_pd3i_o5=sOxHVt4kaorP=kORGG+Te+oYmag@mail.gmail.com>
	<F9E85480F62349458DF67CE8BA000D8D2D2D1B04@FR44EX3005.global.ds.honeywell.com>
	<45DB8ED8-31AB-4721-84F6-33ED345F791A@gmail.com>
	<184DD272-8A24-47F0-8A68-4CD540F89905@rabbitmq.com> <F9E8 5480F623
	49458DF67CE8BA000D8D2D2D1D94@FR44EX3005.global.ds.honeywell.com>
	<3EBD9BB2-C68F-406D-8BF0-0663940FAC35@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2D2D2368@FR44EX3005.global.ds.honeywell.com>

Tim,
Don't worry about this issue. I have probably misused the VERSION number.

The problem is we have custom plug-ins (another product) on top of RabbitMQ, which means the RabbitMQ VERSION is different from our plug-in VERSION.
Then, if RabbitMQ is 3.0.2 and our plug-in is 0.0.4 the lager will be compiled twice: as lager-2.0.0-rmq3.0.2 and then as lager-2.0.0-rmq3.0.2. The rabbitmq_lager/dist directory will however store only one .ez file-- the one that will be compiled later. This creates a problem for packaging, because the name of the .ez file in rabbitmq_lager/dist depends on the build sequence, which is not very nice.

Lesson learned: The VERSION number shall indicate the RabbitMQ version for all plug-ins.


Petr

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: 28. b?ezna 2013 14:44
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] lager vs sasl error log


On 28 Mar 2013, at 13:18, Gotthard, Petr wrote:

> Thanks Tim,
> 
> It compiles, runs and works, but--- there's a trouble (at least here) with the "rmq" suffix (the name is something like lager-2.0.0-rmq0.0.0-git9719370.ez)
> 
> The RMQ numbers seem to be taken from the VERSION parameter. Which means that if multiple plug-ins have different version, different version of the lager is created for each of the plugins (rmq0.0.0, rmq0.0.1, rmq0.0.4) and these versions overwrite each other, which creates a mess.
> 

I'm not really sure why this would happen?

> Can various plug-ins can have different version, but still be compiled against the same rabbit?
> 

I don't think so - when you build from source, all the plugins (and the broker) should pick up the same VERSION as each other. If you're not building from source, I'm not sure which constraint you're running into. What are the symptoms (i.e., what goes wrong)?

From saprykin.dmitry at gmail.com  Fri Mar 29 08:45:53 2013
From: saprykin.dmitry at gmail.com (Dmitry Saprykin)
Date: Fri, 29 Mar 2013 12:45:53 +0400
Subject: [rabbitmq-discuss] RabbitMQ server connections close issue
Message-ID: <CAHWt7w2Mfi3pQ8=7ZDuBZJVoX2PJqkCOty6YKLL+7gd_2SWoGQ@mail.gmail.com>

Hello,

We experience a problem with rabbitMQ connection closed by client by
timeout. I cannot find any solution so I would very appreciate any help.

Our setup is following:

R14B04 erlang with hipe
rabbitmq is hipe compiled
2 RabbitMQ 3.0.4 (3.0.0 earlier with the same problem) clustered nodes
durable queue is mirrored between nodes
from 400 to 600 messages per seconds
rabbitmq-c clients with 200 ms timeout
clients use non persistent connections ( sender opens connection, publish
message, closes connection. consumer opens connection, gets N messages,
closes connection, restarts )
tcp_listener keepalive is enabled

Initially everything goes fine. But some connection are closed by client by
timeout.
It seems to me that these connection are not closed inside of RabbitMQ so
connection time steadily grows and after approx 1 day cluster average
connect time become above 200 ms.

rabbitmqctl stop_app && rabbitmqctl start_app resolves problem for one more
day.

tcpdump shows that client connection timeout occures before server sends
capabilities package.
after 10 seconds in rabbit error log appears handshake_timeout exception.

Initially (netstat -nt | wc -l) and (rabbitmqctl list_connections | wc -l)
shows very close counts
When everything goes bad  (rabbitmqctl list_connections | wc -l) twice as
much connections than (netstat -nt | wc -l)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130329/709f97e2/attachment.htm>

From bison_art at o2.pl  Fri Mar 29 12:36:42 2013
From: bison_art at o2.pl (rabbit15)
Date: Fri, 29 Mar 2013 05:36:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Blocking connections
Message-ID: <1364560602974-25788.post@n5.nabble.com>

Hi, I have problem with blocking connections. I have 45 queues and 23
exchanges. Main traffic is on 32 queues (3 parts of the system are connected
with 16 queues form them), which have separate connections and channels.
Producer A is connected with node B with 1 exchange and 16 queues bound to
it. B forwards data to consumer C, which is also connected with 1 exchange
and 16 queues bound to it. On the begginning there were about 40 000
messages /s
After about 15 minutes rabbit is not able to deliver nor to receive
messages, because all connections seem to be blocked.. 
Memory and disk usage were under watermarks. There was about 6 milions
stored messages.

Here the rabbitctl outoput
rabbitmqctl list_connections last_blocked_by last_blocked_age

flow    195.281173
flow    195.283588
flow    195.288559
flow    195.289516
flow    195.291581
flow    195.29297
flow    195.33622
flow    195.34424
flow    195.347141
flow    195.353336
flow    195.357779
flow    195.370545
flow    195.379896
flow    195.396611
flow    195.411805
flow    195.412806
flow    195.417144
flow    195.425048
flow    195.431083
flow    195.436961
flow    195.440714
flow    195.4458
flow    195.464814
flow    195.484873
flow    195.505444
flow    195.533318
flow    195.562232
flow    195.567712
flow    356.156679
flow    372.703345
flow    373.315765
flow    377.614557
flow    385.315363
flow    479.393574
flow    483.674278
flow    483.696068
flow    483.773512
flow    483.784834
flow    483.79031
flow    483.803412
flow    483.8756
flow    483.915878
flow    483.928576
flow    484.447225
...done.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Blocking-connections-tp25788.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From stuff at moesel.net  Fri Mar 29 12:46:26 2013
From: stuff at moesel.net (Chris)
Date: Fri, 29 Mar 2013 08:46:26 -0400
Subject: [rabbitmq-discuss] rabbitmq-java-messagepatterns
Message-ID: <CAHEpgBBrupMf=JsWY4SfjFgNe_GFeLgqAwYsZU0scDqH4mkFew@mail.gmail.com>

We are currently using the Java AMQP client (3.0.x) with a 3.0.x server.
 We need to implement HA/Failover, so we want to handle server
interruptions gracefully-- reconnecting (to same or different node) and
resubscribing to all queues.

Someone on my team identified the
rabbitmq-java-messagepatterns<https://github.com/rabbitmq/rabbitmq-java-messagepatterns>project
on github as a potential solution.  I see that it is about 3 years
old, but it is authored by some people who are still prominent in this
community.

Can anyone recommend for or against this library for 3.x deployments?
 Should we look into it, or should we just plan on implementing the
reconnection and resubscription logic ourselves?

Thanks!
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130329/e2824fef/attachment.htm>

From tilak.chauhan at ymail.com  Fri Mar 29 18:57:17 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Fri, 29 Mar 2013 11:57:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem with multiple consumers on multiple
	servers !
Message-ID: <1364583437418-25790.post@n5.nabble.com>

Hi,

I've recently started to develop a cron job kind of mechanism by using
rabbitmq. In this system a producer reads all the jobs (messages) from a
database table and creates queues, depending upon the category of the job
and puts jobs into their respective queues. In other words, each job belongs
to a particular category and for each category we've a queue.

Now I've setup multiple consumers and each consumer is listening to a single
queue. Below is the sample code (in PHP) for each consumer :

$connection = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
$channel = $connection->channel();
$channel->queue_declare('queue_category_1', false, true, false, false);
$channel->exchange_declare('router', 'direct', true, true, false);
$channel->queue_bind('queue_category_1', 'router', 'queue_category_1');

$callback = function($msg)  {  /***** code here to consume message/job
******/  };

$channel->basic_qos(null, 1, null);

$channel->basic_consume('queue_category_1', 'unique_consumer_tag', false,
false, false, false, $callback);

while (count($channel->callbacks)) {
    $channel->wait();
}

When I try to call all the consumers simultaneously, I can see they all are
consuming/processing messages/jobs parallely. Now I've added one more server
(server-2) which consumes messages from previous sever (server-1). In this
way, now the number of consumers are doubled (server-1 is working as both
producer and consumer sever & server-2 is consumer server). In both the
servers, consumer processes are running parallely, but, they are not
consuming messages as they are supposed to do. The problem which I've
noticed is that only one message/job from each queue is being consumed at a
time. As I added one more server so now two jobs from each queue should be
consumed at time instead of only one job. Soon I'll have to add more severs
to make this system more distributed. Can anyone please help me to find out,
why only one job is being consumed at a time ? and what can be the solution
?

Thanks in advance.

T.luck















  





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Problem-with-multiple-consumers-on-multiple-servers-tp25790.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From atlanta444484 at yahoo.com  Fri Mar 29 22:08:04 2013
From: atlanta444484 at yahoo.com (Atlanta44)
Date: Fri, 29 Mar 2013 15:08:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Exchnages and queues
Message-ID: <1364594884354-25791.post@n5.nabble.com>

If I have a lot of queues (say 50 to 79) that I need to create, which would
be better, using a single exchange with all the queues on it, or would I use
multiple exchanges with 10 or 20 queues on each exchange

Which would be faster

Which would be more orderly

Thanks in advance



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Exchnages-and-queues-tp25791.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Fri Mar 29 22:17:45 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 30 Mar 2013 02:17:45 +0400
Subject: [rabbitmq-discuss] Exchnages and queues
In-Reply-To: <1364594884354-25791.post@n5.nabble.com>
References: <1364594884354-25791.post@n5.nabble.com>
Message-ID: <CAE3HoVR67TOUafiWzGunXu-VqenwojdOdRKOWXReC2gq+cFhag@mail.gmail.com>

2013/3/30 Atlanta44 <atlanta444484 at yahoo.com>

> Which would be faster
>
> Which would be more orderly
>

It depends on your routing patterns but 50 to 79 is hardly a large number
of queues
so use whatever approach seems more straightforward to you.

Reasoning about a topology with just 1 exchange is likely to be easier and
I expect
the code to be more straightforward, too.

Message routing is very rarely a bottleneck.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130330/8cf9c60d/attachment.htm>

From sender.eric at gmail.com  Fri Mar 29 22:38:17 2013
From: sender.eric at gmail.com (sender.eric)
Date: Fri, 29 Mar 2013 15:38:17 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ unable to talk to remote server
Message-ID: <1364596697774-25793.post@n5.nabble.com>

Note. I realized I was not subscribed properly to RabbitMQ mailing list,
which may have been why google groups doesn't seem to work and I see barely
any replies. I am re-posting this here where replies seem to come through
more.
___
Hello,

I am setting up an enviornment where the server and client are on seperate
hosts. Using wireshark, I am finding that my connection requests are being
blocked by code 10:

Code: 10 (Host administratively prohibited)

I was wondering if anyone knows how to make sure my server is set up right
to work with RabbitMQ? I am using the default ports.

Here is my set up:

- Remote server is CentOS. It is on my same subnet (its actually a guestOS
on my PC)
- I am currently running the server as Python. Just the tutorial #1
recieve.py server
- connection =
pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
- My client is my HostOS PC running Java.
- factory.setHost("192.168.1.124"); //x.x.x.124 is my "remote" GuestOS
- Everything works find through localhost, but when I try to separate the
client and server, I am getting what looks like firewall issues. 

So, this question may require some help from a person who uses RedHat/CentOS
as their server OS, as I imagine part of the solution has to do with
modifying the firewall or something in the virtual NIC card?

I am posting this on the Google Groups, and I have noticed google doesn't
update for every reply? Please be sure to CC my personal email just in case
Google doesn't update. sender.eric (at) gmail

Thanks,
Eric



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-unable-to-talk-to-remote-server-tp25793.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alex.reshniuk at gmail.com  Fri Mar 29 21:07:50 2013
From: alex.reshniuk at gmail.com (Alexander Reshniuk)
Date: Fri, 29 Mar 2013 14:07:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to start direct connection using Erlang
	client
Message-ID: <a0b3f8d1-aa1e-4256-b95a-d79e2e55cbd4@googlegroups.com>

Hi All,

I really need you help since
I spend few days trying to make direct connection to RabbitMQ using Erlang 
client (both located on same host):

{ok, Connection} =
>         amqp_connection:start(#amqp_params_direct{ node = 
> <<"kiosk at localhost">>}),


Same connection but  #amqp_params_network works without any problem.
I'm dumping cookie before this call (using get_cookie()) and it'ss same as 
/var/lib/rabbitmq/.erlang.cookie  and /root/.erlang.cookie

RabbitMQ version: 2.7.1
Erlang AMQP client lib version: 2.7.1
Erlang version:  R14B04

rabbitmq-server output:
---------
/usr/lib/rabbitmq/bin/rabbitmq-server
Activating RabbitMQ plugins ...
10 plugins activated:
* amqp_client-0.0.0
* mochiweb-1.3-rmq0.0.0-git
* rabbitmq_consistent_hash_exchange-0.0.0
* rabbitmq_federation-0.0.0
* rabbitmq_management-0.0.0
* rabbitmq_management_agent-0.0.0
* rabbitmq_management_visualiser-0.0.0
* rabbitmq_mochiweb-0.0.0
* rabbitmq_tracing-0.0.0
* webmachine-1.7.0-rmq0.0.0-hg

node with name "kiosk" already running on "localhost"
diagnostics:
- nodes and their ports on localhost: [{kiosk,44319},
                                       {rabbitmqprelaunch671,54355}]
- current node: rabbitmqprelaunch671 at localhost
- current node home dir: /root
- current node cookie hash: UuV+hP3qioICevzwrp5uuw==

---------

Runtime error log:
-----------------------
=ERROR REPORT==== 29-Mar-2013::21:03:24 ===
** Generic server <0.46.0> terminating
** Last message in was connect
** When Server state == {state,amqp_direct_connection,
                            {state,undefined,undefined,undefined,undefined,
                                undefined,undefined,undefined},
                            <0.45.0>,undefined,
                            {amqp_params_direct,<<"guest">>,<<"/">>,
                                <<"kiosk at localhost">>,none,[]},
                            undefined,undefined,
                            #Fun<amqp_connection_sup.1.36702488>,
                            #Fun<amqp_connection_sup.2.54430129>,false}
** Reason for termination ==
** {{function_clause,[{gen,call,
                           [{rex,<<"kiosk at localhost">>},
                            '$gen_call',
                            {call,rabbit_direct,connect,
                                  [<<"guest">>,<<"/">>,
                                   rabbit_framing_amqp_0_9_1,<0.46.0>,
                                   [{pid,<0.46.0>},
                                    {protocol,{'Direct',{0,9,1}}},
                                    {address,unknown},
                                    {port,unknown},
                                    {name,<<"<t1 at localhost.2.46.0>">>},
                                    {peer_address,unknown},
                                    {peer_port,unknown},
                                    {user,<<"guest">>},
                                    {vhost,<<"/">>},
                                    {client_properties,[]},
                                    {type,direct}]],
                                  <0.42.0>},
                            infinity]},
                      {gen_server,call,3},
                      {rpc,do_call,3},
                      {amqp_direct_connection,connect,4},
                      {amqp_gen_connection,handle_call,3},
                      {gen_server,handle_msg,5},
                      {proc_lib,init_p_do_apply,3}]},
    {gen_server,call,
                [{rex,<<"kiosk at localhost">>},
                 {call,rabbit_direct,connect,
                       [<<"guest">>,<<"/">>,rabbit_framing_amqp_0_9_1,
                        <0.46.0>,
                        [{pid,<0.46.0>},
                         {protocol,{'Direct',{0,9,1}}},
                         {address,unknown},
                         {port,unknown},
                         {name,<<"<t1 at localhost.2.46.0>">>},
                         {peer_address,unknown},
                         {peer_port,unknown},
                         {user,<<"guest">>},
                         {vhost,<<"/">>},
                         {client_properties,[]},
                         {type,direct}]],
                       <0.42.0>},
                 infinity]}}
escript: exception exit: {{{function_clause,
                      [{gen,call,
                           [{rex,<<"kiosk at localhost">>},
                            '$gen_call',
                            {call,rabbit_direct,connect,
                                [<<"guest">>,<<"/">>,
                                 rabbit_framing_amqp_0_9_1,<0.46.0>,
                                 [{pid,<0.46.0>},
                                  {protocol,{'Direct',{0,9,1}}},
                                  {address,unknown},
                                  {port,unknown},
                                  {name,<<"<t1 at localhost.2.46.0>">>},
                                  {peer_address,unknown},
                                  {peer_port,unknown},
                                  {user,<<"guest">>},
                                  {vhost,<<"/">>},
                                  {client_properties,[]},
                                  {type,direct}]],
                                <0.42.0>},
                            infinity]},
                       {gen_server,call,3},
                       {rpc,do_call,3},
                       {amqp_direct_connection,connect,4},
                       {amqp_gen_connection,handle_call,3},
                       {gen_server,handle_msg,5},
                       {proc_lib,init_p_do_apply,3}]},
                  {gen_server,call,
                      [{rex,<<"kiosk at localhost">>},
                       {call,rabbit_direct,connect,
                           [<<"guest">>,<<"/">>,rabbit_framing_amqp_0_9_1,
                            <0.46.0>,
                            [{pid,<0.46.0>},
                             {protocol,{'Direct',{0,9,1}}},
                             {address,unknown},
                             {port,unknown},
                             {name,<<"<t1 at localhost.2.46.0>">>},
                             {peer_address,unknown},
                             {peer_port,unknown},
                             {user,<<"guest">>},
                             {vhost,<<"/">>},
                             {client_properties,[]},
                             {type,direct}]],
                           <0.42.0>},
                       infinity]}},
                 {gen_server,call,[<0.46.0>,connect,infinity]}}
  in function  gen_server:call/3
  in call from erl_eval:do_apply/5
  in call from erl_eval:expr/5
  in call from escript:eval_exprs/5
  in call from erl_eval:local_func/5
  in call from escript:interpret/4
  in call from escript:start/1
  in call from init:start_it/1
-----------------------

Thank you in advance for any ideas,

Best,
Alexander Reshniuk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130329/4a51e2dd/attachment.htm>

From atlanta444484 at yahoo.com  Fri Mar 29 23:11:26 2013
From: atlanta444484 at yahoo.com (Atlanta44)
Date: Fri, 29 Mar 2013 16:11:26 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and Nagle
Message-ID: <1364598686622-25795.post@n5.nabble.com>

I read where RabbitMQ is faster with Nagle off

SHould I turn Nagle off at the OS level, or is there a way to do that from
my Java code.  If so, could someone please post a link

Thanks in advance



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-and-Nagle-tp25795.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From goyalk at vmware.com  Fri Mar 29 23:18:20 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Fri, 29 Mar 2013 16:18:20 -0700 (PDT)
Subject: [rabbitmq-discuss] Configuring RabbitMQ to support
	change	in	hostname
In-Reply-To: <95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>
References: <9915783f.00001508.000000cf@KAPILPC.vmware.com>
	<95003806-680B-425F-AC8D-9466CAB8071D@dushin.net>
Message-ID: <215e265c.00001508.000000f6@KAPILPC.vmware.com>

Thanks Dushin. Setting NODENAME to rabbit at localhost in rabbitmq-env.conf
seems to work. But, if I were to later implement clustering/federation of
multiple such servers, each having rabbit at localhost as the node-name won't
work. I am thinking of solving it by replacing rabbit at localhost with
rabbit@<random string> before RabbitMQ starts for the first time. Does
<random string> have to be DNS resolvable?

 

 

From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Dushin
Fred
Sent: Thursday, March 28, 2013 6:44 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Configuring RabbitMQ to support change in
hostname

 

See

 

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-February/025368.
html

 

 

On Mar 28, 2013, at 4:53 PM, Kapil Goyal <goyalk at vmware.com> wrote:





RabbitMQ creates a new database if hostname is changed (as documented at
<http://www.rabbitmq.com/ec2.html> http://www.rabbitmq.com/ec2.html).

 

I need to support the hostname change on my RabbitMQ server without
impacting its functioning. Can I accomplish this by setting the NODENAME
environment variable in rabbitmq-env.conf. It seems from rabbitmq-server
script that names of database, logs etc. try to use this variable before
resorting to using hostname. Is this the right approach? Are there any
side-effects to look out for?

 

Thanks

Kapil Goyal

Sr. MTS

VMware Inc.

_______________________________________________
rabbitmq-discuss mailing list
 <mailto:rabbitmq-discuss at lists.rabbitmq.com>
rabbitmq-discuss at lists.rabbitmq.com
 <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130329/88b3f6c9/attachment.htm>

From michael.s.klishin at gmail.com  Sat Mar 30 05:50:04 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 30 Mar 2013 09:50:04 +0400
Subject: [rabbitmq-discuss] RabbitMQ and Nagle
In-Reply-To: <1364598686622-25795.post@n5.nabble.com>
References: <1364598686622-25795.post@n5.nabble.com>
Message-ID: <CAE3HoVTHs-ADK+A1PyfKu7HyEs0nwEKSYtgbbzLjMZod49cqvA@mail.gmail.com>

2013/3/30 Atlanta44 <atlanta444484 at yahoo.com>

> SHould I turn Nagle off at the OS level, or is there a way to do that from
> my Java code.  If so, could someone please post a link
>

You cannot disable Nagle's algorithm at the OS level, it is a per-socket
setting.

RabbitMQ Java client disables it by default:
http://hg.rabbitmq.com/rabbitmq-java-client/file/025634fd7006/src/com/rabbitmq/client/ConnectionFactory.java#l478
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130330/1c5a2237/attachment.htm>

From michael.s.klishin at gmail.com  Sat Mar 30 10:20:29 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 30 Mar 2013 14:20:29 +0400
Subject: [rabbitmq-discuss] RabbitMQ and Nagle
In-Reply-To: <CAE3HoVTHs-ADK+A1PyfKu7HyEs0nwEKSYtgbbzLjMZod49cqvA@mail.gmail.com>
References: <1364598686622-25795.post@n5.nabble.com>
	<CAE3HoVTHs-ADK+A1PyfKu7HyEs0nwEKSYtgbbzLjMZod49cqvA@mail.gmail.com>
Message-ID: <CAE3HoVR_CqB3rmjCGe8+rVu4b=ZpDfdw_8xijvOPSZS2akb4Mg@mail.gmail.com>

2013/3/30 Michael Klishin <michael.s.klishin at gmail.com>

> You cannot disable Nagle's algorithm at the OS level


For the record, it turns out you can do it on OS X and *BSD by setting
net.inet.tcp.delayed_ack=0 with sysctl (or in sysctl.conf).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130330/f289e36b/attachment.htm>

From watson.timothy at gmail.com  Sat Mar 30 12:14:06 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 30 Mar 2013 12:14:06 +0000
Subject: [rabbitmq-discuss] Problem with multiple consumers on multiple
	servers !
In-Reply-To: <1364583437418-25790.post@n5.nabble.com>
References: <1364583437418-25790.post@n5.nabble.com>
Message-ID: <3CBCB0F9-112C-4CC3-BB5B-5D1B4C753AFD@rabbitmq.com>

The broker wont send a consumer another message until it avks the last one. Your consumers can opt to receive more than one un-acknowledged message by setting a prefetch count using basic.qos.

Perhaps that's the issue?

Cheers
Tim

On 29 Mar 2013, at 18:57, tluck <tilak.chauhan at ymail.com> wrote:

> Hi,
> 
> I've recently started to develop a cron job kind of mechanism by using
> rabbitmq. In this system a producer reads all the jobs (messages) from a
> database table and creates queues, depending upon the category of the job
> and puts jobs into their respective queues. In other words, each job belongs
> to a particular category and for each category we've a queue.
> 
> Now I've setup multiple consumers and each consumer is listening to a single
> queue. Below is the sample code (in PHP) for each consumer :
> 
> $connection = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
> $channel = $connection->channel();
> $channel->queue_declare('queue_category_1', false, true, false, false);
> $channel->exchange_declare('router', 'direct', true, true, false);
> $channel->queue_bind('queue_category_1', 'router', 'queue_category_1');
> 
> $callback = function($msg)  {  /***** code here to consume message/job
> ******/  };
> 
> $channel->basic_qos(null, 1, null);
> 
> $channel->basic_consume('queue_category_1', 'unique_consumer_tag', false,
> false, false, false, $callback);
> 
> while (count($channel->callbacks)) {
>    $channel->wait();
> }
> 
> When I try to call all the consumers simultaneously, I can see they all are
> consuming/processing messages/jobs parallely. Now I've added one more server
> (server-2) which consumes messages from previous sever (server-1). In this
> way, now the number of consumers are doubled (server-1 is working as both
> producer and consumer sever & server-2 is consumer server). In both the
> servers, consumer processes are running parallely, but, they are not
> consuming messages as they are supposed to do. The problem which I've
> noticed is that only one message/job from each queue is being consumed at a
> time. As I added one more server so now two jobs from each queue should be
> consumed at time instead of only one job. Soon I'll have to add more severs
> to make this system more distributed. Can anyone please help me to find out,
> why only one job is being consumed at a time ? and what can be the solution
> ?
> 
> Thanks in advance.
> 
> T.luck
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Problem-with-multiple-consumers-on-multiple-servers-tp25790.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tilak.chauhan at ymail.com  Sat Mar 30 14:28:31 2013
From: tilak.chauhan at ymail.com (tluck)
Date: Sat, 30 Mar 2013 07:28:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem with multiple consumers on multiple
	servers !
In-Reply-To: <3CBCB0F9-112C-4CC3-BB5B-5D1B4C753AFD@rabbitmq.com>
References: <1364583437418-25790.post@n5.nabble.com>
	<3CBCB0F9-112C-4CC3-BB5B-5D1B4C753AFD@rabbitmq.com>
Message-ID: <1364653711470-25800.post@n5.nabble.com>

Hi Tim,

Thanks for your quick answer. Don't you think that if I increase prefetch
count then it may cause redundancy of  the same messages to more then one
consumer ? I mean the same message/job can be consumed by two or more
consumers at a time (I read it somewhere and may be I'm wrong). Suppose, if
I increase prefetch count to 10 then broker won't send messages to any of
the consumers (which are consuming messages from current queue)  until  all
10 messages are consumed ? right ? If yes, then how can we tackle the
problem which can be caused by all this. If one/two consumer(s) take too
long time to consume their messages then others will go idle (as they have
to wait others to finish their job).

If I have 20K messages and 10 consumers on a single queue then what would be
an ideal count for prefetch_count ?






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Problem-with-multiple-consumers-on-multiple-servers-tp25790p25800.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From atlanta444484 at yahoo.com  Sat Mar 30 19:23:18 2013
From: atlanta444484 at yahoo.com (Atlanta44)
Date: Sat, 30 Mar 2013 12:23:18 -0700 (PDT)
Subject: [rabbitmq-discuss] node-amqp ???
Message-ID: <1364671398331-25801.post@n5.nabble.com>

What exactly is node-amqp

I am writing java clients,  Is this applicable to java clients

Is this a standard (supported) part of RabbitMQ ?

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/node-amqp-tp25801.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From atlanta444484 at yahoo.com  Sat Mar 30 19:32:32 2013
From: atlanta444484 at yahoo.com (Atlanta44)
Date: Sat, 30 Mar 2013 12:32:32 -0700 (PDT)
Subject: [rabbitmq-discuss] prefetch count
Message-ID: <1364671952003-25802.post@n5.nabble.com>

Is there4 a default prefetch count in Rabbit, or is it unlimited

How can I increase the prefetch count.  Could you please post an example

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/prefetch-count-tp25802.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From videlalvaro at gmail.com  Sat Mar 30 20:08:02 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 30 Mar 2013 21:08:02 +0100
Subject: [rabbitmq-discuss] prefetch count
In-Reply-To: <1364671952003-25802.post@n5.nabble.com>
References: <1364671952003-25802.post@n5.nabble.com>
Message-ID: <CAMcAHLVd_zhs1u8=Ugy4Y6vh+xdA-POEuVKja0P78E=C8O-A8g@mail.gmail.com>

This tutorial uses basic.qos to change the prefetch count:
http://www.rabbitmq.com/tutorials/tutorial-two-python.html


On Sat, Mar 30, 2013 at 8:32 PM, Atlanta44 <atlanta444484 at yahoo.com> wrote:

> Is there4 a default prefetch count in Rabbit, or is it unlimited
>
> How can I increase the prefetch count.  Could you please post an example
>
> Thanks
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/prefetch-count-tp25802.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130330/cdb47b81/attachment.htm>

From michael.s.klishin at gmail.com  Sat Mar 30 20:11:43 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 31 Mar 2013 00:11:43 +0400
Subject: [rabbitmq-discuss] prefetch count
In-Reply-To: <1364671952003-25802.post@n5.nabble.com>
References: <1364671952003-25802.post@n5.nabble.com>
Message-ID: <CAE3HoVS4KewMmHRyNuNF3GthHt4QOqdGooNbAYxLf+aKmb5-iA@mail.gmail.com>

2013/3/30 Atlanta44 <atlanta444484 at yahoo.com>

> Is there4 a default prefetch count in Rabbit, or is it unlimited


There is no limit by default.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130331/ed1135b5/attachment.htm>

From michael.s.klishin at gmail.com  Sat Mar 30 21:01:40 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 31 Mar 2013 01:01:40 +0400
Subject: [rabbitmq-discuss] node-amqp ???
In-Reply-To: <1364671398331-25801.post@n5.nabble.com>
References: <1364671398331-25801.post@n5.nabble.com>
Message-ID: <CAE3HoVTptgHHBgEm=dHPLq-xH0RFhcRt9n0rTzoyfXbM6ECjiw@mail.gmail.com>

2013/3/30 Atlanta44 <atlanta444484 at yahoo.com>

> What exactly is node-amqp


It's a node.js RabbitMQ client. It is of no use to Java programs.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130331/d451b990/attachment.htm>

From atlanta444484 at yahoo.com  Sat Mar 30 22:07:46 2013
From: atlanta444484 at yahoo.com (Atlanta44)
Date: Sat, 30 Mar 2013 15:07:46 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ and AMQP
Message-ID: <1364681266322-25806.post@n5.nabble.com>

I was reading the documentation that said AMQP is not only an API
specification, but also a wire specification.

Does that mean ActiveMQ (using AMQP) can talk to RabbitMQ  Any links to docs
on how this might work?

Thanks



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-and-AMQP-tp25806.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Sun Mar 31 08:08:35 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 31 Mar 2013 11:08:35 +0400
Subject: [rabbitmq-discuss] RabbitMQ and AMQP
In-Reply-To: <1364681266322-25806.post@n5.nabble.com>
References: <1364681266322-25806.post@n5.nabble.com>
Message-ID: <CAE3HoVRSwDOQ1E_5TJRmaEUN3GEZLK7mQs3uRuAptL81YNEZbA@mail.gmail.com>

2013/3/31 Atlanta44 <atlanta444484 at yahoo.com>

> Does that mean ActiveMQ (using AMQP) can talk to RabbitMQ  Any links to
> docs
> on how this might work?
>

RabbitMQ currently implements AMQP 0.9.1. AMQP 1.0 is a completely
different protocol,
so RabbitMQ cannot interoperate with those implementations.

There is an experimental plugin that adds AMQP 1.0 support to RabbitMQ.
AFAIK
it is not complete yet.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130331/b2c1f665/attachment.htm>

From tim at rabbitmq.com  Sun Mar 31 13:48:32 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Sun, 31 Mar 2013 13:48:32 +0100
Subject: [rabbitmq-discuss] Problem with multiple consumers on multiple
	servers !
In-Reply-To: <1364653711470-25800.post@n5.nabble.com>
References: <1364583437418-25790.post@n5.nabble.com>
	<3CBCB0F9-112C-4CC3-BB5B-5D1B4C753AFD@rabbitmq.com>
	<1364653711470-25800.post@n5.nabble.com>
Message-ID: <E545C841-72CF-48AC-A49D-C7283282066B@rabbitmq.com>

Hi,

On 30 Mar 2013, at 14:28, tluck wrote:
> Thanks for your quick answer. Don't you think that if I increase prefetch
> count then it may cause redundancy of  the same messages to more then one
> consumer ? I mean the same message/job can be consumed by two or more
> consumers at a time (I read it somewhere and may be I'm wrong).

That's not correct. A dequeued message will be delivered to exactly one consumer. 

> Suppose, if
> I increase prefetch count to 10 then broker won't send messages to any of
> the consumers (which are consuming messages from current queue)  until  all
> 10 messages are consumed ? right ?

I'm not quite sure what you're asking. RabbitMQ dispatches messages once they
enter the queue. It doesn't look at the number of unacknowledged messages for a
consumer, but simply dispatches every n-th message to the n-th consumer. If the
prefetch count is 1, then 1 message will be delivered to the consumer and any 
subsequent messages will be dispatched to the next consumer, and so on.
Only once a consumer starts to send acknowledgements for some (or all) delivered
messages will it become eligible to receive more.

So if you set the prefetch count to 10, you'll be able to receive a maximum of 10
messages per consumer before the broker stops delivering to that consumer until some
acks are received.

If the number of messages in the queue is the same as the prefetch count
of all consumers then one consumer will get all the messages in the
queue (until more messages arrive in the queue). This means that other
consumers will be idle.

> If yes, then how can we tackle the
> problem which can be caused by all this. If one/two consumer(s) take too
> long time to consume their messages then others will go idle (as they have
> to wait others to finish their job).

>> Can anyone please help me to find out, why only one job is being consumed at a time ?

These two points are orthogonal, but really I think the problem boils down to these
comments you made previously:

"Now I've setup multiple consumers and each consumer is listening to a single
queue"

... and ...

"The problem which I've
noticed is that only one message/job from each queue is being consumed at a
time.

So I'm not quite sure what you're trying to achieve here. If you have one consumer
on each queue, then this next comment:

"The problem which I've noticed is that only one message/job from each queue is
being consumed at a time."

That's how a queue works right, it's giving you FIFO semantics. I'm not really sure
what else you're expecting to happen.

> 
> If I have 20K messages and 10 consumers on a single queue then what would be
> an ideal count for prefetch_count ?
> 

It really depends on what you want to do. The prefetch count can be used either as
an optimisation (to make sure that you've received some messages locally that you
can work on as soon as you're ready) or to create a kind of fair dispatch (based on
preventing workers from having messages dispatched to them until they've acknowledged
the previous one(s) already).

Having 10 consumers on a single queue then they'll receive messages in round robin
fashion (unless you use the prefetch count to override that). If you don't bother
with the prefetch count then the broker will continue sending messages (regardless of
acks) to the consumers in this fashion and once it gets an ACK for each message it
will remove it (fully) from the queue.

"The problem which I've noticed is that only one message/job from each queue is being
consumed at a time" - what does this even mean? Are you saying you want each consumer
on a single queue to consume more than one message before messages get delivered to the
next? That's what prefetch count > 1 will do for you and is why I suggested it... Once
n messages (where n=prefetchCount) have been delivered to a consumer, messages will start
getting delivered to other consumers until the original consumer starts sending acks (or
a single ACK using the multiple flag) at which point it will be included in the round
robin dispatch again.

Are you saying you want something else to happen? 

Tim


From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.3.1364902152.3387.rabbitmq-discuss@lists.rabbitmq.com>

broker to run in the same Erlang VM. If that is the case then don't
start another VM for the client. If you want multiple Erlang VMs on the
same host then make sure you don't start full brokers with clashing node
names and listening ports on more than one of them.

Here is a sample transcript that demonstrates what you probably want:

$ rabbitmq-plugins enable amqp_client
The following plugins have been enabled:
  amqp_client

Plugin configuration has changed. Restart RabbitMQ for changes to take
effect.

(restart broker and connect an Erlang shell)

> rr(amqp_connection).
['P_access','P_basic','P_channel','P_confirm',
 'P_connection','P_dtx','P_exchange','P_file','P_queue',
 'P_stream','P_test','P_tunnel','P_tx','access.request',
 'access.request_ok',adapter_info,amqp_error,amqp_msg,
 amqp_params_direct,amqp_params_network,amqqueue,'basic.ack',
 'basic.cancel','basic.cancel_ok','basic.consume',
 'basic.consume_ok','basic.deliver','basic.get',
 'basic.get_empty'|...]

>{ok, Connection} = amqp_connection:start(#amqp_params_direct{}).
{ok,<0.227.0>}







-Emile













From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.4.1365400402.3387.rabbitmq-discuss@lists.rabbitmq.com>

track of when the last time you received data, if this timer expires you
know that your connection to the broker is dead and you need to close the
socket. A second timer is needed to keep track of the last time you sent
data, when this timer expires a heartbeat frame needs to be sent.

The current design of rabbitmq-c single-threaded event-driven, meaning the
library itself doesn't do anything when you're not calling into the
library, and has no thread behind the scenes dealing with these timers. So
lets say you received a message, then spent more than 2 * heartbeat
interval processing the message without calling into rabbitmq-c, the
connection would be closed by the broker.

Using the current single-threaded event-driven model of the library I have
not been able to come up with a good way to implement heartbeating that is
totally internal to the library (it also needs to be cross platform and not
rely on a non-sharable global resource like setitimer()/SIGALARM).

The best way to fully implement heartbeats in rabbitmq-c is to add a thread
behind the scenes that deals with these timers, a second alternative that
could be provided by those who don't want the overhead of a separate
behind-the-scenes thread would be to provide functions that could be
plugged into an event loop.

HTH
-Alan


On Fri, Apr 5, 2013 at 11:48 AM, Moebius <cmorris at voicerite.com> wrote:

> I am new to all this, but wanted to ask a couple of questions.  If the
> library sees a heartbeat come in, why can't it just send one back in
> response?  Why would there have to be a message queue involved?
>
>
> Alan Antonuk wrote
> > While I cannot comment on what Dawn ended up doing, I can say a few words
> > about the rabbitmq-c library.
> >
> > Currently the rabbitmq-c only has partial support for AMQP heartbeats:
> the
> > library understands AMQP hearbeats at a protocol level, the library
> > provides an interface for sending and receiving frames that allows
> > heartbeat frames to be sent, however the library does not have an event
> > loop that will automatically handle heartbeats for you.
> >
> > To use heartbeats with rabbitmq-c you would need to provide your own
> event
> > loop/logic to send and receive heartbeat frames.
> >
> > HTH
> > -Alan
>
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Is-heartbeat-option-working-in-C-client-tp23785p25909.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

--f46d044794f372ca6904d9d30cd4
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Because thats not quite how AMQP heartbeats work (I&#39;m =
sorry if some code I posted earlier lead you astray). Heartbeats in AMQP wo=
rk by having each peer (the broker, and the client) have a timer for receiv=
ing something from the other host (something could be useful communication =
like message delivery or publishing, or in the case that a peer has nothing=
 useful to send, it can send a heartbeat). If the timer reaches 0 at either=
 end, that peer is supposed to close the socket immediately.<div>
<br></div><div>From an implementation point of view you need to have 2 time=
rs: one to keep track of when the last time you received data, if this time=
r expires you know that your connection to the broker is dead and you need =
to close the socket. A second timer is needed to keep track of the last tim=
e you sent data, when this timer expires a heartbeat frame needs to be sent=
.</div>
<div><br></div><div>The current design of rabbitmq-c single-threaded event-=
driven, meaning the library itself doesn&#39;t do anything when you&#39;re =
not calling into the library, and has no thread behind the scenes dealing w=
ith these timers. So lets say you received a message, then spent more than =
2 * heartbeat interval processing the message without calling into rabbitmq=
-c, the connection would be closed by the broker.</div>
<div><br></div><div style>Using the current single-threaded event-driven mo=
del of the library I have not been able to come up with a good way to imple=
ment heartbeating that is totally internal to the library (it also needs to=
 be cross platform and not rely on a non-sharable global resource like seti=
timer()/SIGALARM). </div>
<div style><br></div><div style>The best way to fully implement heartbeats =
in rabbitmq-c is to add a thread behind the scenes that deals with these ti=
mers, a second alternative that could be provided by those who don&#39;t wa=
nt the overhead of a separate behind-the-scenes thread would be to provide =
functions that could be plugged into an event loop.</div>
<div style><br></div><div style>HTH</div><div style>-Alan</div></div><div c=
lass=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Fri, Apr 5, 2013=
 at 11:48 AM, Moebius <span dir=3D"ltr">&lt;<a href=3D"mailto:cmorris at voice=
rite.com" target=3D"_blank">cmorris at voicerite.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">I am new to all this, but wanted to ask a co=
uple of questions. =A0If the<br>
library sees a heartbeat come in, why can&#39;t it just send one back in<br=
>
response? =A0Why would there have to be a message queue involved?<br>
<br>
<br>
Alan Antonuk wrote<br>
<div class=3D"im">&gt; While I cannot comment on what Dawn ended up doing, =
I can say a few words<br>
&gt; about the rabbitmq-c library.<br>
&gt;<br>
&gt; Currently the rabbitmq-c only has partial support for AMQP heartbeats:=
 the<br>
&gt; library understands AMQP hearbeats at a protocol level, the library<br=
>
&gt; provides an interface for sending and receiving frames that allows<br>
&gt; heartbeat frames to be sent, however the library does not have an even=
t<br>
&gt; loop that will automatically handle heartbeats for you.<br>
&gt;<br>
&gt; To use heartbeats with rabbitmq-c you would need to provide your own e=
vent<br>
&gt; loop/logic to send and receive heartbeat frames.<br>
&gt;<br>
&gt; HTH<br>
&gt; -Alan<br>
<br>
<br>
<br>
<br>
<br>
</div>--<br>
View this message in context: <a href=3D"http://rabbitmq.1065348.n5.nabble.=
com/Is-heartbeat-option-working-in-C-client-tp23785p25909.html" target=3D"_=
blank">http://rabbitmq.1065348.n5.nabble.com/Is-heartbeat-option-working-in=
-C-client-tp23785p25909.html</a><br>

Sent from the RabbitMQ mailing list archive at Nabble.com.<br>
<div class=3D"HOEnZb"><div class=3D"h5">___________________________________=
____________<br>
rabbitmq-discuss mailing list<br>
<a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss at lis=
ts.rabbitmq.com</a><br>
<a href=3D"https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-dis=
cuss" target=3D"_blank">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo=
/rabbitmq-discuss</a><br>
</div></div></blockquote></div><br></div>

--f46d044794f372ca6904d9d30cd4--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.5.1367440297.3387.rabbitmq-discuss@lists.rabbitmq.com>

In order to get the service approach to work correctly, I modified rabbitmq-server in /etc/init.d as follows:
[root at cluster1 init.d]# diff rabbitmq-server.20130501 rabbitmq-server
63c63
<         RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON \
---
>         RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON -detached \
[root at cluster1 init.d]#

I changed it there because DAEMON appears to be the rabbitmq-server

[root at cluster1 init.d]# grep DAEMON rabbitmq-server
DAEMON=/usr/sbin/${NAME}
test -x $DAEMON || exit 0
        RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON -detached \
[root at cluster1 init.d]#

When I performed service rabbitmq-server start

It just hung and never came back with a prompt.

However in another window I confirmed the rabbitmq-server was running

I then killed the service console window and looked at the startup_err file:
[root at cluster1 init.d]# more /var/log/rabbitmq/startup_err
Warning: PID file not written; -detached was passed.

and then i had to separately kill the process(s) associated with rabbitmq.

so my questions are thus:
   1) the documentation states this is how to normally start the server.  Is that normally for all modes or just for a clustered node approach?
   2) What can I do to keep the command from hanging if started as a service?  
       


>  -------Original Message-------
>  From: Gerald Kuch <jkuch at gopivotal.com>
>  To: srd <srd at duneram.com>, Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>  Subject: Re: [rabbitmq-discuss] another question on cookies version 3.0.4
>  Sent: 01 May '13 19:52
>  
>  Ooops, my fingers auto-completed the "/etc/init.d" on the end of the
>  sentence. ?Forget about that part.
>  
>  
>  On Wed, May 1, 2013 at 12:51 PM, Gerald Kuch <[LINK:
>  mailto:jkuch at gopivotal.com] jkuch at gopivotal.com> wrote:
>  
>  Depends how you started it: ?Either /sbin/service/rabbitmq-server stop or
>  /etc/init.d/.
>  
>  
>  Of course 'kill' will stop it, but the cleanliness of doing the
>  former is preferable in non-emergency circumstances.
>  
>  
>  On Wed, May 1, 2013 at 6:26 AM, srd <[LINK: mailto:srd at duneram.com]
>  srd at duneram.com> wrote:
>  Thank you for your help. ?I will give this a try.
>  
>  I've been starting it wrong all this time.
>  
>  what is the best way to stop the server? ?up until now I have found no
>  good way to stop it except
>  
>  ps -efwww | grep rabbit
>  and then with that kill off the 4-6 associated jobs.
>  
>  Dave
>  
>  
>  > ?-------Original Message-------
>  > ?From: Tim Watson <[LINK: mailto:tim at rabbitmq.com] tim at rabbitmq.com>
>  > ?To: srd <[LINK: mailto:srd at duneram.com] srd at duneram.com>, Discussions
>  about RabbitMQ <[LINK: mailto:rabbitmq-discuss at lists.rabbitmq.com]
>  rabbitmq-discuss at lists.rabbitmq.com>
>  > ?Subject: Re: [rabbitmq-discuss] another question on cookies version
>  3.0.4
>  > ?Sent: 01 May '13 13:21
>  >
>  > ?Hi,
>  >
>  > ?On 1 May 2013, at 14:15, srd wrote:
>  >
>  > ?> so my questions are:
>  > ?> 1) How does one normally start the server?
>  >
>  > ?Depending on the platform, either /sbin/service rabbitmq-server start
>  or via /etc/init.d/.
>  >
>  > ?> 2) my reason for wanting to do cookies is I wanted to setup a multi
>  node cluster (different servers)
>  > ?>????If I start a server (no parameters) on each server the cookie
>  hash is different.
>  >
>  > ?You need to ensure that all the cookies are the same. You can do this
>  by placing the .erlang.cookie file in the /home/rabbitmq directory on each
>  server.
>  >
>  > ?> 3) I have looked at the clustering guide but haven't succeeded
>  in a setup using it.??How does one normally synchronize the cookies
>  across servers?
>  >
>  > ?That's up to you - rabbit doesn't provide anything out of the
>  box to do this.
>  >
>  > ?> 4) where is the cookie file stored??? I found one on the rabbitmq
>  user's root directory.?? Is that where it is stored?
>  >
>  > ?That's correct.
>  >
>  > ?> 5) If I have to set a cookie value, is there a config file where it
>  can be set (or env variable?) and what is the syntax to set it?
>  > ?>
>  >
>  > ?I would recommend just using the cookie stored in the rabbitmq
>  user's home directory.
>  >
>  > ?Cheers,
>  > ?Tim
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  [LINK: mailto:rabbitmq-discuss at lists.rabbitmq.com]
>  rabbitmq-discuss at lists.rabbitmq.com
>  [LINK:
>  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss]
>  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.6.1367460509.3387.rabbitmq-discuss@lists.rabbitmq.com>

The minute you join one node to another to form a cluster something
dramatically changes: not every node has a full copy of every queue.
In a single node setup all of the information about a queue (metadata,
state, and contents) is fully stored in that node (Figure 5.1).
However, in a cluster when you create queues, the cluster only creates
the full information about the queue (metadata, state, contents) on a
single node in the cluster rather than on all of them (the cluster
tries to evenly distribute queue creation amongst the nodes). The
result is that only the =E2=80=9Cowner=E2=80=9D node for a queue knows the =
full
information about that queue. All of the =E2=80=9Cnon-owner=E2=80=9D nodes =
only know
the queue=E2=80=99s metadata and a pointer to the node where the queue
actually lives. So when a cluster node dies that node=E2=80=99s queues and
associated bindings disappear. Consumers attached to those queues lose
their subscriptions, and any new messages that would have matched that
queue=E2=80=99s bindings become blackholed.


Does this mean, when a client create a queue in the cluster, this
queue is created on a random(?) node of the cluster, not the connected
node  for the client?

Thanks.

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.7.1367473510.3387.rabbitmq-discuss@lists.rabbitmq.com>

<br>
The minute you join one node to another to form a cluster something<br>
dramatically changes: not every node has a full copy of every queue.<br>
In a single node setup all of the information about a queue (metadata,<br>
state, and contents) is fully stored in that node (Figure 5.1).<br>
However, in a cluster when you create queues, the cluster only creates<br>
the full information about the queue (metadata, state, contents) on a<br>
single node in the cluster rather than on all of them (the cluster<br>
tries to evenly distribute queue creation amongst the nodes). The<br>
result is that only the =93owner=94 node for a queue knows the full<br>
information about that queue. All of the =93non-owner=94 nodes only know<br=
>
the queue=92s metadata and a pointer to the node where the queue<br>
actually lives. So when a cluster node dies that node=92s queues and<br>
associated bindings disappear. Consumers attached to those queues lose<br>
their subscriptions, and any new messages that would have matched that<br>
queue=92s bindings become blackholed.<br>
<br>
<br>
Does this mean, when a client create a queue in the cluster, this<br>
queue is created on a random(?) node of the cluster, not the connected<br>
node =A0for the client?<br>
<br>
Thanks.<br>
_______________________________________________<br>
rabbitmq-discuss mailing list<br>
<a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss at lis=
ts.rabbitmq.com</a><br>
<a href=3D"https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-dis=
cuss" target=3D"_blank">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo=
/rabbitmq-discuss</a><br>
</blockquote></div><br></div>

--001a11c23448b5203104dbb5bb29--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.8.1367499599.3387.rabbitmq-discuss@lists.rabbitmq.com>

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin

--047d7b6d9e22baf41004dbbbced8
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div class=3D"gmail_extra">2013/5/2 Simon MacMullen <span =
dir=3D"ltr">&lt;<a href=3D"mailto:simon at rabbitmq.com" target=3D"_blank">sim=
on at rabbitmq.com</a>&gt;</span><br><div class=3D"gmail_quote"><blockquote cl=
ass=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;p=
adding-left:1ex">

Again, this is a common case for some users.</blockquote></div><br>From my =
experience most apps have queues roughly empty most of the time.<br>-- <br>=
MK<br><br><a href=3D"http://github.com/michaelklishin" target=3D"_blank">ht=
tp://github.com/michaelklishin</a><br>

<a href=3D"http://twitter.com/michaelklishin" target=3D"_blank">http://twit=
ter.com/michaelklishin</a><br>
</div></div>

--047d7b6d9e22baf41004dbbbced8--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.9.1367904979.3387.rabbitmq-discuss@lists.rabbitmq.com>

However, from the outside (monitoring) point of view, what matters is
the space currently used wrt the space supposed to be used.

 > If you want to set an upper bound on the disk space rabbit is
 > using, I suggest you configure a separate partition for it.

This is technically possible but rather painful, for instance when you
want to resize partitions.

Thanks for your answer.

Lionel

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.10.1370255345.3387.rabbitmq-discuss@lists.rabbitmq.com>

running, though you seem to be unable to contact it. Check if the
connection attempts show up in the broker logfile - perhaps you are not
using the correct cookie file.

> sudo rabbitmqctl stop
> 
> And it show: Error: unable to connect to node rabbit@ mydomain: nodedown

If that doesn't work and you can't establish contact with the broker
using the normal admin channel then killing the Erlang process is the
simplest way to proceed. Check for "beam" or "beam.smp" processes
associated with RabbitMQ and send a kill signal.



-Emile












From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.11.1370558778.3387.rabbitmq-discuss@lists.rabbitmq.com>

1370554962786: <Tracer-0> ch#1 <- {#method<channel.close>(reply-code=3D404,
reply-text=3DNOT_FOUND - no exchange 'foo' in vhost '/', class-id=3D60,
method-id=3D40), null, ""}
1370554962788: <Tracer-0> ch#1 -> {#method<channel.close-ok>(), null, ""}
1370554974891: <Tracer-0> ch#1 -> {#method<channel.open>(out-of-band=3D),
null, ""}
1370554974970: <Tracer-0> ch#1 <- {#method<channel.open-ok>(channel-id=3D),
null, ""}

Any ideas why things are hanging?

Thanks
- jonathan

--089e0102e0dccb73e204de840768
Content-Type: text/html; charset=windows-1252
Content-Transfer-Encoding: quoted-printable

<div>I hit on a scenario where connection.createChannel() may hang forever.=
 The scenario: obtain a channel and attempt to publish to a non-existent ex=
change. The channel will be shutdown. Attempt to establish a new (replaceme=
nt) channel via Connection.createChannel(), which hangs forever. A simple v=
ersion of this scenario:</div>
<div><br></div><div>public Channel channelFor(final String tenantId) throws=
 Exception {</div><div>=A0 Channel channel =3D connection.createChannel();<=
/div><div>=A0 channel.addShutdownListener(new ShutdownListener() {</div><di=
v>
=A0 =A0 public void shutdownCompleted(ShutdownSignalException e) {</div><di=
v>=A0 =A0 =A0 if (!e.isInitiatedByApplication())=A0</div><div>=A0 =A0 =A0 =
=A0 channelFor(tenantId);</div><div>=A0 =A0 }</div><div>=A0 });</div><div><=
br></div><div>=A0 return channel;</div>
<div>}</div><div><br></div><div>Channel channel =3D channelFor(&quot;foo&qu=
ot;);</div><div>channel.basicPublish(someNonExistentExchange, =85</div><div=
><br></div><div>From Tracer:</div><div><br></div><div>1370554962786: &lt;Tr=
acer-0&gt; ch#1 &lt;- {#method&lt;channel.close&gt;(reply-code=3D404, reply=
-text=3DNOT_FOUND - no exchange &#39;foo&#39; in vhost &#39;/&#39;, class-i=
d=3D60, method-id=3D40), null, &quot;&quot;}</div>
<div>1370554962788: &lt;Tracer-0&gt; ch#1 -&gt; {#method&lt;channel.close-o=
k&gt;(), null, &quot;&quot;}</div><div>1370554974891: &lt;Tracer-0&gt; ch#1=
 -&gt; {#method&lt;channel.open&gt;(out-of-band=3D), null, &quot;&quot;}</d=
iv>
<div>1370554974970: &lt;Tracer-0&gt; ch#1 &lt;- {#method&lt;channel.open-ok=
&gt;(channel-id=3D), null, &quot;&quot;}</div><div><br></div><div>Any ideas=
 why things are hanging?</div><div><br></div><div>Thanks=A0</div><div>- jon=
athan</div>

--089e0102e0dccb73e204de840768--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.12.1370616800.3387.rabbitmq-discuss@lists.rabbitmq.com>

messages and physically save them to disk for each of the consumers to read 
(1 queue/consumer, 1msg copy/queue). The reason I expected that is because 
if messages are ack'ed by consumers 1 and 2, I expected their queue to be 
free of their messages while consumer 3 would still need them to be 
persisted until it has read them. That was possible a false assumption I 
should have verified with you guys. It would indeed be more optimal to 
store a single copy of the messages and only keep the metadata. *Is this 
correct?*

Also, during a test where I continuously sent (a lot) of messages while my 
big consumer 3 was offline. The observation I made then is that *obviously:*
- data was accumulating on disk
- memory usage on all nodes went up. to the point where it eventually 
choked the brokers

I assumed then that the increasing memory usage was because the queue and 
msg metadata was increasing in Mnesia. This was a decisive factor to me 
because I didn't want to be in a situation where my realtime consumers 
would be affected by a slow moving elephant. Is there way I could have 
avoided that situation I didn't see?

Thanks!




------=_Part_176_25682693.1370614353885
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

Hi guys,<div><br></div><div>following a discussion on the kafka user mailin=
g list in which Alexis Richardson replied, I realized I might have been wro=
ng about what I assumed for the messages storage in RabbitMQ. It won't chan=
ge the decision I made to use Kafka but I'd like to set my own mind right i=
n my conception of how RabbitMQ stores messages. I want to use Rabbit in ot=
her projects as well so I want to have the right picture in my mind.</div><=
div><br></div><div>The setup I used was based on what is described in&nbsp;=
<a href=3D"http://www.rabbitmq.com/tutorials/tutorial-four-python.html">htt=
p://www.rabbitmq.com/tutorials/tutorial-four-python.html</a>.&nbsp;</div><d=
iv><br></div><div>RabbitMQ</div><div>- RabbitMQ 3.0.x (not exactly sure wha=
t x was)</div><div>- 5 brokers (behind HA proxy)</div><div>- Messages poste=
d to multiple topics (called it A, B, C) where the topic is used as the rou=
ting key by the exchange<br></div><div>- Queues and messages are persistent=
 (+ replicated)</div><div><br></div><div>Consumers</div><div>- Consumer 1 s=
ubscribes to Topic A (near real-time) - Queue 1</div><div>- Consumer 2 subs=
cribes to Topic B&nbsp;(near real-time)&nbsp;&nbsp;- Queue 2</div><div>- Co=
nsumer 3 subscribes to A, B and C (offline, BI)&nbsp;- Queue 3</div><div><b=
r></div><div>Published 10M messages (size varying between 500b to 2k)<br></=
div><div><br></div><div>From what I (believe I) saw and read, I really expe=
cted Rabbit to route messages and physically save them to disk for each of =
the consumers to read (1 queue/consumer, 1msg copy/queue). The reason I exp=
ected that is because if messages are ack'ed by consumers 1 and 2, I expect=
ed their queue to be free of their messages while consumer 3 would still ne=
ed them to be persisted until it has read them. That was possible a false a=
ssumption I should have verified with you guys. It would indeed be more opt=
imal to store a single copy of the messages and only keep the metadata. <b>=
Is this correct?</b></div><div><br></div><div>Also, during a test where I c=
ontinuously sent (a lot) of messages while my big consumer 3 was offline. T=
he observation I made then is that <u>obviously:</u></div><div>- data was a=
ccumulating on disk</div><div>- memory usage on all nodes went up. to the p=
oint where it eventually choked the brokers</div><div><br></div><div>I assu=
med then that the increasing memory usage was because the queue and msg met=
adata was increasing in Mnesia. This was a decisive factor to me because I =
didn't want to be in a situation where my realtime consumers would be affec=
ted by a slow moving elephant. Is there way I could have avoided that situa=
tion I didn't see?</div><div><br></div><div>Thanks!</div><div><br></div><di=
v><br></div><div><br></div>
------=_Part_176_25682693.1370614353885--

------=_Part_175_26893787.1370614353885--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.13.1370986153.3387.rabbitmq-discuss@lists.rabbitmq.com>

gml at ip-10-202-102-31:~$ sudo rabbitmqctl stop_app
Stopping node 'rabbit at ip-10-202-102-31' ...
...done.
gml at ip-10-202-102-31:~$ sudo rabbitmqctl join_cluster rabbit at rabbit1
Clustering node 'rabbit at ip-10-202-102-31' with rabbit at rabbit1 ...
Error: {cannot_discover_cluster,"The nodes provided are either offline or 
not running"}

When I telnet to rabbit1:5672 there is an entry in rabbit1s log files, but 
when I join_cluster, nothing shows up.

Any suggestions?


------=_Part_3418_29434029.1370976605553
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

I'm trying to set up clustering on AWS EC2 but I'm running into problems ju=
st getting the basic setup.<div><br></div><div>Setup:</div><div>-I have the=
 appropriate ports open, and I can connect to them via. telnet</div><div>-I=
 scp'd my erlang.cookie from one machine to the other, set owner to rabbitm=
q:rabbitmq and permissions to 0600</div><div>-rabbit1 and rabbit2 entry in =
both machines hosts file</div><div><br></div><div>When I try to do the basi=
c join_cluster, I can't get a connection no matter what I try.</div><div><b=
r></div><div>From rabbit2:</div><div><br></div><div><div>gml at ip-10-202-102-=
31:~$ sudo rabbitmqctl stop_app</div><div>Stopping node 'rabbit at ip-10-202-1=
02-31' ...</div><div>...done.</div><div>gml at ip-10-202-102-31:~$ sudo rabbit=
mqctl join_cluster rabbit at rabbit1</div><div>Clustering node 'rabbit at ip-10-2=
02-102-31' with rabbit at rabbit1 ...</div><div>Error: {cannot_discover_cluste=
r,"The nodes provided are either offline or not running"}</div></div><div><=
br></div><div>When I telnet to rabbit1:5672 there is an entry in rabbit1s l=
og files, but when I join_cluster, nothing shows up.</div><div><br></div><d=
iv>Any suggestions?</div><div><br></div>
------=_Part_3418_29434029.1370976605553--

------=_Part_3417_31048634.1370976605553--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.14.1370986156.3387.rabbitmq-discuss@lists.rabbitmq.com>

running that delegate all of their work to one or more worker dynos. The 
REST server dynos must be stateless. 

I have two basic patterns to support.


   1. REST RPC. Basically, the client makes a call like GET /user/{id}. I 
   delegate this call to a worker dyno that does a database lookup in the USER 
   table for the specified ID and returns it. The REST interface then returns 
   this. This to me seems like basic RPC. 
   2. REST ASYNC. In this model the client may call my REST server with a 
   POST or a GET. Let's use the classic case of a long running task to format 
   a graphic. I will create a JOB ID, return it to the client in an URI. The 
   client calls the URI to poll the job until it is done and then eventually 
   gets redirected to a URI that has the result. In this case, when I get the 
   initial REST call I will generate a UID for it, submit it to the worker. 
   There are several ways I can do the polling and returning of the result. A 
   lot of that depends on how I decide to interact with the worker.  Is it 
   RPC? AKKA? AMQP?  Because there may be more than one REST service dyno, the 
   request to post the job may happen on one REST server and the polling 
   request may be routed to another. So it must be stateless.


So here's my question. First, should I be using RabbitMQ for this or is 
there a better solution? If I am using RabbitMQ must I implement the RPC 
and ASYNC patterns myself directly on top of RabbitMQ or are there 
libraries out there that create a layer of abstraction on top of RabbitMQ 
so I can do both of these simply? If I'm going to use RabbitMQ I'm hoping 
to use CloudAMQP on Heroku.

Thanks!

Robert

------=_Part_1973_10294539.1370977579935
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

I am writing a REST server in Java and am trying to come up with the best a=
pproach for scalability. The server is deployed on Heroku. I am new to Rabb=
itMQ/AMQ so I need some advice.<div><br></div><div>From an architectural po=
int of view I want to have one or more REST dynos running that delegate all=
 of their work to one or more worker dynos. The REST server dynos must be s=
tateless.&nbsp;</div><div><br></div><div>I have two basic patterns to suppo=
rt.</div><div><br></div><div><ol><li><span style=3D"line-height: normal;">R=
EST RPC. Basically, the client makes a call like GET /user/{id}. I delegate=
 this call to a worker dyno that does a database lookup in the USER table f=
or the specified ID and returns it. The REST interface then returns this. T=
his to me seems like basic RPC.&nbsp;</span></li><li><span style=3D"line-he=
ight: normal;">REST ASYNC. In this model the client may call my REST server=
 with a POST or a GET. Let's use the classic case of a long running task to=
 format a graphic. I will create a JOB ID, return it to the client in an UR=
I. The client calls the URI to poll the job until it is done and then event=
ually gets redirected to a URI that has the result. In this case, when I ge=
t the initial REST call I will generate a UID for it, submit it to the work=
er. There are several ways I can do the polling and returning of the result=
. A lot of that depends on how I decide to interact with the worker. &nbsp;=
Is it RPC? AKKA? AMQP? &nbsp;Because there may be more than one REST servic=
e dyno, the request to post the job may happen on one REST server and the p=
olling request may be routed to another. So it must be stateless.</span></l=
i></ol><div><br>So here's my question. First, should I be using RabbitMQ fo=
r this or is there a better solution? If I am using RabbitMQ must I impleme=
nt the RPC and ASYNC patterns myself directly on top of RabbitMQ or are the=
re libraries out there that create a layer of abstraction on top of RabbitM=
Q so I can do both of these simply? If I'm going to use RabbitMQ I'm hoping=
 to use CloudAMQP on Heroku.</div></div><div><br></div><div>Thanks!</div><d=
iv><br></div><div>Robert</div>
------=_Part_1973_10294539.1370977579935--

------=_Part_1972_32952114.1370977579935--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.15.1371305849.3387.rabbitmq-discuss@lists.rabbitmq.com>

=INFO REPORT==== 14-Jun-2013::11:18:01 ===
Error description:
   {error,
       {cannot_read_enabled_plugins_file,
          
 "C:/Users/john.z/AppData/Roaming/RabbitMQ/enabled_plugins",eisdir}}

Log files (may contain more information):
   C:/Users/john.z/AppData/Roaming/RabbitMQ/log/rabbit at DEVLAP3.log
   C:/Users/john.z/AppData/Roaming/RabbitMQ/log/rabbit at DEVLAP3-sasl.log

Stack trace:
   [{rabbit_plugins,read_enabled,1,[]},
    {rabbit_plugins,prepare_plugins,3,[]},
    {rabbit,'-boot/0-fun-1-',0,[]},
    {rabbit,start_it,1,[]},
    {init,start_it,1,[{file,"init.erl"},{line,1054}]},
    {init,start_em,1,[{file,"init.erl"},{line,1034}]}]


My enable_plugins folder is empty and there is nothing there to load which 
I believe is the reason. I have uninstalled and re-installed the 
application but I am getting the same problem. I don't know what to do 
about this so I am asking for some assistance in getting this to start up. 
We are attempting to utilize this tool to push messages across a couple 
different servers of ours and I am trying to set this up for testing, but 
unable to get anywhere and having a have time winding anything. 

I am using Win 7 64bit. 

Thanks in advance! 

------=_Part_431_15825803.1371227600411
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

I cannot enable the management plug ins. which lead me down this rabbit hol=
e to discover that the service crashes upon booting up.&nbsp;<div>From what=
 I can tell this is the cause... &nbsp;</div><div><br></div><div><div>=3DIN=
FO REPORT=3D=3D=3D=3D 14-Jun-2013::11:18:01 =3D=3D=3D</div><div>Error descr=
iption:</div><div>&nbsp; &nbsp;{error,</div><div>&nbsp; &nbsp; &nbsp; &nbsp=
;{cannot_read_enabled_plugins_file,</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &=
nbsp; &nbsp;"C:/Users/john.z/AppData/Roaming/RabbitMQ/enabled_plugins",eisd=
ir}}</div><div><br></div><div>Log files (may contain more information):</di=
v><div>&nbsp; &nbsp;C:/Users/john.z/AppData/Roaming/RabbitMQ/log/rabbit at DEV=
LAP3.log</div><div>&nbsp; &nbsp;C:/Users/john.z/AppData/Roaming/RabbitMQ/lo=
g/rabbit at DEVLAP3-sasl.log</div><div><br></div><div>Stack trace:</div><div>&=
nbsp; &nbsp;[{rabbit_plugins,read_enabled,1,[]},</div><div>&nbsp; &nbsp; {r=
abbit_plugins,prepare_plugins,3,[]},</div><div>&nbsp; &nbsp; {rabbit,'-boot=
/0-fun-1-',0,[]},</div><div>&nbsp; &nbsp; {rabbit,start_it,1,[]},</div><div=
>&nbsp; &nbsp; {init,start_it,1,[{file,"init.erl"},{line,1054}]},</div><div=
>&nbsp; &nbsp; {init,start_em,1,[{file,"init.erl"},{line,1034}]}]</div></di=
v><div><br></div><div id=3D""><br></div><div id=3D"">My enable_plugins fold=
er is empty and there is nothing there to load which I believe is the reaso=
n. I have uninstalled and re-installed the application but I am getting the=
 same problem. I don't know what to do about this so I am asking for some a=
ssistance in getting this to start up. We are attempting to utilize this to=
ol to push messages across a couple different servers of ours and I am tryi=
ng to set this up for testing, but unable to get anywhere and having a have=
 time winding anything.&nbsp;</div><div id=3D""><br></div><div id=3D"aeaoof=
nhgocdbnbeljkmbjdmhbcokfdb-mousedown">I am using Win 7 64bit.&nbsp;</div><d=
iv id=3D"aeaoofnhgocdbnbeljkmbjdmhbcokfdb-mousedown"><br></div><div id=3D"a=
eaoofnhgocdbnbeljkmbjdmhbcokfdb-mousedown">Thanks in advance!&nbsp;</div>
------=_Part_431_15825803.1371227600411--

------=_Part_430_33074227.1371227600411--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.16.1372225401.3387.rabbitmq-discuss@lists.rabbitmq.com>

behavior under stress condition when a slave goes down. I presume this weird
behavior will only surface under stress condition.

Is there a rough estimate for the maximum load that a RabbitMQ server can
take per second for mirroring? Thanks. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-s-Mirroring-results-in-weird-behavior-when-slave-goes-down-tp27572p27611.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.17.1372926057.3387.rabbitmq-discuss@lists.rabbitmq.com>

=ERROR REPORT==== 3-Jul-2013::18:46:11 ===
STOMP error frame sent:
Message: "Bad CONNECT"
Detail: "Virtual host 'localhost' access denied"
Server private detail: none



------=_Part_5773_20943472.1372899417754
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

I'm trying to access RabbitMQ Stomp with the latest 3.1.3 release. I'm usin=
g the default guest/guest and trying to connect to localhost. I've verified=
 guest has all rights on the default virtual host ("/") in rabbitmq. I'm ge=
tting this error:<div><br></div><div><div>CONNECT</div><div>accept-version:=
1.0,1.1</div><div>passcode:guest</div><div>heart-beat:10000,30000</div><div=
>client-id:ID:CJANDERSON-LT-11309-635084707237720849-0:0</div><div>login:gu=
est</div><div>host:localhost</div><div><br></div><div>.ERROR</div><div>mess=
age:Bad CONNECT</div><div>content-type:text/plain</div><div>version:1.0,1.1=
,1.2</div><div>content-length:39</div><div><br></div><div>Virtual host 'loc=
alhost' access denied.</div></div><div><br></div><div>---------------------=
-------------------------------------</div><div><br></div><div>From the Rab=
bitMQ Logs:</div><div><br></div><div><div>=3DERROR REPORT=3D=3D=3D=3D 3-Jul=
-2013::18:46:11 =3D=3D=3D</div><div>STOMP error frame sent:</div><div>Messa=
ge: "Bad CONNECT"</div><div>Detail: "Virtual host 'localhost' access denied=
"</div><div>Server private detail: none</div></div><div><br></div><div><br>=
</div>
------=_Part_5773_20943472.1372899417754--

------=_Part_5772_30734686.1372899417754--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.18.1373280210.3387.rabbitmq-discuss@lists.rabbitmq.com>

acknowledgements from the consumer for a single message, while each
message represents many logical messages.



-Emile







From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.19.1373296460.3387.rabbitmq-discuss@lists.rabbitmq.com>

is setting state->state to CONNECTION_STATE_IDLE (== 0) between
amqp_connection.c lines 234 and 245. The obvious suspect is consume_data
but unless things are already corrupted, it's hard to see what could be
happening.

If you can run your program in a debugger, try breaking on the abort and
examining state's memory at that time. It might give some clues as to what
is going wrong.

Does the problem occur when the message rate is high, or low, or is it not
correlated with either?

I should also mention I'm looking at git revision
31ecd4f52f17dbf9e189625cd1ba2ad08af29851. Which revision of the library are
you using?

Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/

--001a11c1e89cc58e3a04e10119de
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div class=3D"gmail_extra"><div class=3D"gmail_quote">On 8=
 July 2013 09:17, Haster <span dir=3D"ltr">&lt;<a href=3D"mailto:haster2004=
@yandex.ru" target=3D"_blank">haster2004 at yandex.ru</a>&gt;</span> wrote:<br=
><blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border=
-left:1px solid rgb(204,204,204);padding-left:1ex">

The problem is that I use only one thread in my program (only one thread<br=
>
works with connection to rabbitmq)<br></blockquote><div><br></div><div>Is t=
here only one thread in your program, or is there more than one thread but =
only one which uses librabbitmq? If there&#39;s more than one, perhaps anot=
her thread is chewing up memory somehow.<br>
=C2=A0<br></div><blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0=
px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">
I heard that on HP-UX TCP/IP stack protocol API is different to other UNIX<=
br>
SYSTEMS and to fix it I need use libxnet and _XOPEN_SOURCE_EXTENDED define<=
br>
directive.<br></blockquote><div><br></div><div>This doesn&#39;t sound like =
the problem, but I could be wrong.<br><br>From the error message you found =
in the logs, it looks to me like something is setting state-&gt;state to CO=
NNECTION_STATE_IDLE (=3D=3D 0) between amqp_connection.c lines 234 and 245.=
 The obvious suspect is consume_data but unless things are already corrupte=
d, it&#39;s hard to see what could be happening.<br>
<br></div><div>If you can run your program in a debugger, try breaking on t=
he abort and examining state&#39;s memory at that time. It might give some =
clues as to what is going wrong.<br><br></div><div>Does the problem occur w=
hen the message rate is high, or low, or is it not correlated with either?<=
br>
</div><div><br></div><div>I should also mention I&#39;m looking at git revi=
sion 31ecd4f52f17dbf9e189625cd1ba2ad08af29851. Which revision of the librar=
y are you using?<br><br></div><div>Tony<br></div></div>-- <br>Tony Garnock-=
Jones<br>
<a href=3D"mailto:tonygarnockjones at gmail.com" target=3D"_blank">tonygarnock=
jones at gmail.com</a><br><a href=3D"http://homepages.kcbbs.gen.nz/tonyg/" tar=
get=3D"_blank">http://homepages.kcbbs.gen.nz/tonyg/</a>
</div></div>

--001a11c1e89cc58e3a04e10119de--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.20.1373557840.3387.rabbitmq-discuss@lists.rabbitmq.com>

1. RabbitMQ does not work efficiently when queue starts to grow:

   "Rabbit makes a lot of trade-offs that focus on flexible messaging
topologies and reliable delivery, all of which can work against raw
throughput, and especially the ability to act as an infinite buffer."
  
   and the initial workaround with:
  
   "Producer -> RabbitMQ -> Buffer Module -> RabbitMQ -> Consumer "

2. RabbitMQ has correct queue implementation
    
    "It shouldn't be necessary to introduce another buffer, because that is
what queues do."

Taking into account that correct queue implementation should be of O(1) time
complexity should the issues with RabbitMQ performance when queues grow
treated as a bug that will be fixed or as a "feature" that is not going to
be addressed because Rabbit focuses on efficient message routing and not
efficient queuing?

Cheers,
Nu
 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-QUEUE-MESSAGES-tp27737p28007.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.21.1373624481.3387.rabbitmq-discuss@lists.rabbitmq.com>

rabbitmq-service stop
rabbitmq-service remove
rabbitmq-service install
rabbitmq-service start

this command
*alwys giving error handle is invalid .*
may be i am missing some setting .
but i m already using in my machine  in same way .
Please help me if i am missing any configuration somewhere





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/not-able-to-enable-any-plugin-tp28027p28038.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.22.1374657778.3387.rabbitmq-discuss@lists.rabbitmq.com>

a single queue resided only on a single node..am I wrong?
What if I discover that my machine is not able to keep up with message rate?
Maybe I should start mirroring the queue on multiple servers so I can 
multiply the number of consumers? 
Is this approach scalable or does the synchronization overhead kill the 
performance?

Best,
Flavio


------=_Part_458_26324946.1374653053573
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: 7bit

Hi to all,<br>In my application I have a queue that could potentially become very big.&nbsp;<div>From what I understood queues cannot be splitted among different machines, a single queue resided only on a single node..am I wrong?<br>What if I discover that my machine is not able to keep up with message rate?</div><div>Maybe I should start mirroring the queue on multiple servers so I can multiply the number of consumers?&nbsp;</div><div>Is this approach scalable or does the synchronization overhead kill the performance?</div><div><br></div><div>Best,</div><div>Flavio</div><div><br></div>
------=_Part_458_26324946.1374653053573--

------=_Part_457_29950399.1374653053573--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.23.1374834206.3387.rabbitmq-discuss@lists.rabbitmq.com>

"[...] acknowledge receipt of the frame with a RECEIPT frame which
contains the value of this header as the value of the receipt-id header
in the RECEIPT packet."

So RECEIPT frames should have "receipt-id" headers.

> Here's the sequence of interactions.  As you can see we receive a MESSAGE
> frame instead of a RECEIPT frame.  I'm lead to the conclusion that the
> STOMP connector in RabbitMQ is misbehaving?

I don't see any violation of the spec.

> CONNECT
> passcode:guest
> login:guest

As an aside, clients that rely on features defined in more recent
versions (such as "ack=client-individual") should negotiate the correct
version using CONNECT.

> CONNECTED
> heart-beat:0,0
> version:1.0
> session:session-tUmymk-YrI16_2JwFpOH7w
> server:RabbitMQ/3.1.3
> 
> --
> 
> SUBSCRIBE
> activemq.prefetchSize:1
> ack:client-individual
> destination:sis-test-queue
> 
> --
> 
> BEGIN
> transaction:session-tUmymk-YrI16_2JwFpOH7w-1
> 
> --
> 
> SEND
> destination:sis-test-queue
> receipt:session-tUmymk-YrI16_2JwFpOH7w-2
> 
> event%3Dprocess%26message%3DTHEDATA

You should add a transaction header to the SEND frame if you want to
publish transactionally.

> MESSAGE
> destination:/queue/sis-test-queue
> content-length:1052
> receipt:session-tUmymk-YrI16_2JwFpOH7w-2
> message-id:Q_sis-test-queue@@session-tUmymk-YrI16_2JwFpOH7w@@1
> 
> event%3Dprocess%26message%3DTHEDATA

How much time elapses here? If clients don't abort immediately then a
RECEIPT frame will arrive with header
"receipt:session-tUmymk-YrI16_2JwFpOH7w-2".

> ABORT
> transaction:session-tUmymk-YrI16_2JwFpOH7w-1
> 
> --
> 
> DISCONNECT

Make sure you read the section on destinations in
http://www.rabbitmq.com/stomp.html



-Emile




From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.24.1375198014.3387.rabbitmq-discuss@lists.rabbitmq.com>

he sample age and sample increment parameters. However, when I pass in thes=
e parameters I do not get the range of samples I am expecting. Just the las=
t one.

When I send the following request to my rabbit cluster I receive the below =
JSON response.

http://myrabbitserver:15672/api/overview?sample_age=3D3600&sample_incr=3D60

User-Agent: Fiddler
Host: myrabbitserver:15672
WWW-Authenticate: Basic realm=3D"RabbitMQ Management"
Authorization: Basic Z3Vlc3Q6Z3Vlc3Q=3D

This is a test server using guest and guest credentials.

JSON response.

{"management_version":"3.1.3","statistics_level":"fine","exchange_types":[{=
"name":"topic","description":"AMQP topic exchange, as per the AMQP specific=
ation","enabled":true},{"name":"fanout","description":"AMQP fanout exchange=
, as per the AMQP specification","enabled":true},{"name":"direct","descript=
ion":"AMQP direct exchange, as per the AMQP specification","enabled":true},=
{"name":"headers","description":"AMQP headers exchange, as per the AMQP spe=
cification","enabled":true}],"rabbitmq_version":"3.1.3","erlang_version":"R=
16B01","erlang_full_version":"Erlang R16B01 (erts-5.10.2) [source-bdf5300] =
[64-bit] [smp:4:4] [async-threads:30] [hipe] [kernel-poll:true]","message_s=
tats":{"publish":270634,"publish_details":{"rate":0.0},"ack":270634,"ack_de=
tails":{"rate":0.0},"deliver_get":270761,"deliver_get_details":{"rate":0.0}=
,"redeliver":127,"redeliver_details":{"rate":0.0},"deliver":270761,"deliver=
_details":{"rate":0.0}},"queue_totals":{"messages":0,"messages_details":{"r=
ate":0.0},"messages_ready":0,"messages_ready_details":{"rate":0.0},"message=
s_unacknowledged":0,"messages_unacknowledged_details":{"rate":0.0}},"object=
_totals":{"consumers":10,"queues":5,"exchanges":41,"connections":10,"channe=
ls":10},"node":"rabbit at 15below-rabmq03","statistics_db_node":"rabbit at 15belo=
w-rabmq02","listeners":[{"node":"rabbit at 15below-rabmq02","protocol":"amqp",=
"ip_address":"::","port":5672},{"node":"rabbit at 15below-rabmq03","protocol":=
"amqp","ip_address":"::","port":5672}],"contexts":[{"node":"rabbit at 15below-=
rabmq02","description":"RabbitMQ Management","path":"/","port":15672},{"nod=
e":"rabbit at 15below-rabmq03","description":"RabbitMQ Management","path":"/",=
"port":15672},{"node":"rabbit at 15below-rabmq02","description":"Redirect to p=
ort 15672","path":"/","port":55672,"ignore_in_use":true},{"node":"rabbit at 15=
below-rabmq03","description":"Redirect to port 15672","path":"/","port":556=
72,"ignore_in_use":true}]}

I have had messages going through the bus within the last few hours so woul=
d expect to see something extra...

I am using fiddler to send the HTTP get commands.

Please let me know if you need anything further.

Cheers

Chris Nicel
Senior Systems Engineer
15below ltd : 15below Australia pty. ltd.

t:        +44 1273 764230
e:       chris.nicel at 15below.com<mailto:chris.nicel at 15below.com>
w:      15below.com<http://www.15below.com/>
[cid:image001.png at 01CE8D3B.1E3CA1C0]       @15below_travel<https://twitter.=
com/#!/15below_travel>


15below Limited: Company registered in England and Wales No 3945289
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, Unit=
ed Kingdom

15below Australia Pty Limited: ABN 25 132 716 379
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Austra=
lia

Please think about the environment before printing this email.

************************************************************************
This email and any attachments may be confidential and/or legally privilege=
d and are solely for the use of the intended recipient. If you have receive=
d this email in error please contact the sender. Any views or opinions expr=
essed within this e-mail are solely those of the sender, and do not necessa=
rily represent those of 15below unless otherwise specifically stated. Altho=
ugh 15below has taken every reasonable precaution to ensure that any attach=
ment to this e-mail has been checked for viruses, it is strongly recommende=
d that you carry out your own virus check before opening any attachment, as=
 we cannot accept liability for any damage sustained as a result of softwar=
e virus infection.

--_000_A57B6B00637AF741A9FA2D006B40C3C883C23465A4AUSP01VMBX29c_
Content-Type: text/html; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

<html xmlns:v=3D"urn:schemas-microsoft-com:vml" xmlns:o=3D"urn:schemas-micr=
osoft-com:office:office" xmlns:w=3D"urn:schemas-microsoft-com:office:word" =
xmlns:m=3D"http://schemas.microsoft.com/office/2004/12/omml" xmlns=3D"http:=
//www.w3.org/TR/REC-html40">
<head>
<meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dus-ascii"=
>
<meta name=3D"Generator" content=3D"Microsoft Word 14 (filtered medium)">
<style><!--
/* Font Definitions */
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"Lucida Console";
	panose-1:2 11 6 9 4 5 4 2 2 4;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-language:EN-US;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri","sans-serif";
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;
	font-family:"Calibri","sans-serif";
	mso-fareast-language:EN-US;}
@page WordSection1
	{size:612.0pt 792.0pt;
	margin:72.0pt 72.0pt 72.0pt 72.0pt;}
div.WordSection1
	{page:WordSection1;}
/* List Definitions */
@list l0
	{mso-list-id:740450605;
	mso-list-type:hybrid;
	mso-list-template-ids:-1755024472 -2033308478 1923925024 -2091997756 -5010=
27950 -138781648 -243628202 1653882186 -1791180630 -542731350;}
@list l0:level1
	{mso-level-number-format:image;
	list-style-image:url("cid:image001.png\@01CE8D3B.1E3CA1C0");
	mso-level-text:\F0B7;
	mso-level-tab-stop:18.0pt;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level2
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:54.0pt;
	mso-level-number-position:left;
	margin-left:54.0pt;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:90.0pt;
	mso-level-number-position:left;
	margin-left:90.0pt;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:126.0pt;
	mso-level-number-position:left;
	margin-left:126.0pt;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:162.0pt;
	mso-level-number-position:left;
	margin-left:162.0pt;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:198.0pt;
	mso-level-number-position:left;
	margin-left:198.0pt;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:234.0pt;
	mso-level-number-position:left;
	margin-left:234.0pt;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:270.0pt;
	mso-level-number-position:left;
	margin-left:270.0pt;
	text-indent:-18.0pt;
	font-family:Symbol;}
@list l0:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:306.0pt;
	mso-level-number-position:left;
	margin-left:306.0pt;
	text-indent:-18.0pt;
	font-family:Symbol;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
--></style><!--[if gte mso 9]><xml>
<o:shapedefaults v:ext=3D"edit" spidmax=3D"1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext=3D"edit">
<o:idmap v:ext=3D"edit" data=3D"1" />
</o:shapelayout></xml><![endif]-->
</head>
<body lang=3D"EN-GB" link=3D"blue" vlink=3D"purple">
<div class=3D"WordSection1">
<p class=3D"MsoNormal">Hi All, <o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">I am trying to get some data from a RabbitMQ cluster=
 regarding message rate statistics.
<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">From reading the API page (<a href=3D"http://myrabbi=
tserver:15672/api">http://myrabbitserver:15672/api</a>) I am aware of the s=
ample age and sample increment parameters. However, when I pass in these pa=
rameters I do not get the range of samples
 I am expecting. Just the last one.<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">When I send the following request to my rabbit clust=
er I receive the below JSON response.<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal"><a href=3D"http://myrabbitserver:15672/api/overview?=
sample_age=3D3600&amp;sample_incr=3D60">http://myrabbitserver:15672/api/ove=
rview?sample_age=3D3600&amp;sample_incr=3D60</a><o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">User-Agent: Fiddler<o:p></o:p></p>
<p class=3D"MsoNormal">Host: myrabbitserver:15672<o:p></o:p></p>
<p class=3D"MsoNormal">WWW-Authenticate: Basic realm=3D&quot;RabbitMQ Manag=
ement&quot;<o:p></o:p></p>
<p class=3D"MsoNormal">Authorization: Basic Z3Vlc3Q6Z3Vlc3Q=3D<o:p></o:p></=
p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">This is a test server using guest and guest credenti=
als.<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">JSON response.<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal" style=3D"text-autospace:none"><span style=3D"font-si=
ze:8.5pt;font-family:&quot;Lucida Console&quot;">{&quot;management_version&=
quot;:&quot;3.1.3&quot;,&quot;statistics_level&quot;:&quot;fine&quot;,&quot=
;exchange_types&quot;:[{&quot;name&quot;:&quot;topic&quot;,&quot;descriptio=
n&quot;:&quot;AMQP topic exchange, as per the AMQP specification&quot;,&quo=
t;enabled&quot;:true},{&quot;name&quot;:&quot;fanout&quot;,&quot;descriptio=
n&quot;:&quot;AMQP
 fanout exchange, as per the AMQP specification&quot;,&quot;enabled&quot;:t=
rue},{&quot;name&quot;:&quot;direct&quot;,&quot;description&quot;:&quot;AMQ=
P direct exchange, as per the AMQP specification&quot;,&quot;enabled&quot;:=
true},{&quot;name&quot;:&quot;headers&quot;,&quot;description&quot;:&quot;A=
MQP headers exchange, as per the AMQP specification&quot;,&quot;enabled&quo=
t;:true}],&quot;rabbitmq_version&quot;:&quot;3.1.3&quot;,&quot;erlang_versi=
on&quot;:&quot;R16B01&quot;,&quot;erlang_full_version&quot;:&quot;Erlang
 R16B01 (erts-5.10.2) [source-bdf5300] [64-bit] [smp:4:4] [async-threads:30=
] [hipe] [kernel-poll:true]&quot;,&quot;message_stats&quot;:{&quot;publish&=
quot;:270634,&quot;publish_details&quot;:{&quot;rate&quot;:0.0},&quot;ack&q=
uot;:270634,&quot;ack_details&quot;:{&quot;rate&quot;:0.0},&quot;deliver_ge=
t&quot;:270761,&quot;deliver_get_details&quot;:{&quot;rate&quot;:0.0},&quot=
;redeliver&quot;:127,&quot;redeliver_details&quot;:{&quot;rate&quot;:0.0},&=
quot;deliver&quot;:270761,&quot;deliver_details&quot;:{&quot;rate&quot;:0.0=
}},&quot;queue_totals&quot;:{&quot;messages&quot;:0,&quot;messages_details&=
quot;:{&quot;rate&quot;:0.0},&quot;messages_ready&quot;:0,&quot;messages_re=
ady_details&quot;:{&quot;rate&quot;:0.0},&quot;messages_unacknowledged&quot=
;:0,&quot;messages_unacknowledged_details&quot;:{&quot;rate&quot;:0.0}},&qu=
ot;object_totals&quot;:{&quot;consumers&quot;:10,&quot;queues&quot;:5,&quot=
;exchanges&quot;:41,&quot;connections&quot;:10,&quot;channels&quot;:10},&qu=
ot;node&quot;:&quot;rabbit at 15below-rabmq03&quot;,&quot;statistics_db_node&q=
uot;:&quot;rabbit at 15below-rabmq02&quot;,&quot;listeners&quot;:[{&quot;node&=
quot;:&quot;rabbit at 15below-rabmq02&quot;,&quot;protocol&quot;:&quot;amqp&qu=
ot;,&quot;ip_address&quot;:&quot;::&quot;,&quot;port&quot;:5672},{&quot;nod=
e&quot;:&quot;rabbit at 15below-rabmq03&quot;,&quot;protocol&quot;:&quot;amqp&=
quot;,&quot;ip_address&quot;:&quot;::&quot;,&quot;port&quot;:5672}],&quot;c=
ontexts&quot;:[{&quot;node&quot;:&quot;rabbit at 15below-rabmq02&quot;,&quot;d=
escription&quot;:&quot;RabbitMQ
 Management&quot;,&quot;path&quot;:&quot;/&quot;,&quot;port&quot;:15672},{&=
quot;node&quot;:&quot;rabbit at 15below-rabmq03&quot;,&quot;description&quot;:=
&quot;RabbitMQ Management&quot;,&quot;path&quot;:&quot;/&quot;,&quot;port&q=
uot;:15672},{&quot;node&quot;:&quot;rabbit at 15below-rabmq02&quot;,&quot;desc=
ription&quot;:&quot;Redirect to port 15672&quot;,&quot;path&quot;:&quot;/&q=
uot;,&quot;port&quot;:55672,&quot;ignore_in_use&quot;:true},{&quot;node&quo=
t;:&quot;rabbit at 15below-rabmq03&quot;,&quot;description&quot;:&quot;Redirec=
t
 to port 15672&quot;,&quot;path&quot;:&quot;/&quot;,&quot;port&quot;:55672,=
&quot;ignore_in_use&quot;:true}]}<o:p></o:p></span></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">I have had messages going through the bus within the=
 last few hours so would expect to see something extra&#8230;<o:p></o:p></p=
>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">I am using fiddler to send the HTTP get commands.<o:=
p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">Please let me know if you need anything further.<o:p=
></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">Cheers<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal"><b><span style=3D"color:#1F497D;mso-fareast-language=
:EN-GB">Chris Nicel<o:p></o:p></span></b></p>
<p class=3D"MsoNormal"><span style=3D"color:#1F497D;mso-fareast-language:EN=
-GB">Senior Systems Engineer<o:p></o:p></span></p>
<p class=3D"MsoNormal"><span style=3D"color:#1F497D;mso-fareast-language:EN=
-GB">15below ltd : 15below Australia pty. ltd.<o:p></o:p></span></p>
<p class=3D"MsoNormal"><span style=3D"color:#1F497D;mso-fareast-language:EN=
-GB"><o:p>&nbsp;</o:p></span></p>
<p class=3D"MsoNormal"><b><span style=3D"color:#BFBFBF;mso-fareast-language=
:EN-GB">t:</span></b><b><span style=3D"color:#1F497D;mso-fareast-language:E=
N-GB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></b><span style=3D"color:#1F497D;mso-fareast-language:EN-GB">&#43;44=
 1273 764230<o:p></o:p></span></p>
<p class=3D"MsoNormal"><b><span style=3D"color:#BFBFBF;mso-fareast-language=
:EN-GB">e</span></b><span style=3D"color:#BFBFBF;mso-fareast-language:EN-GB=
">:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style=3D"color:#1F497D;mso-fareast-language:EN-GB"><a href=3D"=
mailto:chris.nicel at 15below.com"><span style=3D"color:blue">chris.nicel at 15be=
low.com</span></a><br>
</span><b><span style=3D"color:#BFBFBF;mso-fareast-language:EN-GB">w:</span=
></b><span style=3D"color:#1F497D;mso-fareast-language:EN-GB">&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;
<a href=3D"http://www.15below.com/"><span style=3D"color:blue">15below.com<=
/span></a><o:p></o:p></span></p>
<p class=3D"MsoNormal" style=3D"margin-left:18.0pt;text-indent:-18.0pt;mso-=
list:l0 level1 lfo1">
<![if !supportLists]><span lang=3D"EN-US" style=3D"font-family:Symbol;color=
:#1F497D;mso-fareast-language:EN-GB"><span style=3D"mso-list:Ignore"><img w=
idth=3D"16" height=3D"12" src=3D"cid:image001.png at 01CE8D3B.1E3CA1C0" alt=3D=
"*"><span style=3D"font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbs=
p;
</span></span></span><![endif]><span lang=3D"EN-US" style=3D"color:#1F497D;=
mso-fareast-language:EN-GB">&nbsp;&nbsp;&nbsp;<a href=3D"https://twitter.co=
m/#!/15below_travel"><span style=3D"color:blue">@15below_travel</span></a><=
o:p></o:p></span></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
</div>
<br>
<font face=3D"Arial" color=3D"Black" size=3D"3">15below Limited: Company re=
gistered in England and Wales No 3945289<br>
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, Unit=
ed Kingdom<br>
<br>
15below Australia Pty Limited: ABN 25 132 716 379<br>
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Austra=
lia<br>
<br>
Please think about the environment before printing this email.<br>
<br>
************************************************************************<br=
>
This email and any attachments may be confidential and/or legally privilege=
d and are solely for the use of the intended recipient. If you have receive=
d this email in error please contact the sender. Any views or opinions expr=
essed within this e-mail are solely
 those of the sender, and do not necessarily represent those of 15below unl=
ess otherwise specifically stated. Although 15below has taken every reasona=
ble precaution to ensure that any attachment to this e-mail has been checke=
d for viruses, it is strongly recommended
 that you carry out your own virus check before opening any attachment, as =
we cannot accept liability for any damage sustained as a result of software=
 virus infection.<br>
</font>
</body>
</html>

--_000_A57B6B00637AF741A9FA2D006B40C3C883C23465A4AUSP01VMBX29c_--

--_004_A57B6B00637AF741A9FA2D006B40C3C883C23465A4AUSP01VMBX29c_
Content-Type: image/png; name="image001.png"
Content-Description: image001.png
Content-Disposition: inline; filename="image001.png"; size=808;
	creation-date="Tue, 30 Jul 2013 14:40:30 GMT";
	modification-date="Tue, 30 Jul 2013 14:40:30 GMT"
Content-ID: <image001.png at 01CE8D3B.1E3CA1C0>
Content-Transfer-Encoding: base64

iVBORw0KGgoAAAANSUhEUgAAABcAAAARCAMAAAABrcePAAAAAXNSR0ICQMB9xQAAAaFQTFRFAAAA
E779Fr/9Fb/9HMb9H8T9GMP9FML9FsH9HcP9E8D9G8L9PtL9OtH9ONH9NM/8Ms/9PtH9Mc79PdH9
Ms79OM/9Nc/9Nc79Oc/9Mc39M879Ls39L839NM79O8/8Icj9L8z9Lsv9Kcr8K8r8JMn8PM78Mcv9
Jsj9KMn9J8n9Jcf9Kcf9IcX9I8X9PMv9LMf9IsT9IMT9IMP9IMH9JcP9StX8QtP9RNT9S9T9RNP9
Utf9RtP9UNX8SNL8UdT8XdX9Rs/9XNP9U9D9WtH9Y9v9dt79d9/9d979aNv8ZNr8Ytj8b9v8f979
Z9f9cdj9euD8jt/9htz9gOL9muf8ieP9n+n9iuL9h+H9kOD9ve/9vvD9oOj9pOn9oOb8pOb9rOn+
r+n+pef9pub+qef+rej92fb+y/P+wPD9zPP+wfD93/f+x/H9wvD+3fb+zvP+3fb92PT+2vX+zPH+
2/X+1PP9zvH+0PH+9Pz+6fn+7/r+9fz+//7//P7+4ff9///+8Pr+5Pj95fn94/f97vr9+/7/6vn+
5Pj+7Pr+9/z+9/3+////sIGLtgAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAAZ
dEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAA7klEQVQoz2PoQgLlkVEVEBYDA5Co
hApXBZn6pyKJB4ekVYM4oTxm5i7pCPEMC0vXzJquLCteMzM+62y4eLkbv4Cge220kLCwMI+ARx1M
vN5TRFRMyMZGXEJUVFRMMCanASLeleslKSUlLSMLBjJyYY1Q8SZbeQUYUFSwC8+CinfleSspKUOA
imo+zHwgiFVT1wADTRYfiL3NLSDxVntWLTBgc2iDuLM9Lr6gMMFXW0cXCFjZ9Ypg/ir20zcw5OA0
NDLi5OJ2LEGEQ0eikzEjExMzo4lzUmcdUvh0lZcmBwRGpJRVwUMW5h50wIALAADyCoGSB3+xKwAA
AABJRU5ErkJggg==

--_004_A57B6B00637AF741A9FA2D006B40C3C883C23465A4AUSP01VMBX29c_--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.25.1375381886.3387.rabbitmq-discuss@lists.rabbitmq.com>

don't match?  I found the one for rabbitmq, but have no idea where to
look for another to compare it to.

Thanks,

Jesse


Activating RabbitMQ plugins ...

********************************************************************************
********************************************************************************

0 plugins activated:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.8.7  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at openPLM
app
descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.7/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : nJHdsCiO5JRXQaQNWj71Zg==ns activated:

ERROR: epmd error for host "openPLM": timeout (timed out establishing
tcp connection)

Activating RabbitMQ plugins ...

********************************************************************************
********************************************************************************

0 plugins activated:

ERROR: epmd error for host "openPLM": timeout (timed out establishing
tcp connection)

Activating RabbitMQ plugins ...

********************************************************************************
********************************************************************************

0 plugins activated:

ERROR: epmd error for host "openPLM": timeout (timed out establishing
tcp connection)

Activating RabbitMQ plugins ...

********************************************************************************
********************************************************************************



From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.26.1375871810.3387.rabbitmq-discuss@lists.rabbitmq.com>

the elang process.  But I don't know if this is the most efficient way.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Authenticated-push-message-service-using-RabbitMQ-Web-STOMP-plugin-tp28530p28630.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.27.1375889300.3387.rabbitmq-discuss@lists.rabbitmq.com>

should know about the second case I have here.


On Wed, Aug 7, 2013 at 5:53 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/08/13 16:47, Yamil Einar Asusta Santos wrote:
>
>> I have been testing my cluster and I have come across an unexpected
>> behavior. As explained in the subject, the cluster runs well on 3
>> nodes. If I bring 1 node down, it still runs smoothly. But if I bring
>> a second node down, the third one becomes unresponsive. This is what
>> the third node provides after running "rabbitmqctl report":
>>
>
> You have pause_minority mode enabled. From
> http://www.rabbitmq.com/**partitions.html#automatic-**handling<http://www.rabbitmq.com/partitions.html#automatic-handling>
> :
>
>  In pause-minority mode RabbitMQ will automatically pause cluster
>> nodes which determine themselves to be in a minority after seeing
>> other nodes go down.
>>
>
> So when you stop two nodes, the third determines itself to be in a
> minority, and pauses, becoming unresponsive.
>
> If this behaviour is not what you want, then you don't want pause_minority
> mode.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
Yamil Asusta

--bcaec5015f07924cf404e35c7517
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">I understand that. But I have been testing this in two dif=
ferent env. In my personal env, they remaining node crashes. Versus in the =
other environment, the cluster runs on 1 node. Same configurations, both pa=
used_minority.<div>

<br></div><div>From your explanation I won&#39;t be using pause_minority bu=
t I think you should know about the second case I have here.</div></div><di=
v class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Wed, Aug 7, 2=
013 at 5:53 AM, Simon MacMullen <span dir=3D"ltr">&lt;<a href=3D"mailto:sim=
on at rabbitmq.com" target=3D"_blank">simon at rabbitmq.com</a>&gt;</span> wrote:=
<br>

<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">On 06/08/13 16:47, Yamil Einar Asusta Santos=
 wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
I have been testing my cluster and I have come across an unexpected<br>
behavior. As explained in the subject, the cluster runs well on 3<br>
nodes. If I bring 1 node down, it still runs smoothly. But if I bring<br>
a second node down, the third one becomes unresponsive. This is what<br>
the third node provides after running &quot;rabbitmqctl report&quot;:<br>
</blockquote>
<br>
You have pause_minority mode enabled. From<br>
<a href=3D"http://www.rabbitmq.com/partitions.html#automatic-handling" targ=
et=3D"_blank">http://www.rabbitmq.com/<u></u>partitions.html#automatic-<u><=
/u>handling</a>:<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
In pause-minority mode RabbitMQ will automatically pause cluster<br>
nodes which determine themselves to be in a minority after seeing<br>
other nodes go down.<br>
</blockquote>
<br>
So when you stop two nodes, the third determines itself to be in a minority=
, and pauses, becoming unresponsive.<br>
<br>
If this behaviour is not what you want, then you don&#39;t want pause_minor=
ity mode.<br>
<br>
Cheers, Simon<span class=3D"HOEnZb"><font color=3D"#888888"><br>
<br>
-- <br>
Simon MacMullen<br>
RabbitMQ, Pivotal<br>
</font></span></blockquote></div><br><br clear=3D"all"><div><br></div>-- <b=
r><span style=3D"background-color:rgb(255,255,255)"><span style=3D"backgrou=
nd-repeat:repeat repeat">Yamil</span> <span style=3D"background-repeat:repe=
at repeat">Asusta</span><br>

<br></span>
</div>

--bcaec5015f07924cf404e35c7517--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.28.1376492219.3387.rabbitmq-discuss@lists.rabbitmq.com>


=3DINFO REPORT=3D=3D=3D=3D 14-Aug-2013::16:21:05 =3D=3D=3D
accepting AMQP connection <0.23461.3294> (10.10.0.182:63312 -> 10.10.0.85:5=
672)

=3DWARNING REPORT=3D=3D=3D=3D 14-Aug-2013::16:21:05 =3D=3D=3D
closing AMQP connection <0.23461.3294> (10.10.0.182:63312 -> 10.10.0.85:567=
2):
connection_closed_abruptly

=3DINFO REPORT=3D=3D=3D=3D 14-Aug-2013::16:21:05 =3D=3D=3D
accepting AMQP connection <0.14548.3287> (10.10.0.214:61485 -> 10.10.0.85:5=
672)

=3DERROR REPORT=3D=3D=3D=3D 14-Aug-2013::16:21:05 =3D=3D=3D
closing AMQP connection <0.14548.3287> (10.10.0.214:61485 -> 10.10.0.85:567=
2):
{inet_error,econnaborted}



This does not seem due to the flow control, because the status shows that t=
he memory and resource are far below the limits.
Attached is the rabbitmqctl report from the problematic server.


Thanks and best regards,
--Bin Chen


--_000_0A9BFCC08BB88444B487C782A14860AC04FAC73CSN2PRD0310MB359_
Content-Type: text/html; charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

<html xmlns:v=3D"urn:schemas-microsoft-com:vml" xmlns:o=3D"urn:schemas-micr=
osoft-com:office:office" xmlns:w=3D"urn:schemas-microsoft-com:office:word" =
xmlns:m=3D"http://schemas.microsoft.com/office/2004/12/omml" xmlns=3D"http:=
//www.w3.org/TR/REC-html40">
<head>
<meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dus-ascii"=
>
<meta name=3D"Generator" content=3D"Microsoft Word 12 (filtered medium)">
<style><!--
/* Font Definitions */
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:"\@SimSun";
	panose-1:2 1 6 0 3 1 1 1 1 1;}
/* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-priority:99;
	color:purple;
	text-decoration:underline;}
span.EmailStyle17
	{mso-style-type:personal-compose;
	font-family:"Calibri","sans-serif";
	color:windowtext;}
.MsoChpDefault
	{mso-style-type:export-only;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
--></style><!--[if gte mso 9]><xml>
<o:shapedefaults v:ext=3D"edit" spidmax=3D"1026" />
</xml><![endif]--><!--[if gte mso 9]><xml>
<o:shapelayout v:ext=3D"edit">
<o:idmap v:ext=3D"edit" data=3D"1" />
</o:shapelayout></xml><![endif]-->
</head>
<body lang=3D"EN-US" link=3D"blue" vlink=3D"purple">
<div class=3D"WordSection1">
<p class=3D"MsoNormal">Hello,<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">We are using RabbitMQ 3.1.3 with Erlang 16B01 on Win=
dows 2008 Server 64-bit.<o:p></o:p></p>
<p class=3D"MsoNormal">We have experienced frequent connection failure some=
times.<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">From the log file we can see lots of entries like th=
is:<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<div style=3D"mso-element:para-border-div;border-top:solid windowtext 1.0pt=
;border-left:none;border-bottom:solid windowtext 1.0pt;border-right:none;pa=
dding:1.0pt 0in 1.0pt 0in">
<p class=3D"MsoNormal" style=3D"border:none;padding:0in"><o:p>&nbsp;</o:p><=
/p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in">=3DINFO REPORT=3D=
=3D=3D=3D 14-Aug-2013::16:21:05 =3D=3D=3D<o:p></o:p></p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in">accepting AMQP con=
nection &lt;0.23461.3294&gt; (10.10.0.182:63312 -&gt; 10.10.0.85:5672)<o:p>=
</o:p></p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in"><o:p>&nbsp;</o:p><=
/p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in">=3DWARNING REPORT=
=3D=3D=3D=3D 14-Aug-2013::16:21:05 =3D=3D=3D<o:p></o:p></p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in">closing AMQP conne=
ction &lt;0.23461.3294&gt; (10.10.0.182:63312 -&gt; 10.10.0.85:5672):<o:p><=
/o:p></p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in">connection_closed_=
abruptly<o:p></o:p></p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in"><o:p>&nbsp;</o:p><=
/p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in">=3DINFO REPORT=3D=
=3D=3D=3D 14-Aug-2013::16:21:05 =3D=3D=3D<o:p></o:p></p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in">accepting AMQP con=
nection &lt;0.14548.3287&gt; (10.10.0.214:61485 -&gt; 10.10.0.85:5672)<o:p>=
</o:p></p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in"><o:p>&nbsp;</o:p><=
/p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in">=3DERROR REPORT=3D=
=3D=3D=3D 14-Aug-2013::16:21:05 =3D=3D=3D<o:p></o:p></p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in">closing AMQP conne=
ction &lt;0.14548.3287&gt; (10.10.0.214:61485 -&gt; 10.10.0.85:5672):<o:p><=
/o:p></p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in">{inet_error,econna=
borted}<o:p></o:p></p>
<p class=3D"MsoNormal" style=3D"border:none;padding:0in"><o:p>&nbsp;</o:p><=
/p>
</div>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">This does not seem due to the flow control, because =
the status shows that the memory and resource are far below the limits.<o:p=
></o:p></p>
<p class=3D"MsoNormal">Attached is the rabbitmqctl report from the problema=
tic server.<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
<p class=3D"MsoNormal">Thanks and best regards,<o:p></o:p></p>
<p class=3D"MsoNormal">--Bin Chen<o:p></o:p></p>
<p class=3D"MsoNormal"><o:p>&nbsp;</o:p></p>
</div>
</body>
</html>

--_000_0A9BFCC08BB88444B487C782A14860AC04FAC73CSN2PRD0310MB359_--

--_004_0A9BFCC08BB88444B487C782A14860AC04FAC73CSN2PRD0310MB359_
Content-Type: application/x-zip-compressed; name="report.zip"
Content-Description: report.zip
Content-Disposition: attachment; filename="report.zip"; size=29774;
	creation-date="Wed, 14 Aug 2013 13:47:38 GMT";
	modification-date="Wed, 14 Aug 2013 13:47:38 GMT"
Content-Transfer-Encoding: base64

UEsDBBQAAAAIAFAIDkPQIvYxtHMAAGPuAwAKAAAAcmVwb3J0LnR4dOxdaW/zRBD+bH5F1C8cCmXv
o0KIUwhxn0ICFKWp37eBXCQpV8V/55l12rjBDpOshEFygdJ4Y2ey++zcM/tFuVqut9PF88GmXP9S
rgeb7Xh7txksF4P7eyWkHoahNH8O78NQDVX4888XXhhcXl6+8OXubc8Gi+VNOViPr6+n2ze/eOud
D9XXn3zwlRAmve27+9X0Zqh8CH8OXxjcr+8WC3zWaLxazaaT8Xa6XGyG391Xdw8vvkj///jzi+GF
vpSX+oJuavm5ny/KzXQ8vPj4k/e+/OCtweCdb98ZSB0GUuF2cxmP3rzcjObLxfDinc8+3d9pHO5U
l+oSjzh282/zcj0bXnz78UeD1XiNecNtoPYf6N2MN7jpy7e+/KhGq6RPxK3q+K3bm9n0enjx3hdf
fVm7WaTPlfEf7v6pXC/KWePd+KqO7v4B99OkDO9/nS60Gi62f6Yr+J5jLBdwscFS4RHp9eAL6d4W
cvBSud5uXrWXUlyqlwffOfMqVu+HwXeb+epKKvyLv8eb3xeTV7e363J8s7nS4ofvFxfp0fNyvlz/
jsXfLrfj2dBYYaJy1j35JveT5WJRTggno9V6OdkMrdJSGxGevu3nu/Ku3L3DRC9kcObpO1azu+dT
gE08vbzc3pbrdONQumiCDXTf31GGT3VeHQw9n29HN9eHj5xvno+mi5vyt6G0WsVgQtNHltvN0Mmg
TDgYvp4uxpgXFZzV0ceDz5xgs4FS5a0QB1M13i7nQ+ukd7LpAze/b7blfOgwd0rr3Yr/Mh9V6zC6
nT6/Hf063pbr+Xj901BcmoM3zKZzbFEptDAyiuB1Gr+Zbn4aPVuX5eP4w8/T4aFR0Qd8J2lVGnk2
nZWjm3IzWU9X2+V68wCE6jn0FXcr8fef3RvvNuUNPq/1XZvl5CfM8sMDDebzH95aPdLF3eQQKsrN
piTaHr4dEOIx7/fpnToGTOQDYxslEA5len232k7n5dBHYWmyX3jhndndZkvslcs3MUyfTFM4GX7X
8L4f0kfveWq6ofGdu68zBp/fcdwfiKS39kx4UC5+ma6Xi3m52DJoG99tb0fXY0za4ubxI0f1q9gB
+LaL8az67DQ0Lye348V0M8ctL3720VsffPLi8MW3Pv68+rN6I91OX6ba0PPlzd2sHO6e/8t4PR1f
z8pqML19Us3q7rvff/fDkKbrzydjj997hE+/meHpw+nzxXK9e8JyNgODGdG6TDfbKRjIYrloG6u+
1i/gV/YR4uWz8d1sO1ph50w3m2p+X3/94vKVizfeGP7tjx/qNxHg1jT0/K7cbDH6t8HRdvwczxvf
zKcLkLAeY688fcQvt8vNlp7x2v7+WfkcO3k0Wd4taCtxdmq5oKm9Ge345Ij2J8Tj1WvvluXqfdy2
eO1BOr928N6LnahYL9ej2fL5c3yl+2O34z2vNWDrEtcvqqV7th7PsfpjsFAtha84xm2Jhbwux9uh
29F8O13Rl5yv6MOejWebatmmCyz9TXlzoGVU04YPGc3KX8oZrtSky3C6eLZMG6pi4BvMc5kmYbSZ
/vE4Z857r6R7+raK2x+A9XGUOH31jnTXw/zeTNdt81M9Yf7zqNLIXttAJLx2efnaw3Q/eU752wqo
Pva4m+um2X5194BXqwdUD6WN9fh1xr+Nflze0R4egSusp9hgzlpdffl1SToBODhImC2XP92tNo8r
UKk6o2xAvEqPqaGCpqMS1qsSW7p8XNMNPm2CS/gwfCWAfDknPkBa7d10cwskLICnx7fOMFQuyvWT
+5erJzDZTla79+1HdpK5WdEi/kpCBOv/65+t71mX2NTjm5v1cLuuWFjTT8UG8WWGUoXWNyUJMRv/
/g+PAsNLC0DvgqrS/sbyN8AWXHIyW24ettPjZNQnzUIT2g2sx5Oy4kC4zlApSBA+7rnN1QswDgpa
m4KMkGJVYnnTX3ji7mX6CwuUXlWrvLm7/hFPqF0B370r17UL4NDTm+n29+Kp4KEHEX62S7D29OKn
8ndsIRp+XqYLk+kK2lL683a8uS0e303cuPglkUOifXm3LR7ZVDGZTbFHatAs1uXkl9Fysq3+mCzw
JSAWcaX6Y39lhV8FSZiymI0329H1jJSRm9H1709fj0Eg0bkA63rh9Sb+KaGIRxsulVDmjUIKvKRr
QV05JbUYvPrGoLooLoO9olUs0q80WuyH6rcWCQcFfpKULujnXgwj1JwiCa3iNby9qNh08d39xWo2
3j5brucwLi4/ee8r8BVcW4M1TrYXewMvXZ6MV+Pr6WxK83UxpHvvrgEzUlbBmJ9N13NcJtjSmx8W
afT4B7bjDbBdew/u2tzN6fbxYlLOoBVsp89+349fjzfTyeUCe2t37YfqrtXva0CV6Hvn4e/BS++8
PFBC+FfJBh588/Gv43U5HHywmFwm2qcL+pJJtOC2j6aTcgGNcHAH1rkeQN8efPzZR5eDwZdlObjd
bldXr73266+/Xj5w9ksIrdfSc3aW1YPBeylgixUwQnQIhYlO+MIKKaOhFzEWothpewUpKQWomC4I
5tK0QsIb2Jci2D0itAcgvLStgEijdUDs7+zx0AEelJHGaiy/FhE7VWkvVFQKfwXtTCsoXCsmYjSX
Wim1x4S5st4a1wqJNNoECdMjogtEQBONGtOqrDaYXAnb2hrChozOn4MI7x1BQj9AAr+MuILxqmQr
KNLoE1Dsb+1h0QksvPXagyeouOPhQQUhpCNeYaS1rdBQph0bUijCRthjIzrAALynFRpptA6N/Z09
MrpAhoeS54MDDEIM+C11tFHhL+91uwiRsR0VVsUKFXtZEK+cdK5d00yjjVIk9qjoABXY2nAYC8w+
+aGxNaFkSq3hlaYLxrsz2IWHbxq40LqGC33lSAVtxUUabcSF7nHRBS601tY6gYXw2kUL6yMYa8E1
CoppGNmOC9XKMFRQjoARaypG1FfQK007MtJoo4oRe2h0Ag0rlEOELRZYAVimhUcsyAkIgkKGgCVr
lyWhDRrQZkM4gIYDzwDU2pFBo43IcD0wugCGV8ojOBYL6BVg2xZkCK8DXuvgjuidshUVFrosUGHE
HhXWAwFK+FZUpNEmVNjTXRf/tTke5gH1b0AaNoD3BGD+I7h/ACqI61tFSqcvnAMcBKmgXkKMxIDJ
pgj3MaukDRzOekHYkHstwznIEm3bsZFGm7QM19sk/z6agQ1jTQDXwEIEKwJYehRe4peB2hGDPMvd
+cA05J5pAH5X1h7lGvaQa+xv7aHRATSUhYMLfotCYyk1XupghJKm0LAgj2ifolWYaKHDAcPwErBw
sd2/lUbrsNjf2aOiA1QgHiUhLQADLCeSp4ooRKR0sIAL0ELVGeYqXOji7wwD9mqMsRUYabSRX/QB
s26A4RAj84I4hRLwZwEVHvlmWmLl4fg8Dxh4wAHHkMrBKhGu3SpJo42xVNUrGZ1AwzgwBmSXVvaq
K2BqgmsES1oHMk6P+D7boyUAliNoqJorQ4YrgyiKaoVGGm10ZcheyegIGkj5jbHyXERAI0IYiCTz
ESw5Ik6kb4WGho1B0NC1YAnskqh1KzDSaBMweqd4J7AIFuYIwUIRw9BFhI5gnDAmCRMZzhEmeFTS
MmzNw4XwqvCmXf1Mo40erj662gkwFGxLlTQ/pyUsQwvflCHPBv4Trp1b6FZYYOeHA1hgza6ckaE9
tppGGwWJ7u2SLoDhA6mdKU6hLZRNWCgGdSqGpL2EO+MMP4ZW8KIeIEM7aBhWtifppNEmYOhe9+wE
FyLKFBmJnlzgRiv8GwVe43/tTs925YJCLQSKfZwEr8AtlG2XImm0ERS9rdoFKCTA4OFB8CRPIpkn
WCLRziLaPZ1YFuITtfAIImi08jG0oiGNNnoudK9tdgMHKBURDJrCn2STeuM1+Tg1TAlxemAEgErS
o2aa2isHN2o7JtJoY8ysR0QXiIA16hFlB4OAegirQ3tlXVAU7VYUUT3D/e0rPdPWrFIP8wNGb7u/
Io02wcL35kcXuLCwPKSXqvBQKcEfkDQFJRMqv3feurMycuD9OECFQSI4InLtxkcabUKF6TPBu0CF
khbapIPnO6ZMKSeVgXsSEREXTLvlccTtHXxSK1ytYCTAg2VEezwkjTYWjPSezS5AARRAjYiU6Cvg
5DRFgD/LwYXlcSFqe05eJ25USYbEWjwE7AIf5dtN0jTaGA/p+UUn0NACtqiUkB8m+JTOCd+mNhr6
JmKo53gqrKJ8Xyf2sFDI0gruSL5vGm1ChTo9S6sHRT4oXNBeg2PAMUGiA0qntHBeUIAd+VtnqBZw
lAt3gAqpoXECfu26RRptZBa6Vzm7wAVmEz5F1IPCW2HgpQAvj+nVGe4KL4wiRMiaskkREHukXiSN
NimbfX1ZJ3jQcGYaT2lY0AYkfgdFadhQPiFTxBk5vtJCChEq6u4KyrEwRzyaabTRX3G6m/u/Nsf/
xxxfyA4NPYJ8V6LAzAoqJDrPdxWNJDSYuoqpYZHKI6WGNNosNc6oHurxkI8HqgbxGvOlyIMVwBoK
gzIzCplK6Ay45s/ABlQDQdioh0qdpZwb155akUYbQ6Wud27++2iGu4KqQkyUlLAJdu0DSn/g8MR1
Zds5RmyvEfEy1FFB16imTB2pHKLRZuvjdH7RYyIfE8CAgwVCIQjriFlg1yJoaWB+RK/0Gb4KifuT
sllzYqHkhASJb/dipdFGQSJ7ZtEFMLSMYBeWFE2IDSoKwcZFSgR8ncGHcwoNEXZ3B7gw6sqSz7MV
FjTaXLTeB9C7QIWEvMAyKmxVgwL25H3GSzCNVFGkz0r21ojKPwEGfkX0SaJi11ZkpNHm4uTej9UF
NFC0HhHpFPjDkX2KMg2Uk0GEUM6MPcuPhWTxA1wEMAwrdXs1WRptgkXfTq0TVAQHQVLoSO0MJBxK
Hj94KdUZ0TEVdSQ8+FrdKQkQc8StmUYb6057PHSBB039kJDTDT+3pVg2tUxCmY/CaxXb1YpWrUIL
5IkfgCJSyanQ7dkVabQJFLEPmXYBCh8Eyj0RF0P/NPBpxMS8jZAaBWwRdyTlpjW3GxnBSaOodc2C
kUsVp6Fdo6DR5sJC0fOKLmChkdbtkUJLtgj2K1WCKHQ8ob5ZUckzTBCPR1xqPKNmgaAOOYYjHs40
2miB9Pn+XYACkXIRjcK0AhQUOQcv13B6I3fzSM8CeyyzQh1gQpJZGp1uz6xIo43eit4u7QgVECHK
Bmx+gchDkibUSU062AOnJ/sr3O0IFfX6Y5QG4eu1c4o02giKnlN0gglB+boQGfgLHZyDxwt9RrI/
tMVIWNA1M1RQWndsx0IabTRD++B5F1hQtvIjwuRQDhaHSqjw4XQ0IGPXJtZgHuFASgQeeqSZSRpt
gEOvRHQEBwUjVFgPryS0B2q0iD2uEGnARRVPt0IlMmySZmlrPILkhdHtpR9ptJFH9KDoBBQR9gHZ
enBikmuCPBJOGkrJg8/ijMIPBfMl7FCxz6ajjgTetcMijTaqEX2VWCe4kHBQGQUlTiHEQQ6CGBAN
M450TXWkT0U7LqyMh9wi+nOLB/twRyeoULBDxa6NIvWvk9AqSIoAFdrKM3K5UV2WDNF6FCw1zzOy
HRVptDEK1jfP6wYW3mhHjTa1IFEi6awIF6rjQrw+AxaS+lsc4AL5GcBFFO1pNmm00Zdp+9KPTnCh
0bcEVggBRAVSLuiQzZiapskjRqlsb1IBfeCQX0QoF9IcOW4qjTZHzXvlohtcOJwCaYk/WDgwg0Wm
fpWiB2lyhs4Jd6hLOqd/hAWVECLweqR3SRptQEVfQtgNKOCqovarkUQ7dE7s8WDxUtszguZO2yQ+
6qEwja4EUELb3VdptLlTxenZeP+1+f0/pnUjkQZb2moYpyglpT7exiE7L1CbI7JPzujijehapXCG
ugCxFCRVR4OkqiXt6nRk5CxDzysegqRB0oFC8FJQ/q5EDNsIFPhiAKrnGYcLUWtNQ7ionxViU1fe
I33R0mgjLmwfEesCFzBNUR5GAkQ7T9YHsnbBJtDFor0A5EivPBylfkklZ3VMRDJCTHsBSBptxkSv
bHaBCUleb2p4BaMyapIcVsGMSC3/rTxdudAwdQkVupaQR02wpG3XNdNoY0Jej4kuMIFaIBIbgs6z
9KRbWHql7emRMWlhuBzAAeorEjSlaRccNNoSNe89FV0AwqAYDLzBBKgUqWCM5LqV54RK4SF9AMQ+
l85RwtURF0UabU7DO73EuAdEPiCkpQNivKfG3F6m9YnU3oi6CpzTzMbrdBZdMHWHJuoGvTlid6TR
ZodmXzjYBSqsVHSiKGbVpXOIVajOoYM+ccap2NAUPWGiHilVnvobifbgRxptFB19K5tOMCHTdGrq
bESOIrwIQdMSQQQcadHdXnfuAIkDWGiDnrv6SG5mGm3sh9brE52AQsDo0KnlrkEEzEKKoD6MeDmy
cM7xT0jk7ByCQl9R44N2pSKNNoKilx6dgIIahxSWTE+Uflg61dae09kIBxgmC3R/EHZVIqh1u8WR
Rhuw0JcIdoMFrSiRP7EEmKGW+qsiJ/90LEiFmqEKDPt2uQCDiL49MzONNjba7cHQBRgo+U1TGqYt
LBRMQc4JGH7trKG9sgPlX4dwgCCCOyIeERQ02mJ99pKiC0DA9eANhANtUiuQviLwQh/hDi+8gylZ
lLPN1Qur6U2xGM/LYrLElQkRWCzu5tflurjb4Ncvt0ss2nY9XmzGaXQ8K3azXeznb3m32BbzcrMZ
Py83ozuassXy11l587y8qV/f3Xl4cT6fbre4iNueXlity2fldnK7+4TJbFoutqNns+Wvo+vZcvJT
eXOkPEU4Kkust1iB3IMl1uhYGbxkXi5aeztFG+hZMMfNA4wrpO9+i/0/1ZUjJ+oEfRJZnkWWzyQL
idaBwp2Cl1k3eCm+XPxzkl48oAqbqCJK8ohCzjmIsoLVDWXwkhQvF6zOKn8n64S5cggPgCoXWCe1
gqqXC86hr1k0IfvW2EQUqys2iML6cTps562glGCJl9TSl5eYB7r0ywUny09nTReAnuAeFatNwuCl
8HLB6LgQsoiiHi/JdOM1/xm85Fhod42cQT7SJP+BKsTN8f0QkGKZDwnuDEOkhSjJI0rSqVVEVGQ1
dQZRWEBGf+jMBVRUECnr3SENjG4tWoiy7SxUeaJJIyhgM2cqxKASUawqzbR8nILPPKowJSGAKh9Y
hxoPXgJXYJyPnMcUIJodIT3U91+8Ig9u8/5TR3hVtIqwrvAFVR5ZxmhDVHkuZ3c8zu6yqCKtwxJZ
kZcZVW1BTppV3h50ytMaRsHrk5U4O6PnVsgSgyFYT0QprsYQeSpDpnAWLrGGWM+aTzofmmA203VE
RbbWPx5TbvK4g6p2tBBsugSPLpE1XxGlbkSWYopnxRLPKlM8YzNbooqrNEjJIkvm6qNgA0RWZB3o
BLJg5jDOhvJZVFk8JBUFsPogVcoop6dSHoPXAgZgIovXVTohi9GhugVZXLKMSK4haZnA8ixc+Ty4
o1dF6ncnPauIuGINrILkLNZA3eZVIoup+knN0f0ygSVRpBuIqsBcQs1aQp23hEqj1WGiinc4fXLM
MA66N1lzhdNFCO1KMhVSydNIZeZkQfWURJbheoukZbmLpM1jDiGpDsi3Z7J3zeHumWi3MCoSTawj
zJP5zDgN3WUxBk1nqJ4yUY4zUS5Pv0IhU2Wb8DrVVzoDp+19plUoyQpPhLFqvivmzqofzwKWM4n1
qVijyoEC7czJWzAiov/wDW0WVSpUCogWnINUqzVkHMmap/Z5aZPsqnFRauWA2OXJ9oTW1tMWJDGY
x9qjiIkoxUWV56EqTxfF+uFRRBZzrgJvrkKewImh0j4sVw4GnhzMJEshuTKhndn/mrDFMuxzbVUN
Jd3/jTA64QFs41TCJJ1XRA+L2aCXYof6UJOG+opOQ2omSx3hpSiYCjuyVB4vlRE7KD2KVQ6R3JGM
woq8NYTUEUmLZDuNpOCBK2+y0BY6bR+uTcEyKbIokhDRiSReCmpSZ/45mzVPxZICPr9EFK+kIpnP
jPIMlQcqhC0ry4TLSA2PkZo8RupU5T5knmAFuli+Btm6hLw19LLy0hnubEXebMW82dJgognwlhsS
ULyQgMrbhtaZtIqOVzRSaX+cCpQ89gAQVeY472xmON9ZoYpc3cGioDNRxXW/C577PY+7R5W+oPE1
/Z3UUji5T9yI6sHHLY5txMAhCpmFlp7EzW1QvKnK1BrCjmnVDVZDh7VC+zrVOwPB7pM5p/O9M+Cc
Pk0X18GmDMvDpvJ0PzilbTVfzOi44gTHVeZcRROSOhO5PMuzWFamFRZRtJ2oYkPL8KCVKafRGstX
hDFZqZQsXprJ4Y1JyLKCdRxqQhbjZNVcaQjzNxHFO8kgIeufD0XIBJaALyQRxV0/xVu/zG2ooJG6
RBcX8Dy8Z8KdclZlIoupACqeuqwy6UJmrUiAl0yByIvcxzzbAvZ4BS7JBJfSLHCpTHmoEWI4abYU
LzdSyUy6rE4MgulqcyxPW17+DBoVVSSxqvYq9sCpAMxjpcGJiiqujFaaJaRzgSUD/GmJMC7X8iyu
lRuNRoeQiiy288/znH8+j0Egxip0IozrO/Is51GmTPTWJHhxfSKWxeNt3iI6E1WKq3FNfMEz8fNM
HiqPsYksJiuVjsVKZWbskGqXTaKLHZFWvIh0HueSaMEhTllGw1rFXPUhoLPgKauoFGsVVaYWKEOQ
MdHF67pemT2cFu6ZlitOR63o4vL5wOLzeembCtXYFYtgumoUy1XTtoaeOVchVCqz5p0hXXlFOAdS
5+VhwHKVp3EunhIoZdYi6litoWFSZVlE2Sya0DmooonJsyTPuywzQxdUXxwSXby2yWkXMlow5+1C
+JaVO6RKS+jM6JZwsnUB5T/sHPsqN3wI/nAStAwLWpmiB+RoeQq4lGSBK9sWUwgYnTJbUrOmK5dr
2UqT5wZ6pGPNlsysvkKOqjeJLtZxjEn0/PPBjrn8Af6xcMpkWdZcZerxyHaNJ1ElA4us3NQVCf6k
El1MwCse4DPLimBSu9PI4lGVBy0FJu8TVTxXTWS5amLWTKE9uEkKDTcnyrPM1kxbOsDlfgpRUrGo
yjTDUL1aeRMtV4GXiqXBS5WlPDgXk13hmLOlBGu2lMjkDWRCJLq4fhpWzWhmaqmkrumJKt4mlJ61
C2Wmtw1nn1cKILc+k8ffM9k7qKoktGPm4UZWHm4ey0LhVUUUNxFD8aKH2cqfqQwez+UOlsUc8qww
JGWHNFncClsleJOV5wFU0Gd0IovtXNY853Ke4oAYXYh1utLjKQiMZuonO7XQ06FSHbKTopROE8/N
XJGBpc9ka384eiCRxeRZMrKYViZ/oMNTiCp2txDPQnwuh0f1gE7QYif6KMliELl8S7qdTysw5XTk
iOnsKDB+iChuEwXpWEpNts0aEedJdDElomZJxEyupQHuUyaLpy5n+uGxeU7biLx9mLkNNUxWfwov
VTyPVmZaG3UEiKcsIS9FJI8o5SqaIk9VVixNORNVcHWLE2iyLJpyvTNCVFuZn2jHC+FLn6f8GVkl
YrDz7HipNLnsCr05XCKLqzd4nt6Qm1iAI1zlSdNleNOV6+2mQ8pPgxcPXZlkmRBI2vP7VHlOKm5u
HgYMi5OYFpNr5bItpdRJmFe8GH6m2AmhmvX9ApINhr4rJ+aOwWCS6VE2N3cMZycnkpjTJHmBnczM
YCtS/Jibvyl5TtK/WLu2ZDuOELYlBPSD7H9hmem+qUomqVhE8Yc/j+WGEW8QNX2uFS8qdkbaKU9U
1PO1anfkx1WaVKfdaq+DivT5wNUDxLwtcux5YHFUBc6ZUROkuc062u5kNKFlQDA884VF93a7UVZQ
TXP7GjF7wLgBHg9Ju3x7ZIcfkuIHzd74zmrxO7eFUPRHa2RPguBSt79cRPNLp8FsNwjCjSIIVeOf
X7kkz45/OOcny/MMyGMQ2QUd3GtBfC13qxcVu3zJueVLatf5I71xYJEfIrg+B9H4JO6XCPpLLO5L
1LZJZpk1NIvb/KIx6YBZR624mXIx857jqDo7IcP1goiKDvg+JoedJ+KWh2svhcCMlqJPSs/FbRNR
o0UKXD1H3FOAR6t24+tz7vMTI2ePOf2gIjeyDWojm1bt9bFHdgQILssgZ7Am1miIEJQEtZje1w40
MHF9IGJ1wnfMbPECuChH3QG6x4+7QAYTRgUTqmu1916dbzCob1CLJsJytNxQbiJTLVyG7ULHYQA3
oCY6fIER1bHOXIVC9BkC06r1GXKNfmJy7QHUolFuq562k/4djeowA5WFlN9pXUeU3S5GDYiK1H68
dSe1nAuYNQ8mxriYOMFtRnBiQ1GMy1HkLLtzfoJrjsIItwYocG3b6vauMe04CvTQOLgIQrUzc6Ij
QnAiFOs3K7AOKNJPgFGOgrgka0VGT4RkXVcbJlxrZeexFvVWWq0Llj4PKHYym1sVrjkvzy95fVHF
K0Fb3YWDnm43CS2v/MTzS96xNoOyNuJbhd8KMX0nhhtSVXPsGHt4h7C4fgG1jopt8BY5cEUlraaE
cusRqVPkIA/1lq9q+DKL8WVEf8+fP5dH2VwMt3tDNDoedumdvvRDnvrRyrse+xI8u9RlMi67uA/E
09BxkaleXy274LkqO9zu3Oo1VXyPfu4GiwZFouJTjbVaT8WNCaldc9OiWrTAlcChMbvP2uex2PVF
3Gp8Lbfga2RHq8CplboZ1Xd5zzY7mR4SnYYAvOX4gdtRLJ4tDLfMDrdvhtvVVIOjG0Bz63jEx5pH
4YP0rzj3SmtT87HmwUQqFXeiU+wS/WGr4AwzJmOZxauhI28ilF7vxLUuqHmiWn5QkTeaMJgjTWLW
f8bCAUUaG4CyNmqWyKyHigOlyW9Vtr4+0t3TQO0Y1QEFbqhYDG329qvqZGSDoiIbNVMLA2YH16Zg
aWYGNtcVIedaOedaqXtbsKql7eBSV3KSCHeUcbILGLmBJTEnGmtWh6+cIyyxXIL0vJ8hORbk3IZ+
kbKQsaJlnp1bDu4peVfIPa9qkc4xdVw1tMQHtvnuyJCa7NLU3SO2d9SdGwjXfD6PGbMDCtzuHbkz
JvbwjlbBGbUSFyh5DquG2+5UF5GLrU0T3nqqZF5KK837snm+GnoR8abKXZrP8Cro7LwUqEBeDJjD
yntvVdRblXZEOPCT/mfvsSd1jl1sxAy32zFH76/lth+oDaJvcXB1fGTu1pCICllHs5LVd6P0XeMr
jGUHFMehoGpd4igqVnUwUVvCSpOdz9v1z25iXZSeizVBYMx9UJH5vU3l98Tdw5gDDekNRnpqwDXC
o/PpUe6LGkLMsdABBapIKaYdMX/62Okz+tzNAtfsH9Ye3lF1cM3ZYp0Le+bs8AI4YhAJ9JFVXgYl
7R+4JJG64e3BVa3vENRyMDWl9ujD7H2J3P1gMVfr81GjjnJxa/pEGYYjo8HvVK1E7BJ90Xw9BtR4
n8q7HdFheRID68moiQfPgVssGaxaUbGgOjMfM/8C6vlrnBzDzq6yPwp1opJVcrXkUas4sEjGGhRh
iX5D+O2OYdekczcnXAO1sOZXgP6Ggon2KoYVV9enrFYAcncECK4RTMwRwYevz2vVfCDEzK7FQcH8
/1kqikRWR7PIvUQiqD1bfOWcmyxKcAy3g4r0/JJy/MQ0+5h7dUABFCqx1x4rdrRgcag0AW5fV9c5
hwGMw6BBchs1O2TlQZGVWK90+xk0Y+9McHfstCn+d5IAX3tT67dpPvs9olFr/08tvuX7iytfXR/9
K3bLbo1RXnGKn+GuSeoVuMSjapv3WueXyMV8MGozn1pVyrFPPpS9BkCNDIrp/9wLBxOZZncuzy5u
h1hm96VIWi+K1kUXxm3MjvioRJ/YCYYatTsfoBv1AYr3CVAzvaNW4NRK5AV/e9o7rwXODKoLfR91
uCxKMjuMonaxH8xrWjUUnlqApwkwzBwtAXJhs9rgFI9et2gUm9N3jdyfH6n1leB7jSNH1z3GyBsA
+K9bMn9FDvMo+58vqjzelS+0jTPWq+u29VnibWsfUKxecWqlaVV5oAPKOVRqg1rMHAcWyVaLIiut
AIAZ62oV+QFO6vsT07QOz9VB5RQqMZ/2duxER4BOCVCMbrYv7yg713ysuXxhNlqgMClU6pIIlB21
2vSF7s1d6NbMjSPmgcW+1uJeS+0aMKQdXGQ46EGFg+oKUeTKOLhIdgiKHVRUwyYOKjKBPKn8sVqk
R4wPqMTji67/0Hc14qjWSj2e2CPqA2vG41+Fd08/Oe7d3CiVtNwNB1TR9ZJJ1Us0EXr8aHuxabVJ
ZdVEVPOYwmWkAD0pCYrpj+ep6kXFHpYoiq/EpoFY64Ji5bco+Wl+X3rtA4p0ZYpyZbQPcK3LL0YS
6KAIVMwToX4UnZ1jLGqOUT5TB/tqev421sjZzV6hTuna9Y52zDXsgGKNTXDGRssShYdl6wNM6gPU
qApjjBfUn9diHmPjttoiHGPdCQ45Afkg2h9YqMdDRka7Ov92ahwl1avzY8U6sEi6mhRdaSYQeF7l
gKJvtnInWyVUPteOg4q0gYuygZq18Rrx1fZaL4BqH3T2gTr/wSE3V3jthdZHWNQ3KJP7GkfbnTSE
QRlCjUV9xv2YnRXh5kQohs77R92dzYouKiuq6XsA+1ADu3nEqQkOlduxan1QwZ/HwrJ2gDPqZOj2
kAOcwomUglR2bErbRb2K5fODyqOOuvfnXUacMtXQrwyOiS+sR9V+y1rLuz7yjvNb6aqPvAfigCKN
M0BZZ7FPFFjrKhYdzoMK50VYA8M6rxXUY2nkjjXXOqBYF3lQLvLQDGHYAZUsKHCZD5GvYv5EJuSM
OoIZUheDnJmFA4rMxwSVjlHH+d1nHlSkL8rlj9VEbVhFS4CDEqBGopg57luRvACuuiQGXv781qEr
esoL3Ej4LyeEfpksOrAGqe9YlMKrp5wx/UpxkLq1GdXSXBnMqvtWXK4ITKpINILll64GmSmaVKJI
XbtqPnYHlXPFEjGp7ZkYBxbJohgUjYqE5aNwZEiPl2zGvdJ03WeiDiiyNOigaoNi68cDK/YHFjLf
yGvNtitj5SePXHpBPMzCOnxVDF+pBROLm5bhG8lBOX4uLrh//rGjpazNAWdzNN1Ki/lBtfHY54z2
DnIs+yMtI9rBxMgPqHichvR+/5ztdcLUku8TVM04oEhdhzHKrja3wy3981Y+8uGssvZ6G+y6fpG+
PfcdERqf5wIeDI7VrVu+mTX/X+qWz2MNHFQ0kwbHpFr89fbd7J4UOSFqqCL9ypBNri0uuaYJMWzO
1YLF9cqogT3m32Vo/o5V7eo+13A7ZmfrQYWvmwdZpP/nSfl/6tnrWJgHFhdWDCas0FzS2AsfRHgb
6epRrPZLWfmhZZMd+Nh1HoptGwWX8oOYnYlK/7xW5GOjI2bb7Mw4RLr1gs7wtIOKpQbnqEG99PJW
YA4u1icFN9wo5mcw7sTXYjulMaiARwwOMbLywGKptBgm1cq9GMvm30A9ylU7+oMBcbd277cuJ84r
uMW8ykUmHlBU4kEtjyPCO7rlRumW2Gb0JpWvyrOV6OQq0dqkv6cnWkJcnBA1X8vHrH1gsQncoPK3
oaVvfeeqA4ttnimqeUbT+GG3Nrf/FEu/pIVY3Uax3HZHE/XlQLbH+qCK/Viehban9bzuVQa5Ngf4
zSqzTfgoihzUFV14IB1c7NACJuUtq5k2ZFym2awD4VwbouicPirxI0fWUiMZUw1V68f60Xq21QFG
9TqIA49vc9b+mxxfBZvZTsfD7/W5KN3j2jFxcLHODefbiAkIc1xUbIcdgmqxk9M1a2UPFzhcYo7S
0/KqPencLMq3EX2IRMwWpzrHqepA5oifb5HuVl5ct7L4XiOnt7irKOoqzUGt8GpJkcsjyTu4n3ef
39eKx3NO7OxyhOcdssih39t7Hh6z43iBcrxEhgjslR8xzvmIMcZq1s7nu9L7fzlHcSOfYmdkkpqR
0RybmutgIpWdq5mLNvpnwKlYl5kbtlfT3uaj81IcK2jCm9MOgdIzj0H5ymLGtGzFQcW6yh6Mq+wq
rMJ9LC4Rj2Qy8eLXB3tQHVCsO+pO+aPyPSb4j7qzG4A3tQFY3YVfl9SLTHtzTfBbUyw8ErODiu14
4NpKRecdXuvyKF3nAVfn0YIdxJ6zpVqgVEt0GDAtrxTZWMe5WEd9rjXj0ik9jkJNo0ig3FDo2Ghu
H9XWSMttjurYaFA2WnyqWGt1nsq5PRzqehBfQLScBzfKexDHr3zt7JlEGGUSxYxW2KgvnSZeWG3b
sx48h0tl0xNIXNKiV/UYt6rHNGDb6n12du/FoAyiFlbUzgOJbWubVFubmO9+tN06qKgZC+2dYgEH
Eu2+G+W+a5/f8hEHFW0FjTKDIqpCT6kY8Wn2BuYWnW/Pnfr4xPXSsJX7A2s9WmW10AxV4eXn1bcc
qsJqnsdiV+GAdBlEGXqNdWCRPgO4zX5qJhmJn+diM7ZBZWzFQGfU6n2F3GcoynBh7pYMORFqoDbq
KBa7PAhJRdByGbNmZQeXG4XLRTcGVRUd1aKGWFXP3Xz6C4rdSoXNdUqKzqhj/QiRXedAnf2S28ai
fmDR+QYy4aB9i54eFxc5kuJOzaSIhtoz11V5tnI/qcK9mn3PH8tDFpmCKjKJ7kM4HB33wblLEC4O
y8Tz71uHTrkjTerCnvNUIN1ScDGh2g+CfVGRRprrzlKbs1asA4o0Ok5NYKlK5StHBxUVP4vhcy7s
DiYkA0ot1ef2aKFyCpXovGfZ1Sp6JCy5kTCtBDZjX1js/UR36n6ii6MM23MeXGx6FNx0rdr6tMMu
LraLwKguAq3ZfG+73yHZbDGYZguN2WuveiGxuxDB3RFQp9RgaWjJD5T8xEN3Pvbq2EFuPEZtns78
oXe2gomiKpjixAdy5yF4dnnkprw+sfqFYTeXTK9pBLenUX2tAf8bOTxC3Lmy2znjFXV0S+2cwc4Z
nc/Qqc9QXZ2APYd1iBSLYVKxURNls8UOi2IHFVTY13GI+aQiR3ve4/Vj8nRDyheOHVh5UJFxqlNx
qujLeOAn+GJrqkmVVLVv0CP3JQa2ozWphlbRe/eRNjvsDo7exYnfB1asFmNRhCW5Db5Q1QrqNxfU
q5nIytodwgI3kil6yV5zHc2iV2EHNc2nlU/e73l39N25GpjY9/S8e7ZggVvRrZ778Z941dl9Lx7U
whcPTbfGyAOLzDk4VQNTZeiBA4otF2JR9UI1CIvyaMkQSclQTIUkyg4sMmTlyjoil+awC4rlLIAi
LbF6MneMA4tkeOcq5GLxZKXFV+HneBV+xj/D+heFt+fX/uBSzVfeIy9nsTsIndlBqD1VWV0Bsnm/
otJ+WqxaMy+Lsr1PANP7JOr629JTBxZpCp0bLBSVHUDOA4vcAzCoPQBq0shjXMUi+zSRTKOmSO3w
nNERIbijW2puJmZcZmBr0MnVoMXXij39wGLXxDm3J070ZzAegfX4YVL8IK7kxVje8v5ALShVlWv6
rL9RfL1SzGg6NJ427vej7r59UDUdeDjn/IlsunJW51ME1w4iwxrZUi2qwiqmaLDHvt8hmXeYVNpB
/Qr3/Al32EYjN6rRSGydPknlju0hvQdVhvtH39l8FjUOrVqeGn5R0QMV3DyFiKrm9WnI5ulBNU+L
npabVbQkGJQExaYst4ErQraBDZvqYFMTuDZuxEPf4ArqBpeW/XPHbpEDuOsjMqyxdye2cCq2kOso
oxfxBIVKVfiZ+DrxD9JHswayy1kzfna7qZz1qHWez5A+o7aZgR3xG9wr0HL+JuX7ac2tXlZHreij
gU6tMxJdvxdWdWC5UbDUpvywMUfH+wM34aQuvw3bdZWLbRkrqmNMbLsNZF5Y7Pon547Viumjce1O
sI6Wc56WPC4wvQ4uOsQfVIivdbM9v7EOKnILdVFLqEXN8so8oMgcPLi+ELVCF3npIdg+qKTaoMQR
p9x19Z0uDThXGhC/wmF+YJFOqSfjlLr4WHMPHFRsLoRLS4pJ3D3H+XLYm5Tg7mvL2T/bdXGx3T0I
qr1H3QwH3xbnt9iECJJKiIg7qPEo6f6qlz2lp6iuvzyGHXMY+v6Z3LgUz3o1XFJL1q7t69Ip2ZJY
TEeilll2y7xkym7rBqh13WKhzmFzHlxkqysW1esq9m86nh/reA9BeQ9q2IqyK0Q2FsOmgjE1T+NR
V+HJZFtSyTbRIrqPVS2TCM4kaoMDnrDzP+QvgE/uArhIWz6wr2NDZwGLywKqTvOoHz4ls6ZU2lvV
rm23fYw9L++gJkbVfngv3E4t+uI2d05GjvRjXJ5nQ+pJRdRT+hbDxm3k5E+5F9PnI5aBA49ydZiL
q2tqYQ/sWsQkU1u/s3dlu3EVQfTZfAUfwFJbd3Xxdu+dGSHeEI8IoUAGiACz2GER4t+5c3uGNcBp
VSyDNCA5wbHjok91LaeWDojZSh7UOekx1B9idencQVkL3YQCQwdhKHZINmKUyj4ilUFC5bJDJ6NN
JpR24ALxDpws03n1rlaoCWWMluTcnnVv3eMYGCoLQ6FyUrGadeeMPi8v2PPy2WHkOCesBprQApnQ
HCXJ5KWfFRjIQBN0OfiYS5FNJjBZhcbnPKXoLGy8yQTmEwzlE8nIioUbD5mrClmrXCWMpXD3y2gc
iu2nyvKRrCrdDcJd8AXrgk/eQSvaDQO81KFgSx1KTudLa91Bw5Mfhk1+5Hw0V6KuXzAjWTFGMqn3
ocEjAQ1XKKJJi9Wojak99v5cMqUQsvN1hDMdaKKBk+OQ5EGbWOhAK1doojW9ZZbC6yYY3E9NWD91
rjNRlKLLhRZboZcikq1HWtWGPGODPGNyDkuM7C+h6QqheBl+/oclLLaAK9+oZSb9tOC6JmN1zVwk
KNZaDMnFBsmV9EBSjGPIpAo2BCxJHJ1LN6kopcUKcVpZ/WqXtBrmcTEa9wW3cUgstxiyXIJYrhxX
w5V6mxw6+RTQ5FPOV3OtvAkFu2qCXHXS84h1qdA4UASKA7OJvnJ31AWOm7E38ZIgKkcZE6tgYuXS
H3XVTSzYxmPjtsl6q7F1EFEit0BEbi4lM7UOIWrfMfOes+4W1AFE49KAwtKcslc5nxRItlWIbMvV
dqoV2WRCY1LBmtqyxIiz6JBWMUNqlWzE8FppEwvtiKpQQ1Qum258ds8g480BMd5J096UechYYasw
clFyWHT8wPKcKFSfS8bITCRdLDToYyjqyzaeM7H4iMUShUxW+rj4TESh5KQyRE5qzjgwqZYhY8oO
GdPsWhpm9iEcuUE4ZtdpsYh1vUfZScfYyex5qUX/u9BcmgXKpdMXUkupf9awom8VNxk2FK7SObKX
IJcJd80HyytYl0+uhYytRgxdR+w2ZpXLXNtQDMEBBRGc3Q5fWtWh3JUdyl2TWQ9XVfuTXLZaL/Xg
QRilaH8C2tJbQp1av4lgkbohRerspl5vPpb2iEB5T3IWhFv1OhTNCxbNJ7lcjouFgFtYCtbCkqMf
hKz6kP9pkPtJ9i+ThQ0ZLsxu5dIMYT6bU3iXd8F2eScx5EJd58GOEa5Iy0iy8CrC0S0EWklsUCEx
qVlSaYyFYKxpJN3sLRE6lmkQlmkkWWYVpyEDgXWN5JhAMRsjIjAeImkfCkcbyq3FkNw6S3BJLRJD
1pSx3dnZR2bEqbQh4oYxmjlrUN0rjwEJkSTZyop4SBmpjgm0FzC5b0ha+KB6CaZeuVBQoqiPMHBc
IQYu6ReVisVY7lOw3Cen9Eql0lAUIVAUkQNRqelQJSMgOik7ANU7AyvKJWG9+8m2jMq8CYUGNljr
fk6pasQmEzoPTNg8cG6HPVtrm1Sgogsjip5NENvgURl2VDmdksoyIhUmVDpssH79wC4yg5rIcgfV
zDt8cCRDWCSTfPGwFS5DVkEUMgvJukorVjex4I4osCUqdwlbVNrEAuMrbkh8lRzmDio2ou4NUveW
MqHBtasVunKFoJUrya1azBzdsqOhFRZZ5XwgizbdpIIpSYyRzEoVMuIFWREvmGyVZCnW7SjKNrBB
dEPSD7LU0hUeHIASaAAqmQ+yxlkqsBYmUC0sN0HAJtQVC0y7sEWASW0vGjrkcLBNCrn5US6uPnRU
4FklD6tezCj4LJ1Az9IlhXI5R1goncwF4pM5+Vwee3XaBAPLc4K9apbeTa1kI/ZdCLHvyWkZbtW7
cUDLYKJQGSy7cZmDlTfB4HVMjq1jShZ/g0uXC+0PLlB7cDKkCSEfMqcskD1NskUcoj4SlzYkLM22
HkWr3Zyi/Ci22i4XaQnT2Z6i9SZ2qN6UVHjhJjIUAToUAOYG4EVEbCy/x7YuJ8lkkSo6pFuMtQmn
xzXF6xjxwBDvkMvvRcK6cqFdK4x1rWS72kQifChzVShzTT7IaFRsSCrBxMp6azHVjiM6zCPYbL7k
tnKKVZGRygA2Ap9tLSiqNOStMWed89Xiej4ruMEU6i/NCdWoDqU+XKHcJ2vmm1qM6JVAepUEsFnh
MeuArcbN1qNDax3yiYK1O0i2bhFBMWa1FLNaSXOqTNy1Hn19Q6DXN+TFYqFAKmtrQyGqYC1RySRW
RQcLiFClPMnaqFjpUqGPlRTksZJcomg9HXMUQGyzT06m0tqQTIJN9GTrvyyyiYVubVNsa1vSNLBq
bGLBo+8Kjb7nklcO7lLBXGBgXGByrkGIeZMLvYKOXMFcQm1yVizU6bBATidJ1ZhGNw1ooIXFWSmZ
ikQdOyrMP3MuDSut6CYWTE0aRk1azj9707LJhaYVCqUVOdPgoWPqLpi6J71z89oxRGvAAdWAk31s
YW6bVGAgw9DDCMlp7qitqxXYhCGENGEkY75w72oF9psXqN88F8gwGdWhk1LopHIXkFkKb1KhHFuD
KLYsCy9SfSiSEUYimWzYZ1LrSNxXoLAvqVhWlUeEYoOkyjZhlJAeusOEA8Y3pLwzV6405HEccjjZ
2d9avZtR+HE67G26FITCF5OFTlYwIZMVnOwcE2H6sydcTZYXq8PtiLFFo3KK+5ILjkVqtaFcFSvR
JVVLtJY24ne4IH4nOb8ghaUOhaNCUDwquW5zKe3sD9EKvmBbHLO1ihI25qexUli2ElZL0TG7pZjh
Sr4EJ9WNh7S+QlqfrQw4+xgVQhgVkouXJWqTTS6wK4qhh9Wzz/lJRNUhixqQRU3mYUrMXSx0slwU
mizP0n9KrbQRGB1BMfs4KpvwkM47pPJJsc5TRQ01D1AyliRKQ+xPMqm+VUmFRkk2tvOaw/yzDWRj
B+XQQeVYUmXTTShwzJCx50mSMY0G0SYVWiI3pESey8I0QjaZQCaEsUdvsrFyEeVNLLToyw4VfbMv
OZdzft9Qntsxojsp1qWbuoEZvmAZfnZVQUjoJhbobhjadcTZZUdUtZ8WGpNiIWnOtjM16lKBTSHY
s2ZJPktL/TOCXOKUVdjwznoxKnp59j+pWaxRfRMMnLXgAs1aZJ82YyMqI54HeyY8e1pu6kMazxh9
lKwacuPS5UL5I2jDiuXsg7BFbFKB7FGF2KNs25+YxogxDcSW5mo7UrT04A8lS8HqXPKoSpXB6KFg
0UNyuEhqq0M2vkE2PllLEfcYkooDEiv5HKN4Y9rEQtsvWJD+i6TNEg/VkYRHGEl4koUniard76AV
aYMq0jlSUjvfHejsB0OzH8nUgpvyJhU6s8bQyFpSKjPrUqH1zIqUM5M+pxrRJhR8Axm6gTlddxqV
KiCpcr7QhbuyoywWQyxW8qiMyiYUatkJs+zJ+lwzqptYaNjXkLAvtwOjWesyoTGDEBQzSHLlS0iL
TS4wocAW6SeJ5LAqm1CotxHM3aQJB2tjlxB77TA5PccsLkO6xQ3SrTQTIrXomCk1yJQmYWTV6HKh
MZZAMVYu8mMT9U0qdAhSoCHIZMNKIe+GCy2UF6hOnqO6Oah2s4U292Cv2iYDGpHqXSyQv8XmwZL2
QUpIhxBM7YWQ3D7ZIylV6pgxZYGsKUvyuGojH7NaClmtpFMUr1SGvCK2qz4XAoqH8pB9EGw5myQz
HmnGXTBwG2GDthEmXaK0Jl3rwSZqbBgseVQhrW1CgUvjGNsal1xlJ2FiQ0Yee/Yj29AWwTqS9YhC
WU+yk1pJqIsFrvdigvZ7JVt7lIV55LS4QKeVfK9fhbUbU7CkyVBFM2dLWdtJsiC4jMJYGSVpSrlo
2+SCHQ9hnieZ53OTfl5g7spQ7po8LNXzYaFdGFyQNoxsb4gJbVKBtxC7hMlqpkboJhTa6xpQq2uO
aLNK9mf8aMWvxXAblEjtfEFLa1Vx8iFVx95ozVYNK58RhBcdObboKOmjXaONHJcQdFzZlbN+0S3w
wTCFHgxL5hWN3Iesu0PGPYlgo7Nmoa23jG1zyPqc6HYmCI0bAgsckj3BrKqyyYUWwwRbhZulTLlE
HfOHkDvMeUMu4TKk84xN2KZhrFJ4Ewyt0wm0QSHb2c1e3YcMvWCvJmfVS6hZbIKhLJJCJFIuFxOO
6DCijDzWIJLTeikaNnRWjD2yxrnSmBRvXblA1hRrek32vF4msYJQ9oGxdXZpHrAE100weMMDtuAh
p1y1cRlSeawGlVStVomH7FZAZitp5iVa000suO81sL7X7EqaiLOJQNlcrhCbm000lNR6GAGyuRwQ
nZs9MGWuXe3RFkWGWhST6aJKtW4jQJoZerQoKxRtCDJYdIUGIpNqVRptIsFhYMPCwGTLJHPtcsG3
EBtOziY/olE3udDBQ2Zo8DBLUIoV2eRCc4yG5Bi56oV61SHdKpBqJSk3U+onhY5xGzTGnYzizUo3
DWjsgD0JmevHsFp8EwqsmjP0UkOyPbhw400osMjjUI0nNw1ZhW2TCaVqRCCqJvsAaliRISsq2Mqx
dDLNpYyZBsba29J9UcbaTwyNlgV7ly7Lm3IzoSHBFJIrCaRwkdjEAmlmxron0xmimnccYTKQMDIw
iaNU435gYBlKwNXUSUshtUnZ5EJpN4h1y8IYTWUs3BIs3Eoe10lLexwIzzg0bMgBjZtfeff5cf3C
V7+6ffXNt175+tnTm9snXx5vnj5ff8YXx5snz++/+vDp8Yvj/fr7bz99/uXx9v7u5qvvb4/ffnj6
4q+/+uLZxz/eHH/4+Ivnd8++O3748Ve3d+tXbX/6ok/fP/n05svj3d2TT493H357fPL0x9/+8/nt
k48/v/3q+y+OTz89Pv318zeXb75bP/XlV9/+eHP3xZP171x/wt3N3Y+3H3/27Ve3z+6OTz/83ec/
Wv+qZ7effvjN6X/vw7v7J/fP1y/efvkHo918/ajr+d0/ufv87nViqzwpmQpZmLb9EraLyWnal/2a
WXz75TdEpXv5fsLvf3Bz+ofO/6pVaut/v//TN/wa/fzaqz99I/3X9VDvn7x2/uX57dPjJ89uj09f
o99+//P25Xr+Nuu/fnG87b/5+nj79PQ/uP5/3vXP3K8AHe8//PbJl+txP7+9f+3Z7fr3PLv/8fSH
p89+effp+U/o/KnTd//+U7fHH+4/vDt+8+Gzp+efsp76s7v7FfXff9mT7z79cP3Z364ArT/u/vga
vfHr548v+vQm5vYtf/dnf/62D26+fX57u37H399p8rLaG44LWgfZF2lsLMx24Jh0X7yuWFWvu4Ps
ELSKXNF6CLS0ctve97+AtRSrpdYoBznYzDwv816qtb1LjSnk78GyuKH+QTZ395LwsrgAZpFGzAKA
zOKFmFn8V0CTGq4ramEX1IrsJpJpR6aThcmsZaZDlcOeLdY/u16xR0SL3fmE1pqGrt/6/Iv7u9d5
2YmVHa3Oam/LPE0StN+7l7mpt52+8c5XH7391d09gtvVkT0MbtyE9PQCzq+ObK7LtMw8S4hY06nR
TE4U0XSRmK+O7BHREj+VWKWxXtBqs6i7uaibteYxy078MNfdGn4sDbKJ17v1QGixWJzQ+tWDOdUw
ntoKDRnPPMmu6Kx8cmqiJFe0HhEtbdxOaPkFrcnLfmEptJTFatXZZKqFvLbFm/n+itbjoRUsp6sl
9RJuAEH9v4Yb5RTXl5ce3Jdfg/uSD+4LEtwzF+cXAlj+M/E9ew0/Qei/Qbjfz8ueSOfYLzYvpYVP
Mes+DvtWDjP/O4RcVvT6B1P2lwUhlwuEXNIQckEgFHshgFz+KwAquZQTgL8L+Vv1YrrU/Uxhsl/m
MOL9KeqfxHZT/DuAKjfUP3DV5vKSAFS5AKiSBlAFALAUfvEVVPnPIGjKJwB/jf1j4RU6X5YmanWx
qOK+L63KLnRH19j/EcGS6vRHtNSVfa+TLosYT2U6hE3zvI/dYdmVnSFoXeOTh0FLmYI6WmfjCFDE
/2ocr7g9NG7stdmKm/KvrGOY7OagEGmmB5rbYZ4ruR72835xR9C62sSHQUuoufwOLYBzBNC63q2H
QcuU6QSWXEwiQOlfTeKjw8a6GUS9oAZQxP+KGvMN9Q+tRbysIJ/5AhxzGjlmALoaL07S+D8DHrl1
+H71Z7472FSbysI2xzIfRArNIjpNqlquV+0R0SpU5A9o7dZAnq2ET7swbmWedlOlw87XWJJtgRjj
a/TxQGixhJ7QsgtaVusk5FrLsrMd8Xq3TmRWNKpxWA5Q/ny9Ww+Dllhr/Du0ALbxitajocVFOU5o
ld/CDp93h6mJzwduRmVpvCy8n6Y1XCy7NcD/97DjittD46ak1Ttul5pn8TItO9/TtLOlaKy4cZl4
/Y1OB7nmz4+IlkjlekLrd2U02okepsVt2s+2TDQvU43G1ZRWT3ZAajCyRffbx9oiyF4SeCy/Bfjy
EiJ8QUL8Ru1vgnz5z0T5ouKt43jhQWISoQjZ6Wxh83Q4RfssazwphQnihq+37oHQqhz+p1u3263Q
WOXCh5W3Wi2mHyYr+8P+4CyVgeL11bc9OG7Bhf9wy0hZDk2Npbgddod2gnCp5GuWNh8irmg9HlpK
IfqHWwbkZ/96y7SeQKsvvTxdL9hpTYOnFUCPQ15cna7/FQDFuW4AnhuygATget0eDS0Oq1vC1jpa
gEu7ovVoaDXncgLr1+o04Mv+1TZeYXto2KKGbbD1OwYkawhY9j8Fy/7bYEmplf+AFq8mcZp9jjqv
aO2nOEzs4YseaM+LXovTj4gWl1OsYdSxAjoZ/xYrjlN0GC+9BTUueHG+i5ihLuK/4T3+My3EorXW
P6C2LEQi09YJZwfdx37yRky0LLrfy3Vm+jHRaqx/RCvKRDJb2S1zNbf1ZvEUMvukqzfjOiNoXUmq
h0GLW6E4ocWXEBG4XdcQ8dFxayEbbHKBDZg6+1fYTs4sXnKzzq/uLO/NIGcmLwbuP+PMuJ62IZL9
fqJptYW7Jrv9YRGjWdviB57WtkbhxXdqJ+Dee/7Rl8/u74/f/tul4xs1t5dVivmFvTNbchu3wvB1
z1PkBeRgX3LHVfu+M5VSSSK1S9S+8OkjdttjNtmJRRmJnVTXeMauMU9/B/iBAxA8AD47Xez2LCC/
YAT+HNqQaeumwBzZCBNJuLAZgIYtNMIsgMi/fTGD4vUXYy9CEApVdbh/IxkUP68ZFIkuxyEVkn88
iRQfagcR/wKBoBQjQbCAAv8p5UNP3d159Ae+Cf3+SQEwxJQSxBkj+AHdCecw1D2yjoJ0DVoWtizJ
EBG6rgvDRIZuA84lsOwHou33QVL8rw6SUMrfu8dCwl8vjopuINUI0qgBdQIEJkSDmgk0AjmCgEhs
6nYa5T6npf8Z3ejrCaPfc7iYDi0ETd0QCBETC80QUuOIQIIxw/hzj/Yv1AoCTOk7tQxuY4wI51Tj
BEsmhKTQQABRZjMIPl/4fqFaWL4OZVhE8vw1ynSODIRsjRiC6UyaUJgE2JoudaH/OCBy9ALe/kMQ
E0KVchx9k47//G5e/shuXgjEh/Lx32YzL5T49Qr46DcdbENkAdMgAurEMIQOJJKUcGRJKiSlPxaQ
8FA7rvpIBMK/CUj4TwtI+AMCEoY/FJDw30bAr9eKEfwWLh/of5/h8pephQTAKKLWA53tAbX+Zyf8
6PdWCxLxdp9QJOMOEWjZNpEAIyIMphlCAMq5aXOpMfFAnuv/gWwM/966IQgwDIXj34R7YGnlAeEQ
Dn/BF4gwIQT858VD+OfVQzgxKxEEAwA/1BDhj1dYCPnCoRSQCQY4JYT9qelDT93defQHJlZYCP1C
IQOcEAqAIOzH+kMGAH69ciGd/p+ror9B58UAQPom3rcECItCZOm6LiUhFFCJiE4kwFgSptnm5/64
X6gWApixUC36TS0hDZshw2TY5MTGQtMYk1jqEDJAMf3Mbv6VahEuRKjW9zOtTY50RrHOdUkAsSQ3
GdGFRYWl6Rgbj6j1+bLwn1ELorcbWaj8phaEyLxHPKlLQxDbtjUTYikgZkRagsrP5NhfqBZijMJ3
amFmUgyoZRgCEaQDySjUDSCkLohl6Q+92n2q9Z9RCwMM6Tu1TMGZKSyCAADkro9EgkFqMmBgyKH+
2bd+pVpQIPxOLYEhBAbTDQNLIinTkNQtXUgdWJYB+Oe49QvVghTRUC0GItlEkhoCAkQ5RwQKTQim
W5qlSQMahmal24X/v5p6DtnvLRyCTMpQOPh9QzDQbKATG1GNcEA10wCWbkJdMgSheKibfQbF/5Ba
GEr+Xi2dWUgKzDjSCTa5JgzCmWljiIi07IeO9f8Miv8ZtaSQKBQLfYuJD7wpp4iJ/7NryRDL31w5
CDGWr9K99bMHUn4eEOwzKv6n1KKURNR6YOrxgFr/s92L8N9bLgQEE+/kkjbQdAk1aUOTENMSxIaa
NHWCCTNM87Nz/Uq1JKfsVa106eaPjGLwBVMgVaWK/Jd1g/w372eCYBgKR9662QOy/bCbMUzpfyHL
/D8hFyK/+ZsYBJyKd3phxAQCBqO2iYhuc13jOmWWDoCBbUP/fBP7lWpxSNA7tYimSUtKijhhRFqG
tJGBqE0F4ha96/ap1q9TCwHI6Ve1vg1ijEqD2diERBAiDaYhXQrCsKQcYWTwRwYxcv8HvnBAsPgv
ZAaQnxeOJPdfUCzhh+qRD9WD4ovgFGPGqMSISML/FPOhp+6+PPoD36R+9yTjgkNBmYQIs0fyQhAU
iEX66QPpXJ/99Nf1UwjQ6/oW/dZPH1jh+mE/JaFoBKg+iov8qR35efHII+r9iykM+W30wwAR+apf
ujj7mYX1G4iHhJSvofJrpsgD0v1LtTgn6EWIFy4wCH/HSABElW0J55ygb9pxTlBCPpF2nyrnBCUl
FOKD/Yqcow+F5AJ/rCWSXxgmHAmBAYGMyQ9HTPkFAMiYlAJIRgRl74V++NF/+0MfGDEhoOz1vZF/
//AqCJeUGoauEQvbGkAWBwLrEElhyc+tc7+001IQjpg8elcO51Q3NY5tyQhkUOeWjjFlhq0Di7GH
NhZD+frrBQpMJfsv5D1D+fPiQZnorhBTBtOcTkTYFy4lh5QCIhHi6E9FH3no7suDPy6uNiFfOKYA
IcixQBjKB7SXHMJQ+6+JmA8o/2+O4qb0ReAXiLEIf5dUMq5sFxdElH6V/u3PiXidNusdIko/iNc4
sW8BEIA+1h9jkaYXQ/GFQMQl5BQQLCGKBeiHH/23P/SBAC2kDN9lBYn0eGgw2wBEI5pOuMUlEgQZ
3GISaxrQ8SM9/n/+uwcSiP7mu1QwwFS+apcuWn/Oj38D8ShGMNSOfdPugQTCH/Y79AJe/6UUK5MN
fZPt57c8P7LjmX4o22+z3VlICN5k+zZI6oaBw2tUmWQEM6gZzEA2Ypq0NGlanzm6v1AsCDFEoVr8
m1qI2DTU5S4ZIzqHuuSSEsug1LKYZf5wWR2/cPY/mz34u6tFqRRvan0/CoLr3JLIMJAERAimizBV
hhPTIpoFMfsczn4T8RBmQr4T74HO9inebyIeY+hVPPkWJx/odz9Qi79AhLmyFbpPud7JhbgIhzUJ
3uR64PC3z0nIr1MLUyoiaj3wfv3AgagCq+pb/+UDUeVvchzqH9Z1PBtupt7hL/7mL3/92x+b4dp7
Od623ot7uiu58l6Gp6M/uNekd/Re5pv7GLUZrl7utXFa3x0/vGz91Xx8++PFne+98fG7WhHN/hiu
d1/e/v6Hj02GG/90fHn77V8/NvOG7r32Xr7+/q8fXA+P49mPH3trtPc/rPzpy9HfzscPPHvcD8fe
j55+++t/89Af+vy1sX1T4OCf9mNv8CrE1z8v70+8uN7hON8Mj3N/8/aXkf/x9sT+XmVhq116t+8C
/fHifZX46ctGdifv9Lz13//x3YWn7zkMXXjeOurC09/AQxeet/7YBcNEhJqAWswihq5pSALL4pzq
AnNh4o9ceN466sLPzU5DP37yR0Sdefr01tCP562jLqQ63yTuwvPWT7vwZ30+78djkvzwXK0P6uN5
66gLT98bF7rwvHXUhae/BYQuPG/9sQvI1ADSTECwRiRBOqY6sBmyLUgkMj8MV89bR11Itaoed+F5
66dd+LNhP+/HY33jh6kcH9TH89ZPu/BnYZ7347H6SHvVQejH89ZRF57eHx268Lx11IWnL0oPXXje
+gMXHrg+6QMXnreOuvD0pszQheetoy48faJ46MLz1h+6oDNDM3SoI4kQEVgTQAccACkFNpDUPxy6
nreOuvBza8ehHz/5I6LOPH2mcejH89ZRF57eZxW68Lz10y78WZ/P+/GYJAYljDImqY1sokOoG7qF
GBEWR0xq8sOg/bx11IWnbzYKXXjeOurC0+eRhi48bx114env3qELz1tHXXj6HvTQheetP3TBsnTD
AgDr0jKIblAhuSZ1bEnbEtTWPxTieesPXbCRRZGABCIIiQ2lhi3KGQcaC1/w0YdB+3nrdy68rYwC
SBjUMCAYASIJFpYhiSk1DjSLWgxEwWltoriU96iHuLQ2UVzKW1NDXFqbKC7lWW8hLq1NFJfypJcQ
l9bmQ5yGEJASmVgnkuiabUCiQ2SaFFEISBSX1iaKS3kySohLa5PAPbDCFcGltYniUt4QG+LS2kRx
Kc9jDXFpbaK4lEkfIS6tTRSX8mNciEtrE8WlvPIrxKW1ieJSbiMOcWltoriURyCGuLQ2H+E4htzC
GjYMRKBGX+dWum5J0zZMar6LKmltoriUZ/eHuLQ2CdwDK4IRXFqbKC7lHuYQl9Ymikv5WTXEpbVJ
4B5YWIzg0tpEcSmT8UNcWpsPcaZNNCYwCodIadxlRxToCGFNwxi/a5lpbT7CSYJMXQKJkCDYBrqw
dZ0Bjm1LtwzOo7i0NlFcyqTNEJfWJopLufMtxKW1ieJSXk4W4tLaJHAPLF9GcGltPsJRTjXD5BbQ
TGJQLA0BIdUglgbWbPSuMtPaRHEpD38KcWltErgHVkEjuLQ2UVzKU1BDXFqbKC7l3r8Ql9Ymikt5
mX6IS2sTxaU8uD7EpbX5CKcjzDnhCHNChOBSRybits7uwYgb4t0AlNYmikt5a3qIS2vzEc6Adw14
OIfDhBlEMsS5RQVDpsQmeDdXSWsTxaU8NCzEpbWJ4lIeABji0tp8hOPUMiCiwKAGYQzrBGmMAs6E
wQXh7/pdWpsE7oHl+wgurU0UlzJZNcSltYniUl6PFuLS2kRxKc/ZCnFpbRK4B9a1I7i0NlFcyqs5
Q1xamwTugSXzCC6tTRSX8nKMEJfWJopLeRhNiEtrE8WlPPA+xKW1SeAeWGWP4NLafIijJiRUcs2U
BAqqa6bGgG1yZFFIjHe4tDYJ3AML+BFcWpsE7oHF+ggurc0d94fhbw73NMz9t9zO15/zlr0Z+rHx
VoPt3H0Zf31scBxOX8KE3b23O90TZd0/firH7l/tuRQUf92jEiaoju/QzHxf08B0XqsahZrQzVH+
tG0V6q8Jq3+kSSp7+7Lxb/FIEIbeLqb6zp9aOTPIX/zCvrcqdafmbN7oUi09/9E6YAzAuw+IRHzI
aZM1GFd2o3q/1N/Xm7dpn37zIU3y0AN1gCGA4m0D5Xe+Zw/2TvXoddFqYG8rwaxuTkv19PxH6wBR
JkMneLQhDAJWJVkeLA/WzDn09Y11KeS+OpEmY+iRSgDwdQMHjDaErhs0sxMkWrO9YQ6DwJkb94af
nv9oJUAmvp7oGW2N7sbqBpejfTFv13aBjsyxuflaCT+VFPGvlIAcgFCJqBN9MneclmbO/cZgAW71
Odzj3uXNiTRpAI8ogdjbEfjR5tghmW4DN6zcaKF548O5Ua4eoZae/2glYCARDZ2INodl9myfCusS
9nKDZQfVtlcf8q9KhOH4gcj4o2j0dbtltOrbY10IJi/DrMb4RgybJenji0IqZBCzeAzWipVpARrO
UN6Q5xyG0ykoFqffqQ9EwB+U9e2WcUhYNOpdr/7BsBcyN7sQxEtNH1t6XSUVCfYFw3cdDK8Om/qF
+z2rMGNLW/jiFFgqiyrR67FbAEWgq1Le74HmuDX1+odrM1sYLBxHJZSA13tuIY1A9Ut2O1l1Ky6Q
s6Y5K6xQzr6ohEIsQNiAoYhQuaNtpks01ep9pzKazKhhLEuaQirmhITjJ4xAb5fVvlon8tLdLf3h
rDKusdNaZVGRwDKcueCoqpP5abpGYM/PixueOj1r1tIzKtuvFK/HnGIaHSUbwX6CqgvaoqfceDV2
9ZZVUFq/4PWAcIKi0HN/o8llc79ljfmtsDV1a9y7KIRCDnlYvyTaVaW3LFmD+a65NGbbZYO7YHlZ
q6xfBBl8LWs0Kl35rbU+2CaT9XO2cNi16ofrQmUFC4TDXkOivWZ/0jrrwbHXN6ajvHPenjuT2URl
BSPGaYLab1yap/bumOvWDtcahqebp41UFhVJQF9llRHqoQwna5e7tdK0Vuv2TsfBhHWUygr4281w
IDrEaSevfDD0uX9kp+zwslmhnaeUighicWq+XSgu7cDrz/r6eHM5oct1praslAAYpy68g8Hd+iK/
JJUROA4D6zRaqKRCCl8jP40GYUvuJ0trheaCdJa7eqXmdU6BytYEmYA0TiWtwFmJ9sony2HQcCpB
c5J1VJYVQyATZQWd5tAUt57VAk77pBXYVetylf1VMMBDaDQK13u1JpvbmerQalZzXvPWzMGMylEO
CkpYnMpGhVG1ADZjsxtsxWWVN/292iDBKUmUFWXIzePlba+Uwd65fRktL01fZQVDwBGNrwXwJaY3
L7vZtXazjmkUgFeESssKiSAgTnW2jfVm3TY7u2ndrU7YsNN2b2p1xTRB7Y+hPgyy07Kjr7adCWqu
+4WjSioH/HWxhUTnpLtrf+b5Ymn1aHs/rPTWt31FqawMIhan3mo7fzLG/by1Z4XytrhulMdCJRUh
QRJl7d6G4DzttMsnbcn15m1XyvCLysaEKMEwTrVaeTO/2LMrKFvFBW245xn0VMqKKX6t4Oik1Kg4
hzvMWaKL2Z5JQovgrLQtQcSEiFPnmcW6Vyxt6teOb1YrgXvOt2tKqVjIBLV6q+C5VrGPqHfon3Ld
1nxSqaqUFQrKUJxav4HtJA+m2x1uW5tqcbQ5mCOVZWVvF0fS6FR4lhs6mrHb16bDy2FaPlWxxzSV
YyvkgIo49bJfrn3Qq8HiddL0oVUtVr2sSiqSArE4dVk/D6+1nuHSDrS6p02+lG36KqkYAU7iVN2T
Zg6P7Xy2XnYHe2vsn02qkorwa+AX0dW1U83RS+tjdljLHfrlRdBy7bnKBiy4TEDzlcWlvD+VVtjL
7urCn7m23lEZgiGlWMapK80QBpxlwLXTyVB0zLd8U+m6C2QI0jgV72a17Knk9FpbMuqNCdOMtamW
yhiLU+VAHwhXXvtbJ9u3zO2lLzZjlTWMMCEJXTFw7EW9O6hUDC1brI14cQ/LKhsTEiLZmmgPWtNu
NV+Suc6MDzLVdY40lJaVgdfGFH1vNfvOyl8hv2Pe9DG/6VuxX45VFhVLBuJQGGQOTiW3Lsxvnijl
3ZJVP21VtiUEmGBx6rV6a24rTvdw7ZTkmsrcWLtWVBYVQcxhnLrMlDOzw62/vSJn3Ms3yqJlV5Wq
igjAceqo0eA7dmrU1uBw2bdICw9KJ6U1LCRONKb76/lldSpV3aBsFEedbrluIqWLs4zztxu8o5Ef
+1Uny0986BwLl1Yxo+V7M5WjDedSxKG8vd80M/xskU0wsPWx08zSucqSQooIiVPXs4tP50jr7BtG
5jjVhrfcFiptwZISFqeW3cBzbsPz1pS4W/Iai8Pk1lJJxQiARA33DIJgXbs1Ds4BmZLxBXbULoEg
ktTVHC/r+fkls5r1lsFkS7PZunNVqiskry04uu6yMxpkk1lC2c+1V/Wh5Ttgp3a4QUDGoedW++IW
YG94LDlupjHr3VpDoRIqCE1AZUcfeKPrGi1agyu1LrVrGfdUQiGWlMapbpPyfW5z3E7IrD2ZOOf5
UscqqYgKSuJUco9G7MTX66lBMuYB42Z1q/TlBnGBYZy64o2a0cpcr8Vyrnk5FXu17KislCooSNTw
MJu9zArHG6A5/9LUbwMBzoFKKgaEJvrNMTMD3S5sYKBVtzletZm7UDrIYUhxog1nr6VbwTP7q7Jd
Gk4G+97kVlM6EcaQJbtrxvVGh7peWIl5c7k0u5VTMLfUhkOe7DnlzYyUTst6nxwCfMwcAq0RqP3u
iXgySszH+mwwzS0MZjU62yKGWX+JlNYwfV05ZNG1WVFi+gLTg5ufz25ycuzc2r7S1R6KUQK6WC1u
RiWDeplJbtwudmrnzAiqVJUyQOLQotaq9Dez7Gbb3QN3WxJsDtR+9wQSyTh1YuynWO9y0sGaLc+2
ZG5O6VIExAiKODU/t4rtDBKrU7AFmQqc+mOtpLSsVFAUpxpseUDOqcG297gP/cZwiMaGyrYEJQI8
Ts30RYleenbWHGdrW61T61SqQGkNS8QTuhKmD86LI/B3R1OcM/vr4LLPqKxhhAVicSqv8t2x0umU
zMUxuBSu1fG1ovTrAqKcJ3pORTY2eDDe2Ef/2jXPm2OnNZNKy8opSbRheT/aNBi480G+Jvub43Sq
jSRRqSsSEiXa8PRo5Xvjbm92pvMuCGChQ8BRbegHJFHDS2BXUed2ds01n1/vEaqkZZSGfkpoIimu
uZvvoR+sz8XTogAy5fxNwL3KonIAYCITj2QaPtx7tEwFm04bHY27plKoJCwOXVfcxna52/f6U7i/
tOi6O8gqnacJgVAcivrHbL62q+/gYVYvTHzPzJ/7KtsvhFwmiroJGBLT+rE4q23L/SOGeSd7UFlU
SBBJlBUcjHtXzfNAH6PuqrGpNZqDi8oIAYlgIE51+/69mO3L/eTjntfyPadf3SkdWxFmOFHDg+4y
d/I8Z8GZXi5ZdDk51soqy4ohQiRBPY2kx4aDe9pWtdEao5nXHgGV/QYjIHic2g62o2A95ZXL0imb
q9oUHFyln3gxgknqeZzXDq3mbbg7o8MxWw5GR6Ookgq5BPFk7U7H2Zgb3D66wfbkrLRR4B+HKqGI
iUSGeB2QfM6ttzq9XuM0Ps5v56u9UgmFkNEEVXZH56G3OpD+DPVluRHklqyhNEZQjHCcWtpmSqtj
OU9mLmtkzn05WsuR0t4KMUnIOpKZne/ozKwOtRnPWd19x1e7CAKxTJS1X2jfXxi51xrUp+u8VaWt
4XyrlIohgwlq1dudQTVT07hPtaYpV1ZVbeYso0zGqX523OwvjMK4NNM7BiQEw53SN0iMIEnUMAJk
LJzycS2JVais6pWhJ6HKnoMRfIXS6ESY7PzxdUYH09rxWpvssj2N51TKipEkMej9exjpj5vnghzf
+hX3ehmu8oKrrF8oeGLXxnbcztjHK74M4cC7eO6ZgdxGafUCgGCcSpq3hdHxBGpNzkvD75eECU8q
Q4QA/PU9g0dHG1CoWPw0Xi1b5CAyHcNZjzSVRYUMcxCn5vfXhWs1jGO23TXGncu5gQ9TlUVFEBEe
p55KpVwHmCeKyUHfmC3Pu2dEK23AAFAUp9oFUfSd6rit3zcSDOrcwh213QbBt2maiHabdnNQyIzn
50L5eMpY+Us1UwxUVjAEkIA49dzo2Fd847PxhBYGfd6uZZDSWQQknOA4tZNdmnjOigtRzhwnY3c9
y57bKisYcxLGfQ6imY67RmlN2wPdrGwy83ZzWJF6oLSoCDES387W7nKb5A/WRl5yjRyslXN5tWMc
BgCD1wXaaDjcZfXicT2plCormj1I6WMKVJZVShaqylm02yw9TY6z+ZbZvJ0DctvfJFI6OUQc8PjG
zSvMVSxz1Ctfj5dRLWvJwdbsqqxfSDlgceqwZ/fbNixkg9PUPUALzGBe6RdeCJF8VTXabWrHaY/t
yy1nn7sUptlMnQQnpe9UECOeoO4L52NT37v50j352u/oZNVgSj8GIgIxi1OvhVNL12YWrmh6QHDr
uBjaB5XhEEmMZJzKWibyDvZlLYNms93ujrMry1bZmjDEMlHWcbO8u+y6BTrAmwmlm33QMZoqywqB
lK8fcWR09u3O/PPtPFpUZpfD7TJqZfXpWCUVAZik7tqndb7Lq/P2bFMsj7eFWsFFSlsT5pzHqcsF
CqbD4nXWpPy2mNTn7du8p7Ks8nULpADR+h3mLNnZdgd8Xan0pmsns6uPVIZDiCTlceoJ2dbqfHGP
dDS45/loPdTa1VSWFEopcZzquf4955zP91brHpOqxeyk5m9U9hsEuUzUcL1TdMCteGXZPMansZbx
a4O2yrJiBBGMU4u5c5O0M5XAb+fqtYscTL3yUCUVQvEKffddmXk1VN6OqBaMzFJDq8HduqEUyjGP
Q9GtDvu3jiuCdbeHs/ViGV+wSijihMah2iXXmgzum8ZIv4ibZLOtdG2lGy8JhyIOdYJqi09td94e
WbtjZ3vko9lNZVQiAuE49Na53QbazWRuaS+qM1I/GxpU2WkgESRB3Rv3byfmulhG5o3kpzZuXQ2q
kooBJokKrm4vTlec89QdF/rblemBkmOrVBVySl4DBIruR6le+25vszlrTaKX6MSeZrdqu6pgFMSp
3b1+f3Uzid2+9eSwVXNOzZvSxoTkW1FxdFwN+vWzQ3PeyPJdoyhcv+uoLSoQUsSp/Xb2NCCXpTG/
Z1lOwOq67dWU7kJHgEsQP6cCdauOf19KG03bFX9htom2mUmVFQwJx69ljb5TBaJlaoY3OQx8y5iW
1ov9paA0tQdyIFicOu61D0fWXnXdSw11g/2wAKtqN2kwimScegz0xvmMbIPc99G2ll19OZwrTShC
DKL4QUB038lrruyUiwN6gNAvglVf6X5lQbiMQ2/W+TRpbemgtB9cCludth1T6Zsy5ChJrU17l+5x
qWFp1TK97YGPW+2CWirjIE7lp32ObGHJzaxgvnC6jnJ9tRsgEWIIx6n1XMsZlvRNe+nYgXU7G1ti
eUqpEjMWp8p+bTybd6Yy8A6YyE0wInylsgVDCWX8KJvG/fWxXCvpRaN7rNvTnG54A7WLpJIJFKe2
eotxJlvg1tB0tSq7di+b6lJlBWMgqIhT80e/7o8PFWJmr6POtj4pnCVTWVaK8Os0WETfbvalA+kd
rhcxGrhN4+KV7tsR1ULfmtK7jVy+Pj+dd+WOD2bWoMQz4NRRul1CIonj0JnTLXi5wkKuD0HJ5X0Q
1CBSKSqiDCXqF2r4RAAxh9PWdCeDdnE8hyWVRRXkbYiT0Q+t2Sk8TvaTSe+6a27u38hKS01pWIIQ
cRSnHmG3fTygLDJp67YLRtkbcZRul0CIcRmnBszDPQGLq+PovrzVH1byTbOqsoKRIBAmqHJVcxqT
DjLkxa5mq+49bUDtcE75a1qEBNHZt1ttNrZeviW8YXG+sU7DaV7pO+vbm0aMqp0XmYmsZgq+3Czn
JzIp+IdBpIYfOEzwBwlb8PWbMor2G9EBl1N37Mqpds8Ppn6jyQ+FukIolBInTscAjWytOSoSvjgx
ecpWurnV2dZUUiF/2zZMozMmLurZRje/yUxPl+W1mz9WzYFKKkYsmRdRXk/ym6s+LTRL/qDuzc+j
c2mtUlYMMIfx7yidwMXrzdEqN1cttMsNFpN90VKpKwGYxb+j7AbG+Drc2vPVEY1Xm5tfqW4mKqEQ
C8biS6TyZFl5EPQKw0N+VtUs68iId1FIxYDKBLVUWjanjV3utDk7w+soG0x0bae0MUECQZzqLY94
se+RGm5vgnydNjodsVdJZVgkVtOWHilX67fa6pxByy0V97X+XkNpC0YYxtciakbHOOsFoF3Lzjib
cWVtsuqrLCmSQMo4NSjWHKM9WRTYrEWyQ5dYo/ZMZVtCFAoUX4xYbkaOrldhob7ON8fH5sTOXPIq
KxgJQBKLEVc8Q9566Zh7Z2GOyu1c25nelNYwIjD+fn6Bp+lZbkyXTyfza0tfzCfSVVnBjFAUh649
y8vUhNfKH6q7S20cOM3hTGX9QkxkYtllUfBp6VwY95zhxSU3uM8E07PaaEhpYtnl1Bj458yw0hyd
YTnIj+7Ll8ezyrJiIDCNU+1ObelM7zvVZnmoD1fzSoeYB5VUhCRJrLv4YHGhhdrJWWpuz3XMHqL5
klIqAZTEqWdT6haY4wLWD5l837+NLvmhUqqUQCYOm27QcXOTuR0qObeVXZtZGDShytYkOEucMp7D
3J1qFQGy0CjdtzFkMkPNUAmFEFEYpw4Xdf8qhoheFtnrdI3ni9Gxr7KCIYMMxKmdNuVXQlx7Zm77
tNdo7+fZusqyIkhA4gxhMJ05wS7f0fWgOPVl/1pZHNYq4yFCjJE4tT6a71p+VuDbQM4awmx1EVwr
LSumydZUvDSKQnj44hV8bLZcOMhnF0qpVJJEa9qWrNbmDDQDlTblTMstVubuUmkNS5ksKxrPeZnn
DztwyptzbzeYDeyzysEVAwgT1GPP9ZbBABdXVtDfB5PSmVevKsuKpUTxpZc1xpP5sJyfzzWylLWs
XVm2Riqh8FtjEtEgkckD/3Kg5858mqt6zu54GHTVUiXjcep1N6xRuan7XWtBq7DbERpTOj+EBAAa
p+LdjfNVsW0ta9eAe8WJfWNllQERUUxFnLqf3Xe0ju8vrzNn2Jp2e619prFTScWMxNd77gfG02Ba
IefL2jlrXVOvMttXGSKgwIlFptzKXzgj3ThdLw1a6tx25+E8q7KghJAE9H7qtrMrigG7HguDanMi
dFw9q2xJEonEIp550bM+Mdxr95RFWtAIpjs3p7J6JWGJ9cq6Y9zTdEv5q9M6tm7GejBuN+YqQyFE
jOLEKqleqCO0gc1OBxiNTtkCerursqiQYJSoYG/RLuj5/rZXXraNm501aLbTVKkqlIAlqPSwMg0y
2FZcGnh5sA+CsndQSUVMAJ7oNoANnQVe2rSKWuVrocnXOVdlt0FcJjvr5bhynfXZPFh6q0f8w/3r
wjyvsjUhIVAiLvGAF6YruEBlMJ/Muyt3Oaq0lZZVkiQ1s5/n3fn9IPX1sZrP7DOZYoUfVJYVYgHj
y9AC5jpVzWzATKnSbhf30+N6e1LacShOrH1Xg2A55935PFuWxVketHIXIpRCBUqUdOkuUac4nRgD
7MjuOgvPOU+pqJSDt28L7yf82XGQA5uRPuufV7PJPm9PVWrKoMQJTTXRNYstQ3rTliPK1fPKNbhK
KMcyoemxlQ16XpBrkWH7fiPB6cDbjZHK6hWAJ6p3e81NJ4NDMMHXVgm37e7W77dVllSAZPWi8iDo
j6uwWMnNWkVsTYbtvNLFdogxRnHqWdwKmWmT4jLb1yeyRpq1UkllUSGVPEFlpbbpl/aFU3s8qi/X
C+yW+0OlVIZooqsGGzI7ucuGzq6DY2FcGRSHO6UjHOQs2ZhGvpfJllrj5fSw92vdSrHT9R2V1H+2
di+9yhphHMDX7afouoktc2WmOwRFRUBUENwYQeQiyJGLgp++96bFJu1iknfznhzyy/+ZizCHGSFh
n1ndk/d1faMLdq46LhSUZCt4FNmbIKPSh2pWkX8+zGxqgCFoFsrlNnUVoVk553isNvqUe0badYy/
nfc5tjgZLiKzIgAoGaudYST5sppPrvxCQ3Q4BdJuJTIrgkj+UMGNxZU918k7OVah9c7NlToTOXIQ
pJiO1V0WxEMxhN7y8MwUdb+ma1sWmlViv5rg7+awVxJMAzaRdLqz1svLoh1Etiph0tisnvFbv8vK
82109dZVyMo1KpHVBYB+oO9s927zMnembLnpSZSAKhP6uAoRp2N0/1zkDG2KzW4ne++lKkVeKHSh
EkH2gV62x3R/LuV9OljL6uZOnGkj9MkRyRR9tOmmnxU2a4r3XIru8Re2my0R2aYYSfADLeFpFvcs
TWrc0fkpuzSV0BVZwslH0tfh0ASX3E7huUV1bqEXO4Uik1II8BitE0AqWaVhdeCN816fAlgIXffg
mHyUV0nUKAkNONSsBsnVJKvgJnTdAwDyWd/WUphJhvOQlukMRyv1neJKZFSAAfrIuu6Xm5Unh9MN
So2qXV0qYy7071OAYSh9ZPXetdMmb4sMr7x2mnLKz0jkUIWAQD5W89e6nblenc6XR8A29k3NL2Lv
lRCWPyq8uEyU3m786kHQCi/1+TUEU5EVhr9cxD9Ga53QbLs96DVZVm4pa8vOFPr5BimDZKxiiwG6
9/QuG2xmGUanzN6FyDkCcvbZh6NHpR8t6fY8TedH8xW9StAIXW9BUCZ0rMKvbY6+0qe7KF5fW4kf
+H3q/039H98p+199GP369gcg9G/q3czuxfomTTJielrZuT3JJ45AFTDO4Pi7NbHRkqHQd6/FHtzc
xaU/YldJRKoS/U3lf89qY+96HlauE1azfndyEbwyR2SFEYDkt9cN5b+pm3LruaXv9Pm2t1+tj4+X
efQSqEIG5d/uv/+etQkA8u7lRtvc0SyQByBn6kmkCjgB/FeV/001d8/Dbds8Cy9trE3wWEzx9SFU
lSiUf1Ex+Jt6eJjTIHve40q6LZAd95fTvhXZrgBwiMZHVCxt5dV4HkljugkS6TYv5zUUqULOZPCr
+ves0zUPXB+tHeCyQX0opYUxEFrhP1YF5H9sWFs157j7ipPtoSntNcmf/W0nMivFHIxP45idPTSL
3LNmWlplLOLhGtqGyKlJlj/O4igu3mWVrKO779VnpA/zPHQmQsvLIQdjNbq0MnsVWnGa+93L8DEd
fF3kdIgBweM3Vy3MWtKzpzW5BvGtS6y89c8iUQQoYWMV6j3byEYg24to5scuDuLUFaoy/nECyO54
fTlPyRn6tWQWmVUpJ3smEiUQS2N0ikBySV6O/Z6mF1mtjMHPtyK7L5HIx/kf8jFHq/gdnpFmq8jQ
v+y8aEUmBRIj8ljdJYoW+82RhLPpnEml97U0a5HTAyAS/8iqlI6T3G82D7eW9IqNFQ1OmsgCQyjL
eKxuqXF1m2Hav5zOCter8tK3a5FZEaCAjlXDrGxQup4d3S0W7Y+qqydHkfMSpRIcv3l9nO/xw1/e
62XLY/8wjcP9cBWJcklGY7Sa39THozpoISvu+bv/qkj6ENqDAZfxWI1g+VjJ85u/n10PoPavNF1X
QlVJxmx8OoVr2v1mY+SvKLfrzXx37d51KLLAgAEuj1WZcnvdVPyRbPapTm9btbx7Insw4JTjsfp1
ZVLWpvNp5g0Tmzh4Mjm9hI5WCVI4VpXKuBj0+OU9TUqbaGUoZ9cUmRVJmKKxSoIg4PP0vtE8m0mz
+bNeHa4iexOCkEhjdTWto2hdVijf2fP1bBY3kiT0LoJBTMcbJXhQdcFulwfBdT6NXtFr2LRCP3A4
k/kYHZab1z0O4TOJNlN/wWsEOrGfN5B87gnR5HMS9irZSNHD2YV6et4XQh/Qwa+/O1Ybt/Cvyt6u
C/O9oDPQo8RohY4bAGQ8VpdOEl+h/gD60aaHr6+LJ+tiP1tlwD/aNfUW22Jjvs66vq2VXn3vM42K
7EwY8I8TQHbLEq1WINuuy3UT6uiUxJrYtQgAMB2rt/7q08rT50slvWtbDTHUFEKnfkIwHKuRm9mO
au+x81AeeH1cngarENuFCftQE3+Xb+/ZLboFzhnAt9kNnis0K+eUjNU6GhQ3v0g60/ptnhh0Va0G
kSqUJI7GamPthm0Azm3hNVfXPD/dmaQKHTiQMDZWt7t78JpydH5yPDtYblgvWSpUReSzD2vW6hrj
qXKpSTjgHJn9kVGRKpLIZ7tKxolmpzh69OtYnRFL6zaxIrIPI4lxMFarKewqUsj6Mm91L+zClq/v
IrNCyuTxJrlp0jh9vuo6d3GNaFA8OyJpIrswwpSM0Y2mFEP6Vf8ydtQ8mM+tm46ByPoSIsExWuIt
0F/R3j8682Zy0yp9SmWRKKOEjdFueWFBVpXa5CtSNL3Gg2G5ItsUIIl9qF+HWrnq0utc4ytVYGEq
p5PQ+v5yGZDHagW2JdSjrlpOt5af+m/1rXORWSGAkI/V2/vRzal726f45MxOKAslsTM/hIiTsepS
J3uYB7wqtmoa0ddiP3GEVhhiIOGxqqwiyZyQ8rmePPbt7HA4BMeLUJVw+SPrYea3yaO6F2jZzAr2
fqTHoRJaYSaRj6wvIyblLi5Xb8RSLeBnNNS+UJUDiMZqEXR789XjazzDupaYk+1BETpJyP+yZRhP
dOKnQ/961PU5eQPLeOx3Im8PGZbJGG3mM2Nye97XRy7Rzeni3Mw9F5kUQIDBWH2Ex5SA5VXZsC+9
kBi1n0ToXQSABPCxWqB32+rK/Xk4H4r1yTF5vp2KzAoRRXismkaoPpOymdx7D7+f+eJxngldxgOS
BKXxnuEhPSm3YyPflBtk2Zenx/tyIVZFnzuVpwtfO+4omVybr/CprvFkCROhKgCyPFZ3fvNsdFna
l25+VB7n0LLOYp+rIMQfFb66nBh7hR69rAtfartsVonYv3tiyvlY5T1eHNE56/3MAlKWd3C7DERm
hZBKcKziA3dOeZZF60pVHYdOy+gRiRyvvw5XNlZ9MzgezHv3sAMIkuK4r233KDSrLFMwVhcIOOtV
BE9WIfWSoiXUDBuRWTmgZLwBXb/0C0NFYKqS55VcbvmtsAeRUQGk5EOVnlMY7jKEs259bLX7KSh3
TGgXZlSGYxX3W/Caaaek3T5Lz1Tzsyl2zRJwiOSxuupfCfNkrsu8SQ/UnvpzthCpQkzhR9ZLfvBl
JZ24eZPMJs5CaWQtEqkCAD9O/qtuNrocDtpXpYGJ1EKye9alyGaFEEh4rGawjR7pCQ5+Gq6i4zFI
ymkgcu7nEI930fpaOy/APXIKnkaHgur4dBO6yiRDmY/RoLyusK/pp8oyLwWytmejeoqcICDA/ENd
muHgbw9yKGFL2g/u816YYqdgyuiHGj66k8F8DpFWqs2gG9uDdBHZf2UskfHOPAkfkbND+13E89bx
niriTOirEQhDafwqf5kEWclZlLhOV0mT+W2yUM8iuxKmEh6jvbHsN/fts1Jr400cv3HOJBda3n9B
TfoYwiJ9ueZ9FcNGOXaaJ4lEuYw/yntaQmZK3v54XddyGt7ettoa/2jTqTyVZxyq6i8XYsbolCma
pMhYm2FlBhD9z4nw96+VQP94ZqW35H63kIGbheoahj0saOWIVOVfxPFM6M9I4k4yo6s2743aBTJ+
dUdFoEo5/WhVpVv1+37OLD2bP3duXMN1WyQCUUABZGNVLq7mk53a8GJa8vp62Te34M9T/77dxHWZ
NU1W3Zvvqvt3P/70bdfE9TdRdb9mSVfH37zqrI2/qePz5duki5v2mx++//3fL9dWRRZl8R8X/vL/
c30u4zau//rJDz/8cKnu8Q/f/gxQSwECPwAUAAAACABQCA5D0CL2MbRzAABj7gMACgAkAAAAAAAA
ACAAAAAAAAAAcmVwb3J0LnR4dAoAIAAAAAAAAQAYAFiHhKDEmM4BdIJcz/SYzgF0glzP9JjOAVBL
BQYAAAAAAQABAFwAAADccwAAAAA=

--_004_0A9BFCC08BB88444B487C782A14860AC04FAC73CSN2PRD0310MB359_--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.29.1376554989.3387.rabbitmq-discuss@lists.rabbitmq.com>

<quote>
- The property flags are an array of bits that indicate the presence or=20
absence of each property value in sequence. The bits are ordered from most=
=20
high to low - bit 15 indicates the first property.

- The property flags can specify more than 16 properties. If the last bit=
=20
(0) is set, this indicates that a further property flags field follows.=20
There are many property flags fields as needed.

- The property values are class-specific AMQP data fields.

- Bit properties are indicated ONLY by their respective property flag (1 or=
=20
0) and are never present in the property list.
</quote>

I'm sorry for asking you silly questions. But how it influence on the=20
interpretation of binary?

For example.
Client application receives=20
Basic.publish
| type (octet)| channel (short)| size (long)|  class-id(short) | method-id=
=20
(short) | payload | frame-end (octet) |

Binary:
| 0x01 | 0x0042 | 0x00000032 | 0x003C | 0x0028 |  Basic.publish payload |=
=20
0xCE |

And the content comes:

| type (octet)| channel (short)| size (long)|  class-id(short) | weight=20
(short) | body-size (long long) | property-flags (2 octets ) | property=20
list |

Binary
| 0x02 | 0x0042 | 0x0000000E + Z | 0x003C | 0x0000 |  body-size =3D 16 |=20
PROPERTY_FLAGS | Z octets | 0xCE |

So if PROPERTY_FLAGS =3D 0x0000 what is in Z image, how to interpret it?

if PROPERTY_FLAGS =3D 0x0080 or PROPERTY_FLAGS =3D whatever  (0x0 <=3D what=
ever=20
=3D< 0xFFFF)

I've looked at other clients implementation. For Ruby I found some tips in=
=20
http://rubydoc.info/github/ruby-amqp/amq-protocol/master/AMQ/Protocol/Basic
But where these constants came from?=20
Are they documented? or it's just peer2peer knowledge?

Or are they client2client meaningful and it's up to them to make an=20
agreement on their meaning and way of interpretation?

Thanx

=D1=81=D1=80=D0=B5=D0=B4=D0=B0, 14 =D0=B0=D0=B2=D0=B3=D1=83=D1=81=D1=82=D0=
=B0 2013 =D0=B3., 0:58:51 UTC+3 =D0=BF=D0=BE=D0=BB=D1=8C=D0=B7=D0=BE=D0=B2=
=D0=B0=D1=82=D0=B5=D0=BB=D1=8C Nicolai G. =D0=BD=D0=B0=D0=BF=D0=B8=D1=81=D0=
=B0=D0=BB:
>
> Hello!
>
> I try to implement yet another amqp-client (on C++, heavily integrated=20
> with our base frameworks). And I've come to the point of interpreting the=
=20
> content header payload, and I cannot find clear description of the=20
> relationship between property-flags and property-list. If I got=20
> F1%b1,F2%b1, ... ,Fn%b0 in property-flags, what *amqp-field sequence I MU=
ST=20
> expect in property-list?
>
> Can anyone, please, point me on any doc where I can find this information=
?
>
> Best regards,
> Nicolai
>

------=_Part_2991_24962191.1376551482340
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div><div>I read the spec, and this particular segment I'v=
e read very attentively:<br>From AMQP 0-9-1, s 4.2.6.1 "The Content Header"=
<br>
<br>
&lt;quote&gt;<br>
- The property flags are an array of bits that indicate the presence or=20
absence of each property value in sequence. The bits are ordered from=20
most high to low - bit 15 indicates the first property.<br>
<br>
- The property flags can specify more than 16 properties. If the last=20
bit (0) is set, this indicates that a further property flags field=20
follows. There are many property flags fields as needed.<br>
<br>
- The property values are class-specific AMQP data fields.<br>
<br>
- Bit properties are indicated ONLY by their respective property flag (1 or=
 0) and are never present in the property list.<br>
&lt;/quote&gt;<br><br>I'm sorry for asking you silly questions. But how it =
influence on the interpretation of binary?<br><br></div>For example.<br>
</div>Client application receives <br>Basic.publish<br><div>| type (octet)|=
 channel (short)| size (long)|&nbsp; class-id(short) | method-id (short) | =
payload | frame-end (octet) |<br><br></div><div>Binary:<br></div><div>| 0x0=
1 | 0x0042 | 0x00000032 | 0x003C | 0x0028 |&nbsp; Basic.publish payload | 0=
xCE |<br>
<br></div><div>And the content comes:<br><br>| type (octet)| channel=20
(short)| size (long)|&nbsp; class-id(short) | weight (short) | body-size=20
(long long) | property-flags (2 octets ) | property list |<br></div><div><b=
r>Binary<br>
</div><div>| 0x02 | 0x0042 | 0x0000000E + Z | 0x003C | 0x0000 |&nbsp; body-=
size =3D 16 | PROPERTY_FLAGS | Z octets | 0xCE |<br></div><div><br></div><d=
iv>So if PROPERTY_FLAGS =3D 0x0000 what is in Z image, how to interpret it?=
<br></div>
<div><br></div><div>if PROPERTY_FLAGS =3D 0x0080 or PROPERTY_FLAGS =3D what=
ever&nbsp; (0x0 &lt;=3D whatever =3D&lt; 0xFFFF)<br><br></div><div>I've loo=
ked at other clients implementation. For Ruby I found some tips in <a href=
=3D"http://rubydoc.info/github/ruby-amqp/amq-protocol/master/AMQ/Protocol/B=
asic" target=3D"_blank">http://rubydoc.info/github/<wbr>ruby-amqp/amq-proto=
col/master/<wbr>AMQ/Protocol/Basic</a><br>
</div><div>But where these constants came from? <br></div><div>Are they doc=
umented? or it's just peer2peer knowledge?<br></div><div><br></div>Or are t=
hey client2client meaningful and it's up to them to make an agreement on th=
eir meaning and way of interpretation?<div>
<br></div>Thanx<br><br>=D1=81=D1=80=D0=B5=D0=B4=D0=B0, 14 =D0=B0=D0=B2=D0=
=B3=D1=83=D1=81=D1=82=D0=B0 2013&nbsp;=D0=B3., 0:58:51 UTC+3 =D0=BF=D0=BE=
=D0=BB=D1=8C=D0=B7=D0=BE=D0=B2=D0=B0=D1=82=D0=B5=D0=BB=D1=8C Nicolai G. =D0=
=BD=D0=B0=D0=BF=D0=B8=D1=81=D0=B0=D0=BB:<blockquote class=3D"gmail_quote" s=
tyle=3D"margin: 0;margin-left: 0.8ex;border-left: 1px #ccc solid;padding-le=
ft: 1ex;"><div dir=3D"ltr">Hello!<br><br>I try to implement yet another amq=
p-client (on C++, heavily integrated with our base frameworks). And I've co=
me to the point of interpreting the content header payload, and I cannot fi=
nd clear description of the relationship between property-flags and propert=
y-list. If I got F1%b1,F2%b1, ... ,Fn%b0 in property-flags, what *amqp-fiel=
d sequence I MUST expect in property-list?<br><br>Can anyone, please, point=
 me on any doc where I can find this information?<br><br>Best regards,<br>N=
icolai<br></div></blockquote></div>
------=_Part_2991_24962191.1376551482340--

------=_Part_2990_17542345.1376551482339--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.30.1376555564.3387.rabbitmq-discuss@lists.rabbitmq.com>

<quote>
- The property flags are an array of bits that indicate the presence or 
absence of each property value in sequence. The bits are ordered from most 
high to low - bit 15 indicates the first property.

- The property flags can specify more than 16 properties. If the last bit 
(0) is set, this indicates that a further property flags field follows. 
There are many property flags fields as needed.

- The property values are class-specific AMQP data fields.

- Bit properties are indicated ONLY by their respective property flag (1 or 
0) and are never present in the property list.
</quote>

I'm sorry for asking you silly questions. But how it influence on the 
interpretation of binary?

For example.
Client application receives 
Basic.deliver
| type (octet)| channel (short)| size (long)|  class-id(short) | method-id 
(short) | payload | frame-end (octet) |

Binary:
| 0x01 | 0x0042 | 0x00000032 | 0x003C | 0x0028 |  Basic.deliver payload | 
0xCE |

And the content comes:

| type (octet)| channel (short)| size (long)|  class-id(short) | weight 
(short) | body-size (long long) | property-flags (2 octets ) | property 
list |

Binary
| 0x02 | 0x0042 | 0x0000000E + Z | 0x003C | 0x0000 |  body-size = 16 | 
PROPERTY_FLAGS | Z octets | 0xCE |

So if PROPERTY_FLAGS = 0x0000 what is in Z image, how to interpret it?

if PROPERTY_FLAGS = 0x0080 or PROPERTY_FLAGS = whatever  (0x0 <= whatever 
=< 0xFFFF)

I've looked at other clients implementation. For Ruby I found some tips in 
http://rubydoc.info/github/ruby-amqp/amq-protocol/master/AMQ/Protocol/Basic
But where these constants came from? 
Are they documented? or it's just peer2peer knowledge?

Or are they client2client meaningful and it's up to them to make an 
agreement on their meaning and way of interpretation?

Thanx

On Wednesday, August 14, 2013 12:58:51 AM UTC+3, Nicolai G. wrote:
>
> Hello!
>
> I try to implement yet another amqp-client (on C++, heavily integrated 
> with our base frameworks). And I've come to the point of interpreting the 
> content header payload, and I cannot find clear description of the 
> relationship between property-flags and property-list. If I got 
> F1%b1,F2%b1, ... ,Fn%b0 in property-flags, what *amqp-field sequence I MUST 
> expect in property-list?
>
> Can anyone, please, point me on any doc where I can find this information?
>
> Best regards,
> Nicolai
>

------=_Part_21_17765123.1376552056654
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: 7bit

<div dir="ltr"><div><div>I read the spec, and this particular segment I've read very attentively:<br>From AMQP 0-9-1, s 4.2.6.1 "The Content Header"<br>
<br>
&lt;quote&gt;<br>
- The property flags are an array of bits that indicate the presence or 
absence of each property value in sequence. The bits are ordered from 
most high to low - bit 15 indicates the first property.<br>
<br>
- The property flags can specify more than 16 properties. If the last 
bit (0) is set, this indicates that a further property flags field 
follows. There are many property flags fields as needed.<br>
<br>
- The property values are class-specific AMQP data fields.<br>
<br>
- Bit properties are indicated ONLY by their respective property flag (1 or 0) and are never present in the property list.<br>
&lt;/quote&gt;<br><br>I'm sorry for asking you silly questions. But how it influence on the interpretation of binary?<br><br></div>For example.<br>
</div>Client application receives <br>Basic.deliver<br><div>| type (octet)| channel (short)| size (long)|&nbsp; class-id(short) | method-id (short) | payload | frame-end (octet) |<br><br></div><div>Binary:<br></div><div>| 0x01 | 0x0042 | 0x00000032 | 0x003C | 0x0028 |&nbsp; Basic.deliver payload | 0xCE |<br>
<br></div><div>And the content comes:<br><br>| type (octet)| channel 
(short)| size (long)|&nbsp; class-id(short) | weight (short) | body-size 
(long long) | property-flags (2 octets ) | property list |<br></div><div><br>Binary<br>
</div><div>| 0x02 | 0x0042 | 0x0000000E + Z | 0x003C | 0x0000 |&nbsp; body-size = 16 | PROPERTY_FLAGS | Z octets | 0xCE |<br></div><div><br></div><div>So if PROPERTY_FLAGS = 0x0000 what is in Z image, how to interpret it?<br></div>
<div><br></div><div>if PROPERTY_FLAGS = 0x0080 or PROPERTY_FLAGS = whatever&nbsp; (0x0 &lt;= whatever =&lt; 0xFFFF)<br><br></div><div>I've looked at other clients implementation. For Ruby I found some tips in <a href="http://rubydoc.info/github/ruby-amqp/amq-protocol/master/AMQ/Protocol/Basic" target="_blank">http://rubydoc.info/github/<wbr>ruby-amqp/amq-protocol/master/<wbr>AMQ/Protocol/Basic</a><br>
</div><div>But where these constants came from? <br></div><div>Are they documented? or it's just peer2peer knowledge?<br></div><div><br></div>Or are they client2client meaningful and it's up to them to make an agreement on their meaning and way of interpretation?<div>
<br></div>Thanx<br><br>On Wednesday, August 14, 2013 12:58:51 AM UTC+3, Nicolai G. wrote:<blockquote class="gmail_quote" style="margin: 0;margin-left: 0.8ex;border-left: 1px #ccc solid;padding-left: 1ex;"><div dir="ltr">Hello!<br><br>I try to implement yet another amqp-client (on C++, heavily integrated with our base frameworks). And I've come to the point of interpreting the content header payload, and I cannot find clear description of the relationship between property-flags and property-list. If I got F1%b1,F2%b1, ... ,Fn%b0 in property-flags, what *amqp-field sequence I MUST expect in property-list?<br><br>Can anyone, please, point me on any doc where I can find this information?<br><br>Best regards,<br>Nicolai<br></div></blockquote></div>
------=_Part_21_17765123.1376552056654--

------=_Part_20_28923711.1376552056654--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.31.1377254190.3387.rabbitmq-discuss@lists.rabbitmq.com>

What is the size of your key?

Do you get a similar error when you use the same SSL config for AMQPS
clients on port 5671?

Does the certificate/key combination work with OpenSSL, as explained in
the SSL troubleshooting page:
http://www.rabbitmq.com/troubleshooting-ssl.html
Do any of the other validation procedures on that page fail? (You will
need to adjust the port)

Are there any entries in the broker logfile?



-Emile




From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.32.1377601620.3387.rabbitmq-discuss@lists.rabbitmq.com>

> On Fri, Aug 23, 2013 at 4:51 PM, Jason McIntosh wrote:

>     =INFO REPORT==== 23-Aug-2013::15:37:45 ===
>     Disk free limit set to 1000MB

Were there any other log messages in either logfile or console messages
on any nodes in the interval between or near 15:37:45 - 15:37:50?

>         =ERROR REPORT==== 23-Aug-2013::15:37:50 ===
>         ** Generic server <0.303.0> terminating
>         ** Last message in was {'EXIT',<0.350.0>,normal}
Did you perform the same upgrade in other environments, and the failure
only occurred in one of the environments?



-Emile









From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.33.1379417667.3387.rabbitmq-discuss@lists.rabbitmq.com>

Michal





-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-=
bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: 17. z=E1=F8=ED 2013 11:36
To: Discussions about RabbitMQ
Cc: Skorepa, Michal
Subject: Re: [rabbitmq-discuss] RabbitMQ - Erlang AMQP client - mutual SSL =
authentication problem

Skorepa, Michal:

> {error, esslconnect}
> =20
> The broker log says:
> -------------------------
> =3DERROR REPORT=3D=3D=3D=3D 17-Sep-2013::10:39:40 =3D=3D=3D error on AMQP=
 connection=20
> <0.9012.1>: {ssl_upgrade_error,esslaccept} (unknown POSIX error)

Michal,

According to Erlang ssl docs, this reason means that

"Server SSL handshake procedure between client and server failed"

I suspect that either party refuses to accept the certificate presented by =
the peer.
Have you tried connecting with openssl s_client to see if it performs hands=
hake successfully?

MK




From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.34.1379426465.3387.rabbitmq-discuss@lists.rabbitmq.com>

Michal





-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-=
bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: 17. z=E1=F8=ED 2013 11:36
To: Discussions about RabbitMQ
Cc: Skorepa, Michal
Subject: Re: [rabbitmq-discuss] RabbitMQ - Erlang AMQP client - mutual SSL =
authentication problem

Skorepa, Michal:

> {error, esslconnect}
> =20
> The broker log says:
> -------------------------
> =3DERROR REPORT=3D=3D=3D=3D 17-Sep-2013::10:39:40 =3D=3D=3D error on AMQP=
 connection
> <0.9012.1>: {ssl_upgrade_error,esslaccept} (unknown POSIX error)

Michal,

According to Erlang ssl docs, this reason means that

"Server SSL handshake procedure between client and server failed"

I suspect that either party refuses to accept the certificate presented by =
the peer.
Have you tried connecting with openssl s_client to see if it performs hands=
hake successfully?

MK



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.35.1380267101.3387.rabbitmq-discuss@lists.rabbitmq.com>

I assume you're detecting timeout by looking for AMQP_STATUS_TIMEOUT in
result?

-Alan


On Wed, Sep 25, 2013 at 11:02 PM, Lothe Shashank <
Shashank.Lothe at techmahindra.com> wrote:

>  Hi Alan,
>
> Thanks for the earlier prompt replies. I am trying*amqp_simple_wait_frame_noblock
> * API in amqp_listen.c example from rabbitmq-c library. I have
> successfully opened new connection and channel and created queue for this
> listner. I want the frame to wait for 10 seconds to receive the message
> sent by sender. I declared the timeout as follows.
>
> struct timeval timeout;
> timeout.tv_sec = 10;
> timeout.tv_usec = 0;
>
> result = amqp_simple_wait_frame_noblock(conn, &frame, &timeout);
>
> However I noticed that this API is not waiting for 10seconds and I am
> getting timeout in around 1-2seconds. Could you please provide a snippet
> for the usage of this API as I was not able to get it from the current
> examples?
>
> Thanks and regards,
> Shashank
>
> ------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

--f46d0418258cb77a4c04e7572f09
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">The amqp_consume_message() function in amqp_consume.c prov=
ides a good example how to correctly use amqp_simple_wait_frame_noblock().<=
div><br></div><div><a href=3D"https://github.com/alanxz/rabbitmq-c/blob/mas=
ter/librabbitmq/amqp_consumer.c#L136">https://github.com/alanxz/rabbitmq-c/=
blob/master/librabbitmq/amqp_consumer.c#L136</a><br>
</div><div><br></div><div>From the limited code snippet, it looks like you&=
#39;re doing things correctly, I assume you&#39;re detecting timeout by loo=
king for AMQP_STATUS_TIMEOUT in result?</div><div><br></div><div>-Alan</div=
>
</div><div class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Wed,=
 Sep 25, 2013 at 11:02 PM, Lothe Shashank <span dir=3D"ltr">&lt;<a href=3D"=
mailto:Shashank.Lothe at techmahindra.com" target=3D"_blank">Shashank.Lothe at te=
chmahindra.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">




<div>
<div style=3D"direction:ltr;font-size:10pt;font-family:Tahoma">Hi Alan,<br>
<br>
Thanks for the earlier prompt replies. I am trying<b> amqp_simple_wait_fram=
e_noblock</b> API in amqp_listen.c example from rabbitmq-c library. I have =
successfully opened new connection and channel and created queue for this l=
istner. I want the frame to wait
 for 10 seconds to receive the message sent by sender. I declared the timeo=
ut as follows.<br>
<br>
struct timeval timeout;<br>
timeout.tv_sec =3D 10;<br>
timeout.tv_usec =3D 0;<br>
<br>
result =3D amqp_simple_wait_frame_noblock(conn, &amp;frame, &amp;timeout);<=
br>
<br>
However I noticed that this API is not waiting for 10seconds and I am getti=
ng timeout in around 1-2seconds. Could you please provide a snippet for the=
 usage of this API as I was not able to get it from the current examples?<b=
r>

<br>
Thanks and regards,<br>
Shashank</div>
<br>
<hr>
<font face=3D"Arial" color=3D"Navy"><br>
DISCLAIMER:<br>
This email (including any attachments) is intended for the sole use of the =
intended recipient/s and may contain material that is CONFIDENTIAL AND PRIV=
ATE COMPANY INFORMATION. Any review or reliance by others or copying or dis=
tribution or forwarding of any or
 all of the contents in this message is STRICTLY PROHIBITED. If you are not=
 the intended recipient, please contact the sender by email and delete all =
copies; your cooperation in this regard is appreciated.<br>
</font>
</div>

<br>_______________________________________________<br>
rabbitmq-discuss mailing list<br>
<a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss at lis=
ts.rabbitmq.com</a><br>
<a href=3D"https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-dis=
cuss" target=3D"_blank">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo=
/rabbitmq-discuss</a><br>
<br></blockquote></div><br></div>

--f46d0418258cb77a4c04e7572f09--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.36.1380289483.3387.rabbitmq-discuss@lists.rabbitmq.com>

the root cause was. Was this the first error recorded on either node?

> =CRASH REPORT==== 25-Sep-2013::07:40:26 ===

As much context as possible will be useful here. Will you be able to
supply the complete regular and sasl logs for the nodes that the
extracts were taken from?

How long were the delete operations given to time out? Where there any
network connectivity issues while this happened?



Thanks


Emile

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.37.1380299365.3387.rabbitmq-discuss@lists.rabbitmq.com>

"local" one, and there are a lot of examples in internet doing "just use
/temp-queue/ for reply".
But relying on replicating autogenerated queues is probably a bad practice
and one that could generate hard to debug problems for application
developer, or in best case just add unnecesary overhead by replicating
queues that don't need to be replicated at all.


>
>  I'm trying to fix mcollective over federated servers, the original code
>> used very simple method of sending request to exchange with 'reply-to'
>> header containing name of autogenerated queue, and server then sent
>> reply to that address. Obviously that didnt work over federation
>>
>
> Interesting. I hadn't really thought people would do RPC over federation
> but I think your plan should work.
>
It is mainly because we tried ActiveMQ clustering, and while clustering
worked fine over WAN, we couldn't make ActiveMQ work more than few days
without it going OOM and dying, and even buitin watchdog didnt help much


>
>  My first try was just replacing reply queue with direct exchange that
>> client subscribed to to get replies and it worked partially, over
>> federation when client did simple
>> "subscribe(reply_exchange);**publish(request_exchange), but sometimes
>> messages were "lost" probably because server sent reply too fast (before
>> federation managed to subscribe to remote exchange.
>>
>
> Yeah, I think that analysis is right.
>
Is there any way to query exchange about what queues are subscribed to it
over STOMP? I'd like to fix it by simply making server wait for client
subscription to exchange before sending reply.

Cheers,
Mariusz

--20cf30780db0a71bd104e75eb128
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div class=3D"gmail_extra"><br><div class=3D"gmail_quote">=
2013/9/27 Simon MacMullen <span dir=3D"ltr">&lt;<a href=3D"mailto:simon at rab=
bitmq.com" target=3D"_blank">simon at rabbitmq.com</a>&gt;</span><br><blockquo=
te class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px =
solid rgb(204,204,204);padding-left:1ex">
On 27/09/2013 2:16PM, Mariusz Gronczewski wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-=
left:1px solid rgb(204,204,204);padding-left:1ex">
I&#39;ve tested it for a bit and have another question: Is federating<br>
autogenerated (amq.*) queues planned (on current nightly trying to<br>
federate those returns &quot;queue name contains reserved prefix amq&quot;)=
 or it<br>
is something that should not be used at all ?<br>
</blockquote>
<br>
Hmm. That&#39;s kinda problematic - you shouldn&#39;t be able to declare yo=
ur own named queue in the server-generated namespace. But the downstream fe=
derated queue is just another AMQP client from the perspective of the upstr=
eam, so it can&#39;t violate that requirement.<br>

=C2=A0</blockquote><blockquote class=3D"gmail_quote" style=3D"margin:0px 0p=
x 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">
Not sure if that&#39;s the right thing to do, but that&#39;s how it is now.=
 Hmm.<br></blockquote><blockquote class=3D"gmail_quote" style=3D"margin:0px=
 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">
<br>
Of course, you could have your client generate a reply queue name based on =
a UUID or something, that would get round the problem.=C2=A0<br></blockquot=
e><div><br>From the point of the client federated queue should work exactly=
 like=20
&quot;local&quot; one, and there are a lot of examples in internet doing &q=
uot;just use
 /temp-queue/ for reply&quot;. <br>But relying on replicating autogenerated=
=20
queues is probably a bad practice and one that could generate hard to=20
debug problems for application developer, or in best case just add unnecesa=
ry overhead by replicating queues that don&#39;t need to be replicated at a=
ll.<br>=C2=A0</div><blockquote class=3D"gmail_quote" style=3D"margin:0px 0p=
x 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">

<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-=
left:1px solid rgb(204,204,204);padding-left:1ex">
I&#39;m trying to fix mcollective over federated servers, the original code=
<br>
used very simple method of sending request to exchange with &#39;reply-to&#=
39;<br>
header containing name of autogenerated queue, and server then sent<br>
reply to that address. Obviously that didnt work over federation<br>
</blockquote>
<br>
Interesting. I hadn&#39;t really thought people would do RPC over federatio=
n but I think your plan should work.<br></blockquote><div>It is mainly beca=
use we tried ActiveMQ clustering, and while clustering worked fine over WAN=
, we couldn&#39;t make ActiveMQ work more than few days without it going OO=
M and dying, and even buitin watchdog didnt help much<br>
=C2=A0<br></div><blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0=
px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-=
left:1px solid rgb(204,204,204);padding-left:1ex">
My first try was just replacing reply queue with direct exchange that<br>
client subscribed to to get replies and it worked partially, over<br>
federation when client did simple<br>
&quot;subscribe(reply_exchange);<u></u>publish(request_exchange), but somet=
imes<br>
messages were &quot;lost&quot; probably because server sent reply too fast =
(before<br>
federation managed to subscribe to remote exchange.<br>
</blockquote>
<br>
Yeah, I think that analysis is right.<span class=3D""><font color=3D"#88888=
8"><br></font></span></blockquote><div>Is there any way to query exchange a=
bout what queues are subscribed to it over STOMP? I&#39;d like to fix it by=
 simply making server wait for client subscription to exchange before sendi=
ng reply.<br>
</div></div><br>Cheers,<br></div><div class=3D"gmail_extra">Mariusz<br>
</div></div>

--20cf30780db0a71bd104e75eb128--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.38.1380691516.3387.rabbitmq-discuss@lists.rabbitmq.com>

fwrite/fread.

Batch Publish: The library supports sending messages in batches. Read more
here: https://github.com/videlalvaro/php-amqplib#batch-publishing

Optimized Message Publish: if you need to publish different message
contents, to the same exchange and using the same routing key, then this
might interest you:
https://github.com/videlalvaro/php-amqplib#optimized-message-publishing

Protocol Extensions Support: we added support to several protocol
extensions. See:
https://github.com/videlalvaro/php-amqplib#supported-rabbitmq-extensions

Thanks to all the contributors that made this new release possible!

Regards,

Alvaro

--001a11c2d7baeeae4f04e7b9f2fb
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div>Hi,</div><div><br></div><div>I&#39;m happy to announc=
e the new release of php-amqplib.</div><div><br></div><div>You can obtain i=
t via github: <a href=3D"https://github.com/videlalvaro/php-amqplib/release=
s/tag/v2.2.0">https://github.com/videlalvaro/php-amqplib/releases/tag/v2.2.=
0</a> or via packagist:=A0<a href=3D"https://packagist.org/packages/videlal=
varo/php-amqplib">https://packagist.org/packages/videlalvaro/php-amqplib</a=
><br>
</div><div><br></div><div>Release Highlights:</div><div><br></div><div>Perf=
ormance: There&#39;s been a lot of work improving the library performance. =

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.39.1380691516.3387.rabbitmq-discuss@lists.rabbitmq.com>

fwrite/fread.</div>
<div><br></div><div>Batch Publish: The library supports sending messages in=
 batches. Read more here:=A0<a href=3D"https://github.com/videlalvaro/php-a=
mqplib#batch-publishing">https://github.com/videlalvaro/php-amqplib#batch-p=
ublishing</a></div>
<div><br></div><div>Optimized Message Publish: if you need to publish diffe=
rent message contents, to the same exchange and using the same routing key,=
 then this might interest you:=A0<a href=3D"https://github.com/videlalvaro/=
php-amqplib#optimized-message-publishing">https://github.com/videlalvaro/ph=
p-amqplib#optimized-message-publishing</a></div>
<div><br></div><div>Protocol Extensions Support: we added support to severa=
l protocol extensions. See:=A0<a href=3D"https://github.com/videlalvaro/php=
-amqplib#supported-rabbitmq-extensions">https://github.com/videlalvaro/php-=
amqplib#supported-rabbitmq-extensions</a></div>
<div><br></div><div>Thanks to all the contributors that made this new relea=
se possible!</div><div><br></div><div>Regards,</div><div><br></div><div>Alv=
aro</div></div>

--001a11c2d7baeeae4f04e7b9f2fb--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.40.1380884008.3387.rabbitmq-discuss@lists.rabbitmq.com>

value store, assuming that is the case, perhaps redis or zookeeper or
somesuch might be a good fit. But I'd assume you've considered
that--could you go into a bit more detail as to why you need rabbit to
do this?
>
> Is that possible in RabbitMQ?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--------------080806000700090603010001
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit

<html>
  <head>
    <meta content="text/html; charset=ISO-8859-1"
      http-equiv="Content-Type">
  </head>
  <body bgcolor="#FFFFFF" text="#000000">
    <div class="moz-cite-prefix">(03/10/13 20:00), Steve Marotta wrote:<br>
    </div>
    <blockquote
      cite="mid:eb3426df-7bcb-43f4-957c-5c51c75219d4 at googlegroups.com"
      type="cite">
      <div dir="ltr">I'm not entirely sure how to characterize what I'm
        looking for here, but here goes. What I want is to be able to
        implement, in RabbitMQ, a sort of functionality that is similar
        to an environment variable. Suppose I want to have a queue with
        a single value that one client can set and the other clients can
        read that value as many times as they need without that value
        going away until a client publishes a new value to the queue,
        replacing the old value with the new one.<br>
      </div>
    </blockquote>
    From what you say, it initially sounds like you're asking for a key
    value store, assuming that is the case, perhaps redis or zookeeper
    or somesuch might be a good fit. But I'd assume you've considered
    that--could you go into a bit more detail as to why you need rabbit
    to do this?<br>
    <blockquote
      cite="mid:eb3426df-7bcb-43f4-957c-5c51c75219d4 at googlegroups.com"
      type="cite">
      <div dir="ltr"><br>
        Is that possible in RabbitMQ?<br>
      </div>
      <br>
      <fieldset class="mimeAttachmentHeader"></fieldset>
      <br>
      <pre wrap="">_______________________________________________
rabbitmq-discuss mailing list
<a class="moz-txt-link-abbreviated" href="mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss at lists.rabbitmq.com</a>
<a class="moz-txt-link-freetext" href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</a>
</pre>
    </blockquote>
    <br>
  </body>
</html>

--------------080806000700090603010001--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.41.1381153389.3387.rabbitmq-discuss@lists.rabbitmq.com>

problem that has been fixed, but not released yet. You can either build
the broker from source (from the "stable" branch) or wait for the next
release, which will include the fix. The release notes will reference
the fix as "bug25757".


-Emile



From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.42.1381227473.3387.rabbitmq-discuss@lists.rabbitmq.com>

rabbitmqctl status -n rabbit at testrabbit02

This is my /etc/rabbitmq/rabbitmq.config file:
[
  {kernel,
       [{inet_dist_listen_min, 45111},
        {inet_dist_listen_max, 45111},
        {inet_default_listen_options, [{nodelay,true}]},
        {inet_default_connect_options, [{nodelay,true}]}
       ]
  },
  {rabbit, [
    {cluster_nodes, {['rabbit at testrabbit01', 'rabbit at testrabbit02'], disc}},
    {tcp_listen_options, [binary, {packet,raw},
                                  {reuseaddr,true},
                                  {backlog,128},
                                  {nodelay,true},
                                  {exit_on_close,false},
                                  {keepalive,false}]},
    {default_user, <<"rabbit">>},
    {default_pass, <<"rabbit">>}
  ]}
].

I'm able to join the servers via:
rabbitmqctl join_cluster rabbit at testrabbit02

But I can never get them to "auto-configure" from the config file alone. 
 I'm not getting any errors in any logs.

Any ideas?  What else should I try?

Thanks,
Ben


------=_Part_247_18799776.1381195859997
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">I've setup two Ubuntu 12.04 servers with rabbitmq running =
on each.<div><br></div><div>From server 1, I can see server 2's status, cor=
rectly running:</div><div><font face=3D"courier new, monospace">rabbitmqctl=
 status -n rabbit at testrabbit02</font><br></div><div><br></div><div>This is =
my /etc/rabbitmq/rabbitmq.config file:</div><div><div><font face=3D"courier=
 new, monospace">[</font></div><div><font face=3D"courier new, monospace">&=
nbsp; {kernel,</font></div><div><font face=3D"courier new, monospace">&nbsp=
; &nbsp; &nbsp; &nbsp;[{inet_dist_listen_min, 45111},</font></div><div><fon=
t face=3D"courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; {inet_dist_li=
sten_max, 45111},</font></div><div><font face=3D"courier new, monospace">&n=
bsp; &nbsp; &nbsp; &nbsp; {inet_default_listen_options, [{nodelay,true}]},<=
/font></div><div><font face=3D"courier new, monospace">&nbsp; &nbsp; &nbsp;=
 &nbsp; {inet_default_connect_options, [{nodelay,true}]}</font></div><div><=
font face=3D"courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp;]</font></d=
iv><div><font face=3D"courier new, monospace">&nbsp; },</font></div><div><f=
ont face=3D"courier new, monospace">&nbsp; {rabbit, [</font></div><div><fon=
t face=3D"courier new, monospace">&nbsp; &nbsp; {cluster_nodes, {['rabbit at t=
estrabbit01', 'rabbit at testrabbit02'], disc}},</font></div><div><font face=
=3D"courier new, monospace">&nbsp; &nbsp; {tcp_listen_options, [binary, {pa=
cket,raw},</font></div><div><font face=3D"courier new, monospace">&nbsp; &n=
bsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {reuseaddr,true},</font></div><div><font=
 face=3D"courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp=
; {backlog,128},</font></div><div><font face=3D"courier new, monospace">&nb=
sp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &=
nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {nodelay,true},</font></div><div><=
font face=3D"courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nb=
sp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &=
nbsp; {exit_on_close,false},</font></div><div><font face=3D"courier new, mo=
nospace">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nb=
sp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {keepalive,false}]},</=
font></div><div><font face=3D"courier new, monospace">&nbsp; &nbsp; {defaul=
t_user, &lt;&lt;"rabbit"&gt;&gt;},</font></div><div><font face=3D"courier n=
ew, monospace">&nbsp; &nbsp; {default_pass, &lt;&lt;"rabbit"&gt;&gt;}</font=
></div><div><font face=3D"courier new, monospace">&nbsp; ]}</font></div><di=
v><font face=3D"courier new, monospace">].</font></div></div><div><font fac=
e=3D"courier new, monospace"><br></font></div><div>I'm able to join the ser=
vers via:</div><div><font face=3D"courier new, monospace">rabbitmqctl join_=
cluster rabbit at testrabbit02</font><br></div><div><br></div><div>But I can n=
ever get them to "auto-configure" from the config file alone. &nbsp;I'm not=
 getting any errors in any logs.</div><div><br></div><div>Any ideas? &nbsp;=
What else should I try?</div><div><br></div><div>Thanks,</div><div>Ben</div=
><div><br></div></div>
------=_Part_247_18799776.1381195859997--

------=_Part_246_24050424.1381195859997--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.43.1381517881.3387.rabbitmq-discuss@lists.rabbitmq.com>



On Fri, Oct 11, 2013 at 8:39 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/10/2013 4:26PM, MyOwnFitness wrote:
>
>> There is a naming convention where the users will have LDAP accounts
>> like, TestUser1 and 2 and TestPub1 and 2. Is there a way to grant
>> access to a certain vhost based on Naming convention?
>>
>
> You could do something like:
>
> {match, {string, "${vhost}"}, {string, "^${username}-host$"}}
>
> So that TestUser1 can log in to TestUser1-host and so on.
>
>
>  Also, on that
>> same note could you have multiple vhost sections in the config?
>>
>
> No. Like I said, in 3.2.0 you will be able to use boolean ops to simulate
> this.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>

--047d7b47207804bb8d04e87a3f45
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Awesome, that might work... one more question...<div><br><=
/div><div>If i used:</div><div><br></div><div><span style=3D"font-family:ar=
ial,sans-serif;font-size:13px">{match, {string, &quot;${vhost}&quot;}, {str=
ing, &quot;^${username}-host$&quot;}}</span><br>
</div><div><span style=3D"font-family:arial,sans-serif;font-size:13px"><br>=
</span></div><div><span style=3D"font-family:arial,sans-serif;font-size:13p=
x">What if TestPub1 needed to publish to TestUser1-host?=A0</span></div><di=
v>
<span style=3D"font-family:arial,sans-serif;font-size:13px"><br></span></di=
v><div><span style=3D"font-family:arial,sans-serif;font-size:13px">From the=
 above they would only get access to TestPub1-host, correct?</span></div><d=
iv>
<span style=3D"font-family:arial,sans-serif;font-size:13px"><br></span></di=
v></div><div class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Fr=
i, Oct 11, 2013 at 8:39 AM, Simon MacMullen <span dir=3D"ltr">&lt;<a href=
=3D"mailto:simon at rabbitmq.com" target=3D"_blank">simon at rabbitmq.com</a>&gt;=
</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><div class=3D"im">On 11/10/2013 4:26PM, MyOw=
nFitness wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
There is a naming convention where the users will have LDAP accounts<br>
like, TestUser1 and 2 and TestPub1 and 2. Is there a way to grant<br>
access to a certain vhost based on Naming convention?<br>
</blockquote>
<br></div>
You could do something like:<br>
<br>
{match, {string, &quot;${vhost}&quot;}, {string, &quot;^${username}-host$&q=
uot;}}<br>
<br>
So that TestUser1 can log in to TestUser1-host and so on.<div class=3D"im">=
<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">
Also, on that<br>
same note could you have multiple vhost sections in the config?<br>
</blockquote>
<br></div>
No. Like I said, in 3.2.0 you will be able to use boolean ops to simulate t=
his.<div class=3D"HOEnZb"><div class=3D"h5"><br>
<br>
Cheers, Simon<br>
<br>
-- <br>
Simon MacMullen<br>
RabbitMQ, Pivotal<br>
</div></div></blockquote></div><br></div>

--047d7b47207804bb8d04e87a3f45--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.44.1381941815.3387.rabbitmq-discuss@lists.rabbitmq.com>

http://www.rabbitmq.com/memory.html


On Wed, Oct 16, 2013 at 3:43 PM, Chris Nicel <Chris.Nicel at 15below.com>wrote:

>  Hi All.****
>
> ** **
>
> I would like to know more about the decision to default the memory high
> watermark to 40% of the installed RAM. Is this designed for use on a server
> with contended resources? If the server is dedicated to running RabbitMQ
> can this be raised to say 80% or 90% safely? ****
>
> ** **
>
> RabbitMQ: 3.1.5****
>
> Erlang: 16B02****
>
> Linux Distro: Ubuntu 12.04LTS****
>
> ** **
>
> Thanks in advance.****
>
> ** **
>
> *Chris Nicel*
>
> Senior Systems Engineer****
>
> 15below ltd : 15below Australia pty. ltd.****
>
> ** **
>
> *t:**        *+44 1273 764230****
>
> *e*:       chris.nicel at 15below.com
> *w:*      15below.com <http://www.15below.com/>****
>
> **[image: *]    **   @15below_travel<https://twitter.com/#!/15below_travel>
> ****
>
> ** **
>
> 15below Limited: Company registered in England and Wales No 3945289
> Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB,
> United Kingdom
>
> 15below Australia Pty Limited: ABN 25 132 716 379
> Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000,
> Australia
>
> Please think about the environment before printing this email.
>
> ************************************************************************
> This email and any attachments may be confidential and/or legally
> privileged and are solely for the use of the intended recipient. If you
> have received this email in error please contact the sender. Any views or
> opinions expressed within this e-mail are solely those of the sender, and
> do not necessarily represent those of 15below unless otherwise specifically
> stated. Although 15below has taken every reasonable precaution to ensure
> that any attachment to this e-mail has been checked for viruses, it is
> strongly recommended that you carry out your own virus check before opening
> any attachment, as we cannot accept liability for any damage sustained as a
> result of software virus infection.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
----
Duncan McIntyre
Senior Consultant
dmcintyre at gopivotal.com
+44 7917 580 118

--047d7b86daaa9ea1b704e8dce586
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Because of this:<div><br></div><div><span style=3D"color:r=
gb(85,85,85);font-family:Verdana,sans-serif;font-size:13px;line-height:18px=
">The default memory threshold is set to 40% of installed RAM. Note that th=
is does not prevent the RabbitMQ server from using more than 40%, it is mer=
ely the point at which publishers are throttled. Erlang&#39;s garbage colle=
ctor can, in the worst case, cause double the amount of memory to be used (=
by default, 80% of RAM). It is strongly recommended that OS swap or page fi=
les are enabled.</span><br>
</div><div><span style=3D"color:rgb(85,85,85);font-family:Verdana,sans-seri=
f;font-size:13px;line-height:18px"><br></span></div><div><span style=3D"col=
or:rgb(85,85,85);font-family:Verdana,sans-serif;font-size:13px;line-height:=
18px">From here:</span></div>
<div><span style=3D"color:rgb(85,85,85);font-family:Verdana,sans-serif;font=
-size:13px;line-height:18px"><br></span></div><div><font color=3D"#555555" =
face=3D"Verdana, sans-serif"><span style=3D"line-height:17.99715805053711px=
"><a href=3D"http://www.rabbitmq.com/memory.html">http://www.rabbitmq.com/m=
emory.html</a></span></font><br>
</div></div><div class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">O=
n Wed, Oct 16, 2013 at 3:43 PM, Chris Nicel <span dir=3D"ltr">&lt;<a href=
=3D"mailto:Chris.Nicel at 15below.com" target=3D"_blank">Chris.Nicel at 15below.c=
om</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex">





<div lang=3D"EN-GB" link=3D"blue" vlink=3D"purple">
<div>
<p class=3D"MsoNormal">Hi All.<u></u><u></u></p>
<p class=3D"MsoNormal"><u></u>=A0<u></u></p>
<p class=3D"MsoNormal">I would like to know more about the decision to defa=
ult the memory high watermark to 40% of the installed RAM. Is this designed=
 for use on a server with contended resources? If the server is dedicated t=
o running RabbitMQ can this be raised
 to say 80% or 90% safely? <u></u><u></u></p>
<p class=3D"MsoNormal"><u></u>=A0<u></u></p>
<p class=3D"MsoNormal">RabbitMQ: 3.1.5<u></u><u></u></p>
<p class=3D"MsoNormal">Erlang: 16B02<u></u><u></u></p>
<p class=3D"MsoNormal">Linux Distro: Ubuntu 12.04LTS<u></u><u></u></p>
<p class=3D"MsoNormal"><u></u>=A0<u></u></p>
<p class=3D"MsoNormal">Thanks in advance.<u></u><u></u></p>
<p class=3D"MsoNormal"><u></u>=A0<u></u></p>
<p class=3D"MsoNormal"><b><span style=3D"color:#1f497d">Chris Nicel<u></u><=
u></u></span></b></p>
<p class=3D"MsoNormal"><span style=3D"color:#1f497d">Senior Systems Enginee=
r<u></u><u></u></span></p>
<p class=3D"MsoNormal"><span style=3D"color:#1f497d">15below ltd : 15below =
Australia pty. ltd.<u></u><u></u></span></p>
<p class=3D"MsoNormal"><span style=3D"color:#1f497d"><u></u>=A0<u></u></spa=
n></p>
<p class=3D"MsoNormal"><b><span style=3D"color:#bfbfbf">t:</span></b><b><sp=
an style=3D"color:#1f497d">=A0=A0=A0=A0=A0=A0=A0
</span></b><span style=3D"color:#1f497d"><a href=3D"tel:%2B44%201273%207642=
30" value=3D"+441273764230" target=3D"_blank">+44 1273 764230</a><u></u><u>=
</u></span></p>
<p class=3D"MsoNormal"><b><span style=3D"color:#bfbfbf">e</span></b><span s=
tyle=3D"color:#bfbfbf">:=A0=A0=A0=A0=A0=A0
</span><span style=3D"color:#1f497d"><a href=3D"mailto:chris.nicel at 15below.=
com" target=3D"_blank"><span style=3D"color:blue">chris.nicel at 15below.com</=
span></a><br>
</span><b><span style=3D"color:#bfbfbf">w:</span></b><span style=3D"color:#=
1f497d">=A0=A0=A0=A0=A0
<a href=3D"http://www.15below.com/" target=3D"_blank"><span style=3D"color:=
blue">15below.com</span></a><u></u><u></u></span></p>
<p class=3D"MsoNormal" style=3D"margin-left:18.0pt">
<u></u><span lang=3D"EN-US" style=3D"font-family:Symbol;color:#1f497d"><spa=
n><img width=3D"16" height=3D"12" src=3D"cid:image001.png at 01CECA86.6C4BD2E0=
" alt=3D"*"><span style=3D"font:7.0pt &quot;Times New Roman&quot;">=A0=A0=
=A0
</span></span></span><u></u><span lang=3D"EN-US" style=3D"color:#1f497d">=
=A0=A0=A0<a href=3D"https://twitter.com/#!/15below_travel" target=3D"_blank=
"><span style=3D"color:blue">@15below_travel</span></a><u></u><u></u></span=
></p>
<p class=3D"MsoNormal"><u></u>=A0<u></u></p>
</div>
<br>
<font face=3D"Arial" color=3D"Black" size=3D"3">15below Limited: Company re=
gistered in England and Wales No 3945289<br>
Registered Office: Lyndean House, 43-46 Queens Road, Brighton BN1 3XB, Unit=
ed Kingdom<br>
<br>
15below Australia Pty Limited: ABN 25 132 716 379<br>
Level 21, Tower 2 Darling Park, 201 Sussex Street, Sydney, NSW 2000, Austra=
lia<br>
<br>
Please think about the environment before printing this email.<br>
<br>
************************************************************************<br=
>
This email and any attachments may be confidential and/or legally privilege=
d and are solely for the use of the intended recipient. If you have receive=
d this email in error please contact the sender. Any views or opinions expr=
essed within this e-mail are solely
 those of the sender, and do not necessarily represent those of 15below unl=
ess otherwise specifically stated. Although 15below has taken every reasona=
ble precaution to ensure that any attachment to this e-mail has been checke=
d for viruses, it is strongly recommended
 that you carry out your own virus check before opening any attachment, as =
we cannot accept liability for any damage sustained as a result of software=
 virus infection.<br>
</font>
</div>

<br>_______________________________________________<br>
rabbitmq-discuss mailing list<br>
<a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss at lis=
ts.rabbitmq.com</a><br>
<a href=3D"https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-dis=
cuss" target=3D"_blank">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo=
/rabbitmq-discuss</a><br>
<br></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br><div>---=
-</div>Duncan McIntyre<div>Senior Consultant</div><div><a href=3D"mailto:dm=
cintyre at gopivotal.com" target=3D"_blank">dmcintyre at gopivotal.com</a></div><=
div>
+44 7917 580 118</div>
</div>

--047d7b86daaa9ea1b704e8dce586--
--047d7b86daaa9ea1b904e8dce587
Content-Type: image/png; name="image001.png"
Content-Transfer-Encoding: base64
Content-ID: <image001.png at 01CECA86.6C4BD2E0>
X-Attachment-Id: cc924c94c07aecac_0.0.1

iVBORw0KGgoAAAANSUhEUgAAABcAAAARCAMAAAABrcePAAAAAXNSR0ICQMB9xQAAAaFQTFRFAAAA
E779Fr/9Fb/9HMb9H8T9GMP9FML9FsH9HcP9E8D9G8L9PtL9OtH9ONH9NM/8Ms/9PtH9Mc79PdH9
Ms79OM/9Nc/9Nc79Oc/9Mc39M879Ls39L839NM79O8/8Icj9L8z9Lsv9Kcr8K8r8JMn8PM78Mcv9
Jsj9KMn9J8n9Jcf9Kcf9IcX9I8X9PMv9LMf9IsT9IMT9IMP9IMH9JcP9StX8QtP9RNT9S9T9RNP9
Utf9RtP9UNX8SNL8UdT8XdX9Rs/9XNP9U9D9WtH9Y9v9dt79d9/9d979aNv8ZNr8Ytj8b9v8f979
Z9f9cdj9euD8jt/9htz9gOL9muf8ieP9n+n9iuL9h+H9kOD9ve/9vvD9oOj9pOn9oOb8pOb9rOn+
r+n+pef9pub+qef+rej92fb+y/P+wPD9zPP+wfD93/f+x/H9wvD+3fb+zvP+3fb92PT+2vX+zPH+
2/X+1PP9zvH+0PH+9Pz+6fn+7/r+9fz+//7//P7+4ff9///+8Pr+5Pj95fn94/f97vr9+/7/6vn+
5Pj+7Pr+9/z+9/3+////sIGLtgAAAAF0Uk5TAEDm2GYAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAAZ
dEVYdFNvZnR3YXJlAE1pY3Jvc29mdCBPZmZpY2V/7TVxAAAA7klEQVQoz2PoQgLlkVEVEBYDA5Co
hApXBZn6pyKJB4ekVYM4oTxm5i7pCPEMC0vXzJquLCteMzM+62y4eLkbv4Cge220kLCwMI+ARx1M
vN5TRFRMyMZGXEJUVFRMMCanASLeleslKSUlLSMLBjJyYY1Q8SZbeQUYUFSwC8+CinfleSspKUOA
imo+zHwgiFVT1wADTRYfiL3NLSDxVntWLTBgc2iDuLM9Lr6gMMFXW0cXCFjZ9Ypg/ir20zcw5OA0
NDLi5OJ2LEGEQ0eikzEjExMzo4lzUmcdUvh0lZcmBwRGpJRVwUMW5h50wIALAADyCoGSB3+xKwAA
AABJRU5ErkJggg==
--047d7b86daaa9ea1b904e8dce587--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.45.1382448252.3387.rabbitmq-discuss@lists.rabbitmq.com>

unlimited prefetch or a value of 500. It is likely that the broker
memory use will be reduced if consumers use a much lower prefetch count,
say 1. Would it be possible for you to try that? The reason why it might
help in your particular case is most of the memory is being consumed by
the Erlang processes that write to the network.

I realise that it might be difficult for you to make this change to all
consumers. Let me know if this is too onerous so we can discuss
alternatives.




-Emile





From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.46.1383372038.3387.rabbitmq-discuss@lists.rabbitmq.com>

forever even as channels are recovered, but I don't this is a problem since
all usage of those tags will be through Lyra's proxied channel which will
re-adjust them before sending an ack/nack/reject.

What do you think of this approach?

Cheers,
Jonathan


>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

--001a1133158ea7aa5504ea29b630
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Hi Matthais,<br><div class=3D"gmail_extra"><br><div class=
=3D"gmail_quote">On Fri, Nov 1, 2013 at 7:05 AM, Matthias Radestock <span d=
ir=3D"ltr">&lt;<a href=3D"mailto:matthias at rabbitmq.com" target=3D"_blank">m=
atthias at rabbitmq.com</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-=
left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;p=
adding-left:1ex">Jonathan,<div class=3D"im"><br>
<br>
On 31/10/13 18:54, Jonathan Halterman wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-=
left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;p=
adding-left:1ex">
I don&#39;t suppose you&#39;re open to enhancing the amqp-client API to inc=
lude<br>
something like this? :) One possible change would be the inclusion of a<br>
VersionedDeliveryTag like object in the Envelope along with some<br>
corresponding basic ack/nack/reject(<u></u>VersionedDeliveryTag) methods on=
 the<br>
Channel interface. The channel&#39;s &quot;version&quot; would just be anot=
her piece<br>
of meta information that the user could specify.<br>
</blockquote>
<br></div>
Such an API extension doesn&#39;t really make sense in the existing client.=
 Plus, in order to take advantage of it client code would have to change, s=
o you might as well bite the bullet and design a recovery-enabled API that =
wraps the existing API.<div class=3D"im">
<br>
<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-=
left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;p=
adding-left:1ex">
One other idea - Brett Cameron suggested tracking the last delivery tag<br>
for each channel and dropping any ack/nack/reject requests for delivery<br>
tags greater than that. If a channel is recovered, the last delivery tag<br=
>
for the new channel will most likely be less than any delivery tags for<br>
messages consumed on the previously closed channel. This is obviously<br>
not foolproof, but it&#39;s not a bad start.<br>
</blockquote>
<br></div>
That&#39;s better than the present situation, I suppose, but doesn&#39;t ca=
tch the more dangerous of the two ways things can go wrong, i.e. when the o=
ld delivery tags *are* in range of the new ones then the wrong messages get=
 acknowledged.</blockquote>
<div><br></div><div>Another approach suggested by Brett - this one seems pr=
etty sound. Start by tracking the max delivery tag for a channel. If a chan=
nel is closed and recovered, we increment subsequent delivery tags by the m=
ax tag we observed for the previous channel. When the user acks/nacks/rejec=
ts a delivery tag, we decrement by the max tag. If the decremented value is=
 &lt;=3D 0, then we know the delivery tag is for a previously closed channe=
l.=A0</div>
<div><br></div><div>From the user&#39;s perspective this means delivery tag=
s simply increase forever even as channels are recovered, but I don&#39;t t=
his is a problem since all usage of those tags will be through Lyra&#39;s p=
roxied channel which will re-adjust them before sending an ack/nack/reject.=
=A0</div>
<div><br></div><div>What do you think of this approach?=A0</div><div><br></=
div><div>Cheers,</div><div>Jonathan=A0</div><div><br></div><blockquote clas=
s=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left-width:1px;b=
order-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex"=
>
<div class=3D""><div class=3D"h5"><br>
<br>
Matthias.<br>
______________________________<u></u>_________________<br>
rabbitmq-discuss mailing list<br>
<a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com" target=3D"_blank">ra=
bbitmq-discuss at lists.<u></u>rabbitmq.com</a><br>
<a href=3D"https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-dis=
cuss" target=3D"_blank">https://lists.rabbitmq.com/<u></u>cgi-bin/mailman/l=
istinfo/<u></u>rabbitmq-discuss</a><br>
</div></div></blockquote></div><br></div></div>

--001a1133158ea7aa5504ea29b630--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.47.1383744178.3387.rabbitmq-discuss@lists.rabbitmq.com>

<div class=3D"HOEnZb"><div class=3D"h5"><br>
MK<br>
<br>
Software Engineer, Pivotal/RabbitMQ<br>
<br>
<br>
_______________________________________________<br>
rabbitmq-discuss mailing list<br>
<a href=3D"mailto:rabbitmq-discuss at lists.rabbitmq.com">rabbitmq-discuss at lis=
ts.rabbitmq.com</a><br>
<a href=3D"https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-dis=
cuss" target=3D"_blank">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo=
/rabbitmq-discuss</a><br>
</div></div></blockquote></div><br></div>

--f46d0438955fd4698604ea804f7d--

From bogus@does.not.exist.com  Thu Mar 14 15:04:54 2013
From: bogus@does.not.exist.com ()
Date: Thu, 14 Mar 2013 15:04:54 -0000
Subject: No subject
Message-ID: <mailman.48.1385172830.3387.rabbitmq-discuss@lists.rabbitmq.com>

                       *


 Pls advise me how to proceed further.

Thanks,
Shri

--047d7b60443c79bbc204ebccc3f9
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Hi There,<div>=A0 =A0</div><div>=A0 =A0 I am experiencing =
high cpu usage (above 400%) on Cent OS rabbit mq cluster (with 2 nodes). We=
 have a similar setup in Ubuntu and cpu usage seems fine. Pls fine the repo=
rt, status and top below.</div>

<div><br></div><div>OS:=A0<i>CentOS release 6.4</i></div><div><br></div><di=
v>Report:</div><div><div><i>{pid,2148},</i></div><div><i>=A0{running_applic=
ations,</i></div><div><i>=A0 =A0 =A0[{rabbitmq_management,&quot;RabbitMQ Ma=
nagement Console&quot;,&quot;3.0.2&quot;},</i></div>

<div><i>=A0 =A0 =A0 {rabbitmq_management_agent,&quot;RabbitMQ Management Ag=
ent&quot;,&quot;3.0.2&quot;},</i></div><div><i>=A0 =A0 =A0 {rabbit,&quot;Ra=
bbitMQ&quot;,&quot;3.0.2&quot;},</i></div><div><i>=A0 =A0 =A0 {os_mon,&quot=
;CPO =A0CXC 138 46&quot;,&quot;2.2.7&quot;},</i></div>

<div><i>=A0 =A0 =A0 {rabbitmq_mochiweb,&quot;RabbitMQ Mochiweb Embedding&qu=
ot;,&quot;3.0.2&quot;},</i></div><div><i>=A0 =A0 =A0 {webmachine,&quot;webm=
achine&quot;,&quot;1.9.1-rmq3.0.2-git52e62bc&quot;},</i></div><div><i>=A0 =
=A0 =A0 {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;2.3.1-rmq3.0.2-gi=
td541e9a&quot;},</i></div>

<div><i>=A0 =A0 =A0 {xmerl,&quot;XML parser&quot;,&quot;1.2.10&quot;},</i><=
/div><div><i>=A0 =A0 =A0 {inets,&quot;INETS =A0CXC 138 49&quot;,&quot;5.7.1=
&quot;},</i></div><div><i>=A0 =A0 =A0 {mnesia,&quot;MNESIA =A0CXC 138 12&qu=
ot;,&quot;4.5&quot;},</i></div>

<div><i>=A0 =A0 =A0 {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;3.0=
.2&quot;},</i></div><div><i>=A0 =A0 =A0 {sasl,&quot;SASL =A0CXC 138 11&quot=
;,&quot;2.1.10&quot;},</i></div><div><i>=A0 =A0 =A0 {stdlib,&quot;ERTS =A0C=
XC 138 10&quot;,&quot;1.17.5&quot;},</i></div>

<div><i>=A0 =A0 =A0 {kernel,&quot;ERTS =A0CXC 138 10&quot;,&quot;2.14.5&quo=
t;}]},</i></div><div><i>=A0{os,{unix,linux}},</i></div><div><i>=A0{erlang_v=
ersion,</i></div><div><i>=A0 =A0 =A0&quot;Erlang R14B04 (erts-5.8.5) [sourc=
e] [64-bit] [smp:12:12] [rq:12] [async-threads:30] [kernel-poll:true]\n&quo=
t;},</i></div>

<div><i>=A0{memory,</i></div><div><i>=A0 =A0 =A0[{total,285898072},</i></di=
v><div><i>=A0 =A0 =A0 {connection_procs,16592856},</i></div><div><i>=A0 =A0=
 =A0 {queue_procs,1064888},</i></div><div><i>=A0 =A0 =A0 {plugins,269872},<=
/i></div><div><i>=A0 =A0 =A0 {other_proc,13173224},</i></div>

<div><i>=A0 =A0 =A0 {mnesia,100632},</i></div><div><i>=A0 =A0 =A0 {mgmt_db,=
2167672},</i></div><div><i>=A0 =A0 =A0 {msg_index,35352},</i></div><div><i>=
=A0 =A0 =A0 {other_ets,72058416},</i></div><div><i>=A0 =A0 =A0 {binary,7326=
576},</i></div><div><i>=A0 =A0 =A0 {code,17434264},</i></div>

<div><i>=A0 =A0 =A0 {atom,3356065},</i></div><div><i>=A0 =A0 =A0 {other_sys=
tem,152318255}]},</i></div><div><i>=A0{vm_memory_high_watermark,0.4},</i></=
div><div><i>=A0{vm_memory_limit,4991811584},</i></div><div><i>=A0{disk_free=
_limit,1000000000},</i></div>

<div><i>=A0{disk_free,17927184384},</i></div><div><i>=A0{file_descriptors,<=
/i></div><div><i>=A0 =A0 =A0[{total_limit,199900},</i></div><div><i>=A0 =A0=
 =A0 {total_used,314},</i></div><div><i>=A0 =A0 =A0 {sockets_limit,179908},=
</i></div><div><i>=A0 =A0 =A0 {sockets_used,312}]},</i></div>

<div><i>=A0{processes,[{limit,1048576},{used,2703}]},</i></div><div><i>=A0{=
run_queue,0},</i></div><div><i>=A0{uptime,3207797}]</i></div></div><div><br=
></div><div>From Top:</div><div><div><i>=A0 =A02249 rabbitmq =A020 =A0 0 29=
89m 319m 2540 S 371.5 =A02.7 =A025109:43 beam.smp =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0=
 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0</i></div>

</div><div><br></div><div><br></div><div>=A0Pls advise me how to proceed fu=
rther.=A0</div><div><br></div><div>Thanks,</div><div>Shri</div></div>

--047d7b60443c79bbc204ebccc3f9--

