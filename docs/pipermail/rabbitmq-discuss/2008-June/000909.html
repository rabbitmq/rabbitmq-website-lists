<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Durable queues for STOMP broker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Durable%20queues%20for%20STOMP%20broker&In-Reply-To=48427486.9000408%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000905.html">
   <LINK REL="Next"  HREF="000896.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Durable queues for STOMP broker</H1>
    <B>Sean Treadway</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Durable%20queues%20for%20STOMP%20broker&In-Reply-To=48427486.9000408%40lshift.net"
       TITLE="[rabbitmq-discuss] Durable queues for STOMP broker">sean at soundcloud.com
       </A><BR>
    <I>Mon Jun  2 12:17:48 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000905.html">[rabbitmq-discuss] Durable queues for STOMP broker
</A></li>
        <LI>Next message: <A HREF="000896.html">[rabbitmq-discuss] Problem running rabbit broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#909">[ date ]</a>
              <a href="thread.html#909">[ thread ]</a>
              <a href="subject.html#909">[ subject ]</a>
              <a href="author.html#909">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Tony,

Thanks for applying the patch!  I see you caught that commented line  
in the ruby receiver example - thanks.

On Jun 1, 2008, at 12: 05, Tony Garnock-Jones wrote:

&gt;&gt;<i> * expose 'passive', 'durable', 'auto-delete', 'exclusive'  
</I>&gt;&gt;<i> parameters of the AMQP 'queue.declare' method as STOMP headers in  
</I>&gt;&gt;<i> SUBSCRIBE
</I>&gt;<i>
</I>&gt;<i> Hmm, naming and interoperability. While we're still in  
</I>&gt;<i> &quot;experimental&quot; status we can use any names we like, of course, but  
</I>&gt;<i> I'd be interested to compare and contrast the names we choose for  
</I>&gt;<i> things like this with the names other STOMP-supporting brokers use  
</I>&gt;<i> for similar features.
</I>&gt;<i>
</I>&gt;<i> Does anyone on the list have any comments around this area?
</I>&gt;<i>
</I>&gt;<i> On a related note, what do you think about trying to more generally  
</I>&gt;<i> expose more of the AMQP functionality over STOMP? We could look at  
</I>&gt;<i> ways of using the AMQP protocol definition to autogenerate the  
</I>&gt;<i> necessary marshalling code, just as we do for other transport and  
</I>&gt;<i> protocol bindings.
</I>
I chose the AMQP naming for this patch because I used the AMQP  
documentation to learn/understanding the intended behavior of queue  
declaration.  I took a quick trip over to ActiveMQ's documentation  
pages and saw that they had similar configuration with their own/ 
different naming but I consciously thought &quot;This is not ActiveMQ, this  
is RabbitMQ.  I want to know that to leverage RabbitMQ features&quot;.   
STOMP looked like it was MQ agnostic and extensible while keeping the  
core headers well defined (ack=client, message_id, etc...), but my  
application was not MQ agnostic.  Plus I saw some of the ActiveMQ  
headers weren't available or necessary in RabbitMQ.

Keeping the AMQP naming is the best way to piggy back on the AMQP  
documentation.  For those that need simple, transient queues, the  
existing STOMP documentation would be sufficient.

&gt;&gt;<i> Big thanks to you all at LShift for building this beautiful code.
</I>&gt;<i>
</I>&gt;<i> You're welcome! I take it you're using Ruby to interact with the  
</I>&gt;<i> broker - have you tried any of the available Ruby AMQP clients out  
</I>&gt;<i> there? Can you share with us what kind of thing you're doing with  
</I>&gt;<i> RabbitMQ?
</I>
We're using RabbitMQ as a job dispatcher for our media transcoder  
machines and for our 1-many notification broadcasts (upload a track,  
your fans are notified).

We chose RabbitMQ because after reading Joe's book on Erlang, OTP  
quickly became the best choice for meeting the requirements of fail- 
tolerance and scalability.  Pure throughput wasn't an issue for us.

I've been keeping an eye on RabbitMQ for about a year, and have to  
admit that the language tone and 'heaviness' around AMQP kept me from  
adopting it in a previous project.  The tone of rabbitmq.com was much  
more accessible, so I had faith that this was an open source project  
with dedicated maintainers so I put it on top of my list of MQ  
candidates when I needed the reliability and could invest in this part  
of our infrastructure.

I remember reading somewhere long ago that ruby AMQP lib was  
incomplete and not very stable.  The ruby source seemed complicated  
and did much more than what we needed.  AMQP solves a lot of problems,  
most of which I am unfamiliar with.

When the STOMP broker was released I thought &quot;great! STOMP looks just  
like HTTP&quot;.  I grabbed the ruby lib, understood it, and thought that  
if anything went wrong, I could fix it.  With RSS and XMPP experience,  
it was easy for me to see how the publish-subscribe model we needed  
was implemented in STOMP.

If we need anything more complicated like setting up custom exchanges  
or finer control over routing, we'll probably switch to AMQP.

&gt;&gt;<i> whether or not to try and match ActiveMQ's STOMP header names or  
</I>&gt;&gt;<i> stick with the AMQP naming,
</I>&gt;<i>
</I>&gt;<i> This is a great question. I'd love to hear your thoughts on the  
</I>&gt;<i> subject, not being familiar myself with any other broker-specific  
</I>&gt;<i> options and headers.
</I>
I only have experience with RabbitMQ, so I'm fine with exposing AMQP  
rather than try to come to some agreement over the extension names of  
standard STOMP headers.  Since I'm new around here, don't really know  
the relationship between the RabbitMQ and ActiveMQ communities.  If  
we're all in this together and have good communication, it may be  
worth the effort to harmonize on the naming.  &quot;What does consisting  
naming across broker vendors give the consumers of our MQ&quot; may be the  
right question to ask.

&gt;&gt;<i> Also, the STOMP spec gives no insight for queue deletion when a  
</I>&gt;&gt;<i> durable queue is no longer needed.  Any ideas for that one?
</I>&gt;<i>
</I>&gt;<i> Good point. I think we're probably pretty free to implement  
</I>&gt;<i> extensions of our own in this area - how about a &quot;DELETE&quot; command?  
</I>&gt;<i> This touches on my question above of how best to expose more of AMQP.
</I>
Here, I would stick with the verbs defined in STOMP and extend the  
verbs with headers.  One possibility is to use UNSUBSCRIBE messages to  
change the queue properties before sending the 'basic.cancel' method.   
Another possibility is to change queue properties on a SUBSCRIBE  
message. Neither seem nice to me.  Third option is to do nothing, and  
delete the queues outside of the STOMP protocol (we're fine with that  
as we have a fixed number of persistent queues).

How are auto-delete=false queues removed with AMQP?

On Jun 1, 2008, at 23: 28, Tony Garnock-Jones wrote:
&gt;<i> By the way, is it just me, or does the Ruby STOMP adapter get very  
</I>&gt;<i> confused when the socket closes underneath it? I see fairly  
</I>&gt;<i> consistent behaviour of 100% CPU usage, with the Ruby program just  
</I>&gt;<i> spinning, if the socket's closed by the server for whatever reason.  
</I>&gt;<i> Odd!
</I>
This was in the example's receive loop and not in the library itself,  
the 'nil' message on socket closure was just being ignored.  Here's a  
receive loop that actually terminates :).  It could also be applied to  
cb-receiver.rb:

while msg = conn.receive
   puts msg.body
end

-Sean


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000905.html">[rabbitmq-discuss] Durable queues for STOMP broker
</A></li>
	<LI>Next message: <A HREF="000896.html">[rabbitmq-discuss] Problem running rabbit broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#909">[ date ]</a>
              <a href="thread.html#909">[ thread ]</a>
              <a href="subject.html#909">[ subject ]</a>
              <a href="author.html#909">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
