From dmitriy.samovskiy at cohesiveft.com  Fri Feb  1 23:39:03 2008
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Fri, 01 Feb 2008 17:39:03 -0600
Subject: [rabbitmq-discuss] Alternative Python AMQP client library
In-Reply-To: <47A1185B.2040109@barryp.org>
References: <47547A2B.5040007@barryp.org> <15192757.post@talk.nabble.com>
	<47A1185B.2040109@barryp.org>
Message-ID: <47A3AD97.9040000@cohesiveft.com>



Barry Pederson wrote:
> kyles wrote:
>>
>> Traceback (most recent call last):
>>   File "demo_send.py", line 56, in <module>
>>     main()
>>   File "demo_send.py", line 41, in main
>>     conn = amqp.Connection(options.host, userid=options.userid,
>> password=options.password, ssl=options.ssl)
>>   File "/usr/local/lib/python2.5/site-packages/amqplib/client_0_8.py", line
>> 180, in __init__
>>     self.close()
>>   File "/usr/local/lib/python2.5/site-packages/amqplib/client_0_8.py", line
>> 420, in close
>>     (10, 61),    # Connection.close_ok
>>   File "/usr/local/lib/python2.5/site-packages/amqplib/client_0_8.py", line
>> 356, in wait
>>     frame_type, payload = self._wait_channel(0)
>>   File "/usr/local/lib/python2.5/site-packages/amqplib/client_0_8.py", line
>> 298, in _wait_channel
>>     frame_type, frame_channel, payload = self._wait_frame()
>>   File "/usr/local/lib/python2.5/site-packages/amqplib/client_0_8.py", line
>> 273, in _wait_frame
>>     frame_type = self.input.read_octet()
>>   File "/usr/local/lib/python2.5/site-packages/amqplib/util_0_8.py", line
>> 96, in read_octet
>>     return unpack('B', self.input.read(1))[0]
>>   File "/usr/local/lib/python2.5/struct.py", line 87, in unpack
>>     return o.unpack(s)
>> struct.error: unpack requires a string argument of length 1
>> Exception socket.error: (32, 'Broken pipe') in <bound method
>> Connection.__del__ of <amqplib.client_0_8.Connection object at 0xb7c7470c>>
>> ignored
>>
>> Is this something you've seen before?
>>
>> Thanks,
>> Kyle
> 
> Sorry, I haven't had a multi-node RabbitMQ setup to try anything like
> that particular setup, so haven't seen that particular error.
> 
> It looks like the node you're connecting to is maybe trying to redirect
> you to the other node, and then closing the socket without waiting for
> the client to send a "close" message and then responding with "close-ok".
> 
Yes, I get the same very exception when broker replies with a redirect.

You can also use insist flag when starting a connection:

client = Connection(host=myip, userid='guest', password='guest', insist=True)

This should work with the latest version of amqplib.

In my tests I have never seen a broker respond with redirect when I set insist to True, 
even though according to the spec, a broker SHOULD accept a connection (not MUST):

       <field name="insist" type="bit">
     insist on connecting to server
     <doc>
       In a configuration with multiple load-sharing servers, the server
       may respond to a Connection.Open method with a Connection.Redirect.
       The insist option tells the server that the client is insisting on
       a connection to the specified server.
     </doc>
         <rule implement="SHOULD">
       When the client uses the insist option, the server SHOULD accept
       the client connection unless it is technically unable to do so.
     </rule>
       </field>


- Dmitriy






From tonyg at lshift.net  Sat Feb  2 00:13:54 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sat, 02 Feb 2008 00:13:54 +0000
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
Message-ID: <47A3B5C2.6070100@lshift.net>

Hi all,

I?ve just made our experimental STOMP adapter to RabbitMQ available.

STOMP (http://stomp.codehaus.org/Home) is a very simple messaging wire 
protocol, with what appears to be fairly broad client support. I've only 
personally experimented with the Perl Net::Stomp client, but according 
to http://stomp.codehaus.org/Clients, there are a bunch of options 
available.

Please try it out and let me know what you think! I've made a blog post 
summarising getting the thing running: 
http://www.lshift.net/blog/2008/02/02/how-to-run-rabbitmqs-experimental-stomp-adapter

If you use mercurial, you can get a checkout of the adapter code with

hg clone http://www.lshift.net/~tonyg/hg/hgwebdir.cgi/rabbitmq-stomp/

I would have put the repository on dev.rabbitmq.com, but for some 
extremely unfortunate network setup issues we suffer from inside our 
firewall at present. Once we sort the problems out, all RabbitMQ 
mercurial repositories will be moving to dev.rabbitmq.com.

Regards,
   Tony



From tom at samplonius.org  Sun Feb  3 09:53:45 2008
From: tom at samplonius.org (Tom Samplonius)
Date: Sun, 3 Feb 2008 01:53:45 -0800 (PST)
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <47A3B5C2.6070100@lshift.net>
Message-ID: <19940185.5781202032425657.JavaMail.root@ly.sdf.com>


----- "Tony Garnock-Jones" <tonyg at lshift.net> wrote:
> Hi all,
> 
> I?ve just made our experimental STOMP adapter to RabbitMQ available.
> 
> STOMP (http://stomp.codehaus.org/Home) is a very simple messaging wire
> 
> protocol, with what appears to be fairly broad client support. I've
> only 
> personally experimented with the Perl Net::Stomp client, but according
> 
> to http://stomp.codehaus.org/Clients, there are a bunch of options 
> available.
> 
> Please try it out and let me know what you think! I've made a blog
> post 
> summarising getting the thing running: 
> http://www.lshift.net/blog/2008/02/02/how-to-run-rabbitmqs-experimental-stomp-adapter
> 
> If you use mercurial, you can get a checkout of the adapter code with
> 
> hg clone http://www.lshift.net/~tonyg/hg/hgwebdir.cgi/rabbitmq-stomp/
> 
> I would have put the repository on dev.rabbitmq.com, but for some 
> extremely unfortunate network setup issues we suffer from inside our 
> firewall at present. Once we sort the problems out, all RabbitMQ 
> mercurial repositories will be moving to dev.rabbitmq.com.


  It would cool if the RabbitMQ Makefile used $(MAKE) instead of just executing "make".  Some systems have multiple make versions, with different names.  So "make" may not be GNU make.  Using $(MAKE) solves this problem.

  But so far Stomp support looks ok.  Is the plan to include the protocol into the RabbitMQ tree later, or will be it always be an extra download?


> Regards,
>    Tony


Tom



From alexis.richardson at cohesiveft.com  Sun Feb  3 11:10:31 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sun, 3 Feb 2008 11:10:31 +0000
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <19940185.5781202032425657.JavaMail.root@ly.sdf.com>
References: <47A3B5C2.6070100@lshift.net>
	<19940185.5781202032425657.JavaMail.root@ly.sdf.com>
Message-ID: <167204d20802030310v4f6cf681saaa802d68d5aee68@mail.gmail.com>

Tom

Thanks for your comments.

On Feb 3, 2008 9:53 AM, Tom Samplonius <tom at samplonius.org> wrote:
>
>   But so far Stomp support looks ok.  Is the plan to include the protocol into the RabbitMQ tree later, or will be it always be an extra download?
>

At this stage we are introducing experimental client packs and add-ons
on a strictly by-need basis, i.e. as the community produces them and
customers ask for them, and subject to resources.  STOMP represents a
convenient bridge into existing environments, enabling folks to
benefit from RabbitMQ's stability.  In the future we plan to be more
systematic about RabbitMQ client packs, and managing the tree to
include the clients that have emerged in this way.

Would you like to get involved?

alexis


-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From dgl at dgl.cx  Sun Feb  3 11:15:48 2008
From: dgl at dgl.cx (David Leadbeater)
Date: Sun, 3 Feb 2008 11:15:48 +0000
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <47A3B5C2.6070100@lshift.net>
References: <47A3B5C2.6070100@lshift.net>
Message-ID: <20080203111548.GA19701@dgl.cx>

On Sat, Feb 02, 2008 at 12:13:54AM +0000, Tony Garnock-Jones wrote:
> I?ve just made our experimental STOMP adapter to RabbitMQ available.
> 
> STOMP (http://stomp.codehaus.org/Home) is a very simple messaging wire 
> protocol, with what appears to be fairly broad client support. I've only 
> personally experimented with the Perl Net::Stomp client, but according 
> to http://stomp.codehaus.org/Clients, there are a bunch of options 
> available.

Looks good.

I noticed in some other testing that Net::Stomp currently has a rather
large overhead as it does a getc for every single character in a
frame. Especially if you're consuming large messages (it was
noticeable around 8KB) then this has a huge overhead. It probably
would be quite easy to fix but I haven't looked into it yet.

David



From tonyg at lshift.net  Sun Feb  3 14:57:00 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 03 Feb 2008 14:57:00 +0000
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <19940185.5781202032425657.JavaMail.root@ly.sdf.com>
References: <19940185.5781202032425657.JavaMail.root@ly.sdf.com>
Message-ID: <47A5D63C.3080505@lshift.net>

Hi Tom,

Thanks for the feedback.

Tom Samplonius wrote:
> It would cool if the RabbitMQ Makefile used $(MAKE) instead of just
> executing "make".  Some systems have multiple make versions, with
> different names.  So "make" may not be GNU make.  Using $(MAKE)
> solves this problem.

Good suggestion. Done in CVS HEAD for the RabbitMQ broker, and in 
mercurial default tip for the STOMP adapter. The next broker snapshot or 
release will contain the change.

> But so far Stomp support looks ok.  Is the plan to include the
> protocol into the RabbitMQ tree later, or will be it always be an
> extra download?

We want our codebase to be modular, but we don't want to force a bunch 
of separate downloads.

So while the source trees will probably stay loosely coupled, we'll 
probably provide some kind of preconfigured bundles of binary 
functionality as single downloads in future.

I've also been thinking about a less ad-hoc way of extending the server 
with plugins, but that's probably a wee way off.

Tony



From tonyg at lshift.net  Sun Feb  3 15:06:47 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 03 Feb 2008 15:06:47 +0000
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <20080203111548.GA19701@dgl.cx>
References: <47A3B5C2.6070100@lshift.net> <20080203111548.GA19701@dgl.cx>
Message-ID: <47A5D887.6090401@lshift.net>

Hi David,

David Leadbeater wrote:
> I noticed in some other testing that Net::Stomp currently has a rather
> large overhead as it does a getc for every single character in a
> frame.

How were you testing it? Our Erlang STOMP serialiser always supplies a 
content-length header, and from my reading of the Net::Stomp code, it 
looks like it should use the content-length, when there is one, to do a 
single block read.

Tony




From tonyg at lshift.net  Sun Feb  3 15:17:15 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 03 Feb 2008 15:17:15 +0000
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <47A5D887.6090401@lshift.net>
References: <47A3B5C2.6070100@lshift.net> <20080203111548.GA19701@dgl.cx>
	<47A5D887.6090401@lshift.net>
Message-ID: <47A5DAFB.6070504@lshift.net>

Hi again,

Tony Garnock-Jones wrote:
> How were you testing it? Our Erlang STOMP serialiser always supplies a 
> content-length header, and from my reading of the Net::Stomp code, it 
> looks like it should use the content-length, when there is one, to do a 
> single block read.

I've just checked, by sending

$stomp->send({destination=>'foo',
	      bytes_message=>1,
	      body=>($ARGV[0] or "test\0message")});

that the receiver correctly handles embedded NULs - which means it's in 
the branch that uses the content-length to do a block read. (Of course, 
it's probably still not doing any buffering!)

I'd be interested to hear more about your testing, and how 
RabbitMQ+STOMP performs for your use cases.

Regards,
   Tony



From dgl at dgl.cx  Mon Feb  4 16:22:42 2008
From: dgl at dgl.cx (David Leadbeater)
Date: Mon, 4 Feb 2008 16:22:42 +0000
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <47A5DAFB.6070504@lshift.net>
References: <47A3B5C2.6070100@lshift.net> <20080203111548.GA19701@dgl.cx>
	<47A5D887.6090401@lshift.net> <47A5DAFB.6070504@lshift.net>
Message-ID: <20080204162242.GA16202@dgl.cx>

Hi,

On Sun, Feb 03, 2008 at 03:17:15PM +0000, Tony Garnock-Jones wrote:
> >How were you testing it? Our Erlang STOMP serialiser always supplies a 
> >content-length header, and from my reading of the Net::Stomp code, it 
> >looks like it should use the content-length, when there is one, to do a 
> >single block read.

Sorry, I meant I'd seen the issue against ActiveMQ, it seems to work
quite well with rabbitmq-stomp.  I also just tested it out with
ActiveMQ CMS using STOMP and that seems to work OK.

David



From stevej at gmail.com  Mon Feb  4 21:29:45 2008
From: stevej at gmail.com (Steve Jenson)
Date: Mon, 4 Feb 2008 13:29:45 -0800
Subject: [rabbitmq-discuss] dealing with a closing connection
Message-ID: <81d74c280802041329h383fe463kad22b2d64a479620@mail.gmail.com>

Hi,

I'm using the Java client library to connect to a rabbitmq server
(1.2.0). Sometimes I will restart the server which obviously will
restart rabbitmq and my client application will print out a message to
the console.

AMQConnection.mainLoop: connection close

How can I use the rabbitmq java library to determine that the
Connection has been closed so I can reestablish? I could periodically
close() and recreate the Connection from the ConnectionFactory but I'm
hoping there's something nicer available that I have missed.

Thanks,
Steve



From tonyg at lshift.net  Mon Feb  4 23:56:06 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 04 Feb 2008 23:56:06 +0000
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <20080204162242.GA16202@dgl.cx>
References: <47A3B5C2.6070100@lshift.net> <20080203111548.GA19701@dgl.cx>
	<47A5D887.6090401@lshift.net> <47A5DAFB.6070504@lshift.net>
	<20080204162242.GA16202@dgl.cx>
Message-ID: <47A7A616.5020801@lshift.net>

Hi David,

David Leadbeater wrote:
> Sorry, I meant I'd seen the issue against ActiveMQ, it seems to work
> quite well with rabbitmq-stomp.  I also just tested it out with
> ActiveMQ CMS using STOMP and that seems to work OK.

Great news! Thanks very much!

Tony




From wvanheemstra at xs4all.nl  Tue Feb  5 00:02:17 2008
From: wvanheemstra at xs4all.nl (Willem van Heemstra)
Date: Tue, 5 Feb 2008 00:02:17 +0000
Subject: [rabbitmq-discuss]  Tutorial of RabbitMQ Client
In-Reply-To: <47A7A616.5020801@lshift.net>
References: <47A3B5C2.6070100@lshift.net> <20080203111548.GA19701@dgl.cx>
	<47A5D887.6090401@lshift.net> <47A5DAFB.6070504@lshift.net>
	<20080204162242.GA16202@dgl.cx> <47A7A616.5020801@lshift.net>
Message-ID: <A08EEFDA-B641-4AA1-A7EC-176E0B1FA947@xs4all.nl>

Sorry if this is not the right place, but I am trying to learn how to  
use the RabbitMQ client. Where is the best place to find a tutorial?  
Thanks! Willem
On 4 Feb 2008, at 23:56, Tony Garnock-Jones wrote:

> Hi David,
>
> David Leadbeater wrote:
>> Sorry, I meant I'd seen the issue against ActiveMQ, it seems to work
>> quite well with rabbitmq-stomp.  I also just tested it out with
>> ActiveMQ CMS using STOMP and that seems to work OK.
>
> Great news! Thanks very much!
>
> Tony
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From tonyg at lshift.net  Tue Feb  5 00:09:03 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 05 Feb 2008 00:09:03 +0000
Subject: [rabbitmq-discuss] Tutorial of RabbitMQ Client
In-Reply-To: <A08EEFDA-B641-4AA1-A7EC-176E0B1FA947@xs4all.nl>
References: <47A3B5C2.6070100@lshift.net>
	<20080203111548.GA19701@dgl.cx>	<47A5D887.6090401@lshift.net>
	<47A5DAFB.6070504@lshift.net>	<20080204162242.GA16202@dgl.cx>
	<47A7A616.5020801@lshift.net>
	<A08EEFDA-B641-4AA1-A7EC-176E0B1FA947@xs4all.nl>
Message-ID: <47A7A91F.3040703@lshift.net>

Hi Willem,

The closest thing we have to a tutorial, if you're using Java, is 
http://www.rabbitmq.com/api-guide.html. It could most certainly be 
fleshed out to be more useful, so please take a look and let us know 
where it's weak, so we can improve it.

If you're using .NET/C#, the equivalent is part of the User Guide, 
http://www.rabbitmq.com/releases/doc/rabbitmq-dotnet-release_20080125/rabbitmq-dotnet-1.2.8025.1832-user-guide.pdf 
section 2, "ApiOverview".

There's also some interesting material in chapter 3 of that PDF, which 
is mostly language-neutral. Again, if you think something could be 
explained better, please let us know. We're trying to make using 
RabbitMQ as easy as possible.

Does anyone on the list have any good links to tutorials and 
documentation about AMQP in general or RabbitMQ in particular? We could 
set up a links page, if people think it's a good idea.

Regards,
   Tony


Willem van Heemstra wrote:
> Sorry if this is not the right place, but I am trying to learn how to  
> use the RabbitMQ client. Where is the best place to find a tutorial?  
> Thanks! Willem




From wvanheemstra at xs4all.nl  Tue Feb  5 00:10:01 2008
From: wvanheemstra at xs4all.nl (Willem van Heemstra)
Date: Tue, 5 Feb 2008 00:10:01 +0000
Subject: [rabbitmq-discuss] Tutorial of RabbitMQ Client
In-Reply-To: <167204d20802041604y5bb313aob1832bb785fde5b9@mail.gmail.com>
References: <47A3B5C2.6070100@lshift.net> <20080203111548.GA19701@dgl.cx>
	<47A5D887.6090401@lshift.net> <47A5DAFB.6070504@lshift.net>
	<20080204162242.GA16202@dgl.cx> <47A7A616.5020801@lshift.net>
	<A08EEFDA-B641-4AA1-A7EC-176E0B1FA947@xs4all.nl>
	<167204d20802041604y5bb313aob1832bb785fde5b9@mail.gmail.com>
Message-ID: <AB61C90B-649B-47C7-8038-DDE1384E6957@xs4all.nl>

Thanks for you quick reply, Alexis

The case for us in Scotland (UK) is that we have to demo RabbitMQ to a  
large group of institutions in the field of education (Schools) on  
Thursday.

I have successfully installed RabbitMQ Server on a Mac OS X (10.5)  
Leopard and it is up and running.

For the demo I need to show that we can put messages in a queue on one  
machine and retrieve them on another machine over a network.

Any hints, tips, documentation would be much appreciated. Sorry for  
raising this issue towards a deadline ;o)

Willem

(P.S. I perform magic in my spare-time, and can think of nothing more  
apt than using a Rabbit as messaging software!)
On 5 Feb 2008, at 00:04, Alexis Richardson wrote:

> Willem
>
> We don't normally do this, but I would be happy to take you through a
> tutorial by phone on Friday afternoon.  Please get in touch directly.
>
> alexis
>
>
> On Feb 5, 2008 12:02 AM, Willem van Heemstra  
> <wvanheemstra at xs4all.nl> wrote:
>> Sorry if this is not the right place, but I am trying to learn how to
>> use the RabbitMQ client. Where is the best place to find a tutorial?
>> Thanks! Willem
>> On 4 Feb 2008, at 23:56, Tony Garnock-Jones wrote:
>>
>>> Hi David,
>>>
>>> David Leadbeater wrote:
>>>> Sorry, I meant I'd seen the issue against ActiveMQ, it seems to  
>>>> work
>>>> quite well with rabbitmq-stomp.  I also just tested it out with
>>>> ActiveMQ CMS using STOMP and that seems to work OK.
>>>
>>> Great news! Thanks very much!
>>>
>>> Tony
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> -- 
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)
>




From tonyg at lshift.net  Tue Feb  5 00:18:35 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 05 Feb 2008 00:18:35 +0000
Subject: [rabbitmq-discuss] Tutorial of RabbitMQ Client
In-Reply-To: <AB61C90B-649B-47C7-8038-DDE1384E6957@xs4all.nl>
References: <47A3B5C2.6070100@lshift.net>
	<20080203111548.GA19701@dgl.cx>	<47A5D887.6090401@lshift.net>
	<47A5DAFB.6070504@lshift.net>	<20080204162242.GA16202@dgl.cx>
	<47A7A616.5020801@lshift.net>	<A08EEFDA-B641-4AA1-A7EC-176E0B1FA947@xs4all.nl>	<167204d20802041604y5bb313aob1832bb785fde5b9@mail.gmail.com>
	<AB61C90B-649B-47C7-8038-DDE1384E6957@xs4all.nl>
Message-ID: <47A7AB5B.1020208@lshift.net>

Hi again Willem,

The examples in the Java and .NET/C# code ought, I hope, to be 
sufficient for your purposes. I'd suggest looking at the following 
files, depending on your client language choice:

For sending:
  - in the main erlang-server-and-java-client distro:
    java/test/src/com/rabbitmq/examples/SimpleProducer.java
    java/test/src/com/rabbitmq/examples/SendString.java
  - in the rabbitmq-dotnet distro:
    src/examples/SendString.cs
    src/examples/SendMap.cs

For receiving:
  - in the main erlang/java distro:
    java/test/src/com/rabbitmq/examples/SimpleConsumer.java
    java/test/src/com/rabbitmq/examples/LogTail.java
  - in the .NET/C# distro:
    src/examples/LogTail.cs
    src/examples/SingleGet.cs

Regards,
   Tony




From wvanheemstra at xs4all.nl  Tue Feb  5 00:19:16 2008
From: wvanheemstra at xs4all.nl (Willem van Heemstra)
Date: Tue, 5 Feb 2008 00:19:16 +0000
Subject: [rabbitmq-discuss] Tutorial of RabbitMQ Client
In-Reply-To: <47A7A91F.3040703@lshift.net>
References: <47A3B5C2.6070100@lshift.net>
	<20080203111548.GA19701@dgl.cx>	<47A5D887.6090401@lshift.net>
	<47A5DAFB.6070504@lshift.net>	<20080204162242.GA16202@dgl.cx>
	<47A7A616.5020801@lshift.net>
	<A08EEFDA-B641-4AA1-A7EC-176E0B1FA947@xs4all.nl>
	<47A7A91F.3040703@lshift.net>
Message-ID: <75DF13E7-074B-46FA-8051-2F6D1941ACF2@xs4all.nl>

Thanks Tony,

Those links are very helpful.

I could do with a client in Java that I would know how to configure  
for our simple demo (one client one server/broker).
Do I have to code this client from scratch? Are the parameters hard- 
coded or read from a config file?
It is these questions that a seek answers for.

Thanks again!

Willem


On 5 Feb 2008, at 00:09, Tony Garnock-Jones wrote:

> Hi Willem,
>
> The closest thing we have to a tutorial, if you're using Java, is http://www.rabbitmq.com/api-guide.html 
> . It could most certainly be fleshed out to be more useful, so  
> please take a look and let us know where it's weak, so we can  
> improve it.
>
> If you're using .NET/C#, the equivalent is part of the User Guide, http://www.rabbitmq.com/releases/doc/rabbitmq-dotnet-release_20080125/rabbitmq-dotnet-1.2.8025.1832-user-guide.pdf 
>  section 2, "ApiOverview".
>
> There's also some interesting material in chapter 3 of that PDF,  
> which is mostly language-neutral. Again, if you think something  
> could be explained better, please let us know. We're trying to make  
> using RabbitMQ as easy as possible.
>
> Does anyone on the list have any good links to tutorials and  
> documentation about AMQP in general or RabbitMQ in particular? We  
> could set up a links page, if people think it's a good idea.
>
> Regards,
>  Tony
>
>
> Willem van Heemstra wrote:
>> Sorry if this is not the right place, but I am trying to learn how  
>> to  use the RabbitMQ client. Where is the best place to find a  
>> tutorial?  Thanks! Willem
>
>




From wvanheemstra at xs4all.nl  Tue Feb  5 00:21:29 2008
From: wvanheemstra at xs4all.nl (Willem van Heemstra)
Date: Tue, 5 Feb 2008 00:21:29 +0000
Subject: [rabbitmq-discuss] Tutorial of RabbitMQ Client
In-Reply-To: <47A7AB5B.1020208@lshift.net>
References: <47A3B5C2.6070100@lshift.net>
	<20080203111548.GA19701@dgl.cx>	<47A5D887.6090401@lshift.net>
	<47A5DAFB.6070504@lshift.net>	<20080204162242.GA16202@dgl.cx>
	<47A7A616.5020801@lshift.net>	<A08EEFDA-B641-4AA1-A7EC-176E0B1FA947@xs4all.nl>	<167204d20802041604y5bb313aob1832bb785fde5b9@mail.gmail.com>
	<AB61C90B-649B-47C7-8038-DDE1384E6957@xs4all.nl>
	<47A7AB5B.1020208@lshift.net>
Message-ID: <056FAD92-76F4-4264-9C7C-2452BDA0A16C@xs4all.nl>

Great!

That sounds promising.

Willem

On 5 Feb 2008, at 00:18, Tony Garnock-Jones wrote:

> Hi again Willem,
>
> The examples in the Java and .NET/C# code ought, I hope, to be  
> sufficient for your purposes. I'd suggest looking at the following  
> files, depending on your client language choice:
>
> For sending:
> - in the main erlang-server-and-java-client distro:
>   java/test/src/com/rabbitmq/examples/SimpleProducer.java
>   java/test/src/com/rabbitmq/examples/SendString.java
> - in the rabbitmq-dotnet distro:
>   src/examples/SendString.cs
>   src/examples/SendMap.cs
>
> For receiving:
> - in the main erlang/java distro:
>   java/test/src/com/rabbitmq/examples/SimpleConsumer.java
>   java/test/src/com/rabbitmq/examples/LogTail.java
> - in the .NET/C# distro:
>   src/examples/LogTail.cs
>   src/examples/SingleGet.cs
>
> Regards,
>  Tony
>




From tonyg at lshift.net  Tue Feb  5 00:23:31 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 05 Feb 2008 00:23:31 +0000
Subject: [rabbitmq-discuss] Tutorial of RabbitMQ Client
In-Reply-To: <75DF13E7-074B-46FA-8051-2F6D1941ACF2@xs4all.nl>
References: <47A3B5C2.6070100@lshift.net>
	<20080203111548.GA19701@dgl.cx>	<47A5D887.6090401@lshift.net>
	<47A5DAFB.6070504@lshift.net>	<20080204162242.GA16202@dgl.cx>
	<47A7A616.5020801@lshift.net>
	<A08EEFDA-B641-4AA1-A7EC-176E0B1FA947@xs4all.nl>
	<47A7A91F.3040703@lshift.net>
	<75DF13E7-074B-46FA-8051-2F6D1941ACF2@xs4all.nl>
Message-ID: <47A7AC83.8050502@lshift.net>

Hi again,

Willem van Heemstra wrote:
> Those links are very helpful.

I'm glad. Please do point out anything in the docs that could be better.

> I could do with a client in Java that I would know how to configure for 
> our simple demo (one client one server/broker).
> Do I have to code this client from scratch? Are the parameters 
> hard-coded or read from a config file?
> It is these questions that a seek answers for.

I hope my other post in this thread points you toward skeletons you can 
flesh out to your requirements - and with regard to the config-file 
question,

  1. for the Java client library, we have not implemented any particular
     config-reading mechanism yet - so the answer is that the parameters
     are provided however your application chooses to provide them! :-)

  2. for the .NET client, we have provided the low-level, supply-your-
     own-parameters approach, as well as supporting reading some of the
     configuration from App.config, or from environment variables. You
     may also find the WCF approach of value, if you're using WCF.

Regards,
   Tony




From alexis.richardson at cohesiveft.com  Tue Feb  5 00:50:31 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 5 Feb 2008 00:50:31 +0000
Subject: [rabbitmq-discuss] Tutorial of RabbitMQ Client
In-Reply-To: <AB61C90B-649B-47C7-8038-DDE1384E6957@xs4all.nl>
References: <47A3B5C2.6070100@lshift.net> <20080203111548.GA19701@dgl.cx>
	<47A5D887.6090401@lshift.net> <47A5DAFB.6070504@lshift.net>
	<20080204162242.GA16202@dgl.cx> <47A7A616.5020801@lshift.net>
	<A08EEFDA-B641-4AA1-A7EC-176E0B1FA947@xs4all.nl>
	<167204d20802041604y5bb313aob1832bb785fde5b9@mail.gmail.com>
	<AB61C90B-649B-47C7-8038-DDE1384E6957@xs4all.nl>
Message-ID: <167204d20802041650hed2b6a5vd584f2ffc3c09e42@mail.gmail.com>

Willem

I'd be happy to help - feel free to call me on Wednesday after lunch
on my cell phone (077 9865 2911).  In the meantime please do try to
use Tony's suggestions which I think will help you.

Re your magical inclinations .. if you are ever in London, we can show
you a trick or two...

alexis




On Feb 5, 2008 12:10 AM, Willem van Heemstra <wvanheemstra at xs4all.nl> wrote:
> Thanks for you quick reply, Alexis
>
> The case for us in Scotland (UK) is that we have to demo RabbitMQ to a
> large group of institutions in the field of education (Schools) on
> Thursday.
>
> I have successfully installed RabbitMQ Server on a Mac OS X (10.5)
> Leopard and it is up and running.
>
> For the demo I need to show that we can put messages in a queue on one
> machine and retrieve them on another machine over a network.
>
> Any hints, tips, documentation would be much appreciated. Sorry for
> raising this issue towards a deadline ;o)
>
> Willem
>
> (P.S. I perform magic in my spare-time, and can think of nothing more
> apt than using a Rabbit as messaging software!)
>
> On 5 Feb 2008, at 00:04, Alexis Richardson wrote:
>
> > Willem
> >
> > We don't normally do this, but I would be happy to take you through a
> > tutorial by phone on Friday afternoon.  Please get in touch directly.
> >
> > alexis
> >
> >
> > On Feb 5, 2008 12:02 AM, Willem van Heemstra
> > <wvanheemstra at xs4all.nl> wrote:
> >> Sorry if this is not the right place, but I am trying to learn how to
> >> use the RabbitMQ client. Where is the best place to find a tutorial?
> >> Thanks! Willem
> >> On 4 Feb 2008, at 23:56, Tony Garnock-Jones wrote:
> >>
> >>> Hi David,
> >>>
> >>> David Leadbeater wrote:
> >>>> Sorry, I meant I'd seen the issue against ActiveMQ, it seems to
> >>>> work
> >>>> quite well with rabbitmq-stomp.  I also just tested it out with
> >>>> ActiveMQ CMS using STOMP and that seems to work OK.
> >>>
> >>> Great news! Thanks very much!
> >>>
> >>> Tony
> >>>
> >>>
> >>> _______________________________________________
> >>> rabbitmq-discuss mailing list
> >>> rabbitmq-discuss at lists.rabbitmq.com
> >>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> >
> >
> > --
> > Alexis Richardson
> > +44 20 7617 7339 (UK)
> > +44 77 9865 2911 (cell)
> > +1 650 206 2517 (US)
> >
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From matthias at lshift.net  Wed Feb  6 06:28:52 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 06 Feb 2008 06:28:52 +0000
Subject: [rabbitmq-discuss] dealing with a closing connection
In-Reply-To: <81d74c280802041329h383fe463kad22b2d64a479620@mail.gmail.com>
References: <81d74c280802041329h383fe463kad22b2d64a479620@mail.gmail.com>
Message-ID: <47A953A4.5070409@lshift.net>

Steve,

Steve Jenson wrote:
> How can I use the rabbitmq java library to determine that the
> Connection has been closed so I can reestablish?

You could call isOpen() on the connection/channel, either periodically 
or before attempting an operation, to check whether the connection is 
still open, and attempt reconnection if not. This does of course leave a 
time window where an operation may be attempted when the connection is 
closed, which may or may not be a problem for your application.

In the .net client you can install event handlers on connection/channel 
objects that get notified of shutdowns, which is neater but still 
suffers from the same problem.

The better approach is to catch the IOException resulting from any 
operation the client attempts, check that the cause is a 
ShutdownSignalException, and then perform the necessary reconnection 
actions.


Matthias.



From stevej at gmail.com  Wed Feb  6 17:37:37 2008
From: stevej at gmail.com (Steve Jenson)
Date: Wed, 6 Feb 2008 09:37:37 -0800
Subject: [rabbitmq-discuss] dealing with a closing connection
In-Reply-To: <47A953A4.5070409@lshift.net>
References: <81d74c280802041329h383fe463kad22b2d64a479620@mail.gmail.com>
	<47A953A4.5070409@lshift.net>
Message-ID: <81d74c280802060937i4d2bb56dp60b18074500068f8@mail.gmail.com>

On Feb 5, 2008 10:28 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Steve,
>
> Steve Jenson wrote:
> > How can I use the rabbitmq java library to determine that the
> > Connection has been closed so I can reestablish?
>
> You could call isOpen() on the connection/channel, either periodically
> or before attempting an operation, to check whether the connection is
> still open, and attempt reconnection if not. This does of course leave a
> time window where an operation may be attempted when the connection is
> closed, which may or may not be a problem for your application.

Connection and Channel have no method for determining whether they are
still open that I can tell, unfortunately.

> In the .net client you can install event handlers on connection/channel
> objects that get notified of shutdowns, which is neater but still
> suffers from the same problem.
>
> The better approach is to catch the IOException resulting from any
> operation the client attempts, check that the cause is a
> ShutdownSignalException, and then perform the necessary reconnection
> actions.

I'm using basicConsume and see no exceptions when the connection is
closed, my consumer is simply never called again.

I certainly don't mind handling an exception or checking if the
connection is open, I just don't see a way to do either.

Steve



From dmitriy.samovskiy at cohesiveft.com  Wed Feb  6 17:45:28 2008
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Wed, 06 Feb 2008 11:45:28 -0600
Subject: [rabbitmq-discuss] Building Erlang for RabbitMQ
In-Reply-To: <47A3B5C2.6070100@lshift.net>
References: <47A3B5C2.6070100@lshift.net>
Message-ID: <47A9F238.7000909@cohesiveft.com>


Hi Tony,

Could you please recommend ./configure options for building Erlang R11B-5.

I noticed erl in your session reports "Erlang (BEAM) emulator version 5.5.5 [source] 
[async-threads:30] [kernel-poll:true]", and mine says "Erlang (BEAM) emulator version 
5.5.5 [source] [async-threads:0] [hipe] [kernel-poll:false]".  Are these differences 
significant? I built with "--prefix=/usr --disable-x".

BTW, Erlang R12B-1 is out today (Feb 6).

Thanks,
Dmitriy



Tony Garnock-Jones wrote:
> Hi all,
> 
> I?ve just made our experimental STOMP adapter to RabbitMQ available.
> 
> STOMP (http://stomp.codehaus.org/Home) is a very simple messaging wire 
> protocol, with what appears to be fairly broad client support. I've only 
> personally experimented with the Perl Net::Stomp client, but according 
> to http://stomp.codehaus.org/Clients, there are a bunch of options 
> available.
> 
> Please try it out and let me know what you think! I've made a blog post 
> summarising getting the thing running: 
> http://www.lshift.net/blog/2008/02/02/how-to-run-rabbitmqs-experimental-stomp-adapter
> 
> If you use mercurial, you can get a checkout of the adapter code with
> 
> hg clone http://www.lshift.net/~tonyg/hg/hgwebdir.cgi/rabbitmq-stomp/
> 
> I would have put the repository on dev.rabbitmq.com, but for some 
> extremely unfortunate network setup issues we suffer from inside our 
> firewall at present. Once we sort the problems out, all RabbitMQ 
> mercurial repositories will be moving to dev.rabbitmq.com.
> 
> Regards,
>    Tony
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 



From matthias at lshift.net  Wed Feb  6 18:56:45 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 06 Feb 2008 18:56:45 +0000
Subject: [rabbitmq-discuss] dealing with a closing connection
In-Reply-To: <81d74c280802060937i4d2bb56dp60b18074500068f8@mail.gmail.com>
References: <81d74c280802041329h383fe463kad22b2d64a479620@mail.gmail.com>	<47A953A4.5070409@lshift.net>
	<81d74c280802060937i4d2bb56dp60b18074500068f8@mail.gmail.com>
Message-ID: <47AA02ED.1050800@lshift.net>

Steve,

Steve Jenson wrote:

> Connection and Channel have no method for determining whether they are
> still open that I can tell, unfortunately.

Ah yes, I forgot those methods aren't in the Connection/Channel 
interfaces (as they are for the .Net client). You can find them in the 
implementation classes AMQConnection and AMQChannel though.

This is an area we are planning to revise in a future release, probably 
by following the example of the .Net client.

> I'm using basicConsume and see no exceptions when the connection is
> closed, my consumer is simply never called again.

You should be able to override Consumer.handleShutdownSignal(String, 
ShutdownSignalException), which ought to get called when the connection 
or channel are shut down.


Matthias.



From stevej at gmail.com  Wed Feb  6 19:23:22 2008
From: stevej at gmail.com (Steve Jenson)
Date: Wed, 6 Feb 2008 11:23:22 -0800
Subject: [rabbitmq-discuss] dealing with a closing connection
In-Reply-To: <47AA02ED.1050800@lshift.net>
References: <81d74c280802041329h383fe463kad22b2d64a479620@mail.gmail.com>
	<47A953A4.5070409@lshift.net>
	<81d74c280802060937i4d2bb56dp60b18074500068f8@mail.gmail.com>
	<47AA02ED.1050800@lshift.net>
Message-ID: <81d74c280802061123k170592bft93a6f7176d5449e2@mail.gmail.com>

On Feb 6, 2008 10:56 AM, Matthias Radestock <matthias at lshift.net> wrote:
> Steve,
>
> Steve Jenson wrote:
>
> > Connection and Channel have no method for determining whether they are
> > still open that I can tell, unfortunately.
>
> Ah yes, I forgot those methods aren't in the Connection/Channel
> interfaces (as they are for the .Net client). You can find them in the
> implementation classes AMQConnection and AMQChannel though.
>
> This is an area we are planning to revise in a future release, probably
> by following the example of the .Net client.

I look forward to trying it out.

> > I'm using basicConsume and see no exceptions when the connection is
> > closed, my consumer is simply never called again.
>
> You should be able to override Consumer.handleShutdownSignal(String,
> ShutdownSignalException), which ought to get called when the connection
> or channel are shut down.

That's perfect, thank you. I will give that a try.

Steve



From alexis.richardson at cohesiveft.com  Fri Feb  8 14:37:48 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 8 Feb 2008 14:37:48 +0000
Subject: [rabbitmq-discuss] perl client, C client, C++ client,
	and STOMP .. and JMS
Message-ID: <167204d20802080637l618cd3bewc401d71b822077eb@mail.gmail.com>

Hi everyone

We are still working on getting you a decent C/C++ client.

Meanwhile.... Tony has created a STOMP adapter:
http://www.lshift.net/blog/2008/02/02/how-to-run-rabbitmqs-experimental-stomp-adapter

This is cool because:

1. It represents a solution to getting Perl, C, C++ etc to talk to
RabbitMQ.  Please give it a go, if you are using STOMP.
2. If you are using STOMP with JMS, this lets you try RabbitMQ as well
- just start a RabbitMQ broker and point your STOMP client at it.

Have fun with this ;-)

alexis






-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From tonyg at lshift.net  Fri Feb  8 15:02:23 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 08 Feb 2008 15:02:23 +0000
Subject: [rabbitmq-discuss] Building Erlang for RabbitMQ
In-Reply-To: <47A9F238.7000909@cohesiveft.com>
References: <47A3B5C2.6070100@lshift.net> <47A9F238.7000909@cohesiveft.com>
Message-ID: <47AC6EFF.3000103@lshift.net>

Hi Dmitriy,

Dmitriy Samovskiy wrote:
> Could you please recommend ./configure options for building Erlang R11B-5.

I've really only ever tried "./configure --prefix=/opt/erlang", on my
Mac. Otherwise I use the stock Debian packages or Windows binaries.

> I noticed erl in your session reports "Erlang (BEAM) emulator version
> 5.5.5 [source] [async-threads:30] [kernel-poll:true]", and mine says
> "Erlang (BEAM) emulator version 5.5.5 [source] [async-threads:0] [hipe]
> [kernel-poll:false]".  Are these differences significant? I built with
> "--prefix=/usr --disable-x".

The differences are interesting. The async-threads were something we
enabled to reduce the impact of blocking system calls for workloads
involving persistent messages, but since it's only a minor tweak for
performance enhancement in one case, it shouldn't matter if it's not
there usually.

The kernel-poll thing is I think an extension for more efficient IO
eventing from the kernel. Only a few operating systems support it.

What kind of platform are you building Erlang on?

> BTW, Erlang R12B-1 is out today (Feb 6).

Thanks for the tip! I'm looking forward to experimenting with it; for
now, we're still recommending R11B-5.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From dmitriy.samovskiy at cohesiveft.com  Fri Feb  8 19:45:01 2008
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Fri, 08 Feb 2008 13:45:01 -0600
Subject: [rabbitmq-discuss] Building Erlang for RabbitMQ
In-Reply-To: <47AC6EFF.3000103@lshift.net>
References: <47A3B5C2.6070100@lshift.net> <47A9F238.7000909@cohesiveft.com>
	<47AC6EFF.3000103@lshift.net>
Message-ID: <47ACB13D.1070608@cohesiveft.com>

Hi Tony,

Tony Garnock-Jones wrote:
>> Could you please recommend ./configure options for building Erlang R11B-5.
> 
> I've really only ever tried "./configure --prefix=/opt/erlang", on my
> Mac. Otherwise I use the stock Debian packages or Windows binaries.
> 
>> I noticed erl in your session reports "Erlang (BEAM) emulator version
>> 5.5.5 [source] [async-threads:30] [kernel-poll:true]", and mine says
>> "Erlang (BEAM) emulator version 5.5.5 [source] [async-threads:0] [hipe]
>> [kernel-poll:false]".  Are these differences significant? I built with
>> "--prefix=/usr --disable-x".
> 
> The differences are interesting. The async-threads were something we
> enabled to reduce the impact of blocking system calls for workloads
> involving persistent messages, but since it's only a minor tweak for
> performance enhancement in one case, it shouldn't matter if it's not
> there usually.
> 
I also use Debian. I found that I can make my erl behave more like one from your session 
by calling it as "erl +K true +A 30" and rebuilding it with --disable-hipe. I will stick 
with your defaults since I am new to Erlang. Please let us know if you find better 
optimizations for running rabbitmq brokers.

Thanks for the explanation!

Dmitriy



From holger at wizards.de  Fri Feb 15 12:57:13 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Fri, 15 Feb 2008 13:57:13 +0100
Subject: [rabbitmq-discuss] Generic AMQP API / Java client library evolution
	(OT?)
Message-ID: <47B58C29.6060103@wizards.de>

Hi all,

A more general question about AMQP, hope that is not too OT. Does anybody 
know if there are any plans for a generic Java API in terms of interfaces, 
like JMS? I saw the note about the "properly modeled" client API on the 
Rabbit roadmap and it was not entirely clear whether this will follow some 
kind of common API. Looking at Qpid they seem to happily mix Qpid and JMS 
APIs, which may help adoption but IMHO looks a bit questionable from an 
evolutionary point of view, since AMQP is so much more powerful and 
well-defined than JMS.
Any thoughts appreciated.

thanks,
Holger




From alexis.richardson at cohesiveft.com  Fri Feb 15 14:36:15 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 15 Feb 2008 14:36:15 +0000
Subject: [rabbitmq-discuss] Generic AMQP API / Java client library
	evolution (OT?)
In-Reply-To: <47B58C29.6060103@wizards.de>
References: <47B58C29.6060103@wizards.de>
Message-ID: <167204d20802150636u55dce9aesfcf39d15bc71761@mail.gmail.com>

Holger

Good to hear from you again.

On Fri, Feb 15, 2008 at 12:57 PM, Holger Hoffst?tte <holger at wizards.de> wrote:
> Hi all,
>
>  A more general question about AMQP, hope that is not too OT. Does anybody
>  know if there are any plans for a generic Java API in terms of interfaces,
>  like JMS?

Yes.  But not quite yet.  Watch for public announcements from the AMQP
WG quite soon, on the spec and roadmap.


> I saw the note about the "properly modeled" client API on the
>  Rabbit roadmap and it was not entirely clear whether this will follow some
>  kind of common API.

We are looking at this right now.  Have you seen our .NET
documentation?  That gives a flavour of where we want to go.  We are
keen to involve everyone in this discussion.  Let us know if you want
to get involved.



> Looking at Qpid they seem to happily mix Qpid and JMS
>  APIs, which may help adoption but IMHO looks a bit questionable from an
>  evolutionary point of view, since AMQP is so much more powerful and
>  well-defined than JMS.
>  Any thoughts appreciated.

I think it is fair to say that AMQP's model needs native support in an
API.  Especially outside Java, or to 'take full advantage' of AMQP.

At the same time, JMS is a major standard.  I quite understand anyone
wanting to use it.

Thoughts?

alexis


>
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From dwischusen at gmail.com  Mon Feb 18 21:49:56 2008
From: dwischusen at gmail.com (Derek Wischusen)
Date: Mon, 18 Feb 2008 13:49:56 -0800 (PST)
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <47A3B5C2.6070100@lshift.net>
References: <47A3B5C2.6070100@lshift.net>
Message-ID: <15549124.post@talk.nabble.com>


Thank you for creating this adapter.  I just tested it out with the
ActionScript (Flash/Flex) Stomp client and everything seemed to work quite
well.  If anyone is interested, I wrote up a short post about it here:
http://flexonrails.net/?p=106.

Are you planning on adding any custom AMQP specific extensions to the
protocol like ActiveMQ does for JMS (see
http://activemq.apache.org/stomp.html)?  It looks like there is already one
for specifying an exchange. Do you think you might add others?

Best,

Derek



Tony Garnock-Jones-2 wrote:
> 
> Hi all,
> 
> I?ve just made our experimental STOMP adapter to RabbitMQ available.
> 
> STOMP (http://stomp.codehaus.org/Home) is a very simple messaging wire 
> protocol, with what appears to be fairly broad client support. I've only 
> personally experimented with the Perl Net::Stomp client, but according 
> to http://stomp.codehaus.org/Clients, there are a bunch of options 
> available.
> 
> Please try it out and let me know what you think! I've made a blog post 
> summarising getting the thing running: 
> http://www.lshift.net/blog/2008/02/02/how-to-run-rabbitmqs-experimental-stomp-adapter
> 
> If you use mercurial, you can get a checkout of the adapter code with
> 
> hg clone http://www.lshift.net/~tonyg/hg/hgwebdir.cgi/rabbitmq-stomp/
> 
> I would have put the repository on dev.rabbitmq.com, but for some 
> extremely unfortunate network setup issues we suffer from inside our 
> firewall at present. Once we sort the problems out, all RabbitMQ 
> mercurial repositories will be moving to dev.rabbitmq.com.
> 
> Regards,
>    Tony
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://www.nabble.com/Experimental-STOMP-adapter-available-tp15237803p15549124.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From alexis.richardson at cohesiveft.com  Tue Feb 19 15:46:27 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 19 Feb 2008 15:46:27 +0000
Subject: [rabbitmq-discuss] documentation for running tests
Message-ID: <167204d20802190746p7a73fe91xde2591938e950dde@mail.gmail.com>

Hi everyone

Some of you have asked for documentation on performance tests and
other kinds of test.

I attach a PDF to that end.  This will go on the web site soon.

alexis


-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQ_ SimplePerformanceTests.pdf
Type: application/pdf
Size: 86875 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080219/f040a2c2/attachment.pdf 

From splisson at veodia.com  Tue Feb 19 23:51:28 2008
From: splisson at veodia.com (Sebastien PLISSON)
Date: Tue, 19 Feb 2008 15:51:28 -0800
Subject: [rabbitmq-discuss] Rabbitmqctl issue
Message-ID: <C3E0AB80.180F%splisson@veodia.com>

Hello,

I installed rabbitmq server using the debian repository.

The rabbitmqserver seems to work well when I use it but I have errors when I
try to use rabbitmqctl :

rabbitmqctl list_users
{error_logger,{{2008,2,19},{12,25,21}},crash_report,[[{pid,<0.19.0>},{regist
ered_name,auth},{error_info,{{case_clause,eof},[{auth,read_cookie,2},{auth,i
nit_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}},{i
nitial_call,{gen,init_it,[gen_server,<0.17.0>,<0.17.0>,{local,auth},auth,[],
[]]}},{ancestors,[net_sup,kernel_sup,<0.8.0>]},{messages,[]},{links,[<0.17.0
>,#Port<0.7>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,
377},{stack_size,21},{reductions,2652}],[]]}
{error_logger,{{2008,2,19},{12,25,21}},supervisor_report,[{supervisor,{local
,net_sup}},{errorContext,start_error},{reason,{{case_clause,eof},[{auth,read
_cookie,2},{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_l
ib,init_p,5}]}},{offender,[{pid,undefined},{name,auth},{mfa,{auth,start_link
,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2008,2,19},{12,25,21}},supervisor_report,[{supervisor,{local
,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,u
ndefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_typ
e,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2008,2,19},{12,25,21}},crash_report,[[{pid,<0.7.0>},{registe
red_name,[]},{error_info,{shutdown,{kernel,start,[normal,[]]}}},{initial_cal
l,{application_master,init,[<0.5.0>,<0.6.0>,{appl_data,kernel,[application_c
ontroller,erl_reply,auth,boot_server,code_server,disk_log_server,disk_log_su
p,erl_prim_loader,error_logger,file_server_2,fixtable_server,global_group,gl
obal_name_server,heart,init,kernel_config,kernel_sup,net_kernel,net_sup,rex,
user,os_server,ddll_server,erl_epmd,inet_db,pg2],undefined,{kernel,[]},[appl
ication,application_controller,application_master,application_starter,auth,c
ode,code_aux,packages,code_server,dist_util,erl_boot_server,erl_distribution
,erl_prim_loader,erl_reply,erlang,error_handler,error_logger,file,file_serve
r,file_io_server,prim_file,global,global_group,global_search,group,heart,hip
e_unified_loader,inet6_tcp,inet6_tcp_dist,inet6_udp,inet_config,inet_hosts,i
net_gethost_native,inet_tcp_dist,init,kernel,kernel_config,net,net_adm,net_k
ernel,os,ram_file,rpc,user,user_drv,user_sup,disk_log,disk_log_1,disk_log_se
rver,disk_log_sup,dist_ac,erl_ddll,erl_epmd,erts_debug,gen_tcp,gen_udp,prim_
inet,inet,inet_db,inet_dns,inet_parse,inet_res,inet_tcp,inet_udp,pg2,seq_tra
ce,wrap_log_reader,zlib,otp_ring0],[],infinity,infinity},normal]}},{ancestor
s,[<0.6.0>]},{messages,[{'EXIT',<0.8.0>,normal}]},{links,[<0.6.0>,<0.5.0>]},
{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_siz
e,21},{reductions,2079}],[]]}
{error_logger,{{2008,2,19},{12,25,21}},std_info,[{application,kernel},{exite
d,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid 
terminated",application_controller,"{application_start_failure,kernel,{shutd
own,{kernel,start,[normal,[]]}}}"}
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})


What is wrong on my installation ?

Thanks
Sebastien Plisson




From tom at samplonius.org  Wed Feb 20 07:40:24 2008
From: tom at samplonius.org (Tom Samplonius)
Date: Tue, 19 Feb 2008 23:40:24 -0800 (PST)
Subject: [rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
Message-ID: <10837132.5991203493224371.JavaMail.root@ly.sdf.com>


  I see that RabbitMQ does not yet have replication for message queues.  I need a high-available message queue that never loses messages.  I'm not terribly concerned about performance, as I just need to process several thousand messages per day.  It is just hard to repair consistency if any are lost.

  I thought about using DRDB to replicate RabbitMQ's on-disk Mnesia store to a standby node.  I've used DRDB successfully for MySQL, and it works well.  And then use Hearbeat to start RabbitMQ on the standby node, which would then recover the Mnesia tables, and start running.

  Anyone tried DRDB, or any other block mirroring system to create a cluster layer beneath RabbitMQ?

Tom



From matthias at lshift.net  Wed Feb 20 09:25:53 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 20 Feb 2008 09:25:53 +0000
Subject: [rabbitmq-discuss] Rabbitmqctl issue
In-Reply-To: <C3E0AB80.180F%splisson@veodia.com>
References: <C3E0AB80.180F%splisson@veodia.com>
Message-ID: <47BBF221.60200@lshift.net>

Sebastien,

Sebastien PLISSON wrote:
> Hello,
> 
> I installed rabbitmq server using the debian repository.
> 
> The rabbitmqserver seems to work well when I use it but I have errors when I
> try to use rabbitmqctl :
> 
> rabbitmqctl list_users
> {error_logger,{{2008,2,19},{12,25,21}},crash_report,[[{pid,<0.19.0>},{regist
> ered_name,auth},{error_info,{{case_clause,eof},[{auth,read_cookie,2},{auth,i
> nit_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}},{i
> nitial_call,{gen,init_it,[gen_server,<0.17.0>,<0.17.0>,{local,auth},auth,[],
> []]}},{ancestors,[net_sup,kernel_sup,<0.8.0>]},{messages,[]},{links,[<0.17.0
>> ,#Port<0.7>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,
> 377},{stack_size,21},{reductions,2652}],[]]}

It looks like rabbitmqctl encounters an eof reading the ~/.erlang.cookie 
file.

In the debian package, rabbitmqctl is a wrapper script that calls the 
real rabbitmqctl script as the 'rabbitmq' user. Please check that 
~rabbitmq/.erlang.cookie exists, is readable by the rabbitmq user and 
non-empty.

The recommended way to start the server under Debian is with 
'invoke-rc.d rabbitmq-server stop/start/etc', which starts RabbitMQ as 
the 'rabbitmq' user. Did you perhaps run 'rabbitmq-server' directly?


Matthias.



From splisson at veodia.com  Wed Feb 20 14:36:26 2008
From: splisson at veodia.com (Sebastien PLISSON)
Date: Wed, 20 Feb 2008 06:36:26 -0800
Subject: [rabbitmq-discuss] Rabbitmqctl issue
In-Reply-To: <47BBF221.60200@lshift.net>
Message-ID: <C3E17AEA.181B%splisson@veodia.com>

Eventually I was runnning rabbitmq-server directly.

Now when I try with the invoke-rc.d command, I get :
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

Thanks
Sebastien


On 2/20/08 1:25 AM, "Matthias Radestock" <matthias at lshift.net> wrote:

> Sebastien,
> 
> Sebastien PLISSON wrote:
>> Hello,
>> 
>> I installed rabbitmq server using the debian repository.
>> 
>> The rabbitmqserver seems to work well when I use it but I have errors when I
>> try to use rabbitmqctl :
>> 
>> rabbitmqctl list_users
>> {error_logger,{{2008,2,19},{12,25,21}},crash_report,[[{pid,<0.19.0>},{regist
>> ered_name,auth},{error_info,{{case_clause,eof},[{auth,read_cookie,2},{auth,i
>> nit_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}},{i
>> nitial_call,{gen,init_it,[gen_server,<0.17.0>,<0.17.0>,{local,auth},auth,[],
>> []]}},{ancestors,[net_sup,kernel_sup,<0.8.0>]},{messages,[]},{links,[<0.17.0
>>> ,#Port<0.7>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,
>> 377},{stack_size,21},{reductions,2652}],[]]}
> 
> It looks like rabbitmqctl encounters an eof reading the ~/.erlang.cookie
> file.
> 
> In the debian package, rabbitmqctl is a wrapper script that calls the
> real rabbitmqctl script as the 'rabbitmq' user. Please check that
> ~rabbitmq/.erlang.cookie exists, is readable by the rabbitmq user and
> non-empty.
> 
> The recommended way to start the server under Debian is with
> 'invoke-rc.d rabbitmq-server stop/start/etc', which starts RabbitMQ as
> the 'rabbitmq' user. Did you perhaps run 'rabbitmq-server' directly?
> 
> 
> Matthias.




From dmitriy.samovskiy at cohesiveft.com  Wed Feb 20 14:39:21 2008
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Wed, 20 Feb 2008 08:39:21 -0600
Subject: [rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
In-Reply-To: <10837132.5991203493224371.JavaMail.root@ly.sdf.com>
References: <10837132.5991203493224371.JavaMail.root@ly.sdf.com>
Message-ID: <47BC3B99.4000408@cohesiveft.com>


Hi Tom,

Tom Samplonius wrote:
>   I see that RabbitMQ does not yet have replication for message queues.  I need a high-available message queue that never loses messages.  I'm not terribly concerned about performance, as I just need to process several thousand messages per day.  It is just hard to repair consistency if any are lost.

I am also in a very similar situation - HA is more important for my project than 
throughput. It is my understanding that if you define your queues as durable and send 
messages as persistent, your messages will be saved on disk until consumed. A bigger 
question is how long it will take between a message is sent and the message is consumed. 
Out of the box, I guess it depends on how fast you can restore the original broker (app, 
system and/or network connectivity, depending on what failed).

>   I thought about using DRDB to replicate RabbitMQ's on-disk Mnesia store to a standby node.  I've used DRDB successfully for MySQL, and it works well.  And then use Hearbeat to start RabbitMQ on the standby node, which would then recover the Mnesia tables, and start running.
So you are planning to produce to a broker and consume from the same broker. And once that 
broker fails, you will have both producers and consumers shift to another broker, which 
you will start on DRBD-cloned disk after the first broker failed?


I am currently leaning towards a cluster of rabbitmq brokers. Producers will send messages 
to one broker, consumers will connect to *all* brokers in a cluster and will  have 
application logic to identify duplicate messages (just in case). Producers will get an 
exception if their broker failed to properly receive their message and will reconnect and 
resend (tested with QPid python, planning to switch py-amqplib shortly). Consumers might 
not get an exception about broker failure soon enough, therefore for now I will have them 
consuming from all brokers in the cluster.

I hope that latter approach will work better for me, since in my case I might have trouble 
convincing all consumers at the same time that one particular broker is not available 
(some of my consumers are over LAN, some are over WAN; if I lose WAN access, consumers on 
the WAN will think the broker is gone, while consumers on LAN will still be able to talk 
to it).


Please let us know if you get to deploy rabbitmq with DRBD-backed storage and how it works 
for you.

Thanks,
Dmitriy



From splisson at veodia.com  Wed Feb 20 16:18:41 2008
From: splisson at veodia.com (Sebastien PLISSON)
Date: Wed, 20 Feb 2008 08:18:41 -0800
Subject: [rabbitmq-discuss] Rabbitmqctl issue
In-Reply-To: <C3E17AEA.181B%splisson@veodia.com>
Message-ID: <C3E192E1.181E%splisson@veodia.com>

After cleaning the processes, it finally worked fine !

Thanks for the help

Sebastien


On 2/20/08 6:36 AM, "Sebastien PLISSON" <splisson at veodia.com> wrote:

> Eventually I was runnning rabbitmq-server directly.
> 
> Now when I try with the invoke-rc.d command, I get :
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> 
> Thanks
> Sebastien
> 
> 
> On 2/20/08 1:25 AM, "Matthias Radestock" <matthias at lshift.net> wrote:
> 
>> Sebastien,
>> 
>> Sebastien PLISSON wrote:
>>> Hello,
>>> 
>>> I installed rabbitmq server using the debian repository.
>>> 
>>> The rabbitmqserver seems to work well when I use it but I have errors when I
>>> try to use rabbitmqctl :
>>> 
>>> rabbitmqctl list_users
>>> {error_logger,{{2008,2,19},{12,25,21}},crash_report,[[{pid,<0.19.0>},{regist
>>> ered_name,auth},{error_info,{{case_clause,eof},[{auth,read_cookie,2},{auth,i
>>> nit_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}},{i
>>> nitial_call,{gen,init_it,[gen_server,<0.17.0>,<0.17.0>,{local,auth},auth,[],
>>> []]}},{ancestors,[net_sup,kernel_sup,<0.8.0>]},{messages,[]},{links,[<0.17.0
>>>> ,#Port<0.7>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,
>>> 377},{stack_size,21},{reductions,2652}],[]]}
>> 
>> It looks like rabbitmqctl encounters an eof reading the ~/.erlang.cookie
>> file.
>> 
>> In the debian package, rabbitmqctl is a wrapper script that calls the
>> real rabbitmqctl script as the 'rabbitmq' user. Please check that
>> ~rabbitmq/.erlang.cookie exists, is readable by the rabbitmq user and
>> non-empty.
>> 
>> The recommended way to start the server under Debian is with
>> 'invoke-rc.d rabbitmq-server stop/start/etc', which starts RabbitMQ as
>> the 'rabbitmq' user. Did you perhaps run 'rabbitmq-server' directly?
>> 
>> 
>> Matthias.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From peterson at orbitec.com.au  Thu Feb 21 01:09:15 2008
From: peterson at orbitec.com.au (David Peterson)
Date: Thu, 21 Feb 2008 12:09:15 +1100
Subject: [rabbitmq-discuss] Rabbit-Spring integration
Message-ID: <1203556155.9050.7.camel@vostok>


Hey guys,

We're currently evaluating RabbitMQ in a Java environment as an
alternative to a conventional JMS messaging system. Ideally, I would
like to "plug-in" rabbit in a manner similar to the way that JMS is
supported by Spring 2.x (i.e. a MessageContainer and MessageListener
implementation that allows "message-driven POJOs").

My question is: are there any spring support classes for Rabbit at this
time that provide this kind of integration?

I've already started prototyping a few ideas in this regard and I'm
wondering whether they would be welcome within the Java client, perhaps
within a a com.rabbitmq.spring.* package heirarchy?

A second question: I note that Rabbit defines the various AMQP
interfaces inside the com.rabbitmq.* heirarchy. Do you know whether
there are any plans by the AMQP consortium to split this out into an
"org.amqp.*" heirarchy that could be implemented against by any Java API
(rabbit included)?

Thanks in advance for your help and guidance.

Dave






From alexis.richardson at cohesiveft.com  Thu Feb 21 13:19:34 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 21 Feb 2008 13:19:34 +0000
Subject: [rabbitmq-discuss] Rabbit-Spring integration
In-Reply-To: <1203556155.9050.7.camel@vostok>
References: <1203556155.9050.7.camel@vostok>
Message-ID: <167204d20802210519o3436fc1dk4b8438d1057a8344@mail.gmail.com>

Hi David

On Thu, Feb 21, 2008 at 1:09 AM, David Peterson <peterson at orbitec.com.au> wrote:
>
>  We're currently evaluating RabbitMQ in a Java environment as an
>  alternative to a conventional JMS messaging system.

Excellent :-)

Do you have any non-Java cases too?  Or are you currently thinking of
a Java2Java messaging set-up?

[ I ask because we've just released a .NET client, which will interop
with Java over AMQP, plus of course the STOMP and HTTP clients seem
useful to Java users. ]


>  Ideally, I would
>  like to "plug-in" rabbit in a manner similar to the way that JMS is
>  supported by Spring 2.x (i.e. a MessageContainer and MessageListener
>  implementation that allows "message-driven POJOs").

This is eminently sensible.


>  My question is: are there any spring support classes for Rabbit at this
>  time that provide this kind of integration?

Not yet.. We did look at it, and it seems like a refactoring of the
Spring messaging classes using RabbitMQ's Java client, would be
straightforward.


>  I've already started prototyping a few ideas in this regard and I'm
>  wondering whether they would be welcome within the Java client, perhaps
>  within a a com.rabbitmq.spring.* package heirarchy?

That would be extremely welcome!

I am cc'ing some potentially interested parties.



>  A second question: I note that Rabbit defines the various AMQP
>  interfaces inside the com.rabbitmq.* heirarchy. Do you know whether
>  there are any plans by the AMQP consortium to split this out into an
>  "org.amqp.*" heirarchy that could be implemented against by any Java API
>  (rabbit included)?

Yes.  The AMQP Working Group believes that a client API could be
useful, for example a set of Java interface classes in a package
org.amqp.*

What do you think of the RabbitMQ Java and C# APIs?


>  Thanks in advance for your help and guidance.

It's a pleasure.

alexis




>
>
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From splisson at veodia.com  Thu Feb 21 15:45:18 2008
From: splisson at veodia.com (Sebastien PLISSON)
Date: Thu, 21 Feb 2008 07:45:18 -0800
Subject: [rabbitmq-discuss] Rabbit-Spring integration
In-Reply-To: <167204d20802210519o3436fc1dk4b8438d1057a8344@mail.gmail.com>
Message-ID: <C3E2DC8E.1839%splisson@veodia.com>

Hi,

I started integrating the communication with RabbitMQ server using Spring
2.5. I use the Qpid M1 java client to do that because it provides the JMS
Interface usable by the Spring JMS classes.
This configuration allows the usage of MessageListenerAdapter,
MessageListenerContainer, JmsGateway, ...

I hope that one day we will have a full amqp spring template... ;-)

Sebastien


On 2/21/08 5:19 AM, "Alexis Richardson" <alexis.richardson at cohesiveft.com>
wrote:

> Hi David
> 
> On Thu, Feb 21, 2008 at 1:09 AM, David Peterson <peterson at orbitec.com.au>
> wrote:
>> 
>>  We're currently evaluating RabbitMQ in a Java environment as an
>>  alternative to a conventional JMS messaging system.
> 
> Excellent :-)
> 
> Do you have any non-Java cases too?  Or are you currently thinking of
> a Java2Java messaging set-up?
> 
> [ I ask because we've just released a .NET client, which will interop
> with Java over AMQP, plus of course the STOMP and HTTP clients seem
> useful to Java users. ]
> 
> 
>>  Ideally, I would
>>  like to "plug-in" rabbit in a manner similar to the way that JMS is
>>  supported by Spring 2.x (i.e. a MessageContainer and MessageListener
>>  implementation that allows "message-driven POJOs").
> 
> This is eminently sensible.
> 
> 
>>  My question is: are there any spring support classes for Rabbit at this
>>  time that provide this kind of integration?
> 
> Not yet.. We did look at it, and it seems like a refactoring of the
> Spring messaging classes using RabbitMQ's Java client, would be
> straightforward.
> 
> 
>>  I've already started prototyping a few ideas in this regard and I'm
>>  wondering whether they would be welcome within the Java client, perhaps
>>  within a a com.rabbitmq.spring.* package heirarchy?
> 
> That would be extremely welcome!
> 
> I am cc'ing some potentially interested parties.
> 
> 
> 
>>  A second question: I note that Rabbit defines the various AMQP
>>  interfaces inside the com.rabbitmq.* heirarchy. Do you know whether
>>  there are any plans by the AMQP consortium to split this out into an
>>  "org.amqp.*" heirarchy that could be implemented against by any Java API
>>  (rabbit included)?
> 
> Yes.  The AMQP Working Group believes that a client API could be
> useful, for example a set of Java interface classes in a package
> org.amqp.*
> 
> What do you think of the RabbitMQ Java and C# APIs?
> 
> 
>>  Thanks in advance for your help and guidance.
> 
> It's a pleasure.
> 
> alexis
> 
> 
> 
> 
>> 
>> 
>>  _______________________________________________
>>  rabbitmq-discuss mailing list
>>  rabbitmq-discuss at lists.rabbitmq.com
>>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 




From alexis.richardson at cohesiveft.com  Thu Feb 21 15:48:16 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 21 Feb 2008 15:48:16 +0000
Subject: [rabbitmq-discuss] Rabbit-Spring integration
In-Reply-To: <C3E2DC8E.1839%splisson@veodia.com>
References: <167204d20802210519o3436fc1dk4b8438d1057a8344@mail.gmail.com>
	<C3E2DC8E.1839%splisson@veodia.com>
Message-ID: <167204d20802210748k33b39836m26a6e86339ab614@mail.gmail.com>

Hi Sebastien

On Thu, Feb 21, 2008 at 3:45 PM, Sebastien PLISSON <splisson at veodia.com> wrote:
> Hi,
>
>  I started integrating the communication with RabbitMQ server using Spring
>  2.5. I use the Qpid M1 java client to do that because it provides the JMS
>  Interface usable by the Spring JMS classes.
>  This configuration allows the usage of MessageListenerAdapter,
>  MessageListenerContainer, JmsGateway, ...

Thanks for that :-)

Could you show us any of your client classes or config files?


>  I hope that one day we will have a full amqp spring template... ;-)

David, over to you!

alexis






>  wrote:
>
>
>
>  > Hi David
>  >
>  > On Thu, Feb 21, 2008 at 1:09 AM, David Peterson <peterson at orbitec.com.au>
>  > wrote:
>  >>
>  >>  We're currently evaluating RabbitMQ in a Java environment as an
>  >>  alternative to a conventional JMS messaging system.
>  >
>  > Excellent :-)
>  >
>  > Do you have any non-Java cases too?  Or are you currently thinking of
>  > a Java2Java messaging set-up?
>  >
>  > [ I ask because we've just released a .NET client, which will interop
>  > with Java over AMQP, plus of course the STOMP and HTTP clients seem
>  > useful to Java users. ]
>  >
>  >
>  >>  Ideally, I would
>  >>  like to "plug-in" rabbit in a manner similar to the way that JMS is
>  >>  supported by Spring 2.x (i.e. a MessageContainer and MessageListener
>  >>  implementation that allows "message-driven POJOs").
>  >
>  > This is eminently sensible.
>  >
>  >
>  >>  My question is: are there any spring support classes for Rabbit at this
>  >>  time that provide this kind of integration?
>  >
>  > Not yet.. We did look at it, and it seems like a refactoring of the
>  > Spring messaging classes using RabbitMQ's Java client, would be
>  > straightforward.
>  >
>  >
>  >>  I've already started prototyping a few ideas in this regard and I'm
>  >>  wondering whether they would be welcome within the Java client, perhaps
>  >>  within a a com.rabbitmq.spring.* package heirarchy?
>  >
>  > That would be extremely welcome!
>  >
>  > I am cc'ing some potentially interested parties.
>  >
>  >
>  >
>  >>  A second question: I note that Rabbit defines the various AMQP
>  >>  interfaces inside the com.rabbitmq.* heirarchy. Do you know whether
>  >>  there are any plans by the AMQP consortium to split this out into an
>  >>  "org.amqp.*" heirarchy that could be implemented against by any Java API
>  >>  (rabbit included)?
>  >
>  > Yes.  The AMQP Working Group believes that a client API could be
>  > useful, for example a set of Java interface classes in a package
>  > org.amqp.*
>  >
>  > What do you think of the RabbitMQ Java and C# APIs?
>  >
>  >
>  >>  Thanks in advance for your help and guidance.
>  >
>  > It's a pleasure.
>  >
>  > alexis
>  >
>  >
>  >
>  >
>  >>
>  >>
>  >>  _______________________________________________
>  >>  rabbitmq-discuss mailing list
>  >>  rabbitmq-discuss at lists.rabbitmq.com
>  >>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  >>
>  >
>  >
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From splisson at veodia.com  Thu Feb 21 16:09:11 2008
From: splisson at veodia.com (Sebastien PLISSON)
Date: Thu, 21 Feb 2008 08:09:11 -0800
Subject: [rabbitmq-discuss] Rabbit-Spring integration
In-Reply-To: <167204d20802210748k33b39836m26a6e86339ab614@mail.gmail.com>
Message-ID: <C3E2E228.183E%splisson@veodia.com>

I attached a sample spring configuration.

Sebastien


On 2/21/08 7:48 AM, "Alexis Richardson" <alexis.richardson at cohesiveft.com>
wrote:

> Hi Sebastien
> 
> On Thu, Feb 21, 2008 at 3:45 PM, Sebastien PLISSON <splisson at veodia.com>
> wrote:
>> Hi,
>> 
>>  I started integrating the communication with RabbitMQ server using Spring
>>  2.5. I use the Qpid M1 java client to do that because it provides the JMS
>>  Interface usable by the Spring JMS classes.
>>  This configuration allows the usage of MessageListenerAdapter,
>>  MessageListenerContainer, JmsGateway, ...
> 
> Thanks for that :-)
> 
> Could you show us any of your client classes or config files?
> 
> 
>>  I hope that one day we will have a full amqp spring template... ;-)
> 
> David, over to you!
> 
> alexis
> 
> 
> 
> 
> 
> 
>>  wrote:
>> 
>> 
>> 
>>> Hi David
>>> 
>>> On Thu, Feb 21, 2008 at 1:09 AM, David Peterson <peterson at orbitec.com.au>
>>> wrote:
>>>> 
>>>>  We're currently evaluating RabbitMQ in a Java environment as an
>>>>  alternative to a conventional JMS messaging system.
>>> 
>>> Excellent :-)
>>> 
>>> Do you have any non-Java cases too?  Or are you currently thinking of
>>> a Java2Java messaging set-up?
>>> 
>>> [ I ask because we've just released a .NET client, which will interop
>>> with Java over AMQP, plus of course the STOMP and HTTP clients seem
>>> useful to Java users. ]
>>> 
>>> 
>>>>  Ideally, I would
>>>>  like to "plug-in" rabbit in a manner similar to the way that JMS is
>>>>  supported by Spring 2.x (i.e. a MessageContainer and MessageListener
>>>>  implementation that allows "message-driven POJOs").
>>> 
>>> This is eminently sensible.
>>> 
>>> 
>>>>  My question is: are there any spring support classes for Rabbit at this
>>>>  time that provide this kind of integration?
>>> 
>>> Not yet.. We did look at it, and it seems like a refactoring of the
>>> Spring messaging classes using RabbitMQ's Java client, would be
>>> straightforward.
>>> 
>>> 
>>>>  I've already started prototyping a few ideas in this regard and I'm
>>>>  wondering whether they would be welcome within the Java client, perhaps
>>>>  within a a com.rabbitmq.spring.* package heirarchy?
>>> 
>>> That would be extremely welcome!
>>> 
>>> I am cc'ing some potentially interested parties.
>>> 
>>> 
>>> 
>>>>  A second question: I note that Rabbit defines the various AMQP
>>>>  interfaces inside the com.rabbitmq.* heirarchy. Do you know whether
>>>>  there are any plans by the AMQP consortium to split this out into an
>>>>  "org.amqp.*" heirarchy that could be implemented against by any Java API
>>>>  (rabbit included)?
>>> 
>>> Yes.  The AMQP Working Group believes that a client API could be
>>> useful, for example a set of Java interface classes in a package
>>> org.amqp.*
>>> 
>>> What do you think of the RabbitMQ Java and C# APIs?
>>> 
>>> 
>>>>  Thanks in advance for your help and guidance.
>>> 
>>> It's a pleasure.
>>> 
>>> alexis
>>> 
>>> 
>>> 
>>> 
>>>> 
>>>> 
>>>>  _______________________________________________
>>>>  rabbitmq-discuss mailing list
>>>>  rabbitmq-discuss at lists.rabbitmq.com
>>>>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>> 
>>> 
>> 
>> 
> 
> 

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: qpidclient_spring.xml
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080221/84927534/attachment.txt 

From peterson at orbitec.com.au  Thu Feb 21 21:29:20 2008
From: peterson at orbitec.com.au (David Peterson)
Date: Fri, 22 Feb 2008 08:29:20 +1100
Subject: [rabbitmq-discuss] Rabbit-Spring integration
In-Reply-To: <C3E2E228.183E%splisson@veodia.com>
References: <C3E2E228.183E%splisson@veodia.com>
Message-ID: <1203629360.7562.3.camel@vostok>


Hi All,

Thanks Alexis, Sebastian. I'm thinking the best way would be to create a
com.rabbitmq.client.spring (or "org.springframework.amqp") set of base
classes that parallel the org.springframework.jms classes and implement
a similar kind of MessageListener and MessageListenerContainer callback
model. 

If it's not JMS, then the AMQP Rabbit stuff should not extend /
implement JMS interfaces. Rather we should create our own parallel
heirarchy. Thoughts / comments please?

Regs,

Dave


On Thu, 2008-02-21 at 08:09 -0800, Sebastien PLISSON wrote:
> I attached a sample spring configuration.
> 
> Sebastien
> 
> 
> On 2/21/08 7:48 AM, "Alexis Richardson" <alexis.richardson at cohesiveft.com>
> wrote:
> 
> > Hi Sebastien
> > 
> > On Thu, Feb 21, 2008 at 3:45 PM, Sebastien PLISSON <splisson at veodia.com>
> > wrote:
> >> Hi,
> >> 
> >>  I started integrating the communication with RabbitMQ server using Spring
> >>  2.5. I use the Qpid M1 java client to do that because it provides the JMS
> >>  Interface usable by the Spring JMS classes.
> >>  This configuration allows the usage of MessageListenerAdapter,
> >>  MessageListenerContainer, JmsGateway, ...
> > 
> > Thanks for that :-)
> > 
> > Could you show us any of your client classes or config files?
> > 
> > 
> >>  I hope that one day we will have a full amqp spring template... ;-)
> > 
> > David, over to you!
> > 
> > alexis
> > 
> > 
> > 
> > 
> > 
> > 
> >>  wrote:
> >> 
> >> 
> >> 
> >>> Hi David
> >>> 
> >>> On Thu, Feb 21, 2008 at 1:09 AM, David Peterson <peterson at orbitec.com.au>
> >>> wrote:
> >>>> 
> >>>>  We're currently evaluating RabbitMQ in a Java environment as an
> >>>>  alternative to a conventional JMS messaging system.
> >>> 
> >>> Excellent :-)
> >>> 
> >>> Do you have any non-Java cases too?  Or are you currently thinking of
> >>> a Java2Java messaging set-up?
> >>> 
> >>> [ I ask because we've just released a .NET client, which will interop
> >>> with Java over AMQP, plus of course the STOMP and HTTP clients seem
> >>> useful to Java users. ]
> >>> 
> >>> 
> >>>>  Ideally, I would
> >>>>  like to "plug-in" rabbit in a manner similar to the way that JMS is
> >>>>  supported by Spring 2.x (i.e. a MessageContainer and MessageListener
> >>>>  implementation that allows "message-driven POJOs").
> >>> 
> >>> This is eminently sensible.
> >>> 
> >>> 
> >>>>  My question is: are there any spring support classes for Rabbit at this
> >>>>  time that provide this kind of integration?
> >>> 
> >>> Not yet.. We did look at it, and it seems like a refactoring of the
> >>> Spring messaging classes using RabbitMQ's Java client, would be
> >>> straightforward.
> >>> 
> >>> 
> >>>>  I've already started prototyping a few ideas in this regard and I'm
> >>>>  wondering whether they would be welcome within the Java client, perhaps
> >>>>  within a a com.rabbitmq.spring.* package heirarchy?
> >>> 
> >>> That would be extremely welcome!
> >>> 
> >>> I am cc'ing some potentially interested parties.
> >>> 
> >>> 
> >>> 
> >>>>  A second question: I note that Rabbit defines the various AMQP
> >>>>  interfaces inside the com.rabbitmq.* heirarchy. Do you know whether
> >>>>  there are any plans by the AMQP consortium to split this out into an
> >>>>  "org.amqp.*" heirarchy that could be implemented against by any Java API
> >>>>  (rabbit included)?
> >>> 
> >>> Yes.  The AMQP Working Group believes that a client API could be
> >>> useful, for example a set of Java interface classes in a package
> >>> org.amqp.*
> >>> 
> >>> What do you think of the RabbitMQ Java and C# APIs?
> >>> 
> >>> 
> >>>>  Thanks in advance for your help and guidance.
> >>> 
> >>> It's a pleasure.
> >>> 
> >>> alexis
> >>> 
> >>> 
> >>> 
> >>> 
> >>>> 
> >>>> 
> >>>>  _______________________________________________
> >>>>  rabbitmq-discuss mailing list
> >>>>  rabbitmq-discuss at lists.rabbitmq.com
> >>>>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>> 
> >>> 
> >>> 
> >> 
> >> 
> > 
> > 
> 
-- 
Orbitec Pty Ltd
Suite 1-11, 460 Pacific Hwy
St. Leonards NSW 2065
AUSTRALIA

Phone:  +61 (0)2 8002 4780
Mobile: +61 (0)415 943 940
Email:  support at orbitec.com.au
Web:    http://www.orbitec.com.au 

This email may contain CONFIDENTIAL information intended solely for
the use of the intended recipient. If you receive this email in error,
we ask that you notify us by email of our error and then delete the
email as soon as possible. We ask that you do not copy, store or
distribute any message that you have received in error and we thank you
for your assistance.





From alexis.richardson at cohesiveft.com  Thu Feb 21 21:36:29 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 21 Feb 2008 21:36:29 +0000
Subject: [rabbitmq-discuss] Rabbit-Spring integration
In-Reply-To: <1203629360.7562.3.camel@vostok>
References: <C3E2E228.183E%splisson@veodia.com>
	<1203629360.7562.3.camel@vostok>
Message-ID: <167204d20802211336s679f6693w41bf7cd853e02fd9@mail.gmail.com>

David

Your first intuition is correct.  This would be much better than the
second option, in the long run.  We would love to work with folks on
this.

alexis


On Thu, Feb 21, 2008 at 9:29 PM, David Peterson <peterson at orbitec.com.au> wrote:
>
>  Hi All,
>
>  Thanks Alexis, Sebastian. I'm thinking the best way would be to create a
>  com.rabbitmq.client.spring (or "org.springframework.amqp") set of base
>  classes that parallel the org.springframework.jms classes and implement
>  a similar kind of MessageListener and MessageListenerContainer callback
>  model.
>
>  If it's not JMS, then the AMQP Rabbit stuff should not extend /
>  implement JMS interfaces. Rather we should create our own parallel
>  heirarchy. Thoughts / comments please?
>
>  Regs,
>
>  Dave
>
>
>
>
>  On Thu, 2008-02-21 at 08:09 -0800, Sebastien PLISSON wrote:
>  > I attached a sample spring configuration.
>  >
>  > Sebastien
>  >
>  >
>  > On 2/21/08 7:48 AM, "Alexis Richardson" <alexis.richardson at cohesiveft.com>
>  > wrote:
>  >
>  > > Hi Sebastien
>  > >
>  > > On Thu, Feb 21, 2008 at 3:45 PM, Sebastien PLISSON <splisson at veodia.com>
>  > > wrote:
>  > >> Hi,
>  > >>
>  > >>  I started integrating the communication with RabbitMQ server using Spring
>  > >>  2.5. I use the Qpid M1 java client to do that because it provides the JMS
>  > >>  Interface usable by the Spring JMS classes.
>  > >>  This configuration allows the usage of MessageListenerAdapter,
>  > >>  MessageListenerContainer, JmsGateway, ...
>  > >
>  > > Thanks for that :-)
>  > >
>  > > Could you show us any of your client classes or config files?
>  > >
>  > >
>  > >>  I hope that one day we will have a full amqp spring template... ;-)
>  > >
>  > > David, over to you!
>  > >
>  > > alexis
>  > >
>  > >
>  > >
>  > >
>  > >
>  > >
>  > >>  wrote:
>  > >>
>  > >>
>  > >>
>  > >>> Hi David
>  > >>>
>  > >>> On Thu, Feb 21, 2008 at 1:09 AM, David Peterson <peterson at orbitec.com.au>
>  > >>> wrote:
>  > >>>>
>  > >>>>  We're currently evaluating RabbitMQ in a Java environment as an
>  > >>>>  alternative to a conventional JMS messaging system.
>  > >>>
>  > >>> Excellent :-)
>  > >>>
>  > >>> Do you have any non-Java cases too?  Or are you currently thinking of
>  > >>> a Java2Java messaging set-up?
>  > >>>
>  > >>> [ I ask because we've just released a .NET client, which will interop
>  > >>> with Java over AMQP, plus of course the STOMP and HTTP clients seem
>  > >>> useful to Java users. ]
>  > >>>
>  > >>>
>  > >>>>  Ideally, I would
>  > >>>>  like to "plug-in" rabbit in a manner similar to the way that JMS is
>  > >>>>  supported by Spring 2.x (i.e. a MessageContainer and MessageListener
>  > >>>>  implementation that allows "message-driven POJOs").
>  > >>>
>  > >>> This is eminently sensible.
>  > >>>
>  > >>>
>  > >>>>  My question is: are there any spring support classes for Rabbit at this
>  > >>>>  time that provide this kind of integration?
>  > >>>
>  > >>> Not yet.. We did look at it, and it seems like a refactoring of the
>  > >>> Spring messaging classes using RabbitMQ's Java client, would be
>  > >>> straightforward.
>  > >>>
>  > >>>
>  > >>>>  I've already started prototyping a few ideas in this regard and I'm
>  > >>>>  wondering whether they would be welcome within the Java client, perhaps
>  > >>>>  within a a com.rabbitmq.spring.* package heirarchy?
>  > >>>
>  > >>> That would be extremely welcome!
>  > >>>
>  > >>> I am cc'ing some potentially interested parties.
>  > >>>
>  > >>>
>  > >>>
>  > >>>>  A second question: I note that Rabbit defines the various AMQP
>  > >>>>  interfaces inside the com.rabbitmq.* heirarchy. Do you know whether
>  > >>>>  there are any plans by the AMQP consortium to split this out into an
>  > >>>>  "org.amqp.*" heirarchy that could be implemented against by any Java API
>  > >>>>  (rabbit included)?
>  > >>>
>  > >>> Yes.  The AMQP Working Group believes that a client API could be
>  > >>> useful, for example a set of Java interface classes in a package
>  > >>> org.amqp.*
>  > >>>
>  > >>> What do you think of the RabbitMQ Java and C# APIs?
>  > >>>
>  > >>>
>  > >>>>  Thanks in advance for your help and guidance.
>  > >>>
>  > >>> It's a pleasure.
>  > >>>
>  > >>> alexis
>  > >>>
>  > >>>
>  > >>>
>  > >>>
>  > >>>>
>  > >>>>
>  > >>>>  _______________________________________________
>  > >>>>  rabbitmq-discuss mailing list
>  > >>>>  rabbitmq-discuss at lists.rabbitmq.com
>  > >>>>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  > >>>>
>  > >>>
>  > >>>
>  > >>
>  > >>
>  > >
>  > >
>  >
>  --
>  Orbitec Pty Ltd
>  Suite 1-11, 460 Pacific Hwy
>  St. Leonards NSW 2065
>  AUSTRALIA
>
>  Phone:  +61 (0)2 8002 4780
>  Mobile: +61 (0)415 943 940
>  Email:  support at orbitec.com.au
>  Web:    http://www.orbitec.com.au
>
>  This email may contain CONFIDENTIAL information intended solely for
>  the use of the intended recipient. If you receive this email in error,
>  we ask that you notify us by email of our error and then delete the
>  email as soon as possible. We ask that you do not copy, store or
>  distribute any message that you have received in error and we thank you
>  for your assistance.
>
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From splisson at veodia.com  Thu Feb 21 21:41:35 2008
From: splisson at veodia.com (Sebastien PLISSON)
Date: Thu, 21 Feb 2008 13:41:35 -0800
Subject: [rabbitmq-discuss] Rabbit-Spring integration
In-Reply-To: <167204d20802211336s679f6693w41bf7cd853e02fd9@mail.gmail.com>
Message-ID: <C3E3300F.1847%splisson@veodia.com>

I agree with you David, I'd prefer not use JMS but have Spring-amqp classes.

Regards,
Sebastien


On 2/21/08 1:36 PM, "Alexis Richardson" <alexis.richardson at cohesiveft.com>
wrote:

> David
> 
> Your first intuition is correct.  This would be much better than the
> second option, in the long run.  We would love to work with folks on
> this.
> 
> alexis
> 
> 
> On Thu, Feb 21, 2008 at 9:29 PM, David Peterson <peterson at orbitec.com.au>
> wrote:
>> 
>>  Hi All,
>> 
>>  Thanks Alexis, Sebastian. I'm thinking the best way would be to create a
>>  com.rabbitmq.client.spring (or "org.springframework.amqp") set of base
>>  classes that parallel the org.springframework.jms classes and implement
>>  a similar kind of MessageListener and MessageListenerContainer callback
>>  model.
>> 
>>  If it's not JMS, then the AMQP Rabbit stuff should not extend /
>>  implement JMS interfaces. Rather we should create our own parallel
>>  heirarchy. Thoughts / comments please?
>> 
>>  Regs,
>> 
>>  Dave
>> 
>> 
>> 
>> 
>>  On Thu, 2008-02-21 at 08:09 -0800, Sebastien PLISSON wrote:
>>> I attached a sample spring configuration.
>>> 
>>> Sebastien
>>> 
>>> 
>>> On 2/21/08 7:48 AM, "Alexis Richardson" <alexis.richardson at cohesiveft.com>
>>> wrote:
>>> 
>>>> Hi Sebastien
>>>> 
>>>> On Thu, Feb 21, 2008 at 3:45 PM, Sebastien PLISSON <splisson at veodia.com>
>>>> wrote:
>>>>> Hi,
>>>>> 
>>>>>  I started integrating the communication with RabbitMQ server using Spring
>>>>>  2.5. I use the Qpid M1 java client to do that because it provides the JMS
>>>>>  Interface usable by the Spring JMS classes.
>>>>>  This configuration allows the usage of MessageListenerAdapter,
>>>>>  MessageListenerContainer, JmsGateway, ...
>>>> 
>>>> Thanks for that :-)
>>>> 
>>>> Could you show us any of your client classes or config files?
>>>> 
>>>> 
>>>>>  I hope that one day we will have a full amqp spring template... ;-)
>>>> 
>>>> David, over to you!
>>>> 
>>>> alexis
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>> 
>>>>>  wrote:
>>>>> 
>>>>> 
>>>>> 
>>>>>> Hi David
>>>>>> 
>>>>>> On Thu, Feb 21, 2008 at 1:09 AM, David Peterson <peterson at orbitec.com.au>
>>>>>> wrote:
>>>>>>> 
>>>>>>>  We're currently evaluating RabbitMQ in a Java environment as an
>>>>>>>  alternative to a conventional JMS messaging system.
>>>>>> 
>>>>>> Excellent :-)
>>>>>> 
>>>>>> Do you have any non-Java cases too?  Or are you currently thinking of
>>>>>> a Java2Java messaging set-up?
>>>>>> 
>>>>>> [ I ask because we've just released a .NET client, which will interop
>>>>>> with Java over AMQP, plus of course the STOMP and HTTP clients seem
>>>>>> useful to Java users. ]
>>>>>> 
>>>>>> 
>>>>>>>  Ideally, I would
>>>>>>>  like to "plug-in" rabbit in a manner similar to the way that JMS is
>>>>>>>  supported by Spring 2.x (i.e. a MessageContainer and MessageListener
>>>>>>>  implementation that allows "message-driven POJOs").
>>>>>> 
>>>>>> This is eminently sensible.
>>>>>> 
>>>>>> 
>>>>>>>  My question is: are there any spring support classes for Rabbit at this
>>>>>>>  time that provide this kind of integration?
>>>>>> 
>>>>>> Not yet.. We did look at it, and it seems like a refactoring of the
>>>>>> Spring messaging classes using RabbitMQ's Java client, would be
>>>>>> straightforward.
>>>>>> 
>>>>>> 
>>>>>>>  I've already started prototyping a few ideas in this regard and I'm
>>>>>>>  wondering whether they would be welcome within the Java client, perhaps
>>>>>>>  within a a com.rabbitmq.spring.* package heirarchy?
>>>>>> 
>>>>>> That would be extremely welcome!
>>>>>> 
>>>>>> I am cc'ing some potentially interested parties.
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>>>  A second question: I note that Rabbit defines the various AMQP
>>>>>>>  interfaces inside the com.rabbitmq.* heirarchy. Do you know whether
>>>>>>>  there are any plans by the AMQP consortium to split this out into an
>>>>>>>  "org.amqp.*" heirarchy that could be implemented against by any Java
>>>>>>> API
>>>>>>>  (rabbit included)?
>>>>>> 
>>>>>> Yes.  The AMQP Working Group believes that a client API could be
>>>>>> useful, for example a set of Java interface classes in a package
>>>>>> org.amqp.*
>>>>>> 
>>>>>> What do you think of the RabbitMQ Java and C# APIs?
>>>>>> 
>>>>>> 
>>>>>>>  Thanks in advance for your help and guidance.
>>>>>> 
>>>>>> It's a pleasure.
>>>>>> 
>>>>>> alexis
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>>> 
>>>>>>> 
>>>>>>>  _______________________________________________
>>>>>>>  rabbitmq-discuss mailing list
>>>>>>>  rabbitmq-discuss at lists.rabbitmq.com
>>>>>>>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>> 
>>>>>> 
>>>>>> 
>>>>> 
>>>>> 
>>>> 
>>>> 
>>> 
>>  --
>>  Orbitec Pty Ltd
>>  Suite 1-11, 460 Pacific Hwy
>>  St. Leonards NSW 2065
>>  AUSTRALIA
>> 
>>  Phone:  +61 (0)2 8002 4780
>>  Mobile: +61 (0)415 943 940
>>  Email:  support at orbitec.com.au
>>  Web:    http://www.orbitec.com.au
>> 
>>  This email may contain CONFIDENTIAL information intended solely for
>>  the use of the intended recipient. If you receive this email in error,
>>  we ask that you notify us by email of our error and then delete the
>>  email as soon as possible. We ask that you do not copy, store or
>>  distribute any message that you have received in error and we thank you
>>  for your assistance.
>> 
>> 
>> 
> 
> 




From tom at samplonius.org  Fri Feb 22 03:26:12 2008
From: tom at samplonius.org (Tom Samplonius)
Date: Thu, 21 Feb 2008 19:26:12 -0800 (PST)
Subject: [rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
In-Reply-To: <47BC3B99.4000408@cohesiveft.com>
Message-ID: <28154399.6051203650772262.JavaMail.root@ly.sdf.com>

----- "Dmitriy Samovskiy" <dmitriy.samovskiy at cohesiveft.com> wrote:

> ... A bigger 
> question is how long it will take between a message is sent and the
> message is consumed. 
> Out of the box, I guess it depends on how fast you can restore the
> original broker (app, 
> system and/or network connectivity, depending on what failed).

  Yes, only you will be able to answer that.  In my case, the time to fix a unresponsive server is about an hour.

> >   I thought about using DRDB to replicate RabbitMQ's on-disk Mnesia
> store to a standby node.  I've used DRDB successfully for MySQL, and
> it works well.  And then use Hearbeat to start RabbitMQ on the standby
> node, which would then recover the Mnesia tables, and start running.
> So you are planning to produce to a broker and consume from the same
> broker. And once that 
> broker fails, you will have both producers and consumers shift to
> another broker, which 
> you will start on DRBD-cloned disk after the first broker failed?

  Yes.  DRDB keeps the master disk synced to the slave disk.  Hearbeat determines if the master fails, and switches the direction of the syncing, and can also move the virtual IP from the master to the slave.  Everything just connects to the virtual IP.  Obviously clients (producers and consumers) need to be robust, and have the ability to recovery from timeouts, and reconnect.


...
> application logic to identify duplicate messages (just in case).
...

  I've never come across a good way of doing this.  I can attach a unique id to each message, but then the clients have to keep state on which ids they've processed.  And if you multiple clients, they need to talk to each other too.  I don't want consumers to have to keep state.  

  Now depending on the message, of course, processing it twice may not matter that much.  For example, if the message is "Turn switch 2 On", then if you do that twice, it is harmless.  But obviously you don't want to processing every message twice just for high-availability.  

...
> Please let us know if you get to deploy rabbitmq with DRBD-backed
> storage and how it works 
> for you.

  I have to do a lot of testing of this configuration first.


> Thanks,
> Dmitriy


Tom



From peterson at orbitec.com.au  Fri Feb 22 05:52:29 2008
From: peterson at orbitec.com.au (David Peterson)
Date: Fri, 22 Feb 2008 16:52:29 +1100
Subject: [rabbitmq-discuss] Rabbit-Spring integration
In-Reply-To: <C3E3300F.1847%splisson@veodia.com>
References: <C3E3300F.1847%splisson@veodia.com>
Message-ID: <1203659549.7562.50.camel@vostok>


Great hack though! Don't know why I didn't think of it myself :)

Dave


On Thu, 2008-02-21 at 13:41 -0800, Sebastien PLISSON wrote:
> I agree with you David, I'd prefer not use JMS but have Spring-amqp classes.
> 
> Regards,
> Sebastien
> 
> 
> On 2/21/08 1:36 PM, "Alexis Richardson" <alexis.richardson at cohesiveft.com>
> wrote:
> 
> > David
> > 
> > Your first intuition is correct.  This would be much better than the
> > second option, in the long run.  We would love to work with folks on
> > this.
> > 
> > alexis
> > 
> > 
> > On Thu, Feb 21, 2008 at 9:29 PM, David Peterson <peterson at orbitec.com.au>
> > wrote:
> >> 
> >>  Hi All,
> >> 
> >>  Thanks Alexis, Sebastian. I'm thinking the best way would be to create a
> >>  com.rabbitmq.client.spring (or "org.springframework.amqp") set of base
> >>  classes that parallel the org.springframework.jms classes and implement
> >>  a similar kind of MessageListener and MessageListenerContainer callback
> >>  model.
> >> 
> >>  If it's not JMS, then the AMQP Rabbit stuff should not extend /
> >>  implement JMS interfaces. Rather we should create our own parallel
> >>  heirarchy. Thoughts / comments please?
> >> 
> >>  Regs,
> >> 
> >>  Dave
> >> 
> >> 
> >> 
> >> 
> >>  On Thu, 2008-02-21 at 08:09 -0800, Sebastien PLISSON wrote:
> >>> I attached a sample spring configuration.
> >>> 
> >>> Sebastien
> >>> 
> >>> 
> >>> On 2/21/08 7:48 AM, "Alexis Richardson" <alexis.richardson at cohesiveft.com>
> >>> wrote:
> >>> 
> >>>> Hi Sebastien
> >>>> 
> >>>> On Thu, Feb 21, 2008 at 3:45 PM, Sebastien PLISSON <splisson at veodia.com>
> >>>> wrote:
> >>>>> Hi,
> >>>>> 
> >>>>>  I started integrating the communication with RabbitMQ server using Spring
> >>>>>  2.5. I use the Qpid M1 java client to do that because it provides the JMS
> >>>>>  Interface usable by the Spring JMS classes.
> >>>>>  This configuration allows the usage of MessageListenerAdapter,
> >>>>>  MessageListenerContainer, JmsGateway, ...
> >>>> 
> >>>> Thanks for that :-)
> >>>> 
> >>>> Could you show us any of your client classes or config files?
> >>>> 
> >>>> 
> >>>>>  I hope that one day we will have a full amqp spring template... ;-)
> >>>> 
> >>>> David, over to you!
> >>>> 
> >>>> alexis
> >>>> 
> >>>> 
> >>>> 
> >>>> 
> >>>> 
> >>>> 
> >>>>>  wrote:
> >>>>> 
> >>>>> 
> >>>>> 
> >>>>>> Hi David
> >>>>>> 
> >>>>>> On Thu, Feb 21, 2008 at 1:09 AM, David Peterson <peterson at orbitec.com.au>
> >>>>>> wrote:
> >>>>>>> 
> >>>>>>>  We're currently evaluating RabbitMQ in a Java environment as an
> >>>>>>>  alternative to a conventional JMS messaging system.
> >>>>>> 
> >>>>>> Excellent :-)
> >>>>>> 
> >>>>>> Do you have any non-Java cases too?  Or are you currently thinking of
> >>>>>> a Java2Java messaging set-up?
> >>>>>> 
> >>>>>> [ I ask because we've just released a .NET client, which will interop
> >>>>>> with Java over AMQP, plus of course the STOMP and HTTP clients seem
> >>>>>> useful to Java users. ]
> >>>>>> 
> >>>>>> 
> >>>>>>>  Ideally, I would
> >>>>>>>  like to "plug-in" rabbit in a manner similar to the way that JMS is
> >>>>>>>  supported by Spring 2.x (i.e. a MessageContainer and MessageListener
> >>>>>>>  implementation that allows "message-driven POJOs").
> >>>>>> 
> >>>>>> This is eminently sensible.
> >>>>>> 
> >>>>>> 
> >>>>>>>  My question is: are there any spring support classes for Rabbit at this
> >>>>>>>  time that provide this kind of integration?
> >>>>>> 
> >>>>>> Not yet.. We did look at it, and it seems like a refactoring of the
> >>>>>> Spring messaging classes using RabbitMQ's Java client, would be
> >>>>>> straightforward.
> >>>>>> 
> >>>>>> 
> >>>>>>>  I've already started prototyping a few ideas in this regard and I'm
> >>>>>>>  wondering whether they would be welcome within the Java client, perhaps
> >>>>>>>  within a a com.rabbitmq.spring.* package heirarchy?
> >>>>>> 
> >>>>>> That would be extremely welcome!
> >>>>>> 
> >>>>>> I am cc'ing some potentially interested parties.
> >>>>>> 
> >>>>>> 
> >>>>>> 
> >>>>>>>  A second question: I note that Rabbit defines the various AMQP
> >>>>>>>  interfaces inside the com.rabbitmq.* heirarchy. Do you know whether
> >>>>>>>  there are any plans by the AMQP consortium to split this out into an
> >>>>>>>  "org.amqp.*" heirarchy that could be implemented against by any Java
> >>>>>>> API
> >>>>>>>  (rabbit included)?
> >>>>>> 
> >>>>>> Yes.  The AMQP Working Group believes that a client API could be
> >>>>>> useful, for example a set of Java interface classes in a package
> >>>>>> org.amqp.*
> >>>>>> 
> >>>>>> What do you think of the RabbitMQ Java and C# APIs?
> >>>>>> 
> >>>>>> 
> >>>>>>>  Thanks in advance for your help and guidance.
> >>>>>> 
> >>>>>> It's a pleasure.
> >>>>>> 
> >>>>>> alexis
> >>>>>> 
> >>>>>> 
> >>>>>> 
> >>>>>> 
> >>>>>>> 
> >>>>>>> 
> >>>>>>>  _______________________________________________
> >>>>>>>  rabbitmq-discuss mailing list
> >>>>>>>  rabbitmq-discuss at lists.rabbitmq.com
> >>>>>>>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>>>>>> 
> >>>>>> 
> >>>>>> 
> >>>>> 
> >>>>> 
> >>>> 
> >>>> 
> >>> 
> >>  --
> >>  Orbitec Pty Ltd
> >>  Suite 1-11, 460 Pacific Hwy
> >>  St. Leonards NSW 2065
> >>  AUSTRALIA
> >> 
> >>  Phone:  +61 (0)2 8002 4780
> >>  Mobile: +61 (0)415 943 940
> >>  Email:  support at orbitec.com.au
> >>  Web:    http://www.orbitec.com.au
> >> 
> >>  This email may contain CONFIDENTIAL information intended solely for
> >>  the use of the intended recipient. If you receive this email in error,
> >>  we ask that you notify us by email of our error and then delete the
> >>  email as soon as possible. We ask that you do not copy, store or
> >>  distribute any message that you have received in error and we thank you
> >>  for your assistance.
> >> 
> >> 
> >> 
> > 
> > 
> 
-- 
Orbitec Pty Ltd
Suite 1-11, 460 Pacific Hwy
St. Leonards NSW 2065
AUSTRALIA

Phone:  +61 (0)2 8002 4780
Mobile: +61 (0)415 943 940
Email:  support at orbitec.com.au
Web:    http://www.orbitec.com.au 

This email may contain CONFIDENTIAL information intended solely for
the use of the intended recipient. If you receive this email in error,
we ask that you notify us by email of our error and then delete the
email as soon as possible. We ask that you do not copy, store or
distribute any message that you have received in error and we thank you
for your assistance.





From chime at mu.dk  Fri Feb 22 09:43:41 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Fri, 22 Feb 2008 10:43:41 +0100
Subject: [rabbitmq-discuss] Strange error report - any ideas anyone?
Message-ID: <76A7629B-BFD0-4882-A84E-D12F773AB833@mu.dk>

Hi,

Yesterday I had avery weird failure on one of components communicating  
on AMQP. In the rabbit-log we have

=INFO REPORT==== 21-Feb-2008::15:20:09 === Syntax error collecting  
method content: {amqp,frame_error,none}

=INFO REPORT==== 21-Feb-2008::15:20:09 === Sending exception: Channel  
4, Reason {amqp,syntax_error,'basic.publish'}

Has anybody seen this before? Any ideas what the 'real' problem is?

I'd like to add that we have been using RabbitMQ for more than 6  
months and been very satisfied, so I suspect that it is us who is  
doing something we shouldn't and not a problem in RabbitMQ.

Regards,

Michael Arnoldus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080222/538fa483/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080222/538fa483/attachment.bin 

From tonyg at lshift.net  Fri Feb 22 13:04:43 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 22 Feb 2008 13:04:43 +0000
Subject: [rabbitmq-discuss] Strange error report - any ideas anyone?
In-Reply-To: <76A7629B-BFD0-4882-A84E-D12F773AB833@mu.dk>
References: <76A7629B-BFD0-4882-A84E-D12F773AB833@mu.dk>
Message-ID: <47BEC86B.30505@lshift.net>

Hi Michael,

Michael Arnoldus wrote:
> Yesterday I had avery weird failure on one of components communicating
> on AMQP. In the rabbit-log we have
> =INFO REPORT==== 21-Feb-2008::15:20:09 === Syntax error collecting
> method content: {amqp,frame_error,none}
> =INFO REPORT==== 21-Feb-2008::15:20:09 === Sending exception: Channel 4,
> Reason {amqp,syntax_error,'basic.publish'}

In the 1.2.0 codebase, this is caused by either

 - a non-content-header frame arriving, when a content-header is
   expected; or,

 - a content-header frame arriving, as expected, but with a class ID
   that doesn't match the class of the preceding method frame; or

 - a non-content-body frame arriving, when a content-body is expected

A likely cause of this is sharing of a single Channel object between
multiple threads without sufficient mutual-exclusion. A publish, with
associated content, is ending up being interleaved with other frames on
the same channel. Could this, a Channel shared between threads, be
what's happening?

Just as an aside, that particular piece of code has been changed in our
CVS HEAD a little, so the precise error report will be a little
different for that case in future. The changes in that code are for
bringing the error reporting closer into line with the definitions of
frame-error, syntax-error and command-invalid in the specification.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From 0x6e6562 at gmail.com  Fri Feb 22 13:05:13 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 22 Feb 2008 13:05:13 +0000
Subject: [rabbitmq-discuss] Strange error report - any ideas anyone?
In-Reply-To: <76A7629B-BFD0-4882-A84E-D12F773AB833@mu.dk>
References: <76A7629B-BFD0-4882-A84E-D12F773AB833@mu.dk>
Message-ID: <6C80517E-3FBE-441B-8408-D0C1A41F4728@gmail.com>

Michael,

On 22 Feb 2008, at 09:43, Michael Arnoldus wrote:
> =INFO REPORT==== 21-Feb-2008::15:20:09 === Syntax error collecting  
> method content: {amqp,frame_error,none}
>
> =INFO REPORT==== 21-Feb-2008::15:20:09 === Sending exception:  
> Channel 4, Reason {amqp,syntax_error,'basic.publish'}
>
> Has anybody seen this before? Any ideas what the 'real' problem is?
>
I have seen this in a similar context when I've deleted the mnesia  
database and have tried to publish to an exchange without declaring it  
first, but the error atom you get is {amqp, not_found,  
'basic_publish'}. I wouldn't have seen this if I wasn't continuously  
starting and stopping the broker and playing around with the OTP  
application state, so I don't know if this is of any relevance to your  
problem.

If you are able to reproduce this problem, it may help if you can  
describe the steps it takes to provoke the error so that we can  
reproduce it ourselves to try to diagnose it.

HTH,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080222/2a48eca1/attachment.htm 

From chime at mu.dk  Fri Feb 22 15:48:59 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Fri, 22 Feb 2008 16:48:59 +0100
Subject: [rabbitmq-discuss] Bad threading :-(
Message-ID: <217774B8-60E6-4CB6-9F17-586ED5916C66@mu.dk>

Tony and Ben,

The weird statements in the Rabbit logfile I reported earlier was due  
to several threads sending on the same channel at the same time :- 
( That's for not going with Erlang!

Tony and Ben - thanks for your suggestions!

Regards,

Michael Arnoldus
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080222/48c1f2df/attachment.bin 

From Aamir_Mohammad at manulife.com  Fri Feb 22 19:34:12 2008
From: Aamir_Mohammad at manulife.com (Aamir_Mohammad at manulife.com)
Date: Fri, 22 Feb 2008 14:34:12 -0500
Subject: [rabbitmq-discuss] amq_client_session_wait in RabbitMQ .net API?
Message-ID: <OF254CC3F4.AC00E84A-ON852573F7.006AFCDA-852573F7.006B8065@manulife.com>

Hello,

In the OpenAMQ WireAPI there is a method called 
amq_client_session_wait(session, timeout)  ... what is the equivalent 
method in the RabitMQ .NET API? 

The OpenAMQ "chatroom" example calls amq_client_session_wait() inside the 
infinite while loop that is used for consuming messages. I gather that the 
purpose of this method is to prevent the infinite loop from wasting 
resources when there are no messages in the queue. How does the RabbitMQ 
.NET API handle this?

Thanks
Aamir
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080222/4469021f/attachment.htm 

From tonyg at lshift.net  Fri Feb 22 19:52:11 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 22 Feb 2008 19:52:11 +0000
Subject: [rabbitmq-discuss] Bad threading :-(
In-Reply-To: <217774B8-60E6-4CB6-9F17-586ED5916C66@mu.dk>
References: <217774B8-60E6-4CB6-9F17-586ED5916C66@mu.dk>
Message-ID: <47BF27EB.8050705@lshift.net>

Hi Michael,

Michael Arnoldus wrote:
> The weird statements in the Rabbit logfile I reported earlier was due to 
> several threads sending on the same channel at the same time :-( That's 
> for not going with Erlang!

Great, thanks for letting us know.

Tony




From themuleman at gmail.com  Sun Feb 24 22:42:18 2008
From: themuleman at gmail.com (Ross Mason)
Date: Sun, 24 Feb 2008 23:42:18 +0100
Subject: [rabbitmq-discuss] Problem running Java client Multithreaded
Message-ID: <B488A8C3-7A35-4E97-867B-89935EAFF494@gmail.com>

Hi,

I'm testing RabbitMQ with Mule using the JavaClient (RpcClient). I run  
1000 requests in a single thread and all is good. As soon as a I spawn  
2 or more client threads I get ShutdownSignalException. None of my  
code closes the connection but I can't figure out what does. The  
exception I get is:

Caused by: com.rabbitmq.client.ShutdownSignalException (connection  
error; reason: {#method<connection.close>(reply code=502, reply  
text=SYNTAX_ERROR, class id=60, method id=40),null,""})
	at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java: 
565)
	at  
com 
.rabbitmq 
.client.impl.AMQConnection.handleConnectionClose(AMQConnection.java:549)
	at  
com 
.rabbitmq 
.client.impl.AMQConnection.processControlCommand(AMQConnection.java:526)
	at com.rabbitmq.client.impl.AMQConnection 
$1.processAsync(AMQConnection.java:80)
	at  
com 
.rabbitmq 
.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java: 
146)
	at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:101)
	at com.rabbitmq.client.impl.AMQConnection 
$MainLoop.run(AMQConnection.java:431)

Any ideas?

Cheers,

Ross Mason
CTO, Co-Founder
MuleSource Inc.

http://mulesource.com | http://blog.rossmason.com





-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080224/606c41fb/attachment.htm 

From holger at wizards.de  Sun Feb 24 23:03:16 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Mon, 25 Feb 2008 00:03:16 +0100
Subject: [rabbitmq-discuss] Problem running Java client Multithreaded
In-Reply-To: <B488A8C3-7A35-4E97-867B-89935EAFF494@gmail.com>
References: <B488A8C3-7A35-4E97-867B-89935EAFF494@gmail.com>
Message-ID: <47C1F7B4.5040407@wizards.de>

Ross Mason wrote:
> Hi,
> 
> I'm testing RabbitMQ with Mule using the JavaClient (RpcClient). I run 
> 1000 requests in a single thread and all is good. As soon as a I spawn 2 
> or more client threads I get ShutdownSignalException. None of my code 
> closes the connection but I can't figure out what does. The exception I 
> get is:
> 
> Caused by: com.rabbitmq.client.ShutdownSignalException (connection 
> error; reason: {#method<connection.close>(reply code=502, reply 
> text=SYNTAX_ERROR, class id=60, method id=40),null,""})
^^^^^^^^^^^^^^^^^^^^^^

Just discussed that last week:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-February/000901.html

Holger



From yhe at usatech.com  Mon Feb 25 16:09:24 2008
From: yhe at usatech.com (Ying He)
Date: Mon, 25 Feb 2008 11:09:24 -0500
Subject: [rabbitmq-discuss] Queue info
Message-ID: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>

Hi, all,

Is there any way in RabbitMQ server for the admin to check for example:

How many queues are currently in the system?

How many messages that each one has processed and each one still holds
waiting for the consumer to process?

 

I read the documentation and did not find a way to find these out.
Please advise if you know anything. I think it will be good to have
these stats available if they are not available on the server. Thank
you. 

 

Best,

Ying

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080225/9712b0b3/attachment.htm 

From chime at mu.dk  Wed Feb 27 08:40:48 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Wed, 27 Feb 2008 09:40:48 +0100
Subject: [rabbitmq-discuss] AMQP tracer tool on Mac OS X
Message-ID: <99FF5FF9-8192-4290-BC89-504B325D4409@mu.dk>

Just a small note. On Mac OS X 10.5 (don't about lower versions) /bin/ 
sh does not understand -n in the echo command. This means the runjava- 
sh script fails. It is fixed by making it use /bin/bash as the shell.

Regards,

Michael Arnoldus
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080227/7534bd12/attachment.bin 

From chime at mu.dk  Wed Feb 27 09:02:07 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Wed, 27 Feb 2008 10:02:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ internal error
Message-ID: <85FE5AD5-81AE-4601-92F2-DC6F103E89BF@mu.dk>

Hi,

Yesterday we experienced another problem with RabbitMQ. Possibly still  
our own fault, but this time a bit more severe. Suddenly from out of  
the blue it was impossible to send a single message through Rabbit.  
Even restart of the components connecting to rabbit didn't help. The  
erlang process stayed but didn't seem to work. Killing the beam  
process helped and everything returned to normal.

In a log file we had:

ERROR    2008-02-26 16:17:32,857   --call got Closed:  
Method(name=close, id=60) (541, 'INTERNAL_ERROR', 0, 0) content = None

The part of the message after "Closed:" is from a Qpid Python  
exception. I'm still prepared to suspect something with threading and  
are investigating. However, the other day when we had the threads  
sharing a channel problem, the message in the same log was:

ERROR    2008-02-21 15:20:09,962   --send got Closed:  
Method(name=close, id=60) (502, 'SYNTAX_ERROR', 60, 40) content = None

Unfortunately we don't have a rabbit.log of the incident. It seems  
rabbit overwrites the old log when restarting without doing any form  
of log rotation (hint hint :-)

Any suggestions or anything I can do find the problem is very welcome!!!

Regards,

Michael Arnoldus
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080227/cec80ca4/attachment.bin 

From marcuscavanaugh at gmail.com  Thu Feb 28 05:29:06 2008
From: marcuscavanaugh at gmail.com (Marcus Cavanaugh)
Date: Wed, 27 Feb 2008 23:29:06 -0600
Subject: [rabbitmq-discuss] Status of HTTP/AJAX Binding
Message-ID: <19470512-365A-4C65-AA77-F7F2DB408CC6@gmail.com>

Hello,

I've taken an initial glance at the HTTP AMQP binding; it looks  
promising. I noted that it is still "experimental". Is anyone actively  
using it, and/or are there known bugs? Also, is there a certain  
roadmap for when it might be considered suitable for production use?

I'm quite new to AMQP and RabbitMQ itself, so I'm in the process of  
acclimating myself to its concepts. Looks very interesting thus far.

Thanks,

Marcus




From tonyg at lshift.net  Thu Feb 28 07:15:20 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 28 Feb 2008 07:15:20 +0000
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
Message-ID: <47C65F88.8020700@lshift.net>

Hi Ying,

Ying He wrote:
> Is there any way in RabbitMQ server for the admin to check for example:
> How many queues are currently in the system?
> How many messages that each one has processed and each one still holds 
> waiting for the consumer to process?

There is an undocumented way of doing this. If you start the broker by 
running rabbitmq-server, then you end up at an erlang shell (if you 
don't see the prompt, tap enter to make it reprint it). If you have the 
broker running in the background, you need to attach an erlang shell to 
it, with a command along the lines of "erl -sname temp -remsh 
rabbit at yourmachine", running as the same user as the rabbit server.

At the erlang prompt, type "rabbit_amqqueue:stat_all().", which will 
produce a brief report on the status of the queues in the system. This 
tells you how many there are, how many consumers are listening on each, 
and how many messages are backlogged on each. There is no indication of 
how many messages have been through the queues yet. For example:

(rabbit at walk)1> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,<<"bar">>},0,1},
  {ok,{resource,<<"/">>,queue,<<"foo">>},0,1}]

The example shows two queues, "foo" and "bar", each with a single 
consumer attached (in fact a LogTail.exe instance from our .NET client), 
and neither with any messages waiting to be consumed. The result of the 
stat_all() call is a list of {status, fully-qualified-queue-name, 
message-queue-length, consumer-count} tuples.

Regards,
   Tony




From tonyg at lshift.net  Thu Feb 28 07:25:46 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 28 Feb 2008 07:25:46 +0000
Subject: [rabbitmq-discuss] AMQP tracer tool on Mac OS X
In-Reply-To: <99FF5FF9-8192-4290-BC89-504B325D4409@mu.dk>
References: <99FF5FF9-8192-4290-BC89-504B325D4409@mu.dk>
Message-ID: <47C661FA.8070107@lshift.net>

Hi Michael,

Michael Arnoldus wrote:
> Just a small note. On Mac OS X 10.5 (don't about lower versions) /bin/sh 
> does not understand -n in the echo command. This means the runjava-sh 
> script fails. It is fixed by making it use /bin/bash as the shell.

Thanks for the report. I've been working around this myself by "bash 
runjava.sh ..." for a while now; your message has spurred me to actually 
do something about it! I've committed a fix that avoids 'echo -n', while 
staying with /bin/sh. You should see it in the next release; in the 
meantime, for those interested, I've attached the revised script.

Regards,
   Tony

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: runjava.sh
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080228/ee45df40/attachment.txt 

From tonyg at lshift.net  Thu Feb 28 07:52:01 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 28 Feb 2008 07:52:01 +0000
Subject: [rabbitmq-discuss] RabbitMQ internal error
In-Reply-To: <85FE5AD5-81AE-4601-92F2-DC6F103E89BF@mu.dk>
References: <85FE5AD5-81AE-4601-92F2-DC6F103E89BF@mu.dk>
Message-ID: <47C66821.1000104@lshift.net>

Hi Michael,

Michael Arnoldus wrote:
> Yesterday we experienced another problem with RabbitMQ. Possibly still 
> our own fault, but this time a bit more severe. Suddenly from out of the 
> blue it was impossible to send a single message through Rabbit. Even 
> restart of the components connecting to rabbit didn't help. The erlang 
> process stayed but didn't seem to work. Killing the beam process helped 
> and everything returned to normal.

This is extremely interesting.

  - What architecture are you running on? Is it a Mac?
  - Was the CPU pinned to 100%?
  - Were you able to issue commands at the Erlang prompt in the server?

We are tracking down what we suspect to be a Mac-specific bug in the 
Erlang runtime that manifests in some corner-cases of socket shutdown - 
it would be interesting if you have detected the same thing we're 
chasing. (We are still in the early stages of our investigation - we 
can't say for sure yet whether it's really a runtime problem.)

> In a log file we had:
> ERROR    2008-02-26 16:17:32,857   --call got Closed: Method(name=close, 
> id=60) (541, 'INTERNAL_ERROR', 0, 0) content = None

If only the other log files hadn't been stomped on by the broker 
startup! Your message has prompted us to fix this bad behaviour - we 
have changed the startup scripts to move existing log files out of the 
way, keeping the most recent few files.

The INTERNAL_ERROR message is very interesting, because it indicates a 
real bug in the broker. We don't see it in the case of the Mac bug I 
mentioned earlier, so you might have found something different.

This is probably the code that ran:

lookup_amqp_exception(Other) ->
     rabbit_log:warning("Non-AMQP exit reason '~p'~n", [Other]),
     {true, ?INTERNAL_ERROR, <<"INTERNAL_ERROR">>, none}.

... which produces a "Non-AMQP exit reason" message in the log. I'm 
afraid without that message, we'll have a tough time diagnosing this one.

Regards,
   Tony



From tonyg at lshift.net  Thu Feb 28 08:01:58 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 28 Feb 2008 08:01:58 +0000
Subject: [rabbitmq-discuss] amq_client_session_wait in RabbitMQ .net API?
In-Reply-To: <OF254CC3F4.AC00E84A-ON852573F7.006AFCDA-852573F7.006B8065@manulife.com>
References: <OF254CC3F4.AC00E84A-ON852573F7.006AFCDA-852573F7.006B8065@manulife.com>
Message-ID: <47C66A76.9040902@lshift.net>

Hi Aamir,

Aamir_Mohammad at manulife.com wrote:
> In the OpenAMQ WireAPI there is a method called 
> amq_client_session_wait(session, timeout)  ... what is the equivalent 
> method in the RabitMQ .NET API?

There's no direct equivalent, because RabbitMQ's .NET client 
implementation uses a background thread to process packets arriving on 
the socket, and dispatches the resulting work to quite fine-grained 
IBasicConsumer instances that usually are running in application threads.

The recommended approach is to use either QueueingBasicConsumer, as per 
the example given in the documentation, http://tinyurl.com/2o7yen, or 
the higher-level convenience class Subscription, 
http://tinyurl.com/36xpmf. Here's the core of a Subscription-based receiver:

using (IConnection conn = new 
ConnectionFactory().CreateConnection(serverAddress))
{
     using (IModel ch = conn.CreateModel()) {
	Subscription sub;
	sub = new Subscription(ch, ticket, exchange, exchangeType,
				routingKey);
	foreach (BasicDeliverEventArgs e in sub) {
	    // ... handle the delivered message here, and send replies
	    // with ch.BasicPublish
	    sub.Ack(e);
	}
     }
}



From tonyg at lshift.net  Thu Feb 28 08:08:28 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 28 Feb 2008 08:08:28 +0000
Subject: [rabbitmq-discuss] Experimental STOMP adapter available
In-Reply-To: <15549124.post@talk.nabble.com>
References: <47A3B5C2.6070100@lshift.net> <15549124.post@talk.nabble.com>
Message-ID: <47C66BFC.4010001@lshift.net>

Hi Derek,

Derek Wischusen wrote:
> Thank you for creating this adapter.  I just tested it out with the
> ActionScript (Flash/Flex) Stomp client and everything seemed to work quite
> well.  If anyone is interested, I wrote up a short post about it here:
> http://flexonrails.net/?p=106.

Awesome post!

> Are you planning on adding any custom AMQP specific extensions to the
> protocol like ActiveMQ does for JMS (see
> http://activemq.apache.org/stomp.html)?  It looks like there is already one
> for specifying an exchange. Do you think you might add others?

Yes. I want to keep to the protocol definition as closely as possible, 
but to provide extensions to allow people to use more of the 
AMQP-specific features that are available. You're right about the 
exchange extension. So far, refreshing my memory by looking at the code, 
the extensions are:

  - "virtual-host" and "realm" headers on CONNECT, for exploiting
    RabbitMQ's implementation of AMQP's authorization features
  - "exchange" on SEND - if omitted, the default ("") exchange is used

If you have anything in mind you'd like to see added, please let me 
know. I need feedback to decide what direction to take the STOMP adapter in.

Regards,
   Tony




From tonyg at lshift.net  Thu Feb 28 08:16:15 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 28 Feb 2008 08:16:15 +0000
Subject: [rabbitmq-discuss] Replicated message queue?  DRDB+Hearbeat?
In-Reply-To: <10837132.5991203493224371.JavaMail.root@ly.sdf.com>
References: <10837132.5991203493224371.JavaMail.root@ly.sdf.com>
Message-ID: <47C66DCF.1090303@lshift.net>

Hi Tom,

Tom Samplonius wrote:
> I see that RabbitMQ does not yet have replication for message queues.

You're right. One of the items we're discussing informally at the moment 
here at LShift is the best way to refactor the codebase to support 
pluggable queue backends. Once that's done, it'll be easy to support the 
existing fast journal-based implementation alongside such as

  - a mnesia-backed queue
  - an ODBC-backed queue
  - other?

> I need a high-available message queue that never loses messages. I'm not
> terribly concerned about performance, as I just need to process several
> thousand messages per day. It is just hard to repair consistency if any
> are lost.

Understood.

> Anyone tried DRDB, or any other block mirroring system to create a
> cluster layer beneath RabbitMQ?

That's a *really* interesting idea. Rabbit's message store is in fact 
not in Mnesia (otherwise it'd already be replicated! :-) ), but is in a 
separate disk_log-based journal called "rabbit_persister.LOG". From 
casual investigation of DRBD it seems that your approach could work well.

The more I think about it the more I like the idea. If you try it, 
please share your results with us. If I get time (!) I'll have a stab at 
it myself, but I'm afraid that's not likely for the next few weeks.

Regards,
   Tony



From tonyg at lshift.net  Thu Feb 28 08:25:31 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 28 Feb 2008 08:25:31 +0000
Subject: [rabbitmq-discuss] State and idempotency (was Re: Replicated
 message queue? DRDB+Hearbeat?)
In-Reply-To: <28154399.6051203650772262.JavaMail.root@ly.sdf.com>
References: <28154399.6051203650772262.JavaMail.root@ly.sdf.com>
Message-ID: <47C66FFB.2070709@lshift.net>

Tom Samplonius wrote:
>> application logic to identify duplicate messages (just in case).
> 
> I've never come across a good way of doing this.  I can attach a
> unique id to each message, but then the clients have to keep state on
> which ids they've processed.  And if you multiple clients, they need
> to talk to each other too.  I don't want consumers to have to keep
> state.

Indeed. Ultimately, to support exactly-once delivery, the clients do 
have to have some kind of state. It can be reduced to a minimum, though 
- perhaps as far as two facts: the client's name, and a single integer 
representing its "high tide mark" in the incoming message stream.

The way we're looking to address this is to introduce the notion of a 
session. Sessions provide a notion of scope for stateful things like 
exactly-once delivery, with minimal client-side state.

By using the client-to-server notion of sessions, each client just needs 
to remember where it was up to in its conversation with the server, 
rather than anything about the wider conversations with other clients 
that are layered on top of the AMQP network, reducing the O(n^2) problem 
to O(n).

Regards,
   Tony



From alexis.richardson at cohesiveft.com  Thu Feb 28 08:25:43 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 28 Feb 2008 08:25:43 +0000
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <47C65F88.8020700@lshift.net>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
Message-ID: <167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>

Thanks Tony.

One other thing that we have been talking about and would love to
share with others is this: how best to expose these erlang 'management
functions', such as they are, to users of other languages?

What would people most like to see?  One idea would be to expose
functions remotely over queues (as reified RPC messages) and then use
the AMQP, STOMP or HTTP interfaces externally.  Another approach would
be to use one of the GUI tools, one of the prototype flex clients.

Any thoughts?

alexis


On Thu, Feb 28, 2008 at 7:15 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Hi Ying,
>
>
>  Ying He wrote:
>  > Is there any way in RabbitMQ server for the admin to check for example:
>  > How many queues are currently in the system?
>  > How many messages that each one has processed and each one still holds
>  > waiting for the consumer to process?
>
>  There is an undocumented way of doing this. If you start the broker by
>  running rabbitmq-server, then you end up at an erlang shell (if you
>  don't see the prompt, tap enter to make it reprint it). If you have the
>  broker running in the background, you need to attach an erlang shell to
>  it, with a command along the lines of "erl -sname temp -remsh
>  rabbit at yourmachine", running as the same user as the rabbit server.
>
>  At the erlang prompt, type "rabbit_amqqueue:stat_all().", which will
>  produce a brief report on the status of the queues in the system. This
>  tells you how many there are, how many consumers are listening on each,
>  and how many messages are backlogged on each. There is no indication of
>  how many messages have been through the queues yet. For example:
>
>  (rabbit at walk)1> rabbit_amqqueue:stat_all().
>  [{ok,{resource,<<"/">>,queue,<<"bar">>},0,1},
>   {ok,{resource,<<"/">>,queue,<<"foo">>},0,1}]
>
>  The example shows two queues, "foo" and "bar", each with a single
>  consumer attached (in fact a LogTail.exe instance from our .NET client),
>  and neither with any messages waiting to be consumed. The result of the
>  stat_all() call is a list of {status, fully-qualified-queue-name,
>  message-queue-length, consumer-count} tuples.
>
>  Regards,
>    Tony
>
>
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From tonyg at lshift.net  Thu Feb 28 08:31:16 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 28 Feb 2008 08:31:16 +0000
Subject: [rabbitmq-discuss] Generic AMQP API / Java client library
 evolution (OT?)
In-Reply-To: <47B58C29.6060103@wizards.de>
References: <47B58C29.6060103@wizards.de>
Message-ID: <47C67154.8030601@lshift.net>

Hi Holger,

Holger Hoffst?tte wrote:
> A more general question about AMQP, hope that is not too OT. Does anybody 
> know if there are any plans for a generic Java API in terms of interfaces, 
> like JMS? I saw the note about the "properly modeled" client API on the 
> Rabbit roadmap and it was not entirely clear whether this will follow some 
> kind of common API. Looking at Qpid they seem to happily mix Qpid and JMS 
> APIs, which may help adoption but IMHO looks a bit questionable from an 
> evolutionary point of view, since AMQP is so much more powerful and 
> well-defined than JMS.

Agreed. I think a standard API is best evolved for a while before being 
more formally designed. IMO, we're still in the "evolution" phase, as 
people get to grips with working with AMQP.

We'd welcome any feedback on what style of API people would like to use. 
Personally, I think our Java API wasn't a bad first stab, but I actually 
prefer the style of our .NET API more. I'd really like to get the Java 
client library refactored to be more in the style of the .NET library.

Check out the .NET API docs at 
http://www.rabbitmq.com/releases/doc/rabbitmq-dotnet-release_20080125/rabbitmq-dotnet-1.2.8025.1832-net-2.0-htmldoc/ 
- the core namespace is RabbitMQ.Client, corresponding roughly to Java's 
  com.rabbitmq.client package.

Particular features I'd like to transplant are the way the shutdown 
protocols work, including the ability to get good information on the 
cause of the shutdown, and the way multiple protocol variants are 
supported (although clearly the way it's done in the .NET library today 
is just a start).

Tony




From tonyg at lshift.net  Thu Feb 28 08:36:02 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 28 Feb 2008 08:36:02 +0000
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>	
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
Message-ID: <47C67272.8050903@lshift.net>

Alexis Richardson wrote:
> What would people most like to see?  One idea would be to expose
> functions remotely over queues (as reified RPC messages) and then use
> the AMQP, STOMP or HTTP interfaces externally.  Another approach would
> be to use one of the GUI tools, one of the prototype flex clients.

I really like that idea of exposing server-internal interfaces over an 
AMQP transport and layering tools over top of various AMQP client 
libraries or adapters. I wouldn't go for a GUI to begin with, but that's 
just my cantankerous unix dinosaurhood, perhaps :-)

Ben Hood has made a promising start in this direction: see 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2007-October/000662.html 
for some details.

Tony




From JWatson at sis.tv  Thu Feb 28 08:46:59 2008
From: JWatson at sis.tv (John Watson)
Date: Thu, 28 Feb 2008 08:46:59 -0000
Subject: [rabbitmq-discuss] Generic AMQP API / Java client library
 evolution (OT?)
References: <47B58C29.6060103@wizards.de> <47C67154.8030601@lshift.net>
Message-ID: <85FA03E6BB6F0340B5A117013571A9B7FD7160@exchange3.ad.sis.tv>

My two-pennorth is that I'd prefer to see exchanges and queues as first-class objects in the java / .Net APIs. I realise there's an impedence mismatch here with the erlang, but nevertheless......

John

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tony Garnock-Jones
Sent: 28 February 2008 08:31
To: Holger Hoffst?tte
Cc: rabbitmq
Subject: Re: [rabbitmq-discuss] Generic AMQP API / Java client library evolution (OT?)

Hi Holger,

Holger Hoffst?tte wrote:
> A more general question about AMQP, hope that is not too OT. Does anybody 
> know if there are any plans for a generic Java API in terms of interfaces, 
> like JMS? I saw the note about the "properly modeled" client API on the 
> Rabbit roadmap and it was not entirely clear whether this will follow some 
> kind of common API. Looking at Qpid they seem to happily mix Qpid and JMS 
> APIs, which may help adoption but IMHO looks a bit questionable from an 
> evolutionary point of view, since AMQP is so much more powerful and 
> well-defined than JMS.

Agreed. I think a standard API is best evolved for a while before being 
more formally designed. IMO, we're still in the "evolution" phase, as 
people get to grips with working with AMQP.

We'd welcome any feedback on what style of API people would like to use. 
Personally, I think our Java API wasn't a bad first stab, but I actually 
prefer the style of our .NET API more. I'd really like to get the Java 
client library refactored to be more in the style of the .NET library.

Check out the .NET API docs at 
http://www.rabbitmq.com/releases/doc/rabbitmq-dotnet-release_20080125/rabbitmq-dotnet-1.2.8025.1832-net-2.0-htmldoc/ 
- the core namespace is RabbitMQ.Client, corresponding roughly to Java's 
  com.rabbitmq.client package.

Particular features I'd like to transplant are the way the shutdown 
protocols work, including the ability to get good information on the 
cause of the shutdown, and the way multiple protocol variants are 
supported (although clearly the way it's done in the .NET library today 
is just a start).

Tony


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

*************************************************************
Satellite Information Services Limited Registered Office: 
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality.  If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
*************************************************************




From themuleman at gmail.com  Thu Feb 28 09:01:17 2008
From: themuleman at gmail.com (Ross Mason)
Date: Thu, 28 Feb 2008 10:01:17 +0100
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
Message-ID: <7871CF1B-C900-4D78-869F-466662F5B306@gmail.com>

I think you'd be better of starting off with SNMP. I think Tony said  
that Erlang already has a library for this and both .Net and java have  
some support for SNMP.  It would be a good feature to be able to plug  
in to existing management frameworks such as HP OpenView, Hyperic,  
Hawk, Hermes (they all start with an H, weird).

Cheers,

Ross Mason
CTO, Co-Founder
MuleSource Inc.

http://mulesource.com | http://blog.rossmason.com





On 28 Feb 2008, at 09:25, Alexis Richardson wrote:

> Thanks Tony.
>
> One other thing that we have been talking about and would love to
> share with others is this: how best to expose these erlang 'management
> functions', such as they are, to users of other languages?
>
> What would people most like to see?  One idea would be to expose
> functions remotely over queues (as reified RPC messages) and then use
> the AMQP, STOMP or HTTP interfaces externally.  Another approach would
> be to use one of the GUI tools, one of the prototype flex clients.
>
> Any thoughts?
>
> alexis
>
>
> On Thu, Feb 28, 2008 at 7:15 AM, Tony Garnock-Jones  
> <tonyg at lshift.net> wrote:
>> Hi Ying,
>>
>>
>> Ying He wrote:
>>> Is there any way in RabbitMQ server for the admin to check for  
>>> example:
>>> How many queues are currently in the system?
>>> How many messages that each one has processed and each one still  
>>> holds
>>> waiting for the consumer to process?
>>
>> There is an undocumented way of doing this. If you start the broker  
>> by
>> running rabbitmq-server, then you end up at an erlang shell (if you
>> don't see the prompt, tap enter to make it reprint it). If you have  
>> the
>> broker running in the background, you need to attach an erlang  
>> shell to
>> it, with a command along the lines of "erl -sname temp -remsh
>> rabbit at yourmachine", running as the same user as the rabbit server.
>>
>> At the erlang prompt, type "rabbit_amqqueue:stat_all().", which will
>> produce a brief report on the status of the queues in the system.  
>> This
>> tells you how many there are, how many consumers are listening on  
>> each,
>> and how many messages are backlogged on each. There is no  
>> indication of
>> how many messages have been through the queues yet. For example:
>>
>> (rabbit at walk)1> rabbit_amqqueue:stat_all().
>> [{ok,{resource,<<"/">>,queue,<<"bar">>},0,1},
>>  {ok,{resource,<<"/">>,queue,<<"foo">>},0,1}]
>>
>> The example shows two queues, "foo" and "bar", each with a single
>> consumer attached (in fact a LogTail.exe instance from our .NET  
>> client),
>> and neither with any messages waiting to be consumed. The result of  
>> the
>> stat_all() call is a list of {status, fully-qualified-queue-name,
>> message-queue-length, consumer-count} tuples.
>>
>> Regards,
>>   Tony
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> -- 
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From chime at mu.dk  Thu Feb 28 09:18:02 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Thu, 28 Feb 2008 10:18:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ internal error
In-Reply-To: <47C66821.1000104@lshift.net>
References: <85FE5AD5-81AE-4601-92F2-DC6F103E89BF@mu.dk>
	<47C66821.1000104@lshift.net>
Message-ID: <C37C2E46-2974-4D01-BDE0-A6F2471745B2@mu.dk>

Hi Tony,

Yes, we're running on a Mac. Don't know about the CPU as I  
unfortunately wasn't present when I happened. I'll check to and see if  
somebody else knows. Good to hear you have changed the startup script  
and we'll be careful to save the log-file if it happens again and  
check CPU utilization and if we can get an erlang shell.

Thank you for taking this so seriously. I will send you anything we  
discover, and please let me know if you find anything that you think  
might be relevant to this, or any experiments you would like us to try.

Regards,

Michael


On Feb 28, 2008, at 8:52 , Tony Garnock-Jones wrote:

> Hi Michael,
>
> Michael Arnoldus wrote:
>> Yesterday we experienced another problem with RabbitMQ. Possibly  
>> still our own fault, but this time a bit more severe. Suddenly from  
>> out of the blue it was impossible to send a single message through  
>> Rabbit. Even restart of the components connecting to rabbit didn't  
>> help. The erlang process stayed but didn't seem to work. Killing  
>> the beam process helped and everything returned to normal.
>
> This is extremely interesting.
>
> - What architecture are you running on? Is it a Mac?
> - Was the CPU pinned to 100%?
> - Were you able to issue commands at the Erlang prompt in the server?
>
> We are tracking down what we suspect to be a Mac-specific bug in the  
> Erlang runtime that manifests in some corner-cases of socket  
> shutdown - it would be interesting if you have detected the same  
> thing we're chasing. (We are still in the early stages of our  
> investigation - we can't say for sure yet whether it's really a  
> runtime problem.)
>
>> In a log file we had:
>> ERROR    2008-02-26 16:17:32,857   --call got Closed:  
>> Method(name=close, id=60) (541, 'INTERNAL_ERROR', 0, 0) content =  
>> None
>
> If only the other log files hadn't been stomped on by the broker  
> startup! Your message has prompted us to fix this bad behaviour - we  
> have changed the startup scripts to move existing log files out of  
> the way, keeping the most recent few files.
>
> The INTERNAL_ERROR message is very interesting, because it indicates  
> a real bug in the broker. We don't see it in the case of the Mac bug  
> I mentioned earlier, so you might have found something different.
>
> This is probably the code that ran:
>
> lookup_amqp_exception(Other) ->
>    rabbit_log:warning("Non-AMQP exit reason '~p'~n", [Other]),
>    {true, ?INTERNAL_ERROR, <<"INTERNAL_ERROR">>, none}.
>
> ... which produces a "Non-AMQP exit reason" message in the log. I'm  
> afraid without that message, we'll have a tough time diagnosing this  
> one.
>
> Regards,
>  Tony




From chime at mu.dk  Thu Feb 28 09:27:39 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Thu, 28 Feb 2008 10:27:39 +0100
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
Message-ID: <3D9A6D60-2D06-46C8-847F-56923360C878@mu.dk>

As long as we're just wishing ... :-)

In order of priority:

1. Exposed over AMQP - I send a message to some queue the broker  
listens too and get a reply with the information I need.
2. A very simple command-line tool giving the same info.
3. A nice sexy GUI with bells and whistles :-)

(1) would actually be VERY nice - to the degree that I'd be prepared  
to write something myself when I get some headroom (Rrright! ;-)

Speaking of which - if it should happen that I one late night are  
finding myself sorely missing working in erlang to the degree that I'd  
like to experiment with this - do you have any docs or just pointers  
to how to receive and send AMQP from inside erlang? I guess using the  
erlang AMQP client to let the server talk to itself isn't exactly the  
right approach ...

Michael

On Feb 28, 2008, at 9:25 , Alexis Richardson wrote:

> Thanks Tony.
>
> One other thing that we have been talking about and would love to
> share with others is this: how best to expose these erlang 'management
> functions', such as they are, to users of other languages?
>
> What would people most like to see?  One idea would be to expose
> functions remotely over queues (as reified RPC messages) and then use
> the AMQP, STOMP or HTTP interfaces externally.  Another approach would
> be to use one of the GUI tools, one of the prototype flex clients.
>
> Any thoughts?
>
> alexis
>
>
> On Thu, Feb 28, 2008 at 7:15 AM, Tony Garnock-Jones  
> <tonyg at lshift.net> wrote:
>> Hi Ying,
>>
>>
>> Ying He wrote:
>>> Is there any way in RabbitMQ server for the admin to check for  
>>> example:
>>> How many queues are currently in the system?
>>> How many messages that each one has processed and each one still  
>>> holds
>>> waiting for the consumer to process?
>>
>> There is an undocumented way of doing this. If you start the broker  
>> by
>> running rabbitmq-server, then you end up at an erlang shell (if you
>> don't see the prompt, tap enter to make it reprint it). If you have  
>> the
>> broker running in the background, you need to attach an erlang  
>> shell to
>> it, with a command along the lines of "erl -sname temp -remsh
>> rabbit at yourmachine", running as the same user as the rabbit server.
>>
>> At the erlang prompt, type "rabbit_amqqueue:stat_all().", which will
>> produce a brief report on the status of the queues in the system.  
>> This
>> tells you how many there are, how many consumers are listening on  
>> each,
>> and how many messages are backlogged on each. There is no  
>> indication of
>> how many messages have been through the queues yet. For example:
>>
>> (rabbit at walk)1> rabbit_amqqueue:stat_all().
>> [{ok,{resource,<<"/">>,queue,<<"bar">>},0,1},
>>  {ok,{resource,<<"/">>,queue,<<"foo">>},0,1}]
>>
>> The example shows two queues, "foo" and "bar", each with a single
>> consumer attached (in fact a LogTail.exe instance from our .NET  
>> client),
>> and neither with any messages waiting to be consumed. The result of  
>> the
>> stat_all() call is a list of {status, fully-qualified-queue-name,
>> message-queue-length, consumer-count} tuples.
>>
>> Regards,
>>   Tony
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> -- 
> Alexis Richardson
> +44 20 7617 7339 (UK)
> +44 77 9865 2911 (cell)
> +1 650 206 2517 (US)
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From alexis.richardson at cohesiveft.com  Thu Feb 28 11:51:28 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 28 Feb 2008 11:51:28 +0000
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <7871CF1B-C900-4D78-869F-466662F5B306@gmail.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
	<7871CF1B-C900-4D78-869F-466662F5B306@gmail.com>
Message-ID: <167204d20802280351h4c433439p946a7ed25a1e07c1@mail.gmail.com>

Ross

Interesting... thanks.  Here is some background on SNMP from Erlang Consulting:

http://www.erlang-consulting.com/thesis/protocolmapping.html

I am not sure what kinds of things Hyperic et al. look for.

With Hermes, talking to Rabbit via the Qpid M1 JMS client should work.
 See Sebastien's Spring emails...

alexis




On Thu, Feb 28, 2008 at 9:01 AM, Ross Mason <themuleman at gmail.com> wrote:
> I think you'd be better of starting off with SNMP. I think Tony said
>  that Erlang already has a library for this and both .Net and java have
>  some support for SNMP.  It would be a good feature to be able to plug
>  in to existing management frameworks such as HP OpenView, Hyperic,
>  Hawk, Hermes (they all start with an H, weird).
>
>  Cheers,
>
>  Ross Mason
>  CTO, Co-Founder
>  MuleSource Inc.
>
>  http://mulesource.com | http://blog.rossmason.com
>
>
>
>
>
>
>
>  On 28 Feb 2008, at 09:25, Alexis Richardson wrote:
>
>  > Thanks Tony.
>  >
>  > One other thing that we have been talking about and would love to
>  > share with others is this: how best to expose these erlang 'management
>  > functions', such as they are, to users of other languages?
>  >
>  > What would people most like to see?  One idea would be to expose
>  > functions remotely over queues (as reified RPC messages) and then use
>  > the AMQP, STOMP or HTTP interfaces externally.  Another approach would
>  > be to use one of the GUI tools, one of the prototype flex clients.
>  >
>  > Any thoughts?
>  >
>  > alexis
>  >
>  >
>  > On Thu, Feb 28, 2008 at 7:15 AM, Tony Garnock-Jones
>  > <tonyg at lshift.net> wrote:
>  >> Hi Ying,
>  >>
>  >>
>  >> Ying He wrote:
>  >>> Is there any way in RabbitMQ server for the admin to check for
>  >>> example:
>  >>> How many queues are currently in the system?
>  >>> How many messages that each one has processed and each one still
>  >>> holds
>  >>> waiting for the consumer to process?
>  >>
>  >> There is an undocumented way of doing this. If you start the broker
>  >> by
>  >> running rabbitmq-server, then you end up at an erlang shell (if you
>  >> don't see the prompt, tap enter to make it reprint it). If you have
>  >> the
>  >> broker running in the background, you need to attach an erlang
>  >> shell to
>  >> it, with a command along the lines of "erl -sname temp -remsh
>  >> rabbit at yourmachine", running as the same user as the rabbit server.
>  >>
>  >> At the erlang prompt, type "rabbit_amqqueue:stat_all().", which will
>  >> produce a brief report on the status of the queues in the system.
>  >> This
>  >> tells you how many there are, how many consumers are listening on
>  >> each,
>  >> and how many messages are backlogged on each. There is no
>  >> indication of
>  >> how many messages have been through the queues yet. For example:
>  >>
>  >> (rabbit at walk)1> rabbit_amqqueue:stat_all().
>  >> [{ok,{resource,<<"/">>,queue,<<"bar">>},0,1},
>  >>  {ok,{resource,<<"/">>,queue,<<"foo">>},0,1}]
>  >>
>  >> The example shows two queues, "foo" and "bar", each with a single
>  >> consumer attached (in fact a LogTail.exe instance from our .NET
>  >> client),
>  >> and neither with any messages waiting to be consumed. The result of
>  >> the
>  >> stat_all() call is a list of {status, fully-qualified-queue-name,
>  >> message-queue-length, consumer-count} tuples.
>  >>
>  >> Regards,
>  >>   Tony
>  >>
>  >>
>  >> _______________________________________________
>  >> rabbitmq-discuss mailing list
>  >> rabbitmq-discuss at lists.rabbitmq.com
>  >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  >>
>  >
>  >
>  >
>  > --
>  > Alexis Richardson
>  > +44 20 7617 7339 (UK)
>  > +44 77 9865 2911 (cell)
>  > +1 650 206 2517 (US)
>  >
>  > _______________________________________________
>  > rabbitmq-discuss mailing list
>  > rabbitmq-discuss at lists.rabbitmq.com
>  > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From yhe at usatech.com  Thu Feb 28 14:42:25 2008
From: yhe at usatech.com (Ying He)
Date: Thu, 28 Feb 2008 09:42:25 -0500
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <47C65F88.8020700@lshift.net>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
Message-ID: <DC162902A1CB844CBEF4A6753064B42D03584059@usamal03.usatech.com>

Hi, Thanks for your reply.

I was running rabbitmq-server.bat and I do have some queues with
producers and consumers and they are working fine running in the
backgroud. However this command does not show me the right info, when I
start in another cmd 

C:\Program Files\erl5.5.5\bin>erl -sname yhe -remsh rabbit at localhost
Eshell V5.5.5  (abort with ^G)
(yhe at yhe)1> rabbit_amqqueue:stat_all().
** exited: {aborted,{no_exists,[amqqueue,[{'$1',[],['$1']}]]}} **

Please advise. Anything I did wrong? 'yhe' is the username.

As to the management interface, it will be good to see the number of
messages that has been through the queue and the number of messages that
still sit on the queue and error log for failure of delivery etc( this
could be optional)

Best,
ying

-----Original Message-----
From: Tony Garnock-Jones [mailto:tonyg at lshift.net] 
Sent: Thursday, February 28, 2008 2:15 AM
To: Ying He
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Queue info

Hi Ying,

Ying He wrote:
> Is there any way in RabbitMQ server for the admin to check for
example:
> How many queues are currently in the system?
> How many messages that each one has processed and each one still holds

> waiting for the consumer to process?

There is an undocumented way of doing this. If you start the broker by 
running rabbitmq-server, then you end up at an erlang shell (if you 
don't see the prompt, tap enter to make it reprint it). If you have the 
broker running in the background, you need to attach an erlang shell to 
it, with a command along the lines of "erl -sname temp -remsh 
rabbit at yourmachine", running as the same user as the rabbit server.

At the erlang prompt, type "rabbit_amqqueue:stat_all().", which will 
produce a brief report on the status of the queues in the system. This 
tells you how many there are, how many consumers are listening on each, 
and how many messages are backlogged on each. There is no indication of 
how many messages have been through the queues yet. For example:

(rabbit at walk)1> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,<<"bar">>},0,1},
  {ok,{resource,<<"/">>,queue,<<"foo">>},0,1}]

The example shows two queues, "foo" and "bar", each with a single 
consumer attached (in fact a LogTail.exe instance from our .NET client),

and neither with any messages waiting to be consumed. The result of the 
stat_all() call is a list of {status, fully-qualified-queue-name, 
message-queue-length, consumer-count} tuples.

Regards,
   Tony




From 0x6e6562 at gmail.com  Fri Feb 29 09:44:38 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 29 Feb 2008 09:44:38 +0000
Subject: [rabbitmq-discuss] Queue info
Message-ID: <6D4A9404-BA07-4896-A88B-E0CA06540946@gmail.com>

Michael,

On 28 Feb 2008, at 09:27, Michael Arnoldus wrote:

> 1. Exposed over AMQP - I send a message to some queue the broker
> listens too and get a reply with the information I need.

This already exists, albeit in a very alpha form due to other  
priorities:

http://dev.rabbitmq.com/viewmtn/branch/changes/com.rabbitmq.management

Basically it exposes the rabbit_access_control module via an  
asynchronous RPC over AMQP mechanism.

So you program against a Java interface which is backed by a dynamic  
proxy that initiates an RPC request via AMQP.

On the Rabbit side, you have a generic RPC handler that invokes the  
correct module in the address space of the server, which in turn  
returns it's response as the bottom half of the RPC.

 From a client perspective, because you are programming against a Java  
management interface, you don't even need to care whether it's AMQP or  
whatever.

The reason why I used AMQP as a remoting technology was twofold:

1. Rabbit already speaks it
2. An AMQP implementation *should* eat its own dogfood :-)

HTH,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080229/55888b62/attachment.htm 

From tonyg at lshift.net  Fri Feb 29 12:24:25 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 29 Feb 2008 12:24:25 +0000
Subject: [rabbitmq-discuss] Generic AMQP API / Java client library
 evolution (OT?)
In-Reply-To: <85FA03E6BB6F0340B5A117013571A9B7FD7160@exchange3.ad.sis.tv>
References: <47B58C29.6060103@wizards.de> <47C67154.8030601@lshift.net>
	<85FA03E6BB6F0340B5A117013571A9B7FD7160@exchange3.ad.sis.tv>
Message-ID: <47C7F979.400@lshift.net>

Hi John,

John Watson wrote:
> My two-pennorth is that I'd prefer to see exchanges and queues as
> first-class objects in the java / .Net APIs.

We think that this is probably a good idea, and have been thinking along
these lines ourselves, but each time we get stuck on the following
questions; perhaps you can help?

 - What kinds of operations on first-class exchanges and queues should
   exist?

 - What kinds of collaborations would a first-class exchange or queue
   have with, for example, Channels and/or Connections?

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri Feb 29 12:31:23 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 29 Feb 2008 12:31:23 +0000
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <DC162902A1CB844CBEF4A6753064B42D03584059@usamal03.usatech.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<DC162902A1CB844CBEF4A6753064B42D03584059@usamal03.usatech.com>
Message-ID: <47C7FB1B.2060403@lshift.net>

Hi Ying,

Ying He wrote:
> I was running rabbitmq-server.bat and I do have some queues with
> producers and consumers and they are working fine running in the
> backgroud. However this command does not show me the right info, when I
> start in another cmd 
> 
> C:\Program Files\erl5.5.5\bin>erl -sname yhe -remsh rabbit at localhost
> Eshell V5.5.5  (abort with ^G)
> (yhe at yhe)1> rabbit_amqqueue:stat_all().
> ** exited: {aborted,{no_exists,[amqqueue,[{'$1',[],['$1']}]]}} **

This is really interesting. I haven't tried the "-remsh" option on
Windows yet, but it looks like it's not registered that it's supposed to
connect to the running broker. For comparison, here's what I see on my
Linux machine:

~$ erl -sname foo -remsh rabbit at shortstop
Erlang (BEAM) emulator version 5.5.5 [source] [async-threads:0] [hipe]
[kernel-poll:false]

Eshell V5.5.5  (abort with ^G)
(rabbit at shortstop)1>


Notice how I said "-sname foo", and the *prompt* I'm given says
"rabbit at shortstop", indicating that I am issuing commands into a remote
erlang instance, not the local one. In the text you copied into your
email, above, we see "yhe at yhe" as the prompt, indicating that commands
you enter are being targetted at the *local* erlang instance, not the
remote one named in the "-remsh" command-line option.

I'll try to find a windows machine upon which to experiment.

> Please advise. Anything I did wrong? 'yhe' is the username.

If it's also the machine name, perhaps the following will do the trick?

erl -sname temp -remsh rabbit at yhe

> As to the management interface, it will be good to see the number of
> messages that has been through the queue and the number of messages that
> still sit on the queue and error log for failure of delivery etc( this
> could be optional)

The number-of-messages-seen could be added fairly easily. The number of
messages currently on the queue is already present. What do you mean by
"failure of delivery", in this case?

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From sustrik at imatix.com  Fri Feb 29 12:34:02 2008
From: sustrik at imatix.com (Martin Sustrik)
Date: Fri, 29 Feb 2008 13:34:02 +0100
Subject: [rabbitmq-discuss] Generic AMQP API / Java client library
 evolution (OT?)
In-Reply-To: <47C7F979.400@lshift.net>
References: <47B58C29.6060103@wizards.de>
	<47C67154.8030601@lshift.net>	<85FA03E6BB6F0340B5A117013571A9B7FD7160@exchange3.ad.sis.tv>
	<47C7F979.400@lshift.net>
Message-ID: <47C7FBBA.3030006@imatix.com>


>  - What kinds of collaborations would a first-class exchange or queue
>    have with, for example, Channels and/or Connections?
>   
Just a hint: It proved useful to have exclusive queues/exchanges listed 
under appropriate connection.

That way you can find the connection corresponding to your app and list 
all of it's exclusive resources.

Martin



From tonyg at lshift.net  Fri Feb 29 12:51:42 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 29 Feb 2008 12:51:42 +0000
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <DC162902A1CB844CBEF4A6753064B42D03584059@usamal03.usatech.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<DC162902A1CB844CBEF4A6753064B42D03584059@usamal03.usatech.com>
Message-ID: <47C7FFDE.7030605@lshift.net>

Hi Ying,

I've run some experiments now. The problem seems to be that erl.exe
doesn't honour the -remsh option, where werl.exe does. So you could try

werl -sname test -remsh rabbitmq at yourmachinename

which should give you a prompt reading "rabbitmq at ..." instead of "test at ...".

Regards,
  Tony

Ying He wrote:
> C:\Program Files\erl5.5.5\bin>erl -sname yhe -remsh rabbit at localhost
> Eshell V5.5.5  (abort with ^G)
> (yhe at yhe)1> rabbit_amqqueue:stat_all().
> ** exited: {aborted,{no_exists,[amqqueue,[{'$1',[],['$1']}]]}} **
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From JWatson at sis.tv  Fri Feb 29 15:58:38 2008
From: JWatson at sis.tv (John Watson)
Date: Fri, 29 Feb 2008 15:58:38 -0000
Subject: [rabbitmq-discuss] Generic AMQP API / Java client library
 evolution (OT?)
References: <47B58C29.6060103@wizards.de> <47C67154.8030601@lshift.net> 
	<85FA03E6BB6F0340B5A117013571A9B7FD7160@exchange3.ad.sis.tv> 
	<47C7F979.400@lshift.net>
Message-ID: <85FA03E6BB6F0340B5A117013571A9B7FD7190@exchange3.ad.sis.tv>

Hi, Tony

>> What kinds of collaborations would a first-class exchange or queue
>>   have with, for example, Channels and/or Connections?

One of the aspects of the AMQP spec that I have trouble with is the dynamic and transient nature of so much of what can happen.  From my perspective, I would need durable exchanges and queues that have an independent existence - i.e. orthogonal to any producer or consumer that may happen to connect to them.

If (say) a producer needs to create a transient object, then it would need to do so in the context of a channel and connection before it starts to use them for putting messages. I can quite see that. But if we want durable objects, in many cases the channels and connections are just ceremony that we need to perform in order to do the creation or modification.

Does this help at all?

John

*************************************************************
Satellite Information Services Limited Registered Office: 
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality.  If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
*************************************************************




From yhe at usatech.com  Fri Feb 29 16:47:54 2008
From: yhe at usatech.com (Ying He)
Date: Fri, 29 Feb 2008 11:47:54 -0500
Subject: [rabbitmq-discuss] Queue info
In-Reply-To: <47C7FB1B.2060403@lshift.net>
References: <DC162902A1CB844CBEF4A6753064B42D03584059@usamal03.usatech.com>
	<47C7FB1B.2060403@lshift.net>
Message-ID: <DC162902A1CB844CBEF4A6753064B42D0358405B@usamal03.usatech.com>

Hi, Tony,
Thanks for your advice. erl works for Solaris(I have it on solaris too)
for rabbit_amqqueue:stat_all() (Note: on solaris rabbit at localhost will
not work, I have to use machine name)

For werl, it works once on windows XP, and the second time I run it. I
got a erl crush dump. Here is a snippet of the dump file:

=erl_crash_dump:0.1
Fri Feb 29 11:11:51 2008
Slogan: Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}
})
System version: Erlang (BEAM) emulator version 5.5.5 [async-threads:0]
Compiled: Tue Jun 12 12:44:20 2007

After this crash, I am not able to run werl -sname yhe -remsh rabbit at yhe
again successfully. Please advise if you know more about this.

As to the "failure of delivery", what I mean is if a delivery happens
but the client does not acknowledge it, then according to the AMQP spec,
the server needs to redeliver it if the client start a new session. And
if after all redeliver try of eg 5 times, the server still cannot
deliver the message and get acknowledgement. It should  put the message
to the dead letter queue and cause the client to abort. It will be
helpful to see how many messages are being redelivered because of no
acknowledgement and find a way to examine the message content( I don't
know how though at this moment) 

Best,
Ying


-----Original Message-----
From: Tony Garnock-Jones [mailto:tonyg at lshift.net] 
Sent: Friday, February 29, 2008 7:31 AM
To: Ying He
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Queue info

Hi Ying,

Ying He wrote:
> I was running rabbitmq-server.bat and I do have some queues with
> producers and consumers and they are working fine running in the
> backgroud. However this command does not show me the right info, when
I
> start in another cmd 
> 
> C:\Program Files\erl5.5.5\bin>erl -sname yhe -remsh rabbit at localhost
> Eshell V5.5.5  (abort with ^G)
> (yhe at yhe)1> rabbit_amqqueue:stat_all().
> ** exited: {aborted,{no_exists,[amqqueue,[{'$1',[],['$1']}]]}} **

This is really interesting. I haven't tried the "-remsh" option on
Windows yet, but it looks like it's not registered that it's supposed to
connect to the running broker. For comparison, here's what I see on my
Linux machine:

~$ erl -sname foo -remsh rabbit at shortstop
Erlang (BEAM) emulator version 5.5.5 [source] [async-threads:0] [hipe]
[kernel-poll:false]

Eshell V5.5.5  (abort with ^G)
(rabbit at shortstop)1>


Notice how I said "-sname foo", and the *prompt* I'm given says
"rabbit at shortstop", indicating that I am issuing commands into a remote
erlang instance, not the local one. In the text you copied into your
email, above, we see "yhe at yhe" as the prompt, indicating that commands
you enter are being targetted at the *local* erlang instance, not the
remote one named in the "-remsh" command-line option.

I'll try to find a windows machine upon which to experiment.

> Please advise. Anything I did wrong? 'yhe' is the username.

If it's also the machine name, perhaps the following will do the trick?

erl -sname temp -remsh rabbit at yhe

> As to the management interface, it will be good to see the number of
> messages that has been through the queue and the number of messages
that
> still sit on the queue and error log for failure of delivery etc( this
> could be optional)

The number-of-messages-seen could be added fairly easily. The number of
messages currently on the queue is already present. What do you mean by
"failure of delivery", in this case?

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



