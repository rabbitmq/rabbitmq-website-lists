From vlm at lionet.info  Fri May  1 01:17:11 2009
From: vlm at lionet.info (Lev Walkin)
Date: Thu, 30 Apr 2009 17:17:11 -0700
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
 robustness problem
In-Reply-To: <49F9E177.9060508@lshift.net>
References: <49F58CFB.8070406@lionet.info> <49F8C1CF.7080405@lshift.net>
	<49F9E177.9060508@lshift.net>
Message-ID: <49FA3F87.1000007@lionet.info>

Tony Garnock-Jones wrote:
> Matthias Radestock wrote:
>> Lev Walkin wrote:
>>> During evaluation period, our RabbitMQ node has crashed at some point, 
>>> killed by OOM killer.
> 
> You may also wish to disable the OOM killer!!!

I've already had two power outages in our triple-redundant industrial 
grade colocation in San Jose. How do I disable power outages?

-- 
vlm



From rberger at ibd.com  Fri May  1 04:20:55 2009
From: rberger at ibd.com (Robert J Berger)
Date: Thu, 30 Apr 2009 20:20:55 -0700
Subject: [rabbitmq-discuss] apt-get install rabbitmq-server for 1.5.4 fails
	even though it succeeds (/etc/init.d/rabbitmq start doesn't
	daemonize)
Message-ID: <4FFF2D4B-CFEB-496C-87ED-4033497CC1AC@ibd.com>

On a fresh install of rabbitmq-server 1.5.4 on ubuntu 8.10 server the  
install fails after trying to start rabbitmq-server. It looks like  
when the install finishes installing and then trys to do an /etc/ 
init.d/rabbitmq-server start, the process starts ok, but it doesn't  
daemonize. Eventually the install times out and says it fails:

...
Starting rabbitmq-server:
[... long wait... ]
FAILED - check /var/log/rabbitmq/startup_log, _err
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
subprocess post-installation script returned error exit status 1
...
ps shows that it is running:

29782 ?        Ssl    0:00 /usr/lib/erlang/erts-5.5.5/bin/beam -W w -K  
true -A30 -- -root /usr/lib/erlang -progname erl -- -home /var/lib/ 
rabbitmq -pa /usr/lib/rabbitmq/bin/../ebin -noshell -noinput -s rabbit  
-sname rabbit -boot start_sasl -kernel inet_default_listen_options  
[{nodelay,true},{sndbuf,16384},{recbuf,4096}] -kernel  
inet_default_connect_options [{nodelay,true}] -rabbit tcp_listeners  
[{"0.0.0.0", 5672}] -sasl errlog_type error -kernel error_logger  
{file,"/var/log/rabbitmq/rabbit.log"} -sasl sasl_error_logger {file,"/ 
var/log/rabbitmq/rabbit-sasl.log"} -os_mon start_cpu_sup true -os_mon  
start_disksup false -os_mon start_memsup false -os_mon start_os_sup  
false -os_mon memsup_system_only true -os_mon  
system_memory_high_watermark 0.95 -mnesia dir "/var/lib/rabbitmq/ 
mnesia/rabbit" -noshell -noinput
If I look at the startup_log it looks like it started fine:

Starting all nodes...
Starting node rabbit at dashboard...
RabbitMQ 1.5.4 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies  
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/
Logging to "/var/log/rabbitmq/rabbit.log"
SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"
starting database ...done
starting core processes ...done
starting recovery ...done
starting persister ...done
starting guid generator ...done
starting builtin applications ...done
starting TCP listeners ...done broker

running startup_err does have this:
Error: cannot_get_pid
It does the same thing if I manually run /etc/initd./rabbitmq-server  
start except it just never returns from the command (ie the process  
doesn't daemonize) Is this normal (my pre 1.5.3 installs on other  
systems didn't have this problem) Or am I forgetting to do something?  
Thanks!

__________________
Robert J Berger - CTO
(Our name has been changed from Cinch to Runa)
520 San Antonio Rd Suite 210, Mountain View, CA 94040
+1 408-838-8896
http://blog.ibd.com / http://www.runa.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090430/efc78c46/attachment.htm 

From tonyg at lshift.net  Fri May  1 13:06:33 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 01 May 2009 13:06:33 +0100
Subject: [rabbitmq-discuss] why isn't my queue durable? (python client)
In-Reply-To: <dbd9700a0904301131r5be0a2d6g289f945761adfbbe@mail.gmail.com>
References: <dbd9700a0904300755y71ec6a81oe5eceb3ee95dcc9e@mail.gmail.com>	
	<49F9CF55.5060603@lshift.net>
	<dbd9700a0904301131r5be0a2d6g289f945761adfbbe@mail.gmail.com>
Message-ID: <49FAE5C9.6020103@lshift.net>

Brian Whitman wrote:
>         m = amqp.Message(whatever, content_type='text/x-json')
>         m.properties["delivery_mode"] = 2

You may also be able to use:

  m = amqp.Message(whatever,
                   content_type='text/x-json',
                   delivery_mode = 2)


Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri May  1 13:07:24 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 01 May 2009 13:07:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
 robustness problem
In-Reply-To: <49FA3F87.1000007@lionet.info>
References: <49F58CFB.8070406@lionet.info> <49F8C1CF.7080405@lshift.net>
	<49F9E177.9060508@lshift.net> <49FA3F87.1000007@lionet.info>
Message-ID: <49FAE5FC.4050105@lshift.net>

Lev Walkin wrote:
> I've already had two power outages in our triple-redundant industrial
> grade colocation in San Jose. How do I disable power outages?

Point taken. My point was that you may wish to reduce avoidable harm.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From alexis.richardson at gmail.com  Fri May  1 15:05:10 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 1 May 2009 15:05:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ talks in London
Message-ID: <167204d20905010705m57a64af4yf4ab50d5dbe8f46b@mail.gmail.com>

Hi

If anyone is around London on May 12th, please come to this:
http://upcoming.yahoo.com/event/2295373/

a



From celldee at gmail.com  Fri May  1 16:22:17 2009
From: celldee at gmail.com (Chris Duncan)
Date: Fri, 1 May 2009 16:22:17 +0100
Subject: [rabbitmq-discuss] [ANN] New release of Bunny synchronous Ruby AMQP
	client
Message-ID: <FFAAA559-35AF-4287-A7B1-7C8B49B7106C@gmail.com>

Bunny v0.2.0 is now available. The highlights are -

* Code has been re-organised
* When instantiating a default exchange (one beginning with ?amq.?)  
the type will be inferred from the name
* Fixed Queue#subscribe and included Queue#unsubscribe method. See  
examples/simple_consumer.rb for details




From vlm at lionet.info  Fri May  1 19:13:12 2009
From: vlm at lionet.info (Lev Walkin)
Date: Fri, 01 May 2009 11:13:12 -0700
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
 robustness problem
In-Reply-To: <49FAE5FC.4050105@lshift.net>
References: <49F58CFB.8070406@lionet.info> <49F8C1CF.7080405@lshift.net>
	<49F9E177.9060508@lshift.net> <49FA3F87.1000007@lionet.info>
	<49FAE5FC.4050105@lshift.net>
Message-ID: <49FB3BB8.60209@lionet.info>

Tony Garnock-Jones wrote:
> Lev Walkin wrote:
>> I've already had two power outages in our triple-redundant industrial
>> grade colocation in San Jose. How do I disable power outages?
> 
> Point taken. My point was that you may wish to reduce avoidable harm.

Speaking of OOM killer, it is not wise to disable OOM on a 
dedicated-to-AMQ system with 16 Gigs of RAM and 4 Gigs of swap.

If AMQP can't cope with about 300k unconfirmed messages on the queue (it 
grows beyond _gigabytes_ when all these unconfirmed messages are "in 
flight" to the destination), you're bound have a hard stop at some point 
anyway.

Better have erlang killed with OOM than box killed because of kernel 
panic, or because sshd is killed (when OOM is disabled just for the beam 
process) and you can never reach your machine again.

-- 
Lev Walkin
vlm at lionet.info



From holger at wizards.de  Fri May  1 19:25:34 2009
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Fri, 01 May 2009 20:25:34 +0200
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
 robustness problem
In-Reply-To: <49FB3BB8.60209@lionet.info>
References: <49F58CFB.8070406@lionet.info>
	<49F8C1CF.7080405@lshift.net>	<49F9E177.9060508@lshift.net>
	<49FA3F87.1000007@lionet.info>	<49FAE5FC.4050105@lshift.net>
	<49FB3BB8.60209@lionet.info>
Message-ID: <49FB3E9E.6040804@wizards.de>

Lev Walkin wrote:
> Speaking of OOM killer, it is not wise to disable OOM on a 
> dedicated-to-AMQ system with 16 Gigs of RAM and 4 Gigs of swap.

Yes.

> Better have erlang killed with OOM than box killed because of kernel 
> panic, or because sshd is killed (when OOM is disabled just for the beam 
> process) and you can never reach your machine again.

echo -17 /proc/<pid of process>/oom_adj will prevent a process from
getting killed. Handle with care. Good for Postgres.

One may (or may not) also want to set vm.oom_kill_allocating_task = 1 in
/etc/sysctl.conf; see
http://www.mail-archive.com/mm-commits at vger.kernel.org/msg25237.html for
what it does.

-h



From rberger at ibd.com  Sat May  2 00:59:27 2009
From: rberger at ibd.com (Robert J Berger)
Date: Fri, 1 May 2009 16:59:27 -0700 (PDT)
Subject: [rabbitmq-discuss] apt-get install rabbitmq-server for 1.5.4
 fails even though it succeeds (/etc/init.d/rabbitmq start doesn't
 daemonize)
In-Reply-To: <4FFF2D4B-CFEB-496C-87ED-4033497CC1AC@ibd.com>
References: <4FFF2D4B-CFEB-496C-87ED-4033497CC1AC@ibd.com>
Message-ID: <23341620.post@talk.nabble.com>


Well, it looks like the problem might have been due to delays in dns
propagation (I had created the dns entries right before trying this and had
several other issues of things not working in a similar fashion). 

In any case it worked fine the next morning after the DNS entries had
stabilized. 



Robert J Berger wrote:
> 
> On a fresh install of rabbitmq-server 1.5.4 on ubuntu 8.10 server the  
> install fails after trying to start rabbitmq-server. It looks like  
> when the install finishes installing and then trys to do an /etc/ 
> init.d/rabbitmq-server start, the process starts ok, but it doesn't  
> daemonize. Eventually the install times out and says it fails:
> 
> ...
> Starting rabbitmq-server:
> [... long wait... ]
> FAILED - check /var/log/rabbitmq/startup_log, _err
> rabbitmq-server.
> invoke-rc.d: initscript rabbitmq-server, action "start" failed.
> dpkg: error processing rabbitmq-server (--configure):
> subprocess post-installation script returned error exit status 1
> ...
> ps shows that it is running:
> 
> 29782 ?        Ssl    0:00 /usr/lib/erlang/erts-5.5.5/bin/beam -W w -K  
> true -A30 -- -root /usr/lib/erlang -progname erl -- -home /var/lib/ 
> rabbitmq -pa /usr/lib/rabbitmq/bin/../ebin -noshell -noinput -s rabbit  
> -sname rabbit -boot start_sasl -kernel inet_default_listen_options  
> [{nodelay,true},{sndbuf,16384},{recbuf,4096}] -kernel  
> inet_default_connect_options [{nodelay,true}] -rabbit tcp_listeners  
> [{"0.0.0.0", 5672}] -sasl errlog_type error -kernel error_logger  
> {file,"/var/log/rabbitmq/rabbit.log"} -sasl sasl_error_logger {file,"/ 
> var/log/rabbitmq/rabbit-sasl.log"} -os_mon start_cpu_sup true -os_mon  
> start_disksup false -os_mon start_memsup false -os_mon start_os_sup  
> false -os_mon memsup_system_only true -os_mon  
> system_memory_high_watermark 0.95 -mnesia dir "/var/lib/rabbitmq/ 
> mnesia/rabbit" -noshell -noinput
> If I look at the startup_log it looks like it started fine:
> 
> Starting all nodes...
> Starting node rabbit at dashboard...
> RabbitMQ 1.5.4 (AMQP 8-0)
> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies  
> LLC., and Rabbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
> Logging to "/var/log/rabbitmq/rabbit.log"
> SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"
> starting database ...done
> starting core processes ...done
> starting recovery ...done
> starting persister ...done
> starting guid generator ...done
> starting builtin applications ...done
> starting TCP listeners ...done broker
> 
> running startup_err does have this:
> Error: cannot_get_pid
> It does the same thing if I manually run /etc/initd./rabbitmq-server  
> start except it just never returns from the command (ie the process  
> doesn't daemonize) Is this normal (my pre 1.5.3 installs on other  
> systems didn't have this problem) Or am I forgetting to do something?  
> Thanks!
> 
> __________________
> Robert J Berger - CTO
> (Our name has been changed from Cinch to Runa)
> 520 San Antonio Rd Suite 210, Mountain View, CA 94040
> +1 408-838-8896
> http://blog.ibd.com / http://www.runa.com
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://www.nabble.com/apt-get-install-rabbitmq-server-for-1.5.4-fails-even-though-it-succeeds-%28-etc-init.d-rabbitmq-start-doesn%27t-daemonize%29-tp23327995p23341620.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From nyx at nyx.cz  Mon May  4 18:08:27 2009
From: nyx at nyx.cz (Marek Janda)
Date: Mon, 4 May 2009 19:08:27 +0200
Subject: [rabbitmq-discuss] direct exchanges / routing key necessary?
Message-ID: <200905041908.27634.nyx@nyx.cz>

Hello,
I just need to confirm one thing.

If I send some message to direct exchange, is there any way to bind queue to 
it that you'll get the message even without knowing it's routing key? I want 
to use RK as a "password" so that every user can subscribe only to messages 
addressed to him - so I need to know if there isn't some way to create 
wildcard match and subscribe to all messages.

After reading documentation, searching the web and looking into source (well, 
I've seen Erlang for the first time in my life), I think it should require the 
key, but I'd like to be 100% sure I didn't miss anything.

Also, is it ok to send everything to one exchange or should I create more 
exchanges and divide users between them? From the performance POV.

Thank you

-- 
S pozdravem
Marek Janda



From alexis.richardson at gmail.com  Mon May  4 19:29:26 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 4 May 2009 19:29:26 +0100
Subject: [rabbitmq-discuss] direct exchanges / routing key necessary?
In-Reply-To: <200905041908.27634.nyx@nyx.cz>
References: <200905041908.27634.nyx@nyx.cz>
Message-ID: <167204d20905041129y6116407cwab9bd5bda1e171da@mail.gmail.com>

Marek,

On Mon, May 4, 2009 at 6:08 PM, Marek Janda <nyx at nyx.cz> wrote:
> Hello,
> I just need to confirm one thing.
>
> If I send some message to direct exchange, is there any way to bind queue to
> it that you'll get the message even without knowing it's routing key? I want
> to use RK as a "password" so that every user can subscribe only to messages
> addressed to him - so I need to know if there isn't some way to create
> wildcard match and subscribe to all messages.

As I recall there are no wildcards with direct exchanges.

Wildcards are appropriate for topic exchanges where they are explicit
(*, #), and fanout exchanges where they are implicit since fanout
implement full broadcast to all bound queues.

However, note that with direct exchanges there is nothing in the spec
to prevent someone who knows the password binding to a given exchange
once they know the key.  So if I know your password then I can see a
copy of your messages, as well as mine.  And vice versa.

You may want to look at ACLs in RabbitMQ:
http://www.nabble.com/ACLs-td21615692.html  Users who do not have
permission to manage their own bindings, and who can only send and
receive messages, will not be able to add bindings and hence
compromise your scheme.  I think but am not 100% that this is possible
with how RabbitMQ currently implements ACLs.


> After reading documentation, searching the web and looking into source (well,
> I've seen Erlang for the first time in my life), I think it should require the
> key, but I'd like to be 100% sure I didn't miss anything.

:-)

I am hopeful that one of the RabbitMQ engineers will substantiate or
correct my comments above with some detail.  It's a holiday weekend
here in the UK so this may not happen instantly.


> Also, is it ok to send everything to one exchange or should I create more
> exchanges and divide users between them? From the performance POV.

In the case of RabbitMQ that's somewhat moot and depends on the
details of your use case.  Fanout exchanges are computationally
cheaper than direct, since there is one fewer lookup step, and topic
exchanges are more complex than direct.  But there may be other
factors to consider.

If you wanted to implement the twitter follower pattern for example,
you could EITHER use one direct exchange (bind to the exchange with
the key of the person you follow), OR have one fanout exchange per
user (bind to the exchange of anyone you follow).  Happy to explain
more if you like...

alexis





> Thank you
>
> --
> S pozdravem
> Marek Janda
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From nyx at nyx.cz  Mon May  4 20:33:56 2009
From: nyx at nyx.cz (Marek Janda)
Date: Mon, 4 May 2009 21:33:56 +0200
Subject: [rabbitmq-discuss] direct exchanges / routing key necessary?
In-Reply-To: <167204d20905041129y6116407cwab9bd5bda1e171da@mail.gmail.com>
References: <200905041908.27634.nyx@nyx.cz>
	<167204d20905041129y6116407cwab9bd5bda1e171da@mail.gmail.com>
Message-ID: <200905042133.56743.nyx@nyx.cz>

Thank you

In my case, RK is generated from username and session, so it changes for every 
login.

I'm using Orbited to implement Comet (sending events from server to browser) 
and I'm dealing with possibility (well...certainity) that some users will open 
multiple browser tabs and I'll need to send the message to all of them.

So I have to create uniquely named queue for every browser tab/connection and 
bind them all to exchange with the same RK. If I use the same queue for all 
tabs, message will be sent only to one of them.

Possible attacker could:
1) guess RK, create new queue and bind it to exchange with that RK
2) guess name of existing queue and subscribe to it - unlikely, as queues are 
quite short-lived - after user leaves page, current queue is destroyed and new 
is created on next page (messages send in between are handled outside MQ)

If attacker could sniff their RK, they could as well read all their messages 
anyway, so I don't see those two options as real danger.

So unless there is some option 3) that would allow attacker to consume from 
exchange without knowing RKs, I think I'm safe.

There may be other possibilities - like dropping whole exchange and creating 
it with different type - I'm using default amq.direct, so I'm not even sure 
it's possible - have to try.

Other ideas are welcome of course.

// Users themselves don't publish anything to MQ...they just send ajax request 
to server and messages are published from server, so users don't need to know 
other user's RK.

On Monday 04 May 2009, Alexis Richardson wrote:
> Marek,
>
> On Mon, May 4, 2009 at 6:08 PM, Marek Janda <nyx at nyx.cz> wrote:
> > Hello,
> > I just need to confirm one thing.
> >
> > If I send some message to direct exchange, is there any way to bind queue
> > to it that you'll get the message even without knowing it's routing key?
> > I want to use RK as a "password" so that every user can subscribe only to
> > messages addressed to him - so I need to know if there isn't some way to
> > create wildcard match and subscribe to all messages.
>
> As I recall there are no wildcards with direct exchanges.
>
> Wildcards are appropriate for topic exchanges where they are explicit
> (*, #), and fanout exchanges where they are implicit since fanout
> implement full broadcast to all bound queues.
>
> However, note that with direct exchanges there is nothing in the spec
> to prevent someone who knows the password binding to a given exchange
> once they know the key.  So if I know your password then I can see a
> copy of your messages, as well as mine.  And vice versa.
> 
> You may want to look at ACLs in RabbitMQ:
> http://www.nabble.com/ACLs-td21615692.html  Users who do not have
> permission to manage their own bindings, and who can only send and
> receive messages, will not be able to add bindings and hence
> compromise your scheme.  I think but am not 100% that this is possible
> with how RabbitMQ currently implements ACLs.
>
> > After reading documentation, searching the web and looking into source
> > (well, I've seen Erlang for the first time in my life), I think it should
> > require the key, but I'd like to be 100% sure I didn't miss anything.
> >
> :-)
>
> I am hopeful that one of the RabbitMQ engineers will substantiate or
> correct my comments above with some detail.  It's a holiday weekend
> here in the UK so this may not happen instantly.
>
> > Also, is it ok to send everything to one exchange or should I create more
> > exchanges and divide users between them? From the performance POV.
>
> In the case of RabbitMQ that's somewhat moot and depends on the
> details of your use case.  Fanout exchanges are computationally
> cheaper than direct, since there is one fewer lookup step, and topic
> exchanges are more complex than direct.  But there may be other
> factors to consider.
>
> If you wanted to implement the twitter follower pattern for example,
> you could EITHER use one direct exchange (bind to the exchange with
> the key of the person you follow), OR have one fanout exchange per
> user (bind to the exchange of anyone you follow).  Happy to explain
> more if you like...
>
> alexis
>
> > Thank you
> >
> > --
> > S pozdravem
> > Marek Janda
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
S pozdravem
Marek Janda
email:      nyx at nyx.cz
GnuPG:      http://nyx.nyx.cz/files/nyx.gpg



From matthias at lshift.net  Mon May  4 20:45:03 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 04 May 2009 20:45:03 +0100
Subject: [rabbitmq-discuss] direct exchanges / routing key necessary?
In-Reply-To: <167204d20905041129y6116407cwab9bd5bda1e171da@mail.gmail.com>
References: <200905041908.27634.nyx@nyx.cz>
	<167204d20905041129y6116407cwab9bd5bda1e171da@mail.gmail.com>
Message-ID: <49FF45BF.9090306@lshift.net>

Marek, Alexis,

Alexis Richardson wrote:
> You may want to look at ACLs in RabbitMQ:
> http://www.nabble.com/ACLs-td21615692.html  Users who do not have
> permission to manage their own bindings, and who can only send and
> receive messages, will not be able to add bindings and hence
> compromise your scheme.  I think but am not 100% that this is possible
> with how RabbitMQ currently implements ACLs.

ACLs can indeed do this, though the above approach requires that the 
queues and bindings must be created by a "superuser", which may or may 
not fit the use case here.

NB: The implementation of ACLs has not made it into an official release 
yet, and it is slightly different than what is documented in the above link.


Regards,

Matthias.



From clemesha at gmail.com  Mon May  4 21:13:12 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Mon, 4 May 2009 13:13:12 -0700
Subject: [rabbitmq-discuss] direct exchanges / routing key necessary?
In-Reply-To: <200905042133.56743.nyx@nyx.cz>
References: <200905041908.27634.nyx@nyx.cz>
	<167204d20905041129y6116407cwab9bd5bda1e171da@mail.gmail.com>
	<200905042133.56743.nyx@nyx.cz>
Message-ID: <d272f0690905041313x34026328uf1f46524deab979c@mail.gmail.com>

On Mon, May 4, 2009 at 12:33 PM, Marek Janda <nyx at nyx.cz> wrote:

> Thank you
>
> In my case, RK is generated from username and session, so it changes for
> every
> login.
>
> I'm using Orbited to implement Comet (sending events from server to
> browser)
> and I'm dealing with possibility (well...certainity) that some users will
> open
> multiple browser tabs and I'll need to send the message to all of them.

Are you working on a project that is open source?  If so, and you'd like to
provide
a link to your project please do.  I'd be interested to see how you get on
with this.


>
>
> So I have to create uniquely named queue for every browser tab/connection
> and
> bind them all to exchange with the same RK. If I use the same queue for all
> tabs, message will be sent only to one of them.

This is slightly off-topic for the RabbitMQ list, but from what I understand
browsers
actually restrict the total number of connections to a given server.  It's
something
like 2 for Firefox, and IE has the same (all per the http 1.1 spec).
Are you solving this in some interesting way like creating multiple
subdomains
(I think facebook does this) ... or some other way?


Anyways, love to hear how you get on tying together Orbited and RabbitMQ.

thanks,
Alex




>
>
> Possible attacker could:
> 1) guess RK, create new queue and bind it to exchange with that RK
> 2) guess name of existing queue and subscribe to it - unlikely, as queues
> are
> quite short-lived - after user leaves page, current queue is destroyed and
> new
> is created on next page (messages send in between are handled outside MQ)
>
> If attacker could sniff their RK, they could as well read all their
> messages
> anyway, so I don't see those two options as real danger.
>
> So unless there is some option 3) that would allow attacker to consume from
> exchange without knowing RKs, I think I'm safe.
>
> There may be other possibilities - like dropping whole exchange and
> creating
> it with different type - I'm using default amq.direct, so I'm not even sure
> it's possible - have to try.
>
> Other ideas are welcome of course.
>
> // Users themselves don't publish anything to MQ...they just send ajax
> request
> to server and messages are published from server, so users don't need to
> know
> other user's RK.
>
> On Monday 04 May 2009, Alexis Richardson wrote:
> > Marek,
> >
> > On Mon, May 4, 2009 at 6:08 PM, Marek Janda <nyx at nyx.cz> wrote:
> > > Hello,
> > > I just need to confirm one thing.
> > >
> > > If I send some message to direct exchange, is there any way to bind
> queue
> > > to it that you'll get the message even without knowing it's routing
> key?
> > > I want to use RK as a "password" so that every user can subscribe only
> to
> > > messages addressed to him - so I need to know if there isn't some way
> to
> > > create wildcard match and subscribe to all messages.
> >
> > As I recall there are no wildcards with direct exchanges.
> >
> > Wildcards are appropriate for topic exchanges where they are explicit
> > (*, #), and fanout exchanges where they are implicit since fanout
> > implement full broadcast to all bound queues.
> >
> > However, note that with direct exchanges there is nothing in the spec
> > to prevent someone who knows the password binding to a given exchange
> > once they know the key.  So if I know your password then I can see a
> > copy of your messages, as well as mine.  And vice versa.
> >
> > You may want to look at ACLs in RabbitMQ:
> > http://www.nabble.com/ACLs-td21615692.html  Users who do not have
> > permission to manage their own bindings, and who can only send and
> > receive messages, will not be able to add bindings and hence
> > compromise your scheme.  I think but am not 100% that this is possible
> > with how RabbitMQ currently implements ACLs.
> >
> > > After reading documentation, searching the web and looking into source
> > > (well, I've seen Erlang for the first time in my life), I think it
> should
> > > require the key, but I'd like to be 100% sure I didn't miss anything.
> > >
> > :-)
> >
> > I am hopeful that one of the RabbitMQ engineers will substantiate or
> > correct my comments above with some detail.  It's a holiday weekend
> > here in the UK so this may not happen instantly.
> >
> > > Also, is it ok to send everything to one exchange or should I create
> more
> > > exchanges and divide users between them? From the performance POV.
> >
> > In the case of RabbitMQ that's somewhat moot and depends on the
> > details of your use case.  Fanout exchanges are computationally
> > cheaper than direct, since there is one fewer lookup step, and topic
> > exchanges are more complex than direct.  But there may be other
> > factors to consider.
> >
> > If you wanted to implement the twitter follower pattern for example,
> > you could EITHER use one direct exchange (bind to the exchange with
> > the key of the person you follow), OR have one fanout exchange per
> > user (bind to the exchange of anyone you follow).  Happy to explain
> > more if you like...
> >
> > alexis
> >
> > > Thank you
> > >
> > > --
> > > S pozdravem
> > > Marek Janda
> > >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> --
> S pozdravem
> Marek Janda
> email:      nyx at nyx.cz
> GnuPG:      http://nyx.nyx.cz/files/nyx.gpg
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alex Clemesha
clemesha.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090504/a5bfd3bf/attachment.htm 

From theczintheroc2007 at gmail.com  Mon May  4 23:40:32 2009
From: theczintheroc2007 at gmail.com (Colin Z)
Date: Mon, 4 May 2009 18:40:32 -0400
Subject: [rabbitmq-discuss] Managing and unknown number of responses
Message-ID: <ce47f6b80905041540i384cfaf8vbf44eecb4f3238f0@mail.gmail.com>

This may be an issue with asynchronous or message-passing based programming
in general...I hope someone can help out...

Basically, I want to send out a query in the form of an AMQ message and
receive back responses from an unknown and possibly large number of
responders.

As an example, let's say we're doing some game logic and we want to figure
out if an action should succeed or not.

My idea was to publish a message to a topic exchange with a routing key like
"magic.success.<characterName>" and then collect all the responses from all
the subscribed subsystems and use their responses to decide if the action
succeeded or not. It's almost like a map-reduce I guess.

It seems like I would either need to set a timeout after which I stop
waiting for responses (seems wasteful and possibly non-deterministic if some
logic takes unusually long to run)

or I somehow need to know in advance how many consumers there are, OR I need
to know how many queues my initial message got delivered to.

Has anyone dealt with something like this before?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090504/749ca256/attachment.htm 

From njbartlett at gmail.com  Tue May  5 00:06:35 2009
From: njbartlett at gmail.com (Neil Bartlett)
Date: Tue, 5 May 2009 00:06:35 +0100
Subject: [rabbitmq-discuss] Managing and unknown number of responses
In-Reply-To: <ce47f6b80905041540i384cfaf8vbf44eecb4f3238f0@mail.gmail.com>
References: <ce47f6b80905041540i384cfaf8vbf44eecb4f3238f0@mail.gmail.com>
Message-ID: <bb4674270905041606y302fd67aj10f97738b772c197@mail.gmail.com>

You cannot really know how many consumers there will be. You might
think you know, but some might crash or do something funky and as a
result you will get fewer responses than you expect. If you wait until
all the consumers respond, then you may wait forever for the last
couple of responses that never arrive.

What you're trying to do is reach consensus on the value of a binary
variable. That's very hard to do in in absolute terms, instead you
have to think about probability. And, yes, non-determinism too...
sorry! Rather than always waiting a fixed period of time, you could
assume the value is true once a certain number of consumers have
responded, but you would still need a timeout in case that level of
confidence cannot be not reached in a reasonable time.

Neil


On Mon, May 4, 2009 at 11:40 PM, Colin Z <theczintheroc2007 at gmail.com> wrote:
> This may be an issue with asynchronous or message-passing based programming
> in general...I hope someone can help out...
>
> Basically, I want to send out a query in the form of an AMQ message and
> receive back responses from an unknown and possibly large number of
> responders.
>
> As an example, let's say we're doing some game logic and we want to figure
> out if an action should succeed or not.
>
> My idea was to publish a message to a topic exchange with a routing key like
> "magic.success.<characterName>" and then collect all the responses from all
> the subscribed subsystems and use their responses to decide if the action
> succeeded or not. It's almost like a map-reduce I guess.
>
> It seems like I would either need to set a timeout after which I stop
> waiting for responses (seems wasteful and possibly non-deterministic if some
> logic takes unusually long to run)
>
> or I somehow need to know in advance how many consumers there are, OR I need
> to know how many queues my initial message got delivered to.
>
> Has anyone dealt with something like this before?
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From icambron at gmail.com  Tue May  5 01:45:57 2009
From: icambron at gmail.com (Isaac Cambron)
Date: Mon, 4 May 2009 20:45:57 -0400
Subject: [rabbitmq-discuss] .net client exception
Message-ID: <42fa2da60905041745v6300074ble2dfb68a73ac7b56@mail.gmail.com>

Hi,

I have a messaging application that runs fine on my local machine (Windows
Server 2008, .net 3.5) but blows up on my production machine (a VM, Windows
Server 2003, .net 3.5). They're using the same broker. Here's the error:

Unhandled Exception: RabbitMQ.Client.Exceptions.AlreadyClosedException: The
AMQP operation was interrupted: AMQP close-reason, initiated by Library,
code=0, text="End of stream", classId=0, methodId=0,
cause=System.IO.EndOfStreamException:
Heartbeat missing with heartbeat == 3 seconds
   at RabbitMQ.Client.Impl.SessionBase.Transmit(Command cmd)
   at RabbitMQ.Client.Impl.ModelBase.ModelSend(MethodBase method,
ContentHeaderBase header, Byte[] body)
   at RabbitMQ.Client.Framing.Impl.v0_8.Model._Private_BasicPublish(String
exchange, String routingKey, Boolean mandatory, Boolean immediate,
IBasicProperties basicProperties, Byte[] body)
   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String
routingKey, Boolean mandatory, Boolean immediate, IBasicProperties
basicProperties, Byte[] body)
   at RabbitMQ.Client.Impl.ModelBase.BasicPublish(String exchange, String
routingKey, IBasicProperties basicProperties, Byte[] body)

And below that, my code starts. Searching around the net, I saw there are
similar issues with certain versions of Mono, but this is Windows. I also
can't find any differences between the two environments except operating
system version. Is this a known issue? What does it really mean? Where
should I start looking?

Thanks a ton,
Isaac
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090504/90728081/attachment.htm 

From bradford.n.cross at gmail.com  Tue May  5 03:28:37 2009
From: bradford.n.cross at gmail.com (bradford cross)
Date: Mon, 4 May 2009 19:28:37 -0700
Subject: [rabbitmq-discuss] Multicasting
Message-ID: <ea7d6a710905041928y1ebc6555pe5a41d82288ac71c@mail.gmail.com>

I would like to do redundant one-to-many multicasting from the java AMQP
client.  Well, actually, I am not sure if the word redundant is the proper
terminology or if I really need to do multicasting at all.

My requirement is to have two parallel (forked, or whatever) queues, one of
which the regular production process listens to, and one of which a backup
process listens to.

Rabbitmq seems to call this sort of thing one-to-many broadcasting and
multicast.  There is not a lot of documentation about it, just a blurb
here<http://www.rabbitmq.com/faq.html#scenarios>and then the code here
->
rabbitmq-java-client-1.5.4/test/src/com/rabbitmq/examples/MulticastMain.java

Looking at a snippet from the multicast code below, it is clear that each
producer and consumer runs on its own thread, on its own connection, on its
own channel, and each consumer creates its own queue.  But they all use one
exchange name, one ID, and one address (host and port.)  Is it solely these
last elements and what is happening in channel.queueBind that make this
multicast?  What exactly makes it multicasting?

Lastly, am I even headed in the right direction for what I want to do?  It
appears that I would ahve to manually write the code the puts a message into
two duplicate queues to achieve the queue for the backup.

What else is different about this multicasting and the two independent
queues in  the clojure example code below:



Clojure, two independent queues:

(defn two-independent-queues []
  (with-open [connection (let [params (doto (ConnectionParameters.)
                                        (.setVirtualHost "/")
                                        (.setUsername "guest")
                                        (.setPassword "guest"))
                               factory (ConnectionFactory. params)]
                           (.newConnection factory "localhost"))
              channel (.createChannel connection)
              channel2 (.createChannel connection)]
    (let [queue-name (random-id)
          queue-name2 (random-id)
          consumer (bootstrap-consumer channel exchangeName "direct"
queue-name id)
      consumer2 (bootstrap-consumer channel2 exchangeName "direct"
queue-name2 id)]
      (publish channel queue-name "hello")
      (publish channel2 queue-name2 "goodbye")
      (str (consume channel queue-name consumer) "  " (consume channel2
queue-name2 consumer2)))))




java, multicast:

 //setup
            String id = UUID.randomUUID().toString();
            Stats stats = new Stats(1000L * samplingInterval);
            Address[] addresses = new Address[] {
                new Address(hostName, portNumber)
            };
            ConnectionParameters params = new ConnectionParameters();
            Thread[] consumerThreads = new Thread[consumerCount];
            Connection[] consumerConnections = new
Connection[consumerCount];
            for (int i = 0; i < consumerCount; i++) {
                System.out.println("starting consumer #" + i);
                Connection conn = new
ConnectionFactory(params).newConnection(addresses, maxRedirects);
                consumerConnections[i] = conn;
                Channel channel = conn.createChannel();
                if (consumerTxSize > 0) channel.txSelect();
                channel.exchangeDeclare(exchangeName, exchangeType);
                Queue.DeclareOk res = channel.queueDeclare();
                String queueName = res.getQueue();
                QueueingConsumer consumer = new QueueingConsumer(channel);
                channel.basicConsume(queueName, autoAck, consumer);
                channel.queueBind(queueName, exchangeName, id);
                Thread t =
                    new Thread(new Consumer(consumer, id,
                                            consumerTxSize, autoAck,
                                            stats, timeLimit));
                consumerThreads[i] = t;
                t.start();
            }
            Thread[] producerThreads = new Thread[producerCount];
            Connection[] producerConnections = new
Connection[producerCount];
            for (int i = 0; i < producerCount; i++) {
                System.out.println("starting producer #" + i);
                Connection conn = new
ConnectionFactory(params).newConnection(addresses, maxRedirects);
                producerConnections[i] = conn;
                Channel channel = conn.createChannel();
                if (producerTxSize > 0) channel.txSelect();
                channel.exchangeDeclare(exchangeName, exchangeType);
                Thread t =
                    new Thread(new Producer(channel, exchangeName, id,
                                            flags, producerTxSize,
                                            1000L * samplingInterval,
                                            rateLimit, minMsgSize,
timeLimit));
                producerThreads[i] = t;
                t.start();
            }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090504/0b5b027c/attachment.htm 

From matthias at lshift.net  Tue May  5 08:37:35 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 05 May 2009 08:37:35 +0100
Subject: [rabbitmq-discuss] millions of unack'd messages in a day
 --	disk store instead of ram?
In-Reply-To: <dbd9700a0904301118v2834c10ap6fc38aba6602c4ad@mail.gmail.com>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>	<167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>	<dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>	<dbd9700a0904300811j687429fen7e3d7051f26caf95@mail.gmail.com>	<20090430152930.GA10551@mrnibble.lshift.net>
	<dbd9700a0904301118v2834c10ap6fc38aba6602c4ad@mail.gmail.com>
Message-ID: <49FFECBF.9030905@lshift.net>

Brian,

Brian Whitman wrote:
> I see this in my startup_err:
> 
> /etc/rabbitmq/rabbitmq.conf: line 1: memory_alarms: command not found
> 
> When I put this in my rabbitmq.conf:
> 
> SERVER_START_ARGS=-rabbit memory_alarms false
> 
> What am I doing wrong there?

You are missing some quotes - it should be

SERVER_START_ARGS="-rabbit memory_alarms false"


Regards,

Matthias.



From matthias at lshift.net  Tue May  5 09:54:52 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 05 May 2009 09:54:52 +0100
Subject: [rabbitmq-discuss] Multicasting
In-Reply-To: <ea7d6a710905041928y1ebc6555pe5a41d82288ac71c@mail.gmail.com>
References: <ea7d6a710905041928y1ebc6555pe5a41d82288ac71c@mail.gmail.com>
Message-ID: <49FFFEDC.5000904@lshift.net>

Bradford,

bradford cross wrote:
> My requirement is to have two parallel (forked, or whatever) queues, one 
> of which the regular production process listens to, and one of which a 
> backup process listens to.
> 
> Rabbitmq seems to call this sort of thing one-to-many broadcasting and 
> multicast.  There is not a lot of documentation about it, just a blurb 
> here <http://www.rabbitmq.com/faq.html#scenarios> and then the code here 
> -> 
> rabbitmq-java-client-1.5.4/test/src/com/rabbitmq/examples/MulticastMain.java

You may want to read
   http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/
which is linked to from
   http://www.rabbitmq.com/how.html

Briefly, to get a message sent to multiple queues, bind those queues to 
an exchange using binding keys that match the message's routing key.

Btw, MulticastMain is a fairly universal test program, so it's not 
exactly a concise example of performing simple multicast routing.


Regards,

Matthias.



From tonyg at lshift.net  Tue May  5 11:40:08 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 05 May 2009 11:40:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
 robustness problem
In-Reply-To: <49FB3BB8.60209@lionet.info>
References: <49F58CFB.8070406@lionet.info> <49F8C1CF.7080405@lshift.net>
	<49F9E177.9060508@lshift.net> <49FA3F87.1000007@lionet.info>
	<49FAE5FC.4050105@lshift.net> <49FB3BB8.60209@lionet.info>
Message-ID: <4A001788.3060400@lshift.net>

Lev Walkin wrote:
> Better have erlang killed with OOM than box killed because of kernel
> panic, or because sshd is killed (when OOM is disabled just for the beam
> process) and you can never reach your machine again.

Perhaps ulimit can be of use here, to control the size of beam
independently of the rest of the system?

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From vlm at lionet.info  Tue May  5 11:43:59 2009
From: vlm at lionet.info (Lev Walkin)
Date: Tue, 05 May 2009 03:43:59 -0700
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
 robustness problem
In-Reply-To: <4A001788.3060400@lshift.net>
References: <49F58CFB.8070406@lionet.info> <49F8C1CF.7080405@lshift.net>
	<49F9E177.9060508@lshift.net> <49FA3F87.1000007@lionet.info>
	<49FAE5FC.4050105@lshift.net> <49FB3BB8.60209@lionet.info>
	<4A001788.3060400@lshift.net>
Message-ID: <4A00186F.1040603@lionet.info>

Tony Garnock-Jones wrote:
> Lev Walkin wrote:
>> Better have erlang killed with OOM than box killed because of kernel
>> panic, or because sshd is killed (when OOM is disabled just for the beam
>> process) and you can never reach your machine again.
> 
> Perhaps ulimit can be of use here, to control the size of beam
> independently of the rest of the system?

This solves sshd killing, but does not solve inability to cope with
broken persister log when beam finally dies due to reaching ulimit.

-- 
Lev Walkin
vlm at lionet.info



From tonyg at lshift.net  Tue May  5 11:48:14 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 05 May 2009 11:48:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
 robustness problem
In-Reply-To: <4A00186F.1040603@lionet.info>
References: <49F58CFB.8070406@lionet.info> <49F8C1CF.7080405@lshift.net>
	<49F9E177.9060508@lshift.net> <49FA3F87.1000007@lionet.info>
	<49FAE5FC.4050105@lshift.net> <49FB3BB8.60209@lionet.info>
	<4A001788.3060400@lshift.net> <4A00186F.1040603@lionet.info>
Message-ID: <4A00196E.6030007@lshift.net>

Lev Walkin wrote:
> This solves sshd killing, but does not solve inability to cope with
> broken persister log when beam finally dies due to reaching ulimit.

You are correct.

-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From matthias at lshift.net  Tue May  5 11:59:47 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 05 May 2009 11:59:47 +0100
Subject: [rabbitmq-discuss] .net client exception
In-Reply-To: <42fa2da60905041745v6300074ble2dfb68a73ac7b56@mail.gmail.com>
References: <42fa2da60905041745v6300074ble2dfb68a73ac7b56@mail.gmail.com>
Message-ID: <4A001C23.3010503@lshift.net>

Isaac,

Isaac Cambron wrote:
> Unhandled Exception: RabbitMQ.Client.Exceptions.AlreadyClosedException: 
> The AMQP operation was interrupted: AMQP close-reason, initiated by 
> Library, code=0, text="End of stream", classId=0, methodId=0, 
> cause=System.IO.EndOfStreamException:
> Heartbeat missing with heartbeat == 3 seconds
>    at RabbitMQ.Client.Impl.SessionBase.Transmit(Command cmd)
> [...]
> Searching around the net, I saw there are similar issues with certain
> versions of Mono, but this is Windows. I also can't find any
> differences between the two environments except operating system
> version. Is this a known issue? What does it really mean? Where
> should I start looking?

There was a problem with heartbeats in the .net client that people 
reported ~1 year ago. But we fixed that in the 1.5.0 release. What 
version of the client are you running?

You could try disabling heartbeating, by setting 
ConnectionParameters.RequestedHeartbeat to zero (0) on your
ConnectionFactory before calling CreateConnection.

Could you write a little standalone program that exhibits the problem 
and send it to us?

Also, getting a trace of the traffic with our capture tool - 
http://www.rabbitmq.com/examples.html#tracer - would be useful, though 
it does require Java.


Regards,

Matthias.



From Rajesh_Reddy at ml.com  Tue May  5 16:02:16 2009
From: Rajesh_Reddy at ml.com (Reddy, Rajesh (GPT EMEA))
Date: Tue, 5 May 2009 16:02:16 +0100
Subject: [rabbitmq-discuss] How do I inspect the queue
Message-ID: <03FC0D29D4E88943AB7420C524BE8489027C37D3@mllnc20mb056.emea.win.ml.com>

Hi

Iam using the RabbitMQ client for .NET . I have created a non durable
and autodelete queue. When is the queue autodeleted and also how do I
inspect a queue instance after declaring it.

Thanks
Rajesh

--------------------------------------------------------------------------
This message w/attachments (message) may be privileged, confidential or proprietary, and if you are not an intended recipient, please notify the sender, do not use or share it and delete it. Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Merrill Lynch. Subject to applicable law, Merrill Lynch may monitor, review and retain e-communications (EC) traveling through its networks/systems. The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or error-free. References to "Merrill Lynch" are references to any company in the Merrill Lynch & Co., Inc. group of companies, which are wholly-owned by Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Attachments that are part of this E-communication may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: http://www.ml.com/e-communications_terms/. By messaging with Merrill Lynch you consent to the foregoing.
--------------------------------------------------------------------------
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090505/9f4590e9/attachment.htm 

From tonyg at lshift.net  Tue May  5 16:52:00 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 05 May 2009 16:52:00 +0100
Subject: [rabbitmq-discuss] How do I inspect the queue
In-Reply-To: <03FC0D29D4E88943AB7420C524BE8489027C37D3@mllnc20mb056.emea.win.ml.com>
References: <03FC0D29D4E88943AB7420C524BE8489027C37D3@mllnc20mb056.emea.win.ml.com>
Message-ID: <4A0060A0.1080101@lshift.net>

Hi,

Reddy, Rajesh (GPT EMEA) wrote:
> Iam using the RabbitMQ client for .NET . I have created a non durable
> and autodelete queue. When is the queue autodeleted and also how do I
> inspect a queue instance after declaring it.

Autodelete queues disappear once the last consumer consuming from them
is closed. (If no consumers are ever created on the queue, it won't be
deleted automatically, IIRC.) Since consumers are scoped to the lifetime
of a channel, which in turn is scoped to the lifetime of a TCP/IP
connection, then if you

 - connect
 - open a channel
 - create your autodelete queue
 - basic.consume from it
 - handle deliveries for a while
 - drop the connection, either cleanly or as the result of an error

then the queue will end up deleted.

Regarding inspection of the queue, what kinds of things are you
interested in? You might try "rabbitmqctl list_queues", and see if any
of the available info items meet your needs.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From Rajesh_Reddy at ml.com  Tue May  5 17:02:41 2009
From: Rajesh_Reddy at ml.com (Reddy, Rajesh (GPT EMEA))
Date: Tue, 5 May 2009 17:02:41 +0100
Subject: [rabbitmq-discuss] How do I inspect the queue
In-Reply-To: <4A0060A0.1080101@lshift.net>
Message-ID: <03FC0D29D4E88943AB7420C524BE8489027C37D4@mllnc20mb056.emea.win.ml.com>

Hi Tony,

Thanks a lot for your reply.

Yes iam following the same steps as mentioned by you below. In my case I
have a call back which is waiting on this queue.
Now whenever a message arrives on the queue I get the callback called.

As I was debugging some issue the queue was deleted even though the
connection is still active and I was no longer receiving any call back(
as the queue no longer exists).

Do you see any reason why the queue was deleted and the connection still
active. 

Also, regarding the Queue inspection . I meant how do I check in my
client if the queue exists.

Thanks
Rajesh

-----Original Message-----
From: Tony Garnock-Jones [mailto:tonyg at lshift.net] 
Sent: 05 May 2009 16:52
To: Reddy, Rajesh (GPT EMEA)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] How do I inspect the queue


Hi,

Reddy, Rajesh (GPT EMEA) wrote:
> Iam using the RabbitMQ client for .NET . I have created a non durable
> and autodelete queue. When is the queue autodeleted and also how do I
> inspect a queue instance after declaring it.

Autodelete queues disappear once the last consumer consuming from them
is closed. (If no consumers are ever created on the queue, it won't be
deleted automatically, IIRC.) Since consumers are scoped to the lifetime
of a channel, which in turn is scoped to the lifetime of a TCP/IP
connection, then if you

 - connect
 - open a channel
 - create your autodelete queue
 - basic.consume from it
 - handle deliveries for a while
 - drop the connection, either cleanly or as the result of an error

then the queue will end up deleted.

Regarding inspection of the queue, what kinds of things are you
interested in? You might try "rabbitmqctl list_queues", and see if any
of the available info items meet your needs.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net

--------------------------------------------------------------------------
This message w/attachments (message) may be privileged, confidential or proprietary, and if you are not an intended recipient, please notify the sender, do not use or share it and delete it. Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Merrill Lynch. Subject to applicable law, Merrill Lynch may monitor, review and retain e-communications (EC) traveling through its networks/systems. The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or error-free. References to "Merrill Lynch" are references to any company in the Merrill Lynch & Co., Inc. group of companies, which are wholly-owned by Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Attachments that are part of this E-communication may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: http://www.ml.com/e-communications_terms/. By messaging with Merrill Lynch you consent to the foregoing.
--------------------------------------------------------------------------
 



From tonyg at lshift.net  Tue May  5 17:11:51 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 05 May 2009 17:11:51 +0100
Subject: [rabbitmq-discuss] How do I inspect the queue
In-Reply-To: <03FC0D29D4E88943AB7420C524BE8489027C37D4@mllnc20mb056.emea.win.ml.com>
References: <03FC0D29D4E88943AB7420C524BE8489027C37D4@mllnc20mb056.emea.win.ml.com>
Message-ID: <4A006547.10606@lshift.net>

Reddy, Rajesh (GPT EMEA) wrote:
> As I was debugging some issue the queue was deleted even though the
> connection is still active and I was no longer receiving any call back(
> as the queue no longer exists).

Could it be that the pauses caused by the debugger in turn caused the
heartbeat mechanism to fire, terminating the connection at the server-side?

> Also, regarding the Queue inspection . I meant how do I check in my
> client if the queue exists.

You can do a passive declare; though this will cause the channel to
close if the queue does not exist. Alternatively, you may not need to
check: queue.declare is idempotent, and you can simply issue the
queue.declare again if you are in doubt.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From bradford.n.cross at gmail.com  Tue May  5 20:03:56 2009
From: bradford.n.cross at gmail.com (bradford cross)
Date: Tue, 5 May 2009 12:03:56 -0700
Subject: [rabbitmq-discuss] Multicasting
In-Reply-To: <49FFFEDC.5000904@lshift.net>
References: <ea7d6a710905041928y1ebc6555pe5a41d82288ac71c@mail.gmail.com>
	<49FFFEDC.5000904@lshift.net>
Message-ID: <ea7d6a710905051203l12c58bfeq50dbc60f14708cbf@mail.gmail.com>

Excellent, I got it working, thank you!

On Tue, May 5, 2009 at 1:54 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Bradford,
>
> bradford cross wrote:
>
>> My requirement is to have two parallel (forked, or whatever) queues, one
>> of which the regular production process listens to, and one of which a
>> backup process listens to.
>>
>> Rabbitmq seems to call this sort of thing one-to-many broadcasting and
>> multicast.  There is not a lot of documentation about it, just a blurb here
>> <http://www.rabbitmq.com/faq.html#scenarios> and then the code here ->
>> rabbitmq-java-client-1.5.4/test/src/com/rabbitmq/examples/MulticastMain.java
>>
>
> You may want to read
>  http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/
> which is linked to from
>  http://www.rabbitmq.com/how.html
>
> Briefly, to get a message sent to multiple queues, bind those queues to an
> exchange using binding keys that match the message's routing key.
>
> Btw, MulticastMain is a fairly universal test program, so it's not exactly
> a concise example of performing simple multicast routing.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090505/8d6d3d83/attachment.htm 

From bradford.n.cross at gmail.com  Tue May  5 22:27:59 2009
From: bradford.n.cross at gmail.com (bradford cross)
Date: Tue, 5 May 2009 14:27:59 -0700
Subject: [rabbitmq-discuss] Multicasting
In-Reply-To: <ea7d6a710905051203l12c58bfeq50dbc60f14708cbf@mail.gmail.com>
References: <ea7d6a710905041928y1ebc6555pe5a41d82288ac71c@mail.gmail.com>
	<49FFFEDC.5000904@lshift.net>
	<ea7d6a710905051203l12c58bfeq50dbc60f14708cbf@mail.gmail.com>
Message-ID: <ea7d6a710905051427j6f390263r8bee939a340bb0fc@mail.gmail.com>

BTW: I wrote notes while getting multicast working and blogged about  it:
http://bradfordcross.blogspot.com/2009/05/multicast-rabbitmq-from-clojure.html

On Tue, May 5, 2009 at 12:03 PM, bradford cross
<bradford.n.cross at gmail.com>wrote:

> Excellent, I got it working, thank you!
>
>
> On Tue, May 5, 2009 at 1:54 AM, Matthias Radestock <matthias at lshift.net>wrote:
>
>> Bradford,
>>
>> bradford cross wrote:
>>
>>> My requirement is to have two parallel (forked, or whatever) queues, one
>>> of which the regular production process listens to, and one of which a
>>> backup process listens to.
>>>
>>> Rabbitmq seems to call this sort of thing one-to-many broadcasting and
>>> multicast.  There is not a lot of documentation about it, just a blurb here
>>> <http://www.rabbitmq.com/faq.html#scenarios> and then the code here ->
>>> rabbitmq-java-client-1.5.4/test/src/com/rabbitmq/examples/MulticastMain.java
>>>
>>
>> You may want to read
>>  http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/
>> which is linked to from
>>  http://www.rabbitmq.com/how.html
>>
>> Briefly, to get a message sent to multiple queues, bind those queues to an
>> exchange using binding keys that match the message's routing key.
>>
>> Btw, MulticastMain is a fairly universal test program, so it's not exactly
>> a concise example of performing simple multicast routing.
>>
>>
>> Regards,
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090505/455a5c14/attachment.htm 

From bradford.n.cross at gmail.com  Tue May  5 22:30:22 2009
From: bradford.n.cross at gmail.com (bradford cross)
Date: Tue, 5 May 2009 14:30:22 -0700
Subject: [rabbitmq-discuss] Multicasting
In-Reply-To: <ea7d6a710905051427j6f390263r8bee939a340bb0fc@mail.gmail.com>
References: <ea7d6a710905041928y1ebc6555pe5a41d82288ac71c@mail.gmail.com>
	<49FFFEDC.5000904@lshift.net>
	<ea7d6a710905051203l12c58bfeq50dbc60f14708cbf@mail.gmail.com>
	<ea7d6a710905051427j6f390263r8bee939a340bb0fc@mail.gmail.com>
Message-ID: <ea7d6a710905051430u30692f56rf944134d5c67acd@mail.gmail.com>

BTW, I used the binding/routing key approach for this example.  What would
be different about the code if I were to use the fan out exchange?

On Tue, May 5, 2009 at 2:27 PM, bradford cross
<bradford.n.cross at gmail.com>wrote:

> BTW: I wrote notes while getting multicast working and blogged about  it:
> http://bradfordcross.blogspot.com/2009/05/multicast-rabbitmq-from-clojure.html
>
>
> On Tue, May 5, 2009 at 12:03 PM, bradford cross <
> bradford.n.cross at gmail.com> wrote:
>
>> Excellent, I got it working, thank you!
>>
>>
>> On Tue, May 5, 2009 at 1:54 AM, Matthias Radestock <matthias at lshift.net>wrote:
>>
>>> Bradford,
>>>
>>> bradford cross wrote:
>>>
>>>> My requirement is to have two parallel (forked, or whatever) queues, one
>>>> of which the regular production process listens to, and one of which a
>>>> backup process listens to.
>>>>
>>>> Rabbitmq seems to call this sort of thing one-to-many broadcasting and
>>>> multicast.  There is not a lot of documentation about it, just a blurb here
>>>> <http://www.rabbitmq.com/faq.html#scenarios> and then the code here ->
>>>> rabbitmq-java-client-1.5.4/test/src/com/rabbitmq/examples/MulticastMain.java
>>>>
>>>
>>> You may want to read
>>>  http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/
>>> which is linked to from
>>>  http://www.rabbitmq.com/how.html
>>>
>>> Briefly, to get a message sent to multiple queues, bind those queues to
>>> an exchange using binding keys that match the message's routing key.
>>>
>>> Btw, MulticastMain is a fairly universal test program, so it's not
>>> exactly a concise example of performing simple multicast routing.
>>>
>>>
>>> Regards,
>>>
>>> Matthias.
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090505/494bd0d9/attachment.htm 

From joe at joetify.com  Wed May  6 00:25:15 2009
From: joe at joetify.com (Joe Williams)
Date: Tue, 05 May 2009 16:25:15 -0700
Subject: [rabbitmq-discuss] exchanges and message processing
Message-ID: <4A00CADB.90900@joetify.com>

This is in relation to a thread I started on the ruby-amqp list:

http://groups.google.com/group/ruby-amqp/browse_thread/thread/6296567fa545ca8d?hl=en


My question is regarding exchanges, queues and dealing with messages 
that I would like to get processed only once. I am sending messages 
containing json and would like to use a field from the json as the 
routing key to alleviate needing to do numerous case statements in my 
code. It seems that fanout and direct exchanges would not work since 
they have possibility of having messages getting processed more than 
once by different consumers. The responder on the ruby-amqp list 
mentioned a shared queue that is in the 091 spec. But this seems to put 
me back at using a long case statement.

In an ideal situation I would have multiple consumers (written without 
epic case statements) and messages that get consumed once and only once.

Any suggestions on how to go about doing something like this?

Thanks.

-Joe

-- 
Name: Joseph A. Williams
Email: joe at joetify.com
Blog: http://www.joeandmotorboat.com/




From matthias at lshift.net  Wed May  6 07:53:35 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 06 May 2009 07:53:35 +0100
Subject: [rabbitmq-discuss] exchanges and message processing
In-Reply-To: <4A00CADB.90900@joetify.com>
References: <4A00CADB.90900@joetify.com>
Message-ID: <4A0133EF.9070400@lshift.net>

Joe,

Joe Williams wrote:
> This is in relation to a thread I started on the ruby-amqp list:
> 
> http://groups.google.com/group/ruby-amqp/browse_thread/thread/6296567fa545ca8d?hl=en
> 
> 
> My question is regarding exchanges, queues and dealing with messages 
> that I would like to get processed only once. I am sending messages 
> containing json and would like to use a field from the json as the 
> routing key to alleviate needing to do numerous case statements in my 
> code. It seems that fanout and direct exchanges would not work since 
> they have possibility of having messages getting processed more than 
> once by different consumers. The responder on the ruby-amqp list 
> mentioned a shared queue that is in the 091 spec. But this seems to put 
> me back at using a long case statement.
> 
> In an ideal situation I would have multiple consumers (written without 
> epic case statements) and messages that get consumed once and only once.
> 
> Any suggestions on how to go about doing something like this?

The role of exchanges is to route messages to queues. They *all* have 
the possibility of resulting in messages getting routed to multiple 
queues and hence processed by multiple consumers - that's what they are 
there for. Whether that actually happens depends on the bindings that 
have been configured.

For your use case, the following setup should work:
- one direct exchange
- one queue for each of the case branches
- one binding per queue to the direct exchange, with the binding key set 
to the case branch discriminator
- one consumer per queue, handling the messages for one particular 
branch discriminator

In this setup messages will get routed to exactly one consumer, based on 
their routing key. You'd only get duplication if you set up additional 
queues and consumers that bound to the direct exchange with the same 
binding keys.

One possible downside of this setup compared to a single queue is that 
message order is not preserved across queues.


Regards,

Matthias.



From kyle at pelago.com  Wed May  6 09:10:30 2009
From: kyle at pelago.com (Kyle Wilkinson)
Date: Wed, 06 May 2009 01:10:30 -0700
Subject: [rabbitmq-discuss] Error running rabbitmq-server on Mac OS X
Message-ID: <C6269406.6F7F6%kyle@pelago.com>

First, I apologize if this issue was covered earlier on the list.  I
searched the last few months of the archives and on Google trying to find a
solution to this problem with no luck.

I'm trying to run the rabbitmq-server on my mac, but I keep on running into
a rather cryptic error:

>>>
computer:rabbitmq kyle$ sudo -H -u rabbitmq rabbitmq-server
{"init terminating in
do_boot",{undef,[{rabbit,start,[]},{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
<<<

The logs in /var/log/rabbitmq are both empty files and I'm unable to
determine anything obvious (to an erlang newbie, at least) from the
erl_crash.dump file.

I installed rabbitmq using MacPorts and the latest stable build linked to
from http://www.rabbitmq.com/install.html#macports.  The installation seemed
to work ok and the the various files and folders for logs, etc. seemed to
all have been created correctly.

Any idea what is going wrong with my install?

Thanks,

Kyle Wilkinson




From Rajesh_Reddy at ml.com  Wed May  6 09:29:08 2009
From: Rajesh_Reddy at ml.com (Reddy, Rajesh (GPT EMEA))
Date: Wed, 6 May 2009 09:29:08 +0100
Subject: [rabbitmq-discuss] How do I inspect the queue
In-Reply-To: <4A006547.10606@lshift.net>
Message-ID: <03FC0D29D4E88943AB7420C524BE8489027C37D5@mllnc20mb056.emea.win.ml.com>

Hi Tony,

It could be a connection thing as it happened only in debug, but when I
checked the connections in server it was fine. So this is a strange
behaviour. Let me see if this happens in release mode.

Also, iam declaring a queue as follows,
Passive = false
Durable = false
Exclusive = true
Autodelete = true
Nowait = true

This would create a non durable and auto delete queue. I can inspect
using rabbitmqctl list_queues, but it only gives me durable and
autodelete and not the other items related to declare queue.
Also, what is exclusive used for.

So there is no way I can find out if my queue is deleted.

I my case the client creates queue just once and then waits on a
callback for any messages on that queue. So if a queue is deleted then
the client will be just sitting there waiting for a message without
knowing that the queue no longer exists.

Thanks
Rajesh

-----Original Message-----
From: Tony Garnock-Jones [mailto:tonyg at lshift.net] 
Sent: 05 May 2009 17:12
To: Reddy, Rajesh (GPT EMEA)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] How do I inspect the queue


Reddy, Rajesh (GPT EMEA) wrote:
> As I was debugging some issue the queue was deleted even though the
> connection is still active and I was no longer receiving any call
back(
> as the queue no longer exists).

Could it be that the pauses caused by the debugger in turn caused the
heartbeat mechanism to fire, terminating the connection at the
server-side?

> Also, regarding the Queue inspection . I meant how do I check in my
> client if the queue exists.

You can do a passive declare; though this will cause the channel to
close if the queue does not exist. Alternatively, you may not need to
check: queue.declare is idempotent, and you can simply issue the
queue.declare again if you are in doubt.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net

--------------------------------------------------------------------------
This message w/attachments (message) may be privileged, confidential or proprietary, and if you are not an intended recipient, please notify the sender, do not use or share it and delete it. Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Merrill Lynch. Subject to applicable law, Merrill Lynch may monitor, review and retain e-communications (EC) traveling through its networks/systems. The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or error-free. References to "Merrill Lynch" are references to any company in the Merrill Lynch & Co., Inc. group of companies, which are wholly-owned by Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Attachments that are part of this E-communication may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: http://www.ml.com/e-communications_terms/. By messaging with Merrill Lynch you consent to the foregoing.
--------------------------------------------------------------------------
 



From matthias at lshift.net  Wed May  6 09:56:16 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 06 May 2009 09:56:16 +0100
Subject: [rabbitmq-discuss] Multicasting
In-Reply-To: <ea7d6a710905051430u30692f56rf944134d5c67acd@mail.gmail.com>
References: <ea7d6a710905041928y1ebc6555pe5a41d82288ac71c@mail.gmail.com>	<49FFFEDC.5000904@lshift.net>	<ea7d6a710905051203l12c58bfeq50dbc60f14708cbf@mail.gmail.com>	<ea7d6a710905051427j6f390263r8bee939a340bb0fc@mail.gmail.com>
	<ea7d6a710905051430u30692f56rf944134d5c67acd@mail.gmail.com>
Message-ID: <4A0150B0.1040304@lshift.net>

Bradford,

bradford cross wrote:
> BTW, I used the binding/routing key approach for this example.  What 
> would be different about the code if I were to use the fan out exchange?

Any set up of a direct exchange and bound queues can be simulated by a 
set of fanout exchanges. Say, for example, that you have the following 
topology:

- one direct exchange
- queue a bound to it with binding key foo
- queue b bound to it with binding keys foo and bar

with the publisher publishing messages to the direct exchange and using 
routing keys foo or bar.

then you could alternatively set up the following:

- two fanout exchanges, called x.foo and x.bar
- queue a bound to x.foo
- queue b bound to x.foo and x.bar

and change the publisher to publish to exchange x.foo or x.bar rather 
than setting a routing key.

The main difference between the two approaches is the way unroutable 
messages are handled. Publishing a message to a direct exchange with a 
routing key that matches no bindings is perfectly fine; the message will 
simply be swallowed (and if you have the mandatory or immediate flags 
set the publisher will receive a basic.return message, indicating that 
routing failed). By contrast, publishing a message to a non-existing 
exchange, e.g. x.baz, results in an error.

There are also differences in how one can control access; RabbitMQ's 
upcoming ACLs operate on per resource (exchange, queue) basis, which 
means the second approach gives you more fine-grained control.


Matthias.



From joe at joetify.com  Wed May  6 17:21:24 2009
From: joe at joetify.com (Joe Williams)
Date: Wed, 06 May 2009 09:21:24 -0700
Subject: [rabbitmq-discuss] exchanges and message processing
In-Reply-To: <4A0133EF.9070400@lshift.net>
References: <4A00CADB.90900@joetify.com> <4A0133EF.9070400@lshift.net>
Message-ID: <4A01B904.5030106@joetify.com>

Thanks Matthias, that makes sense to me. Message order isn't an issue in 
my case so I think it might work well.

-Joe


Matthias Radestock wrote:
> Joe,
>
> Joe Williams wrote:
>> This is in relation to a thread I started on the ruby-amqp list:
>>
>> http://groups.google.com/group/ruby-amqp/browse_thread/thread/6296567fa545ca8d?hl=en 
>>
>>
>>
>> My question is regarding exchanges, queues and dealing with messages 
>> that I would like to get processed only once. I am sending messages 
>> containing json and would like to use a field from the json as the 
>> routing key to alleviate needing to do numerous case statements in my 
>> code. It seems that fanout and direct exchanges would not work since 
>> they have possibility of having messages getting processed more than 
>> once by different consumers. The responder on the ruby-amqp list 
>> mentioned a shared queue that is in the 091 spec. But this seems to 
>> put me back at using a long case statement.
>>
>> In an ideal situation I would have multiple consumers (written 
>> without epic case statements) and messages that get consumed once and 
>> only once.
>>
>> Any suggestions on how to go about doing something like this?
>
> The role of exchanges is to route messages to queues. They *all* have 
> the possibility of resulting in messages getting routed to multiple 
> queues and hence processed by multiple consumers - that's what they 
> are there for. Whether that actually happens depends on the bindings 
> that have been configured.
>
> For your use case, the following setup should work:
> - one direct exchange
> - one queue for each of the case branches
> - one binding per queue to the direct exchange, with the binding key 
> set to the case branch discriminator
> - one consumer per queue, handling the messages for one particular 
> branch discriminator
>
> In this setup messages will get routed to exactly one consumer, based 
> on their routing key. You'd only get duplication if you set up 
> additional queues and consumers that bound to the direct exchange with 
> the same binding keys.
>
> One possible downside of this setup compared to a single queue is that 
> message order is not preserved across queues.
>
>
> Regards,
>
> Matthias.

-- 
Name: Joseph A. Williams
Email: joe at joetify.com
Blog: http://www.joeandmotorboat.com/




From brian at echonest.com  Wed May  6 21:16:18 2009
From: brian at echonest.com (Brian Whitman)
Date: Wed, 6 May 2009 16:16:18 -0400
Subject: [rabbitmq-discuss] starting persister --- timeout
Message-ID: <dbd9700a0905061316g6d03cd52o44dffefb84f91da2@mail.gmail.com>

I'm getting this when I restart my rabbit server. Anyone know what it means?

RabbitMQ 1.5.4 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and R
abbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

Logging to "/var/log/rabbitmq/rabbit.log"
SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...timeout
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090506/96159e6b/attachment.htm 

From brian at echonest.com  Wed May  6 21:24:26 2009
From: brian at echonest.com (Brian Whitman)
Date: Wed, 6 May 2009 16:24:26 -0400
Subject: [rabbitmq-discuss] millions of unack'd messages in a day --
	disk store instead of ram?
In-Reply-To: <49FFECBF.9030905@lshift.net>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>
	<167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>
	<dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>
	<dbd9700a0904300811j687429fen7e3d7051f26caf95@mail.gmail.com>
	<20090430152930.GA10551@mrnibble.lshift.net>
	<dbd9700a0904301118v2834c10ap6fc38aba6602c4ad@mail.gmail.com>
	<49FFECBF.9030905@lshift.net>
Message-ID: <dbd9700a0905061324w5ee112beo77a80f0945bc49b2@mail.gmail.com>

ah, that did it. Thanks matthias.

On Tue, May 5, 2009 at 3:37 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Brian,
>
> Brian Whitman wrote:
>
>> I see this in my startup_err:
>>
>> /etc/rabbitmq/rabbitmq.conf: line 1: memory_alarms: command not found
>>
>> When I put this in my rabbitmq.conf:
>>
>> SERVER_START_ARGS=-rabbit memory_alarms false
>>
>> What am I doing wrong there?
>>
>
> You are missing some quotes - it should be
>
> SERVER_START_ARGS="-rabbit memory_alarms false"
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090506/305098d2/attachment.htm 

From brian at echonest.com  Wed May  6 22:04:59 2009
From: brian at echonest.com (Brian Whitman)
Date: Wed, 6 May 2009 17:04:59 -0400
Subject: [rabbitmq-discuss] starting persister --- timeout
In-Reply-To: <dbd9700a0905061316g6d03cd52o44dffefb84f91da2@mail.gmail.com>
References: <dbd9700a0905061316g6d03cd52o44dffefb84f91da2@mail.gmail.com>
Message-ID: <dbd9700a0905061404j3b431269v33c421515e50d4d1@mail.gmail.com>

As far as I can tell the persister was taking too long to load the messages
from the persister log (700MB) back into rabbit. It eventually came back up.

On Wed, May 6, 2009 at 4:16 PM, Brian Whitman <brian at echonest.com> wrote:

> I'm getting this when I restart my rabbit server. Anyone know what it
> means?
>
> RabbitMQ 1.5.4 (AMQP 8-0)
> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
> and R
> abbit Technologies Ltd.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> Logging to "/var/log/rabbitmq/rabbit.log"
> SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"
>
> starting database             ...done
> starting core processes       ...done
> starting recovery             ...done
> starting persister            ...timeout
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090506/ec14eb5d/attachment.htm 

From matthias at lshift.net  Thu May  7 07:24:59 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 07 May 2009 07:24:59 +0100
Subject: [rabbitmq-discuss] Error running rabbitmq-server on Mac OS X
In-Reply-To: <C6269406.6F7F6%kyle@pelago.com>
References: <C6269406.6F7F6%kyle@pelago.com>
Message-ID: <4A027EBB.2050201@lshift.net>

Kyle,

Kyle Wilkinson wrote:
> I'm trying to run the rabbitmq-server on my mac, but I keep on running into
> a rather cryptic error:
> 
> computer:rabbitmq kyle$ sudo -H -u rabbitmq rabbitmq-server
> {"init terminating in
> do_boot",{undef,[{rabbit,start,[]},{init,start_it,1},{init,start_em,1}]}}

Looks like Erlang cannot find the rabbitmq libraries.

The libs are meant to get installed into the same dir tree as 
Erlang/OTP's core libs. That's usually s.t. like /usr/lib/erlang/lib, 
but could be different if you installed Erlang manually.

So ...

1) find out where your Erlang libs are installed, e.g. by evaluating
   code:get_path().
in an Erlang shell.

2) find out where your rabbitmq libraries are installed, e.g. by 
searching the filesystem for "rabbit.beam"

3) If the two are in a different place, create a symlink from the Erlang 
libs dir to the rabbitmq libs.


Regards,

Matthias.



From matthias at lshift.net  Thu May  7 07:29:24 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 07 May 2009 07:29:24 +0100
Subject: [rabbitmq-discuss] starting persister --- timeout
In-Reply-To: <dbd9700a0905061404j3b431269v33c421515e50d4d1@mail.gmail.com>
References: <dbd9700a0905061316g6d03cd52o44dffefb84f91da2@mail.gmail.com>
	<dbd9700a0905061404j3b431269v33c421515e50d4d1@mail.gmail.com>
Message-ID: <4A027FC4.8070003@lshift.net>

Brian,

Brian Whitman wrote:
> As far as I can tell the persister was taking too long to load the 
> messages from the persister log (700MB) back into rabbit.

Yep, that's it.

We are in the process of redesigning the persister, and the timeout 
error should go away as part of that.


Matthias.



From floppya at gmail.com  Thu May  7 20:35:55 2009
From: floppya at gmail.com (Adam Wentz)
Date: Thu, 7 May 2009 12:35:55 -0700
Subject: [rabbitmq-discuss] rabbitmq through firewall (rabbitmq-server patch)
Message-ID: <348bc1a20905071235n3a51a80cxfdf77bd628cbc1e1@mail.gmail.com>

I'm clustering rabbitmq through a firewall and made the following change to
/usr/lib/rabbitmq/bin/rabbitmq-server so we can specify the ports erlang
will use to do the cluster to cluster communication:

 35a36,37
> RABBIT_LISTEN_MIN_DEFAULT=34567
> RABBIT_LISTEN_MAX_DEFAULT=34567
38c40,41
< -kernel inet_default_connect_options [{nodelay,true}]"
---
> -kernel inet_default_connect_options [{nodelay,true}] \
> -kernel inet_dist_listen_min
${RABBIT_LISTEN_MIN:-$RABBIT_LISTEN_MIN_DEFAULT} inet_dist_listen_max
${RABBIT_LISTEN_MAX:-$RABBIT_LISTEN_MAX_DEFAULT}"

You can define RABBIT_LISTEN_MIN and RABBIT_LISTEN_MAX for your own custom
ranges, might want to change the defaults too. I'm posting this in the hopes
that it will either be useful to others or someone will show me a better way
as I'm new to erlang/rabbitmq.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090507/f05d0988/attachment.htm 

From bsullivan at lindenlab.com  Fri May  8 18:41:07 2009
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Fri, 8 May 2009 10:41:07 -0700
Subject: [rabbitmq-discuss] millions of unack'd messages in a day--	disk
	store instead of ram?
In-Reply-To: <20090430152930.GA10551@mrnibble.lshift.net>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com><167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail
	.com><dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com><dbd9700a0904300811j687429fen7e3d7051f26caf95@mail.gmail.com>
	<20090430152930.GA10551@mrnibble.lshift.net>
Message-ID: <0B391593-838F-422B-AFA4-902C331133A0@lindenlab.com>

Hi Matthew,

On Apr 30, 2009, at 8:29 AM, Matthew Sackman wrote:

> [snip] Beware though that the broker you are using could have internal
> messages timeout on it - this was fixed in bug 20546 which is in our
> "default" development branch, not the stable "v1_5" branch. As such,  
> you
> may see messages coming out of the broker which indicate strange  
> timeouts
> occurred. [snip]

Would this timeout error you mention possibly be the reason I have  
seen this error crop up once every few days?  If so, do you know when  
the fix will make it to the stable branch?

=INFO REPORT==== 1-May-2009::16:29:00 ===
starting TCP connection <0.17070.115> from 10.0.4.56:51169

=ERROR REPORT==== 1-May-2009::19:09:53 ===
connection <0.17070.115> (running), channel 1 - error:
{{timeout,{gen_server,call,[<0.17078.115>,stat]}},
  [{gen_server,call,2},
   {rabbit_misc,with_exit_handler,2},
   {rabbit_channel,return_queue_declare_ok,3},
   {rabbit_channel,handle_message,2},
   {buffering_proxy,'-mainloop/4-fun-0-',3},
   {lists,foldl,3},
   {buffering_proxy,mainloop,4}]}

=WARNING REPORT==== 1-May-2009::19:09:53 ===
Non-AMQP exit reason '{{timeout,{gen_server,call,[<0.17078.115>,stat]}},
                        [{gen_server,call,2},
                         {rabbit_misc,with_exit_handler,2},
                         {rabbit_channel,return_queue_declare_ok,3},
                         {rabbit_channel,handle_message,2},
                         {buffering_proxy,'-mainloop/4-fun-0-',3},
                         {lists,foldl,3},
                         {buffering_proxy,mainloop,4}]}'

=INFO REPORT==== 1-May-2009::19:09:53 ===
closing TCP connection <0.17070.115> from 10.0.4.56:51169

Thanks,
Brian




From matthias at lshift.net  Sat May  9 10:24:40 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 09 May 2009 10:24:40 +0100
Subject: [rabbitmq-discuss] How do I inspect the queue
In-Reply-To: <03FC0D29D4E88943AB7420C524BE8489027C37D5@mllnc20mb056.emea.win.ml.com>
References: <03FC0D29D4E88943AB7420C524BE8489027C37D5@mllnc20mb056.emea.win.ml.com>
Message-ID: <4A054BD8.3030708@lshift.net>

Rajesh,

Reddy, Rajesh (GPT EMEA) wrote:
> Also, iam declaring a queue as follows,
> Passive = false
> Durable = false
> Exclusive = true
> Autodelete = true
> Nowait = true
> 
> This would create a non durable and auto delete queue. I can inspect
> using rabbitmqctl list_queues, but it only gives me durable and
> autodelete and not the other items related to declare queue.

'passive' and 'nowait' affect the behaviour of the queue.declare 
*operation*. They are not properties of queues, so it would not make 
sense to return them from list_queues.

> Also, what is exclusive used for.

You can find an explanation of all the queue.declare parameters in the 
spec xml. See 
http://jira.amqp.org/confluence/download/attachments/720900/amqp0-9-1.xml?version=1 
(I am linking to the 0-9-1 spec here rather than 0-8 because the 
explanation there is much clearer).

> I my case the client creates queue just once and then waits on a
> callback for any messages on that queue. So if a queue is deleted then
> the client will be just sitting there waiting for a message without
> knowing that the queue no longer exists.

Correct; consumers do not get notified when a queue disappears. This has 
come up in discussion before. It would be a nice feature to have.


Regards,

Matthias.



From matthew at lshift.net  Sun May 10 13:02:52 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 10 May 2009 13:02:52 +0100
Subject: [rabbitmq-discuss] millions of unack'd messages in a day--	disk
	store instead of ram?
In-Reply-To: <0B391593-838F-422B-AFA4-902C331133A0@lindenlab.com>
References: <20090430152930.GA10551@mrnibble.lshift.net>
	<0B391593-838F-422B-AFA4-902C331133A0@lindenlab.com>
Message-ID: <20090510120252.GA1727@wellquite.org>

Hi Brian,

On Fri, May 08, 2009 at 10:41:07AM -0700, Brian Sullivan wrote:
>> [snip] Beware though that the broker you are using could have internal
>> messages timeout on it - this was fixed in bug 20546 which is in our
>> "default" development branch, not the stable "v1_5" branch. As such,  
>> you
>> may see messages coming out of the broker which indicate strange  
>> timeouts
>> occurred. [snip]
>
> Would this timeout error you mention possibly be the reason I have seen 
> this error crop up once every few days?  If so, do you know when the fix 
> will make it to the stable branch?
>
> =INFO REPORT==== 1-May-2009::16:29:00 ===
> starting TCP connection <0.17070.115> from 10.0.4.56:51169
>
> =ERROR REPORT==== 1-May-2009::19:09:53 ===
> connection <0.17070.115> (running), channel 1 - error:
> {{timeout,{gen_server,call,[<0.17078.115>,stat]}},

Yep. That is a synchronous call within rabbit timing out. By default the
OTP platform sets these timeouts to be 5 seconds. When a machine is very
heavily loaded, it's very possible for calls to take more than 5 seconds
to complete. We have changed all the timeouts to 'infinity' now because
doing so allows rabbit to continue to operate successfully in heavily
loaded situations and also because we don't think there's any value in
trying to catch such timeout errors - it's not like there's something
other than retrying that we could do when a timeout like this occurs, thus
it's better to just remove the timeout completely.

I'd be interested to know if there are any specific circumstances which
cause your broker to emit these timeout errors.

Wrt these changes landing in a stable branch, it's very unlikely they'll
hit in 1.5. They will, I suspect, be in 1.6, but we don't have a timetable
as to when we're planning on forking that. Sorry I can't help more.

Matthew



From bradford.n.cross at gmail.com  Mon May 11 05:48:56 2009
From: bradford.n.cross at gmail.com (bradford cross)
Date: Sun, 10 May 2009 21:48:56 -0700
Subject: [rabbitmq-discuss] creating fanout exchange gives
	ShutdownSignalException
Message-ID: <ea7d6a710905102148l5790a61cj65c56a1b0188ab2f@mail.gmail.com>

I still have an issue getting fanout to work.

Take a look at the code from my clojure repl.

com.parsimony-group.rabbitcj> (def connection (let [params (doto
(ConnectionParameters.)
                                        (.setVirtualHost "/")
                                        (.setUsername "guest")
                                        (.setPassword "guest"))
                               factory (ConnectionFactory. params)]
                           (.newConnection factory host))
                   )
#'com.parsimony-group.rabbitcj/connection
com.parsimony-group.rabbitcj> (def channel (.createChannel connection))
#'com.parsimony-group.rabbitcj/channel
com.parsimony-group.rabbitcj>  (.exchangeDeclare channel "foo" "direct" )
#<DeclareOk #method<exchange.declare-ok>()>
com.parsimony-group.rabbitcj>  (.exchangeDeclare channel "foo" "amq.fanout"
)
; Evaluation aborted.


...very simple, exchangeDeclare is fine for direct, but clows up for fanout
case...I get the error message:


No message.
  [Thrown class com.rabbitmq.client.ShutdownSignalException]

Restarts:
 0: [ABORT] Return to SLIME's top level.

Backtrace:
  0: com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:606)
  1:
com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection.java:561)
  2:
com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection.java:541)
  3:
com.rabbitmq.client.impl.AMQConnection$1.processAsync(AMQConnection.java:84)
  4:
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:159)
  5: com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
  6:
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:446)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090510/754b5ead/attachment.htm 

From aaron.feng at gmail.com  Mon May 11 12:35:46 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Mon, 11 May 2009 07:35:46 -0400
Subject: [rabbitmq-discuss] creating fanout exchange gives
	ShutdownSignalException
In-Reply-To: <ea7d6a710905102148l5790a61cj65c56a1b0188ab2f@mail.gmail.com>
References: <ea7d6a710905102148l5790a61cj65c56a1b0188ab2f@mail.gmail.com>
Message-ID: <4e3934860905110435k18050993ob705e187e68bea8e@mail.gmail.com>

Hi Bradford,
Is this the exact code from the REPL?

If so, you can't create a different exchange with an existing exchange name
of different type.  stop_app, reset then start_app using rabbitmqctl, and
try to create the fanout exchange first.

Aaron

On Mon, May 11, 2009 at 12:48 AM, bradford cross <bradford.n.cross at gmail.com
> wrote:

> I still have an issue getting fanout to work.
>
> Take a look at the code from my clojure repl.
>
> com.parsimony-group.rabbitcj> (def connection (let [params (doto
> (ConnectionParameters.)
>                                         (.setVirtualHost "/")
>                                         (.setUsername "guest")
>                                         (.setPassword "guest"))
>                                factory (ConnectionFactory. params)]
>                            (.newConnection factory host))
>                    )
> #'com.parsimony-group.rabbitcj/connection
> com.parsimony-group.rabbitcj> (def channel (.createChannel connection))
> #'com.parsimony-group.rabbitcj/channel
> com.parsimony-group.rabbitcj>  (.exchangeDeclare channel "foo" "direct" )
> #<DeclareOk #method<exchange.declare-ok>()>
> com.parsimony-group.rabbitcj>  (.exchangeDeclare channel "foo" "amq.fanout"
> )
> ; Evaluation aborted.
>
>
> ...very simple, exchangeDeclare is fine for direct, but clows up for fanout
> case...I get the error message:
>
>
> No message.
>   [Thrown class com.rabbitmq.client.ShutdownSignalException]
>
> Restarts:
>  0: [ABORT] Return to SLIME's top level.
>
> Backtrace:
>   0:
> com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:606)
>   1:
> com.rabbitmq.client.impl.AMQConnection.handleConnectionClose(AMQConnection.java:561)
>   2:
> com.rabbitmq.client.impl.AMQConnection.processControlCommand(AMQConnection.java:541)
>   3:
> com.rabbitmq.client.impl.AMQConnection$1.processAsync(AMQConnection.java:84)
>   4:
> com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:159)
>   5: com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)
>   6:
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:446)
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090511/41eea400/attachment.htm 

From aaron.feng at gmail.com  Mon May 11 12:48:41 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Mon, 11 May 2009 07:48:41 -0400
Subject: [rabbitmq-discuss] creating fanout exchange gives
	ShutdownSignalException
In-Reply-To: <ea7d6a710905102148l5790a61cj65c56a1b0188ab2f@mail.gmail.com>
References: <ea7d6a710905102148l5790a61cj65c56a1b0188ab2f@mail.gmail.com>
Message-ID: <4C508839-9A46-4220-AEDC-5B9A0C6C708E@gmail.com>

FYI reset will return to default mode. So don't reset if you care  
about what you added to the broker.

Aaron

On May 11, 2009, at 12:48 AM, bradford cross  
<bradford.n.cross at gmail.com> wrote:

> I still have an issue getting fanout to work.
>
> Take a look at the code from my clojure repl.
>
> com.parsimony-group.rabbitcj> (def connection (let [params (doto  
> (ConnectionParameters.)
>                                         (.setVirtualHost "/")
>                                         (.setUsername "guest")
>                                         (.setPassword "guest"))
>                                factory (ConnectionFactory. params)]
>                            (.newConnection factory host))
>                    )
> #'com.parsimony-group.rabbitcj/connection
> com.parsimony-group.rabbitcj> (def channel (.createChannel  
> connection))
> #'com.parsimony-group.rabbitcj/channel
> com.parsimony-group.rabbitcj>  (.exchangeDeclare channel "foo"  
> "direct" )
> #<DeclareOk #method<exchange.declare-ok>()>
> com.parsimony-group.rabbitcj>  (.exchangeDeclare channel "foo"  
> "amq.fanout" )
> ; Evaluation aborted.
>
>
> ...very simple, exchangeDeclare is fine for direct, but clows up for  
> fanout case...I get the error message:
>
>
> No message.
>   [Thrown class com.rabbitmq.client.ShutdownSignalException]
>
> Restarts:
>  0: [ABORT] Return to SLIME's top level.
>
> Backtrace:
>   0:  
> com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java: 
> 606)
>   1:  
> com. 
> rabbitmq. 
> client.impl.AMQConnection.handleConnectionClose(AMQConnection.java: 
> 561)
>   2:  
> com. 
> rabbitmq. 
> client.impl.AMQConnection.processControlCommand(AMQConnection.java: 
> 541)
>   3: com.rabbitmq.client.impl.AMQConnection 
> $1.processAsync(AMQConnection.java:84)
>   4:  
> com. 
> rabbitmq. 
> client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java: 
> 159)
>   5: com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java: 
> 110)
>   6: com.rabbitmq.client.impl.AMQConnection 
> $MainLoop.run(AMQConnection.java:446)
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From matthias at lshift.net  Mon May 11 20:19:19 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 11 May 2009 20:19:19 +0100
Subject: [rabbitmq-discuss] creating fanout exchange
	gives	ShutdownSignalException
In-Reply-To: <4e3934860905110435k18050993ob705e187e68bea8e@mail.gmail.com>
References: <ea7d6a710905102148l5790a61cj65c56a1b0188ab2f@mail.gmail.com>
	<4e3934860905110435k18050993ob705e187e68bea8e@mail.gmail.com>
Message-ID: <4A087A37.9030107@lshift.net>

Bradfor,

Aaron Feng wrote:
> you can't create a different exchange with an existing exchange 
> name of different type.

That's one problem. The second one is that the type is specified as 
"amq.fanout" rather than "fanout".

Btw, the error returned by rabbit in both cases is actually quite 
informative, so it would be a good idea to display the 
ShutdownSignalException (it has a toString method that returns something 
sensible, though strangely it doesn't specify a message; I have filed a 
bug to change that). The RabbitMQ server log should contain useful info 
as well that helps tracking down this sort of problem.


Regards,

Matthias.



From tperrett at googlemail.com  Tue May 12 18:10:56 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Tue, 12 May 2009 18:10:56 +0100
Subject: [rabbitmq-discuss] Where too now?
Message-ID: <b22ab270905121010p282b27aq2a5dbd63213b4970@mail.gmail.com>

Hey guys,

This is my first post to this list - im afraid im a bit of a rabbitmq
n00bie! I've got everything setup and working and now looking to do
something good with it to understand how it all works for my use case.

Essentially I have some backend tools that expose services with SOAP -
for which my app will repeatedly get data from - probably every 10
seconds, maybe less i've not decided yet. Anyway... said app gets said
data from those services. What I would then like it to do is notify
any other consumers (which will be other applications) that have opted
to subscribe to information / updates about that job via AMQP.
Consumers will also be able to hand messages to the central service
and effectively say "deal with this job and notify me about any
changes".

Now then, excuse my complete ignorance, but its possible to build such
a workflow, right? Any pro's / con's in doing this? What would be the
optimal way to build such a system from a RabbitMQ POV?

Just looking for a bit of a sounding board right now so any
information / feedback would be greatly appreciated.

Cheers, Tim



From chime at mu.dk  Tue May 12 19:50:47 2009
From: chime at mu.dk (Michael Arnoldus)
Date: Tue, 12 May 2009 20:50:47 +0200
Subject: [rabbitmq-discuss] Where too now?
In-Reply-To: <b22ab270905121010p282b27aq2a5dbd63213b4970@mail.gmail.com>
References: <b22ab270905121010p282b27aq2a5dbd63213b4970@mail.gmail.com>
Message-ID: <FFA9686B-9E28-40E5-BF20-2A4C503D882D@mu.dk>

Hi Tim,

Sounds like a good plan. We're using AMQP for exactly the same purpose  
in the same way.

Regards,

Michael Arnoldus


On May 12, 2009, at 19:10 , Tim Perrett wrote:

> Hey guys,
>
> This is my first post to this list - im afraid im a bit of a rabbitmq
> n00bie! I've got everything setup and working and now looking to do
> something good with it to understand how it all works for my use case.
>
> Essentially I have some backend tools that expose services with SOAP -
> for which my app will repeatedly get data from - probably every 10
> seconds, maybe less i've not decided yet. Anyway... said app gets said
> data from those services. What I would then like it to do is notify
> any other consumers (which will be other applications) that have opted
> to subscribe to information / updates about that job via AMQP.
> Consumers will also be able to hand messages to the central service
> and effectively say "deal with this job and notify me about any
> changes".
>
> Now then, excuse my complete ignorance, but its possible to build such
> a workflow, right? Any pro's / con's in doing this? What would be the
> optimal way to build such a system from a RabbitMQ POV?
>
> Just looking for a bit of a sounding board right now so any
> information / feedback would be greatly appreciated.
>
> Cheers, Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090512/5661983d/attachment.bin 

From tperrett at googlemail.com  Wed May 13 00:39:30 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Wed, 13 May 2009 00:39:30 +0100
Subject: [rabbitmq-discuss] Where too now?
In-Reply-To: <FFA9686B-9E28-40E5-BF20-2A4C503D882D@mu.dk>
References: <b22ab270905121010p282b27aq2a5dbd63213b4970@mail.gmail.com>
	<FFA9686B-9E28-40E5-BF20-2A4C503D882D@mu.dk>
Message-ID: <b22ab270905121639o65098bdfie58aaf0c24c87759@mail.gmail.com>

Thanks Michael, thats good to hear.

Any advice on the implementation? what to do and what to avoid?

Cheers, Tim

On Tue, May 12, 2009 at 7:50 PM, Michael Arnoldus <chime at mu.dk> wrote:
> Hi Tim,
>
> Sounds like a good plan. We're using AMQP for exactly the same purpose in
> the same way.
>
> Regards,
>
> Michael Arnoldus
>
>
> On May 12, 2009, at 19:10 , Tim Perrett wrote:
>
>> Hey guys,
>>
>> This is my first post to this list - im afraid im a bit of a rabbitmq
>> n00bie! I've got everything setup and working and now looking to do
>> something good with it to understand how it all works for my use case.
>>
>> Essentially I have some backend tools that expose services with SOAP -
>> for which my app will repeatedly get data from - probably every 10
>> seconds, maybe less i've not decided yet. Anyway... said app gets said
>> data from those services. What I would then like it to do is notify
>> any other consumers (which will be other applications) that have opted
>> to subscribe to information / updates about that job via AMQP.
>> Consumers will also be able to hand messages to the central service
>> and effectively say "deal with this job and notify me about any
>> changes".
>>
>> Now then, excuse my complete ignorance, but its possible to build such
>> a workflow, right? Any pro's / con's in doing this? What would be the
>> optimal way to build such a system from a RabbitMQ POV?
>>
>> Just looking for a bit of a sounding board right now so any
>> information / feedback would be greatly appreciated.
>>
>> Cheers, Tim
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From jewel at subvert-the-dominant-paradigm.net  Wed May 13 12:06:46 2009
From: jewel at subvert-the-dominant-paradigm.net (John Leuner)
Date: Wed, 13 May 2009 13:06:46 +0200
Subject: [rabbitmq-discuss] Debian dependencies
Message-ID: <1242212806.14540.38.camel@cmalu.WAG54GS>

I have changed the debian package to depend on the 'erlang-os-mon'
package recently introduced into debian unstable.

John

-------------- next part --------------
Source: rabbitmq-server
Section: net
Priority: extra
Maintainer: John Leuner <jewel at debian.org>
Build-Depends: cdbs, debhelper (>= 5), erlang-nox, erlang-os-mon, erlang-dev, python-simplejson
Standards-Version: 3.8.0

Package: rabbitmq-server
Architecture: all
Depends: erlang-nox, erlang-os-mon, adduser, logrotate, ${misc:Depends}
Description: An AMQP server written in Erlang
 RabbitMQ is an implementation of AMQP, the emerging standard for high
 performance enterprise messaging. The RabbitMQ server is a robust and
 scalable implementation of an AMQP broker.
Homepage: http://www.rabbitmq.com/

From matthew at lshift.net  Wed May 13 12:13:29 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 13 May 2009 12:13:29 +0100
Subject: [rabbitmq-discuss] Debian dependencies
In-Reply-To: <1242212806.14540.38.camel@cmalu.WAG54GS>
References: <1242212806.14540.38.camel@cmalu.WAG54GS>
Message-ID: <20090513111319.GA3047@mrnibble.lshift.net>

On Wed, May 13, 2009 at 01:06:46PM +0200, John Leuner wrote:
> I have changed the debian package to depend on the 'erlang-os-mon'
> package recently introduced into debian unstable.

Ahh cool, I had spotted that and raised an internal bug for it. It
seemed to me that erlang-nox should really depend on erlang-os-mon.
Is that your feeling too (in which case I'll raise a Debian bug for
it) or is there some reason why os-mon has mysteriously been left
out?

Matthew



From tperrett at googlemail.com  Wed May 13 12:39:05 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Wed, 13 May 2009 12:39:05 +0100
Subject: [rabbitmq-discuss] Where too now?
In-Reply-To: <ce47f6b80905121833u296f0b24q9eb062e626f85329@mail.gmail.com>
References: <b22ab270905121010p282b27aq2a5dbd63213b4970@mail.gmail.com>
	<FFA9686B-9E28-40E5-BF20-2A4C503D882D@mu.dk>
	<b22ab270905121639o65098bdfie58aaf0c24c87759@mail.gmail.com>
	<ce47f6b80905121833u296f0b24q9eb062e626f85329@mail.gmail.com>
Message-ID: <b22ab270905130439y534ec030o3b0bcd25b7235c2e@mail.gmail.com>

Hey Colin,

Im using a scala abstraction that's part of the lift framework project
(which im a committer on). We have dispatcher and sender
implementations I do belive... right now im just trying to bridge the
knowledge gap and figure out what does what. The code is here:

http://is.gd/zsjO

The chap who wrote our implementation (Steve J @ twitter) is not
really active in the team anymore so im just trying to work through
what he's made and fill my knowledge gaps about rabbit mq as I go
along.

Based on my vauge understand right now, the senders shove messages
into the ques and the dispatchers serve messages up to lisening
clients - applications in this case. Does that sound about right?

Cheers, Tim

On Wed, May 13, 2009 at 2:33 AM, Colin Z <theczintheroc2007 at gmail.com> wrote:
> Depends on what languages you will use to interface with the Rabbit
> server/cluster.
>
> I found the C# client library very easy to use. The Erlang client library
> was a little bit tricker and I ran into some error-handling issues but I
> think these were fixed in more recent versions, I haven't checked.
>
> IMHO, the team has done an excellent job of making Rabbit as "fire and
> forget" as an Erlang app can be.
>
>
>
> On Tue, May 12, 2009 at 7:39 PM, Tim Perrett <tperrett at googlemail.com>
> wrote:
>>
>> Thanks Michael, thats good to hear.
>>
>> Any advice on the implementation? what to do and what to avoid?
>>
>> Cheers, Tim
>>
>> On Tue, May 12, 2009 at 7:50 PM, Michael Arnoldus <chime at mu.dk> wrote:
>> > Hi Tim,
>> >
>> > Sounds like a good plan. We're using AMQP for exactly the same purpose
>> > in
>> > the same way.
>> >
>> > Regards,
>> >
>> > Michael Arnoldus
>> >
>> >
>> > On May 12, 2009, at 19:10 , Tim Perrett wrote:
>> >
>> >> Hey guys,
>> >>
>> >> This is my first post to this list - im afraid im a bit of a rabbitmq
>> >> n00bie! I've got everything setup and working and now looking to do
>> >> something good with it to understand how it all works for my use case.
>> >>
>> >> Essentially I have some backend tools that expose services with SOAP -
>> >> for which my app will repeatedly get data from - probably every 10
>> >> seconds, maybe less i've not decided yet. Anyway... said app gets said
>> >> data from those services. What I would then like it to do is notify
>> >> any other consumers (which will be other applications) that have opted
>> >> to subscribe to information / updates about that job via AMQP.
>> >> Consumers will also be able to hand messages to the central service
>> >> and effectively say "deal with this job and notify me about any
>> >> changes".
>> >>
>> >> Now then, excuse my complete ignorance, but its possible to build such
>> >> a workflow, right? Any pro's / con's in doing this? What would be the
>> >> optimal way to build such a system from a RabbitMQ POV?
>> >>
>> >> Just looking for a bit of a sounding board right now so any
>> >> information / feedback would be greatly appreciated.
>> >>
>> >> Cheers, Tim
>> >>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From chime at mu.dk  Wed May 13 13:03:22 2009
From: chime at mu.dk (Michael Arnoldus)
Date: Wed, 13 May 2009 14:03:22 +0200
Subject: [rabbitmq-discuss] Where too now?
In-Reply-To: <b22ab270905130439y534ec030o3b0bcd25b7235c2e@mail.gmail.com>
References: <b22ab270905121010p282b27aq2a5dbd63213b4970@mail.gmail.com>
	<FFA9686B-9E28-40E5-BF20-2A4C503D882D@mu.dk>
	<b22ab270905121639o65098bdfie58aaf0c24c87759@mail.gmail.com>
	<ce47f6b80905121833u296f0b24q9eb062e626f85329@mail.gmail.com>
	<b22ab270905130439y534ec030o3b0bcd25b7235c2e@mail.gmail.com>
Message-ID: <E969196A-8F18-476C-A44C-6DC17584CE37@mu.dk>

Senders shove messages into exchanges, bindings move them to zero or  
more queues. Clients take from the queues.

Using the scenario you previouslf described we send each information  
type to a specific exchange of type fanout. The clinet has one or more  
queues bound to the exchanges it wants information from. Use one or  
more queues for each client depending on how tho client uses the info.

Michael

On May 13, 2009, at 13:39 , Tim Perrett wrote:

> Hey Colin,
>
> Im using a scala abstraction that's part of the lift framework project
> (which im a committer on). We have dispatcher and sender
> implementations I do belive... right now im just trying to bridge the
> knowledge gap and figure out what does what. The code is here:
>
> http://is.gd/zsjO
>
> The chap who wrote our implementation (Steve J @ twitter) is not
> really active in the team anymore so im just trying to work through
> what he's made and fill my knowledge gaps about rabbit mq as I go
> along.
>
> Based on my vauge understand right now, the senders shove messages
> into the ques and the dispatchers serve messages up to lisening
> clients - applications in this case. Does that sound about right?
>
> Cheers, Tim
>
> On Wed, May 13, 2009 at 2:33 AM, Colin Z  
> <theczintheroc2007 at gmail.com> wrote:
>> Depends on what languages you will use to interface with the Rabbit
>> server/cluster.
>>
>> I found the C# client library very easy to use. The Erlang client  
>> library
>> was a little bit tricker and I ran into some error-handling issues  
>> but I
>> think these were fixed in more recent versions, I haven't checked.
>>
>> IMHO, the team has done an excellent job of making Rabbit as "fire  
>> and
>> forget" as an Erlang app can be.
>>
>>
>>
>> On Tue, May 12, 2009 at 7:39 PM, Tim Perrett  
>> <tperrett at googlemail.com>
>> wrote:
>>>
>>> Thanks Michael, thats good to hear.
>>>
>>> Any advice on the implementation? what to do and what to avoid?
>>>
>>> Cheers, Tim
>>>
>>> On Tue, May 12, 2009 at 7:50 PM, Michael Arnoldus <chime at mu.dk>  
>>> wrote:
>>>> Hi Tim,
>>>>
>>>> Sounds like a good plan. We're using AMQP for exactly the same  
>>>> purpose
>>>> in
>>>> the same way.
>>>>
>>>> Regards,
>>>>
>>>> Michael Arnoldus
>>>>
>>>>
>>>> On May 12, 2009, at 19:10 , Tim Perrett wrote:
>>>>
>>>>> Hey guys,
>>>>>
>>>>> This is my first post to this list - im afraid im a bit of a  
>>>>> rabbitmq
>>>>> n00bie! I've got everything setup and working and now looking to  
>>>>> do
>>>>> something good with it to understand how it all works for my use  
>>>>> case.
>>>>>
>>>>> Essentially I have some backend tools that expose services with  
>>>>> SOAP -
>>>>> for which my app will repeatedly get data from - probably every 10
>>>>> seconds, maybe less i've not decided yet. Anyway... said app  
>>>>> gets said
>>>>> data from those services. What I would then like it to do is  
>>>>> notify
>>>>> any other consumers (which will be other applications) that have  
>>>>> opted
>>>>> to subscribe to information / updates about that job via AMQP.
>>>>> Consumers will also be able to hand messages to the central  
>>>>> service
>>>>> and effectively say "deal with this job and notify me about any
>>>>> changes".
>>>>>
>>>>> Now then, excuse my complete ignorance, but its possible to  
>>>>> build such
>>>>> a workflow, right? Any pro's / con's in doing this? What would  
>>>>> be the
>>>>> optimal way to build such a system from a RabbitMQ POV?
>>>>>
>>>>> Just looking for a bit of a sounding board right now so any
>>>>> information / feedback would be greatly appreciated.
>>>>>
>>>>> Cheers, Tim
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq- 
>>>>> discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090513/ea4f4112/attachment.bin 

From aaron.feng at gmail.com  Wed May 13 15:07:46 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Wed, 13 May 2009 10:07:46 -0400
Subject: [rabbitmq-discuss] Platform for rabbit
Message-ID: <4e3934860905130707i6cb0013ey3da727160414cfc4@mail.gmail.com>

Hi,
I understand rabbit run happily on various platforms.  Is there a particular
platform or distribution that is better or is it just pure preference?
 Rabbit is now bundle with Ubuntu, are there any particular advantages other
packaging?

I would also be interested to see what the community is running rabbit on.

Thanks,

Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090513/83a856f3/attachment.htm 

From cremes.devlist at mac.com  Wed May 13 19:06:32 2009
From: cremes.devlist at mac.com (Chuck Remes)
Date: Wed, 13 May 2009 13:06:32 -0500
Subject: [rabbitmq-discuss] Erlang R13B
Message-ID: <BB14229D-8D05-4DE8-A013-984561B63D5C@mac.com>

I'm ready for one of my semi-annual macports updates. It is listing  
erlange R13B_2 as the latest revision available. Should I leave this  
one off the upgrade list or does the latest rabbitmq release (1.5.4?)  
work okay with it?

cr



From nemik at nemik.net  Wed May 13 19:25:44 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Wed, 13 May 2009 13:25:44 -0500
Subject: [rabbitmq-discuss] Erlang R13B
In-Reply-To: <BB14229D-8D05-4DE8-A013-984561B63D5C@mac.com>
References: <BB14229D-8D05-4DE8-A013-984561B63D5C@mac.com>
Message-ID: <acceaadf0905131125i6868bcc7rd3e87abff9d2ee2b@mail.gmail.com>

I just tried running my RabbitMQ 1.5.4 with the STOMP adapter on R13B and it
seems to be working perfectly. Haven't done too much testing beyond the
basics though so I'm not sure about production usage.

On Wed, May 13, 2009 at 1:06 PM, Chuck Remes <cremes.devlist at mac.com> wrote:

> I'm ready for one of my semi-annual macports updates. It is listing
> erlange R13B_2 as the latest revision available. Should I leave this
> one off the upgrade list or does the latest rabbitmq release (1.5.4?)
> work okay with it?
>
> cr
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090513/e2b590bc/attachment.htm 

From cremes.devlist at mac.com  Wed May 13 19:31:47 2009
From: cremes.devlist at mac.com (Chuck Remes)
Date: Wed, 13 May 2009 13:31:47 -0500
Subject: [rabbitmq-discuss] Erlang R13B
In-Reply-To: <acceaadf0905131125i6868bcc7rd3e87abff9d2ee2b@mail.gmail.com>
References: <BB14229D-8D05-4DE8-A013-984561B63D5C@mac.com>
	<acceaadf0905131125i6868bcc7rd3e87abff9d2ee2b@mail.gmail.com>
Message-ID: <A9F95694-EF53-4A53-9D1D-89A2DD8838A4@mac.com>


On May 13, 2009, at 1:25 PM, Nemanja Stefanovic wrote:

> I just tried running my RabbitMQ 1.5.4 with the STOMP adapter on  
> R13B and it seems to be working perfectly. Haven't done too much  
> testing beyond the basics though so I'm not sure about production  
> usage.
>
> On Wed, May 13, 2009 at 1:06 PM, Chuck Remes  
> <cremes.devlist at mac.com> wrote:
> I'm ready for one of my semi-annual macports updates. It is listing
> erlange R13B_2 as the latest revision available. Should I leave this
> one off the upgrade list or does the latest rabbitmq release (1.5.4?)
> work okay with it?

I'm looking to do some development with it so handling a production  
load *right now* isn't too important.

Thanks for sharing your results...

cr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090513/fb62a697/attachment.htm 

From eric at grokthis.net  Thu May 14 06:32:34 2009
From: eric at grokthis.net (Eric Windisch)
Date: Thu, 14 May 2009 01:32:34 -0400
Subject: [rabbitmq-discuss] Message accounting patch
Message-ID: <E384024B-74B7-4D86-B907-1906B58B8334@grokthis.net>

With the help of Programming Erlang and the gracious folks at Philly  
Lambda, I've completed a patch for message accounting.  Quite simply,  
this patch adds two mnesia tables which count up the messages  
submitted into Rabbit.  One table counts messages per user, and the  
other counts messages per vhost.

To pull data out, you can use the following code:

  Ucount=fun() ->  
mnesia:dirty_read(rabbit_uaudit,mnesia:first(rabbit_uaudit)) end.
  mnesia:transaction(Ucount).
  Vcount=fun() ->  
mnesia:dirty_read(rabbit_vaudit,mnesia:first(rabbit_vaudit)) end.
  mnesia:transaction(Vcount).

This example will grab the data from the first entry from each table.   
You can clearly substitute the Key argument with a string, or write a  
more complicated expression as you might desire.

Regards,
Eric Windisch



diff -r 2ce3d18b4383 include/rabbit.hrl
--- a/include/rabbit.hrl	Fri Apr 24 17:08:19 2009 +0100
+++ b/include/rabbit.hrl	Thu May 14 05:17:18 2009 +0000
@@ -52,6 +52,8 @@
  -record(exchange, {name, type, durable, auto_delete, arguments}).

  -record(amqqueue, {name, durable, auto_delete, arguments, pid}).
+
+-record(counter, {name, count}).

  %% mnesia doesn't like unary records, so we add a dummy 'value' field
  -record(route, {binding, value = const}).
@@ -111,6 +113,10 @@
        #binding{exchange_name    :: exchange_name(),
                 queue_name       :: queue_name(),
                 key              :: binding_key()}).
+-type(counter() ::
+      #counter{name          :: string(),
+               count         :: non_neg_integer()}).
+
  %% TODO: make this more precise by tying specific class_ids to
  %% specific properties
  -type(undecoded_content() ::
diff -r 2ce3d18b4383 src/rabbit_mnesia.erl
--- a/src/rabbit_mnesia.erl	Fri Apr 24 17:08:19 2009 +0100
+++ b/src/rabbit_mnesia.erl	Thu May 14 05:17:18 2009 +0000
@@ -143,7 +143,16 @@
         {disc_copies, [node()]}]},
       {rabbit_queue,
        [{record_name, amqqueue},
-       {attributes, record_info(fields, amqqueue)}]}].
+       {attributes, record_info(fields, amqqueue)}]},
+     {rabbit_vaudit,
+      [{record_name, counter},
+       {attributes, record_info(fields, counter)},
+       {disc_copies, [node()]}]},
+     {rabbit_uaudit,
+      [{record_name, counter},
+       {attributes, record_info(fields, counter)},
+       {disc_copies, [node()]}]}
+	].

  table_names() ->
      [Tab || {Tab, _} <- table_definitions()].
diff -r 2ce3d18b4383 src/rabbit_reader.erl
--- a/src/rabbit_reader.erl	Fri Apr 24 17:08:19 2009 +0100
+++ b/src/rabbit_reader.erl	Thu May 14 05:17:18 2009 +0000
@@ -613,6 +613,13 @@
                                            user = User},
                             sock = Sock}) ->
      ok = rabbit_access_control:check_vhost_access(User, VHostPath),
+
+ 	%% EricW: I'm assuming that this is a decent place to
+ 	%% do message accounting. We can get the VHost and User
+ 	%% at any rate...
+ 	mnesia:dirty_update_counter(rabbit_vaudit,VHostPath,1),
+ 	mnesia:dirty_update_counter(rabbit_uaudit,User,1),
+
      NewConnection = Connection#connection{vhost = VHostPath},
      KnownHosts =  
format_listeners(rabbit_networking:active_listeners()),
      Redirects = compute_redirects(Insist),





From jewel at subvert-the-dominant-paradigm.net  Thu May 14 14:10:34 2009
From: jewel at subvert-the-dominant-paradigm.net (John Leuner)
Date: Thu, 14 May 2009 15:10:34 +0200
Subject: [rabbitmq-discuss] Debian dependencies
In-Reply-To: <20090513111319.GA3047@mrnibble.lshift.net>
References: <1242212806.14540.38.camel@cmalu.WAG54GS>
	<20090513111319.GA3047@mrnibble.lshift.net>
Message-ID: <1242306634.14540.43.camel@cmalu.WAG54GS>

On Wed, 2009-05-13 at 12:13 +0100, Matthew Sackman wrote:
> On Wed, May 13, 2009 at 01:06:46PM +0200, John Leuner wrote:
> > I have changed the debian package to depend on the 'erlang-os-mon'
> > package recently introduced into debian unstable.
> 
> Ahh cool, I had spotted that and raised an internal bug for it. It
> seemed to me that erlang-nox should really depend on erlang-os-mon.
> Is that your feeling too (in which case I'll raise a Debian bug for
> it) or is there some reason why os-mon has mysteriously been left
> out?

I'm not sure, I asked the maintainer and he suggested erlang-nox and
erlang-os-mon.

John







From matthew at lshift.net  Thu May 14 14:30:31 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 14 May 2009 14:30:31 +0100
Subject: [rabbitmq-discuss] Debian dependencies
In-Reply-To: <1242306634.14540.43.camel@cmalu.WAG54GS>
References: <1242212806.14540.38.camel@cmalu.WAG54GS>
	<20090513111319.GA3047@mrnibble.lshift.net>
	<1242306634.14540.43.camel@cmalu.WAG54GS>
Message-ID: <20090514133031.GA16435@mrnibble.lshift.net>

On Thu, May 14, 2009 at 03:10:34PM +0200, John Leuner wrote:
> On Wed, 2009-05-13 at 12:13 +0100, Matthew Sackman wrote:
> > It
> > seemed to me that erlang-nox should really depend on erlang-os-mon.
> > Is that your feeling too (in which case I'll raise a Debian bug for
> > it) or is there some reason why os-mon has mysteriously been left
> > out?
> 
> I'm not sure, I asked the maintainer and he suggested erlang-nox and
> erlang-os-mon.

Oh ok. That strikes me as a bit odd, but I guess if there is some reason
for it...

Btw, don't your current dependencies mean that the package could never
be installed by someone who isn't using the new split-out version of
erlang, or have I missed something?

Because I don't think you're allowed parenthesis in dependencies, I can't
see how to express this more nicely, but don't you really want:

Depends: erlang-nox, erlang-os-mon | erlang-nox (<< 1:13.b-dfsg1-1),
         adduser, logrotate, ${misc:Depends}

I.e. any version of erlang-nox, but if erlang-os-mon isn't installed then
we must have -nox << 1:13.b-dfsg1-1.

That should allow the package to be installed on Debian systems without
the new split-out r13 packages, no?

Matthew



From eric at grokthis.net  Thu May 14 23:26:02 2009
From: eric at grokthis.net (Eric Windisch)
Date: Thu, 14 May 2009 18:26:02 -0400
Subject: [rabbitmq-discuss] New rabbit access control in tip?
Message-ID: <6898D37C-2666-4C7F-83FE-16050B2FE9DE@grokthis.net>

Is there yet any documentation or information on the new permissions  
system in tip?  From the source, I've figured that the syntax for  
rabbitmqctl set_permissions <username> <regexp> <regexp> <regexp>  
refers to "configuration", "write", "read".   Yet, what these regular  
expressions should be matching is not very clear.

I realize that this code is probably still in progress, but ACLs is  
something that is essential to me, and I'd like to find out what  
capability this new code provides, and how I can configure user  
permissions in the latest tip.

Regards,
Eric Windisch



From aaron.feng at gmail.com  Fri May 15 00:19:17 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Thu, 14 May 2009 19:19:17 -0400
Subject: [rabbitmq-discuss] New rabbit access control in tip?
In-Reply-To: <6898D37C-2666-4C7F-83FE-16050B2FE9DE@grokthis.net>
References: <6898D37C-2666-4C7F-83FE-16050B2FE9DE@grokthis.net>
Message-ID: <4e3934860905141619p44b08525v83781317efd89c77@mail.gmail.com>

Eric,

Is this what you are looking for?

https://dev.rabbitmq.com/wiki/AccessControlDesign

Aaron

On Thu, May 14, 2009 at 6:26 PM, Eric Windisch <eric at grokthis.net> wrote:

> Is there yet any documentation or information on the new permissions
> system in tip?  From the source, I've figured that the syntax for
> rabbitmqctl set_permissions <username> <regexp> <regexp> <regexp>
> refers to "configuration", "write", "read".   Yet, what these regular
> expressions should be matching is not very clear.
>
> I realize that this code is probably still in progress, but ACLs is
> something that is essential to me, and I'd like to find out what
> capability this new code provides, and how I can configure user
> permissions in the latest tip.
>
> Regards,
> Eric Windisch
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090514/17db34d1/attachment.htm 

From eric at grokthis.net  Fri May 15 01:08:46 2009
From: eric at grokthis.net (Eric Windisch)
Date: Thu, 14 May 2009 20:08:46 -0400
Subject: [rabbitmq-discuss] New rabbit access control in tip?
In-Reply-To: <4e3934860905141619p44b08525v83781317efd89c77@mail.gmail.com>
References: <6898D37C-2666-4C7F-83FE-16050B2FE9DE@grokthis.net>
	<4e3934860905141619p44b08525v83781317efd89c77@mail.gmail.com>
Message-ID: <BCBF2565-4105-41A4-A3C7-A60F69D2A86A@grokthis.net>


On May 14, 2009, at 7:19 PM, Aaron Feng wrote:
> Is this what you are looking for?
> https://dev.rabbitmq.com/wiki/AccessControlDesign

Yes and no.  This basically reconfirms everything that I already  
determined, even though this is not yet in sync with the actual code.   
However, what is most important is not covered by this document: the  
definition/syntax of the ConfigurationPermission and  
MessagingPermission arguments.   Until that is documented, tip is  
unusable.  Thats fine, though, it is tip after all.   Personally, I'd  
like to figure out how the new permissions systems will work as I have  
a special interest in that area and I'm even looking at fine-tuning  
permissions beyond those suggested by the AccessControlDesign document.

I understand it is a work in progress, so I've no problems with  
sitting tight for now, I just hope that more documentation will be  
available soon.

Regards,
Eric Windisch
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090514/2ee9fc53/attachment.htm 

From tperrett at googlemail.com  Fri May 15 15:42:39 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Fri, 15 May 2009 15:42:39 +0100
Subject: [rabbitmq-discuss] Where too now?
In-Reply-To: <E969196A-8F18-476C-A44C-6DC17584CE37@mu.dk>
References: <b22ab270905121010p282b27aq2a5dbd63213b4970@mail.gmail.com>
	<FFA9686B-9E28-40E5-BF20-2A4C503D882D@mu.dk>
	<b22ab270905121639o65098bdfie58aaf0c24c87759@mail.gmail.com>
	<ce47f6b80905121833u296f0b24q9eb062e626f85329@mail.gmail.com>
	<b22ab270905130439y534ec030o3b0bcd25b7235c2e@mail.gmail.com>
	<E969196A-8F18-476C-A44C-6DC17584CE37@mu.dk>
Message-ID: <b22ab270905150742i792d5f06t419de5f25eed5ed@mail.gmail.com>

Thanks for that Michael - most useful.

Based on some reading ive done elsewhere, the queues are created
programatically by the consumers? Would I be right in saying that each
application (consumer) has a single queue, and then if I want say,
granularity to session level in a web app, thats handled by the
consumer rather than creating shed loads of queues?

Cheers, Tim



On Wed, May 13, 2009 at 1:03 PM, Michael Arnoldus <chime at mu.dk> wrote:
> Senders shove messages into exchanges, bindings move them to zero or more
> queues. Clients take from the queues.
>
> Using the scenario you previouslf described we send each information type to
> a specific exchange of type fanout. The clinet has one or more queues bound
> to the exchanges it wants information from. Use one or more queues for each
> client depending on how tho client uses the info.
>
> Michael
>
> On May 13, 2009, at 13:39 , Tim Perrett wrote:
>
>> Hey Colin,
>>
>> Im using a scala abstraction that's part of the lift framework project
>> (which im a committer on). We have dispatcher and sender
>> implementations I do belive... right now im just trying to bridge the
>> knowledge gap and figure out what does what. The code is here:
>>
>> http://is.gd/zsjO
>>
>> The chap who wrote our implementation (Steve J @ twitter) is not
>> really active in the team anymore so im just trying to work through
>> what he's made and fill my knowledge gaps about rabbit mq as I go
>> along.
>>
>> Based on my vauge understand right now, the senders shove messages
>> into the ques and the dispatchers serve messages up to lisening
>> clients - applications in this case. Does that sound about right?
>>
>> Cheers, Tim
>>
>> On Wed, May 13, 2009 at 2:33 AM, Colin Z <theczintheroc2007 at gmail.com>
>> wrote:
>>>
>>> Depends on what languages you will use to interface with the Rabbit
>>> server/cluster.
>>>
>>> I found the C# client library very easy to use. The Erlang client library
>>> was a little bit tricker and I ran into some error-handling issues but I
>>> think these were fixed in more recent versions, I haven't checked.
>>>
>>> IMHO, the team has done an excellent job of making Rabbit as "fire and
>>> forget" as an Erlang app can be.
>>>
>>>
>>>
>>> On Tue, May 12, 2009 at 7:39 PM, Tim Perrett <tperrett at googlemail.com>
>>> wrote:
>>>>
>>>> Thanks Michael, thats good to hear.
>>>>
>>>> Any advice on the implementation? what to do and what to avoid?
>>>>
>>>> Cheers, Tim
>>>>
>>>> On Tue, May 12, 2009 at 7:50 PM, Michael Arnoldus <chime at mu.dk> wrote:
>>>>>
>>>>> Hi Tim,
>>>>>
>>>>> Sounds like a good plan. We're using AMQP for exactly the same purpose
>>>>> in
>>>>> the same way.
>>>>>
>>>>> Regards,
>>>>>
>>>>> Michael Arnoldus
>>>>>
>>>>>
>>>>> On May 12, 2009, at 19:10 , Tim Perrett wrote:
>>>>>
>>>>>> Hey guys,
>>>>>>
>>>>>> This is my first post to this list - im afraid im a bit of a rabbitmq
>>>>>> n00bie! I've got everything setup and working and now looking to do
>>>>>> something good with it to understand how it all works for my use case.
>>>>>>
>>>>>> Essentially I have some backend tools that expose services with SOAP -
>>>>>> for which my app will repeatedly get data from - probably every 10
>>>>>> seconds, maybe less i've not decided yet. Anyway... said app gets said
>>>>>> data from those services. What I would then like it to do is notify
>>>>>> any other consumers (which will be other applications) that have opted
>>>>>> to subscribe to information / updates about that job via AMQP.
>>>>>> Consumers will also be able to hand messages to the central service
>>>>>> and effectively say "deal with this job and notify me about any
>>>>>> changes".
>>>>>>
>>>>>> Now then, excuse my complete ignorance, but its possible to build such
>>>>>> a workflow, right? Any pro's / con's in doing this? What would be the
>>>>>> optimal way to build such a system from a RabbitMQ POV?
>>>>>>
>>>>>> Just looking for a bit of a sounding board right now so any
>>>>>> information / feedback would be greatly appreciated.
>>>>>>
>>>>>> Cheers, Tim
>>>>>>
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Fri May 15 17:13:18 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 15 May 2009 17:13:18 +0100
Subject: [rabbitmq-discuss] New rabbit access control in tip?
In-Reply-To: <BCBF2565-4105-41A4-A3C7-A60F69D2A86A@grokthis.net>
References: <6898D37C-2666-4C7F-83FE-16050B2FE9DE@grokthis.net>	<4e3934860905141619p44b08525v83781317efd89c77@mail.gmail.com>
	<BCBF2565-4105-41A4-A3C7-A60F69D2A86A@grokthis.net>
Message-ID: <4A0D949E.60101@lshift.net>

Eric,

Eric Windisch wrote:
> 
> On May 14, 2009, at 7:19 PM, Aaron Feng wrote:
>> Is this what you are looking for?
>> https://dev.rabbitmq.com/wiki/AccessControlDesign
> 
> Yes and no.  This basically reconfirms everything that I already 
> determined, even though this is not yet in sync with the actual code. 
>  However, what is most important is not covered by this document: the 
> definition/syntax of the ConfigurationPermission and MessagingPermission 
> arguments.   Until that is documented, tip is unusable.  Thats fine, 
> though, it is tip after all.

Presumably by 'tip' you mean "tip of the 'default' branch".

To get the existing behaviour on 'default', set the permissions of users 
to ".*", e.g.
   rabbitmqctl set_permissions -p /myvhost matthias ".*" ".*" ".*"

The link above points to some early design docs; the actual 
implementation is slightly different and the docs for it will be 
published together with the official release of that feature.


Regards,

Matthias.



From tperrett at googlemail.com  Sat May 16 11:22:48 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Sat, 16 May 2009 11:22:48 +0100
Subject: [rabbitmq-discuss] Broken Install on OSX?
Message-ID: <b22ab270905160322jdf6059aqe2415af07972e0c1@mail.gmail.com>

Guys,

This is probably a very noobie question, but everything was previously
working perfectly, and now its just broken. For some reason
rabbitmqctl appears to not be able to see the running broker? I worked
through this post:

http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/

And based on whats detailed there, he suggests its an issue with
rabbitmq not running as the rabbitmq user? Im running on OSX and did a
manual install.

Any advice / help is greatly appreciated.

Thanks, Tim



From tperrett at googlemail.com  Sat May 16 11:37:26 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Sat, 16 May 2009 11:37:26 +0100
Subject: [rabbitmq-discuss] Broken Install on OSX?
In-Reply-To: <b22ab270905160322jdf6059aqe2415af07972e0c1@mail.gmail.com>
References: <b22ab270905160322jdf6059aqe2415af07972e0c1@mail.gmail.com>
Message-ID: <b22ab270905160337w54c98110p547d4b3899aa15d8@mail.gmail.com>

Sorry, just to add some more information - when I run:

macbookpro:~ timperrett$ sudo rabbitmq-server
RabbitMQ 1.5.4 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

Logging to "/var/log/rabbitmq/rabbit.log"
SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done

broker running

Then in another terminal I run:

macbookpro:~ timperrett$ sudo rabbitmqctl status
Status of node rabbit at macbookpro ...
{badrpc,nodedown}
...done.

I then tried:

timperrett$ sudo -u rabbitmq rabbitmq-server
{error_logger,{{2009,5,16},{11,34,45}},"Failed to create cookie file",[]}
{error_logger,{{2009,5,16},{11,34,45}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{"Failed
to create cookie
file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.18.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,580}],[]]}
{error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Failed
to create cookie
file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfa,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2009,5,16},{11,34,45}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

Thanks

Tim


On Sat, May 16, 2009 at 11:22 AM, Tim Perrett <tperrett at googlemail.com> wrote:
> Guys,
>
> This is probably a very noobie question, but everything was previously
> working perfectly, and now its just broken. For some reason
> rabbitmqctl appears to not be able to see the running broker? I worked
> through this post:
>
> http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/
>
> And based on whats detailed there, he suggests its an issue with
> rabbitmq not running as the rabbitmq user? Im running on OSX and did a
> manual install.
>
> Any advice / help is greatly appreciated.
>
> Thanks, Tim
>



From tperrett at googlemail.com  Sat May 16 18:47:51 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Sat, 16 May 2009 18:47:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ on OSX - Having Problems...
Message-ID: <b22ab270905161047g7be9c1d1je6557015244d1718@mail.gmail.com>

Ok, so I completely scrapped this and started again, this time with
macports to ensure it was nothing stupid i was doing causing the
problem. So, I installed via macports, and following the instructions:

sudo -H -u rabbitmq rabbitmq-server

Great I thought! It works out of the box... however, if i open another
terminal, the rabbitmqctl doesnt find the running server still.

Any ideas? This is really starting to do my head in!

Cheers, Tim

On Sat, May 16, 2009 at 11:37 AM, Tim Perrett <tperrett at googlemail.com> wrote:
> Sorry, just to add some more information - when I run:
>
> macbookpro:~ timperrett$ sudo rabbitmq-server
> RabbitMQ 1.5.4 (AMQP 8-0)
> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
> LLC., and Rabbit Technologies Ltd.
> Licensed under the MPL. ?See http://www.rabbitmq.com/
>
> Logging to "/var/log/rabbitmq/rabbit.log"
> SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"
>
> starting database ? ? ? ? ? ? ...done
> starting core processes ? ? ? ...done
> starting recovery ? ? ? ? ? ? ...done
> starting persister ? ? ? ? ? ?...done
> starting guid generator ? ? ? ...done
> starting builtin applications ...done
> starting TCP listeners ? ? ? ?...done
>
> broker running
>
> Then in another terminal I run:
>
> macbookpro:~ timperrett$ sudo rabbitmqctl status
> Status of node rabbit at macbookpro ...
> {badrpc,nodedown}
> ...done.
>
> I then tried:
>
> timperrett$ sudo -u rabbitmq rabbitmq-server
> {error_logger,{{2009,5,16},{11,34,45}},"Failed to create cookie file",[]}
> {error_logger,{{2009,5,16},{11,34,45}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{"Failed
> to create cookie
> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.18.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,580}],[]]}
> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Failed
> to create cookie
> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfa,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2009,5,16},{11,34,45}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>
> Thanks
>
> Tim
>
>
> On Sat, May 16, 2009 at 11:22 AM, Tim Perrett <tperrett at googlemail.com> wrote:
>> Guys,
>>
>> This is probably a very noobie question, but everything was previously
>> working perfectly, and now its just broken. For some reason
>> rabbitmqctl appears to not be able to see the running broker? I worked
>> through this post:
>>
>> http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/
>>
>> And based on whats detailed there, he suggests its an issue with
>> rabbitmq not running as the rabbitmq user? Im running on OSX and did a
>> manual install.
>>
>> Any advice / help is greatly appreciated.
>>
>> Thanks, Tim
>>
>



From celldee at gmail.com  Sat May 16 19:30:29 2009
From: celldee at gmail.com (Chris Duncan)
Date: Sat, 16 May 2009 19:30:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ on OSX - Having Problems...
In-Reply-To: <b22ab270905161047g7be9c1d1je6557015244d1718@mail.gmail.com>
References: <b22ab270905161047g7be9c1d1je6557015244d1718@mail.gmail.com>
Message-ID: <0355AFBD-5803-4F76-80BB-BA499BBADC7A@gmail.com>

Hi Tim,

The easiest way that I found to run RabbitMQ on OSX was to use the  
generic unix download - http://www.rabbitmq.com/releases/rabbitmq- 
server/v1.5.4/rabbitmq-server-generic-unix-1.5.4.tar.gz

I installed Erlang via Macports so I unpacked the RabbitMQ .tar.gz  
into /opt/local/lib/erlang/lib

Then I run the server with the command -

sudo /opt/local/lib/erlang/lib/rabbitmq_server-1.5.4/sbin/rabbitmq- 
server -detached

The '-detached' option runs it in the background. I run it as root  
because by default it wants to write to /var/log and I haven't gotten  
around to changing things.

The rabbitmqctl command -

/opt/local/lib/erlang/lib/rabbitmq_server-1.5.4/sbin/rabbitmqctl

Obviously you can create aliases etc. to make life easier.

HTH :)

Regards,

Chris



On 16 May 2009, at 18:47, Tim Perrett wrote:

> Ok, so I completely scrapped this and started again, this time with
> macports to ensure it was nothing stupid i was doing causing the
> problem. So, I installed via macports, and following the instructions:
>
> sudo -H -u rabbitmq rabbitmq-server
>
> Great I thought! It works out of the box... however, if i open another
> terminal, the rabbitmqctl doesnt find the running server still.
>
> Any ideas? This is really starting to do my head in!
>
> Cheers, Tim
>
> On Sat, May 16, 2009 at 11:37 AM, Tim Perrett  
> <tperrett at googlemail.com> wrote:
>> Sorry, just to add some more information - when I run:
>>
>> macbookpro:~ timperrett$ sudo rabbitmq-server
>> RabbitMQ 1.5.4 (AMQP 8-0)
>> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
>> LLC., and Rabbit Technologies Ltd.
>> Licensed under the MPL.  See http://www.rabbitmq.com/
>>
>> Logging to "/var/log/rabbitmq/rabbit.log"
>> SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"
>>
>> starting database             ...done
>> starting core processes       ...done
>> starting recovery             ...done
>> starting persister            ...done
>> starting guid generator       ...done
>> starting builtin applications ...done
>> starting TCP listeners        ...done
>>
>> broker running
>>
>> Then in another terminal I run:
>>
>> macbookpro:~ timperrett$ sudo rabbitmqctl status
>> Status of node rabbit at macbookpro ...
>> {badrpc,nodedown}
>> ...done.
>>
>> I then tried:
>>
>> timperrett$ sudo -u rabbitmq rabbitmq-server
>> {error_logger,{{2009,5,16},{11,34,45}},"Failed to create cookie  
>> file",[]}
>> {error_logger,{{2009,5,16},{11,34,45}},crash_report, 
>> [[{initial_call,{auth,init,['Argument__1']}},{pid,<0.20.0>}, 
>> {registered_name,[]},{error_info,{exit,{"Failed
>> to create cookie
>> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6}, 
>> {proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6}, 
>> {proc_lib,init_p_do_apply,3}]}},{ancestors, 
>> [net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.18.0>]}, 
>> {dictionary,[]},{trap_exit,true},{status,running},{heap_size,610}, 
>> {stack_size,24},{reductions,580}],[]]}
>> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report, 
>> [{supervisor,{local,net_sup}},{errorContext,start_error},{reason, 
>> {"Failed
>> to create cookie
>> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6}, 
>> {proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined}, 
>> {name,auth},{mfa,{auth,start_link,[]}},{restart_type,permanent}, 
>> {shutdown,2000},{child_type,worker}]}]}
>> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report, 
>> [{supervisor,{local,kernel_sup}},{errorContext,start_error}, 
>> {reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa, 
>> {erl_distribution,start_link,[]}},{restart_type,permanent}, 
>> {shutdown,infinity},{child_type,supervisor}]}]}
>> {error_logger,{{2009,5,16},{11,34,45}},std_info, 
>> [{application,kernel},{exited,{shutdown,{kernel,start,[normal, 
>> []]}}},{type,permanent}]}
>> {"Kernel pid  
>> terminated",application_controller,"{application_start_failure,kernel 
>> ,{shutdown,{kernel,start,[normal,[]]}}}"}
>>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller)
>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal, 
>> []]}}})
>>
>> Thanks
>>
>> Tim
>>
>>
>> On Sat, May 16, 2009 at 11:22 AM, Tim Perrett  
>> <tperrett at googlemail.com> wrote:
>>> Guys,
>>>
>>> This is probably a very noobie question, but everything was  
>>> previously
>>> working perfectly, and now its just broken. For some reason
>>> rabbitmqctl appears to not be able to see the running broker? I  
>>> worked
>>> through this post:
>>>
>>> http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/
>>>
>>> And based on whats detailed there, he suggests its an issue with
>>> rabbitmq not running as the rabbitmq user? Im running on OSX and  
>>> did a
>>> manual install.
>>>
>>> Any advice / help is greatly appreciated.
>>>
>>> Thanks, Tim
>>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From tperrett at googlemail.com  Sat May 16 20:26:34 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Sat, 16 May 2009 20:26:34 +0100
Subject: [rabbitmq-discuss] RabbitMQ on OSX - Having Problems...
In-Reply-To: <0355AFBD-5803-4F76-80BB-BA499BBADC7A@gmail.com>
References: <b22ab270905161047g7be9c1d1je6557015244d1718@mail.gmail.com>
	<0355AFBD-5803-4F76-80BB-BA499BBADC7A@gmail.com>
Message-ID: <b22ab270905161226k19b02484wd313d37078b3ffc5@mail.gmail.com>

Hey Chris,

I agree - thats why i started with the unix install. I just seem to be
having consistent problems right now. Anywho...

Rabbit is up and running, i've actually not really had a problem with
getting the server booted, just dont appear to be able to get the
connection from rabbitmqctl - not overly helpfull as i need to
configure the server. I can telnet to it etc.

I've been doing some digging, and looking at what processes are
running, i see both the rabbit server and the ctl coming up under the
"rabbitmq" user i've created on my system.

Otherwise, the only thing that is not ringing true is that the
.erlang.cookie does not appear to be written to the place detailed on
the install guide:

$MACPORTS_PREFIX/var/lib/rabbitmq/.erlang.cookie.

Could it be that the rabbitmqctl cant find the cookie? perhaps?

Cheers, Tim

On Sat, May 16, 2009 at 7:30 PM, Chris Duncan <celldee at gmail.com> wrote:
> Hi Tim,
>
> The easiest way that I found to run RabbitMQ on OSX was to use the generic
> unix download -
> http://www.rabbitmq.com/releases/rabbitmq-server/v1.5.4/rabbitmq-server-generic-unix-1.5.4.tar.gz
>
> I installed Erlang via Macports so I unpacked the RabbitMQ .tar.gz into
> /opt/local/lib/erlang/lib
>
> Then I run the server with the command -
>
> sudo /opt/local/lib/erlang/lib/rabbitmq_server-1.5.4/sbin/rabbitmq-server
> -detached
>
> The '-detached' option runs it in the background. I run it as root because
> by default it wants to write to /var/log and I haven't gotten around to
> changing things.
>
> The rabbitmqctl command -
>
> /opt/local/lib/erlang/lib/rabbitmq_server-1.5.4/sbin/rabbitmqctl
>
> Obviously you can create aliases etc. to make life easier.
>
> HTH :)
>
> Regards,
>
> Chris
>
>
>
> On 16 May 2009, at 18:47, Tim Perrett wrote:
>
>> Ok, so I completely scrapped this and started again, this time with
>> macports to ensure it was nothing stupid i was doing causing the
>> problem. So, I installed via macports, and following the instructions:
>>
>> sudo -H -u rabbitmq rabbitmq-server
>>
>> Great I thought! It works out of the box... however, if i open another
>> terminal, the rabbitmqctl doesnt find the running server still.
>>
>> Any ideas? This is really starting to do my head in!
>>
>> Cheers, Tim
>>
>> On Sat, May 16, 2009 at 11:37 AM, Tim Perrett <tperrett at googlemail.com>
>> wrote:
>>>
>>> Sorry, just to add some more information - when I run:
>>>
>>> macbookpro:~ timperrett$ sudo rabbitmq-server
>>> RabbitMQ 1.5.4 (AMQP 8-0)
>>> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
>>> LLC., and Rabbit Technologies Ltd.
>>> Licensed under the MPL. ?See http://www.rabbitmq.com/
>>>
>>> Logging to "/var/log/rabbitmq/rabbit.log"
>>> SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"
>>>
>>> starting database ? ? ? ? ? ? ...done
>>> starting core processes ? ? ? ...done
>>> starting recovery ? ? ? ? ? ? ...done
>>> starting persister ? ? ? ? ? ?...done
>>> starting guid generator ? ? ? ...done
>>> starting builtin applications ...done
>>> starting TCP listeners ? ? ? ?...done
>>>
>>> broker running
>>>
>>> Then in another terminal I run:
>>>
>>> macbookpro:~ timperrett$ sudo rabbitmqctl status
>>> Status of node rabbit at macbookpro ...
>>> {badrpc,nodedown}
>>> ...done.
>>>
>>> I then tried:
>>>
>>> timperrett$ sudo -u rabbitmq rabbitmq-server
>>> {error_logger,{{2009,5,16},{11,34,45}},"Failed to create cookie file",[]}
>>>
>>> {error_logger,{{2009,5,16},{11,34,45}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{"Failed
>>> to create cookie
>>>
>>> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.18.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,580}],[]]}
>>>
>>> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Failed
>>> to create cookie
>>>
>>> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfa,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>>
>>> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>>
>>> {error_logger,{{2009,5,16},{11,34,45}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>>> {"Kernel pid
>>> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>>
>>> Crash dump was written to: erl_crash.dump
>>> Kernel pid terminated (application_controller)
>>>
>>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>>>
>>> Thanks
>>>
>>> Tim
>>>
>>>
>>> On Sat, May 16, 2009 at 11:22 AM, Tim Perrett <tperrett at googlemail.com>
>>> wrote:
>>>>
>>>> Guys,
>>>>
>>>> This is probably a very noobie question, but everything was previously
>>>> working perfectly, and now its just broken. For some reason
>>>> rabbitmqctl appears to not be able to see the running broker? I worked
>>>> through this post:
>>>>
>>>> http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/
>>>>
>>>> And based on whats detailed there, he suggests its an issue with
>>>> rabbitmq not running as the rabbitmq user? Im running on OSX and did a
>>>> manual install.
>>>>
>>>> Any advice / help is greatly appreciated.
>>>>
>>>> Thanks, Tim
>>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From tperrett at googlemail.com  Sat May 16 20:52:14 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Sat, 16 May 2009 20:52:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ on OSX - Having Problems...
In-Reply-To: <b22ab270905161226k19b02484wd313d37078b3ffc5@mail.gmail.com>
References: <b22ab270905161047g7be9c1d1je6557015244d1718@mail.gmail.com>
	<0355AFBD-5803-4F76-80BB-BA499BBADC7A@gmail.com>
	<b22ab270905161226k19b02484wd313d37078b3ffc5@mail.gmail.com>
Message-ID: <b22ab270905161252u5ba2ea14x79abbddc39ed9573@mail.gmail.com>

Just reading this (for the n'th time!)

http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/

When i run the the erl shell with: ?erl -sname foo -cookie coo? and
run this command: ?net_adm:names().? I keep seeing the rabbit in the
list (its my understanding that it should not feature there?)

Thoughts?

Cheers, Tim

On Sat, May 16, 2009 at 8:26 PM, Tim Perrett <tperrett at googlemail.com> wrote:
> Hey Chris,
>
> I agree - thats why i started with the unix install. I just seem to be
> having consistent problems right now. Anywho...
>
> Rabbit is up and running, i've actually not really had a problem with
> getting the server booted, just dont appear to be able to get the
> connection from rabbitmqctl - not overly helpfull as i need to
> configure the server. I can telnet to it etc.
>
> I've been doing some digging, and looking at what processes are
> running, i see both the rabbit server and the ctl coming up under the
> "rabbitmq" user i've created on my system.
>
> Otherwise, the only thing that is not ringing true is that the
> .erlang.cookie does not appear to be written to the place detailed on
> the install guide:
>
> $MACPORTS_PREFIX/var/lib/rabbitmq/.erlang.cookie.
>
> Could it be that the rabbitmqctl cant find the cookie? perhaps?
>
> Cheers, Tim
>
> On Sat, May 16, 2009 at 7:30 PM, Chris Duncan <celldee at gmail.com> wrote:
>> Hi Tim,
>>
>> The easiest way that I found to run RabbitMQ on OSX was to use the generic
>> unix download -
>> http://www.rabbitmq.com/releases/rabbitmq-server/v1.5.4/rabbitmq-server-generic-unix-1.5.4.tar.gz
>>
>> I installed Erlang via Macports so I unpacked the RabbitMQ .tar.gz into
>> /opt/local/lib/erlang/lib
>>
>> Then I run the server with the command -
>>
>> sudo /opt/local/lib/erlang/lib/rabbitmq_server-1.5.4/sbin/rabbitmq-server
>> -detached
>>
>> The '-detached' option runs it in the background. I run it as root because
>> by default it wants to write to /var/log and I haven't gotten around to
>> changing things.
>>
>> The rabbitmqctl command -
>>
>> /opt/local/lib/erlang/lib/rabbitmq_server-1.5.4/sbin/rabbitmqctl
>>
>> Obviously you can create aliases etc. to make life easier.
>>
>> HTH :)
>>
>> Regards,
>>
>> Chris
>>
>>
>>
>> On 16 May 2009, at 18:47, Tim Perrett wrote:
>>
>>> Ok, so I completely scrapped this and started again, this time with
>>> macports to ensure it was nothing stupid i was doing causing the
>>> problem. So, I installed via macports, and following the instructions:
>>>
>>> sudo -H -u rabbitmq rabbitmq-server
>>>
>>> Great I thought! It works out of the box... however, if i open another
>>> terminal, the rabbitmqctl doesnt find the running server still.
>>>
>>> Any ideas? This is really starting to do my head in!
>>>
>>> Cheers, Tim
>>>
>>> On Sat, May 16, 2009 at 11:37 AM, Tim Perrett <tperrett at googlemail.com>
>>> wrote:
>>>>
>>>> Sorry, just to add some more information - when I run:
>>>>
>>>> macbookpro:~ timperrett$ sudo rabbitmq-server
>>>> RabbitMQ 1.5.4 (AMQP 8-0)
>>>> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
>>>> LLC., and Rabbit Technologies Ltd.
>>>> Licensed under the MPL. ?See http://www.rabbitmq.com/
>>>>
>>>> Logging to "/var/log/rabbitmq/rabbit.log"
>>>> SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"
>>>>
>>>> starting database ? ? ? ? ? ? ...done
>>>> starting core processes ? ? ? ...done
>>>> starting recovery ? ? ? ? ? ? ...done
>>>> starting persister ? ? ? ? ? ?...done
>>>> starting guid generator ? ? ? ...done
>>>> starting builtin applications ...done
>>>> starting TCP listeners ? ? ? ?...done
>>>>
>>>> broker running
>>>>
>>>> Then in another terminal I run:
>>>>
>>>> macbookpro:~ timperrett$ sudo rabbitmqctl status
>>>> Status of node rabbit at macbookpro ...
>>>> {badrpc,nodedown}
>>>> ...done.
>>>>
>>>> I then tried:
>>>>
>>>> timperrett$ sudo -u rabbitmq rabbitmq-server
>>>> {error_logger,{{2009,5,16},{11,34,45}},"Failed to create cookie file",[]}
>>>>
>>>> {error_logger,{{2009,5,16},{11,34,45}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{"Failed
>>>> to create cookie
>>>>
>>>> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.18.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,580}],[]]}
>>>>
>>>> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Failed
>>>> to create cookie
>>>>
>>>> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfa,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>>>
>>>> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>>>
>>>> {error_logger,{{2009,5,16},{11,34,45}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>>>> {"Kernel pid
>>>> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>>>
>>>> Crash dump was written to: erl_crash.dump
>>>> Kernel pid terminated (application_controller)
>>>>
>>>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>>>>
>>>> Thanks
>>>>
>>>> Tim
>>>>
>>>>
>>>> On Sat, May 16, 2009 at 11:22 AM, Tim Perrett <tperrett at googlemail.com>
>>>> wrote:
>>>>>
>>>>> Guys,
>>>>>
>>>>> This is probably a very noobie question, but everything was previously
>>>>> working perfectly, and now its just broken. For some reason
>>>>> rabbitmqctl appears to not be able to see the running broker? I worked
>>>>> through this post:
>>>>>
>>>>> http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/
>>>>>
>>>>> And based on whats detailed there, he suggests its an issue with
>>>>> rabbitmq not running as the rabbitmq user? Im running on OSX and did a
>>>>> manual install.
>>>>>
>>>>> Any advice / help is greatly appreciated.
>>>>>
>>>>> Thanks, Tim
>>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>



From dmitriy.samovskiy at cohesiveft.com  Sun May 17 02:47:59 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Sat, 16 May 2009 20:47:59 -0500
Subject: [rabbitmq-discuss] RabbitMQ on OSX - Having Problems...
In-Reply-To: <b22ab270905161252u5ba2ea14x79abbddc39ed9573@mail.gmail.com>
References: <b22ab270905161047g7be9c1d1je6557015244d1718@mail.gmail.com>	<0355AFBD-5803-4F76-80BB-BA499BBADC7A@gmail.com>	<b22ab270905161226k19b02484wd313d37078b3ffc5@mail.gmail.com>
	<b22ab270905161252u5ba2ea14x79abbddc39ed9573@mail.gmail.com>
Message-ID: <4A0F6CCF.3090208@cohesiveft.com>

Hi Tim,

Since net_adm:names() does not hang and returns a list which includes rabbit, looks to me 
like the problem is with cookies or something related which causes nodes not to be able to 
talk to each other.

So, assuming your broker is in fact running as user rabbitmq, I'd try this:

Check that home directory of user rabbitmq exists and is writeable by user rabbitmq.
If broker is running as rabbitmq, there should probably be a file in that dir called 
.erlang.cookie, owned by user rabbitmq.

You should be able to do su - rabbitmq and then erl -sname foo -remsh rabbit at HOSTNAME 
(HOSTNAME is probably going to be whatever is returned by net_adm:localhost() up to a 
first dot).

Alternatively, if you cat ~rabbitmq/.erlang.cookie and get cookie itself (e.g, COOKIE), as 
any user on your system, you should be able to do this:

erl -sname foo -remsg rabbit at HOSTNAME -cookie COOKIE


This error message is weird however:
 > timperrett$ sudo -u rabbitmq rabbitmq-server
 > {error_logger,{{2009,5,16},{11,34,45}},"Failed to create cookie file",[]}

To me it looks like there's something wrong with how user rabbitmq is set up on your 
system. Either it has no home dir, home dir is not defined or maybe it's not writeable.

I don't have any hands-on experience with running rabbitmq on Mac though, I run it only on 
Linux.

HTH,
Dmitriy



Tim Perrett wrote:
> Just reading this (for the n'th time!)
> 
> http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/
> 
> When i run the the erl shell with: ?erl -sname foo -cookie coo? and
> run this command: ?net_adm:names().? I keep seeing the rabbit in the
> list (its my understanding that it should not feature there?)
> 
> Thoughts?
> 
> Cheers, Tim
> 
> On Sat, May 16, 2009 at 8:26 PM, Tim Perrett <tperrett at googlemail.com> wrote:
>> Hey Chris,
>>
>> I agree - thats why i started with the unix install. I just seem to be
>> having consistent problems right now. Anywho...
>>
>> Rabbit is up and running, i've actually not really had a problem with
>> getting the server booted, just dont appear to be able to get the
>> connection from rabbitmqctl - not overly helpfull as i need to
>> configure the server. I can telnet to it etc.
>>
>> I've been doing some digging, and looking at what processes are
>> running, i see both the rabbit server and the ctl coming up under the
>> "rabbitmq" user i've created on my system.
>>
>> Otherwise, the only thing that is not ringing true is that the
>> .erlang.cookie does not appear to be written to the place detailed on
>> the install guide:
>>
>> $MACPORTS_PREFIX/var/lib/rabbitmq/.erlang.cookie.
>>
>> Could it be that the rabbitmqctl cant find the cookie? perhaps?
>>
>> Cheers, Tim
>>
>> On Sat, May 16, 2009 at 7:30 PM, Chris Duncan <celldee at gmail.com> wrote:
>>> Hi Tim,
>>>
>>> The easiest way that I found to run RabbitMQ on OSX was to use the generic
>>> unix download -
>>> http://www.rabbitmq.com/releases/rabbitmq-server/v1.5.4/rabbitmq-server-generic-unix-1.5.4.tar.gz
>>>
>>> I installed Erlang via Macports so I unpacked the RabbitMQ .tar.gz into
>>> /opt/local/lib/erlang/lib
>>>
>>> Then I run the server with the command -
>>>
>>> sudo /opt/local/lib/erlang/lib/rabbitmq_server-1.5.4/sbin/rabbitmq-server
>>> -detached
>>>
>>> The '-detached' option runs it in the background. I run it as root because
>>> by default it wants to write to /var/log and I haven't gotten around to
>>> changing things.
>>>
>>> The rabbitmqctl command -
>>>
>>> /opt/local/lib/erlang/lib/rabbitmq_server-1.5.4/sbin/rabbitmqctl
>>>
>>> Obviously you can create aliases etc. to make life easier.
>>>
>>> HTH :)
>>>
>>> Regards,
>>>
>>> Chris
>>>
>>>
>>>
>>> On 16 May 2009, at 18:47, Tim Perrett wrote:
>>>
>>>> Ok, so I completely scrapped this and started again, this time with
>>>> macports to ensure it was nothing stupid i was doing causing the
>>>> problem. So, I installed via macports, and following the instructions:
>>>>
>>>> sudo -H -u rabbitmq rabbitmq-server
>>>>
>>>> Great I thought! It works out of the box... however, if i open another
>>>> terminal, the rabbitmqctl doesnt find the running server still.
>>>>
>>>> Any ideas? This is really starting to do my head in!
>>>>
>>>> Cheers, Tim
>>>>
>>>> On Sat, May 16, 2009 at 11:37 AM, Tim Perrett <tperrett at googlemail.com>
>>>> wrote:
>>>>> Sorry, just to add some more information - when I run:
>>>>>
>>>>> macbookpro:~ timperrett$ sudo rabbitmq-server
>>>>> RabbitMQ 1.5.4 (AMQP 8-0)
>>>>> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
>>>>> LLC., and Rabbit Technologies Ltd.
>>>>> Licensed under the MPL.  See http://www.rabbitmq.com/
>>>>>
>>>>> Logging to "/var/log/rabbitmq/rabbit.log"
>>>>> SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"
>>>>>
>>>>> starting database             ...done
>>>>> starting core processes       ...done
>>>>> starting recovery             ...done
>>>>> starting persister            ...done
>>>>> starting guid generator       ...done
>>>>> starting builtin applications ...done
>>>>> starting TCP listeners        ...done
>>>>>
>>>>> broker running
>>>>>
>>>>> Then in another terminal I run:
>>>>>
>>>>> macbookpro:~ timperrett$ sudo rabbitmqctl status
>>>>> Status of node rabbit at macbookpro ...
>>>>> {badrpc,nodedown}
>>>>> ...done.
>>>>>
>>>>> I then tried:
>>>>>
>>>>> timperrett$ sudo -u rabbitmq rabbitmq-server
>>>>> {error_logger,{{2009,5,16},{11,34,45}},"Failed to create cookie file",[]}
>>>>>
>>>>> {error_logger,{{2009,5,16},{11,34,45}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{"Failed
>>>>> to create cookie
>>>>>
>>>>> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.18.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,580}],[]]}
>>>>>
>>>>> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Failed
>>>>> to create cookie
>>>>>
>>>>> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfa,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>>>>
>>>>> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>>>>
>>>>> {error_logger,{{2009,5,16},{11,34,45}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>>>>> {"Kernel pid
>>>>> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>>>>
>>>>> Crash dump was written to: erl_crash.dump
>>>>> Kernel pid terminated (application_controller)
>>>>>
>>>>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>>>>>
>>>>> Thanks
>>>>>
>>>>> Tim
>>>>>
>>>>>
>>>>> On Sat, May 16, 2009 at 11:22 AM, Tim Perrett <tperrett at googlemail.com>
>>>>> wrote:
>>>>>> Guys,
>>>>>>
>>>>>> This is probably a very noobie question, but everything was previously
>>>>>> working perfectly, and now its just broken. For some reason
>>>>>> rabbitmqctl appears to not be able to see the running broker? I worked
>>>>>> through this post:
>>>>>>
>>>>>> http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/
>>>>>>
>>>>>> And based on whats detailed there, he suggests its an issue with
>>>>>> rabbitmq not running as the rabbitmq user? Im running on OSX and did a
>>>>>> manual install.
>>>>>>
>>>>>> Any advice / help is greatly appreciated.
>>>>>>
>>>>>> Thanks, Tim
>>>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 



From tperrett at googlemail.com  Sun May 17 12:13:29 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Sun, 17 May 2009 12:13:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ on OSX - Having Problems...
In-Reply-To: <4A0F6CCF.3090208@cohesiveft.com>
References: <b22ab270905161047g7be9c1d1je6557015244d1718@mail.gmail.com>
	<0355AFBD-5803-4F76-80BB-BA499BBADC7A@gmail.com>
	<b22ab270905161226k19b02484wd313d37078b3ffc5@mail.gmail.com>
	<b22ab270905161252u5ba2ea14x79abbddc39ed9573@mail.gmail.com>
	<4A0F6CCF.3090208@cohesiveft.com>
Message-ID: <b22ab270905170413v1da8998aq7621daeddabacd35@mail.gmail.com>

Morning Dmitriy,

Thanks for your response. I actually managed to fix it really late
last night. It appears that in the sharing preferences of OSX you set
the network sharing name, mine was "macbookpro". I then started to
fiddle around and found that I needed to add "macbookpro" to my
/etc/hosts file in order for rabbitmqctl to work...

The interesting is that before I added the hosts record, I could still
ping "macbookpro". So im not sure how RabbitMQ resolves the hosts, but
it must bypass whatever internal mechanism OSX uses.

Sorry about spamming the list - was kind of clutching at straws last
night when I finally got this to work!

Cheers, Tim

On Sun, May 17, 2009 at 2:47 AM, Dmitriy Samovskiy
<dmitriy.samovskiy at cohesiveft.com> wrote:
> Hi Tim,
>
> Since net_adm:names() does not hang and returns a list which includes
> rabbit, looks to me like the problem is with cookies or something related
> which causes nodes not to be able to talk to each other.
>
> So, assuming your broker is in fact running as user rabbitmq, I'd try this:
>
> Check that home directory of user rabbitmq exists and is writeable by user
> rabbitmq.
> If broker is running as rabbitmq, there should probably be a file in that
> dir called .erlang.cookie, owned by user rabbitmq.
>
> You should be able to do su - rabbitmq and then erl -sname foo -remsh
> rabbit at HOSTNAME (HOSTNAME is probably going to be whatever is returned by
> net_adm:localhost() up to a first dot).
>
> Alternatively, if you cat ~rabbitmq/.erlang.cookie and get cookie itself
> (e.g, COOKIE), as any user on your system, you should be able to do this:
>
> erl -sname foo -remsg rabbit at HOSTNAME -cookie COOKIE
>
>
> This error message is weird however:
>> timperrett$ sudo -u rabbitmq rabbitmq-server
>> {error_logger,{{2009,5,16},{11,34,45}},"Failed to create cookie file",[]}
>
> To me it looks like there's something wrong with how user rabbitmq is set up
> on your system. Either it has no home dir, home dir is not defined or maybe
> it's not writeable.
>
> I don't have any hands-on experience with running rabbitmq on Mac though, I
> run it only on Linux.
>
> HTH,
> Dmitriy
>
>
>
> Tim Perrett wrote:
>>
>> Just reading this (for the n'th time!)
>>
>> http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/
>>
>> When i run the the erl shell with: ?erl -sname foo -cookie coo? and
>> run this command: ?net_adm:names().? I keep seeing the rabbit in the
>> list (its my understanding that it should not feature there?)
>>
>> Thoughts?
>>
>> Cheers, Tim
>>
>> On Sat, May 16, 2009 at 8:26 PM, Tim Perrett <tperrett at googlemail.com>
>> wrote:
>>>
>>> Hey Chris,
>>>
>>> I agree - thats why i started with the unix install. I just seem to be
>>> having consistent problems right now. Anywho...
>>>
>>> Rabbit is up and running, i've actually not really had a problem with
>>> getting the server booted, just dont appear to be able to get the
>>> connection from rabbitmqctl - not overly helpfull as i need to
>>> configure the server. I can telnet to it etc.
>>>
>>> I've been doing some digging, and looking at what processes are
>>> running, i see both the rabbit server and the ctl coming up under the
>>> "rabbitmq" user i've created on my system.
>>>
>>> Otherwise, the only thing that is not ringing true is that the
>>> .erlang.cookie does not appear to be written to the place detailed on
>>> the install guide:
>>>
>>> $MACPORTS_PREFIX/var/lib/rabbitmq/.erlang.cookie.
>>>
>>> Could it be that the rabbitmqctl cant find the cookie? perhaps?
>>>
>>> Cheers, Tim
>>>
>>> On Sat, May 16, 2009 at 7:30 PM, Chris Duncan <celldee at gmail.com> wrote:
>>>>
>>>> Hi Tim,
>>>>
>>>> The easiest way that I found to run RabbitMQ on OSX was to use the
>>>> generic
>>>> unix download -
>>>>
>>>> http://www.rabbitmq.com/releases/rabbitmq-server/v1.5.4/rabbitmq-server-generic-unix-1.5.4.tar.gz
>>>>
>>>> I installed Erlang via Macports so I unpacked the RabbitMQ .tar.gz into
>>>> /opt/local/lib/erlang/lib
>>>>
>>>> Then I run the server with the command -
>>>>
>>>> sudo
>>>> /opt/local/lib/erlang/lib/rabbitmq_server-1.5.4/sbin/rabbitmq-server
>>>> -detached
>>>>
>>>> The '-detached' option runs it in the background. I run it as root
>>>> because
>>>> by default it wants to write to /var/log and I haven't gotten around to
>>>> changing things.
>>>>
>>>> The rabbitmqctl command -
>>>>
>>>> /opt/local/lib/erlang/lib/rabbitmq_server-1.5.4/sbin/rabbitmqctl
>>>>
>>>> Obviously you can create aliases etc. to make life easier.
>>>>
>>>> HTH :)
>>>>
>>>> Regards,
>>>>
>>>> Chris
>>>>
>>>>
>>>>
>>>> On 16 May 2009, at 18:47, Tim Perrett wrote:
>>>>
>>>>> Ok, so I completely scrapped this and started again, this time with
>>>>> macports to ensure it was nothing stupid i was doing causing the
>>>>> problem. So, I installed via macports, and following the instructions:
>>>>>
>>>>> sudo -H -u rabbitmq rabbitmq-server
>>>>>
>>>>> Great I thought! It works out of the box... however, if i open another
>>>>> terminal, the rabbitmqctl doesnt find the running server still.
>>>>>
>>>>> Any ideas? This is really starting to do my head in!
>>>>>
>>>>> Cheers, Tim
>>>>>
>>>>> On Sat, May 16, 2009 at 11:37 AM, Tim Perrett <tperrett at googlemail.com>
>>>>> wrote:
>>>>>>
>>>>>> Sorry, just to add some more information - when I run:
>>>>>>
>>>>>> macbookpro:~ timperrett$ sudo rabbitmq-server
>>>>>> RabbitMQ 1.5.4 (AMQP 8-0)
>>>>>> Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies
>>>>>> LLC., and Rabbit Technologies Ltd.
>>>>>> Licensed under the MPL. ?See http://www.rabbitmq.com/
>>>>>>
>>>>>> Logging to "/var/log/rabbitmq/rabbit.log"
>>>>>> SASL logging to "/var/log/rabbitmq/rabbit-sasl.log"
>>>>>>
>>>>>> starting database ? ? ? ? ? ? ...done
>>>>>> starting core processes ? ? ? ...done
>>>>>> starting recovery ? ? ? ? ? ? ...done
>>>>>> starting persister ? ? ? ? ? ?...done
>>>>>> starting guid generator ? ? ? ...done
>>>>>> starting builtin applications ...done
>>>>>> starting TCP listeners ? ? ? ?...done
>>>>>>
>>>>>> broker running
>>>>>>
>>>>>> Then in another terminal I run:
>>>>>>
>>>>>> macbookpro:~ timperrett$ sudo rabbitmqctl status
>>>>>> Status of node rabbit at macbookpro ...
>>>>>> {badrpc,nodedown}
>>>>>> ...done.
>>>>>>
>>>>>> I then tried:
>>>>>>
>>>>>> timperrett$ sudo -u rabbitmq rabbitmq-server
>>>>>> {error_logger,{{2009,5,16},{11,34,45}},"Failed to create cookie
>>>>>> file",[]}
>>>>>>
>>>>>>
>>>>>> {error_logger,{{2009,5,16},{11,34,45}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{"Failed
>>>>>> to create cookie
>>>>>>
>>>>>>
>>>>>> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.18.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,580}],[]]}
>>>>>>
>>>>>>
>>>>>> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Failed
>>>>>> to create cookie
>>>>>>
>>>>>>
>>>>>> file",[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfa,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>>>>>
>>>>>>
>>>>>> {error_logger,{{2009,5,16},{11,34,45}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>>>>>
>>>>>>
>>>>>> {error_logger,{{2009,5,16},{11,34,45}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>>>>>> {"Kernel pid
>>>>>>
>>>>>> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>>>>>
>>>>>> Crash dump was written to: erl_crash.dump
>>>>>> Kernel pid terminated (application_controller)
>>>>>>
>>>>>>
>>>>>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>>>>>>
>>>>>> Thanks
>>>>>>
>>>>>> Tim
>>>>>>
>>>>>>
>>>>>> On Sat, May 16, 2009 at 11:22 AM, Tim Perrett
>>>>>> <tperrett at googlemail.com>
>>>>>> wrote:
>>>>>>>
>>>>>>> Guys,
>>>>>>>
>>>>>>> This is probably a very noobie question, but everything was
>>>>>>> previously
>>>>>>> working perfectly, and now its just broken. For some reason
>>>>>>> rabbitmqctl appears to not be able to see the running broker? I
>>>>>>> worked
>>>>>>> through this post:
>>>>>>>
>>>>>>> http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/
>>>>>>>
>>>>>>> And based on whats detailed there, he suggests its an issue with
>>>>>>> rabbitmq not running as the rabbitmq user? Im running on OSX and did
>>>>>>> a
>>>>>>> manual install.
>>>>>>>
>>>>>>> Any advice / help is greatly appreciated.
>>>>>>>
>>>>>>> Thanks, Tim
>>>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From holger at wizards.de  Sun May 17 18:58:38 2009
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Sun, 17 May 2009 19:58:38 +0200
Subject: [rabbitmq-discuss] Patches for rabbitmq-client OSGi integration
Message-ID: <4A10504E.1060601@wizards.de>

Hi,

I started to make the java-client lib a proper OSGi bundle so that it can
be installed out of the box..into an OSGi box. :)

A first version is now availabe from my clone at:
http://hoho.dyndns.org/hg/rabbitmq-java-client/

I tried to fold the necessary work into the existing build process as
gently as possible, and while I was at it I also updated the dependencies
to some more recent (known to be good) versions. This was not strictly
necessary but made testing easier, as they already have proper OSGi bundle
information.

Essentially, all it does is add a "bndwrap" task to the ant build, which
is invoked from the "jar" task. This is necessary as I didn't want to
rewrite everything by using bnd directly to create the jar. Other than
that the build process is not impacted.

Two remaining issues I could need feedback with:

- the handling of the library "version" seems scattered across the entire
build process (seriously..make?) and I'm not really sure what to do with
it; the bnd input properties file in the osgi directory has a "version"
line which might need to be updated from whatever hackery the build
process invokes. I'm reluctant to touch any of that. :-(

- the backport retrotranslating is currently not implemented properly; the
resulting bundle does not declare the retrotranslator or
backport-util-concurrent dependencies correctly and therefore very likely
won't resolve correctly in OSGi. Not sure if this is important enough -
the bndwrap process for the retrotranslated jar would have to be fed a
second properties file with updated dependencies. Volunteers welcome ;)

Also maybe someone else familiar with OSGi can look over the generated
bundle and check whether the imports/exports and version ranges are
appropriate.

Let me know what you think!

Holger




From keith.irwin at gmail.com  Sun May 17 20:57:15 2009
From: keith.irwin at gmail.com (Keith Irwin)
Date: Sun, 17 May 2009 12:57:15 -0700
Subject: [rabbitmq-discuss] Does erlang client tip work with server tip?
Message-ID: <8aff81590905171257h2971b20ai1bf9ed4f218e1b21@mail.gmail.com>

Folks--

Basic problem: Can't get the erlang-client network tests to succeed,
using the HG tips of rabbitmq_server and rabbitmg_erlang_client.

Error is:

erl -pa ebin rabbitmq_server/ebin -noshell -eval
'network_client_test:test(),halt().'
network_client_test: basic_qos_test...*timed out*
undefined
=======================================================
  Failed: 0.  Skipped: 0.  Passed: 2.
One or more tests were cancelled.

Just starting to experiment with rabbitmq. I'm mostly interested in
how to run it in a sandbox as opposed to "properly" installing it in
/opt/local/bin (MaxOS) or other such system areas.

The goal is to cd into rabbitmq, start it up, then in a separate
shell, cd into some client code (yet to be written), and start that
up, and watch things happen.

(As a comparison, ActiveMQ can run straight from the untarred
download, if you want.)

So, here's what I did:

  cd Rabbits
  hg clone http://hg.rabbitmq.com/rabbitmq-server
  hg clone http://hg.rabbitmq.com/rabbitmq-codegen
  cd rabbitmq-server
  make
  cd ebin
  erl -boot start_sasl -s rabbit

and as far as I can tell, the app starts up just fine. I even tried
appmon:start() to see all the processes and applications. Looks good
to me!

Then:
  cd Rabbits
  hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client/
  make
  make test_network

and I get the error:

  erl -pa ebin rabbitmq_server/ebin -noshell -eval
'network_client_test:test(),halt().'
  network_client_test: basic_qos_test...*timed out*
  undefined
  =======================================================
    Failed: 0.  Skipped: 0.  Passed: 2.
  One or more tests were cancelled.

I'm using the recent MacPorts version of Erlang (13B with fixed Eunit
installed).

I guess the first question is, does the tip of the erlang client code
work with the tip of the erlang rabbitmq code?

If so, is it possible to run rabbitmq server straight from the ebin
directory, as I've done above?  (I'm not so concerned at the moment
about a distributed set up).

Thanks!

Keith



From keith.irwin at gmail.com  Sun May 17 22:31:42 2009
From: keith.irwin at gmail.com (Keith Irwin)
Date: Sun, 17 May 2009 14:31:42 -0700
Subject: [rabbitmq-discuss] Does erlang client tip work with server tip?
In-Reply-To: <8aff81590905171257h2971b20ai1bf9ed4f218e1b21@mail.gmail.com>
References: <8aff81590905171257h2971b20ai1bf9ed4f218e1b21@mail.gmail.com>
Message-ID: <8aff81590905171431i35fba772tcfe47382eff8248b@mail.gmail.com>

I tried this again using the generic unix release (1.5.4), setting
appropriate environment vars such that I can start RabbitMQ using
rabbit-server, and, again, the server seems to start up fine,
indicating "broker running".

I did a fresh checkout of rabbitmq-erlang-client, used

   make BROKER_DIR=../rabbitmq_server-1.5.4/

which worked fine.

Then:

  make test_network

and I get:

erl -pa ebin rabbitmq_server/ebin -noshell -eval
'network_client_test:test(),halt().'
network_client_test: basic_get_test...*timed out*
undefined
=======================================================
  Failed: 0.  Skipped: 0.  Passed: 0.
One or more tests were cancelled.

On the server side, I see:

=INFO REPORT==== 17-May-2009::14:24:54 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:52226

=INFO REPORT==== 17-May-2009::14:24:54 ===
starting TCP connection <0.221.0> from 127.0.0.1:52226

=ERROR REPORT==== 17-May-2009::14:24:59 ===
error on TCP connection <0.221.0> from 127.0.0.1:52226
connection_closed_abruptly

=INFO REPORT==== 17-May-2009::14:24:59 ===
closing TCP connection <0.221.0> from 127.0.0.1:52226

Puzzling. I'm not sure if this means the erlang client is basically
broken, or there's some magic config somewhere. I guess the next step
is to try and write a client using the erlang-client code and see if
there's anything to be seen. Then to write one in Groovy (using the
java client) to see if that works.

(I'm wishing you didn't have to have rabbitmq_server even installed to
get an erlang_client, just for these sorts of reasons.)

Anyway, it would help if anyone could even tell me that this is
supposed to work! I'd be happy to struggle, as long as I've chosen the
right road to go down....

Keith

On Sun, May 17, 2009 at 12:57 PM, Keith Irwin <keith.irwin at gmail.com> wrote:
> Folks--
>
> Basic problem: Can't get the erlang-client network tests to succeed,
> using the HG tips of rabbitmq_server and rabbitmg_erlang_client.
>
> Error is:
>
> erl -pa ebin rabbitmq_server/ebin -noshell -eval
> 'network_client_test:test(),halt().'
> network_client_test: basic_qos_test...*timed out*
> undefined
> =======================================================
> ?Failed: 0. ?Skipped: 0. ?Passed: 2.
> One or more tests were cancelled.
>
> Just starting to experiment with rabbitmq. I'm mostly interested in
> how to run it in a sandbox as opposed to "properly" installing it in
> /opt/local/bin (MaxOS) or other such system areas.
>
> The goal is to cd into rabbitmq, start it up, then in a separate
> shell, cd into some client code (yet to be written), and start that
> up, and watch things happen.
>
> (As a comparison, ActiveMQ can run straight from the untarred
> download, if you want.)
>
> So, here's what I did:
>
> ?cd Rabbits
> ?hg clone http://hg.rabbitmq.com/rabbitmq-server
> ?hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> ?cd rabbitmq-server
> ?make
> ?cd ebin
> ?erl -boot start_sasl -s rabbit
>
> and as far as I can tell, the app starts up just fine. I even tried
> appmon:start() to see all the processes and applications. Looks good
> to me!
>
> Then:
> ?cd Rabbits
> ?hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client/
> ?make
> ?make test_network
>
> and I get the error:
>
> ?erl -pa ebin rabbitmq_server/ebin -noshell -eval
> 'network_client_test:test(),halt().'
> ?network_client_test: basic_qos_test...*timed out*
> ?undefined
> ?=======================================================
> ? ?Failed: 0. ?Skipped: 0. ?Passed: 2.
> ?One or more tests were cancelled.
>
> I'm using the recent MacPorts version of Erlang (13B with fixed Eunit
> installed).
>
> I guess the first question is, does the tip of the erlang client code
> work with the tip of the erlang rabbitmq code?
>
> If so, is it possible to run rabbitmq server straight from the ebin
> directory, as I've done above? ?(I'm not so concerned at the moment
> about a distributed set up).
>
> Thanks!
>
> Keith
>



From matthias at lshift.net  Mon May 18 07:29:55 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 18 May 2009 07:29:55 +0100
Subject: [rabbitmq-discuss] Does erlang client tip work with server tip?
In-Reply-To: <8aff81590905171257h2971b20ai1bf9ed4f218e1b21@mail.gmail.com>
References: <8aff81590905171257h2971b20ai1bf9ed4f218e1b21@mail.gmail.com>
Message-ID: <4A110063.3020306@lshift.net>

Keith,

Keith Irwin wrote:
>   cd Rabbits
>   hg clone http://hg.rabbitmq.com/rabbitmq-server
>   hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>   cd rabbitmq-server
>   make
>   cd ebin
>   erl -boot start_sasl -s rabbit
> 
> and as far as I can tell, the app starts up just fine. I even tried
> appmon:start() to see all the processes and applications. Looks good
> to me!

That doesn't work for me. There are a whole bunch of additional 
parameters required, such as the node name and the mnesia dir.

You really should use the startup script in scripts/rabbitmq-server, e.g.
  RABBITMQ_LOG_BASE=/tmp RABBITMQ_MNESIA_BASE=/tmp scripts/rabbitmq-server

You can also just type 'make run'.

> Then:
>   cd Rabbits
>   hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client/
>   make
>   make test_network
> 
> and I get the error:
> 
>   erl -pa ebin rabbitmq_server/ebin -noshell -eval
> 'network_client_test:test(),halt().'
>   network_client_test: basic_qos_test...*timed out*
>   undefined
>   =======================================================
>     Failed: 0.  Skipped: 0.  Passed: 2.
>   One or more tests were cancelled.

That is due to a bug in the tests we fixed a while ago but that hasn't 
been qa'ed and merged into 'default' yet. Try the bug20444 branch (e.g. 
hg up -C bug20444).

Alternatively, the v1_5 branch works, i.e. try
   (cd rabbitmq-codegen; hg up -C v1_5)
   (cd rabbitmq-server; hg up -C v1_5; make clean all)
   (cd rabbitmq-erlang-client; hg up -C v1_5; make)
and then
    cd rabbitmq-server; make run
and
    cd rabbitmq-erlang-client; make test_network


Regards,

Matthias.



From matthias at lshift.net  Mon May 18 07:54:09 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 18 May 2009 07:54:09 +0100
Subject: [rabbitmq-discuss] Does erlang client tip work with server tip?
In-Reply-To: <8aff81590905171431i35fba772tcfe47382eff8248b@mail.gmail.com>
References: <8aff81590905171257h2971b20ai1bf9ed4f218e1b21@mail.gmail.com>
	<8aff81590905171431i35fba772tcfe47382eff8248b@mail.gmail.com>
Message-ID: <4A110611.4020007@lshift.net>

Keith,

Keith Irwin wrote:
> (I'm wishing you didn't have to have rabbitmq_server even installed to
> get an erlang_client)

The Erlang client is still experimental and we have done no release 
packaging. Hence the need to work from the source repos. If there were 
packaged versions they would include the necessary parts of / dependency 
on the server code.

Regarding the repo structure, we could have both the server and the 
client depend on a rabbitmq-common source repo, but that doesn't really 
make any material difference to the effort required in building & 
running the Erlang client since we'd simply be switching one dependency 
- on the rabbitmq-server repo - for another. It would also complicate 
the server build & packaging.


Regards,

Matthias.



From alexis.richardson at gmail.com  Mon May 18 10:33:06 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 18 May 2009 10:33:06 +0100
Subject: [rabbitmq-discuss] Patches for rabbitmq-client OSGi integration
In-Reply-To: <4A10504E.1060601@wizards.de>
References: <4A10504E.1060601@wizards.de>
Message-ID: <167204d20905180233t79141c7eq19be60c3a4beb538@mail.gmail.com>

Holger,

Very cool - have you shown this to Neil?  (cc'd).

alexis


2009/5/17 Holger Hoffst?tte <holger at wizards.de>:
> Hi,
>
> I started to make the java-client lib a proper OSGi bundle so that it can
> be installed out of the box..into an OSGi box. :)
>
> A first version is now availabe from my clone at:
> http://hoho.dyndns.org/hg/rabbitmq-java-client/
>
> I tried to fold the necessary work into the existing build process as
> gently as possible, and while I was at it I also updated the dependencies
> to some more recent (known to be good) versions. This was not strictly
> necessary but made testing easier, as they already have proper OSGi bundle
> information.
>
> Essentially, all it does is add a "bndwrap" task to the ant build, which
> is invoked from the "jar" task. This is necessary as I didn't want to
> rewrite everything by using bnd directly to create the jar. Other than
> that the build process is not impacted.
>
> Two remaining issues I could need feedback with:
>
> - the handling of the library "version" seems scattered across the entire
> build process (seriously..make?) and I'm not really sure what to do with
> it; the bnd input properties file in the osgi directory has a "version"
> line which might need to be updated from whatever hackery the build
> process invokes. I'm reluctant to touch any of that. :-(
>
> - the backport retrotranslating is currently not implemented properly; the
> resulting bundle does not declare the retrotranslator or
> backport-util-concurrent dependencies correctly and therefore very likely
> won't resolve correctly in OSGi. Not sure if this is important enough -
> the bndwrap process for the retrotranslated jar would have to be fed a
> second properties file with updated dependencies. Volunteers welcome ;)
>
> Also maybe someone else familiar with OSGi can look over the generated
> bundle and check whether the imports/exports and version ranges are
> appropriate.
>
> Let me know what you think!
>
> Holger
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From holger at wizards.de  Mon May 18 10:55:19 2009
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Mon, 18 May 2009 11:55:19 +0200
Subject: [rabbitmq-discuss] Patches for rabbitmq-client OSGi integration
In-Reply-To: <167204d20905180233t79141c7eq19be60c3a4beb538@mail.gmail.com>
References: <4A10504E.1060601@wizards.de>
	<167204d20905180233t79141c7eq19be60c3a4beb538@mail.gmail.com>
Message-ID: <4A113087.6070006@wizards.de>


Good morning!

Alexis Richardson wrote:
> Very cool - have you shown this to Neil?  (cc'd).

I took a peek at his rabbit-osgi project for inspiration. :)
He wrangled the bundle metainfo into the jar manually, and that is what I
wanted to add to the upstream client build. Once the client lib jar is a
proper bundle, Neil's (or any other) project will simply be smaller and
won't have to bundle a manually wrapped client lib any more.
Fwiw the fix itself is pretty small; I spent most of the time figuring out
 a workaround for a bug in bnd's ant task..

cheerz
Holger



From njbartlett at gmail.com  Mon May 18 12:25:13 2009
From: njbartlett at gmail.com (Neil Bartlett)
Date: Mon, 18 May 2009 12:25:13 +0100
Subject: [rabbitmq-discuss] Patches for rabbitmq-client OSGi integration
In-Reply-To: <4A113087.6070006@wizards.de>
References: <4A10504E.1060601@wizards.de>
	<167204d20905180233t79141c7eq19be60c3a4beb538@mail.gmail.com>
	<4A113087.6070006@wizards.de>
Message-ID: <bb4674270905180425w6f1dc263xf56dc02a5d96499b@mail.gmail.com>

Hi Alexis,

I saw the mail because I'm on the list. Sorry I haven't had time yet
to look at what Holger has done.

Moving the metadata up into the main build is definitely the right
thing to do. When I did my original work I just had to take the Rabbit
client and treat it as another other third-party library.

Holger, If you would like to send me some bundles I can verify whether
the metadata is correct.

Regards,
Neil

2009/5/18 Holger Hoffst?tte <holger at wizards.de>:
>
> Good morning!
>
> Alexis Richardson wrote:
>> Very cool - have you shown this to Neil? ?(cc'd).
>
> I took a peek at his rabbit-osgi project for inspiration. :)
> He wrangled the bundle metainfo into the jar manually, and that is what I
> wanted to add to the upstream client build. Once the client lib jar is a
> proper bundle, Neil's (or any other) project will simply be smaller and
> won't have to bundle a manually wrapped client lib any more.
> Fwiw the fix itself is pretty small; I spent most of the time figuring out
> ?a workaround for a bug in bnd's ant task..
>
> cheerz
> Holger
>



From keith.irwin at gmail.com  Mon May 18 18:31:38 2009
From: keith.irwin at gmail.com (Keith Irwin)
Date: Mon, 18 May 2009 10:31:38 -0700
Subject: [rabbitmq-discuss] Does erlang client tip work with server tip?
In-Reply-To: <4A110063.3020306@lshift.net>
References: <8aff81590905171257h2971b20ai1bf9ed4f218e1b21@mail.gmail.com>
	<4A110063.3020306@lshift.net>
Message-ID: <8aff81590905181031w59e34144rf14ae35d6092fd0e@mail.gmail.com>

On Sun, May 17, 2009 at 11:29 PM, Matthias Radestock
<matthias at lshift.net> wrote:
> Keith,
>
> Keith Irwin wrote:
>>
>> ?cd Rabbits
>> ?hg clone http://hg.rabbitmq.com/rabbitmq-server
>> ?hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>> ?cd rabbitmq-server
>> ?make
>> ?cd ebin
>> ?erl -boot start_sasl -s rabbit
>>
>> and as far as I can tell, the app starts up just fine. I even tried
>> appmon:start() to see all the processes and applications. Looks good
>> to me!
>
> That doesn't work for me. There are a whole bunch of additional parameters
> required, such as the node name and the mnesia dir.

Hi!

Actually, I just tested this and it does work, interestingly. The
mnesia db gets created just fine right in amongst the beam files, and
the node name doesn't seem to matter unless you're in cluster mode,
right? At any rate, I was able to get some code working both starting
the service interactively (as above), and by using the proper
rabbitmq-server script.

I'm quite happy about this, actually. It at least leads to the
possibility that one could "embed" rabbitmq in your client if only to
create a temporary broker for unit testing.

> That is due to a bug in the tests we fixed a while ago but that hasn't been
> qa'ed and merged into 'default' yet. Try the bug20444 branch (e.g. hg up -C
> bug20444).
>
> Alternatively, the v1_5 branch works, i.e. try
> ?(cd rabbitmq-codegen; hg up -C v1_5)
> ?(cd rabbitmq-server; hg up -C v1_5; make clean all)
> ?(cd rabbitmq-erlang-client; hg up -C v1_5; make)
> and then
> ? cd rabbitmq-server; make run
> and
> ? cd rabbitmq-erlang-client; make test_network

Thanks for this info. I scratched around HG for a bit and couldn't
immediately see how to get a specific branch, or check out to a
specific revision. I did manage to get the 1.5 client going, though,
and that solved my problems.  (I'm a bzr user, mainly.)

Keith



From keith.irwin at gmail.com  Mon May 18 18:44:39 2009
From: keith.irwin at gmail.com (Keith Irwin)
Date: Mon, 18 May 2009 10:44:39 -0700
Subject: [rabbitmq-discuss] Does erlang client tip work with server tip?
In-Reply-To: <4A110611.4020007@lshift.net>
References: <8aff81590905171257h2971b20ai1bf9ed4f218e1b21@mail.gmail.com>
	<8aff81590905171431i35fba772tcfe47382eff8248b@mail.gmail.com>
	<4A110611.4020007@lshift.net>
Message-ID: <8aff81590905181044j31d0975bu4686975b680ae926@mail.gmail.com>

On Sun, May 17, 2009 at 11:54 PM, Matthias Radestock
<matthias at lshift.net> wrote:
> Keith,
>
> Keith Irwin wrote:
>>
>> (I'm wishing you didn't have to have rabbitmq_server even installed to
>> get an erlang_client)
>
> The Erlang client is still experimental and we have done no release
> packaging. Hence the need to work from the source repos. If there were
> packaged versions they would include the necessary parts of / dependency on
> the server code.

Yes, that makes sense.

> Regarding the repo structure, we could have both the server and the client
> depend on a rabbitmq-common source repo, but that doesn't really make any
> material difference to the effort required in building & running the Erlang
> client since we'd simply be switching one dependency - on the
> rabbitmq-server repo - for another. It would also complicate the server
> build & packaging.

How about this? Why not merge the client with the server, and bundle
it all up together (at least for release)? I think ActiveMQ works this
way. If you check out the source, it's a bunch of related projects
(and HUGE), but the release contains, among other things, a JAR file
which contains all the code, including dependent libs, the broker, the
client code, and so on.

This is great because you can just drop it into your project, use an
embedded broker for unit testing (if you want).

I could see a case for that with rabbitmq, especially if the idea of
loading code from archives ever gets more accepted in the Erlang
community. (The advantage of the archive is that you don't notice
there's a lot of code you're not using.... ;))

BTW, after I wrote my little frustrated comment, I found the long
discussion with Ed Fine in the mailing list archives. Good stuff. I
really appreciate your team's patience with us.

I'm pasting in the "test" code I wrote to experiment with the client
and server. I think it's slightly more understandable for my way of
thinking than the example at:

    http://github.com/careo/rabbitmq-erlang-client-examples/tree/master

which did not have the benefit of lib_amqp.

My example doesn't really illustrate everything (for instance I seem
to have forgotten to explicitly set the realm), but it's a nice
template for exploration.

I'm looking forward to seeing more work on lib_amqp.

Regards,

Keith

-----
-module(test).

-compile(export_all).
-include("../lib/rabbitmq-client/include/amqp_client.hrl").
-include_lib("../lib/rabbitmq-server/include/rabbit.hrl").
-include_lib("../lib/rabbitmq-server/include/rabbit_framing.hrl").

-record(conn, {conn, channel}).

-define(USER, "guest").
-define(PASS, "guest").
-define(HOST, "localhost").
-define(REALM, <<"/">>).

-define(QUEUE,         <<"app.queue">>).
-define(EXCHANGE,      <<"app.exchange">>).
-define(EXCHANGE_TYPE, <<"direct">>).
-define(ROUTING_KEY,   <<"app.route">>).

start_all() ->
    start_consumer(),
    start_producer().

stop_all() ->
    stop_producer(),
    stop_consumer().

send(Msg) ->
    case whereis(producer) of
        undefined ->
            producer_not_started;
        Pid ->
            Pid ! Msg
    end.

start_consumer() ->
    spawn(fun() -> consumer() end).

stop_consumer() ->
    case whereis(consumer) of
        undefined ->
            consumer_not_started;
        Pid ->
            Pid ! stop
    end.

start_producer() ->
    Pid = spawn(fun() -> producer() end),
    register(producer, Pid).

stop_producer() ->
    case whereis(producer) of
        undefined ->
            producer_not_started;
        Pid ->
            Pid ! stop
    end.

consumer() ->
    process_flag(trap_exit, true),
    register(consumer, self()),
    Conn = connect(?USER, ?PASS, ?HOST),
    #conn{channel=Channel} = Conn,
    lib_amqp:declare_queue(Channel, ?QUEUE),
    lib_amqp:declare_exchange(Channel, ?EXCHANGE, ?EXCHANGE_TYPE),
    lib_amqp:bind_queue(Channel, ?EXCHANGE, ?QUEUE, ?ROUTING_KEY),
    lib_amqp:subscribe(Channel, ?QUEUE, self(), ?ROUTING_KEY),

    consumer_loop(),

    lib_amqp:unsubscribe(Channel, ?ROUTING_KEY),
    lib_amqp:unbind_queue(Channel, ?EXCHANGE, ?QUEUE, ?ROUTING_KEY),
    lib_amqp:delete_queue(Channel, ?QUEUE),
    disconnect(Conn),
    consumer_stopped.

consumer_loop() ->
    receive
        {'EXIT', _Pid, Reason} ->
            io:format("consumer: exiting ~p~n", [Reason]),
            void;

        stop ->
            void;

        {Delivery, Content} ->
            io:format("consumer: delivery = ~p~n", [Delivery]),
            io:format("consumer: content = ~p~n", [Content]),
            consumer_loop();

        Msg ->
            io:format("consumer: msg = ~p~n", [Msg]),
            consumer_loop()
    end,
    ok.

producer() ->
    process_flag(trap_exit, true),
    Conn = connect(?USER, ?PASS, ?HOST),
    #conn{channel=Channel} = Conn,
    producer_loop(Channel),
    disconnect(Conn),
    producer_stopped.

producer_loop(Channel) ->
    receive
        stop ->
            void;
        Msg ->
            io:format("publisher: sending <<~p>>~n", [Msg]),
            lib_amqp:publish(Channel, ?EXCHANGE, ?ROUTING_KEY,
list_to_binary(Msg)),
            io:format("publisher: msg sent~n"),
            producer_loop(Channel)
    end.

connect(User, Pass, Host) ->
    Connection = amqp_connection:start(User, Pass, Host),
    Channel = amqp_connection:open_channel(Connection),
    #conn{conn=Connection, channel=Channel}.

disconnect(Conn) ->
    #conn{conn=Connection, channel=Channel} = Conn,
    lib_amqp:close_channel(Channel),
    lib_amqp:close_connection(Connection).


-----


>
>
> Regards,
>
> Matthias.
>



From matthias at lshift.net  Mon May 18 18:51:44 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 18 May 2009 18:51:44 +0100
Subject: [rabbitmq-discuss] Does erlang client tip work with server tip?
In-Reply-To: <8aff81590905181031w59e34144rf14ae35d6092fd0e@mail.gmail.com>
References: <8aff81590905171257h2971b20ai1bf9ed4f218e1b21@mail.gmail.com>	<4A110063.3020306@lshift.net>
	<8aff81590905181031w59e34144rf14ae35d6092fd0e@mail.gmail.com>
Message-ID: <4A11A030.3060608@lshift.net>

Keith,

Keith Irwin wrote:
> On Sun, May 17, 2009 at 11:29 PM, Matthias Radestock
> <matthias at lshift.net> wrote:
>>>  erl -boot start_sasl -s rabbit
>> That doesn't work for me. There are a whole bunch of additional parameters
>> required, such as the node name and the mnesia dir.
> 
> Actually, I just tested this and it does work, interestingly.

Hmmm. It didn't work for me this morning, but now it does. Still, I 
wouldn't recommend running it like this.

> The mnesia db gets created just fine right in amongst the beam files, and
> the node name doesn't seem to matter unless you're in cluster mode,
> right?

The node name is also needed for rabbitmqctl.


Matthias.



From tperrett at googlemail.com  Mon May 18 22:27:03 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Mon, 18 May 2009 22:27:03 +0100
Subject: [rabbitmq-discuss] Fanout exchange not playing ball?
Message-ID: <b22ab270905181427v6820e9f1s1594197f3b562cd7@mail.gmail.com>

Hey guys,

I've setup a fanout exchange and my expectation does not match the
output... My expectation was that using a fanout exchange all
listening clients would get all messages - however this doesn't appear
to be the case. I started two separate instances of the same
application and run the listeners - I then publish a message into the
exchange, and it appears that App1 gets a message, then App2 gets
nothing. I send another message into the queue and then App2 gets the
message but not App1 - im a little lost how this could happen?

My creation code looks like:

    val ticket = channel.accessRequest("/data")
    channel.exchangeDeclare(ticket, "mult", "topic")
    channel.queueDeclare(ticket, "mult_queue")
    channel.queueBind(ticket, "mult_queue", "mult", "example.*")
    channel.basicConsume(ticket, "mult_queue", false, new
SerializedConsumer(channel, this))


Any ideas / suggestions?

Cheers, Tim



From rich.kim at db.com  Mon May 18 22:31:29 2009
From: rich.kim at db.com (Rich Kim)
Date: Mon, 18 May 2009 17:31:29 -0400
Subject: [rabbitmq-discuss] Fanout exchange not playing ball?
In-Reply-To: <b22ab270905181427v6820e9f1s1594197f3b562cd7@mail.gmail.com>
Message-ID: <OF161391FD.4B398A54-ON852575BA.00760A51-852575BA.00763C5D@db.com>

Taking a stab at this one, but have you setup your two listening clients 
with separate queue names? When using a fanout exchange and binding queues 
to the exchange, when you attach the second listener to the exchange, the 
queue name is already found, and therefore performs a NOOP. Both listeners 
share the same queue name, and thereafter begin round-robin like behavior. 


Create two listeners with distinct queue names, and you should see your 
expected behavior.

________________________
Richard Kim
Deutsche Bank Americas
Global Banking, New York
rich.kim at db.com
P: +1 212.250.4984



Tim Perrett <tperrett at googlemail.com> 
Sent by: rabbitmq-discuss-bounces at lists.rabbitmq.com
05/18/2009 05:27 PM

To
RabbitMQ Discuss <rabbitmq-discuss at lists.rabbitmq.com>
cc

Subject
[rabbitmq-discuss] Fanout exchange not playing ball?






Hey guys,

I've setup a fanout exchange and my expectation does not match the
output... My expectation was that using a fanout exchange all
listening clients would get all messages - however this doesn't appear
to be the case. I started two separate instances of the same
application and run the listeners - I then publish a message into the
exchange, and it appears that App1 gets a message, then App2 gets
nothing. I send another message into the queue and then App2 gets the
message but not App1 - im a little lost how this could happen?

My creation code looks like:

    val ticket = channel.accessRequest("/data")
    channel.exchangeDeclare(ticket, "mult", "topic")
    channel.queueDeclare(ticket, "mult_queue")
    channel.queueBind(ticket, "mult_queue", "mult", "example.*")
    channel.basicConsume(ticket, "mult_queue", false, new
SerializedConsumer(channel, this))


Any ideas / suggestions?

Cheers, Tim

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



---
This communication may contain confidential and/or privileged information.
If you are not the intended recipient (or have received this communication
in error) please notify the sender immediately and destroy this
communication. Any unauthorized copying, disclosure or distribution of the
material in this communication is strictly forbidden.

Deutsche Bank does not render legal or tax advice, and the information
contained in this communication should not be regarded as such.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090518/1313eb03/attachment.htm 

From tperrett at googlemail.com  Mon May 18 23:00:46 2009
From: tperrett at googlemail.com (Tim Perrett)
Date: Mon, 18 May 2009 23:00:46 +0100
Subject: [rabbitmq-discuss] Fanout exchange not playing ball?
In-Reply-To: <OF161391FD.4B398A54-ON852575BA.00760A51-852575BA.00763C5D@db.com>
References: <b22ab270905181427v6820e9f1s1594197f3b562cd7@mail.gmail.com>
	<OF161391FD.4B398A54-ON852575BA.00760A51-852575BA.00763C5D@db.com>
Message-ID: <b22ab270905181500nc60fbcm6c6b4eee63b48c1c@mail.gmail.com>

Thanks Richard - that was just the ticket.

There does not appear to be a great deal of examples on this anywhere
- is this the case or am I just being amazingly slow? ;-)

Cheers, Tim

On Mon, May 18, 2009 at 10:31 PM, Rich Kim <rich.kim at db.com> wrote:
>
> Taking a stab at this one, but have you setup your two listening clients
> with separate queue names? When using a fanout exchange and binding queues
> to the exchange, when you attach the second listener to the exchange, the
> queue name is already found, and therefore performs a NOOP. Both listeners
> share the same queue name, and thereafter begin round-robin like behavior.
>
> Create two listeners with distinct queue names, and you should see your
> expected behavior.
>
> ________________________
> Richard Kim
> Deutsche Bank Americas
> Global Banking, New York
> rich.kim at db.com
> P: +1 212.250.4984
>
>
> Tim Perrett <tperrett at googlemail.com>
> Sent by: rabbitmq-discuss-bounces at lists.rabbitmq.com
>
> 05/18/2009 05:27 PM
>
> To
> RabbitMQ Discuss <rabbitmq-discuss at lists.rabbitmq.com>
> cc
> Subject
> [rabbitmq-discuss] Fanout exchange not playing ball?
>
>
>
>
> Hey guys,
>
> I've setup a fanout exchange and my expectation does not match the
> output... My expectation was that using a fanout exchange all
> listening clients would get all messages - however this doesn't appear
> to be the case. I started two separate instances of the same
> application and run the listeners - I then publish a message into the
> exchange, and it appears that App1 gets a message, then App2 gets
> nothing. I send another message into the queue and then App2 gets the
> message but not App1 - im a little lost how this could happen?
>
> My creation code looks like:
>
> ? ?val ticket = channel.accessRequest("/data")
> ? ?channel.exchangeDeclare(ticket, "mult", "topic")
> ? ?channel.queueDeclare(ticket, "mult_queue")
> ? ?channel.queueBind(ticket, "mult_queue", "mult", "example.*")
> ? ?channel.basicConsume(ticket, "mult_queue", false, new
> SerializedConsumer(channel, this))
>
>
> Any ideas / suggestions?
>
> Cheers, Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ---
> This communication may contain confidential and/or privileged information.
> If you are not the intended recipient (or have received this communication
> in error) please notify the sender immediately and destroy this
> communication. Any unauthorized copying, disclosure or distribution of the
> material in this communication is strictly forbidden.
>
> Deutsche Bank does not render legal or tax advice, and the information
> contained in this communication should not be regarded as such.



From rich.kim at db.com  Mon May 18 23:36:26 2009
From: rich.kim at db.com (Rich Kim)
Date: Mon, 18 May 2009 18:36:26 -0400
Subject: [rabbitmq-discuss] Fanout exchange not playing ball?
In-Reply-To: <b22ab270905181500nc60fbcm6c6b4eee63b48c1c@mail.gmail.com>
Message-ID: <OF7586AFB0.635322D3-ON852575BA.007C28BD-852575BA.007C2EB0@db.com>

Trial and error for me as well, or maybe we're both just slow :-)

________________________
Richard Kim
Deutsche Bank Americas
Global Banking, New York
rich.kim at db.com
P: +1 212.250.4984



Tim Perrett <tperrett at googlemail.com> 
05/18/2009 06:00 PM

To
Rich Kim/db/dbcom at DBAmericas
cc
RabbitMQ Discuss <rabbitmq-discuss at lists.rabbitmq.com>, 
rabbitmq-discuss-bounces at lists.rabbitmq.com
Subject
Re: [rabbitmq-discuss] Fanout exchange not playing ball?






Thanks Richard - that was just the ticket.

There does not appear to be a great deal of examples on this anywhere
- is this the case or am I just being amazingly slow? ;-)

Cheers, Tim

On Mon, May 18, 2009 at 10:31 PM, Rich Kim <rich.kim at db.com> wrote:
>
> Taking a stab at this one, but have you setup your two listening clients
> with separate queue names? When using a fanout exchange and binding 
queues
> to the exchange, when you attach the second listener to the exchange, 
the
> queue name is already found, and therefore performs a NOOP. Both 
listeners
> share the same queue name, and thereafter begin round-robin like 
behavior.
>
> Create two listeners with distinct queue names, and you should see your
> expected behavior.
>
> ________________________
> Richard Kim
> Deutsche Bank Americas
> Global Banking, New York
> rich.kim at db.com
> P: +1 212.250.4984
>
>
> Tim Perrett <tperrett at googlemail.com>
> Sent by: rabbitmq-discuss-bounces at lists.rabbitmq.com
>
> 05/18/2009 05:27 PM
>
> To
> RabbitMQ Discuss <rabbitmq-discuss at lists.rabbitmq.com>
> cc
> Subject
> [rabbitmq-discuss] Fanout exchange not playing ball?
>
>
>
>
> Hey guys,
>
> I've setup a fanout exchange and my expectation does not match the
> output... My expectation was that using a fanout exchange all
> listening clients would get all messages - however this doesn't appear
> to be the case. I started two separate instances of the same
> application and run the listeners - I then publish a message into the
> exchange, and it appears that App1 gets a message, then App2 gets
> nothing. I send another message into the queue and then App2 gets the
> message but not App1 - im a little lost how this could happen?
>
> My creation code looks like:
>
>    val ticket = channel.accessRequest("/data")
>    channel.exchangeDeclare(ticket, "mult", "topic")
>    channel.queueDeclare(ticket, "mult_queue")
>    channel.queueBind(ticket, "mult_queue", "mult", "example.*")
>    channel.basicConsume(ticket, "mult_queue", false, new
> SerializedConsumer(channel, this))
>
>
> Any ideas / suggestions?
>
> Cheers, Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ---
> This communication may contain confidential and/or privileged 
information.
> If you are not the intended recipient (or have received this 
communication
> in error) please notify the sender immediately and destroy this
> communication. Any unauthorized copying, disclosure or distribution of 
the
> material in this communication is strictly forbidden.
>
> Deutsche Bank does not render legal or tax advice, and the information
> contained in this communication should not be regarded as such.



---
This communication may contain confidential and/or privileged information.
If you are not the intended recipient (or have received this communication
in error) please notify the sender immediately and destroy this
communication. Any unauthorized copying, disclosure or distribution of the
material in this communication is strictly forbidden.

Deutsche Bank does not render legal or tax advice, and the information
contained in this communication should not be regarded as such.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090518/2ae82253/attachment.htm 

From alex at polvi.net  Tue May 19 03:43:27 2009
From: alex at polvi.net (Alex Polvi)
Date: Mon, 18 May 2009 19:43:27 -0700
Subject: [rabbitmq-discuss] flushing a queue?
Message-ID: <23e488cd0905181943h69948c15q276bdb786f87f734@mail.gmail.com>

Hi,

I hope this finds you well!

Is it possible to flush/remove the contents of a particular queue? I
have a queue that keeps getting needlessly filled up, and thus
consumes a bunch of memory. While I'm in the middle of trying to find
the bug, it would be great if I could reset that particular queue,
without resetting all of rabbitmq. Is that possible?

Also, is it possible to see the contents of a particular queue? Would
be great for debugging purposes, even if I need to use hexdump ...

Thanks for any help!

-Alex

-- 
twitter.com/polvi



From matthias at lshift.net  Tue May 19 06:53:04 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 19 May 2009 06:53:04 +0100
Subject: [rabbitmq-discuss] flushing a queue?
In-Reply-To: <23e488cd0905181943h69948c15q276bdb786f87f734@mail.gmail.com>
References: <23e488cd0905181943h69948c15q276bdb786f87f734@mail.gmail.com>
Message-ID: <4A124940.5070908@lshift.net>

Alex,

Alex Polvi wrote:
> Is it possible to flush/remove the contents of a particular queue?

This can be done with the AMQP queue.purge command.

> Also, is it possible to see the contents of a particular queue? Would
> be great for debugging purposes, even if I need to use hexdump ...

One option is to consume messages from the queue using, say, basic,get, 
but not acknowledging them, and close the connection/channel when the 
last message has been read that way - which causes all the messages to 
be re-queued.

The main downside is that this isn't totally transparent to other 
consumers, e.g. the message order may change.

Or you could use the Erlang shell to poke inside the queue processes. 
That requires some knowledge of Erlang and the RabbitMQ internals.


Regards,

Matthias.



From dmitriy.samovskiy at cohesiveft.com  Tue May 19 16:44:20 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Tue, 19 May 2009 10:44:20 -0500
Subject: [rabbitmq-discuss] mysterious rabbit crash
Message-ID: <4A12D3D4.6070609@cohesiveft.com>

Hi all,

One of my rabbits running on an old machine crashed last night.

Starting yesterday at 3:04pm, rabbit apparently has been complaining about "alarm_handler: 
{set,{system_memory_high_watermark,[]}}" in the log file.

But at 00:27am this morning, it rolled the persister log and crashed.

Please note that the size of rabbit_persister.LOG.previous is roughly the same as the 
amount of memory it failed to allocate.

My question is is this a coincidence that the numbers are close? I would think rabbit has 
no use for *previous* persister log in this situation.

Disk where mnesia and persister log are located was not full at the time of crash (I 
think). I am also nearly positive that consumers were around just before and during the 
crash, and were properly consuming from the broker (I have charts with data going all the 
way to roughly 00:27am). Which makes me wonder why rabbit was using so much memory if its 
queues were being drained normally...

-rw-r--r--    1 rabbitmq rabbitmq 22722770 May 19 00:27 rabbit_persister.LOG.previous

=erl_crash_dump:0.1
Tue May 19 00:27:27 2009
Slogan: binary_alloc: Cannot allocate 22615166 bytes of memory (of type "binary"
).
System version: Erlang (BEAM) emulator version 5.6.5 [source] [async-threads:30]
Compiled: Fri Apr  3 11:49:36 2009
Atoms: 9807
=memory
total: 931495488
processes: 90885644
processes_used: 90882996
system: 840609844
atom: 435481
atom_used: 426079
binary: 815315560
code: 3451735
ets: 20791156


{rabbit,"RabbitMQ","1.5.4"},
                         {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                         {os_mon,"CPO  CXC 138 46","2.1.8"},
                         {sasl,"SASL  CXC 138 11","2.1.5.4"},
                         {stdlib,"ERTS  CXC 138 10","1.15.5"},
                         {kernel,"ERTS  CXC 138 10","2.12.5"}]},

Has anybody seen anything like this?

This is a very low priority issue for me, I am just curious.

Thanks in advance for your thoughts and time spent looking into it.

- Dmitriy



From tonyg at lshift.net  Tue May 19 18:05:11 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 19 May 2009 18:05:11 +0100
Subject: [rabbitmq-discuss] mysterious rabbit crash
In-Reply-To: <4A12D3D4.6070609@cohesiveft.com>
References: <4A12D3D4.6070609@cohesiveft.com>
Message-ID: <4A12E6C7.4080301@lshift.net>

Dmitriy Samovskiy wrote:
> way to roughly 00:27am). Which makes me wonder why rabbit was using so much memory if its 
> queues were being drained normally...

Indeed. If you still have the persister log around somewhere, it might
be worth feeding it to a rabbit and using rabbitmqctl to get a picture
of the states of the queues implied by the file?

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From matthias at lshift.net  Tue May 19 18:28:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 19 May 2009 18:28:12 +0100
Subject: [rabbitmq-discuss] mysterious rabbit crash
In-Reply-To: <4A12E6C7.4080301@lshift.net>
References: <4A12D3D4.6070609@cohesiveft.com> <4A12E6C7.4080301@lshift.net>
Message-ID: <4A12EC2C.4090300@lshift.net>

Dmitriy,

Tony Garnock-Jones wrote:
> Dmitriy Samovskiy wrote:
>> Which makes me wonder why rabbit was using  so much memory if its
>> queues were being drained normally...
> Indeed. If you still have the persister log around somewhere, it might
> be worth feeding it to a rabbit and using rabbitmqctl to get a picture
> of the states of the queues implied by the file?

The difference between

> -rw-r--r--    1 rabbitmq rabbitmq 22722770 May 19 00:27 rabbit_persister.LOG.previous

and

> binary: 815315560

Suggests that the bulk of the memory is consumed by transient messages, 
and that it just happened to be a persister log rollover that triggered 
the OOM condition.

What client are you using to publish the messages? Does it react to 
channel.flow messages from the server telling it to throttle?

Also, are you sure the consumers were draining all the queues and 
ack'ing messages properly?

You could set up some monitoring that periodically calls 'rabbitmqctl 
list_queues ...' to catch any queues not getting drained.


Regards,

Matthias.



From dmitriy.samovskiy at cohesiveft.com  Tue May 19 18:53:45 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Tue, 19 May 2009 12:53:45 -0500
Subject: [rabbitmq-discuss] mysterious rabbit crash
In-Reply-To: <4A12EC2C.4090300@lshift.net>
References: <4A12D3D4.6070609@cohesiveft.com> <4A12E6C7.4080301@lshift.net>
	<4A12EC2C.4090300@lshift.net>
Message-ID: <4A12F229.5090602@cohesiveft.com>


Matthias Radestock wrote:
> Tony Garnock-Jones wrote:
>> Dmitriy Samovskiy wrote:
>>> Which makes me wonder why rabbit was using  so much memory if its
>>> queues were being drained normally...
>> Indeed. If you still have the persister log around somewhere, it might
>> be worth feeding it to a rabbit and using rabbitmqctl to get a picture
>> of the states of the queues implied by the file?
> 

I don't think it survived :)

> The difference between
> 
>> -rw-r--r--    1 rabbitmq rabbitmq 22722770 May 19 00:27 
>> rabbit_persister.LOG.previous
> 
> and
> 
>> binary: 815315560
> 
> Suggests that the bulk of the memory is consumed by transient messages, 
> and that it just happened to be a persister log rollover that triggered 
> the OOM condition.
> 
> What client are you using to publish the messages? Does it react to 
> channel.flow messages from the server telling it to throttle?

Py-amqplib. I don't think it supports channel.flow, or at least the version that I 
currently have doesn't support it.


> 
> Also, are you sure the consumers were draining all the queues and 
> ack'ing messages properly?

Not anymore. The code seems to indicate it does, but I will verify it with rabbitmqctl 
next time.

> 
> You could set up some monitoring that periodically calls 'rabbitmqctl 
> list_queues ...' to catch any queues not getting drained.
> 

Thanks for your ideas and your time. I will keep a closer eye on this box now. If it 
happens again, I can get more information.


- Dmitriy




From matthias at lshift.net  Wed May 20 12:17:55 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 20 May 2009 12:17:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.5.5 release
Message-ID: <4A13E6E3.3070509@lshift.net>

The RabbitMQ team is pleased to announce the release of RabbitMQ 1.5.5.

This release has 'final' status and fixes a number of bugs related to 
clustering and in the RPM packaging.

For details see the attached release notes.

Binary and source distributions of the new release can be found in the 
usual place, at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to 
this latest release.

As always, we welcome any questions, bug reports, and other feedback on 
this release, as well as general suggestions for features and 
enhancements in future releases. Mail us via the RabbitMQ discussion 
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at 
info at rabbitmq.com.


Regards,

The RabbitMQ Team

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-1.5.5.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090520/dbf9c694/attachment.txt 

From gmr at myyearbook.com  Wed May 20 17:12:39 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 20 May 2009 12:12:39 -0400
Subject: [rabbitmq-discuss] Stomp Connector,
Message-ID: <af1bce590905200912s26eb37fby4b5cbd573ded1d03@mail.gmail.com>

I am using Jason Briggs' excellent Stomp.py to communicate with RabbitMQ.  I
am trying to find out how to create a durable and non-autoDelete queue,
using only a connection that is subscribed to a queue, but not dequeueing.
 I've tried passing in headers on connection and subscription but haven't
had any success.  Is this possible with the Stomp connector?  If so, what
should I be passing in where?
Thanks,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090520/58ef4eaf/attachment.htm 

From zerthurd at gmail.com  Wed May 20 20:18:42 2009
From: zerthurd at gmail.com (Maxim Treskin)
Date: Thu, 21 May 2009 02:18:42 +0700
Subject: [rabbitmq-discuss]  Simple samples of AMQP usage
Message-ID: <be8f531d0905201218s3e14457ah60881eea54f1cb9f@mail.gmail.com>

Hello

May be someone of novice will be interested.
This is simple samples of AMQP usage on erlang:
http://github.com/Zert/amqp-erlang-sample/tree/master
Works with v1_5

-- 
Maxim Treskin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090521/1f1bbd2f/attachment.htm 

From geir at pobox.com  Wed May 20 20:30:13 2009
From: geir at pobox.com (Geir Magnusson Jr.)
Date: Wed, 20 May 2009 15:30:13 -0400
Subject: [rabbitmq-discuss] best practice for EC2 deployment?
Message-ID: <E92924F1-63B6-4740-BF51-56ACDDB13DD7@pobox.com>

I'm about to create a rabbitMQ cluster on EC2.

Anyone have any pointers or suggestions for best-practices or things  
that will make this easier?

tia

geir




From dmitriy.samovskiy at cohesiveft.com  Wed May 20 21:09:41 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Wed, 20 May 2009 15:09:41 -0500
Subject: [rabbitmq-discuss] best practice for EC2 deployment?
In-Reply-To: <E92924F1-63B6-4740-BF51-56ACDDB13DD7@pobox.com>
References: <E92924F1-63B6-4740-BF51-56ACDDB13DD7@pobox.com>
Message-ID: <4A146385.9060402@cohesiveft.com>

Hi Geir,

Geir Magnusson Jr. wrote:
> I'm about to create a rabbitMQ cluster on EC2.
> 
> Anyone have any pointers or suggestions for best-practices or things  
> that will make this easier?


Basically, there are several things that I have seen people on this list do when deploying 
on EC2.

1. Consider putting Mnesia dir and persister log on EBS if you need persistence beyond 
reboot.

2. If you go with EBS, before creating mnesia dir and before starting broker off of data 
on EBS, you want to make sure your instance is running with the hostname that you control, 
not the one assigned by amazon (not all AMIs are affected by this). This way you will be 
able to use mnesia on another instance if this one crashes (that new instance will need 
same hostname). [1]

3. All hostnames should be defined in /etc/hosts or in DNS that you control so that nodes 
can talk to each other. Plus, (afaik) erlang can't [easily?] communicate over IPs without 
names.

I personally don't know how well rabbitmq reacts to changes in /etc/hosts - say hostA was 
at 10.1.1.1 and that instance crashed and new instance is now 10.2.2.2. As a potential 
solution, (attention! shameless plug) - you may check out VPN-Cubed for EC2 solution, that 
can help you get rid of this problem. [3] Or you may consider Elastic IPs (but they cost $$$).

4. Your clients may need to set insist=True when opening connections. This may become 
especially relevant if some clients are in EC2 and some are not (or are located in another 
region). [2]

5. I would also consider if you need clustering in the first place. Since queues 
themselves are currently not replicated (afaik), I think one of the main use cases for 
clustering is support for large numbers of clients (to better spread IO and connections). 
If it's not your usecase, I don't know if you can benefit from clustering. I would love to 
hear others' opinions as to reasons why they are using broker clusters in their current form.

I may have missed something, hopefully other folks can add/adjust as needed.


[1] http://www.nabble.com/Mnesia-db-integrity-td21754791.html
[2] http://www.google.com/search?q=site%3Alists.rabbitmq.com+insist+ec2+internal
[3] http://www.cohesiveft.com/vpn4ec2/


Hope this gives you a good start!

Cheers,
Dmitriy



From clemesha at gmail.com  Wed May 20 21:11:26 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Wed, 20 May 2009 13:11:26 -0700
Subject: [rabbitmq-discuss] best practice for EC2 deployment?
In-Reply-To: <E92924F1-63B6-4740-BF51-56ACDDB13DD7@pobox.com>
References: <E92924F1-63B6-4740-BF51-56ACDDB13DD7@pobox.com>
Message-ID: <d272f0690905201311q45b4a141n69098b9d1886c21d@mail.gmail.com>

On Wed, May 20, 2009 at 12:30 PM, Geir Magnusson Jr. <geir at pobox.com> wrote:
> I'm about to create a rabbitMQ cluster on EC2.
>
> Anyone have any pointers or suggestions for best-practices or things
> that will make this easier?

I have some notes on this:
http://www.oceanobservatories.org/spaces/display/CIDev/RabbitMQ+Cluster


Important points are things like "RabbitMQ Mnesia db hardcodes the
current hostname",
and dealing with using the "insist" flag, which allows you to insist
to connect to specific cluster nodes.


and see this thread:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-March/003534.html


I used Nanite (http://github.com/ezmobius/nanite/tree/master) to
mostly automate the
process of bringing up nodes into the cluster, here are some notes:

http://www.oceanobservatories.org/spaces/display/CIDev/Nanite+-+Installing+and+Usage+on+EC2
http://www.oceanobservatories.org/spaces/display/CIDev/Nanite+Interactive+Provisioning+of+RabbitMQ+Cluster



hope this helps some,
if you have questions, please ask,
-Alex




> tia
>
> geir
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alex Clemesha
clemesha.org



From work at anomalizer.net  Thu May 21 12:26:00 2009
From: work at anomalizer.net (work at anomalizer.net)
Date: Thu, 21 May 2009 04:26:00 -0700 (PDT)
Subject: [rabbitmq-discuss] message queues in clustered mode
Message-ID: <16369.210.210.41.202.1242905160.squirrel@bilbo.syminet.com>

(rabbit n00b warning)
I have two machines januty00 and jaunty01 that are running in clustered
mode. There is a durable queue with a few messages in it. Here is the
behaviour I am seeing:


arvindj at jaunty00 ~ $ sudo rabbitmqctl list_queues
Listing queues ...
po_box  40
...done.
arvindj at jaunty00 ~ $ sudo rabbitmqctl status
Status of node rabbit at jaunty00 ...
[{running_applications,[{rabbit,"RabbitMQ","1.5.4"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                        {os_mon,"CPO  CXC 138 46","2.1.8"},
                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {nodes,[rabbit at jaunty01,rabbit at jaunty00]},
 {running_nodes,[rabbit at jaunty01,rabbit at jaunty00]}]
...done.



arvindj at jaunty01 ~ $ sudo rabbitmqctl list_queues
Listing queues ...
po_box  40
...done.
arvindj at jaunty01 ~ $ sudo rabbitmqctl status
Status of node rabbit at jaunty01 ...
[{running_applications,[{rabbit,"RabbitMQ","1.5.4"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                        {os_mon,"CPO  CXC 138 46","2.1.8"},
                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
 {nodes,[rabbit at jaunty01,rabbit at jaunty00]},
 {running_nodes,[rabbit at jaunty00,rabbit at jaunty01]}]
...done.


All looks fine when both machines are up. Now when jaunty00 goes down, the
queue disappears from jaunty01
arvindj at jaunty00 ~ $ sudo /etc/init.d/rabbitmq-server stop
Stopping rabbitmq-server: rabbitmq-server.
arvindj at jaunty01 ~ $ sudo rabbitmqctl list_queues
Listing queues ...
...done.


When I bring januty00 back, the queue reappears on jaunty01.The reverse is
not true i.e. when jaunty01 goes down, the queue is still available on
jaunty00

My understanding was that in clustered mode, if any one of the nodes goes
down, the queue is still available on the other nodes. What am I missing
here?




From brendan.ribera at gmail.com  Thu May 21 17:45:52 2009
From: brendan.ribera at gmail.com (Brendan Ribera)
Date: Thu, 21 May 2009 09:45:52 -0700
Subject: [rabbitmq-discuss] message queues in clustered mode
In-Reply-To: <16369.210.210.41.202.1242905160.squirrel@bilbo.syminet.com>
References: <16369.210.210.41.202.1242905160.squirrel@bilbo.syminet.com>
Message-ID: <ccad12500905210945g3fc6df92ya0711a4530abd13b@mail.gmail.com>

>From the Clustering Guide (emphasis mine):

"All data/state required for the operation of a RabbitMQ broker is
replicated across all nodes, for reliability and scaling, with full ACID
properties. *An exception to this are message queues, which currently only
reside on the node that created them*, though they are visible and reachable
from all nodes. Future releases of RabbitMQ will introduce migration and
replication of message queues."

http://www.rabbitmq.com/clustering.html#clustering

-Brendan

On Thu, May 21, 2009 at 4:26 AM, <work at anomalizer.net> wrote:

> (rabbit n00b warning)
> I have two machines januty00 and jaunty01 that are running in clustered
> mode. There is a durable queue with a few messages in it. Here is the
> behaviour I am seeing:
>
>
> arvindj at jaunty00 ~ $ sudo rabbitmqctl list_queues
> Listing queues ...
> po_box  40
> ...done.
> arvindj at jaunty00 ~ $ sudo rabbitmqctl status
> Status of node rabbit at jaunty00 ...
> [{running_applications,[{rabbit,"RabbitMQ","1.5.4"},
>                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
>                        {os_mon,"CPO  CXC 138 46","2.1.8"},
>                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
>                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
>                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
>  {nodes,[rabbit at jaunty01,rabbit at jaunty00]},
>  {running_nodes,[rabbit at jaunty01,rabbit at jaunty00]}]
> ...done.
>
>
>
> arvindj at jaunty01 ~ $ sudo rabbitmqctl list_queues
> Listing queues ...
> po_box  40
> ...done.
> arvindj at jaunty01 ~ $ sudo rabbitmqctl status
> Status of node rabbit at jaunty01 ...
> [{running_applications,[{rabbit,"RabbitMQ","1.5.4"},
>                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
>                        {os_mon,"CPO  CXC 138 46","2.1.8"},
>                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
>                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
>                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
>  {nodes,[rabbit at jaunty01,rabbit at jaunty00]},
>  {running_nodes,[rabbit at jaunty00,rabbit at jaunty01]}]
> ...done.
>
>
> All looks fine when both machines are up. Now when jaunty00 goes down, the
> queue disappears from jaunty01
> arvindj at jaunty00 ~ $ sudo /etc/init.d/rabbitmq-server stop
> Stopping rabbitmq-server: rabbitmq-server.
> arvindj at jaunty01 ~ $ sudo rabbitmqctl list_queues
> Listing queues ...
> ...done.
>
>
> When I bring januty00 back, the queue reappears on jaunty01.The reverse is
> not true i.e. when jaunty01 goes down, the queue is still available on
> jaunty00
>
> My understanding was that in clustered mode, if any one of the nodes goes
> down, the queue is still available on the other nodes. What am I missing
> here?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090521/9740b5e3/attachment.htm 

From bhyde at pobox.com  Thu May 21 18:10:42 2009
From: bhyde at pobox.com (Ben Hyde)
Date: Thu, 21 May 2009 13:10:42 -0400
Subject: [rabbitmq-discuss] best practice for EC2 deployment?
In-Reply-To: <4A146385.9060402@cohesiveft.com>
References: <E92924F1-63B6-4740-BF51-56ACDDB13DD7@pobox.com>
	<4A146385.9060402@cohesiveft.com>
Message-ID: <51FACF12-34B5-4ADB-B4A7-0E3E93E90C62@pobox.com>

On May 20, 2009, at 4:09 PM, Dmitriy Samovskiy wrote:
> Hi Geir,
>
> Geir Magnusson Jr. wrote:
>> I'm about to create a rabbitMQ cluster on EC2.

I'm cutting out much useful advice, all of which I agree with.  I  
agree with this too:

> 5. I would also consider if you need clustering in the first place.  
> Since queues
> themselves are currently not replicated...

I'm curious if people have a scheme in mind?

My preference, from real time control systems I've built, is to murder  
key components randomly to assure that recover is not an exceptional  
event.

But so far I've not managed that here.  I have a plan, a lousy plan.   
Something like a hot standby.

My two last go at this involved having my own name servers (tinydns,  
etc.) running with short times to live.  When hare.example.com goes  
missing a hot standby would leap into action; it would notify the name  
server that it was taking over; spin up rabbitmq; etc. etc.   But this  
handoff looks amazingly slow compared to the latency in the message  
flow.  I assume time to live and the mnesia startup are the hard bit.   
You can switch amazon elastic ip reasonably quickly, to work around  
the DNS time out.  I suspect there is some clever things to be done to  
improve maintenance of a mnesia in service of hot standby.





From msmith1638 at gmail.com  Thu May 21 20:51:54 2009
From: msmith1638 at gmail.com (msmith1638 at gmail.com)
Date: Thu, 21 May 2009 19:51:54 +0000
Subject: [rabbitmq-discuss] dropped messages in simple publish subscribe
	system
Message-ID: <0016e641db12cd6dea046a7179cd@google.com>

I have created a basic example using .NET clients. My broker is running in  
an out of the box configuration. Feeding into my broker I have a client  
that publishes messages via the basic publish method to two topic  
exchanges. Message persistence is turned off. On another machine I have a  
client that simply rips the messages from the two exchanges and takes some  
statistical data.

Input into the system is about 31,000 messages per second. Now if I run the  
client on the same machine as the input program and broker or on a  
different machine on the network my through put is only about 4500 - 5000  
messages per second. Is this the max amount of messages that Rabbit MQ can  
handle or am I missing some serious performance tweaks.

Would appreciate some performance tuning tips or pointers to documentation  
on this subject.

Thanks
Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090521/c2ad05fc/attachment.htm 

From dmitriy.samovskiy at cohesiveft.com  Thu May 21 21:14:21 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Thu, 21 May 2009 15:14:21 -0500
Subject: [rabbitmq-discuss] rabbitmq + graphite integration
Message-ID: <4A15B61D.2010600@cohesiveft.com>

Hi all,

This might be of interest to some of you I hope.

I put together some python scripts to be able to send data to Graphite via RabbitMQ 
instead of using direct TCP connections.

Graphite is an open source charts and graphing solution that was developed within Orbitz. 
It's very flexible and powerful and includes a very nice web UI (written in Django) and 
its model fits very well with AMQP - graphite doesn't do any polling by itself and just 
takes what you send, so you are in control of how to set up hierarchies of your metrics.

In particular, there is a script in examples/ directory which lets you build charts of 
your rabbitmq queues - how much memory they consume, how many messages there are, etc 
(essentially, what rabbitmqctl provides).

All written in python, uses py-amqplib. If you don't like python, it's quite easy to 
replace the consumer part with something else - all heavy lifting is performed by another 
process (called carbon-persister) with which your consumer can communicate over a pipe. 
This can even let you start building charts for the data you're already pumping via rabbit.


http://github.com/somic/graphite-rabbitmq

Graphite home: http://graphite.wikidot.com/


Cheers,
Dmitriy



From msmith1638 at gmail.com  Thu May 21 21:38:31 2009
From: msmith1638 at gmail.com (smittycb10)
Date: Thu, 21 May 2009 13:38:31 -0700 (PDT)
Subject: [rabbitmq-discuss]  dropped messages
Message-ID: <23659084.post@talk.nabble.com>


I have created a basic example using .NET clients. My broker is running in an
out of the box configuration. Feeding into my broker I have a client that
publishes messages via the basic publish method to two topic exchanges.
Message persistence is turned off. On another machine I have a client that
simply rips the messages from the two exchanges and takes some statistical
data.

Input into the system is about 31,000 messages per second. Now if I run the
client on the same machine as the input program and broker or on a different
machine on the network my through put is only about 4500 - 5000 messages per
second. Is this the max amount of messages that Rabbit MQ can handle or am I
missing some serious performance tweaks.

Would appreciate some performance tuning tips or pointers to documentation
on this subject.

Thanks
Mark
-- 
View this message in context: http://www.nabble.com/dropped-messages-tp23659084p23659084.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From msmith1638 at gmail.com  Thu May 21 22:58:55 2009
From: msmith1638 at gmail.com (smittycb10)
Date: Thu, 21 May 2009 14:58:55 -0700 (PDT)
Subject: [rabbitmq-discuss] dropped messages
In-Reply-To: <23659084.post@talk.nabble.com>
References: <23659084.post@talk.nabble.com>
Message-ID: <23660939.post@talk.nabble.com>


It seems that my biggest problem was understanding the difference between a
'#' and '*' in the routing key. Expect to see better results tomorrow.

Mark

smittycb10 wrote:
> 
> I have created a basic example using .NET clients. My broker is running in
> an out of the box configuration. Feeding into my broker I have a client
> that publishes messages via the basic publish method to two topic
> exchanges. Message persistence is turned off. On another machine I have a
> client that simply rips the messages from the two exchanges and takes some
> statistical data.
> 
> Input into the system is about 31,000 messages per second. Now if I run
> the client on the same machine as the input program and broker or on a
> different machine on the network my through put is only about 4500 - 5000
> messages per second. Is this the max amount of messages that Rabbit MQ can
> handle or am I missing some serious performance tweaks.
> 
> Would appreciate some performance tuning tips or pointers to documentation
> on this subject.
> 
> Thanks
> Mark
> 

-- 
View this message in context: http://www.nabble.com/dropped-messages-tp23659084p23660939.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From eric.hanchrow at gmail.com  Fri May 22 00:27:36 2009
From: eric.hanchrow at gmail.com (Eric Hanchrow)
Date: Thu, 21 May 2009 16:27:36 -0700
Subject: [rabbitmq-discuss] Is it reasonable to stop a rabbitmq server by
	sending it a fatal signal?
Message-ID: <36366a980905211627x4aa48a8ek81567556d8b024da@mail.gmail.com>

I've got a system that manages child processes, and stops those
processes by simply sending them a fatal signal -- in Unix parlance,
it does "kill -9 <process ID>".  The process that it currently manages
deal gracefully with being killed, but I'm hoping to add rabbitmq to
this system, and would prefer not to have to write any special code
for it -- that is, I'd like to be able to stop it, too, by sending it
a fatal signal.  Is this a reasonable thing to do?  In particular, can
I expect that whatever it's written to disk will remain consistent?

As it happens, I am not using, and don't plan to use, any persistent
queues; I assume this fact increases the chances I'll get away with
this.

Also, I've tried killing rabbitmq and restarting it, with clients
connected, and have not observed anything alarming.  I _did_ see a log
message or two like this

=INFO REPORT==== 21-May-2009::15:24:28 ===
Repaired persister log - 1 recovered, 0 bad

... but I figure those are _good_ signs, not bad.

So: dumb idea, or perfectly fine?

Thanks.



From matthias at lshift.net  Fri May 22 10:50:41 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 22 May 2009 10:50:41 +0100
Subject: [rabbitmq-discuss] dropped messages
In-Reply-To: <23660939.post@talk.nabble.com>
References: <23659084.post@talk.nabble.com> <23660939.post@talk.nabble.com>
Message-ID: <4A167571.4070603@lshift.net>

Mark,

smittycb10 wrote:
> It seems that my biggest problem was understanding the difference between a
> '#' and '*' in the routing key. Expect to see better results tomorrow.

> Would appreciate some performance tuning tips or pointers to documentation
> on this subject.

Here are a few tips of how to get the best performance out of AMQP:

- avoid topic exchanges if you can. Most use cases only need direct or 
fanout exchanges, which are much more efficient. It is a common 
misconception that direct exchanges only route messages to at most one 
queue. That is not the case; they can route messages to multiple queues.

- on the consuming side, use basic.consume instead of basic.get, and 
turn on 'no-ack' (thus eliminating the need to send acks), if your 
application semantics permit that.

- avoid creating lots of exchanges. A common mistake, again mostly due 
to misunderstanding about how direct exchanges work, is to create pairs 
of exchanges and queues when a single exchange with lots of queues would 
suffice. While RabbitMQ is perfectly happy with high exchange counts, 
and the number of exchanges has little or no impact on routing 
performance, exchange creation/deletion operations themselves are quite 
expensive.


Beyond that, RabbitMQ and the underlying Erlang/OTP runtime can be tuned 
to a degree. Plus the OS, in particular the network stack. In practice 
though most users get good enough performance with the standard settings.


Regards,

Matthias.



From nilesh at pokelondon.com  Fri May 22 14:05:07 2009
From: nilesh at pokelondon.com (Nilesh Ashra)
Date: Fri, 22 May 2009 14:05:07 +0100
Subject: [rabbitmq-discuss] Status/number of messages in a queue
Message-ID: <49F6FCAC-82AD-4668-B752-867BCE6B2959@pokelondon.com>

Hi all,

Is there a way to get the number of messages that are in Rabbit's  
queues? We're looking to get some status of the queue server  
(megabytes, number of messages serviced, number of messages  
unconsumed, etc), but can't find any leads!

Really appreciate the help guys,

Cheers,

- Nilesh



From matthias at lshift.net  Fri May 22 15:04:20 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 22 May 2009 15:04:20 +0100
Subject: [rabbitmq-discuss] Stomp Connector
In-Reply-To: <af1bce590905200912s26eb37fby4b5cbd573ded1d03@mail.gmail.com>
References: <af1bce590905200912s26eb37fby4b5cbd573ded1d03@mail.gmail.com>
Message-ID: <4A16B0E4.8000409@lshift.net>

Gavin,

Gavin M. Roy wrote:
> I am trying to find out how to create a durable and non-autoDelete
> queue, using only a connection that is subscribed to a queue, but not
> dequeueing.  I've tried passing in headers on connection and
> subscription but haven't had any success.

If my reading of the server code is right, one has to supply an
   auto-delete=false
header in SUBSCRIBE. The default is 'true', which means the queue gets 
deleted when its last subscriber disconnects.


Regards,

Matthias.



From msmith1638 at gmail.com  Fri May 22 15:42:54 2009
From: msmith1638 at gmail.com (smittycb10)
Date: Fri, 22 May 2009 07:42:54 -0700 (PDT)
Subject: [rabbitmq-discuss] dropped messages
In-Reply-To: <4A167571.4070603@lshift.net>
References: <23659084.post@talk.nabble.com> <23660939.post@talk.nabble.com>
	<4A167571.4070603@lshift.net>
Message-ID: <23671830.post@talk.nabble.com>


I am still having problems, when I run the client program on the server I am
getting the same degraded numbers as when run across the network. Some
details:
I am publishing about 4000 message per second to a direct exchange via the
.NET client, however I am only receiving about 10% of these messages on the
client subscription side.


My publish code looks like this:

Properties 
 if (m_RabbitProperties == null) 
      {
        m_RabbitProperties = m_RabbitChannel.CreateBasicProperties();
        m_RabbitProperties.AppId = "RemoteMIS";
        m_RabbitProperties.DeliveryMode = 1;
        m_RabbitProperties.Expiration = "1000";
      }

creating the channel:
 if (m_RabbitConnec == null)
        m_RabbitConnec = new
ConnectionFactory().CreateConnection(AMPQ_SERVER);

      if (m_RabbitChannel == null)
        m_RabbitChannel = m_RabbitConnec.CreateModel();


publishing the message:
 m_RabbitChannel.BasicPublish("quotes", "quotes", true, true,
m_RabbitProperties, packet);
//note queue and exchange name are the same:

Exchanges are set up as follows with the subscription pattern:
  using (IConnection conn = new
ConnectionFactory().CreateConnection(rabbitBroker)) 
      {
        using (IModel channel = conn.CreateModel()) 
        {
          Subscription sub = new Subscription(channel, "quotes", "direct",
"quotes");
          foreach (BasicDeliverEventArgs ev in sub) 
          {
           
            int totalLength = ev.Body.Length / MISQuote.misQuoteSz;
            int index = 0;
           /**
            * process the message
            **/
            sub.Ack(ev);
          }
        }
      }

What am I doing wrong??
Thanks
Mark

Matthias Radestock-2 wrote:
> 
> Mark,
> 
> smittycb10 wrote:
>> It seems that my biggest problem was understanding the difference between
>> a
>> '#' and '*' in the routing key. Expect to see better results tomorrow.
> 
>> Would appreciate some performance tuning tips or pointers to
>> documentation
>> on this subject.
> 
> Here are a few tips of how to get the best performance out of AMQP:
> 
> - avoid topic exchanges if you can. Most use cases only need direct or 
> fanout exchanges, which are much more efficient. It is a common 
> misconception that direct exchanges only route messages to at most one 
> queue. That is not the case; they can route messages to multiple queues.
> 
> - on the consuming side, use basic.consume instead of basic.get, and 
> turn on 'no-ack' (thus eliminating the need to send acks), if your 
> application semantics permit that.
> 
> - avoid creating lots of exchanges. A common mistake, again mostly due 
> to misunderstanding about how direct exchanges work, is to create pairs 
> of exchanges and queues when a single exchange with lots of queues would 
> suffice. While RabbitMQ is perfectly happy with high exchange counts, 
> and the number of exchanges has little or no impact on routing 
> performance, exchange creation/deletion operations themselves are quite 
> expensive.
> 
> 
> Beyond that, RabbitMQ and the underlying Erlang/OTP runtime can be tuned 
> to a degree. Plus the OS, in particular the network stack. In practice 
> though most users get good enough performance with the standard settings.
> 
> 
> Regards,
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://www.nabble.com/dropped-messages-tp23659084p23671830.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Fri May 22 16:12:16 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 22 May 2009 16:12:16 +0100
Subject: [rabbitmq-discuss] dropped messages
In-Reply-To: <23671830.post@talk.nabble.com>
References: <23659084.post@talk.nabble.com>
	<23660939.post@talk.nabble.com>	<4A167571.4070603@lshift.net>
	<23671830.post@talk.nabble.com>
Message-ID: <4A16C0D0.2090908@lshift.net>

Mark,

smittycb10 wrote:
> I am still having problems, when I run the client program on the server I am
> getting the same degraded numbers as when run across the network. Some
> details:
> I am publishing about 4000 message per second to a direct exchange via the
> .NET client, however I am only receiving about 10% of these messages on the
> client subscription side.
 > [...]
>  m_RabbitChannel.BasicPublish("quotes", "quotes", true, true,
> m_RabbitProperties, packet);

Why are you setting mandatory=true and immediate=true? The latter means 
the server will return messages unless it can *immediately* send them on 
to a client, i.e. it will never enqueue the messages.

Also, don't set mandatory=true unless you have to - it degrades performance.


Regards,

Matthias.




From nemik at nemik.net  Fri May 22 16:16:46 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Fri, 22 May 2009 10:16:46 -0500
Subject: [rabbitmq-discuss] Status/number of messages in a queue
In-Reply-To: <49F6FCAC-82AD-4668-B752-867BCE6B2959@pokelondon.com>
References: <49F6FCAC-82AD-4668-B752-867BCE6B2959@pokelondon.com>
Message-ID: <acceaadf0905220816y4500573ftb7999fd6200d9d3e@mail.gmail.com>

I'm pretty sure you can use the rabbitmqctl list_queues to do this.

On Fri, May 22, 2009 at 8:05 AM, Nilesh Ashra <nilesh at pokelondon.com> wrote:

> Hi all,
>
> Is there a way to get the number of messages that are in Rabbit's
> queues? We're looking to get some status of the queue server
> (megabytes, number of messages serviced, number of messages
> unconsumed, etc), but can't find any leads!
>
> Really appreciate the help guys,
>
> Cheers,
>
> - Nilesh
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090522/70777319/attachment.htm 

From msmith1638 at gmail.com  Fri May 22 16:35:30 2009
From: msmith1638 at gmail.com (smittycb10)
Date: Fri, 22 May 2009 08:35:30 -0700 (PDT)
Subject: [rabbitmq-discuss] dropped messages
In-Reply-To: <4A16C0D0.2090908@lshift.net>
References: <23659084.post@talk.nabble.com> <23660939.post@talk.nabble.com>
	<4A167571.4070603@lshift.net> <23671830.post@talk.nabble.com>
	<4A16C0D0.2090908@lshift.net>
Message-ID: <23673004.post@talk.nabble.com>


Thanks for the reply,
I changed these settings so that now my publish looks like this:
m_RabbitChannel.BasicPublish(QUOTES_EX, QUOTES_EX, m_RabbitProperties,
packet);

however I still have the same problem 100,000's messages in and only 1,000's
of messages out.
Do I need to anything to broker? 
Is a message rate of 100,000 per second unreasonable? 
Am I publishing and subscribing in the most efficent manner?

Going to be spending the weekend reading up on AMPQ and Rabbits .NET
client:-(

Thanks


Matthias Radestock-2 wrote:
> 
> Mark,
> 
> smittycb10 wrote:
>> I am still having problems, when I run the client program on the server I
>> am
>> getting the same degraded numbers as when run across the network. Some
>> details:
>> I am publishing about 4000 message per second to a direct exchange via
>> the
>> .NET client, however I am only receiving about 10% of these messages on
>> the
>> client subscription side.
>  > [...]
>>  m_RabbitChannel.BasicPublish("quotes", "quotes", true, true,
>> m_RabbitProperties, packet);
> 
> Why are you setting mandatory=true and immediate=true? The latter means 
> the server will return messages unless it can *immediately* send them on 
> to a client, i.e. it will never enqueue the messages.
> 
> Also, don't set mandatory=true unless you have to - it degrades
> performance.
> 
> 
> Regards,
> 
> Matthias.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://www.nabble.com/dropped-messages-tp23659084p23673004.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From msmith1638 at gmail.com  Fri May 22 20:39:24 2009
From: msmith1638 at gmail.com (smittycb10)
Date: Fri, 22 May 2009 12:39:24 -0700 (PDT)
Subject: [rabbitmq-discuss] dropped messages
In-Reply-To: <23673004.post@talk.nabble.com>
References: <23659084.post@talk.nabble.com> <23660939.post@talk.nabble.com>
	<4A167571.4070603@lshift.net> <23671830.post@talk.nabble.com>
	<4A16C0D0.2090908@lshift.net> <23673004.post@talk.nabble.com>
Message-ID: <23676641.post@talk.nabble.com>


Just wondering, is there a max number of messages any one channel can have
queued in it at one time? I am currently trying to squeeze all the messages
into one channel, should I be splitting work across channels and threads on
the receiving side??
Thanks 

smittycb10 wrote:
> 
> Thanks for the reply,
> I changed these settings so that now my publish looks like this:
> m_RabbitChannel.BasicPublish(QUOTES_EX, QUOTES_EX, m_RabbitProperties,
> packet);
> 
> however I still have the same problem 100,000's messages in and only
> 1,000's of messages out.
> Do I need to anything to broker? 
> Is a message rate of 100,000 per second unreasonable? 
> Am I publishing and subscribing in the most efficent manner?
> 
> Going to be spending the weekend reading up on AMPQ and Rabbits .NET
> client:-(
> 
> Thanks
> 
> 
> Matthias Radestock-2 wrote:
>> 
>> Mark,
>> 
>> smittycb10 wrote:
>>> I am still having problems, when I run the client program on the server
>>> I am
>>> getting the same degraded numbers as when run across the network. Some
>>> details:
>>> I am publishing about 4000 message per second to a direct exchange via
>>> the
>>> .NET client, however I am only receiving about 10% of these messages on
>>> the
>>> client subscription side.
>>  > [...]
>>>  m_RabbitChannel.BasicPublish("quotes", "quotes", true, true,
>>> m_RabbitProperties, packet);
>> 
>> Why are you setting mandatory=true and immediate=true? The latter means 
>> the server will return messages unless it can *immediately* send them on 
>> to a client, i.e. it will never enqueue the messages.
>> 
>> Also, don't set mandatory=true unless you have to - it degrades
>> performance.
>> 
>> 
>> Regards,
>> 
>> Matthias.
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> 

-- 
View this message in context: http://www.nabble.com/dropped-messages-tp23659084p23676641.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From work at anomalizer.net  Sat May 23 07:59:37 2009
From: work at anomalizer.net (Arvind Jayaprakash)
Date: Sat, 23 May 2009 12:29:37 +0530
Subject: [rabbitmq-discuss] Status/number of messages in a queue
In-Reply-To: <49F6FCAC-82AD-4668-B752-867BCE6B2959@pokelondon.com>
References: <49F6FCAC-82AD-4668-B752-867BCE6B2959@pokelondon.com>
Message-ID: <20090523065937.GA9310@aa>

On May 22, Nilesh Ashra wrote:
>Hi all,
>
>Is there a way to get the number of messages that are in Rabbit's  
>queues? We're looking to get some status of the queue server  
>(megabytes, number of messages serviced, number of messages  
>unconsumed, etc), but can't find any leads!
>
>Really appreciate the help guys,

If you are merely looking for number of unconsumed messages, this should
suffice: http://www.rabbitmq.com/admin-guide.html#list_queues



From eric at grokthis.net  Sat May 23 13:16:06 2009
From: eric at grokthis.net (Eric Windisch)
Date: Sat, 23 May 2009 08:16:06 -0400
Subject: [rabbitmq-discuss] Status/number of messages in a queue
In-Reply-To: <49F6FCAC-82AD-4668-B752-867BCE6B2959@pokelondon.com>
References: <49F6FCAC-82AD-4668-B752-867BCE6B2959@pokelondon.com>
Message-ID: <C4770633-BBFC-474D-8BD4-626F21CAA86A@grokthis.net>


On May 22, 2009, at 9:05 AM, Nilesh Ashra wrote:

> (megabytes, number of messages serviced, number of messages
> unconsumed, etc), but can't find any leads!

Total messages serviced is available in a patch I submitted to this  
list a week or two ago, but I wouldn't expect to rely on it long term  
(it hasn't been merged into rabbit).

Regards,
Eric Windisch



From mike at middlesoft.co.uk  Mon May 25 16:43:51 2009
From: mike at middlesoft.co.uk (Michael Barker)
Date: Mon, 25 May 2009 16:43:51 +0100
Subject: [rabbitmq-discuss] [PATCH] Licensing issue with AMQP spec files and
	generated code
Message-ID: <80d1dfde0905250843v7c8586d2v6e88af8d953503a1@mail.gmail.com>

Hi,

In the process of building the Mono/AMQP integration, we've run into a
small problem with the licensing of the AMQP spec files and the
generated code.  The email from Mirco Bauer who handles the packaging
for the Debian distribution raised the issue which is detailed here:

http://lists.ximian.com/pipermail/mono-devel-list/2009-May/032255.html

We are going to resolve this by removing the spec files from Mono
source tree and change the generator so that it does not emit comments
verbatim from the spec files, which will be sufficient to adhere to
the DFSG.  I have attached a small patch to this email that does this.
 There is an additional command line option (/c) that can be used to
re-enable the comments.  It would be useful if this patch could merged
as it would save me from having to maintain this patch outside of the
main rabbitmq source tree.

Regards,
Michael Barker.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: comments.patch
Type: text/x-patch
Size: 3181 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090525/7aad5220/attachment.bin 

From alexis.richardson at gmail.com  Mon May 25 16:50:00 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 25 May 2009 16:50:00 +0100
Subject: [rabbitmq-discuss] [PATCH] Licensing issue with AMQP spec files
	and generated code
In-Reply-To: <80d1dfde0905250843v7c8586d2v6e88af8d953503a1@mail.gmail.com>
References: <80d1dfde0905250843v7c8586d2v6e88af8d953503a1@mail.gmail.com>
Message-ID: <167204d20905250850w1f8341fai2f826f76cd548226@mail.gmail.com>

Michael,

Thanks for that note and your patch.

You should not use the AMQP-licensed XML files for DFSG compliant
distributions.  Please use the BSD licensed .json and .xml from our
repos, which are DFSG compliant.  How we got there is a long story
that began when we noticed this problem in 2007 and set out to resolve
it.  Note that we fixed the problem and that RabbitMQ is now
disributed in Ubuntu universe and one of the Debian distributions.
Let me know if you need more info and background on this.

Best wishes

alexis



On Mon, May 25, 2009 at 4:43 PM, Michael Barker <mike at middlesoft.co.uk> wrote:
> Hi,
>
> In the process of building the Mono/AMQP integration, we've run into a
> small problem with the licensing of the AMQP spec files and the
> generated code. ?The email from Mirco Bauer who handles the packaging
> for the Debian distribution raised the issue which is detailed here:
>
> http://lists.ximian.com/pipermail/mono-devel-list/2009-May/032255.html
>
> We are going to resolve this by removing the spec files from Mono
> source tree and change the generator so that it does not emit comments
> verbatim from the spec files, which will be sufficient to adhere to
> the DFSG. ?I have attached a small patch to this email that does this.
> ?There is an additional command line option (/c) that can be used to
> re-enable the comments. ?It would be useful if this patch could merged
> as it would save me from having to maintain this patch outside of the
> main rabbitmq source tree.
>
> Regards,
> Michael Barker.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Mon May 25 17:15:29 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 25 May 2009 17:15:29 +0100
Subject: [rabbitmq-discuss] [PATCH] Licensing issue with AMQP spec files
	and generated code
In-Reply-To: <167204d20905250850w1f8341fai2f826f76cd548226@mail.gmail.com>
References: <80d1dfde0905250843v7c8586d2v6e88af8d953503a1@mail.gmail.com>
	<167204d20905250850w1f8341fai2f826f76cd548226@mail.gmail.com>
Message-ID: <167204d20905250915m21977e33g493441a37d464176@mail.gmail.com>

Michael

Apologies.  The DFSG-safe spec in our repos is .json only but you
could very easily generate a .xml file from it.  This would also be
DFSG-safe due to the BSD license on the .json file.  Please note that
these files support AMQP 0-8.  If you would like to see a DFSG-safe
document for another spec version, please shout out about it here.

alexis


On Mon, May 25, 2009 at 4:50 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> Michael,
>
> Thanks for that note and your patch.
>
> You should not use the AMQP-licensed XML files for DFSG compliant
> distributions. ?Please use the BSD licensed .json and .xml from our
> repos, which are DFSG compliant. ?How we got there is a long story
> that began when we noticed this problem in 2007 and set out to resolve
> it. ?Note that we fixed the problem and that RabbitMQ is now
> disributed in Ubuntu universe and one of the Debian distributions.
> Let me know if you need more info and background on this.
>
> Best wishes
>
> alexis
>
>
>
> On Mon, May 25, 2009 at 4:43 PM, Michael Barker <mike at middlesoft.co.uk> wrote:
>> Hi,
>>
>> In the process of building the Mono/AMQP integration, we've run into a
>> small problem with the licensing of the AMQP spec files and the
>> generated code. ?The email from Mirco Bauer who handles the packaging
>> for the Debian distribution raised the issue which is detailed here:
>>
>> http://lists.ximian.com/pipermail/mono-devel-list/2009-May/032255.html
>>
>> We are going to resolve this by removing the spec files from Mono
>> source tree and change the generator so that it does not emit comments
>> verbatim from the spec files, which will be sufficient to adhere to
>> the DFSG. ?I have attached a small patch to this email that does this.
>> ?There is an additional command line option (/c) that can be used to
>> re-enable the comments. ?It would be useful if this patch could merged
>> as it would save me from having to maintain this patch outside of the
>> main rabbitmq source tree.
>>
>> Regards,
>> Michael Barker.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>



From jewel at subvert-the-dominant-paradigm.net  Mon May 25 17:16:52 2009
From: jewel at subvert-the-dominant-paradigm.net (John Leuner)
Date: Mon, 25 May 2009 18:16:52 +0200
Subject: [rabbitmq-discuss] Debian dependencies
In-Reply-To: <20090514133031.GA16435@mrnibble.lshift.net>
References: <1242212806.14540.38.camel@cmalu.WAG54GS>
	<20090513111319.GA3047@mrnibble.lshift.net>
	<1242306634.14540.43.camel@cmalu.WAG54GS>
	<20090514133031.GA16435@mrnibble.lshift.net>
Message-ID: <1243268212.14540.51.camel@cmalu.WAG54GS>

On Thu, 2009-05-14 at 14:30 +0100, Matthew Sackman wrote:
> On Thu, May 14, 2009 at 03:10:34PM +0200, John Leuner wrote:
> > On Wed, 2009-05-13 at 12:13 +0100, Matthew Sackman wrote:
> > > It
> > > seemed to me that erlang-nox should really depend on erlang-os-mon.
> > > Is that your feeling too (in which case I'll raise a Debian bug for
> > > it) or is there some reason why os-mon has mysteriously been left
> > > out?
> > 
> > I'm not sure, I asked the maintainer and he suggested erlang-nox and
> > erlang-os-mon.
> 
> Oh ok. That strikes me as a bit odd, but I guess if there is some reason
> for it...
> 
> Btw, don't your current dependencies mean that the package could never
> be installed by someone who isn't using the new split-out version of
> erlang, or have I missed something?
> 
> Because I don't think you're allowed parenthesis in dependencies, I can't
> see how to express this more nicely, but don't you really want:
> 
> Depends: erlang-nox, erlang-os-mon | erlang-nox (<< 1:13.b-dfsg1-1),
>          adduser, logrotate, ${misc:Depends}
> 
> I.e. any version of erlang-nox, but if erlang-os-mon isn't installed then
> we must have -nox << 1:13.b-dfsg1-1.
> 
> That should allow the package to be installed on Debian systems without
> the new split-out r13 packages, no?

Yes, that would be better for the debian package on the rabbit site. 

For debian unstable, however, I was just trying to keep the package
consistent with whatever is currently in unstable.

John





From matthias at lshift.net  Mon May 25 17:52:38 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 25 May 2009 17:52:38 +0100
Subject: [rabbitmq-discuss] Is it reasonable to stop a rabbitmq server
 by sending it a fatal signal?
In-Reply-To: <36366a980905211627x4aa48a8ek81567556d8b024da@mail.gmail.com>
References: <36366a980905211627x4aa48a8ek81567556d8b024da@mail.gmail.com>
Message-ID: <4A1ACCD6.8020108@lshift.net>

Eric,

Eric Hanchrow wrote:
> I've got a system that manages child processes, and stops those
> processes by simply sending them a fatal signal -- in Unix parlance,
> it does "kill -9 <process ID>".
> [...]
> So: dumb idea, or perfectly fine?

Somewhere inbetween ;) It will probably work, but I certainly wouldn't 
recommend it as a general procedure for stopping RabbitMQ.


Matthias.



From dave.smith.to at gmail.com  Mon May 25 19:23:41 2009
From: dave.smith.to at gmail.com (Dave Smith)
Date: Mon, 25 May 2009 14:23:41 -0400
Subject: [rabbitmq-discuss] Is it reasonable to stop a rabbitmq server
	by sending it a fatal signal?
In-Reply-To: <36366a980905211627x4aa48a8ek81567556d8b024da@mail.gmail.com>
References: <36366a980905211627x4aa48a8ek81567556d8b024da@mail.gmail.com>
Message-ID: <5ea453f90905251123t13502696q613fbdc4f711f7df@mail.gmail.com>

I think in general sending a SIGKILL (9) to a process should be done in
exceptional cases, and not as a part of a normal shutdown.  Typically
applications respond to SIGTERM (15) to shutdown in an orderly manner.

I'm not sure of the details of CouchDB, but BEAM response to SIGTERM in a
reasonable way and terminates gracefully.

--DS


2009/5/21 Eric Hanchrow <eric.hanchrow at gmail.com>

> I've got a system that manages child processes, and stops those
> processes by simply sending them a fatal signal -- in Unix parlance,
> it does "kill -9 <process ID>".  The process that it currently manages
> deal gracefully with being killed, but I'm hoping to add rabbitmq to
> this system, and would prefer not to have to write any special code
> for it -- that is, I'd like to be able to stop it, too, by sending it
> a fatal signal.  Is this a reasonable thing to do?  In particular, can
> I expect that whatever it's written to disk will remain consistent?
>
> As it happens, I am not using, and don't plan to use, any persistent
> queues; I assume this fact increases the chances I'll get away with
> this.
>
> Also, I've tried killing rabbitmq and restarting it, with clients
> connected, and have not observed anything alarming.  I _did_ see a log
> message or two like this
>
> =INFO REPORT==== 21-May-2009::15:24:28 ===
> Repaired persister log - 1 recovered, 0 bad
>
> ... but I figure those are _good_ signs, not bad.
>
> So: dumb idea, or perfectly fine?
>
> Thanks.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090525/2722e916/attachment.htm 

From dave.smith.to at gmail.com  Mon May 25 19:26:33 2009
From: dave.smith.to at gmail.com (Dave Smith)
Date: Mon, 25 May 2009 14:26:33 -0400
Subject: [rabbitmq-discuss] Is it reasonable to stop a rabbitmq server
	by sending it a fatal signal?
In-Reply-To: <5ea453f90905251123t13502696q613fbdc4f711f7df@mail.gmail.com>
References: <36366a980905211627x4aa48a8ek81567556d8b024da@mail.gmail.com>
	<5ea453f90905251123t13502696q613fbdc4f711f7df@mail.gmail.com>
Message-ID: <5ea453f90905251126j379c8f5fua60352f703cfac6e@mail.gmail.com>

RabbitMQ I meant.  Subscribed to too many mailing lists.

--DS


2009/5/25 Dave Smith <dave.smith.to at gmail.com>

> I think in general sending a SIGKILL (9) to a process should be done in
> exceptional cases, and not as a part of a normal shutdown.  Typically
> applications respond to SIGTERM (15) to shutdown in an orderly manner.
>
> I'm not sure of the details of CouchDB, but BEAM response to SIGTERM in a
> reasonable way and terminates gracefully.
>
> --DS
>
>
> 2009/5/21 Eric Hanchrow <eric.hanchrow at gmail.com>
>
> I've got a system that manages child processes, and stops those
>> processes by simply sending them a fatal signal -- in Unix parlance,
>> it does "kill -9 <process ID>".  The process that it currently manages
>> deal gracefully with being killed, but I'm hoping to add rabbitmq to
>> this system, and would prefer not to have to write any special code
>> for it -- that is, I'd like to be able to stop it, too, by sending it
>> a fatal signal.  Is this a reasonable thing to do?  In particular, can
>> I expect that whatever it's written to disk will remain consistent?
>>
>> As it happens, I am not using, and don't plan to use, any persistent
>> queues; I assume this fact increases the chances I'll get away with
>> this.
>>
>> Also, I've tried killing rabbitmq and restarting it, with clients
>> connected, and have not observed anything alarming.  I _did_ see a log
>> message or two like this
>>
>> =INFO REPORT==== 21-May-2009::15:24:28 ===
>> Repaired persister log - 1 recovered, 0 bad
>>
>> ... but I figure those are _good_ signs, not bad.
>>
>> So: dumb idea, or perfectly fine?
>>
>> Thanks.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090525/d9d7308c/attachment.htm 

From mike at middlesoft.co.uk  Mon May 25 19:41:34 2009
From: mike at middlesoft.co.uk (Michael Barker)
Date: Mon, 25 May 2009 19:41:34 +0100
Subject: [rabbitmq-discuss] [PATCH] Licensing issue with AMQP spec files
	and generated code
In-Reply-To: <167204d20905250915m21977e33g493441a37d464176@mail.gmail.com>
References: <80d1dfde0905250843v7c8586d2v6e88af8d953503a1@mail.gmail.com>
	<167204d20905250850w1f8341fai2f826f76cd548226@mail.gmail.com>
	<167204d20905250915m21977e33g493441a37d464176@mail.gmail.com>
Message-ID: <80d1dfde0905251141k7e99a94aj7a9cff16f20f276a@mail.gmail.com>

Hi Alexis,

The guys from Debian seem to be happy with simply making sure the
comments are not present in the generated code and we aren't use the
XML files during the build (some tricky dependency issues), we've
checked in the generated source files.  Therefore, were okay for the
moment.  If there are any other issues I'll let you know.

Regards,
Michael Barker.

On Mon, May 25, 2009 at 5:15 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> Michael
>
> Apologies. ?The DFSG-safe spec in our repos is .json only but you
> could very easily generate a .xml file from it. ?This would also be
> DFSG-safe due to the BSD license on the .json file. ?Please note that
> these files support AMQP 0-8. ?If you would like to see a DFSG-safe
> document for another spec version, please shout out about it here.
>
> alexis
>
>
> On Mon, May 25, 2009 at 4:50 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>> Michael,
>>
>> Thanks for that note and your patch.
>>
>> You should not use the AMQP-licensed XML files for DFSG compliant
>> distributions. ?Please use the BSD licensed .json and .xml from our
>> repos, which are DFSG compliant. ?How we got there is a long story
>> that began when we noticed this problem in 2007 and set out to resolve
>> it. ?Note that we fixed the problem and that RabbitMQ is now
>> disributed in Ubuntu universe and one of the Debian distributions.
>> Let me know if you need more info and background on this.
>>
>> Best wishes
>>
>> alexis
>>
>>
>>
>> On Mon, May 25, 2009 at 4:43 PM, Michael Barker <mike at middlesoft.co.uk> wrote:
>>> Hi,
>>>
>>> In the process of building the Mono/AMQP integration, we've run into a
>>> small problem with the licensing of the AMQP spec files and the
>>> generated code. ?The email from Mirco Bauer who handles the packaging
>>> for the Debian distribution raised the issue which is detailed here:
>>>
>>> http://lists.ximian.com/pipermail/mono-devel-list/2009-May/032255.html
>>>
>>> We are going to resolve this by removing the spec files from Mono
>>> source tree and change the generator so that it does not emit comments
>>> verbatim from the spec files, which will be sufficient to adhere to
>>> the DFSG. ?I have attached a small patch to this email that does this.
>>> ?There is an additional command line option (/c) that can be used to
>>> re-enable the comments. ?It would be useful if this patch could merged
>>> as it would save me from having to maintain this patch outside of the
>>> main rabbitmq source tree.
>>>
>>> Regards,
>>> Michael Barker.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>



From alexis.richardson at gmail.com  Mon May 25 19:53:20 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 25 May 2009 19:53:20 +0100
Subject: [rabbitmq-discuss] [PATCH] Licensing issue with AMQP spec files
	and generated code
In-Reply-To: <80d1dfde0905251141k7e99a94aj7a9cff16f20f276a@mail.gmail.com>
References: <80d1dfde0905250843v7c8586d2v6e88af8d953503a1@mail.gmail.com>
	<167204d20905250850w1f8341fai2f826f76cd548226@mail.gmail.com>
	<167204d20905250915m21977e33g493441a37d464176@mail.gmail.com>
	<80d1dfde0905251141k7e99a94aj7a9cff16f20f276a@mail.gmail.com>
Message-ID: <167204d20905251153p3a03ecacobf4512e6d2473a2a@mail.gmail.com>

Michael,

Many thanks.

alexis


On Mon, May 25, 2009 at 7:41 PM, Michael Barker <mike at middlesoft.co.uk> wrote:
> Hi Alexis,
>
> The guys from Debian seem to be happy with simply making sure the
> comments are not present in the generated code and we aren't use the
> XML files during the build (some tricky dependency issues), we've
> checked in the generated source files. ?Therefore, were okay for the
> moment. ?If there are any other issues I'll let you know.
>
> Regards,
> Michael Barker.
>
> On Mon, May 25, 2009 at 5:15 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>> Michael
>>
>> Apologies. ?The DFSG-safe spec in our repos is .json only but you
>> could very easily generate a .xml file from it. ?This would also be
>> DFSG-safe due to the BSD license on the .json file. ?Please note that
>> these files support AMQP 0-8. ?If you would like to see a DFSG-safe
>> document for another spec version, please shout out about it here.
>>
>> alexis
>>
>>
>> On Mon, May 25, 2009 at 4:50 PM, Alexis Richardson
>> <alexis.richardson at gmail.com> wrote:
>>> Michael,
>>>
>>> Thanks for that note and your patch.
>>>
>>> You should not use the AMQP-licensed XML files for DFSG compliant
>>> distributions. ?Please use the BSD licensed .json and .xml from our
>>> repos, which are DFSG compliant. ?How we got there is a long story
>>> that began when we noticed this problem in 2007 and set out to resolve
>>> it. ?Note that we fixed the problem and that RabbitMQ is now
>>> disributed in Ubuntu universe and one of the Debian distributions.
>>> Let me know if you need more info and background on this.
>>>
>>> Best wishes
>>>
>>> alexis
>>>
>>>
>>>
>>> On Mon, May 25, 2009 at 4:43 PM, Michael Barker <mike at middlesoft.co.uk> wrote:
>>>> Hi,
>>>>
>>>> In the process of building the Mono/AMQP integration, we've run into a
>>>> small problem with the licensing of the AMQP spec files and the
>>>> generated code. ?The email from Mirco Bauer who handles the packaging
>>>> for the Debian distribution raised the issue which is detailed here:
>>>>
>>>> http://lists.ximian.com/pipermail/mono-devel-list/2009-May/032255.html
>>>>
>>>> We are going to resolve this by removing the spec files from Mono
>>>> source tree and change the generator so that it does not emit comments
>>>> verbatim from the spec files, which will be sufficient to adhere to
>>>> the DFSG. ?I have attached a small patch to this email that does this.
>>>> ?There is an additional command line option (/c) that can be used to
>>>> re-enable the comments. ?It would be useful if this patch could merged
>>>> as it would save me from having to maintain this patch outside of the
>>>> main rabbitmq source tree.
>>>>
>>>> Regards,
>>>> Michael Barker.
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>



From matthias at lshift.net  Mon May 25 22:07:39 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 25 May 2009 22:07:39 +0100
Subject: [rabbitmq-discuss] dropped messages
In-Reply-To: <23673004.post@talk.nabble.com>
References: <23659084.post@talk.nabble.com>
	<23660939.post@talk.nabble.com>	<4A167571.4070603@lshift.net>
	<23671830.post@talk.nabble.com>	<4A16C0D0.2090908@lshift.net>
	<23673004.post@talk.nabble.com>
Message-ID: <4A1B089B.7020204@lshift.net>

Mark,

smittycb10 wrote:
> however I still have the same problem 100,000's messages in and only
> 1,000's of messages out. Am I publishing and subscribing in the most
> efficent manner?

Can you send through the *complete* code? It's impossible to tell
otherwise why exactly you are getting the results you are seeing.

How are you measuring the rates? If on the sending side you are just
timing a loop of publishes then all you are measuring is the time it
takes to hand over the messages to the kernel. They can get buffered
there, in the network layer, in multiple layers at the broker, etc, etc.

Also, since AMQP's basic.publish is asynchronous, if the publishing 
connection is not terminated cleanly then some messages will inevitably 
get lost.

It's also worth remembering that RabbitMQ is a message *queuing* system, 
so one shouldn't be surprised if occasionally it queues some messages ;) 
What's more, because RabbitMQ's queuing is quite efficient, when you 
push the system hard, i.e. by feeding it messages as fast as you can, it 
will handle the incoming messages at a faster rate than it sends them to 
consumers.

For meaningful benchmark results it is therefore important to throttle
the producer, e.g. send messages at a fixed rate, monitor the rate at
which they are received by consumers, and slowly increase the producing
rate until the consumption rate starts falling behind.

>> Do I need to anything to broker?

Unlikely.

>> Is a message rate of 100,000 per second unreasonable?

For a single producer->broker->consumer chain that would be quite a high
rate - 10s of thousands of msgs/s is more realistic on stock hardware.

If you have several independent message streams then higher total
throughputs can be achieved when running on lots of cores.

> is there a max number of messages any one channel can have queued in
> it at one time?

No.

> I am currently trying to squeeze all the messages into one channel,
> should I be splitting work across channels and threads on the
> receiving side??

Having multiple channels and, even better, multiple connections, 
provides more opportunities for parellelism at the server. Whether or 
not that actually makes a positive difference depends on lots of factors.


Regards,

Matthias.



From rpunnoose at proteus-technologies.com  Tue May 26 17:31:18 2009
From: rpunnoose at proteus-technologies.com (Roshan Punnoose)
Date: Tue, 26 May 2009 12:31:18 -0400
Subject: [rabbitmq-discuss] Performance question
Message-ID: <C6419196.9003%rpunnoose@proteus-technologies.com>

I have a one producer, one consumer queue running locally for a performance
test. In terms of just server and client configuration, what is the best way
to increase performance. For a simple queue publisher and consumer, I?m
getting about 10k a second for simple byte messages.

Here is some of the code:

Publisher:
channel.exchangeDeclare("exchangename", "direct");
channel.queueDeclare("queuename");                    channel
.queueBind("queuename", "exchangename",
"routingKey");                     byte[] messageBodyBytes = new byte[0];
int count = 0;                    long start = System.currentTimeMillis();
String name = Thread.currentThread().getName();                    for (int
i = 0; i < 100000; i++) {
channel.basicPublish("exchangename", "routingKey",
null, messageBodyBytes);                        count++;
if ((System.currentTimeMillis() - start) > 1000) {
System.out.println(name + "-" + count);                            count =
0;                            start = System.currentTimeMillis();
}                     }


Consumer:
channel.basicConsume("queuename", false, new DefaultConsumer(channel) {
int count = 0;            long start = System.currentTimeMillis();
@Override            public void handleDelivery(String consumerTag, Envelope
envelope,                    BasicProperties properties, byte[] body) throws
IOException {                count++;                if
((System.currentTimeMillis() - start) > 1000) {
System.out.println(count);                    count = 0;
start = System.currentTimeMillis();                }
this.getChannel().basicAck(envelope.getDeliveryTag(), false);            }
});

Is there some way I can increase the performance? From the tests I have seen
online, I hear numbers of millions of messages a second.

Roshan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090526/3300372d/attachment.htm 

From alexis.richardson at gmail.com  Tue May 26 20:05:58 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 26 May 2009 20:05:58 +0100
Subject: [rabbitmq-discuss] Performance question
In-Reply-To: <C6419196.9003%rpunnoose@proteus-technologies.com>
References: <C6419196.9003%rpunnoose@proteus-technologies.com>
Message-ID: <167204d20905261205n448afe46p8ca7dd8a971019f2@mail.gmail.com>

Roshan

The easiest way to increase performance is to change what you are measuring ;-)

Here is an analysis of the tests you are referring to.  Note that a 16
core machine was used, plus some compression and batching using
OPRA/FAST.  Also the rates are ingress plus egress (fanout ratio of
4).  This is very different from the case you describe which appears
to be a single stream.  10k mps ingress per core isn't bad.  Why don't
you try using a fanout exchange to increase the message output from
the broker?  Another tip is to use a C client.  The Java client may
limit you.

Let us know how you get on.

alexis




On Tue, May 26, 2009 at 5:31 PM, Roshan Punnoose
<rpunnoose at proteus-technologies.com> wrote:
> I have a one producer, one consumer queue running locally for a performance
> test. In terms of just server and client configuration, what is the best way
> to increase performance. For a simple queue publisher and consumer, I?m
> getting about 10k a second for simple byte messages.
>
> Here is some of the code:
>
> Publisher:
> channel.exchangeDeclare("exchangename", "direct");
> ???????????????????channel.queueDeclare("queuename");
> ???????????????????channel
> ???????????????????????????.queueBind("queuename", "exchangename",
> ???????????????????????????????????"routingKey"); ???????????????????byte[]
> messageBodyBytes = new byte[0]; ???????????????????int count = 0;
> ???????????????????long start = System.currentTimeMillis();
> ???????????????????String name = Thread.currentThread().getName();
> ???????????????????for (int i = 0; i < 100000; i++) {
> ???????????????????????channel.basicPublish("exchangename", "routingKey",
> ???????????????????????????????null, messageBodyBytes);
> ???????????????????????count++; ???????????????????????if
> ((System.currentTimeMillis() - start) > 1000) {
> ???????????????????????????System.out.println(name + "-" + count);
> ???????????????????????????count = 0; ???????????????????????????start =
> System.currentTimeMillis(); ???????????????????????} ???????????????????}
>
>
> Consumer:
> channel.basicConsume("queuename", false, new DefaultConsumer(channel) {
> ???????????int count = 0; ???????????long start =
> System.currentTimeMillis(); ???????????@Override ???????????public void
> handleDelivery(String consumerTag, Envelope envelope,
> ???????????????????BasicProperties properties, byte[] body) throws
> IOException { ???????????????count++; ???????????????if
> ((System.currentTimeMillis() - start) > 1000) {
> ???????????????????System.out.println(count); ???????????????????count = 0;
> ???????????????????start = System.currentTimeMillis(); ???????????????}
> ???????????????this.getChannel().basicAck(envelope.getDeliveryTag(), false);
> ???????????} ???????});
>
> Is there some way I can increase the performance? From the tests I have seen
> online, I hear numbers of millions of messages a second.
>
> Roshan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From lord at crocodile.org  Tue May 26 22:52:55 2009
From: lord at crocodile.org (Vadim Zaliva)
Date: Tue, 26 May 2009 14:52:55 -0700 (PDT)
Subject: [rabbitmq-discuss] logging
Message-ID: <ae59f5f9-920e-446f-a826-7f3ebe540fb1@r31g2000prh.googlegroups.com>

if there is a way to enable debug logging in rabbitmq so I can trace
how messages are delivered (when and to what client connection)?
Thanks!

Vadim




From rpunnoose at proteus-technologies.com  Wed May 27 01:45:29 2009
From: rpunnoose at proteus-technologies.com (Roshan Punnoose)
Date: Tue, 26 May 2009 20:45:29 -0400
Subject: [rabbitmq-discuss] Performance question
In-Reply-To: <167204d20905261205n448afe46p8ca7dd8a971019f2@mail.gmail.com>
Message-ID: <C6420569.900B%rpunnoose@proteus-technologies.com>

Thank you. That makes sense. Are there examples of using a fanout exchange
with the Java api? I will also definitely start looking into using the C
api. 


On 5/26/09 3:05 PM, "Alexis Richardson" <alexis.richardson at gmail.com> wrote:

> Roshan

The easiest way to increase performance is to change what you are
> measuring ;-)

Here is an analysis of the tests you are referring to.  Note
> that a 16
core machine was used, plus some compression and batching
> using
OPRA/FAST.  Also the rates are ingress plus egress (fanout ratio of
4).
> This is very different from the case you describe which appears
to be a single
> stream.  10k mps ingress per core isn't bad.  Why don't
you try using a fanout
> exchange to increase the message output from
the broker?  Another tip is to
> use a C client.  The Java client may
limit you.

Let us know how you get
> on.

alexis




On Tue, May 26, 2009 at 5:31 PM, Roshan
> Punnoose
<rpunnoose at proteus-technologies.com> wrote:
> I have a one producer,
> one consumer queue running locally for a performance
> test. In terms of just
> server and client configuration, what is the best way
> to increase
> performance. For a simple queue publisher and consumer, I?m
> getting about
> 10k a second for simple byte messages.
>
> Here is some of the code:
>
>
> Publisher:
> channel.exchangeDeclare("exchangename", "direct");
>
> ???????????????????channel.queueDeclare("queuename");
>
> ???????????????????channel
>
> ???????????????????????????.queueBind("queuename", "exchangename",
>
> ???????????????????????????????????"routingKey"); ???????????????????byte[]
>
> messageBodyBytes = new byte[0]; ???????????????????int count = 0;
>
> ???????????????????long start = System.currentTimeMillis();
>
> ???????????????????String name = Thread.currentThread().getName();
>
> ???????????????????for (int i = 0; i < 100000; i++) {
>
> ???????????????????????channel.basicPublish("exchangename", "routingKey",>
> ???????????????????????????????null, messageBodyBytes);
>
> ???????????????????????count++; ???????????????????????if
>
> ((System.currentTimeMillis() - start) > 1000) {
>
> ???????????????????????????System.out.println(name + "-" + count);
>
> ???????????????????????????count = 0; ???????????????????????????start =
>
> System.currentTimeMillis(); ???????????????????????}
> ???????????????????}
>
>
> Consumer:
> channel.basicConsume("queuename",
> false, new DefaultConsumer(channel) {
> ???????????int count = 0;
> ???????????long start =
> System.currentTimeMillis(); ???????????@Override
> ???????????public void
> handleDelivery(String consumerTag, Envelope
> envelope,
> ???????????????????BasicProperties properties, byte[] body)
> throws
> IOException { ???????????????count++; ???????????????if
>
> ((System.currentTimeMillis() - start) > 1000) {
>
> ???????????????????System.out.println(count); ???????????????????count = 0;
>
> ???????????????????start = System.currentTimeMillis(); ???????????????}
>
> ???????????????this.getChannel().basicAck(envelope.getDeliveryTag(), false);
>
> ???????????} ???????});
>
> Is there some way I can increase the performance?
> From the tests I have seen
> online, I hear numbers of millions of messages a
> second.
>
> Roshan
> _______________________________________________
>
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
>
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>





From daviddcawley at gmail.com  Wed May 27 11:09:39 2009
From: daviddcawley at gmail.com (David Cawley)
Date: Wed, 27 May 2009 18:09:39 +0800
Subject: [rabbitmq-discuss] RabbitMQ + Stomp under FC9
In-Reply-To: <49F9DF14.5040008@lshift.net>
References: <c454d1480904192035s3578bd4evf60da350b098eba3@mail.gmail.com>
	<49F9DF14.5040008@lshift.net>
Message-ID: <c454d1480905270309kdc18641m7ca2dcb0b658246a@mail.gmail.com>

Hi Tony,

Thanks for the reply but I didn't have a chance to look at this again until
now.

My problem was quite simple in the end. I didn't realise that the test
scripts provided
would only allow me to send a message when a consumer was listening to the
queue.
It appears that others have also encountered this issue:

http://vampiresoftware.blogspot.com/2009/05/stomping-on-rabbit-pt2.html

Thanks,

David


On Fri, May 1, 2009 at 1:25 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:

> Hi David,
>
> What you describe is really odd -- and unfortunately, it actually works
> OK for me:
>
> hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> hg clone http://hg.rabbitmq.com/rabbitmq-server
> hg clone http://hg.rabbitmq.com/rabbitmq-stomp
> (cd rabbitmq-codegen; hg up rabbitmq_v1_5_3)
> (cd rabbitmq-server; hg up rabbitmq_v1_5_3)
> (cd rabbitmq-stomp; hg up rabbitmq_v1_5_3)
> make -C rabbitmq-server
> make -C rabbitmq-stomp run
>
> Then in another terminal,
> rabbitmq-stomp/examples/perl/rabbitmq_stomp_recv.pl.
>
> Then in another terminal, every call I make to
> rabbitmq-stomp/examples/perl/rabbitmq_stomp_send.pl makes "testmessage"
> appear on the console running the _recv.pl script.
>
> It's especially odd that you can connect and everything seems to run
> fine. Is there anything interesting in the rabbit.log file?
>
> (Also worth checking: did you run the receiver before running the
> sender? I think (?) the receiver needs to be running at the time the
> sender runs)
>
> Regards,
>  Tony
>
>
> David Cawley wrote:
> > I've been testing out several Message Queues under Redhat FC9
> > using Stomp e.g. POE based MQ and ActiveMQ. I also wanted to
> > try RabbitMQ but I'm unable to receive messages from the queue?
> > I see that Tony from lshift has been busy answering questions and
> > fixing issues so I'm hoping it's in a usable state.
> >
> > I installed the rabbitmq-server-1.5.3-1 via yum (I had to manually create
> > a rabbitmq user/group and home directory for a cookie). I then compiled
> > the stomp adaptor as follows using the rabbitmq_v1_5_3 tag :
> >
> > cd /usr/lib/erlang/lib/
> > hg clone http://hg.rabbitmq.com/rabbitmq-stomp
> > cd rabbitmq-stomp
> > hg update rabbitmq_v1_5_3
> > make RABBIT_SERVER_SOURCE_ROOT=../rabbitmq_server-1.5.3
> >
> > I created a config file so that the stomp adaptor is used:
> > /etc/rabbitmq/rabbitmq.conf
> >
> >     SERVER_START_ARGS='
> >       -pa /usr/lib/erlang/lib/rabbitmq-stomp/ebin
> >       -rabbit
> >          stomp_listeners [{"0.0.0.0",61613}]
> >          extra_startup_steps
> > [{"STOMP-listeners",rabbit_stomp,kickstart,[]}]'
> >
> > I restarted the rabbitmq-server process and I can connect to port 61613.
> > The stomp
> > connect works. However, when I run the example perl test scripts I don't
> > receive any
> > of the messages. The rabbit.log file indicates the accepting of the TCP
> > connection
> > and starting and sending of Stomp connection and no errors. I also tried
> > using the ruby
> > examples but still no luck. I even tried doing the process above with
> > the latest 1.5.4
> > mq-server rpm with the v1_5_3 tagged rabbitmq-stomp. How can I get it
> > working?
> >
> > ./examples/perl/rabbitmq_stomp_send.pl
> > ./examples/perl/rabbitmq_stomp_recv.pl
> >
> > Thanks,
> >
> > David
> >
> >
> > ------------------------------------------------------------------------
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> --
>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090527/5c0e11f7/attachment.htm 

From alexis.richardson at gmail.com  Wed May 27 11:28:40 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 27 May 2009 11:28:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ + Stomp under FC9
In-Reply-To: <c454d1480905270309kdc18641m7ca2dcb0b658246a@mail.gmail.com>
References: <c454d1480904192035s3578bd4evf60da350b098eba3@mail.gmail.com>
	<49F9DF14.5040008@lshift.net>
	<c454d1480905270309kdc18641m7ca2dcb0b658246a@mail.gmail.com>
Message-ID: <167204d20905270328p6ff2c3a6qfc035ca8018e3043@mail.gmail.com>

David

I am cc'ing the author of that blog who has now solved the problem
described, which is a simple config issue.

alexis


On Wed, May 27, 2009 at 11:09 AM, David Cawley <daviddcawley at gmail.com> wrote:
> Hi Tony,
>
> Thanks for the reply but I didn't have a chance to look at this again until
> now.
>
> My problem was quite simple in the end. I didn't realise that the test
> scripts provided
> would only allow me to send a message when a consumer was listening to the
> queue.
> It appears that others have also encountered this issue:
>
> http://vampiresoftware.blogspot.com/2009/05/stomping-on-rabbit-pt2.html
>
> Thanks,
>
> David
>
>
> On Fri, May 1, 2009 at 1:25 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
>>
>> Hi David,
>>
>> What you describe is really odd -- and unfortunately, it actually works
>> OK for me:
>>
>> hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>> hg clone http://hg.rabbitmq.com/rabbitmq-server
>> hg clone http://hg.rabbitmq.com/rabbitmq-stomp
>> (cd rabbitmq-codegen; hg up rabbitmq_v1_5_3)
>> (cd rabbitmq-server; hg up rabbitmq_v1_5_3)
>> (cd rabbitmq-stomp; hg up rabbitmq_v1_5_3)
>> make -C rabbitmq-server
>> make -C rabbitmq-stomp run
>>
>> Then in another terminal,
>> rabbitmq-stomp/examples/perl/rabbitmq_stomp_recv.pl.
>>
>> Then in another terminal, every call I make to
>> rabbitmq-stomp/examples/perl/rabbitmq_stomp_send.pl makes "testmessage"
>> appear on the console running the _recv.pl script.
>>
>> It's especially odd that you can connect and everything seems to run
>> fine. Is there anything interesting in the rabbit.log file?
>>
>> (Also worth checking: did you run the receiver before running the
>> sender? I think (?) the receiver needs to be running at the time the
>> sender runs)
>>
>> Regards,
>> ?Tony
>>
>>
>> David Cawley wrote:
>> > I've been testing out several Message Queues under Redhat FC9
>> > using Stomp e.g. POE based MQ and ActiveMQ. I also wanted to
>> > try RabbitMQ but I'm unable to receive messages from the queue?
>> > I see that Tony from lshift has been busy answering questions and
>> > fixing issues so I'm hoping it's in a usable state.
>> >
>> > I installed the rabbitmq-server-1.5.3-1 via yum (I had to manually
>> > create
>> > a rabbitmq user/group and home directory for a cookie). I then compiled
>> > the stomp adaptor as follows using the rabbitmq_v1_5_3 tag :
>> >
>> > cd /usr/lib/erlang/lib/
>> > hg clone http://hg.rabbitmq.com/rabbitmq-stomp
>> > cd rabbitmq-stomp
>> > hg update rabbitmq_v1_5_3
>> > make RABBIT_SERVER_SOURCE_ROOT=../rabbitmq_server-1.5.3
>> >
>> > I created a config file so that the stomp adaptor is used:
>> > /etc/rabbitmq/rabbitmq.conf
>> >
>> > ? ? SERVER_START_ARGS='
>> > ? ? ? -pa /usr/lib/erlang/lib/rabbitmq-stomp/ebin
>> > ? ? ? -rabbit
>> > ? ? ? ? ?stomp_listeners [{"0.0.0.0",61613}]
>> > ? ? ? ? ?extra_startup_steps
>> > [{"STOMP-listeners",rabbit_stomp,kickstart,[]}]'
>> >
>> > I restarted the rabbitmq-server process and I can connect to port 61613.
>> > The stomp
>> > connect works. However, when I run the example perl test scripts I don't
>> > receive any
>> > of the messages. The rabbit.log file indicates the accepting of the TCP
>> > connection
>> > and starting and sending of Stomp connection and no errors. I also tried
>> > using the ruby
>> > examples but still no luck. I even tried doing the process above with
>> > the latest 1.5.4
>> > mq-server rpm with the v1_5_3 tagged rabbitmq-stomp. How can I get it
>> > working?
>> >
>> > ./examples/perl/rabbitmq_stomp_send.pl
>> > ./examples/perl/rabbitmq_stomp_recv.pl
>> >
>> > Thanks,
>> >
>> > David
>> >
>> >
>> > ------------------------------------------------------------------------
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> --
>> ?[][][] Tony Garnock-Jones ? ? | Mob: +44 (0)7905 974 211
>> ? [][] LShift Ltd ? ? ? ? ? ? | Tel: +44 (0)20 7729 7060
>> ?[] ?[] http://www.lshift.net/ | Email: tonyg at lshift.net
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From 0x6e6562 at gmail.com  Wed May 27 12:08:01 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 27 May 2009 12:08:01 +0100
Subject: [rabbitmq-discuss] rabbitmq-erlang-client compile issue
In-Reply-To: <578625C3-50BF-47AE-AC69-0BBE0FFD70E3@sebastian-latza.de>
References: <578625C3-50BF-47AE-AC69-0BBE0FFD70E3@sebastian-latza.de>
Message-ID: <269388e30905270408g4e413d96k1aa13a4e78f599ec@mail.gmail.com>

Hi Sebastian,

On Tue, May 26, 2009 at 3:50 PM, Sebastian Latza
<mail at sebastian-latza.de> wrote:
> Hi Ben,
>
> just a short question about the rabbitmq-erlang-client.
> When trying to compile the client amqp_channel.erl it includes
> rabbit_framing.hrl from the rabbitmq_server directory. The problem there is,
> the file is actually called rabbit_framing_spec.hrl . Which is a bit strange
> since it's beeing called that way for over 10 months if i read the repo
> correctly. Have I missed something there or has just nobody noticed this? ;)
>
> Besides that I'm having some additional issues, but I guess these are
> somehow related to my project setup.
>
> $ make
> erlc -I include -o ebin -Wall -v +debug_info src/amqp_channel.erl
> src/amqp_channel.erl:94: record 'basic.consume' undefined
> src/amqp_channel.erl:139: record 'channel.close' undefined
> [...]

rabbit_framing.hrl contains all of the patterns that rabbit needs at
compile time in order to match the various different types of message
types that are passed around within rabbit.

rabbit_framing_spec.hrl contains some specs for success typing, but it
should be orthogonal to including record definitions during plain
erlang compilation (I should think that it is only required for the
dialyze target).

Can you maybe say (on the list :-) which version of the Erlang client
you are using?

HTH,

Ben



From mail at sebastian-latza.de  Wed May 27 13:08:19 2009
From: mail at sebastian-latza.de (Sebastian Latza)
Date: Wed, 27 May 2009 14:08:19 +0200
Subject: [rabbitmq-discuss] rabbitmq-erlang-client compile issue
In-Reply-To: <269388e30905270408g4e413d96k1aa13a4e78f599ec@mail.gmail.com>
References: <578625C3-50BF-47AE-AC69-0BBE0FFD70E3@sebastian-latza.de>
	<269388e30905270408g4e413d96k1aa13a4e78f599ec@mail.gmail.com>
Message-ID: <6E9E61CD-984B-4AE0-870A-9FF23CD614BE@sebastian-latza.de>


Hi Ben,

> Can you maybe say (on the list :-) which version of the Erlang client
> you are using?

I wasn't sure if I should post issues concerning the "experimental"  
client on the regular rabbit-list, but I guess this has been cleared  
up now ;-)

The (quite embarrassing) solution to the problem on my side was to  
actually compile rabbitmq so it can generate the appropriate file and  
not just place the sources there.
I hate those Mondays...well..Tuesdays ;-)

Best Regards and thanks for the help anyway.
--
Sebastian Latza
mail at sebastian-latza.de






From aymerick at fotonauts.com  Wed May 27 13:36:27 2009
From: aymerick at fotonauts.com (=?ISO-8859-1?Q?Aymerick_J=E9hanne?=)
Date: Wed, 27 May 2009 14:36:27 +0200
Subject: [rabbitmq-discuss] RabbitMQ with Chef
Message-ID: <9A519E3F-4CBE-46FB-9BB5-DCE661E7F8AC@fotonauts.com>

Hi,

I'm trying to deploy rabbitmq using Chef (http://wiki.opscode.com/display/chef/Home 
).

I have a strange issue on one of my servers... I have the error  
message "Failed to create thread: Resource temporarily unavailable  
(11)" while executing "/etc/init.d/rabbitmq-server status".

Any idea of what can cause this error message ?

Thanks,
Aymerick


Full log:

[Wed, 27 May 2009 12:27:00 +0000] DEBUG: Executing /etc/init.d/ 
rabbitmq-server status
[Wed, 27 May 2009 12:27:00 +0000] DEBUG: ---- Begin output of /etc/ 
init.d/rabbitmq-server status ----
[Wed, 27 May 2009 12:27:00 +0000] DEBUG: STDOUT: Failed to create  
thread: Resource temporarily unavailable (11)
Aborted
[Wed, 27 May 2009 12:27:00 +0000] DEBUG: STDERR:
[Wed, 27 May 2009 12:27:00 +0000] DEBUG: ---- End output of /etc/ 
init.d/rabbitmq-server status ----




From msmith1638 at gmail.com  Wed May 27 22:40:39 2009
From: msmith1638 at gmail.com (Mark Smith)
Date: Wed, 27 May 2009 16:40:39 -0500
Subject: [rabbitmq-discuss] dropped messages
In-Reply-To: <4A1B089B.7020204@lshift.net>
References: <23659084.post@talk.nabble.com> <23660939.post@talk.nabble.com>
	<4A167571.4070603@lshift.net> <23671830.post@talk.nabble.com>
	<4A16C0D0.2090908@lshift.net> <23673004.post@talk.nabble.com>
	<4A1B089B.7020204@lshift.net>
Message-ID: <e12fe9f10905271440h22612a0fs13cccd0c913fa449@mail.gmail.com>

Matthias,Attached is a zipped Visual Studio 2008 solution. This exhibits the
problems I am seeing. The code contains a producer.exe and consumer.exe,
both projects share a sharedTypes.dll. This all builds from one solution
once you update the reference to a RabbitMQ .NET Client. The code assumes
that the broker is installed locally. Comments are in program.cs of the
producer.exe project.

Thanks for taking a look.

Mark

On Mon, May 25, 2009 at 4:07 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Mark,
>
> smittycb10 wrote:
>
>> however I still have the same problem 100,000's messages in and only
>> 1,000's of messages out. Am I publishing and subscribing in the most
>> efficent manner?
>>
>
> Can you send through the *complete* code? It's impossible to tell
> otherwise why exactly you are getting the results you are seeing.
>
> How are you measuring the rates? If on the sending side you are just
> timing a loop of publishes then all you are measuring is the time it
> takes to hand over the messages to the kernel. They can get buffered
> there, in the network layer, in multiple layers at the broker, etc, etc.
>
> Also, since AMQP's basic.publish is asynchronous, if the publishing
> connection is not terminated cleanly then some messages will inevitably get
> lost.
>
> It's also worth remembering that RabbitMQ is a message *queuing* system, so
> one shouldn't be surprised if occasionally it queues some messages ;) What's
> more, because RabbitMQ's queuing is quite efficient, when you push the
> system hard, i.e. by feeding it messages as fast as you can, it will handle
> the incoming messages at a faster rate than it sends them to consumers.
>
> For meaningful benchmark results it is therefore important to throttle
> the producer, e.g. send messages at a fixed rate, monitor the rate at
> which they are received by consumers, and slowly increase the producing
> rate until the consumption rate starts falling behind.
>
>  Do I need to anything to broker?
>>>
>>
> Unlikely.
>
>  Is a message rate of 100,000 per second unreasonable?
>>>
>>
> For a single producer->broker->consumer chain that would be quite a high
> rate - 10s of thousands of msgs/s is more realistic on stock hardware.
>
> If you have several independent message streams then higher total
> throughputs can be achieved when running on lots of cores.
>
>  is there a max number of messages any one channel can have queued in
>> it at one time?
>>
>
> No.
>
>  I am currently trying to squeeze all the messages into one channel,
>> should I be splitting work across channels and threads on the
>> receiving side??
>>
>
> Having multiple channels and, even better, multiple connections, provides
> more opportunities for parellelism at the server. Whether or not that
> actually makes a positive difference depends on lots of factors.
>
>
> Regards,
>
> Matthias.
>



-- 
Mark Smith

please send all correspondences to this
new email address
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090527/fb755cf7/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitMQ_Producer.zip
Type: application/zip
Size: 21116 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090527/fb755cf7/attachment.zip 

From matthias at lshift.net  Wed May 27 23:14:06 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 27 May 2009 23:14:06 +0100
Subject: [rabbitmq-discuss] dropped messages
In-Reply-To: <e12fe9f10905271440h22612a0fs13cccd0c913fa449@mail.gmail.com>
References: <23659084.post@talk.nabble.com>
	<23660939.post@talk.nabble.com>	<4A167571.4070603@lshift.net>
	<23671830.post@talk.nabble.com>	<4A16C0D0.2090908@lshift.net>
	<23673004.post@talk.nabble.com>	<4A1B089B.7020204@lshift.net>
	<e12fe9f10905271440h22612a0fs13cccd0c913fa449@mail.gmail.com>
Message-ID: <4A1DBB2E.6030606@lshift.net>

Mark,

Mark Smith wrote:
> Attached is a zipped Visual Studio 2008 solution. This exhibits the 
> problems I am seeing. The code contains a producer.exe and consumer.exe, 
> both projects share a sharedTypes.dll.

There is quite a lot of code there besides the invocations of the 
RabbitMQ client API. Any chance you could simplify this?

Also, can you hook up the producer and consumer to an instance of our 
tracer (http://www.rabbitmq.com/examples.html#tracer), and send me a few 
seconds worth of output from the beginning? That will tell us whether 
what the client is asking the server to do is matching your intentions, 
and whether the server is behaving as expected.


Matthias.



From rgh at roughage.com.au  Thu May 28 00:14:34 2009
From: rgh at roughage.com.au (Richard Heycock)
Date: Thu, 28 May 2009 09:14:34 +1000
Subject: [rabbitmq-discuss] RabbitMQ with Chef
In-Reply-To: <9A519E3F-4CBE-46FB-9BB5-DCE661E7F8AC@fotonauts.com>
References: <9A519E3F-4CBE-46FB-9BB5-DCE661E7F8AC@fotonauts.com>
Message-ID: <1243465984-sup-4892@wrasse>

Excerpts from Aymerick J?hanne's message of Wed May 27 22:36:27 +1000 2009:
> Hi,
> 
> I'm trying to deploy rabbitmq using Chef
> (http://wiki.opscode.com/display/chef/Home 
> ).
> 
> I have a strange issue on one of my servers... I have the error  
> message "Failed to create thread: Resource temporarily unavailable  
> (11)" while executing "/etc/init.d/rabbitmq-server status".
> 
> Any idea of what can cause this error message ?
> 
> Thanks,
> Aymerick
> 
> 
> Full log:
> 
> [Wed, 27 May 2009 12:27:00 +0000] DEBUG: Executing /etc/init.d/ 
> rabbitmq-server status
> [Wed, 27 May 2009 12:27:00 +0000] DEBUG: ---- Begin output of /etc/ 
> init.d/rabbitmq-server status ----
> [Wed, 27 May 2009 12:27:00 +0000] DEBUG: STDOUT: Failed to create  
> thread: Resource temporarily unavailable (11)
> Aborted
> [Wed, 27 May 2009 12:27:00 +0000] DEBUG: STDERR:
> [Wed, 27 May 2009 12:27:00 +0000] DEBUG: ---- End output of /etc/ 
> init.d/rabbitmq-server status ----

Are you sure that it's a rabbitmq issue? It looks more like it might be
a chef issue. Just a random stab in the dark here; you're not running it
on a VM are you, like openvz, etc?

rgh



From aymerick at fotonauts.com  Thu May 28 01:13:12 2009
From: aymerick at fotonauts.com (=?ISO-8859-1?Q?Aymerick_J=E9hanne?=)
Date: Thu, 28 May 2009 02:13:12 +0200
Subject: [rabbitmq-discuss] RabbitMQ with Chef
In-Reply-To: <1243465984-sup-4892@wrasse>
References: <9A519E3F-4CBE-46FB-9BB5-DCE661E7F8AC@fotonauts.com>
	<1243465984-sup-4892@wrasse>
Message-ID: <10A1E385-75CC-4533-AA80-81AF372D5CF1@fotonauts.com>

On May 28, 2009, at 1:14 AM, Richard Heycock wrote:

> Excerpts from Aymerick J?hanne's message of Wed May 27 22:36:27  
> +1000 2009:
>> Hi,
>>
>> I'm trying to deploy rabbitmq using Chef
>> (http://wiki.opscode.com/display/chef/Home
>> ).
>>
>> I have a strange issue on one of my servers... I have the error
>> message "Failed to create thread: Resource temporarily unavailable
>> (11)" while executing "/etc/init.d/rabbitmq-server status".
>>

> Are you sure that it's a rabbitmq issue? It looks more like it might  
> be
> a chef issue. Just a random stab in the dark here; you're not  
> running it
> on a VM are you, like openvz, etc?


I'm a running on an EC2 instance.

I don't think this is a Chef issue, because it only outputs the STDOUT  
of "/etc/init.d/rabbitmq-server status".

It looks more like an issue with erlang.

Aymerick




From matthias at lshift.net  Thu May 28 09:06:24 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 28 May 2009 09:06:24 +0100
Subject: [rabbitmq-discuss] logging
In-Reply-To: <ae59f5f9-920e-446f-a826-7f3ebe540fb1@r31g2000prh.googlegroups.com>
References: <ae59f5f9-920e-446f-a826-7f3ebe540fb1@r31g2000prh.googlegroups.com>
Message-ID: <4A1E4600.4070900@lshift.net>

Vadim,

Vadim Zaliva wrote:
> if there is a way to enable debug logging in rabbitmq so I can trace
> how messages are delivered (when and to what client connection)?

I can think of several ways of doing this:

1) run your connections through our tracer 
(http://www.rabbitmq.com/examples.html#tracer)

2) run a network capture/analysis tool like wireshark

3) use Erlang's built-in tracing facilities - you'll need some knowledge 
of Erlang and the RabbitMQ internals for that

We also have an experimental feature in development called 'firehose' 
which allows you to turn on logging of messages received by / sent from 
AMQP channels. Check it out on branch 'bug20589' in our hg repo, if you 
are feeling adventurous. One thing that doesn't do is identify the 
client connection. I will investigate whether that would be easy and 
desirable to add.


Regards,

Matthias.



From dmitriy.samovskiy at cohesiveft.com  Thu May 28 15:15:31 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Thu, 28 May 2009 09:15:31 -0500
Subject: [rabbitmq-discuss] RabbitMQ with Chef
In-Reply-To: <10A1E385-75CC-4533-AA80-81AF372D5CF1@fotonauts.com>
References: <9A519E3F-4CBE-46FB-9BB5-DCE661E7F8AC@fotonauts.com>	<1243465984-sup-4892@wrasse>
	<10A1E385-75CC-4533-AA80-81AF372D5CF1@fotonauts.com>
Message-ID: <4A1E9C83.5010001@cohesiveft.com>

Hi Aymerick,

Aymerick J?hanne wrote:
>>> I'm trying to deploy rabbitmq using Chef
>>> (http://wiki.opscode.com/display/chef/Home
>>> ).
>>>
>>> I have a strange issue on one of my servers... I have the error
>>> message "Failed to create thread: Resource temporarily unavailable
>>> (11)" while executing "/etc/init.d/rabbitmq-server status".
>>>
> 
> I'm a running on an EC2 instance.
> 
> I don't think this is a Chef issue, because it only outputs the STDOUT  
> of "/etc/init.d/rabbitmq-server status".
> 
> It looks more like an issue with erlang.

I would first try to eliminate chef from the equation.

Try starting, stopping and getting a status of rabbit from command line. If that works, 
then you'll know it's somehow related to chef.

I personally also think it's an issue with erlang. Did you compile it yourself? If yes, 
did you specify --enable-threads? Not sure how important that might be and what it would 
look like if that option was not there.

You could also try "erl +A30" from command line - does it start normally into erlang 
prompt or does it fail? It starts on my box, so I guess a failure would indicate something 
wrong with erlang.

These are just guesses though.

- Dmitriy



From ryan at acceleration.net  Thu May 28 16:50:50 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Thu, 28 May 2009 11:50:50 -0400
Subject: [rabbitmq-discuss] rabbitmqctl status problem on windows server
 2008 (the vista-ish variant)
Message-ID: <4A1EB2DA.1030601@acceleration.net>

Folks,

I'm having problems running "rabbitmqctl status".  It always returns
{badrpc,nodedown}.  Rabbit is running as a windows service, and I can
connect to it from clients with no problems, so I'm confident that
rabbit is running properly, and the status report is inaccurate.  From
everything I've read online, this is a erlang cookie problem, but for
the life of me I can't get it work.

I've copied .erlang.cookie files such that the following are identical:

    * C:\Windows\.erlang.cookie - this is what the rabbit service should use
    * C:\Users\ryan\AppData\Roaming\.erlang.cookie - this is what
      running erl.exe from a command window should use
    * C:\Users\ryan\.erlang.cookie - this should not be used anywhere,
      but was put here for superstition's sake

I've also tried changing the rabbitmqctl.bat file to try different
-setcookie arguments:

    * -setcookie "C:\Windows\.erlang.cookie" - which isn't right now
      that I look at the docs
    * -setcookie "XXX" - with XXX being the contents of
      C:\Windows\.erlang.cookie
    * -setcookie XXX - same as above with no quotes

I also trying specifying the node with "-n rabbit at localhost" in case the
hostname was confusing things, but still no dice.  I was running these
from an administrator command prompt, so I don't think permissions are
the issue.

I can check my cookie using erlang:get_cookie(), and it returns 'XXX',
with XXX matching the contents of C:\Windows\.erlang.cookie.

I tried following some debugging steps listed at
http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/, which is
linux-specific.  Running "net_adm:names()." does not list the rabbit
node.  One interesting bit is that if I start two eshells,
net_adm:names(). lists both of them.

My best guess is that rabbit is using a cookie differently than the one
in "C:\Windows\.erlang.cookie", but that doesn't make much sense to me.

Any help would be appreciated.

Thanks,

-- 
Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090528/a810643e/attachment.htm 

From dmitriy.samovskiy at cohesiveft.com  Thu May 28 17:16:07 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Thu, 28 May 2009 11:16:07 -0500
Subject: [rabbitmq-discuss] rabbitmqctl status problem on windows server
 2008 (the vista-ish variant)
In-Reply-To: <4A1EB2DA.1030601@acceleration.net>
References: <4A1EB2DA.1030601@acceleration.net>
Message-ID: <4A1EB8C7.6000607@cohesiveft.com>

Hi Ryan,

Ryan Davis wrote:
> I tried following some debugging steps listed at 
> http://somic.org/2009/02/19/on-rabbitmqctl-and-badrpcnodedown/, which is 
> linux-specific.  Running "net_adm:names()." does not list the rabbit 
> node.  One interesting bit is that if I start two eshells, 
> net_adm:names(). lists both of them.

You are absolutely right, that post focuses on *nix systems, and I have no idea how 
applicable it might be to Windows environments. Any chance you can switch to Linux? :)

I can't explain how these 2 can be true at the same time though:
1) you have rabbit running as a service and you can connect to it
2) rabbit node does not show up in net_adm:names() which would mean rabbit is not running

Is there anything in the rabbit log (such as this "connection attempt from disallowed 
node" [1])?

You may also check out mailing list archives on Windows and cookies [2] or Windows and 
services [3]

[1] http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-September/001681.html
[2] http://www.google.com/search?q=site%3Alists.rabbitmq.com+windows+cookie
[3] http://www.google.com/search?q=site%3Alists.rabbitmq.com+windows+service


- Dmitriy



From ryan at acceleration.net  Thu May 28 18:25:25 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Thu, 28 May 2009 13:25:25 -0400
Subject: [rabbitmq-discuss] rabbitmqctl status problem on windows server
 2008 (the vista-ish variant) KINDA SOLVED
In-Reply-To: <4A1EB8C7.6000607@cohesiveft.com>
References: <4A1EB2DA.1030601@acceleration.net>
	<4A1EB8C7.6000607@cohesiveft.com>
Message-ID: <4A1EC905.9050405@acceleration.net>

Dmitriy Samovskiy wrote:
> You are absolutely right, that post focuses on *nix systems, and I
> have no idea how applicable it might be to Windows environments. Any
> chance you can switch to Linux? :)
I'm using Rabbit to replace some homegrown .NET/SQL Server queue
solutions, and putting it on the same box running the .NET code was
handy.  I can switch to linux, but brining up another system seemed like
overkill for my message rates.
> Is there anything in the rabbit log (such as this "connection attempt
> from disallowed node" [1])?
No, I didn't see anything like that in the logs covering the time period
this morning when I was futzing with it.

I managed to get the status working by restarting the RabbitMQ service. 
My best guess is that the erlang cookie in the running rabbit server for
some reason did not match the one in C:\Windows\.erlang.cookie.  Maybe I
accidentally overwrote that file?  Anyway, it works now, thanks for the
quick response.  I'll keep an eye on it and see if I can recreate the
problem.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506





