<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq behind nginx
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq%20behind%20nginx&In-Reply-To=%3C5361F8CB.9080307%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035700.html">
   <LINK REL="Next"  HREF="035691.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq behind nginx</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq%20behind%20nginx&In-Reply-To=%3C5361F8CB.9080307%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmq behind nginx">simon at rabbitmq.com
       </A><BR>
    <I>Thu May  1 08:33:31 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035700.html">[rabbitmq-discuss] rabbitmq behind nginx
</A></li>
        <LI>Next message: <A HREF="035691.html">[rabbitmq-discuss] How to resolve this issue?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35702">[ date ]</a>
              <a href="thread.html#35702">[ thread ]</a>
              <a href="subject.html#35702">[ subject ]</a>
              <a href="author.html#35702">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Port 5672 is AMQP. Port 55672 is the old HTTP management plugin port. 
(It's moved to port 15672.)

nginx can't proxy AMQP.

So are you trying to proxy AMQP or HTTP? If you are just trying to 
access RabbitMQ from non-localhost, why do you need nginx?

For default log file locations it depends how you installed RabbitMQ, 
see <A HREF="http://www.rabbitmq.com/relocate.html">http://www.rabbitmq.com/relocate.html</A> for the various possibilities.

Cheers, Simon

On 01/05/2014 00:13, Richard Tier wrote:
&gt;<i> I am trying to setup rabbitmq it can be accessed externally (from
</I>&gt;<i> non-localhost) through nginx.
</I>&gt;<i>
</I>&gt;<i> nginx-rabbitmq.conf:
</I>&gt;<i>
</I>&gt;<i> server {
</I>&gt;<i>      listen       5672;
</I>&gt;<i>      server_name  x.x.x.x;
</I>&gt;<i>      location / {
</I>&gt;<i>          proxy_pass <A HREF="http://localhost:55672/;">http://localhost:55672/;</A>
</I>&gt;<i>      }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> rabbitmq.conf:
</I>&gt;<i>
</I>&gt;<i> [
</I>&gt;<i>   {rabbit,
</I>&gt;<i>    [
</I>&gt;<i>     {tcp_listeners, [{&quot;127.0.0.1&quot;, 55672}]}
</I>&gt;<i>    ]
</I>&gt;<i>   }
</I>&gt;<i> ]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> By default guest user can only interact from localhost, so we need to
</I>&gt;<i> create another user with required permissions, like so:
</I>&gt;<i>
</I>&gt;<i> sudo rabbitmqctl add_user my_user my_password
</I>&gt;<i> sudo rabbitmqctl set_permissions my_user &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;
</I>&gt;<i>
</I>&gt;<i> However, when I attempt a connection to rabbitmq through pika I get
</I>&gt;<i> ConnectionClosed exception
</I>&gt;<i>
</I>&gt;<i> import pika
</I>&gt;<i> credentials = pika.credentials.PlainCredentials('my_username',
</I>&gt;<i> 'my_password')
</I>&gt;<i> pika.BlockingConnection(
</I>&gt;<i>      pika.ConnectionParameters(host=ip_address, port=55672,
</I>&gt;<i> credentials=credentials)
</I>&gt;<i> )
</I>&gt;<i>
</I>&gt;<i> However, if I use the same credentials via localhost and change to port
</I>&gt;<i> 5672 then it connects ok:
</I>&gt;<i>
</I>&gt;<i> I have opened port 5672 on the GCE web console, and communication
</I>&gt;<i> through nginx is happening: nginx access.log file shows
</I>&gt;<i>
</I>&gt;<i> [30/Apr/2014:22:59:41 +0000] &quot;AMQP\x00\x00\x09\x01&quot; 400 172 &quot;-&quot; &quot;-&quot; &quot;-&quot;
</I>&gt;<i>
</I>&gt;<i> Which shows a 400 status code response (bad request).
</I>&gt;<i>
</I>&gt;<i> So by the looks the request fails when going through nginx, but works
</I>&gt;<i> when we request rabbitmq directly.
</I>&gt;<i>
</I>&gt;<i> Has anyone else had similar problems/got rabbitmq working for external
</I>&gt;<i> users through nginx? is there a rabbitmq log file where I can see each
</I>&gt;<i> request and help further troubleshooting?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035700.html">[rabbitmq-discuss] rabbitmq behind nginx
</A></li>
	<LI>Next message: <A HREF="035691.html">[rabbitmq-discuss] How to resolve this issue?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35702">[ date ]</a>
              <a href="thread.html#35702">[ thread ]</a>
              <a href="subject.html#35702">[ subject ]</a>
              <a href="author.html#35702">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
