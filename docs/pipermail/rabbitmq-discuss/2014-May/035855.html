<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Federation link and partition handling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20link%20and%20partition%20handling&In-Reply-To=%3C536B58DC.6070902%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035854.html">
   <LINK REL="Next"  HREF="035857.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Federation link and partition handling</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20link%20and%20partition%20handling&In-Reply-To=%3C536B58DC.6070902%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Federation link and partition handling">simon at rabbitmq.com
       </A><BR>
    <I>Thu May  8 11:13:48 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035854.html">[rabbitmq-discuss] Messages that can never touch disk
</A></li>
        <LI>Next message: <A HREF="035857.html">[rabbitmq-discuss] IPv6 issue?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35855">[ date ]</a>
              <a href="thread.html#35855">[ thread ]</a>
              <a href="subject.html#35855">[ subject ]</a>
              <a href="author.html#35855">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/04/14 23:35, lepolac wrote:
&gt;<i> When there's a partition on a cluster that's configured in ignore or
</I>&gt;<i> autoheal, where both sides will stay active, a second federation link seems
</I>&gt;<i> to be created.
</I>
Yes, that's correct.

It's hard to see how it could be otherwise - while the partition is 
ongoing, both halves of the cluster think that the other half is down, 
and that they need to keep things going. So the half that didn't have 
the federation link when the partition happened will start up a new one.

&gt;<i> Are both links active ? Will the downstream broker get messages from both
</I>&gt;<i> partitions ? How will they be merged back ?
</I>
This is really more of a question about what happens to state in 
partitions; the federation link can just be thought of as a stateful 
thing that is involved in the partition.

So:

&gt;<i> Are both links active ?
</I>
While the partition is ongoing. Afterwards it depends on the partition 
handling mode - see below.

&gt;<i> Will the downstream broker get messages from both partitions ?
</I>
Well, federation links retrieve messages from the upstream; so we are 
talking about the downstream partitioning. Both halves of the downstream 
will retrieve messages from the same upstream (if the upstream is also a 
cluster they may decide to connect to different nodes of course). Since 
both halves of the downstream partition will have the same cluster-id, 
they will end up sharing the message stream from the upstream in a 
round-robin-ish way.

&gt;<i> How will they be merged back ?
</I>
After the partition heals (at the network level) it depends whether the 
partition handling mode is &quot;ignore&quot; or &quot;autoheal. In &quot;ignore&quot; mode both 
links will continue to be active and publishing into their respective 
halves of the cluster. In &quot;autoheal&quot; mode enough nodes will be restarted 
that the partition will heal - and the excess links will get shut down.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035854.html">[rabbitmq-discuss] Messages that can never touch disk
</A></li>
	<LI>Next message: <A HREF="035857.html">[rabbitmq-discuss] IPv6 issue?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35855">[ date ]</a>
              <a href="thread.html#35855">[ thread ]</a>
              <a href="subject.html#35855">[ subject ]</a>
              <a href="author.html#35855">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
