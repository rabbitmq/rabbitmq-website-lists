<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] php pecl and max channel reached with php-fpm
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20php%20pecl%20and%20max%20channel%20reached%20with%20php-fpm&In-Reply-To=%3CCAMcAHLVsSFqqC4nY_F7XoOSb4OfeC0_gfdDPQqWhjVKYDJXWpA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036265.html">
   <LINK REL="Next"  HREF="036268.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] php pecl and max channel reached with php-fpm</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20php%20pecl%20and%20max%20channel%20reached%20with%20php-fpm&In-Reply-To=%3CCAMcAHLVsSFqqC4nY_F7XoOSb4OfeC0_gfdDPQqWhjVKYDJXWpA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] php pecl and max channel reached with php-fpm">videlalvaro at gmail.com
       </A><BR>
    <I>Tue May 27 07:38:43 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036265.html">[rabbitmq-discuss] php pecl and max channel reached with php-fpm
</A></li>
        <LI>Next message: <A HREF="036268.html">[rabbitmq-discuss] php pecl and max channel reached with php-fpm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36266">[ date ]</a>
              <a href="thread.html#36266">[ thread ]</a>
              <a href="subject.html#36266">[ subject ]</a>
              <a href="author.html#36266">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As MK said, be sure to either close the channels after you don't need them,
or reuse them. For me it seems that you are keeping persistent connections
and then you open one channel per request, but you don't close the channel
at the end, therefore the channels are &quot;leaking&quot;, and thus your problem.

Regards,

Alvaro


On Tue, May 27, 2014 at 7:25 AM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt;wrote:

&gt;<i>  On 27 May 2014 at 03:00:50, BeaT Adrian (<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aditza8 at gmail.com</A>) wrote:
</I>&gt;<i> &gt; &gt; After a while (I guess 65500 requests) a problem occurs halting
</I>&gt;<i> &gt; all writes
</I>&gt;<i> &gt; &quot;Could not create channel. Connection has no open channel slots
</I>&gt;<i> &gt; remaining&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; From what I have read in the sources is because every tcp connection
</I>&gt;<i> &gt; have an autoincrement channel ID that reaches its max. This happens
</I>&gt;<i> &gt; because every request must use the channel, and is no way to use
</I>&gt;<i> &gt; the same channel ( I could not find a way into the php-amqp channel
</I>&gt;<i> &gt; classs to make it persistent) and scripts cannot communicate
</I>&gt;<i> &gt; ( to use the same instance of the channel as php object).
</I>&gt;<i>
</I>&gt;<i> Every AMQP 0-9-1 connection has 1 or more channels (the max is negotiated
</I>&gt;<i> between client and server, so this can be limited by the broker). If you
</I>&gt;<i> open a lot of channels, you need to close them, or use more than 1
</I>&gt;<i> connection
</I>&gt;<i> (which in turn will use more than 1 TCP connection).
</I>&gt;<i>
</I>&gt;<i> Both channels and especially connections in practice take up some
</I>&gt;<i> resources.
</I>&gt;<i> It is very rare that an app actually needs 1000s or 10s of 1000s of
</I>&gt;<i> channels.
</I>&gt;<i>
</I>&gt;<i> See <A HREF="http://www.rabbitmq.com/tutorials/amqp-concepts.html">http://www.rabbitmq.com/tutorials/amqp-concepts.html</A> if you need a
</I>&gt;<i> more
</I>&gt;<i> detailed explanation.
</I>&gt;<i>
</I>&gt;<i> By the way, it is highly recommended that you use
</I>&gt;<i> <A HREF="https://github.com/videlalvaro/php-amqplib">https://github.com/videlalvaro/php-amqplib</A>
</I>&gt;<i> and not the PECL extension (which is not actively maintained AFAIK).
</I>&gt;<i> --
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i> Software Engineer, Pivotal/RabbitMQ
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/7d667ffa/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140527/7d667ffa/attachment.html</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036265.html">[rabbitmq-discuss] php pecl and max channel reached with php-fpm
</A></li>
	<LI>Next message: <A HREF="036268.html">[rabbitmq-discuss] php pecl and max channel reached with php-fpm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36266">[ date ]</a>
              <a href="thread.html#36266">[ thread ]</a>
              <a href="subject.html#36266">[ subject ]</a>
              <a href="author.html#36266">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
