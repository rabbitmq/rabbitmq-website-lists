<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Retry%20Message%20for%203%20times%20with%2010%20seconds%0A%20interval%20-%20in%20Consumer&In-Reply-To=%3CCADtU9_tAuBsv1YOyCsMHB8Q%2B8gPkaEtrNOnBKYp0A6gCbsRryA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036142.html">
   <LINK REL="Next"  HREF="036174.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer</H1>
    <B>Gary Russell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Retry%20Message%20for%203%20times%20with%2010%20seconds%0A%20interval%20-%20in%20Consumer&In-Reply-To=%3CCADtU9_tAuBsv1YOyCsMHB8Q%2B8gPkaEtrNOnBKYp0A6gCbsRryA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer">grussell at gopivotal.com
       </A><BR>
    <I>Tue May 20 20:48:07 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036142.html">[rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer
</A></li>
        <LI>Next message: <A HREF="036174.html">[rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36143">[ date ]</a>
              <a href="thread.html#36143">[ thread ]</a>
              <a href="subject.html#36143">[ subject ]</a>
              <a href="author.html#36143">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To configure the retry advice in XML, you need to wire up
a StatefulRetryOperationsInterceptorFactoryBean.

It needs a RetryTemplate (RetryOperations) bean which needs a RetryPolicy
and BackOffPolicy beans.

Then wire the factory bean into the advice chain.

To set the message id, it depends on how you are sending messages; you can
set it directly, or if you are using message conversion, set
the createMessageIds to true on the outbound template's
SimpleMessageConverter.

However, when using long backoffs like that, there's not much benefit in
using stateful retry.


On Tue, May 20, 2014 at 3:29 PM, Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srinatsr at cisco.com</A>&gt; wrote:

&gt;<i>  Thanks  do you have xml version of the following?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I need to set message id before publishing the message?  How to do this?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards &#8230;*?*
</I>&gt;<i>
</I>&gt;<i> Srinath
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* rabbitmq-discuss [mailto:
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] *On Behalf Of *Gary Russell
</I>&gt;<i> *Sent:* Tuesday, May 20, 2014 12:24 PM
</I>&gt;<i> *To:* Discussions about RabbitMQ
</I>&gt;<i> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
</I>&gt;<i> seconds interval - in Consumer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> @Bean
</I>&gt;<i>
</I>&gt;<i> public MethodInterceptor retryAdvice() {
</I>&gt;<i>
</I>&gt;<i>      FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
</I>&gt;<i>
</I>&gt;<i>      backOffPolicy.setBackOffPeriod(10000);;
</I>&gt;<i>
</I>&gt;<i>      return RetryInterceptorBuilder.stateful()
</I>&gt;<i>
</I>&gt;<i>           .backOffPolicy(backOffPolicy)
</I>&gt;<i>
</I>&gt;<i>           .maxAttempts(3)
</I>&gt;<i>
</I>&gt;<i>           .recoverer(new RejectAndDontRequeueRecoverer())
</I>&gt;<i>
</I>&gt;<i>           .build();
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Add it to the adviceChain property of the SimpleMessageListenerContainer.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Note: stateful retry requires the message to have a message id; use a
</I>&gt;<i> stateless advice otherwise.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> After the retries are exhausted, the message will be rejected (and dropped
</I>&gt;<i> or sent to a Dead Letter Exchange of so configured).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR
</I>&gt;<i> TECHNOLOGIES INC at Cisco) &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srinatsr at cisco.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I am consuming the messages using the listener as follows,  I need to
</I>&gt;<i> retry processing three times if any exceptions occurred.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &lt;bean
</I>&gt;<i>
</I>&gt;<i>         class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer&quot;*
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;connectionFactory&quot;* ref=*&quot;connectionFactory&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;queueNames&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>             &lt;array&gt;
</I>&gt;<i>
</I>&gt;<i>                 &lt;value&gt;validateRequestQueue&lt;/value&gt;
</I>&gt;<i>
</I>&gt;<i>             &lt;/array&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;messageListener&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>             &lt;bean
</I>&gt;<i>
</I>&gt;<i>                 class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter&quot;*
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>                 &lt;property name=*&quot;delegate&quot;* ref=*&quot;retryConsumer&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>             &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;!-- &lt;property name=&quot;acknowledgeMode&quot; value=&quot;NONE&quot; /&gt; --&gt;
</I>&gt;<i>
</I>&gt;<i>     &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *public* *class* RetryConsumer *implements* ChannelAwareMessageListener {
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>        /**
</I>&gt;<i>
</I>&gt;<i>        * Callback for processing a received Rabbit message.
</I>&gt;<i>
</I>&gt;<i>        * *@param* message the received AMQP message
</I>&gt;<i>
</I>&gt;<i>        * *@param* channel the underlying Rabbit Channel
</I>&gt;<i>
</I>&gt;<i>        * *@throws* Exception
</I>&gt;<i>
</I>&gt;<i>         */
</I>&gt;<i>
</I>&gt;<i>        @Override
</I>&gt;<i>
</I>&gt;<i>        *public* *void* onMessage(Message message, Channel channel)
</I>&gt;<i> *throws* Exception {
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>              System.*out*.println(&quot;Received Message :: &quot;+*new*String(message.getBody()));
</I>&gt;<i>
</I>&gt;<i>              *if*(*true*){
</I>&gt;<i>
</I>&gt;<i>              *throw* *new* RuntimeException(&quot;Error&quot;);
</I>&gt;<i>
</I>&gt;<i>              }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>        }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards &#8230;*?*
</I>&gt;<i>
</I>&gt;<i> Srinath
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at
</I>&gt;<i> Cisco)
</I>&gt;<i> *Sent:* Monday, May 19, 2014 10:47 AM
</I>&gt;<i> *To:* <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> *Subject:* Retry Message for 3 times with 10 seconds interval - in
</I>&gt;<i> Consumer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Retry unacknowledged RabbitMQ message in 10 second interval
</I>&gt;<i>
</I>&gt;<i> And Retry 3 times using Spring framework in java .
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Please need help on this
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards &#8230;*?*
</I>&gt;<i>
</I>&gt;<i> Srinath
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/c107df17/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140520/c107df17/attachment.html</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036142.html">[rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer
</A></li>
	<LI>Next message: <A HREF="036174.html">[rabbitmq-discuss] Retry Message for 3 times with 10 seconds interval - in Consumer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36143">[ date ]</a>
              <a href="thread.html#36143">[ thread ]</a>
              <a href="subject.html#36143">[ subject ]</a>
              <a href="author.html#36143">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
