<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Getting maximum performance from RabbitMQ	cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Getting%20maximum%20performance%20from%20RabbitMQ%0A%09cluster&In-Reply-To=%3C1399349783225-35358.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035790.html">
   <LINK REL="Next"  HREF="035815.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Getting maximum performance from RabbitMQ	cluster</H1>
    <B>Pavel</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Getting%20maximum%20performance%20from%20RabbitMQ%0A%09cluster&In-Reply-To=%3C1399349783225-35358.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Getting maximum performance from RabbitMQ	cluster">pmaisenovich at blizzard.com
       </A><BR>
    <I>Tue May  6 05:16:23 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035790.html">[rabbitmq-discuss] Getting maximum performance from RabbitMQ cluster
</A></li>
        <LI>Next message: <A HREF="035815.html">[rabbitmq-discuss] Getting maximum performance from RabbitMQ	cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35798">[ date ]</a>
              <a href="thread.html#35798">[ thread ]</a>
              <a href="subject.html#35798">[ subject ]</a>
              <a href="author.html#35798">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Today I've tested the overhead that &quot;x-consistent-hash&quot; exchange adds. In
this test setup I had 16 queues with same weights behind hash exchange (by
custom hash-header). All queues declared on same node, non-HA, publisher
threads connecting to that node as well. Throughput numbers

1 thread - 9K/s
2 threads - 18K/s
4 threads - 40K/s
8 threads - 82K/s
16 threads - 95K/s

Publish rate is reduced by about a half, Rabbit CPU at 16 threads was
constantly 99%+ busy.

The more I think about scaling RabbitMQ, the more I come with conclusion
that cluster is no help. In the test case above for example it would not
help at all to have a cluster as publishers have no means to know which node
the message would end up going to and thus can't pick which node to connect
for most efficient publishing (to avoid cross node synchronization
overhead). It would be better to have multiple independent RabbitMQ brokers,
each having multiple consumers with even load distribution (via hash
exchange) and publishers randomly choosing which node to connect to.

Am I going crazy here or  clustering feature
&lt;<A HREF="https://www.rabbitmq.com/clustering.html">https://www.rabbitmq.com/clustering.html</A>&gt;   of RabbitMQ is suited best for
reliability and not scalability? I just don't see how it helps so far.





--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Getting-maximum-performance-from-RabbitMQ-cluster-tp35347p35358.html">http://rabbitmq.1065348.n5.nabble.com/Getting-maximum-performance-from-RabbitMQ-cluster-tp35347p35358.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035790.html">[rabbitmq-discuss] Getting maximum performance from RabbitMQ cluster
</A></li>
	<LI>Next message: <A HREF="035815.html">[rabbitmq-discuss] Getting maximum performance from RabbitMQ	cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35798">[ date ]</a>
              <a href="thread.html#35798">[ thread ]</a>
              <a href="subject.html#35798">[ subject ]</a>
              <a href="author.html#35798">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
