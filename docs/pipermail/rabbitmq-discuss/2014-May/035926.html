<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Need clarification on RabbitMq Connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Need%20clarification%20on%20RabbitMq%20Connection&In-Reply-To=%3CetPan.537223ac.238e1f29.11ca%40mercurio.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035694.html">
   <LINK REL="Next"  HREF="035705.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Need clarification on RabbitMq Connection</H1>
    <B>Michael Klishin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Need%20clarification%20on%20RabbitMq%20Connection&In-Reply-To=%3CetPan.537223ac.238e1f29.11ca%40mercurio.local%3E"
       TITLE="[rabbitmq-discuss] Need clarification on RabbitMq Connection">mklishin at gopivotal.com
       </A><BR>
    <I>Tue May 13 14:52:16 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035694.html">[rabbitmq-discuss] Need clarification on RabbitMq Connection
</A></li>
        <LI>Next message: <A HREF="035705.html">[rabbitmq-discuss] Redelivery of unacked messages.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35926">[ date ]</a>
              <a href="thread.html#35926">[ thread ]</a>
              <a href="subject.html#35926">[ subject ]</a>
              <a href="author.html#35926">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1 May 2014 at 10:24:19, Loganathan Sellapa (<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">loganathan.ms at gmail.com</A>) wrote:
&gt;<i> &gt; This library needs to
</I>&gt;<i>  
</I>&gt;<i> run always and should not close the connection at all, hence it  
</I>&gt;<i> needs to listen &amp; publish messages always, also this library  
</I>&gt;<i> is running to of ROR application.
</I>&gt;<i>  
</I>&gt;<i> For this requirement I have build an rake task to start listening  
</I>&gt;<i> to RabbitMQ, also I have placed the same code in initializers  
</I>&gt;<i> file in order to start the library along with Apache server in  
</I>&gt;<i> production mode. In production mode initializer file is starting  
</I>&gt;<i> my library to listen &amp; publish the messages to RabbitMq. I have  
</I>&gt;<i> noticed that connectiong to RabbitMq behaves differently via  
</I>&gt;<i> rake task &amp; initilazer file, copied below the rabbitmq log for  
</I>&gt;<i> your reference.
</I>&gt;<i>  
</I>&gt;<i> RABBITMQ LOG WHILE RUNNING THE RUBY LIBRARY VIA RAKE TASK: (Connection  
</I>&gt;<i> made one time only)
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> =INFO REPORT==== 30-Apr-2014(<A HREF="http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4">http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4</A>)::20:43:24  
</I>&gt;<i> ===
</I>&gt;<i> accepting AMQP connection &lt;0.7409.18&gt; (10.146.14.118:54932(<A HREF="http://10.146.14.118:54932/">http://10.146.14.118:54932/</A>)  
</I>&gt;<i> -&gt; 10.112.187.58:5671(<A HREF="http://10.112.187.58:5671/">http://10.112.187.58:5671/</A>))
</I>&gt;<i>  
</I>&gt;<i> RABBITMQ LOG WHILE RUNNING THE RUBY LIBRARY VIA INITIALIZER  
</I>&gt;<i> FILE:(Connection made multiple times)
</I>&gt;<i>  
</I>&gt;<i> =INFO REPORT==== 30-Apr-2014(<A HREF="http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4">http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4</A>)::20:28:35  
</I>&gt;<i> ===
</I>&gt;<i> accepting AMQP connection &lt;0.6325.18&gt; (10.146.14.118:54928(<A HREF="http://10.146.14.118:54928/">http://10.146.14.118:54928/</A>)  
</I>&gt;<i> -&gt; 10.112.187.58:5671(<A HREF="http://10.112.187.58:5671/">http://10.112.187.58:5671/</A>))
</I>&gt;<i>  
</I>&gt;<i> =INFO REPORT==== 30-Apr-2014(<A HREF="http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4">http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4</A>)::20:28:35  
</I>&gt;<i> ===
</I>&gt;<i> accepting AMQP connection &lt;0.6329.18&gt; (10.146.14.118:54929(<A HREF="http://10.146.14.118:54929/">http://10.146.14.118:54929/</A>)  
</I>&gt;<i> -&gt; 10.112.187.58:5671(<A HREF="http://10.112.187.58:5671/">http://10.112.187.58:5671/</A>))
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> =WARNING REPORT==== 30-Apr-2014(<A HREF="http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4">http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4</A>)::20:28:37  
</I>&gt;<i> ===
</I>&gt;<i> closing AMQP connection &lt;0.6325.18&gt; (10.146.14.118:54928(<A HREF="http://10.146.14.118:54928/">http://10.146.14.118:54928/</A>)  
</I>&gt;<i> -&gt; 10.112.187.58:5671(<A HREF="http://10.112.187.58:5671/">http://10.112.187.58:5671/</A>)):
</I>&gt;<i> connection_closed_abruptly
</I>&gt;<i>  
</I>&gt;<i> =INFO REPORT==== 30-Apr-2014(<A HREF="http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4">http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4</A>)::20:28:37  
</I>&gt;<i> ===
</I>&gt;<i> accepting AMQP connection &lt;0.6368.18&gt; (10.146.14.118:54930(<A HREF="http://10.146.14.118:54930/">http://10.146.14.118:54930/</A>)  
</I>&gt;<i> -&gt; 10.112.187.58:5671(<A HREF="http://10.112.187.58:5671/">http://10.112.187.58:5671/</A>))
</I>&gt;<i>  
</I>&gt;<i> =WARNING REPORT==== 30-Apr-2014(<A HREF="http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4">http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4</A>)::20:28:37  
</I>&gt;<i> ===
</I>&gt;<i> closing AMQP connection &lt;0.6329.18&gt; (10.146.14.118:54929(<A HREF="http://10.146.14.118:54929/">http://10.146.14.118:54929/</A>)  
</I>&gt;<i> -&gt; 10.112.187.58:5671(<A HREF="http://10.112.187.58:5671/">http://10.112.187.58:5671/</A>)):
</I>&gt;<i> connection_closed_abruptly
</I>&gt;<i>  
</I>&gt;<i> =INFO REPORT==== 30-Apr-2014(<A HREF="http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4">http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4</A>)::20:28:37  
</I>&gt;<i> ===
</I>&gt;<i> accepting AMQP connection &lt;0.6373.18&gt; (10.146.14.118:54931(<A HREF="http://10.146.14.118:54931/">http://10.146.14.118:54931/</A>)  
</I>&gt;<i> -&gt; 10.112.187.58:5671(<A HREF="http://10.112.187.58:5671/">http://10.112.187.58:5671/</A>))
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> =ERROR REPORT==== 30-Apr-2014(<A HREF="http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4">http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4</A>)::20:28:42  
</I>&gt;<i> ===
</I>&gt;<i> error on AMQP connection &lt;0.6368.18&gt;: {ssl_upgrade_error,timeout}  
</I>&gt;<i> (unknown POSIX error)
</I>&gt;<i>  
</I>&gt;<i> =ERROR REPORT==== 30-Apr-2014(<A HREF="http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4">http://airmail.calendar/2014-04-30%2012:00:00%20GMT+4</A>)::20:28:42  
</I>&gt;<i> ===
</I>&gt;<i> error on AMQP connection &lt;0.6373.18&gt;: {ssl_upgrade_error,timeout}  
</I>&gt;<i> (unknown POSIX error)
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> Can
</I>&gt;<i> anybody
</I>&gt;<i> let me know whether the issue with my code or with RabbitMq configuration,  
</I>&gt;<i> you can see my code HERE(<A HREF="https://gist.github.com/loganathan-s/22256c01127065c9d659">https://gist.github.com/loganathan-s/22256c01127065c9d659</A>).  
</I>
The initializer is loaded multiple times (I'm very rusty on Rails and Passenger to suggest why).
You need to change your code to not connect N times if $connection is not nil and alive.

And as I said before, if you don't use Thin or EventMachine heavily, please migrate from amqp
gem to Bunny ASAP. You will see your initializer code become much more straightforward
and easier to debug.&#160;
--  
MK  

Software Engineer, Pivotal/RabbitMQ
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035694.html">[rabbitmq-discuss] Need clarification on RabbitMq Connection
</A></li>
	<LI>Next message: <A HREF="035705.html">[rabbitmq-discuss] Redelivery of unacked messages.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35926">[ date ]</a>
              <a href="thread.html#35926">[ thread ]</a>
              <a href="subject.html#35926">[ subject ]</a>
              <a href="author.html#35926">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
