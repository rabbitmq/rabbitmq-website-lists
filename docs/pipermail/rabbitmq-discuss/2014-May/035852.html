<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Writes to Rabbit Occasionally Hang	Indefinitely
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Writes%20to%20Rabbit%20Occasionally%20Hang%0A%09Indefinitely&In-Reply-To=%3CA758C1AE-8EDB-4C69-A507-7B57970E0481%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035837.html">
   <LINK REL="Next"  HREF="035933.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Writes to Rabbit Occasionally Hang	Indefinitely</H1>
    <B>Jeffrey Doto</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Writes%20to%20Rabbit%20Occasionally%20Hang%0A%09Indefinitely&In-Reply-To=%3CA758C1AE-8EDB-4C69-A507-7B57970E0481%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] Writes to Rabbit Occasionally Hang	Indefinitely">jeffdoto at gmail.com
       </A><BR>
    <I>Wed May  7 17:41:21 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035837.html">[rabbitmq-discuss] New RabbitMQ 3.3.0 Web_stomp SSL problems
</A></li>
        <LI>Next message: <A HREF="035933.html">[rabbitmq-discuss] Writes to Rabbit Occasionally Hang Indefinitely
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35852">[ date ]</a>
              <a href="thread.html#35852">[ thread ]</a>
              <a href="subject.html#35852">[ subject ]</a>
              <a href="author.html#35852">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Michael,

Thanks very much for your response.  I have a bit more data about this that could be interesting.

Our producer node dysfunction seems to be correlated with a heartbeat timeout event:

5/7/14 12:44:11.000 AM	
=INFO REPORT==== 7-May-2014::00:44:11 ===
accepting AMQP connection &lt;0.17458.855&gt; (172.20.153.34:36684 -&gt; 172.20.153.185:5672)


5/7/14 12:44:11.000 AM	
=ERROR REPORT==== 7-May-2014::00:44:11 ===
closing AMQP connection &lt;0.30506.852&gt; (172.20.153.34:37769 -&gt; 172.20.153.185:5672):
{heartbeat_timeout,running}


If we check netstat on the producer / rabbit-server sides, we see a very large Send-Q value on the producer, and nothing on the rabbit-server side; the producer Send-Q size just continues to grow larger, with no response from the server:

producer:
[ccpmer-po-cb48-p ~ ]$ netstat -an | grep 5672
tcp        0 1066985 ::ffff:172.20.153.34:36684  ::ffff:172.20.153.185:5672  ESTABLISHED 
tcp        1      0 ::ffff:172.20.153.34:60075  ::ffff:172.20.149.41:15672  CLOSE_WAIT  

rabbit side:
[ccpmer-po-cb176-p ~ ]$ netstat -an | grep 5672 | grep 34
tcp        0      0 ::ffff:172.20.153.185:5672  ::ffff:172.20.153.34:36684  ESTABLISHED 

producer Send-Q keeps growing.
[ccpmer-po-cb48-p ~ ]$ netstat -an | grep 5672
tcp        0 1074230 ::ffff:172.20.153.34:36684  ::ffff:172.20.153.185:5672  ESTABLISHED 
tcp        1      0 ::ffff:172.20.153.34:60075  ::ffff:172.20.149.41:15672  CLOSE_WAIT


Again we&#8217;re running the 3.2.2 version of the server - I do see that bugfix 25457 fixed a similar issue in the 3.0.3 release, but we&#8217;re past that now.

Is this still indicative of the socketWrite timeout issue you referred me to in your last response, or could this be something else?  Is there more data you&#8217;d like to see that could help diagnose this further?

Are there any plans to fix <A HREF="https://github.com/rabbitmq/rabbitmq-java-client/issues/11">https://github.com/rabbitmq/rabbitmq-java-client/issues/11</A> soon?  There&#8217;s not another more recent version of rabbit we could upgrade to that would help us, is there?  

Thanks again,

Jeff



On Apr 28, 2014, at 6:31 PM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt; wrote:

&gt;<i> On 29 April 2014 at 02:29:30, Jeff Doto (<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jeffdoto at gmail.com</A>) wrote:
</I>&gt;&gt;&gt;<i> We&#8217;re wondering if anyone has encountered an issue similar  
</I>&gt;&gt;<i> to this running the versions of Rabbit server / client we are.  
</I>&gt;&gt;<i> Are there any suggestions for what we can do to prevent this? Could  
</I>&gt;&gt;<i> upgrading the server version help?
</I>&gt;<i> 
</I>&gt;<i> This is a known Java client (or, well, JDK Socket) limitation:
</I>&gt;<i> <A HREF="http://markmail.org/thread/w7ay4hslxwqirfsc">http://markmail.org/thread/w7ay4hslxwqirfsc</A> 
</I>&gt;<i> --  
</I>&gt;<i> MK  
</I>&gt;<i> 
</I>&gt;<i> Software Engineer, Pivotal/RabbitMQ
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/fbfb2fa9/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140507/fbfb2fa9/attachment.html</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035837.html">[rabbitmq-discuss] New RabbitMQ 3.3.0 Web_stomp SSL problems
</A></li>
	<LI>Next message: <A HREF="035933.html">[rabbitmq-discuss] Writes to Rabbit Occasionally Hang Indefinitely
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35852">[ date ]</a>
              <a href="thread.html#35852">[ thread ]</a>
              <a href="subject.html#35852">[ subject ]</a>
              <a href="author.html#35852">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
