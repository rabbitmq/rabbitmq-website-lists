<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fully reliable setup impossible?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fully%20reliable%20setup%20impossible%3F&In-Reply-To=%3C537E26D0.3070703%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036217.html">
   <LINK REL="Next"  HREF="036220.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fully reliable setup impossible?</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fully%20reliable%20setup%20impossible%3F&In-Reply-To=%3C537E26D0.3070703%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Fully reliable setup impossible?">simon at rabbitmq.com
       </A><BR>
    <I>Thu May 22 17:33:20 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036217.html">[rabbitmq-discuss] Fully reliable setup impossible?
</A></li>
        <LI>Next message: <A HREF="036220.html">[rabbitmq-discuss] Fully reliable setup impossible?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36218">[ date ]</a>
              <a href="thread.html#36218">[ thread ]</a>
              <a href="subject.html#36218">[ subject ]</a>
              <a href="author.html#36218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/05/14 14:04, Steffen Daniel Jensen wrote:
&gt;<i> We have two data centers connected closely by LAN.
</I>&gt;<i> We are interested in a *reliable cluster* setup. It must be a cluster
</I>&gt;<i> because we want clients to be able to connect to each node
</I>&gt;<i> transparently. Federation is not an option.
</I>
I hope you realise that you are asking for a lot here! You should read 
up on the CAP theorem if you have not already done so.

&gt;<i> 1. It happens that the firewall/switch is restarted, and maybe a few
</I>&gt;<i> ping messages are lost.
</I>&gt;<i> 2. The setup should survive data center crash
</I>&gt;<i> 3. All queues are durable and mirrored, all messages are persisted, all
</I>&gt;<i> publishes are confirmed
</I>&gt;<i> There are 3 cluster-recovery settings
</I>&gt;<i> a) ignore: A cross data center network break-down would cause message
</I>&gt;<i> loss on the node that is restarted In order to rejoin.
</I>&gt;<i> b) pause_minority: If we choose the same number of nodes in each data
</I>&gt;<i> center, the whole cluster will pause. If we don't, only the data center
</I>&gt;<i> with the most nodes can survive.
</I>&gt;<i> c) auto_heal: If the cluster decides network partitioning, there is a
</I>&gt;<i> potential of message loss, when joining.
</I>&gt;<i> [I would really like a resync-setting similar to the one described below]
</I>&gt;<i> Question 1: Is it even possible to have a fully reliable setup in such a
</I>&gt;<i> setting?
</I>
Depends how you define &quot;fully reliable&quot;. If you want Consistency (i.e. 
mirrored queues), Availability (i.e. neither data centre pauses) and 
Partition tolerance (no loss of data from either side if the network 
goes down between them) then I'm afraid you can't.

&gt;<i> In reality we probably won't have actual network partitions, and it will
</I>&gt;<i> most probably only be a very short network downtime.
</I>&gt;<i> Question 2: Is it possible to adjust how long it takes rabbitmq to
</I>&gt;<i> decide &quot;node down&quot;?
</I>
Yes, see <A HREF="http://www.rabbitmq.com/nettick.html">http://www.rabbitmq.com/nettick.html</A>

&gt;<i> It is much better to have a halted rabbitmq for some seconds than to
</I>&gt;<i> have message loss.
</I>&gt;<i> Question 3: Assume that we are using the ignore setting, and that we
</I>&gt;<i> have only two nodes in the cluster. Would the following be a full
</I>&gt;<i> recovery with zero message loss?
</I>&gt;<i> 0. Decide which node survives, Ns, and which should be restarted, Nr.
</I>&gt;<i> 1. Refuse all connections to Nr except from a special recovery
</I>&gt;<i> application. (One could change the ip, so all running services can't
</I>&gt;<i> connect or similar)
</I>&gt;<i> 2. Consume and republish all message from Nr to Ns.
</I>&gt;<i> 3. Restart Nr
</I>&gt;<i> Then the cluster should be up-and-running again.
</I>
That sounds like it would work. You're losing some availability and 
consistency, and your message ordering will change. You have a pretty 
good chance of duplicating lots of messages too (any that were in the 
queues when the partition happened). Assuming you're happy with that it 
sounds reasonable.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036217.html">[rabbitmq-discuss] Fully reliable setup impossible?
</A></li>
	<LI>Next message: <A HREF="036220.html">[rabbitmq-discuss] Fully reliable setup impossible?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36218">[ date ]</a>
              <a href="thread.html#36218">[ thread ]</a>
              <a href="subject.html#36218">[ subject ]</a>
              <a href="author.html#36218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
