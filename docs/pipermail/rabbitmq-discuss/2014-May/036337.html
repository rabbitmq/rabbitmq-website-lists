<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] FW: Retry Message for 3 times with 10 seconds interval - in Consumer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20FW%3A%20Retry%20Message%20for%203%20times%20with%2010%0A%20seconds%20interval%20-%20in%20Consumer&In-Reply-To=%3CCADtU9_vfb6%3DX6S7DaOa3XfA0ePngPwoz45mFBOeB7APrje2M6Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="036320.html">
   <LINK REL="Next"  HREF="036097.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] FW: Retry Message for 3 times with 10 seconds interval - in Consumer</H1>
    <B>Gary Russell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20FW%3A%20Retry%20Message%20for%203%20times%20with%2010%0A%20seconds%20interval%20-%20in%20Consumer&In-Reply-To=%3CCADtU9_vfb6%3DX6S7DaOa3XfA0ePngPwoz45mFBOeB7APrje2M6Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] FW: Retry Message for 3 times with 10 seconds interval - in Consumer">grussell at gopivotal.com
       </A><BR>
    <I>Thu May 29 15:48:03 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="036320.html">[rabbitmq-discuss] FW: Retry Message for 3 times with 10 seconds interval - in Consumer
</A></li>
        <LI>Next message: <A HREF="036097.html">[rabbitmq-discuss] RetryTemplate I need 3 retries
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36337">[ date ]</a>
              <a href="thread.html#36337">[ thread ]</a>
              <a href="subject.html#36337">[ subject ]</a>
              <a href="author.html#36337">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You need to provide much more information (logs, all configuration).

Please move this question to Stack Overflow (<A HREF="http://stackoverflow.com/">http://stackoverflow.com/</A>)
using the 'spring-amqp' tag since your concerns are all about Spring AMQP
and not RabbitMQ itself.


On Wed, May 28, 2014 at 8:03 PM, Srinath Sridharan -X (srinatsr - ZENSAR
TECHNOLOGIES INC at Cisco) &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srinatsr at cisco.com</A>&gt; wrote:

&gt;<i>  Hi Gary,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My listener getting disconnected if any messages published to queue (which
</I>&gt;<i> it is listening).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Following is the listerner configuration.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &lt;bean
</I>&gt;<i>
</I>&gt;<i>               class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer&quot;*
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;property name=*&quot;connectionFactory&quot;* ref=
</I>&gt;<i> *&quot;connectionFactory&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;property name=*&quot;queueNames&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>                     &lt;array&gt;
</I>&gt;<i>
</I>&gt;<i>                            &lt;value&gt;validateRequestQueue&lt;/value&gt;
</I>&gt;<i>
</I>&gt;<i>                     &lt;/array&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;property name=*&quot;messageListener&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>                     &lt;bean
</I>&gt;<i>
</I>&gt;<i>                            class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter&quot;*
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>                            &lt;property name=*&quot;delegate&quot;* ref=
</I>&gt;<i> *&quot;validationListener&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>                     &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;property name=*&quot;adviceChain&quot;*
</I>&gt;<i>
</I>&gt;<i>                     ref=*&quot;statefulRetryOperationsInterceptorFactoryBean&quot;*
</I>&gt;<i> &gt;&lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;property name=*&quot;acknowledgeMode&quot;* value=*&quot;NONE&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>        &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards &#8230;*?*
</I>&gt;<i>
</I>&gt;<i> Srinath
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Gary Russell [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">grussell at gopivotal.com</A>]
</I>&gt;<i> *Sent:* Wednesday, May 21, 2014 2:34 PM
</I>&gt;<i> *To:* Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
</I>&gt;<i> *Subject:* Re: FW: [rabbitmq-discuss] Retry Message for 3 times with 10
</I>&gt;<i> seconds interval - in Consumer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     &lt;bean id=*&quot;statefulRetryOperationsInterceptorFactoryBean&quot;*
</I>&gt;<i>
</I>&gt;<i>         class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.config.StatefulRetryOperationsInterceptorFactoryBean&quot;*
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;retryOperations&quot;* ref=*&quot;retryTemplate&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;messageRecoverer&quot;&gt;*
</I>&gt;<i>
</I>&gt;<i>             &lt;bean class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.retry.RejectAndDontRequeueRecoverer&quot;&gt;*
</I>&gt;<i>
</I>&gt;<i>         &lt;/property*&gt;    *
</I>&gt;<i>
</I>&gt;<i>     &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wed, May 21, 2014 at 4:46 PM, Srinath Sridharan -X (srinatsr - ZENSAR
</I>&gt;<i> TECHNOLOGIES INC at Cisco) &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srinatsr at cisco.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I totally agree Gary.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> But how to configure in xml ?  Here is my xml and designed as you
</I>&gt;<i> described.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>    &lt;bean id=*&quot;simpleRetryPolicy&quot;* class=
</I>&gt;<i> *&quot;org.springframework.retry.policy.SimpleRetryPolicy&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;maxAttempts&quot;* value=*&quot;3&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>     &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>     &lt;!-- &lt;bean id=&quot;retryTemplate&quot;
</I>&gt;<i> class=&quot;org.springframework.retry.support.RetryTemplate&quot;&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=&quot;retryPolicy&quot; *ref*=&quot;simpleRetryPolicy&quot; /&gt;
</I>&gt;<i>
</I>&gt;<i>     &lt;/bean&gt; --&gt;
</I>&gt;<i>
</I>&gt;<i>     &lt;bean id=*&quot;statefulRetryOperationsInterceptorFactoryBean&quot;*
</I>&gt;<i>
</I>&gt;<i>         class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.config.StatefulRetryOperationsInterceptorFactoryBean&quot;*
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;retryOperations&quot;* ref=*&quot;retryTemplate&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;messageRecoverer&quot;*
</I>&gt;<i>
</I>&gt;<i>     &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>        &lt;bean id=*&quot;retryTemplate&quot;* class=
</I>&gt;<i> *&quot;org.springframework.retry.support.RetryTemplate&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>               &lt;property name=*&quot;retryPolicy&quot;* ref=*&quot;simpleRetryPolicy&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;property name=*&quot;backOffPolicy&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>                     &lt;bean class=
</I>&gt;<i> *&quot;org.springframework.retry.backoff.ExponentialBackOffPolicy&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>                            &lt;property name=*&quot;initialInterval&quot;* value=
</I>&gt;<i> *&quot;10000&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;!--         &lt;property name=&quot;multiplier&quot; value=&quot;10.0&quot; /&gt;
</I>&gt;<i>
</I>&gt;<i>                            &lt;property name=&quot;maxInterval&quot; value=&quot;10000&quot; /&gt;
</I>&gt;<i> --&gt;
</I>&gt;<i>
</I>&gt;<i>                     &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>        &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>        &lt;rabbit:template id=*&quot;rabbitTemplate&quot;*
</I>&gt;<i>
</I>&gt;<i>              connection-factory=*&quot;connectionFactory&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>        &lt;bean
</I>&gt;<i>
</I>&gt;<i>               class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer&quot;*
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;property name=*&quot;connectionFactory&quot;* ref=
</I>&gt;<i> *&quot;connectionFactory&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;property name=*&quot;queueNames&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>                     &lt;array&gt;
</I>&gt;<i>
</I>&gt;<i>                            &lt;value&gt;validateRequestQueue&lt;/value&gt;
</I>&gt;<i>
</I>&gt;<i>                     &lt;/array&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;property name=*&quot;messageListener&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>                     &lt;bean
</I>&gt;<i>
</I>&gt;<i>                            class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter&quot;*
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>                            &lt;property name=*&quot;delegate&quot;* ref=
</I>&gt;<i> *&quot;retryConsumer&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>                     &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;property name=*&quot;adviceChain&quot;* ref=
</I>&gt;<i> *&quot;statefulRetryOperationsInterceptorFactoryBean&quot;*&gt;&lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>              &lt;!-- &lt;property name=&quot;acknowledgeMode&quot; value=&quot;NONE&quot; /&gt; --&gt;
</I>&gt;<i>
</I>&gt;<i>        &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards &#8230;*?*
</I>&gt;<i>
</I>&gt;<i> Srinath
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* rabbitmq-discuss [mailto:
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] *On Behalf Of *Gary Russell
</I>&gt;<i> *Sent:* Wednesday, May 21, 2014 1:14 PM
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *To:* Discussions about RabbitMQ
</I>&gt;<i> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
</I>&gt;<i> seconds interval - in Consumer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You did not configure a MessageRecoverer as I suggested; the default
</I>&gt;<i> recoverer logs a WARN message and acks the message.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Add a RejectAndDontRequeueRecoverer and the rejected message will go to
</I>&gt;<i> the DLE.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wed, May 21, 2014 at 2:14 PM, Srinath Sridharan -X (srinatsr - ZENSAR
</I>&gt;<i> TECHNOLOGIES INC at Cisco) &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srinatsr at cisco.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> After 3 times, I am getting the following exception.  But I don&#8217;t want
</I>&gt;<i> this exception, directly the message should go to dead letter exchange.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I  have configured dlx as follows.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> rabbitmqctl set_policy DLX &quot;.*&quot; '{&quot;dead-letter-exchange&quot;:&quot;my-dlx&quot;}'
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 2014-05-21 11:10:37:870 -0700, [WARN]
</I>&gt;<i> StatefulRetryOperationsInterceptorFactoryBean  recover - 89 Message dropped
</I>&gt;<i> on recovery: (Body:'[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">B at 3ed60d48</A>(byte[163])'MessageProperties [headers={},
</I>&gt;<i> timestamp=null, messageId=1, userId=null, appId=null, clusterId=null,
</I>&gt;<i> type=null, correlationId=null, replyTo=null,
</I>&gt;<i> contentType=application/octet-stream, contentEncoding=null,
</I>&gt;<i> contentLength=0, deliveryMode=PERSISTENT, expiration=null, priority=0,
</I>&gt;<i> redelivered=true, receivedExchange=,
</I>&gt;<i> receivedRoutingKey=validateRequestQueue, deliveryTag=8, messageCount=0])
</I>&gt;<i>
</I>&gt;<i> *org.springframework.amqp.rabbit.listener.ListenerExecutionFailedException*:
</I>&gt;<i> Listener threw exception
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.wrapToListenerExecutionFailedExceptionIfNeeded(
</I>&gt;<i> *AbstractMessageListenerContainer.java:758*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(
</I>&gt;<i> *AbstractMessageListenerContainer.java:653*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(
</I>&gt;<i> *AbstractMessageListenerContainer.java:576*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$001(
</I>&gt;<i> *SimpleMessageListenerContainer.java:75*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$1.invokeListener(
</I>&gt;<i> *SimpleMessageListenerContainer.java:154*)
</I>&gt;<i>
</I>&gt;<i>        at sun.reflect.NativeMethodAccessorImpl.invoke0(*Native Method*)
</I>&gt;<i>
</I>&gt;<i>        at sun.reflect.NativeMethodAccessorImpl.invoke(
</I>&gt;<i> *NativeMethodAccessorImpl.java:57*)
</I>&gt;<i>
</I>&gt;<i>        at sun.reflect.DelegatingMethodAccessorImpl.invoke(
</I>&gt;<i> *DelegatingMethodAccessorImpl.java:43*)
</I>&gt;<i>
</I>&gt;<i>        at java.lang.reflect.Method.invoke(*Method.java:606*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(
</I>&gt;<i> *AopUtils.java:317*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(
</I>&gt;<i> *ReflectiveMethodInvocation.java:183*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(
</I>&gt;<i> *ReflectiveMethodInvocation.java:150*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor$MethodInvocationRetryCallback.doWithRetry(
</I>&gt;<i> *StatefulRetryOperationsInterceptor.java:162*)
</I>&gt;<i>
</I>&gt;<i>        at org.springframework.retry.support.RetryTemplate.doExecute(
</I>&gt;<i> *RetryTemplate.java:263*)
</I>&gt;<i>
</I>&gt;<i>        at org.springframework.retry.support.RetryTemplate.execute(
</I>&gt;<i> *RetryTemplate.java:193*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.retry.interceptor.StatefulRetryOperationsInterceptor.invoke(
</I>&gt;<i> *StatefulRetryOperationsInterceptor.java:137*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(
</I>&gt;<i> *ReflectiveMethodInvocation.java:172*)
</I>&gt;<i>
</I>&gt;<i>        at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(
</I>&gt;<i> *JdkDynamicAopProxy.java:204*)
</I>&gt;<i>
</I>&gt;<i>        at com.sun.proxy.$Proxy62.invokeListener(Unknown Source)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.invokeListener(
</I>&gt;<i> *SimpleMessageListenerContainer.java:1113*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(
</I>&gt;<i> *AbstractMessageListenerContainer.java:559*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(
</I>&gt;<i> *SimpleMessageListenerContainer.java:904*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(
</I>&gt;<i> *SimpleMessageListenerContainer.java:888*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$500(
</I>&gt;<i> *SimpleMessageListenerContainer.java:75*)
</I>&gt;<i>
</I>&gt;<i>        at
</I>&gt;<i> org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(
</I>&gt;<i> *SimpleMessageListenerContainer.java:989*)
</I>&gt;<i>
</I>&gt;<i>        at java.lang.Thread.run(*Thread.java:724*)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards &#8230;*?*
</I>&gt;<i>
</I>&gt;<i> Srinath
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* rabbitmq-discuss [mailto:
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] *On Behalf Of *Srinath
</I>&gt;<i> Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at Cisco)
</I>&gt;<i> *Sent:* Wednesday, May 21, 2014 11:00 AM
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *To:* Discussions about RabbitMQ
</I>&gt;<i> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
</I>&gt;<i> seconds interval - in Consumer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It works perfect thank you so much J
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards &#8230;*?*
</I>&gt;<i>
</I>&gt;<i> Srinath
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* rabbitmq-discuss [
</I>&gt;<i> mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>&gt;] *On Behalf Of *Gary Russell
</I>&gt;<i> *Sent:* Tuesday, May 20, 2014 12:48 PM
</I>&gt;<i> *To:* Discussions about RabbitMQ
</I>&gt;<i> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
</I>&gt;<i> seconds interval - in Consumer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> To configure the retry advice in XML, you need to wire up
</I>&gt;<i> a StatefulRetryOperationsInterceptorFactoryBean.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It needs a RetryTemplate (RetryOperations) bean which needs a RetryPolicy
</I>&gt;<i> and BackOffPolicy beans.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Then wire the factory bean into the advice chain.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> To set the message id, it depends on how you are sending messages; you can
</I>&gt;<i> set it directly, or if you are using message conversion, set
</I>&gt;<i> the createMessageIds to true on the outbound template's
</I>&gt;<i> SimpleMessageConverter.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> However, when using long backoffs like that, there's not much benefit in
</I>&gt;<i> using stateful retry.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, May 20, 2014 at 3:29 PM, Srinath Sridharan -X (srinatsr - ZENSAR
</I>&gt;<i> TECHNOLOGIES INC at Cisco) &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srinatsr at cisco.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Thanks  do you have xml version of the following?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I need to set message id before publishing the message?  How to do this?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards &#8230;*?*
</I>&gt;<i>
</I>&gt;<i> Srinath
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* rabbitmq-discuss [mailto:
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] *On Behalf Of *Gary Russell
</I>&gt;<i> *Sent:* Tuesday, May 20, 2014 12:24 PM
</I>&gt;<i> *To:* Discussions about RabbitMQ
</I>&gt;<i> *Subject:* Re: [rabbitmq-discuss] Retry Message for 3 times with 10
</I>&gt;<i> seconds interval - in Consumer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> @Bean
</I>&gt;<i>
</I>&gt;<i> public MethodInterceptor retryAdvice() {
</I>&gt;<i>
</I>&gt;<i>      FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
</I>&gt;<i>
</I>&gt;<i>      backOffPolicy.setBackOffPeriod(10000);;
</I>&gt;<i>
</I>&gt;<i>      return RetryInterceptorBuilder.stateful()
</I>&gt;<i>
</I>&gt;<i>           .backOffPolicy(backOffPolicy)
</I>&gt;<i>
</I>&gt;<i>           .maxAttempts(3)
</I>&gt;<i>
</I>&gt;<i>           .recoverer(new RejectAndDontRequeueRecoverer())
</I>&gt;<i>
</I>&gt;<i>           .build();
</I>&gt;<i>
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Add it to the adviceChain property of the SimpleMessageListenerContainer.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Note: stateful retry requires the message to have a message id; use a
</I>&gt;<i> stateless advice otherwise.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> After the retries are exhausted, the message will be rejected (and dropped
</I>&gt;<i> or sent to a Dead Letter Exchange of so configured).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, May 20, 2014 at 3:09 PM, Srinath Sridharan -X (srinatsr - ZENSAR
</I>&gt;<i> TECHNOLOGIES INC at Cisco) &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srinatsr at cisco.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I am consuming the messages using the listener as follows,  I need to
</I>&gt;<i> retry processing three times if any exceptions occurred.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &lt;bean
</I>&gt;<i>
</I>&gt;<i>         class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer&quot;*
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;connectionFactory&quot;* ref=*&quot;connectionFactory&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;queueNames&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>             &lt;array&gt;
</I>&gt;<i>
</I>&gt;<i>                 &lt;value&gt;validateRequestQueue&lt;/value&gt;
</I>&gt;<i>
</I>&gt;<i>             &lt;/array&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;property name=*&quot;messageListener&quot;*&gt;
</I>&gt;<i>
</I>&gt;<i>             &lt;bean
</I>&gt;<i>
</I>&gt;<i>                 class=
</I>&gt;<i> *&quot;org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter&quot;*
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>                 &lt;property name=*&quot;delegate&quot;* ref=*&quot;retryConsumer&quot;* /&gt;
</I>&gt;<i>
</I>&gt;<i>             &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;/property&gt;
</I>&gt;<i>
</I>&gt;<i>         &lt;!-- &lt;property name=&quot;acknowledgeMode&quot; value=&quot;NONE&quot; /&gt; --&gt;
</I>&gt;<i>
</I>&gt;<i>     &lt;/bean&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *public* *class* RetryConsumer *implements* ChannelAwareMessageListener {
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>        /**
</I>&gt;<i>
</I>&gt;<i>        * Callback for processing a received Rabbit message.
</I>&gt;<i>
</I>&gt;<i>        * *@param* message the received AMQP message
</I>&gt;<i>
</I>&gt;<i>        * *@param* channel the underlying Rabbit Channel
</I>&gt;<i>
</I>&gt;<i>        * *@throws* Exception
</I>&gt;<i>
</I>&gt;<i>         */
</I>&gt;<i>
</I>&gt;<i>        @Override
</I>&gt;<i>
</I>&gt;<i>        *public* *void* onMessage(Message message, Channel channel)
</I>&gt;<i> *throws* Exception {
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>              System.*out*.println(&quot;Received Message :: &quot;+*new*
</I>&gt;<i> String(message.getBody()));
</I>&gt;<i>
</I>&gt;<i>              *if*(*true*){
</I>&gt;<i>
</I>&gt;<i>              *throw* *new* RuntimeException(&quot;Error&quot;);
</I>&gt;<i>
</I>&gt;<i>              }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>        }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards &#8230;*?*
</I>&gt;<i>
</I>&gt;<i> Srinath
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Srinath Sridharan -X (srinatsr - ZENSAR TECHNOLOGIES INC at
</I>&gt;<i> Cisco)
</I>&gt;<i> *Sent:* Monday, May 19, 2014 10:47 AM
</I>&gt;<i> *To:* <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> *Subject:* Retry Message for 3 times with 10 seconds interval - in
</I>&gt;<i> Consumer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Retry unacknowledged RabbitMQ message in 10 second interval
</I>&gt;<i>
</I>&gt;<i> And Retry 3 times using Spring framework in java .
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Please need help on this
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards &#8230;*?*
</I>&gt;<i>
</I>&gt;<i> Srinath
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/9a9b6a12/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140529/9a9b6a12/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="036320.html">[rabbitmq-discuss] FW: Retry Message for 3 times with 10 seconds interval - in Consumer
</A></li>
	<LI>Next message: <A HREF="036097.html">[rabbitmq-discuss] RetryTemplate I need 3 retries
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#36337">[ date ]</a>
              <a href="thread.html#36337">[ thread ]</a>
              <a href="subject.html#36337">[ subject ]</a>
              <a href="author.html#36337">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
