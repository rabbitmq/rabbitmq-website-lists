<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Draft of C++ rabbitMq API
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%3D%3Fwindows-1251%3Fq%3FDraft_of_C%2B%2B_rabbitMq_API%3F%3D&In-Reply-To=4B8EEAC6.8030300%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006543.html">
   <LINK REL="Next"  HREF="006512.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Draft of C++ rabbitMq API</H1>
    <B>Alexandre Kalendarev</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%3D%3Fwindows-1251%3Fq%3FDraft_of_C%2B%2B_rabbitMq_API%3F%3D&In-Reply-To=4B8EEAC6.8030300%40lshift.net"
       TITLE="[rabbitmq-discuss] Draft of C++ rabbitMq API">akalend at mail.ru
       </A><BR>
    <I>Thu Mar  4 15:49:16 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006543.html">[rabbitmq-discuss] Draft of C++ rabbitMq API
</A></li>
        <LI>Next message: <A HREF="006512.html">[rabbitmq-discuss] Queue slow to come up with a lot of messages	stored on disk w/ bug21637 branch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6547">[ date ]</a>
              <a href="thread.html#6547">[ thread ]</a>
              <a href="subject.html#6547">[ subject ]</a>
              <a href="author.html#6547">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>the new version of draft:

the Draft of C++ API

Connection class

class AMQP {
	AMQP();
	AMQP( string connectionString );
	AMQP( string connectionString , int channelNumber);
	
	void Open( string connectionString );
	void Open( string connectionString , int channelNumber);
	
	void Close();
	
	setChannel(int channelNumber);

	AMQPExchange 	createQueue( );
	AMQPExchange 	createQueue(int channelNumber );
	AMQPExchange 	createQueue( string  queueName);	
	AMQPExchange 	createQueue( const char *  queueName);
	AMQPExchange 	createQueue( string  queueName, int channelNumber);	
	AMQPExchange 	createQueue( const char *  queueName, int channelNumber);

	AMQPQueue 	createExchange();
	AMQPQueue 	createExchange(int channelNumber);
	AMQPQueue 	createExchange(string  exchangeName);
	AMQPQueue 	createExchange(const char *  exchangeName);
	AMQPQueue 	createExchange(string  exchangeName, int channelNumber);
	AMQPQueue 	createExchange( const char *  exchangeName, int channelNumber);

}

const AMQPCnnDebug = &quot;localhost:5672&quot;

the example:

	AMQP amqp(&quot;guest:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">guest at localhost</A>:5673/somevhost&quot;);
	AMQPExchange * exchange = amgp.createExchange();  

	
	default connection string is &quot;localhost:5672&quot;
	the debug connection string   AMQPCnnDebug  is &quot;guest:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">guest at localhost</A>:5673&quot; 

	AMQP amqp( AMQPCnnDebug );


Exchange class

class AMQPExchange {
	AMQPExchange( AMQPConnection * cnn );
	
	void Declare(string name);
	void Declare(string name, int parms);
	void Declare(string name, int parms, map properties ); // *)?

	void Delete(string name)

	void Bind ( string queueName );
	void Bind ( string queueName , string key);

	void Ubind ( string queueName );
	void Ubind ( string queueName , string key);

	void Publish(  string message);
	void Publish(  uchar* message);
	void Publish(  string message, const char * key);
	void Publish(  uchar* message, const char * key);

}


the parms is set of constants as AMQPDurable, AMQPAutodelete etc
the type of exchange is AMQPDirect default or AMQPFanout, or AMQPTopic 


Example:
	AMQP amqp();
	AMQPExchange * ex = amqp.createExchange();
	ex-&gt;Declare(&quot;my_exchange&quot;);
or:
	AMQP amqp();
	AMQPExchange * ex = amqp.createExchange(&quot;my_exchange&quot;); // if exchange &quot;my_exchange&quot; alredy declared.
	ex-&gt;Bind(&quot;qu1&quot;, &quot;spb.news&quot;);



Queue class

class AMQPQueue {
	AMQPQueue(AMQPConnection * cnn);

	void Declare(string name);
	void Declare(string name, int parms);
	void Declare(string name, int parms, map properties ); // *)?

	void Delete(string name)

	void Purge (string name)

	void Bind ( string exchangeName );
	void Bind ( string exchangeName , string key);

	void Ubind ( string exchangeName );
	void Ubind ( string exchangeName , string key);

	void Cancel()


	AMQPMessage *  Get()
	AMQPMessage *  Get( string queueName)

	void Ask( ) 
	void Ask( string queueName ) ????

	void Reject(  ) ????
	void Reject( string queueName )

	void addEvents( enum eventName,  IAMQPEvents events );

	void Consume( );
	void Consume( string queueName , IAMQPEvents * callback );
}


the parms is set of constants as AMQPDurable, AMQPAutodelete etc


example:
	AMQP amqp();
	AMQPEQueue * qu = amqp.createQueue();
	qu-&gt;Declare(&quot;qu_mylife&quot;);




class AMQPMessage  ????
 int timestamp
 int expiration
 string contentType
 string deliveryTag
 uchar* message or string 
 int number // internal number message
 string exchange 
 string key
....

 AMQPEvents is the abstract class, the callbackName is derived from IAMQPEvent.

after received each the message call the method run of derived AMQPCallback base class.


*) properties is map of addional property, it will to resolve in future.

Examples:

	// publish message	
	AMQP amqp();

	AMQPExchange * ex = amqp.createExchange();
	ex-&gt;Declare(&quot;my_exchange&quot;, AMQPTopic);	
	ex-&gt;Bind(&quot;my_exchange&quot;, &quot;qu_mylive&quot;, &quot;news&quot; );
	ex-&gt;Publish(&quot;my_exchange&quot;, &quot;12345&quot; , &quot;news&quot;);

	// deteting ex will after exit from scope of amqp variable;


	// consume message
	class printMessage : IAMQPEvents {
		void run (uchar* message) {
			std::cout &lt;&lt; message &lt;&lt; std::endl;
		}
	}
	
	AMQP amqp();

	AMQPQueue * queue = amqp.createQueue(&quot;qu_mylive&quot;);
	queue-&gt;addEvent(AMQPonMessage, printMessage);	
	queue-&gt;Consume( pm); 



unrealise classes(it will to resolve in future):  AMQPFile, AMQPStreams etc ...

exceptions:

AMQPnoConnectException
AMQPnonAutorizeException
AMQPnotFoundException 
AMQPnotAllowedException 
...
AMQPerrorException (AMQPcommandInvalidException  )








Hi Alexandre,
&gt;<i> 
</I>&gt;<i> Thanks for this, it's a great start.
</I>&gt;<i> 
</I>&gt;<i> Alexandre Kalendarev wrote:
</I>&gt;<i> &gt; Exchange class
</I>&gt;<i> &gt; class AMQPExchange {
</I>&gt;<i> &gt; 	AMQPExchange( AMQPConnection * cnn );
</I>&gt;<i> &gt; 	void Declare(string name);
</I>&gt;<i> &gt; 	void Declare(string name, int parms);
</I>&gt;<i> &gt; 	void Declare(string name, int parms, map properties ); // *)?
</I>&gt;<i> &gt; 	void Delete(string name)
</I>&gt;<i> &gt; }
</I>&gt;<i> 
</I>&gt;<i> The only question I have is why these are classes. I would have expected
</I>&gt;<i> &quot;factory&quot; methods such as Declare to live on AMQPConnection itself. (Do
</I>&gt;<i> you intend, by the way, to support multiple channels per connection? I
</I>&gt;<i> can't say I recommend it, but for some scenarios it's probably pretty
</I>&gt;<i> useful.)
</I>&gt;<i> 
</I>&gt;<i> I would have expected something more like:
</I>&gt;<i> 
</I>&gt;<i> class AMQPConnection {
</I>&gt;<i>   ...
</I>&gt;<i>   AMQPExchange *ExchangeDeclare( ... );
</I>&gt;<i>   AMQPQueue *QueueDeclare( ... );
</I>&gt;<i>   ...
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> class AMQPExchange {
</I>&gt;<i>   void Delete();
</I>&gt;<i>   void Publish(string routingKey, ...);
</I>&gt;<i> 
</I>&gt;<i>   string getName();
</I>&gt;<i>   // etc
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> I'm afraid my C++ years are approximately a decade behind me, so please
</I>&gt;<i> don't read my suggestions too literally :-) It'll take me a while to get
</I>&gt;<i> back up to speed with what's considered good modern C++ style...
</I>&gt;<i> 
</I>&gt;<i> (Also, could AMQPExchange be a valuetype? It's pretty tiny, it's
</I>&gt;<i> stateless, and it'd be nice to avoid memory-management headaches where
</I>&gt;<i> possible.)
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i>   Tony
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006543.html">[rabbitmq-discuss] Draft of C++ rabbitMq API
</A></li>
	<LI>Next message: <A HREF="006512.html">[rabbitmq-discuss] Queue slow to come up with a lot of messages	stored on disk w/ bug21637 branch
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6547">[ date ]</a>
              <a href="thread.html#6547">[ thread ]</a>
              <a href="subject.html#6547">[ subject ]</a>
              <a href="author.html#6547">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
