<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consumer stop to receive messages but	continue listening queue problem.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Consumer%20stop%20to%20receive%20messages%20but%0A%09continue%20listening%20queue%20problem.&In-Reply-To=20100312144412.GC25615%40mrnibble.lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006634.html">
   <LINK REL="Next"  HREF="006639.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consumer stop to receive messages but	continue listening queue problem.</H1>
    <B>Gustavo Aquino</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Consumer%20stop%20to%20receive%20messages%20but%0A%09continue%20listening%20queue%20problem.&In-Reply-To=20100312144412.GC25615%40mrnibble.lshift.net"
       TITLE="[rabbitmq-discuss] Consumer stop to receive messages but	continue listening queue problem.">aquino.gustavo at gmail.com
       </A><BR>
    <I>Fri Mar 12 15:47:37 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006634.html">[rabbitmq-discuss] Consumer stop to receive messages but continue listening queue problem.
</A></li>
        <LI>Next message: <A HREF="006639.html">[rabbitmq-discuss] Consumer stop to receive messages but	continue listening queue problem.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6637">[ date ]</a>
              <a href="thread.html#6637">[ thread ]</a>
              <a href="subject.html#6637">[ subject ]</a>
              <a href="author.html#6637">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthew,

On Fri, Mar 12, 2010 at 11:44 AM, Matthew Sackman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at lshift.net</A>&gt;wrote:

&gt;<i> On Fri, Mar 12, 2010 at 11:21:44AM -0300, Gustavo Aquino wrote:
</I>&gt;<i> &gt; On Fri, Mar 12, 2010 at 9:24 AM, Matthew Sackman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at lshift.net</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; &gt; On Fri, Mar 12, 2010 at 12:00:52AM -0300, Gustavo Aquino wrote:
</I>&gt;<i> &gt; &gt; &gt; I'm running my RabbitMQ in one server, and have 2 producers in other
</I>&gt;<i> &gt; &gt; server
</I>&gt;<i> &gt; &gt; &gt; posting ~2000 messages /s , and have 4 consumers in one server and
</I>&gt;<i> other
</I>&gt;<i> &gt; &gt; 4
</I>&gt;<i> &gt; &gt; &gt; in other.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sorry but I don't understand why we have 4kHz in total.
</I>&gt;<i>
</I>&gt;<i> 2kHz * 2. Maybe you were giving cumulative rates and you meant 2kHz
</I>&gt;<i> inbound in total?
</I>&gt;<i>
</I>&gt;<i>
</I>2KhZ in total, one producer post about ~200/s and other ~2000/s but
the average is 2000/s.


&gt;<i> &gt; All 8 consumers are listening the same queue.
</I>&gt;<i>
</I>&gt;<i> Ahhh! So each consumer will receive 1/8th of the messages. Thus if we
</I>&gt;<i> have 2kHz inbound, we will now have 2kHz outbound.
</I>&gt;<i>
</I>
No, 2kHz for inbound and 4kHz for outbound, I have two queues listening the
same exchange messages but with different proposals, for each queue I have 8
consumer so I have 8 consumers for queue1 and 8 for queue2 and 2 producers
for Exchange1.



&gt;<i>
</I>&gt;<i> &gt; &gt; Also, when this happens, what does Rabbit record in the logs?
</I>&gt;<i>
</I>&gt;<i> ?
</I>&gt;<i>
</I>
Nothing, I don't see nothing in logs, just INFO tasks about open and close
connections.


&gt;<i> &gt; This is the point, I think that we will be the first in this environment,
</I>&gt;<i> I
</I>&gt;<i> &gt; tried to found some experiences in Internet but don't found nothing. I'm
</I>&gt;<i> &gt; using Erlang R12 yes I know it's very old, but RH have only this version
</I>&gt;<i> &gt; compiled for ppc, I'm trying to install R13B but having some compiling
</I>&gt;<i> &gt; problems with ncourses, but It's other e-mail :).
</I>&gt;<i>
</I>&gt;<i> You should be able to compile erlang without requiring ncurses, but
</I>&gt;<i> you'd at least have to provided a number of extra flags to configure.
</I>&gt;<i>
</I>
I'm trying to found it, or do you know what version of ncourses Erlang13
need ? I have ncourses installed but configure don't recognize it.

&gt;<i>
</I>&gt;<i> &gt; Sorry, I put wrong values, my fault, My message size have 180 Bytes ~
</I>&gt;<i> &gt; 1Kbytes.
</I>&gt;<i>
</I>&gt;<i> Right, so we've gone from world-beating network performance to about
</I>&gt;<i> 2MB/s. :D
</I>&gt;<i>
</I>
Yes for inbound,  for outbound ~4MB/s. About network performance I had
1gbit between this environments, and will test fiber channel. But we had
monitoring network and get average 40% of utilization.

&gt;<i>
</I>&gt;<i> &gt; And all in the same queue. Another information Rabbit always crash
</I>&gt;<i> &gt; with queue size get Rabbit's memory limit I try to found but don't see a
</I>&gt;<i> way
</I>&gt;<i> &gt; to configure queue to drop messages after a specific size or memory
</I>&gt;<i> limit.
</I>&gt;<i>
</I>&gt;<i> What is the crash message, what are the entries in Rabbit's logs?
</I>&gt;<i>
</I>&gt;<i> Last time that I do this test I just found this error.Some times Rabbit
</I>stop to response and we need to kill him.

=CRASH REPORT==== 10-Mar-2010::08:12:53 ===
  crasher:
    initial call: application_master:init/4
    pid: &lt;0.103.0&gt;
    registered_name: []
    exception exit: {{timeout_waiting_for_tables,
                         [rabbit_user,rabbit_user_permission,rabbit_vhost,

 rabbit_config,rabbit_listener,rabbit_durable_route,
                          rabbit_route,rabbit_reverse_route,
                          rabbit_durable_exchange,rabbit_exchange,
                          rabbit_durable_queue,rabbit_queue]},
                     {rabbit,start,[normal,[]]}}
      in function  application_master:init/4
    ancestors: [&lt;0.102.0&gt;]
    messages: [{'EXIT',&lt;0.104.0&gt;,normal}]
    links: [&lt;0.102.0&gt;,&lt;0.7.0&gt;]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 116
  neighbours:



&gt;<i> Matthew
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100312/c05df6e1/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100312/c05df6e1/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006634.html">[rabbitmq-discuss] Consumer stop to receive messages but continue listening queue problem.
</A></li>
	<LI>Next message: <A HREF="006639.html">[rabbitmq-discuss] Consumer stop to receive messages but	continue listening queue problem.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6637">[ date ]</a>
              <a href="thread.html#6637">[ thread ]</a>
              <a href="subject.html#6637">[ subject ]</a>
              <a href="author.html#6637">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
