<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Stop producer and queue continue growing...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Stop%20producer%20and%20queue%20continue%20growing...&In-Reply-To=20100312145826.GD25615%40mrnibble.lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006635.html">
   <LINK REL="Next"  HREF="006656.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Stop producer and queue continue growing...</H1>
    <B>Gustavo Aquino</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Stop%20producer%20and%20queue%20continue%20growing...&In-Reply-To=20100312145826.GD25615%40mrnibble.lshift.net"
       TITLE="[rabbitmq-discuss] Stop producer and queue continue growing...">aquino.gustavo at gmail.com
       </A><BR>
    <I>Fri Mar 12 16:03:55 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006635.html">[rabbitmq-discuss] Stop producer and queue continue growing...
</A></li>
        <LI>Next message: <A HREF="006656.html">[rabbitmq-discuss] Stop producer and queue continue growing...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6638">[ date ]</a>
              <a href="thread.html#6638">[ thread ]</a>
              <a href="subject.html#6638">[ subject ]</a>
              <a href="author.html#6638">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthew,


On Fri, Mar 12, 2010 at 11:58 AM, Matthew Sackman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at lshift.net</A>&gt;wrote:

&gt;<i> On Fri, Mar 12, 2010 at 11:36:31AM -0300, Gustavo Aquino wrote:
</I>&gt;<i> &gt; This is my biggest concern.
</I>&gt;<i>
</I>&gt;<i> It's the nature of AMQP.
</I>&gt;<i>
</I>&gt;<i> &gt; Look about this scenario I have one Exchange and one persistent queue.I'm
</I>&gt;<i> &gt; posting transient messages to this Exchange (to get better performance)
</I>&gt;<i> if
</I>&gt;<i> &gt; my Exchanges messages are in buffer and server crash I will be loose all
</I>&gt;<i> &gt; messages in buffer and it is a big problem.... I cannot lose any
</I>&gt;<i> messages,
</I>&gt;<i>
</I>&gt;<i> Not true. There is no messaging product available (nor will there ever
</I>&gt;<i> be) that can guarantee it can't lose messages. Do you have infinite disk
</I>&gt;<i> space? Is there no event that can cause power loss? Even in the event of
</I>&gt;<i> the sun exploding you want to ensure no message loss?
</I>&gt;<i>
</I>
If sun exploding money will be the minor problem of us. ;-)

We don't have infinite disk space, but the primary proposal is monitoring to
be able to be pro active and do something before problem happen.

Look,for example I'm monitoring queue size, and look that we are coming to
our limit, one way to guarantee the messages inside server is stopping
producers and redirect producers to other server, so in theory I can
guarantee that messages inside server1 will be consumed and server not loose
messages or crash.


Or how to guarantee that one message posted will be consumed ? consume don't
know about the message posted.


&gt;<i>
</I>&gt;<i> The fact is, message loss is unavoidable. You can take many steps to
</I>&gt;<i> avoid this, by using transactions and buffering messages in the client
</I>&gt;<i> so that if the connection to the broker dies you can reconnect and
</I>&gt;<i> republish, but at that point you risk duplicates, so you need
</I>&gt;<i> application logic on the consumer side to watch for duplicates and
</I>&gt;<i> remove them as necessary.
</I>&gt;<i>
</I>&gt;<i> &gt; this messages are business it represent money, so if I loose one we loose
</I>&gt;<i> &gt; money and It cannot happen, in other way I need to be the fastest we
</I>&gt;<i> &gt; need overrides in nanoseconds or 1 millisecond is the limit, so post
</I>&gt;<i> &gt; messages in persistent queue is out of the scope, or  have one way to be
</I>&gt;<i> &gt; fast with persistent ?
</I>&gt;<i>
</I>&gt;<i> Right, so you can't afford the delay of writing to disk, and yet you
</I>&gt;<i> want to ensure messages can't be lost in the event of a crash, or
</I>&gt;<i> comet strike. You may wish then to explore multiple brokers, publish, in
</I>&gt;<i> transactions to duplicate resources (queues) on every broker, and then
</I>&gt;<i> simultaneously consume from all of them, deduplicating as you go. Thus
</I>&gt;<i> you don't need to write to disk, and by shear strength of numbers, you
</I>&gt;<i> should be able to survive crashes. However, really these various brokers
</I>&gt;<i> should be in different data centres, probably on different continents,
</I>&gt;<i> so the 1ms max delay may be challenging...
</I>&gt;<i>
</I>
How to duplicate resources inside multiples brokers using Rabbitmq ? I saw
that Rabbit don't have a default way to do a Cluster HA, your based proposal
is HP.


&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100312/91a1092b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100312/91a1092b/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006635.html">[rabbitmq-discuss] Stop producer and queue continue growing...
</A></li>
	<LI>Next message: <A HREF="006656.html">[rabbitmq-discuss] Stop producer and queue continue growing...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6638">[ date ]</a>
              <a href="thread.html#6638">[ thread ]</a>
              <a href="subject.html#6638">[ subject ]</a>
              <a href="author.html#6638">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
