<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Duplicate Messages received after	basicRecoveryAsync() is called.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Duplicate%20Messages%20received%0A%20after%09basicRecoveryAsync%28%29%20is%20called.&In-Reply-To=A2F999AF-2AD9-4910-9036-1983B90C8B46%40versatile.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006533.html">
   <LINK REL="Next"  HREF="006535.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Duplicate Messages received after	basicRecoveryAsync() is called.</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Duplicate%20Messages%20received%0A%20after%09basicRecoveryAsync%28%29%20is%20called.&In-Reply-To=A2F999AF-2AD9-4910-9036-1983B90C8B46%40versatile.com"
       TITLE="[rabbitmq-discuss] Duplicate Messages received after	basicRecoveryAsync() is called.">matthias at lshift.net
       </A><BR>
    <I>Wed Mar  3 13:00:10 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006533.html">[rabbitmq-discuss] Duplicate Messages received after	basicRecoveryAsync() is called.
</A></li>
        <LI>Next message: <A HREF="006535.html">[rabbitmq-discuss] Duplicate Messages received after	basicRecoveryAsync() is called.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6534">[ date ]</a>
              <a href="thread.html#6534">[ thread ]</a>
              <a href="subject.html#6534">[ subject ]</a>
              <a href="author.html#6534">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>John,

John Mann wrote:
&gt;<i> I had no luck with calling basicCancel() and then waiting for the 
</I>&gt;<i> handleCancelOK() method to be called.  I realized after stepping through 
</I>&gt;<i> the source with a debugger that a Channel disassociates the Consumer 
</I>&gt;<i> when basicCancel() is called:
</I>&gt;<i> 
</I>&gt;<i> ChannelN.java: line 645:
</I>&gt;<i> 
</I>&gt;<i>                 Consumer callback = _consumers.remove(consumerTag);
</I>
That codes is part of an rpc continuation. It gets called when the 
cancel-ok arrives, and the call to handleCancelOk happens right after 
the above line.

&gt;<i> The only way that I knew I could reestablish this association was by 
</I>&gt;<i> calling Channel.basicConsume().  Unfortunately this didn't work. 
</I>&gt;<i>  Messages after that point were never delivered.  
</I>
Here is the sequence of client actions I proposed:

1) send basic.cancel
2) wait for basic.cancel-ok
3) send basic.recover
4) send basic.consume

So you do indeed need a basic.consume to re-establish the consumer.

One needs to be very careful with the threading here though. For 
example, the basic.consume must not be issued from the handleCancelOk 
callback. Doing so would most likely cause a deadlock. Perhaps that's 
what you were seeing.

Anyway, I'm glad the channel close/re-open works as expected.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006533.html">[rabbitmq-discuss] Duplicate Messages received after	basicRecoveryAsync() is called.
</A></li>
	<LI>Next message: <A HREF="006535.html">[rabbitmq-discuss] Duplicate Messages received after	basicRecoveryAsync() is called.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6534">[ date ]</a>
              <a href="thread.html#6534">[ thread ]</a>
              <a href="subject.html#6534">[ subject ]</a>
              <a href="author.html#6534">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
