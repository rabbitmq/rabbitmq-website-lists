<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] High Availability
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20High%20Availability&In-Reply-To=37F6F302-4420-4B9C-8DE1-0607CD6C47A0%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006687.html">
   <LINK REL="Next"  HREF="006698.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] High Availability</H1>
    <B>Mark Steele</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20High%20Availability&In-Reply-To=37F6F302-4420-4B9C-8DE1-0607CD6C47A0%40gmail.com"
       TITLE="[rabbitmq-discuss] High Availability">msteele at beringmedia.com
       </A><BR>
    <I>Fri Mar 19 19:32:15 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006687.html">[rabbitmq-discuss] High Availability
</A></li>
        <LI>Next message: <A HREF="006698.html">[rabbitmq-discuss] High Availability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6688">[ date ]</a>
              <a href="thread.html#6688">[ thread ]</a>
              <a href="subject.html#6688">[ subject ]</a>
              <a href="author.html#6688">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If you are looking for high availability, the only way that I am aware of is
to use something like DRBD (or SAN backed storage) along with a cluster
resource manager (eg: corosync/heartbeat/etc) and make all your messages
durable and persist to disk.

You can then scale clusters (eg multiple 2-node clusters) for reaching scale
using Erlang's native cluster capabilities without sacrificing on high
availability. A load balancer won't help with HA unless you have some
mechanism for ensuring messages replicate between nodes.

Mark Steele
Director of development
Bering Media Inc.



On Fri, Mar 19, 2010 at 1:38 AM, Alvaro Videla &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">videlalvaro at gmail.com</A>&gt;wrote:

&gt;<i> Gustavo,
</I>&gt;<i>
</I>&gt;<i> 1) We haven't benchmarked the overhead of using LVS
</I>&gt;<i>
</I>&gt;<i> 2) As you can find out from our numbers, not that much, and it's hard to
</I>&gt;<i> tell, since during peak time we have 20.000 concurrent users, but maybe in
</I>&gt;<i> the morning the are only 5000. And at the end it depends on what they do on
</I>&gt;<i> the site. Soon we plan to add other 300.000 messages a day.
</I>&gt;<i>
</I>&gt;<i> 3) The queues are persistent.
</I>&gt;<i>
</I>&gt;<i> This means that if one node is out of the LVS, anyway we can reach that
</I>&gt;<i> node by it's exact IP. In our setup that node won't receive more messages
</I>&gt;<i> &#8211;because the publishers connect to the LVS IP&#8211;, but we are able to consume
</I>&gt;<i> the old ones.
</I>&gt;<i>
</I>&gt;<i> 4) We don't share storage. 1 message will go to one queue, there's no
</I>&gt;<i> replication. The sysadmin is working on solving that. I prefer to try
</I>&gt;<i> something &quot;native&quot; i.e.: provided or implemented inside RabbitMQ. He's
</I>&gt;<i> researching some Linux technologies for filesystems.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Alvaro
</I>&gt;<i>
</I>&gt;<i> P. S. My second name is Gustavo, so this feels like replying to myself :)
</I>&gt;<i>
</I>&gt;<i> On Mar 18, 2010, at 11:59 PM, Gustavo Aquino wrote:
</I>&gt;<i>
</I>&gt;<i> Alvaro,
</I>&gt;<i>
</I>&gt;<i> Thank you so much to report your experience.
</I>&gt;<i>
</I>&gt;<i> I will take a look about LVM now.. so I would like to do some questions
</I>&gt;<i> that I'm in doubt about your solution. Do you know what is the overhead
</I>&gt;<i> using LVM ? How many messages per second do you have ? Do you use a
</I>&gt;<i> persistent queue ? If yes how did you to continue consume queue when one
</I>&gt;<i> node is down ?
</I>&gt;<i>
</I>&gt;<i> You are using a heartbeat, so how you share inter nodes the same disk ? NFS
</I>&gt;<i> ? Storage ?
</I>&gt;<i>
</I>&gt;<i> Thank you so much for your report it helps a lot.
</I>&gt;<i>
</I>&gt;<i> Best wishes.
</I>&gt;<i>
</I>&gt;<i> On Thu, Mar 18, 2010 at 12:17 PM, Alvaro Videla &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">videlalvaro at gmail.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Sorry, It's me again, forgot to add something :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That LVS setup was live tested when we got the dreaded out of memory
</I>&gt;&gt;<i> problem, when the Erlang VM just crash shutting down the RabbitMQ node. One
</I>&gt;&gt;<i> of the brokers went down, but we continued working from the other.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> After that we decided to finally upgrade our RabbitMQ server to the latest
</I>&gt;&gt;<i> version
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Mar 18, 2010 at 11:05 PM, Alvaro Videla &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">videlalvaro at gmail.com</A>&gt;wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> After some feedback by @etrepum at Twitter, I feel that what I commented
</I>&gt;&gt;&gt;<i> needs some more details, so I did some research about LVS, since that set up
</I>&gt;&gt;&gt;<i> was done by one of our sysadmins.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You can check about a LVS setup here:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> <A HREF="http://www.ibiblio.org/oswg/oswg-nightly/oswg/en_US.ISO_8859-1/articles/cluster-howto/cluster-howto/index.html">http://www.ibiblio.org/oswg/oswg-nightly/oswg/en_US.ISO_8859-1/articles/cluster-howto/cluster-howto/index.html</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> From that page:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &quot;the role of the *active router* is to redirect service requests from
</I>&gt;&gt;&gt;<i> the virtual server address to the real servers.&quot; [...]
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &quot;The active router dynamically monitors the health of the real servers,
</I>&gt;&gt;&gt;<i> and the workload on each.&quot; [...]
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &quot;If a real server becomes disabled, the active router stops sending jobs
</I>&gt;&gt;&gt;<i> to the server until it returns to normal operation.&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I hope this mails clarifies things up,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Alvaro
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Mar 18, 2010, at 7:57 PM, Gustavo Aquino wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I have done this question before for many peoples, without success,
</I>&gt;&gt;&gt;<i> because I don't found (Documentation, discussion lists and etc) any way to
</I>&gt;&gt;&gt;<i> do High Availability with RabbitMQ without a lot of workaround, so exist a
</I>&gt;&gt;&gt;<i> way to do HA with RabbitMQ without implementing a lot of stuffs by client
</I>&gt;&gt;&gt;<i> side, like recreating queues when node down, recreating configurations,
</I>&gt;&gt;&gt;<i> recreating client connections and etc ?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> What's recommendation from RabbitMQ to do HA ?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Someone here have done some HA implementation to RabbitMQ ?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Regards.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Gustavo
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100319/0eab6acc/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100319/0eab6acc/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006687.html">[rabbitmq-discuss] High Availability
</A></li>
	<LI>Next message: <A HREF="006698.html">[rabbitmq-discuss] High Availability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6688">[ date ]</a>
              <a href="thread.html#6688">[ thread ]</a>
              <a href="subject.html#6688">[ subject ]</a>
              <a href="author.html#6688">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
