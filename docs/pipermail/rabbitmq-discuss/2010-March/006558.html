<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] limit number of messages buffered in memory in new persister
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20limit%20number%20of%20messages%20buffered%20in%20memory%0A%20in%20new%20persister&In-Reply-To=4B90C908.1060308%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006556.html">
   <LINK REL="Next"  HREF="006561.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] limit number of messages buffered in memory in new persister</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20limit%20number%20of%20messages%20buffered%20in%20memory%0A%20in%20new%20persister&In-Reply-To=4B90C908.1060308%40lshift.net"
       TITLE="[rabbitmq-discuss] limit number of messages buffered in memory in new persister">matthew at lshift.net
       </A><BR>
    <I>Fri Mar  5 11:49:57 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006556.html">[rabbitmq-discuss] limit number of messages buffered in memory in new persister
</A></li>
        <LI>Next message: <A HREF="006561.html">[rabbitmq-discuss] limit number of messages buffered in memory	in new persister
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6558">[ date ]</a>
              <a href="thread.html#6558">[ thread ]</a>
              <a href="subject.html#6558">[ subject ]</a>
              <a href="author.html#6558">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Mar 05, 2010 at 09:04:08AM +0000, Matthias Radestock wrote:
&gt;<i> transactional and persistent:
</I>&gt;<i> $ sh build/dist/runjava.sh com.rabbitmq.examples.MulticastMain -m 1 -a 
</I>&gt;<i> -f persistent -i 2 -z 1
</I>&gt;<i> starting consumer #0
</I>&gt;<i> starting producer #0
</I>&gt;<i> recving rate avg: 9 msg/s
</I>&gt;<i> sending rate avg: 9 msg/s
</I>
Note this test was done on a recent ubuntu, which is running ext4 on its
fs, with barriers turned on. On my machine, Debian Sid, which runs ext3
with data=ordered, I get

recving rate avg: 487 msg/s
sending rate avg: 487 msg/s

On my machine on an SSD, which is mounted ext4 barrier=1,
data=writeback, I get

recving rate avg: 1138 msg/s
sending rate avg: 1138 msg/s

On another ubuntu karmic box, with ext3, we get

recving rate avg: 220 msg/s
sending rate avg: 220 msg/s

all on the same test.

Also it's a good idea to make sure the disk schedular is set to
deadline, not cfq, as it normally is by default. You also really want to
stop anything else from writing to disk, and turn of CPU Frequency
Scaling. Basically, give Rabbit its own disk, and very carefully tune
and test. You may have good results with the latest btrfs too, depends
how bleeding edge you want to be. As you can see, SSD performance is
astonishing, because fsyncs on SSDs are constant time and an order of
magnitude faster than rotating media.

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006556.html">[rabbitmq-discuss] limit number of messages buffered in memory in new persister
</A></li>
	<LI>Next message: <A HREF="006561.html">[rabbitmq-discuss] limit number of messages buffered in memory	in new persister
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6558">[ date ]</a>
              <a href="thread.html#6558">[ thread ]</a>
              <a href="subject.html#6558">[ subject ]</a>
              <a href="author.html#6558">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
