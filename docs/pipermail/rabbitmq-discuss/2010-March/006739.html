<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] debugging an unroutable message
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20debugging%20an%20unroutable%20message&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006753.html">
   <LINK REL="Next"  HREF="006747.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] debugging an unroutable message</H1>
    <B>Daniel Risacher</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20debugging%20an%20unroutable%20message&In-Reply-To="
       TITLE="[rabbitmq-discuss] debugging an unroutable message">magnus at alum.mit.edu
       </A><BR>
    <I>Mon Mar 29 09:03:22 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006753.html">[rabbitmq-discuss] &quot;Returning&quot; values
</A></li>
        <LI>Next message: <A HREF="006747.html">[rabbitmq-discuss] debugging an unroutable message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6739">[ date ]</a>
              <a href="thread.html#6739">[ thread ]</a>
              <a href="subject.html#6739">[ subject ]</a>
              <a href="author.html#6739">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here's my use case:  controlling (1 or more) daemons via multiple user
interfaces, e.g. web, command-line, etc.

1. At startup, the daemon(s) declares a queue bound to a fanout
exchange ('brokaw') to listen for broadcast messages from clients.

2. When run, the command-line client creates a queue to listen for
replies, and binds it to amq.direct with a routing key equal to the
queue name (which I let the server generate).

3. Command-line client sends a 'PING' message to the 'brokaw'
exchange, with reply-to set to the name of its reply queue.

4. Daemon gets the 'PING' message

4.5 Daemon responds with a 'PONG' to amq.direct with the routing_key
set to the reply-to field.

5. Command-line client waits around for eh, 500ms for a response,
dumps result to console and exits.

(All coded in perl, with POE::Component::Client::AMQP.)

Here's the bug symptom- it strictly alternates between working and not
working.  Works the first time, not the second, etc.   When it doesn't
work, the daemon gets the PING, but the PONG is returned as
unroutable.

Here's the dump of the return frame:
--- !!perl/hash:Net::AMQP::Frame::Method
channel: 1
method_frame: !!perl/hash:Net::AMQP::Protocol::Basic::Return
  exchange: amq.direct
  reply_code: 312
  reply_text: unroutable
  routing_key: amq.gen-HIi2IrPHZ8QST0+FvDDRCA==
payload: ''
type_id: 1


So two questions:

First, is my architecture screwed up? (Esp. am I misusing amq.direct?)
Second, how can I debug this ?  How do I tell *why* it returns unroutable?


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006753.html">[rabbitmq-discuss] &quot;Returning&quot; values
</A></li>
	<LI>Next message: <A HREF="006747.html">[rabbitmq-discuss] debugging an unroutable message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6739">[ date ]</a>
              <a href="thread.html#6739">[ thread ]</a>
              <a href="subject.html#6739">[ subject ]</a>
              <a href="author.html#6739">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
