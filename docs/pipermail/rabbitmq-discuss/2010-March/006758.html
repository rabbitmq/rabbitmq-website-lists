<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] New RabbitMQ Groovy DSL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20New%20RabbitMQ%20Groovy%20DSL&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006757.html">
   <LINK REL="Next"  HREF="006759.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] New RabbitMQ Groovy DSL</H1>
    <B>Jon Brisbin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20New%20RabbitMQ%20Groovy%20DSL&In-Reply-To="
       TITLE="[rabbitmq-discuss] New RabbitMQ Groovy DSL">jon.brisbin at npcinternational.com
       </A><BR>
    <I>Wed Mar 31 21:49:57 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006757.html">[rabbitmq-discuss] basic_qos(prefetch_count=1) NOT_IMPLEMENTED
</A></li>
        <LI>Next message: <A HREF="006759.html">[rabbitmq-discuss] clustering question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6758">[ date ]</a>
              <a href="thread.html#6758">[ thread ]</a>
              <a href="subject.html#6758">[ subject ]</a>
              <a href="author.html#6758">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Folks,

&quot;I'm fixin' to&quot; (as we say here in the Midwest) upload some recent work I've done on a Groovy-language DSL for RabbitMQ that lets me integrate with our existing Groovy REST/MVC framework. A simple example looks like:

mq.on error: {err -&gt;
  log.error(err.message)
}, myevent: {msg -&gt;
  log.info(msg.bodyAsString)
}

// Initialization
mq {channel -&gt;
  //channel.queueDelete(&quot;test&quot;)
  //channel.exchangeDelete(&quot;test&quot;)
}

mq.exchange(name: &quot;test&quot;) {
  // Named, non-durable queue
  queue name: &quot;test&quot;, routingKey: &quot;test.key&quot;, {
    consume tag: &quot;test&quot;, onmessage: &quot;myevent&quot;
  }
  // Anonymous (server-generated) non-durable queue
  queue name: null, routingKey: &quot;test2.key&quot;, {
    consume tag: &quot;test2&quot;, onmessage: {msg -&gt;
      log.info(msg.bodyAsString)
      log.info(&quot;myHeaderValue=&quot; + msg.properties.headers[&quot;myHeaderValue&quot;])
    }
  }
  // Poke some messages
  queue routingKey: &quot;test.key&quot;, {
    publish body: &quot;this is a test&quot;
  }
  queue routingKey: &quot;test2.key&quot;, {
    publish myHeaderValue: &quot;customHeader&quot;, body: {msg, out -&gt;
      msg.properties.contentType = &quot;text/plain&quot;
      out.write(&quot;test are test bytes&quot;.bytes)
    }
  }
}


To test it, I've got a command-line utility that takes RabbitMQ connection parameters and a Groovy DSL file to operate on (it also handles stdin/stdout for piping).

Basics of the system include:

* Direct access to the channel when you need custom stuff.
* A very basic event system for dispatch error and custom application events.
* Using Groovy, I can get a lot of stuff done quickly (works great for utilities, etc...).
* On a &quot;consume&quot; closure, if you return a non-null/true result, it will keep listening for more messages (uses a QueuingConsumer). 
* On a &quot;publish&quot; node, if you specify a closure for the body, it will call() that closure, passing an output stream for you to do custom byte processing, otherwise it'll try and fit whatever you tell it into the message body (strings automagically converted, etc...).

There's more to this. This is just a simplistic example. I'll try and document some of that on my github account.

I'd be interested in some feedback. I'm wondering what might make this useful to more people than just me. I do make some assumptions about how I'm interacting with RabbitMQ because that's just how we're doing it. I'd be interested in hearing if that doesn't hold for others.

I'll post the link when I've got everything put into Git.

Jon Brisbin
Portal Webmaster
NPC International, Inc.





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006757.html">[rabbitmq-discuss] basic_qos(prefetch_count=1) NOT_IMPLEMENTED
</A></li>
	<LI>Next message: <A HREF="006759.html">[rabbitmq-discuss] clustering question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6758">[ date ]</a>
              <a href="thread.html#6758">[ thread ]</a>
              <a href="subject.html#6758">[ subject ]</a>
              <a href="author.html#6758">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
