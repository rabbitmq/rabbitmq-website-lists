<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Writing applications using AMQP,	basic design 	questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Writing%20applications%20using%20AMQP%2C%0A%09basic%20design%20%09questions&In-Reply-To=ce2570e21003031532v6f81701bh81e02dab32e783c4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006546.html">
   <LINK REL="Next"  HREF="006549.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Writing applications using AMQP,	basic design 	questions</H1>
    <B>Laurens Van Houtven</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Writing%20applications%20using%20AMQP%2C%0A%09basic%20design%20%09questions&In-Reply-To=ce2570e21003031532v6f81701bh81e02dab32e783c4%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Writing applications using AMQP,	basic design 	questions">lvh at laurensvh.be
       </A><BR>
    <I>Thu Mar  4 17:30:04 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006546.html">[rabbitmq-discuss] Writing applications using AMQP,	basic design 	questions
</A></li>
        <LI>Next message: <A HREF="006549.html">[rabbitmq-discuss] Writing applications using AMQP,	basic design 	questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6548">[ date ]</a>
              <a href="thread.html#6548">[ thread ]</a>
              <a href="subject.html#6548">[ subject ]</a>
              <a href="author.html#6548">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(Messages were cut liberally for brevity reasons.)

On Thu, Mar 4, 2010 at 12:32 AM, Garrett Smith &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">g at rre.tt</A>&gt; wrote:
&gt;<i> Are you talking about exposing your mobile apps to external users via AMQP?
</I>
Possibly. I'm definitely not considering letting the mobile users be
AMQP producers themselves for the reasons mentioned below. Whether or
not letting the monitoring users be actual AMQP consumers, or having
another abstraction layer there is a good idea, I'm not sure.

The people doing the monitoring will primarily use a webapp that does
two things:
1. Get previous data from the persistence layer (a classic webapp that
gets stuff from a database somewhere, not AMQP so not relevant to this
discussion)
2. Follow data coming in from the mobile clients live, through a Comet
implementation.

Alternatively, later, mobile apps could request this data too, but
there's no reason they couldn't use the same Comet implementation the
browsers of the webapp users do.

AMQP sounds very well suited to the latter. I'm not sure RabbitMQ's
plugins for letting browsers talk AMQP through JS. Because of the
sensitive nature of the data, I'm not sure if
rabbitmq-jsonrpc-channel/rabbitmq-jsonrpc are applicable. The
advantage of an AMQP-&gt;Comet bridge at the end (analogous to the
HTTP-&gt;AMQP bridge at the beginning) would be that I can do the same
pre-shared SSL certificate tricks for verifying and authenticating
clients.

&gt;<i> What's the nature of the public API. Is there a performance or
</I>&gt;<i> throughput requirement?
</I>
Not a particularly big one. Lots of writers, very low amount of data,
regular reporting. Think less than a hundred bytes, every ten seconds
to a minute or so, for a few hours a day, times potentially a few
thousand mobile clients.

I know making guesses about bottlenecks in complex systems is stupid
without any data to back it up, but I'm guessing the proposed
HTTPS-&gt;AMQP bridge will start running out of steam long before the
broker will. Hopefully this can be fixed by adding more of them, and
using classic load balancing ideas for web servers.

&gt;<i> Working with an AMQP interface is considerably different from working
</I>&gt;<i> with a REST or other RPC interface. If you're thinking along these
</I>&gt;<i> lines, I'd float the idea by some of your users to see what they think
</I>&gt;<i> of the approach. That's also assuming you have a technical requirement
</I>&gt;<i> to use AMQP for the public interface.
</I>
I'm mostly interested in using it for the internal interfaces for
flexibility reasons. I don't think any of the properties of AMQP
particularly interest my monitoring users (which would be AMQP
consumers if we let them speak AMQP). The mobile clients just want
their data to be persisted and possibly reported, they don't really
care what I do internally to make it happen.

&gt;&gt;<i> I'm interested in temporary queues, so that only active mobile clients
</I>&gt;&gt;<i> have queues running. I have read the AMQP specification (v0.8),
</I>&gt;&gt;<i> section 2.2.8, specifically the part about temporary queues.
</I>&gt;&gt;<i> Apparently any client can cause a queue to be created, and the client
</I>&gt;&gt;<i> creating it is responsible for creating a consumer on it.
</I>&gt;<i>
</I>&gt;<i> You can create your queues as exclusive, which tells rabbit to auto
</I>&gt;<i> delete the queue once the declaring connection is closed.
</I>
In that case, the proposed HTTPS-&gt;AMQP bridge would be responsible for
creating the mandatory consumer responsible for persistence every time
a previously inactive client starts sending data? Does that mean the
bridge has to keep the connection open? (creating a queue and
attaching a consumer sounds like an expensive operation.) That would
have implications for the load balancing I can do later.

&gt;&gt;<i> I take it that means letting the mobile clients (with untrustworthy
</I>&gt;&gt;<i> software) do AMQP is a bad idea. The first idea is to have an
</I>&gt;&gt;<i> HTTP(S)-&gt;AMQP bridge. Why?
</I>
&gt;<i> Running AMQP on mobile clients would make for a cool demo, but you're
</I>&gt;<i> thinking is sound here.
</I>
Yay! I'm not insane.

&gt;<i> In my block-and-tackle understanding, you would opt for a message
</I>&gt;<i> oriented approach for a few reasons:
</I>&gt;<i>
</I>&gt;<i> - Out-of-the-box support async application patterns
</I>
Definitely true. Everything is being powered by Twisted/txAMQP, so
everything else is already asynchronous in nature.

&gt;<i> - Latency requirements prohibit the use of expensive transports like HTTP
</I>
Internally? Sure. As long as the only HTTP latency being introduced is
that at the start (the HTTPS-&gt;AMQP bridge) and at the end (AMQP-&gt;Comet
like thing), I'm happy.

&gt;<i> - Flexibility in provisioning services
</I>
Definitely.

&gt;<i> Garrett
</I>
Thanks for your reply,
Laurens


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006546.html">[rabbitmq-discuss] Writing applications using AMQP,	basic design 	questions
</A></li>
	<LI>Next message: <A HREF="006549.html">[rabbitmq-discuss] Writing applications using AMQP,	basic design 	questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6548">[ date ]</a>
              <a href="thread.html#6548">[ thread ]</a>
              <a href="subject.html#6548">[ subject ]</a>
              <a href="author.html#6548">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
