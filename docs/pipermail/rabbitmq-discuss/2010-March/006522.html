<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] problem with an HA pair of rabbitmq servers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20problem%20with%20an%20HA%20pair%20of%20rabbitmq%20servers&In-Reply-To=621b44ae1002281841o35f958f8pf1fd3d9443430c87%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006508.html">
   <LINK REL="Next"  HREF="006523.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] problem with an HA pair of rabbitmq servers</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20problem%20with%20an%20HA%20pair%20of%20rabbitmq%20servers&In-Reply-To=621b44ae1002281841o35f958f8pf1fd3d9443430c87%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] problem with an HA pair of rabbitmq servers">matthew at lshift.net
       </A><BR>
    <I>Tue Mar  2 12:19:29 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006508.html">[rabbitmq-discuss] problem with an HA pair of rabbitmq servers
</A></li>
        <LI>Next message: <A HREF="006523.html">[rabbitmq-discuss] problem with an HA pair of rabbitmq servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6522">[ date ]</a>
              <a href="thread.html#6522">[ thread ]</a>
              <a href="subject.html#6522">[ subject ]</a>
              <a href="author.html#6522">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Allan,

On Sun, Feb 28, 2010 at 06:41:19PM -0800, allan bailey wrote:
&gt;<i> We have a pair of rabbitmq servers.   The 1st server periodically does a lot
</I>&gt;<i> of intense I/O copying data
</I>&gt;<i> out to the 2nd server.   This apparently causes timeouts that then cause a
</I>&gt;<i> partitioning of the cluster.
</I>
Very interesting problem - this isn't something we've come across.

I think the fix is to change the net ticktime. The default here is
apparently 60 seconds, and the below diff changes that to 500 seconds.
Obviously with larger values, the cluster will take longer to notice an
error if something bad happens. Please do let us know how you get on.

Obviously, this'll require building from source...

--- a/src/rabbit_node_monitor.erl       Sun Feb 28 10:25:51 2010 +0000
+++ b/src/rabbit_node_monitor.erl       Tue Mar 02 12:15:45 2010 +0000
@@ -48,6 +48,7 @@
 %%--------------------------------------------------------------------
 
 init([]) -&gt;
+    net_kernel:set_net_ticktime(500),
     ok = net_kernel:monitor_nodes(true),
     {ok, no_state}.
 
Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006508.html">[rabbitmq-discuss] problem with an HA pair of rabbitmq servers
</A></li>
	<LI>Next message: <A HREF="006523.html">[rabbitmq-discuss] problem with an HA pair of rabbitmq servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6522">[ date ]</a>
              <a href="thread.html#6522">[ thread ]</a>
              <a href="subject.html#6522">[ subject ]</a>
              <a href="author.html#6522">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
