<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] debugging an unroutable message
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20debugging%20an%20unroutable%20message&In-Reply-To=a3ff00ac1003300344n433ca34q9153af88c17e0040%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006748.html">
   <LINK REL="Next"  HREF="006742.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] debugging an unroutable message</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20debugging%20an%20unroutable%20message&In-Reply-To=a3ff00ac1003300344n433ca34q9153af88c17e0040%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] debugging an unroutable message">matthew at lshift.net
       </A><BR>
    <I>Tue Mar 30 11:59:37 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006748.html">[rabbitmq-discuss] debugging an unroutable message
</A></li>
        <LI>Next message: <A HREF="006742.html">[rabbitmq-discuss] bug21673 crashed with very large transaction
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6749">[ date ]</a>
              <a href="thread.html#6749">[ thread ]</a>
              <a href="subject.html#6749">[ subject ]</a>
              <a href="author.html#6749">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Mar 30, 2010 at 06:44:32AM -0400, Daniel Risacher wrote:
&gt;<i> I did have some race conditions in the first pass of the code, but I
</I>&gt;<i> think that's fixed before I wrote to the list.  Generating the 'ping'
</I>&gt;<i> happens as part of a $queue-&gt;do_when_created() callback.  I'm
</I>&gt;<i> certainly not explicitly changing the ack settings or QoS settings.
</I>
Ok, so you are manually acking the messages on both the daemon and the
client? It shouldn't be causing the issue you're seeing, but it's still
good to always let RabbitMQ know when you've received the message.

&gt;<i> I actually fixed my example by not binding the reply queue to
</I>&gt;<i> amq.direct, and instead using the default binding to the unnamed
</I>&gt;<i> default exchange.  Which is good in that I can move forward on other
</I>&gt;<i> parts of my project, but one of the secondary goals of the project is
</I>&gt;<i> to learn about how AMQP works in implementation, and I still don't
</I>&gt;<i> understand what was wrong with the first approach.
</I>&gt;<i> 
</I>&gt;<i> I never delete queues - I let the server do that when the connection drops.
</I>
Ok, so you're either setting them exclusive or auto-delete?

&gt;<i> I suppose there could be another race between the bind to amq.direct
</I>&gt;<i> and the pong.  I wasn't explicitly waiting for bindOK, although as I
</I>&gt;<i> recall from the traces, I was getting bindOK, before sending the ping,
</I>&gt;<i> and it still wasn't working - but I'll check that.
</I>
Sure, in general, any command that has an _ok variant should be treated
as synchronous and you should wait for the reply before continuing
(unless you have good reason not to, but bears await ye).

&gt;<i> Are there rules about what can be bound to amq.direct?
</I>
Nope.

&gt;<i> It would be useful if there were some way to have rabbitmq output
</I>&gt;<i> every transaction (in commit order?) for analysis/debugging. Is there
</I>&gt;<i> any mechanism to do something like that?  Maybe as a plugin?
</I>
Yes, use the Tracer which is part of the Java client. This sits in the
middle of a connection and just dumps out (after decoding) every message
that flies in either direction.

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006748.html">[rabbitmq-discuss] debugging an unroutable message
</A></li>
	<LI>Next message: <A HREF="006742.html">[rabbitmq-discuss] bug21673 crashed with very large transaction
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6749">[ date ]</a>
              <a href="thread.html#6749">[ thread ]</a>
              <a href="subject.html#6749">[ subject ]</a>
              <a href="author.html#6749">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
