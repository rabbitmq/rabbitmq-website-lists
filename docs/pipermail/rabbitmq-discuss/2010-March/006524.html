<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Node/Broker failover and recreating queues on another node
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Node/Broker%20failover%20and%20recreating%20queues%0A%20on%20another%20node&In-Reply-To=4d260fa71003011427h43fd576ej18bf5b46766174b3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006515.html">
   <LINK REL="Next"  HREF="006526.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Node/Broker failover and recreating queues on another node</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Node/Broker%20failover%20and%20recreating%20queues%0A%20on%20another%20node&In-Reply-To=4d260fa71003011427h43fd576ej18bf5b46766174b3%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Node/Broker failover and recreating queues on another node">matthew at lshift.net
       </A><BR>
    <I>Tue Mar  2 12:43:37 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006515.html">[rabbitmq-discuss] Node/Broker failover and recreating queues on	another node
</A></li>
        <LI>Next message: <A HREF="006526.html">[rabbitmq-discuss] Node/Broker failover and recreating queues on another node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6524">[ date ]</a>
              <a href="thread.html#6524">[ thread ]</a>
              <a href="subject.html#6524">[ subject ]</a>
              <a href="author.html#6524">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matthew,

On Tue, Mar 02, 2010 at 08:57:45AM +1030, Matthew Dunn wrote:
&gt;<i> *It's OK for a few messages to be dropped when a broker goes down
</I>&gt;<i> *I need to load balance these messages
</I>&gt;<i> *Availability is more important than dropping the ocassional message
</I>&gt;<i> *I would prefer messages only be proccessed once.
</I>
Is this in fact rather similar to what the standard MySQL master/slave
HA setup is - i.e. async from the master to the slave, but instant
availability of the slave when the master fails, and the slave is
(pretty much) unusable up until the master fails?

&gt;<i> If the broker hosting the public queue crashes or is unavailable. Each
</I>&gt;<i> consumer will connect to a new available broker and recreate the queue there
</I>&gt;<i> with the same name.
</I>
Your entire plan can be implemented using the new rabbitmq-shovel
plugin. I would recommend you try this out as it was written for exactly
these situations.

&gt;<i> The question I have is, if I have created a public queue on a different
</I>&gt;<i> broker, when the crashed broker comes back online will there be a problem
</I>&gt;<i> with conflicting queues?
</I>
No, provided you don't use clustering.

&gt;<i> *Broker A with Queue A Crashes
</I>&gt;<i> *Consumers failover to Broker B
</I>&gt;<i> *A consumer recreates Queue A on Broker B
</I>&gt;<i> *Broker A is restored -- Will Broker A have problems starting because Queue
</I>&gt;<i> A has been recreated elsewhere?
</I>
I would suggest a slight variation. Brokers A and B are both up. The
shovel connects from your local &quot;leaf&quot; broker to both brokers, creating
queues and consuming from both queues. The publishers can then publish
to either broker and the messages will get through to the consumers, who
are consuming via their local leaf brokers.

In event of failure, hopefully the queues on A and B will be pretty
short, if not empty, so you shouldn't lose much. The shovels will
continue, and as soon as the failed node comes back up, will reconnect
to the node, recreating the queues and consuming as necessary. The
publishers simply need to have some logic to be able to switch between
either broker if they find a node has failed.

Is that sufficient for your needs?

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006515.html">[rabbitmq-discuss] Node/Broker failover and recreating queues on	another node
</A></li>
	<LI>Next message: <A HREF="006526.html">[rabbitmq-discuss] Node/Broker failover and recreating queues on another node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6524">[ date ]</a>
              <a href="thread.html#6524">[ thread ]</a>
              <a href="subject.html#6524">[ subject ]</a>
              <a href="author.html#6524">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
