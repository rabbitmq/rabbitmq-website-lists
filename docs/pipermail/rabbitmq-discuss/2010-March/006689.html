<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Adapter merges tornado and pika
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Adapter%20merges%20tornado%20and%20pika&In-Reply-To=mailman.453.1269093411.22012.rabbitmq-discuss%40lists.rabbitmq.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006725.html">
   <LINK REL="Next"  HREF="006724.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Adapter merges tornado and pika</H1>
    <B>Richard Clark</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Adapter%20merges%20tornado%20and%20pika&In-Reply-To=mailman.453.1269093411.22012.rabbitmq-discuss%40lists.rabbitmq.com"
       TITLE="[rabbitmq-discuss] Adapter merges tornado and pika">richard at redspider.co.nz
       </A><BR>
    <I>Sat Mar 20 14:06:45 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006725.html">[rabbitmq-discuss] Increasing base memory.
</A></li>
        <LI>Next message: <A HREF="006724.html">[rabbitmq-discuss] Adapter merges tornado and pika
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6689">[ date ]</a>
              <a href="thread.html#6689">[ thread ]</a>
              <a href="subject.html#6689">[ subject ]</a>
              <a href="author.html#6689">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, I'm half asleep so I'll make this quick. After fighting with
numerous strategies for melding tornado and rabbitmq in a way that
doesn't involve spawning extra processes, mangling my interpreter,
going anywhere near twisted, mangling my ability to dispatch properly
off multiple queues on a single channel etc, I finally managed
something that, at least for first appearances, works.

The changes are fairly simple. Tornado needs one 2 line change to
ioloop to allow it to run a loop once, rather than spinning - sadly
attempts to do it without this change caused nightmarish bugs to
emerge.

In addition to that, two files (attached, no warranty etc etc) are
required:

asyncloop.py, an ioloop handler that mostly pretends to be an asyncore
dispatcher
ioloop_adapter.py, an adapter almost exactly like the
asyncore_adapter.py in pika, except it uses the asyncloop and gets rid
of some crap (and, unfortunately, timers, but they're easy to put back
using ioloop stuff)

In no way is this production code, it's barely even tested. I intend
to try and get it further in that direction tomorrow, but in case
anyone else has been banging their head on the same problem I figured
I'd throw the strategy out there.

Files:
<A HREF="http://gist.github.com/338680">http://gist.github.com/338680</A>

Example:
<A HREF="http://gist.github.com/338683">http://gist.github.com/338683</A> (requires an amqp echo service on echo/
echo)

cross-posting to tornado as well.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006725.html">[rabbitmq-discuss] Increasing base memory.
</A></li>
	<LI>Next message: <A HREF="006724.html">[rabbitmq-discuss] Adapter merges tornado and pika
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6689">[ date ]</a>
              <a href="thread.html#6689">[ thread ]</a>
              <a href="subject.html#6689">[ subject ]</a>
              <a href="author.html#6689">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
