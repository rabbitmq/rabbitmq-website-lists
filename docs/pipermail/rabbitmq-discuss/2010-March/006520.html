<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] limit number of messages buffered in memory in new persister
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20limit%20number%20of%20messages%20buffered%20in%20memory%0A%20in%20new%20persister&In-Reply-To=908041.74697.qm%40web31808.mail.mud.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006519.html">
   <LINK REL="Next"  HREF="006531.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] limit number of messages buffered in memory in new persister</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20limit%20number%20of%20messages%20buffered%20in%20memory%0A%20in%20new%20persister&In-Reply-To=908041.74697.qm%40web31808.mail.mud.yahoo.com"
       TITLE="[rabbitmq-discuss] limit number of messages buffered in memory in new persister">matthew at lshift.net
       </A><BR>
    <I>Tue Mar  2 11:23:09 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006519.html">[rabbitmq-discuss] limit number of messages buffered in memory in	new persister
</A></li>
        <LI>Next message: <A HREF="006531.html">[rabbitmq-discuss] limit number of messages buffered in memory	in new persister
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6520">[ date ]</a>
              <a href="thread.html#6520">[ thread ]</a>
              <a href="subject.html#6520">[ subject ]</a>
              <a href="author.html#6520">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,

On Tue, Mar 02, 2010 at 12:38:28AM -0800, alex chen wrote:
&gt;<i> We are using new persister.  When client publishes at high rate, messages are buffered in memory before writing to disk.  In this case if the server crashes, those messages are lost.  I am wondering if rabbitmq could add a configuration parameter on server side to limit the number of messages that have not been written to the disk?
</I>
There is no such parameter, and adding one would be very tricky indeed
giving the number of processes and corresponding mailboxes that messages
can sit in. Your best bet to limit this is to use transactions - if you
put the publishing channel in transactional mode, and then issue a
commit every, say, 100 publishes, then you will ensure that no more than
100 messages (from that publisher) are ever pending being written to
disk. However, be warned that a commit must also fsync various files,
which is an expensive operation on rotating disks. SSDs can do fsyncs in
constant time, about 1000 times faster than rotating disks. Thus if
performance is important here, you will want to carefully balance the
number of outstanding messages, and maybe investigate SSDs if you find
performance suffers too much.

Note that in the case of multiple publishers doing multiple commits at
the same time, we coalesce commits thus the worst case is one fsync per
commit, and it's frequently less than one fsync per commit.

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006519.html">[rabbitmq-discuss] limit number of messages buffered in memory in	new persister
</A></li>
	<LI>Next message: <A HREF="006531.html">[rabbitmq-discuss] limit number of messages buffered in memory	in new persister
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6520">[ date ]</a>
              <a href="thread.html#6520">[ thread ]</a>
              <a href="subject.html#6520">[ subject ]</a>
              <a href="author.html#6520">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
