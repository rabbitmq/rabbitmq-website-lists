<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Client connection timeout
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Client%20connection%20timeout&In-Reply-To=DF5EA4D3-4B6B-4DF4-B9EE-6F57EF24407F%40epicadvertising.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006728.html">
   <LINK REL="Next"  HREF="006733.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Client connection timeout</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Client%20connection%20timeout&In-Reply-To=DF5EA4D3-4B6B-4DF4-B9EE-6F57EF24407F%40epicadvertising.com"
       TITLE="[rabbitmq-discuss] Client connection timeout">matthew at lshift.net
       </A><BR>
    <I>Fri Mar 26 18:18:48 GMT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006728.html">[rabbitmq-discuss] Client connection timeout
</A></li>
        <LI>Next message: <A HREF="006733.html">[rabbitmq-discuss] Client connection timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6732">[ date ]</a>
              <a href="thread.html#6732">[ thread ]</a>
              <a href="subject.html#6732">[ subject ]</a>
              <a href="author.html#6732">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Howdy,

On Fri, Mar 26, 2010 at 09:33:25AM -0500, Brendan Doyle wrote:
&gt;<i> 1. If the gen_server was started by a supervisor, why would it not come back up and start accepting connections once again?
</I>
I would expect it did. However, supervisors have a restart limit in
terms of the number of restarts within a particular period of time. I
would expect that it came back up and then immediately died again with
the same error, cycled like this for a while, and then the supervisor
gave up, exited, and took down the rest of rabbit. If this was the case
you should have entries in your logs about &quot;Reached maximum restart
intensity&quot;.

Or, Erlang could have decided to try and reread the .beam file for the
module (no idea when it decides to do that), hit the same emfile error
and decided to die.

&gt;<i> 2. Given that the client is not closing connections cleanly ( I am looking into this ) but rabbit is successfully detecting that the connection HAS closed, why would we get an out of file descriptors error?  I would hope that file descriptors are released properly and re-used
</I>
Should be. lsof or rumaging around in /proc/$PID/fd will show you what
is open and what isn't. You may be able to detect a leak there. Also
netstat -anp | grep beam may be illuminatory.

&gt;<i> This server was running for a few months before this issue cropped up so it may be a 'slow' bug and is not super critical for us as a restart fixed things.  However hopefully someone can shed some light
</I>
Sure. Whilst I'm sure I sound like a stuck record these days, this bug
is fixed in the new persister branch, where we track file descriptors
including sockets and stop accepting new network connections when we get
near the limit. The goal here is really to protect the erlang VM so that
we don't die horribly when we run out of file descriptors. My recent
blog post to the lshift blog explains in some detail how the general
mechanism works.

<A HREF="http://www.lshift.net/blog/2010/03/23/the-fine-art-of-holding-a-file-descriptor">http://www.lshift.net/blog/2010/03/23/the-fine-art-of-holding-a-file-descriptor</A>

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006728.html">[rabbitmq-discuss] Client connection timeout
</A></li>
	<LI>Next message: <A HREF="006733.html">[rabbitmq-discuss] Client connection timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6732">[ date ]</a>
              <a href="thread.html#6732">[ thread ]</a>
              <a href="subject.html#6732">[ subject ]</a>
              <a href="author.html#6732">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
