<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ crashed again
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20crashed%20again&In-Reply-To=4BB3C888.3010406%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006760.html">
   <LINK REL="Next"  HREF="006757.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ crashed again</H1>
    <B>Ian Ragsdale</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20crashed%20again&In-Reply-To=4BB3C888.3010406%40lshift.net"
       TITLE="[rabbitmq-discuss] RabbitMQ crashed again">ian.ragsdale at gmail.com
       </A><BR>
    <I>Wed Mar 31 23:37:40 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006760.html">[rabbitmq-discuss] RabbitMQ crashed again
</A></li>
        <LI>Next message: <A HREF="006757.html">[rabbitmq-discuss] basic_qos(prefetch_count=1) NOT_IMPLEMENTED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6761">[ date ]</a>
              <a href="thread.html#6761">[ thread ]</a>
              <a href="subject.html#6761">[ subject ]</a>
              <a href="author.html#6761">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for confirming, Michael.  Is it safe to assume that closing a connection will deallocate any associated resources?  I have the example for how to increase the number of processes, so I can increase that and make sure that the connections get reopened on a regular basis, which should hopefully keep whatever is causing this slow resource from crashing the server.

Any thoughts on the behavior I mentioned where the server seemed to continue to accept messages?  I don't see that behavior if I manually stop the server, just in the case of this crash - does that seem at all possible?  I could try to reproduce it locally if that would help.

Thanks,
Ian

On Mar 31, 2010, at 5:11 PM, Michael Bridgen wrote:

&gt;<i> Hi Ian,
</I>&gt;<i> 
</I>&gt;<i> &gt; Hello all, I'm trying to track down the cause of another RabbitMQ
</I>&gt;<i> &gt; crash that happened to me last night.  The server was clearly no
</I>&gt;<i> &gt; longer working correctly (my consumers stopped receiving messages)
</I>&gt;<i> &gt; but the main producer seemed to be able to continue to publish
</I>&gt;<i> &gt; messages.  On a dev machine I started the producer and then stopped
</I>&gt;<i> &gt; the server entirely, and it stopped producing as expected, but the
</I>&gt;<i> &gt; live producer seemed to think the server was still working, and
</I>&gt;<i> &gt; happily published messages to the broken rabbitmq instance, which is
</I>&gt;<i> &gt; extremely troubling.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This does not seem to be caused by the same issue that caused my
</I>&gt;<i> &gt; previous crash (hitting channel limits) - the crash log is different,
</I>&gt;<i> &gt; but still has a reference to a system limit being reached.  RabbitMQ
</I>&gt;<i> &gt; seems very stable for others, so I'm guessing there's some issue in
</I>&gt;<i> &gt; my code base causing this.  Since I disabled the code that was
</I>&gt;<i> &gt; causing all the extra channels to be created, I'm at a bit of a loss
</I>&gt;<i> &gt; trying to understand what is causing these crashes and how I can
</I>&gt;<i> &gt; prevent them - this is starting to become a huge problem.
</I>&gt;<i> 
</I>&gt;<i> As you deduced, it looks like you're running into a limit on the number of processes.  This is possible with some usages, and there's examples of how to increase process limits not long ago on the list which may be worth trying out.
</I>&gt;<i> 
</I>&gt;<i> For troubleshooting your application, you could keep an eye on the things that use processes -- principally connections, channels and queues -- by using rabbitmqctl with 'list_connections', 'list_channels' (new in 1.7.latest), or 'list_queues'.  (&quot;watch&quot; could be your friend here; e.g., &quot;watch -n4 rabbitmqctl list_channels&quot;.)
</I>&gt;<i> 
</I>&gt;<i> My first suspicion is that channels are somehow remaining open.  If the problem remains mysterious, it'll be a help if you can post (ideally minimal!) app code.  Happy to look at it.
</I>&gt;<i> 
</I>&gt;<i> Please do let us know if this helps, and how you get on.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Michael
</I>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006760.html">[rabbitmq-discuss] RabbitMQ crashed again
</A></li>
	<LI>Next message: <A HREF="006757.html">[rabbitmq-discuss] basic_qos(prefetch_count=1) NOT_IMPLEMENTED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6761">[ date ]</a>
              <a href="thread.html#6761">[ thread ]</a>
              <a href="subject.html#6761">[ subject ]</a>
              <a href="author.html#6761">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
