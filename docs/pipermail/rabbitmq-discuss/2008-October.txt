From jonatan at heysan.com  Wed Oct  1 01:28:33 2008
From: jonatan at heysan.com (Jonatan Kallus)
Date: Tue, 30 Sep 2008 17:28:33 -0700
Subject: [rabbitmq-discuss] Small error in RabbitMQ Java Client API Guide
Message-ID: <4cc167ca0809301728v3c04ab99kd4ac14e4bfafc3d1@mail.gmail.com>

I think I found a minor error in the java client API guide. I believe
the example line:

conn.close(AMQP.REPLY_SUCCESS, "Goodbye");

Should be:

conn.close(timeoutMillis);

Just not to trap any new people.



From Andrius.Norkaitis at oryo.lt  Wed Oct  1 06:49:19 2008
From: Andrius.Norkaitis at oryo.lt (Andrius Norkaitis)
Date: Wed, 1 Oct 2008 08:49:19 +0300
Subject: [rabbitmq-discuss] FW:  wct + pubsub
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAADD8y5mmM4JOoiA39C93acIBAAAAAA==@oryo.lt>

>Are both instances of the server running off the same (shared) queue?
>That could explain the behaviour you are seeing.

>If you want to get one copy of the message per subscribed client, you
>need one queue per subscriber, and then to bind each queue to the
>relevant exchange with the relevant key (direct case) or keys (topic
>case).

>Without diving deeper into the code it looks to me like this is how
>logtail is working (so "Both instances of logtail program got the
>message."), but the second example is running off a shared queue (or
>you have found a bug).

>Can you check if I am right please.  If I am wrong we shall need
>someone to dig deeper at this end, which we can do, but probably not
>today or tomorrow.

I tried to compare query declaration code in logtain and WCF example and
haven't found significant differences.


Ok. This is code from WCF service model implementation
(RabbitMQInputChannel.cs):

	//Create a queue for messages destined to this service, bind it to
the service URI routing key
            
            string queue = model.QueueDeclare(ticket);
            model.QueueBind(ticket, queue, base.LocalAddress.Uri.Host,
base.LocalAddress.Uri.PathAndQuery, false, null);

            //Listen to the queue
            messageQueue = new QueueingBasicConsumer(model);
            model.BasicConsume(ticket, queue, null, messageQueue);


and this code is from logtail:

using (IModel ch = conn.CreateModel()) {
                        ushort ticket = ch.AccessRequest("/data");

                        Subscription sub;
                        if (exchange == "") {
                            sub = new Subscription(ch, ticket, routingKey);
                        } else {
                            sub = new Subscription(ch, ticket, exchange,
exchangeType, routingKey);
                        }

And Subscribtion implamentation code (Subscription.cs) for query creating:

    m_queueName = m_model.QueueDeclare(ticket);



Maybe I missed something, but I fell the same, that something with query
declaration is wrong.




From matthias at lshift.net  Wed Oct  1 08:06:11 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 01 Oct 2008 08:06:11 +0100
Subject: [rabbitmq-discuss] Small error in RabbitMQ Java Client API Guide
In-Reply-To: <4cc167ca0809301728v3c04ab99kd4ac14e4bfafc3d1@mail.gmail.com>
References: <4cc167ca0809301728v3c04ab99kd4ac14e4bfafc3d1@mail.gmail.com>
Message-ID: <48E32163.1090307@lshift.net>

Jonatan,

Jonatan Kallus wrote:
> I think I found a minor error in the java client API guide. I believe
> the example line:
> 
> conn.close(AMQP.REPLY_SUCCESS, "Goodbye");
> 
> Should be:
> 
> conn.close(timeoutMillis);

or conn.close()

Well spotted.

The former method is implemented but it's not part of the public API. I 
reckon it should be though so I have file a bug for that.


Matthias.



From peter.kieltyka at gmail.com  Wed Oct  1 21:29:57 2008
From: peter.kieltyka at gmail.com (Peter Kieltyka)
Date: Wed, 1 Oct 2008 16:29:57 -0400
Subject: [rabbitmq-discuss] Rabbitmqctl issues
Message-ID: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>

Hello everyone,

For the longest time, I've struggled to be able to control the server  
to do basic start/stop/restart commands.

Currently on my production server I am running Debian Etch where I  
followed the instructions at http://www.rabbitmq.com/debian.html to  
install Rabbit.

Running the rabbitmq-server or rabbitmq-multi start_all 1 commands  
will bring the server online, however to stop it, or add a user none  
of the scripts work. I am always presented with an error, bad_node.

I.e.

Creating user "patbroker" ...
rabbit_control action add_user failed:
{badrpc,nodedown}

However, I can confirm that Rabbit is running fine because my  
application is working just fine. I've even tried explicitly  
specifying the -n rabbit at broker (hostname -s returns broker).

The same goes for stopping the server, either using /etc/init.d/ 
rabbitmq-server stop, or calling "rabbitmq-multi stop_all" directly  
will result in:

Stopping all nodes...

rabbit_multi action stop_all failed:
no_nodes_running

Thanks.

Peter



From clemesha at gmail.com  Wed Oct  1 21:52:22 2008
From: clemesha at gmail.com (Alex Clemesha)
Date: Wed, 1 Oct 2008 13:52:22 -0700
Subject: [rabbitmq-discuss] Rabbitmqctl issues
In-Reply-To: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
References: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
Message-ID: <d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>

Hi,

I also run into the same thing (actually happened ~15 minutes ago), I'm
using Ubuntu 8.04.
(installed RabbitMQ by adding the relevant line to /etc/apt/source.list,
then using apt-get).

I usually just find the relevant processes and kill them, then run
'rabbitmq-server -detached'
to start things back up.

I just assumed I was missing something (maybe I still am :-)

thanks
-Alex

On Wed, Oct 1, 2008 at 1:29 PM, Peter Kieltyka <peter.kieltyka at gmail.com>wrote:

> Hello everyone,
>
> For the longest time, I've struggled to be able to control the server
> to do basic start/stop/restart commands.
>
> Currently on my production server I am running Debian Etch where I
> followed the instructions at http://www.rabbitmq.com/debian.html to
> install Rabbit.
>
> Running the rabbitmq-server or rabbitmq-multi start_all 1 commands
> will bring the server online, however to stop it, or add a user none
> of the scripts work. I am always presented with an error, bad_node.
>
> I.e.
>
> Creating user "patbroker" ...
> rabbit_control action add_user failed:
> {badrpc,nodedown}
>
> However, I can confirm that Rabbit is running fine because my
> application is working just fine. I've even tried explicitly
> specifying the -n rabbit at broker (hostname -s returns broker).
>
> The same goes for stopping the server, either using /etc/init.d/
> rabbitmq-server stop, or calling "rabbitmq-multi stop_all" directly
> will result in:
>
> Stopping all nodes...
>
> rabbit_multi action stop_all failed:
> no_nodes_running
>
> Thanks.
>
> Peter
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alex Clemesha
clemesha.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081001/3e02bbf1/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Wed Oct  1 22:24:41 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Wed, 1 Oct 2008 17:24:41 -0400
Subject: [rabbitmq-discuss] Rabbitmqctl issues
In-Reply-To: <d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>
References: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
	<d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>
Message-ID: <6c2563b20810011424sb0c9952ka4800ce20f4d6298@mail.gmail.com>

Would you like to try this?

Please ensure that you are using the same Erlang cookie that Rabbit was
started with. This is in a file is named $HOME/.erlang.cookie where $HOME is
the directory of the user that started rabbitmq. If you try to run commands
that connect to the rabbitmq Erlang node, using a different user name, even
as root, if it does not have the same cookie file, the commands will fail.

It's best to control rabbit exclusively as one user, for example as the
rabbit user.

Hope this helps,
Edwin

On Wed, Oct 1, 2008 at 4:52 PM, Alex Clemesha <clemesha at gmail.com> wrote:

> Hi,
>
> I also run into the same thing (actually happened ~15 minutes ago), I'm
> using Ubuntu 8.04.
> (installed RabbitMQ by adding the relevant line to /etc/apt/source.list,
> then using apt-get).
>
> I usually just find the relevant processes and kill them, then run
> 'rabbitmq-server -detached'
> to start things back up.
>
> I just assumed I was missing something (maybe I still am :-)
>
> thanks
> -Alex
>
>
> On Wed, Oct 1, 2008 at 1:29 PM, Peter Kieltyka <peter.kieltyka at gmail.com>wrote:
>
>> Hello everyone,
>>
>> For the longest time, I've struggled to be able to control the server
>> to do basic start/stop/restart commands.
>>
>> Currently on my production server I am running Debian Etch where I
>> followed the instructions at http://www.rabbitmq.com/debian.html to
>> install Rabbit.
>>
>> Running the rabbitmq-server or rabbitmq-multi start_all 1 commands
>> will bring the server online, however to stop it, or add a user none
>> of the scripts work. I am always presented with an error, bad_node.
>>
>> I.e.
>>
>> Creating user "patbroker" ...
>> rabbit_control action add_user failed:
>> {badrpc,nodedown}
>>
>> However, I can confirm that Rabbit is running fine because my
>> application is working just fine. I've even tried explicitly
>> specifying the -n rabbit at broker (hostname -s returns broker).
>>
>> The same goes for stopping the server, either using /etc/init.d/
>> rabbitmq-server stop, or calling "rabbitmq-multi stop_all" directly
>> will result in:
>>
>> Stopping all nodes...
>>
>> rabbit_multi action stop_all failed:
>> no_nodes_running
>>
>> Thanks.
>>
>> Peter
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> Alex Clemesha
> clemesha.org
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081001/c134469a/attachment.htm 

From clemesha at gmail.com  Wed Oct  1 23:07:01 2008
From: clemesha at gmail.com (Alex Clemesha)
Date: Wed, 1 Oct 2008 15:07:01 -0700
Subject: [rabbitmq-discuss] Rabbitmqctl issues
In-Reply-To: <6c2563b20810011424sb0c9952ka4800ce20f4d6298@mail.gmail.com>
References: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
	<d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>
	<6c2563b20810011424sb0c9952ka4800ce20f4d6298@mail.gmail.com>
Message-ID: <d272f0690810011507s415dfa8s82add6a5d1bc3826@mail.gmail.com>

On Wed, Oct 1, 2008 at 2:24 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net>wrote:

> Would you like to try this?
>
> Please ensure that you are using the same Erlang cookie that Rabbit was
> started with. This is in a file is named $HOME/.erlang.cookie where $HOME is
> the directory of the user that started rabbitmq. If you try to run commands
> that connect to the rabbitmq Erlang node, using a different user name, even
> as root, if it does not have the same cookie file, the commands will fail.
>
> It's best to control rabbit exclusively as one user, for example as the
> rabbit user.
>
Great, thanks for the tip.  I was in fact using a different user, so I'll
use the rabbit user from now on.




>
>
> Hope this helps,
> Edwin
>
>
> On Wed, Oct 1, 2008 at 4:52 PM, Alex Clemesha <clemesha at gmail.com> wrote:
>
>> Hi,
>>
>> I also run into the same thing (actually happened ~15 minutes ago), I'm
>> using Ubuntu 8.04.
>> (installed RabbitMQ by adding the relevant line to /etc/apt/source.list,
>> then using apt-get).
>>
>> I usually just find the relevant processes and kill them, then run
>> 'rabbitmq-server -detached'
>> to start things back up.
>>
>> I just assumed I was missing something (maybe I still am :-)
>>
>> thanks
>> -Alex
>>
>>
>> On Wed, Oct 1, 2008 at 1:29 PM, Peter Kieltyka <peter.kieltyka at gmail.com>wrote:
>>
>>> Hello everyone,
>>>
>>> For the longest time, I've struggled to be able to control the server
>>> to do basic start/stop/restart commands.
>>>
>>> Currently on my production server I am running Debian Etch where I
>>> followed the instructions at http://www.rabbitmq.com/debian.html to
>>> install Rabbit.
>>>
>>> Running the rabbitmq-server or rabbitmq-multi start_all 1 commands
>>> will bring the server online, however to stop it, or add a user none
>>> of the scripts work. I am always presented with an error, bad_node.
>>>
>>> I.e.
>>>
>>> Creating user "patbroker" ...
>>> rabbit_control action add_user failed:
>>> {badrpc,nodedown}
>>>
>>> However, I can confirm that Rabbit is running fine because my
>>> application is working just fine. I've even tried explicitly
>>> specifying the -n rabbit at broker (hostname -s returns broker).
>>>
>>> The same goes for stopping the server, either using /etc/init.d/
>>> rabbitmq-server stop, or calling "rabbitmq-multi stop_all" directly
>>> will result in:
>>>
>>> Stopping all nodes...
>>>
>>> rabbit_multi action stop_all failed:
>>> no_nodes_running
>>>
>>> Thanks.
>>>
>>> Peter
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>>
>> --
>> Alex Clemesha
>> clemesha.org
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>


-- 
Alex Clemesha
clemesha.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081001/2544b408/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Wed Oct  1 23:15:40 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Wed, 1 Oct 2008 18:15:40 -0400
Subject: [rabbitmq-discuss] Rabbitmqctl issues
In-Reply-To: <d272f0690810011507s415dfa8s82add6a5d1bc3826@mail.gmail.com>
References: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
	<d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>
	<6c2563b20810011424sb0c9952ka4800ce20f4d6298@mail.gmail.com>
	<d272f0690810011507s415dfa8s82add6a5d1bc3826@mail.gmail.com>
Message-ID: <6c2563b20810011515q3f14286cw1fb3efe41b15f454@mail.gmail.com>

I wasn't sure from your response - does it work now? :)

On Wed, Oct 1, 2008 at 6:07 PM, Alex Clemesha <clemesha at gmail.com> wrote:

>
>
> On Wed, Oct 1, 2008 at 2:24 PM, Edwin Fine <rabbitmq-discuss_efine at usa.net
> > wrote:
>
>> Would you like to try this?
>>
>> Please ensure that you are using the same Erlang cookie that Rabbit was
>> started with. This is in a file is named $HOME/.erlang.cookie where $HOME is
>> the directory of the user that started rabbitmq. If you try to run commands
>> that connect to the rabbitmq Erlang node, using a different user name, even
>> as root, if it does not have the same cookie file, the commands will fail.
>>
>> It's best to control rabbit exclusively as one user, for example as the
>> rabbit user.
>>
> Great, thanks for the tip.  I was in fact using a different user, so I'll
> use the rabbit user from now on.
>
>
>
>
>>
>>
>> Hope this helps,
>> Edwin
>>
>>
>> On Wed, Oct 1, 2008 at 4:52 PM, Alex Clemesha <clemesha at gmail.com> wrote:
>>
>>> Hi,
>>>
>>> I also run into the same thing (actually happened ~15 minutes ago), I'm
>>> using Ubuntu 8.04.
>>> (installed RabbitMQ by adding the relevant line to /etc/apt/source.list,
>>> then using apt-get).
>>>
>>> I usually just find the relevant processes and kill them, then run
>>> 'rabbitmq-server -detached'
>>> to start things back up.
>>>
>>> I just assumed I was missing something (maybe I still am :-)
>>>
>>> thanks
>>> -Alex
>>>
>>>
>>> On Wed, Oct 1, 2008 at 1:29 PM, Peter Kieltyka <peter.kieltyka at gmail.com
>>> > wrote:
>>>
>>>> Hello everyone,
>>>>
>>>> For the longest time, I've struggled to be able to control the server
>>>> to do basic start/stop/restart commands.
>>>>
>>>> Currently on my production server I am running Debian Etch where I
>>>> followed the instructions at http://www.rabbitmq.com/debian.html to
>>>> install Rabbit.
>>>>
>>>> Running the rabbitmq-server or rabbitmq-multi start_all 1 commands
>>>> will bring the server online, however to stop it, or add a user none
>>>> of the scripts work. I am always presented with an error, bad_node.
>>>>
>>>> I.e.
>>>>
>>>> Creating user "patbroker" ...
>>>> rabbit_control action add_user failed:
>>>> {badrpc,nodedown}
>>>>
>>>> However, I can confirm that Rabbit is running fine because my
>>>> application is working just fine. I've even tried explicitly
>>>> specifying the -n rabbit at broker (hostname -s returns broker).
>>>>
>>>> The same goes for stopping the server, either using /etc/init.d/
>>>> rabbitmq-server stop, or calling "rabbitmq-multi stop_all" directly
>>>> will result in:
>>>>
>>>> Stopping all nodes...
>>>>
>>>> rabbit_multi action stop_all failed:
>>>> no_nodes_running
>>>>
>>>> Thanks.
>>>>
>>>> Peter
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>
>>>
>>> --
>>> Alex Clemesha
>>> clemesha.org
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
>
> --
> Alex Clemesha
> clemesha.org
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081001/1d5c5a6c/attachment.htm 

From clemesha at gmail.com  Wed Oct  1 23:45:23 2008
From: clemesha at gmail.com (Alex Clemesha)
Date: Wed, 1 Oct 2008 15:45:23 -0700
Subject: [rabbitmq-discuss] Rabbitmqctl issues
In-Reply-To: <6c2563b20810011515q3f14286cw1fb3efe41b15f454@mail.gmail.com>
References: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
	<d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>
	<6c2563b20810011424sb0c9952ka4800ce20f4d6298@mail.gmail.com>
	<d272f0690810011507s415dfa8s82add6a5d1bc3826@mail.gmail.com>
	<6c2563b20810011515q3f14286cw1fb3efe41b15f454@mail.gmail.com>
Message-ID: <d272f0690810011545m9f0361kee713ca5f8eedf76@mail.gmail.com>

On Wed, Oct 1, 2008 at 3:15 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net>wrote:

> I wasn't sure from your response - does it work now? :)
>
Looks like it does, below's the proof :-)

Status of node rabbit at dj ...
[{running_applications,[{rabbit,"RabbitMQ","1.4.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.3.5"},
                        {os_mon,"CPO  CXC 138 46","2.1.2.1"},
                        {sasl,"SASL  CXC 138 11","2.1.5.1"},
                        {stdlib,"ERTS  CXC 138 10","1.14.5"},
                        {kernel,"ERTS  CXC 138 10","2.11.5"}]},
 {nodes,[rabbit at dj]},
 {running_nodes,[rabbit at dj]}]
done.


thanks!
-Alex





>
>
> On Wed, Oct 1, 2008 at 6:07 PM, Alex Clemesha <clemesha at gmail.com> wrote:
>
>>
>>
>> On Wed, Oct 1, 2008 at 2:24 PM, Edwin Fine <
>> rabbitmq-discuss_efine at usa.net> wrote:
>>
>>> Would you like to try this?
>>>
>>> Please ensure that you are using the same Erlang cookie that Rabbit was
>>> started with. This is in a file is named $HOME/.erlang.cookie where $HOME is
>>> the directory of the user that started rabbitmq. If you try to run commands
>>> that connect to the rabbitmq Erlang node, using a different user name, even
>>> as root, if it does not have the same cookie file, the commands will fail.
>>>
>>> It's best to control rabbit exclusively as one user, for example as the
>>> rabbit user.
>>>
>> Great, thanks for the tip.  I was in fact using a different user, so I'll
>> use the rabbit user from now on.
>>
>>
>>
>>
>>>
>>>
>>> Hope this helps,
>>> Edwin
>>>
>>>
>>> On Wed, Oct 1, 2008 at 4:52 PM, Alex Clemesha <clemesha at gmail.com>wrote:
>>>
>>>> Hi,
>>>>
>>>> I also run into the same thing (actually happened ~15 minutes ago), I'm
>>>> using Ubuntu 8.04.
>>>> (installed RabbitMQ by adding the relevant line to /etc/apt/source.list,
>>>> then using apt-get).
>>>>
>>>> I usually just find the relevant processes and kill them, then run
>>>> 'rabbitmq-server -detached'
>>>> to start things back up.
>>>>
>>>> I just assumed I was missing something (maybe I still am :-)
>>>>
>>>> thanks
>>>> -Alex
>>>>
>>>>
>>>> On Wed, Oct 1, 2008 at 1:29 PM, Peter Kieltyka <
>>>> peter.kieltyka at gmail.com> wrote:
>>>>
>>>>> Hello everyone,
>>>>>
>>>>> For the longest time, I've struggled to be able to control the server
>>>>> to do basic start/stop/restart commands.
>>>>>
>>>>> Currently on my production server I am running Debian Etch where I
>>>>> followed the instructions at http://www.rabbitmq.com/debian.html to
>>>>> install Rabbit.
>>>>>
>>>>> Running the rabbitmq-server or rabbitmq-multi start_all 1 commands
>>>>> will bring the server online, however to stop it, or add a user none
>>>>> of the scripts work. I am always presented with an error, bad_node.
>>>>>
>>>>> I.e.
>>>>>
>>>>> Creating user "patbroker" ...
>>>>> rabbit_control action add_user failed:
>>>>> {badrpc,nodedown}
>>>>>
>>>>> However, I can confirm that Rabbit is running fine because my
>>>>> application is working just fine. I've even tried explicitly
>>>>> specifying the -n rabbit at broker (hostname -s returns broker).
>>>>>
>>>>> The same goes for stopping the server, either using /etc/init.d/
>>>>> rabbitmq-server stop, or calling "rabbitmq-multi stop_all" directly
>>>>> will result in:
>>>>>
>>>>> Stopping all nodes...
>>>>>
>>>>> rabbit_multi action stop_all failed:
>>>>> no_nodes_running
>>>>>
>>>>> Thanks.
>>>>>
>>>>> Peter
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Alex Clemesha
>>>> clemesha.org
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>
>>
>> --
>> Alex Clemesha
>> clemesha.org
>>
>
>


-- 
Alex Clemesha
clemesha.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081001/aa3a90bc/attachment.htm 

From jonatan at heysan.com  Thu Oct  2 01:48:40 2008
From: jonatan at heysan.com (Jonatan Kallus)
Date: Wed, 1 Oct 2008 17:48:40 -0700
Subject: [rabbitmq-discuss] Redelivery of unacknowledged messages
In-Reply-To: <48E1CED0.8020607@lshift.net>
References: <4cc167ca0809291434td4d7674tf493b460fa67b74c@mail.gmail.com>
	<269388e30809291759u620ec14fyf63cc6643b7f69ff@mail.gmail.com>
	<48E1CED0.8020607@lshift.net>
Message-ID: <4cc167ca0810011748k4ebd4384m6f54a288dda4effd@mail.gmail.com>

Is it meant to work like this or is it a matter of a feature not being
implemented yet?

In my current implementation I am closing the channel occasionally, for no
particular reason, but to get the redeliveries. This causes the processing
to temporarily stop or slow down since I have to wait for all tasks to be
done and acked before I can close the channel. (Since messages need to be
acked on the same channel they were received on, as far as I know.)

It would probably be possible to have two parallel channels open, one active
(receiving new tasks) and one waiting for its tasks to be done and acked,
then closing the inactive one, making the previously active one passive and
opening a new active channel. This would add the complexity of keeping track
of what message that should be acked on what channel.

Are there any good patterns to handle this?

On Tue, Sep 30, 2008 at 12:01 AM, Matthias Radestock <matthias at lshift.net>
wrote:
> Ben Hood wrote:
>>>
>>> When are unacknowledged messages redelivered?
>>
>> After the channel in which the initial receive has been closed and a
>> new channel has been setup.
>
> To be precise, unacknowledged messages become eligible for redelivery when
> the channel (or connection) on which they have been delivered is closed.
>
> If a queue has more than one consumer, the message will be delivered to
one
> of the remaining consumers. Otherwise it will be enqueued and can thus be
> consumed by a consumer which comes along later.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081001/8e6b7eea/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Thu Oct  2 02:13:53 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Wed, 1 Oct 2008 21:13:53 -0400
Subject: [rabbitmq-discuss] Rabbitmqctl issues
In-Reply-To: <d272f0690810011545m9f0361kee713ca5f8eedf76@mail.gmail.com>
References: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
	<d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>
	<6c2563b20810011424sb0c9952ka4800ce20f4d6298@mail.gmail.com>
	<d272f0690810011507s415dfa8s82add6a5d1bc3826@mail.gmail.com>
	<6c2563b20810011515q3f14286cw1fb3efe41b15f454@mail.gmail.com>
	<d272f0690810011545m9f0361kee713ca5f8eedf76@mail.gmail.com>
Message-ID: <6c2563b20810011813g4eef8e7ds3e686ef388de4529@mail.gmail.com>

Great!!

On Wed, Oct 1, 2008 at 6:45 PM, Alex Clemesha <clemesha at gmail.com> wrote:

>
>
> On Wed, Oct 1, 2008 at 3:15 PM, Edwin Fine <rabbitmq-discuss_efine at usa.net
> > wrote:
>
>> I wasn't sure from your response - does it work now? :)
>>
> Looks like it does, below's the proof :-)
>
> Status of node rabbit at dj ...
> [{running_applications,[{rabbit,"RabbitMQ","1.4.0"},
>                         {mnesia,"MNESIA  CXC 138 12","4.3.5"},
>                         {os_mon,"CPO  CXC 138 46","2.1.2.1"},
>                         {sasl,"SASL  CXC 138 11","2.1.5.1"},
>                         {stdlib,"ERTS  CXC 138 10","1.14.5"},
>                         {kernel,"ERTS  CXC 138 10","2.11.5"}]},
>  {nodes,[rabbit at dj]},
>  {running_nodes,[rabbit at dj]}]
> done.
>
>
> thanks!
> -Alex
>
>
>
>
>
>>
>>
>> On Wed, Oct 1, 2008 at 6:07 PM, Alex Clemesha <clemesha at gmail.com> wrote:
>>
>>>
>>>
>>> On Wed, Oct 1, 2008 at 2:24 PM, Edwin Fine <
>>> rabbitmq-discuss_efine at usa.net> wrote:
>>>
>>>> Would you like to try this?
>>>>
>>>> Please ensure that you are using the same Erlang cookie that Rabbit was
>>>> started with. This is in a file is named $HOME/.erlang.cookie where $HOME is
>>>> the directory of the user that started rabbitmq. If you try to run commands
>>>> that connect to the rabbitmq Erlang node, using a different user name, even
>>>> as root, if it does not have the same cookie file, the commands will fail.
>>>>
>>>> It's best to control rabbit exclusively as one user, for example as the
>>>> rabbit user.
>>>>
>>> Great, thanks for the tip.  I was in fact using a different user, so I'll
>>> use the rabbit user from now on.
>>>
>>>
>>>
>>>
>>>>
>>>>
>>>> Hope this helps,
>>>> Edwin
>>>>
>>>>
>>>> On Wed, Oct 1, 2008 at 4:52 PM, Alex Clemesha <clemesha at gmail.com>wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> I also run into the same thing (actually happened ~15 minutes ago), I'm
>>>>> using Ubuntu 8.04.
>>>>> (installed RabbitMQ by adding the relevant line to
>>>>> /etc/apt/source.list, then using apt-get).
>>>>>
>>>>> I usually just find the relevant processes and kill them, then run
>>>>> 'rabbitmq-server -detached'
>>>>> to start things back up.
>>>>>
>>>>> I just assumed I was missing something (maybe I still am :-)
>>>>>
>>>>> thanks
>>>>> -Alex
>>>>>
>>>>>
>>>>> On Wed, Oct 1, 2008 at 1:29 PM, Peter Kieltyka <
>>>>> peter.kieltyka at gmail.com> wrote:
>>>>>
>>>>>> Hello everyone,
>>>>>>
>>>>>> For the longest time, I've struggled to be able to control the server
>>>>>> to do basic start/stop/restart commands.
>>>>>>
>>>>>> Currently on my production server I am running Debian Etch where I
>>>>>> followed the instructions at http://www.rabbitmq.com/debian.html to
>>>>>> install Rabbit.
>>>>>>
>>>>>> Running the rabbitmq-server or rabbitmq-multi start_all 1 commands
>>>>>> will bring the server online, however to stop it, or add a user none
>>>>>> of the scripts work. I am always presented with an error, bad_node.
>>>>>>
>>>>>> I.e.
>>>>>>
>>>>>> Creating user "patbroker" ...
>>>>>> rabbit_control action add_user failed:
>>>>>> {badrpc,nodedown}
>>>>>>
>>>>>> However, I can confirm that Rabbit is running fine because my
>>>>>> application is working just fine. I've even tried explicitly
>>>>>> specifying the -n rabbit at broker (hostname -s returns broker).
>>>>>>
>>>>>> The same goes for stopping the server, either using /etc/init.d/
>>>>>> rabbitmq-server stop, or calling "rabbitmq-multi stop_all" directly
>>>>>> will result in:
>>>>>>
>>>>>> Stopping all nodes...
>>>>>>
>>>>>> rabbit_multi action stop_all failed:
>>>>>> no_nodes_running
>>>>>>
>>>>>> Thanks.
>>>>>>
>>>>>> Peter
>>>>>>
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>
>>>>>
>>>>>
>>>>>
>>>>> --
>>>>> Alex Clemesha
>>>>> clemesha.org
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>
>>>
>>>
>>> --
>>> Alex Clemesha
>>> clemesha.org
>>>
>>
>>
>
>
> --
> Alex Clemesha
> clemesha.org
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081001/ff4d5340/attachment.htm 

From gsim at redhat.com  Thu Oct  2 08:41:19 2008
From: gsim at redhat.com (Gordon Sim)
Date: Thu, 02 Oct 2008 08:41:19 +0100
Subject: [rabbitmq-discuss] Redelivery of unacknowledged messages
In-Reply-To: <4cc167ca0810011748k4ebd4384m6f54a288dda4effd@mail.gmail.com>
References: <4cc167ca0809291434td4d7674tf493b460fa67b74c@mail.gmail.com>	<269388e30809291759u620ec14fyf63cc6643b7f69ff@mail.gmail.com>	<48E1CED0.8020607@lshift.net>
	<4cc167ca0810011748k4ebd4384m6f54a288dda4effd@mail.gmail.com>
Message-ID: <48E47B1F.5000703@redhat.com>

Jonatan Kallus wrote:
> Is it meant to work like this or is it a matter of a feature not being 
> implemented yet?
> 
> In my current implementation I am closing the channel occasionally, for 
> no particular reason, but to get the redeliveries. 

You could use basic.recover(): "This method asks the broker to redeliver 
all unacknowledged messages on a specified channel".

There is a 'requeue' argument to that method: "If this field is zero, 
the message will be redelivered to the original recipient. If this bit 
is 1, the server will attempt to requeue the message, potentially then 
delivering it to an alternative subscriber."

> This causes the 
> processing to temporarily stop or slow down since I have to wait for all 
> tasks to be done and acked before I can close the channel. (Since 
> messages need to be acked on the same channel they were received on, as 
> far as I know.)

I'm a bit confused by this... if you ack all the messages on the 
channel, closing it will not result in any redeliveries?

> It would probably be possible to have two parallel channels open, one 
> active (receiving new tasks) and one waiting for its tasks to be done 
> and acked, then closing the inactive one, making the previously active 
> one passive and opening a new active channel. This would add the 
> complexity of keeping track of what message that should be acked on what 
> channel.
> 
> Are there any good patterns to handle this?

What is the motivation for wanting messages to be redelivered?



From 0x6e6562 at gmail.com  Thu Oct  2 08:40:21 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 2 Oct 2008 08:40:21 +0100
Subject: [rabbitmq-discuss] Redelivery of unacknowledged messages
In-Reply-To: <4cc167ca0810011748k4ebd4384m6f54a288dda4effd@mail.gmail.com>
References: <4cc167ca0809291434td4d7674tf493b460fa67b74c@mail.gmail.com>
	<269388e30809291759u620ec14fyf63cc6643b7f69ff@mail.gmail.com>
	<48E1CED0.8020607@lshift.net>
	<4cc167ca0810011748k4ebd4384m6f54a288dda4effd@mail.gmail.com>
Message-ID: <269388e30810020040q6dce1225h94e3d5c67fae477d@mail.gmail.com>

Jonatan,

On Thu, Oct 2, 2008 at 1:48 AM, Jonatan Kallus <jonatan at heysan.com> wrote:
> Is it meant to work like this or is it a matter of a feature not being
> implemented yet?

The real problem that you have here is that the Basic.Reject command
as specified in the AMQP protocol is not implemented in RabbitMQ :-(

There is a compatibility matrix here: http://www.rabbitmq.com/compatibility.html

The reason was because the reject behaviour specified in 0-8 of the
spec was a bit tricky. Also we have only been asked by one other
person to implement this functionality, hence it has been
de-prioritized.

However, it is a roadmap item, because we want to be fully spec
compliant after 0.91 is signed off.

I can't give you an ETA on this feature, it will get done when time
and resources permit.

In the meantime, the example I posted previously is just a workaround
for the lack of Basic.Reject.

> In my current implementation I am closing the channel occasionally, for no
> particular reason, but to get the redeliveries. This causes the processing
> to temporarily stop or slow down since I have to wait for all tasks to be
> done and acked before I can close the channel. (Since messages need to be
> acked on the same channel they were received on, as far as I know.)
>
> It would probably be possible to have two parallel channels open, one active
> (receiving new tasks) and one waiting for its tasks to be done and acked,
> then closing the inactive one, making the previously active one passive and
> opening a new active channel. This would add the complexity of keeping track
> of what message that should be acked on what channel.

Yes, it's clunky. A good solution would be to convince us to implement
this feature :-)

> Are there any good patterns to handle this?

Maybe you can describe the specific use case that requires you to have
redeliveries before we talk about strategies to deal with them.

Ben



From 0x6e6562 at gmail.com  Thu Oct  2 21:57:33 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 2 Oct 2008 21:57:33 +0100
Subject: [rabbitmq-discuss] AS3 library under windows
Message-ID: <269388e30810021357o456213dfm7c63ccaee59b16a3@mail.gmail.com>

Anne,

I don't suppose you are still looking into the issues you were having
with the AS3 client, but I just wanted to let you know that you did
actually have a real issue, for which I found a solution today.

It turns out the the way socket IO is handled under windows differs
from the behavior seen on OSX, although we are talking about a virtual
machine.

I wrote a test to isolate the socket library and ran it against a
simple Echo server -  the difference between Windows and OSX is that
the client has to explicitly flush the socket every time it wants to
send a command. On OSX this is not necessary.

So the fix, although it took a very long time to isolate, was one line of code.

Ben



From norbu09 at googlemail.com  Fri Oct  3 03:04:10 2008
From: norbu09 at googlemail.com (lenz)
Date: Fri, 3 Oct 2008 15:04:10 +1300
Subject: [rabbitmq-discuss] amqp_rpc_client and lib_amqp
Message-ID: <e25246b60810021904h38072246u2bda3a1799b7a057@mail.gmail.com>

hi,
i have somehow clumsy fingers. i try to get a test script working that uses
the erlang rpc client and lib_amqp but i fail miserably. is there somewhere
a short snippet that actually uses those two libs to post messages to
rabbit? my (very short) test thingy looks currently like that (many
iterations old though)

---------------------8<------------------

-module(test).

-include_lib("rabbitmq_server/include/rabbit_framing.hrl").
-include_lib("rabbitmq_server/include/rabbit.hrl").
-include("include/amqp_client.hrl").

-export([channel/0, broker/0, start/0]).

channel() ->
    C=lib_amqp:start_connection("localhost"),
    Channel=lib_amqp:start_channel(C),
    {ok, Channel}.

broker ()->
    {ok, Channel} = channel(),
    Broker = #broker_config{channel_pid = Channel},
    {ok, Broker}.

start() ->
    {ok, Broker} = broker(),
    amqp_rpc_client:start(Broker, <<"Hessian">>).

--------------------->8------------------

thanks for all hints in the right direction :-)

cheers
lenz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081003/1fddc60e/attachment.htm 

From matthias at lshift.net  Fri Oct  3 03:25:08 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 03 Oct 2008 03:25:08 +0100
Subject: [rabbitmq-discuss] Redelivery of unacknowledged messages
In-Reply-To: <269388e30810020040q6dce1225h94e3d5c67fae477d@mail.gmail.com>
References: <4cc167ca0809291434td4d7674tf493b460fa67b74c@mail.gmail.com>	<269388e30809291759u620ec14fyf63cc6643b7f69ff@mail.gmail.com>	<48E1CED0.8020607@lshift.net>	<4cc167ca0810011748k4ebd4384m6f54a288dda4effd@mail.gmail.com>
	<269388e30810020040q6dce1225h94e3d5c67fae477d@mail.gmail.com>
Message-ID: <48E58284.4000700@lshift.net>

Ben Hood wrote:
> The real problem that you have here is that the Basic.Reject command
> as specified in the AMQP protocol is not implemented in RabbitMQ :-(

I am not at all sure that Basic.Reject is what Jonatan needs.

Jonatan, as Gordon suggested, please provide some more details on what 
you are trying to do.

Are you using RabbitMQ to distribute tasks to workers and are trying to 
gracefully shift the workload from one worker process to another? If so, 
simply cancel the subscription of the first worker and create a 
subscription for the second worker.


Matthias.



From 0x6e6562 at gmail.com  Fri Oct  3 07:35:41 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 3 Oct 2008 07:35:41 +0100
Subject: [rabbitmq-discuss] Redelivery of unacknowledged messages
In-Reply-To: <48E58284.4000700@lshift.net>
References: <4cc167ca0809291434td4d7674tf493b460fa67b74c@mail.gmail.com>
	<269388e30809291759u620ec14fyf63cc6643b7f69ff@mail.gmail.com>
	<48E1CED0.8020607@lshift.net>
	<4cc167ca0810011748k4ebd4384m6f54a288dda4effd@mail.gmail.com>
	<269388e30810020040q6dce1225h94e3d5c67fae477d@mail.gmail.com>
	<48E58284.4000700@lshift.net>
Message-ID: <269388e30810022335i57fd37b2xc019aa811cabef1a@mail.gmail.com>

Matthias,

On Fri, Oct 3, 2008 at 3:25 AM, Matthias Radestock <matthias at lshift.net> wrote:
> I am not at all sure that Basic.Reject is what Jonatan needs.

Potentially not. I probably left too much of the original context of a
similar question that I answered off list last week. I did ask that
person I they would mind me turning their conversation into a list
topic for the benefit of everybody, but they never did get back to me.
So you and Gordon rightfully point out, it would be better if Jonatan
told us exactly what functionality his application requires.

Ben



From denchevb at yahoo.com  Fri Oct  3 08:08:58 2008
From: denchevb at yahoo.com (deuce)
Date: Fri, 3 Oct 2008 00:08:58 -0700 (PDT)
Subject: [rabbitmq-discuss]  RabbitMQ erlang broker problem
Message-ID: <19727032.post@talk.nabble.com>


I keep getting this entry in the rabbit_persister.LOG 
dirty_work
deliverh
resourcem
"queue name"

I can't figure out what it means but it appears every time a message goes
thru the message broker eventually causing it to crash with out of memory
error.
Please help. 


-- 
View this message in context: http://www.nabble.com/RabbitMQ-erlang-broker-problem-tp19727032p19727032.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From 0x6e6562 at gmail.com  Fri Oct  3 10:57:34 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 3 Oct 2008 10:57:34 +0100
Subject: [rabbitmq-discuss] amqp_rpc_client and lib_amqp
In-Reply-To: <e25246b60810021904h38072246u2bda3a1799b7a057@mail.gmail.com>
References: <e25246b60810021904h38072246u2bda3a1799b7a057@mail.gmail.com>
Message-ID: <269388e30810030257lbc09d82oba90a3502106d45a@mail.gmail.com>

Lenz,

On Fri, Oct 3, 2008 at 3:04 AM, lenz <norbu09 at googlemail.com> wrote:
> hi,
> i have somehow clumsy fingers. i try to get a test script working that uses
> the erlang rpc client and lib_amqp but i fail miserably. is there somewhere
> a short snippet that actually uses those two libs to post messages to
> rabbit?

Have you looked at the unit tests that are in the same source tree as
the client?

If not, take a look at the test_util module.

HTH,

Ben



From 0x6e6562 at gmail.com  Fri Oct  3 13:00:48 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 3 Oct 2008 13:00:48 +0100
Subject: [rabbitmq-discuss] RabbitMQ erlang broker problem
In-Reply-To: <19727032.post@talk.nabble.com>
References: <19727032.post@talk.nabble.com>
Message-ID: <269388e30810030500x6a0ecb1dg7dac5c52ab4ccd2d@mail.gmail.com>

Deuce,

On Fri, Oct 3, 2008 at 8:08 AM, deuce <denchevb at yahoo.com> wrote:
>
> I keep getting this entry in the rabbit_persister.LOG

rabbit_persister.LOG is not a log file for information purposes, it is
a write-ahead disk log for persistent messages.

In essence it is the journal from which unacknowledged messages will
be replayed in the (unlikely :-) event of Rabbit crashing.

The log file that you may be looking for is called ${NODE_NAME}.log
(generally rabbit.log), and it's location will depend on the OS you
are running.

> I can't figure out what it means but it appears every time a message goes
> thru the message broker eventually causing it to crash with out of memory
> error.

Well I need some information than that to help diagnose the issue, e.g.

- The real log file
- Details about your installed verison of Rabbit, the OS and Erlang OTP
- What symptoms you experience
- What it was that you were doing that caused the issue (e.g. example
code is always good)

HTH,

Ben



From 0x6e6562 at gmail.com  Fri Oct  3 13:12:31 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 3 Oct 2008 13:12:31 +0100
Subject: [rabbitmq-discuss] amqp_rpc_client and lib_amqp
In-Reply-To: <e25246b60810021904h38072246u2bda3a1799b7a057@mail.gmail.com>
References: <e25246b60810021904h38072246u2bda3a1799b7a057@mail.gmail.com>
Message-ID: <269388e30810030512x4068706fieb773f1f5112cff0@mail.gmail.com>

Lenz,

On Fri, Oct 3, 2008 at 3:04 AM, lenz <norbu09 at googlemail.com> wrote:
> i have somehow clumsy fingers. i try to get a test script working that uses
> the erlang rpc client and lib_amqp but i fail miserably.

Sorry I overlooked the fact that you are looking into the
amqp_rpc_client module in my previous response (although it was in the
title of the post).

I just wanted to point out that efforts are underway to bring the
Erlang client up to a 1.0 state, which involves the simpification of
the rpc components. There is a patch for this in hg if you are
interested (19344 refers). At some stage soon this can get finished
and QA'ed into the main tree, but, as usual, there is no ETA on this.

This means that the way you use the rpc modules will change soon.

HTH,

Ben



From jonatan at heysan.com  Fri Oct  3 18:26:23 2008
From: jonatan at heysan.com (Jonatan Kallus)
Date: Fri, 3 Oct 2008 10:26:23 -0700
Subject: [rabbitmq-discuss] Redelivery of unacknowledged messages
In-Reply-To: <269388e30810022335i57fd37b2xc019aa811cabef1a@mail.gmail.com>
References: <4cc167ca0809291434td4d7674tf493b460fa67b74c@mail.gmail.com>
	<269388e30809291759u620ec14fyf63cc6643b7f69ff@mail.gmail.com>
	<48E1CED0.8020607@lshift.net>
	<4cc167ca0810011748k4ebd4384m6f54a288dda4effd@mail.gmail.com>
	<269388e30810020040q6dce1225h94e3d5c67fae477d@mail.gmail.com>
	<48E58284.4000700@lshift.net>
	<269388e30810022335i57fd37b2xc019aa811cabef1a@mail.gmail.com>
Message-ID: <4cc167ca0810031026n7a8fd577vf297f695dd476bd5@mail.gmail.com>

Ben, Mathias, Gordon,

Thanks for your answers.

The system around the queue involves a few web servers using php to enqueue
messages at almost every page load and a single java application that
subscribes to the queue and makes one http request to another site for each
message. (To take load off from the web servers and to make their flow
asynchronous, in opposite to when they made the http request themselves.)
The http request usually takes around 50 ms, but sometimes more and
sometimes they fail or timeout after 60 s. We are using a number of
concurrent connections for the http client, not to let a single http request
timing out block the queue. The RabbitMQ subscriber starts threads that
handles the http requests as long as there are available http connections,
if there are no available http connections, the handleDelivery method waits
(while-loop) for a free connection, thus blocking from receiving more
messages until there is time to handle them.

Currently I acknowledge messages that results in a successful http request,
but any message that fails due to issues outside of our system (timeouts
etc.) does not get acknowledged, since we want them to be delivered again
later.

I am trying not to have any concept of a queue inside of the java
applications since that is the MQs responsibility and to avoid loss of
messages on a crash.

Since I started this thread I have realized that it might be smarter to
retry with messages that fail due to timeouts until they succeed instead of
throwing them away and wait for a redelivery.

It is not an issue of load balancing and to do it the way I do it now,
basic.reject is probably what I need.

I'm thankful for, and interested in, any thoughts and ideas.

On Thu, Oct 2, 2008 at 11:35 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Matthias,
>
> On Fri, Oct 3, 2008 at 3:25 AM, Matthias Radestock <matthias at lshift.net>
> wrote:
> > I am not at all sure that Basic.Reject is what Jonatan needs.
>
> Potentially not. I probably left too much of the original context of a
> similar question that I answered off list last week. I did ask that
> person I they would mind me turning their conversation into a list
> topic for the benefit of everybody, but they never did get back to me.
> So you and Gordon rightfully point out, it would be better if Jonatan
> told us exactly what functionality his application requires.
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081003/7029829d/attachment.htm 

From 0x6e6562 at gmail.com  Fri Oct  3 18:57:58 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 3 Oct 2008 18:57:58 +0100
Subject: [rabbitmq-discuss] Redelivery of unacknowledged messages
In-Reply-To: <4cc167ca0810031023i3b0d3dd7t822066682837b896@mail.gmail.com>
References: <4cc167ca0809291434td4d7674tf493b460fa67b74c@mail.gmail.com>
	<269388e30809291759u620ec14fyf63cc6643b7f69ff@mail.gmail.com>
	<48E1CED0.8020607@lshift.net>
	<4cc167ca0810011748k4ebd4384m6f54a288dda4effd@mail.gmail.com>
	<269388e30810020040q6dce1225h94e3d5c67fae477d@mail.gmail.com>
	<48E58284.4000700@lshift.net>
	<269388e30810022335i57fd37b2xc019aa811cabef1a@mail.gmail.com>
	<4cc167ca0810031023i3b0d3dd7t822066682837b896@mail.gmail.com>
Message-ID: <269388e30810031057g71d6e11ex9c2d8464f4d75f18@mail.gmail.com>

Jonatan,

On Fri, Oct 3, 2008 at 6:23 PM, Jonatan Kallus <jonatan.kallus at gmail.com> wrote:
> The system around the queue involves a few web servers using php to enqueue
> messages at almost every page load and a single java application that
> subscribes to the queue and makes one http request to another site for each
> message. (To take load off from the web servers and to make their flow
> asynchronous, in opposite to when they made the http request themselves.)
> The http request usually takes around 50 ms, but sometimes more and
> sometimes they fail or timeout after 60 s. We are using a number of
> concurrent connections for the http client, not to let a single http request
> timing out block the queue. The RabbitMQ subscriber starts threads that
> handles the http requests as long as there are available http connections,
> if there are no available http connections, the handleDelivery method waits
> (while-loop) for a free connection, thus blocking from receiving more
> messages until there is time to handle them.
>
> Currently I acknowledge messages that results in a successful http request,
> but any message that fails due to issues outside of our system (timeouts
> etc.) does not get acknowledged, since we want them to be delivered again
> later.


So if I understand you correctly, the problem that may arise is not an
issue with the message per se, but one of the availability of the
downstream system.

In which case it may be an idea to retry the downstream system,
potentially n times.

After n retries, you might decide that it's pointless to continue, so
you just end the channel (unacked messages get requeued) and tell your
friendly sysad that something is wrong with the other system.

In this case, it wouldn't help to be able to reject the message,
since, if I understand you correctly, the next message may also have a
reasonable chance of failing as well.

In this particular scenario, message rejection as an exception
management strategy is too fine grained, because the actual root cause
of the errors is very coarse grained - the downstream system has
barfed. Hence you might want to reflect this situation by ceasing to
try to send it anything at all.

After the issue with the downstream system is resolved, restart the
consumer(s) and resume processing.

Basic.Reject is a fine grained mechanism - it is sent by a particular
consumer to the broker with a "don't send me this one again"
sentiment.

It is also an academic mechanism in RabbitMQ, because it isn't implemented :-(

HTH,

Ben



From vanpelt at gmail.com  Fri Oct  3 21:21:17 2008
From: vanpelt at gmail.com (Chris Van Pelt)
Date: Fri, 3 Oct 2008 13:21:17 -0700
Subject: [rabbitmq-discuss] Improved queue status
Message-ID: <9d5c45d10810031321y20b6c093s89b0e49d4741880@mail.gmail.com>

While using rabbitmq recently I was surprised to discover there is no
reliable way to introspect the status of a given queue.  Specifically the
amount of pending items in a queue.  Because items are sent to consumers in
batch, if I do a passive declare on a queue my message count is 0 even
though I may have 1000 items waiting in the TCP buffer of my consumer.  This
becomes a big issue if my items are taking more than 5 seconds to complete.
The reason I want this information is so that I can intelligently add more
consumers as load fluctuates.

The simplest way to solve this issue in my mind would be for rabbitmq to be
able to return the number of un-acked items in a given queue.  Has there
been any discussion of this?  My current approach is to make Get requests
instead of consuming a queue.

Also, rabbitmq kicks ass!!  Thanks for all the hard work.

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081003/c34a1ac7/attachment.htm 

From norbu09 at googlemail.com  Fri Oct  3 22:30:06 2008
From: norbu09 at googlemail.com (lenz)
Date: Sat, 4 Oct 2008 10:30:06 +1300
Subject: [rabbitmq-discuss] amqp_rpc_client and lib_amqp
In-Reply-To: <269388e30810030512x4068706fieb773f1f5112cff0@mail.gmail.com>
References: <e25246b60810021904h38072246u2bda3a1799b7a057@mail.gmail.com>
	<269388e30810030512x4068706fieb773f1f5112cff0@mail.gmail.com>
Message-ID: <e25246b60810031430w64087f31ga8b9427b14de4a00@mail.gmail.com>

sorry, i did not recognize that after the last pull of the repository (when
i got the rcp sources) the test files changed as well ... thanks for the
hint
lenz

On Sat, Oct 4, 2008 at 1:12 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Lenz,
>
> On Fri, Oct 3, 2008 at 3:04 AM, lenz <norbu09 at googlemail.com> wrote:
> > i have somehow clumsy fingers. i try to get a test script working that
> uses
> > the erlang rpc client and lib_amqp but i fail miserably.
>
> Sorry I overlooked the fact that you are looking into the
> amqp_rpc_client module in my previous response (although it was in the
> title of the post).
>
> I just wanted to point out that efforts are underway to bring the
> Erlang client up to a 1.0 state, which involves the simpification of
> the rpc components. There is a patch for this in hg if you are
> interested (19344 refers). At some stage soon this can get finished
> and QA'ed into the main tree, but, as usual, there is no ETA on this.
>
> This means that the way you use the rpc modules will change soon.
>
> HTH,
>
> Ben
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081004/3ab72769/attachment.htm 

From tsuraan at gmail.com  Fri Oct  3 23:20:42 2008
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 3 Oct 2008 17:20:42 -0500
Subject: [rabbitmq-discuss] rabbit_persister:extend_transaction in chunks?
Message-ID: <84fb38e30810031520o4c9c13acr3fee8ae412ef70ca@mail.gmail.com>

In rabbit_amqqueue_process:terminate, all buffered messages are sent
to rabbit_persister:extend_transaction as a huge chunk (slightly
modified to look like acks instead of just a list of messages, I
guess).  It looks like it would be safe to send these messages in
batches instead of as a huge list, but I'm not sure.  Can somebody
confirm that sending batches of (for example) 1024 { ack, { QName,
PKey }} tuples to extend_transaction would be the same as sending all
of the tuples in one huge list?



From matthias at lshift.net  Fri Oct  3 23:39:18 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 03 Oct 2008 23:39:18 +0100
Subject: [rabbitmq-discuss] rabbit_persister:extend_transaction in
	chunks?
In-Reply-To: <84fb38e30810031520o4c9c13acr3fee8ae412ef70ca@mail.gmail.com>
References: <84fb38e30810031520o4c9c13acr3fee8ae412ef70ca@mail.gmail.com>
Message-ID: <48E69F16.5030806@lshift.net>

Tsuraan,

tsuraan wrote:
> In rabbit_amqqueue_process:terminate, all buffered messages are sent
> to rabbit_persister:extend_transaction as a huge chunk (slightly
> modified to look like acks instead of just a list of messages, I
> guess).

What is actually happening is that the ack work items (not the messages) 
are passed to rabbit_persister:dirty_work (not extend_transaction).

> It looks like it would be safe to send these messages in
> batches instead of as a huge list, but I'm not sure.  Can somebody
> confirm that sending batches of (for example) 1024 { ack, { QName,
> PKey }} tuples to extend_transaction would be the same as sending all
> of the tuples in one huge list?

That would work, but why would you want to do that? Have you obtained 
some measurements indicating that there is a performance problem in that 
area?


Matthias



From matthias at lshift.net  Sat Oct  4 00:03:19 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 04 Oct 2008 00:03:19 +0100
Subject: [rabbitmq-discuss] Improved queue status
In-Reply-To: <9d5c45d10810031321y20b6c093s89b0e49d4741880@mail.gmail.com>
References: <9d5c45d10810031321y20b6c093s89b0e49d4741880@mail.gmail.com>
Message-ID: <48E6A4B7.90701@lshift.net>

Chris,

Chris Van Pelt wrote:
> if I do a passive declare on a queue my message 
> count is 0 even though I may have 1000 items waiting in the TCP buffer 
> of my consumer.  This becomes a big issue if my items are taking more 
> than 5 seconds to complete.  The reason I want this information is so 
> that I can intelligently add more consumers as load fluctuates.

By the time there are 1000 items in the TCP buffer of the existing 
consumer isn't it too late to add more consumers?

> The simplest way to solve this issue in my mind would be for rabbitmq to 
> be able to return the number of un-acked items in a given queue.  Has 
> there been any discussion of this?

With basic.qos (which has been on our todo list for a while - sorry, 
some other items have higher priority) one can limit the number of 
unacknowledged messages per channel. Down to one if you wanted to, i.e. 
a client would have to ack a message before the server sends it another one.

That provides a fine degree of control over the maximum number of 
messages to keep in flight, and allows messages to stay queued up where 
they belong - at the server. It also makes the message count returned by 
queue.declare a reasonable parameter to guide consumer creation in the 
way you envisage.

> Also, rabbitmq kicks ass!!

Thanks. Glad you like it. Keep the questions coming.


Regards,

Matthias.



From tsuraan at gmail.com  Sat Oct  4 03:15:05 2008
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 3 Oct 2008 21:15:05 -0500
Subject: [rabbitmq-discuss] rabbit_persister:extend_transaction in
	chunks?
In-Reply-To: <48E69F16.5030806@lshift.net>
References: <84fb38e30810031520o4c9c13acr3fee8ae412ef70ca@mail.gmail.com>
	<48E69F16.5030806@lshift.net>
Message-ID: <84fb38e30810031915l577d4336wad198b70b75aad95@mail.gmail.com>

> That would work, but why would you want to do that? Have you obtained
> some measurements indicating that there is a performance problem in that
> area?

No, not a performance issue, but a memory one.  I have a file-based
queue implementation now, and it looks like it's easy enough to drop
into the rabbit_amqqueue_process, with the exception of where it calls
queue:to_list in purge_message_buffer.  I'd like to avoid having to
have the to_list called, and instead just grab a few (thousand)
messages at a time and call extend_transaction on the chunks.



From matthias at lshift.net  Sat Oct  4 05:22:28 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 04 Oct 2008 05:22:28 +0100
Subject: [rabbitmq-discuss] rabbit_persister:extend_transaction in
	chunks?
In-Reply-To: <84fb38e30810031915l577d4336wad198b70b75aad95@mail.gmail.com>
References: <84fb38e30810031520o4c9c13acr3fee8ae412ef70ca@mail.gmail.com>	<48E69F16.5030806@lshift.net>
	<84fb38e30810031915l577d4336wad198b70b75aad95@mail.gmail.com>
Message-ID: <48E6EF84.9080205@lshift.net>

Tsuraan,

tsuraan wrote:
>> That would work, but why would you want to do that? Have you obtained
>> some measurements indicating that there is a performance problem in that
>> area?
> 
> No, not a performance issue, but a memory one.

The memory required for the list is linear in the size of the queue and 
independent of the message payload size (because payloads are binaries 
and thus not copied). So normally this shouldn't be an issue. But ...

> I have a file-based queue implementation now,

This changes things since it means the memory footprint of your queues 
is potentially constant rather than O(n), and you want to keep it that 
way. I understand the motivation for your question now.

> it looks like it's easy enough to drop into the
> rabbit_amqqueue_process, with the exception of where it calls
> queue:to_list in purge_message_buffer. I'd like to avoid having to
> have the to_list called, and instead just grab a few (thousand)
> messages at a time and call extend_transaction on the chunks.

It is safe to call extend_transaction and dirty_work (which is what 
actually gets called in the above case) multiple times. Also note that 
you do not need to materialise the entire messages - you just need their 
persistent_keys.


Matthias.



From alexis.richardson at cohesiveft.com  Sat Oct  4 12:01:20 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sat, 4 Oct 2008 12:01:20 +0100
Subject: [rabbitmq-discuss] potentially stupid question
Message-ID: <167204d20810040401y24e42921y373af84cb1151032@mail.gmail.com>

Hi all,

Does anyone know anything about this?  It looks like it was discussed
on #erlang.

 http://paste.lisp.org/display/67113

%%%-------------------------------------------------------------------
%%% File    : amqp_cli.erl
%%% @author Jake <jake at cogini.com>
%%% Description : AMQP client utility functions
%%%
%%% Created : 2008-03-15 by Jake
%%%-------------------------------------------------------------------

....

alexis



From hbayhantopcu at gmail.com  Sun Oct  5 04:20:23 2008
From: hbayhantopcu at gmail.com (Haldun Bayhantopcu)
Date: Sun, 5 Oct 2008 05:20:23 +0200
Subject: [rabbitmq-discuss] Sent and received message counts don't match
Message-ID: <5DF69AD0-B4AB-4013-8C4C-7060263251D5@gmail.com>

Hi all,

I'm trying to warm myself up with amqp and in particularly rabbitmq.
I wrote some python scripts just to send and receive messages based
on the demos that I've found in py-amqplib's repository. However, I
encounter a situation that I did not expect.

There is a producer script which produces 1000 messages containing
random phrases and sends them to a fanout exchange.[1] It prints the
number of sent messages as 1000, which I think that 1000 messages
delivered successfully to rabbitmq.

There are two consumer scripts[2,3] The first one just tries to
get messages one by one with channel.basic_get(queue_name) resulting
saying that it gets 998 messages. The second one uses a callback
technique which I copied from the demo code. It prints ~500
messages to the screen and seems to be stalled. And for one
reason that I don't understand yet, the second consumer script
fetches messages very fast than the first one.

The codes are using py-amqplib, and their addresses are pasted
below.

Do I make completely wrong at something?

Thanks in advance,
Haldun.

[1] http://pastebin.com/f29a4811
[2] http://pastebin.com/f33fffd26
[3] http://pastebin.com/f7f6f3a45




From matthias at lshift.net  Sun Oct  5 17:58:50 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 05 Oct 2008 17:58:50 +0100
Subject: [rabbitmq-discuss] Sent and received message counts don't match
In-Reply-To: <5DF69AD0-B4AB-4013-8C4C-7060263251D5@gmail.com>
References: <5DF69AD0-B4AB-4013-8C4C-7060263251D5@gmail.com>
Message-ID: <48E8F24A.1010802@lshift.net>

Haldun,

Haldun Bayhantopcu wrote:
> There is a producer script which produces 1000 messages containing
> random phrases and sends them to a fanout exchange.[1] It prints the
> number of sent messages as 1000, which I think that 1000 messages
> delivered successfully to rabbitmq.
> 
> There are two consumer scripts[2,3] The first one just tries to
> get messages one by one with channel.basic_get(queue_name) resulting
> saying that it gets 998 messages. The second one uses a callback
> technique which I copied from the demo code. It prints ~500
> messages to the screen and seems to be stalled. And for one
> reason that I don't understand yet, the second consumer script
> fetches messages very fast than the first one.

Are you starting the consumer programs *after* the producer? If so then 
any messages published before the consumer programs create & bind their 
queues will be lost since the 'myfan' exchange has no place to route 
them to.

Also, the producer does not close the connection properly with 
conn.close. This too may result in messages getting dropped.

As for the comparative speed of the two consumer scripts - basic.consume 
is a more efficient way of consuming messages than basic.get, since the 
latter retrieves messages one at a time.

HTH.

Matthias.



From vanpelt at gmail.com  Sun Oct  5 19:34:48 2008
From: vanpelt at gmail.com (Chris Van Pelt)
Date: Sun, 5 Oct 2008 11:34:48 -0700
Subject: [rabbitmq-discuss] Improved queue status
In-Reply-To: <48E6A4B7.90701@lshift.net>
References: <9d5c45d10810031321y20b6c093s89b0e49d4741880@mail.gmail.com>
	<48E6A4B7.90701@lshift.net>
Message-ID: <9d5c45d10810051134x298b5664q4203cc3df45e27a0@mail.gmail.com>

Yeah, I picked 1000 because that seemed like a reasonable max... at some
point the TCP buffer fills up?  Basic.qos sounds like it is the answer to
all my concerns.  I look forward to seeing this feature!

Cheers,

Chris

On Fri, Oct 3, 2008 at 4:03 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Chris,
>
> Chris Van Pelt wrote:
>
>> if I do a passive declare on a queue my message count is 0 even though I
>> may have 1000 items waiting in the TCP buffer of my consumer.  This becomes
>> a big issue if my items are taking more than 5 seconds to complete.  The
>> reason I want this information is so that I can intelligently add more
>> consumers as load fluctuates.
>>
>
> By the time there are 1000 items in the TCP buffer of the existing consumer
> isn't it too late to add more consumers?
>
>  The simplest way to solve this issue in my mind would be for rabbitmq to
>> be able to return the number of un-acked items in a given queue.  Has there
>> been any discussion of this?
>>
>
> With basic.qos (which has been on our todo list for a while - sorry, some
> other items have higher priority) one can limit the number of unacknowledged
> messages per channel. Down to one if you wanted to, i.e. a client would have
> to ack a message before the server sends it another one.
>
> That provides a fine degree of control over the maximum number of messages
> to keep in flight, and allows messages to stay queued up where they belong -
> at the server. It also makes the message count returned by queue.declare a
> reasonable parameter to guide consumer creation in the way you envisage.
>
>  Also, rabbitmq kicks ass!!
>>
>
> Thanks. Glad you like it. Keep the questions coming.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081005/b7c1941e/attachment.htm 

From michel.polder at quality-it.com  Mon Oct  6 14:14:18 2008
From: michel.polder at quality-it.com (Michel Polder)
Date: Mon, 6 Oct 2008 15:14:18 +0200
Subject: [rabbitmq-discuss] RabbitMQ C# client
Message-ID: <20081006130831.M60183@quality-it.com>

I have a RabbitMQ client that connects to an OpenAMQ server and sends a
message using the BasicPublish function. The problem is that my RabbitMQ
client connects sucessfully but is disconnected from the OpenAMQ server when
sending a message. 
The client that listens for the message is written in C using the WireAPI
also disconnects on the amq_content_basic_get_body function call. I've attached
my test code below.

any idea what's going on?

thanks,

Michel

<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
C listener
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
#include "base.h"
#include "amq_client_connection.h"
#include "amq_client_session.h"

int main (int argc, char *argv [])
{
        amq_client_connection_t *connection;
        amq_client_session_t    *session;
        icl_longstr_t           *auth_data;
        amq_content_basic_t             *content;
        char                    message_text [1024];
        size_t                  message_size;

        icl_system_initialise(0, NULL);

        auth_data = amq_client_connection_auth_plain("guest", "guest");
        connection = amq_client_connection_new("127.0.0.1:5672", "/", 
            auth_data, "testserver", 3, 30000);

        icl_longstr_destroy(&auth_data);

        session = amq_client_session_new(connection);

        //  Create a private queue
        amq_client_session_queue_declare (
                session,                        //  session
                0,                              //  ticket
                "listener",                     //  queue name
                FALSE,                          //  passive
                FALSE,                          //  durable
                FALSE,                          //  exclusive
                FALSE,                          //  auto-delete
                NULL);                          //  arguments

        //  Bind the queue to the exchange
        amq_client_session_queue_bind (
                session,                        //  session
                0,                              //  ticket
                "listener",                     //  queue
                "amq.direct",                   //  exchange
                "TEST",                         //  routing-key
                NULL);                          //  arguments

        //  Consume from the queue
        amq_client_session_basic_consume (
                session,                        //  session
                0,                              //  ticket
                "listener",                     //  queue
                NULL,                           //  consumer-tag
                TRUE,                           //  no-local
                TRUE,                           //  no-ack
                TRUE,                           //  exclusive
                NULL);                          //  arguments

        while (1)
        {
                while (1)
                {
                        //  Get next message
                        content = amq_client_session_basic_arrived(session);
                        if      (!content)
                        {
                                break;
                        }

                        //  Get the message body and write it to stdout
                        message_size = amq_content_basic_get_body(content,
                             (byte*) message_text, sizeof (message_text));

                        if (message_size)
                        {
                                message_text[message_size] = 0;
                                fputs (message_text, stdout);
                        }

                        //  Destroy the message
                        amq_content_basic_unlink (&content);
        }
        //  Wait while next message arrives
        amq_client_session_wait (session, 0);

        //  Exit the loop if Ctrl+C is encountered
        if      (!connection->alive)
        {
                break;
        }
    }

    //  Close the channel
    amq_client_session_destroy (&session);

    //  Close the connection
    amq_client_connection_destroy (&connection);

    //  Uninitialise system
    icl_system_terminate ();

    return 0;
}
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
C# client
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
using System;
using System.IO;
using System.Text;

using RabbitMQ.Client;
using RabbitMQ.Client.Content;
using RabbitMQ.Client.Events;
using RabbitMQ.Client.MessagePatterns;
using RabbitMQ.Util;

namespace RabbitMQ.Client.Examples {
    public class LogTail {
        public static int Main(string[] args) {
            try {
                string serverAddress = args[0];

                ConnectionFactory factory = new ConnectionFactory();
                ConnectionParameters connparams = factory.Parameters;
                connparams.AccessRequestConfig = AccessRequestConfig.Suppress;
                IProtocol protocol = Protocols.AMQP_0_9;               
                using (IConnection conn = factory.CreateConnection(protocol,
                    serverAddress))
                {
                    using (IModel ch = conn.CreateModel()) {
                        ushort ticket = ch.AccessRequest("/");
                        
                        byte[] messageBodyBytes = 
                            Encoding.UTF8.GetBytes("test message");
                        IBasicProperties props = ch.CreateBasicProperties();
                        props.ContentType = "text/plain";
                        props.DeliveryMode = 2;
                        ch.BasicPublish(ticket,
                                        "amq.direct",
                                        "TEST",
                                        props,
                                        messageBodyBytes);
                        return 0;
                    }
                }
            } catch (Exception e) {
                Console.Error.WriteLine(e);
                return 2;
            }
        }
    }
}





From hubert at lshift.net  Mon Oct  6 18:06:11 2008
From: hubert at lshift.net (Hubert Plociniczak)
Date: Mon, 06 Oct 2008 18:06:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ C# client
In-Reply-To: <20081006130831.M60183@quality-it.com>
References: <20081006130831.M60183@quality-it.com>
Message-ID: <48EA4583.3080208@lshift.net>

Hi Michel,

I tested your code with the current C# RabbitMQ client's default branch 
and 1.4.0 release against the RabbitMQ broker and everything worked 
correctly.
Can you tell us which version of C# RabbitMQ client are you using ?
Are you running .Net or Mono? Which version?

Maybe the problem is in OpenAMQ or WireAPI ?

Thanks,
hubert



Michel Polder wrote:
> I have a RabbitMQ client that connects to an OpenAMQ server and sends a
> message using the BasicPublish function. The problem is that my RabbitMQ
> client connects sucessfully but is disconnected from the OpenAMQ server when
> sending a message. 
> The client that listens for the message is written in C using the WireAPI
> also disconnects on the amq_content_basic_get_body function call. I've attached
> my test code below.
>
> any idea what's going on?
>
> thanks,
>
> Michel
>   
-- 
 [][][] Hubert Plociniczak
   [][] LShift Ltd
 []  [] www.lshift.net




From jonatan at heysan.com  Mon Oct  6 18:26:44 2008
From: jonatan at heysan.com (Jonatan Kallus)
Date: Mon, 6 Oct 2008 10:26:44 -0700
Subject: [rabbitmq-discuss] Simplistic php stomp client (that works with
	rabbitmq's stomp gateway)
Message-ID: <4cc167ca0810061026g77665b13y2c7557804d73b70@mail.gmail.com>

I made a really small implementation of a php stomp client since we didn't
need most of the features of the existing client and since the existing
client didn't really work with the STOMP gateway for RabbitMQ (the existing
client had a small flaw in its implementation of the protocol). This
implementation does nothing more than 'CONNECT', 'SEND', 'DISCONNECT' and it
has only been tested with RabbitMQ's STOMP gateway. Posting it here in case
its to anyone's interest.

Source is here:
http://code.google.com/p/simplisticstompclient/downloads/list

A little more info here: Simplistic STOMP Client for
PHP<http://code.google.com/p/simplisticstompclient/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081006/8c9f198f/attachment.htm 

From peter.kieltyka at gmail.com  Mon Oct  6 22:02:14 2008
From: peter.kieltyka at gmail.com (Peter Kieltyka)
Date: Mon, 6 Oct 2008 17:02:14 -0400
Subject: [rabbitmq-discuss] Rabbitmqctl issues
In-Reply-To: <6c2563b20810011813g4eef8e7ds3e686ef388de4529@mail.gmail.com>
References: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
	<d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>
	<6c2563b20810011424sb0c9952ka4800ce20f4d6298@mail.gmail.com>
	<d272f0690810011507s415dfa8s82add6a5d1bc3826@mail.gmail.com>
	<6c2563b20810011515q3f14286cw1fb3efe41b15f454@mail.gmail.com>
	<d272f0690810011545m9f0361kee713ca5f8eedf76@mail.gmail.com>
	<6c2563b20810011813g4eef8e7ds3e686ef388de4529@mail.gmail.com>
Message-ID: <2B9B4581-9FF4-4453-97A3-4387D09B49B8@gmail.com>

Sorry about the delayed response, but unfortunately for me, even if  
I'm the "rabbitmq" user, I'm still running into issues.

rabbitmq at broker:/vol/rabbitmq-server/scripts$ ./rabbitmq-multi  
start_all 1
Starting all nodes...
Starting node rabbit at broker...
RabbitMQ %%VERSION%% (AMQP 8-0)
...etc..

Starting the app works, but now if I try to stop the server I get the  
error:

rabbitmq at broker:/vol/rabbitmq-server/scripts$ ./rabbitmq-multi stop_all
Stopping all nodes...

rabbit_multi action stop_all failed:
no_nodes_running

As the rabbitmq, if I run "env" I get the output (truncated)

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
USER=rabbitmq
MNESIA_BASE=/vol/rabbitmq/mnesia
ERL_ARGS=-daemon

Thanks.

Peter

On 1-Oct-08, at 9:13 PM, Edwin Fine wrote:

> Great!!
>
> On Wed, Oct 1, 2008 at 6:45 PM, Alex Clemesha <clemesha at gmail.com>  
> wrote:
>
>
> On Wed, Oct 1, 2008 at 3:15 PM, Edwin Fine <rabbitmq-discuss_efine at usa.net 
> > wrote:
> I wasn't sure from your response - does it work now? :)
> Looks like it does, below's the proof :-)
>
> Status of node rabbit at dj ...
> [{running_applications,[{rabbit,"RabbitMQ","1.4.0"},
>                         {mnesia,"MNESIA  CXC 138 12","4.3.5"},
>                         {os_mon,"CPO  CXC 138 46","2.1.2.1"},
>                         {sasl,"SASL  CXC 138 11","2.1.5.1"},
>                         {stdlib,"ERTS  CXC 138 10","1.14.5"},
>                         {kernel,"ERTS  CXC 138 10","2.11.5"}]},
>  {nodes,[rabbit at dj]},
>  {running_nodes,[rabbit at dj]}]
> done.
>
>
> thanks!
> -Alex
>
>
>
>
>
>
> On Wed, Oct 1, 2008 at 6:07 PM, Alex Clemesha <clemesha at gmail.com>  
> wrote:
>
>
> On Wed, Oct 1, 2008 at 2:24 PM, Edwin Fine <rabbitmq-discuss_efine at usa.net 
> > wrote:
> Would you like to try this?
>
> Please ensure that you are using the same Erlang cookie that Rabbit  
> was started with. This is in a file is named $HOME/.erlang.cookie  
> where $HOME is the directory of the user that started rabbitmq. If  
> you try to run commands that connect to the rabbitmq Erlang node,  
> using a different user name, even as root, if it does not have the  
> same cookie file, the commands will fail.
>
> It's best to control rabbit exclusively as one user, for example as  
> the rabbit user.
> Great, thanks for the tip.  I was in fact using a different user, so  
> I'll use the rabbit user from now on.
>
>
>
>
>
> Hope this helps,
> Edwin
>
>
> On Wed, Oct 1, 2008 at 4:52 PM, Alex Clemesha <clemesha at gmail.com>  
> wrote:
> Hi,
>
> I also run into the same thing (actually happened ~15 minutes ago),  
> I'm using Ubuntu 8.04.
> (installed RabbitMQ by adding the relevant line to /etc/apt/ 
> source.list, then using apt-get).
>
> I usually just find the relevant processes and kill them, then run  
> 'rabbitmq-server -detached'
> to start things back up.
>
> I just assumed I was missing something (maybe I still am :-)
>
> thanks
> -Alex
>
>
> On Wed, Oct 1, 2008 at 1:29 PM, Peter Kieltyka <peter.kieltyka at gmail.com 
> > wrote:
> Hello everyone,
>
> For the longest time, I've struggled to be able to control the server
> to do basic start/stop/restart commands.
>
> Currently on my production server I am running Debian Etch where I
> followed the instructions at http://www.rabbitmq.com/debian.html to
> install Rabbit.
>
> Running the rabbitmq-server or rabbitmq-multi start_all 1 commands
> will bring the server online, however to stop it, or add a user none
> of the scripts work. I am always presented with an error, bad_node.
>
> I.e.
>
> Creating user "patbroker" ...
> rabbit_control action add_user failed:
> {badrpc,nodedown}
>
> However, I can confirm that Rabbit is running fine because my
> application is working just fine. I've even tried explicitly
> specifying the -n rabbit at broker (hostname -s returns broker).
>
> The same goes for stopping the server, either using /etc/init.d/
> rabbitmq-server stop, or calling "rabbitmq-multi stop_all" directly
> will result in:
>
> Stopping all nodes...
>
> rabbit_multi action stop_all failed:
> no_nodes_running
>
> Thanks.
>
> Peter
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> -- 
> Alex Clemesha
> clemesha.org
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
> -- 
> Alex Clemesha
> clemesha.org
>
>
>
>
> -- 
> Alex Clemesha
> clemesha.org
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081006/5119af72/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Mon Oct  6 22:27:18 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Mon, 6 Oct 2008 17:27:18 -0400
Subject: [rabbitmq-discuss] Rabbitmqctl issues
In-Reply-To: <2B9B4581-9FF4-4453-97A3-4387D09B49B8@gmail.com>
References: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
	<d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>
	<6c2563b20810011424sb0c9952ka4800ce20f4d6298@mail.gmail.com>
	<d272f0690810011507s415dfa8s82add6a5d1bc3826@mail.gmail.com>
	<6c2563b20810011515q3f14286cw1fb3efe41b15f454@mail.gmail.com>
	<d272f0690810011545m9f0361kee713ca5f8eedf76@mail.gmail.com>
	<6c2563b20810011813g4eef8e7ds3e686ef388de4529@mail.gmail.com>
	<2B9B4581-9FF4-4453-97A3-4387D09B49B8@gmail.com>
Message-ID: <6c2563b20810061427x6b6adb62h482f0b12fd4aa009@mail.gmail.com>

I note that in my startup script for rabbitmq, it specifically uses /bin/sh
to run the daemon. Now this may be a long shot, but sometimes using a
different shell can cause subtle havoc. If you run rabbit (and stop it)
specifically from within /bin/sh, does it make any difference? Does it work
better if you use the functions as shown below (assuming the paths are
correct)?

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
DAEMON=/usr/local/sbin/rabbitmq-multi
NODE_COUNT=1

start_rabbitmq () {
    su rabbitmq -s /bin/sh -c "$DAEMON start_all ${NODE_COUNT}" > /dev/null
&
}

stop_rabbitmq () {
    su rabbitmq -s /bin/sh -c "$DAEMON stop_all" > /dev/null &
}


On Mon, Oct 6, 2008 at 5:02 PM, Peter Kieltyka <peter.kieltyka at gmail.com>wrote:

> Sorry about the delayed response, but unfortunately for me, even if I'm the
> "rabbitmq" user, I'm still running into issues.
> rabbitmq at broker:/vol/rabbitmq-server/scripts$ ./rabbitmq-multi start_all 1
> Starting all nodes...
> Starting node rabbit at broker...
> RabbitMQ %%VERSION%% (AMQP 8-0)
> ...etc..
>
> Starting the app works, but now if I try to stop the server I get the
> error:
>
> rabbitmq at broker:/vol/rabbitmq-server/scripts$ ./rabbitmq-multi stop_all
> Stopping all nodes...
>
> rabbit_multi action stop_all failed:
> no_nodes_running
>
> As the rabbitmq, if I run "env" I get the output (truncated)
>
> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
> USER=rabbitmq
> MNESIA_BASE=/vol/rabbitmq/mnesia
> ERL_ARGS=-daemon
>
> Thanks.
>
> Peter
>
> On 1-Oct-08, at 9:13 PM, Edwin Fine wrote:
>
> Great!!
>
> On Wed, Oct 1, 2008 at 6:45 PM, Alex Clemesha <clemesha at gmail.com> wrote:
>
>>
>>
>> On Wed, Oct 1, 2008 at 3:15 PM, Edwin Fine <
>> rabbitmq-discuss_efine at usa.net> wrote:
>>
>>> I wasn't sure from your response - does it work now? :)
>>>
>> Looks like it does, below's the proof :-)
>>
>> Status of node rabbit at dj ...
>> [{running_applications,[{rabbit,"RabbitMQ","1.4.0"},
>>                         {mnesia,"MNESIA  CXC 138 12","4.3.5"},
>>                         {os_mon,"CPO  CXC 138 46","2.1.2.1"},
>>                         {sasl,"SASL  CXC 138 11","2.1.5.1"},
>>                         {stdlib,"ERTS  CXC 138 10","1.14.5"},
>>                         {kernel,"ERTS  CXC 138 10","2.11.5"}]},
>>  {nodes,[rabbit at dj]},
>>  {running_nodes,[rabbit at dj]}]
>> done.
>>
>>
>> thanks!
>> -Alex
>>
>>
>>
>>
>>
>>>
>>>
>>> On Wed, Oct 1, 2008 at 6:07 PM, Alex Clemesha <clemesha at gmail.com>wrote:
>>>
>>>>
>>>>
>>>> On Wed, Oct 1, 2008 at 2:24 PM, Edwin Fine <
>>>> rabbitmq-discuss_efine at usa.net> wrote:
>>>>
>>>>> Would you like to try this?
>>>>>
>>>>> Please ensure that you are using the same Erlang cookie that Rabbit was
>>>>> started with. This is in a file is named $HOME/.erlang.cookie where $HOME is
>>>>> the directory of the user that started rabbitmq. If you try to run commands
>>>>> that connect to the rabbitmq Erlang node, using a different user name, even
>>>>> as root, if it does not have the same cookie file, the commands will fail.
>>>>>
>>>>> It's best to control rabbit exclusively as one user, for example as the
>>>>> rabbit user.
>>>>>
>>>> Great, thanks for the tip.  I was in fact using a different user, so
>>>> I'll use the rabbit user from now on.
>>>>
>>>>
>>>>
>>>>
>>>>>
>>>>>
>>>>> Hope this helps,
>>>>> Edwin
>>>>>
>>>>>
>>>>> On Wed, Oct 1, 2008 at 4:52 PM, Alex Clemesha <clemesha at gmail.com>wrote:
>>>>>
>>>>>> Hi,
>>>>>>
>>>>>> I also run into the same thing (actually happened ~15 minutes ago),
>>>>>> I'm using Ubuntu 8.04.
>>>>>> (installed RabbitMQ by adding the relevant line to
>>>>>> /etc/apt/source.list, then using apt-get).
>>>>>>
>>>>>> I usually just find the relevant processes and kill them, then run
>>>>>> 'rabbitmq-server -detached'
>>>>>> to start things back up.
>>>>>>
>>>>>> I just assumed I was missing something (maybe I still am :-)
>>>>>>
>>>>>> thanks
>>>>>> -Alex
>>>>>>
>>>>>>
>>>>>> On Wed, Oct 1, 2008 at 1:29 PM, Peter Kieltyka <
>>>>>> peter.kieltyka at gmail.com> wrote:
>>>>>>
>>>>>>> Hello everyone,
>>>>>>>
>>>>>>> For the longest time, I've struggled to be able to control the server
>>>>>>> to do basic start/stop/restart commands.
>>>>>>>
>>>>>>> Currently on my production server I am running Debian Etch where I
>>>>>>> followed the instructions at http://www.rabbitmq.com/debian.html to
>>>>>>> install Rabbit.
>>>>>>>
>>>>>>> Running the rabbitmq-server or rabbitmq-multi start_all 1 commands
>>>>>>> will bring the server online, however to stop it, or add a user none
>>>>>>> of the scripts work. I am always presented with an error, bad_node.
>>>>>>>
>>>>>>> I.e.
>>>>>>>
>>>>>>> Creating user "patbroker" ...
>>>>>>> rabbit_control action add_user failed:
>>>>>>> {badrpc,nodedown}
>>>>>>>
>>>>>>> However, I can confirm that Rabbit is running fine because my
>>>>>>> application is working just fine. I've even tried explicitly
>>>>>>> specifying the -n rabbit at broker (hostname -s returns broker).
>>>>>>>
>>>>>>> The same goes for stopping the server, either using /etc/init.d/
>>>>>>> rabbitmq-server stop, or calling "rabbitmq-multi stop_all" directly
>>>>>>> will result in:
>>>>>>>
>>>>>>> Stopping all nodes...
>>>>>>>
>>>>>>> rabbit_multi action stop_all failed:
>>>>>>> no_nodes_running
>>>>>>>
>>>>>>> Thanks.
>>>>>>>
>>>>>>> Peter
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> rabbitmq-discuss mailing list
>>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> Alex Clemesha
>>>>>> clemesha.org
>>>>>>
>>>>>> _______________________________________________
>>>>>> rabbitmq-discuss mailing list
>>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>>
>>>>>>
>>>>>
>>>>
>>>>
>>>> --
>>>> Alex Clemesha
>>>> clemesha.org
>>>>
>>>
>>>
>>
>>
>> --
>> Alex Clemesha
>> clemesha.org
>>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081006/26ba4090/attachment.htm 

From peter.kieltyka at gmail.com  Mon Oct  6 22:31:41 2008
From: peter.kieltyka at gmail.com (Peter Kieltyka)
Date: Mon, 6 Oct 2008 17:31:41 -0400
Subject: [rabbitmq-discuss] Rabbitmqctl issues
In-Reply-To: <6c2563b20810061427x6b6adb62h482f0b12fd4aa009@mail.gmail.com>
References: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
	<d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>
	<6c2563b20810011424sb0c9952ka4800ce20f4d6298@mail.gmail.com>
	<d272f0690810011507s415dfa8s82add6a5d1bc3826@mail.gmail.com>
	<6c2563b20810011515q3f14286cw1fb3efe41b15f454@mail.gmail.com>
	<d272f0690810011545m9f0361kee713ca5f8eedf76@mail.gmail.com>
	<6c2563b20810011813g4eef8e7ds3e686ef388de4529@mail.gmail.com>
	<2B9B4581-9FF4-4453-97A3-4387D09B49B8@gmail.com>
	<6c2563b20810061427x6b6adb62h482f0b12fd4aa009@mail.gmail.com>
Message-ID: <0EBE9162-E092-4B56-A770-E57AE4B4213F@gmail.com>

Edwin,

This is what I had tried originally. In fact thats what the default  
init.d script that is packaged with rabbitmq-server in debian looks  
like. However, it never worked when trying to stop the rabbitmq server  
or add a new user. I would always receive a bad_node error.

I've tried both sh and bash. Also, with this init script, I'd like to  
set my MNESIA_BASE path to something else which doesn't quite work  
either.

Regards,

Peter

On 6-Oct-08, at 5:27 PM, Edwin Fine wrote:

> I note that in my startup script for rabbitmq, it specifically uses / 
> bin/sh to run the daemon. Now this may be a long shot, but sometimes  
> using a different shell can cause subtle havoc. If you run rabbit  
> (and stop it) specifically from within /bin/sh, does it make any  
> difference? Does it work better if you use the functions as shown  
> below (assuming the paths are correct)?
>
> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
> DAEMON=/usr/local/sbin/rabbitmq-multi
> NODE_COUNT=1
>
> start_rabbitmq () {
>     su rabbitmq -s /bin/sh -c "$DAEMON start_all ${NODE_COUNT}" > / 
> dev/null &
> }
>
> stop_rabbitmq () {
>     su rabbitmq -s /bin/sh -c "$DAEMON stop_all" > /dev/null &
> }
>
>
> On Mon, Oct 6, 2008 at 5:02 PM, Peter Kieltyka <peter.kieltyka at gmail.com 
> > wrote:
> Sorry about the delayed response, but unfortunately for me, even if  
> I'm the "rabbitmq" user, I'm still running into issues.
>
> rabbitmq at broker:/vol/rabbitmq-server/scripts$ ./rabbitmq-multi  
> start_all 1
> Starting all nodes...
> Starting node rabbit at broker...
> RabbitMQ %%VERSION%% (AMQP 8-0)
> ...etc..
>
> Starting the app works, but now if I try to stop the server I get  
> the error:
>
> rabbitmq at broker:/vol/rabbitmq-server/scripts$ ./rabbitmq-multi  
> stop_all
> Stopping all nodes...
>
> rabbit_multi action stop_all failed:
> no_nodes_running
>
> As the rabbitmq, if I run "env" I get the output (truncated)
>
> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
> USER=rabbitmq
> MNESIA_BASE=/vol/rabbitmq/mnesia
> ERL_ARGS=-daemon
>
> Thanks.
>
> Peter
>
> On 1-Oct-08, at 9:13 PM, Edwin Fine wrote:
>
>> Great!!
>>
>> On Wed, Oct 1, 2008 at 6:45 PM, Alex Clemesha <clemesha at gmail.com>  
>> wrote:
>>
>>
>> On Wed, Oct 1, 2008 at 3:15 PM, Edwin Fine <rabbitmq-discuss_efine at usa.net 
>> > wrote:
>> I wasn't sure from your response - does it work now? :)
>> Looks like it does, below's the proof :-)
>>
>> Status of node rabbit at dj ...
>> [{running_applications,[{rabbit,"RabbitMQ","1.4.0"},
>>                         {mnesia,"MNESIA  CXC 138 12","4.3.5"},
>>                         {os_mon,"CPO  CXC 138 46","2.1.2.1"},
>>                         {sasl,"SASL  CXC 138 11","2.1.5.1"},
>>                         {stdlib,"ERTS  CXC 138 10","1.14.5"},
>>                         {kernel,"ERTS  CXC 138 10","2.11.5"}]},
>>  {nodes,[rabbit at dj]},
>>  {running_nodes,[rabbit at dj]}]
>> done.
>>
>>
>> thanks!
>> -Alex
>>
>>
>>
>>
>>
>>
>> On Wed, Oct 1, 2008 at 6:07 PM, Alex Clemesha <clemesha at gmail.com>  
>> wrote:
>>
>>
>> On Wed, Oct 1, 2008 at 2:24 PM, Edwin Fine <rabbitmq-discuss_efine at usa.net 
>> > wrote:
>> Would you like to try this?
>>
>> Please ensure that you are using the same Erlang cookie that Rabbit  
>> was started with. This is in a file is named $HOME/.erlang.cookie  
>> where $HOME is the directory of the user that started rabbitmq. If  
>> you try to run commands that connect to the rabbitmq Erlang node,  
>> using a different user name, even as root, if it does not have the  
>> same cookie file, the commands will fail.
>>
>> It's best to control rabbit exclusively as one user, for example as  
>> the rabbit user.
>> Great, thanks for the tip.  I was in fact using a different user,  
>> so I'll use the rabbit user from now on.
>>
>>
>>
>>
>>
>> Hope this helps,
>> Edwin
>>
>>
>> On Wed, Oct 1, 2008 at 4:52 PM, Alex Clemesha <clemesha at gmail.com>  
>> wrote:
>> Hi,
>>
>> I also run into the same thing (actually happened ~15 minutes ago),  
>> I'm using Ubuntu 8.04.
>> (installed RabbitMQ by adding the relevant line to /etc/apt/ 
>> source.list, then using apt-get).
>>
>> I usually just find the relevant processes and kill them, then run  
>> 'rabbitmq-server -detached'
>> to start things back up.
>>
>> I just assumed I was missing something (maybe I still am :-)
>>
>> thanks
>> -Alex
>>
>>
>> On Wed, Oct 1, 2008 at 1:29 PM, Peter Kieltyka <peter.kieltyka at gmail.com 
>> > wrote:
>> Hello everyone,
>>
>> For the longest time, I've struggled to be able to control the server
>> to do basic start/stop/restart commands.
>>
>> Currently on my production server I am running Debian Etch where I
>> followed the instructions at http://www.rabbitmq.com/debian.html to
>> install Rabbit.
>>
>> Running the rabbitmq-server or rabbitmq-multi start_all 1 commands
>> will bring the server online, however to stop it, or add a user none
>> of the scripts work. I am always presented with an error, bad_node.
>>
>> I.e.
>>
>> Creating user "patbroker" ...
>> rabbit_control action add_user failed:
>> {badrpc,nodedown}
>>
>> However, I can confirm that Rabbit is running fine because my
>> application is working just fine. I've even tried explicitly
>> specifying the -n rabbit at broker (hostname -s returns broker).
>>
>> The same goes for stopping the server, either using /etc/init.d/
>> rabbitmq-server stop, or calling "rabbitmq-multi stop_all" directly
>> will result in:
>>
>> Stopping all nodes...
>>
>> rabbit_multi action stop_all failed:
>> no_nodes_running
>>
>> Thanks.
>>
>> Peter
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> -- 
>> Alex Clemesha
>> clemesha.org
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>>
>> -- 
>> Alex Clemesha
>> clemesha.org
>>
>>
>>
>>
>> -- 
>> Alex Clemesha
>> clemesha.org
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081006/340919b0/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Mon Oct  6 23:18:19 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Mon, 6 Oct 2008 18:18:19 -0400
Subject: [rabbitmq-discuss] Rabbitmqctl issues
In-Reply-To: <0EBE9162-E092-4B56-A770-E57AE4B4213F@gmail.com>
References: <DBD46A5B-5CD2-47BA-8D3C-A8EE3EF82859@gmail.com>
	<d272f0690810011352he9eeef0mb459a82ad11abc06@mail.gmail.com>
	<6c2563b20810011424sb0c9952ka4800ce20f4d6298@mail.gmail.com>
	<d272f0690810011507s415dfa8s82add6a5d1bc3826@mail.gmail.com>
	<6c2563b20810011515q3f14286cw1fb3efe41b15f454@mail.gmail.com>
	<d272f0690810011545m9f0361kee713ca5f8eedf76@mail.gmail.com>
	<6c2563b20810011813g4eef8e7ds3e686ef388de4529@mail.gmail.com>
	<2B9B4581-9FF4-4453-97A3-4387D09B49B8@gmail.com>
	<6c2563b20810061427x6b6adb62h482f0b12fd4aa009@mail.gmail.com>
	<0EBE9162-E092-4B56-A770-E57AE4B4213F@gmail.com>
Message-ID: <6c2563b20810061518t72ed313es4edc505c379c75e3@mail.gmail.com>

>
>
> This is what I had tried originally. In fact thats what the default init.d
> script that is packaged with rabbitmq-server in debian looks like. However,
> it never worked when trying to stop the rabbitmq server or add a new user. I
> would always receive a bad_node error.
>

If you search this forum, you will see that I sent out a step-by-step guide
to installing RabbitMQ. I have used this to install RabbitMQ successfully on
both Ubuntu and OpenSuSE on multiple systems. If you would consider
re-installing from scratch, following those instructions to the letter (it
is important not to skip any steps), maybe this would help. Sometimes things
just get so messed up that only a clean install will fix them. For example,
if you start something as root when you shouldn't, and some file somewhere
gets created with root as owner, and you get an inexplicable error when you
start up as a different user, it can be hell to try to find that file
especially when you didn't even know it existed :) Hmmm... actually, you can
do an lsof and see which files rabbit is using. You may be surprised.

I've tried both sh and bash.
>

Ok, it was worth a try.


> Also, with this init script, I'd like to set my MNESIA_BASE path to
> something else which doesn't quite work either.
>

That's weird; I have changed the MNESIA_BASE path just fine. Be aware,
though, that you can't just copy the files there, you need to start with an
empty directory and let Rabbit recreate the databases. Then you have to add
the users and permissions and so on.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081006/116c07ff/attachment.htm 

From 0x6e6562 at gmail.com  Tue Oct  7 00:21:42 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 7 Oct 2008 00:21:42 +0100
Subject: [rabbitmq-discuss] Threading issues
Message-ID: <269388e30810061621k17ee2faclb2215688beae1694@mail.gmail.com>

Hi all,

Recently I have been asked (mostly via personally addressed IM, Email
or on IRC) about strategies surrounding client side threading with
AMQP (and Rabbit).

So I decided to write an article about this:
http://hopper.squarespace.com/blog/2008/10/6/multithreading-amqp-clients.html

By its very nature, this cannot be a complete treatise on the subject.

But hopefully this may of relevance for those deliberating over how to
thread either in their own applications or for those wanting to
implement an interface to an AMQP broker.

HTH,

Ben



From 0x6e6562 at gmail.com  Tue Oct  7 01:49:02 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 7 Oct 2008 01:49:02 +0100
Subject: [rabbitmq-discuss] Consumer Driven Messaging
Message-ID: <269388e30810061749y6a71bbbfq35c8ae2aa49b9d28@mail.gmail.com>

Hi all,

Since I was in the swing of writing articles, I though I'd publish my
take on the question of whether an exchange really does decouple the
producer from the consumer:
http://hopper.squarespace.com/blog/2008/10/7/consumer-driven-messaging.html

HTH,

Ben



From polidore at gmail.com  Tue Oct  7 03:35:26 2008
From: polidore at gmail.com (Benjamin Polidore)
Date: Mon, 6 Oct 2008 22:35:26 -0400
Subject: [rabbitmq-discuss] how to close a connection in dotnet?
Message-ID: <8801cb2b0810061935h76fa24b0hc25c8736de5e904a@mail.gmail.com>

I'm still having this problem:
Any luck fixing it?

Re: how to close a connection in dotnet?[image: Click to flag this
post]<javascript: void Nabble.setFlag(18941638);>


by Hubert Plociniczak-2<http://www.nabble.com/user/UserProfile.jtp?user=1290996>
 Aug 12, 2008; 06:30am :: Rate this Message:
<http://www.nabble.com/how-to-close-a-connection-in-dotnet--td18935278.html#>
 <http://www.nabble.com/how-to-close-a-connection-in-dotnet--td18935278.html#><http://www.nabble.com/how-to-close-a-connection-in-dotnet--td18935278.html#><http://www.nabble.com/how-to-close-a-connection-in-dotnet--td18935278.html#><http://www.nabble.com/how-to-close-a-connection-in-dotnet--td18935278.html#><http://www.nabble.com/how-to-close-a-connection-in-dotnet--td18935278.html#>
 <http://www.nabble.com/how-to-close-a-connection-in-dotnet--td18935278.html#>
 - Use ratings to moderate (? <http://www.nabble.com/help/Answer.jtp?id=16>)

Reply <http://www.nabble.com/forum/Reply.jtp?post=18941638> | Reply to
Author <http://www.nabble.com/user/SendEmail.jtp?type=pm&post=18941638> |
Print <http://www.nabble.com/forum/PrintPost.jtp?post=18941638> | View
Threaded <javascript: void Nabble.setView('newthreaded',18941638);> | Show
Only this Message<http://www.nabble.com/Re%3A-how-to-close-a-connection-in-dotnet--p18941638.html>
Hi Geoffrey,

I tried to reproduce your bug on Mono and everything was working
as expected.

Then I switched to .Net (native) and actually noticed your problem.
I guess there is something different with .Net environment (again)
and it does not behave as expected.

Thanks for reporting that!
I will fix that as soon as possible.

Hubert

Geoffrey Anderson wrote:
> Just a basic question on opening and closing the connection...
>
> When I call this line of C# code using the .net library 1.4.0 :
>
> mqConnection.Close();
>
> I quickly get this exception:
>
> System.*ObjectDisposedException* was unhandled
>   Message="Cannot access a *disposed* *object*.\r\nObject name:
> 'System.Net.Sockets.Socket'."
>   Source="System"
>   *ObjectName*="System.Net.Sockets.Socket"
>   StackTrace:
>        at System.Net.Sockets.TcpClient.set_ReceiveTimeout(Int32 value)
>        at *RabbitMQ*.Client.Impl.SocketFrameHandler_0_9.set_Timeout(Int32
value)
>        at *RabbitMQ*.Client.Impl.ConnectionBase.ClosingLoop()
>        at *RabbitMQ*.Client.Impl.ConnectionBase.MainLoop()
>        at System.Threading.ThreadHelper.ThreadStart_Context(*Object*
 state)
>        at System.Threading.ExecutionContext.Run(ExecutionContext
executionContext,
> ContextCallback callback, *Object* state)
>        at System.Threading.ThreadHelper.ThreadStart()
>
>
>
> Here is the code which established my connection before I called the Close
method.
>
> Is there a mistake in the way I set up the connection which might cause
this socket
> error?  It seems to run fine and there are no exceptions except for the
later Close
> statement.
>
>
>         void OpenOutputQueue()
>         {
>             mqFactory = new ConnectionFactory();
>             mqFactory.Parameters.UserName = Cfg("MessageQueueUserName");
>             mqFactory.Parameters.Password = Cfg("MessageQueuePassword");
>             mqFactory.Parameters.VirtualHost =
Cfg("MessageQueueVirtualHost", "/");
>             mqFactory.Parameters.RequestedHeartbeat = 0;
>             //mqFactory.Parameters.RequestedHeartbeat = 20;
>             IProtocol mqProtocol = Protocols.FromEnvironment();
>             mqHost = Cfg("MessageQueueHost", "localhost");
>             mqConnection = mqFactory.CreateConnection(mqProtocol,
mqHost);
>             mqModel = mqConnection.CreateModel();
>             mqTicket = mqModel.AccessRequest(Cfg("MessageQueueRealm"));
>             mqExchange = Cfg("MessageQueueExchange");
>             mqModel.ExchangeDeclare(mqTicket, mqExchange,
ExchangeType.Direct);
>             mqQueueName = Cfg("MessageQueueName");
>             mqModel.QueueDeclare(mqTicket, mqQueueName, false);
>             mqRoutingKey = Cfg("MessageQueueRoutingKey");
>             mqModel.QueueBind(mqTicket, mqQueueName, mqExchange,
mqRoutingKey,
> false, null);
>             mqConnection.AutoClose = false;
>         }
>
>
>
> Sorry to waste time if I missed something in the manuals.
>
> Thanks for reading.
>
> Geoffrey Anderson
>
> _______________________________________________
> *rabbitmq*-*discuss* mailing list
> *rabbitmq*-*discuss*@...<http://www.nabble.com/user/SendEmail.jtp?type=post&post=18941638&i=0>

> http://lists.*rabbitmq*.com/cgi-bin/mailman/listinfo/*rabbitmq*-*discuss*<http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
... [show rest of
quote<http://www.nabble.com/how-to-close-a-connection-in-dotnet--td18935278.html#>
]

-- 
 [][][] Hubert Plociniczak
   [][] LShift Ltd
 []  [] www.lshift.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081006/1d9e9c9f/attachment.htm 

From hubert at lshift.net  Tue Oct  7 10:46:58 2008
From: hubert at lshift.net (Hubert Plociniczak)
Date: Tue, 07 Oct 2008 10:46:58 +0100
Subject: [rabbitmq-discuss] how to close a connection in dotnet?
In-Reply-To: <8801cb2b0810061935h76fa24b0hc25c8736de5e904a@mail.gmail.com>
References: <8801cb2b0810061935h76fa24b0hc25c8736de5e904a@mail.gmail.com>
Message-ID: <48EB3012.4080000@lshift.net>

Did you try the latest default branch from the repository ?
The problem was fixed in branch bug19190 and it was merged into default 
branch.
I tested this on .Net now, just in case, and it works for me.

I hope that helps.

hubert


Benjamin Polidore wrote:
> I'm still having this problem:
>
> Any luck fixing it?  


-- 
 [][][] Hubert Plociniczak
   [][] LShift Ltd
 []  [] www.lshift.net




From alexis.richardson at cohesiveft.com  Wed Oct  8 13:32:07 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 8 Oct 2008 13:32:07 +0100
Subject: [rabbitmq-discuss] Simplistic php stomp client (that works with
	rabbitmq's stomp gateway)
In-Reply-To: <4cc167ca0810061026g77665b13y2c7557804d73b70@mail.gmail.com>
References: <4cc167ca0810061026g77665b13y2c7557804d73b70@mail.gmail.com>
Message-ID: <167204d20810080532v24083dcfwd78a591fb0052afb@mail.gmail.com>

Jonatan

Very cool :-)

I have added a link to it here:
https://dev.rabbitmq.com/wiki/ClientsKnownToWorkWithRabbit

If anyone thinks something is missing from this list please speak out!

alexis


On Mon, Oct 6, 2008 at 6:26 PM, Jonatan Kallus <jonatan at heysan.com> wrote:
> I made a really small implementation of a php stomp client since we didn't
> need most of the features of the existing client and since the existing
> client didn't really work with the STOMP gateway for RabbitMQ (the existing
> client had a small flaw in its implementation of the protocol). This
> implementation does nothing more than 'CONNECT', 'SEND', 'DISCONNECT' and it
> has only been tested with RabbitMQ's STOMP gateway. Posting it here in case
> its to anyone's interest.
>
> Source is here:
> http://code.google.com/p/simplisticstompclient/downloads/list
>
> A little more info here: Simplistic STOMP Client for PHP
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From manuel+rabbitmq at aguete.org  Wed Oct  8 15:22:40 2008
From: manuel+rabbitmq at aguete.org (Manuel Duran Aguete)
Date: Wed, 8 Oct 2008 16:22:40 +0200
Subject: [rabbitmq-discuss] No "connection.redirect" support in erlang
	client.
Message-ID: <8bb2c19f0810080722o4001a3e8x9e3a6a1978a744a3@mail.gmail.com>

Hi,
I'm testing the erlang amqp client and seems it not supports
"connection.redirect".

2> lib_amqp:start_connection("localhost").
Have a look into this one: closed
** exception error: no match of right hand side value
{error,{{badmatch,{'connection.redirect',<<"host1:5672">>,

<<"host1:5672,host2:5672">>}},

[{amqp_network_driver,network_handshake,2},

{amqp_network_driver,handshake,1},

{amqp_connection,init,1},

{gen_server,init_it,6},

{proc_lib,init_p,5}]}}
     in function  amqp_connection:start/5


What's the correct behavior with these method ?

Close the socket and reconnect  to the host indicated ?

What state must return network_handshake to do that ?

Sorry for the questions but I'm newbie to erlang.


Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081008/8d5a789c/attachment.htm 

From 0x6e6562 at gmail.com  Wed Oct  8 15:30:19 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 8 Oct 2008 15:30:19 +0100
Subject: [rabbitmq-discuss] No "connection.redirect" support in erlang
	client.
In-Reply-To: <8bb2c19f0810080722o4001a3e8x9e3a6a1978a744a3@mail.gmail.com>
References: <8bb2c19f0810080722o4001a3e8x9e3a6a1978a744a3@mail.gmail.com>
Message-ID: <269388e30810080730u588a7476j3e97ef7dc1e48ba6@mail.gmail.com>

Manuel,

On Wed, Oct 8, 2008 at 3:22 PM, Manuel Duran Aguete
<manuel+rabbitmq at aguete.org> wrote:
> Hi,
> I'm testing the erlang amqp client and seems it not supports
> "connection.redirect".
>
> 2> lib_amqp:start_connection("localhost").
> Have a look into this one: closed
> ** exception error: no match of right hand side value
> {error,{{badmatch,{'connection.redirect',<<"host1:5672">>,
>
> <<"host1:5672,host2:5672">>}},

Could you elaborate on what test code you are using, what version of
the client and server are you using to help us diagnose this?

> Sorry for the questions but I'm newbie to erlang.

In general in Erlang badmatch means that you are trying to assign the
wrong pattern to a variable.

Ben



From manuel+rabbitmq at aguete.org  Wed Oct  8 16:15:53 2008
From: manuel+rabbitmq at aguete.org (Manuel Duran Aguete)
Date: Wed, 8 Oct 2008 17:15:53 +0200
Subject: [rabbitmq-discuss] No "connection.redirect" support in erlang
	client.
In-Reply-To: <269388e30810080730u588a7476j3e97ef7dc1e48ba6@mail.gmail.com>
References: <8bb2c19f0810080722o4001a3e8x9e3a6a1978a744a3@mail.gmail.com>
	<269388e30810080730u588a7476j3e97ef7dc1e48ba6@mail.gmail.com>
Message-ID: <8bb2c19f0810080815o19896d91uf8269ae594a71c4f@mail.gmail.com>

Hi Ben,

2008/10/8 Ben Hood <0x6e6562 at gmail.com>
>
> Manuel,
>
> On Wed, Oct 8, 2008 at 3:22 PM, Manuel Duran Aguete
> <manuel+rabbitmq at aguete.org> wrote:
> > Hi,
> > I'm testing the erlang amqp client and seems it not supports
> > "connection.redirect".
> >
> > 2> lib_amqp:start_connection("localhost").
> > Have a look into this one: closed
> > ** exception error: no match of right hand side value
> > {error,{{badmatch,{'connection.redirect',<<"host1:5672">>,
> >
> > <<"host1:5672,host2:5672">>}},
>
> Could you elaborate on what test code you are using, what version of
> the client and server are you using to help us diagnose this?

Today I've downloaded the repository of server and client and compile
all in my workstation.

>
> > Sorry for the questions but I'm newbie to erlang.
>
> In general in Erlang badmatch means that you are trying to assign the
> wrong pattern to a variable.

>
> Ben


Regards.



From 0x6e6562 at gmail.com  Wed Oct  8 16:32:29 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 8 Oct 2008 16:32:29 +0100
Subject: [rabbitmq-discuss] No "connection.redirect" support in erlang
	client.
In-Reply-To: <8bb2c19f0810080815o19896d91uf8269ae594a71c4f@mail.gmail.com>
References: <8bb2c19f0810080722o4001a3e8x9e3a6a1978a744a3@mail.gmail.com>
	<269388e30810080730u588a7476j3e97ef7dc1e48ba6@mail.gmail.com>
	<8bb2c19f0810080815o19896d91uf8269ae594a71c4f@mail.gmail.com>
Message-ID: <269388e30810080832n112dfb07p48be3a6299d44a58@mail.gmail.com>

Manuel,

Are you running a cluster of Rabbits or a single instance?

I've just sucessfully tried running

lib_amqp:start_connection("localhost").

in the shell.

I used a standalone server version 251 (3ced8b393249) and client
version 111 (203d83e64622).

You are going to have to give me some clues such about your setup,
like your OS, version of Erlang and specifically how you installed
Rabbit so that you could get the client to run at all.

Ben


On Wed, Oct 8, 2008 at 4:15 PM, Manuel Duran Aguete
<manuel+rabbitmq at aguete.org> wrote:
> Hi Ben,
>
> 2008/10/8 Ben Hood <0x6e6562 at gmail.com>
>>
>> Manuel,
>>
>> On Wed, Oct 8, 2008 at 3:22 PM, Manuel Duran Aguete
>> <manuel+rabbitmq at aguete.org> wrote:
>> > Hi,
>> > I'm testing the erlang amqp client and seems it not supports
>> > "connection.redirect".
>> >
>> > 2> lib_amqp:start_connection("localhost").
>> > Have a look into this one: closed
>> > ** exception error: no match of right hand side value
>> > {error,{{badmatch,{'connection.redirect',<<"host1:5672">>,
>> >
>> > <<"host1:5672,host2:5672">>}},
>>
>> Could you elaborate on what test code you are using, what version of
>> the client and server are you using to help us diagnose this?
>
> Today I've downloaded the repository of server and client and compile
> all in my workstation.
>
>>
>> > Sorry for the questions but I'm newbie to erlang.
>>
>> In general in Erlang badmatch means that you are trying to assign the
>> wrong pattern to a variable.
>
>>
>> Ben
>
>
> Regards.
>



From manuel+rabbitmq at aguete.org  Wed Oct  8 16:43:38 2008
From: manuel+rabbitmq at aguete.org (Manuel Duran Aguete)
Date: Wed, 8 Oct 2008 17:43:38 +0200
Subject: [rabbitmq-discuss] No "connection.redirect" support in erlang
	client.
In-Reply-To: <269388e30810080832n112dfb07p48be3a6299d44a58@mail.gmail.com>
References: <8bb2c19f0810080722o4001a3e8x9e3a6a1978a744a3@mail.gmail.com>
	<269388e30810080730u588a7476j3e97ef7dc1e48ba6@mail.gmail.com>
	<8bb2c19f0810080815o19896d91uf8269ae594a71c4f@mail.gmail.com>
	<269388e30810080832n112dfb07p48be3a6299d44a58@mail.gmail.com>
Message-ID: <8bb2c19f0810080843q792b109ei3bf6c4aae45aeab1@mail.gmail.com>

Ben,
   I'm running a cluster.
   Server rev 265 (5a04b02b93da)
   Client rev 115 (c8303be95a15)

   Rabbit installed from /packaging/debs/Debian

   Ubuntu Linux 8.04 x86
   Erlang R12-B3

   Erlang (BEAM) emulator version 5.6.3 [source] [smp:2]
[async-threads:0] [hipe] [kernel-poll:false]

Regards.


2008/10/8 Ben Hood <0x6e6562 at gmail.com>:
> Manuel,
>
> Are you running a cluster of Rabbits or a single instance?
>
> I've just sucessfully tried running
>
> lib_amqp:start_connection("localhost").
>
> in the shell.
>
> I used a standalone server version 251 (3ced8b393249) and client
> version 111 (203d83e64622).
>
> You are going to have to give me some clues such about your setup,
> like your OS, version of Erlang and specifically how you installed
> Rabbit so that you could get the client to run at all.
>
> Ben
>
>
> On Wed, Oct 8, 2008 at 4:15 PM, Manuel Duran Aguete
> <manuel+rabbitmq at aguete.org> wrote:
>> Hi Ben,
>>
>> 2008/10/8 Ben Hood <0x6e6562 at gmail.com>
>>>
>>> Manuel,
>>>
>>> On Wed, Oct 8, 2008 at 3:22 PM, Manuel Duran Aguete
>>> <manuel+rabbitmq at aguete.org> wrote:
>>> > Hi,
>>> > I'm testing the erlang amqp client and seems it not supports
>>> > "connection.redirect".
>>> >
>>> > 2> lib_amqp:start_connection("localhost").
>>> > Have a look into this one: closed
>>> > ** exception error: no match of right hand side value
>>> > {error,{{badmatch,{'connection.redirect',<<"host1:5672">>,
>>> >
>>> > <<"host1:5672,host2:5672">>}},
>>>
>>> Could you elaborate on what test code you are using, what version of
>>> the client and server are you using to help us diagnose this?
>>
>> Today I've downloaded the repository of server and client and compile
>> all in my workstation.
>>
>>>
>>> > Sorry for the questions but I'm newbie to erlang.
>>>
>>> In general in Erlang badmatch means that you are trying to assign the
>>> wrong pattern to a variable.
>>
>>>
>>> Ben
>>
>>
>> Regards.
>>
>



From 0x6e6562 at gmail.com  Wed Oct  8 17:37:53 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 8 Oct 2008 17:37:53 +0100
Subject: [rabbitmq-discuss] No "connection.redirect" support in erlang
	client.
In-Reply-To: <8bb2c19f0810080843q792b109ei3bf6c4aae45aeab1@mail.gmail.com>
References: <8bb2c19f0810080722o4001a3e8x9e3a6a1978a744a3@mail.gmail.com>
	<269388e30810080730u588a7476j3e97ef7dc1e48ba6@mail.gmail.com>
	<8bb2c19f0810080815o19896d91uf8269ae594a71c4f@mail.gmail.com>
	<269388e30810080832n112dfb07p48be3a6299d44a58@mail.gmail.com>
	<8bb2c19f0810080843q792b109ei3bf6c4aae45aeab1@mail.gmail.com>
Message-ID: <269388e30810080937t33f22ba4p4ff7d735081a7757@mail.gmail.com>

Manuel,

On Wed, Oct 8, 2008 at 4:43 PM, Manuel Duran Aguete
<manuel+rabbitmq at aguete.org> wrote:
>   I'm running a cluster.

The Erlang client has not been tested in a clustered scenario (the
Erlang is currently officially still experimental but is well on the
way to being formally released - for more information please go back
through the archives to read threads about the Erlang client's roadmap
to a 1.0 release).

Furthermore, I am not 100% sure if the redirect attribute will be part
of the upcoming 0.91 spec revision, so I will have to check on that.

So my suggestion for you in the meantime is: run the broker is a
standalone modus to see if that really does make a difference.

If it does, please let me know I will create a bug for this issue and
schedule it's resolution.

HTH,

Ben



From manuel+rabbitmq at aguete.org  Wed Oct  8 18:05:32 2008
From: manuel+rabbitmq at aguete.org (Manuel Duran Aguete)
Date: Wed, 8 Oct 2008 19:05:32 +0200
Subject: [rabbitmq-discuss] No "connection.redirect" support in erlang
	client.
In-Reply-To: <269388e30810080937t33f22ba4p4ff7d735081a7757@mail.gmail.com>
References: <8bb2c19f0810080722o4001a3e8x9e3a6a1978a744a3@mail.gmail.com>
	<269388e30810080730u588a7476j3e97ef7dc1e48ba6@mail.gmail.com>
	<8bb2c19f0810080815o19896d91uf8269ae594a71c4f@mail.gmail.com>
	<269388e30810080832n112dfb07p48be3a6299d44a58@mail.gmail.com>
	<8bb2c19f0810080843q792b109ei3bf6c4aae45aeab1@mail.gmail.com>
	<269388e30810080937t33f22ba4p4ff7d735081a7757@mail.gmail.com>
Message-ID: <8bb2c19f0810081005u34e7b24emda127fcea8a5464f@mail.gmail.com>

Hi,
Using "insist=true" works ok, at the moment it's perfect for me.

thanks.

2008/10/8 Ben Hood <0x6e6562 at gmail.com>:
> Manuel,
>
> On Wed, Oct 8, 2008 at 4:43 PM, Manuel Duran Aguete
> <manuel+rabbitmq at aguete.org> wrote:
>>   I'm running a cluster.
>
> The Erlang client has not been tested in a clustered scenario (the
> Erlang is currently officially still experimental but is well on the
> way to being formally released - for more information please go back
> through the archives to read threads about the Erlang client's roadmap
> to a 1.0 release).
>
> Furthermore, I am not 100% sure if the redirect attribute will be part
> of the upcoming 0.91 spec revision, so I will have to check on that.
>
> So my suggestion for you in the meantime is: run the broker is a
> standalone modus to see if that really does make a difference.
>
> If it does, please let me know I will create a bug for this issue and
> schedule it's resolution.
>
> HTH,
>
> Ben
>



From 0x6e6562 at gmail.com  Wed Oct  8 18:14:06 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 8 Oct 2008 18:14:06 +0100
Subject: [rabbitmq-discuss] No "connection.redirect" support in erlang
	client.
In-Reply-To: <8bb2c19f0810081005u34e7b24emda127fcea8a5464f@mail.gmail.com>
References: <8bb2c19f0810080722o4001a3e8x9e3a6a1978a744a3@mail.gmail.com>
	<269388e30810080730u588a7476j3e97ef7dc1e48ba6@mail.gmail.com>
	<8bb2c19f0810080815o19896d91uf8269ae594a71c4f@mail.gmail.com>
	<269388e30810080832n112dfb07p48be3a6299d44a58@mail.gmail.com>
	<8bb2c19f0810080843q792b109ei3bf6c4aae45aeab1@mail.gmail.com>
	<269388e30810080937t33f22ba4p4ff7d735081a7757@mail.gmail.com>
	<8bb2c19f0810081005u34e7b24emda127fcea8a5464f@mail.gmail.com>
Message-ID: <269388e30810081014s7d6c7c42pffa4f72c79e09536@mail.gmail.com>

Manuel,

On Wed, Oct 8, 2008 at 6:05 PM, Manuel Duran Aguete
<manuel+rabbitmq at aguete.org> wrote:
> Using "insist=true" works ok, at the moment it's perfect for me.

Sure. I just assumed that it might be easier for you to go to
non-clustered, but if you've already looked inside the network driver,
and have understood what is going on, then the fix is straight
forward.

Ben



From alexis.richardson at cohesiveft.com  Fri Oct 10 08:09:45 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 10 Oct 2008 08:09:45 +0100
Subject: [rabbitmq-discuss] installing RabbitMQ on OSX
Message-ID: <167204d20810100009g717b118o948675183d6308aa@mail.gmail.com>

In case anyone is still in need of advice on this, the BoomLoop guys
have posted a short set of instructions:

http://playtype.net/past/2008/10/9/installing_rabbitmq_on_osx/

alexis



From hbayhantopcu at gmail.com  Fri Oct 10 12:29:36 2008
From: hbayhantopcu at gmail.com (Haldun Bayhantopcu)
Date: Fri, 10 Oct 2008 13:29:36 +0200
Subject: [rabbitmq-discuss] Message ack timeout
Message-ID: <08C22EAA-BE7F-4A87-917A-F977B6B354C4@gmail.com>

Hi all,

I'm trying to set up a system where one process produces several
messages to many consumer processes. Each consumer creates a new
record in database for each message. Since this is a bit slow,
and heavy work for database when especially a lot of messages
are produced in a short interval, I considered buffering the
messages in consumer processes, and then sending them to the
database in batch. I also don't want to lose messages -in case of
a failure in consumer process- so I don't ack immediately
when a message arrived, but after successfullyinserting to database.

Here is where the problem occurs. When I buffer the messages in
consumer process, broker seems to send that same messages to
another consumer process. So basically I need to find out a
way to prevent the broker from sending the messages that I just
buffered in my process, for a certain time.

I looked around to find a way to set up timeout or something,
however found none. Maybe there is another mechanism to achieve
the behavior that I described here.

Thanks in advance,
Haldun.




From 0x6e6562 at gmail.com  Fri Oct 10 12:26:51 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 10 Oct 2008 12:26:51 +0100
Subject: [rabbitmq-discuss] Message ack timeout
In-Reply-To: <08C22EAA-BE7F-4A87-917A-F977B6B354C4@gmail.com>
References: <08C22EAA-BE7F-4A87-917A-F977B6B354C4@gmail.com>
Message-ID: <269388e30810100426p2c67b4e0h3f1b3df4596e437d@mail.gmail.com>

Haldun,

On Fri, Oct 10, 2008 at 12:29 PM, Haldun Bayhantopcu
<hbayhantopcu at gmail.com> wrote:
> Here is where the problem occurs. When I buffer the messages in
> consumer process, broker seems to send that same messages to
> another consumer process. So basically I need to find out a
> way to prevent the broker from sending the messages that I just
> buffered in my process, for a certain time.

Assuming that you have set the routing up correctly and have turned
the auto-ack flag off when subscribing or you are not closing and
restarting channels, what you are describing *shouldn't* really occur
under normal circumstances. Maybe you can elaborate or send a cut down
version of your code that illustrates this behavior.

HTH,

Ben



From dmitriy.samovskiy at cohesiveft.com  Fri Oct 10 18:14:32 2008
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Fri, 10 Oct 2008 12:14:32 -0500
Subject: [rabbitmq-discuss] Message ack timeout
In-Reply-To: <08C22EAA-BE7F-4A87-917A-F977B6B354C4@gmail.com>
References: <08C22EAA-BE7F-4A87-917A-F977B6B354C4@gmail.com>
Message-ID: <48EF8D78.9090704@cohesiveft.com>


Hi Haldun,

Haldun Bayhantopcu wrote:
> Hi all,
> 
> I'm trying to set up a system where one process produces several
> messages to many consumer processes. Each consumer creates a new
> record in database for each message. Since this is a bit slow,
> and heavy work for database when especially a lot of messages
> are produced in a short interval, I considered buffering the
> messages in consumer processes, and then sending them to the

Interesting problem. I personally can think of 2 ways how you can design it to meet your 
requirements. (Please note it's purely on theoretical level, I haven't tested any of it).


1. Your consumer can establish a connection to rabbitmq broker, and then set up N 
channels. Do basic.get on each channel, you will end up with a batch of at most N 
messages, write the batch to the database, and then ack each message individually. Then 
repeat.

A problem of course is that something may happen before you finish ack'ing all messages 
(say after you ack'ed 2 of 5). It is my understanding that you won't be able to ack them 
all together, since basic.ack can only ack messages on its channel. Not sure if you can 
handle that in your app, but unack'ed 3 messages will be delivered to you again in this 
scenario.


1a. You can use nearly identical approach by having your consumers open multiple 
connections to broker (and a single channel inside each connection). Might get more 
complicated, as you will have to juggle multiple sockets.


2. "buffering" is somewhat like "queueing", so why not use rabbitmq to be your buffer? In 
this case, you set up a regular consumer (basic.consume). When a message arrives, you 
publish it back to rabbitmq but to a different routing_key (say "finished.{batch_number}" 
to topic-based exchange), and then ack the original one. Once you accumulate N messages, 
you write entire batch to the database, and then send something like "END" to 
"finished.{batch_number}". Have another process regularly check all finished.* messages, 
and for those that were not properly END'ed, put them back into original queue.

In this case, your window of inconsistency should be much smaller I think. With multiple 
consumer, make sure to use "finished.{consumer_id}_{batch_number}" instead.



- Dmitriy



From 0x6e6562 at gmail.com  Sat Oct 11 00:07:51 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 11 Oct 2008 00:07:51 +0100
Subject: [rabbitmq-discuss] Message ack timeout
In-Reply-To: <48EF8D78.9090704@cohesiveft.com>
References: <08C22EAA-BE7F-4A87-917A-F977B6B354C4@gmail.com>
	<48EF8D78.9090704@cohesiveft.com>
Message-ID: <269388e30810101607o21bd0ed0m7162f781dc4c54f@mail.gmail.com>

Dmitriy,

On Fri, Oct 10, 2008 at 6:14 PM, Dmitriy Samovskiy
<dmitriy.samovskiy at cohesiveft.com> wrote:
> A problem of course is that something may happen before you finish ack'ing all messages
> (say after you ack'ed 2 of 5). It is my understanding that you won't be able to ack them
> all together, since basic.ack can only ack messages on its channel.

I don't know if I'm missing the point, but you can acknowledge a range
of messages that were delivered within a channel. Using this command
(basic.ack {delivery_tag = 0, multiple = true}), if you set the
multiple flag, the broker will tick off every message that a consumer
has pulled off up until the tag specified in the command.

HTH,

Ben



From alexis.richardson at cohesiveft.com  Sat Oct 11 19:59:28 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sat, 11 Oct 2008 19:59:28 +0100
Subject: [rabbitmq-discuss] introducing Nanite: self assembling fabric of
	ruby daemons using RabbitMQ
Message-ID: <167204d20810111159s756b696fq10dc8b1ff7738f24@mail.gmail.com>

Hi all,

This is very cool.  Kudos to Ezra at EngineYard :-)

Nanite enables you to scale merb and rails apps, using rabbitmq to
pass requests to backend workers asynchronously based on load profile.
 Take a look here: http://github.com/ezmobius/nanite/tree/master

This pattern could also be implemented using other languages eg Python and PHP.

alexis



From rgl at ruilopes.com  Sun Oct 12 10:25:06 2008
From: rgl at ruilopes.com (Rui Lopes)
Date: Sun, 12 Oct 2008 10:25:06 +0100
Subject: [rabbitmq-discuss] introducing Nanite: self assembling fabric
 of	ruby daemons using RabbitMQ
In-Reply-To: <167204d20810111159s756b696fq10dc8b1ff7738f24@mail.gmail.com>
References: <167204d20810111159s756b696fq10dc8b1ff7738f24@mail.gmail.com>
Message-ID: <48F1C272.3040807@ruilopes.com>

Hello,

Alexis Richardson wrote:
> This is very cool.  Kudos to Ezra at EngineYard :-)
>   
Indeed, my hat off to them ;-)

> Nanite enables you to scale merb and rails apps, using rabbitmq to
> pass requests to backend workers asynchronously based on load profile.
>  Take a look here: http://github.com/ezmobius/nanite/tree/master
>
> This pattern could also be implemented using other languages eg Python and PHP.
>   
It would be cool if they were already using JSON payloads, so we can 
join Python/JavaScript into the pack *G*

Thanks for the heads up Alexis!

Best regards,
Rui Lopes



From amspb1 at hotmail.com  Mon Oct 13 12:47:50 2008
From: amspb1 at hotmail.com (Anatole Medyntsev)
Date: Mon, 13 Oct 2008 11:47:50 +0000
Subject: [rabbitmq-discuss] Channel Manager framework as an extensions for
	RabbitMQ
Message-ID: <COL108-W22D3A0CD85BCBFC7E4738593360@phx.gbl>


Hello All,
I started of the Channel Manager framework for distributed application: http://www.codeplex.com/CanalManager/
But, I hope the Channel/Ports paradigm with specific message exchange protocol used in the Channel Manager could be interesting for you as an extension of RabbitMQ. I don?t plan to use RabbitMQ so far in my project. But, feel free to use my approach in your one.
 
Regards,
Anatoly Medyntsev,
Arcadia Inc.
_________________________________________________________________
Explore the seven wonders of the world
http://search.msn.com/results.aspx?q=7+wonders+world&mkt=en-US&form=QBRE
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081013/52f6440c/attachment.htm 

From alexis.richardson at cohesiveft.com  Mon Oct 13 18:55:37 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Mon, 13 Oct 2008 18:55:37 +0100
Subject: [rabbitmq-discuss] (London) RabbitMQ talk this Thursday 16th
Message-ID: <167204d20810131055q534215d1w55ed49da43bfbf07@mail.gmail.com>

Folks,

There is a talk on RabbitMQ this Thursday October 16th.

The agenda will be:
1. Overview - why RabbitMQ and AMQP
2. How we got away with less then 5k LOC in the server
3. Ben's hackathon showing what you can do and how

It will start at 6:30pm and be at the LShift offices in London:
http://www.lshift.net/contact

A few beers may be provided and some RabbitMQ t-shirts are available
for people who don't have one yet ;-)

It would be great to see people there.  Feel free to bring a few friends
- if you want to bring a massive posse let me know in advance.

Cheers,

alexis



From Andrius.Norkaitis at oryo.lt  Tue Oct 14 09:54:56 2008
From: Andrius.Norkaitis at oryo.lt (Andrius Norkaitis)
Date: Tue, 14 Oct 2008 11:54:56 +0300
Subject: [rabbitmq-discuss] Exeption in .NET Client Sample (when disposing)
Message-ID: <000001c92dda$8b512080$a1f36180$@Norkaitis@oryo.lt>

Hi,

 

I debugged "senstring" example and detected that .NET Client throws
exception when IConnection is disposed/closed.

 

Code:

 

            using (IConnection conn = new
ConnectionFactory().CreateConnection(serverAddress))

                 {

                     using (IModel ch = conn.CreateModel())

                     {

                         ushort ticket = ch.AccessRequest("/data");

 

                         if (exchange != "")

                         {

                             ch.ExchangeDeclare(ticket, exchange,
exchangeType);

                         }

 

                         ch.BasicPublish(ticket,

                                         exchange,

                                         routingKey,

                                         null,

                                         SerializeObject(order));

 

                     }

                 } //Traced, that exeption is coused somewhere in Client,
when disposing

 

A first chance exception of type 'System.ObjectDisposedException' occurred
in System.dll

 

 

Can somebody try and confirm it?

 

Andrius

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081014/284a14d2/attachment.htm 

From dialtone at gmail.com  Tue Oct 14 22:23:58 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Tue, 14 Oct 2008 14:23:58 -0700
Subject: [rabbitmq-discuss] Catching channel disconnect
Message-ID: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey,
I'm using the erlang client and I need to detect when one of my channels
disconnects, from my crash report I see that:

=CRASH REPORT==== 14-Oct-2008::12:22:59 ===
   crasher:
     pid: <0.155.0>
     registered_name: []
     exception exit: {function_clause,
                         [{amqp_channel,handle_info,
                              [{'EXIT',<0.157.0>,normal},
                               {channel_state, 
1,<0.151.0>,<0.153.0>,<0.156.0>,
                                   #Fun<amqp_network_driver.do.2>,
                                   #Fun<amqp_network_driver.do.3>,
                                    
#Fun<amqp_network_driver.close_channel.1>,

what happens is that this function is called:

handle_info( {'EXIT', Pid, normal}, State) ->
     NewState = unregister_channel(Pid, State),
     {noreply, NewState};

Which unregisters the channel. Unfortunately I don't understand how to  
setup the
system so that it reconnects or that it crashes if the channel goes  
down.

I have a supervisor that is configured in this way:

    ...

     {ok, RemoteHost} = application:get_env(server, remote_host),
     {ok, Tsize} = application:get_env(server, t_size),

     Shovel = {shovel,
         {shovel, start, [RemoteHost, Tsize]},
         permanent, 5000, worker, [shovel]
     },

     Processes = [Shovel, EGeoIp, ShareServer, Web],
     {ok, {{one_for_one, 10, 10}, Processes}}.


While the shovel.erl file is here:
http://github.com/dialtone/shovel/tree/master/src/shovel.erl

This all works fine until I shut down the remote host, then shovel  
crashes
and I can't see how to recover it.

I'd also would be grateful if anyone could point me to a good OTP  
documentation
where good means that it explains how everything fits together rather  
than simply
how I can configure stuff here and there (as done in programming  
erlang).

I'm basically a bit clueless as to how to proceed without changing the  
client's
source code.

- --
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (Darwin)

iEYEARECAAYFAkj1De4ACgkQ9Llz28widGUF7gCghtBZ/HcLsz9EoQuv/raUJgAI
WysAnRIZT+18OjmN27BBYskFMYI18/oL
=Vx8d
-----END PGP SIGNATURE-----



From dialtone at gmail.com  Tue Oct 14 22:49:52 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Tue, 14 Oct 2008 14:49:52 -0700
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
Message-ID: <3706EDE7-8054-4215-87A9-3B7ECD2FB3F5@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Oct 14, 2008, at 2:23 PM, Valentino Volonghi wrote:

> I'm basically a bit clueless as to how to proceed without changing  
> the client's
> source code.


Ok, so I'm a little bit less clueless now. What happens actually is  
that shovel crashes
but if the rabbitmq comes back up it tries to reconnect to it when the  
next message
is delivered, I suppose the system restarts itself when trying to send  
a message then
it crashes and restarts. So this could work except that it tries super  
hard to reconnect
immediately and thus almost immediately reaches the max number of  
retries and
then crashes completely.

Is there a way to control this behavior?

- --
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (Darwin)

iEYEARECAAYFAkj1FAEACgkQ9Llz28widGX5OACfVcY0EgUPaD/6RHWQMLymEeXR
q/0AoLtMGbUXnUDVr7eME2E40oF19z+t
=e42i
-----END PGP SIGNATURE-----



From 0x6e6562 at gmail.com  Tue Oct 14 23:54:58 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 14 Oct 2008 23:54:58 +0100
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
Message-ID: <269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>

Valentino,

On Tue, Oct 14, 2008 at 10:23 PM, Valentino Volonghi <dialtone at gmail.com> wrote:
> This all works fine until I shut down the remote host, then shovel
> crashes
> and I can't see how to recover it.

You may be running into the same issue that has been addressed in
branch 19251 (which is awaiting QA before being folded back into the
trunk).

HTH,

Ben



From dialtone at gmail.com  Wed Oct 15 00:31:56 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Tue, 14 Oct 2008 16:31:56 -0700
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
Message-ID: <83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


On Oct 14, 2008, at 3:54 PM, Ben Hood wrote:

> Valentino,
>
> On Tue, Oct 14, 2008 at 10:23 PM, Valentino Volonghi <dialtone at gmail.com 
> > wrote:
>> This all works fine until I shut down the remote host, then shovel
>> crashes
>> and I can't see how to recover it.
>
> You may be running into the same issue that has been addressed in
> branch 19251 (which is awaiting QA before being folded back into the
> trunk).


Well, I can see that with the patch what would happen is that at the  
exact moment
of the disconnect the process would crash and then would be restarted  
instead of
waiting until a tx_select() fails to then restart everything.

This is fine and more in line with what I would expect, it's just that  
even in this case
erlang appears to not have any kind of exponential backoff  
reconnection strategy.

Basically when it restarts it tries to connect to the remote rabbitmq  
instance and of course,
since it's down (in my test), it raises an econnrefused because no  
port is open. This is
all good and fine. I suspect that since econnrefused is an exception I  
should plug my
logic right there and catch it and start a loop there that runs until  
the connection is
established and use an exponential backoff to ask for new connections.

Do you think this makes sense?

- --
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (Darwin)

iEYEARECAAYFAkj1K+wACgkQ9Llz28widGX/vgCfQCPv06ZNsG0nGGNNqYuLw07r
fWsAnAzgQHAQCWEUrpi6Fuf8wqc1E5jF
=4Wuz
-----END PGP SIGNATURE-----



From dialtone at gmail.com  Wed Oct 15 01:41:19 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Tue, 14 Oct 2008 17:41:19 -0700
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
Message-ID: <D494E156-0F3D-443B-A0A2-E2368131C324@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


On Oct 14, 2008, at 4:31 PM, Valentino Volonghi wrote:

> Do you think this makes sense?


It does, it's in fact very simple:

http://github.com/dialtone/shovel/tree/master/src/shovel.erl#L55

connect(User, Password, To) ->
     connect(User, Password, To, 1000).

connect(User, Password, To, Backoff) ->
     try
         Connection = lib_amqp:start_connection(User, Password, To),
         Channel = lib_amqp:start_channel(Connection),
         {Connection, Channel}
     catch
         error:{badmatch,{error,econnrefused}} ->
             % so the remote is not reachable right now... let's backoff
             timer:sleep(Backoff),
             NewBackoff = lists:min([round(Backoff*? 
BACKOFF_MULTIPLIER), ?BACKOFF_MAX]),
             connect(User, Password, To, NewBackoff)
     end.

does the trick.

One thing I'm wondering though... Is tail recursion preserved when the  
call or the
return value is inside a try..catch or a case ... of ?

I'll patiently wait for the other patch to land tip :)

- --
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (Darwin)

iEYEARECAAYFAkj1PC8ACgkQ9Llz28widGWqRgCdEivGBHrIsdH+lfWPXHH6wY2o
Qn0An2GRkqiNQE6I6uZIN/sH4v8iCV78
=+Qfp
-----END PGP SIGNATURE-----



From norbu09 at googlemail.com  Wed Oct 15 03:45:39 2008
From: norbu09 at googlemail.com (lenz)
Date: Wed, 15 Oct 2008 15:45:39 +1300
Subject: [rabbitmq-discuss] erlang AMQP network_client problem
Message-ID: <e25246b60810141945l35661e51m6c240d8a75260326@mail.gmail.com>

i have a weird issue with the network client code. no matter which version
of rabbit i use (tested against 1.3,1.4 and current) and which version of
rabbit-erlang-client i use (tried various snapshots over the last weeks) i
always get this error:

=ERROR REPORT==== 15-Oct-2008::14:50:08 ===
Error in process <0.51.0> on node 'web at rino' with exit value:
{badarg,[{rabbit_framing,encode_method_fields,1},{rabbit_binary_generator,build_simple_method_frame,2},{rabbit_writer,internal_send_command_async,3},{rabbit_writer,handle_message,2},{rabbit_writer,mainloop,1}]}

Connection: Handling exit from <0.50.0> --> {function_clause,
                                             [{amqp_channel,handle_info,
                                               [{'EXIT',<0.51.0>,
                                                 {badarg,
                                                  [{rabbit_framing,
                                                    encode_method_fields,1},
                                                   {rabbit_binary_generator,

 build_simple_method_frame,
                                                    2},
                                                   {rabbit_writer,

 internal_send_command_async,
                                                    3},
                                                   {rabbit_writer,
                                                    handle_message,2},
                                                   {rabbit_writer,mainloop,
                                                    1}]}},
                                                {channel_state,1,<0.45.0>,
                                                 <0.47.0>,<0.51.0>,

#Fun<amqp_network_driver.do.2>,

#Fun<amqp_network_driver.do.3>,

#Fun<amqp_network_driver.close_channel.1>,
                                                 {[{{<0.37.0>,#Ref<0.0.0.64
>},
                                                    {'queue.declare',

undefined,<<"q">>,false,

false,false,false,false,
                                                     []}}],
                                                  []},
                                                 {[],[]},
                                                 {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],
                                                   [],[],[],[],[],[],[]},
                                                  {{[],[],[],[],[],[],[],[],

 [],[],[],[],[],[],[],[]}}},
                                                 false,undefined,
                                                 {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],
                                                   [],[],[],[],[],[],[]},
                                                  {{[],[],[],[],[],[],[],[],
                                                    [],[],[],[],[],[],[],
                                                    []}}}}]},
                                              {gen_server,handle_msg,5},
                                              {proc_lib,init_p,5}]}
...

as long as i use the beast locally everything works fine. what do i miss
here?

all the network_client tests fail as well btw

(web at rino)3> net_adm:ping(rabbit at rino).
pong
(web at rino)4> direct_client_test:test_coverage().
direct_client_test:basic_get_test...*failed*
::error:{badmatch,{error,{aborted,{no_exists,[user,<<"guest">>]}}}}
  in function amqp_connection:start/3
  in call from direct_client_test:basic_get_test/0


direct_client_test:basic_return_test...*failed*
::error:{badmatch,{error,{aborted,{no_exists,[user,<<"guest">>]}}}}
  in function amqp_connection:start/3
  in call from direct_client_test:basic_return_test/0
...

thanks
lenz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081015/6bbef609/attachment.htm 

From matthias at lshift.net  Wed Oct 15 07:29:05 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 15 Oct 2008 07:29:05 +0100
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <D494E156-0F3D-443B-A0A2-E2368131C324@gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
	<D494E156-0F3D-443B-A0A2-E2368131C324@gmail.com>
Message-ID: <48F58DB1.1090204@lshift.net>

Valentino,

Valentino Volonghi wrote:
> Is tail recursion preserved when the call or the return value is
> inside a try..catch or a case ... of ?

It is. Try this in the shell:

1> F = fun(G) -> try throw(x) catch _ -> G(G) end end.
#Fun<erl_eval.6.13229925>
2> F(F).


Matthias.



From matthias at lshift.net  Wed Oct 15 07:39:29 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 15 Oct 2008 07:39:29 +0100
Subject: [rabbitmq-discuss] erlang AMQP network_client problem
In-Reply-To: <e25246b60810141945l35661e51m6c240d8a75260326@mail.gmail.com>
References: <e25246b60810141945l35661e51m6c240d8a75260326@mail.gmail.com>
Message-ID: <48F59021.4010207@lshift.net>

Lenz,

lenz wrote:
> i have a weird issue with the network client code. no matter which 
> version of rabbit i use (tested against 1.3,1.4 and current) and which 
> version of rabbit-erlang-client i use (tried various snapshots over the 
> last weeks) i always get this error:
> 
> =ERROR REPORT==== 15-Oct-2008::14:50:08 ===
> Error in process <0.51.0> on node 'web at rino' with exit value: 
> {badarg,[{rabbit_framing,encode_method_fields,1},{rabbit_binary_generator,build_simple_method_frame,2},{rabbit_writer,internal_send_command_async,3},{rabbit_writer,handle_message,2},{rabbit_writer,mainloop,1}]}
> [...]
> {'queue.declare',undefined,<<"q">>,false,false,false,false,false,[]}
 > [...]
> as long as i use the beast locally everything works fine. what do i
> miss  here?

It looks like you have a queue.declare with the ticket field set to 
'undefined'. That will break the network encoding, but work in the 
direct case since there the value isn't checked.


Matthias.



From 0x6e6562 at gmail.com  Wed Oct 15 08:56:19 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Oct 2008 08:56:19 +0100
Subject: [rabbitmq-discuss] erlang AMQP network_client problem
In-Reply-To: <e25246b60810141945l35661e51m6c240d8a75260326@mail.gmail.com>
References: <e25246b60810141945l35661e51m6c240d8a75260326@mail.gmail.com>
Message-ID: <269388e30810150056j7c07fb52gd3f4dcb64f577cba@mail.gmail.com>

Lenz,

On Wed, Oct 15, 2008 at 3:45 AM, lenz <norbu09 at googlemail.com> wrote:
> {'queue.declare',undefined,<<"q">>,false, false,false,false,false,[]}}],
> as long as i use the beast locally everything works fine. what do i miss
> here?

As Matthias has pointed out, the ticket field is not set. One way to
do this without setting it yourself is to use the latest version of
the rabbitmq-codegen project with the latest default branch of the
server. The codegen project now sets convenient default values for
various fields including tickets.

> all the network_client tests fail as well btw
> (web at rino)3> net_adm:ping(rabbit at rino).
> pong
> (web at rino)4> direct_client_test:test_coverage().

BTW, I wouldn't bother with the test_coverage/0 function, I don't
think it works. Use test/0 instead.

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Oct 15 09:08:47 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Oct 2008 09:08:47 +0100
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
Message-ID: <269388e30810150108s5819c474pc1f96748763d1a5c@mail.gmail.com>

Valentio,

On Wed, Oct 15, 2008 at 12:31 AM, Valentino Volonghi <dialtone at gmail.com> wrote:
> Well, I can see that with the patch what would happen is that at the exact
> moment
> of the disconnect the process would crash and then would be restarted
> instead of
> waiting until a tx_select() fails to then restart everything.

That patch addresses the issue of the connection to the other peer's
socket being lost.

I don't quite know what you mean with the failure of a tx_select
command. How does this differ from anything any other pending RPC
whose bottom half doesn't arrive because the underlying socket
connection has died?

>
> This is fine and more in line with what I would expect, it's just that even
> in this case
> erlang appears to not have any kind of exponential backoff reconnection
> strategy.

Sorry, I don't follow this either - are you saying that the socket
abstraction in Erlang should try to reconnect a few times before
telling higher level code that the underlying TCP connection has died?

> Basically when it restarts it tries to connect to the remote rabbitmq
> instance and of course,
> since it's down (in my test), it raises an econnrefused because no port is
> open. This is
> all good and fine. I suspect that since econnrefused is an exception I
> should plug my
> logic right there and catch it and start a loop there that runs until the
> connection is
> established and use an exponential backoff to ask for new connections.
>
> Do you think this makes sense?

If I you are meaning to say that retries are a concern of the client
app rather than the client itself, then yes.

>From an architectural perspective, the role of the client is to
provide a transparent and correct propagation of events between a
client app and the broker. It should not try to address the problems
of application flow that are best left to higher level code.

HTH,

Ben



From dialtone at gmail.com  Wed Oct 15 09:53:40 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Wed, 15 Oct 2008 01:53:40 -0700
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <269388e30810150108s5819c474pc1f96748763d1a5c@mail.gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
	<269388e30810150108s5819c474pc1f96748763d1a5c@mail.gmail.com>
Message-ID: <6CCA7377-6E1F-4D40-896C-7721AB3133DF@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Oct 15, 2008, at 1:08 AM, Ben Hood wrote:

> That patch addresses the issue of the connection to the other peer's
> socket being lost.
>
> I don't quite know what you mean with the failure of a tx_select
> command. How does this differ from anything any other pending RPC
> whose bottom half doesn't arrive because the underlying socket
> connection has died?

It doesn't, the tx_select just happens to be the one call that  
triggers the crash and restart
for my code which still doesn't include the patch.

> Sorry, I don't follow this either - are you saying that the socket
> abstraction in Erlang should try to reconnect a few times before
> telling higher level code that the underlying TCP connection has died?

No, I used erlang in the wrong way, scratch that. I meant the  
supervisor doesn't
provide a mechanism to restart the application using an exponential  
backoff
rather than simply as fast as possible as it's currently with the 3  
strategies.

Clearly I don't need to implement backoff myself if erlang restarts a  
dying process
increasing the interval at each retry.

> If I you are meaning to say that retries are a concern of the client
> app rather than the client itself, then yes.
>
> From an architectural perspective, the role of the client is to
> provide a transparent and correct propagation of events between a
> client app and the broker. It should not try to address the problems
> of application flow that are best left to higher level code.


Yes, I fully understand that, I don't claim that the client API should  
provide a
mechanism to do exponential backoff. :). I was simply asking myself  
if, without
rewriting the supervisor behavior to include this new feature, there  
was another
way to achieve the same results. As a matter of fact it's possible and  
it's relatively
easy. I'm starting to learn to rely on supervisor restarts as part of  
the application
logic, it wouldn't surprise me if this is actually part of the erlang  
kool-aid.

thanks again.

- --
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (Darwin)

iEYEARECAAYFAkj1r5QACgkQ9Llz28widGV2HQCfbpwVJMCWC1iwjDgKOQhaZGQo
KjIAn1koAww376Mj9xbPM6Vvw35mVHdQ
=vKfQ
-----END PGP SIGNATURE-----



From 0x6e6562 at gmail.com  Wed Oct 15 11:15:54 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Oct 2008 11:15:54 +0100
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <6CCA7377-6E1F-4D40-896C-7721AB3133DF@gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
	<269388e30810150108s5819c474pc1f96748763d1a5c@mail.gmail.com>
	<6CCA7377-6E1F-4D40-896C-7721AB3133DF@gmail.com>
Message-ID: <269388e30810150315x2d0715d4jeb63cea17e20d530@mail.gmail.com>

Valentino,

On Wed, Oct 15, 2008 at 9:53 AM, Valentino Volonghi <dialtone at gmail.com> wrote:
> It doesn't, the tx_select just happens to be the one call that triggers the
> crash and restart
> for my code which still doesn't include the patch.

Are you saying that when the client sends a tx_select, this crashes the broker?

> Yes, I fully understand that, I don't claim that the client API should
> provide a
> mechanism to do exponential backoff. :). I was simply asking myself if,
> without
> rewriting the supervisor behavior to include this new feature, there was
> another
> way to achieve the same results. As a matter of fact it's possible and it's
> relatively
> easy. I'm starting to learn to rely on supervisor restarts as part of the
> application
> logic, it wouldn't surprise me if this is actually part of the erlang
> kool-aid.

Sounds sensible.

Ben



From dialtone at gmail.com  Wed Oct 15 16:21:13 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Wed, 15 Oct 2008 08:21:13 -0700
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <269388e30810150315x2d0715d4jeb63cea17e20d530@mail.gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
	<269388e30810150108s5819c474pc1f96748763d1a5c@mail.gmail.com>
	<6CCA7377-6E1F-4D40-896C-7721AB3133DF@gmail.com>
	<269388e30810150315x2d0715d4jeb63cea17e20d530@mail.gmail.com>
Message-ID: <8E6122DB-EEB8-40CE-9E89-247C2EC80028@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


On Oct 15, 2008, at 3:15 AM, Ben Hood wrote:

> Are you saying that when the client sends a tx_select, this crashes  
> the broker?

No, it crashes the unpatched client if it's not actually connected to  
the broker.

- --
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (Darwin)

iEYEARECAAYFAkj2CmkACgkQ9Llz28widGXCJgCfWM1bhCr4YCeImwqOr8YDmhfw
+EIAnjo5twWnKvWPttTdyyUmv4dm2EMc
=3BIS
-----END PGP SIGNATURE-----



From 0x6e6562 at gmail.com  Wed Oct 15 17:09:55 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Oct 2008 17:09:55 +0100
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <269388e30810150909h5f992ad5i2626d8988e7a992b@mail.gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
	<269388e30810150108s5819c474pc1f96748763d1a5c@mail.gmail.com>
	<6CCA7377-6E1F-4D40-896C-7721AB3133DF@gmail.com>
	<269388e30810150315x2d0715d4jeb63cea17e20d530@mail.gmail.com>
	<8E6122DB-EEB8-40CE-9E89-247C2EC80028@gmail.com>
	<269388e30810150909h5f992ad5i2626d8988e7a992b@mail.gmail.com>
Message-ID: <269388e30810150909j23eea77fle5537979a1f1d1ad@mail.gmail.com>

Valentino,

On Wed, Oct 15, 2008 at 4:21 PM, Valentino Volonghi <dialtone at gmail.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> On Oct 15, 2008, at 3:15 AM, Ben Hood wrote:
>
>> Are you saying that when the client sends a tx_select, this crashes the
>> broker?
>
> No, it crashes the unpatched client if it's not actually connected to the
> broker.

Good. That's what the patch is intended to fix.

Ben



From hubert at lshift.net  Fri Oct 17 10:43:30 2008
From: hubert at lshift.net (Hubert Plociniczak)
Date: Fri, 17 Oct 2008 10:43:30 +0100
Subject: [rabbitmq-discuss] Exeption in .NET Client Sample (when
	disposing)
In-Reply-To: <000001c92dda$8b512080$a1f36180$@Norkaitis@oryo.lt>
References: <000001c92dda$8b512080$a1f36180$@Norkaitis@oryo.lt>
Message-ID: <48F85E42.6090801@lshift.net>

Andrius,

I believe this is the problem we identified some time ago,
see 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-August/001548.html.

I am guessing here but you are probably using the 1.4.0 version of the 
C# client, right?
The bug is fixed, so have a look at the latest state of the default 
branch of the repository.

For building instructions see 
http://www.rabbitmq.com/build-dotnet-client.html.

Thanks,
hubert

Andrius Norkaitis wrote:
>
> Hi,
>
> I debugged ?senstring? example and detected that .NET Client throws 
> exception when IConnection is disposed/closed.
>
> Code:
>
> using (IConnection conn = new 
> ConnectionFactory().CreateConnection(serverAddress))
>
> {
>
> using (IModel ch = conn.CreateModel())
>
> {
>
> ushort ticket = ch.AccessRequest("/data");
>
> if (exchange != "")
>
> {
>
> ch.ExchangeDeclare(ticket, exchange, exchangeType);
>
> }
>
> ch.BasicPublish(ticket,
>
> exchange,
>
> routingKey,
>
> null,
>
> SerializeObject(order));
>
> }
>
> } //Traced, that exeption is coused somewhere in Client, when disposing
>
> A first chance exception of type 'System.ObjectDisposedException' 
> occurred in System.dll
>
> Can somebody try and confirm it?
>
> Andrius
>
> ------------------------------------------------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   


-- 
 [][][] Hubert Plociniczak
   [][] LShift Ltd
 []  [] www.lshift.net




From kirk at kirkwylie.com  Fri Oct 17 10:28:49 2008
From: kirk at kirkwylie.com (Kirk Wylie)
Date: Fri, 17 Oct 2008 10:28:49 +0100
Subject: [rabbitmq-discuss] (London) RabbitMQ talk this Thursday 16th
In-Reply-To: <167204d20810131055q534215d1w55ed49da43bfbf07@mail.gmail.com>
References: <167204d20810131055q534215d1w55ed49da43bfbf07@mail.gmail.com>
Message-ID: <8f10a9e00810170228h2502dcefya441a5e70b3d07c0@mail.gmail.com>

For those of you who missed it, a great time was had by all, and I
wanted to salute Alexis, Matteus (I'm sure I messed THAT up) and Ben
for putting on a good show and LShift for hosting.

I did a little writeup on the contents for those of you who couldn't
attend, but it was quite a good talk.

http://kirkwylie.blogspot.com/2008/10/rabbitmq-talk-at-lshift-last-night.html

Kirk Wylie

On Mon, Oct 13, 2008 at 6:55 PM, Alexis Richardson
<alexis.richardson at cohesiveft.com> wrote:
> Folks,
>
> There is a talk on RabbitMQ this Thursday October 16th.
>
> The agenda will be:
> 1. Overview - why RabbitMQ and AMQP
> 2. How we got away with less then 5k LOC in the server
> 3. Ben's hackathon showing what you can do and how
>
> It will start at 6:30pm and be at the LShift offices in London:
> http://www.lshift.net/contact
>
> A few beers may be provided and some RabbitMQ t-shirts are available
> for people who don't have one yet ;-)
>
> It would be great to see people there.  Feel free to bring a few friends
> - if you want to bring a massive posse let me know in advance.
>
> Cheers,
>
> alexis
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From pneumann at gmail.com  Fri Oct 17 14:26:53 2008
From: pneumann at gmail.com (Phillip N.)
Date: Fri, 17 Oct 2008 10:26:53 -0300
Subject: [rabbitmq-discuss] Ruby library
Message-ID: <1224250013.3272.23.camel@negro>

Hi,

I dont know if its ok to send this question here. if not sorry.. :)

Im trying to send durable messages to durable queues, using tmm1-amqp
ruby library, without much luck.

Im using the attached script to test this.
The idea is to get the message after rabbitmq restarts, but im not
getting it.

When i run the test, and do not restart rabbitmq, then the message
arrives as this:

"got the msg! 'body'"
#<AMQP::Protocol::Header:0x857ccc4
 @klass=AMQP::Protocol::Basic,
 @properties=
  {:consumer_tag=>"q4",
   :redelivered=>false,
   :exchange=>"ex4",
   :priority=>0,
   :delivery_mode=>2,
   :delivery_tag=>1,
   :content_type=>"application/octet-stream",
   :routing_key=>"this.one.key4"},
 @size=4,
 @weight=0>

delivery_mode=2 meas its a durable message, isnit?

Why is the script not getting the message after rabbitmq restarts?

Im using version 0.5.5.
With 0.5.9 cannot test it becouse AMQP.stop {EM.stop_event_loop } is
generating an exception:


/usr/local/lib/ruby/gems/1.8/gems/tmm1-amqp-0.5.9/lib/amqp/client.rb:72:in `connection_completed': Disconnected from server (AMQP::Error)

from /usr/local/lib/ruby/gems/1.8/gems/tmm1-amqp-0.5.9/lib/amqp/client.rb:42:in `call'

from /usr/local/lib/ruby/gems/1.8/gems/tmm1-amqp-0.5.9/lib/amqp/client.rb:42:in `process_frame'

from /usr/local/lib/ruby/gems/1.8/gems/tmm1-amqp-0.5.9/lib/amqp/client.rb:100:in `receive_data'

from /usr/local/lib/ruby/gems/1.8/gems/eventmachine-0.12.2/lib/eventmachine.rb:231:in `run_machine'

from /usr/local/lib/ruby/gems/1.8/gems/eventmachine-0.12.2/lib/eventmachine.rb:231:in `run'
	from broker_test.rb:12



Any tip is welcome. Thanks!



-------------- next part --------------
A non-text attachment was scrubbed...
Name: broker_test.rb
Type: application/x-ruby
Size: 933 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081017/05991229/attachment.bin 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: broker_test.rb
Type: application/x-ruby
Size: 933 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081017/05991229/attachment-0001.bin 

From 0x6e6562 at gmail.com  Fri Oct 17 17:35:46 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 17 Oct 2008 17:35:46 +0100
Subject: [rabbitmq-discuss] Ruby library
In-Reply-To: <1224250013.3272.23.camel@negro>
References: <1224250013.3272.23.camel@negro>
Message-ID: <269388e30810170935l7ebdb57erca9b16a96eb2810a@mail.gmail.com>

Phillip,

On Fri, Oct 17, 2008 at 2:26 PM, Phillip N. <pneumann at gmail.com> wrote:
> I dont know if its ok to send this question here. if not sorry.. :)

In principle you can ask any Rabbit related question on this list, so
your question is perfectly valid.

Having said that, I would first want to run this question by the
ruby-amqp list (http://groups.google.com/group/ruby-amqp) in order to
verify that that you are using the client properly.

I think Aman will be able to answer your question quicker that anybody else.

If that doesn't bear any fruit, feel free to take it up again on this list.

HTH,

Ben



From 0x6e6562 at gmail.com  Fri Oct 17 17:57:22 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 17 Oct 2008 17:57:22 +0100
Subject: [rabbitmq-discuss] Ruby library
In-Reply-To: <1224250013.3272.23.camel@negro>
References: <1224250013.3272.23.camel@negro>
Message-ID: <269388e30810170957s256d0a48m6ec426526593897d@mail.gmail.com>

Phillip,

On Fri, Oct 17, 2008 at 2:26 PM, Phillip N. <pneumann at gmail.com> wrote:

> delivery_mode=2 meas its a durable message, isnit?
>
> Why is the script not getting the message after rabbitmq restarts?

One non-Ruby observation maybe be the fact that you can send
persistent messages to a transient queue. If the queue that you are
consuming from does not survive the restart (because it was perhaps
not declared as being durable), then you can not consume a message
from it, because it won't exist.

Ben



From alexis.richardson at cohesiveft.com  Fri Oct 17 18:05:18 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 17 Oct 2008 18:05:18 +0100
Subject: [rabbitmq-discuss] Ruby library
In-Reply-To: <269388e30810170935l7ebdb57erca9b16a96eb2810a@mail.gmail.com>
References: <1224250013.3272.23.camel@negro>
	<269388e30810170935l7ebdb57erca9b16a96eb2810a@mail.gmail.com>
Message-ID: <167204d20810171005i7f13dc7dhaff916fb99dd2228@mail.gmail.com>

Phillip

It's also cool to cross post to both lists ;-)

alexis


On Fri, Oct 17, 2008 at 5:35 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Phillip,
>
> On Fri, Oct 17, 2008 at 2:26 PM, Phillip N. <pneumann at gmail.com> wrote:
>> I dont know if its ok to send this question here. if not sorry.. :)
>
> In principle you can ask any Rabbit related question on this list, so
> your question is perfectly valid.
>
> Having said that, I would first want to run this question by the
> ruby-amqp list (http://groups.google.com/group/ruby-amqp) in order to
> verify that that you are using the client properly.
>
> I think Aman will be able to answer your question quicker that anybody else.
>
> If that doesn't bear any fruit, feel free to take it up again on this list.
>
> HTH,
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From pneumann at gmail.com  Fri Oct 17 18:35:29 2008
From: pneumann at gmail.com (Phillip N.)
Date: Fri, 17 Oct 2008 14:35:29 -0300
Subject: [rabbitmq-discuss] Ruby library
In-Reply-To: <167204d20810171005i7f13dc7dhaff916fb99dd2228@mail.gmail.com>
References: <1224250013.3272.23.camel@negro>
	<269388e30810170935l7ebdb57erca9b16a96eb2810a@mail.gmail.com>
	<167204d20810171005i7f13dc7dhaff916fb99dd2228@mail.gmail.com>
Message-ID: <1224264929.3272.35.camel@negro>

Hi,

I was about to send the same email to the other mailing list, and test
it ones again. I realise that it was working fine.

It was my error, probably becouse im playing with more that 1 server,
and got confused.

The server on my notebook did not behaves well, ill reinstall and report
if the problem persist.

Sorry for the noise and thanks!






From alexis.richardson at cohesiveft.com  Fri Oct 17 18:40:26 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 17 Oct 2008 18:40:26 +0100
Subject: [rabbitmq-discuss] Ruby library
In-Reply-To: <1224264929.3272.35.camel@negro>
References: <1224250013.3272.23.camel@negro>
	<269388e30810170935l7ebdb57erca9b16a96eb2810a@mail.gmail.com>
	<167204d20810171005i7f13dc7dhaff916fb99dd2228@mail.gmail.com>
	<1224264929.3272.35.camel@negro>
Message-ID: <167204d20810171040r52897230hb21e61cee62dbb7@mail.gmail.com>

No worries :-)

And thanks for the clarification.  We worry when things seem to not work..


On Fri, Oct 17, 2008 at 6:35 PM, Phillip N. <pneumann at gmail.com> wrote:
> Hi,
>
> I was about to send the same email to the other mailing list, and test
> it ones again. I realise that it was working fine.
>
> It was my error, probably becouse im playing with more that 1 server,
> and got confused.
>
> The server on my notebook did not behaves well, ill reinstall and report
> if the problem persist.
>
> Sorry for the noise and thanks!
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From 0x6e6562 at gmail.com  Fri Oct 17 19:18:51 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 17 Oct 2008 19:18:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.4 on RHEL 5 64-bit
In-Reply-To: <167204d20810171105le0690afqe85b1d7b0683510d@mail.gmail.com>
References: <845634110810171053g7d7c086cy9aeb81f04efa9091@mail.gmail.com>
	<167204d20810171105le0690afqe85b1d7b0683510d@mail.gmail.com>
Message-ID: <269388e30810171118p17b068e3j1cf7d92e804931aa@mail.gmail.com>

On Fri, Oct 17, 2008 at 7:05 PM, Alexis Richardson
<alexis.richardson at cohesiveft.com> wrote:
> Hmm.  This really should work OOTB - many people have used this
> package without any trouble.
> On Fri, Oct 17, 2008 at 6:53 PM, John Arnold <jarnold at sydrom.com> wrote:
>
>> Thus far, I have:
>>
>> 1. Unpacked rabbitmq-server-1.4
>> 2. make
>> 3. make install, setting TARGET_DIR=/opt2/rabbitmq
>>
>> When I run rabbitmqctl, it will only only run successfully from
>> /opt2/rabbitmq/bin directory. Running from any other directory causes a
>> dump, to be written to erl_crash.dump
>>
>> I am sure that it must be a PATH issue?

You might want to try the RPMs that we supply as part of the distribution.

HTH,

Ben



From 0x6e6562 at gmail.com  Mon Oct 20 11:32:20 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 20 Oct 2008 11:32:20 +0100
Subject: [rabbitmq-discuss] Topic routing
Message-ID: <269388e30810200332l4b964a6ax64020b1885d1eb81@mail.gmail.com>

Brian,

I am taking you up on your offer to turn this into a list topic :-)

On Thu, Oct 16, 2008 at 6:06 PM, Brian Sullivan <bsullivan at lindenlab.com> wrote:
> Yes, we're using topic exchanges, since we want to be able to publish
> messages from multiple domains - I've been prepending the domain to the
> topic name. In this case, if I want to
> track someone logging in, my topic is "productiongrid.login".  If I want to
> subscribe across ALL logins for some reason, I can subscribe to "*.login".
>  Does that make sense?

Do you mean that you are sending messages to the default topic
exchange with the routing key productiongrid.login or do you have a
topic exchange called productiongrid.login?

> I guess I *could* create an exchange for each grid, but that seems to be a
> less scalable solution, and it's harder to subscribe to "all" of them.

I don't think I understand your domain enough to judge this (a diagram
always helps :-).

Topic exchanges are very simple way to do hierarchial routing because
consumers can filter out portions of a routing key that they are not
interested in.

However, in the current architecture, direct bindings are more
efficient than topic bindings because they can exploit an index that
topics can't.

So I think that the scalablility sweet spot between topic exchanges
and direct exchanges will depend on the semantics of your application
and the abstractions that you want to employ.

> Either way, if the broker has no bindings to a key, it should be able to
> just drop it, correct?

Yes, if it can't route a message, it just turfs it (if it's quick
enough to drain the pipeline ;-)

> I am not clear why it would be so slow in this case.
> I just ran some other tests this morning - I think the scenario I described
> below (sudden drop in performance) is when I start using swap. Any
> ideas?

It is always helpful to have a stripped down test that can help us
reproduce the issues that you are experiencing with your own code.
That combined with an understanding of what you are trying to acheive
will allow us to come up with a solution for your problem.

HTH,

Ben



From 0x6e6562 at gmail.com  Mon Oct 20 11:42:46 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 20 Oct 2008 11:42:46 +0100
Subject: [rabbitmq-discuss] Topic routing
In-Reply-To: <A624C6F7-FD5E-4B37-8D56-3FC24DDDA088@synergy-solutions.biz>
References: <269388e30810200332l4b964a6ax64020b1885d1eb81@mail.gmail.com>
	<A624C6F7-FD5E-4B37-8D56-3FC24DDDA088@synergy-solutions.biz>
Message-ID: <269388e30810200342y25c390b2k2845d826dc56fab4@mail.gmail.com>

Preston,

On Mon, Oct 20, 2008 at 11:35 AM, Preston Marshall
<preston at synergy-solutions.biz> wrote:
> It sounds like all you need is a single exchange with different routing keys
> for the consumers, so they only get what they care about.  Thats what we do.

Yes, that is in line with the general AMQP model, but I am trying to
find out more about what Brian's actual requirements are before I make
a recommendation.

BTW, I don't think your post went to the list.

Cheers,

Ben



From kirk at kirkwylie.com  Mon Oct 20 16:01:55 2008
From: kirk at kirkwylie.com (Kirk Wylie)
Date: Mon, 20 Oct 2008 16:01:55 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
Message-ID: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>

Ben asked me to open this up to a list-wide audience, and figured this
would be better than lots of ping-pong back-and-forth on blogs, so I'm
kicking off the topic.

Some background:
http://hopper.squarespace.com/blog/2008/10/7/consumer-driven-messaging.html
http://kirkwylie.blogspot.com/2008/07/amqps-semantic-model-and-mismatching.html

Summary:
I don't believe that the current Exchange system in AMQP (and thus in
RabbitMQ) really accurately represents consumer-driven messaging, in
that the producer of a message has an implicit option to determine the
manner in which messages are routed to consumers by declaring the
exchange and thus its type.

Personally, I believe that the spec should be changed so that
exchanges are nothing other than producer-provided namespaces/groups
of related messages, and consumers should bind to exchanges based on
the semantics that they want.

Example:
Producer is aggregating tick data from a variety of sources. It
publishes to three exchanges, that it declares:
- ControlMsg (for all control messages that don't contain ticks)
- OPRA (for the OPRA feed)
- NYSE (for the NYSE feed)
- TSE (for the Tokyo stock exchange feed)

Subscribers bind their queue to the exchanges that they're interested
in, and when they declare the binding, they ALSO declare the routing
rules that they want, out of a set of routing rules available to them.

Backwards Compatibility?
Yes, you can still achieve backwards compatibility here, particularly
with the "implicit" exchanges, by allowing exchanges to have "default"
routing rules which are specified by the producer's exchange assertion
(or the default assertion). This means that existing applications will
continue to work, and you can develop new applications with consumer
driven bindings that all work.

Ben, care to take it up from here?

Kirk Wylie



From 0x6e6562 at gmail.com  Mon Oct 20 17:59:38 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 20 Oct 2008 17:59:38 +0100
Subject: [rabbitmq-discuss] jms support
In-Reply-To: <21A4D899-49EB-44F2-B0D3-2D5C96DF6AB6@lindenlab.com>
References: <8579EE81-7373-4EA0-AC8E-820B4307F82E@lindenlab.com>
	<E5B2CDBF-9E78-4E2B-B0EF-190BDB9B01A2@lindenlab.com>
	<7556DC8E-FA14-4FE5-ADD6-DD54CD90D9E1@lindenlab.com>
	<167204d20810160941o49faef66v4c4c676a0fb19321@mail.gmail.com>
	<F9B5B828-D7D0-44CA-BC86-2F432798E04D@lindenlab.com>
	<07B6400E-B982-49FD-B189-3ABC5F42DBA1@lindenlab.com>
	<269388e30810171038y6aa70a18w640f3c9b02665579@mail.gmail.com>
	<269388e30810171111o5efd1bf5p8d9f4deca6a3832b@mail.gmail.com>
	<269388e30810200323oabf2ebyc7f657b00bc4332d@mail.gmail.com>
	<21A4D899-49EB-44F2-B0D3-2D5C96DF6AB6@lindenlab.com>
Message-ID: <269388e30810200959j287dd610t7e7ea1bbbf8c1245@mail.gmail.com>

Brian,

On Mon, Oct 20, 2008 at 5:09 PM, Brian Sullivan <bsullivan at lindenlab.com> wrote:
> We do have certain high-volume topics that we would like to be able to not
> worry about buildup - if we aren't running the consuming applications, I
> would expect there to be very little load on the system.  If I understand
> you correctly, I can get flow control if I have an active subscription.

Well not exactly. There is a command in AMQP called Channel.Flow which
is essentially a reverse RPC - the broker requests the client to
suspend sending any messages until such a time that the broker
notifies the client that it can resume sending messages. This gives
the broker a chance to process a backlog and thus prevents any
overflow. The current released version of Rabbit does not implement
this command, we are working on it at the moment and should be
released in the near future (but as always, no concrete ETA).

>  What I want to protect us against is slowing down of the entire system
> because of a spammy topic or two - we'd really like to have the ability to
> turn off consumption of that topic should things go haywire (either on
> message publication, or falling behind on the consumption of other feeds).

To prevent backlog you would ideally want to decrease production (e.g.
by using Channel.Flow) or increase consumption (e.g. by adding more
consumers). I don't think you would want to decrease consumption.

>  The goal we have is to publish everything (ie, not turn off certain topics
> when we have a problem), and manage the load on the server via subscriptions
> and clustering.  Note that our publishing side has all intermixed topics -
> we have applications log all messages to a single place on a host, then we
> simply use that as a transmission buffer.  The benefit there is that we have
> a central place to store the queue of messages to be sent and can manage
> buffering there.  The downside is that flow controlling a single topic is
> not really possible - we'd be slowing down all feeds, if I understand you
> correctly.
>
> Does that make sense?

I think that having a central TX buffer may turn itself into a global
bottleneck for the system.

Having said this, I think it would be a good idea to be more specific
about what you're trying to acheive with what mechanism (hopefully
breaking this down gives you an idea of how I'm interpreting your
questions, which I may be doing wrongly):

1. Centralized logging: You don't need a store and forward dongle to
log everything that passes through the system - you can just bind
every exchange in your system to one or more log queues;

2. Ingress Flow Control: Will be implemented by Channel.Flow command.

3. Egress Flow Control: IMHO this is where your problem is going to
be. To do proper credit based load balancing, you will need the
Basic.QoS command, which we have designed but not yet implemented. ATM
consumption is for all intents and purposes limited by the slowest
consumer. WRT adding resources dynamically, this is not specifically a
concern of the broker, since it has no control over consumers.
Thinking on my feet I have 2 suggestions:

- Always load every available hardware thread on the side of
consumption with the optimal amount of consumers and let the OS
scehduler load balance software threads for you - when there is no
work to do, they just spin in NOOPs
- If you think you can pull some extra CPU out of your hat at a
critical stage, then you could petition us to include a callback
handler mechanism for the Channel.Flow command. The current design
just blocks subsequent publication, but you could easily notify a
callback handler in the event loop which could take any course of
prophylactic action (automagically deploy more consumers if this made
sense or just sending a message to somebody's Blackberry for manual
intervention).

4. Topics: I still haven't completely understood the rational behind
topic exchanges from the point of view of your application. As I have
indicated before, direct exchanges are more efficient that topics ATM,
but the sweet spot is going to depend on your app.

HTH,

Ben



From 0x6e6562 at gmail.com  Mon Oct 20 19:03:36 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 20 Oct 2008 19:03:36 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
Message-ID: <269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>

Kirk,

On Mon, Oct 20, 2008 at 4:01 PM, Kirk Wylie <kirk at kirkwylie.com> wrote:
> Personally, I believe that the spec should be changed so that
> exchanges are nothing other than producer-provided namespaces/groups
> of related messages, and consumers should bind to exchanges based on
> the semantics that they want.

I think you may find resonance with some members of the WG on this
issue. However, moving the routing algorithm to the binding does have
a practical implication from an implementation perspective. This would
turn any routing decision into a linear scan of all of the bindings in
order to perform a match on the routing type :-( You would not be able
to exploit any type-based indexes.

> Backwards Compatibility?
> Yes, you can still achieve backwards compatibility here, particularly
> with the "implicit" exchanges, by allowing exchanges to have "default"
> routing rules which are specified by the producer's exchange assertion
> (or the default assertion). This means that existing applications will
> continue to work, and you can develop new applications with consumer
> driven bindings that all work.

This is true, but I think until AMQP goes 1.0, you should, IMHO,
prioritize design over backwards compatibility.

I think it may not necessary be a good idea to de-characterize an
exchange to the extent that it merely represents a logical address. If
you were to do so, you would be automatically precluding semantics
that you could efficiency build into a custom exchange (e.g. an
exchange that delivers to a subset of the matching binding - for
example the shortest queue).

Furthermore, you can bring the consumer driven-ness into the realm of
your app by having a convention that prevents a producer from
declaring exchanges - if the exchange doesn't exist, then the producer
will not be able to send messages to it.

Cheers,

Ben



From alexis.richardson at cohesiveft.com  Mon Oct 20 20:09:04 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Mon, 20 Oct 2008 20:09:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ - in SF tomorrow and Saturday
Message-ID: <167204d20810201209k403b1116m454b2b10b11e0c44@mail.gmail.com>

Hi all,

I am in SF tomorrow (Tuesday) and would love to meet RabbitMQ users
and critics (or both..).

Please may I propose meeting at the 'Thirsty Bear' at 6:30pm - all welcome :-)

Hope to see you..

alexis

(black hair, 6'2", tel +44 77 9865 2911)



From dialtone at gmail.com  Mon Oct 20 20:17:11 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Mon, 20 Oct 2008 12:17:11 -0700
Subject: [rabbitmq-discuss] RabbitMQ - in SF tomorrow and Saturday
In-Reply-To: <167204d20810201209k403b1116m454b2b10b11e0c44@mail.gmail.com>
References: <167204d20810201209k403b1116m454b2b10b11e0c44@mail.gmail.com>
Message-ID: <43AAD958-082F-4396-ADC3-8B65B0CBCB04@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


On Oct 20, 2008, at 12:09 PM, Alexis Richardson wrote:

> Hi all,
>
> I am in SF tomorrow (Tuesday) and would love to meet RabbitMQ users
> and critics (or both..).
>
> Please may I propose meeting at the 'Thirsty Bear' at 6:30pm - all  
> welcome :-)
>
> Hope to see you..


Expect me to be there! :)

- --
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (Darwin)

iEYEARECAAYFAkj82TcACgkQ9Llz28widGWnLQCfa3W+f8Tv9NEEZOs+w+JwbR5y
pAAAniNdz5/LN+BlyNibSSatoeR3eK8O
=BVmX
-----END PGP SIGNATURE-----



From 0x6e6562 at gmail.com  Mon Oct 20 21:37:37 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 20 Oct 2008 21:37:37 +0100
Subject: [rabbitmq-discuss] Topic routing
In-Reply-To: <47A96577-B185-4BE9-8ECA-CB7644284887@lindenlab.com>
References: <269388e30810200332l4b964a6ax64020b1885d1eb81@mail.gmail.com>
	<47A96577-B185-4BE9-8ECA-CB7644284887@lindenlab.com>
Message-ID: <269388e30810201337u218eac5do6ccec6eb0136d2d4@mail.gmail.com>

Brian,

On Mon, Oct 20, 2008 at 6:00 PM, Brian Sullivan <bsullivan at lindenlab.com> wrote:
> The former.  We want to have a routing key "<domain>.<event>", so that we
> can easily subscribe to the same event across all domains.  You could think
> of it like trying to listen to events that are happening across a number of
> servers.  Same set of event types, but N servers, which we might like to see
> individually, or all together in a subscription.  If we did it with separate
> topic exchanges, we'd need to know the full list of them and subscribe to
> each individually - we'd like to keep it more dynamic than that.

Ok, this sounds like an ideal candidate for topic exchanges from an
application perspective.

> Is there a way to speed up this draining process, in case there is a
> particularly high volume feed that has gotten out of control and we don't
> want it to impact more critical feeds?

The way to deal with high volume ingress is the Channel.Flow command.
Please refer to this thread:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-October/002132.html

I've just checked the timestamp of that thread - it is 3 minutes
earlier that this post, hence you probably did not have a chance to
read it before you wrote this.

> My plan has been to route the
> heaviest feeds to particular nodes on the cluster, so that they can manage
> that busy queue there.  Our publishers are sending all event types, so the
> heavier topics are not yet separated out (hence the appeal of a message
> queue routing system).

Clustering will not affect the run time complexity of routing, since
the routing table has to be coherent across the cluster.

In a clustered scenario, the queues may reside on different nodes,
whereas exchanges will *exist* on every node.

> Also, from what I can see in testing, the overhead of routing messages to
> nodes in the cluster that have active subscriptions is pretty low.  I know I
> can throw more consuming applications to pull off a single queue on that
> node to keep up with the flow.  However, there's got to be a saturation
> point where that node cannot manage the volume of all messages with that
> topic key going to one place.

I think that you might be touching on the subject that would make AMQP
truly globally scalable - eventual consistency.

With eventual consistency, you *could* relax the constraint of having
to have a single gloabally consistent queue endpoint and allow
multiple queues with the same name. If you were to do this, you'd have
to build in the notions of merging and other conflicts that may arise
into the AMQP model.

Until this happens, you are stuck with the global consistency of AMQP.

>From a practical perspective, you have to ask yourself, when I am
likely to run into that saturation point.

If you think that may happen at some stage soon, you may well have to
reconsider using RabbitMQ.

Might be worth just calibrating this.

> Is there any way to scale this without
> changing my routing keys?

Ok, so the general advice we give is to try to exploit some kind of
partition that is natural to your application  - not a very original
idea, I know and doesn't *actually* answer your question :-(

> The only way I can think of managing that limit
> at this point is to start generating smarter keys so that I can split the
> load by key to different nodes (for example "mytopickey.1", "mytopickey.2").
>  Is there something cleaner (non-data-related) than that?

No and yes.

No in the sense that there is nothing OOTB that I know of that will
solve this issue *without* you getting funky with your routing keys.

Yes in the sense that you could implement a custom exchange type that
allows you to continue with your current naming scheme and the
exchange is smart enough to perform some kind of partitioned routing
that would facilitate very high volume routing.

> The only "issue" I have been able having is theoretical, since I expected
> the SpammyTopicProducer sample code to sustain some max throughput without
> any subscribers.  I have made a quick modification to publish on a constant
> topic (to make sure it wasn't due to a routing table issue with millions of
> topics) and I still saw the same behavior (where it seems the broker doesn't
> throw away the messages fast enough).

Yes, the solution for this is the Channel.Flow patch (as the Linux
team say - crashing a kernel sometime near you soon :-)

Ben



From rabbitmq-discuss_efine at usa.net  Mon Oct 20 23:17:27 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Mon, 20 Oct 2008 18:17:27 -0400
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
Message-ID: <6c2563b20810201517h79f481c7p144f315ffd2d8423@mail.gmail.com>

>
> that you could efficiency build into a custom exchange (e.g. an


Sorry if this is answered elsewhere (I did look), but how (in a nutshell)
would I implement my own custom exchange type?

Regards,
Ed
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081020/acde2ac5/attachment.htm 

From 0x6e6562 at gmail.com  Tue Oct 21 01:18:49 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 21 Oct 2008 01:18:49 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <6c2563b20810201517h79f481c7p144f315ffd2d8423@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
	<6c2563b20810201517h79f481c7p144f315ffd2d8423@mail.gmail.com>
Message-ID: <269388e30810201718mdaea285jaad21ecc9205debf@mail.gmail.com>

On Mon, Oct 20, 2008 at 11:17 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> Sorry if this is answered elsewhere (I did look), but how (in a nutshell)
> would I implement my own custom exchange type?

In a nutshell: with difficulty.



From 0x6e6562 at gmail.com  Tue Oct 21 01:50:28 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 21 Oct 2008 01:50:28 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <6c2563b20810201517h79f481c7p144f315ffd2d8423@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
	<6c2563b20810201517h79f481c7p144f315ffd2d8423@mail.gmail.com>
Message-ID: <269388e30810201750i1697872fo721400703d863447@mail.gmail.com>

Edwin,

On Mon, Oct 20, 2008 at 11:17 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> Sorry if this is answered elsewhere (I did look), but how (in a nutshell)
> would I implement my own custom exchange type?

1. The abridged version:

If you look into at functions rabbit_exchange:route/2 and
lookup_qpids:/1 in the same module on the 18776 branch, you might be
able to follow how the generalized routing mechanism works. Basically
you read the routing table for bindings to queue names that match your
key, resolve their corresponding process ids and the rest is handled
for you.

2. The realistic version:

Somehow you're going to have to make a routing decision, and this
usually has something to do with bindings, although you could
theoretically create some kind of foo exchange that just picks some
queue names out of a hat. But if you need to do stateful routing,
you're going to have to retrieve the state from somewhere.

You might also want to make sure that you are not breaking any other
functionality that you currently rely on when you do this.

This also wouldn't necessarily been spec compliant per se, although
section 3.1.3.6 of the 0-9 spec mentions the possibility of custom
exchanges. So you would have to be comfortable with that.

And, unless it was a really worthwhile addition, we probably wouldn't
maintain it in the main Rabbit tree.

Other than that, feel free to do so. We have talked about plugable
queues before (although Matthias has rightly pointed out that this is
much easier said than done) so why should exchanges be any different?

But despite all of these practical considerations, there is a lot of
merit to adding custom exchanges (which Kirk may interpret as custom
routing algorithms :-), because the exchange is point in the AMQP
pipeline with the greatest amount of leverage effect when it comes
down to deciding which messages go where.

HTH,

Ben



From rabbitmq-discuss at davidsackett.com  Tue Oct 21 02:15:26 2008
From: rabbitmq-discuss at davidsackett.com (David Sackett)
Date: Tue, 21 Oct 2008 12:15:26 +1100
Subject: [rabbitmq-discuss] txAMQP and multiple queues per channel
Message-ID: <5f013b1a0810201815ge4ccb75n17506c92a612eba1@mail.gmail.com>

Hi,

I have been testing out txAMQP with RabbitMQ and managed to get
txamqp_example.py<http://www.nabble.com/attachment/19436045/0/txamqp_example.py>working
(after reading posts on this list). I have also tested out amqplib
but see Twisted as a better option for my application.

I'm having difficulty understanding how the channel callbacks should be used
in regard to consuming from queues. amqplib allows callbacks to be attached
to individual queues but it appears that txAMQP only allows callbacks to be
attached to a channel:

amqplib:
channel.basic_consume(queue=queue_name, callback=callback)

txAMQP:
channel.basic_consume(queue=queue_name)
channel.deferred.addCallback(gotMessage)

Also, if I try to attach multiple callbacks or connect a channel to multiple
queues (using basic_consume) strange things happen. Sometimes the callback
is never called and other times channel.queue_declare() returns an object
with a "fields" attribute set to an empty tuple rather than a triplet
containing the queue name. I can't help but feel my problems stem from
incorrectly using the library and not allowing for the asynchronous nature
of Twisted (I am fairly new to Twisted).

What is the correct way to consume from multiple queues with txAMPQ? Should
each channel only consume from one queue? How can I safely initialise all my
channels and queues and latter consume from other queues once in operation?

I haven't included my code because it is convoluted and messy but if needed
I can cut it down and provide it.

Thanks in advance,

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081021/96f8a829/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Tue Oct 21 05:30:16 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Tue, 21 Oct 2008 00:30:16 -0400
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <269388e30810201750i1697872fo721400703d863447@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
	<6c2563b20810201517h79f481c7p144f315ffd2d8423@mail.gmail.com>
	<269388e30810201750i1697872fo721400703d863447@mail.gmail.com>
Message-ID: <6c2563b20810202130y35b7215end8607782b438035@mail.gmail.com>

Ben, Thanks.

Coincidentally, I did look into rabbit_exchange:route while waiting for your
response. One (very very minor) thing that struck me on reading it was the
use of regexp:split/2 to convert "a.dotted.topic.key" to
["a","dotted","topic","key"]. I wondered why the more efficient
string:tokens/2 was not used. They do have different behavior in edge
conditions (e.g. ".atopic") - was that the reason?

Anyway, besides that, for now I'll probably just go with a topic exchange,
which seems to be the general purpose ancestor of all the others. I really
do not want to add my code to the Rabbit server side and risk having merge
difficulties when future releases arise...

Regards,
Edwin

On Mon, Oct 20, 2008 at 8:50 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Edwin,
>
> On Mon, Oct 20, 2008 at 11:17 PM, Edwin Fine
> <rabbitmq-discuss_efine at usa.net> wrote:
> > Sorry if this is answered elsewhere (I did look), but how (in a nutshell)
> > would I implement my own custom exchange type?
>
> 1. The abridged version:
>
> If you look into at functions rabbit_exchange:route/2 and
> lookup_qpids:/1 in the same module on the 18776 branch, you might be
> able to follow how the generalized routing mechanism works. Basically
> you read the routing table for bindings to queue names that match your
> key, resolve their corresponding process ids and the rest is handled
> for you.
>
> 2. The realistic version:
>
> Somehow you're going to have to make a routing decision, and this
> usually has something to do with bindings, although you could
> theoretically create some kind of foo exchange that just picks some
> queue names out of a hat. But if you need to do stateful routing,
> you're going to have to retrieve the state from somewhere.
>
> You might also want to make sure that you are not breaking any other
> functionality that you currently rely on when you do this.
>
> This also wouldn't necessarily been spec compliant per se, although
> section 3.1.3.6 of the 0-9 spec mentions the possibility of custom
> exchanges. So you would have to be comfortable with that.
>
> And, unless it was a really worthwhile addition, we probably wouldn't
> maintain it in the main Rabbit tree.
>
> Other than that, feel free to do so. We have talked about plugable
> queues before (although Matthias has rightly pointed out that this is
> much easier said than done) so why should exchanges be any different?
>
> But despite all of these practical considerations, there is a lot of
> merit to adding custom exchanges (which Kirk may interpret as custom
> routing algorithms :-), because the exchange is point in the AMQP
> pipeline with the greatest amount of leverage effect when it comes
> down to deciding which messages go where.
>
> HTH,
>
> Ben
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081021/2f4c9bc1/attachment.htm 

From 0x6e6562 at gmail.com  Tue Oct 21 09:38:57 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 21 Oct 2008 09:38:57 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <6c2563b20810202130y35b7215end8607782b438035@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
	<6c2563b20810201517h79f481c7p144f315ffd2d8423@mail.gmail.com>
	<269388e30810201750i1697872fo721400703d863447@mail.gmail.com>
	<6c2563b20810202130y35b7215end8607782b438035@mail.gmail.com>
Message-ID: <269388e30810210138q161a1c93q2c6fe017754a469a@mail.gmail.com>

Edwin,

On Tue, Oct 21, 2008 at 5:30 AM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> Coincidentally, I did look into rabbit_exchange:route while waiting for your
> response. One (very very minor) thing that struck me on reading it was the
> use of regexp:split/2 to convert "a.dotted.topic.key" to
> ["a","dotted","topic","key"]. I wondered why the more efficient
> string:tokens/2 was not used. They do have different behavior in edge
> conditions (e.g. ".atopic") - was that the reason?

I don't know where that code originated from so I can't comment.
However, if you think that you of a more efficient implementation,
feel free to contribute it. There is a test case for this in the
rabbit_tests module.

> Anyway, besides that, for now I'll probably just go with a topic exchange,
> which seems to be the general purpose ancestor of all the others. I really
> do not want to add my code to the Rabbit server side and risk having merge
> difficulties when future releases arise...

Although I am not eagerly encouraging you to go out and hack away at
the internal modules, to be objective, I think that the conciseness of
that module would not necessarily lead to any significant merge
issues. After all, you would just be using Erlang pattern matching to
do the code organization for you.

Another thought crossed my mind as well - to experiment with some kind
of module paramterization or some callback that would separate these
concerns (again with reference to the custom queue discussion - I
think that to do something like this would be a lot more tractable
with exchanges than it would be with queues).

Ben



From 0x6e6562 at gmail.com  Tue Oct 21 09:52:21 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 21 Oct 2008 09:52:21 +0100
Subject: [rabbitmq-discuss] txAMQP and multiple queues per channel
In-Reply-To: <5f013b1a0810201815ge4ccb75n17506c92a612eba1@mail.gmail.com>
References: <5f013b1a0810201815ge4ccb75n17506c92a612eba1@mail.gmail.com>
Message-ID: <269388e30810210152q5838e669p9bd92da85a77e3a9@mail.gmail.com>

David,

On Tue, Oct 21, 2008 at 2:15 AM, David Sackett
<rabbitmq-discuss at davidsackett.com> wrote:
> What is the correct way to consume from multiple queues with txAMPQ? Should
> each channel only consume from one queue? How can I safely initialise all my
> channels and queues and latter consume from other queues once in operation?

I am going to let Esteve comment on txAMQP but I can make a few
general points about the protocol semantics:

- Subscriptions are identified by a consumer tag. This is effectively
a hint that the broker gives to the client to indicate to whom the
message should be farmed out to, so in general, a client library
*should* maintain a mapping between a consumer tag and reference to a
consumer instance.

- You *can* have multiple subcriptions per channel and also multiple
consumers per channel (refer here for reasons why you may or may not
do this - http://hopper.squarespace.com/blog/2008/10/6/multithreading-amqp-clients.html).

- A channel could be construed as the broker's view on a client side
thread (see same article) - but in any case it is merely a stateful
conversation between both peers.

- Declaring entities in AMQP is akin to an assertion of existence -
see here more a more detailed discussion -
http://hopper.squarespace.com/blog/2008/10/7/consumer-driven-messaging.html

HTH,

Ben



From esteve at sindominio.net  Tue Oct 21 16:42:42 2008
From: esteve at sindominio.net (Esteve Fernandez)
Date: Tue, 21 Oct 2008 17:42:42 +0200
Subject: [rabbitmq-discuss] txAMQP and multiple queues per channel
In-Reply-To: <5f013b1a0810201815ge4ccb75n17506c92a612eba1@mail.gmail.com>
References: <5f013b1a0810201815ge4ccb75n17506c92a612eba1@mail.gmail.com>
Message-ID: <200810211742.42835.esteve@sindominio.net>

Hi David

On Tuesday 21 October 2008 03:15:26 David Sackett wrote:
> What is the correct way to consume from multiple queues with txAMPQ? Should
> each channel only consume from one queue? How can I safely initialise all
> my channels and queues and latter consume from other queues once in
> operation?

Sorry, that code was meant to prove that txAMQP supported multiple channels, 
but I must admit that it was quite crappy. Take a look at the unit tests 
found under the test directory. The test_example test is pretty complete and 
easy to follow.

Back when txAMQP was released, I decided to separate the client from the 
queueing code, letting developers to write their own queues. There's a simple 
queueing channel class in the testlib.py file that you can use, through. 
Anyway, I reorganized the source code and joined both pieces, you may get it 
from:

bzr branch lp:~txamqpteam/txamqp/use-queues

Cheers.

PS: I attached a simple example of how to use the queueing code, let me know 
if it works as expected
-------------- next part --------------
A non-text attachment was scrubbed...
Name: txamqp_example_queues.py
Type: application/x-python
Size: 2572 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081021/cfb53ddf/attachment.bin 

From kirk at kirkwylie.com  Tue Oct 21 17:40:04 2008
From: kirk at kirkwylie.com (Kirk Wylie)
Date: Tue, 21 Oct 2008 17:40:04 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
Message-ID: <8f10a9e00810210940x2991d29fidd942b75af333947@mail.gmail.com>

Ben,

On Mon, Oct 20, 2008 at 7:03 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> On Mon, Oct 20, 2008 at 4:01 PM, Kirk Wylie <kirk at kirkwylie.com> wrote:
>> Personally, I believe that the spec should be changed so that
>> exchanges are nothing other than producer-provided namespaces/groups
>> of related messages, and consumers should bind to exchanges based on
>> the semantics that they want.
>
> I think you may find resonance with some members of the WG on this
> issue. However, moving the routing algorithm to the binding does have
> a practical implication from an implementation perspective. This would
> turn any routing decision into a linear scan of all of the bindings in
> order to perform a match on the routing type :-( You would not be able
> to exploit any type-based indexes.

Well, no, actually, that's not true. That's only true of a naive
implementation of a binding-based system. The RabbitMQ-based
implementation where you're modelling all the primitive AMQP concepts
as direct Erlang processes would definitely suffer from this problem,
but I'm sure you could work out a system where invoking a binding
dynamically modifies the routing table of the exchange.

> This is true, but I think until AMQP goes 1.0, you should, IMHO,
> prioritize design over backwards compatibility.

Agreed completely.

> I think it may not necessary be a good idea to de-characterize an
> exchange to the extent that it merely represents a logical address. If
> you were to do so, you would be automatically precluding semantics
> that you could efficiency build into a custom exchange (e.g. an
> exchange that delivers to a subset of the matching binding - for
> example the shortest queue).

Well, you're talking about a custom routing rule, and conflating that
with an exchange. Custom routing rules are great, and orthogonal to
Exchanges if you decouple exchanges from routing, which is what I'd
really prefer.

> Furthermore, you can bring the consumer driven-ness into the realm of
> your app by having a convention that prevents a producer from
> declaring exchanges - if the exchange doesn't exist, then the producer
> will not be able to send messages to it.

Then the "createExchange" call shouldn't be an assertion, it should
check for a pre-defined configuration point.

Remember, I'm concerned with badly written applications, where they
might even tell you in documentation all the exchanges that they're
using, but they're actually lying. This happens a lot sadly.

Kirk



From kirk at kirkwylie.com  Tue Oct 21 17:45:15 2008
From: kirk at kirkwylie.com (Kirk Wylie)
Date: Tue, 21 Oct 2008 17:45:15 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <8f10a9e00810210940x2991d29fidd942b75af333947@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
	<8f10a9e00810210940x2991d29fidd942b75af333947@mail.gmail.com>
Message-ID: <8f10a9e00810210945uf58f03cu18a02a44af086c03@mail.gmail.com>

Also, John O'Hara piped up on the Blog post where I told everybody who
reads said drivel-filled-narcissistic-writing
(http://kirkwylie.blogspot.com/2008/10/amqp-exchanges-and-routing-thread-on.html)
that apparently this has all been resolved in the 1.0 draft, which I'm
QUITE eager to see.

Hopefully that will resolve this!

Kirk

On Tue, Oct 21, 2008 at 5:40 PM, Kirk Wylie <kirk at kirkwylie.com> wrote:
> Ben,
>
> On Mon, Oct 20, 2008 at 7:03 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>> On Mon, Oct 20, 2008 at 4:01 PM, Kirk Wylie <kirk at kirkwylie.com> wrote:
>>> Personally, I believe that the spec should be changed so that
>>> exchanges are nothing other than producer-provided namespaces/groups
>>> of related messages, and consumers should bind to exchanges based on
>>> the semantics that they want.
>>
>> I think you may find resonance with some members of the WG on this
>> issue. However, moving the routing algorithm to the binding does have
>> a practical implication from an implementation perspective. This would
>> turn any routing decision into a linear scan of all of the bindings in
>> order to perform a match on the routing type :-( You would not be able
>> to exploit any type-based indexes.
>
> Well, no, actually, that's not true. That's only true of a naive
> implementation of a binding-based system. The RabbitMQ-based
> implementation where you're modelling all the primitive AMQP concepts
> as direct Erlang processes would definitely suffer from this problem,
> but I'm sure you could work out a system where invoking a binding
> dynamically modifies the routing table of the exchange.
>
>> This is true, but I think until AMQP goes 1.0, you should, IMHO,
>> prioritize design over backwards compatibility.
>
> Agreed completely.
>
>> I think it may not necessary be a good idea to de-characterize an
>> exchange to the extent that it merely represents a logical address. If
>> you were to do so, you would be automatically precluding semantics
>> that you could efficiency build into a custom exchange (e.g. an
>> exchange that delivers to a subset of the matching binding - for
>> example the shortest queue).
>
> Well, you're talking about a custom routing rule, and conflating that
> with an exchange. Custom routing rules are great, and orthogonal to
> Exchanges if you decouple exchanges from routing, which is what I'd
> really prefer.
>
>> Furthermore, you can bring the consumer driven-ness into the realm of
>> your app by having a convention that prevents a producer from
>> declaring exchanges - if the exchange doesn't exist, then the producer
>> will not be able to send messages to it.
>
> Then the "createExchange" call shouldn't be an assertion, it should
> check for a pre-defined configuration point.
>
> Remember, I'm concerned with badly written applications, where they
> might even tell you in documentation all the exchanges that they're
> using, but they're actually lying. This happens a lot sadly.
>
> Kirk
>



From terry at jon.es  Wed Oct 22 00:59:29 2008
From: terry at jon.es (Terry Jones)
Date: Wed, 22 Oct 2008 01:59:29 +0200
Subject: [rabbitmq-discuss] Bug(?) in stopping multiple instances of
	rabbitmq-server
Message-ID: <18686.27873.874961.524690@jon.es>

The following is run in the scripts directory of the rabbitmq-server-1.4.0
distribution. I'm using Ubuntu Hardy latest & greatest.

First I start and stop rabbitmq manually:

    # ./rabbitmq-multi start_all 1
    [snip]

    # ps aux | grep rabbitmq | grep -v grep
    root     24785  0.0  0.0   3944   592 ?        Ss   01:41   0:00 /bin/sh ./rabbitmq-server -noinput

    # ./rabbitmq-multi stop_all
    [snip]


That's all fine. I can also start it specifying a port via NODE_PORT=22222
on the command line. That starts fine and I can telnet localhost 22222 and
get connected. I can then stop it via *either*

    NODE_PORT=22222 ./rabbitmq-multi stop_all
or
    ./rabbitmq-multi stop_all

I'm not sure how it knows how to stop itself when I don't tell it the port
number. That's presumably logged somewhere. It may be related to this:

    # ./rabbitmq-multi start_all 1
    Starting all nodes...
    [snip]

    # NODENAME=fred NODE_PORT=30000 ./rabbitmq-multi start_all 1
    Starting all nodes...
    [snip]

I now have 2 instances of rabbitmq-server running (verified by ps and
telnet). I stop one:

    # NODENAME=fred NODE_PORT=30000 ./rabbitmq-multi stop_all
    Stopping all nodes...
    [snip]

So far so good. There's just one rabbitmq-server running, I can telnet to
it on 5672, but I can no longer stop it:

    # ./rabbitmq-multi stop_all
    Stopping all nodes...

    rabbit_multi action stop_all failed:
    no_nodes_running

Even though ps shows the process is still there. I have to kill it manually.

Terry



From terry at jon.es  Wed Oct 22 01:18:49 2008
From: terry at jon.es (Terry Jones)
Date: Wed, 22 Oct 2008 02:18:49 +0200
Subject: [rabbitmq-discuss] I'd like rabbitmq to be able to pick its own
	port(s)
Message-ID: <18686.29033.460911.539083@jon.es>

The reason I ran into the problem stopping multiple instances of rabbitmq
is that I was just starting to play with it and was wondering about how
port numbers are chosen/assigned.

It would be useful (to me, anyway) if Rabbit could leave port assignment to
the OS and then report on what it gets.

I'd like to locally test some code that simulates multiple machines, each
of which has an instance of rabbit running on it. That means I want to
start multiple instances on my local machine. But rabbit either tries to
use its default 5672 port or lets you choose one. That means that my test
code has to somehow be picking port numbers and is either less reliable or
more complex because it would ideally avoid picking ports that are in use.
If rabbit could just leave it to the OS and then report the port(s) it
gets, that would be nice. Then I could parse its output and know where to
connect to.

Sorry if that all sounds convoluted.  To give an example from the Twisted
[1] world, when I start a twistd service, if I don't tell it what port to
use, it lets the OS allocated it. I can then log it and test code can parse
the log to see where the new service is listening. That makes it easy to
write code that doesn't need to know (or impose) a port number in advance.
So I can have many copies of the same service running on the same machine,
no problem.  That makes local testing of a complex multi-host service much
easier.

Regards,
Terry

[1] http://twistedmatrix.com/trac/



From 0x6e6562 at gmail.com  Wed Oct 22 01:54:44 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 22 Oct 2008 01:54:44 +0100
Subject: [rabbitmq-discuss] Topic routing
In-Reply-To: <7A8E4A9E-EFA8-4A4C-AC24-64A6FF3BF412@lindenlab.com>
References: <269388e30810200332l4b964a6ax64020b1885d1eb81@mail.gmail.com>
	<47A96577-B185-4BE9-8ECA-CB7644284887@lindenlab.com>
	<269388e30810201337u218eac5do6ccec6eb0136d2d4@mail.gmail.com>
	<7A8E4A9E-EFA8-4A4C-AC24-64A6FF3BF412@lindenlab.com>
Message-ID: <269388e30810211754x68a801b8ueb7c4b3083b20836@mail.gmail.com>

Brian,

On Wed, Oct 22, 2008 at 1:35 AM, Brian Sullivan <bsullivan at lindenlab.com> wrote:
> Just to clarify what you mean by "not affect the run time complexity of
> routing"...  Are you saying that each node in a cluster has to manage the
> total load of ALL messages that hit the cluster, regardless of whether the
> producer is sending to that node or not?  I was under the impression that
> the shared routing table that is synchronized across the cluster would be
> leveraged by each node to know where it might need to forward messages (only
> to those nodes managing queues that have relevant subscriptions).

No, a single node only has to route the messages sent directly to it.
The queues to which that node has to route messages to may or may not
exist on the same node.

> For example, if I had a cluster with nodes A, B, C -
> When I have [only] a client A1 publishing a busy topic stream to node A and
> a client B1 subscribing to that topic on node B...  Does C see any load at
> all?

Only if C has a queue that matches a routing key for a message sent to
A or B, but even if that is the case, a queue process on C receives a
already-routed message in it's inbox -  and this is optimized across
nodes so that only one intra-node TX is made per message, even if
there are multiple matches on the remote node.

>> Clustering will not affect the run time complexity of routing, since
>> the routing table has to be coherent across the cluster.
>>
>> In a clustered scenario, the queues may reside on different nodes,
>> whereas exchanges will *exist* on every node.

What I meant to say that the parallelism does not change the
fundamental complexity of the routing algorithm - sure it will
distribute load, but O(n) is still O(n) even in a clustered context.

So when you up the ante to the nth degree, you will find that this
methodology *may* not cut it (although you are actually scaling
linearly :-)

The question remains - do you think that you will realistically take
it to the nth degree.

HTH,

Ben



From terry at jon.es  Wed Oct 22 02:02:54 2008
From: terry at jon.es (Terry Jones)
Date: Wed, 22 Oct 2008 03:02:54 +0200
Subject: [rabbitmq-discuss] I'd like rabbitmq to be able to pick its
	own	port(s)
In-Reply-To: Your message at 02:18:49 on Wednesday, 22 October 2008
References: <18686.29033.460911.539083@jon.es>
Message-ID: <18686.31678.916106.504909@jon.es>

Following up on myself...

>>>>> "Terry" == Terry Jones <terry at jon.es> writes:
Terry> It would be useful (to me, anyway) if Rabbit could leave port
Terry> assignment to the OS and then report on what it gets.

I should perhaps have made it clear that I'd like this as an option. It's
good that rabbit uses 5672 by default and it's good that you can
specifically request a port. I'd like a third option - to let the OS give
you the port (and to then report it somewhere - actually I can already see
it in the ps output).

Terry



From matthias at lshift.net  Wed Oct 22 07:14:29 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Oct 2008 07:14:29 +0100
Subject: [rabbitmq-discuss] Bug(?) in stopping multiple instances
	of	rabbitmq-server
In-Reply-To: <18686.27873.874961.524690@jon.es>
References: <18686.27873.874961.524690@jon.es>
Message-ID: <48FEC4C5.1010809@lshift.net>

Terry Jones wrote:

> I can then stop it via *either*
> 
>     NODE_PORT=22222 ./rabbitmq-multi stop_all
> or
>     ./rabbitmq-multi stop_all
> 
> I'm not sure how it knows how to stop itself when I don't tell it the port
> number. That's presumably logged somewhere.

rabbitmq-multi records the names of the nodes it has started. That's 
enough for Erlang to be able to subsequently connect to them.

>     # ./rabbitmq-multi start_all 1
>     Starting all nodes...
>     [snip]
> 
>     # NODENAME=fred NODE_PORT=30000 ./rabbitmq-multi start_all 1
>     Starting all nodes...
>     [snip]

That's a usage of rabbitmq-multi we hadn't thought of :)

rabbitmq-multi is designed to control *one set of* multiple nodes named 
NODENAME, NODENAME_1, ..., NODENAME_{N-1}, at ports NODE_PORT, 
NODE_PORT+1, ..., NODE_PORT+{N-1}.

The important bit here is the "one set". What you are doing above is 
create *two* sets of nodes. The way rabbitmq-multi currently works, the 
record of node names for the second set will overwrite the first. That 
leads to the behaviour you saw:

>     # NODENAME=fred NODE_PORT=30000 ./rabbitmq-multi stop_all
>     Stopping all nodes...
>     [snip]
> 
>     # ./rabbitmq-multi stop_all
>     Stopping all nodes...
> 
>     rabbit_multi action stop_all failed:
>     no_nodes_running

When the second set of nodes was started the first set of nodes will 
have been forgotten.

Btw, there is no need to specify NODENAME etc in anything other than the 
start_all call.


For starting a several nodes with unrelated names and ports I recommend 
using the rabbitmq-server script, rather than rabbitmq-multi. You can 
stop the nodes individually with rabbitmqctl.


Regards,

Matthias



From terry at jon.es  Wed Oct 22 07:26:27 2008
From: terry at jon.es (Terry Jones)
Date: Wed, 22 Oct 2008 08:26:27 +0200
Subject: [rabbitmq-discuss] Bug(?) in stopping multiple instances
	of	rabbitmq-server
In-Reply-To: Your message at 07:14:29 on Wednesday, 22 October 2008
References: <18686.27873.874961.524690@jon.es>
	<48FEC4C5.1010809@lshift.net>
Message-ID: <18686.51091.264966.242485@jon.es>

Hi Matthias

>>>>> "Matthias" == Matthias Radestock <matthias at lshift.net> writes:
Matthias> For starting a several nodes with unrelated names and ports I
Matthias> recommend using the rabbitmq-server script, rather than
Matthias> rabbitmq-multi. You can stop the nodes individually with
Matthias> rabbitmqctl.

Thanks for all that - will do.

BTW, I started looking at rabbit-multi after reading
/etc/init.d/rabbitmq-server

It was the first time I'd done anything with rabbit at all, apart from
starting & stopping it from init.d. I'll probably ask a few more newbie
questions.

Terry



From rabbitmq-discuss at davidsackett.com  Wed Oct 22 09:19:41 2008
From: rabbitmq-discuss at davidsackett.com (David Sackett)
Date: Wed, 22 Oct 2008 19:19:41 +1100
Subject: [rabbitmq-discuss] txAMQP and multiple queues per channel
In-Reply-To: <269388e30810210152q5838e669p9bd92da85a77e3a9@mail.gmail.com>
References: <5f013b1a0810201815ge4ccb75n17506c92a612eba1@mail.gmail.com>
	<269388e30810210152q5838e669p9bd92da85a77e3a9@mail.gmail.com>
Message-ID: <5f013b1a0810220119h566d3207ka6af292fb4c0286a@mail.gmail.com>

Hi Ben,

Thank you for the background information. I've read the posts and it has
greatly improved my understanding (I think ;)). I will now give more though
to how I structure my application.

Best regards,

David

On Tue, Oct 21, 2008 at 7:52 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> David,
>
> On Tue, Oct 21, 2008 at 2:15 AM, David Sackett
> <rabbitmq-discuss at davidsackett.com> wrote:
> > What is the correct way to consume from multiple queues with txAMPQ?
> Should
> > each channel only consume from one queue? How can I safely initialise all
> my
> > channels and queues and latter consume from other queues once in
> operation?
>
> I am going to let Esteve comment on txAMQP but I can make a few
> general points about the protocol semantics:
>
> - Subscriptions are identified by a consumer tag. This is effectively
> a hint that the broker gives to the client to indicate to whom the
> message should be farmed out to, so in general, a client library
> *should* maintain a mapping between a consumer tag and reference to a
> consumer instance.
>
> - You *can* have multiple subcriptions per channel and also multiple
> consumers per channel (refer here for reasons why you may or may not
> do this -
> http://hopper.squarespace.com/blog/2008/10/6/multithreading-amqp-clients.html
> ).
>
> - A channel could be construed as the broker's view on a client side
> thread (see same article) - but in any case it is merely a stateful
> conversation between both peers.
>
> - Declaring entities in AMQP is akin to an assertion of existence -
> see here more a more detailed discussion -
> http://hopper.squarespace.com/blog/2008/10/7/consumer-driven-messaging.html
>
> HTH,
>
> Ben
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081022/432eab12/attachment.htm 

From rabbitmq-discuss at davidsackett.com  Wed Oct 22 09:21:33 2008
From: rabbitmq-discuss at davidsackett.com (David Sackett)
Date: Wed, 22 Oct 2008 19:21:33 +1100
Subject: [rabbitmq-discuss] txAMQP and multiple queues per channel
In-Reply-To: <200810211742.42835.esteve@sindominio.net>
References: <5f013b1a0810201815ge4ccb75n17506c92a612eba1@mail.gmail.com>
	<200810211742.42835.esteve@sindominio.net>
Message-ID: <5f013b1a0810220121q76d0c0f5nc45ba1f584961f1e@mail.gmail.com>

Hi Esteve,

Thanks for the link and the example. The example worked great after I added
vhost to line 78:

f = _InstanceFactory(reactor, AMQClient(delegate, qpid.spec.load(specFile)),
d)

Became:

f = _InstanceFactory(reactor, AMQClient(delegate, qpid.spec.load(specFile),
vhost='/'), d)

For some reason RabbitMQ on my PC was not authorizing the default vhost
('localhost') in your script. I updated my test software following your
example and it works perfectly so far!

Do you plan to merge use-queues into the trunk at some point?

Thanks again this has really helped me out!

Best regards,

David

On Wed, Oct 22, 2008 at 2:42 AM, Esteve Fernandez <esteve at sindominio.net>wrote:

> Hi David
>
> On Tuesday 21 October 2008 03:15:26 David Sackett wrote:
> > What is the correct way to consume from multiple queues with txAMPQ?
> Should
> > each channel only consume from one queue? How can I safely initialise all
> > my channels and queues and latter consume from other queues once in
> > operation?
>
> Sorry, that code was meant to prove that txAMQP supported multiple
> channels,
> but I must admit that it was quite crappy. Take a look at the unit tests
> found under the test directory. The test_example test is pretty complete
> and
> easy to follow.
>
> Back when txAMQP was released, I decided to separate the client from the
> queueing code, letting developers to write their own queues. There's a
> simple
> queueing channel class in the testlib.py file that you can use, through.
> Anyway, I reorganized the source code and joined both pieces, you may get
> it
> from:
>
> bzr branch lp:~txamqpteam/txamqp/use-queues
>
> Cheers.
>
> PS: I attached a simple example of how to use the queueing code, let me
> know
> if it works as expected
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081022/6641029d/attachment.htm 

From pauljones23 at gmail.com  Wed Oct 22 09:30:05 2008
From: pauljones23 at gmail.com (Paul Jones)
Date: Wed, 22 Oct 2008 09:30:05 +0100
Subject: [rabbitmq-discuss] I'd like rabbitmq to be able to pick its own
	port(s)
In-Reply-To: <18686.31678.916106.504909@jon.es>
References: <18686.29033.460911.539083@jon.es>
	<18686.31678.916106.504909@jon.es>
Message-ID: <29598b610810220130m741729a9yc3a9d3548e21fcef@mail.gmail.com>

Hi Terry,

On Wed, Oct 22, 2008 at 2:02 AM, Terry Jones <terry at jon.es> wrote:

>
> I should perhaps have made it clear that I'd like this as an option. It's
> good that rabbit uses 5672 by default and it's good that you can
> specifically request a port. I'd like a third option - to let the OS give
> you the port (and to then report it somewhere - actually I can already see
> it in the ps output).
>

I haven't tried this, so it may not work, but have you tried configuring
Rabbit to use a port of 0? When using socket apis directly, I seem to recall
that is how you ask it to assign you a free port, and doing this from a
config level may just work...

Paul.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081022/6f2358b7/attachment.htm 

From esteve at sindominio.net  Wed Oct 22 10:34:22 2008
From: esteve at sindominio.net (Esteve Fernandez)
Date: Wed, 22 Oct 2008 11:34:22 +0200
Subject: [rabbitmq-discuss] txAMQP and multiple queues per channel
In-Reply-To: <5f013b1a0810220121q76d0c0f5nc45ba1f584961f1e@mail.gmail.com>
References: <5f013b1a0810201815ge4ccb75n17506c92a612eba1@mail.gmail.com>
	<200810211742.42835.esteve@sindominio.net>
	<5f013b1a0810220121q76d0c0f5nc45ba1f584961f1e@mail.gmail.com>
Message-ID: <200810221134.23133.esteve@sindominio.net>

Hi David

On Wednesday 22 October 2008 10:21:33 David Sackett wrote:
> f = _InstanceFactory(reactor, AMQClient(delegate, qpid.spec.load(specFile),
> vhost='/'), d)

Ouch, you're right, will commit a fix to the testsuite.

> For some reason RabbitMQ on my PC was not authorizing the default vhost
> ('localhost') in your script. I updated my test software following your
> example and it works perfectly so far!

Great! Let me know if you find anything that can be improved.

> Do you plan to merge use-queues into the trunk at some point?

Sure, probably by the end of the week. I need to clean up some things first, 
though.

Cheers.



From terry at jon.es  Wed Oct 22 11:49:30 2008
From: terry at jon.es (Terry Jones)
Date: Wed, 22 Oct 2008 12:49:30 +0200
Subject: [rabbitmq-discuss] I'd like rabbitmq to be able to pick its
	own	port(s)
In-Reply-To: Your message at 09:30:05 on Wednesday, 22 October 2008
References: <18686.29033.460911.539083@jon.es>
	<18686.31678.916106.504909@jon.es>
	<29598b610810220130m741729a9yc3a9d3548e21fcef@mail.gmail.com>
Message-ID: <18687.1338.454505.303769@jon.es>

>>>>> "Paul" == Paul Jones <pauljones23 at gmail.com> writes:
Paul> I haven't tried this, so it may not work, but have you tried
Paul> configuring Rabbit to use a port of 0? When using socket apis
Paul> directly, I seem to recall that is how you ask it to assign you a
Paul> free port, and doing this from a config level may just work...

Hi Paul

Thanks for the suggestion. Running with NODE_PORT=0 does indeed get rabbit
going on an OS-assigned port. But I still need to figure out what the port
is :-)  Looking at netstat, I see two listeners

  # netstat -tupan
  Active Internet connections (servers and established)
  Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
  tcp        0      0 0.0.0.0:35073           0.0.0.0:*               LISTEN      31912/beam
  tcp        0      0 0.0.0.0:58341           0.0.0.0:*               LISTEN      31912/beam

So it's either 35073 or 58341. The log file doesn't help:

  # cat /var/log/rabbitmq/rabbit.log
  [snip]
  =INFO REPORT==== 22-Oct-2008::12:15:50 ===
  started TCP listener on 0.0.0.0:0

That's a good start...

Attached is a tiny patch to src/tcp_listener.erl that makes the log file
print the correct port number.

These are literally my first 2 lines ever of Erlang! Be gentle with me :-)

Terry
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: d
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081022/e4a30af4/attachment.txt 

From terry at jon.es  Wed Oct 22 11:55:53 2008
From: terry at jon.es (Terry Jones)
Date: Wed, 22 Oct 2008 12:55:53 +0200
Subject: [rabbitmq-discuss] rabbitmq-server could do with an exec
Message-ID: <18687.1721.236720.174492@jon.es>

Hi again rabbit folks

scripts/rabbitmq-server could do with an exec when it starts erl. I didn't
bother with a one-word patch :-)

Terry



From matthias at lshift.net  Wed Oct 22 12:00:01 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Oct 2008 12:00:01 +0100
Subject: [rabbitmq-discuss] I'd like rabbitmq to be able to pick its own
 port(s)
In-Reply-To: <29598b610810220130m741729a9yc3a9d3548e21fcef@mail.gmail.com>
References: <18686.29033.460911.539083@jon.es>	<18686.31678.916106.504909@jon.es>
	<29598b610810220130m741729a9yc3a9d3548e21fcef@mail.gmail.com>
Message-ID: <48FF07B1.40104@lshift.net>

Paul,

Paul Jones wrote:
> I haven't tried this, so it may not work, but have you tried configuring 
> Rabbit to use a port of 0? When using socket apis directly, I seem to 
> recall that is how you ask it to assign you a free port, and doing this 
> from a config level may just work...

This does indeed work, at least under Debian. Unfortunately we didn't 
anticipate this case when writing the code that logs the listening ip & 
port in rabbit.log - it displays the port as '0' even though it's 
actually listening on a different port. I have filed a bug to get that 
fixed.

Matthias.



From 0x6e6562 at gmail.com  Wed Oct 22 12:19:41 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 22 Oct 2008 12:19:41 +0100
Subject: [rabbitmq-discuss] Flow Control
Message-ID: <269388e30810220419u6a1df652n55ab569738d7a8d2@mail.gmail.com>

Brian,

On Wed, Oct 22, 2008 at 2:14 AM, Brian Sullivan <bsullivan at lindenlab.com> wrote:
> [I am answering this thread, even though I think we have a bit of a split
> into two topics, and this one no longer has anything to do with jms
> support...  ;)   Responses inline.]

Sure, so I've changed the subject line and conveniently ignored JMS
tas a subject of discussion.

> I think the Channel.Flow command is exactly what I am looking for here.  Can
> I make the assumption that it will work in the case where there are NO
> subscribers (my "base case" scenario where the publisher is sending a ton of
> data, and I just don't have any clients currently reading it).  The
> publisher will simply get the Channel.Flow signal when the broker needs
> extra time to clean up messages it hasn't been able to throw away yet,
> correct?

The Channel.Flow command will be sent to all open channels and will
have the effect that message sending will be suspended until the
broker sends the pendant to allow the resumption of transmission. So
it doesn't matter when you have consumers or not. Furthermore, in one
of the previous posts I briefly discussed the possibility of
introducing a callback interface in the client so that you could take
action in an event driven fashion.

> Yeah, it is a bottleneck, but just for each host - and we are less worried
> about latency than we are about fault tolerance, because this is a logging
> system.  We currently have a similar system running, and want the hosts to
> be able to dump their logging messages easily (locally), then just have a
> process to pick this heterogeneous mix of logging messages and transmit them
> all to the exchange, on the appropriate topics.

Are you talking about some fast local broker that relays to a slower
*less-local* broker thus giving the producer the maximum amount of
bandwith in order to do a reliable fire and forget?

> I agree that egress flow is where our problem is (at least what I was
> expecting, and hopefully it's only one place...).  As long as the broker can
> send back a Channel.Flow command to a producer if one of the queues fills up
> the whole node, then we can back up and handle it when necessary, likely by
> upping the consumption rate.  We don't have a real need to do this
> dynamically right now - we just want to be able to detect the problem and
> address it via configuration at this point.

This would be doable with Channel.Flow.

> The main thing here is that we want to make sure the server doesn't crash if
> it gets overloaded, and that the behavior is predictable.From my tests
> somewhere earlier in this thread, I hit some wall where I saturated the
> broker and it got stuck at 200 msg/sec.  As long as the updated flow control
> works to keep the broker happy, then I think I am good.

This is the whole intention of the flow control implementation. In
your case, you were most likely seeing TCP-based flow control via back
pressure over the socket, but this is not something that we are going
to rely on given the message pipeline inside the broker. Hence the
upcoming Channel.Flow patch.

>> 4. Topics: I still haven't completely understood the rational behind
>> topic exchanges from the point of view of your application. As I have
>> indicated before, direct exchanges are more efficient that topics ATM,
>> but the sweet spot is going to depend on your app.
>>
>
> I think we got to an understanding on this one on the other thread.  Please
> let me know if it's still not clear why I want topic vs direct.  :)

Yep, that's been answered in the other thread.

HTH,

Ben



From terry at jon.es  Wed Oct 22 14:32:39 2008
From: terry at jon.es (Terry Jones)
Date: Wed, 22 Oct 2008 15:32:39 +0200
Subject: [rabbitmq-discuss] I'd like rabbitmq to be able to pick its own
 port(s)
In-Reply-To: Your message at 12:00:01 on Wednesday, 22 October 2008
References: <18686.29033.460911.539083@jon.es>
	<18686.31678.916106.504909@jon.es>
	<29598b610810220130m741729a9yc3a9d3548e21fcef@mail.gmail.com>
	<48FF07B1.40104@lshift.net>
Message-ID: <18687.11127.229723.550978@jon.es>

>>>>> "Matthias" == Matthias Radestock <matthias at lshift.net> writes:
Matthias> This does indeed work, at least under Debian. Unfortunately we
Matthias> didn't anticipate this case when writing the code that logs the
Matthias> listening ip & port in rabbit.log - it displays the port as '0'
Matthias> even though it's actually listening on a different port. I have
Matthias> filed a bug to get that fixed.

That's what my patch fixes, in case that wasn't clear.

Terry



From 0x6e6562 at gmail.com  Wed Oct 22 14:50:25 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 22 Oct 2008 14:50:25 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.4 on RHEL 5 64-bit
In-Reply-To: <845634110810220639p2ece4e81rc27f4fe4b6001947@mail.gmail.com>
References: <845634110810171053g7d7c086cy9aeb81f04efa9091@mail.gmail.com>
	<167204d20810171105le0690afqe85b1d7b0683510d@mail.gmail.com>
	<845634110810220639p2ece4e81rc27f4fe4b6001947@mail.gmail.com>
Message-ID: <269388e30810220650r77f81406h6ae1c69b2a610ba1@mail.gmail.com>

John,

On Wed, Oct 22, 2008 at 2:39 PM, John Arnold <jarnold at sydrom.com> wrote:
> Yes, as I expected, it was a PATH issue. I changed the reference to ../ebin
> in rabbitmqctl from relative to absolute ie ${RABBIT_BASE} and everything is
> tickety-boo

Good to know.

BTW as indicated in my previous post
(http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-October/002128.html),
RPMs are also available for RH on the download page.

> Follow-up question: I may be missing something, but I don't seem to be able
> to find any simple examples ie programs for sending and receiving messages.

Have you checked out the documentation on the Rabbit website?

http://www.rabbitmq.com/api-guide.html

Furthermore, there are many different examples in different languages
that you could refer to in various places on the internet - a simple
way to find out about this is to post a question to the user list (to
which I am cross-posting this message).

HTH,

Ben



From bsullivan at lindenlab.com  Wed Oct 22 16:39:22 2008
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Wed, 22 Oct 2008 08:39:22 -0700
Subject: [rabbitmq-discuss] Flow Control
In-Reply-To: <269388e30810220419u6a1df652n55ab569738d7a8d2@mail.gmail.com>
References: <269388e30810220419u6a1df652n55ab569738d7a8d2@mail.gmail.com>
Message-ID: <15671E64-9832-4084-AB26-45C621E04C2C@lindenlab.com>


On Oct 22, 2008, at 4:19 AM, Ben Hood wrote:

>> Yeah, it is a bottleneck, but just for each host - and we are less  
>> worried
>> about latency than we are about fault tolerance, because this is a  
>> logging
>> system.  We currently have a similar system running, and want the  
>> hosts to
>> be able to dump their logging messages easily (locally), then just  
>> have a
>> process to pick this heterogeneous mix of logging messages and  
>> transmit them
>> all to the exchange, on the appropriate topics.
>
> Are you talking about some fast local broker that relays to a slower
> *less-local* broker thus giving the producer the maximum amount of
> bandwith in order to do a reliable fire and forget?
>>

What we have is a simple log file that we are then tailing and  
converting into messages - this allows us to be logging in a simple  
way, using our existing code, then we can attach a reader to funnel  
these messages into a more flexible messaging system like RabbitMQ.   
There we subscribe across the event types (topics) and consume in  
various ways.  The log file is both a reliable "fire and forget", as  
well as a common format to be consumed by other processes if we needed.

So while it might be a bottleneck to mix all the messages together,  
it's an acceptable one from our standpoint.  Let me know if I am still  
unclear, or if you see something wrong with this approach.  Thanks  
again for the speedy responses on all of this!

Brian



From 0x6e6562 at gmail.com  Wed Oct 22 16:49:27 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 22 Oct 2008 16:49:27 +0100
Subject: [rabbitmq-discuss] Flow Control
In-Reply-To: <15671E64-9832-4084-AB26-45C621E04C2C@lindenlab.com>
References: <269388e30810220419u6a1df652n55ab569738d7a8d2@mail.gmail.com>
	<15671E64-9832-4084-AB26-45C621E04C2C@lindenlab.com>
Message-ID: <269388e30810220849h18baab2fq14f53a417ed167ac@mail.gmail.com>

Brian,

On Wed, Oct 22, 2008 at 4:39 PM, Brian Sullivan <bsullivan at lindenlab.com> wrote:
> What we have is a simple log file that we are then tailing and converting
> into messages - this allows us to be logging in a simple way, using our
> existing code, then we can attach a reader to funnel these messages into a
> more flexible messaging system like RabbitMQ.  There we subscribe across the
> event types (topics) and consume in various ways.  The log file is both a
> reliable "fire and forget", as well as a common format to be consumed by
> other processes if we needed.

OK, I see. It has just occurred to me that you were using the Java
client to accomplish this task. Just FTR I wanted to point out the
existence of the Ruby (http://github.com/tmm1/amqp/tree/master) and
Python (http://barryp.org/software/py-amqplib/) clients which are
slightly more amenable to scripting that the Java library is.

> So while it might be a bottleneck to mix all the messages together, it's an
> acceptable one from our standpoint.  Let me know if I am still unclear, or
> if you see something wrong with this approach.

No that seems reasonable from the perspective that a catch all binding
key is simpler to maintain that requiring knowledge of the entirety of
all possible routing keys.

Ben



From bsullivan at lindenlab.com  Wed Oct 22 16:58:14 2008
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Wed, 22 Oct 2008 08:58:14 -0700
Subject: [rabbitmq-discuss] Flow Control
In-Reply-To: <269388e30810220849h18baab2fq14f53a417ed167ac@mail.gmail.com>
References: <269388e30810220419u6a1df652n55ab569738d7a8d2@mail.gmail.com>
	<15671E64-9832-4084-AB26-45C621E04C2C@lindenlab.com>
	<269388e30810220849h18baab2fq14f53a417ed167ac@mail.gmail.com>
Message-ID: <E5306E28-DDF9-4D90-9A3F-FEF185446D8D@lindenlab.com>

Just one last followup on this, to make sure we're on the same page -

On Oct 22, 2008, at 8:49 AM, Ben Hood wrote:

> Brian,
>
> On Wed, Oct 22, 2008 at 4:39 PM, Brian Sullivan <bsullivan at lindenlab.com 
> > wrote:
>> What we have is a simple log file that we are then tailing and  
>> converting
>> into messages - this allows us to be logging in a simple way, using  
>> our
>> existing code, then we can attach a reader to funnel these messages  
>> into a
>> more flexible messaging system like RabbitMQ.  There we subscribe  
>> across the
>> event types (topics) and consume in various ways.  The log file is  
>> both a
>> reliable "fire and forget", as well as a common format to be  
>> consumed by
>> other processes if we needed.
>
> OK, I see. It has just occurred to me that you were using the Java
> client to accomplish this task. Just FTR I wanted to point out the
> existence of the Ruby (http://github.com/tmm1/amqp/tree/master) and
> Python (http://barryp.org/software/py-amqplib/) clients which are
> slightly more amenable to scripting that the Java library is.
>

Actually, we are going to use the Python library on the log parsing  
and publication side.  :)  The Java client is used on the consuming end.

>> So while it might be a bottleneck to mix all the messages together,  
>> it's an
>> acceptable one from our standpoint.  Let me know if I am still  
>> unclear, or
>> if you see something wrong with this approach.
>
> No that seems reasonable from the perspective that a catch all binding
> key is simpler to maintain that requiring knowledge of the entirety of
> all possible routing keys.
>

Just to be clear, the "catch all" part is the logging file.  When we  
parse the file and convert into messages to send to RabbitMQ, that's  
when we assign the various topic keys and allow it to do the routing.   
Each logging application is free to log whatever "key" it wants, then  
we can just set up something to pick it up on the consuming end when  
we're ready.

Thanks again,
Brian




From bsullivan at lindenlab.com  Wed Oct 22 17:19:32 2008
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Wed, 22 Oct 2008 09:19:32 -0700
Subject: [rabbitmq-discuss] Topic routing
In-Reply-To: <269388e30810211754x68a801b8ueb7c4b3083b20836@mail.gmail.com>
References: <269388e30810200332l4b964a6ax64020b1885d1eb81@mail.gmail.com>
	<47A96577-B185-4BE9-8ECA-CB7644284887@lindenlab.com>
	<269388e30810201337u218eac5do6ccec6eb0136d2d4@mail.gmail.com>
	<7A8E4A9E-EFA8-4A4C-AC24-64A6FF3BF412@lindenlab.com>
	<269388e30810211754x68a801b8ueb7c4b3083b20836@mail.gmail.com>
Message-ID: <62DA86E0-757B-4C92-BF4F-CC6B4BD820C8@lindenlab.com>


On Oct 21, 2008, at 5:54 PM, Ben Hood wrote:

>>> Clustering will not affect the run time complexity of routing, since
>>> the routing table has to be coherent across the cluster.
>>>
>>> In a clustered scenario, the queues may reside on different nodes,
>>> whereas exchanges will *exist* on every node.
>
> What I meant to say that the parallelism does not change the
> fundamental complexity of the routing algorithm - sure it will
> distribute load, but O(n) is still O(n) even in a clustered context.
>
> So when you up the ante to the nth degree, you will find that this
> methodology *may* not cut it (although you are actually scaling
> linearly :-)
>
> The question remains - do you think that you will realistically take
> it to the nth degree.

Is "N" the number of subscriptions?  If so, I think we're fine, since  
my number of consumers will be relatively low.  If it's the number of  
topics, then that becomes a little more troublesome if I want to get  
clever with my routing keys to help distribute the consumption load  
across nodes.  (Troublesome, but not undoable)

Thanks,
Brian




From 0x6e6562 at gmail.com  Wed Oct 22 17:40:17 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 22 Oct 2008 17:40:17 +0100
Subject: [rabbitmq-discuss] Flow Control
In-Reply-To: <E5306E28-DDF9-4D90-9A3F-FEF185446D8D@lindenlab.com>
References: <269388e30810220419u6a1df652n55ab569738d7a8d2@mail.gmail.com>
	<15671E64-9832-4084-AB26-45C621E04C2C@lindenlab.com>
	<269388e30810220849h18baab2fq14f53a417ed167ac@mail.gmail.com>
	<E5306E28-DDF9-4D90-9A3F-FEF185446D8D@lindenlab.com>
Message-ID: <269388e30810220940l64f8847ds5956f0643a9a3395@mail.gmail.com>

Brian,

On Wed, Oct 22, 2008 at 4:58 PM, Brian Sullivan <bsullivan at lindenlab.com> wrote:
> Actually, we are going to use the Python library on the log parsing and
> publication side.  :)  The Java client is used on the consuming end.

Makes sense - use the right tool for the right job :-)

> Just to be clear, the "catch all" part is the logging file.  When we parse
> the file and convert into messages to send to RabbitMQ, that's when we
> assign the various topic keys and allow it to do the routing.

Understood.

> Each logging
> application is free to log whatever "key" it wants, then we can just set up
> something to pick it up on the consuming end when we're ready.

Sure. The way that I meant catch-all from from a consumer perspective.

So say for example you have two routing keys, A and B that are
determined by the producer.

And then say you have two consumers, X and Y. X is interested in A and
Y is interesed in B.

In that case it would be trivial to set up a direct exchange and use
direct bindings for the keys A and B.

However, if you wanted to have a third consumer Z, who consumes
everything, Z would have to know every routing key that would ever be
used, when using a direct exchange.

In contrast, you get this for free with a topic exchange because you
can use a wildcard as a binding key.

Hence this is what I meant by a trade-off between efficiency (direct
exchanges) and clarity (topic exchanges).

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Oct 22 18:01:13 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 22 Oct 2008 18:01:13 +0100
Subject: [rabbitmq-discuss] Topic routing
In-Reply-To: <62DA86E0-757B-4C92-BF4F-CC6B4BD820C8@lindenlab.com>
References: <269388e30810200332l4b964a6ax64020b1885d1eb81@mail.gmail.com>
	<47A96577-B185-4BE9-8ECA-CB7644284887@lindenlab.com>
	<269388e30810201337u218eac5do6ccec6eb0136d2d4@mail.gmail.com>
	<7A8E4A9E-EFA8-4A4C-AC24-64A6FF3BF412@lindenlab.com>
	<269388e30810211754x68a801b8ueb7c4b3083b20836@mail.gmail.com>
	<62DA86E0-757B-4C92-BF4F-CC6B4BD820C8@lindenlab.com>
Message-ID: <269388e30810221001j2aae8c1bl53150f358bb17fa2@mail.gmail.com>

Brian,

On Wed, Oct 22, 2008 at 5:19 PM, Brian Sullivan <bsullivan at lindenlab.com> wrote:
> Is "N" the number of subscriptions?

n is the number of bindings attached to an exchange. Whether or not
somebody is actually consuming something from any of the queues, or
whether an immediate flag causes undeliverable messages to be dropped,
is irrevalent. What counts is the runtime complexity of deciding where
you have to route to, not what happens to a message after you have
decided where it is going to go.

If so, I think we're fine, since my
> number of consumers will be relatively low.  If it's the number of topics,
> then that becomes a little more troublesome if I want to get clever with my
> routing keys to help distribute the consumption load across nodes.

When you say "number of topics", do you mean:

1. The number of topic exhanges
2. The number of bindings attached to a single topic exchange

?

The former would not be a problem, because this would represent
natural application partitioning.

The latter is what I think you mean, and is, as indicated above, what
the O(n) cost is based on for a topic exchnage, because wildcards
force a linear scan.

HTH,

Ben



From bsullivan at lindenlab.com  Wed Oct 22 19:52:52 2008
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Wed, 22 Oct 2008 11:52:52 -0700
Subject: [rabbitmq-discuss] Topic routing
In-Reply-To: <269388e30810221001j2aae8c1bl53150f358bb17fa2@mail.gmail.com>
References: <269388e30810200332l4b964a6ax64020b1885d1eb81@mail.gmail.com>
	<47A96577-B185-4BE9-8ECA-CB7644284887@lindenlab.com>
	<269388e30810201337u218eac5do6ccec6eb0136d2d4@mail.gmail.com>
	<7A8E4A9E-EFA8-4A4C-AC24-64A6FF3BF412@lindenlab.com>
	<269388e30810211754x68a801b8ueb7c4b3083b20836@mail.gmail.com>
	<62DA86E0-757B-4C92-BF4F-CC6B4BD820C8@lindenlab.com>
	<269388e30810221001j2aae8c1bl53150f358bb17fa2@mail.gmail.com>
Message-ID: <E8D96A36-37B2-40E3-AA35-92561884C859@lindenlab.com>


On Oct 22, 2008, at 10:01 AM, Ben Hood wrote:

>
> If so, I think we're fine, since my
>> number of consumers will be relatively low.  If it's the number of  
>> topics,
>> then that becomes a little more troublesome if I want to get clever  
>> with my
>> routing keys to help distribute the consumption load across nodes.
>
> When you say "number of topics", do you mean:
>
> 1. The number of topic exhanges
> 2. The number of bindings attached to a single topic exchange
>
> ?
>
> The former would not be a problem, because this would represent
> natural application partitioning.
>
> The latter is what I think you mean, and is, as indicated above, what
> the O(n) cost is based on for a topic exchnage, because wildcards
> force a linear scan.

I mean 3) number of actual topic keys that I publish on - if I need to  
add some variables to the keys so I can distribute load across  
multiple queues ("mytopic.1", "mytopic.2").  Some ideas I had here  
were a little funky and might cause a multiplying of actual topic key  
strings that I use.  One idea was to use the publisher's hostname in  
the topic key (ex: "mytopic.host123") so that I could create a binding  
to "mytopic.host*3" to get ~1/10th the load on each queue (however now  
that I think about it, I don't know if I can do that with the  
wildcards anyways - I think * matches only full words in the key,  
doesn't it?).

Regardless, as long as a binding to "mytopic.*" counts as one binding  
in your O(n), even if I have M topics (mytopic.1, ... mytopic.m), then  
I think I'm good with whatever oddball scheme I come up with.

Thanks,
Brian




From 0x6e6562 at gmail.com  Wed Oct 22 23:15:48 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 22 Oct 2008 23:15:48 +0100
Subject: [rabbitmq-discuss] Topic routing
In-Reply-To: <E8D96A36-37B2-40E3-AA35-92561884C859@lindenlab.com>
References: <269388e30810200332l4b964a6ax64020b1885d1eb81@mail.gmail.com>
	<47A96577-B185-4BE9-8ECA-CB7644284887@lindenlab.com>
	<269388e30810201337u218eac5do6ccec6eb0136d2d4@mail.gmail.com>
	<7A8E4A9E-EFA8-4A4C-AC24-64A6FF3BF412@lindenlab.com>
	<269388e30810211754x68a801b8ueb7c4b3083b20836@mail.gmail.com>
	<62DA86E0-757B-4C92-BF4F-CC6B4BD820C8@lindenlab.com>
	<269388e30810221001j2aae8c1bl53150f358bb17fa2@mail.gmail.com>
	<E8D96A36-37B2-40E3-AA35-92561884C859@lindenlab.com>
Message-ID: <269388e30810221515k3e49552akecd6b25c7ce20671@mail.gmail.com>

Brian,

On Wed, Oct 22, 2008 at 7:52 PM, Brian Sullivan <bsullivan at lindenlab.com> wrote:
> I mean 3) number of actual topic keys that I publish on - if I need to add
> some variables to the keys so I can distribute load across multiple queues
> ("mytopic.1", "mytopic.2").  Some ideas I had here were a little funky and
> might cause a multiplying of actual topic key strings that I use.  One idea
> was to use the publisher's hostname in the topic key (ex: "mytopic.host123")
> so that I could create a binding to "mytopic.host*3" to get ~1/10th the load
> on each queue (however now that I think about it, I don't know if I can do
> that with the wildcards anyways - I think * matches only full words in the
> key, doesn't it?).

Well, the O(n) I refer to is not option (3). The cost of routing a
message on a topic exchange is linear in the number of bindings,
irrespective of how many different routing keys you use.

Whether foo.*.[0-9] delivers true load balancing will depend on the
relative frequency of each individual key on one side.

On the other side, it will also depend on how homogeneous the capacity
of consumption is on each queue - the more heterogeneous this is, the
less load balancing you will experience.

Though you could also imagine a situation whereby skew in the key
distribution is counteracted by heterogeneous queue throughput, thus
bringing balance into the system by accident.

And you can imagine the opposite, when a skew distribution is
amplified by unbalanced queues.

I don't know whether or not implementing load balancing via topic
matches will buy you much in terms of load balancing, so my advice is
to try it out and measure it.

The reason why I say this is because to answer this with any certain
authority you would have to have intimate knowledge of how things get
pushed through the entire processing pipeline.

As far as I can see you would definitely be increasing the effective
workload on ingress - proportional to the degree that you want to load
balance.

On egress, I think the only gain you would see is when a queue cannot
farm work out quick enough to the consumers listening on it, which, if
you had QoS, would be less likely to happen.

But having said that

a) you mileage may vary;
b) you could use a bounded number of intelligently chosen wildcard
patterns (using a * for the last character will give you a load
balance of 1/n(charset) for randomly distributed keys);
c) topic caching is on the road map, persuasiveness has been known to
lead to re-prioritization;
d) one could implement a custom exchange type that is specifically
designed to do load balancing;
e) you might find that you don't need to do this yet before your real
needs aren't anywhere near the limits (but due diligence is always
good).

BTW: * matches a single word, and # matches zero or more words.


> Regardless, as long as a binding to "mytopic.*" counts as one binding in
> your O(n), even if I have M topics (mytopic.1, ... mytopic.m), then I think
> I'm good with whatever oddball scheme I come up with.

As indicated above, this is correct way to view the O(n) - the number
of bindings.

HTH,

Ben



From bsullivan at lindenlab.com  Wed Oct 22 23:23:15 2008
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Wed, 22 Oct 2008 15:23:15 -0700
Subject: [rabbitmq-discuss] Topic routing
In-Reply-To: <269388e30810221515k3e49552akecd6b25c7ce20671@mail.gmail.com>
References: <269388e30810200332l4b964a6ax64020b1885d1eb81@mail.gmail.com>
	<47A96577-B185-4BE9-8ECA-CB7644284887@lindenlab.com>
	<269388e30810201337u218eac5do6ccec6eb0136d2d4@mail.gmail.com>
	<7A8E4A9E-EFA8-4A4C-AC24-64A6FF3BF412@lindenlab.com>
	<269388e30810211754x68a801b8ueb7c4b3083b20836@mail.gmail.com>
	<62DA86E0-757B-4C92-BF4F-CC6B4BD820C8@lindenlab.com>
	<269388e30810221001j2aae8c1bl53150f358bb17fa2@mail.gmail.com>
	<E8D96A36-37B2-40E3-AA35-92561884C859@lindenlab.com>
	<269388e30810221515k3e49552akecd6b25c7ce20671@mail.gmail.com>
Message-ID: <3DEE8643-5B54-42B9-A73B-909BE255CCC2@lindenlab.com>


Agreed on all of your points.  I am less worried about this being a  
showstopper for us now - I just want to have an idea of what options I  
might have to relieve pressure in this scenario.  Thanks for the  
thorough reply.  :)

Brian

On Oct 22, 2008, at 3:15 PM, Ben Hood wrote:

> Brian,
>
> On Wed, Oct 22, 2008 at 7:52 PM, Brian Sullivan <bsullivan at lindenlab.com 
> > wrote:
>> I mean 3) number of actual topic keys that I publish on - if I need  
>> to add
>> some variables to the keys so I can distribute load across multiple  
>> queues
>> ("mytopic.1", "mytopic.2").  Some ideas I had here were a little  
>> funky and
>> might cause a multiplying of actual topic key strings that I use.   
>> One idea
>> was to use the publisher's hostname in the topic key (ex:  
>> "mytopic.host123")
>> so that I could create a binding to "mytopic.host*3" to get ~1/10th  
>> the load
>> on each queue (however now that I think about it, I don't know if I  
>> can do
>> that with the wildcards anyways - I think * matches only full words  
>> in the
>> key, doesn't it?).
>
> Well, the O(n) I refer to is not option (3). The cost of routing a
> message on a topic exchange is linear in the number of bindings,
> irrespective of how many different routing keys you use.
>
> Whether foo.*.[0-9] delivers true load balancing will depend on the
> relative frequency of each individual key on one side.
>
> On the other side, it will also depend on how homogeneous the capacity
> of consumption is on each queue - the more heterogeneous this is, the
> less load balancing you will experience.
>
> Though you could also imagine a situation whereby skew in the key
> distribution is counteracted by heterogeneous queue throughput, thus
> bringing balance into the system by accident.
>
> And you can imagine the opposite, when a skew distribution is
> amplified by unbalanced queues.
>
> I don't know whether or not implementing load balancing via topic
> matches will buy you much in terms of load balancing, so my advice is
> to try it out and measure it.
>
> The reason why I say this is because to answer this with any certain
> authority you would have to have intimate knowledge of how things get
> pushed through the entire processing pipeline.
>
> As far as I can see you would definitely be increasing the effective
> workload on ingress - proportional to the degree that you want to load
> balance.
>
> On egress, I think the only gain you would see is when a queue cannot
> farm work out quick enough to the consumers listening on it, which, if
> you had QoS, would be less likely to happen.
>
> But having said that
>
> a) you mileage may vary;
> b) you could use a bounded number of intelligently chosen wildcard
> patterns (using a * for the last character will give you a load
> balance of 1/n(charset) for randomly distributed keys);
> c) topic caching is on the road map, persuasiveness has been known to
> lead to re-prioritization;
> d) one could implement a custom exchange type that is specifically
> designed to do load balancing;
> e) you might find that you don't need to do this yet before your real
> needs aren't anywhere near the limits (but due diligence is always
> good).
>
> BTW: * matches a single word, and # matches zero or more words.
>
>
>> Regardless, as long as a binding to "mytopic.*" counts as one  
>> binding in
>> your O(n), even if I have M topics (mytopic.1, ... mytopic.m), then  
>> I think
>> I'm good with whatever oddball scheme I come up with.
>
> As indicated above, this is correct way to view the O(n) - the number
> of bindings.
>
> HTH,
>
> Ben




From hubert at lshift.net  Fri Oct 24 13:20:44 2008
From: hubert at lshift.net (Hubert Plociniczak)
Date: Fri, 24 Oct 2008 13:20:44 +0100
Subject: [rabbitmq-discuss] rabbitmq-server could do with an exec
In-Reply-To: <18687.1721.236720.174492@jon.es>
References: <18687.1721.236720.174492@jon.es>
Message-ID: <4901BD9C.4050700@lshift.net>

Hi Terry,

thanks for spotting that. I will fix it soon.

Hubert


Terry Jones wrote:
> Hi again rabbit folks
>
> scripts/rabbitmq-server could do with an exec when it starts erl. I didn't
> bother with a one-word patch :-)
>
> Terry
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   


-- 
 [][][] Hubert Plociniczak
   [][] LShift Ltd
 []  [] www.lshift.net




From matthias at lshift.net  Fri Oct 24 14:01:08 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 24 Oct 2008 14:01:08 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <8f10a9e00810210940x2991d29fidd942b75af333947@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
	<8f10a9e00810210940x2991d29fidd942b75af333947@mail.gmail.com>
Message-ID: <4901C714.7080103@lshift.net>

Kirk,

Kirk Wylie wrote:
>> I think it may not necessary be a good idea to de-characterize an
>> exchange to the extent that it merely represents a logical address. If
>> you were to do so, you would be automatically precluding semantics
>> that you could efficiency build into a custom exchange (e.g. an
>> exchange that delivers to a subset of the matching binding - for
>> example the shortest queue).
> 
> Well, you're talking about a custom routing rule, and conflating that
> with an exchange. Custom routing rules are great, and orthogonal to
> Exchanges if you decouple exchanges from routing, which is what I'd
> really prefer.

Would your proposed model allow for routing decisions that are based on 
the set of all bindings (or some subset thereof), rather than each 
individual binding? Ben's example - an exchange that routes to the 
shorted queue - requires the former.


Matthias.



From alexis.richardson at cohesiveft.com  Fri Oct 24 14:20:12 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 24 Oct 2008 06:20:12 -0700
Subject: [rabbitmq-discuss] Microsoft join AMQP
Message-ID: <167204d20810240620r56d1416n1cb75b33f4a39af1@mail.gmail.com>

http://www.prnewswire.com/cgi-bin/stories.pl?ACCT=104&STORY=/www/story/10-24-2008/0004910956&EDATE=



From 0x6e6562 at gmail.com  Fri Oct 24 14:50:50 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 24 Oct 2008 14:50:50 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <8f10a9e00810210940x2991d29fidd942b75af333947@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
	<8f10a9e00810210940x2991d29fidd942b75af333947@mail.gmail.com>
Message-ID: <269388e30810240650o22240ef0pc3a3a89822c73d10@mail.gmail.com>

Kirk,

On Tue, Oct 21, 2008 at 5:40 PM, Kirk Wylie <kirk at kirkwylie.com> wrote:
> Well, no, actually, that's not true. That's only true of a naive
> implementation of a binding-based system. The RabbitMQ-based
> implementation where you're modelling all the primitive AMQP concepts
> as direct Erlang processes would definitely suffer from this problem,
> but I'm sure you could work out a system where invoking a binding
> dynamically modifies the routing table of the exchange.

Don't get me wrong, the thing I that I would love the most is to be
proven wrong on this point.

The reason why I say this is because I have an interest in pushing
back the boundaries with Rabbit so I would quite humbly accept the
suggestion of an algorithm that allows you to match routes in
sublinear time over an arbitrarily large routing table whilst
deferring the specification of the algorithm to the bindings.

So if you really think that I do not possess the level of abstraction
required to think beyond the implementation I am currently working on,
please set me straight.

And lets set a few things straight, lest untruths manifest themselves
as technical arguments :-)

- Rabbit does not model every AMQP concept as a process - bindings or
routes are not modeled as processes;
- What do you mean excatly by "invoking a binding"?
- The routing table is dynamically modified by issuing the Bind and
Unbind commands to the broker.

Setting the rebuttal aside now to concentrate on the real design and
engineering concerns, do you think you can come up with a simple model
on paper for this?

Here's a suggestion of where one *may* start (requires a fixed width font):

                        -----------
                        | Message |
                        | key = x |
                        -----------
                             |
                             |
                        ------------
                        | Exchange |
                        | name = y |
                        ------------
                             |
        ------------------------------------------
        |                    |                   |
------------------  ------------------  ------------------
| Binding        |  | Binding        |  | Binding        |
| key = foo      |  | key = bar      |  | key = baz      |
| algorithm = A1 |  | algorithm = A2 |  | algorithm = A3 |
------------------  ------------------  ------------------

My point is that by deferring the algorithm to the bindings you are
removing any potential of using root metadata in when you compute the
routing graph.

Although this is slightly OT, this is reminiscent of the way that svn
stores metadata on a per-directory basis as opposed to storing it in
the root - the difference being the ease to which you can compute the
transitive closure of the graph.

>> Furthermore, you can bring the consumer driven-ness into the realm of
>> your app by having a convention that prevents a producer from
>> declaring exchanges - if the exchange doesn't exist, then the producer
>> will not be able to send messages to it.
>
> Then the "createExchange" call shouldn't be an assertion, it should
> check for a pre-defined configuration point.

You can currently use the passive flag to achieve this.

Ben



From 0x6e6562 at gmail.com  Fri Oct 24 15:03:33 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 24 Oct 2008 15:03:33 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <8f10a9e00810210945uf58f03cu18a02a44af086c03@mail.gmail.com>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
	<8f10a9e00810210940x2991d29fidd942b75af333947@mail.gmail.com>
	<8f10a9e00810210945uf58f03cu18a02a44af086c03@mail.gmail.com>
Message-ID: <269388e30810240703p63221f67x73a90db771fc9aa5@mail.gmail.com>

Kirk,

On Tue, Oct 21, 2008 at 5:45 PM, Kirk Wylie <kirk at kirkwylie.com> wrote:
> Also, John O'Hara piped up on the Blog post where I told everybody who
> reads said drivel-filled-narcissistic-writing
> (http://kirkwylie.blogspot.com/2008/10/amqp-exchanges-and-routing-thread-on.html)
> that apparently this has all been resolved in the 1.0 draft, which I'm
> QUITE eager to see.
>
> Hopefully that will resolve this!

There is a subtle difference between specifying an architecture and
verifying it's implementability and fitness for purpose.

If the latter was of no relevance, then you would never have a
situation where a specification is written but not completely
implemented.

I have no qualms about the intention of what you are suggesting, I am
just checking whether it is feasible to implement it.

> We should have this over on the AMQP lists - but I've forgotten if there are user mail lists (poor show).

BTW John: Should user mailing lists on AMQP not exist, my practical
suggestion to you is to subscribe and post to the Rabbit list just for
this topic.

That way you can express your ideas to an interested community and
keep things in context.

Ben



From kirk at kirkwylie.com  Sat Oct 25 13:11:37 2008
From: kirk at kirkwylie.com (Kirk Wylie)
Date: Sat, 25 Oct 2008 13:11:37 +0100
Subject: [rabbitmq-discuss] Exchanges, Routing, and AMQP
In-Reply-To: <4901C714.7080103@lshift.net>
References: <8f10a9e00810200801k6c3040e3w568a9be9d062ff74@mail.gmail.com>
	<269388e30810201103q6529063djbe5e0641e7c6b047@mail.gmail.com>
	<8f10a9e00810210940x2991d29fidd942b75af333947@mail.gmail.com>
	<4901C714.7080103@lshift.net>
Message-ID: <8f10a9e00810250511p2f350327l3e15cc66614d2532@mail.gmail.com>

Matthias (and BTW, I think I messed up your name on a blog post; for
that I apologize).

On Fri, Oct 24, 2008 at 2:01 PM, Matthias Radestock <matthias at lshift.net> wrote:
>>> I think it may not necessary be a good idea to de-characterize an
>>> exchange to the extent that it merely represents a logical address. If
>>> you were to do so, you would be automatically precluding semantics
>>> that you could efficiency build into a custom exchange (e.g. an
>>> exchange that delivers to a subset of the matching binding - for
>>> example the shortest queue).
>>
>> Well, you're talking about a custom routing rule, and conflating that
>> with an exchange. Custom routing rules are great, and orthogonal to
>> Exchanges if you decouple exchanges from routing, which is what I'd
>> really prefer.
>
> Would your proposed model allow for routing decisions that are based on the
> set of all bindings (or some subset thereof), rather than each individual
> binding? Ben's example - an exchange that routes to the shorted queue -
> requires the former.

It would depend on the server-side implementation as to whether that
was possible, since custom routing rules are outside the scope of the
protocol itself.

My suspicion is that any reasonable implementation allowing for
optimized performance would require the same hooks necessary to
implement shortest-queue-routing. This is because you'd have to have a
compilation step once the binding is declared before you could use it
(so that you're not just reparsing text all the time if nothing else).
In the context state where you're storing the pre-compiled binding
rule, you could be able to store data necessary for the shortest-queue
routing rule.

But it's really an implementation detail to be honest. I could easily
see an implementation which forces routing rules into such a localized
decision that you couldn't do that type of global routing logic, and
in a lot of cases that would in fact be easier to keep highly
performant.

Kirk



From rabbitmq-discuss_efine at usa.net  Sun Oct 26 17:55:53 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Sun, 26 Oct 2008 13:55:53 -0400
Subject: [rabbitmq-discuss] Erlang client: function_clause error
Message-ID: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>

I shut RabbitMQ down while an application still had connections to it (I am
doing various recovery scenarios), and I got this:

** Reason for termination ==
** {function_clause,
       [{amqp_connection,handle_info,
            [{method,
                 {'connection.close',320,
                     <<"CONNECTION_FORCED - broker forced connection closure
with reason 'shutdown'">>,
                     0,0},
                 none},
             {connection_state,<<"xhg">>,<<"xhg">>,"0.0.0.0",
                 #Port<0.230>,<<"/xhg">>,<0.150.0>,<0.151.0>,undefined,0,0,
                 {dict,0,16,16,8,80,48,
                     {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}}}]},
        {gen_server,handle_msg,5},
        {proc_lib,init_p,5}]}

Should there be a handle_info clause for this in amqp_connection, or is it
something I need to code for somehow?

Regards,
Edwin Fine
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081026/3cfc2628/attachment.htm 

From michel.polder at quality-it.com  Mon Oct 27 11:50:27 2008
From: michel.polder at quality-it.com (Michel Polder)
Date: Mon, 27 Oct 2008 12:50:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ C# client
In-Reply-To: <48EA4583.3080208@lshift.net>
References: <20081006130831.M60183@quality-it.com>
	<48EA4583.3080208@lshift.net>
Message-ID: <20081027115017.M43054@quality-it.com>

Hubert,

thanks for your help! It seems this problem is solved by upgrading to
OpenAMQ1.2d5. We were still using 1.2c4 when this problem occurred....

Michel 

---------- Original Message -----------
From: Hubert Plociniczak <hubert at lshift.net>
To: Michel Polder <michel.polder at quality-it.com>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Mon, 06 Oct 2008 18:06:11 +0100
Subject: Re: [rabbitmq-discuss] RabbitMQ C# client

> Hi Michel,
> 
> I tested your code with the current C# RabbitMQ client's default 
> branch and 1.4.0 release against the RabbitMQ broker and everything 
> worked correctly. Can you tell us which version of C# RabbitMQ 
> client are you using ? Are you running .Net or Mono? Which version?
> 
> Maybe the problem is in OpenAMQ or WireAPI ?
> 
> Thanks,
> hubert
> 
> Michel Polder wrote:
> > I have a RabbitMQ client that connects to an OpenAMQ server and sends a
> > message using the BasicPublish function. The problem is that my RabbitMQ
> > client connects sucessfully but is disconnected from the OpenAMQ server when
> > sending a message. 
> > The client that listens for the message is written in C using the WireAPI
> > also disconnects on the amq_content_basic_get_body function call. I've
attached
> > my test code below.
> >
> > any idea what's going on?
> >
> > thanks,
> >
> > Michel
> >   
> -- 
>  [][][] Hubert Plociniczak
>    [][] LShift Ltd
>  []  [] www.lshift.net
------- End of Original Message -------




From 0x6e6562 at gmail.com  Mon Oct 27 12:04:02 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 27 Oct 2008 12:04:02 +0000
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
Message-ID: <269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>

Edwin,

On Sun, Oct 26, 2008 at 5:55 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> Should there be a handle_info clause for this in amqp_connection, or is it
> something I need to code for somehow?

This is a bug in the amqp_connection module, it should be handling
this message from the broker. I have started to fix this (19625
refers), but I'm going to have to think about the event propagation.
The current patch will at least handle the message.

HTH,

Ben



From rabbitmq-discuss_efine at usa.net  Mon Oct 27 14:06:08 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Mon, 27 Oct 2008 10:06:08 -0400
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
Message-ID: <6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>

Thanks, Ben.

Do you have any general suggestions as to how to recover cleanly from
multiple connections dying in an application because the broker went down?
Ideally, I'd like to be able to recover gracefully and not have to crash
processes unnecessarily.

Regards,
Edwin

On Mon, Oct 27, 2008 at 8:04 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Edwin,
>
> On Sun, Oct 26, 2008 at 5:55 PM, Edwin Fine
> <rabbitmq-discuss_efine at usa.net> wrote:
> > Should there be a handle_info clause for this in amqp_connection, or is
> it
> > something I need to code for somehow?
>
> This is a bug in the amqp_connection module, it should be handling
> this message from the broker. I have started to fix this (19625
> refers), but I'm going to have to think about the event propagation.
> The current patch will at least handle the message.
>
> HTH,
>
> Ben
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081027/f40ddb6b/attachment.htm 

From 0x6e6562 at gmail.com  Mon Oct 27 15:06:14 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 27 Oct 2008 15:06:14 +0000
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
Message-ID: <269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>

Edwin,

On Mon, Oct 27, 2008 at 2:06 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> Do you have any general suggestions as to how to recover cleanly from
> multiple connections dying in an application because the broker went down?
> Ideally, I'd like to be able to recover gracefully and not have to crash
> processes unnecessarily.

When you say multiple connections in an application, are you referring
to multiple TCP connections or multiple AMQP channels?

Valentino started a thread on a related topic so he may be able to
chime in here: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-October/002105.html

I'm not quite sure whether the discussion was about how to supervise
client connections using an OTP tree or whether I had that discussion
with somebody else.....if it was, could that person please chip in
here?

HTH,

Ben



From rabbitmq-discuss_efine at usa.net  Mon Oct 27 15:08:45 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Mon, 27 Oct 2008 11:08:45 -0400
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
Message-ID: <6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>

On Mon, Oct 27, 2008 at 11:06 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Edwin,
>
> On Mon, Oct 27, 2008 at 2:06 PM, Edwin Fine
> <rabbitmq-discuss_efine at usa.net> wrote:
> > Do you have any general suggestions as to how to recover cleanly from
> > multiple connections dying in an application because the broker went
> down?
> > Ideally, I'd like to be able to recover gracefully and not have to crash
> > processes unnecessarily.
>
> When you say multiple connections in an application, are you referring
> to multiple TCP connections or multiple AMQP channels?


Both, actually. I have a connection pool of TCP connections to a rabbit
broker, each connection of which supports multiple channels.


> Valentino started a thread on a related topic so he may be able to
> chime in here:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-October/002105.html
>

I'll take a look.


>
> I'm not quite sure whether the discussion was about how to supervise
> client connections using an OTP tree or whether I had that discussion
> with somebody else.....if it was, could that person please chip in
> here?
>
> HTH,
>
> Ben
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081027/40cfed41/attachment.htm 

From 0x6e6562 at gmail.com  Mon Oct 27 15:24:43 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 27 Oct 2008 15:24:43 +0000
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
Message-ID: <269388e30810270824y62820129k16d2c3074a64c947@mail.gmail.com>

Edwin,

On Mon, Oct 27, 2008 at 3:08 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> Both, actually. I have a connection pool of TCP connections to a rabbit
> broker, each connection of which supports multiple channels.

One thing that the Erlang client doesn't have which the other clients
do is a facility to register a shutdown handler with the AMQP
connection. Maybe we should look into doing this.

Ben



From rabbitmq-discuss_efine at usa.net  Mon Oct 27 15:33:36 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Mon, 27 Oct 2008 11:33:36 -0400
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <269388e30810270824y62820129k16d2c3074a64c947@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
	<269388e30810270824y62820129k16d2c3074a64c947@mail.gmail.com>
Message-ID: <6c2563b20810270833h1888430cj929cc568b4acf364@mail.gmail.com>

On Mon, Oct 27, 2008 at 11:24 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Edwin,
>
> On Mon, Oct 27, 2008 at 3:08 PM, Edwin Fine
> <rabbitmq-discuss_efine at usa.net> wrote:
> > Both, actually. I have a connection pool of TCP connections to a rabbit
> > broker, each connection of which supports multiple channels.
>
> One thing that the Erlang client doesn't have which the other clients
> do is a facility to register a shutdown handler with the AMQP
> connection. Maybe we should look into doing this.


Music to my ears. I would really, really appreciate something like that.


> Ben
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081027/c9421bef/attachment.htm 

From 0x6e6562 at gmail.com  Mon Oct 27 16:30:01 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 27 Oct 2008 16:30:01 +0000
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <6c2563b20810270833h1888430cj929cc568b4acf364@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
	<269388e30810270824y62820129k16d2c3074a64c947@mail.gmail.com>
	<6c2563b20810270833h1888430cj929cc568b4acf364@mail.gmail.com>
Message-ID: <269388e30810270930y584d4ea4k967772af1197951c@mail.gmail.com>

Edwin,

On Mon, Oct 27, 2008 at 3:33 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> Music to my ears. I would really, really appreciate something like that.

Ok, I've roadmapped it for consideration in the 1.0 release of the
Erlang client (when a patch transpires 19630 will refer).

Ben



From rabbitmq-discuss_efine at usa.net  Mon Oct 27 17:06:37 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Mon, 27 Oct 2008 13:06:37 -0400
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <269388e30810270930y584d4ea4k967772af1197951c@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
	<269388e30810270824y62820129k16d2c3074a64c947@mail.gmail.com>
	<6c2563b20810270833h1888430cj929cc568b4acf364@mail.gmail.com>
	<269388e30810270930y584d4ea4k967772af1197951c@mail.gmail.com>
Message-ID: <6c2563b20810271006p552fce13pd22165ba8224a259@mail.gmail.com>

Ben,

Thanks. In the meantime, I may try to hack it for myself.

Regards,
Ed

On Mon, Oct 27, 2008 at 12:30 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Edwin,
>
> On Mon, Oct 27, 2008 at 3:33 PM, Edwin Fine
> <rabbitmq-discuss_efine at usa.net> wrote:
> > Music to my ears. I would really, really appreciate something like that.
>
> Ok, I've roadmapped it for consideration in the 1.0 release of the
> Erlang client (when a patch transpires 19630 will refer).
>
> Ben
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081027/e05b2c48/attachment.htm 

From weaveinator at gmail.com  Mon Oct 27 18:38:24 2008
From: weaveinator at gmail.com (Steve Weaver)
Date: Mon, 27 Oct 2008 11:38:24 -0700
Subject: [rabbitmq-discuss] Recovering Messages when exchange, queue,
	or broker dies
Message-ID: <c05e896e0810271138v3e64b512pe4e322920b28bc68@mail.gmail.com>

Hi -
Im new to RabbitMQ and was wondering if anyone can point me to good
documentation on how to recover (replay log files or config server or ??)
persisted messages in the queue that were not consumed?  I have the server
running and C# producers and consumers working - just having problems with
the recovery stuff.

Also, if anyone knows of articles on client/server communication over SSL or
SSH?

Thanks very much in advance for any help!!
Steve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081027/4e511db6/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Mon Oct 27 19:03:54 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Mon, 27 Oct 2008 15:03:54 -0400
Subject: [rabbitmq-discuss] Recovering Messages when exchange, queue,
	or broker dies
In-Reply-To: <c05e896e0810271138v3e64b512pe4e322920b28bc68@mail.gmail.com>
References: <c05e896e0810271138v3e64b512pe4e322920b28bc68@mail.gmail.com>
Message-ID: <6c2563b20810271203q732296b3re9e737dbbf9e76bf@mail.gmail.com>

Steve,

AFAIK the broker will automatically send unconsumed messages when you
reconnect a client to it. If in the meantime the broker has gone down and
come back up again, then it will send only persistent messages that it has
in its journal. I think the queue containing the persistent messages had to
have been created as durable = true and autodelete = false prior to sending
the messages.

Hope this helps.

Regards,
Ed.

On Mon, Oct 27, 2008 at 2:38 PM, Steve Weaver <weaveinator at gmail.com> wrote:

> Hi -
> Im new to RabbitMQ and was wondering if anyone can point me to good
> documentation on how to recover (replay log files or config server or ??)
> persisted messages in the queue that were not consumed?  I have the server
> running and C# producers and consumers working - just having problems with
> the recovery stuff.
>
> Also, if anyone knows of articles on client/server communication over SSL
> or SSH?
>
> Thanks very much in advance for any help!!
> Steve
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081027/92c59761/attachment.htm 

From 0x6e6562 at gmail.com  Mon Oct 27 19:17:10 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 27 Oct 2008 19:17:10 +0000
Subject: [rabbitmq-discuss] Recovering Messages when exchange, queue,
	or broker dies
In-Reply-To: <c05e896e0810271138v3e64b512pe4e322920b28bc68@mail.gmail.com>
References: <c05e896e0810271138v3e64b512pe4e322920b28bc68@mail.gmail.com>
Message-ID: <269388e30810271217j76411c17wad6b1ad569a920d5@mail.gmail.com>

Steve,

On Mon, Oct 27, 2008 at 6:38 PM, Steve Weaver <weaveinator at gmail.com> wrote:
> Also, if anyone knows of articles on client/server communication over SSL or
> SSH?

http://www.rabbitmq.com/api-guide.html#ssl

HTH,

Ben



From dialtone at gmail.com  Mon Oct 27 23:01:31 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Mon, 27 Oct 2008 16:01:31 -0700
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
Message-ID: <179A4906-2D71-494E-B593-ACCB102C29E4@gmail.com>


On Oct 27, 2008, at 8:08 AM, Edwin Fine wrote:

> Valentino started a thread on a related topic so he may be able to
> chime in here: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-October/002105.html
>
> I'll take a look.

The way I solved this is simply to let the client crash and restart  
from the supervisor. Then
it starts a loop until it connects successfully to the other broker.  
This makes the code
really simple and very robust.

The only 'problem' is that in this way I'm basically trusting the  
problem (connection error)
to be solved before RabbitMQ goes out of memory.

Speaking of which... Is there any way (donations, manual labor,  
slavery or such) that
I can be of help to change the queue state to a new object that knows  
how to persist
without using all the memory up?

 From what I see by reading the code I think that the change would be  
isolated inside
rabbit_amqqueue_process.erl and the exact variable is message_buffer.  
An object
with a similar API but a different storage strategy could maybe be  
swapped in instead
of the current queue.

-- 
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081027/028b1483/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081027/028b1483/attachment.pgp 

From 0x6e6562 at gmail.com  Tue Oct 28 11:31:08 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 28 Oct 2008 11:31:08 +0000
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <179A4906-2D71-494E-B593-ACCB102C29E4@gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
	<179A4906-2D71-494E-B593-ACCB102C29E4@gmail.com>
Message-ID: <269388e30810280431u520f7d87sf977744eb9bbd430@mail.gmail.com>

Valentino,

On Mon, Oct 27, 2008 at 11:01 PM, Valentino Volonghi <dialtone at gmail.com> wrote:
> Speaking of which... Is there any way (donations, manual labor, slavery or
> such) that
> I can be of help to change the queue state to a new object that knows how to
> persist
> without using all the memory up?

In general, you can help by either contributing code yourself or by
financing the reprioritization of the roadmap.

Disk overflow or queue paging is on the mid term roadmap as something
we are going to do, but we still need to gather requirements.

Here are a few examples:

- When do you decide to page things to disk?
- Is it done on memory consumption or queue depth?
- Is this configurable per queue or across the broker?
- What are sensible defaults so that people who haven't even though
  about paging don't get affected by overly-agressive defaults?
- When and how do you swap back in - is this automatic or manual?
- How do you decide when the low water mark has been reached after
  having commenced the page-in? Do you resume flow control at this point?
- If you do page, are you interested in last image caching?
- Do you want to apply application level heuristics to selectively purge
  overflowed queues?
- What role do TTLs play in this scenario?
- Furthermore, we do already have a fast message persister - it's just
  that it's geared to write as quickly as possible, not read.
- Ask yourself, if we implement paging, is are we potentially reinventing
  a wheel that the OS has already invented?
- And as always, what do you do when your SAN fills up?

One suggestion to kick things off is to begin a more structured
analysis of the whole problem on the wiki and start a dedicated
discussion thread around this. For example, one could start a document
highlighting the motivation and requirements and let interested
parties comment on this.

> From what I see by reading the code I think that the change would be
> isolated inside
> rabbit_amqqueue_process.erl and the exact variable is message_buffer. An
> object
> with a similar API but a different storage strategy could maybe be swapped
> in instead
> of the current queue.

True - the intention is to have a code base that is as short as
possible so that it can be easily understood and adapted.

Having said that, whilst it may be straight forward to do a hello
world overflow, the devil is in the detail of all of the moving parts
and different scenarios that you have to account for whilst maintaing
the clarity of the code base. And testing it of course.

HTH,

Ben

Ben



From richard.marr at gmail.com  Tue Oct 28 11:33:12 2008
From: richard.marr at gmail.com (Richard Marr)
Date: Tue, 28 Oct 2008 11:33:12 +0000
Subject: [rabbitmq-discuss] Pub/sub with expiring reply queue
Message-ID: <dba8f29c0810280433n704ea428yfb87d2a9f7ea312e@mail.gmail.com>

Hi all,

I'm a recent subscriber to the list. For anyone working on RabbitMQ,
congratulations, from my first impressions it looks like stirling
work.

I'm looking into using it as a possible pub/sub-style distribution
mechanism, and thought I'd check with you guys first in case I've
missed something obvious.

The rough flow in my head goes like this:

1) Messages are published on the queue
2) The publishing code creates a temporary reply queue
3) One or more subscribers will post replies
4) Once all replies are received, or a time limit is reached, reply
queue is removed
5) Replies are merged and returned to the calling code

I guess my question is two-fold: Firstly, does that sound practical
using AMQP? And secondly, are there any examples of that sort of
pattern that I can check my ideas against?

Any advice appreciated,

Richard



From 0x6e6562 at gmail.com  Tue Oct 28 11:42:13 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 28 Oct 2008 11:42:13 +0000
Subject: [rabbitmq-discuss] Pub/sub with expiring reply queue
In-Reply-To: <dba8f29c0810280433n704ea428yfb87d2a9f7ea312e@mail.gmail.com>
References: <dba8f29c0810280433n704ea428yfb87d2a9f7ea312e@mail.gmail.com>
Message-ID: <269388e30810280442w4111fd56wa41d7b9884136ea2@mail.gmail.com>

Richard,

On Tue, Oct 28, 2008 at 11:33 AM, Richard Marr <richard.marr at gmail.com> wrote:
> The rough flow in my head goes like this:
>
> 1) Messages are published on the queue
> 2) The publishing code creates a temporary reply queue
> 3) One or more subscribers will post replies
> 4) Once all replies are received, or a time limit is reached, reply
> queue is removed
> 5) Replies are merged and returned to the calling code

This sounds like plain jane async RPC over AMQP. It is a fairly
commonly used pattern.

There are building blocks (generic RPC server and client modules) in a
lot of the AMQP client packages.

A few examples:

- http://www.rabbitmq.com/api-guide.html#rpc
- http://hopper.squarespace.com/blog/2008/7/4/server-side-as3.html

The only thing that doesn't exist yet is message expiry (is on the
roadmap, but as always, no ETA).

HTH,

Ben



From richard.marr at gmail.com  Tue Oct 28 11:55:44 2008
From: richard.marr at gmail.com (Richard Marr)
Date: Tue, 28 Oct 2008 11:55:44 +0000
Subject: [rabbitmq-discuss] Pub/sub with expiring reply queue
In-Reply-To: <269388e30810280442w4111fd56wa41d7b9884136ea2@mail.gmail.com>
References: <dba8f29c0810280433n704ea428yfb87d2a9f7ea312e@mail.gmail.com>
	<269388e30810280442w4111fd56wa41d7b9884136ea2@mail.gmail.com>
Message-ID: <dba8f29c0810280455u7b7a35ecybd38c5ee406280f2@mail.gmail.com>

Hi Ben,

> This sounds like plain jane async RPC over AMQP. It is a fairly
> commonly used pattern.

Good to know, thanks. I've had a look through the source of the RPC
client/server code and the fog is slowly starting to lift.

> The only thing that doesn't exist yet is message expiry (is on the
> roadmap, but as always, no ETA).

Okay, well I should be able to deal with that myself. If my solution
is relatively generic I'll send it to you guys to consider.

Mainly I just wanted to get a bit of reassurance that I'm not planning
on using a screwdriver to hammer a nail.

Thanks again,

Rich



From 0x6e6562 at gmail.com  Tue Oct 28 12:15:38 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 28 Oct 2008 12:15:38 +0000
Subject: [rabbitmq-discuss] Pub/sub with expiring reply queue
In-Reply-To: <dba8f29c0810280455u7b7a35ecybd38c5ee406280f2@mail.gmail.com>
References: <dba8f29c0810280433n704ea428yfb87d2a9f7ea312e@mail.gmail.com>
	<269388e30810280442w4111fd56wa41d7b9884136ea2@mail.gmail.com>
	<dba8f29c0810280455u7b7a35ecybd38c5ee406280f2@mail.gmail.com>
Message-ID: <269388e30810280515v31412f7cy669fe41cc1007933@mail.gmail.com>

Rich,

On Tue, Oct 28, 2008 at 11:55 AM, Richard Marr <richard.marr at gmail.com> wrote:
>> The only thing that doesn't exist yet is message expiry (is on the
>> roadmap, but as always, no ETA).
>
> Okay, well I should be able to deal with that myself. If my solution
> is relatively generic I'll send it to you guys to consider.

Message expiry *may* not turn out to be an issue for you depending on
how you want to map the RPC semantics. IIRC the Java RpcClient does
not have a client side timeout anyway, the invoker blocks
indefinitely. Message TTLs would be nice, but whether or not this is
strictly required will depend on your app.

> Mainly I just wanted to get a bit of reassurance that I'm not planning
> on using a screwdriver to hammer a nail.

Sure - the idea of the pattern is to temporally decouple the RPC
bottom half by making it asynchronous.

HTH,

Ben



From 0x6e6562 at gmail.com  Tue Oct 28 17:40:59 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 28 Oct 2008 17:40:59 +0000
Subject: [rabbitmq-discuss] Fwd:  Recovering Messages when exchange, queue,
	or broker dies
In-Reply-To: <269388e30810280829j48f5e06dy76af5b661e61ac11@mail.gmail.com>
References: <c05e896e0810271138v3e64b512pe4e322920b28bc68@mail.gmail.com>
	<269388e30810271217j76411c17wad6b1ad569a920d5@mail.gmail.com>
	<c05e896e0810280719p2e8e439bt7314c9b0685261f0@mail.gmail.com>
	<269388e30810280829j48f5e06dy76af5b661e61ac11@mail.gmail.com>
Message-ID: <269388e30810281040k12847fcqb6ac52c1eefb79ef@mail.gmail.com>

---------- Forwarded message ----------
From: Ben Hood <0x6e6562 at gmail.com>
Date: Tue, Oct 28, 2008 at 3:29 PM
Subject: Re: [rabbitmq-discuss] Recovering Messages when exchange,
queue, or broker dies
To: Steve Weaver <weaveinator at gmail.com>


Steve,

On Tue, Oct 28, 2008 at 2:19 PM, Steve Weaver <weaveinator at gmail.com> wrote:
> Hi Ben -
> Thanks for replying - I have already looked at that but using (for now) C#
> client which doesn't have SSL or SSH built in.  I have SSL tunnel (using
> Stunnel) connecting to server but then it times out.  Problem is that I'm
> not sure how once I have connection, how to send the broker connection and
> publish commands over it. It looks like (from Stunnel logs) it makes it to
> the remote server, I'm just not getting the response back. So was hoping
> someone has done this with the C# clients and there would be some
> documentation.

IIRC the option to use SSL is not currently built into the C# client,
so if this is true we could put this on the wish list (as always, no
ETA).

Somebody on the list may have already done this - if they have, maybe
they can pass on the code.

If not, it should be reasonably straight forward to change the current
socket client to use SSL. The Java and AS3 libraries can serve as
examples.

As for the Stunnel config, apart from the stunnel manual itself, there
is an stunnel.conf that works with Rabbit described here:
http://hopper.squarespace.com/blog/2008/5/26/tls-support-in-the-as3-amqp-client.html

HTH,

Ben



From 0x6e6562 at gmail.com  Tue Oct 28 17:42:13 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 28 Oct 2008 17:42:13 +0000
Subject: [rabbitmq-discuss] Recovering Messages when exchange, queue,
	or broker dies
In-Reply-To: <269388e30810280829j48f5e06dy76af5b661e61ac11@mail.gmail.com>
References: <c05e896e0810271138v3e64b512pe4e322920b28bc68@mail.gmail.com>
	<269388e30810271217j76411c17wad6b1ad569a920d5@mail.gmail.com>
	<c05e896e0810280719p2e8e439bt7314c9b0685261f0@mail.gmail.com>
	<269388e30810280829j48f5e06dy76af5b661e61ac11@mail.gmail.com>
Message-ID: <269388e30810281042o12538696v95a09c11717a7a9b@mail.gmail.com>

Steve,

On Tue, Oct 28, 2008 at 3:29 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> If not, it should be reasonably straight forward to change the current
> socket client to use SSL. The Java and AS3 libraries can serve as
> examples.

I forgot to mention that the Python library handles SSL as well
(http://barryp.org/software/py-amqplib/).

Ben



From dialtone at gmail.com  Tue Oct 28 18:53:17 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Tue, 28 Oct 2008 11:53:17 -0700
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <269388e30810280431u520f7d87sf977744eb9bbd430@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
	<179A4906-2D71-494E-B593-ACCB102C29E4@gmail.com>
	<269388e30810280431u520f7d87sf977744eb9bbd430@mail.gmail.com>
Message-ID: <DDFF8E3D-0015-4591-A365-229722072DB7@gmail.com>

On Oct 28, 2008, at 4:31 AM, Ben Hood wrote:

> In general, you can help by either contributing code yourself or by
> financing the reprioritization of the roadmap.
>
> Disk overflow or queue paging is on the mid term roadmap as something
> we are going to do, but we still need to gather requirements.
>
> Here are a few examples:
>
> - When do you decide to page things to disk?

I'd say memory high watermark reached or, if reached before, a number
of messages in the queue.

> - Is it done on memory consumption or queue depth?

Both. Depends on which one is reached first, I can see use cases for
both of these triggers.

> - Is this configurable per queue or across the broker?

Across the broker, other AMQP implementation have a 'maximum number
of messages in a queue' as a per broker option.

> - What are sensible defaults so that people who haven't even though
>  about paging don't get affected by overly-agressive defaults?

If a user was not affected before it won't be affected even after  
because
he won't need to overflow to disk anyway. In case the limit hit is the  
number
of messages then simply set it to infinite when no different is  
specified. Then
it will only use memory watermark and this would give them more  
robustness
going from simply crashing the erlang VM because memory is finished to
slowing down because you are now reading from disk.

> - When and how do you swap back in - is this automatic or manual?

When the buffer in the disk is empty then rabbitmq can stop using it,  
I expect
it to deliver messages in order so once the buffer kicks in I'd queue  
stuff on
disk immediately.

> - How do you decide when the low water mark has been reached after
>  having commenced the page-in? Do you resume flow control at this  
> point?

When the disk buffer is empty. And you simply resume working without it.

> - If you do page, are you interested in last image caching?

I'm not sure what this means but looks like an optimization, it's  
probably
interesting to have but caching can come when the system can resist
prolonged consumer downtimes.

Anyway being an optimization in the queue process it should be fairly
isolated in it. I can totally see keeping the current page always in  
memory
(if this is the optimization we are talking about), the big problem is  
keeping
everything in memory.

> - Do you want to apply application level heuristics to selectively  
> purge
>  overflowed queues?

ActiveMQ offers basically 3 different ways to deal with the problem:
kill the queue, drop all new messages, drop old messages.

This can be taken care of in the publish command of rabbitmq.

> - What role do TTLs play in this scenario?

It's not the role of the message broker to kill single messages, it's  
an application
level decision. I can see a configuration option in the queue though  
that together
with the 3 options above can provide a 'kill all the messages older  
than X seconds'.

This can be taken care inside the queue itself when getting the top of  
the queue.

> - Furthermore, we do already have a fast message persister - it's just
>  that it's geared to write as quickly as possible, not read.

And this is a great to me.

> - Ask yourself, if we implement paging, is are we potentially  
> reinventing
>  a wheel that the OS has already invented?

Well, sure. But erlang fails before when it cannot malloc memory.

> - And as always, what do you do when your SAN fills up?

If a 500-600GB disk fills up it means I had at least ~80 times more  
time to
fix the problem somehow, given an average of 8GB of memory in a  
webserver.
So if with 8GB of memory I had 10 hours to fix it, with a disk I have  
30 days to
fix it, and I can even add new disks with a good disk array or  
filesystem to buy
me more time.

> One suggestion to kick things off is to begin a more structured
> analysis of the whole problem on the wiki and start a dedicated
> discussion thread around this. For example, one could start a document
> highlighting the motivation and requirements and let interested
> parties comment on this.

Good, I'm all for this. And I'm starting with this reply.

> Having said that, whilst it may be straight forward to do a hello
> world overflow, the devil is in the detail of all of the moving parts
> and different scenarios that you have to account for whilst maintaing
> the clarity of the code base. And testing it of course.


Yep, this is just right.

-- 
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081028/59ef4692/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081028/59ef4692/attachment.pgp 

From richard.marr at gmail.com  Wed Oct 29 10:19:41 2008
From: richard.marr at gmail.com (Richard Marr)
Date: Wed, 29 Oct 2008 10:19:41 +0000
Subject: [rabbitmq-discuss] Pub/sub with expiring reply queue
In-Reply-To: <269388e30810280515v31412f7cy669fe41cc1007933@mail.gmail.com>
References: <dba8f29c0810280433n704ea428yfb87d2a9f7ea312e@mail.gmail.com>
	<269388e30810280442w4111fd56wa41d7b9884136ea2@mail.gmail.com>
	<dba8f29c0810280455u7b7a35ecybd38c5ee406280f2@mail.gmail.com>
	<269388e30810280515v31412f7cy669fe41cc1007933@mail.gmail.com>
Message-ID: <dba8f29c0810290319s70b520c5r44e48fe3634b7753@mail.gmail.com>

Hey guys,

I've got my demo app working with the regular synchronous RPC pattern
(ie. only one response per request) and it works like a dream.

The only glitch is that if I make two requests very close to each
other then one of them doesn't respond. The requests have different
reply query names, but they seem to have the same ticket ID (not sure
how the ticket IDs are assigned so not sure if that's the problem).

Have you come across this behaviour before, or is it likely to be a
problem in my code?

Rich



From 0x6e6562 at gmail.com  Wed Oct 29 10:26:03 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 29 Oct 2008 10:26:03 +0000
Subject: [rabbitmq-discuss] Pub/sub with expiring reply queue
In-Reply-To: <dba8f29c0810290319s70b520c5r44e48fe3634b7753@mail.gmail.com>
References: <dba8f29c0810280433n704ea428yfb87d2a9f7ea312e@mail.gmail.com>
	<269388e30810280442w4111fd56wa41d7b9884136ea2@mail.gmail.com>
	<dba8f29c0810280455u7b7a35ecybd38c5ee406280f2@mail.gmail.com>
	<269388e30810280515v31412f7cy669fe41cc1007933@mail.gmail.com>
	<dba8f29c0810290319s70b520c5r44e48fe3634b7753@mail.gmail.com>
Message-ID: <269388e30810290326q4d8a2cc8q4d991c135cbe246f@mail.gmail.com>

Richard,

On Wed, Oct 29, 2008 at 10:19 AM, Richard Marr <richard.marr at gmail.com> wrote:
> Hey guys,
>
> I've got my demo app working with the regular synchronous RPC pattern
> (ie. only one response per request) and it works like a dream.
>
> The only glitch is that if I make two requests very close to each
> other then one of them doesn't respond. The requests have different
> reply query names, but they seem to have the same ticket ID (not sure
> how the ticket IDs are assigned so not sure if that's the problem).
>
> Have you come across this behaviour before, or is it likely to be a
> problem in my code?

It's quite hard to tell without actually seeing the code :-)

Ben



From richard.marr at gmail.com  Wed Oct 29 11:10:30 2008
From: richard.marr at gmail.com (Richard Marr)
Date: Wed, 29 Oct 2008 11:10:30 +0000
Subject: [rabbitmq-discuss] Pub/sub with expiring reply queue
In-Reply-To: <269388e30810290326q4d8a2cc8q4d991c135cbe246f@mail.gmail.com>
References: <dba8f29c0810280433n704ea428yfb87d2a9f7ea312e@mail.gmail.com>
	<269388e30810280442w4111fd56wa41d7b9884136ea2@mail.gmail.com>
	<dba8f29c0810280455u7b7a35ecybd38c5ee406280f2@mail.gmail.com>
	<269388e30810280515v31412f7cy669fe41cc1007933@mail.gmail.com>
	<dba8f29c0810290319s70b520c5r44e48fe3634b7753@mail.gmail.com>
	<269388e30810290326q4d8a2cc8q4d991c135cbe246f@mail.gmail.com>
Message-ID: <dba8f29c0810290410t73713940hc04538097c6a2f12@mail.gmail.com>

Ben,

> It's quite hard to tell without actually seeing the code :-)

Yep. I was naively hoping it'd be an obvious n00b question that you'd
know right off the bat  :o)

The demo I've built delivers each message to two queues, but is
currently syncronous so only waits for the first response. My debug
output tells me that both subscribers (one per queue) get the message
body intact, but the replyTo property is null, even though the reply
queue name generated in the client looks valid. I put debug just
before the RpcClient.publish() call in the RpcClient.primitiveCall()
method and it lookeds fine.

Should the properties object be passed through transparently?



// The client code looks like this:

String exchangeName = "searchExchange";
String routingKey = "search.replica.1";
int ticket = _channel.accessRequest( _realm );
	
RpcClient rpc = new RpcClient( _channel, ticket, exchangeName, routingKey );
byte[] results = rpc.primitiveCall( query.getBytes() );



// And the server code looks like this:

int ticket = _channel.accessRequest( _realm );

String exchangeName = "searchExchange";
String queueName = "search.partition."+_partitionCode+".replica." +
_replicaCode;
String bindingKey = "search.replica." + _replicaCode;

_channel.exchangeDeclare(ticket, exchangeName, "direct");
_channel.queueDeclare(ticket, queueName);
_channel.queueBind(ticket, queueName, exchangeName, bindingKey );

RpcServer server = new RpcServer( _channel, ticket, queueName ){
	@Override
	public byte[] handleCall(QueueingConsumer.Delivery request,
AMQP.BasicProperties replyProperties)
	{
		return _index.search( request.getBody() );
	}
};
ShutdownSignalException e = server.mainloop();



From shash4evr at gmail.com  Wed Oct 29 13:05:20 2008
From: shash4evr at gmail.com (shashi fernando)
Date: Wed, 29 Oct 2008 05:05:20 -0800
Subject: [rabbitmq-discuss] project idea for final year project
Message-ID: <3283c11f0810290605o546d1076p6664c44f07d050d9@mail.gmail.com>

hi all,

im a final year student and looking for a project for my final year
(duration - 8 moths). Still im newbie to
RabbitMQ, but have experience on managing messaging protocols.
And i would like to carry out my project on management of distributed
systems while
making a contribution to open source world.
im glad if you guys can propose some ideas relating to my interested areas
and provide
useful information necessary.

thank you
shash
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081029/8f595aa1/attachment.htm 

From alexis.richardson at cohesiveft.com  Wed Oct 29 13:27:21 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 29 Oct 2008 13:27:21 +0000
Subject: [rabbitmq-discuss] project idea for final year project
In-Reply-To: <3283c11f0810290605o546d1076p6664c44f07d050d9@mail.gmail.com>
References: <3283c11f0810290605o546d1076p6664c44f07d050d9@mail.gmail.com>
Message-ID: <167204d20810290627q446c20eeie527decc2a2624b6@mail.gmail.com>

Shashi


On Wed, Oct 29, 2008 at 1:05 PM, shashi fernando <shash4evr at gmail.com> wrote:
> hi all,

Hi :-)

> im a final year student and looking for a project for my final year
> (duration - 8 moths). Still im newbie to
> RabbitMQ, but have experience on managing messaging protocols.
> And i would like to carry out my project on management of distributed
> systems while
> making a contribution to open source world.

An excellent idea!


> im glad if you guys can propose some ideas relating to my interested areas
> and provide
> useful information necessary.

One idea would be to look at what management tools are already
provided by the underlying erlang/OTP platform, such as Appmon, and
find a way to expose the most important ones to non-erlang users.
There are lots and lots of ways that this could be done, but the
easiest would be via completely language neutral means, e.g. HTTP,
SNMP and of course AMQP.

Another - complementary - idea is this: If you look at current
research into systems management for the industry, people are saying
that WS-Man is too complicated and that providing a RESTful interface
would be better.  Certainly RabbitMQ would be a good harness to show
such an invention.

Also, you could look at using queues to manage other things, by the
command pattern.

It all depends how much work you want to do yourself, and how much you
want to make use of existing tools.

Other folks on the list may have suggestions.  Perhaps we can pool
them and help you figure out which is best for your goals.

alexis







>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From 0x6e6562 at gmail.com  Wed Oct 29 13:36:36 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 29 Oct 2008 13:36:36 +0000
Subject: [rabbitmq-discuss] Pub/sub with expiring reply queue
In-Reply-To: <dba8f29c0810290410t73713940hc04538097c6a2f12@mail.gmail.com>
References: <dba8f29c0810280433n704ea428yfb87d2a9f7ea312e@mail.gmail.com>
	<269388e30810280442w4111fd56wa41d7b9884136ea2@mail.gmail.com>
	<dba8f29c0810280455u7b7a35ecybd38c5ee406280f2@mail.gmail.com>
	<269388e30810280515v31412f7cy669fe41cc1007933@mail.gmail.com>
	<dba8f29c0810290319s70b520c5r44e48fe3634b7753@mail.gmail.com>
	<269388e30810290326q4d8a2cc8q4d991c135cbe246f@mail.gmail.com>
	<dba8f29c0810290410t73713940hc04538097c6a2f12@mail.gmail.com>
Message-ID: <269388e30810290636mdae5f23gd273d31b54f52dee@mail.gmail.com>

Richard,

On Wed, Oct 29, 2008 at 11:10 AM, Richard Marr <richard.marr at gmail.com> wrote:

> The demo I've built delivers each message to two queues, but is
> currently syncronous so only waits for the first response. My debug
> output tells me that both subscribers (one per queue) get the message
> body intact, but the replyTo property is null, even though the reply
> queue name generated in the client looks valid. I put debug just
> before the RpcClient.publish() call in the RpcClient.primitiveCall()
> method and it lookeds fine.
>
> Should the properties object be passed through transparently?

Are you saying that when you debug the processRequest() method in the
server, that the replyTo field of the request propertiesis null when
after this line is executed:

AMQP.BasicProperties requestProperties = request.getProperties();

?

Ben



From 0x6e6562 at gmail.com  Wed Oct 29 13:47:42 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 29 Oct 2008 13:47:42 +0000
Subject: [rabbitmq-discuss] project idea for final year project
In-Reply-To: <3283c11f0810290605o546d1076p6664c44f07d050d9@mail.gmail.com>
References: <3283c11f0810290605o546d1076p6664c44f07d050d9@mail.gmail.com>
Message-ID: <269388e30810290647j74109895y51411cea8c630047@mail.gmail.com>

Shash,

On Wed, Oct 29, 2008 at 1:05 PM, shashi fernando <shash4evr at gmail.com> wrote:
> And i would like to carry out my project on management of distributed
> systems while
> making a contribution to open source world.

Depending on how ambitious you are, there is a lot of valueable work
that can done in the areas of model based checking according to the
protocol or pipeline performance testing. This would be a lot more
intensive than knocking out feature x or y, and is not strictly
related to management, so it really depends on where your interests
lie and what your time budget is.

Ben



From esteve at fluidinfo.com  Wed Oct 29 21:44:15 2008
From: esteve at fluidinfo.com (Esteve Fernandez)
Date: Wed, 29 Oct 2008 22:44:15 +0100
Subject: [rabbitmq-discuss] txAMQP 0.2 released, now with Thrift superpowers
Message-ID: <200810292244.15393.esteve@fluidinfo.com>

Hi all,

I'm pleased to announce that Fluidinfo [1] is releasing txAMQP 0.2, 
(codenamed "Peanut butter and chocolate") [2] which includes support for 
Thrift, and various minor fixes.

What does this mean? Well, it makes easier to build a high performance [3]
massively scalable [4] RPC [5] architecture in Python.

We hope you'll enjoy it!

PS: you'll need to apply the patch at [6] to Thrift to add support for
Twisted

1 - Fluidinfo http://fluidinfo.com
2 - txAMQP http://launchpad.net/txamqp
3 - thanks to Twisted http://www.twistedmatrix.com
4 - thanks to AMQP http://www.amqp.org
5 - thanks to Thrift http://incubator.apache.org/thrift
6 - https://issues.apache.org/jira/browse/THRIFT-148



From jlprasantha at gmail.com  Thu Oct 30 10:02:15 2008
From: jlprasantha at gmail.com (prasantha kumara)
Date: Thu, 30 Oct 2008 15:32:15 +0530
Subject: [rabbitmq-discuss] how to use Rabbitmq consumer and handledilvery
Message-ID: <c8d9c65b0810300302p7d7cdcdfv73d82d943d3d10f1@mail.gmail.com>

i have trouble in with coding the consumer part of the rabitmq que.what i
want to do is the after automatic detection of the publishing massage to the
que ,deliver to the receive,still what oi have done is run a infinite loop
in th eclient to chech weathere there is a massage for that client.and if
find request it.but i want to eliminate the above infinite cloop.with
automatic deleverence.

can any one hel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081030/937fb5e0/attachment.htm 

From shash4evr at gmail.com  Thu Oct 30 17:04:17 2008
From: shash4evr at gmail.com (shashi fernando)
Date: Thu, 30 Oct 2008 09:04:17 -0800
Subject: [rabbitmq-discuss] project idea for final year project
In-Reply-To: <167204d20810290627q446c20eeie527decc2a2624b6@mail.gmail.com>
References: <3283c11f0810290605o546d1076p6664c44f07d050d9@mail.gmail.com>
	<167204d20810290627q446c20eeie527decc2a2624b6@mail.gmail.com>
Message-ID: <3283c11f0810301004t21f3c3c8qd2309d3c75bf4e1c@mail.gmail.com>

On Wed, Oct 29, 2008 at 5:27 AM, Alexis Richardson <
alexis.richardson at cohesiveft.com> wrote:

> Shashi
>
>
> On Wed, Oct 29, 2008 at 1:05 PM, shashi fernando <shash4evr at gmail.com>
> wrote:
> > hi all,
>
> Hi :-)
>
> > im a final year student and looking for a project for my final year
> > (duration - 8 moths). Still im newbie to
> > RabbitMQ, but have experience on managing messaging protocols.
> > And i would like to carry out my project on management of distributed
> > systems while
> > making a contribution to open source world.
>
> An excellent idea!
>
>
> > im glad if you guys can propose some ideas relating to my interested
> areas
> > and provide
> > useful information necessary.
>
> One idea would be to look at what management tools are already
> provided by the underlying erlang/OTP platform, such as Appmon, and
> find a way to expose the most important ones to non-erlang users.
> There are lots and lots of ways that this could be done, but the
> easiest would be via completely language neutral means, e.g. HTTP,
> SNMP and of course AMQP.
>
> Another - complementary - idea is this: If you look at current
> research into systems management for the industry, people are saying
> that WS-Man is too complicated and that providing a RESTful interface
> would be better.  Certainly RabbitMQ would be a good harness to show
> such an invention.
>
> Also, you could look at using queues to manage other things, by the
> command pattern.
>
> It all depends how much work you want to do yourself, and how much you
> want to make use of existing tools.
>
> Other folks on the list may have suggestions.  Perhaps we can pool
> them and help you figure out which is best for your goals.
>
> alexis
>
>
>
>
>
>
>
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>

thank you guys for the ideas. since im newbie to this environment, i have
very little knowledge regarding the erlang/OTP platform and WS-Man (but im
going to lookin into them). Therefore can you please provide a more
ellobaration on followings ,so than i can get the exact idea and work on it.

1. *find a way to expose the most important ones to non-erlang users.
    *what the importance of such exposure* ?

2. WS-Man is too complicated and that providing a RESTful interface
   would be better.  Certainly RabbitMQ would be a good harness to show
   such an invention.

*thank you
shash*
*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081030/afe0b0aa/attachment.htm 

From alexis.richardson at cohesiveft.com  Thu Oct 30 18:19:48 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 30 Oct 2008 18:19:48 +0000
Subject: [rabbitmq-discuss] project idea for final year project
In-Reply-To: <3283c11f0810301004t21f3c3c8qd2309d3c75bf4e1c@mail.gmail.com>
References: <3283c11f0810290605o546d1076p6664c44f07d050d9@mail.gmail.com>
	<167204d20810290627q446c20eeie527decc2a2624b6@mail.gmail.com>
	<3283c11f0810301004t21f3c3c8qd2309d3c75bf4e1c@mail.gmail.com>
Message-ID: <167204d20810301119ybf87b76wd8784b1883d5594b@mail.gmail.com>

Shashi

On Thu, Oct 30, 2008 at 5:04 PM, shashi fernando <shash4evr at gmail.com> wrote:
>
> thank you guys for the ideas. since im newbie to this environment, i have
> very little knowledge regarding the erlang/OTP platform and WS-Man (but im
> going to lookin into them). Therefore can you please provide a more
> ellobaration on followings ,so than i can get the exact idea and work on it.
>
> 1. find a way to expose the most important ones to non-erlang users.
>     what the importance of such exposure ?

It would mean that anyone (not just erlang users) could use the
management features, making them more useful and probably easier to
integrate into other systems.


> 2. WS-Man is too complicated and that providing a RESTful interface
>    would be better.  Certainly RabbitMQ would be a good harness to show
>    such an invention.

You could look at WS-Man and choose a small, simple subset of common
management actions that are deemed language neutral by the WS
community.  You could then devise an interface using HTTP-REST.
Because RabbitMQ likes to be managed it would be a good place to
showcase this.

alexis



From dialtone at gmail.com  Thu Oct 30 19:22:58 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Thu, 30 Oct 2008 12:22:58 -0700
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <269388e30810280431u520f7d87sf977744eb9bbd430@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
	<179A4906-2D71-494E-B593-ACCB102C29E4@gmail.com>
	<269388e30810280431u520f7d87sf977744eb9bbd430@mail.gmail.com>
Message-ID: <428FB46D-CC62-4E9F-87BA-277DBD4BFA7B@gmail.com>


On Oct 28, 2008, at 4:31 AM, Ben Hood wrote:

> One suggestion to kick things off is to begin a more structured
> analysis of the whole problem on the wiki and start a dedicated
> discussion thread around this. For example, one could start a document
> highlighting the motivation and requirements and let interested
> parties comment on this.


I've started doing this in the rabbitmq wiki, hopefully nobody will
complain about it.

Here's a link to the page: https://dev.rabbitmq.com/wiki/DiskOverflow

Anyway should feel free to comment, edit, add new stuff, their usecases
etc etc.

-- 
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081030/ed81be6c/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081030/ed81be6c/attachment.pgp 

