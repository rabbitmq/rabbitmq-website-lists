<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Priorities support in RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Priorities%20support%20in%20RabbitMQ&In-Reply-To=4A9BBFEF.5050809%40googlemail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004760.html">
   <LINK REL="Next"  HREF="004747.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Priorities support in RabbitMQ</H1>
    <B>Michal Chruszcz</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Priorities%20support%20in%20RabbitMQ&In-Reply-To=4A9BBFEF.5050809%40googlemail.com"
       TITLE="[rabbitmq-discuss] Priorities support in RabbitMQ">mchruszcz at gmail.com
       </A><BR>
    <I>Tue Sep  1 13:32:39 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004760.html">[rabbitmq-discuss] Error: RabbitMQ.Client.ConnectionFactory.cs	- &quot;Only one usage of each socket address (protocol/network	address/port) is normally permitted&quot;
</A></li>
        <LI>Next message: <A HREF="004747.html">[rabbitmq-discuss] rabbitmq nodename/hostname -s problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4744">[ date ]</a>
              <a href="thread.html#4744">[ thread ]</a>
              <a href="subject.html#4744">[ subject ]</a>
              <a href="author.html#4744">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Aug 31, 2009, at 2:19 PM, Holger Hoffst&#228;tte wrote:

&gt;<i> Michal Chruszcz wrote:
</I>&gt;&gt;<i> control order of message processing. Say I have distributed
</I>&gt;&gt;<i> asynchronous data processing service, which uses RabbitMQ for  
</I>&gt;&gt;<i> queueing
</I>&gt;&gt;<i> tasks, and would like to prioritize them depending on  data volume
</I>&gt;&gt;<i> (tiny packages are processed first). Priorities seemed to be perfect
</I>&gt;&gt;<i> solution, but unfortunately later I realized it's not supported yet.
</I>&gt;<i>
</I>&gt;<i> It is a common misconception that priorities alone can be used to do  
</I>&gt;<i> this
</I>&gt;<i> &quot;properly&quot; - it will only work well if you are accidentally lucky with
</I>&gt;<i> your ingress patterns or really don't care about a total lack of
</I>&gt;<i> predictable processing latency for larger messages. Since Rabbit  
</I>&gt;<i> does not
</I>&gt;<i> page to disk yet, preferring small messages might even make it run  
</I>&gt;<i> out of
</I>&gt;<i> memory *sooner* as more and more large messages are held back.
</I>
In general you're absolutely right, but this does not apply to my  
case, since messages themselves don't contain the data to be  
processed. In fact they are only &quot;pointers&quot; to the data, whose size is  
constant, thus postponing processing of messages pointing to larger  
amounts of data doesn't increase memory usage. In contrary it could  
even lower it, since total throughput would increase.

&gt;<i> Do not
</I>&gt;<i> underestimate the effectiveness of randomized workloads. :)
</I>
I am not. However a well thought out deterministic algorithm usually  
is more effective. :-)

&gt;<i> Explicitly moding this with multiple queues and multiple consumers  
</I>&gt;<i> is much
</I>&gt;<i> more likely to result in better (both predictable and controllable)
</I>&gt;<i> scalability and a well-balanced throughput for both small and large
</I>&gt;<i> messages. Spin up multiple consumers for small messages (keeping those
</I>&gt;<i> cores busy and even hopefully reducing per-message latency), have one
</I>&gt;<i> low-priority consumer chew on larger tasks in the background or even  
</I>&gt;<i> on
</I>&gt;<i> another machine. It also gives you the option of having different
</I>&gt;<i> durability/persistence options for different priorities.
</I>

Again, this is a good idea in general, but a little bit awkward in my  
situation. I'm using celery (<A HREF="http://celeryproject.org/">http://celeryproject.org/</A>) as consumers,  
whose role is performing background computation, and the idea behind  
it is automatic distribution of tasks between nodes. While it is  
probably possible to define custom routing of tasks it's against the  
architecture.

Best regards,
Michal Chruszcz
<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mchruszcz at gmail.com</A>
mobile: +48 607 620 771
phone: +48 22 849 30 26



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004760.html">[rabbitmq-discuss] Error: RabbitMQ.Client.ConnectionFactory.cs	- &quot;Only one usage of each socket address (protocol/network	address/port) is normally permitted&quot;
</A></li>
	<LI>Next message: <A HREF="004747.html">[rabbitmq-discuss] rabbitmq nodename/hostname -s problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4744">[ date ]</a>
              <a href="thread.html#4744">[ thread ]</a>
              <a href="subject.html#4744">[ subject ]</a>
              <a href="author.html#4744">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
