<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] is it possible to receive old messages on	subscribe ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20is%20it%20possible%20to%20receive%20old%20messages%20on%0A%09subscribe%20%3F&In-Reply-To=4A9F915F.3020100%40melix.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004763.html">
   <LINK REL="Next"  HREF="004765.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] is it possible to receive old messages on	subscribe ?</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20is%20it%20possible%20to%20receive%20old%20messages%20on%0A%09subscribe%20%3F&In-Reply-To=4A9F915F.3020100%40melix.org"
       TITLE="[rabbitmq-discuss] is it possible to receive old messages on	subscribe ?">0x6e6562 at gmail.com
       </A><BR>
    <I>Thu Sep  3 12:03:17 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004763.html">[rabbitmq-discuss] is it possible to receive old messages on	subscribe ?
</A></li>
        <LI>Next message: <A HREF="004765.html">[rabbitmq-discuss] possible meet-up in SF next week?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4764">[ date ]</a>
              <a href="thread.html#4764">[ thread ]</a>
              <a href="subject.html#4764">[ subject ]</a>
              <a href="author.html#4764">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>J&#233;r&#233;my,

On Thu, Sep 3, 2009 at 10:50 AM, J&#233;r&#233;my Lal&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">kapouer at melix.org</A>&gt; wrote:
&gt;<i> Now for some queue, i'd like to make every new subscriber receive all messages
</I>&gt;<i> previously sent to the queue (by some privileged user).
</I>&gt;<i>
</I>&gt;<i> Is there a way to do this ? if yes, where do i need to look at ?
</I>&gt;<i> i tried reading the AMQP spec, and did not understand it well enough to find
</I>&gt;<i> an answer...
</I>
I think the only clean way to do this on a pure AMQP level is to have
create and bind queues for consumers that don't yet exist - so that
they will get a *full* queue when they subscribe - they will consume
all of the previously sent messages first and then continue with the
stuff that trickles in afterwards. Since queue paging is only landing
in the next Rabbit release, this *could* cost you a lot of memory with
the current version. Also, you would have to know about all new
consumers ahead of time.

Conceptually, I think you need to ask yourself whether you are turning
your messaging system into a database. If you are, then maybe it's not
such a good idea to implement a database in Rabbit.

Having said this, this is a reasonably common pattern - to implement
this, some people have set up routing rules to archive each message in
addition to normal consumers subscribing to queues - this routing is
the value-add of AMQP. Then in their application they implement the
subscription logic as follows:

- Create and bind a queue to the to real time exchange, but don't
subscribe yet, just let messages queue up;
- Send a request to the archive to replay archived messages;
- Process the archived messages;
- Subscribe to the queue you bound in step one and handle the initial
duplicates;
- Continue consuming the trickle feed as normal;

There are a few improvements some people have made to this kind of thing:

- Implement monotonically increasing ids for your messages so that you
can replay from an arbitrary point;
- Consider a non-AMQP bulk transfer mechanism for recovering old
messages , e.g. HTTP - this can be useful if your consumers
potentially have to recover a vast amount of old data;

HTH,

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004763.html">[rabbitmq-discuss] is it possible to receive old messages on	subscribe ?
</A></li>
	<LI>Next message: <A HREF="004765.html">[rabbitmq-discuss] possible meet-up in SF next week?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4764">[ date ]</a>
              <a href="thread.html#4764">[ thread ]</a>
              <a href="subject.html#4764">[ subject ]</a>
              <a href="author.html#4764">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
