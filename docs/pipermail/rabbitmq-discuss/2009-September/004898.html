<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ with Socket Server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20with%20Socket%20Server&In-Reply-To=9D816149-C7F0-46CE-9C46-89A3C5518EE0%40mac.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004871.html">
   <LINK REL="Next"  HREF="004901.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ with Socket Server</H1>
    <B>Alex Gentle</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20with%20Socket%20Server&In-Reply-To=9D816149-C7F0-46CE-9C46-89A3C5518EE0%40mac.com"
       TITLE="[rabbitmq-discuss] RabbitMQ with Socket Server">alexgentle at sify.com
       </A><BR>
    <I>Fri Sep 18 01:40:15 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004871.html">[rabbitmq-discuss] RabbitMQ with Socket Server
</A></li>
        <LI>Next message: <A HREF="004901.html">[rabbitmq-discuss] RabbitMQ with Socket Server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4898">[ date ]</a>
              <a href="thread.html#4898">[ thread ]</a>
              <a href="subject.html#4898">[ subject ]</a>
              <a href="author.html#4898">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>You need to declare an exchange (of type direct, fanout or topic)
</I>
&gt;<i>which acts as the mailbox for sending the message.
</I>


Thank you for taking time to answer my questions.



&gt;<i>Once you have parsed the message from socket server and determined it &gt;should go to rabbit, you publish the message to it.
</I>


I don&#8217;t know Ruby. I wrote a PHP program that parse the message from
socket server and pass the message to RabbitMQ server. When
the message comes back from RabbitMQ, I format it and send to socket
server that forwards the message to iPhone.



The catch here is the performance. iPhone needs to query for the
message in the queue every few seconds. Let us assume
that User A and User B chats thru iPhone application. User A sends the
message to RabbitMQ.



User A -&gt; Socket Server -&gt; RabbitMQ Server



RabbitMQ has no way of sending the notification to User B that some
message is waiting for him.



User B needs to check the RabbitMQ server every 5 seconds to see if
there is any message in his queue.



Imagine there are 10,000 users like user A and B. All of them will be
sending the message thru socket server to RabbitMQ server. Socket
server can handle all the traffic. It&#8217;s a piece of cake for RabbitMQ
to handle the traffic. But, the poor PHP program in the middle
(between socket server and RabbitMQ) can&#8217;t handle all the incoming and
outgoing requests with ease. It&#8217;s going to slow down the process.
Users will see substantial delay in sending and receiving messages.



Is there a better way to do it? Thanks.





On Tue, Sep 15, 2009 at 7:27 PM, Chuck Remes &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cremes.devlist at mac.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> On Sep 15, 2009, at 7:19 PM, Alex Gentle wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; iPhone app -&gt; socket server -&gt; RabbitMQ server
</I>&gt;<i>
</I>&gt;<i> Great, this is very helpful.
</I>&gt;<i>
</I>&gt;<i> &gt; iPhone app has some social networking features in addition to the
</I>&gt;<i> &gt; chat component. Think of it like mini-facebook inside iPhone. When a
</I>&gt;<i> &gt; user types a message inside chat window of iPhone app, the message
</I>&gt;<i> &gt; travels to Socket server which directs the message depending on what
</I>&gt;<i> &gt; is on the message header. If the message header says &quot;this message
</I>&gt;<i> &gt; is for RabbitMQ&quot;, socket server will route to RabbitMQ. When a
</I>&gt;<i> &gt; message comes from RabbitMQ to socket server, it should have message
</I>&gt;<i> &gt; header that says &quot;Route this to xxxxxx user&quot;. Then, socket server
</I>&gt;<i> &gt; will route the message to appropriate user(s).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It all looks good, but it doesn't work. Because I don't know how to
</I>&gt;<i> &gt; make a call to RabbitMQ using the message from socket server and how
</I>&gt;<i> &gt; to pass the message from RabbitMQ to socket server in binary format.
</I>&gt;<i>
</I>&gt;<i> Ah, this is good.
</I>&gt;<i>
</I>&gt;<i> You need to declare an exchange (of type direct, fanout or topic)
</I>&gt;<i> which acts as the mailbox for sending the message. Once you have
</I>&gt;<i> parsed the message from socket server and determined it should go to
</I>&gt;<i> rabbit, you publish the message to it. Here's some ruby code
</I>&gt;<i> (commented).
</I>&gt;<i>
</I>&gt;<i> def publish_message_to_rabbit(message)
</I>&gt;<i>   # declare the exchange
</I>&gt;<i>   exchange = MQ.direct 'mailbox'
</I>&gt;<i>
</I>&gt;<i>   # send the message
</I>&gt;<i>   exchange.publish(message, :key =&gt; 'some.routing.key')
</I>&gt;<i> end
</I>&gt;<i>
</I>&gt;<i> Next, you need to have a client somewhere that is listening for
</I>&gt;<i> messages. You need to allocate a queue to receive the message and
</I>&gt;<i> subscribe to the routing key. Again, some ruby code.
</I>&gt;<i>
</I>&gt;<i> def listen_for_rabbit_messages
</I>&gt;<i>   # redeclare the exchange; idempotent operation
</I>&gt;<i>   exchange = MQ.direct 'mailbox'
</I>&gt;<i>
</I>&gt;<i>   # declare a queue to receive the messages
</I>&gt;<i>   queue = MQ.queue 'mailslot'
</I>&gt;<i>
</I>&gt;<i>   # bind the queue to the exchange and match incoming messages against
</I>&gt;<i>   # the specified routing key
</I>&gt;<i>   queue.bind(exchange, :key =&gt; 'some.routing.key').subscribe do |
</I>&gt;<i> message|
</I>&gt;<i>     # this block is called each time a message is received
</I>&gt;<i>     # do your message processing here
</I>&gt;<i>   end
</I>&gt;<i> end
</I>&gt;<i>
</I>&gt;<i> Does this help? I highly recommend you take a look through the sample
</I>&gt;<i> code and come back with specific questions.
</I>&gt;<i>
</I>&gt;<i> cr
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090917/4aaa6539/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090917/4aaa6539/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004871.html">[rabbitmq-discuss] RabbitMQ with Socket Server
</A></li>
	<LI>Next message: <A HREF="004901.html">[rabbitmq-discuss] RabbitMQ with Socket Server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4898">[ date ]</a>
              <a href="thread.html#4898">[ thread ]</a>
              <a href="subject.html#4898">[ subject ]</a>
              <a href="author.html#4898">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
