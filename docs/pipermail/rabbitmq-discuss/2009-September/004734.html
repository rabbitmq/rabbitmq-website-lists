<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] of queues, memory and heartbeats...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20of%20queues%2C%20memory%20and%20heartbeats...&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004732.html">
   <LINK REL="Next"  HREF="004735.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] of queues, memory and heartbeats...</H1>
    <B>Anthony</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20of%20queues%2C%20memory%20and%20heartbeats...&In-Reply-To="
       TITLE="[rabbitmq-discuss] of queues, memory and heartbeats...">anthony-rabbitmq at hogan.id.au
       </A><BR>
    <I>Tue Sep  1 08:36:02 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004732.html">[rabbitmq-discuss] direct queue throughput
</A></li>
        <LI>Next message: <A HREF="004735.html">[rabbitmq-discuss] of queues, memory and heartbeats...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4734">[ date ]</a>
              <a href="thread.html#4734">[ thread ]</a>
              <a href="subject.html#4734">[ subject ]</a>
              <a href="author.html#4734">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

We're in a particular situation where occasionally a client will be
disconnected from the server (often through some unclean network break, such
as the random stuff that can happen with 3G data links and virtual
machines), but the queues associated with that client don't die and continue
to grow.

Eventually some of the queues grow so large, that we start seeing txamqp
(the client side library we use) start whining that it doesn't know what to
do with &quot;channel_flow&quot; - presumably this is the memory based throttling
kicking in (though I don't recall explicitly enabling it - unless it's
something auto-enabled by default in the .deb packages?)...

Questions would be:

   1. Even though we haven't explicitly enabled it, if we do start to see
   channel_flow messages, this would be the memory based throttling, correct?

   2. Besides rabbit noticing when a TCP connection dies - is there any
   &quot;heartbeat&quot; functionality built into rabbit and/or the AMQP spec that would
   actually test whether or not a connection is active, and if it isn't, kill
   the relevant queues? Do I as the person who monitors the server configure
   this, or do the programmers who write our clients need to incorporate
   something into their code?

   3. In calculating the &quot;5%&quot; of memory available threshold, what would
   rabbit be considering memory.. Real? Swap? Virtual? All of the above?
   Ie.
   # cat /proc/meminfo | grep -i &quot;total\|free&quot;
   MemTotal:       514056 kB
   MemFree:        144860 kB
   HighTotal:           0 kB
   HighFree:            0 kB
   LowTotal:       514056 kB
   LowFree:        144860 kB
   SwapTotal:     1044184 kB
   SwapFree:       838244 kB
   VmallocTotal:   442360 kB
   HugePages_Total:     0
   HugePages_Free:      0

As a failsafe against runaway queues, I'm thinking of implementing something
that culls queues over a given order of magnitude on a timed basis, or
triggered by a lower memory threshold than rabbit's..
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090901/20bf43e7/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090901/20bf43e7/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004732.html">[rabbitmq-discuss] direct queue throughput
</A></li>
	<LI>Next message: <A HREF="004735.html">[rabbitmq-discuss] of queues, memory and heartbeats...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4734">[ date ]</a>
              <a href="thread.html#4734">[ thread ]</a>
              <a href="subject.html#4734">[ subject ]</a>
              <a href="author.html#4734">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
