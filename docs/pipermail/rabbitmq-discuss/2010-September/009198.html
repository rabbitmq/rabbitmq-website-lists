<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] last sticky wicket on map/reduce
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20last%20sticky%20wicket%20on%20map/reduce&In-Reply-To=%3C61B2CAFD-202F-4374-8F65-D6F8EC3C4D85%40npcinternational.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009203.html">
   <LINK REL="Next"  HREF="009201.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] last sticky wicket on map/reduce</H1>
    <B>Jon Brisbin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20last%20sticky%20wicket%20on%20map/reduce&In-Reply-To=%3C61B2CAFD-202F-4374-8F65-D6F8EC3C4D85%40npcinternational.com%3E"
       TITLE="[rabbitmq-discuss] last sticky wicket on map/reduce">jon.brisbin at npcinternational.com
       </A><BR>
    <I>Thu Sep 30 21:41:51 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009203.html">[rabbitmq-discuss] Plugins not starting?
</A></li>
        <LI>Next message: <A HREF="009201.html">[rabbitmq-discuss] hanging on message sending with py-amqplib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9198">[ date ]</a>
              <a href="thread.html#9198">[ thread ]</a>
              <a href="subject.html#9198">[ subject ]</a>
              <a href="author.html#9198">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've got a pest of a sticky wicket in my map/reduce implementation that's using Groovy for the logic and RabbitMQ for the plumbing. It's frustrating because I'm so close.

The problem I'm having is knowing when I'm finished. Using data like this:

1
2
3
4
5
6
7
8
9
10
END

The &quot;END&quot; goes through a separate consumer thread because it goes out on a fanout exchange (it has to go to all workers), so it comes in out-of-order from the other data:

1    2    3
          END
4    5    6
END  END  
7    8    9
...etc...

I can sort of work around this by keeping track of id changes in my consumers using the classic &quot;if this.id != last.id&quot; approach. But the last record is a tricky one because there's no key change event to trigger sending the response back. Unless I simply wait until a timeout has occurred, I'm not sure how I can tell when I've collected all the responses I'm going to get.

The problem is that I only know how many message I've sent and not how many to expect in return. emit() can be called multiple times from a map phase and the reduce phase can take (records per key) * (emitted) and either rereduce the result or reply back to the requestor. The requestor shouldn't know whether the result has been rereduced or not. It should simply process the return values.

What am I missing to handle situations like this? Should I introduce another component to this that keeps track of how many messages are sent and received? Maybe put a ZooKeeper install in somewhere and coordinate all this? I've already got Riak integrated, though I'd think ZooKeeper would be better at managing concurrent updates.

Any help or suggestions here would be greatly appreciated! :)

Jon Brisbin
Portal Webmaster
NPC International, Inc.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100930/4e41638a/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100930/4e41638a/attachment.htm</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009203.html">[rabbitmq-discuss] Plugins not starting?
</A></li>
	<LI>Next message: <A HREF="009201.html">[rabbitmq-discuss] hanging on message sending with py-amqplib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9198">[ date ]</a>
              <a href="thread.html#9198">[ thread ]</a>
              <a href="subject.html#9198">[ subject ]</a>
              <a href="author.html#9198">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
