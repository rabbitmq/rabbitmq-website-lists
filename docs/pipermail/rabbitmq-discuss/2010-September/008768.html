<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Active/active HA setup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active/active%20HA%20setup&In-Reply-To=%3CAANLkTi%3DX2LABYt0-GCpRjytQdwLzR%3DUXs8YB7VLN378U%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008767.html">
   <LINK REL="Next"  HREF="008772.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Active/active HA setup</H1>
    <B>Alexis Richardson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active/active%20HA%20setup&In-Reply-To=%3CAANLkTi%3DX2LABYt0-GCpRjytQdwLzR%3DUXs8YB7VLN378U%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Active/active HA setup">alexis at rabbitmq.com
       </A><BR>
    <I>Thu Sep  2 23:50:18 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008767.html">[rabbitmq-discuss] Active/active HA setup
</A></li>
        <LI>Next message: <A HREF="008772.html">[rabbitmq-discuss] Active/active HA setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8768">[ date ]</a>
              <a href="thread.html#8768">[ thread ]</a>
              <a href="subject.html#8768">[ subject ]</a>
              <a href="author.html#8768">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jiri

You say that &quot;Some clients send requests to one broker, some to the other&quot;.


Does this mean that one client publisher can send messages (requests) to
both brokers, in such a way that a pair of messages may arrive out of order
if one is sent to each broker?

If the answer is no, then I think my answer stands, because causal order
will be preserved even if messages are lost.  That is: messages that arrive
successfully, will not be out of order with each other.

If the answer is yes, then I am not sure how you can recover global ordering
without imposing it at the publisher using sequence numbers at the app
level.

Does this make sense?

alexis



On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jiri at krutil.com</A>&gt; wrote:

&gt;<i> Alexis
</I>&gt;<i>
</I>&gt;<i> Sorry I probably didn't express myself well.
</I>&gt;<i>
</I>&gt;<i> We don't plan a primary and secondary broker, but a pair of brokers that
</I>&gt;<i> are both active at the same time. A load balancer divides client connections
</I>&gt;<i> to these brokers. A request queue with the same name exists on both brokers,
</I>&gt;<i> but with different contents. Some clients send requests to one broker, some
</I>&gt;<i> to the other. Our back-end server listens to both queues, processes requests
</I>&gt;<i> and sends each response to an exclusive client queue on the broker from
</I>&gt;<i> where the request came.
</I>&gt;<i>
</I>&gt;<i> Ideally this would be transparent to the clients, because the brokers would
</I>&gt;<i> be hidden by a virtual IP address. Of course it can't be transparent to the
</I>&gt;<i> back-end server, which needs to talk to both brokers at the same time.
</I>&gt;<i>
</I>&gt;<i> So (a) is correct, but (b) not.
</I>&gt;<i>
</I>&gt;<i> Hope that makes it a bit clearer...
</I>&gt;<i>
</I>&gt;<i> Cheers
</I>&gt;<i> Jiri
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Jiri
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That answered my questions.  Now, as I understood your example:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> a. you don't mind messages being lost
</I>&gt;&gt;<i> *and*
</I>&gt;&gt;<i> b. you don't use the secondary until after the primary has failed.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Note that if consumption is completely 'fire and forget' then it is
</I>&gt;&gt;<i> possible that a message from the primary may *arrive* after a message from
</I>&gt;&gt;<i> the secondary.  But this can happen whether you use sequence numbers or not.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So if the primary broker fails, why not just forget all undelivered
</I>&gt;&gt;<i> messages?  Consumers will know that any message consumed from the secondary
</I>&gt;&gt;<i> must be later in *all* orderings than any message consumed from the primary.
</I>&gt;&gt;<i>  So, additional sequence numbering is not necessary.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> alexis
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/80c076e0/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100902/80c076e0/attachment-0001.htm</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008767.html">[rabbitmq-discuss] Active/active HA setup
</A></li>
	<LI>Next message: <A HREF="008772.html">[rabbitmq-discuss] Active/active HA setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8768">[ date ]</a>
              <a href="thread.html#8768">[ thread ]</a>
              <a href="subject.html#8768">[ subject ]</a>
              <a href="author.html#8768">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
