<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] hanging on message sending with py-amqplib
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20hanging%20on%20message%20sending%20with%20py-amqplib&In-Reply-To=%3CAANLkTi%3DXsJWYP6ZVxhAT8qKsKWRCHJ4Ohew%3D_%3D%3DYaq3f%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009198.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] hanging on message sending with py-amqplib</H1>
    <B>tsuraan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20hanging%20on%20message%20sending%20with%20py-amqplib&In-Reply-To=%3CAANLkTi%3DXsJWYP6ZVxhAT8qKsKWRCHJ4Ohew%3D_%3D%3DYaq3f%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] hanging on message sending with py-amqplib">tsuraan at gmail.com
       </A><BR>
    <I>Thu Sep 30 22:52:46 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009198.html">[rabbitmq-discuss] last sticky wicket on map/reduce
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9201">[ date ]</a>
              <a href="thread.html#9201">[ thread ]</a>
              <a href="subject.html#9201">[ subject ]</a>
              <a href="author.html#9201">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm migrating machines from using the old bug21673 snapshot that I've
been using to the new rabbit 2.1.0 release.  Fortunately, all of our
queue information is recoverable from our databases, so I am able to
wipe the old mq directory and start a new rabbit instance.  I'm having
a problem repopulating the queues though; what's happening is that as
I send the messages that belong in their respective queues, I'm
getting hanging in the py-amqplib socket.flush method (if the hang
happens while sending) or in the socket.recv method (if the hang
happens during a tx_commit).  I don't believe I've successfully sent
any messages at all on the machines that are doing this.

The way I'm repopulating the queues is by binding each queue to the
amq.direct exchange with the queue name as the routing key, and then
sending messages to that exchange with the desired queue's name as the
key.  The messages are being created as persistent messages, and the
sends are done in a transactional channel with a commit every hundred
messages.  While this is happening, the consumers are consuming from
the queues.  If I stop the consumers, then the hangs also stop.  I
also don't ever seem to get hangs when doing normal message sending
through the exchanges that I normally use; at least I haven't seen any
evidence or heard any bug reports that would indicate that's
happening.  There is nothing in my sasl log, and the only unusual
thing in my other log is that I'm sometimes hitting the high water
mark, but I haven't seen that happen while I've been attempting to
send messages.

Can anybody give me some advice on how to debug what's going on?  Am I
abusing the amq.direct exchange?  Any ideas would be appreciated; this
isn't happening on many machines, but it concerns me a bit.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009198.html">[rabbitmq-discuss] last sticky wicket on map/reduce
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9201">[ date ]</a>
              <a href="thread.html#9201">[ thread ]</a>
              <a href="subject.html#9201">[ subject ]</a>
              <a href="author.html#9201">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
