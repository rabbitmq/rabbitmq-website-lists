<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] mitigating broker and consumer outages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20mitigating%20broker%20and%20consumer%20outages&In-Reply-To=%3C4C90B416.6050801%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008911.html">
   <LINK REL="Next"  HREF="008882.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] mitigating broker and consumer outages</H1>
    <B>Michael Bridgen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20mitigating%20broker%20and%20consumer%20outages&In-Reply-To=%3C4C90B416.6050801%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] mitigating broker and consumer outages">mikeb at rabbitmq.com
       </A><BR>
    <I>Wed Sep 15 12:55:02 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008911.html">[rabbitmq-discuss] mitigating broker and consumer outages
</A></li>
        <LI>Next message: <A HREF="008882.html">[rabbitmq-discuss] Websocket protocol plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8925">[ date ]</a>
              <a href="thread.html#8925">[ thread ]</a>
              <a href="subject.html#8925">[ subject ]</a>
              <a href="author.html#8925">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Shane,

&gt;&gt;<i>    1. I've noticed that all consumers connected to a broker (via Spring
</I>&gt;&gt;<i>    AMQP) stop whenever the broker is stopped. Is this behavior expected?
</I>
They will stop in the sense that when the connection to the broker is 
dropped, it is not automatically picked up again (well I don't think so, 
I've not looked at spring-amqp specifically).

Automatic reconnection is something that could certainly be built into 
clients (but isn't, in the case of our Java client) and applications, 
but it's not without difficulty -- see below.

&gt;&gt;<i>    2. What's the best practice for doing a complete reset (restarting the
</I>&gt;&gt;<i>    broker and consumers)?
</I>
I don't know if there's a commonly understood best practice for how to 
restart consumers (especially lots of consumers) -- perhaps people on 
the list have tactics that work well for them?

Very broadly, I would expect that an orderly reset is best accomplished 
by stopping producers, then consumers, then the broker; and the reverse 
for starting up.

With regard to your application, if you are reconnecting, your 
application must be prepared to be delivered messages that it's already 
seen.  The reason is that messages that weren't acknowledged will be 
returned to the queue on channel close, and redelivered when there are 
again consumers.

In the case of multiple consumers (e.g., if you are using a shared queue 
to load-balance work items), this also means that messages may not be 
distributed among consumers in the same way as before.

Usually this means making work items either transient (in which case, 
you use no_ack=true when consuming) or idempotent (e.g., by having a 
de-duplication filter).

In the pub-sub case you probably either don't care if you're delivered 
messages more than once anyway, or are happy to miss messages.

&gt;&gt;<i>    3. In a system with hundreds of consumers on dozens of machines, it's
</I>&gt;&gt;<i>    impractical to restart them by hand. Is there anything out of the box which
</I>&gt;&gt;<i>    can facilitate reconnecting consumers to a broker?
</I>
Rabbit will try very hard to shut connections down in an orderly fashion 
when you stop it.  For that reason, you can generally rely on having a 
known state in your application.  Hence it is reasonable to expect to 
simply respond to the AMQP connection closing by throwing away work in 
progress, and trying to reconnect (with a backoff).  But, as above, the 
details will depend very much on your application.


HTH,
Michael
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008911.html">[rabbitmq-discuss] mitigating broker and consumer outages
</A></li>
	<LI>Next message: <A HREF="008882.html">[rabbitmq-discuss] Websocket protocol plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8925">[ date ]</a>
              <a href="thread.html#8925">[ thread ]</a>
              <a href="subject.html#8925">[ subject ]</a>
              <a href="author.html#8925">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
