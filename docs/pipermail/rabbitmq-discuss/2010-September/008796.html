<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Delay delivering messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Delay%20delivering%20messages&In-Reply-To=%3C20100903120234.GD2873%40dakota.eng.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008793.html">
   <LINK REL="Next"  HREF="008807.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Delay delivering messages</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Delay%20delivering%20messages&In-Reply-To=%3C20100903120234.GD2873%40dakota.eng.vmware.com%3E"
       TITLE="[rabbitmq-discuss] Delay delivering messages">alexandru at rabbitmq.com
       </A><BR>
    <I>Fri Sep  3 13:02:34 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008793.html">[rabbitmq-discuss] Delay delivering messages
</A></li>
        <LI>Next message: <A HREF="008807.html">[rabbitmq-discuss] Delay delivering messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8796">[ date ]</a>
              <a href="thread.html#8796">[ thread ]</a>
              <a href="subject.html#8796">[ subject ]</a>
              <a href="author.html#8796">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Michael,

&gt;<i> If I let it run for a bit then sometimes both the sending and receiving rate
</I>&gt;<i> drop significantly e.g.:
</I>&gt;<i> 
</I>&gt;<i> sending rate: 638 msg/s, basic returns: 0 ret/s
</I>&gt;<i> recving rate: 628 msg/s, min/avg/max latency: 11788406/12363242/12735553
</I>&gt;<i> microseconds
</I>&gt;<i> 
</I>&gt;<i> Not sure if this drop is indicative of anything?
</I>
Probably not.  Since the sending rate tends to be a bit higher than the
receiving rate, messages are probably piling up in the queue and
rabbit's running out of memory.  You can check if this is the case by
running rabbitmqctl list_queues [when the slowdown occurs].

This means that the broker's fine in your setup.

When the slowdown occurs, does rabbit pick up speed a bit later?  Or do
you have to restart it or something else of the sort?

When it occurs, does list_queues show a large number of messages?  If
so, you're probably not ack'ing the messages after consuming them.

On an unrelated note, 2.0.0 is out, so you might want to upgrade.

Cheers,
Alex

On Fri, Sep 03, 2010 at 11:38:09AM +0100, Michael Burns wrote:
&gt;<i> Hi Alex,
</I>&gt;<i> I ran the multicast client and am getting speeds like:
</I>&gt;<i> 
</I>&gt;<i> sending rate: 3550 msg/s, basic returns: 0 ret/s
</I>&gt;<i> recving rate: 3461 msg/s, min/avg/max latency: 11931197/12253891/12477030
</I>&gt;<i> microseconds
</I>&gt;<i> 
</I>&gt;<i> If I let it run for a bit then sometimes both the sending and receiving rate
</I>&gt;<i> drop significantly e.g.:
</I>&gt;<i> 
</I>&gt;<i> sending rate: 638 msg/s, basic returns: 0 ret/s
</I>&gt;<i> recving rate: 628 msg/s, min/avg/max latency: 11788406/12363242/12735553
</I>&gt;<i> microseconds
</I>&gt;<i> 
</I>&gt;<i> Not sure if this drop is indicative of anything?
</I>&gt;<i> 
</I>&gt;<i> We're using the java client 1.8.1, the broker is rabbitmq_server-1.8.1
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> Michael
</I>&gt;<i> 
</I>&gt;<i> On Fri, Sep 3, 2010 at 9:29 AM, Alexandru Scvor&#355;ov
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexandru at rabbitmq.com</A>&gt;wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Hi Michael,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; We are putting a very low volume of messages through and have sometimes
</I>&gt;<i> &gt; had
</I>&gt;<i> &gt; &gt; to wait up to 15 minutes for a single message to be delivered (at the
</I>&gt;<i> &gt; time
</I>&gt;<i> &gt; &gt; this was the only message in the system).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That sounds strage.  Are you up for a bit of debugging?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Download the java client,
</I>&gt;<i> &gt;  <A HREF="http://www.rabbitmq.com/java-client.html">http://www.rabbitmq.com/java-client.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Unpack it, and run
</I>&gt;<i> &gt;  sh runjava.sh com.rabbitmq.examples.MulticastMain -x 1 -y 1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That command will run one of our example programmes in a way that
</I>&gt;<i> &gt; matches your setup: 1 producer (-x 1) and 1 consumer (-y 1).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When I run it, I get speeds like:
</I>&gt;<i> &gt;  recving rate: 6052 msg/s, min/avg/max latency: 1063522/1118048/1164637
</I>&gt;<i> &gt; microseconds
</I>&gt;<i> &gt;  sending rate: 6419 msg/s, basic returns: 0 ret/s
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If you're getting similar speeds, there's probably something wrong with
</I>&gt;<i> &gt; the consumers/producers.  If not, it might be something to do with the
</I>&gt;<i> &gt; server.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Could you please try it?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Also, which version the broker and which client are you using?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Cheers,
</I>&gt;<i> &gt; Alex
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Fri, Sep 03, 2010 at 09:03:25AM +0100, Michael Burns wrote:
</I>&gt;<i> &gt; &gt; Hi,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; We're just starting out with RabbitMQ and have a very simple setup: one
</I>&gt;<i> &gt; &gt; queue, one producer doing a basicPublish and one consumer doing a
</I>&gt;<i> &gt; &gt; basicConsume using QueueingConsumer.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; For the most part it works fine however at fairly regular intervals we
</I>&gt;<i> &gt; are
</I>&gt;<i> &gt; &gt; finding that messages remain on the queue for a considerable period
</I>&gt;<i> &gt; before
</I>&gt;<i> &gt; &gt; being delivered to the consumer.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; We are putting a very low volume of messages through and have sometimes
</I>&gt;<i> &gt; had
</I>&gt;<i> &gt; &gt; to wait up to 15 minutes for a single message to be delivered (at the
</I>&gt;<i> &gt; time
</I>&gt;<i> &gt; &gt; this was the only message in the system).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; In all cases the messages are eventually delivered.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I dont know where to start debugging this as there is nothing in the
</I>&gt;<i> &gt; &gt; RabbitMQ logs thats suggests something is going wrong - could anyone
</I>&gt;<i> &gt; point
</I>&gt;<i> &gt; &gt; me in the right direction as to what may be causing this?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Many Thanks,
</I>&gt;<i> &gt; &gt; Michael
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I></PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008793.html">[rabbitmq-discuss] Delay delivering messages
</A></li>
	<LI>Next message: <A HREF="008807.html">[rabbitmq-discuss] Delay delivering messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8796">[ date ]</a>
              <a href="thread.html#8796">[ thread ]</a>
              <a href="subject.html#8796">[ subject ]</a>
              <a href="author.html#8796">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
