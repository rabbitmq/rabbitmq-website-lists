<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 2.0 hanging
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.0%20hanging&In-Reply-To=%3CAANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP%2B7Suy%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008913.html">
   <LINK REL="Next"  HREF="008915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 2.0 hanging</H1>
    <B>Cal Leeming [Simplicity Media Ltd]</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%202.0%20hanging&In-Reply-To=%3CAANLkTimqDWgZVD0t_LNk6RnpqgAa9oLSQwUt_cP%2B7Suy%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ 2.0 hanging">cal.leeming at simplicitymedialtd.co.uk
       </A><BR>
    <I>Tue Sep 14 20:15:37 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008913.html">[rabbitmq-discuss] RabbitMQ 2.0 hanging
</A></li>
        <LI>Next message: <A HREF="008915.html">[rabbitmq-discuss] RabbitMQ 2.0 hanging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8914">[ date ]</a>
              <a href="thread.html#8914">[ thread ]</a>
              <a href="subject.html#8914">[ subject ]</a>
              <a href="author.html#8914">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just a quick thing, but I have also noticed this behaviour on both 1.8 and
2.0, when being used with Celery.

I don't know why it happens, the error log shows nothing has gone wrong....

In the end I had to abandon RabbitMQ because of this :/

On Tue, Sep 14, 2010 at 8:13 PM, Noah Fontes &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">nfontes at cynigram.com</A>&gt; wrote:

&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> Hello Dave,
</I>&gt;<i>
</I>&gt;<i> On 09/14/2010 10:11 AM, Dave Greggory wrote:
</I>&gt;<i> &gt; So it happened again this morning.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; rabbitmqctl status, list_connections and list_exchanges worked, but
</I>&gt;<i> list_queues
</I>&gt;<i> &gt; and list_channels hung.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This time there were no errors in the log, unlike the last time. This has
</I>&gt;<i> been
</I>&gt;<i> &gt; quite common, that when it happens there's nothing in the logs. That's
</I>&gt;<i> why I
</I>&gt;<i> &gt; didn't report it any earlier. Very mysterious.
</I>&gt;<i>
</I>&gt;<i> This is quite interesting. We observed this behavior as well --
</I>&gt;<i> list_queues and list_channels hanging. This was also reflected in
</I>&gt;<i> consumers/publishers: we could publish messages fine, but trying to read
</I>&gt;<i> from a queue (or even delete one) would hang usually indefinitely.
</I>&gt;<i>
</I>&gt;<i> We also noted that if we repeatedly attempted to run list_queues the RPC
</I>&gt;<i> call would eventually succeed -- maybe once out of 10 or 15 runs. With
</I>&gt;<i> the exception of certain queues building up with messages (as I
</I>&gt;<i> mentioned above) everything looked fine.
</I>&gt;<i>
</I>&gt;<i> It started when we switched from 1.7.x to 1.8.x (which we're still
</I>&gt;<i> running for the moment). It only seems to happen when nodes are
</I>&gt;<i> clustered; I've never seen the problem on a non-clustered instance.
</I>&gt;<i>
</I>&gt;<i> I'll try to grab some more information when/if it happens again for us.
</I>&gt;<i>
</I>&gt;<i> I also haven't seen the issue occur in probably about 3 weeks now. It's
</I>&gt;<i> very sporadic, although I think I've seen it happen more than once in a
</I>&gt;<i> day (and then not again for a long time).
</I>&gt;<i>
</I>&gt;<i> &gt; I have attached the output of status, list_connections, dmesg, and lsof
</I>&gt;<i> from
</I>&gt;<i> &gt; both rabbitmq nodes in the cluster.
</I>&gt;<i>
</I>&gt;<i> FWIW, here's the minimal information I can offer now:
</I>&gt;<i>
</I>&gt;<i> - - We have a four-node cluster of two disk nodes and two memory nodes
</I>&gt;<i> across two physical servers.
</I>&gt;<i> - - We're running RabbitMQ 1.8.1 with no additional plugins:
</I>&gt;<i> {rabbit,&quot;RabbitMQ&quot;,&quot;1.8.1&quot;},
</I>&gt;<i> {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.4.13&quot;},
</I>&gt;<i> {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.5&quot;},
</I>&gt;<i> {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.9&quot;},
</I>&gt;<i> {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.16.5&quot;},
</I>&gt;<i> {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.13.5&quot;}
</I>&gt;<i>
</I>&gt;<i> This is erlang R13B04 on SuSE Linux.
</I>&gt;<i>
</I>&gt;<i> Hopefully this can shed a *little* more light on the problem. Sorry I
</I>&gt;<i> can't offer more details at the moment.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Noah
</I>&gt;<i>
</I>&gt;<i> &gt; ----- Original Message ----
</I>&gt;<i> &gt; From: Dave Greggory &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">davegreggory at yahoo.com</A>&gt;
</I>&gt;<i> &gt; To: Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; Sent: Mon, September 13, 2010 11:48:44 AM
</I>&gt;<i> &gt; Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Wow... ok.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'll grab lsof / dmesg / syslog output next time this happens.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks for looking into it. Much appreciated.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----- Original Message ----
</I>&gt;<i> &gt; From: Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt;
</I>&gt;<i> &gt; To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; Sent: Mon, September 13, 2010 10:53:24 AM
</I>&gt;<i> &gt; Subject: Re: [rabbitmq-discuss] RabbitMQ 2.0 hanging
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hi Dave,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sorry for the delay in getting back to you.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Your node1 log had this in it:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; =ERROR REPORT==== 8-Sep-2010::09:45:43 ===
</I>&gt;<i> &gt; ** Generic server &lt;0.29.0&gt; terminating
</I>&gt;<i> &gt; ** Last message in was {'EXIT',&lt;0.30.0&gt;,eio}
</I>&gt;<i> &gt; ** When Server state == {state,user_sup,undefined,&lt;0.30.0&gt;,
</I>&gt;<i> &gt;                                {&lt;0.29.0&gt;,user_sup}}
</I>&gt;<i> &gt; ** Reason for termination ==
</I>&gt;<i> &gt; ** eio
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This is utterly bizarre - we've never seen it before and it was
</I>&gt;<i> &gt; certainly enough to take down the node1 or at least hang it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; node2 log has:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; =ERROR REPORT==== 8-Sep-2010::09:41:38 ===
</I>&gt;<i> &gt; ** Generic server delegate_process_0 terminating
</I>&gt;<i> &gt; ** Last message in was {'$gen_cast',{thunk,#Fun&lt;delegate.4.123807736&gt;}}
</I>&gt;<i> &gt; ** When Server state == no_state
</I>&gt;<i> &gt; ** Reason for termination ==
</I>&gt;<i> &gt; ** {noproc,{gen_server2,call,
</I>&gt;<i> &gt;                         [{delegate_process_1,'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ent-jms-qa-1</A>'},
</I>&gt;<i> &gt;                          {thunk,#Fun&lt;delegate.5.131821234&gt;},
</I>&gt;<i> &gt;                          infinity]}}
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This is basically node2 finding that node1 has gone down. This suggests
</I>&gt;<i> &gt; (as does your timeline) that node1 actually failed some time previously
</I>&gt;<i> &gt; but that the immediate error was not logged and only at some later point
</I>&gt;<i> &gt; did a very generic &quot;eio&quot; come out of it - literally error in some form
</I>&gt;<i> &gt; of IO operation.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Now the eio comes out of process &lt;0.30.0&gt; which is a process which is
</I>&gt;<i> &gt; started very early on in the Erlang VM boot process. I can't quite tell
</I>&gt;<i> &gt; what the user_sup process is meant to be doing - it's so far buried that
</I>&gt;<i> &gt; there's no documentation for it. It's quite possible you've found a bug
</I>&gt;<i> &gt; in Erlang itself. Even having googled around for a while, I still can't
</I>&gt;<i> &gt; really find out what &quot;user&quot; is for - the best I can find is:
</I>&gt;<i> &gt; &quot;user is a server which responds to all the messages defined in the I/O
</I>&gt;<i> &gt; interface. The code in user.erl can be used as a model for building
</I>&gt;<i> &gt; alternative I/O servers.&quot; so that's nice and clear. Anyway, my guess is
</I>&gt;<i> &gt; some error came out of said I/O server, took out user and user_sup which
</I>&gt;<i> &gt; was then logged. But as to what the fault actually was, I'm afraid I
</I>&gt;<i> &gt; have no idea.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When this next happens, any chance you could check things like number of
</I>&gt;<i> &gt; open file descriptors, see if there's any kernel log messages relevant
</I>&gt;<i> &gt; etc? Sorry I can't be more helpful - it's just not something we've ever
</I>&gt;<i> &gt; come across before.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Matthew
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v1.4.10 (GNU/Linux)
</I>&gt;<i>
</I>&gt;<i> iEYEARECAAYFAkyPyWEACgkQhitK+HuUQJRLpwCgnYY/YF8xTUW8xowocWKKPzbJ
</I>&gt;<i> BzUAn1aRtruRAgp/23v4mZB1JJXrBIaE
</I>&gt;<i> =CEzP
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>


-- 

Cal Leeming

Operational Security &amp; Support Team

*Out of Hours: *+44 (07534) 971120 | *Support Tickets: *
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">support at simplicitymedialtd.co.uk</A>
*Fax: *+44 (02476) 578987 | *Email: *<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cal.leeming at simplicitymedialtd.co.uk</A>
*IM: *AIM / ICQ / MSN / Skype (available upon request)
Simplicity Media Ltd. All rights reserved.
Registered company number 7143564
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/481c998f/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100914/481c998f/attachment-0001.htm</A>&gt;
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008913.html">[rabbitmq-discuss] RabbitMQ 2.0 hanging
</A></li>
	<LI>Next message: <A HREF="008915.html">[rabbitmq-discuss] RabbitMQ 2.0 hanging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8914">[ date ]</a>
              <a href="thread.html#8914">[ thread ]</a>
              <a href="subject.html#8914">[ subject ]</a>
              <a href="author.html#8914">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
