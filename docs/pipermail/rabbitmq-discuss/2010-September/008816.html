<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Am I using Queues Correctly?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Am%20I%20using%20Queues%20Correctly%3F&In-Reply-To=%3C20100906191823.GD2329%40dakota%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008815.html">
   <LINK REL="Next"  HREF="008824.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Am I using Queues Correctly?</H1>
    <B>Alexandru Scvortov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Am%20I%20using%20Queues%20Correctly%3F&In-Reply-To=%3C20100906191823.GD2329%40dakota%3E"
       TITLE="[rabbitmq-discuss] Am I using Queues Correctly?">alexandru at rabbitmq.com
       </A><BR>
    <I>Mon Sep  6 20:18:23 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008815.html">[rabbitmq-discuss] Am I using Queues Correctly?
</A></li>
        <LI>Next message: <A HREF="008824.html">[rabbitmq-discuss] Management plugin preview release
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8816">[ date ]</a>
              <a href="thread.html#8816">[ thread ]</a>
              <a href="subject.html#8816">[ subject ]</a>
              <a href="author.html#8816">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To clarify a point, when a message is consumed with no-ack disabled, it
is taken off the queue (in the sense that no other consumer will receive
it), but if the consumer dies without ack'ing it, the message will get
re-inserted into the queue and will be delivered to another consumer.

On Mon, Sep 06, 2010 at 08:01:26PM +0100, Alexandru Scvor&#355;ov wrote:
&gt;<i> &gt; When I receive a message from a queue does that remove it from the queue or
</I>&gt;<i> &gt; just mark is as read?
</I>&gt;<i> 
</I>&gt;<i> It depends.  When you basic.get or basic.consume a message from the
</I>&gt;<i> queue, you have to say whether you do it in no-ack mode or not.  If
</I>&gt;<i> you enable no-ack, ``there no need to acknowledge the messages'', so
</I>&gt;<i> consuming it also dequeues it.  If you set no-ack to false, consuming
</I>&gt;<i> the message just marks it as delivered; it's not dequeued until you
</I>&gt;<i> explicitly basic.ack it; if the consumers dies before ack'ing, the
</I>&gt;<i> message is re-inserted into the queue.
</I>&gt;<i> 
</I>&gt;<i> &gt; Do messages get automatically stored to disk or do I
</I>&gt;<i> &gt; need to explicitly turn that on?
</I>&gt;<i> 
</I>&gt;<i> It depends on what you mean by ``stored to disk''.
</I>&gt;<i> 
</I>&gt;<i> As of 2.0.0, all messages may be persisted to disk.  That means that any
</I>&gt;<i> message may get written to disk (RabbitMQ tends to do this if it's
</I>&gt;<i> running low on memory).
</I>&gt;<i> 
</I>&gt;<i> Completely orthogonal to this, messages may be transient or persistent.
</I>&gt;<i> No guarantees are made about transient messages.  Persistent messages
</I>&gt;<i> that end up on durable queues are supposed to survive a broker restart;
</I>&gt;<i> this means that they tend to get written to disk fairly quickly and
</I>&gt;<i> are recovered on startup.  You choose whether a queue is durable or not
</I>&gt;<i> when you declare it.  You choose whether a message is persistent or not
</I>&gt;<i> when you publish it.
</I>&gt;<i> 
</I>&gt;<i> Still, you can lose persistent messages (if the broker dies before it
</I>&gt;<i> has had a chance to sync the disk buffers).  Currently, the only way to
</I>&gt;<i> ensure that messages are never lost is to set the channel to
</I>&gt;<i> transactional mode (tx.select) and do a commit after every message.  If
</I>&gt;<i> the commit succeeds, the message has been published successfully.
</I>&gt;<i> 
</I>&gt;<i> Hope this clears things up.
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> Alex
</I>&gt;<i> 
</I>&gt;<i> On Mon, Sep 06, 2010 at 07:06:45PM +0100, Tom Martin wrote:
</I>&gt;<i> &gt; Thanks for your recommendations, I'll take a look at the topic exchange but
</I>&gt;<i> &gt; if what I've proposed sounds ok then I'll leave it as that.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; When I receive a message from a queue does that remove it from the queue or
</I>&gt;<i> &gt; just mark is as read? Do messages get automatically stored to disk or do I
</I>&gt;<i> &gt; need to explicitly turn that on?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks again.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On 6 September 2010 14:41, Vlad Alexandru Ionescu &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vlad at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Apart from the mentioned 'direct' and 'topic' exchange types, there is also
</I>&gt;<i> &gt; &gt; the 'headers' exchange (match on a number of attributes that you specify).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Rgds,
</I>&gt;<i> &gt; &gt; Vlad.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 09/06/2010 02:38 PM, Alexandru Scvor&#355;ov wrote:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;&gt; Hi,
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; There's nothing inherently wrong with what you describe.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; Depending on what you filter on, you could make it simpler.  If you
</I>&gt;<i> &gt; &gt;&gt; filter on a message name/id or something like that, you could probably
</I>&gt;<i> &gt; &gt;&gt; just bind the filtered queue to a direct exchange (match on the routing
</I>&gt;<i> &gt; &gt;&gt; key) or a topic exchange (match on something like a regexp).
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; If you're filtering rules are more complicated or if they involve
</I>&gt;<i> &gt; &gt;&gt; inspecting the message content, what you're doing is probably the way
</I>&gt;<i> &gt; &gt;&gt; to go.  You could also write a custom exchange type as a plugin.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; Cheers,
</I>&gt;<i> &gt; &gt;&gt; Alex
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; On Mon, Sep 06, 2010 at 02:03:44PM +0100, Tom Martin wrote:
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Hi,
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; I'm building a system which takes incoming messages, filters them and
</I>&gt;<i> &gt; &gt;&gt;&gt; stores
</I>&gt;<i> &gt; &gt;&gt;&gt; them to DB. I have each of these three bits running as separate ruby
</I>&gt;<i> &gt; &gt;&gt;&gt; processes, if the filter or database saving processes die then when they
</I>&gt;<i> &gt; &gt;&gt;&gt; come back, new messages are waiting in the queue.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; I've implemented this using two separate queues: an incoming queue and
</I>&gt;<i> &gt; &gt;&gt;&gt; a filtered queue. The filtering process just takes the incoming queue,
</I>&gt;<i> &gt; &gt;&gt;&gt; does
</I>&gt;<i> &gt; &gt;&gt;&gt; it's business and inserts it into the filtered queue. The DB storing
</I>&gt;<i> &gt; &gt;&gt;&gt; process
</I>&gt;<i> &gt; &gt;&gt;&gt; takes the filtered queue and stores them to DB.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; I'm very new to RabbitMQ, is this kind of flow correct, creating two
</I>&gt;<i> &gt; &gt;&gt;&gt; different queues? or is there a better way to do it using Exchanges or
</I>&gt;<i> &gt; &gt;&gt;&gt; some
</I>&gt;<i> &gt; &gt;&gt;&gt; other part of RabbitMQ?
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt; &gt;&gt;&gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; &gt;&gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; &gt;&gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; _______________________________________________
</I>&gt;<i> &gt; &gt;&gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; -- 
</I>&gt;<i> &gt; Tom Martin
</I>&gt;<i> &gt; devart.org
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008815.html">[rabbitmq-discuss] Am I using Queues Correctly?
</A></li>
	<LI>Next message: <A HREF="008824.html">[rabbitmq-discuss] Management plugin preview release
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8816">[ date ]</a>
              <a href="thread.html#8816">[ thread ]</a>
              <a href="subject.html#8816">[ subject ]</a>
              <a href="author.html#8816">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
