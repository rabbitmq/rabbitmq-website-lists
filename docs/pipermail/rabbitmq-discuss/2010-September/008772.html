<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Active/active HA setup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active/active%20HA%20setup&In-Reply-To=%3C20100903091236.19695rzrv2yog5k4%40webmail.active24.cz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008768.html">
   <LINK REL="Next"  HREF="008774.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Active/active HA setup</H1>
    <B>jiri at krutil.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active/active%20HA%20setup&In-Reply-To=%3C20100903091236.19695rzrv2yog5k4%40webmail.active24.cz%3E"
       TITLE="[rabbitmq-discuss] Active/active HA setup">jiri at krutil.com
       </A><BR>
    <I>Fri Sep  3 08:12:36 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008768.html">[rabbitmq-discuss] Active/active HA setup
</A></li>
        <LI>Next message: <A HREF="008774.html">[rabbitmq-discuss] Active/active HA setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8772">[ date ]</a>
              <a href="thread.html#8772">[ thread ]</a>
              <a href="subject.html#8772">[ subject ]</a>
              <a href="author.html#8772">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alexis

The answer is no - a client can send requests to only one broker at  
any given moment. The client connects via load balancer to one of the  
brokers and stays connected all the time. The client does not even  
know that there are two brokers (it only sees one IP address).

I think requests may be delivered out of order only if a client fails  
over to another broker. Then messages send to one broker can get mixed  
up with messages sent to the other.

My concern was: are there any other issues with this kind of setup  
that I might have missed? Does anyone have experience with this?

Thanks a lot for your help
Jiri



&gt;<i> Jiri
</I>&gt;<i>
</I>&gt;<i> You say that &quot;Some clients send requests to one broker, some to the other&quot;.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Does this mean that one client publisher can send messages (requests) to
</I>&gt;<i> both brokers, in such a way that a pair of messages may arrive out of order
</I>&gt;<i> if one is sent to each broker?
</I>&gt;<i>
</I>&gt;<i> If the answer is no, then I think my answer stands, because causal order
</I>&gt;<i> will be preserved even if messages are lost.  That is: messages that arrive
</I>&gt;<i> successfully, will not be out of order with each other.
</I>&gt;<i>
</I>&gt;<i> If the answer is yes, then I am not sure how you can recover global ordering
</I>&gt;<i> without imposing it at the publisher using sequence numbers at the app
</I>&gt;<i> level.
</I>&gt;<i>
</I>&gt;<i> Does this make sense?
</I>&gt;<i>
</I>&gt;<i> alexis
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Sep 2, 2010 at 9:46 PM, Jiri Krutil &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jiri at krutil.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Alexis
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sorry I probably didn't express myself well.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We don't plan a primary and secondary broker, but a pair of brokers that
</I>&gt;&gt;<i> are both active at the same time. A load balancer divides client connections
</I>&gt;&gt;<i> to these brokers. A request queue with the same name exists on both brokers,
</I>&gt;&gt;<i> but with different contents. Some clients send requests to one broker, some
</I>&gt;&gt;<i> to the other. Our back-end server listens to both queues, processes requests
</I>&gt;&gt;<i> and sends each response to an exclusive client queue on the broker from
</I>&gt;&gt;<i> where the request came.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ideally this would be transparent to the clients, because the brokers would
</I>&gt;&gt;<i> be hidden by a virtual IP address. Of course it can't be transparent to the
</I>&gt;&gt;<i> back-end server, which needs to talk to both brokers at the same time.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So (a) is correct, but (b) not.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hope that makes it a bit clearer...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers
</I>&gt;&gt;<i> Jiri
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Jiri
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> That answered my questions.  Now, as I understood your example:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> a. you don't mind messages being lost
</I>&gt;&gt;&gt;<i> *and*
</I>&gt;&gt;&gt;<i> b. you don't use the secondary until after the primary has failed.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Note that if consumption is completely 'fire and forget' then it is
</I>&gt;&gt;&gt;<i> possible that a message from the primary may *arrive* after a message from
</I>&gt;&gt;&gt;<i> the secondary.  But this can happen whether you use sequence  
</I>&gt;&gt;&gt;<i> numbers or not.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So if the primary broker fails, why not just forget all undelivered
</I>&gt;&gt;&gt;<i> messages?  Consumers will know that any message consumed from the secondary
</I>&gt;&gt;&gt;<i> must be later in *all* orderings than any message consumed from  
</I>&gt;&gt;&gt;<i> the primary.
</I>&gt;&gt;&gt;<i>  So, additional sequence numbering is not necessary.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> alexis
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>


</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008768.html">[rabbitmq-discuss] Active/active HA setup
</A></li>
	<LI>Next message: <A HREF="008774.html">[rabbitmq-discuss] Active/active HA setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8772">[ date ]</a>
              <a href="thread.html#8772">[ thread ]</a>
              <a href="subject.html#8772">[ subject ]</a>
              <a href="author.html#8772">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
