<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Shutdown Listener on Java Client API
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shutdown%20Listener%20on%20Java%20Client%20API&In-Reply-To=%3C847412.22324.qm%40web111008.mail.gq1.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008924.html">
   <LINK REL="Next"  HREF="009146.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Shutdown Listener on Java Client API</H1>
    <B>Dave Greggory</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shutdown%20Listener%20on%20Java%20Client%20API&In-Reply-To=%3C847412.22324.qm%40web111008.mail.gq1.yahoo.com%3E"
       TITLE="[rabbitmq-discuss] Shutdown Listener on Java Client API">davegreggory at yahoo.com
       </A><BR>
    <I>Tue Sep 28 20:29:47 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008924.html">[rabbitmq-discuss] Shutdown Listener on Java Client API
</A></li>
        <LI>Next message: <A HREF="009146.html">[rabbitmq-discuss] Shutdown Listener on Java Client API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9145">[ date ]</a>
              <a href="thread.html#9145">[ thread ]</a>
              <a href="subject.html#9145">[ subject ]</a>
              <a href="author.html#9145">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We had something similar happen again last night. For some reason, one of our 
producers lost the connection to RabbitMQ at 7:47 PM but the shutDownCompleted 
event did not fire on that producer till 8:58 PM. We have a separate thread to 
send out messages from our app so that the app is unaffected should it lose 
messaging functionality. Starting at 7:47 PM, this separate thread started 
blocking and we lost all messages sent beyond its internal buffer's capacity. At 
about 8:58 the shutdown event fired, we automatically reconnected and everything 
returned to normal.

Both of our RabbitMQ nodes stayed up the whole time. No errors or VM HIGH 
WATERMARK events in the logs. This is on RabbitMQ 1.8.1 in our production 
environment. This is a very low volume environment, RabbitMQ nodes were only 
using about 30 MB of the 993 MB it allocated itself. No CPU / Memory / Disk 
spikes.

Any thoughts? Is there something in the java client api that could prevent the 
shutdownEvent from firing quickly? AMQP Heartbeats were mentioned in another 
thread, would that help and how do we enable these?



----- Original Message ----
From: Vlad Alexandru Ionescu &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vlad at rabbitmq.com</A>&gt;
To: Dave Greggory &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">davegreggory at yahoo.com</A>&gt;
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Sent: Wed, September 15, 2010 7:51:27 AM
Subject: Re: [rabbitmq-discuss] Shutdown Listener on Java Client API


Hi Dave,

AFAIK, the event should fire regardless of the shutdown reason (be it 
connection loss, server initiated connection close, sudden socket 
closed, heartbeat timeout etc.). It appears to me that you are using it 
correctly.

Depending on the type of load balancer you are using, perhaps the 
clients never got disconnected? It is also possible that there is a bug 
in the client code.

Rgds,
Vlad.


On 09/13/2010 04:12 PM, Dave Greggory wrote:
&gt;<i> We register a shutdown listener to listen for connection-loss events and
</I>&gt;<i> automatically re-connect clients to other RabbitMQ nodes in the cluster. This
</I>&gt;<i> weekend we had to restart the load balancer that sits between rabbitmq and 
</I>it's
&gt;<i> clients for some maintenance, but the 
</I>ShutdownCompleted/ShutdownSignalException
&gt;<i> event never fired in the clients.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm trying to understand how the shutdown signal works. Does it only fire the
</I>&gt;<i> ShutDownCompleted event if RabbitMQ node shuts down and sends the signal back 
</I>&gt;<i>to
</I>&gt;<i> clients? If that's the case, I'm probably misusing it to detect 
</I>&gt;<i>connection-loss.
</I>&gt;<i> Is there a different way of detecting connection loss?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Dave
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>    
</I>


      
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008924.html">[rabbitmq-discuss] Shutdown Listener on Java Client API
</A></li>
	<LI>Next message: <A HREF="009146.html">[rabbitmq-discuss] Shutdown Listener on Java Client API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9145">[ date ]</a>
              <a href="thread.html#9145">[ thread ]</a>
              <a href="subject.html#9145">[ subject ]</a>
              <a href="author.html#9145">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
