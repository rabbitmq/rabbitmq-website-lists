<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Erlang crashes reports
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Erlang%20crashes%20reports&In-Reply-To=%3CC80EC0C9-61F5-408F-85E8-2B766C47C6D3%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008954.html">
   <LINK REL="Next"  HREF="008960.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Erlang crashes reports</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Erlang%20crashes%20reports&In-Reply-To=%3CC80EC0C9-61F5-408F-85E8-2B766C47C6D3%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] Erlang crashes reports">videlalvaro at gmail.com
       </A><BR>
    <I>Thu Sep 16 10:37:37 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008954.html">[rabbitmq-discuss] Erlang crashes reports
</A></li>
        <LI>Next message: <A HREF="008960.html">[rabbitmq-discuss] Erlang crashes reports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8955">[ date ]</a>
              <a href="thread.html#8955">[ thread ]</a>
              <a href="subject.html#8955">[ subject ]</a>
              <a href="author.html#8955">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What about the number of erlang processes?

We had a problem of RabbitMQ crashing due to too many processes. The problem was that our library was creating thousand of channels per PHP process and that was bad as in really bad.

Regards,

Alvaro

On Sep 16, 2010, at 5:32 PM, Romary Kremer wrote:

&gt;<i> We are performing evaluation on rabbitmq message broker, and we currently encounter difficulties with release 2.0.0:
</I>&gt;<i> 
</I>&gt;<i> - Our application implies 10 000 peers producing messages periodically to a unique queue. This queue is listen asynchronously by another peer.
</I>&gt;<i> - All peer are written in Java.
</I>&gt;<i> - The production rate of a single peer is 4 messages / hour.
</I>&gt;<i> - We can simulate a time-consuming task in the consumer callback, simulating more or less fast consumer.
</I>&gt;<i> - we are using SSL certificate on the broker side to allow the peer to authenticate the broker.
</I>&gt;<i> 	- we have noticed that the use of SSL as dramatic incidence on the memory occupied by Rabbitmq process
</I>&gt;<i> 
</I>&gt;<i> Since we upgraded to version 2.0.0, we are no longer able to make a test scenario running. The symptoms are listed bellow :
</I>&gt;<i> 
</I>&gt;<i> on the broker console first, we get the message :
</I>&gt;<i> 
</I>&gt;<i> Erlang has closed
</I>&gt;<i> Error: unable to connect to node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at murphys</A>: nodedown
</I>&gt;<i> diagnostics:
</I>&gt;<i> - nodes and their ports on murphys: [{rabbitmqctl22609,42767}]
</I>&gt;<i> - current node: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl22609 at murphys</A>
</I>&gt;<i> - current node home dir: /var/lib/rabbitmq
</I>&gt;<i> - current node cookie hash: qu0gh1hg7j7LKyzK0GLk+A==
</I>&gt;<i> 
</I>&gt;<i> we have kept the erl_crash.dump in case, but since i's about 200 MB  I cannot do nothing to send it to you.
</I>&gt;<i> Maybe some one can give us some hints or some indicators to look out in the dump to help diagnostics, but we are not Erlang fluent !
</I>&gt;<i> 
</I>&gt;<i> What we know for sure is that the crash happens while the 10 000 connections are established, at the beginning of the test. 
</I>&gt;<i> We have monitored the  number of connections established and the crashes happens always around 4500 - 5000 connections, but never the same exact number. 
</I>&gt;<i> We also tried with and without SSL but this does not help at all (same symptoms).
</I>&gt;<i> 
</I>&gt;<i> On the client side, our application registers a ShutdownListener to implement a connection retry logic upon shutdown. 
</I>&gt;<i> The retries always failed with the error : connection refused.
</I>&gt;<i> 
</I>&gt;<i> here are some figures we gathered during the test start up about the maximum number of connection established before it crashes 
</I>&gt;<i> 
</I>&gt;<i> - with SSL : 5404, 4493, 4399
</I>&gt;<i> 
</I>&gt;<i> - without SSL : 4673
</I>&gt;<i> 			
</I>&gt;<i> we dont think that the problem is about file descriptors since we haven't changed anything in the configuration when we upgraded to 2.0.0.
</I>&gt;<i> The same test used to run successfully on previous version of the broker (1.7.2, and 1.8.1).
</I>&gt;<i> Moreover, the rabbit_status plugin tells us we have enough file descriptors as well as erlang processes
</I>&gt;<i> 	- file descriptors (used / available)= 34 / 65535
</I>&gt;<i> 	- elrang processes (used / available)= 160 / 1 000 000
</I>&gt;<i> 	- memory (used / available)= 40 MB / 1609 MB
</I>&gt;<i> 
</I>&gt;<i> We haven't try the 2.1.0 yet because we would like to have your feedback about this issue before.
</I>&gt;<i> 
</I>&gt;<i> We would appreciate your feedbacks on that point before we migrate to release 2.1.0.
</I>&gt;<i> 
</I>&gt;<i> Best regards,
</I>&gt;<i> 
</I>&gt;<i> Romary.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/37a5df10/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100916/37a5df10/attachment.htm</A>&gt;
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008954.html">[rabbitmq-discuss] Erlang crashes reports
</A></li>
	<LI>Next message: <A HREF="008960.html">[rabbitmq-discuss] Erlang crashes reports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8955">[ date ]</a>
              <a href="thread.html#8955">[ thread ]</a>
              <a href="subject.html#8955">[ subject ]</a>
              <a href="author.html#8955">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
