<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Erlang has closed?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Erlang%20has%20closed%3F&In-Reply-To=%3CAANLkTimaqx9_MhzjtVa6%2BENg4HeAzy69j2EDScghL7tY%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009141.html">
   <LINK REL="Next"  HREF="009143.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Erlang has closed?</H1>
    <B>Adam Nelson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Erlang%20has%20closed%3F&In-Reply-To=%3CAANLkTimaqx9_MhzjtVa6%2BENg4HeAzy69j2EDScghL7tY%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Erlang has closed?">adam at varud.com
       </A><BR>
    <I>Tue Sep 28 17:10:03 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009141.html">[rabbitmq-discuss] Erlang has closed?
</A></li>
        <LI>Next message: <A HREF="009143.html">[rabbitmq-discuss] channel.flow in pyampqlib (was: Re: Erlang has closed?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9142">[ date ]</a>
              <a href="thread.html#9142">[ thread ]</a>
              <a href="subject.html#9142">[ subject ]</a>
              <a href="author.html#9142">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Brian,

It seems like you should be using Pika - which support channel.flow:

<A HREF="http://github.com/tonyg/pika">http://github.com/tonyg/pika</A>

As for the other issues, it seems like you'll certainly want to use high
memory extra large instances (or larger) for the broker.  You can also use
beefier clients (fewer of them).  I know these are just mitigating
strategies but they seem to make sense for your situation.

-Adam

On Tue, Sep 28, 2010 at 11:42 AM, Brian_Fox &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">genkuro at gmail.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Matthew Sackman wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Wed, May 19, 2010 at 11:06:23AM -0400, Tyler Williams wrote:
</I>&gt;<i> &gt;&gt; =INFO REPORT==== 17-May-2010::14:24:30 ===
</I>&gt;<i> &gt;&gt;     application: rabbit
</I>&gt;<i> &gt;&gt;     exited: {{timeout_waiting_for_tables,[rabbit_disk_queue]},
</I>&gt;<i> &gt;&gt;              {rabbit,start,[normal,[]]}}
</I>&gt;<i> &gt;&gt;     type: temporary
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; =ERROR REPORT==== 17-May-2010::14:24:30 ===
</I>&gt;<i> &gt;&gt; Error in process &lt;0.100.0&gt; on node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at echonest03</A>' with exit
</I>&gt;<i> &gt;&gt; value:
</I>&gt;<i> &gt;&gt; {badarg,[{ets,insert,[rabbit_disk_queue,[{dq_msg_loc,{{resource,&lt;&lt;1
</I>&gt;<i> &gt;&gt; byte&gt;&gt;,queue,&lt;&lt;9 bytes&gt;&gt;},553567},false,true,&lt;&lt;16
</I>&gt;<i> &gt;&gt; bytes&gt;&gt;},{dq_msg_loc,{{resource,&lt;&lt;1 byte&gt;&gt;,queue,&lt;&lt;18
</I>&gt;<i> &gt;&gt; bytes&gt;&gt;},563611},false,true,&lt;&lt;16 bytes&gt;&gt;},{dq_msg_loc,{{resource,&lt;&lt;1
</I>&gt;<i> &gt;&gt; byte&gt;&gt;,queue,&lt;&lt;18 bytes&gt;&gt;},80964},false,true,&lt;&lt;16
</I>&gt;<i> &gt;&gt; bytes&gt;&gt;},{dq_msg_loc,{{resource,&lt;&lt;1 byte&gt;&gt;,queue...
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; =INFO REPORT==== 17-May-2010::14:24:33 ===
</I>&gt;<i> &gt;&gt;     application: mnesia
</I>&gt;<i> &gt;&gt;     exited: stopped
</I>&gt;<i> &gt;&gt;     type: temporary
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; =INFO REPORT==== 17-May-2010::14:24:33 ===
</I>&gt;<i> &gt;&gt;     application: os_mon
</I>&gt;<i> &gt;&gt;     exited: stopped
</I>&gt;<i> &gt;&gt;     type: temporary
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Can you shed any light on this error?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I might have been able to last October when I was writing that code. So
</I>&gt;<i> &gt; much has changed since then that I really can't remember too much about
</I>&gt;<i> &gt; what was going on back then.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Also, pyamqplib does not support channel.flow. Even with the new
</I>&gt;<i> &gt; persister, there are times where rabbit gets overwhelmed (disks just
</I>&gt;<i> &gt; aren't fast enough most of the time) and so needs to temporarily stop
</I>&gt;<i> &gt; publishers. It does this by using channel.flow. Given that pyamqplib
</I>&gt;<i> &gt; doesn't support channel.flow, you are very likely to run into problems.
</I>&gt;<i> &gt; There's a highly experimental patch by Tony (search the mailing list for
</I>&gt;<i> &gt; it) which adds support for channel.flow, but you might also try looking
</I>&gt;<i> &gt; at the other python clients such as txamqp and pika.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Matthew
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> (Sorry to resurrect an older thread)
</I>&gt;<i>
</I>&gt;<i> Has this rabbitmq + pyamqplib problem ever been resolved?
</I>&gt;<i>
</I>&gt;<i> Our group is experimenting with bringing up a massive amount of AMQP
</I>&gt;<i> clients
</I>&gt;<i> using EC2.  And we're running into the same error described above,
</I>&gt;<i> presumably slamming memory on the broker.  It seems like we have a few
</I>&gt;<i> choices: bump up the memory (8GB currently), choose a different library
</I>&gt;<i> with
</I>&gt;<i> flow control, or choose a different strategy to rapidly boot several
</I>&gt;<i> hundred
</I>&gt;<i> clients.  Of the three, the last would be the least attractive option.
</I>&gt;<i>
</I>&gt;<i> Any suggestions on the best alternative lib to avoid this error?  I'm
</I>&gt;<i> hearing mixed things about txAMQP's support of channel flow.
</I>&gt;<i>
</I>&gt;<i> Would clustering help the issue or make it worse?  (we're currently a
</I>&gt;<i> single
</I>&gt;<i> broker on a development platform)
</I>&gt;<i>
</I>&gt;<i> Thanks much,
</I>&gt;<i> Brian
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://old.nabble.com/Erlang-has-closed--tp28600093p29827331.html">http://old.nabble.com/Erlang-has-closed--tp28600093p29827331.html</A>
</I>&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>


-- 
Adam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100928/6b9c652a/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100928/6b9c652a/attachment-0001.htm</A>&gt;
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009141.html">[rabbitmq-discuss] Erlang has closed?
</A></li>
	<LI>Next message: <A HREF="009143.html">[rabbitmq-discuss] channel.flow in pyampqlib (was: Re: Erlang has closed?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9142">[ date ]</a>
              <a href="thread.html#9142">[ thread ]</a>
              <a href="subject.html#9142">[ subject ]</a>
              <a href="author.html#9142">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
