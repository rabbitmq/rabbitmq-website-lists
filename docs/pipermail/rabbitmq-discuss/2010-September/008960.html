<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Erlang crashes reports
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Erlang%20crashes%20reports&In-Reply-To=%3C4C9209BA.7030600%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008955.html">
   <LINK REL="Next"  HREF="008964.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Erlang crashes reports</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Erlang%20crashes%20reports&In-Reply-To=%3C4C9209BA.7030600%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Erlang crashes reports">emile at rabbitmq.com
       </A><BR>
    <I>Thu Sep 16 13:12:42 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008955.html">[rabbitmq-discuss] Erlang crashes reports
</A></li>
        <LI>Next message: <A HREF="008964.html">[rabbitmq-discuss] Erlang crashes reports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8960">[ date ]</a>
              <a href="thread.html#8960">[ thread ]</a>
              <a href="subject.html#8960">[ subject ]</a>
              <a href="author.html#8960">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Romary,

Thanks for this error report. Can you confirm whether the logfile
contained anything relevant before the broker became unavailable? Do you
override any default configuration variables in the broker config file?

If you find memory usage growing with SSL then try using Erlang R14B.
(Also see OTP-8810) What version of Erlang are you currently using?


Regards

Emile





On 16/09/10 10:32, Romary Kremer wrote:
&gt;<i> We are performing evaluation on rabbitmq message broker, and we
</I>&gt;<i> currently encounter difficulties with release 2.0.0:
</I>&gt;<i> 
</I>&gt;<i> - Our application implies 10 000 peers producing messages periodically
</I>&gt;<i> to a unique queue. This queue is listen asynchronously by another peer.
</I>&gt;<i> - All peer are written in Java.
</I>&gt;<i> - The production rate of a single peer is 4 messages / hour.
</I>&gt;<i> - We can simulate a time-consuming task in the consumer callback,
</I>&gt;<i> simulating more or less fast consumer.
</I>&gt;<i> - we are using SSL certificate on the broker side to allow the peer to
</I>&gt;<i> authenticate the broker.
</I>&gt;<i> - we have noticed that the use of SSL as dramatic incidence on the
</I>&gt;<i> memory occupied by Rabbitmq process
</I>&gt;<i> 
</I>&gt;<i> Since we upgraded to version *2.0.0*, we are no longer able to make a
</I>&gt;<i> test scenario running. The symptoms are listed bellow :
</I>&gt;<i> 
</I>&gt;<i> on the broker console first, we get the message :
</I>&gt;<i> 
</I>&gt;<i> Erlang has closed
</I>&gt;<i> Error: unable to connect to node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at murphys</A>: nodedown
</I>&gt;<i> diagnostics:
</I>&gt;<i> - nodes and their ports on murphys: [{rabbitmqctl22609,42767}]
</I>&gt;<i> - current node: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl22609 at murphys</A>
</I>&gt;<i> - current node home dir: /var/lib/rabbitmq
</I>&gt;<i> - current node cookie hash: qu0gh1hg7j7LKyzK0GLk+A==
</I>&gt;<i> 
</I>&gt;<i> we have kept the erl_crash.dump in case, but since i's about 200 MB  I
</I>&gt;<i> cannot do nothing to send it to you.
</I>&gt;<i> Maybe some one can give us some hints or some indicators to look out in
</I>&gt;<i> the dump to help diagnostics, but we are not Erlang fluent !
</I>&gt;<i> 
</I>&gt;<i> What we know for sure is that the crash happens while the 10 000
</I>&gt;<i> connections are established, at the beginning of the test. 
</I>&gt;<i> We have monitored the  number of connections established and the crashes
</I>&gt;<i> happens always around 4500 - 5000 connections, but never the same exact
</I>&gt;<i> number. 
</I>&gt;<i> We also tried with and without SSL but this does not help at all (same
</I>&gt;<i> symptoms).
</I>&gt;<i> 
</I>&gt;<i> On the client side, our application registers a ShutdownListener to
</I>&gt;<i> implement a connection retry logic upon shutdown. 
</I>&gt;<i> The retries always failed with the error : connection refused.
</I>&gt;<i> 
</I>&gt;<i> here are some figures we gathered during the test start up about the
</I>&gt;<i> maximum number of connection established before it crashes 
</I>&gt;<i> 
</I>&gt;<i> - with SSL : 5404, 4493, 4399
</I>&gt;<i> 
</I>&gt;<i> - without SSL : 4673
</I>&gt;<i> we dont think that the problem is about file descriptors since we
</I>&gt;<i> haven't changed anything in the configuration when we upgraded to 2.0.0.
</I>&gt;<i> The same test used to run successfully on previous version of the broker
</I>&gt;<i> (1.7.2, and 1.8.1).
</I>&gt;<i> Moreover, the rabbit_status plugin tells us we have enough file
</I>&gt;<i> descriptors as well as erlang processes
</I>&gt;<i> - file descriptors (used / available)= 34 / 65535
</I>&gt;<i> - elrang processes (used / available)= 160 / 1 000 000
</I>&gt;<i> - memory (used / available)= 40 MB / 1609 MB
</I>&gt;<i> 
</I>&gt;<i> We haven't try the *2.1.0* yet because we would like to have your
</I>&gt;<i> feedback about this issue before.
</I>&gt;<i> 
</I>&gt;<i> We would appreciate your feedbacks on that point before we migrate to
</I>&gt;<i> release 2.1.0.
</I>&gt;<i> 
</I>&gt;<i> Best regards,
</I>&gt;<i> 
</I>&gt;<i> Romary.
</I></PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008955.html">[rabbitmq-discuss] Erlang crashes reports
</A></li>
	<LI>Next message: <A HREF="008964.html">[rabbitmq-discuss] Erlang crashes reports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8960">[ date ]</a>
              <a href="thread.html#8960">[ thread ]</a>
              <a href="subject.html#8960">[ subject ]</a>
              <a href="author.html#8960">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
