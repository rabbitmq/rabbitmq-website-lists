<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Erlang crashes reports
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Erlang%20crashes%20reports&In-Reply-To=%3C4C987702.5000408%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009016.html">
   <LINK REL="Next"  HREF="008968.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Erlang crashes reports</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Erlang%20crashes%20reports&In-Reply-To=%3C4C987702.5000408%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Erlang crashes reports">emile at rabbitmq.com
       </A><BR>
    <I>Tue Sep 21 10:12:34 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009016.html">[rabbitmq-discuss] Erlang crashes reports
</A></li>
        <LI>Next message: <A HREF="008968.html">[rabbitmq-discuss]  How to use Consumer as Producer in rabbitmq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9017">[ date ]</a>
              <a href="thread.html#9017">[ thread ]</a>
              <a href="subject.html#9017">[ subject ]</a>
              <a href="author.html#9017">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Romary,

On 21/09/10 08:03, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">romary.kremer at gmail.com</A> wrote:
&gt;<i> Hi Emile, thanks for the supports and the suggestions.
</I>&gt;<i> Le 17 sept. 10 &#224; 11:11, Emile Joubert a &#233;crit :
</I>&gt;&gt;<i> Hi Romary,
</I>&gt;&gt;<i> On 16/09/10 16:38, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">romary.kremer at gmail.com</A> wrote:
</I>&gt;&gt;&gt;<i> Le 16 sept. 10 &#224; 16:27, Emile Joubert a &#233;crit :
</I>&gt;&gt;&gt;&gt;<i> Hi Romary,
</I>&gt;&gt;&gt;&gt;<i> On 16/09/10 14:54, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">romary.kremer at gmail.com</A> wrote:
</I>
[...]

&gt;&gt;<i> These graphs show that you create the connections at a fast rate. Do you
</I>&gt;&gt;<i> get the same failure if you create connections at a lower rate?
</I>&gt;<i> 
</I>&gt;<i> We have a ramp up scenario to evaluate the kind of thing you're thinking
</I>&gt;<i> of. the same
</I>&gt;<i> crashes occurs the same way about 4000 connections established.
</I>
Ok, thanks for checking this.

&gt;&gt;&gt;&gt;&gt;<i> The memory available raised the threshold before the end of
</I>&gt;&gt;&gt;&gt;&gt;<i> connections
</I>&gt;&gt;&gt;&gt;&gt;<i> of 10 000 peers.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Maybe the average memory occupied by a single, non SSL connection has
</I>&gt;&gt;&gt;&gt;&gt;<i> somehow get bigger between
</I>&gt;&gt;&gt;&gt;&gt;<i> release 1.8.x and 2.x.x ??
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> The data structures have changed from 1.8.1 to 2.0.0, but I don't think
</I>&gt;&gt;&gt;&gt;<i> that is the cause of the problem.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Does anybody has experiment or knows the impact of the new release on
</I>&gt;&gt;&gt;&gt;&gt;<i> the memory occupied by connections ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It is possible that more memory is required per connection, If using a
</I>&gt;&gt;<i> large number of connections caused your RAM budget to be approached in
</I>&gt;&gt;<i> versions prior to 2.0.0 then you may now exceed it.
</I>
I've tried to repeat your test of opening 10000 SSL connections from the
Java client, using rabbit version 2.1.0 and 1.8.1 . The Erlang VM (R14A)
memory consumption was no different: about 1Gb in both cases. The 1Gb
required is just to open the connections, without any queues or
exchanges being declared.

[...]

&gt;<i> We are a bit of worry considering that all the propositions we get to
</I>&gt;<i> fix this issue are
</I>&gt;<i> related to give the broker more memory, while we thought the purpose of
</I>&gt;<i> the 2.x.x
</I>&gt;<i> was to allow the broker to rely more on disk. Moreover, we are wondering
</I>&gt;<i> what have
</I>&gt;<i> caused a connection to be so greedy that we can no longer establish 10
</I>&gt;<i> 000 on the same
</I>&gt;<i> configuration.
</I>
The broker relies more on disk for storing messages. In your case the
persistence layer is less of an issue, because memory consumption is due
to connections rather than messages.

&gt;<i> Since we do not have a 4GB server available to run the same tests, and,
</I>&gt;<i> as we have quite
</I>&gt;<i> short dead line to set up a field test, we are considering to get back
</I>&gt;<i> using the rabbitMQ release 1.8.1,
</I>&gt;<i> with Erlang R14B, hopping that this would be the winning combinaison.
</I>
&gt;<i>From the information you provided so far it appears that insufficient
</I>memory is the most probable cause of the problem. If you are forced to
set the highwater mark above 50% then you probably need more RAM, even
on older version of rabbit.

Some further things you can do to rule out alternative causes is to make
100% sure the rabbit logfile does not contain more information. The
establishment of 10000 connections will generate alot of entries which
you need to filter out. Is there anything that remains? You should also
check the OS log for entries around the time of the problem.

If a erl_crash.dump file was produced then it may be worth inspecting
with the crashdump_viewer (part of start_webtool), although I seldom
find this information to be of value.


Regards

-Emile
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009016.html">[rabbitmq-discuss] Erlang crashes reports
</A></li>
	<LI>Next message: <A HREF="008968.html">[rabbitmq-discuss]  How to use Consumer as Producer in rabbitmq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9017">[ date ]</a>
              <a href="thread.html#9017">[ thread ]</a>
              <a href="subject.html#9017">[ subject ]</a>
              <a href="author.html#9017">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
