<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Delay delivering messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Delay%20delivering%20messages&In-Reply-To=%3C4C9385B0.2040109%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008975.html">
   <LINK REL="Next"  HREF="008977.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Delay delivering messages</H1>
    <B>Vlad Alexandru Ionescu</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Delay%20delivering%20messages&In-Reply-To=%3C4C9385B0.2040109%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Delay delivering messages">vlad at rabbitmq.com
       </A><BR>
    <I>Fri Sep 17 16:13:52 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="008975.html">[rabbitmq-discuss] Delay delivering messages
</A></li>
        <LI>Next message: <A HREF="008977.html">[rabbitmq-discuss] Delay delivering messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8976">[ date ]</a>
              <a href="thread.html#8976">[ thread ]</a>
              <a href="subject.html#8976">[ subject ]</a>
              <a href="author.html#8976">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Michael,


So I understand that it is the consumer's connection that was hanging in 
there.

I tried to reproduce your problem yesterday (killing off both consumer 
and producer apps), with no success.
What version of Java are you using?

By not having been shutdown cleanly... could it be possible, in your 
case, that the client has been disconnected from the network abruptly, 
in some way?

The only situation I can think of when you can have stray connections 
(and would not be a bug) would be the case when the socket has been 
broken in some way without doing a TCP FIN. If the app is killed, the 
underlying OS takes care of closing all its FDs, including all sockets 
that were held by the app - so that shouldn't cause stray connections. 
But, for example, if the client machine is physically disconnected from 
the network, the broker has no way of knowing that and expects the 
client to continue consuming (but it doesn't). Until the TCP socket 
times out (could take 15 mins), the message would remain blocked in the 
queue, as it is reserved for the disconnected client (which didn't 
receive the message entirely and/or didn't get to ack).


Rgds,
Vlad.


On 09/17/2010 03:56 PM, Michael Burns wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Just to add that I experienced the delay problem again - this time I 
</I>&gt;<i> checked the number of connections that were open and saw a stray 
</I>&gt;<i> connection was still hanging about. Upon manually killing this 
</I>&gt;<i> connection my message then came through.
</I>&gt;<i> Any thoughts?
</I>&gt;<i>
</I>&gt;<i> (Again just to add that I'm not 100% sure our consumer app shutdown 
</I>&gt;<i> cleanly, it may have been killed before the connection could be closed 
</I>&gt;<i> our side)
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Michael
</I>&gt;<i>
</I>&gt;<i> On Thu, Sep 16, 2010 at 1:39 PM, Michael Burns 
</I>&gt;<i> &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michaelburns1 at gmail.com</A> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michaelburns1 at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     Hi Vlad,
</I>&gt;<i>     We're using the Java client 1.8.1
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Thanks,
</I>&gt;<i>     Michael
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     On Thu, Sep 16, 2010 at 1:37 PM, Vlad Alexandru Ionescu
</I>&gt;<i>     &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vlad at rabbitmq.com</A> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">vlad at rabbitmq.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>             I've noticed sometimes that there are extra connections
</I>&gt;<i>             hanging about on the RabbitMQ broker (using rabbitmqctl
</I>&gt;<i>              list_connections).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         Michael, can you tell us which client(s) are you using?
</I>&gt;<i>
</I>&gt;<i>         Thanks,
</I>&gt;<i>         Vlad.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100917/d0a145c7/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100917/d0a145c7/attachment-0001.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008975.html">[rabbitmq-discuss] Delay delivering messages
</A></li>
	<LI>Next message: <A HREF="008977.html">[rabbitmq-discuss] Delay delivering messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8976">[ date ]</a>
              <a href="thread.html#8976">[ thread ]</a>
              <a href="subject.html#8976">[ subject ]</a>
              <a href="author.html#8976">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
