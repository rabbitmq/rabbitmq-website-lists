<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Questions on RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Questions%20on%20RabbitMQ&In-Reply-To=%3C396F9222-9382-48DC-83F6-6AE7BA6F51CA%40jbrisbin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009096.html">
   <LINK REL="Next"  HREF="009097.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Questions on RabbitMQ</H1>
    <B>Jon Brisbin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Questions%20on%20RabbitMQ&In-Reply-To=%3C396F9222-9382-48DC-83F6-6AE7BA6F51CA%40jbrisbin.com%3E"
       TITLE="[rabbitmq-discuss] Questions on RabbitMQ">jon at jbrisbin.com
       </A><BR>
    <I>Sat Sep 25 13:59:37 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009096.html">[rabbitmq-discuss] Questions on RabbitMQ
</A></li>
        <LI>Next message: <A HREF="009097.html">[rabbitmq-discuss] deadlock at QueueingBasicConsumer.Queue.Dequeue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9098">[ date ]</a>
              <a href="thread.html#9098">[ thread ]</a>
              <a href="subject.html#9098">[ subject ]</a>
              <a href="author.html#9098">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sep 25, 2010, at 6:07 AM, Ralf Kistner wrote:

&gt;<i> 2 a. Are there any recommended practices for running a (Ruby) process
</I>&gt;<i> to consume messages in an infinite loop?
</I>
Check out the AMQP stuff in Ruby. It uses EventMachine. EM will run until you tell it to stop, which is what you're looking for.

&gt;<i> 2 b. The Ruby script would occasionally be unable to process a
</I>&gt;<i> message. This could be because of a temporary lock on the database, an
</I>&gt;<i> invalid message from the mobile client, or a bug on the server. The
</I>&gt;<i> ideal would be for these messages to be retried a few times, then
</I>&gt;<i> moved to a different queue if it still fails. The messages in the
</I>&gt;<i> queue could then be inspected manually, and moved back to the original
</I>&gt;<i> queue when the bug was fixed.
</I>&gt;<i> How would this be accomplished? Does RabbitMQ have something like a
</I>&gt;<i> dead letter queue? Or would I have to move the message to a different
</I>&gt;<i> queue myself (in the Ruby script), in case of an error?
</I>&gt;<i> Note that I can't return any messages to the sender, I want to keep it
</I>&gt;<i> on the server in a different queue.
</I>
Redelivery is something I'm working on in my own application. I use it to update databases at remote locations that might or might not be online. If I get a timeout error, I write my message into a Riak bucket. There is a Quartz-based job that runs every five minutes that checks this retry bucket and simply deletes the messages and dumps them back into the broker. I haven't put it in yet, but I'm planning on implementing a &quot;maxRetries&quot; so that when a message exceeds the retry number, it will be either sent to a notification queue where it gets emailed, or moved to another Riak bucket where I can write an RSS feed over the top of it.

&gt;<i> 3. What is the best way to create a backup of all the message sent to
</I>&gt;<i> the server? Does RabbitMQ automatically do this, or should I write an
</I>&gt;<i> additional consumer to create a backup?
</I>

A NoSQL store where you keep the entire message in JSON format seems to me the safest and most performant way to persist messages with enough information to be able to resubmit the message at a later time. I have security tokens in the headers (I don't use logins but tokens) and of course I have to capture the exchange and routing key information. I use JSON data for my messages, so this fits nicely together but you could also base64 encode your data.

You could use an additional consumer (e.g. on routing key &quot;#&quot;) but I let the consumer decide whether to persist a message to Riak or not.

Thanks!

J. Brisbin
<A HREF="http://jbrisbin.com/">http://jbrisbin.com/</A>






-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100925/315aeb74/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100925/315aeb74/attachment.htm</A>&gt;
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009096.html">[rabbitmq-discuss] Questions on RabbitMQ
</A></li>
	<LI>Next message: <A HREF="009097.html">[rabbitmq-discuss] deadlock at QueueingBasicConsumer.Queue.Dequeue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9098">[ date ]</a>
              <a href="thread.html#9098">[ thread ]</a>
              <a href="subject.html#9098">[ subject ]</a>
              <a href="author.html#9098">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
