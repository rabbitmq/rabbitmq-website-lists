<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] py-amqplib status messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20py-amqplib%20status%20messages&In-Reply-To=84fb38e30811201750l2d5dd947vb30a96c1afc8b72b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002100.html">
   <LINK REL="Next"  HREF="002108.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] py-amqplib status messages</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20py-amqplib%20status%20messages&In-Reply-To=84fb38e30811201750l2d5dd947vb30a96c1afc8b72b%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] py-amqplib status messages">matthias at lshift.net
       </A><BR>
    <I>Fri Nov 21 08:18:08 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002100.html">[rabbitmq-discuss] py-amqplib status messages
</A></li>
        <LI>Next message: <A HREF="002108.html">[rabbitmq-discuss] py-amqplib status messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2102">[ date ]</a>
              <a href="thread.html#2102">[ thread ]</a>
              <a href="subject.html#2102">[ subject ]</a>
              <a href="author.html#2102">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Tsuraan,

tsuraan wrote:
&gt;<i> Code samples:
</I>&gt;<i> message inserter, which is run first:
</I>&gt;<i> 
</I>&gt;<i> def main():
</I>&gt;<i>   conn = A.Connection('localhost', userid='tsuraan', password='tsuraan')
</I>&gt;<i>   chan = conn.channel()
</I>&gt;<i> 
</I>&gt;<i>   for i in range(1000):
</I>&gt;<i>     m = A.Message(str(i), delivery_mode=2)
</I>&gt;<i>     chan.basic_publish(m, 'rawmsg', 'standard', mandatory=True, immediate=False)
</I>&gt;<i> 
</I>&gt;<i> if __name__ == &quot;__main__&quot;:
</I>&gt;<i>   main()
</I>
The above program exits without closing the channel or connection 
properly first. As a result, any messages that are &quot;in flight&quot; will be lost.

&gt;<i> def main():
</I>&gt;<i>   conn = A.Connection('localhost', userid='tsuraan', password='tsuraan')
</I>&gt;<i>   chan = conn.channel()
</I>&gt;<i> 
</I>&gt;<i>   nums = []
</I>&gt;<i>   while True:
</I>&gt;<i>     chan.tx_select()
</I>&gt;<i>     msg = chan.basic_get(&quot;msgq&quot;, no_ack=True)
</I>&gt;<i>     if msg is None:
</I>&gt;<i>       print 'all done'
</I>&gt;<i>       break
</I>&gt;<i>     else:
</I>&gt;<i>       print 'got message', msg.body
</I>&gt;<i>       nums.append(msg.body)
</I>&gt;<i> 
</I>&gt;<i>     dtag = msg.delivery_info['delivery_tag']
</I>&gt;<i>     chan.basic_ack(dtag)
</I>&gt;<i>     chan.tx_commit()
</I>&gt;<i> 
</I>&gt;<i>   print len(nums)
</I>&gt;<i> 
</I>&gt;<i> if __name__ == &quot;__main__&quot;:
</I>&gt;<i>   main()
</I>
Why are you using tx in the above? It won't do any harm, but it doesn't 
seem to serve any purpose.

As above, you should close the channel and connection properly before 
exiting.

&gt;<i> When the first program is run, it runs for a moment, and then exits
</I>&gt;<i> without any errors.  The second program is run, and it only gets a few
</I>&gt;<i> hundred messages.  The ids that it gets are always sequential numbers,
</I>&gt;<i> starting with 0.  It's as though the last couple of hundred messages
</I>&gt;<i> just never happened, although they were published.
</I>
That is most likely due to the lack of proper channel/connection closure 
in the producer code.


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002100.html">[rabbitmq-discuss] py-amqplib status messages
</A></li>
	<LI>Next message: <A HREF="002108.html">[rabbitmq-discuss] py-amqplib status messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2102">[ date ]</a>
              <a href="thread.html#2102">[ thread ]</a>
              <a href="subject.html#2102">[ subject ]</a>
              <a href="author.html#2102">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
