<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] py-amqplib basic_consume
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20py-amqplib%20basic_consume&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002127.html">
   <LINK REL="Next"  HREF="002118.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] py-amqplib basic_consume</H1>
    <B>tsuraan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20py-amqplib%20basic_consume&In-Reply-To="
       TITLE="[rabbitmq-discuss] py-amqplib basic_consume">tsuraan at gmail.com
       </A><BR>
    <I>Fri Nov 21 22:09:36 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002127.html">[rabbitmq-discuss] timing out during startup in etch
</A></li>
        <LI>Next message: <A HREF="002118.html">[rabbitmq-discuss] py-amqplib basic_consume
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2117">[ date ]</a>
              <a href="thread.html#2117">[ thread ]</a>
              <a href="subject.html#2117">[ subject ]</a>
              <a href="author.html#2117">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, so now I'm trying to get basic_consume to work, and it's behaving
very strangely.  As before, I first run a producer that puts 1000
messages into a queue called toshred.  Once that has run, I run my new
consumer code, which just prints that it got something to consume.  It
doesn't acknowledge the message, it doesn't do anything the slightest
bit useful.  However, it does appear to devour messages like mad.
Every time I run this &quot;consumer&quot;, it calls the consume method once,
but over 200 messages will be gone from the toshred queue (as
determined by a passive declaration of that queue).  If I run the
consumer first, and then put messages in the toshred queue, all but
five messages are enqueued, and the consumer exits after the first
call to consume.

Two questions: why are messages being removed from the queue?  It
doesn't seem like any messages are being acknowledged, so I wouldn't
expect any messages to be dequeued.  Also, what is the expected usage
for basic_consume?  Do you call it and channel.wait() in a loop, in
the same way that basic_get is used?

Consumer code:

import amqplib.client_0_8 as A

def consume(msg):
  print 'consuming', msg

def main():
  conn = A.Connection('localhost', userid='tsuraan', password='tsuraan')
  chan = conn.channel()

  chan.basic_consume('toshred', no_ack=True, callback=consume)
  print 'waiting'
  chan.wait()
  chan.close()
  conn.close()

if __name__ == &quot;__main__&quot;:
  main()


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002127.html">[rabbitmq-discuss] timing out during startup in etch
</A></li>
	<LI>Next message: <A HREF="002118.html">[rabbitmq-discuss] py-amqplib basic_consume
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2117">[ date ]</a>
              <a href="thread.html#2117">[ thread ]</a>
              <a href="subject.html#2117">[ subject ]</a>
              <a href="author.html#2117">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
