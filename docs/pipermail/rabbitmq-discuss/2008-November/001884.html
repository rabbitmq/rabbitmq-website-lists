<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Erlang client and properties
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Erlang%20client%20and%20properties&In-Reply-To=6c2563b20811071431l2100e787y1db4eb9c64cf64bc%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001883.html">
   <LINK REL="Next"  HREF="001887.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Erlang client and properties</H1>
    <B>Edwin Fine</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Erlang%20client%20and%20properties&In-Reply-To=6c2563b20811071431l2100e787y1db4eb9c64cf64bc%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Erlang client and properties">rabbitmq-discuss_efine at usa.net
       </A><BR>
    <I>Fri Nov  7 23:07:57 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001883.html">[rabbitmq-discuss] Erlang client and properties
</A></li>
        <LI>Next message: <A HREF="001887.html">[rabbitmq-discuss] Erlang client and properties
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1884">[ date ]</a>
              <a href="thread.html#1884">[ thread ]</a>
              <a href="subject.html#1884">[ subject ]</a>
              <a href="author.html#1884">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, I found the definitions for timestamp and so on. Seems like reading the
AMQP 0.8 XML document alone was a mistake; I needed to look at the low-level
protocol in the AMQP 0.8 PDF document. I was skipping between so many docs I
got a bit lost. So I guess RTFM comments would be deserved :) That being
said, is it just me, or is this set of specs a bit difficult to absorb?

So we can scratch question 2 and any questions about shortstr etc. I am
working on reading the rabbit code about message headers. Looks as if some
helper functions in the client might be useful, otherwise I'll be using
internal things like a list of tuples {FName, timestamp/other types, Value}
to create message headers. Is that what is supposed to be done?

On Fri, Nov 7, 2008 at 5:31 PM, Edwin Fine
&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss_efine at usa.net</A>&gt;wrote:

&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I'm using the Erlang client (2008/06/23 vintage, I think) and I've started
</I>&gt;<i> to need message-related properties like timestamp, expiration, and so on, to
</I>&gt;<i> avoid reinventing the wheel. The Java client's Javadoc I am not finding very
</I>&gt;<i> helpful for this set of questions. I know that the Erlang client is still
</I>&gt;<i> experimental, so I am asking for &quot;documentation&quot; here (* see the end of this
</I>&gt;<i> post before sending STFW messages, please :)
</I>&gt;<i>
</I>&gt;<i> If the following questions are answered somewhere in a way that relates to
</I>&gt;<i> how to use it in the Erlang client (e.g. examples in Erlang), please point
</I>&gt;<i> me to it and disregard the rest of these questions.
</I>&gt;<i>
</I>&gt;<i> My questions are:
</I>&gt;<i>
</I>&gt;<i>    1. When I send a message with properties set to
</I>&gt;<i>    amqp_util:basic_properties(), and receive it using a basic.get, the message
</I>&gt;<i>    has only got property data in properties_bin, but properties is set to
</I>&gt;<i>    'none'. How do I decode what's in properties_bin? Alternatively, how do I
</I>&gt;<i>    get the properties to stay set in the unencoded 'properties' field?
</I>&gt;<i>    2. What is the format of the timestamp field, and how do I
</I>&gt;<i>    encode/decode it? I can't find a definition for its type &quot;timestamp&quot; in the
</I>&gt;<i>    AMQP spec.
</I>&gt;<i>    3. When and by what does the timestamp get set? I searched all the
</I>&gt;<i>    client code for 'timestamp' but could not find it, so when I create a new
</I>&gt;<i>    message, what sets this?
</I>&gt;<i>    4. What is the format of the expiration? The spec does not define it.
</I>&gt;<i>    5. What is the behavior when a message has expired? Does the client
</I>&gt;<i>    automatically throw it away when doing a basic.get or consume so I never see
</I>&gt;<i>    it?
</I>&gt;<i>    6. Does the message_id ever get set automatically to a unique value?
</I>&gt;<i>    7. What is the purpose of the 'type' property? The spec just writes
</I>&gt;<i>    &quot;message type name&quot;? Is this totally user-defined?
</I>&gt;<i>    8. How does one set and get message headers?
</I>&gt;<i>
</I>&gt;<i> I am sure that I could work this all out if I read all the Rabbit code, all
</I>&gt;<i> the AMQP tutorials I can find, and so on, but it would take me days. It's
</I>&gt;<i> already taken hours so far. If anyone can help me shortcut this, I would be
</I>&gt;<i> very grateful.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Edwin Fine
</I>&gt;<i> ----------
</I>&gt;<i> * For those who believe I should RTFM or STFW, I hear you, and I have done
</I>&gt;<i> my best in the time I have available. This is what I have done and/or
</I>&gt;<i> learned:
</I>&gt;<i>
</I>&gt;<i> I looked in the Erlang client and server code, too, but found little to
</I>&gt;<i> help, besides this in amqp_util.erl:
</I>&gt;<i>
</I>&gt;<i> basic_properties() -&gt;
</I>&gt;<i>     #'P_basic'{content_type = &lt;&lt;&quot;application/octet-stream&quot;&gt;&gt;, delivery_mode
</I>&gt;<i> = 1, priority = 0}
</I>&gt;<i>
</I>&gt;<i> From rabbit_framing.hrl, I got this:
</I>&gt;<i>
</I>&gt;<i> -record('P_basic', {content_type, content_encoding, headers, delivery_mode,
</I>&gt;<i> priority, correlation_id, reply_to, expiration, message_id, timestamp, type,
</I>&gt;<i> user_id, app_id, cluster_id}).
</I>&gt;<i>
</I>&gt;<i> The above fields are described in the amqp0-8.xml document in terms of
</I>&gt;<i> their basic type (e.g. shortstr, whatever that is) and their purpose. The
</I>&gt;<i> basic types (shortstr, timestamp, etc) are not explained in the document,
</I>&gt;<i> nor can I find a reference to anything that does explain them. I saw in the
</I>&gt;<i> Rabbit code an assertion that shortstr length must be &lt; 256, so now I know
</I>&gt;<i> that :)
</I>&gt;<i>
</I>&gt;<i> In the Javadoc, only the content_type, delivery_mode, and priority fields
</I>&gt;<i> seem to be used in the MessageProperties class. The descriptions of each of
</I>&gt;<i> the properties in Basic.Properties are absent.
</I>&gt;<i>
</I>&gt;<i> I searched the Rabbit message list archives, too. One of the messages
</I>&gt;<i> pointed me to a tutorial in C, which was useful to see how some of the
</I>&gt;<i> properties were used (<A HREF="http://www.openamq.org/tutorial:soa">http://www.openamq.org/tutorial:soa</A>). Now I
</I>&gt;<i> understand that I have to set the message_id myself, and that the routing
</I>&gt;<i> key of the sender should be put into reply_to if the sender requires a
</I>&gt;<i> reply, in other words, the routing key of the responder must be set to the
</I>&gt;<i> sender's reply_to property.
</I>&gt;<i>
</I>&gt;<i> I am still looking through the C code tutorials, so maybe I will find out
</I>&gt;<i> more.
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081107/f61e0be9/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081107/f61e0be9/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001883.html">[rabbitmq-discuss] Erlang client and properties
</A></li>
	<LI>Next message: <A HREF="001887.html">[rabbitmq-discuss] Erlang client and properties
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1884">[ date ]</a>
              <a href="thread.html#1884">[ thread ]</a>
              <a href="subject.html#1884">[ subject ]</a>
              <a href="author.html#1884">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
