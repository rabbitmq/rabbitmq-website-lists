<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbitmq-discuss%20Digest%2C%20Vol%2018%2C%20Issue%2034&In-Reply-To=269388e30811161709w655bfcc0g9372b01e73b17ff3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002022.html">
   <LINK REL="Next"  HREF="002026.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34</H1>
    <B>Ilya Grigorik</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbitmq-discuss%20Digest%2C%20Vol%2018%2C%20Issue%2034&In-Reply-To=269388e30811161709w655bfcc0g9372b01e73b17ff3%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34">ilya at aiderss.com
       </A><BR>
    <I>Mon Nov 17 04:25:07 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002022.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34
</A></li>
        <LI>Next message: <A HREF="002026.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2023">[ date ]</a>
              <a href="thread.html#2023">[ thread ]</a>
              <a href="subject.html#2023">[ subject ]</a>
              <a href="author.html#2023">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Man, I feel silly.. I don't know how I haven't caught this before, but the
box I'm running the tests on has no swap partition - completely disabled, I
must have booted the wrong image!

Long story short:

/usr/sbin/rabbitmq-server: line 76: 28477 Killed                  erl -pa
&quot;`dirname $0`/../ebin&quot; ${START_RABBIT} -sname ${NODENAME} -boot start_sasl
+W w ${ERL_ARGS} -rabbit tcp_listeners '[{&quot;'${NODE_IP_ADDRESS}'&quot;,
'${NODE_PORT}'}]' -sasl errlog_type error -kernel error_logger
'{file,&quot;'${LOGS}'&quot;}' -sasl sasl_error_logger '{file,&quot;'${SASL_LOGS}'&quot;}'
-os_mon start_cpu_sup true -os_mon start_disksup false -os_mon start_memsup
true -os_mon start_os_sup false -os_mon memsup_system_only true -os_mon
system_memory_high_watermark 0.90 -mnesia dir &quot;\&quot;${MNESIA_DIR}\&quot;&quot;
${CLUSTER_CONFIG} ${RABBIT_ARGS} &quot;$@&quot;

---
Nov 16 04:11:45 ip-10-251-102-223 kernel: Out of Memory: Kill process 28470
(rabbitmq-server) score 1084241 and children.
Nov 16 04:11:45 ip-10-251-102-223 kernel: Out of memory: Killed process
28477 (beam.smp).
Nov 16 04:11:45 ip-10-251-102-223 kernel: oom-killer: gfp_mask=0x201d2,
order=0
---

-rw-r--r-- 1 root root    8 Nov 16 04:11 rabbit_persister.LOG
-rw-r--r-- 1 root root 368M Nov 16 04:11 rabbit_persister.LOG.previous

---

Needless to say, nothing to recover in the first log file (the process must
have been killed while dumping from memory). Renaming the .previous file
brought rabbit back online in ~30 seconds. What's interesting is that the
persister size is really small, not sure how the process could have run out
of memory? All messages sent to it very marked as persistent. (it was
running overnight)

I'll do some testing with SWAP tomorrow.

ig
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081116/0d19718a/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081116/0d19718a/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002022.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34
</A></li>
	<LI>Next message: <A HREF="002026.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2023">[ date ]</a>
              <a href="thread.html#2023">[ thread ]</a>
              <a href="subject.html#2023">[ subject ]</a>
              <a href="author.html#2023">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
