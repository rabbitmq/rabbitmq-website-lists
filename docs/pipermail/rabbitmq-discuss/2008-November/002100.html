<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] py-amqplib status messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20py-amqplib%20status%20messages&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002099.html">
   <LINK REL="Next"  HREF="002102.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] py-amqplib status messages</H1>
    <B>tsuraan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20py-amqplib%20status%20messages&In-Reply-To="
       TITLE="[rabbitmq-discuss] py-amqplib status messages">tsuraan at gmail.com
       </A><BR>
    <I>Fri Nov 21 01:50:20 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002099.html">[rabbitmq-discuss] RabbitMQ ejabberd gateway
</A></li>
        <LI>Next message: <A HREF="002102.html">[rabbitmq-discuss] py-amqplib status messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2100">[ date ]</a>
              <a href="thread.html#2100">[ thread ]</a>
              <a href="subject.html#2100">[ subject ]</a>
              <a href="author.html#2100">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>How does py-amqplib return results to the user?  For example,
basic_publish has a mandatory flag, which says that if the server
cannot route a message, it gives an unroutable message back.  How does
the user of py-amqplib get this message?  It seems like every method
returns None all the time with the exception of basic_get, so how can
I get server responses?

The reason I ask is that if I do 1000 basic_publish calls, the first
several hundred (used to be ~600, closer to 800 with the latest hg
tip) messages get inserted, but the rest do not (this is the same
problem that I was having a month or so ago, but I finally got time to
pick this up again, so I'm starting fresh-ish).  The call is being
made a thousand times with messages whose bodies are the value of a
simple integer counter, and I never get any sort of failure report or
anything, but I really don't have any idea how to get status
messages...


Code samples:
message inserter, which is run first:

def main():
  conn = A.Connection('localhost', userid='tsuraan', password='tsuraan')
  chan = conn.channel()

  for i in range(1000):
    m = A.Message(str(i), delivery_mode=2)
    chan.basic_publish(m, 'rawmsg', 'standard', mandatory=True, immediate=False)

if __name__ == &quot;__main__&quot;:
  main()

message consumer, which is run after the inserter is run (I know
that's not realistic, but I want to know why I'm silently losing
messages):

def main():
  conn = A.Connection('localhost', userid='tsuraan', password='tsuraan')
  chan = conn.channel()

  nums = []
  while True:
    chan.tx_select()
    msg = chan.basic_get(&quot;msgq&quot;, no_ack=True)
    if msg is None:
      print 'all done'
      break
    else:
      print 'got message', msg.body
      nums.append(msg.body)

    dtag = msg.delivery_info['delivery_tag']
    chan.basic_ack(dtag)
    chan.tx_commit()

  print len(nums)

if __name__ == &quot;__main__&quot;:
  main()

When the first program is run, it runs for a moment, and then exits
without any errors.  The second program is run, and it only gets a few
hundred messages.  The ids that it gets are always sequential numbers,
starting with 0.  It's as though the last couple of hundred messages
just never happened, although they were published.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002099.html">[rabbitmq-discuss] RabbitMQ ejabberd gateway
</A></li>
	<LI>Next message: <A HREF="002102.html">[rabbitmq-discuss] py-amqplib status messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2100">[ date ]</a>
              <a href="thread.html#2100">[ thread ]</a>
              <a href="subject.html#2100">[ subject ]</a>
              <a href="author.html#2100">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
