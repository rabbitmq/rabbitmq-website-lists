<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] py-amqplib status messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20py-amqplib%20status%20messages&In-Reply-To=492AEDCD.2030103%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002139.html">
   <LINK REL="Next"  HREF="002153.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] py-amqplib status messages</H1>
    <B>Dmitriy Samovskiy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20py-amqplib%20status%20messages&In-Reply-To=492AEDCD.2030103%40lshift.net"
       TITLE="[rabbitmq-discuss] py-amqplib status messages">dmitriy.samovskiy at cohesiveft.com
       </A><BR>
    <I>Tue Nov 25 17:08:32 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002139.html">[rabbitmq-discuss] py-amqplib status messages
</A></li>
        <LI>Next message: <A HREF="002153.html">[rabbitmq-discuss] py-amqplib status messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2150">[ date ]</a>
              <a href="thread.html#2150">[ thread ]</a>
              <a href="subject.html#2150">[ subject ]</a>
              <a href="author.html#2150">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

Matthias Radestock wrote:
&gt;<i> 
</I>&gt;<i> So unless the sender has received some application level ack - such as a 
</I>&gt;<i> channel/connection.close-ok, or a tx.commit-ok - there is no way for it 
</I>&gt;<i> to be sure that the messages it has sent have been
</I>&gt;<i> processed.
</I>&gt;<i> 
</I>Understood. So if I don't receive an application level ack, I can't know how many messages 
  that I already sent, have been received by broker. Consider:

for i in range(1000): ch.basic_publish(Message(str(i)), 'amq.fanout')
and I get socket.error exception when i==500.

This means that I either have to do buffering inside producer in order to be able to 
resend them all, or I have to wrap each basic.publish in tx.

In latter case, it's a total of 5 methods (tx.select, tx.select-ok, basic.publish, 
tx.commit, tx.commit-ok). *If* AMQP spec offered a synchronous publish, it would be only 2 
methods (basic.publish-with-confirmation, basic.publish-ok).

I take it there must be a reason why only async version of publish method is provided in 
AMQP spec? Is anyone familiar with reasoning behind this decision?


On a side note, I found that if I sleep after each send in the above loop, I get 
consistently higher success rates of received vs not received messages with py-amqplib on 
Linux (essentially no message loss due to being in flight).

for i in range(1000):
   ch.basic_publish(Message(str(i)), 'amq.fanout')
   time.sleep(0.0001)

Without sleeps, tcpdump shows multiple basic.publish methods packed in a single TCP 
packet. With sleeps, there are more TCP packets that carry the same number of 
basic.publish methods. Note that this may not be the case for other client implementations 
and could be OS dependent as well (not tested).

This may not be a good pattern to rely on, but in limited testing it worked for me.


- Dmitriy


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002139.html">[rabbitmq-discuss] py-amqplib status messages
</A></li>
	<LI>Next message: <A HREF="002153.html">[rabbitmq-discuss] py-amqplib status messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2150">[ date ]</a>
              <a href="thread.html#2150">[ thread ]</a>
              <a href="subject.html#2150">[ subject ]</a>
              <a href="author.html#2150">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
