<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbitmq-discuss%20Digest%2C%20Vol%2018%2C%20Issue%2034&In-Reply-To=6c2563b20811171519r428a621g479e0f84ae45d753%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002029.html">
   <LINK REL="Next"  HREF="002037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34</H1>
    <B>Ilya Grigorik</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbitmq-discuss%20Digest%2C%20Vol%2018%2C%20Issue%2034&In-Reply-To=6c2563b20811171519r428a621g479e0f84ae45d753%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34">ilya at aiderss.com
       </A><BR>
    <I>Tue Nov 18 03:52:18 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002029.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34
</A></li>
        <LI>Next message: <A HREF="002037.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2031">[ date ]</a>
              <a href="thread.html#2031">[ thread ]</a>
              <a href="subject.html#2031">[ subject ]</a>
              <a href="author.html#2031">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Are you using Linux? If so, did the Linux OOM killer maybe zap the Erlang
</I>&gt;<i> node?
</I>&gt;<i>
</I>
That's what I thought, but can't find any trace of it.

You could try this:
&gt;<i>
</I>&gt;<i> $ sudo sysctl vm.overcommit_memory=2
</I>&gt;<i> vm.overcommit_memory = 2
</I>&gt;<i>
</I>
Interesting, this helped a bit. Got up to 2.7GB in persister, then killed
the Erlang node once again. No kernel logs, no nothing. Grrr!

Another interesting observation (not surprising), while swapping to disk,
the accept throughput drops to the floor. I'm sending messages with ack's
disabled, so I'm assuming the vast majority simply never make it to the
queue, here's a quick snapshot (9th column is the KBin .. top half shows
swapping to disk, then once some memory is available it once again resumes
at ~3.5mbs/):

   4   3  2191    995      0      0   9224   1036   1458   1098     36
562
   2   2  1257    212      0      0   6636    599     49     49      5
29
   0   0   305     90      0      0   2399    148      0      5      3
6
   7   7  1247    336      0      0   7323    523     87     79      5
42
   3   3  2729   1023      0      0   8192   1137    986    901     34
481
   6   6  1024    320      0      0  10760    620    248    220     10
119
   2   2   630    146      0      0   7544    596    824    667     28
354
   0   0  1617    683      0      0   3712    918      0      1      0
1
   2   2   889    125      0      0   9280    881      1      9      3
10
#&lt;--------CPU--------&gt;&lt;----------Disks-----------&gt;&lt;----------Network----------&gt;
#cpu sys inter  ctxsw KBRead  Reads KBWrit Writes   KBIn  PktIn  KBOut
PktOut
   9   8   902    355     94     10  11713    775     17     21      4
19
  37  24  1807    478    503     33   2974    145    172    153      9
82
  21  20  1221    944    448     14      0      0   1600   1187     40
589
   4   3  2443   1881    669     21      0      0   2750   2289     78
1169
   0   0  3624   2931   1865     58      0      0   4444   3772    126
1926
   0   0  2060   1660   1726     54      0      0   2704   2148     71
1059
   2   1  2872   2361   1791     57      0      0   3728   2963     99
1497
   2   1  3299   2679   1821     61      0      0   3927   3325    112
1688

Also take a look at overcommit_ratio and swappiness.
&gt;<i>
</I>
Swappiness is at default (60), and overcommit_ratio at 50.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081117/10c0ebc0/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081117/10c0ebc0/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002029.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34
</A></li>
	<LI>Next message: <A HREF="002037.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 18, Issue 34
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2031">[ date ]</a>
              <a href="thread.html#2031">[ thread ]</a>
              <a href="subject.html#2031">[ subject ]</a>
              <a href="author.html#2031">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
