<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Persister crashes Rabbit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Persister%20crashes%20Rabbit&In-Reply-To=491F4378.3090001%40yahoo.com.sg">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002008.html">
   <LINK REL="Next"  HREF="001994.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Persister crashes Rabbit</H1>
    <B>Peter Silva</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Persister%20crashes%20Rabbit&In-Reply-To=491F4378.3090001%40yahoo.com.sg"
       TITLE="[rabbitmq-discuss] Persister crashes Rabbit">Peter.A.Silva at gmail.com
       </A><BR>
    <I>Sun Nov 16 03:21:28 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002008.html">[rabbitmq-discuss] Persister crashes Rabbit
</A></li>
        <LI>Next message: <A HREF="001994.html">[rabbitmq-discuss] Persister crashes Rabbit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2009">[ date ]</a>
              <a href="thread.html#2009">[ thread ]</a>
              <a href="subject.html#2009">[ subject ]</a>
              <a href="author.html#2009">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>would a slower broker (&lt;1000msg/sec), that provides infinite message storage
fit the bill?

If there were an option in rabbit to store all messages on disk,
and forget them there, then reload them when ready to send, then
the retention and queuing limits go away (if queues are also on disk.)
basically if no-one is consuming from a queue for a certain amount of
time... say minutes, those queues should flush to disk, and free up memory
for active queues.

I'm not suggesting rabbit modify their high speed way of doing things, but
there might be another mode... the trivially primitive way to do it:
ie.
exchange stores into directory tree:

db/2008/11/08/23/59/msg324 msg325...

the routing algorithm makes links for the queues:

queues/myqueue/msg324 --&gt; unix hard link, to msg324 in the db tree.
                          msg325...

etc...
we timed a reasonably linux server a few years ago at being able to perform
20,000 file creations per second, which was enough to support the messaging
rate we needed.

yes, you need a single file system for the message store.  We run such db's
with upwards of 20,000,000 messages in an ext3, with decent performance.
LRU is a wonderful gift from the paging system and buffer cache that you get
for free.  It manages what to keep in memory completely transparently to the
application code.

when I can get away with a trivially primitive implementation, I take it.

(before someone says show me the code... <A HREF="http://metpx.sf.net,">http://metpx.sf.net,</A> and no it
doesn't do AMQP... but the ideas are vanishingly alike.)



On Sat, Nov 15, 2008 at 4:47 PM, rrabarg2 &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rrabarg2 at yahoo.com.sg</A>&gt; wrote:

&gt;<i>  Ben,
</I>&gt;<i>
</I>&gt;<i> We have a system which includes a homogeneous set of message producers (we
</I>&gt;<i> call switches) and a backoffice application which consumes these messages.
</I>&gt;<i> We have a guaranteed delivery requirement for the messages, we also require
</I>&gt;<i> that the switches can continue to operate unhindered (assuming infinite disk
</I>&gt;<i> space) during long periods of slow or non-consumption of messages by the
</I>&gt;<i> backoffice.  I'm not familiar with rabbitMQ, but the implication I take from
</I>&gt;<i> this thread is that rabbitMQ would not meet our requirements (at least not
</I>&gt;<i> without significant extra bespoke work)  - is that a fair statement?
</I>&gt;<i>
</I>&gt;<i> Regards
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081115/b741c7d1/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081115/b741c7d1/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002008.html">[rabbitmq-discuss] Persister crashes Rabbit
</A></li>
	<LI>Next message: <A HREF="001994.html">[rabbitmq-discuss] Persister crashes Rabbit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2009">[ date ]</a>
              <a href="thread.html#2009">[ thread ]</a>
              <a href="subject.html#2009">[ subject ]</a>
              <a href="author.html#2009">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
