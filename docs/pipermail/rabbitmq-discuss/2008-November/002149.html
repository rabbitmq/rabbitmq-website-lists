<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] nonblocking py-amqplib issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20nonblocking%20py-amqplib%20issues&In-Reply-To=3bb0d9710811250325q2ed1e770yc1cb7a53ea84ca11%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002145.html">
   <LINK REL="Next"  HREF="002151.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] nonblocking py-amqplib issues</H1>
    <B>Dmitriy Samovskiy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20nonblocking%20py-amqplib%20issues&In-Reply-To=3bb0d9710811250325q2ed1e770yc1cb7a53ea84ca11%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] nonblocking py-amqplib issues">dmitriy.samovskiy at cohesiveft.com
       </A><BR>
    <I>Tue Nov 25 16:20:14 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002145.html">[rabbitmq-discuss] nonblocking py-amqplib issues
</A></li>
        <LI>Next message: <A HREF="002151.html">[rabbitmq-discuss] nonblocking py-amqplib issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2149">[ date ]</a>
              <a href="thread.html#2149">[ thread ]</a>
              <a href="subject.html#2149">[ subject ]</a>
              <a href="author.html#2149">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Marek,

majek04 wrote:
&gt;<i> console #1:
</I>&gt;<i> $ ./rec_2.py  (this is the attached code)
</I>&gt;<i> &lt;I pressed ctrl+z to suspend the program&gt;
</I>&gt;<i> [1]+  Stopped                 ./rec_2.py
</I>&gt;<i> 
</I>&gt;<i> console #2:
</I>&gt;<i> $ ./demo_send.py 1 (standard amqplib demo program)
</I>&gt;<i> $ ./demo_send.py 2
</I>&gt;<i> 
</I>&gt;<i> back to console #1:
</I>&gt;<i> $ fg (to resume the program)
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i>   File &quot;./rec_2.py&quot;, line 31, in &lt;module&gt;
</I>&gt;<i>     amqp.nbloop([ch])
</I>&gt;<i>   File &quot;build/bdist.linux-i686/egg/amqplib/nbclient_0_8.py&quot;, line 176, in nbloop
</I>&gt;<i>   File &quot;build/bdist.linux-i686/egg/amqplib/nbclient_0_8.py&quot;, line 74, in write
</I>&gt;<i> &lt;P&#65533;' read_buf='&amp;&lt;!amq.ctag-rdYQarPUansf8+2dGsnFAQ==&#65533;6&lt;&lt;!amq.ctag-rdYQarPUansf8+2dGsnFAQ==myfan2&lt;&#65533;
</I>&gt;<i> text/plainfooIbarSbaz&#65533;1&#65533;6&lt;&lt;!amq.ctag-rdYQarPUansf8+2dGsnFAQ==myfan2&lt;&#65533;
</I>&gt;<i> text/plainfooIbarSbaz&#65533;2&#65533;' read_p='175'
</I>I was not able to reproduce this problem with python2.5 on debian etch, but I will revisit 
code to see what may be causing it.

&gt;<i> 
</I>&gt;<i> 2. Order of the messages is wrong.
</I>&gt;<i> I just changed the callback function and disabled basic_ack:
</I>&gt;<i> ['4', '1', '2', '3', '4']
</I>I was able to reproduce this problem, and will look into it. It's not only the order but 
also looks like client calls callback() more than once for some messages, which would be 
wrong.


&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 3. no_ack option for basic_consume is not working.
</I>&gt;<i> With disabled basic_ack, and added no_ack to basic_consume:
</I>&gt;<i>     ch.consumer_tag = ch.basic_consume(qname, callback=callback, no_ack=True)
</I>&gt;<i> I get exactly the same results as before.
</I>May I ask what was the expected outcome? With no_ack=False, if your consumer doesn't ack 
and disconnects, unack'ed messages will be requeued for another consumer. With 
no_ack=True, broker automatically marks all messages it sends to your consumer as ack'ed.

<A HREF="http://lettuce.squarespace.com/faq/receiving-messages/how-are-messages-acknowledged-when-using-basicconsume.html">http://lettuce.squarespace.com/faq/receiving-messages/how-are-messages-acknowledged-when-using-basicconsume.html</A>
<A HREF="http://lettuce.squarespace.com/faq/receiving-messages/when-does-a-message-get-removed-from-a-queue.html">http://lettuce.squarespace.com/faq/receiving-messages/when-does-a-message-get-removed-from-a-queue.html</A>

In other words, I think you won't see any difference in output from your script whether 
you use no_ack=True or no_ack=False, because they affect requeueing *after* your script 
disconnects.


I will see if I can find time to look into the issues above in the near future, but can't 
offer any guarantees.


Cheers,
Dmitriy



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002145.html">[rabbitmq-discuss] nonblocking py-amqplib issues
</A></li>
	<LI>Next message: <A HREF="002151.html">[rabbitmq-discuss] nonblocking py-amqplib issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2149">[ date ]</a>
              <a href="thread.html#2149">[ thread ]</a>
              <a href="subject.html#2149">[ subject ]</a>
              <a href="author.html#2149">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
