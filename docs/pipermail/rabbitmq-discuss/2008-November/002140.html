<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Form Submission - Add A Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Form%20Submission%20-%20Add%20A%20Question&In-Reply-To=05C51FE5-19DE-46BC-9D05-432CA78CCD2F%40soundcloud.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002136.html">
   <LINK REL="Next"  HREF="002155.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Form Submission - Add A Question</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Form%20Submission%20-%20Add%20A%20Question&In-Reply-To=05C51FE5-19DE-46BC-9D05-432CA78CCD2F%40soundcloud.com"
       TITLE="[rabbitmq-discuss] Form Submission - Add A Question">0x6e6562 at gmail.com
       </A><BR>
    <I>Mon Nov 24 19:45:04 GMT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002136.html">[rabbitmq-discuss] Form Submission - Add A Question
</A></li>
        <LI>Next message: <A HREF="002155.html">[rabbitmq-discuss] Form Submission - Add A Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2140">[ date ]</a>
              <a href="thread.html#2140">[ thread ]</a>
              <a href="subject.html#2140">[ subject ]</a>
              <a href="author.html#2140">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sean,

On Mon, Nov 24, 2008 at 1:09 PM, Sean Treadway &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sean at soundcloud.com</A>&gt; wrote:
&gt;<i> Ben,
</I>&gt;<i>
</I>&gt;<i> On Nov 22, 2008, at 00: 54, Ben Hood wrote:
</I>&gt;<i> If I could control the consumer's channel's socket to minimize the number of
</I>&gt;<i> mid-flight messages, what socket options should I set?
</I>
I think you've understood me out of context - this is what I originally said:

&gt;&gt;<i> This will depend in part on how your client behaves, e.g. whether it
</I>&gt;&gt;<i> absorbs socket back pressure or not.
</I>
What I meant by absorbing back pressure would be an example where the
consuming client pulls every message from the socket and buffers it
internally. This would negate the effect of back pressure and just
exercise memory pressure on the client application to compensate for
this. This would an example where you would be throwing away the flow
control provided by TCP (under the assumption that you are using TCP
as a transport).

&gt;<i> This makes it clearer:
</I>&gt;<i> <A HREF="http://lettuce.squarespace.com/faq/queues/when-declaring-a-queue-what-does-the-message-count-field-mea.html">http://lettuce.squarespace.com/faq/queues/when-declaring-a-queue-what-does-the-message-count-field-mea.html</A>
</I>&gt;<i> But on a practical level, I think it's important to remind explicitly that
</I>&gt;<i> mid-flight messages for a consumer with no_ack=false are not included in
</I>&gt;<i> this count.
</I>
Sorry, I don't quite follow this. Can you explain?

&gt;<i> One our use cases, parallelizing long running jobs, emphasizes reliability
</I>&gt;<i> and accountability over throughput, so we would like to measure all
</I>&gt;<i> unacknowledged messages in a queue or limit the number of messages consumed
</I>&gt;<i> to one at a time.  Our goal is to keep the queue depth around 0-20 un-ack'd
</I>&gt;<i> messages by controlling the number consumers..
</I>
This sounds more like an application of basic.qos because you would to
distribute messages based on the various consumers' ability to process
units of work. By setting the prefetch window, you get more fine
grained consumer flow control.

&gt;<i> It looks like branch 19684 (rabbitmqctl list_queues messages_ready) gives us
</I>&gt;<i> the statistic we can use to tune our consumer pools.  Are there any plans of
</I>&gt;<i> also exposing the 'messages_ready' statistic over AMQP?
</I>
Hmmm, difficult question. Some of the Redhat guys have been talking
about putting more managementy stuff into the protocol, but I don't
know what the current situation.

And coincidentally we have talking about using the codegen to add some
propriety methods to Rabbit, but this is just talk.

There were further discussions about SNMP as well.

I think for now now backing an embedded RPC handler using JSON as a
codec will pay even money. This would be quite simple to knock up with
the Erlang client for example.

&gt;<i> Or would branch 18577 (basic.qos) with pre-fetch set to 1 give us the count
</I>&gt;<i> of un-acknowledged messages we're looking for from a passive queue.declare?
</I>
I'm not sure I understand - if you set the prefetch size to be one,
only one outstanding message per channel is allowed - I don't think
this answers your question though.

&gt;&gt;<i> <A HREF="http://lettuce.squarespace.com/faq/flow-control/how-long-does-it-take-to-redeliver-an-un-acknowledged-messag.html">http://lettuce.squarespace.com/faq/flow-control/how-long-does-it-take-to-redeliver-an-un-acknowledged-messag.html</A>
</I>&gt;<i>
</I>&gt;<i> :) A question about this answer... When you say &quot;this can be done _manually_
</I>&gt;<i> with basic.get&quot;, does this imply that the redelivered message will be
</I>&gt;<i> prioritized to the channel that issued the basic.get over a channel with a
</I>&gt;<i> consumer?
</I>
No, this just a way to quickly grab that one message that wasn't
acked. It would make no difference if you were to start another
consumer for the same queue on a different channel - this is 6 of one
and half a dozen of the other.

HTH,

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002136.html">[rabbitmq-discuss] Form Submission - Add A Question
</A></li>
	<LI>Next message: <A HREF="002155.html">[rabbitmq-discuss] Form Submission - Add A Question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2140">[ date ]</a>
              <a href="thread.html#2140">[ thread ]</a>
              <a href="subject.html#2140">[ subject ]</a>
              <a href="author.html#2140">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
