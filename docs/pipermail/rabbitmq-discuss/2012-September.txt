From citi007 at 126.com  Sat Sep  1 11:21:38 2012
From: citi007 at 126.com (Allchin)
Date: Sat, 1 Sep 2012 18:21:38 +0800 (CST)
Subject: [rabbitmq-discuss] =?gbk?b?u9i4tDpSZTogIGF1dG8gY29uZmlncmF0aW9u?=
 =?gbk?q?_cluster_fail_=2E=2E=2E?=
In-Reply-To: <87txvjgwje.wl%francesco@rabbitmq.com>
References: <16b1a316.fe2c.13976d8b604.Coremail.citi007@126.com>
	<87txvjgwje.wl%francesco@rabbitmq.com>
Message-ID: <38951a61.52c0.1398159a02f.Coremail.citi007@126.com>

Hi,
I had config the property RABBITMQ_LOG_BASE like

"set RABBITMQ_LOG_BASE=%rabbit_bin_home%\logs"

and I didn't find the text like "config file(s) " neither in 
rabbit.log or rabbit-sasl.log .




Where or how can i get it?


Thx.


--
/*************
From
Allchin .
*************/




At 2012-08-31 18:56:05,"Francesco Mazzoli" <francesco at rabbitmq.com> wrote:
>Hi,
>
>Are you sure that rabbit is picking up your config file?  You can check by
>inspecting the output when starting the broker it will show, among other things,
>
>  config file(s) : (none)
>
>Make sure that in your case you don't get `(none)' but a path to your config
>file.
>
>--
>Francesco * Often in error, never in doubt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120901/bd52ebe0/attachment.htm>

From watson.timothy at gmail.com  Sat Sep  1 12:44:16 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 1 Sep 2012 12:44:16 +0100
Subject: [rabbitmq-discuss] channel 1 badfun
In-Reply-To: <E78BB53C-99EE-478E-B369-1C830E147B3A@rabbitmq.com>
References: <CBF8856C-7C53-4DC3-B0D7-71CBEA6716EC@merrells.com>
	<E78BB53C-99EE-478E-B369-1C830E147B3A@rabbitmq.com>
Message-ID: <46E312EB-C6DE-4733-ABA1-D03293465DB1@rabbitmq.com>

John, can you confirm a few things for me please.

1. Are both nodes running the same version of rabbit and erlang

2. Do the checksums for the rabbit_amqqueue.beam files (in the ebin directory within the broker install dir) match for both nodes

3. is hipe compilation enabled

Cheers

On 30 Aug 2012, at 23:17, Tim Watson <tim at rabbitmq.com> wrote:

> Hi John
> 
> On 25 Aug 2012, at 00:39, John Merrells wrote:
> 
>> 
>> We have a two node cluster of RabbitMQ 2.8.6 on Erlang 5.8.5.
>> 
>> Sometimes one of the servers will peg the cpu and messages will
>> stop passing through the system. We don't have a reliable way of
>> reproducing this...
>> 
> 
> There are a few conditions that can cause this to happen. What other symptoms happen when this occurs? Does memory usage go up as well? Does the CPU usage come down eventually, or get stuck?
> 
>> But, we do have some curious error reports in the logs. I've read
>> through rabbit_amqqueue.erl and delegate.erl and I think that
>> one server is telling the other to execute some function in 
>> rabbit_amqqueue... but I don't see why that function would be 
>> 'bad'.
>> 
>> Anyone any thoughts on the cpu issue, or this error report?
>> 
> 
> Well we'd certainly like to get to the bottom of it asap. Can you please tell us a bit more about your setup please:
> 
> a. cluster setup (i.e., disk vs ram nodes)
> b. how many queues, are there any HA queues?
> c. how you're interacting with the broker/cluster (publishers, consumers, exchanges and bindings and so on)
> 
> Also if there's any more of the logs (and sasl logs) for both nodes you're able to share, that would also help. If this occurs again and you're able to run `rabbitmqctl report` on the affected node, that would be great.
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From wmitchell at imvu.com  Sat Sep  1 02:09:32 2012
From: wmitchell at imvu.com (Wes)
Date: Fri, 31 Aug 2012 18:09:32 -0700 (PDT)
Subject: [rabbitmq-discuss] message timestamp assigned by rabbitmq?
Message-ID: <e8e89b99-9ba5-4d53-b752-4f8c6d07073c@googlegroups.com>

When a message is sent to an exchange, does the time of acceptance get 
recorded?
When I debug using either tcpdump or my client library (amqp for node.js), 
I don't see any timestamp.
Here's what happens during a basic consume:

1 > basicDeliver 
{"consumerTag":"node-amqp-24949-0.9644300159998238","deliveryTag":1,"redelivered":false,"exchange":"facts","routingKey":""}

1 > content header ["basic",0,{"contentType":"application/octet-stream"},39]

1 > content 39

Thanks,
/w
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120831/ed5405ab/attachment.htm>

From nadeem.m.nayeck at gmail.com  Sun Sep  2 05:40:43 2012
From: nadeem.m.nayeck at gmail.com (Nadeem M Nayeck)
Date: Sun, 2 Sep 2012 08:40:43 +0400
Subject: [rabbitmq-discuss] rabbitmq - simple message sending error
In-Reply-To: <CAJ1JW0eAKUeq5NnfSMLchip-4=Mm6wETgKdMUybPt=gRR82hjw@mail.gmail.com>
References: <CACYm6LZnE59FjkmrhnoAi1PY9ULcFaBw34ioB2zX74xFriM20g@mail.gmail.com>
	<1186315546.30048480.1346433300429.JavaMail.root@vmware.com>
	<CAJ1JW0eAKUeq5NnfSMLchip-4=Mm6wETgKdMUybPt=gRR82hjw@mail.gmail.com>
Message-ID: <003801cd88c5$21be58f0$653b0ad0$@gmail.com>

Thanks to all you help guys.

Actually I screwed up - I didn?t need to declare a queue in my Spring Application Context if the queue was already declared on the Rabbit-MQ server.

Am new to Rabbit, don't bash me :)

 

Thanks

Nadeem

 

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthias Reik
Sent: 31 August 2012 23:03
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] rabbitmq - simple message sending error

 

Or to put it more simple:
If you already have a queue, and you try to declare it again (which is ok), you will have to make sure that you declare it with the same parameters. As your stack trace shows, and as Mark mentions, in your case the x-message-ttl is the parameter that differs.

I want to take to use the occasion to ask a question in this context:
For most of the parameters this is a good approach, but for some parameters this can be a bit annoying, especially for the HA feature, where you specify over which servers a queue is distributed. For the TTL it's a bit similar
At least I feel sometimes that it would be good if the queue parameters could be adjusted at runtime, that the mirroring could be changed at runtime, without clients requiring an update.
The current approach we have taken is that clients don't define the queues anymore, but they are managed externally. Which is not ideal either :-( If anyone has a good recommendation, ideas, ... I would be interested to hear them

Cheers
Maze



On Fri, Aug 31, 2012 at 7:15 PM, Mark Fisher <markfisher at vmware.com> wrote:

The error message is showing that you are trying to declare a Queue where the value for 'x-message-ttl' does not match that of an existing Queue with the same name ('ml2gos_events').

  _____  

From: "Nadeem M Nayeck" <nadeem.m.nayeck at gmail.com>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Friday, August 31, 2012 12:57:51 PM
Subject: [rabbitmq-discuss]  rabbitmq - simple message sending error



hi guys
I wrote a simple java client  sending a message to a queue on Rabbit
I get this:


org.springframework.amqp.rabbit.connection.CachingConnectionFactory$CachedChannelInvocationHandler.invoke(CachingConnectionFactory.java:331)
    at $Proxy9.queueDeclare(Unknown Source)
    at org.springframework.amqp.rabbit.core.RabbitAdmin.declareQueues(RabbitAdmin.java:342)
    at org.springframework.amqp.rabbit.core.RabbitAdmin.access$200(RabbitAdmin.java:46)
    at org.springframework.amqp.rabbit.core.RabbitAdmin$11.doInRabbit(RabbitAdmin.java:312)
    at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:600)
    ... 41 more
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; reason: {#method<channel.close>(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for queue 'ml2gos_events' in vhost 'OPLCPMED00': received none but current is the value '86400000' of type 'long', class-id=50, method-id=10), null, ""}
    at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
    at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
    at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
    at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:216)
    at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
    ... 53 more
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; reason: {#method<channel.close>(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for queue 'ml2gos_events' in vhost 'OPLCPMED00': received none but current is the value '86400000' of type 'long', class-id=50, method-id=10), null, ""}
    at com.rabbitmq.client.impl.ChannelN.asyncShutdown(ChannelN.java:454)
    at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:294)
    at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:144)
    at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:91)
    at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:519)



Any pointers?

regards,
Nadeem

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120902/fa9c67e3/attachment.htm>

From tim at rabbitmq.com  Sun Sep  2 12:08:28 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Sun, 2 Sep 2012 12:08:28 +0100
Subject: [rabbitmq-discuss]
 =?utf-8?b?5Zue5aSNOlJlOiAgYXV0byBjb25maWdyYXRp?=
 =?utf-8?q?on_cluster_fail_=2E=2E=2E?=
In-Reply-To: <38951a61.52c0.1398159a02f.Coremail.citi007@126.com>
References: <16b1a316.fe2c.13976d8b604.Coremail.citi007@126.com>
	<87txvjgwje.wl%francesco@rabbitmq.com>
	<38951a61.52c0.1398159a02f.Coremail.citi007@126.com>
Message-ID: <6016BF63-5369-4443-8218-B5CDD6407655@rabbitmq.com>

If you start rabbit from the command line, the 'config file(s)' setting should be printed to stdout during the boot sequence.

On 1 Sep 2012, at 11:21, Allchin wrote:

> Hi,
> I had config the property RABBITMQ_LOG_BASE like
> 
> "set RABBITMQ_LOG_BASE=%rabbit_bin_home%\logs"
> 
> and I didn't find the text like "config file(s) " neither in 
> rabbit.log or rabbit-sasl.log .
> 
> 
> Where or how can i get it?
> 
> Thx.
> 
> --
> /*************
> From 
> Allchin .
> *************/
> 
> 
> At 2012-08-31 18:56:05,"Francesco Mazzoli" <francesco at rabbitmq.com> wrote:
> >Hi,
> >
> >Are you sure that rabbit is picking up your config file?  You can check by
> >inspecting the output when starting the broker it will show, among other things,
> >
> >  config file(s) : (none)
> >
> >Make sure that in your case you don't get `(none)' but a path to your config
> >file.
> >
> >--
> >Francesco * Often in error, never in doubt
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120902/4093f29a/attachment.htm>

From tim at rabbitmq.com  Sun Sep  2 12:09:29 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Sun, 2 Sep 2012 12:09:29 +0100
Subject: [rabbitmq-discuss]
 =?utf-8?b?5Zue5aSNOlJlOiAgYXV0byBjb25maWdyYXRp?=
 =?utf-8?q?on_cluster_fail_=2E=2E=2E?=
In-Reply-To: <6016BF63-5369-4443-8218-B5CDD6407655@rabbitmq.com>
References: <16b1a316.fe2c.13976d8b604.Coremail.citi007@126.com>
	<87txvjgwje.wl%francesco@rabbitmq.com>
	<38951a61.52c0.1398159a02f.Coremail.citi007@126.com>
	<6016BF63-5369-4443-8218-B5CDD6407655@rabbitmq.com>
Message-ID: <CC44C5A6-410E-4E58-BE10-7117011181F6@rabbitmq.com>

In fact, come to think of it, you can probably run `rabbitmqctl environment` to see this property for a running server too.

On 2 Sep 2012, at 12:08, Tim Watson wrote:

> If you start rabbit from the command line, the 'config file(s)' setting should be printed to stdout during the boot sequence.
> 
> On 1 Sep 2012, at 11:21, Allchin wrote:
> 
>> Hi,
>> I had config the property RABBITMQ_LOG_BASE like
>> 
>> "set RABBITMQ_LOG_BASE=%rabbit_bin_home%\logs"
>> 
>> and I didn't find the text like "config file(s) " neither in 
>> rabbit.log or rabbit-sasl.log .
>> 
>> 
>> Where or how can i get it?
>> 
>> Thx.
>> 
>> --
>> /*************
>> From 
>> Allchin .
>> *************/
>> 
>> 
>> At 2012-08-31 18:56:05,"Francesco Mazzoli" <francesco at rabbitmq.com> wrote:
>> >Hi,
>> >
>> >Are you sure that rabbit is picking up your config file?  You can check by
>> >inspecting the output when starting the broker it will show, among other things,
>> >
>> >  config file(s) : (none)
>> >
>> >Make sure that in your case you don't get `(none)' but a path to your config
>> >file.
>> >
>> >--
>> >Francesco * Often in error, never in doubt
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120902/3d5ec38c/attachment.htm>

From Sharon.Ben-Asher at AVG.com  Sun Sep  2 14:06:20 2012
From: Sharon.Ben-Asher at AVG.com (sharonbn)
Date: Sun, 2 Sep 2012 06:06:20 -0700 (PDT)
Subject: [rabbitmq-discuss] Java client lib: up to 5 threads created in
 client when server publishes new message
Message-ID: <1346591180334-21751.post@n5.nabble.com>

Hello,

I created a simple client in Java, which consumes messages from a queue in a
loop.
what I see in the debugger, is that whenever I publish a new message into
queue "q0"
a new thread is opened in the client.  until 5 threads are open and running.
(this is besides the single thread named "AMQP Connection")
the threads begin when the messages are published, not when they are
consumed...

is this expected behavior? can this be changed?

here is the stack trace, the client code is below.

Test at localhost:62105	
	Thread [main] (Suspended (breakpoint at line 19 in Test))	
		Test.main(String...) line: 19	
	Thread [AMQP Connection 204.236.192.179:1883] (Running)	
	Thread [pool-1-thread-1] (Running)	
	Thread [pool-1-thread-2] (Running)	
	Thread [pool-1-thread-3] (Running)	
	Thread [pool-1-thread-4] (Running)	
	Thread [pool-1-thread-5] (Running)	

thanks,
Sharon.


import com.rabbitmq.client.*;

public class Test
{
	static Connection connection;
	static Channel channel;
	static QueueingConsumer consumer;

	public static void main (String... args) throws Exception
	{
		ConnectionFactory factory = new ConnectionFactory();
		factory.setHost(Constants.server);
		factory.setPort(Constants.port);
		connection = factory.newConnection();
		channel = connection.createChannel();
		consumer = new QueueingConsumer(channel);
		channel.basicConsume("q0", true, consumer);

		for (int i = 0 ; i < 10 ; i++) {
			QueueingConsumer.Delivery d = consumer.nextDelivery();
			System.out.println(" got: " + new String(d.getBody()));
			try { Thread.sleep(1000); } catch (InterruptedException e) {}
		}
	}
}




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Java-client-lib-up-to-5-threads-created-in-client-when-server-publishes-new-message-tp21751.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tlempart at gmail.com  Mon Sep  3 08:11:48 2012
From: tlempart at gmail.com (tlempart)
Date: Mon, 3 Sep 2012 00:11:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Exchange and queue naming conventions
In-Reply-To: <CAE0Sz=xH9QKh+F8yCcB-DC1jOKi-tb0Nucw_zazLMMNXiSWPkg@mail.gmail.com>
References: <AANLkTikB3T8BPUDkrvRPd7OwrOQVX8fLrK0LAn-Ab3xZ@mail.gmail.com>
	<yrv4cbp36np8l.fsf@dwragg.eng.vmware.com>
	<AANLkTikOj3sbPq5_dwjD7B2TCgaW6=m0OHrgihg-bnV1@mail.gmail.com>
	<AANLkTimBXprF+Q=VtAd=W+-V1LaYwW-gmW3S8htPk7j4@mail.gmail.com>
	<1346334787471-21702.post@n5.nabble.com>
	<CAE0Sz=xH9QKh+F8yCcB-DC1jOKi-tb0Nucw_zazLMMNXiSWPkg@mail.gmail.com>
Message-ID: <1346656308988-21753.post@n5.nabble.com>

Thank you Jerry,

  the mandatory flag looks like the perfect solution to my problem.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Exchange-and-queue-naming-conventions-tp7254p21753.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From andrea.rosa at hp.com  Mon Sep  3 10:16:41 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Mon, 3 Sep 2012 09:16:41 +0000
Subject: [rabbitmq-discuss] How to achieve HA consumers?
In-Reply-To: <87pq67gv2x.wl%francesco@rabbitmq.com>
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>
	<87pq67gv2x.wl%francesco@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD5F8A62D0@G9W0721.americas.hpqcorp.net>

Hi Francesco,

Sorry but I didn't understand your solution:

>  * You create a second queue that we'll call "token queue", and you
>publish one
>    dummy message in it, with acks enabled.  Then, a consumer wishing to
>consume
>    from your queue, will:
>
>      - Consume from the token queue
>      - Start consuming from the actual queue
>      - When shutting down, publish a dummy message to the token queue

Which consumer needs to consume from the "token queue"?
When the second consumer will start to consume messages?

Regards
--
Andrea Rosa

From francesco at rabbitmq.com  Mon Sep  3 10:29:33 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 03 Sep 2012 10:29:33 +0100
Subject: [rabbitmq-discuss] How to achieve HA consumers?
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD5F8A62D0@G9W0721.americas.hpqcorp.net>
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>
	<87pq67gv2x.wl%francesco@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD5F8A62D0@G9W0721.americas.hpqcorp.net>
Message-ID: <87mx17mp36.wl%francesco@rabbitmq.com>

Hi Andrea,

At Mon, 3 Sep 2012 09:16:41 +0000,
Rosa, Andrea (HP Cloud Services) wrote:
> Sorry but I didn't understand your solution:
> 
> >  * You create a second queue that we'll call "token queue", and you
> >publish one
> >    dummy message in it, with acks enabled.  Then, a consumer wishing to
> >consume
> >    from your queue, will:
> >
> >      - Consume from the token queue
> >      - Start consuming from the actual queue
> >      - When shutting down, publish a dummy message to the token queue
> 
> Which consumer needs to consume from the "token queue"?
> When the second consumer will start to consume messages?

Please note that the last step is wrong (see Matthias correction).

That said, whoever wants to consume from the queue needs to consume from the
token queue first.  In the case of the OP, the main consumer will start first,
and the second right after it.  This way, the second will be blocked until the
first consumer dies/quits and the token message will be requeued.

I hope this makes it clearer for you.

--
Francesco * Often in error, never in doubt

From matthias at rabbitmq.com  Mon Sep  3 10:42:39 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 03 Sep 2012 10:42:39 +0100
Subject: [rabbitmq-discuss] How to achieve HA consumers?
In-Reply-To: <87mx17mp36.wl%francesco@rabbitmq.com>
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>
	<87pq67gv2x.wl%francesco@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD5F8A62D0@G9W0721.americas.hpqcorp.net>
	<87mx17mp36.wl%francesco@rabbitmq.com>
Message-ID: <50447B8F.5040907@rabbitmq.com>

On 03/09/12 10:29, Francesco Mazzoli wrote:
> That said, whoever wants to consume from the queue needs to consume from the
> token queue first.  In the case of the OP, the main consumer will start first,
> and the second right after it.  This way, the second will be blocked until the
> first consumer dies/quits and the token message will be requeued.

In pseudo code, this is what each consumer looks like:

token_consumer = channel.basic_consume(token_queue)
wait_for_consumer_message(token_consumer)
main_consumer = channel.basic_consume(main_queue)
while(true) {
   msg = wait_for_consumer_msg(main_consumer)
   process_message(msg)
   channel.basic_ack(msg)
}


There is one snag with this: When a consumer dies, the order in which 
the token message and any pending "proper" messages are requeued is 
undefined. That means the consumer that is taking over might start 
consuming from the main queue before the unack'ed messages have been 
requeued. The messages will get requeued eventually, but they will be 
out of order.

In practice, introducing a slight delay before consuming from the main 
queue should prevent this.


Matthias.

From charsyam at gmail.com  Mon Sep  3 14:56:38 2012
From: charsyam at gmail.com (CharSyam)
Date: Mon, 3 Sep 2012 21:56:38 +0800
Subject: [rabbitmq-discuss] Failover in Clustering mode
In-Reply-To: <5040A506.1020105@rabbitmq.com>
References: <bc4121ed-eafd-4f57-947f-8e72bc566da8@googlegroups.com>
	<5040A506.1020105@rabbitmq.com>
Message-ID: <CAMrLSE4zROTPidaGU-4BAkN=F6voxLC6n1hPncGEpT=WLXwOOw@mail.gmail.com>

Thank Francesco and  Matthias.

Oh, I'm sorry for leaving stupid question.

Yes, I killed disc node(node1), and I tried to make a queue which has the
same name that node1 has.

and Matthias. your answer is very clear.

and I understood that clustering mode is different from mirror mode. I
thought it does something like mirror mode.

and, If I want to support Failover, I have to run rabbitmq as mirror mode.

Thank you.

2012/8/31 Matthias Radestock <matthias at rabbitmq.com>

> On 29/08/12 12:42, CharSyam wrote:
>
>> I made a Rabbitmq cluster with 3 nodes.
>>
>> Originally, there are 1 disk node and 2 ram nodes.
>>
>> It worked well.
>>
>> but when I kill the process of node1.
>>
>> the queue_declare command failed( queue name is "task_queue" )
>>
>> and I couldn't make it again unless I recovred it.
>>
>
> That is the expected behaviour when the queue is declared as 'durable'.
>
> While a queue's "home" node is down, clients connected to other nodes and
> attempting to re-declare the queue will get a 404-NOT_FOUND.
>
> If other nodes were able to re-declare such queues they would then
> conflict with the original queue when that gets recovered.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120903/1caf53c9/attachment.htm>

From simon at rabbitmq.com  Mon Sep  3 17:40:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Sep 2012 17:40:58 +0100
Subject: [rabbitmq-discuss] Java client lib: up to 5 threads created in
 client when server publishes new message
In-Reply-To: <1346591180334-21751.post@n5.nabble.com>
References: <1346591180334-21751.post@n5.nabble.com>
Message-ID: <5044DD9A.6060307@rabbitmq.com>

On 02/09/12 14:06, sharonbn wrote:
> Hello,

Hi.

> I created a simple client in Java, which consumes messages from a queue in a
> loop.
> what I see in the debugger, is that whenever I publish a new message into
> queue "q0"
> a new thread is opened in the client.  until 5 threads are open and running.
> (this is besides the single thread named "AMQP Connection")
> the threads begin when the messages are published, not when they are
> consumed...
>
> is this expected behavior?

Yes. This is the thread pool for consumer callbacks to get executed in.

> can this be changed?

Yes, invoke ConnectionFactory.newConnection(ExecutorService, Address[]) 
with a different ExecutorService.

Cheers, Simon

> here is the stack trace, the client code is below.
>
> Test at localhost:62105	
> 	Thread [main] (Suspended (breakpoint at line 19 in Test))	
> 		Test.main(String...) line: 19	
> 	Thread [AMQP Connection 204.236.192.179:1883] (Running)	
> 	Thread [pool-1-thread-1] (Running)	
> 	Thread [pool-1-thread-2] (Running)	
> 	Thread [pool-1-thread-3] (Running)	
> 	Thread [pool-1-thread-4] (Running)	
> 	Thread [pool-1-thread-5] (Running)	
>
> thanks,
> Sharon.
>
>
> import com.rabbitmq.client.*;
>
> public class Test
> {
> 	static Connection connection;
> 	static Channel channel;
> 	static QueueingConsumer consumer;
>
> 	public static void main (String... args) throws Exception
> 	{
> 		ConnectionFactory factory = new ConnectionFactory();
> 		factory.setHost(Constants.server);
> 		factory.setPort(Constants.port);
> 		connection = factory.newConnection();
> 		channel = connection.createChannel();
> 		consumer = new QueueingConsumer(channel);
> 		channel.basicConsume("q0", true, consumer);
>
> 		for (int i = 0 ; i<  10 ; i++) {
> 			QueueingConsumer.Delivery d = consumer.nextDelivery();
> 			System.out.println(" got: " + new String(d.getBody()));
> 			try { Thread.sleep(1000); } catch (InterruptedException e) {}
> 		}
> 	}
> }
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Java-client-lib-up-to-5-threads-created-in-client-when-server-publishes-new-message-tp21751.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Sep  3 17:54:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 03 Sep 2012 17:54:51 +0100
Subject: [rabbitmq-discuss] Java client lib: up to 5 threads created in
 client when server publishes new message
In-Reply-To: <5044DD9A.6060307@rabbitmq.com>
References: <1346591180334-21751.post@n5.nabble.com>
	<5044DD9A.6060307@rabbitmq.com>
Message-ID: <5044E0DB.2030807@rabbitmq.com>

On 03/09/12 17:40, Simon MacMullen wrote:
> On 02/09/12 14:06, sharonbn wrote:
>> I created a simple client in Java, which consumes messages from a
>> queue in a
>> loop.
>> what I see in the debugger, is that whenever I publish a new message into
>> queue "q0"
>> a new thread is opened in the client. until 5 threads are open and
>> running.
>> (this is besides the single thread named "AMQP Connection")
>> the threads begin when the messages are published, not when they are
>> consumed...
>>
>> is this expected behavior?

Ah, I missed "the threads begin when the messages are published, not 
when they are consumed."

The threads are started up when the message is consumed by the client 
(which is likely to be very soon after you published!) But this could be 
some time before you invoke QueueingConsumer.nextDelivery() - since 
QueueingConsumer will of course itself queue these messages.

> Yes. This is the thread pool for consumer callbacks to get executed in.
>
>> can this be changed?
>
> Yes, invoke ConnectionFactory.newConnection(ExecutorService, Address[])
> with a different ExecutorService.

...or ConnectionFactory.newConnection(ExecutorService). See:

http://www.rabbitmq.com/api-guide.html#advanced-connection

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From wayne at prjatk.com  Mon Sep  3 21:41:26 2012
From: wayne at prjatk.com (Wayne Douglas)
Date: Mon, 3 Sep 2012 21:41:26 +0100
Subject: [rabbitmq-discuss] Rabbit failing to start on windows 8
Message-ID: <CAGfvhtm0nbmKma4JFbK0PqyYeZLbnjJnZV_wM=w5pK2PWZfrbg@mail.gmail.com>

Hi

I'm new to RabbitMq but have had it running under MassTransit for a while
on a windows 8 machine.

It now refuses to start - totally randomly i think.

here is the log from trying to start:


=INFO REPORT==== 4-Sep-2012::21:35:36 ===
Limiting to approx 924 file handles (829 sockets)

=ERROR REPORT==== 4-Sep-2012::21:36:06 ===
Timeout contacting cluster nodes. Since RabbitMQ was shut down forcefully
it cannot determine which nodes are timing out. Details on all nodes will
follow.

DIAGNOSTICS
===========

nodes in question: [rabbit at Wayne]

hosts, their running nodes and ports:
- Wayne: [{rabbit,1130}]

current node details:
- node name: rabbit at WAYNE
- home dir: C:\Windows
- cookie hash: hlikexZ54F023PLCOi6sEg==



=INFO REPORT==== 4-Sep-2012::21:36:07 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent


Like I said - up to now i've only had to install it and get going so not
really had to interact with rabbit at all - which is amazing! but now it's
playing up i'm completely lost so any help would be erally really
appreciated.

Many thanks

-- 
*--------------------*
*
*
*w://*
*
*
*t: 07525424882*
*
*
*--------------------*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120903/a2b9ac94/attachment.htm>

From wayne at prjatk.com  Mon Sep  3 21:42:21 2012
From: wayne at prjatk.com (Wayne Douglas)
Date: Mon, 3 Sep 2012 21:42:21 +0100
Subject: [rabbitmq-discuss] Rabbit failing to start on windows 8
In-Reply-To: <CAGfvhtm0nbmKma4JFbK0PqyYeZLbnjJnZV_wM=w5pK2PWZfrbg@mail.gmail.com>
References: <CAGfvhtm0nbmKma4JFbK0PqyYeZLbnjJnZV_wM=w5pK2PWZfrbg@mail.gmail.com>
Message-ID: <CAGfvhtn5Vs7oZivBi38UGjjWJCLnCC4n-CFXRJ=ShkW=gbqsMg@mail.gmail.com>

just spotted this in the other log:

=CRASH REPORT==== 4-Sep-2012::21:36:07 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.100.0>
    registered_name: []
    exception exit: {bad_return,{{rabbit,start,[normal,[]]},
                                 {'EXIT',{rabbit,failure_during_boot}}}}
      in function  application_master:init/4 (application_master.erl, line
138)
    ancestors: [<0.99.0>]
    messages: [{'EXIT',<0.101.0>,normal}]
    links: [<0.99.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 249
  neighbours:


On Mon, Sep 3, 2012 at 9:41 PM, Wayne Douglas <wayne at prjatk.com> wrote:

> Hi
>
> I'm new to RabbitMq but have had it running under MassTransit for a while
> on a windows 8 machine.
>
> It now refuses to start - totally randomly i think.
>
> here is the log from trying to start:
>
>
> =INFO REPORT==== 4-Sep-2012::21:35:36 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =ERROR REPORT==== 4-Sep-2012::21:36:06 ===
> Timeout contacting cluster nodes. Since RabbitMQ was shut down forcefully
> it cannot determine which nodes are timing out. Details on all nodes will
> follow.
>
> DIAGNOSTICS
> ===========
>
> nodes in question: [rabbit at Wayne]
>
> hosts, their running nodes and ports:
> - Wayne: [{rabbit,1130}]
>
> current node details:
> - node name: rabbit at WAYNE
> - home dir: C:\Windows
> - cookie hash: hlikexZ54F023PLCOi6sEg==
>
>
>
> =INFO REPORT==== 4-Sep-2012::21:36:07 ===
>     application: rabbit
>     exited: {bad_return,{{rabbit,start,[normal,[]]},
>                          {'EXIT',{rabbit,failure_during_boot}}}}
>     type: permanent
>
>
> Like I said - up to now i've only had to install it and get going so not
> really had to interact with rabbit at all - which is amazing! but now it's
> playing up i'm completely lost so any help would be erally really
> appreciated.
>
> Many thanks
>
> --
> *--------------------*
> *
> *
> *w://*
> *
> *
> *t: 07525424882*
> *
> *
> *--------------------*
>
>
>


-- 
*--------------------*
*
*
*w://*
*
*
*t: 07525424882*
*
*
*--------------------*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120903/7ce252a9/attachment.htm>

From wayne at prjatk.com  Mon Sep  3 22:11:37 2012
From: wayne at prjatk.com (Wayne Douglas)
Date: Mon, 3 Sep 2012 22:11:37 +0100
Subject: [rabbitmq-discuss] Rabbit failing to start on windows 8
In-Reply-To: <CAGfvhtn5Vs7oZivBi38UGjjWJCLnCC4n-CFXRJ=ShkW=gbqsMg@mail.gmail.com>
References: <CAGfvhtm0nbmKma4JFbK0PqyYeZLbnjJnZV_wM=w5pK2PWZfrbg@mail.gmail.com>
	<CAGfvhtn5Vs7oZivBi38UGjjWJCLnCC4n-CFXRJ=ShkW=gbqsMg@mail.gmail.com>
Message-ID: <CAGfvhtnzx1=R7kxFGpg=AZxcgSooJv85dXh7aaSjozfsdn_FjA@mail.gmail.com>

this seemed to fix itself when i had deleted the folder in appdata

but i also then had to re-install rabbitmq for it to come back to life

On Mon, Sep 3, 2012 at 9:42 PM, Wayne Douglas <wayne at prjatk.com> wrote:

> just spotted this in the other log:
>
> =CRASH REPORT==== 4-Sep-2012::21:36:07 ===
>   crasher:
>     initial call: application_master:init/4
>     pid: <0.100.0>
>     registered_name: []
>     exception exit: {bad_return,{{rabbit,start,[normal,[]]},
>                                  {'EXIT',{rabbit,failure_during_boot}}}}
>       in function  application_master:init/4 (application_master.erl, line
> 138)
>     ancestors: [<0.99.0>]
>     messages: [{'EXIT',<0.101.0>,normal}]
>     links: [<0.99.0>,<0.7.0>]
>     dictionary: []
>     trap_exit: true
>     status: running
>     heap_size: 2584
>     stack_size: 24
>     reductions: 249
>   neighbours:
>
>
> On Mon, Sep 3, 2012 at 9:41 PM, Wayne Douglas <wayne at prjatk.com> wrote:
>
>> Hi
>>
>> I'm new to RabbitMq but have had it running under MassTransit for a while
>> on a windows 8 machine.
>>
>> It now refuses to start - totally randomly i think.
>>
>> here is the log from trying to start:
>>
>>
>> =INFO REPORT==== 4-Sep-2012::21:35:36 ===
>> Limiting to approx 924 file handles (829 sockets)
>>
>> =ERROR REPORT==== 4-Sep-2012::21:36:06 ===
>> Timeout contacting cluster nodes. Since RabbitMQ was shut down forcefully
>> it cannot determine which nodes are timing out. Details on all nodes will
>> follow.
>>
>> DIAGNOSTICS
>> ===========
>>
>> nodes in question: [rabbit at Wayne]
>>
>> hosts, their running nodes and ports:
>> - Wayne: [{rabbit,1130}]
>>
>> current node details:
>> - node name: rabbit at WAYNE
>> - home dir: C:\Windows
>> - cookie hash: hlikexZ54F023PLCOi6sEg==
>>
>>
>>
>> =INFO REPORT==== 4-Sep-2012::21:36:07 ===
>>     application: rabbit
>>     exited: {bad_return,{{rabbit,start,[normal,[]]},
>>                          {'EXIT',{rabbit,failure_during_boot}}}}
>>     type: permanent
>>
>>
>> Like I said - up to now i've only had to install it and get going so not
>> really had to interact with rabbit at all - which is amazing! but now it's
>> playing up i'm completely lost so any help would be erally really
>> appreciated.
>>
>> Many thanks
>>
>> --
>> *--------------------*
>> *
>> *
>> *w://*
>> *
>> *
>> *t: 07525424882*
>> *
>> *
>> *--------------------*
>>
>>
>>
>
>
> --
> *--------------------*
> *
> *
> *w://*
> *
> *
> *t: 07525424882*
> *
> *
> *--------------------*
>
>
>


-- 
*--------------------*
*
*
*w://*
*
*
*t: 07525424882*
*
*
*--------------------*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120903/7df75416/attachment.htm>

From mmosiek at gmail.com  Sun Sep  2 21:54:11 2012
From: mmosiek at gmail.com (Malgorzata)
Date: Sun, 2 Sep 2012 13:54:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Multiple nodes on single box
In-Reply-To: <45F36EB1-50C6-465D-85C0-2AC88AD04504@rabbitmq.com>
References: <CAJ1FMH7OfLurQ65OsK2HWsWqF-f3-CG94Bm=MQQc4EfV3Ln1fg@mail.gmail.com>
	<4F71929C.7070009@rabbitmq.com>
	<530BEC3C-A08E-452A-9726-A4351AC3E920@rabbitmq.com>
	<CAJ1FMH7ADA+p5sqM6oTwfHfoBv8TdFzKZp=CXaFXnD+tC2gqEA@mail.gmail.com>
	<45F36EB1-50C6-465D-85C0-2AC88AD04504@rabbitmq.com>
Message-ID: <1346619251369-21752.post@n5.nabble.com>

Hello Steve
I would like to ask you for some help.  I tried your approach with reusing
core code to run RabbitMQ on two different ports on the same machine,
however each time I try to start up second server it freezes. I created the
wrappers for my two nodes (node1.sh and node2.sh in home directory)
containing info about distinct Node port and node name and list of
environmental variables pointing to the directory called node1/node2 with 
copies of the default content from mnesia as well as the copy of the
/etc/rabbitmq/enabled_plugins file.
What am I doing wrong? Please help. I really would like to make this set up
work... I appreciate any advice you may give me...
Regards
Malgorzata



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Multiple-nodes-on-single-box-tp3478p21752.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.justin at gmx.net  Tue Sep  4 07:51:43 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 04 Sep 2012 08:51:43 +0200
Subject: [rabbitmq-discuss] ANN: Habari Client for RabbitMQ - Delphi and
	Free Pascal client
Message-ID: <k248e1$rqt$1@ger.gmane.org>

September 4, 2012 - Habarisoft today released version 1.4 of Habari 
Client for RabbitMQ, a library which provides easy access to RabbitMQ, 
the open source messaging system.

With this library, Delphi and Free Pascal developers can build 
integrated solutions, using the peer-to-peer or the publish and 
subscribe communication model.

New in version 1.4:

* improved STOMP 1.1 support
* NACK support (negative ACK)
* tested with RabbitMQ 2.8.6
* tested with Indy 10.5.9
* upgraded to Synapse build 40
* many internal code improvements / refactorings
* improved and extended documentation
* Free Pascal / RTTI suppression fix
* Free Pascal / CommandLIneSupport fix
* fixes for potential memory leaks
* log hint "Closing a connection for you"

For special offers (bundles and discount coupon codes) please visit 
http://mikejustin.wordpress.com/

Home page and demo download:
http://www.habarisoft.com/habari_rabbitmq.html

Getting Started Guide (PDF):
http://www.habarisoft.com/download/HabariRabbitMQGettingStarted.pdf

Online API documentation:
http://www.habarisoft.com/habari_rabbitmq/1.4/docs/api

Regards
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From Sharon.Ben-Asher at AVG.com  Tue Sep  4 09:48:32 2012
From: Sharon.Ben-Asher at AVG.com (sharonbn)
Date: Tue, 4 Sep 2012 01:48:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Java client lib: up to 5 threads created in
 client when server publishes new message
In-Reply-To: <5044E0DB.2030807@rabbitmq.com>
References: <1346591180334-21751.post@n5.nabble.com>
	<5044DD9A.6060307@rabbitmq.com> <5044E0DB.2030807@rabbitmq.com>
Message-ID: <1346748512269-21764.post@n5.nabble.com>

thanks, your answer cleared the issue for me.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Java-client-lib-up-to-5-threads-created-in-client-when-server-publishes-new-message-tp21751p21764.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From andrea.rosa at hp.com  Tue Sep  4 09:53:56 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Tue, 4 Sep 2012 08:53:56 +0000
Subject: [rabbitmq-discuss] How to achieve HA consumers?
In-Reply-To: <50447B8F.5040907@rabbitmq.com>
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>	<87pq67gv2x.wl%francesco@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD5F8A62D0@G9W0721.americas.hpqcorp.net>
	<87mx17mp36.wl%francesco@rabbitmq.com> <50447B8F.5040907@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD5F8AF5AA@G4W3209.americas.hpqcorp.net>

Hi

Thanks for your replies (Francesco and Matthias).
Now it's clear so we need to start the "backup" consumer after the first one.

Regards
--
Andrea Rosa

>-----Original Message-----
>From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-
>discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthias Radestock
>Sent: 03 September 2012 10:43
>To: Discussions about RabbitMQ
>Subject: Re: [rabbitmq-discuss] How to achieve HA consumers?
>
>On 03/09/12 10:29, Francesco Mazzoli wrote:
>> That said, whoever wants to consume from the queue needs to consume
>from the
>> token queue first.  In the case of the OP, the main consumer will
>start first,
>> and the second right after it.  This way, the second will be blocked
>until the
>> first consumer dies/quits and the token message will be requeued.
>
>In pseudo code, this is what each consumer looks like:
>
>token_consumer = channel.basic_consume(token_queue)
>wait_for_consumer_message(token_consumer)
>main_consumer = channel.basic_consume(main_queue)
>while(true) {
>   msg = wait_for_consumer_msg(main_consumer)
>   process_message(msg)
>   channel.basic_ack(msg)
>}
>
>
>There is one snag with this: When a consumer dies, the order in which
>the token message and any pending "proper" messages are requeued is
>undefined. That means the consumer that is taking over might start
>consuming from the main queue before the unack'ed messages have been
>requeued. The messages will get requeued eventually, but they will be
>out of order.
>
>In practice, introducing a slight delay before consuming from the main
>queue should prevent this.
>
>
>Matthias.
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Ramachandrarao.K at saint-gobain.com  Tue Sep  4 10:51:49 2012
From: Ramachandrarao.K at saint-gobain.com (Ramachandrarao, K [ SGGI - IT ])
Date: Tue, 4 Sep 2012 15:21:49 +0530
Subject: [rabbitmq-discuss] Reg: File Transfer
Message-ID: <8A9DF2095351E74AB39CF6BF78F20CC904C6567F@L00EXCEC1.zl.if.atcsg.net>

Hello,

 

Currently  we are working in RabbitMQ 2.8.4 version with Python Client, 

 

We gone through the RabbitMQ documents, where we are not able to find
how to transfer the Files between the producer and consumer.

 

Requesting anyone can guide us to perform the file transfer.

 

Thanks and Regards

 

Ramachandra Rao K

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120904/15c74a86/attachment.htm>

From alexis at rabbitmq.com  Tue Sep  4 13:36:59 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 4 Sep 2012 13:36:59 +0100
Subject: [rabbitmq-discuss] Performance on ec2
In-Reply-To: <20120123174546.GA5753@rabbitmq.com>
References: <5CB32E73-E1B3-4DE0-B485-0AC204B2FA80@burtcorp.com>
	<CAM8fPiR0dB1TiHO2yvQNHyoi1M0c2+JFnJe6t2y_y2C4+7S=bQ@mail.gmail.com>
	<29734019-3327-406D-9338-596565E8C8DB@burtcorp.com>
	<CACOPnvdCKOmyn96EHqirYDmeiYNFcH-BMV4MGGxRVm6WJD1RBQ@mail.gmail.com>
	<B6C9B5CE-77B8-49A1-AD18-0745B6C1B5D5@burtcorp.com>
	<E3DA278C-ECCD-4D84-BDE2-1DA52B432D05@burtcorp.com>
	<20120123174546.GA5753@rabbitmq.com>
Message-ID: <CACOPnveGYj15-HKKktn64boHD52UyU3dwaxb_jK8k39t1G-PuA@mail.gmail.com>

Posting Srdan's latest numbers showing how RabbitMQ 2.8.6 does better

http://blog.burtcorp.com/post/30859143735/load-testing-rabbitmq-2-8-6



On Mon, Jan 23, 2012 at 5:45 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> Hi Srdan,
>
> In short, "yes, that's about it", especially on EC2. It would be worth
> checking your results with the hipe_compile option turned on with the
> latest Rabbit (2.7.1) and the latest Erlang (R15B). Search for
> hipe_compile on http://www.rabbitmq.com/configure.html
>
> Over loopback, with very very small message payloads, with hipe turned
> on, Rabbit can read off a single socket and throw the data away (i.e.
> no bindings from an exchange) at somewhere around 100kHz. Obviously
> depending on hardware. Also that figure might be a little old these
> days. As payload increases, and non-loopback, and non-hipe, and EC2
> issues, plus actually doing something with the messages such sending
> them first into queues, buffering them, and then sending them out to
> consumers, an overall throughput of around 20kHz is not unexpected.
>
> When we do a simple one-publisher, one-queue, one-consumer benchmark,
> until recently, the figures were something like 16kHz with 1-ack per
> message (no qos) and 25kHz with noAck turned on (autoack). Those figures
> are both in and out - i.e. 25kHz msgs in, and 25kHz msgs out. It's only
> due to a bunch of quite recent optimisations and getting hipe to work
> for us that those figures have improved a bit.
>
> If increasing publishing rate decreases consuming rate then you've hit a
> bottleneck somewhere. Either your CPUs are maxed out (or, if not then
> there must somewhere be some other reason why Rabbit can't utilise more
> CPU) or you've hit a network bottleneck or a disk bottleneck or
> something else.
>
> On a single machine, I'd be surprised if you can get close to 100kHz.
> Across a cluster it should be possible provided the load is spread
> across all the machines - don't forget a queue is a single process on a
> single node within the cluster so the maximum speed of an individual
> queue is determined by the speed of a single core on one machine. Thus
> if you need to go faster than a single core, then you have to spread the
> load across multiple queues. Once you max out the cores on a single
> machine, you'll need to go to multiple nodes.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michal at kiedys.net  Tue Sep  4 14:42:04 2012
From: michal at kiedys.net (=?ISO-8859-2?Q?Micha=B3_Ki=EAdy=B6?=)
Date: Tue, 4 Sep 2012 15:42:04 +0200
Subject: [rabbitmq-discuss] Startup error
In-Reply-To: <504117EC.5090203@rabbitmq.com>
References: <CAHFJS_V69x7WmnE_XzFR+nPzfFXJdZhR02jpYAwT7vz1QokNoA@mail.gmail.com>
	<4FFAACB4.1070303@rabbitmq.com>
	<CAHFJS_Ufrrc4oU+qO_dWYo6J3zRUE7mz0krQbk42vy2hLAZU2Q@mail.gmail.com>
	<504117EC.5090203@rabbitmq.com>
Message-ID: <CAHFJS_Wyy9CZ95Rej8K7+SiLASsR+kFS0Q8B2ApVLtG2fYmSpw@mail.gmail.com>

Matthias,

The problem appeared only when I tried to rejoin a node, that failed before
because of crash.
Disabling management_module or restarting machine was the only solution to
solve the problem.
Error log contained information, that the port used by the plugin was
already used.

Error occurred in version 2.8.4. I do not know if you still occurs because
since then I have not tested scenarios in which RabbitMQ was falling (Out
Of Memory).

Regards

2012/8/31 Matthias Radestock <matthias at rabbitmq.com>

> Micha?,
>
> On 10/07/12 12:59, Micha? Ki?dy? wrote:
>
>> 2012/7/9 Simon MacMullen <simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>>
>>
>>     On 09/07/12 08:54, Micha? Ki?dy? wrote:
>>
>>         What happened? IHMO It looks like management plugin problem.
>>
>>
>>     Hi. Thanks for the bug report, I'll look into it. Does this happen
>>     consistently? Is this in a cluster?
>>
>> Yes - this is part of a two-node server cluster.
>> Does not start only when the rabbitmq_management plugin is enabled.
>>
>
> Did you manage to resolve this problem in the end?
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120904/290ca718/attachment.htm>

From tim at rabbitmq.com  Tue Sep  4 17:02:49 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 4 Sep 2012 17:02:49 +0100
Subject: [rabbitmq-discuss] Reg: File Transfer
In-Reply-To: <8A9DF2095351E74AB39CF6BF78F20CC904C6567F@L00EXCEC1.zl.if.atcsg.net>
References: <8A9DF2095351E74AB39CF6BF78F20CC904C6567F@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <578563E8-2B80-43CE-B952-0968B2B90808@rabbitmq.com>

Hi

On 4 Sep 2012, at 10:51, Ramachandrarao, K [ SGGI - IT ] wrote:

> Hello,
>  
> Currently  we are working in RabbitMQ 2.8.4 version with Python Client,
>  
> We gone through the RabbitMQ documents, where we are not able to find how to transfer the Files between the producer and consumer.
>  
> Requesting anyone can guide us to perform the file transfer.

The contents of messages are opaque to rabbit, so just put the binary data into the message body and you're done.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120904/fc1ac5ac/attachment.htm>

From tim at rabbitmq.com  Tue Sep  4 17:07:28 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 4 Sep 2012 17:07:28 +0100
Subject: [rabbitmq-discuss] Multiple nodes on single box
In-Reply-To: <1346619251369-21752.post@n5.nabble.com>
References: <CAJ1FMH7OfLurQ65OsK2HWsWqF-f3-CG94Bm=MQQc4EfV3Ln1fg@mail.gmail.com>
	<4F71929C.7070009@rabbitmq.com>
	<530BEC3C-A08E-452A-9726-A4351AC3E920@rabbitmq.com>
	<CAJ1FMH7ADA+p5sqM6oTwfHfoBv8TdFzKZp=CXaFXnD+tC2gqEA@mail.gmail.com>
	<45F36EB1-50C6-465D-85C0-2AC88AD04504@rabbitmq.com>
	<1346619251369-21752.post@n5.nabble.com>
Message-ID: <E5FB233F-3161-46A1-BEB3-E30080C6B186@rabbitmq.com>


On 2 Sep 2012, at 21:54, Malgorzata wrote:

> Hello Steve
> I would like to ask you for some help.  I tried your approach with reusing
> core code to run RabbitMQ on two different ports on the same machine,
> however each time I try to start up second server it freezes. I created the
> wrappers for my two nodes (node1.sh and node2.sh in home directory)
> containing info about distinct Node port and node name and list of
> environmental variables pointing to the directory called node1/node2 with 
> copies of the default content from mnesia as well as the copy of the
> /etc/rabbitmq/enabled_plugins file.

What environment variables are you setting up in your script? Here's the list that I think you'll need to override:

RABBITMQ_LOG_BASE,
RABBITMQ_CONFIG_FILE,
RABBITMQ_PLUGINS_EXPAND_DIR
RABBITMQ_ENABLED_PLUGINS_FILE,
RABBITMQ_NODE_IP_ADDRESS,
RABBITMQ_ALLOW_INPUT,
RABBITMQ_NODENAME,
RABBITMQ_MNESIA_DIR,
RABBITMQ_PID_FILE,
RABBITMQ_NODE_PORT

And potentially some others, but that's a good start. Anyway the port is specified in RABBITMQ_NODE_PORT (note that there's another variable for SSL listeners).

> What am I doing wrong? Please help. I really would like to make this set up
> work... I appreciate any advice you may give me...

We'd need to see that startup logs and output of `rabbitmqctl -n <nodename> status` for the nodes to actually diagnose a problem.

From francesco at rabbitmq.com  Tue Sep  4 17:10:14 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 04 Sep 2012 17:10:14 +0100
Subject: [rabbitmq-discuss] Rabbit failing to start on windows 8
In-Reply-To: <CAGfvhtnzx1=R7kxFGpg=AZxcgSooJv85dXh7aaSjozfsdn_FjA@mail.gmail.com>
References: <CAGfvhtm0nbmKma4JFbK0PqyYeZLbnjJnZV_wM=w5pK2PWZfrbg@mail.gmail.com>
	<CAGfvhtn5Vs7oZivBi38UGjjWJCLnCC4n-CFXRJ=ShkW=gbqsMg@mail.gmail.com>
	<CAGfvhtnzx1=R7kxFGpg=AZxcgSooJv85dXh7aaSjozfsdn_FjA@mail.gmail.com>
Message-ID: <87ipbtn509.wl%francesco@rabbitmq.com>

At Mon, 3 Sep 2012 22:11:37 +0100,
Wayne Douglas wrote:
> this seemed to fix itself when i had deleted the folder in appdata
> 
> but i also then had to re-install rabbitmq for it to come back to life

The node you were trying to start was previously clustered, and the nodes that
it was clustered with were all offline, which causes the startup sequence to
fail.

Deleting the mnesia folder has the same effect as resetting the node, and for
that reason the node wasn't clustered anymore.

I doubt that re-installing had any effect, unless it deleted some mnesia files
as a side effect (I'm not familiar with the Windows installer).

--
Francesco * Often in error, never in doubt

From wayne at prjatk.com  Tue Sep  4 17:10:59 2012
From: wayne at prjatk.com (Wayne Douglas)
Date: Tue, 4 Sep 2012 17:10:59 +0100
Subject: [rabbitmq-discuss] Rabbit failing to start on windows 8
In-Reply-To: <87ipbtn509.wl%francesco@rabbitmq.com>
References: <CAGfvhtm0nbmKma4JFbK0PqyYeZLbnjJnZV_wM=w5pK2PWZfrbg@mail.gmail.com>
	<CAGfvhtn5Vs7oZivBi38UGjjWJCLnCC4n-CFXRJ=ShkW=gbqsMg@mail.gmail.com>
	<CAGfvhtnzx1=R7kxFGpg=AZxcgSooJv85dXh7aaSjozfsdn_FjA@mail.gmail.com>
	<87ipbtn509.wl%francesco@rabbitmq.com>
Message-ID: <CAGfvhtnoBAJQRtvwQq2FySzh3zVeK-WrB_h1seCxOYxTRH93_g@mail.gmail.com>

hmm

this is weird as it only ever ran as a single instance on my laptop...

On Tue, Sep 4, 2012 at 5:10 PM, Francesco Mazzoli <francesco at rabbitmq.com>wrote:

> At Mon, 3 Sep 2012 22:11:37 +0100,
> Wayne Douglas wrote:
> > this seemed to fix itself when i had deleted the folder in appdata
> >
> > but i also then had to re-install rabbitmq for it to come back to life
>
> The node you were trying to start was previously clustered, and the nodes
> that
> it was clustered with were all offline, which causes the startup sequence
> to
> fail.
>
> Deleting the mnesia folder has the same effect as resetting the node, and
> for
> that reason the node wasn't clustered anymore.
>
> I doubt that re-installing had any effect, unless it deleted some mnesia
> files
> as a side effect (I'm not familiar with the Windows installer).
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
*--------------------*
*
*
*w://*
*
*
*t: 07525424882*
*
*
*--------------------*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120904/83e95fe7/attachment.htm>

From tim at rabbitmq.com  Tue Sep  4 17:11:20 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 4 Sep 2012 17:11:20 +0100
Subject: [rabbitmq-discuss] Multiple nodes on single box
In-Reply-To: <E5FB233F-3161-46A1-BEB3-E30080C6B186@rabbitmq.com>
References: <CAJ1FMH7OfLurQ65OsK2HWsWqF-f3-CG94Bm=MQQc4EfV3Ln1fg@mail.gmail.com>
	<4F71929C.7070009@rabbitmq.com>
	<530BEC3C-A08E-452A-9726-A4351AC3E920@rabbitmq.com>
	<CAJ1FMH7ADA+p5sqM6oTwfHfoBv8TdFzKZp=CXaFXnD+tC2gqEA@mail.gmail.com>
	<45F36EB1-50C6-465D-85C0-2AC88AD04504@rabbitmq.com>
	<1346619251369-21752.post@n5.nabble.com>
	<E5FB233F-3161-46A1-BEB3-E30080C6B186@rabbitmq.com>
Message-ID: <E98891A1-A39C-44DC-AF88-5A730141FB2F@rabbitmq.com>

Hmn, actually come to think of it I'm probably being a bit over zealous there, as many of those are keyed off the node name. *BUT* you will need to set RABBITMQ_NODENAME and RABBITMQ_NODE_PORT for sure.

On 4 Sep 2012, at 17:07, Tim Watson wrote:

> 
> On 2 Sep 2012, at 21:54, Malgorzata wrote:
> 
>> Hello Steve
>> I would like to ask you for some help.  I tried your approach with reusing
>> core code to run RabbitMQ on two different ports on the same machine,
>> however each time I try to start up second server it freezes. I created the
>> wrappers for my two nodes (node1.sh and node2.sh in home directory)
>> containing info about distinct Node port and node name and list of
>> environmental variables pointing to the directory called node1/node2 with 
>> copies of the default content from mnesia as well as the copy of the
>> /etc/rabbitmq/enabled_plugins file.
> 
> What environment variables are you setting up in your script? Here's the list that I think you'll need to override:
> 
> RABBITMQ_LOG_BASE,
> RABBITMQ_CONFIG_FILE,
> RABBITMQ_PLUGINS_EXPAND_DIR
> RABBITMQ_ENABLED_PLUGINS_FILE,
> RABBITMQ_NODE_IP_ADDRESS,
> RABBITMQ_ALLOW_INPUT,
> RABBITMQ_NODENAME,
> RABBITMQ_MNESIA_DIR,
> RABBITMQ_PID_FILE,
> RABBITMQ_NODE_PORT
> 
> And potentially some others, but that's a good start. Anyway the port is specified in RABBITMQ_NODE_PORT (note that there's another variable for SSL listeners).
> 
>> What am I doing wrong? Please help. I really would like to make this set up
>> work... I appreciate any advice you may give me...
> 
> We'd need to see that startup logs and output of `rabbitmqctl -n <nodename> status` for the nodes to actually diagnose a problem.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Tue Sep  4 17:12:31 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 4 Sep 2012 17:12:31 +0100
Subject: [rabbitmq-discuss] Multiple nodes on single box
In-Reply-To: <E98891A1-A39C-44DC-AF88-5A730141FB2F@rabbitmq.com>
References: <CAJ1FMH7OfLurQ65OsK2HWsWqF-f3-CG94Bm=MQQc4EfV3Ln1fg@mail.gmail.com>
	<4F71929C.7070009@rabbitmq.com>
	<530BEC3C-A08E-452A-9726-A4351AC3E920@rabbitmq.com>
	<CAJ1FMH7ADA+p5sqM6oTwfHfoBv8TdFzKZp=CXaFXnD+tC2gqEA@mail.gmail.com>
	<45F36EB1-50C6-465D-85C0-2AC88AD04504@rabbitmq.com>
	<1346619251369-21752.post@n5.nabble.com>
	<E5FB233F-3161-46A1-BEB3-E30080C6B186@rabbitmq.com>
	<E98891A1-A39C-44DC-AF88-5A730141FB2F@rabbitmq.com>
Message-ID: <65E9D922-E3E1-40AD-AB9F-9468BDBE2696@rabbitmq.com>

And don't copy anything from the mnesia directories. That shouldn't be necessary.

On 4 Sep 2012, at 17:11, Tim Watson wrote:

> Hmn, actually come to think of it I'm probably being a bit over zealous there, as many of those are keyed off the node name. *BUT* you will need to set RABBITMQ_NODENAME and RABBITMQ_NODE_PORT for sure.
> 
> On 4 Sep 2012, at 17:07, Tim Watson wrote:
> 
>> 
>> On 2 Sep 2012, at 21:54, Malgorzata wrote:
>> 
>>> Hello Steve
>>> I would like to ask you for some help.  I tried your approach with reusing
>>> core code to run RabbitMQ on two different ports on the same machine,
>>> however each time I try to start up second server it freezes. I created the
>>> wrappers for my two nodes (node1.sh and node2.sh in home directory)
>>> containing info about distinct Node port and node name and list of
>>> environmental variables pointing to the directory called node1/node2 with 
>>> copies of the default content from mnesia as well as the copy of the
>>> /etc/rabbitmq/enabled_plugins file.
>> 
>> What environment variables are you setting up in your script? Here's the list that I think you'll need to override:
>> 
>> RABBITMQ_LOG_BASE,
>> RABBITMQ_CONFIG_FILE,
>> RABBITMQ_PLUGINS_EXPAND_DIR
>> RABBITMQ_ENABLED_PLUGINS_FILE,
>> RABBITMQ_NODE_IP_ADDRESS,
>> RABBITMQ_ALLOW_INPUT,
>> RABBITMQ_NODENAME,
>> RABBITMQ_MNESIA_DIR,
>> RABBITMQ_PID_FILE,
>> RABBITMQ_NODE_PORT
>> 
>> And potentially some others, but that's a good start. Anyway the port is specified in RABBITMQ_NODE_PORT (note that there's another variable for SSL listeners).
>> 
>>> What am I doing wrong? Please help. I really would like to make this set up
>>> work... I appreciate any advice you may give me...
>> 
>> We'd need to see that startup logs and output of `rabbitmqctl -n <nodename> status` for the nodes to actually diagnose a problem.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


From francesco at rabbitmq.com  Tue Sep  4 17:16:20 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 04 Sep 2012 17:16:20 +0100
Subject: [rabbitmq-discuss] Rabbit failing to start on windows 8
In-Reply-To: <CAGfvhtnoBAJQRtvwQq2FySzh3zVeK-WrB_h1seCxOYxTRH93_g@mail.gmail.com>
References: <CAGfvhtm0nbmKma4JFbK0PqyYeZLbnjJnZV_wM=w5pK2PWZfrbg@mail.gmail.com>
	<CAGfvhtn5Vs7oZivBi38UGjjWJCLnCC4n-CFXRJ=ShkW=gbqsMg@mail.gmail.com>
	<CAGfvhtnzx1=R7kxFGpg=AZxcgSooJv85dXh7aaSjozfsdn_FjA@mail.gmail.com>
	<87ipbtn509.wl%francesco@rabbitmq.com>
	<CAGfvhtnoBAJQRtvwQq2FySzh3zVeK-WrB_h1seCxOYxTRH93_g@mail.gmail.com>
Message-ID: <87hardn4q3.wl%francesco@rabbitmq.com>

At Tue, 4 Sep 2012 17:10:59 +0100,
Wayne Douglas wrote:
> hmm
> 
> this is weird as it only ever ran as a single instance on my laptop...

Well, that message arises when mnesia is trying to contact tables on offline
nodes.  That would not happen unless the node is clustered.

--
Francesco * Often in error, never in doubt

From wayne at prjatk.com  Tue Sep  4 17:18:41 2012
From: wayne at prjatk.com (Wayne Douglas)
Date: Tue, 4 Sep 2012 17:18:41 +0100
Subject: [rabbitmq-discuss] Rabbit failing to start on windows 8
In-Reply-To: <87hardn4q3.wl%francesco@rabbitmq.com>
References: <CAGfvhtm0nbmKma4JFbK0PqyYeZLbnjJnZV_wM=w5pK2PWZfrbg@mail.gmail.com>
	<CAGfvhtn5Vs7oZivBi38UGjjWJCLnCC4n-CFXRJ=ShkW=gbqsMg@mail.gmail.com>
	<CAGfvhtnzx1=R7kxFGpg=AZxcgSooJv85dXh7aaSjozfsdn_FjA@mail.gmail.com>
	<87ipbtn509.wl%francesco@rabbitmq.com>
	<CAGfvhtnoBAJQRtvwQq2FySzh3zVeK-WrB_h1seCxOYxTRH93_g@mail.gmail.com>
	<87hardn4q3.wl%francesco@rabbitmq.com>
Message-ID: <CAGfvht=YN8zDxJA3BS4K0JNzO73XghzLETNokG5s9HgAn-mk7A@mail.gmail.com>

hmmm

sounds like masstransit might be doing something wrong...

On Tue, Sep 4, 2012 at 5:16 PM, Francesco Mazzoli <francesco at rabbitmq.com>wrote:

> At Tue, 4 Sep 2012 17:10:59 +0100,
> Wayne Douglas wrote:
> > hmm
> >
> > this is weird as it only ever ran as a single instance on my laptop...
>
> Well, that message arises when mnesia is trying to contact tables on
> offline
> nodes.  That would not happen unless the node is clustered.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
*--------------------*
*
*
*w://*
*
*
*t: 07525424882*
*
*
*--------------------*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120904/0ae177cd/attachment.htm>

From francesco at rabbitmq.com  Tue Sep  4 17:23:42 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 04 Sep 2012 17:23:42 +0100
Subject: [rabbitmq-discuss] Rabbit failing to start on windows 8
In-Reply-To: <CAGfvht=YN8zDxJA3BS4K0JNzO73XghzLETNokG5s9HgAn-mk7A@mail.gmail.com>
References: <CAGfvhtm0nbmKma4JFbK0PqyYeZLbnjJnZV_wM=w5pK2PWZfrbg@mail.gmail.com>
	<CAGfvhtn5Vs7oZivBi38UGjjWJCLnCC4n-CFXRJ=ShkW=gbqsMg@mail.gmail.com>
	<CAGfvhtnzx1=R7kxFGpg=AZxcgSooJv85dXh7aaSjozfsdn_FjA@mail.gmail.com>
	<87ipbtn509.wl%francesco@rabbitmq.com>
	<CAGfvhtnoBAJQRtvwQq2FySzh3zVeK-WrB_h1seCxOYxTRH93_g@mail.gmail.com>
	<87hardn4q3.wl%francesco@rabbitmq.com>
	<CAGfvht=YN8zDxJA3BS4K0JNzO73XghzLETNokG5s9HgAn-mk7A@mail.gmail.com>
Message-ID: <87fw6xn4dt.wl%francesco@rabbitmq.com>

At Tue, 4 Sep 2012 17:18:41 +0100,
Wayne Douglas wrote:
> hmmm
> 
> sounds like masstransit might be doing something wrong...

There is another option, if you're messing with env variables: using the mnesia
directory that was used previously by some node with a different hostname.

However, this won't happen unless you manually set the mnesia directory, since
by default the dir name is based on the hostname.

--
Francesco * Often in error, never in doubt

From tim at rabbitmq.com  Tue Sep  4 17:24:44 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 4 Sep 2012 17:24:44 +0100
Subject: [rabbitmq-discuss] message timestamp assigned by rabbitmq?
In-Reply-To: <e8e89b99-9ba5-4d53-b752-4f8c6d07073c@googlegroups.com>
References: <e8e89b99-9ba5-4d53-b752-4f8c6d07073c@googlegroups.com>
Message-ID: <681B056C-E83B-41A5-AF19-631145AF3F2C@rabbitmq.com>


On 1 Sep 2012, at 02:09, Wes wrote:

> When a message is sent to an exchange, does the time of acceptance get recorded?

No this information is not added by the broker.

From wayne at prjatk.com  Tue Sep  4 17:30:21 2012
From: wayne at prjatk.com (Wayne Douglas)
Date: Tue, 4 Sep 2012 17:30:21 +0100
Subject: [rabbitmq-discuss] Rabbit failing to start on windows 8
In-Reply-To: <87fw6xn4dt.wl%francesco@rabbitmq.com>
References: <CAGfvhtm0nbmKma4JFbK0PqyYeZLbnjJnZV_wM=w5pK2PWZfrbg@mail.gmail.com>
	<CAGfvhtn5Vs7oZivBi38UGjjWJCLnCC4n-CFXRJ=ShkW=gbqsMg@mail.gmail.com>
	<CAGfvhtnzx1=R7kxFGpg=AZxcgSooJv85dXh7aaSjozfsdn_FjA@mail.gmail.com>
	<87ipbtn509.wl%francesco@rabbitmq.com>
	<CAGfvhtnoBAJQRtvwQq2FySzh3zVeK-WrB_h1seCxOYxTRH93_g@mail.gmail.com>
	<87hardn4q3.wl%francesco@rabbitmq.com>
	<CAGfvht=YN8zDxJA3BS4K0JNzO73XghzLETNokG5s9HgAn-mk7A@mail.gmail.com>
	<87fw6xn4dt.wl%francesco@rabbitmq.com>
Message-ID: <4905660643445443272@unknownmsgid>

None of the above that I am aware of. I'll post some questions to the
mt mailing list....

Sent from my iPhone

On 4 Sep 2012, at 17:23, Francesco Mazzoli <francesco at rabbitmq.com> wrote:

> At Tue, 4 Sep 2012 17:18:41 +0100,
> Wayne Douglas wrote:
>> hmmm
>>
>> sounds like masstransit might be doing something wrong...
>
> There is another option, if you're messing with env variables: using the mnesia
> directory that was used previously by some node with a different hostname.
>
> However, this won't happen unless you manually set the mnesia directory, since
> by default the dir name is based on the hostname.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Tue Sep  4 17:52:28 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 4 Sep 2012 09:52:28 -0700
Subject: [rabbitmq-discuss] Question on ordering of basic.return and
	CommitOK.
Message-ID: <CACLE7ixdUbZm2+e97=hxDydbLHQCUpDNM=gdpxGyuFa=hTLr6g@mail.gmail.com>

I've recently added support in my (Pika-based) code for returned message
support. It's generally working as expected, but there's one question about
the ordering of data from the broker.

The scenario: I'm publishing a message to a non-existent queue. My channel
is in transaction mode, so I'm calling channel.tx_commit() after
channel.basic_publish. I've registered a callback handler for return
messages ( channel.add_on_return_callback() )

What I'm seeing is that the basic.return message comes back from the broker
and enters my callback *before* the channel.tx_commit() returns.
Conceptually I'm fine with this. My understanding is that the basic_return
from the broker is expected to be asynchronous.

However, my question is: Is this ordering guaranteed? Can/will the broker
always send the basic.return before sending the commitOK message? Or could
a client see a CommitOK indicating the broker has the message, and then 10
seconds later see the basic.return?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120904/63213eaf/attachment.htm>

From matthias at rabbitmq.com  Tue Sep  4 17:58:30 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 04 Sep 2012 17:58:30 +0100
Subject: [rabbitmq-discuss] Question on ordering of basic.return and
	CommitOK.
In-Reply-To: <CACLE7ixdUbZm2+e97=hxDydbLHQCUpDNM=gdpxGyuFa=hTLr6g@mail.gmail.com>
References: <CACLE7ixdUbZm2+e97=hxDydbLHQCUpDNM=gdpxGyuFa=hTLr6g@mail.gmail.com>
Message-ID: <50463336.2080209@rabbitmq.com>

Matt,

On 04/09/12 17:52, Matt Pietrek wrote:
> Can/will the broker always send the basic.return before sending the
> commitOK message?

 From http://www.rabbitmq.com/confirms.html
<quote>
Unroutable mandatory or immediate messages are confirmed right after the
basic.return.
</quote>

So yes, the order is guaranteed.

Matthias.

From simon at rabbitmq.com  Tue Sep  4 18:02:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 04 Sep 2012 18:02:35 +0100
Subject: [rabbitmq-discuss] Question on ordering of basic.return
	and	CommitOK.
In-Reply-To: <50463336.2080209@rabbitmq.com>
References: <CACLE7ixdUbZm2+e97=hxDydbLHQCUpDNM=gdpxGyuFa=hTLr6g@mail.gmail.com>
	<50463336.2080209@rabbitmq.com>
Message-ID: <5046342B.1060200@rabbitmq.com>

On 04/09/12 17:58, Matthias Radestock wrote:
> Unroutable mandatory or immediate messages are confirmed right after the
> basic.return.

Of course the OP was asking about tx. But we have the same guarantee there.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mpietrek at skytap.com  Tue Sep  4 18:05:51 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 4 Sep 2012 10:05:51 -0700
Subject: [rabbitmq-discuss] Question on ordering of basic.return and
	CommitOK.
In-Reply-To: <5046342B.1060200@rabbitmq.com>
References: <CACLE7ixdUbZm2+e97=hxDydbLHQCUpDNM=gdpxGyuFa=hTLr6g@mail.gmail.com>
	<50463336.2080209@rabbitmq.com> <5046342B.1060200@rabbitmq.com>
Message-ID: <CACLE7ixb+JK+p=BJbh+t_eoisc9KixDbj+7jtDt13jQgALjjmA@mail.gmail.com>

Excellent. Thanks for the quick responses guys!

On Tue, Sep 4, 2012 at 10:02 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 04/09/12 17:58, Matthias Radestock wrote:
>
>> Unroutable mandatory or immediate messages are confirmed right after the
>> basic.return.
>>
>
> Of course the OP was asking about tx. But we have the same guarantee there.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120904/e6328f38/attachment.htm>

From matthewlmcclure at gmail.com  Tue Sep  4 22:51:33 2012
From: matthewlmcclure at gmail.com (Matt McClure)
Date: Tue, 4 Sep 2012 17:51:33 -0400
Subject: [rabbitmq-discuss] epel erlang repo package dependencies
In-Reply-To: <CAJELnLE2ez0h6wz0YR_J=b7c_WnkO1PVhwmjrSWU14Hb8qqn5A@mail.gmail.com>
References: <CAJELnLE2ez0h6wz0YR_J=b7c_WnkO1PVhwmjrSWU14Hb8qqn5A@mail.gmail.com>
Message-ID: <CAJELnLHartaTixhSj1=sEQ45T6-Y9fhRddJAv90=su9uhFZM-A@mail.gmail.com>

I just enabled the EPEL erlang repo
<http://repos.fedorapeople.org/repos/peter/erlang/epel-$releasever/$basearch/>
and I was suprised to see the next `yum -y upgrade` install a slew of
audio and video related packages. It looks like erlang-wx and possibly
others require them, and that erlang requires all of the erlang-*
packages. Is there a way to install a leaner erlang via the RPMs?

Thanks,
Matt

***

[root at vagrant-centos-5-8 rabbitmq]# rpm -e libtheora
error: Failed dependencies:
        libtheora.so.0()(64bit) is needed by (installed)
gstreamer-plugins-base-0.10.20-3.0.1.el5_3.x86_64
        libtheora.so.0(libtheora.so.1.0)(64bit) is needed by
(installed) gstreamer-plugins-base-0.10.20-3.0.1.el5_3.x86_64
[root at vagrant-centos-5-8 rabbitmq]# rpm -e gstreamer
error: Failed dependencies:
        libgstbase-0.10.so.0()(64bit) is needed by (installed)
gstreamer-plugins-base-0.10.20-3.0.1.el5_3.x86_64
        libgstcontroller-0.10.so.0()(64bit) is needed by (installed)
gstreamer-plugins-base-0.10.20-3.0.1.el5_3.x86_64
        libgstdataprotocol-0.10.so.0()(64bit) is needed by (installed)
gstreamer-plugins-base-0.10.20-3.0.1.el5_3.x86_64
        libgstreamer-0.10.so.0()(64bit) is needed by (installed)
gstreamer-plugins-base-0.10.20-3.0.1.el5_3.x86_64
        libgstreamer-0.10.so.0()(64bit) is needed by (installed)
wxGTK-2.8.12-1.el5.x86_64
        gstreamer >= 0.10.20 is needed by (installed)
gstreamer-plugins-base-0.10.20-3.0.1.el5_3.x86_64
[root at vagrant-centos-5-8 rabbitmq]# rpm -e wxGTK
error: Failed dependencies:
        libwx_gtk2u_adv-2.8.so.0()(64bit) is needed by (installed)
erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_adv-2.8.so.0(WXU_2.8)(64bit) is needed by
(installed) erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_aui-2.8.so.0()(64bit) is needed by (installed)
erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_aui-2.8.so.0(WXU_2.8)(64bit) is needed by
(installed) erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_aui-2.8.so.0(WXU_2.8.5)(64bit) is needed by
(installed) erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_core-2.8.so.0()(64bit) is needed by (installed)
wxGTK-gl-2.8.12-1.el5.x86_64
        libwx_gtk2u_core-2.8.so.0()(64bit) is needed by (installed)
erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_core-2.8.so.0(WXU_2.8)(64bit) is needed by
(installed) wxGTK-gl-2.8.12-1.el5.x86_64
        libwx_gtk2u_core-2.8.so.0(WXU_2.8)(64bit) is needed by
(installed) erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_html-2.8.so.0()(64bit) is needed by (installed)
erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_html-2.8.so.0(WXU_2.8)(64bit) is needed by
(installed) erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_stc-2.8.so.0()(64bit) is needed by (installed)
erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_stc-2.8.so.0(WXU_2.8)(64bit) is needed by
(installed) erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_xrc-2.8.so.0()(64bit) is needed by (installed)
erlang-wx-R14B-04.1.el5.x86_64
        libwx_gtk2u_xrc-2.8.so.0(WXU_2.8)(64bit) is needed by
(installed) erlang-wx-R14B-04.1.el5.x86_64
        wxGTK = 2.8.12-1.el5 is needed by (installed)
wxGTK-gl-2.8.12-1.el5.x86_64


-- 
Matt McClure
http://www.matthewlmcclure.com
http://www.mapmyfitness.com/profile/matthewlmcclure

From ake.kullenberg at gmail.com  Wed Sep  5 01:43:50 2012
From: ake.kullenberg at gmail.com (c00kiemonster)
Date: Tue, 4 Sep 2012 17:43:50 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I avoid write buffer warnings for non
	persistant messaging?
Message-ID: <ea97abea-fc9d-4339-9b33-a9b6c2f3cfed@ql4g2000pbc.googlegroups.com>

I am using pika to communicate between server instances on a linux
server and client instances on windows workstations. I had some issues
with SelectConnection that disappeared when I switched to
BlockingConnection but now I only have one issue left, write buffer
warnings.

I don't need messages to be persistant, and I don't need exchanges and
queues to survive a restart of the rabbitmq server. So after reading
up on AMQP I changed all exchanges (only using topic exchanges) and
queues to be non durable and with auto_delete set to True. All
messages are sent as non persistant and they are consumed with no_ack
set to True. I have confirmed the exchange and queue settings are
correct with rabbitmqctl and all messages received are verified to
have deliver_mode set to 1. So far so good.

But when I start the server instance before the client, ie, the server
instance sends out messages with routing keys that there are no
receivers for, I get write buffer warnings like this one:

2012-09-04 09:05:29,402 - server.STDERR - ERROR - /usr/local/lib/
python2.7/dist-packages/pika-0.9.5-py2.7.egg/pika/connection.py:650:
UserWarning: Pika: Write buffer exceeded warning threshold at 1595
bytes and an estimated 10 frames behind

Am I misunderstanding something here? Because my messages are not
persistant and the exchanges and queues are non durable I would expect
rabbitmq to simply discard messages sent with routing keys that are
without any receiver.

Could someone please explain / help out?

Thanks much!

From gladed at gmail.com  Wed Sep  5 04:01:38 2012
From: gladed at gmail.com (Glade)
Date: Tue, 4 Sep 2012 20:01:38 -0700 (PDT)
Subject: [rabbitmq-discuss] AWS clustering
Message-ID: <9865146e-11da-4ffb-880f-5d51244a792f@googlegroups.com>

Hi all,

In a project I'm working on we set up a cluster of application nodes, each 
with RabbitMQ installed. Everybody can talk to everybody, and we can scale 
the number of nodes pretty easily. But on more than one occasion, we have 
seen mnesia become partitioned. You've seen this before:

*Mnesia('rabbit at app-6'): ** ERROR ** mnesia_event got 
{inconsistent_database, running_partitioned_network, 'rabbit at app-5'}*


As best as we can tell, this is caused by temporary network outages, or 
possibly high-load conditions, or possibly the nexus of both. However it 
happens, you end up with one or more nodes down for the count with 
non-deterministic behavior (messages sent to that node may or may not reach 
other nodes). It doesn't recover until you *manually* stop_app/start_app. 
And if it happened to be a disc node, *rm -rf 
/var/lib/rabbitmq/mnesia/rabbitmq/** in between.

For a supposedly "just works" kind of service, that is just not good 
enough. I can't have my ops people rolling out of bed to take action every 
time there's a minor network glitch. So, I either need to provide a network 
that never becomes partitioned (does such a network exist? Certainly not at 
AWS!), or I need to drop clustering and have a single RabbitMQ server which 
won't scale, or I need to cobble together some kind of automated supervisor 
which is certain not to handle all cases, or I need to use a different 
messaging tool.

Please, somebody dispute my conclusion because I would love to continue 
using RabbitMQ.

Best regards,
Glade


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120904/ed3a8ae9/attachment.htm>

From johnson at edocom.cn  Wed Sep  5 05:32:05 2012
From: johnson at edocom.cn (johnson)
Date: Wed, 5 Sep 2012 12:32:05 +0800
Subject: [rabbitmq-discuss] How to achieve HA consumers?
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>
	<87pq67gv2x.wl%francesco@rabbitmq.com>, 
	<5040A283.9010901@rabbitmq.com>
Message-ID: <201209051232051717314@edocom.cn>

Thanks Matthias and Francesco.

Your second approach is prefect and should work fine. I will choose this approach.

However, I have little concern about the first approach. The channel.queueDeclarePassive method returns the consumer count of the specified channel, but the total number of the consumers connected to the rabbitmq server. So if I start two consumers using the following code in two different machines, i.e., two different JVMs, each consumer needs to create a new connection and a new channel. In this way, the channel.queueDeclarePassive method always return the consumer count == 1, not 2. 

  factory = new ConnectionFactory();
  connection = factory.newConnection(address);
  channel = connection.createChannel();

I also try to find a API that can retrieve the existing connection or channel. Then the second consumer can reuse the connection or channel the first consumer created. But it seems no such APIs.




johnson

From: Matthias Radestock
Date: 2012-08-31 19:39
To: Discussions about RabbitMQ
CC: Francesco Mazzoli; johnson
Subject: Re: [rabbitmq-discuss] How to achieve HA consumers?
On 31/08/12 12:27, Francesco Mazzoli wrote:
>    * The second consumer polls the first in some way and starts consuming when it
>      realises the first consumer is dead.  This is simple and should serve you
>      right, but it's not that nice performance wise.

A passive queue.declare, which returns the consumer_count could 
accomplish this. You'd need to be mindful of races when consumers start up.

>    * You create a second queue that we'll call "token queue", and you publish one
>      dummy message in it, with acks enabled.  Then, a consumer wishing to consume
>      from your queue, will:
>
>        - Consume from the token queue

More specifically, start consuming and wait for the token message to 
arrive. And then...

>        - Start consuming from the actual queue
>        - When shutting down, publish a dummy message to the token queue

No need for the last step (and in fact it will lead to token 
duplication). Simply leave the message unack'ed and let the automatic 
requeue on connection closure/failure take care of the rest.

Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/33efe343/attachment.htm>

From anirudh.seshagirisa at oneconvergence.com  Wed Sep  5 07:47:54 2012
From: anirudh.seshagirisa at oneconvergence.com (Anirudh Seshagirisa)
Date: Wed, 5 Sep 2012 12:17:54 +0530
Subject: [rabbitmq-discuss] Sample C code request
Message-ID: <CAPx-iUJ+Q9zs5cfFES6ZKgpatv+iBPh6NUYnET56tsgqjDCSbA@mail.gmail.com>

Can u send me a sample Producer and Consumer code in C language. I am a
beginner to RabbitMQ.


Thank you

Anirudh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/3c6b8741/attachment.htm>

From Dhinesh.P at saint-gobain.com  Wed Sep  5 08:13:30 2012
From: Dhinesh.P at saint-gobain.com (Dhinesh, P [ Maples - IT ])
Date: Wed, 5 Sep 2012 12:43:30 +0530
Subject: [rabbitmq-discuss]  Reg: File Transfer
Message-ID: <00946F8B780BAB43A04111EEAA7B47F6038FEB41@L00EXCEC1.zl.if.atcsg.net>

 

Hello Tim,

 

If the file transfer is possible in RabbitMQ 2.8.4 using Python 2.7
between producer to consumer.

 

Kindly help us, how we can proceed....

 

Have you any procedure for our query, pls share it...

 

We are waiting for your reply ASAP.....

 

Thanks and Regards,

 

Dhinesh P   

 

From: Tim Watson [mailto:tim at rabbitmq.com] 
Sent: Tuesday, September 04, 2012 9:33 PM
To: Discussions about RabbitMQ
Cc: Dhinesh, P [ Maples - IT ]
Subject: Re: [rabbitmq-discuss] Reg: File Transfer

 

Hi

 

On 4 Sep 2012, at 10:51, Ramachandrarao, K [ SGGI - IT ] wrote:

 

Hello,

 

Currently  we are working in RabbitMQ 2.8.4 version with Python Client,

 

We gone through the RabbitMQ documents, where we are not able to find
how to transfer the Files between the producer and consumer.

 

Requesting anyone can guide us to perform the file transfer.

 

The contents of messages are opaque to rabbit, so just put the binary
data into the message body and you're done.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/c5cf812c/attachment.htm>

From tim at rabbitmq.com  Wed Sep  5 08:27:32 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 5 Sep 2012 08:27:32 +0100
Subject: [rabbitmq-discuss] Reg: File Transfer
In-Reply-To: <00946F8B780BAB43A04111EEAA7B47F6038FE6FE@L00EXCEC1.zl.if.atcsg.net>
References: <8A9DF2095351E74AB39CF6BF78F20CC904C6567F@L00EXCEC1.zl.if.atcsg.net>
	<578563E8-2B80-43CE-B952-0968B2B90808@rabbitmq.com>
	<00946F8B780BAB43A04111EEAA7B47F6038FE6FE@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <B9A3E247-3DAD-40E2-9C91-C0BF3244954B@rabbitmq.com>

Take a look at https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/emit_log.py and https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/python/receive_logs.py. Now just read the file in to the message body before publishing.

On 5 Sep 2012, at 05:28, Dhinesh, P [ Maples - IT ] wrote:

> Hello Tim,
>  
> If the file transfer is possible in RabbitMQ 2.8.4 using Python 2.7 between producer to consumer.
>  
> Kindly help us, how we can proceed?.
>  
> Have you any procedure for our query, pls share it?
>  
> We are waiting for your reply ASAP?..
>  
> Thanks and Regards,
>  
> Dhinesh P   
>  
> From: Tim Watson [mailto:tim at rabbitmq.com] 
> Sent: Tuesday, September 04, 2012 9:33 PM
> To: Discussions about RabbitMQ
> Cc: Dhinesh, P [ Maples - IT ]
> Subject: Re: [rabbitmq-discuss] Reg: File Transfer
>  
> Hi
>  
> On 4 Sep 2012, at 10:51, Ramachandrarao, K [ SGGI - IT ] wrote:
> 
> 
> Hello,
>  
> Currently  we are working in RabbitMQ 2.8.4 version with Python Client,
>  
> We gone through the RabbitMQ documents, where we are not able to find how to transfer the Files between the producer and consumer.
>  
> Requesting anyone can guide us to perform the file transfer.
>  
> The contents of messages are opaque to rabbit, so just put the binary data into the message body and you're done.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/fc6a58b4/attachment.htm>

From matthias at rabbitmq.com  Wed Sep  5 08:48:09 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 05 Sep 2012 08:48:09 +0100
Subject: [rabbitmq-discuss] How to achieve HA consumers?
In-Reply-To: <201209051232051717314@edocom.cn>
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>
	<87pq67gv2x.wl%francesco@rabbitmq.com>,
	<5040A283.9010901@rabbitmq.com> <201209051232051717314@edocom.cn>
Message-ID: <504703B9.7080900@rabbitmq.com>

Johnson,

On 05/09/12 05:32, johnson wrote:
> The channel.queueDeclarePassive method returns the consumer count of
>  the specified channel,

No it doesn't. queue.declarePassive returns the total number of active
consumers of the queue at that point in time. Regardless of what
connection/channel they were created on.

That should be pretty clear from the docs -
http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok.consumer-count
- which make no mention of the count being connection/channel specific.

> So if I start two consumers [...] in two different machines [...] the
> channel.queueDeclarePassive method always return the consumer count
> == 1, not 2.

I am not sure what you are expecting to see here. If you start two
consumers, the count they will see prior to consuming will be 0 or 1.

As mentioned "You'd need to be mindful of races when consumers start 
up.", i.e. if both consumers start up near simultaneously then they will 
both see a count of 0.

> I also try to find a API that can retrieve the existing connection or
> channel. Then the second consumer can reuse the connection or channel
> the first consumer created. But it seems no such APIs.

A connection represents a point-to-point TCP connection. You can't 
"reuse" that from a third point.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed Sep  5 08:49:23 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 05 Sep 2012 08:49:23 +0100
Subject: [rabbitmq-discuss] Sample C code request
In-Reply-To: <CAPx-iUJ+Q9zs5cfFES6ZKgpatv+iBPh6NUYnET56tsgqjDCSbA@mail.gmail.com>
References: <CAPx-iUJ+Q9zs5cfFES6ZKgpatv+iBPh6NUYnET56tsgqjDCSbA@mail.gmail.com>
Message-ID: <50470403.9040608@rabbitmq.com>

Anirudh,

On 05/09/12 07:47, Anirudh Seshagirisa wrote:
> Can u send me a sample Producer and Consumer code in C language. I am a
> beginner to RabbitMQ.

https://github.com/alanxz/rabbitmq-c/tree/master/examples

Matthias.

From Dhinesh.P at saint-gobain.com  Wed Sep  5 09:12:27 2012
From: Dhinesh.P at saint-gobain.com (Dhinesh, P [ Maples - IT ])
Date: Wed, 5 Sep 2012 13:42:27 +0530
Subject: [rabbitmq-discuss] Sample python code for transfer the files
	.....
Message-ID: <00946F8B780BAB43A04111EEAA7B47F603923DAE@L00EXCEC1.zl.if.atcsg.net>

Dear Friends,

If you have any idea to transfer the files between producer and consumer
in RabbitMQ using Python 2.7....

Any one having code for this in python, just share me...

Thanks and Regards,

Dhinesh P

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
Matthias Radestock
Sent: Wednesday, September 05, 2012 1:19 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Sample C code request

Anirudh,

On 05/09/12 07:47, Anirudh Seshagirisa wrote:
> Can u send me a sample Producer and Consumer code in C language. I am 
> a beginner to RabbitMQ.

https://github.com/alanxz/rabbitmq-c/tree/master/examples

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Dhinesh.P at saint-gobain.com  Wed Sep  5 05:28:21 2012
From: Dhinesh.P at saint-gobain.com (Dhinesh, P [ Maples - IT ])
Date: Wed, 5 Sep 2012 09:58:21 +0530
Subject: [rabbitmq-discuss] Reg: File Transfer
In-Reply-To: <578563E8-2B80-43CE-B952-0968B2B90808@rabbitmq.com>
References: <8A9DF2095351E74AB39CF6BF78F20CC904C6567F@L00EXCEC1.zl.if.atcsg.net>
	<578563E8-2B80-43CE-B952-0968B2B90808@rabbitmq.com>
Message-ID: <00946F8B780BAB43A04111EEAA7B47F6038FE6FE@L00EXCEC1.zl.if.atcsg.net>

Hello Tim,

 

If the file transfer is possible in RabbitMQ 2.8.4 using Python 2.7
between producer to consumer.

 

Kindly help us, how we can proceed....

 

Have you any procedure for our query, pls share it...

 

We are waiting for your reply ASAP.....

 

Thanks and Regards,

 

Dhinesh P   

 

From: Tim Watson [mailto:tim at rabbitmq.com] 
Sent: Tuesday, September 04, 2012 9:33 PM
To: Discussions about RabbitMQ
Cc: Dhinesh, P [ Maples - IT ]
Subject: Re: [rabbitmq-discuss] Reg: File Transfer

 

Hi

 

On 4 Sep 2012, at 10:51, Ramachandrarao, K [ SGGI - IT ] wrote:





Hello,

 

Currently  we are working in RabbitMQ 2.8.4 version with Python Client,

 

We gone through the RabbitMQ documents, where we are not able to find
how to transfer the Files between the producer and consumer.

 

Requesting anyone can guide us to perform the file transfer.

 

The contents of messages are opaque to rabbit, so just put the binary
data into the message body and you're done.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/71d3fe4b/attachment.htm>

From francesco at rabbitmq.com  Wed Sep  5 09:34:31 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 05 Sep 2012 09:34:31 +0100
Subject: [rabbitmq-discuss] epel erlang repo package dependencies
In-Reply-To: <CAJELnLHartaTixhSj1=sEQ45T6-Y9fhRddJAv90=su9uhFZM-A@mail.gmail.com>
References: <CAJELnLE2ez0h6wz0YR_J=b7c_WnkO1PVhwmjrSWU14Hb8qqn5A@mail.gmail.com>
	<CAJELnLHartaTixhSj1=sEQ45T6-Y9fhRddJAv90=su9uhFZM-A@mail.gmail.com>
Message-ID: <87fw6w6f6w.wl%francesco@rabbitmq.com>

Hi Matt,

I fail to see how RabbitMQ is related to this problem.  I think that the
erlang-questions mailing list will be more appropriate, or even some fedora
mailing list.

That said, the simplest option is probably to build from source, if you don't
want the wx stuff.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Wed Sep  5 09:43:24 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 05 Sep 2012 09:43:24 +0100
Subject: [rabbitmq-discuss] How can I avoid write buffer warnings for
	non	persistant messaging?
In-Reply-To: <ea97abea-fc9d-4339-9b33-a9b6c2f3cfed@ql4g2000pbc.googlegroups.com>
References: <ea97abea-fc9d-4339-9b33-a9b6c2f3cfed@ql4g2000pbc.googlegroups.com>
Message-ID: <87ehmg6es3.wl%francesco@rabbitmq.com>

At Tue, 4 Sep 2012 17:43:50 -0700 (PDT),
c00kiemonster wrote:
> 2012-09-04 09:05:29,402 - server.STDERR - ERROR - /usr/local/lib/
> python2.7/dist-packages/pika-0.9.5-py2.7.egg/pika/connection.py:650:
> UserWarning: Pika: Write buffer exceeded warning threshold at 1595
> bytes and an estimated 10 frames behind

What's happening here is that your connection is being blocked due to flow
control, and Pika is detecting TCP backpressure, see
<https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/EAxR4_DeiNc>.
This is just a warning, your code is not breaking.

> Am I misunderstanding something here? Because my messages are not persistant
> and the exchanges and queues are non durable I would expect rabbitmq to simply
> discard messages sent with routing keys that are without any receiver.

This is exactly what happens, unless the `mandatory' flag is set - regardless of
the durability of the queue and exchanges:
<https://rabbitmq.com/amqp-0-9-1-reference.html#basic.publish>.  Your messages
are queueing up somewhere, and flow control is being triggered.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Wed Sep  5 09:46:43 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 05 Sep 2012 09:46:43 +0100
Subject: [rabbitmq-discuss] AWS clustering
In-Reply-To: <9865146e-11da-4ffb-880f-5d51244a792f@googlegroups.com>
References: <9865146e-11da-4ffb-880f-5d51244a792f@googlegroups.com>
Message-ID: <87d3206emk.wl%francesco@rabbitmq.com>

Hi Glade,

At Tue, 4 Sep 2012 20:01:38 -0700 (PDT),
Glade wrote:
> For a supposedly "just works" kind of service, that is just not good enough. I
> can't have my ops people rolling out of bed to take action every time there's
> a minor network glitch.

Rabbit clustering is meant to be run on local networks and is not tolerant to
"network glitches".  If you expect those, then don't use it.

> So, I either need to provide a network that never becomes partitioned (does
> such a network exist? Certainly not at AWS!), or I need to drop clustering and
> have a single RabbitMQ server which won't scale, or I need to cobble together
> some kind of automated supervisor which is certain not to handle all cases, or
> I need to use a different messaging tool.

Federation or shovel might fit your needs, see
<http://www.rabbitmq.com/distributed.html> for an overview.

--
Francesco * Often in error, never in doubt

From matthias at rabbitmq.com  Wed Sep  5 10:01:47 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 05 Sep 2012 10:01:47 +0100
Subject: [rabbitmq-discuss] AWS clustering
In-Reply-To: <87d3206emk.wl%francesco@rabbitmq.com>
References: <9865146e-11da-4ffb-880f-5d51244a792f@googlegroups.com>
	<87d3206emk.wl%francesco@rabbitmq.com>
Message-ID: <504714FB.5030104@rabbitmq.com>

On 05/09/12 09:46, Francesco Mazzoli wrote:
> At Tue, 4 Sep 2012 20:01:38 -0700 (PDT),
> Glade wrote:
>> For a supposedly "just works" kind of service, that is just not good enough. I
>> can't have my ops people rolling out of bed to take action every time there's
>> a minor network glitch.
>
> Rabbit clustering is meant to be run on local networks and is not tolerant to
> "network glitches".  If you expect those, then don't use it.

There is in fact some built-in tolerance to glitches. Specifically, TCP 
should be tolerant to network glitches if appropriately configured (or, 
rather, unless inappropriately misconfigured).

You may also want to increase Erlang's kernel net_ticktime. See 
http://www.erlang.org/doc/man/kernel_app.html. And make sure you are 
running the most recent Erlang release.

If, however, the glitch is severe enough to exceed those tolerances 
then you'll end up with a proper network split, which, as Francesco 
notes, Erlang's mnesia distributed db (on which rabbit's cluster is 
based) cannot cope with, thus requiring manual intervention to recover.

Regards,

Matthias.

From matthias at rabbitmq.com  Wed Sep  5 11:56:22 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 05 Sep 2012 11:56:22 +0100
Subject: [rabbitmq-discuss] Exchange to exchange bindings in python
	(pika)
In-Reply-To: <CAAqmy6MiYE13m=ptkgtmvMN3e8ctMmD5ARVNi0X0oQ_3iGBxTw@mail.gmail.com>
References: <CAAqmy6M+J6dwUsdCmuXMbPs63k51MDP=k2BfWEVKR=YU5LXFAA@mail.gmail.com>
	<D9E68005B2F84C8AA41BB29546F31959@meetme.com>
	<CAAqmy6MiYE13m=ptkgtmvMN3e8ctMmD5ARVNi0X0oQ_3iGBxTw@mail.gmail.com>
Message-ID: <50472FD6.4030605@rabbitmq.com>

Dave,

apologies for the late response...

On 23/08/12 04:24, Dave Curylo wrote:
> I get this error attempting to call channel.exchange_bind:
>
> 'BlockingChannel' object has no attribute 'exchange_bind'
>
> This is my source:
>
> import pika
> connection =
> pika.BlockingConnection(pika.ConnectionParameters(host='10.0.1.100'))
> channel = connection.channel()
> channel.exchange_bind(source='topicEx', destination='anotherEx',
> routing_key='#')
>
> I'm running pika version 0.9.5.
>  >>> pika.__version__
> '0.9.5'
>
> What am I missing that keeps me from being able to do exchange to
> exchange bindings?

There's no mention of exchange_bind in the pika docs, though if Gavin 
says that it's supported then presumably it is. And looking at the code 
on github, that does indeed appear to be the case, though I am no python 
expert.

You may want to ask on the pika google group - 
https://groups.google.com/forum/#!forum/pika-python - or file a bug on 
github.

Regards,

Matthias.

From tim at rabbitmq.com  Wed Sep  5 12:50:40 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 5 Sep 2012 12:50:40 +0100
Subject: [rabbitmq-discuss] Java client threading design
In-Reply-To: <073480a1-f4f6-4099-aed8-ab93dd71bc17@googlegroups.com>
References: <073480a1-f4f6-4099-aed8-ab93dd71bc17@googlegroups.com>
Message-ID: <46198480-DBC5-4C75-B9C0-BBA7DBD7D7EC@rabbitmq.com>


On 28 Aug 2012, at 18:03, Kashif Shaikh wrote:

> I'm just trying to understand the threading design:
> 
> - When a consumer is started for any queue on a particular channel, a thread is selected from the default executor service?

Well, you can supply your own, as per http://www.rabbitmq.com/api-guide.html#advanced-connection

> - Does a channel create a thread for itself?
> 

Yes, the Channel maintains a single dispatch thread.

> - I have a threadpool for my application that processes requests and does consumes (amongst other tasks) - I don't want my threadpool servicing the consume callbacks.  So can I keep a single global channel, and just call basicConsume and register callbacks that will be executed on the default executor?

The problem with a 'global' channel like this is that multiple consumers on the channel will block (because the Channel uses a single dispatch thread, as I mentioned earlier). One consumer per channel (and therefore one Channel per thread) will eliminate this problem. 

> Or should I create a channel for each thread in my threadpool, and then use channel.basicConsume()? 
> 

Well this just depends on why you 'don't want your threadpool servicing the consume callbacks'. The threadpool that is used for consumer callbacks is either a default (internally created) one or you can supply your own, and it doesn't have to be the main application thread pool if you don't want it to be. I'd suggest reading through http://www.rabbitmq.com/api-guide.html#consuming in detail for a better understanding of this.

> - what happens if connection breaks - do I have to re-consume again?
> 

Yes you do.

From tuure.laurinolli at portalify.com  Wed Sep  5 14:30:05 2012
From: tuure.laurinolli at portalify.com (Tuure Laurinolli)
Date: Wed, 5 Sep 2012 16:30:05 +0300
Subject: [rabbitmq-discuss] Ordering guarantees for multiple publishers,
	one queue and one consumer?
Message-ID: <3E871F79-07AD-4DF0-9F16-E31972D65655@portalify.com>

Hi,

Assuming nodes A and B publish messages to exchange X with one queue Q that has one consumer C, is it possible to guarantee ordering of messages from A and B to C, assuming A and B have a side channel over which they can coordinate their actions but can't communicate with C directly? If they were able to communicate with C directly, the problem would be trivial, since B could ask C "Have you received a message from A?" and only publish if the answer is yes.

Without being able to communicate with C, is it e.g. enough for A to do a transactional publish with mandatory flag, wait for commit-ok and only then give B signal that would allow B to do its publish? Will guarantee that the message from A will arrive to C before the message from B? It seems to me that AMQP 0-9-1 does not guarantee this (essentially allowing each incoming channel to have its own FIFO queue from with an outgoing channel would pull messages in undefined order). Does RabbitMQ offer stronger guarantees here?





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/462a85cb/attachment.htm>

From matthewlmcclure at gmail.com  Wed Sep  5 14:31:40 2012
From: matthewlmcclure at gmail.com (Matt McClure)
Date: Wed, 5 Sep 2012 09:31:40 -0400
Subject: [rabbitmq-discuss] epel erlang repo package dependencies
In-Reply-To: <87fw6w6f6w.wl%francesco@rabbitmq.com>
References: <CAJELnLE2ez0h6wz0YR_J=b7c_WnkO1PVhwmjrSWU14Hb8qqn5A@mail.gmail.com>
	<CAJELnLHartaTixhSj1=sEQ45T6-Y9fhRddJAv90=su9uhFZM-A@mail.gmail.com>
	<87fw6w6f6w.wl%francesco@rabbitmq.com>
Message-ID: <CAJELnLHzz-5bAZ1cMk9fb2fgXHsw4_f8UCxrNB-FmHBbXJOiLg@mail.gmail.com>

On Wed, Sep 5, 2012 at 4:34 AM, Francesco Mazzoli
<francesco at rabbitmq.com> wrote:
> I fail to see how RabbitMQ is related to this problem.  I think that the
> erlang-questions mailing list will be more appropriate, or even some fedora
> mailing list.

Hi Francesco,

Thanks for replying. I'll ask on erlang-questions.

Matt

-- 
Matt McClure
http://www.matthewlmcclure.com
http://www.mapmyfitness.com/profile/matthewlmcclure

From johnson at edocom.cn  Wed Sep  5 14:51:52 2012
From: johnson at edocom.cn (johnson)
Date: Wed, 5 Sep 2012 21:51:52 +0800
Subject: [rabbitmq-discuss] How to achieve HA consumers?
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>
	<87pq67gv2x.wl%francesco@rabbitmq.com>, 
	<5040A283.9010901@rabbitmq.com> <201209051232051717314@edocom.cn>, 
	<504703B9.7080900@rabbitmq.com>
Message-ID: <201209052151489305075@edocom.cn>


Hi Matthias,

Thanks for your reply. I wrote some test code and found a wired problem.

The init code is like

 factory = new ConnectionFactory();
 connection = factory.newConnection(address);
 channel = connection.createChannel();
 channel.basicQos(1);

And the receive code is like

 QueueingConsumer consumer = new QueueingConsumer(channel);
 boolean autoAck = false; 

 Queue.DeclareOk declare = channel.queueDeclarePassive("LBCQueue");
 int consumerCount = declare.getConsumerCount();
 if (consumerCount > 0)
  return false;
 
 channel.basicConsume("LBCQueue", autoAck, consumer);

First I started the first consumer and didn't publish any message. 


Then I started the second consumer and the value of the variable declare is #method<queue.declare-ok>(queue=LBCQueue, message-count=0, consumer-count=1).
So far everything is OK.

Now I publish 1 messge into the queue and restart the second consumer. The value of the variable declare is #method<queue.declare-ok>(queue=LBCQueue, message-count=0, consumer-count=1).
So far everything is still OK.


Then I publish another message into the queue and restart the second consumer again. 


This time the value of declare is #method<queue.declare-ok>(queue=LBCQueue, message-count=1, consumer-count=0).
The message-count is correct but the consumer-count is changed from 1 to 0. I don't know why. Is it a bug?




johnson

From: Matthias Radestock
Date: 2012-09-05 15:48
To: johnson
CC: rabbitmq-discuss; Francesco Mazzoli
Subject: Re: [rabbitmq-discuss] How to achieve HA consumers?
Johnson,

On 05/09/12 05:32, johnson wrote:
> The channel.queueDeclarePassive method returns the consumer count of
>  the specified channel,

No it doesn't. queue.declarePassive returns the total number of active
consumers of the queue at that point in time. Regardless of what
connection/channel they were created on.

That should be pretty clear from the docs -
http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok.consumer-count
- which make no mention of the count being connection/channel specific.

> So if I start two consumers [...] in two different machines [...] the
> channel.queueDeclarePassive method always return the consumer count
> == 1, not 2.

I am not sure what you are expecting to see here. If you start two
consumers, the count they will see prior to consuming will be 0 or 1.

As mentioned "You'd need to be mindful of races when consumers start 
up.", i.e. if both consumers start up near simultaneously then they will 
both see a count of 0.

> I also try to find a API that can retrieve the existing connection or
> channel. Then the second consumer can reuse the connection or channel
> the first consumer created. But it seems no such APIs.

A connection represents a point-to-point TCP connection. You can't 
"reuse" that from a third point.

Regards,

Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/8ce6f981/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 22572 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/8ce6f981/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 22628 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/8ce6f981/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 22474 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/8ce6f981/attachment-0002.png>

From gladed at glamber.com  Wed Sep  5 15:02:14 2012
From: gladed at glamber.com (Glade Diviney)
Date: Wed, 5 Sep 2012 07:02:14 -0700
Subject: [rabbitmq-discuss] AWS clustering
In-Reply-To: <87d3206emk.wl%francesco@rabbitmq.com>
References: <9865146e-11da-4ffb-880f-5d51244a792f@googlegroups.com>
	<87d3206emk.wl%francesco@rabbitmq.com>
Message-ID: <CAODk++ehYXCDovyvHemhxWmPfOgRn-v==rdZut77NcZue92CSg@mail.gmail.com>

That's the answer I need. Thanks, Francesco.

-Glade

On Wed, Sep 5, 2012 at 1:46 AM, Francesco Mazzoli <francesco at rabbitmq.com>wrote:

> Hi Glade,
>
> At Tue, 4 Sep 2012 20:01:38 -0700 (PDT),
> Glade wrote:
> > For a supposedly "just works" kind of service, that is just not good
> enough. I
> > can't have my ops people rolling out of bed to take action every time
> there's
> > a minor network glitch.
>
> Rabbit clustering is meant to be run on local networks and is not tolerant
> to
> "network glitches".  If you expect those, then don't use it.
>
> > So, I either need to provide a network that never becomes partitioned
> (does
> > such a network exist? Certainly not at AWS!), or I need to drop
> clustering and
> > have a single RabbitMQ server which won't scale, or I need to cobble
> together
> > some kind of automated supervisor which is certain not to handle all
> cases, or
> > I need to use a different messaging tool.
>
> Federation or shovel might fit your needs, see
> <http://www.rabbitmq.com/distributed.html> for an overview.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/34a593b6/attachment.htm>

From matthias at rabbitmq.com  Wed Sep  5 15:14:17 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 05 Sep 2012 15:14:17 +0100
Subject: [rabbitmq-discuss] How to achieve HA consumers?
In-Reply-To: <201209052151489305075@edocom.cn>
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>
	<87pq67gv2x.wl%francesco@rabbitmq.com>,
	<5040A283.9010901@rabbitmq.com> <201209051232051717314@edocom.cn>,
	<504703B9.7080900@rabbitmq.com> <201209052151489305075@edocom.cn>
Message-ID: <50475E39.10907@rabbitmq.com>

Johnson,

On 05/09/12 14:51, johnson wrote:
> The message-count is correct but the consumer-count is changed from 1
> to 0. I don't know why.

That is due to a subtlety in the meaning of consumer-count in the AMQP 
spec. From 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok.consumer-count
<quote>
Reports the number of *active* consumers for the queue.
</quote>

Rabbit's interpretation of "active consumer" is "a consumer to which a 
message can be sent". Since your consumer channels have a qos prefetch 
count of 1, once a message has been sent to a consumer no further 
messages can be sent to it until it acks the message. Until then the 
consumer is inactive and hence won't be included in the consumer-count 
returned by queue.declare-ok.

The RabbitMQ management API/UI isn't bound by AMQP semantics, so it 
always reports all consumers, active or not.

Regards,

Matthias.

From watson.timothy at gmail.com  Wed Sep  5 16:05:54 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 5 Sep 2012 16:05:54 +0100
Subject: [rabbitmq-discuss] Sample python code for transfer the files
	.....
In-Reply-To: <00946F8B780BAB43A04111EEAA7B47F603923DAE@L00EXCEC1.zl.if.atcsg.net>
References: <00946F8B780BAB43A04111EEAA7B47F603923DAE@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <3F69540F-4547-48CE-A103-C523D154DA51@rabbitmq.com>

I've already posted sample producer/consumer code and explained that you need to read the file and store the data therein inside the message body when reading/writing messages. You can put the file name in a user defined message header. Reading the pika documentation for reading/writing message headers and the python stdlib API for reading files might be a good place to start!

On 5 Sep 2012, at 09:12, "Dhinesh, P [ Maples - IT ]" <Dhinesh.P at saint-gobain.com> wrote:

> Dear Friends,
> 
> If you have any idea to transfer the files between producer and consumer
> in RabbitMQ using Python 2.7....
> 
> Any one having code for this in python, just share me...
> 
> Thanks and Regards,
> 
> Dhinesh P
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
> Matthias Radestock
> Sent: Wednesday, September 05, 2012 1:19 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Sample C code request
> 
> Anirudh,
> 
> On 05/09/12 07:47, Anirudh Seshagirisa wrote:
>> Can u send me a sample Producer and Consumer code in C language. I am 
>> a beginner to RabbitMQ.
> 
> https://github.com/alanxz/rabbitmq-c/tree/master/examples
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gmr at meetme.com  Wed Sep  5 16:42:06 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 5 Sep 2012 11:42:06 -0400
Subject: [rabbitmq-discuss] Sample python code for transfer the files
	.....
In-Reply-To: <00946F8B780BAB43A04111EEAA7B47F603923DAE@L00EXCEC1.zl.if.atcsg.net>
References: <00946F8B780BAB43A04111EEAA7B47F603923DAE@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <CAKwdTWdMrsn8z9WEK_096vn95K9uzpxw6n8Tt6QZPD8ehnP1DA@mail.gmail.com>

Here are examples of writing consumers and producers in Python using Pika:
http://pika.github.com/examples.html

On Wed, Sep 5, 2012 at 4:12 AM, Dhinesh, P [ Maples - IT ] <
Dhinesh.P at saint-gobain.com> wrote:

> Dear Friends,
>
> If you have any idea to transfer the files between producer and consumer
> in RabbitMQ using Python 2.7....
>
> Any one having code for this in python, just share me...
>
> Thanks and Regards,
>
> Dhinesh P
>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
> Matthias Radestock
> Sent: Wednesday, September 05, 2012 1:19 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] Sample C code request
>
> Anirudh,
>
> On 05/09/12 07:47, Anirudh Seshagirisa wrote:
> > Can u send me a sample Producer and Consumer code in C language. I am
> > a beginner to RabbitMQ.
>
> https://github.com/alanxz/rabbitmq-c/tree/master/examples
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/f478f281/attachment.htm>

From francesco at rabbitmq.com  Wed Sep  5 17:16:30 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 05 Sep 2012 17:16:30 +0100
Subject: [rabbitmq-discuss] Ordering guarantees for multiple publishers,
	one queue and one consumer?
In-Reply-To: <3E871F79-07AD-4DF0-9F16-E31972D65655@portalify.com>
References: <3E871F79-07AD-4DF0-9F16-E31972D65655@portalify.com>
Message-ID: <87bohk5tsx.wl%francesco@rabbitmq.com>

Hi Tuure,

At Wed, 5 Sep 2012 16:30:05 +0300,
Tuure Laurinolli wrote:
> Assuming nodes A and B publish messages to exchange X with one queue Q that
> has one consumer C, is it possible to guarantee ordering of messages from A
> and B to C, assuming A and B have a side channel over which they can
> coordinate their actions but can't communicate with C directly? If they were
> able to communicate with C directly, the problem would be trivial, since B
> could ask C "Have you received a message from A?" and only publish if the
> answer is yes.
> 
> Without being able to communicate with C, is it e.g. enough for A to do a
> transactional publish with mandatory flag, wait for commit-ok and only then
> give B signal that would allow B to do its publish? Will guarantee that the
> message from A will arrive to C before the message from B? It seems to me that
> AMQP 0-9-1 does not guarantee this (essentially allowing each incoming channel
> to have its own FIFO queue from with an outgoing channel would pull messages
> in undefined order). Does RabbitMQ offer stronger guarantees here?

As discussed on IRC, the answer is yes: with rabbit, after receiving an
confirm/commiting a transaction, messages published afterwards to the same queue
will come after.  So your plan will work, and you don't even need transactions,
confirms are enough - and the mandatory flag is irrelevant here.

--
Francesco * Often in error, never in doubt

From snegi at buffalo-studios.com  Wed Sep  5 18:27:21 2012
From: snegi at buffalo-studios.com (Satyarth Negi)
Date: Wed, 5 Sep 2012 10:27:21 -0700
Subject: [rabbitmq-discuss] Publisher Authentication
Message-ID: <CAAEFr-cN3RjcOorcG62YkruE56Rt=8wgFiFXV+SaqC9bGQbY+w@mail.gmail.com>

Hi All,

I am exploring RabbitMQ for use in our backend infrastructure. I have some
backend servers that will publish to RabbitMQ broker. I am trying to look
for a good way to authenticate our users. I am inclined towards putting
ipchain rules to only allow incoming connections from my authorized servers
and block for the rest.

However i am interested to explore what authentication RabbitMQ supports.
My publishers create persistent connection with Broker and i will prefer
authentication to happen only during connection setup. What are the best
practices for my use case ?

Thanks !
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/1d05f3e8/attachment.htm>

From jerryk at rbcon.com  Wed Sep  5 19:23:24 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 5 Sep 2012 11:23:24 -0700
Subject: [rabbitmq-discuss] Publisher Authentication
In-Reply-To: <CAAEFr-cN3RjcOorcG62YkruE56Rt=8wgFiFXV+SaqC9bGQbY+w@mail.gmail.com>
References: <CAAEFr-cN3RjcOorcG62YkruE56Rt=8wgFiFXV+SaqC9bGQbY+w@mail.gmail.com>
Message-ID: <CAE0Sz=xT5BzmQ6Dw9RoAbU3_KtYpHtX43W4GGSsrEx8rf9MKWg@mail.gmail.com>

Hi, Satyarh...

On Wed, Sep 5, 2012 at 10:27 AM, Satyarth Negi <snegi at buffalo-studios.com>wrote:

>
> I am exploring RabbitMQ for use in our backend infrastructure. I have some
> backend servers that will publish to RabbitMQ broker. I am trying to look
> for a good way to authenticate our users. I am inclined towards putting
> ipchain rules to only allow incoming connections from my authorized servers
> and block for the rest.
>

This is a very reasonable thing to do.  Let your trusted pieces of
infrastructure through the firewall to touch the broker, and block others.


> However i am interested to explore what authentication RabbitMQ supports.
> My publishers create persistent connection with Broker and i will prefer
> authentication to happen only during connection setup. What are the best
> practices for my use case ?
>

You have a variety of authentication mechanisms including:


   - The built-in RabbitMQ user database against which one authenticates by
   presenting a user name or password (such connections and conversations can
   be encrypted by SSL)
   - A plugin that allows you to delegate authentication tasks to an LDAP
   server
   - Support for the SASL EXTERNAL, where clients are required to present a
   client certificate, and the client's identity is determined from that
   - The ability to write custom authentication (and even authorization)
   plugins if you want to do something more esoteric; note, that to do this
   you'll need to write code in Erlang, and learn a bit out how Rabbit's
   internals, boot process, plugin system, etc., work.



> Thanks !
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/021853e4/attachment.htm>

From mpietrek at skytap.com  Wed Sep  5 19:27:47 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 5 Sep 2012 11:27:47 -0700
Subject: [rabbitmq-discuss] Odd delay in federation exchanges being
	recognized
Message-ID: <CACLE7iyK-fcHGPdvVu_oGpr3Tj3DncojMV_o4wpNDgAiqnPaOA@mail.gmail.com>

Let me admit up front that this is a weird one, but I'll press ahead on the
chance there's something there.

I've got two brokers I'm using the federation plugin with. I create a
single exchange 'skytap' on each broker, and make the 'skytap' exchange on
the other broker its upstream.

I create the rabbitmq.config file dynamically before starting each broker.
Starting from a blank slate (blowing away the mnesia directory), I launch
the two nodes concurrently.

When I go to the Exchange tab in either broker, I see two Exchanges as
expected:

   - federation: skytap -> rabbit at mq2.skytap.com B
   - skytap


The type of the exchanges is x-federation-upstream and x-federation,
respectively. However, when first starting up, the type column is a red
color indicating a problem, and hovering over it, I get a message to the
effect of "unknown exchange type x-federation. Messages published to this
exchange won't work."

Now, here's the interesting thing: I*f I wait long enough (usually around
10-15 minutes) **and without doing anything, the error state eventually
goes away* and the Exchanges seem happy. This has happened at least three
times, so it doesn't seem like a random fluke or that I accidentally did
something.

Here's my config file, FWIW...

[
{rabbit, [{cluster_nodes, [rabbit at mq1]}, {disk_free_limit, 104857600}]},
{mnesia, [{debug, trace}]},
{rabbitmq_federation, [{exchanges, [[{type, "topic"}, {upstream_set,
"skytap_upstreams"}, {virtual_host, "/"}, {exchange, "skytap"}]]},
{upstream_sets, [{"skytap_upstreams", [[{connection, "upstream-mq2"},
{max_hops, 1}, {exchange, "skytap"}]]}]},
{connections, [{"upstream-mq2", [{host, "mq2"}, {port, 5672}]}]}]}
].

Again, I realize this sounds a bit wonky, but it's happened enough times to
make me not think I'm crazy.

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/c0a4933d/attachment.htm>

From bsellner at seegrid.com  Wed Sep  5 22:19:09 2012
From: bsellner at seegrid.com (Brennan Sellner)
Date: Wed, 5 Sep 2012 17:19:09 -0400
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <878ve9ijm5.wl%francesco@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
Message-ID: <5047C1CD.10607@seegrid.com>

My apologies for the long delay, but we have quite a bit more 
information available, after doing some extensive field testing.

We now return you to your thread already in progress...

On 07/24/2012 05:38 AM, Francesco Mazzoli wrote:
> Hi Brennan,
> At Mon, 23 Jul 2012 15:57:24 -0400,
> Brennan Sellner wrote:
>> The rabbitmq server (v2.8.2) is running on the same machine, so there aren't
>> any external networks involved.  We're still running Fedora 11 (kernel 2.6.29,
>> Erlang R12B-5.8) for the moment, if that's relevant.
>
> Please upgrade both RabbitMQ and Erlang if you can (especially rabbit), or
> things will be hard to diagnose for us.

We've upgraded Rabbit to 2.8.6.  Erlang has not yet been upgraded, but 
will be in our next release cycle.  R12B-5.8 was the newest official 
build we could find that worked with Fedora 11; I've since been able to 
hand-build the latest Erlang release, but it's still working its way 
through our testing department.

We now have two different types of systems fielded, one where we're 
having issues with slow Rabbit operations, and one where we're not (or, 
at least any slow operations aren't slow enough to trigger our 
watchdogs).  The software configuration is identical between the two 
configurations.

#1: Problematic:
   - CPU: Core 2 Duo E7300 @ 2.66 GHz
   - RAM: 2 GB
   - Disk: SATA 3.0 Gb/s, 5400 RPM

#2: Working fine:
   - CPU: i5 M520 @ 2.4 GHz (2 cores + hyperthreading)
   - RAM: 4 GB
   - Disk: SATA 6.0 Gb/s, SSD

With #1, we're seeing the following librabbitmq-c functions occasionally 
take up to 7.28 seconds to return (3-4 seconds is much more common):
   - amqp_queue_declare
   - amqp_queue_bind
   - amqp_basic_consume

We don't have any persistent messages.  Queues are being declared with 
server-assigned names, passive is false, durable is false, exclusive is 
true, and auto-delete is true.  The consume calls use an empty consumer 
tag, set no-local to false, no-ack to false, and exclusive to false.

We've primarily observed this happening just after launching a new 
thread, which establishes a fresh connection to Rabbit successfully and 
quickly, but has issues when establishing its first subscription.  This 
may be sampling bias, though, as our watchdogs are by chance mostly 
concentrated around new threads being launched.  The full sequence of 
librabbitmq-c calls in this case is:

   - amqp_new_connection
   - amqp_open_socket
   - amqp_set_sockfd
   - amqp_login
   - amqp_channel_open
   - amqp_basic_qos
   - amqp_channel_open  # For the new subscription
   - amqp_basic_qos
   - amqp_exchange_declare
   - amqp_queue_declare # Sometimes slow
   - amqp_queue_bind    # Sometimes slow
   - amqp_basic_consume # Sometimes slow

My suspicion is that Rabbit is hitting disk for some reason; we've seen 
I/O-related delays with other processes (e.g. sqlite) with configuration 
#1 that we don't see with #2.  The SSD may be enough faster that we 
don't notice the issue on configuration #2.

However, I don't see any reason that Rabbit would be hitting the disk. 
Once the problematic librabbitmq-c function times out, our code dumps 
`rabbitmqctl status` to disk.  To take a concrete example, 
amqp_queue_bind took 3.72 seconds to return.  When the dump ran two 
seconds later, it reported the below:

Status of node 'AISINR4 at AISINR4' ...
[{pid,1698},
  {running_applications,[{rabbitmq_shovel,"Data Shovel for 
RabbitMQ","2.8.6"},
                         {erlando,"Syntax extensions for Erlang","2.8.6"},
                         {amqp_client,"RabbitMQ AMQP Client","2.8.6"},
                         {rabbit,"RabbitMQ","2.8.6"},
                         {os_mon,"CPO  CXC 138 46","2.1.8"},
                         {sasl,"SASL  CXC 138 11","2.1.5.4"},
                         {mnesia,"MNESIA  CXC 138 12","4.4.7"},
                         {stdlib,"ERTS  CXC 138 10","1.15.5"},
                         {kernel,"ERTS  CXC 138 10","2.12.5"}]},
  {os,{unix,linux}},
  {erlang_version,"Erlang (BEAM) emulator version 5.6.5 [source] [smp:2] 
[async-threads:30] [hipe] [kernel-poll:true]\n"},
  {memory,[{total,22599840},
           {processes,9909296},
           {processes_used,9706816},
           {system,12690544},
           {atom,782145},
           {atom_used,751012},
           {binary,650640},
           {code,6257852},
           {ets,4197052}]},
  {vm_memory_high_watermark,0.4},
  {vm_memory_limit,825982976},
  {disk_free_limit,1000000000},
  {disk_free,140100812800},
  {file_descriptors,[{total_limit,924},
                     {total_used,17},
                     {sockets_limit,829},
                     {sockets_used,13}]},
  {processes,[{limit,1048576},{used,304}]},
  {run_queue,0},
  {uptime,2106}]
...done.

It doesn't look like we're anywhere near the memory high watermark, nor 
are we stressing the system in terms of sockets or file handles.  We 
dumped the output of top at the same time, which indicates that we're 
not touching swap:

top - 05:18:56 up 35 min,  0 users,  load average: 3.85, 2.26, 1.79
Tasks:  97 total,   2 running,  95 sleeping,   0 stopped,   0 zombie
Cpu(s): 16.1%us, 10.2%sy,  0.0%ni, 69.2%id,  3.6%wa,  0.6%hi,  0.3%si, 
0.0%st
Mem:   2016560k total,  1658564k used,   357996k free,   157468k buffers
Swap:  1023992k total,        0k used,  1023992k free,   787772k cached

   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND 

  1698 rabbitmq  20   0 79096  26m 2136 S  7.9  1.4   2:16.89 beam.smp 


There was nothing interesting in either of Rabbit's logs.

> You might also be hitting flow control, but that is related to running out of
> RAM.  You can check that as well via the management plugin, the connections will
> be marked as "blocked".

`rabbitmqctl list_connections pid name last_blocked_by last_blocked_age` 
lists the last-blocked-age as infinity for all connections.  The 
management plugin is unfortunately not supported with the version of 
Erlang that we're using at the moment.

Anyone have any ideas about what might cause these random slow 
responses, or other data we can collect to help debug?  I'm rather 
baffled at the moment.

Thanks,

-Brennan

From francois at teksol.info  Wed Sep  5 14:40:03 2012
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Wed, 5 Sep 2012 09:40:03 -0400
Subject: [rabbitmq-discuss] Delivering to one and only one queue
Message-ID: <B0AF2E82-F575-42F6-A40C-D528E5ACAA2B@teksol.info>

Hi all!

I asked this question on StackOverflow yesterday, and I was looking to broaden the audience: http://stackoverflow.com/questions/12266488/routing-messages-to-one-and-only-one-queue

Here's a copy of the question:

"""
I have a Topic exchange from which I'd like to distribute messages to two queues on two servers part of a cluster, in order to reduce memory pressure on any particular server. My consumers are periodically slow, and I sometimes run into the high memory watermark.

The way I tried to resolve this is by routing messages using an intermediate direct exchange, with two queues bound to the exchange:

a (topic) -> a1 (direct) -> q1/q2 (bound to routing key "a")

But the messages were routed to both queues, as AMQP intends. Anyone has ideas? What I need is an exchange that routes to one and only one queue, even if the routing key matches many queues. I'd prefer not to change my routing keys, but that could be arranged.

I found Selective routing with RabbitMQ, which may mean I'll need to implement my own routing logic. Hopefully, this already exists somewhere else.
"""

Any ideas?

Thank you very much!
Fran?ois Beausoleil

From ilya at segment.io  Wed Sep  5 23:19:14 2012
From: ilya at segment.io (Ilya Volodarsky)
Date: Wed, 5 Sep 2012 15:19:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Federated Exchange Advice
Message-ID: <7307b1d8-d53f-457b-8660-59786afc673d@googlegroups.com>

Hi,

I was trying to set up a federated exchange topology today, and had a bit 
of trouble. I have a *production *broker with an exchange called *ingestion*, 
which receives tasks from our API servers. There are queues bound to this 
exchange that consume it and process the API tasks. 

I then created a mirror cluster with a *staging *broker, and also created 
an exchange called *ingestion. *I wanted to route everything going from the 
*production* broker's *ingestion* exchange to the* staging* broker's *
ingestion* exchange.

I created a federated exchange called* production-ingestion* on the *staging
* broker, and that created a* staging-ingestion* upstream exchange on the*production
* broker.

I first did an exchange-bind on the *staging* broker: *production-ingestion 
*=> *ingestion*
I then did an exchange-bind on the* production* broker with source: *
ingestion*  => *staging-ingestion*

I saw no traffic going between the computers. I read that the federation 
plugin only transfers things it has subscriptions for, but is an exchange 
binding not counted as a subscription? If so, it feels like I am setting 
this up wrong. Some guidance would be very appreciated.

Thanks,

Ilya



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120905/a6c649ef/attachment.htm>

From michael.s.klishin at gmail.com  Thu Sep  6 00:38:21 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 6 Sep 2012 03:38:21 +0400
Subject: [rabbitmq-discuss] ANN Langohr 1.0.0-beta4
Message-ID: <CAE3HoVQyHeDUuHe7GzegakW06guCfGcrFmAvP9y1qQ-uK=L+Ew@mail.gmail.com>

Langohr is an idiomatic Clojure client for RabbitMQ that embraces AMQP
0.9.1 model.

1.0.0-beta4 includes a couple of usability improvements:

 * Payloads will now be coerced to bytes (by default, Langohr comes with
implementations for strings and byte arrays) instead of
   assuming it is always a string

 * Default values of the :exclusive flag for queues is now set to false.
Previously having it set to true caused
   confusion w.r.t. non-auto-deleted queues being deleted in when the
connection that declared them was closed.

Kudos to Alex Petrov and ?lvaro Videla for pointing out both issues.


Detailed change log:
https://github.com/michaelklishin/langohr/blob/master/ChangeLog.md

Langohr on github (sorry, http://clojurerabbitmq.info is still in the
works):
http://github.com/michaelklishin/langohr

Updates are announced on Twitter @clojurewerkz.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/91c2b3db/attachment.htm>

From johnson at edocom.cn  Thu Sep  6 03:00:31 2012
From: johnson at edocom.cn (johnson)
Date: Thu, 6 Sep 2012 10:00:31 +0800
Subject: [rabbitmq-discuss] How to achieve HA consumers?
References: <mailman.1.1345633202.13976.rabbitmq-discuss@lists.rabbitmq.com>
	<201208250029598551536@edocom.cn>
	<87pq67gv2x.wl%francesco@rabbitmq.com>, 
	<5040A283.9010901@rabbitmq.com> <201209051232051717314@edocom.cn>, 
	<504703B9.7080900@rabbitmq.com> <201209052151489305075@edocom.cn>, 
	<50475E39.10907@rabbitmq.com>
Message-ID: <201209061000316901260@edocom.cn>

Hi Matthias,

Now I am clear about it. So for my scenario, using the token queue is the better solution. I have tried it and it works fine.

Best Regards




johnson

From: Matthias Radestock
Date: 2012-09-05 22:14
To: johnson
CC: rabbitmq-discuss
Subject: Re: [rabbitmq-discuss] How to achieve HA consumers?
Johnson,

On 05/09/12 14:51, johnson wrote:
> The message-count is correct but the consumer-count is changed from 1
> to 0. I don't know why.

That is due to a subtlety in the meaning of consumer-count in the AMQP 
spec. From 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok.consumer-count
<quote>
Reports the number of *active* consumers for the queue.
</quote>

Rabbit's interpretation of "active consumer" is "a consumer to which a 
message can be sent". Since your consumer channels have a qos prefetch 
count of 1, once a message has been sent to a consumer no further 
messages can be sent to it until it acks the message. Until then the 
consumer is inactive and hence won't be included in the consumer-count 
returned by queue.declare-ok.

The RabbitMQ management API/UI isn't bound by AMQP semantics, so it 
always reports all consumers, active or not.

Regards,

Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/84ce5958/attachment.htm>

From jacquesdr at gmail.com  Thu Sep  6 06:00:38 2012
From: jacquesdr at gmail.com (Jacques du Rand)
Date: Thu, 6 Sep 2012 07:00:38 +0200
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <878ve9ijm5.wl%francesco@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
Message-ID: <CA+-VnXBhWe-dm4wOF-n=d0EEt1J_8TN5WRqtZDJW9hStZ71zDg@mail.gmail.com>

What are the avg sizes and the size of a msg that is slow?  Network?
Mtu,nagle?   Does your NIC have tcp offload?  As a black magic solution ser
your system to use deadline schedulerr to see if its worse or better?
jacques
On Jul 24, 2012 11:39 AM, "Francesco Mazzoli" <francesco at rabbitmq.com>
wrote:

> Hi Brennan,
> At Mon, 23 Jul 2012 15:57:24 -0400,
> Brennan Sellner wrote:
> > The rabbitmq server (v2.8.2) is running on the same machine, so there
> aren't
> > any external networks involved.  We're still running Fedora 11 (kernel
> 2.6.29,
> > Erlang R12B-5.8) for the moment, if that's relevant.
>
> Please upgrade both RabbitMQ and Erlang if you can (especially rabbit), or
> things will be hard to diagnose for us.
>
> > Time 0.90: The consumer receives and responds to an AMQP heartbeat from
> > the server, and acks the delivery of a prior message.  It again drops
> > into an amqp_simple_wait_frame.
>
> That does not sound right, heartbeats require no response.
>
> > My understanding is that when dealing solely with non-persistent
> > messages, Rabbit won't hit the disk until it runs out of RAM.  Is that
> > accurate?
>
> It is accurate, but your understanding of "runs out of RAM" might be
> misguided:
> rabbit will start swapping to disc when the RAM used exceeds `total_ram *
> vm_memory_high_watermark', where `vm_high_watermark' is a configurable
> application variable, with 0.4 as default:
> http://www.rabbitmq.com/configure.html .
>
> > Any ideas as to what else might cause this sort of delay, or suggestions
> on
> > how to get further useful information?
>
> I would say that the most likely thing to be happening is for rabbit to
> start
> paging to disc, so please check that first.  You can monitor your disc
> space
> usage with the rabbitmq management plugin.
>
> You might also be hitting flow control, but that is related to running out
> of
> RAM.  You can check that as well via the management plugin, the
> connections will
> be marked as "blocked".
>
> Another option could be that you are running out of file descriptors
> (maybe you
> have a large number of connections open?) and rabbit is blocking until
> some are
> available.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/98761f7c/attachment.htm>

From watson.timothy at gmail.com  Thu Sep  6 09:17:02 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 6 Sep 2012 09:17:02 +0100
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <5047C1CD.10607@seegrid.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
Message-ID: <295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>


On 5 Sep 2012, at 22:19, Brennan Sellner <bsellner at seegrid.com> wrote:

> My apologies for the long delay, but we have quite a bit more information available, after doing some extensive field testing.
> 
> We now return you to your thread already in progress...
> 
> 
> We've upgraded Rabbit to 2.8.6.  Erlang has not yet been upgraded, but will be in our next release cycle.  R12B-5.8 was the newest official build we could find that worked with Fedora 11; I've since been able to hand-build the latest Erlang release, but it's still working its way through our testing department.
> 

R12 is really old and the general performance if the emulator has improved hugely since.

> We now have two different types of systems fielded, one where we're having issues with slow Rabbit operations, and one where we're not (or, at least any slow operations aren't slow enough to trigger our watchdogs).  The software configuration is identical between the two configurations.
> 
> #1: Problematic:
>  - CPU: Core 2 Duo E7300 @ 2.66 GHz
>  - RAM: 2 GB
>  - Disk: SATA 3.0 Gb/s, 5400 RPM
> 
> #2: Working fine:
>  - CPU: i5 M520 @ 2.4 GHz (2 cores + hyperthreading)
>  - RAM: 4 GB
>  - Disk: SATA 6.0 Gb/s, SSD
> 
> With #1, we're seeing the following librabbitmq-c functions occasionally take up to 7.28 seconds to return (3-4 seconds is much more common):
>  - amqp_queue_declare
>  - amqp_queue_bind
>  - amqp_basic_consume
> 

Can you ascertain how much of that time is spent is system calls waiting for the network?

> We don't have any persistent messages.  Queues are being declared with server-assigned names, passive is false, durable is false, exclusive is true, and auto-delete is true.  The consume calls use an empty consumer tag, set no-local to false, no-ack to false, and exclusive to false.
> 
> We've primarily observed this happening just after launching a new thread, which establishes a fresh connection to Rabbit successfully and quickly, but has issues when establishing its first subscription.  

You do know that librabbitmq-c is *not* thread safe, at least iirc!?

> This may be sampling bias, though, as our watchdogs are by chance mostly concentrated around new threads being launched.  The full sequence of librabbitmq-c calls in this case is:
> 
>  - amqp_new_connection
>  - amqp_open_socket
>  - amqp_set_sockfd
>  - amqp_login
>  - amqp_channel_open
>  - amqp_basic_qos
>  - amqp_channel_open  # For the new subscription
>  - amqp_basic_qos
>  - amqp_exchange_declare
>  - amqp_queue_declare # Sometimes slow
>  - amqp_queue_bind    # Sometimes slow
>  - amqp_basic_consume # Sometimes slow
> 
> My suspicion is that Rabbit is hitting disk for some reason; we've seen I/O-related delays with other processes (e.g. sqlite) with configuration #1 that we don't see with #2.  The SSD may be enough faster that we don't notice the issue on configuration #2.
> 

According to top output (below) that's not happening an rabbit will not page to disk without hitting the high memory watermark if your messages are non persistent.

> However, I don't see any reason that Rabbit would be hitting the disk.

Exactly.

> Once the problematic librabbitmq-c function times out, our code dumps `rabbitmqctl status` to disk.  To take a concrete example, amqp_queue_bind took 3.72 seconds to return.  When the dump ran two seconds later, it reported the below:
> 
> Status of node 'AISINR4 at AISINR4' ...
> [{pid,1698},
> {running_applications,[{rabbitmq_shovel,"Data Shovel for RabbitMQ","2.8.6"},
>                        {erlando,"Syntax extensions for Erlang","2.8.6"},
>                        {amqp_client,"RabbitMQ AMQP Client","2.8.6"},
>                        {rabbit,"RabbitMQ","2.8.6"},
>                        {os_mon,"CPO  CXC 138 46","2.1.8"},
>                        {sasl,"SASL  CXC 138 11","2.1.5.4"},
>                        {mnesia,"MNESIA  CXC 138 12","4.4.7"},
>                        {stdlib,"ERTS  CXC 138 10","1.15.5"},
>                        {kernel,"ERTS  CXC 138 10","2.12.5"}]},
> {os,{unix,linux}},
> {erlang_version,"Erlang (BEAM) emulator version 5.6.5 [source] [smp:2] [async-threads:30] [hipe] [kernel-poll:true]\n"},
> {memory,[{total,22599840},
>          {processes,9909296},
>          {processes_used,9706816},
>          {system,12690544},
>          {atom,782145},
>          {atom_used,751012},
>          {binary,650640},
>          {code,6257852},
>          {ets,4197052}]},
> {vm_memory_high_watermark,0.4},
> {vm_memory_limit,825982976},
> {disk_free_limit,1000000000},
> {disk_free,140100812800},
> {file_descriptors,[{total_limit,924},
>                    {total_used,17},
>                    {sockets_limit,829},
>                    {sockets_used,13}]},

Looking at fd volumes, I doubt the message store is writing to disk although I could be wrong.

> {processes,[{limit,1048576},{used,304}]},
> {run_queue,0},
> {uptime,2106}]
> ...done.
> 
> It doesn't look like we're anywhere near the memory high watermark, nor are we stressing the system in terms of sockets or file handles.  We dumped the output of top at the same time, which indicates that we're not touching swap:
> 
> top - 05:18:56 up 35 min,  0 users,  load average: 3.85, 2.26, 1.79
> Tasks:  97 total,   2 running,  95 sleeping,   0 stopped,   0 zombie
> Cpu(s): 16.1%us, 10.2%sy,  0.0%ni, 69.2%id,  3.6%wa,  0.6%hi,  0.3%si, 0.0%st
> Mem:   2016560k total,  1658564k used,   357996k free,   157468k buffers
> Swap:  1023992k total,        0k used,  1023992k free,   787772k cached
> 
>  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND 
> 1698 rabbitmq  20   0 79096  26m 2136 S  7.9  1.4   2:16.89 beam.smp 
> 
> There was nothing interesting in either of Rabbit's logs.
> 

I wonder if this delay is happening in the client rather than the server. Does a standalone sample client with no threading take so lob to perform the basic operations?

>> You might also be hitting flow control, but that is related to running out of
>> RAM.  

Um, isn't flow control actually about applying back pressure to producers when the system is overloaded? That sounds feasible and isn't afaict just about hitting ram limits.

>> You can check that as well via the management plugin, the connections will
>> be marked as "blocked".
> 
> `rabbitmqctl list_connections pid name last_blocked_by last_blocked_age` lists the last-blocked-age as infinity for all connections.  The management plugin is unfortunately not supported with the version of Erlang that we're using at the moment.
> 
> Anyone have any ideas about what might cause these random slow responses, or other data we can collect to help debug?  I'm rather baffled at the moment.
> 
> Thanks,
> 
> -Brennan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From andyzhang at rbcon.com  Thu Sep  6 09:25:36 2012
From: andyzhang at rbcon.com (andyzhang)
Date: Thu, 6 Sep 2012 01:25:36 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq service down when test with tool
 com.rabbitmq.examples.MulticastMain for a heavry load
Message-ID: <8fc49d6f-20f6-4545-8da6-77d95d250209@googlegroups.com>

I have test the rabbitmq service with the official java client tool 
com.rabbitmq.examples.Multicastmain
when i run the client with config:
-r,--rate 250
-s,--size 1100
-x 50
-y 50
with this config i gained 13MB/s bandwidth for the rabbitmq server
after run for about 10minutes. the rabbit server go down

the server spec is: 64GB mem 4 cpu 32G disk
before it go down all these status seems pretty good..

the strace info is listed below:
write(3, "377", 3)                      = 3
write(3, "\n", 1)                       = 1
write(3, "Heap unused: ", 13)           = 13
write(3, "1173", 4)                     = 4
write(3, "\n", 1)                       = 1
write(3, "OldHeap unused: ", 16)        = 16
write(3, "118", 3)                      = 3
write(3, "\n", 1)                       = 1
write(3, "Program counter: ", 17)       = 17
write(3, "0x", 2)                       = 2
write(3, "0000", 4)                     = 4
write(3, "7f58727a0660", 12)            = 12
write(3, " (", 2)                       = 2
write(3, "r", 1)                        = ? <unavailable>
+++ killed by SIGALRM +++

any one can help me out????
more thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/694f1413/attachment.htm>

From andrea.rosa at hp.com  Thu Sep  6 09:40:06 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Thu, 6 Sep 2012 08:40:06 +0000
Subject: [rabbitmq-discuss] Publisher Authentication
In-Reply-To: <CAE0Sz=xT5BzmQ6Dw9RoAbU3_KtYpHtX43W4GGSsrEx8rf9MKWg@mail.gmail.com>
References: <CAAEFr-cN3RjcOorcG62YkruE56Rt=8wgFiFXV+SaqC9bGQbY+w@mail.gmail.com>
	<CAE0Sz=xT5BzmQ6Dw9RoAbU3_KtYpHtX43W4GGSsrEx8rf9MKWg@mail.gmail.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD5F8B1F1C@G4W3209.americas.hpqcorp.net>

Hi,
Some months ago I tested the SASL EXTERNAL support for authenticate both clients and server, it worked well apart an issue with revoked certificates.
It seems that the plugin was not able to verify a certificate against a CRL, and in my understanding (and if I remember correctly) that was a limitation due to SSL erlang library.
Anyone has a similar experience?

Regards
--
Andrea Rosa



From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jerry Kuch
Sent: 05 September 2012 19:23
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Publisher Authentication

Hi, Satyarh...
On Wed, Sep 5, 2012 at 10:27 AM, Satyarth Negi <snegi at buffalo-studios.com<mailto:snegi at buffalo-studios.com>> wrote:

I am exploring RabbitMQ for use in our backend infrastructure. I have some backend servers that will publish to RabbitMQ broker. I am trying to look for a good way to authenticate our users. I am inclined towards putting ipchain rules to only allow incoming connections from my authorized servers and block for the rest.

This is a very reasonable thing to do.  Let your trusted pieces of infrastructure through the firewall to touch the broker, and block others.

However i am interested to explore what authentication RabbitMQ supports. My publishers create persistent connection with Broker and i will prefer authentication to happen only during connection setup. What are the best practices for my use case ?

You have a variety of authentication mechanisms including:

  *   The built-in RabbitMQ user database against which one authenticates by presenting a user name or password (such connections and conversations can be encrypted by SSL)
  *   A plugin that allows you to delegate authentication tasks to an LDAP server
  *   Support for the SASL EXTERNAL, where clients are required to present a client certificate, and the client's identity is determined from that
  *   The ability to write custom authentication (and even authorization) plugins if you want to do something more esoteric; note, that to do this you'll need to write code in Erlang, and learn a bit out how Rabbit's internals, boot process, plugin system, etc., work.

Thanks !

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/36f63b6f/attachment.htm>

From simon at rabbitmq.com  Thu Sep  6 09:49:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Sep 2012 09:49:19 +0100
Subject: [rabbitmq-discuss] Delivering to one and only one queue
In-Reply-To: <B0AF2E82-F575-42F6-A40C-D528E5ACAA2B@teksol.info>
References: <B0AF2E82-F575-42F6-A40C-D528E5ACAA2B@teksol.info>
Message-ID: <5048638F.6050104@rabbitmq.com>

Sounds like the consistent hash exchange will do what you want?

http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/raw-file/default/README.md

This ships with RabbitMQ as a plugin, but is disabled by default.

Cheers, Simon

On 05/09/2012 2:40PM, Fran?ois Beausoleil wrote:
> Hi all!
>
> I asked this question on StackOverflow yesterday, and I was looking to broaden the audience: http://stackoverflow.com/questions/12266488/routing-messages-to-one-and-only-one-queue
>
> Here's a copy of the question:
>
> """
> I have a Topic exchange from which I'd like to distribute messages to two queues on two servers part of a cluster, in order to reduce memory pressure on any particular server. My consumers are periodically slow, and I sometimes run into the high memory watermark.
>
> The way I tried to resolve this is by routing messages using an intermediate direct exchange, with two queues bound to the exchange:
>
> a (topic) -> a1 (direct) -> q1/q2 (bound to routing key "a")
>
> But the messages were routed to both queues, as AMQP intends. Anyone has ideas? What I need is an exchange that routes to one and only one queue, even if the routing key matches many queues. I'd prefer not to change my routing keys, but that could be arranged.
>
> I found Selective routing with RabbitMQ, which may mean I'll need to implement my own routing logic. Hopefully, this already exists somewhere else.
> """
>
> Any ideas?
>
> Thank you very much!
> Fran?ois Beausoleil
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From tim at rabbitmq.com  Thu Sep  6 09:51:08 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 6 Sep 2012 09:51:08 +0100
Subject: [rabbitmq-discuss] rabbitmq service down when test with tool
	com.rabbitmq.examples.MulticastMain for a heavry load
In-Reply-To: <8fc49d6f-20f6-4545-8da6-77d95d250209@googlegroups.com>
References: <8fc49d6f-20f6-4545-8da6-77d95d250209@googlegroups.com>
Message-ID: <8A155C38-6ACA-488F-85CD-02B1F415198B@rabbitmq.com>


On 6 Sep 2012, at 09:25, andyzhang wrote:

> I have test the rabbitmq service with the official java client tool com.rabbitmq.examples.Multicastmain
> when i run the client with config:
> -r,--rate 250
> -s,--size 1100
> -x 50
> -y 50
> with this config i gained 13MB/s bandwidth for the rabbitmq server
> after run for about 10minutes. the rabbit server go down
> 
> the server spec is: 64GB mem 4 cpu 32G disk
> before it go down all these status seems pretty good..
> 
> the strace info is listed below:
> write(3, "377", 3)                      = 3
> write(3, "\n", 1)                       = 1
> write(3, "Heap unused: ", 13)           = 13
> write(3, "1173", 4)                     = 4
> write(3, "\n", 1)                       = 1
> write(3, "OldHeap unused: ", 16)        = 16
> write(3, "118", 3)                      = 3
> write(3, "\n", 1)                       = 1
> write(3, "Program counter: ", 17)       = 17
> write(3, "0x", 2)                       = 2
> write(3, "0000", 4)                     = 4
> write(3, "7f58727a0660", 12)            = 12
> write(3, " (", 2)                       = 2
> write(3, "r", 1)                        = ? <unavailable>
> +++ killed by SIGALRM +++
> 

This looks suspiciously like it is trying to produce erl_crash.dump, which is generated when the emulator crashes. Do you have any other information, i.e., rabbit logs. Also, what is your OS, erlang version and rabbit versions please?

From tim at rabbitmq.com  Thu Sep  6 09:53:53 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 6 Sep 2012 09:53:53 +0100
Subject: [rabbitmq-discuss] rabbitmq service down when test with tool
	com.rabbitmq.examples.MulticastMain for a heavry load
In-Reply-To: <8A155C38-6ACA-488F-85CD-02B1F415198B@rabbitmq.com>
References: <8fc49d6f-20f6-4545-8da6-77d95d250209@googlegroups.com>
	<8A155C38-6ACA-488F-85CD-02B1F415198B@rabbitmq.com>
Message-ID: <86329AAB-FC59-497A-ADF1-182C4905D64B@rabbitmq.com>

On 6 Sep 2012, at 09:51, Tim Watson wrote:

> 
> On 6 Sep 2012, at 09:25, andyzhang wrote:
> 
>> I have test the rabbitmq service with the official java client tool com.rabbitmq.examples.Multicastmain
>> when i run the client with config:
>> -r,--rate 250
>> -s,--size 1100
>> -x 50
>> -y 50
>> with this config i gained 13MB/s bandwidth for the rabbitmq server
>> after run for about 10minutes. the rabbit server go down
>> 
>> the server spec is: 64GB mem 4 cpu 32G disk
>> before it go down all these status seems pretty good..
>> 
> 
> This looks suspiciously like it is trying to produce erl_crash.dump, which is generated when the emulator crashes. Do you have any other information, i.e., rabbit logs. Also, what is your OS, erlang version and rabbit versions please?

And if you're on linux, check for any indication that OOM killer has run.

From bsellner at seegrid.com  Thu Sep  6 10:02:47 2012
From: bsellner at seegrid.com (Brennan Sellner)
Date: Thu, 6 Sep 2012 05:02:47 -0400
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <CA+-VnXBhWe-dm4wOF-n=d0EEt1J_8TN5WRqtZDJW9hStZ71zDg@mail.gmail.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<CA+-VnXBhWe-dm4wOF-n=d0EEt1J_8TN5WRqtZDJW9hStZ71zDg@mail.gmail.com>
Message-ID: <504866B7.3060109@seegrid.com>

On 09/06/2012 01:00 AM, Jacques du Rand wrote:
> What are the avg sizes and the size of a msg that is slow?  

All messages in our system are on the order of tens of bytes; the max
length is around 100 bytes.  Definitely nothing larger than a single frame.

> Network? 

The client and server are running on the same machine, connecting via
the loopback (127.0.0.1) interface.

> Mtu,nagle?   Does your NIC have tcp offload? 

Not sure, but I don't think it's relevant, given that we're local.

> As a black magic solution
> ser your system to use deadline schedulerr to see if its worse or better?

Are you referring to the kernel I/O scheduler?  Could be worth a go...

Thanks,

-Brennan


From bsellner at seegrid.com  Thu Sep  6 10:11:22 2012
From: bsellner at seegrid.com (Brennan Sellner)
Date: Thu, 6 Sep 2012 05:11:22 -0400
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
Message-ID: <504868BA.9020505@seegrid.com>

On 09/06/2012 04:17 AM, Tim Watson wrote:
> 
> On 5 Sep 2012, at 22:19, Brennan Sellner <bsellner at seegrid.com> wrote:
>> We've upgraded Rabbit to 2.8.6.  Erlang has not yet been upgraded, but will be in our next release cycle.  R12B-5.8 was the newest official build we could find that worked with Fedora 11; I've since been able to hand-build the latest Erlang release, but it's still working its way through our testing department.
>>
> 
> R12 is really old and the general performance if the emulator has improved hugely since.

Understood.  Is it plausible that the Erlang version could explain the
sort of intermittent long delays we're seeing?  The upgrade is in the
works, but as we're dealing with a fielded robotic system, there's quite
a bit of testing necessary before an underpinning change like that is
released.

>> With #1, we're seeing the following librabbitmq-c functions occasionally take up to 7.28 seconds to return (3-4 seconds is much more common):
>>  - amqp_queue_declare
>>  - amqp_queue_bind
>>  - amqp_basic_consume
>>
> 
> Can you ascertain how much of that time is spent is system calls waiting for the network?

Not at present: I haven't instrumented librabbitmq-c as yet.  However,
Rabbit and the client are running on the same machine, connecting over
the loopback (127.0.0.1) interface.  I would expect network delays to be
minimal, though I haven't proven that yet.

>> We've primarily observed this happening just after launching a new thread, which establishes a fresh connection to Rabbit successfully and quickly, but has issues when establishing its first subscription.  
> 
> You do know that librabbitmq-c is *not* thread safe, at least iirc!?

Yep.  Each thread opens its own TCP connection to Rabbit, and maintains
its own state.

>> My suspicion is that Rabbit is hitting disk for some reason; we've seen I/O-related delays with other processes (e.g. sqlite) with configuration #1 that we don't see with #2.  The SSD may be enough faster that we don't notice the issue on configuration #2.
>>
> 
> According to top output (below) that's not happening an rabbit will not page to disk without hitting the high memory watermark if your messages are non persistent.
> 
>> However, I don't see any reason that Rabbit would be hitting the disk.
> 
> Exactly.

Okay, thanks.  I wasn't sure if there were any other triggers that would
cause Rabbit to touch the disk, such as the creation of a queue.

> 
> I wonder if this delay is happening in the client rather than the server. Does a standalone sample client with no threading take so lob to perform the basic operations?
> 

I haven't been able to reproduce this in a standalone example yet, but I
also haven't made the attempt on the same hardware that we're seeing the
problem on.  Doing so is next on my list.

>>> You might also be hitting flow control, but that is related to running out of
>>> RAM.  
> 
> Um, isn't flow control actually about applying back pressure to producers when the system is overloaded? That sounds feasible and isn't afaict just about hitting ram limits.

How does Rabbit define 'overloaded'?  It's a dual-core system; one core
is pretty much pegged by one of our processes, but the other is under
only light load.  I've never seen Rabbit consume more than ~10% of it.

Thanks,

-Brennan


From matthias at rabbitmq.com  Thu Sep  6 10:16:17 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 06 Sep 2012 10:16:17 +0100
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <504868BA.9020505@seegrid.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com>
Message-ID: <504869E1.5010205@rabbitmq.com>

Brennan,

On 06/09/12 10:11, Brennan Sellner wrote:
> Okay, thanks.  I wasn't sure if there were any other triggers that would
> cause Rabbit to touch the disk, such as the creation of a queue.

Creation/deletion of durable queues/exchanges/bindings *does* touch the 
disk. With an fsync to boot.

Regards,

Matthias.

From tim at rabbitmq.com  Thu Sep  6 10:21:13 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 6 Sep 2012 10:21:13 +0100
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <504869E1.5010205@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
Message-ID: <7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>

On 6 Sep 2012, at 10:16, Matthias Radestock wrote:

> Brennan,
> 
> On 06/09/12 10:11, Brennan Sellner wrote:
>> Okay, thanks.  I wasn't sure if there were any other triggers that would
>> cause Rabbit to touch the disk, such as the creation of a queue.
> 
> Creation/deletion of durable queues/exchanges/bindings *does* touch the disk. With an fsync to boot.
> 

That would explain why amqp_queue_declare is sometimes slow I suppose - sorry for missing that point - but is this true of non durable queues? Also what of the amqp_{bind|consume} calls - does the same apply?

From matthias at rabbitmq.com  Thu Sep  6 10:28:33 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 06 Sep 2012 10:28:33 +0100
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
	<7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
Message-ID: <50486CC1.1060209@rabbitmq.com>

On 06/09/12 10:21, Tim Watson wrote:
> On 6 Sep 2012, at 10:16, Matthias Radestock wrote:
>> Creation/deletion of durable queues/exchanges/bindings *does* touch
>> the disk. With an fsync to boot.
>>
>
> but is this true of non durable queues?

no.

> Also what of the amqp_bind

Yes, if the exchange/queue involved are durable.

> amqp_consume

no.


Matthias.

From simon at rabbitmq.com  Thu Sep  6 10:43:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Sep 2012 10:43:15 +0100
Subject: [rabbitmq-discuss] Federated Exchange Advice
In-Reply-To: <7307b1d8-d53f-457b-8660-59786afc673d@googlegroups.com>
References: <7307b1d8-d53f-457b-8660-59786afc673d@googlegroups.com>
Message-ID: <50487033.6030108@rabbitmq.com>

So this certainly sounds like it *should* work. At the very least, part 
of our test suite asserts that e2e bindings get routed upstream just 
like queue bindings :-)

I think one way to simplify what you're doing would be for the staging 
broker to just contain a federated "ingestion" exchange, with an 
upstream of the production server's "ingestion" exchange, with no extra 
intermediate exchanges. (The upstream exchange does not need to be 
federated, unless it in turn has upstreams.) That sounds like a simpler 
way to get what you want, but what you are trying *should* work.

One possibility is that you haven't set up some of the intermediate 
bindings correctly? If you want to proceed with your current setup you 
could try binding queues to each exchange in the chain and seeing how 
far messages are getting.

Cheers, Simon

On 05/09/2012 11:19PM, Ilya Volodarsky wrote:
> Hi,
>
> I was trying to set up a federated exchange topology today, and had a
> bit of trouble. I have a /production /broker with an exchange called
> *ingestion*, which receives tasks from our API servers. There are queues
> bound to this exchange that consume it and process the API tasks.
>
> I then created a mirror cluster with a /staging /broker, and also
> created an exchange called *ingestion. *I wanted to route everything
> going from the /production/ broker's *ingestion* exchange to
> the/staging/ broker's *ingestion* exchange.
>
> I created a federated exchange called*production-ingestion* on the
> /staging/ broker, and that created a*staging-ingestion* upstream
> exchange on the/production/ broker.
>
> I first did an exchange-bind on the /staging/ broker:
> *production-ingestion *=> *ingestion*
> I then did an exchange-bind on the/production/ broker with source:
> *ingestion*  => *staging-ingestion*
>
> I saw no traffic going between the computers. I read that the federation
> plugin only transfers things it has subscriptions for, but is an
> exchange binding not counted as a subscription? If so, it feels like I
> am setting this up wrong. Some guidance would be very appreciated.
>
> Thanks,
>
> Ilya
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From joemonvarghese80 at gmail.com  Thu Sep  6 10:53:21 2012
From: joemonvarghese80 at gmail.com (Joemon Varghese)
Date: Thu, 6 Sep 2012 15:23:21 +0530
Subject: [rabbitmq-discuss] Rabbit MQ Dead Lock
Message-ID: <CALnUTWXzsU_U4aXzf+AK8HOmB+NW8yOA-U7_8saZn831ZYh=Sw@mail.gmail.com>

Hi,

 We are using Rabbit MQ 2.7.1 version in our application.We  have got
Request queue and response queue  .Whenver  we are sending a message to
queue we will create a message id and we will polling the response queue
and once we got the response we will acknowledge it.we are using the
subscription method for the polling.
But some times we are getting deadlock and its throwing "Thread Abort
error"

any one faced the same issue before.

Thanks in advance..

Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/258384ca/attachment.htm>

From joemonvarghese80 at gmail.com  Thu Sep  6 10:55:32 2012
From: joemonvarghese80 at gmail.com (Joemon Varghese)
Date: Thu, 6 Sep 2012 15:25:32 +0530
Subject: [rabbitmq-discuss] Rabbit MQ Dead Lock
In-Reply-To: <CALnUTWXzsU_U4aXzf+AK8HOmB+NW8yOA-U7_8saZn831ZYh=Sw@mail.gmail.com>
References: <CALnUTWXzsU_U4aXzf+AK8HOmB+NW8yOA-U7_8saZn831ZYh=Sw@mail.gmail.com>
Message-ID: <CALnUTWUSnNj5Fx0CxfWBAizmCsfMhoz3uJmFFW=n=XxnLysdqw@mail.gmail.com>

 Hi,

 We are using Rabbit MQ 2.7.1 version in our application.We  have got
Request queue and response queue  .Whenver  we are sending a message to
queue we will create a message id and we will polling the response queue
and once we got the response we will acknowledge it.we are using the
subscription method for the polling.
But some times we are getting deadlock and its throwing "Thread Abort
error"

any one faced the same issue before.

Thanks in advance..

Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/509fbfed/attachment.htm>

From simon at rabbitmq.com  Thu Sep  6 10:58:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Sep 2012 10:58:13 +0100
Subject: [rabbitmq-discuss] Odd delay in federation exchanges being
	recognized
In-Reply-To: <CACLE7iyK-fcHGPdvVu_oGpr3Tj3DncojMV_o4wpNDgAiqnPaOA@mail.gmail.com>
References: <CACLE7iyK-fcHGPdvVu_oGpr3Tj3DncojMV_o4wpNDgAiqnPaOA@mail.gmail.com>
Message-ID: <504873B5.3020409@rabbitmq.com>

That... certainly sounds very odd.

So the "unknown exchange type" message is what you get when you declare 
an exchange using a plugin, and then remove that plugin.

So could the exchange type be getting registered slowly somehow? Hard to 
believe, the registration happens during startup, and RabbitMQ shouldn't 
be able to get to the point where it's accepting connections without all 
exchange types being registered.

I'll have a look at that code in case anything jumps out, but it's 
pretty simple so don't hold your breath...

Cheers, Simon

On 05/09/2012 7:27PM, Matt Pietrek wrote:
> Let me admit up front that this is a weird one, but I'll press ahead on
> the chance there's something there.
>
> I've got two brokers I'm using the federation plugin with. I create a
> single exchange 'skytap' on each broker, and make the 'skytap' exchange
> on the other broker its upstream.
>
> I create the rabbitmq.config file dynamically before starting each
> broker. Starting from a blank slate (blowing away the mnesia directory),
> I launch the two nodes concurrently.
>
> When I go to the Exchange tab in either broker, I see two Exchanges as
> expected:
>
>   * federation: skytap -> rabbit at mq2.skytap.com
>     <mailto:rabbit at mq2.skytap.com> B
>   * skytap
>
>
> The type of the exchanges is x-federation-upstream and x-federation,
> respectively. However, when first starting up, the type column is a red
> color indicating a problem, and hovering over it, I get a message to the
> effect of "unknown exchange type x-federation. Messages published to
> this exchange won't work."
>
> Now, here's the interesting thing: I*f I wait long enough (usually
> around 10-15 minutes) **and without doing anything, the error state
> eventually goes away* and the Exchanges seem happy. This has happened at
> least three times, so it doesn't seem like a random fluke or that I
> accidentally did something.
>
> Here's my config file, FWIW...
>
> [
> {rabbit, [{cluster_nodes, [rabbit at mq1]}, {disk_free_limit, 104857600}]},
> {mnesia, [{debug, trace}]},
> {rabbitmq_federation, [{exchanges, [[{type, "topic"}, {upstream_set,
> "skytap_upstreams"}, {virtual_host, "/"}, {exchange, "skytap"}]]},
> {upstream_sets, [{"skytap_upstreams", [[{connection, "upstream-mq2"},
> {max_hops, 1}, {exchange, "skytap"}]]}]},
> {connections, [{"upstream-mq2", [{host, "mq2"}, {port, 5672}]}]}]}
> ].
>
> Again, I realize this sounds a bit wonky, but it's happened enough times
> to make me not think I'm crazy.
>
> Thanks,
>
> Matt
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From bsellner at seegrid.com  Thu Sep  6 11:29:27 2012
From: bsellner at seegrid.com (Brennan Sellner)
Date: Thu, 6 Sep 2012 06:29:27 -0400
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <504869E1.5010205@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
Message-ID: <50487B07.3020209@seegrid.com>

On 09/06/2012 05:16 AM, Matthias Radestock wrote:
> Brennan,
> 
> On 06/09/12 10:11, Brennan Sellner wrote:
>> Okay, thanks.  I wasn't sure if there were any other triggers that would
>> cause Rabbit to touch the disk, such as the creation of a queue.
> 
> Creation/deletion of durable queues/exchanges/bindings *does* touch the
> disk. With an fsync to boot.

Good to know -- I suspected as much, but I wasn't certain.  The queues
and exchanges in question are definitely non-durable, though.

Other parts of the system do use durable queues and exchanges: would the
creation or binding of durable queues via a separate connection to
Rabbit have the potential to impact a connection not dealing in durable
constructs?

Also, does the fsync occur only on the initial creation of the durable
queue, exchange, or binding?  Or does Rabbit hit the disk every time a
client asserts that a durable object exists?

Thanks,

-Brennan



From emile at rabbitmq.com  Thu Sep  6 11:35:31 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 06 Sep 2012 11:35:31 +0100
Subject: [rabbitmq-discuss] Rabbit MQ Dead Lock
In-Reply-To: <CALnUTWXzsU_U4aXzf+AK8HOmB+NW8yOA-U7_8saZn831ZYh=Sw@mail.gmail.com>
References: <CALnUTWXzsU_U4aXzf+AK8HOmB+NW8yOA-U7_8saZn831ZYh=Sw@mail.gmail.com>
Message-ID: <50487C73.4050304@rabbitmq.com>

Hi Joemon,

On 06/09/12 10:53, Joemon Varghese wrote:
> But some times we are getting deadlock and its throwing "Thread Abort
> error"

I don't recall this being reported before. So do you see a deadlock or a
thread abort error? What are the minimal steps needed to reproduce the
error? Are you able to reproduce it reliably?

-Emile



From sajhak at gmail.com  Thu Sep  6 11:39:11 2012
From: sajhak at gmail.com (Sajith Kariyawasam)
Date: Thu, 6 Sep 2012 16:09:11 +0530
Subject: [rabbitmq-discuss]  Simple C Client to read from a Queue
Message-ID: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>

Hi all,

My requirement is to read a message from an AMQP based broker queue, using
a C Client.

I tested the samples found in
https://github.com/alanxz/rabbitmq-c<http://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Falanxz%2Frabbitmq-c&sa=D&sntz=1&usg=AFQjCNEMwRO8OLSNeNdnSc0ZrkktMhO50A>,
there I'm more interested in amqp_listenq.c programme.

But my requirement is to run this client periodically, should not
continuously listen to the message queue (as in this example). I need to
read just a simple message and out put the text content of that message.

How can I do that using C code? Since I'm having a very little experience
with C, it would be very helpful if I can get a sample.

Thanks
Sajith

-- 
Best Regards
Sajith
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/c3dcd7ab/attachment.htm>

From joemonvarghese80 at gmail.com  Thu Sep  6 11:53:39 2012
From: joemonvarghese80 at gmail.com (Joemon Varghese)
Date: Thu, 6 Sep 2012 16:23:39 +0530
Subject: [rabbitmq-discuss] Rabbit MQ Dead Lock
In-Reply-To: <50487C73.4050304@rabbitmq.com>
References: <CALnUTWXzsU_U4aXzf+AK8HOmB+NW8yOA-U7_8saZn831ZYh=Sw@mail.gmail.com>
	<50487C73.4050304@rabbitmq.com>
Message-ID: <CALnUTWXp2rj5tkZSP93q98DBkvxN__A-HmT2=fYY5ka_+=X2Vw@mail.gmail.com>

Hi Emile,

 We are not able to reproduce this issue.We are  getting thread abort error.
   Is there any chances of message being automatically deleted from Queue
after certain amount of time.?
 because  sometimes my queries will take more than 1 hour but still i am
keep on polling for the Response queue  for this     mesage id.

Thanks and Regards
Joe

On Thu, Sep 6, 2012 at 4:05 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Joemon,
>
> On 06/09/12 10:53, Joemon Varghese wrote:
> > But some times we are getting deadlock and its throwing "Thread Abort
> > error"
>
> I don't recall this being reported before. So do you see a deadlock or a
> thread abort error? What are the minimal steps needed to reproduce the
> error? Are you able to reproduce it reliably?
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/6fe85a73/attachment.htm>

From tim at rabbitmq.com  Thu Sep  6 12:03:50 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 6 Sep 2012 12:03:50 +0100
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
Message-ID: <D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>

On 6 Sep 2012, at 11:39, Sajith Kariyawasam wrote:

> Hi all, 
> 
> My requirement is to read a message from an AMQP based broker queue, using a C Client. 
> 
> I tested the samples found in https://github.com/alanxz/rabbitmq-c, there I'm more interested in amqp_listenq.c programme.
> 
> But my requirement is to run this client periodically, should not continuously listen to the message queue (as in this example). I need to read just a simple message and out put the text content of that message.
> 

Does amqp_consumer.c not do more of what you're interested in?

> How can I do that using C code? Since I'm having a very little experience with C, it would be very helpful if I can get a sample.
> 

I can't help you learn C or write your code for you, but I can suggest you spend a bit more time looking at the samples for the client library as they seem to cover what you're asking for.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/90bade3a/attachment.htm>

From tim at rabbitmq.com  Thu Sep  6 12:11:50 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 6 Sep 2012 12:11:50 +0100
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
Message-ID: <FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>


On 6 Sep 2012, at 12:03, Tim Watson wrote:

> On 6 Sep 2012, at 11:39, Sajith Kariyawasam wrote:
> 
>> Hi all, 
>> 
>> My requirement is to read a message from an AMQP based broker queue, using a C Client. 
>> 
>> I tested the samples found in https://github.com/alanxz/rabbitmq-c, there I'm more interested in amqp_listenq.c programme.
>> 
>> But my requirement is to run this client periodically, should not continuously listen to the message queue (as in this example). I need to read just a simple message and out put the text content of that message.
>> 
> 

Someone pointed out that you're after basic.get though. If you are *just* trying to pull 1 message off the queue and then terminate the program, then just drop the loops. 

> Does amqp_consumer.c not do more of what you're interested in?
> 

No, the listenq.c sample is the one you want. It really does seem that you're trying to get someone to write your C code for you though - as I said, just remove the looping - and whilst we are very keen to help with rabbit questions, I suspect this might be going a bit far even for the more enthusiastic among us. ;)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/653091b7/attachment.htm>

From emile at rabbitmq.com  Thu Sep  6 12:30:16 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 06 Sep 2012 12:30:16 +0100
Subject: [rabbitmq-discuss] Rabbit MQ Dead Lock
In-Reply-To: <CALnUTWXp2rj5tkZSP93q98DBkvxN__A-HmT2=fYY5ka_+=X2Vw@mail.gmail.com>
References: <CALnUTWXzsU_U4aXzf+AK8HOmB+NW8yOA-U7_8saZn831ZYh=Sw@mail.gmail.com>
	<50487C73.4050304@rabbitmq.com>
	<CALnUTWXp2rj5tkZSP93q98DBkvxN__A-HmT2=fYY5ka_+=X2Vw@mail.gmail.com>
Message-ID: <50488948.7040200@rabbitmq.com>

Hi Joemon,

On 06/09/12 11:53, Joemon Varghese wrote:
>  We are not able to reproduce this issue.We are  getting thread abort error.

Ok, but that does not sound like deadlock.

>    Is there any chances of message being automatically
> deleted from Queue after certain amount of time.?

Yes: messages may be removed from a queue if the queue was declared with
TTL: http://www.rabbitmq.com/ttl.html#per-queue-message-ttl

>  because  sometimes my queries will take more than 1 hour but still i am
> keep on polling for the Response queue  for this     mesage id.

I'm afraid you have not provided enough information for me to
investigate any further. If you can reproduce the problem then please
provide a description of the steps to reproduce, or a minimal
self-contained piece of code that triggers the failure. In the meantime
here are some suggestions:

- v2.7.1 is very old now. Upgrade to the latest version
- Try not to use polling



-Emile


From sajhak at gmail.com  Thu Sep  6 12:44:35 2012
From: sajhak at gmail.com (Sajith Kariyawasam)
Date: Thu, 6 Sep 2012 17:14:35 +0530
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
Message-ID: <CANGgF+9t4q6oSZxSerpesAwp_jqE6iagv32j9Tvp=Eau=iSxbg@mail.gmail.com>

Hi Tim,

Thanks for the reply and sorry for the inconvenience if I have put the
message into a "wrong" thread.

Even before putting the mail I tried commenting out the loops, but still I
saw it does wait until a message is available in Queue.

Also, I found
http://rabbitmq.1065348.n5.nabble.com/Librabbitmq-c-API-td6134.html , that
they have referred to "amqp_basic_get", and was thinking that someone will
give some help in using amqp_basic_get. I couldn't find a reference
document for C API, but there are docs available for Java/Erlang..etc.. but
could not find any for C.  "amqp_basic_get" have not been used in the set
of example as well...

Actually I'm not a C developer, but a Java Developer, and my requirement is
bit urgent, that's why I was expecting such kind of a basic help. If I had
time, definitely I would have go through the code n will try to understand
more..

IMO, it would have been better If the documentation related to C libraries
are bit improved, so that it will be easy for new comers to understand..


On Thu, Sep 6, 2012 at 4:41 PM, Tim Watson <tim at rabbitmq.com> wrote:

>
> On 6 Sep 2012, at 12:03, Tim Watson wrote:
>
> On 6 Sep 2012, at 11:39, Sajith Kariyawasam wrote:
>
> Hi all,
>
> My requirement is to read a message from an AMQP based broker queue, using
> a C Client.
>
> I tested the samples found in https://github.com/alanxz/rabbitmq-c<http://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Falanxz%2Frabbitmq-c&sa=D&sntz=1&usg=AFQjCNEMwRO8OLSNeNdnSc0ZrkktMhO50A>,
> there I'm more interested in amqp_listenq.c programme.
>
>
> But my requirement is to run this client periodically, should not
> continuously listen to the message queue (as in this example). I need to
> read just a simple message and out put the text content of that message.
>
>
>
> Someone pointed out that you're after basic.get though. If you are *just*
> trying to pull 1 message off the queue and then terminate the program, then
> just drop the loops.
>
> Does amqp_consumer.c not do more of what you're interested in?
>
>
> No, the listenq.c sample is the one you want. It really does seem that
> you're trying to get someone to write your C code for you though - as I
> said, just remove the looping - and whilst we are very keen to help with
> rabbit questions, I suspect this might be going a bit far even for the more
> enthusiastic among us. ;)
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Best Regards
Sajith
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/712436e6/attachment.htm>

From tim at rabbitmq.com  Thu Sep  6 12:23:47 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 6 Sep 2012 12:23:47 +0100
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
Message-ID: <415FE6D8-C51C-481F-9FB1-D9BCBAA36C24@rabbitmq.com>

On 6 Sep 2012, at 12:11, Tim Watson wrote:
> 
> No, the listenq.c sample is the one you want. It really does seem that you're trying to get someone to write your C code for you though - as I said, just remove the looping - and whilst we are very keen to help with rabbit questions, I suspect this might be going a bit far even for the more enthusiastic among us. ;)

In fact looking at the sources for a couple of minutes now, you'll be better off using amqp_basic_get. I didn't notice that at first. There didn't seem to be an example of using that in the repository, so I now understand why you were struggling to see what to do. The returns a amqp_rpc_reply_t struct, from which you can probably get you want via the reply field.

amqp_rpc_reply_t amqp_basic_get(amqp_connection_state_t state,
				amqp_channel_t channel,
				amqp_bytes_t queue,
				amqp_boolean_t no_ack)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/61cbf786/attachment.htm>

From joemonvarghese80 at gmail.com  Thu Sep  6 13:25:39 2012
From: joemonvarghese80 at gmail.com (Joemon Varghese)
Date: Thu, 6 Sep 2012 17:55:39 +0530
Subject: [rabbitmq-discuss] RE  Rabbit MQ Dead Lock
Message-ID: <CALnUTWXh0CdSmZqzn2i+7JcWrGzZ4PS5fVCTWWt40fjzP_JURQ@mail.gmail.com>

I have attached the code that i have implemented.


 //declare a Input queue
                strQueue = InputQueue + "." + objMessage.InputKey;
                model = GetModel();
                model.QueueDeclare(strQueue);
                model.QueueBind(strQueue, Exchange, objMessage.InputKey,
true, null);
                //declare a Response queue
                strResponseQueue = ResponseQueue + "." +
objMessage.InputKey; ;
                modelResponse = GetModelForResponse();
                modelResponse.QueueDeclare(strResponseQueue);
                object msgTask = objMessage.Action;
                //Serialize the Message object
                MemoryStream stream = new MemoryStream();
                DataContractJsonSerializer jsonSerializer = new
DataContractJsonSerializer(typeof(Message));
                jsonSerializer.WriteObject(stream, objMessage);
                byte[] messageBody = stream.ToArray();
                IBasicProperties msgProperties =
model.CreateBasicProperties();
                msgProperties.AppId = RabbitHelper.AppID;
                msgProperties.Headers = new Dictionary<string, object>();
                msgProperties.Headers.Add("MessageTask", msgTask);
                msgProperties.MessageId = Guid.NewGuid().ToString();
                MessageID = msgProperties.MessageId;

                modelResponse.QueueBind(strResponseQueue, Exchange,
MessageID, true, null);
                model.BasicPublish(Exchange, objMessage.InputKey,
msgProperties, messageBody);
 subscription = new Subscription(modelResponse, strResponseQueue, false);
                while (subscription.Next(-1, out basicArgs))
                {
                    if (!object.ReferenceEquals(basicArgs, null))
                    {
                        IBasicProperties props = basicArgs.BasicProperties;
                        byte[] responseMessageBody = basicArgs.Body;
                        //Deserialize the message object
                        IMessage recvMessage =
RabbitHelper.ConvertJsonToObject<Message>(responseMessageBody);
 //validate if this is the desired response
                        if (props.MessageId == MessageID)
                        {
                            retVal = recvMessage.ReturnValue;
                            //acknowledge the queue
                            subscription.Ack(basicArgs);
                        }
                    }
                }



Thanks and Regards,
Joe
 On Thu, Sep 6, 2012 at 5:00 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Joemon,
>
> On 06/09/12 11:53, Joemon Varghese wrote:
> >  We are not able to reproduce this issue.We are  getting thread abort
> error.
>
> Ok, but that does not sound like deadlock.
>
> >    Is there any chances of message being automatically
> > deleted from Queue after certain amount of time.?
>
> Yes: messages may be removed from a queue if the queue was declared with
> TTL: http://www.rabbitmq.com/ttl.html#per-queue-message-ttl
>
> >  because  sometimes my queries will take more than 1 hour but still i am
> > keep on polling for the Response queue  for this     mesage id.
>
> I'm afraid you have not provided enough information for me to
> investigate any further. If you can reproduce the problem then please
> provide a description of the steps to reproduce, or a minimal
> self-contained piece of code that triggers the failure. In the meantime
> here are some suggestions:
>
> - v2.7.1 is very old now. Upgrade to the latest version
> - Try not to use polling
>
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/29482534/attachment.htm>

From francois at teksol.info  Thu Sep  6 13:40:01 2012
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Thu, 6 Sep 2012 08:40:01 -0400
Subject: [rabbitmq-discuss] Delivering to one and only one queue
In-Reply-To: <5048638F.6050104@rabbitmq.com>
References: <B0AF2E82-F575-42F6-A40C-D528E5ACAA2B@teksol.info>
	<5048638F.6050104@rabbitmq.com>
Message-ID: <4621A2E1-9E7F-4311-B0C0-439AAD0D01B9@teksol.info>

I read about that the other day. Sounds like a good way to go, yes.

Thanks!
Fran?ois

Le 2012-09-06 ? 04:49, Simon MacMullen a ?crit :

> Sounds like the consistent hash exchange will do what you want?
> 
> http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/raw-file/default/README.md
> 
> This ships with RabbitMQ as a plugin, but is disabled by default.
> 
> Cheers, Simon
> 
> On 05/09/2012 2:40PM, Fran?ois Beausoleil wrote:
>> Hi all!
>> 
>> I asked this question on StackOverflow yesterday, and I was looking to broaden the audience: http://stackoverflow.com/questions/12266488/routing-messages-to-one-and-only-one-queue
>> 
>> Here's a copy of the question:
>> 
>> """
>> I have a Topic exchange from which I'd like to distribute messages to two queues on two servers part of a cluster, in order to reduce memory pressure on any particular server. My consumers are periodically slow, and I sometimes run into the high memory watermark.
>> 
>> The way I tried to resolve this is by routing messages using an intermediate direct exchange, with two queues bound to the exchange:
>> 
>> a (topic) -> a1 (direct) -> q1/q2 (bound to routing key "a")
>> 
>> But the messages were routed to both queues, as AMQP intends. Anyone has ideas? What I need is an exchange that routes to one and only one queue, even if the routing key matches many queues. I'd prefer not to change my routing keys, but that could be arranged.
>> 
>> I found Selective routing with RabbitMQ, which may mean I'll need to implement my own routing logic. Hopefully, this already exists somewhere else.
>> """
>> 
>> Any ideas?
>> 
>> Thank you very much!
>> Fran?ois Beausoleil
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 


From francois at teksol.info  Thu Sep  6 13:44:15 2012
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Thu, 6 Sep 2012 08:44:15 -0400
Subject: [rabbitmq-discuss] Delivering to one and only one queue
In-Reply-To: <5048638F.6050104@rabbitmq.com>
References: <B0AF2E82-F575-42F6-A40C-D528E5ACAA2B@teksol.info>
	<5048638F.6050104@rabbitmq.com>
Message-ID: <F4D07CAD-48F8-46A0-BE68-C887FC791E12@teksol.info>

I replied much too soon :( Does the consistent hash exchange accept strings as routing keys, and compute a hash from it? From the example, it appears not:

    routing_key = list_to_binary(integer_to_list(random:uniform(1000000))

My routing keys have a consistent format, of the form "persona.qualified.UUID". The UUID part is what would trigger the consistent hash, because the rest of the routing key is constant.

Thanks!
Fran?ois

Le 2012-09-06 ? 04:49, Simon MacMullen a ?crit :

> Sounds like the consistent hash exchange will do what you want?
> 
> http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/raw-file/default/README.md
> 
> This ships with RabbitMQ as a plugin, but is disabled by default.
> 
> Cheers, Simon
> 
> On 05/09/2012 2:40PM, Fran?ois Beausoleil wrote:
>> Hi all!
>> 
>> I asked this question on StackOverflow yesterday, and I was looking to broaden the audience: http://stackoverflow.com/questions/12266488/routing-messages-to-one-and-only-one-queue
>> 
>> Here's a copy of the question:
>> 
>> """
>> I have a Topic exchange from which I'd like to distribute messages to two queues on two servers part of a cluster, in order to reduce memory pressure on any particular server. My consumers are periodically slow, and I sometimes run into the high memory watermark.
>> 
>> The way I tried to resolve this is by routing messages using an intermediate direct exchange, with two queues bound to the exchange:
>> 
>> a (topic) -> a1 (direct) -> q1/q2 (bound to routing key "a")
>> 
>> But the messages were routed to both queues, as AMQP intends. Anyone has ideas? What I need is an exchange that routes to one and only one queue, even if the routing key matches many queues. I'd prefer not to change my routing keys, but that could be arranged.
>> 
>> I found Selective routing with RabbitMQ, which may mean I'll need to implement my own routing logic. Hopefully, this already exists somewhere else.
>> """
>> 
>> Any ideas?
>> 
>> Thank you very much!
>> Fran?ois Beausoleil
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 


From emile at rabbitmq.com  Thu Sep  6 14:25:01 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 06 Sep 2012 14:25:01 +0100
Subject: [rabbitmq-discuss] RE  Rabbit MQ Dead Lock
In-Reply-To: <CALnUTWXh0CdSmZqzn2i+7JcWrGzZ4PS5fVCTWWt40fjzP_JURQ@mail.gmail.com>
References: <CALnUTWXh0CdSmZqzn2i+7JcWrGzZ4PS5fVCTWWt40fjzP_JURQ@mail.gmail.com>
Message-ID: <5048A42D.1090607@rabbitmq.com>

Hi,

On 06/09/12 13:25, Joemon Varghese wrote:
> I have attached the code that i have implemented.

This code is not self-contained, so I'm unable to run it. If you are
able to provide minimal self-contained code then it will be easier to
help you.

How far are you able to follow the message path before the problem
manifests? E.g. after publishing, can you confirm independently (using
the management console or rabbitmqctl) that the message arrived at the
expected destination queue? Once published, does the subscription
deliver the message?

Where does the problem occur exactly? Does the stacktrace shed any light?



-Emile



From bsellner at seegrid.com  Thu Sep  6 14:26:57 2012
From: bsellner at seegrid.com (Brennan Sellner)
Date: Thu, 6 Sep 2012 09:26:57 -0400
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <50486CC1.1060209@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
	<7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
	<50486CC1.1060209@rabbitmq.com>
Message-ID: <5048A4A1.9090307@seegrid.com>

On 09/06/2012 05:28 AM, Matthias Radestock wrote:
> On 06/09/12 10:21, Tim Watson wrote:
>> On 6 Sep 2012, at 10:16, Matthias Radestock wrote:
>>> Creation/deletion of durable queues/exchanges/bindings *does* touch
>>> the disk. With an fsync to boot.

We may have a winner...  It turns out that the exchange is durable,
though the queues being created and bound are not.  Our wrapper around
librabbitmq-c is setting all exchanges to durable; I had (mistakenly)
assumed that the queue's durability must match the exchange's.  From
re-reading http://www.rabbitmq.com/tutorials/amqp-concepts.html, it
looks like a durable queue may only bind to durable exchanges, but a
non-durable queue is free to bind to durable and non-durable exchanges.

My apologies for leading anyone astray.

So, a new set of questions:

Which of the following causes Rabbit to touch disk (and possibly fsync)?
  - Redeclaring an existing durable exchange
  - Binding a non-durable queue to a durable exchange

>> amqp_consume
> 
> no.

If binding a non-durable queue to a durable exchange causes disk access,
a possible explanation for the slow amqp_consume call is that the
immediately preceding amqp_queue_bind is at fault.  Does Rabbit hit the
disk synchronously before sending the bind-ok method, or is it possible
the disk access could affect later calls?

Depending on the answers to the above, a potential explanation for the
observed behavior could be:

amqp_exchange_declare
  - Durable, but being redeclared in all of the problem cases
  - May cause delayed fsync
amqp_queue_declare # Sometimes slow
  - Non-durable
  - Sometimes slowed by the fsync from exchange_declare
amqp_queue_bind    # Sometimes slow
  - Binding non-durable queue to durable exchange
  - May cause synchronous or delayed fsync
  - If fsync occurs before bind-ok is sent, we attribute the delay
    to queue_bind
amqp_basic_consume # Sometimes slow
  - If queue_bind's fsync is delayed, we attribute it to basic_consume

We can certainly change the durability of the exchange if it's at fault,
but I'd like to understand the system's behavior first. :-)

Thanks,

-Brennan


From tgrange at globalpersonals.co.uk  Thu Sep  6 11:05:11 2012
From: tgrange at globalpersonals.co.uk (Tom Grange)
Date: Thu, 6 Sep 2012 11:05:11 +0100
Subject: [rabbitmq-discuss] List consumer connections/channels per queue
Message-ID: <D3855AB32DB24206A9D0A70AF06D1743@globalpersonals.co.uk>

Hi, 

We need to kill all the consumer connections for only one queue through rabbitmqctl (the workers themselves are already dead) - but we need to be able to list only the connections for the one queue we are interested in.

Though rabbitmqctl or the api you can list the queues and list the consumer connections separately but not filter the consumer connection list down by queues.

Any idea how to do this?

Thanks

Tom 


-- 


Global Personals is a limited company registered in England and Wales.

Registered number: 04880697

Registered office: Minton Place, Victoria Street, Windsor, Berkshire, SL4 
1EG, United Kingdom
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/8cfd5640/attachment.htm>

From simon at rabbitmq.com  Thu Sep  6 16:34:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Sep 2012 16:34:28 +0100
Subject: [rabbitmq-discuss] List consumer connections/channels per queue
In-Reply-To: <D3855AB32DB24206A9D0A70AF06D1743@globalpersonals.co.uk>
References: <D3855AB32DB24206A9D0A70AF06D1743@globalpersonals.co.uk>
Message-ID: <5048C284.80906@rabbitmq.com>

I don't think it's convenient to do this from the command line, with 
either rabbitmqctl or rabbitmqadmin, but if you are driving the HTTP API 
directly it's easier. They key is that the HTTP API only adds consumer 
details to a queue when retrieving a single queue, not a list (since 
it's slightly expensive and not frequently called for).

So GET /api/<vhost>/<queue_name>, then look in consumer_details and for 
each item in the array there look in channel_details.connection_name and 
DELETE /api/connections/<connection_name>.

Cheers, Simon

On 06/09/2012 11:05AM, Tom Grange wrote:
> Hi,
>
> We need to kill all the consumer connections for only one queue through
> rabbitmqctl (the workers themselves are already dead) - but we need to
> be able to list only the connections for the one queue we are interested in.
>
> Though rabbitmqctl or the api you can list the queues and list the
> consumer connections separately but not filter the consumer connection
> list down by queues.
>
> Any idea how to do this?
>
> Thanks
>
> Tom
>
>
> Global Personals is a limited company registered in England and Wales.
>
> Registered number: 04880697
>
> Registered office: Minton Place, Victoria Street, Windsor, Berkshire,
> SL4 1EG, United Kingdom
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Thu Sep  6 16:43:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Sep 2012 16:43:06 +0100
Subject: [rabbitmq-discuss] Delivering to one and only one queue
In-Reply-To: <F4D07CAD-48F8-46A0-BE68-C887FC791E12@teksol.info>
References: <B0AF2E82-F575-42F6-A40C-D528E5ACAA2B@teksol.info>
	<5048638F.6050104@rabbitmq.com>
	<F4D07CAD-48F8-46A0-BE68-C887FC791E12@teksol.info>
Message-ID: <5048C48A.9000802@rabbitmq.com>

On 06/09/2012 1:44PM, Fran?ois Beausoleil wrote:
> I replied much too soon :( Does the consistent hash exchange accept
> strings as routing keys, and compute a hash from it?

It has to - routing keys are always strings.

> From the
> example, it appears not:
>
> routing_key =
> list_to_binary(integer_to_list(random:uniform(1000000))

The Erlang client uses the Erlang "binary" type for strings. Erlang is a 
wonderful language in many ways, but its model of strings is not the 
most consistent.

Anyway, that line of code means "generate a random number and convert it 
to a string".

> My routing keys have a consistent format, of the form
> "persona.qualified.UUID". The UUID part is what would trigger the
> consistent hash, because the rest of the routing key is constant.

Should be fine.

Cheers, Simon

From simon at rabbitmq.com  Thu Sep  6 17:08:12 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 06 Sep 2012 17:08:12 +0100
Subject: [rabbitmq-discuss] List consumer connections/channels per queue
In-Reply-To: <266777B0BEDE4D218C80113E8BC88E05@globalpersonals.co.uk>
References: <D3855AB32DB24206A9D0A70AF06D1743@globalpersonals.co.uk>
	<5048C284.80906@rabbitmq.com>
	<266777B0BEDE4D218C80113E8BC88E05@globalpersonals.co.uk>
Message-ID: <5048CA6C.2030707@rabbitmq.com>

Yes - all names need to be URL encoded - so the vhost named "/" becomes 
"%2f", e.g. you address "my queue" in "/" as "/api/%2f/my%20queue".

You'll need to do this for connection names too.

Cheers, Simon

On 06/09/2012 5:05PM, Tom Grange wrote:
> Thanks for the reply, ok that sounds like it should work, happy to use
> the HTTP API if I can.
>
> The issue with your solution is defining the ghost name as it's /
>
> for example
>
> [{"name":"/","tracing":false}]
>
> Is there a special way to define this name in the API rather than "//"
> or "///" which doesn't really make sense.
>
> Thanks
>
> Tom
>
> *Tom Grange*
> Technical Operations Engineer
> Global Personals Limited
>
> http://globalpersonals.co.uk <http://globalpersonals.co.uk/> and
> http://globaldev.co.uk <http://globaldev.co.uk/>
> Phone: 01753 757542
>
>
> Sent with Sparrow <http://www.sparrowmailapp.com/?sig>
>
> On Thursday, 6 September 2012 at 16:34, Simon MacMullen wrote:
>
>> I don't think it's convenient to do this from the command line, with
>> either rabbitmqctl or rabbitmqadmin, but if you are driving the HTTP API
>> directly it's easier. They key is that the HTTP API only adds consumer
>> details to a queue when retrieving a single queue, not a list (since
>> it's slightly expensive and not frequently called for).
>>
>> So GET /api/<vhost>/<queue_name>, then look in consumer_details and for
>> each item in the array there look in channel_details.connection_name and
>> DELETE /api/connections/<connection_name>.
>>
>> Cheers, Simon
>>
>> On 06/09/2012 11:05AM, Tom Grange wrote:
>>> Hi,
>>>
>>> We need to kill all the consumer connections for only one queue through
>>> rabbitmqctl (the workers themselves are already dead) - but we need to
>>> be able to list only the connections for the one queue we are
>>> interested in.
>>>
>>> Though rabbitmqctl or the api you can list the queues and list the
>>> consumer connections separately but not filter the consumer connection
>>> list down by queues.
>>>
>>> Any idea how to do this?
>>>
>>> Thanks
>>>
>>> Tom
>>>
>>>
>>> Global Personals is a limited company registered in England and Wales.
>>>
>>> Registered number: 04880697
>>>
>>> Registered office: Minton Place, Victoria Street, Windsor, Berkshire,
>>> SL4 1EG, United Kingdom
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> Global Personals is a limited company registered in England and Wales.
>
> Registered number: 04880697
>
> Registered office: Minton Place, Victoria Street, Windsor, Berkshire,
> SL4 1EG, United Kingdom
>

From mpietrek at skytap.com  Thu Sep  6 17:18:05 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 6 Sep 2012 09:18:05 -0700
Subject: [rabbitmq-discuss] Odd delay in federation exchanges being
	recognized
In-Reply-To: <504873B5.3020409@rabbitmq.com>
References: <CACLE7iyK-fcHGPdvVu_oGpr3Tj3DncojMV_o4wpNDgAiqnPaOA@mail.gmail.com>
	<504873B5.3020409@rabbitmq.com>
Message-ID: <CACLE7ixU458C1+StszpkVOAagZ-F-7kH5UERBt_CA2rpQCFaFg@mail.gmail.com>

Thanks Simon.

I agree, it's odd. I'll keep an eye out for further clues if/when I see it
again. I mostly wanted to know if there was something obvious to you folks.
For instance (totally a stab in the dark here...) perhaps connections
between federated brokers taking a long time to establish.

Matt

On Thu, Sep 6, 2012 at 2:58 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> That... certainly sounds very odd.
>
> So the "unknown exchange type" message is what you get when you declare an
> exchange using a plugin, and then remove that plugin.
>
> So could the exchange type be getting registered slowly somehow? Hard to
> believe, the registration happens during startup, and RabbitMQ shouldn't be
> able to get to the point where it's accepting connections without all
> exchange types being registered.
>
> I'll have a look at that code in case anything jumps out, but it's pretty
> simple so don't hold your breath...
>
> Cheers, Simon
>
>
> On 05/09/2012 7:27PM, Matt Pietrek wrote:
>
>> Let me admit up front that this is a weird one, but I'll press ahead on
>> the chance there's something there.
>>
>> I've got two brokers I'm using the federation plugin with. I create a
>> single exchange 'skytap' on each broker, and make the 'skytap' exchange
>> on the other broker its upstream.
>>
>> I create the rabbitmq.config file dynamically before starting each
>> broker. Starting from a blank slate (blowing away the mnesia directory),
>> I launch the two nodes concurrently.
>>
>> When I go to the Exchange tab in either broker, I see two Exchanges as
>> expected:
>>
>>   * federation: skytap -> rabbit at mq2.skytap.com
>>     <mailto:rabbit at mq2.skytap.com> B
>>   * skytap
>>
>>
>>
>> The type of the exchanges is x-federation-upstream and x-federation,
>> respectively. However, when first starting up, the type column is a red
>> color indicating a problem, and hovering over it, I get a message to the
>> effect of "unknown exchange type x-federation. Messages published to
>> this exchange won't work."
>>
>> Now, here's the interesting thing: I*f I wait long enough (usually
>> around 10-15 minutes) **and without doing anything, the error state
>> eventually goes away* and the Exchanges seem happy. This has happened at
>>
>> least three times, so it doesn't seem like a random fluke or that I
>> accidentally did something.
>>
>> Here's my config file, FWIW...
>>
>> [
>> {rabbit, [{cluster_nodes, [rabbit at mq1]}, {disk_free_limit, 104857600}]},
>> {mnesia, [{debug, trace}]},
>> {rabbitmq_federation, [{exchanges, [[{type, "topic"}, {upstream_set,
>> "skytap_upstreams"}, {virtual_host, "/"}, {exchange, "skytap"}]]},
>> {upstream_sets, [{"skytap_upstreams", [[{connection, "upstream-mq2"},
>> {max_hops, 1}, {exchange, "skytap"}]]}]},
>> {connections, [{"upstream-mq2", [{host, "mq2"}, {port, 5672}]}]}]}
>> ].
>>
>> Again, I realize this sounds a bit wonky, but it's happened enough times
>> to make me not think I'm crazy.
>>
>> Thanks,
>>
>> Matt
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/4549c474/attachment.htm>

From ilya at segment.io  Thu Sep  6 19:58:27 2012
From: ilya at segment.io (Ilya Volodarsky)
Date: Thu, 6 Sep 2012 11:58:27 -0700
Subject: [rabbitmq-discuss] Federated Exchange Advice
In-Reply-To: <50487033.6030108@rabbitmq.com>
References: <7307b1d8-d53f-457b-8660-59786afc673d@googlegroups.com>
	<50487033.6030108@rabbitmq.com>
Message-ID: <CAG8tyE7uodG_Fo_cxQ80b_cZb5zVeOCisQpnMDXE5Wrb+i3Bnw@mail.gmail.com>

Thanks Simon. I was using RabbitMQ management console to set up the
exchange to exchange bindings, and the upstream exchanges showed up as
"production-ingestion from rabbit at hostname", and when I tried to bind
ingestion to production-ingestion, it wouldn't let me saying that the
exchange didnt exist. I had to give the full upstream exchange name which
looked precarious since it contained the actual hostname of the connecting
computer.

Do you think that doing that / or using RMQ management console could have
something to do with it?

Thanks,

Ilya

On Thu, Sep 6, 2012 at 2:43 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> So this certainly sounds like it *should* work. At the very least, part of
> our test suite asserts that e2e bindings get routed upstream just like
> queue bindings :-)
>
> I think one way to simplify what you're doing would be for the staging
> broker to just contain a federated "ingestion" exchange, with an upstream
> of the production server's "ingestion" exchange, with no extra intermediate
> exchanges. (The upstream exchange does not need to be federated, unless it
> in turn has upstreams.) That sounds like a simpler way to get what you
> want, but what you are trying *should* work.
>
> One possibility is that you haven't set up some of the intermediate
> bindings correctly? If you want to proceed with your current setup you
> could try binding queues to each exchange in the chain and seeing how far
> messages are getting.
>
> Cheers, Simon
>
> On 05/09/2012 11:19PM, Ilya Volodarsky wrote:
>
>> Hi,
>>
>> I was trying to set up a federated exchange topology today, and had a
>> bit of trouble. I have a /production /broker with an exchange called
>> *ingestion*, which receives tasks from our API servers. There are queues
>> bound to this exchange that consume it and process the API tasks.
>>
>> I then created a mirror cluster with a /staging /broker, and also
>> created an exchange called *ingestion. *I wanted to route everything
>> going from the /production/ broker's *ingestion* exchange to
>> the/staging/ broker's *ingestion* exchange.
>>
>> I created a federated exchange called*production-ingestion* on the
>> /staging/ broker, and that created a*staging-ingestion* upstream
>> exchange on the/production/ broker.
>>
>> I first did an exchange-bind on the /staging/ broker:
>> *production-ingestion *=> *ingestion*
>> I then did an exchange-bind on the/production/ broker with source:
>> *ingestion*  => *staging-ingestion*
>>
>> I saw no traffic going between the computers. I read that the federation
>> plugin only transfers things it has subscriptions for, but is an
>> exchange binding not counted as a subscription? If so, it feels like I
>> am setting this up wrong. Some guidance would be very appreciated.
>>
>> Thanks,
>>
>> Ilya
>>
>>
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/461c0ccd/attachment.htm>

From sajhak at gmail.com  Fri Sep  7 08:11:29 2012
From: sajhak at gmail.com (Sajith Kariyawasam)
Date: Fri, 7 Sep 2012 12:41:29 +0530
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <415FE6D8-C51C-481F-9FB1-D9BCBAA36C24@rabbitmq.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
	<415FE6D8-C51C-481F-9FB1-D9BCBAA36C24@rabbitmq.com>
Message-ID: <CANGgF+-wrjhnsQkN+Ctk91N-e6Z+tK5Pf4di9-JtgMWKDY+SCQ@mail.gmail.com>

Thanks for the clue,

I tried using it with following code,

  die_on_error(sockfd = amqp_open_socket(hostname, port), "Opening socket");
  conn = amqp_new_connection();
  amqp_set_sockfd(conn, sockfd);
  die_on_amqp_error(amqp_login(conn, "/", 0, 131072, 0,
AMQP_SASL_METHOD_PLAIN, "guest", "guest"),"Logging in");
  if (!amqp_channel_open(conn, 1))
                die_on_amqp_error(amqp_get_rpc_reply(conn), "opening
channel");
  reply =  amqp_basic_get(conn,1,amqp_cstring_bytes(queuename),1);

I would like to verify whether the set of methods I have invoked and the
order of invocation are correct ?



On Thu, Sep 6, 2012 at 4:53 PM, Tim Watson <tim at rabbitmq.com> wrote:

> On 6 Sep 2012, at 12:11, Tim Watson wrote:
>
>
> No, the listenq.c sample is the one you want. It really does seem that
> you're trying to get someone to write your C code for you though - as I
> said, just remove the looping - and whilst we are very keen to help with
> rabbit questions, I suspect this might be going a bit far even for the more
> enthusiastic among us. ;)
>
>
> In fact looking at the sources for a couple of minutes now, you'll be
> better off using amqp_basic_get. I didn't notice that at first. There
> didn't seem to be an example of using that in the repository, so I now
> understand why you were struggling to see what to do. The returns a
> amqp_rpc_reply_t struct, from which you can probably get you want via the
> reply field.
>
> amqp_rpc_reply_t amqp_basic_get(amqp_connection_state_t state,
> 				amqp_channel_t channel,
> 				amqp_bytes_t queue,
> 				amqp_boolean_t no_ack)
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Best Regards
Sajith
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/ebf0de84/attachment.htm>

From brett.r.cameron at gmail.com  Fri Sep  7 08:23:57 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 7 Sep 2012 19:23:57 +1200
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
Message-ID: <CALPqkiqmz+SRbVP9cku596xKqAL94V4iPDEF5SFBW2+ZRW23cQ@mail.gmail.com>

Sajith,

Could you just use something like
http://manpages.ubuntu.com/manpages/natty/man1/amqp-consume.1.html?

Brett



On Thu, Sep 6, 2012 at 11:11 PM, Tim Watson <tim at rabbitmq.com> wrote:

>
> On 6 Sep 2012, at 12:03, Tim Watson wrote:
>
> On 6 Sep 2012, at 11:39, Sajith Kariyawasam wrote:
>
> Hi all,
>
> My requirement is to read a message from an AMQP based broker queue, using
> a C Client.
>
> I tested the samples found in https://github.com/alanxz/rabbitmq-c<http://www.google.com/url?q=https%3A%2F%2Fgithub.com%2Falanxz%2Frabbitmq-c&sa=D&sntz=1&usg=AFQjCNEMwRO8OLSNeNdnSc0ZrkktMhO50A>,
> there I'm more interested in amqp_listenq.c programme.
>
>
> But my requirement is to run this client periodically, should not
> continuously listen to the message queue (as in this example). I need to
> read just a simple message and out put the text content of that message.
>
>
>
> Someone pointed out that you're after basic.get though. If you are *just*
> trying to pull 1 message off the queue and then terminate the program, then
> just drop the loops.
>
> Does amqp_consumer.c not do more of what you're interested in?
>
>
> No, the listenq.c sample is the one you want. It really does seem that
> you're trying to get someone to write your C code for you though - as I
> said, just remove the looping - and whilst we are very keen to help with
> rabbit questions, I suspect this might be going a bit far even for the more
> enthusiastic among us. ;)
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/5dbe957c/attachment.htm>

From kilian.devouassoux at gmail.com  Fri Sep  7 08:32:37 2012
From: kilian.devouassoux at gmail.com (misterdev)
Date: Fri, 7 Sep 2012 00:32:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq v2.8.6 installation - Command make
	hangs forever
In-Reply-To: <48bfdcbd-707c-490c-aea9-83e4f8f840da@googlegroups.com>
References: <48bfdcbd-707c-490c-aea9-83e4f8f840da@googlegroups.com>
Message-ID: <8a8002fb-a7d6-4043-b003-701e87e458a6@googlegroups.com>

Any idea anyone ?

Thanks in advance.

Le jeudi 30 ao?t 2012 10:57:21 UTC+2, misterdev a ?crit :
>
> Hello all
> I have a problem when I want to install RAbbitMQ v2.8.5 and v2.8.6
> 1 - the command *make* give me errors : 
>
>> git: Command not found 
>>
> --> It'snormal because git is not installed on my server. Is that a 
> problem for the installation ? 
>
> 2 - a few seconds after giving me the git errors, *make *hangs after 
> these lines : 
>
>> rm -rf eldap-wrapper/build/dep-ezs
>> mkdir -p eldap-wrapper/build/dep-ezs
>> [elided] copy dependent ezs
>> touch eldap-wrapper/build/dep-ezs/.done
>>
>  
> And it hangs here forever...
> I have had absolutely no problem installing and running v2.8.4, but I 
> can't compile the new version. 
> Has there been some changes that could explain that ?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/83c1bf38/attachment.htm>

From tim at rabbitmq.com  Fri Sep  7 09:31:42 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 07 Sep 2012 09:31:42 +0100
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <CANGgF+-wrjhnsQkN+Ctk91N-e6Z+tK5Pf4di9-JtgMWKDY+SCQ@mail.gmail.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
	<415FE6D8-C51C-481F-9FB1-D9BCBAA36C24@rabbitmq.com>
	<CANGgF+-wrjhnsQkN+Ctk91N-e6Z+tK5Pf4di9-JtgMWKDY+SCQ@mail.gmail.com>
Message-ID: <5049B0EE.8040202@rabbitmq.com>

Sajith

On 09/07/2012 08:11 AM, Sajith Kariyawasam wrote:
> Thanks for the clue,
>
> I tried using it with following code,
>
>   die_on_error(sockfd = amqp_open_socket(hostname, port), "Opening 
> socket");
>   conn = amqp_new_connection();
>   amqp_set_sockfd(conn, sockfd);
>   die_on_amqp_error(amqp_login(conn, "/", 0, 131072, 0, 
> AMQP_SASL_METHOD_PLAIN, "guest", "guest"),"Logging in");
>   if (!amqp_channel_open(conn, 1))
>                 die_on_amqp_error(amqp_get_rpc_reply(conn), "opening 
> channel");
>   reply =  amqp_basic_get(conn,1,amqp_cstring_bytes(queuename),1);
>

I don't actually know this library at all (apart from glancing at it a 
couple of times) but this generally looks fine. From the examples I note 
that most invocations of 
'die_on_amqp_error(amqp_get_rpc_reply(conn)....' occur regardless of the 
return value of amqp_channel_open, but apart from that you appear to be 
following the same sequence as the examples/tools do.

From tim at rabbitmq.com  Fri Sep  7 09:33:26 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 07 Sep 2012 09:33:26 +0100
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <CALPqkiqmz+SRbVP9cku596xKqAL94V4iPDEF5SFBW2+ZRW23cQ@mail.gmail.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
	<CALPqkiqmz+SRbVP9cku596xKqAL94V4iPDEF5SFBW2+ZRW23cQ@mail.gmail.com>
Message-ID: <5049B156.4020106@rabbitmq.com>

On 09/07/2012 08:23 AM, Brett Cameron wrote:
> Sajith,
>
> Could you just use something like 
> http://manpages.ubuntu.com/manpages/natty/man1/amqp-consume.1.html?
>

That sets up a consumer rather than doing a one-off basic.get - however 
http://manpages.ubuntu.com/manpages/natty/man1/amqp-get.1.html appears 
to do exactly what the OP wants. Both of these programs appear to come 
from the ./tools subdirectory of rabbitmq-c anyway.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/f4fff4f7/attachment.htm>

From sajhak at gmail.com  Fri Sep  7 09:56:18 2012
From: sajhak at gmail.com (Sajith Kariyawasam)
Date: Fri, 7 Sep 2012 14:26:18 +0530
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <5049B156.4020106@rabbitmq.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
	<CALPqkiqmz+SRbVP9cku596xKqAL94V4iPDEF5SFBW2+ZRW23cQ@mail.gmail.com>
	<5049B156.4020106@rabbitmq.com>
Message-ID: <CANGgF+9iH7O8Y5f54Qt38jJQ4xPO4A7T3TZ4j5XaE2d-cALRow@mail.gmail.com>

On Fri, Sep 7, 2012 at 2:03 PM, Tim Watson <tim at rabbitmq.com> wrote:

>  On 09/07/2012 08:23 AM, Brett Cameron wrote:
>
> Sajith,
>
> Could you just use something like
> http://manpages.ubuntu.com/manpages/natty/man1/amqp-consume.1.html?
>
>
> That sets up a consumer rather than doing a one-off basic.get - however
> http://manpages.ubuntu.com/manpages/natty/man1/amqp-get.1.html appears to
> do exactly what the OP wants. Both of these programs appear to come from
> the ./tools subdirectory of rabbitmq-c anyway.
>
>
I installed amqp-tools in Ubuntu 12, and issued the following command,

$ amqp-get --server=10.10.1.2 --vhost=test --username=guest
--password=guest --queue=myqueue,

Then i get following exception ,,

 "basic.get: connection closed unexpectedly"



> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Best Regards
Sajith
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/fe610e19/attachment.htm>

From sajhak at gmail.com  Fri Sep  7 09:59:06 2012
From: sajhak at gmail.com (Sajith Kariyawasam)
Date: Fri, 7 Sep 2012 14:29:06 +0530
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <CANGgF+9iH7O8Y5f54Qt38jJQ4xPO4A7T3TZ4j5XaE2d-cALRow@mail.gmail.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
	<CALPqkiqmz+SRbVP9cku596xKqAL94V4iPDEF5SFBW2+ZRW23cQ@mail.gmail.com>
	<5049B156.4020106@rabbitmq.com>
	<CANGgF+9iH7O8Y5f54Qt38jJQ4xPO4A7T3TZ4j5XaE2d-cALRow@mail.gmail.com>
Message-ID: <CANGgF+8JA9hAChbpBbj4iX=UX_w6-fQCk2dAy8LgwabEkBm=UQ@mail.gmail.com>

Btw, my message broker is Apache Qpid, java broker

On Fri, Sep 7, 2012 at 2:26 PM, Sajith Kariyawasam <sajhak at gmail.com> wrote:

> On Fri, Sep 7, 2012 at 2:03 PM, Tim Watson <tim at rabbitmq.com> wrote:
>
>>  On 09/07/2012 08:23 AM, Brett Cameron wrote:
>>
>> Sajith,
>>
>> Could you just use something like
>> http://manpages.ubuntu.com/manpages/natty/man1/amqp-consume.1.html?
>>
>>
>> That sets up a consumer rather than doing a one-off basic.get - however
>> http://manpages.ubuntu.com/manpages/natty/man1/amqp-get.1.html appears
>> to do exactly what the OP wants. Both of these programs appear to come from
>> the ./tools subdirectory of rabbitmq-c anyway.
>>
>>
> I installed amqp-tools in Ubuntu 12, and issued the following command,
>
> $ amqp-get --server=10.10.1.2 --vhost=test --username=guest
> --password=guest --queue=myqueue,
>
> Then i get following exception ,,
>
>  "basic.get: connection closed unexpectedly"
>
>
>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Best Regards
> Sajith
>
>


-- 
Best Regards
Sajith
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/1620bbc7/attachment.htm>

From simon at rabbitmq.com  Fri Sep  7 10:02:23 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Sep 2012 10:02:23 +0100
Subject: [rabbitmq-discuss] Rabbitmq v2.8.6 installation - Command make
 hangs forever
In-Reply-To: <8a8002fb-a7d6-4043-b003-701e87e458a6@googlegroups.com>
References: <48bfdcbd-707c-490c-aea9-83e4f8f840da@googlegroups.com>
	<8a8002fb-a7d6-4043-b003-701e87e458a6@googlegroups.com>
Message-ID: <5049B81F.2060305@rabbitmq.com>

We've accidentally added a requirement for git to build from source. 
We'll be fixing this in a future release, but for the time being you'll 
need to install git to build. Or you can use the ready made binary 
tarball[1], unless you are patching?

Cheers, Simon

[1] 
http://www.rabbitmq.com/releases/rabbitmq-server/v2.8.6/rabbitmq-server-generic-unix-2.8.6.tar.gz


On 07/09/12 08:32, misterdev wrote:
> Any idea anyone ?
>
> Thanks in advance.
>
> Le jeudi 30 ao?t 2012 10:57:21 UTC+2, misterdev a ?crit :
>
>     Hello all
>     I have a problem when I want to install RAbbitMQ v2.8.5 and v2.8.6
>     1 - the command *make* give me errors :
>
>         git: Command not found
>
>     --> It'snormal because git is not installed on my server. Is that a
>     problem for the installation ?
>
>     2 - a few seconds after giving me the git errors, *make *hangs after
>     these lines :
>
>         rm -rf eldap-wrapper/build/dep-ezs
>         mkdir -p eldap-wrapper/build/dep-ezs
>         [elided] copy dependent ezs
>         touch eldap-wrapper/build/dep-ezs/.done
>
>     And it hangs here forever...
>     I have had absolutely no problem installing and running v2.8.4, but
>     I can't compile the new version.
>     Has there been some changes that could explain that ?
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Fri Sep  7 10:03:17 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 7 Sep 2012 10:03:17 +0100
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <CANGgF+8JA9hAChbpBbj4iX=UX_w6-fQCk2dAy8LgwabEkBm=UQ@mail.gmail.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
	<CALPqkiqmz+SRbVP9cku596xKqAL94V4iPDEF5SFBW2+ZRW23cQ@mail.gmail.com>
	<5049B156.4020106@rabbitmq.com>
	<CANGgF+9iH7O8Y5f54Qt38jJQ4xPO4A7T3TZ4j5XaE2d-cALRow@mail.gmail.com>
	<CANGgF+8JA9hAChbpBbj4iX=UX_w6-fQCk2dAy8LgwabEkBm=UQ@mail.gmail.com>
Message-ID: <D44753C5-6A41-4EF0-B248-01D30082DEE3@rabbitmq.com>

On 7 Sep 2012, at 09:59, Sajith Kariyawasam wrote:

> Btw, my message broker is Apache Qpid, java broker
> 

Well I have no idea if rabbitmq-c will work with Qpid or not, although *in theory* I guess it should be compatible with any AMQP-0.9.1 compliant broker. You should contact the library author/maintainer, as this library is not actually part of RabbitMQ.

Cheers,
Tim


From sbjung at t-online.de  Thu Sep  6 20:48:48 2012
From: sbjung at t-online.de (sbjung at t-online.de)
Date: Thu, 06 Sep 2012 21:48:48 +0200
Subject: [rabbitmq-discuss] RABBITMQ C/C++ client
Message-ID: <1T9i4G-0YXpwG0@fwd11.aul.t-online.de>

i am looking for a rabbitmq c/c++ client with SSL support.

can anyone help?

regards
roland




From pjsanders at gmail.com  Thu Sep  6 22:16:16 2012
From: pjsanders at gmail.com (Phil S)
Date: Thu, 6 Sep 2012 14:16:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Windows clean reinstall
Message-ID: <b3c88a47-4ba9-4a21-aebb-87bb9ffeb779@googlegroups.com>

I am attempting a clean reinstall of rabbitmq in my test environment: 
windows 2008, rabbitmq installed as a service. Uninstall and install both 
succeed but on starting back up my old users, plugins and queues are still 
active. I suppose there is a proper way to do a clean reinstall but I can't 
find it documented. Any ideas?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/f38eb357/attachment.htm>

From bytor99999 at gmail.com  Fri Sep  7 00:55:45 2012
From: bytor99999 at gmail.com (bytor99999)
Date: Thu, 6 Sep 2012 16:55:45 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't install any plugins. Installed on Mac Snow
 Leopard via MacPorts.
Message-ID: <e33fbdcc-2373-4a4b-90f6-479d58821a63@googlegroups.com>

So I installed RabbitMQ via Macports and it installed perfectly, the server 
runs. However, when I try to enable plugins like the management plugin, the 
command in the documentation doesn't work. There is no..

rabbitmq-plugins enable rabbitmq_management


command for me to run. These are the results.

new-host-4:/ bytor99999$ rabbitmq-plugins enable rabbitmq_management
-bash: rabbitmq-plugins: command not found

I also have issues finding where it was actually installed. Couldn't find 
any config files. I did find the log files.

Thanks

Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120906/76b204cb/attachment.htm>

From sajhak at gmail.com  Fri Sep  7 10:06:36 2012
From: sajhak at gmail.com (Sajith Kariyawasam)
Date: Fri, 7 Sep 2012 14:36:36 +0530
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <D44753C5-6A41-4EF0-B248-01D30082DEE3@rabbitmq.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
	<CALPqkiqmz+SRbVP9cku596xKqAL94V4iPDEF5SFBW2+ZRW23cQ@mail.gmail.com>
	<5049B156.4020106@rabbitmq.com>
	<CANGgF+9iH7O8Y5f54Qt38jJQ4xPO4A7T3TZ4j5XaE2d-cALRow@mail.gmail.com>
	<CANGgF+8JA9hAChbpBbj4iX=UX_w6-fQCk2dAy8LgwabEkBm=UQ@mail.gmail.com>
	<D44753C5-6A41-4EF0-B248-01D30082DEE3@rabbitmq.com>
Message-ID: <CANGgF+9DrJEBiBHLb8qrdsW658-pTSF6qTZHNbnrp7naRFdTNg@mail.gmail.com>

On Fri, Sep 7, 2012 at 2:33 PM, Tim Watson <tim at rabbitmq.com> wrote:

> On 7 Sep 2012, at 09:59, Sajith Kariyawasam wrote:
>
> > Btw, my message broker is Apache Qpid, java broker
> >
>
> Well I have no idea if rabbitmq-c will work with Qpid or not, although *in
> theory* I guess it should be compatible with any AMQP-0.9.1 compliant
> broker. You should contact the library author/maintainer, as this library
> is not actually part of RabbitMQ.
>

Thanks TIm, will contact them


>
> Cheers,
> Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Best Regards
Sajith
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/0f3c0c76/attachment.htm>

From tim at rabbitmq.com  Fri Sep  7 10:09:37 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 7 Sep 2012 10:09:37 +0100
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <CANGgF+9DrJEBiBHLb8qrdsW658-pTSF6qTZHNbnrp7naRFdTNg@mail.gmail.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
	<CALPqkiqmz+SRbVP9cku596xKqAL94V4iPDEF5SFBW2+ZRW23cQ@mail.gmail.com>
	<5049B156.4020106@rabbitmq.com>
	<CANGgF+9iH7O8Y5f54Qt38jJQ4xPO4A7T3TZ4j5XaE2d-cALRow@mail.gmail.com>
	<CANGgF+8JA9hAChbpBbj4iX=UX_w6-fQCk2dAy8LgwabEkBm=UQ@mail.gmail.com>
	<D44753C5-6A41-4EF0-B248-01D30082DEE3@rabbitmq.com>
	<CANGgF+9DrJEBiBHLb8qrdsW658-pTSF6qTZHNbnrp7naRFdTNg@mail.gmail.com>
Message-ID: <AB0F5408-DEF6-4D88-9849-AC225A5F1520@rabbitmq.com>


On 7 Sep 2012, at 10:06, Sajith Kariyawasam wrote:
> 
> Well I have no idea if rabbitmq-c will work with Qpid or not, although *in theory* I guess it should be compatible with any AMQP-0.9.1 compliant broker. You should contact the library author/maintainer, as this library is not actually part of RabbitMQ.
> 
> Thanks TIm, will contact them
>  

In fact, afaik QPid no longer supports AMQP-0.9.1, so I think you'll have to look for another client that supports whatever version of the protocol QPid is supporting now. Good luck.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/2f980a7b/attachment.htm>

From francesco at rabbitmq.com  Fri Sep  7 10:14:28 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 07 Sep 2012 10:14:28 +0100
Subject: [rabbitmq-discuss] RABBITMQ C/C++ client
In-Reply-To: <1T9i4G-0YXpwG0@fwd11.aul.t-online.de>
References: <1T9i4G-0YXpwG0@fwd11.aul.t-online.de>
Message-ID: <87txvagpor.wl%francesco@rabbitmq.com>

At Thu, 06 Sep 2012 21:48:48 +0200,
sbjung at t-online.de wrote:
> i am looking for a rabbitmq c/c++ client with SSL support.
> 
> can anyone help?

Sadly I can't find anything like that on <https://rabbitmq.com/devtools.html>,
which indicates that we're not aware of one.

rabbitmq-c will probably support that at some point, you can follow the
development at <https://github.com/alanxz/rabbitmq-c/issues/14>.

--
Francesco * Often in error, never in doubt

From ekirpichov at gmail.com  Thu Sep  6 20:47:25 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 6 Sep 2012 12:47:25 -0700
Subject: [rabbitmq-discuss] Change node cookie without wiping RabbitMQ
	database
Message-ID: <CANVKUrViQMC09WXB1n4O8H7DdNP2pt9irh5VyjOz0yiPwiJXiA@mail.gmail.com>

Consider the following scenario:

* I have a running RabbitMQ, with erlang cookie XXX
* I want to change the cookie to YYY and restart RabbitMQ

However, when I actually change the cookie, RabbitMQ hangs during the
"Starting database" phase. My understanding is that this is due to
Mnesia table cookie mismatch.

What can be done about this? Is there a well-defined
backup/wipe/restore process for this case?

-- 
Eugene Kirpichov
http://www.linkedin.com/in/eugenekirpichov

From emile at rabbitmq.com  Fri Sep  7 10:34:21 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Sep 2012 10:34:21 +0100
Subject: [rabbitmq-discuss] Windows clean reinstall
In-Reply-To: <b3c88a47-4ba9-4a21-aebb-87bb9ffeb779@googlegroups.com>
References: <b3c88a47-4ba9-4a21-aebb-87bb9ffeb779@googlegroups.com>
Message-ID: <5049BF9D.3020908@rabbitmq.com>

Hi Phil,

On 06/09/12 22:16, Phil S wrote:
> I am attempting a clean reinstall of rabbitmq in my test environment:

If you remove %RABBITMQ_BASE% (typically set to %APPDATA%\RabbitMQ)
while the broker is not running then it will create a fresh database at
startup. It is not necessary to reinstall.



-Emile


From emile at rabbitmq.com  Fri Sep  7 10:38:02 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Sep 2012 10:38:02 +0100
Subject: [rabbitmq-discuss] Change node cookie without wiping RabbitMQ
 database
In-Reply-To: <CANVKUrViQMC09WXB1n4O8H7DdNP2pt9irh5VyjOz0yiPwiJXiA@mail.gmail.com>
References: <CANVKUrViQMC09WXB1n4O8H7DdNP2pt9irh5VyjOz0yiPwiJXiA@mail.gmail.com>
Message-ID: <5049C07A.9050704@rabbitmq.com>

Hi Eugene,

On 06/09/12 20:47, Eugene Kirpichov wrote:
> However, when I actually change the cookie, RabbitMQ hangs during the
> "Starting database" phase. My understanding is that this is due to
> Mnesia table cookie mismatch.

I assume the broker that fails to start is a member of a cluster. The
solution is to update the secure cookie of all the nodes in the cluster
and so allow them to communicate.


-Emile


From brett.r.cameron at gmail.com  Fri Sep  7 10:36:27 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 7 Sep 2012 21:36:27 +1200
Subject: [rabbitmq-discuss] RABBITMQ C/C++ client
In-Reply-To: <87txvagpor.wl%francesco@rabbitmq.com>
References: <1T9i4G-0YXpwG0@fwd11.aul.t-online.de>
	<87txvagpor.wl%francesco@rabbitmq.com>
Message-ID: <CALPqkipjG3skA8xb_Tj3OgKsrg8rr+v4-=Cv1Kz1tGpz5o1bYA@mail.gmail.com>

What's currently there in rabbitmq-c is a bit crude but will work (
https://github.com/alanxz/rabbitmq-c/issues/14;
https://github.com/alanxz/rabbitmq-c/tree/ssl), but do heed Alan's
comments! Unfortunately I've not had time to tidy it up further...

Brett


On Fri, Sep 7, 2012 at 9:14 PM, Francesco Mazzoli <francesco at rabbitmq.com>wrote:

> At Thu, 06 Sep 2012 21:48:48 +0200,
> sbjung at t-online.de wrote:
> > i am looking for a rabbitmq c/c++ client with SSL support.
> >
> > can anyone help?
>
> Sadly I can't find anything like that on <
> https://rabbitmq.com/devtools.html>,
> which indicates that we're not aware of one.
>
> rabbitmq-c will probably support that at some point, you can follow the
> development at <https://github.com/alanxz/rabbitmq-c/issues/14>.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/6ff1d2f8/attachment.htm>

From emile at rabbitmq.com  Fri Sep  7 10:43:49 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Sep 2012 10:43:49 +0100
Subject: [rabbitmq-discuss] Can't install any plugins. Installed on Mac
 Snow Leopard via MacPorts.
In-Reply-To: <e33fbdcc-2373-4a4b-90f6-479d58821a63@googlegroups.com>
References: <e33fbdcc-2373-4a4b-90f6-479d58821a63@googlegroups.com>
Message-ID: <5049C1D5.1000804@rabbitmq.com>

Hi,

On 07/09/12 00:55, bytor99999 wrote:
> new-host-4:/ bytor99999$ rabbitmq-plugins enable rabbitmq_management
> -bash: rabbitmq-plugins: command not found

On my installation the command is located in /opt/local/sbin. Is this
directory on your $PATH?


-Emile


From fredrik.stark at mazemedia.se  Fri Sep  7 10:27:22 2012
From: fredrik.stark at mazemedia.se (Fredrik Stark)
Date: Fri, 7 Sep 2012 11:27:22 +0200
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading Ubuntu
	10.04 to 12.04
Message-ID: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>

Hello,

After doing an do-release-upgrade on our 10.04 dev machine rabbitmq-server (2.8.6-1) has stopped working.
We've tried purging rabbitmq-server and all dependencies from the system, but the problem persists.
I've also tried with the 2.8.4 .deb-package available on rabbitmq.com with the same problems.

No other MQ is running, port 5672 is free and available.

The hostname resolves to 127.0.0.1:
# hostname
newborg
# ping newborg
PING localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_req=1 ttl=64 time=0.038 ms


Here's some output:

apt-get install fails when starting rabbitmq-server, and startup_-logs:
http://dpaste.com/797684/

Trying to start rabbitmq-server with `/usr/lib/rabbitmq/bin/rabbitmq-server `
http://dpaste.com/797706/

Does anyone know what might be wrong?



From tim at rabbitmq.com  Fri Sep  7 10:44:36 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 7 Sep 2012 10:44:36 +0100
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading Ubuntu
	10.04 to 12.04
In-Reply-To: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
Message-ID: <9685628E-7C33-4472-B8B5-D121CD46FAD3@rabbitmq.com>

On 7 Sep 2012, at 10:27, Fredrik Stark wrote:

> Hello,
> 

Hi

> No other MQ is running, port 5672 is free and available.
> 
> The hostname resolves to 127.0.0.1:
> # hostname
> newborg
> # ping newborg
> PING localhost (127.0.0.1) 56(84) bytes of data.
> 64 bytes from localhost (127.0.0.1): icmp_req=1 ttl=64 time=0.038 ms
> 
> 
> Here's some output:
> 
> apt-get install fails when starting rabbitmq-server, and startup_-logs:
> http://dpaste.com/797684/
> 
> Trying to start rabbitmq-server with `/usr/lib/rabbitmq/bin/rabbitmq-server `
> http://dpaste.com/797706/
> 
> Does anyone know what might be wrong?
> 

What does running `epmd -names` show?

From tim at rabbitmq.com  Fri Sep  7 10:46:33 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 7 Sep 2012 10:46:33 +0100
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading Ubuntu
	10.04 to 12.04
In-Reply-To: <9685628E-7C33-4472-B8B5-D121CD46FAD3@rabbitmq.com>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<9685628E-7C33-4472-B8B5-D121CD46FAD3@rabbitmq.com>
Message-ID: <73EDD258-46E7-4792-8C48-0E459F76D6A8@rabbitmq.com>

On 7 Sep 2012, at 10:44, Tim Watson wrote:
>> 
>> 
>> Does anyone know what might be wrong?
>> 
> 
> What does running `epmd -names` show?

Hit 'send' too quickly. Also, can you run `erl -sname foobar` successfully?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/975fdeaa/attachment.htm>

From emile at rabbitmq.com  Fri Sep  7 10:54:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Sep 2012 10:54:57 +0100
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading Ubuntu
 10.04 to 12.04
In-Reply-To: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
Message-ID: <5049C471.9070305@rabbitmq.com>

Hi,

On 07/09/12 10:27, Fredrik Stark wrote:
> Does anyone know what might be wrong?

I suspect there is something wrong with your Erlang installation. Did
you upgrade Erlang as well? Does this command produce an error?
  erl -sname test

Try to kill the epmd daemon and try again.


-Emile


From tim at rabbitmq.com  Fri Sep  7 10:49:12 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 7 Sep 2012 10:49:12 +0100
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading Ubuntu
	10.04 to 12.04
In-Reply-To: <73EDD258-46E7-4792-8C48-0E459F76D6A8@rabbitmq.com>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<9685628E-7C33-4472-B8B5-D121CD46FAD3@rabbitmq.com>
	<73EDD258-46E7-4792-8C48-0E459F76D6A8@rabbitmq.com>
Message-ID: <87B612C1-37C9-4E5E-9470-A546735DA59D@rabbitmq.com>

On 7 Sep 2012, at 10:46, Tim Watson wrote:

> On 7 Sep 2012, at 10:44, Tim Watson wrote:
>>> 
>>> Does anyone know what might be wrong?
>>> 
>> 
>> What does running `epmd -names` show?
> 
> Hit 'send' too quickly. Also, can you run `erl -sname foobar` successfully?
> 

Also, can you post the startup and main logs please. Sorry for posting this in tiny chunks! :)

From fredrik.stark at mazemedia.se  Fri Sep  7 11:48:36 2012
From: fredrik.stark at mazemedia.se (Fredrik Stark)
Date: Fri, 7 Sep 2012 12:48:36 +0200
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading Ubuntu
	10.04 to 12.04
In-Reply-To: <5049C471.9070305@rabbitmq.com>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<5049C471.9070305@rabbitmq.com>
Message-ID: <AF66F5D5-EEE5-4C79-B8D7-A7E0238B8ECD@mazemedia.se>

Hello,

erts 5.7.4 was running on the old 10.04
After the upgrade erts has the version number 5.8.5

Here's the output of `erl -sname test`
http://dpaste.com/797732/



On Sep 7, 2012, at 11:54 AM, Emile Joubert wrote:

> Hi,
> 
> On 07/09/12 10:27, Fredrik Stark wrote:
>> Does anyone know what might be wrong?
> 
> I suspect there is something wrong with your Erlang installation. Did
> you upgrade Erlang as well? Does this command produce an error?
>  erl -sname test
> 
> Try to kill the epmd daemon and try again.
> 
> 
> -Emile
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/f4ea124b/attachment.htm>

From fredrik.stark at mazemedia.se  Fri Sep  7 12:03:20 2012
From: fredrik.stark at mazemedia.se (Fredrik Stark)
Date: Fri, 7 Sep 2012 11:03:20 +0000 (UTC)
Subject: [rabbitmq-discuss]
	=?utf-8?q?rabbitmq_won=27t_start_after_upgradi?=
	=?utf-8?q?ng_Ubuntu=0910=2E04_to_12=2E04?=
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<9685628E-7C33-4472-B8B5-D121CD46FAD3@rabbitmq.com>
	<73EDD258-46E7-4792-8C48-0E459F76D6A8@rabbitmq.com>
	<87B612C1-37C9-4E5E-9470-A546735DA59D@rabbitmq.com>
Message-ID: <loom.20120907T125644-905@post.gmane.org>

Hello!

> Also, can you post the startup and main logs please. 
> Sorry for posting this in tiny chunks! :)

The startup and main logs are available here: 
http://dpaste.com/797684/ 


> >> What does running `epmd -names` show?
http://dpaste.com/797737/

> > Hit 'send' too quickly. 
> > Also, can you run `erl -sname foobar` successfully?
http://dpaste.com/797739/


From fredrik.stark at mazemedia.se  Fri Sep  7 12:17:20 2012
From: fredrik.stark at mazemedia.se (Fredrik Stark)
Date: Fri, 7 Sep 2012 13:17:20 +0200
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading
	Ubuntu	10.04 to 12.04
In-Reply-To: <loom.20120907T125644-905@post.gmane.org>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<9685628E-7C33-4472-B8B5-D121CD46FAD3@rabbitmq.com>
	<73EDD258-46E7-4792-8C48-0E459F76D6A8@rabbitmq.com>
	<87B612C1-37C9-4E5E-9470-A546735DA59D@rabbitmq.com>
	<loom.20120907T125644-905@post.gmane.org>
Message-ID: <C740F225-B2E4-4CCD-81DC-DD141F0E2FD6@mazemedia.se>

> The startup and main logs are available here: 
> http://dpaste.com/797684/ 

I just realized that i only posted the startup_* logs, but there are no other log files there.



From emile at rabbitmq.com  Fri Sep  7 13:15:22 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Sep 2012 13:15:22 +0100
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading Ubuntu
 10.04 to 12.04
In-Reply-To: <AF66F5D5-EEE5-4C79-B8D7-A7E0238B8ECD@mazemedia.se>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<5049C471.9070305@rabbitmq.com>
	<AF66F5D5-EEE5-4C79-B8D7-A7E0238B8ECD@mazemedia.se>
Message-ID: <5049E55A.3000205@rabbitmq.com>

Hi Frederik,

On 07/09/12 11:48, Fredrik Stark wrote:
> erts 5.7.4 was running on the old 10.04
> After the upgrade erts has the version number 5.8.5

There were changes in R14B relating to epmd name registration messages
from localhost which may be relevant to this error.

> Here's the output of `erl -sname test`
> http://dpaste.com/797732/

Can you try the same test, but with epmd debug output?

    $ epmd -kill
    $ epmd -d

Then in a different shell:

    $ erl -sname test

I would expect debug output similar to this in the first shell on a
working setup:

    epmd running - daemon = 0
    ** got ALIVE2_REQ
    registering 'test:3', port 49101
    type 77 proto 0 highvsn 5 lowvsn 5
    ** sent ALIVE2_RESP for "test"

If this doesn't work then you will have difficulties with any
distributed Erlang software, not only RabbitMQ.

The problem you describe may be caused by FreeBSD jails, which treats
localhost specially. Is that what you are using? If so then I'm not sure
there is a good solution other than reverting to R13B03 (or any version
of Erlang prior to R14B). There may also be patches to Erlang that work
around the problem, but a FreeBSD mailing list would be the right place
to ask.


-Emile



From fredrik.stark at mazemedia.se  Fri Sep  7 13:46:38 2012
From: fredrik.stark at mazemedia.se (Fredrik Stark)
Date: Fri, 7 Sep 2012 14:46:38 +0200
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading Ubuntu
	10.04 to 12.04
In-Reply-To: <5049E55A.3000205@rabbitmq.com>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<5049C471.9070305@rabbitmq.com>
	<AF66F5D5-EEE5-4C79-B8D7-A7E0238B8ECD@mazemedia.se>
	<5049E55A.3000205@rabbitmq.com>
Message-ID: <6213E5DF-460D-452E-AEA4-8B0920799739@mazemedia.se>

> Can you try the same test, but with epmd debug output?
> 
>    $ epmd -kill
>    $ epmd -d
> 
> Then in a different shell:
> 
>    $ erl -sname test
> 
> I would expect debug output similar to this in the first shell on a
> working setup:
> 
>    epmd running - daemon = 0
>    ** got ALIVE2_REQ
>    registering 'test:3', port 49101
>    type 77 proto 0 highvsn 5 lowvsn 5
>    ** sent ALIVE2_RESP for "test"

This is what I got:

$ epmd -d
epmd: Fri Sep  7 14:39:27 2012: epmd running - daemon = 0
epmd: Fri Sep  7 14:39:36 2012: ** got ALIVE2_REQ
epmd: Fri Sep  7 14:39:36 2012: ALIVE2_REQ from non local address

> The problem you describe may be caused by FreeBSD jails, which treats
> localhost specially. Is that what you are using?

Nope, no jails installed...



From miglianti.marco at gmail.com  Fri Sep  7 13:57:55 2012
From: miglianti.marco at gmail.com (Marco Miglianti)
Date: Fri, 7 Sep 2012 14:57:55 +0200
Subject: [rabbitmq-discuss] Bologna (Italy) & RabbitMQ
Message-ID: <CAMO0AR=dyA4MunV-pczmRERga1Shv5058tH=EDw4DJy-paPpaA@mail.gmail.com>

Anyone in the Bologna (Italy) area interested in grabbing some beers and
talking about RabbitMQ?  I'd be happy to take the mantle of setting it up.

(Copyright Jason J. W. Williams <jasonjwwilliams at gmail.com> 2012)


Marco Miglianti
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/65f1fb9d/attachment.htm>

From virolord at gmail.com  Fri Sep  7 14:09:41 2012
From: virolord at gmail.com (Abhinav Jha)
Date: Fri, 7 Sep 2012 18:39:41 +0530
Subject: [rabbitmq-discuss] Bologna (Italy) & RabbitMQ
In-Reply-To: <CAMO0AR=dyA4MunV-pczmRERga1Shv5058tH=EDw4DJy-paPpaA@mail.gmail.com>
References: <CAMO0AR=dyA4MunV-pczmRERga1Shv5058tH=EDw4DJy-paPpaA@mail.gmail.com>
Message-ID: <CAL5u-71ooXmxkWeAwFx5+qq5t8p448oCKNt6cZ93_RedV5XWcA@mail.gmail.com>

Sorry for the spam but this was hilarious to me for some reason
"grabbing some beers and talking about RabbitMQ" ftw


On Fri, Sep 7, 2012 at 6:27 PM, Marco Miglianti
<miglianti.marco at gmail.com>wrote:

> Anyone in the Bologna (Italy) area interested in grabbing some beers and
> talking about RabbitMQ?  I'd be happy to take the mantle of setting it up.
>
> (Copyright Jason J. W. Williams <jasonjwwilliams at gmail.com> 2012)
>
>
> Marco Miglianti
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/808567c1/attachment.htm>

From emile at rabbitmq.com  Fri Sep  7 14:30:10 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Sep 2012 14:30:10 +0100
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading Ubuntu
 10.04 to 12.04
In-Reply-To: <6213E5DF-460D-452E-AEA4-8B0920799739@mazemedia.se>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<5049C471.9070305@rabbitmq.com>
	<AF66F5D5-EEE5-4C79-B8D7-A7E0238B8ECD@mazemedia.se>
	<5049E55A.3000205@rabbitmq.com>
	<6213E5DF-460D-452E-AEA4-8B0920799739@mazemedia.se>
Message-ID: <5049F6E2.7000803@rabbitmq.com>

Hi Fredrik,

On 07/09/12 13:46, Fredrik Stark wrote:
> epmd: Fri Sep  7 14:39:36 2012: ALIVE2_REQ from non local address

For some reason queries to epmd are made from an address that is not
recognised as local by epmd. This could be caused by kernel routing or
firewall setup, it might be a IPv6 issue, or some other network
peculiarity. You could either try to solve that, so that debug output
from epmd looks like the sample I sent, or you could patch epmd to drop
the local address constraint, by unconditionally setting
  s->local_peer = EPMD_TRUE;
in conn_open() in erts/epmd/src/epmd_srv.c in the Erlang sources.

You might also want to ask over at the erlang-questions mailing list, as
this is not a RabbitMQ-specific issue.


-Emile





From regal at nine.ch  Fri Sep  7 14:49:45 2012
From: regal at nine.ch (Rene Gallati)
Date: Fri, 7 Sep 2012 06:49:45 -0700 (PDT)
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
 Ubuntu (potential all Debian-likes)
Message-ID: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>

Hello list,

as a service provider I was tasked to install RabbitMQ for a customer 
system. No problem, it's in Ubuntu's default repository, right?

Too bad it's broken and the installation via package manager fails. And 
while that may be a Ubuntu maintainer's problem the very same thing happens 
if one uses the official apt-repository provided at 
http://www.rabbitmq.com/install-debian.html

What breaks? Well the package installs correctly but then tries to start 
the rabbitmq-server service. And this doesn't work, the service is not 
startable because it has a very odd requirement: rabbitmq-server cannot be 
started on current Ubuntu 12.04 LTS systems because it claims that the 
"hostname is unresolvable". This is however a wrong error message, because 
the hostname can be perfectly resolvable when rabbitmq-server claims this. 
What is really happening is, that rabbitmq-server absolutely requires that 
the hostname-part be defined as entry in /etc/hosts as name for 127.0.0.1 !

So if your system is named "foo" you have to have
127.0.0.1 localhost foo

in your /etc/hosts and then it will magically be "resolvable" and starts. 
Unfortunately, the default for all modern unix systems is that the hostname 
is assigned to the real IP address and not to 127.0.0.1 and this is why the 
standard installation package is broken by default.

As an alternative, you can also add "NODENAME=rabbit at localhost" to 
rabbitmq-server's configuration file because - look it's magic: localhost 
does actually resolve to 127.0.0.1 which is what rabbitmq-server seems to 
require to function. The problem with that approach is of course that the 
configuration file does not exist prior to attempting to install the 
package via package-manager on your system, so you have to install the 
faulty installation, then add the line in the configuration file, then fix 
the package-installation by rerunning in order to get to a clean state.

Since I have no experience with RabbitMQ itself, I have no idea why this is 
so or what exactly is wrong on my (100% clean and default) system 
configuration for this to appear. If RabbitMQ really really requires the 
hostname to be mapped to 127.0.0.1 by default then this is the first 
networking program with this requirement I've encountered in over 15 years 
of administrating linux systems. I think it's a bug and this is why I 
document this here so that it can be fixed.

Kind regards

Ren?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/14a68169/attachment.htm>

From tim at rabbitmq.com  Fri Sep  7 15:41:38 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 07 Sep 2012 15:41:38 +0100
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
 Ubuntu (potential all Debian-likes)
In-Reply-To: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
Message-ID: <504A07A2.1060807@rabbitmq.com>

On 09/07/2012 02:49 PM, Rene Gallati wrote:
> Since I have no experience with RabbitMQ itself, I have no idea why 
> this is so or what exactly is wrong on my (100% clean and default) 
> system configuration for this to appear. If RabbitMQ really really 
> requires the hostname to be mapped to 127.0.0.1 by default then this 
> is the first networking program with this requirement I've encountered 
> in over 15 years of administrating linux systems. I think it's a bug 
> and this is why I document this here so that it can be fixed.
>
Hi Rene,

This requirement actually comes from Erlang, upon which RabbitMQ is 
based. I have found the hostname resolution behaviour equally 
frustrating on CentOS and FreeBSD. Perhaps you would be willing to post 
this message to the erlang-questions mailing list as well? That might 
even spark a debate about how to improve the way Erlang handles this in 
future. I'm not sure what other steps we could/should take to handle 
this situation though.

/Tim

From simon at rabbitmq.com  Fri Sep  7 16:14:46 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Sep 2012 16:14:46 +0100
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
 Ubuntu (potential all Debian-likes)
In-Reply-To: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
Message-ID: <504A0F66.2040500@rabbitmq.com>

On 07/09/12 14:49, Rene Gallati wrote:
<snip>
> What is really happening is, that rabbitmq-server
> absolutely requires that the hostname-part be defined as entry in
> /etc/hosts as name for 127.0.0.1 !
<snip>

This is not true.

It *does* require that the hostname resolve, i.e. that "ping `hostname`" 
works and maps to *an* IP address of the machine. As Tim says, this is 
an Erlang requirement, but I don't think it's too hideous.

And for the record every installation of Ubuntu I've seen (including a 
recent 12.04 LTS install), does add the hostname to /etc/hosts. But this 
is not necessary - on my main development machine the hostname actually 
resolves over DNS, and RabbitMQ starts fine.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Sep  7 16:16:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Sep 2012 16:16:08 +0100
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
 Ubuntu (potential all Debian-likes)
In-Reply-To: <504A07A2.1060807@rabbitmq.com>
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
	<504A07A2.1060807@rabbitmq.com>
Message-ID: <504A0FB8.3080105@rabbitmq.com>

On 07/09/12 15:41, Tim Watson wrote:
> This requirement actually comes from Erlang, upon which RabbitMQ is
> based.

Note that the OP is claiming that the hostname resolve to 127.0.0.1, not 
just that it resolve.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alan.antonuk at gmail.com  Fri Sep  7 16:38:19 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 7 Sep 2012 11:38:19 -0400
Subject: [rabbitmq-discuss] RABBITMQ C/C++ client
In-Reply-To: <CALPqkipjG3skA8xb_Tj3OgKsrg8rr+v4-=Cv1Kz1tGpz5o1bYA@mail.gmail.com>
References: <1T9i4G-0YXpwG0@fwd11.aul.t-online.de>
	<87txvagpor.wl%francesco@rabbitmq.com>
	<CALPqkipjG3skA8xb_Tj3OgKsrg8rr+v4-=Cv1Kz1tGpz5o1bYA@mail.gmail.com>
Message-ID: <CAAt2poK9LyK7gx2GFqBck9Gcj05kTR41sOsh_6Wbx8qZy6SO4Q@mail.gmail.com>

There is a more complete effort that is currently underway to support SSL:
details can be found here: https://github.com/alanxz/rabbitmq-c/pull/17

I cannot comment on the functionality or completeness.

-Alan

On Fri, Sep 7, 2012 at 5:36 AM, Brett Cameron <brett.r.cameron at gmail.com>wrote:

> What's currently there in rabbitmq-c is a bit crude but will work (
> https://github.com/alanxz/rabbitmq-c/issues/14;
> https://github.com/alanxz/rabbitmq-c/tree/ssl), but do heed Alan's
> comments! Unfortunately I've not had time to tidy it up further...
>
> Brett
>
>
>
> On Fri, Sep 7, 2012 at 9:14 PM, Francesco Mazzoli <francesco at rabbitmq.com>wrote:
>
>> At Thu, 06 Sep 2012 21:48:48 +0200,
>> sbjung at t-online.de wrote:
>> > i am looking for a rabbitmq c/c++ client with SSL support.
>> >
>> > can anyone help?
>>
>> Sadly I can't find anything like that on <
>> https://rabbitmq.com/devtools.html>,
>> which indicates that we're not aware of one.
>>
>> rabbitmq-c will probably support that at some point, you can follow the
>> development at <https://github.com/alanxz/rabbitmq-c/issues/14>.
>>
>> --
>> Francesco * Often in error, never in doubt
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/720f44ca/attachment.htm>

From emile at rabbitmq.com  Fri Sep  7 16:50:26 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 07 Sep 2012 16:50:26 +0100
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
 Ubuntu (potential all Debian-likes)
In-Reply-To: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
Message-ID: <504A17C2.3090207@rabbitmq.com>


Hi Ren?,

On 07/09/12 14:49, Rene Gallati wrote:
> as a service provider I was tasked to install RabbitMQ for a customer
> system. No problem, it's in Ubuntu's default repository, right?

While not addressing your question I want to point out that version
2.7.1-0ubuntu4 shipping with 12.04 LTS makes it especially difficult to
diagnose startup errors like the one you encountered and should
therefore be avoided. You will find that the startup error log
(/var/log/rabbitmq/startup_err by default) contains the frustratingly
glib "rabbitmq failed to start" in case any error occurs. If at all
possible use the latest version from the rabbitmq.com website instead.


-Emile


From alan.antonuk at gmail.com  Fri Sep  7 16:48:19 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 7 Sep 2012 11:48:19 -0400
Subject: [rabbitmq-discuss] Simple C Client to read from a Queue
In-Reply-To: <AB0F5408-DEF6-4D88-9849-AC225A5F1520@rabbitmq.com>
References: <CANGgF+9u8L73HCGAjz2dmRSaLcRkE50ZWyRGrHdg09HBN7h1LA@mail.gmail.com>
	<D2B964E5-561D-4E0D-BDC3-6C13C476513F@rabbitmq.com>
	<FB252029-32F9-4AE3-93FD-F89125893CDB@rabbitmq.com>
	<CALPqkiqmz+SRbVP9cku596xKqAL94V4iPDEF5SFBW2+ZRW23cQ@mail.gmail.com>
	<5049B156.4020106@rabbitmq.com>
	<CANGgF+9iH7O8Y5f54Qt38jJQ4xPO4A7T3TZ4j5XaE2d-cALRow@mail.gmail.com>
	<CANGgF+8JA9hAChbpBbj4iX=UX_w6-fQCk2dAy8LgwabEkBm=UQ@mail.gmail.com>
	<D44753C5-6A41-4EF0-B248-01D30082DEE3@rabbitmq.com>
	<CANGgF+9DrJEBiBHLb8qrdsW658-pTSF6qTZHNbnrp7naRFdTNg@mail.gmail.com>
	<AB0F5408-DEF6-4D88-9849-AC225A5F1520@rabbitmq.com>
Message-ID: <CAAt2poL_1LC_=Kri7nZGK+eseAZjKJ_Ud32fj4HLXaH_F8odtw@mail.gmail.com>

Maintainer of rabbitmq-c here.  The library currently only supports AMQP
0.9-1. The library will not work with a broker that does not speak this
protocol (It doesn't work with AMQP 0.8, nor AMQP 1.0).  The library has
not been tested with any brokers other than RabbitMQ, so it may or may not
work with QPid.

-Alan

On Fri, Sep 7, 2012 at 5:09 AM, Tim Watson <tim at rabbitmq.com> wrote:

>
> On 7 Sep 2012, at 10:06, Sajith Kariyawasam wrote:
>
>
>> Well I have no idea if rabbitmq-c will work with Qpid or not, although
>> *in theory* I guess it should be compatible with any AMQP-0.9.1 compliant
>> broker. You should contact the library author/maintainer, as this library
>> is not actually part of RabbitMQ.
>>
>
> Thanks TIm, will contact them
>
>
>
> In fact, afaik QPid no longer supports AMQP-0.9.1, so I think you'll have
> to look for another client that supports whatever version of the protocol
> QPid is supporting now. Good luck.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/70f11a5a/attachment.htm>

From regal at nine.ch  Fri Sep  7 16:42:52 2012
From: regal at nine.ch (=?UTF-8?B?UmVuw6kgR2FsbGF0aQ==?=)
Date: Fri, 07 Sep 2012 17:42:52 +0200
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
 Ubuntu (potential all Debian-likes)
In-Reply-To: <504A0F66.2040500@rabbitmq.com>
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
	<504A0F66.2040500@rabbitmq.com>
Message-ID: <504A15FC.70500@nine.ch>

On 09/07/2012 05:14 PM, Simon MacMullen wrote:
> On 07/09/12 14:49, Rene Gallati wrote:
> <snip>
>> What is really happening is, that rabbitmq-server
>> absolutely requires that the hostname-part be defined as entry in
>> /etc/hosts as name for 127.0.0.1 !
> <snip>
>
> This is not true.
>
> It *does* require that the hostname resolve, i.e. that "ping `hostname`"
> works and maps to *an* IP address of the machine. As Tim says, this is
> an Erlang requirement, but I don't think it's too hideous.

There are some subtle differences here. The machine has a perfect 
resolvable hostname. The difference is, if the hostname does NOT resolve 
to 127.0.0.1 (which I expect is pretty much standard) then it does not 
work.

Put simply, if your machine is called testmachine and has an IP address 
of 8.7.6.5 then it rabbitmq-server will fail to start.

As soon as you change /etc/hosts from:

127.0.0.1 localhost

8.7.6.5	testmachine testmachine.domain.tld

to:

127.0.0.1 localhost testmachine

8.7.6.5 testmachine.domain.tld

THEN it will work.

I'm sure you'll agree that this is neither standard nor sensible.

Note that no matter what you do, the machine is always perfectly capable 
to ping itself, ie. "host testmachine", "ping testmachine" etc. will 
always give the expected and correct result, but until you add the 
hostname to the localhost entry, rabbitmq-server will simply be unable 
to start in the default configuration as it is being installed from the 
currently available package in the repository.

> And for the record every installation of Ubuntu I've seen (including a
> recent 12.04 LTS install), does add the hostname to /etc/hosts. But this
> is not necessary - on my main development machine the hostname actually
> resolves over DNS, and RabbitMQ starts fine.

Yes they add the hostname but not to the *127.0.0.1* entry. That is the 
difference. And without that the current standard package won't start on 
a freshly installed Ubuntu Linux 12.04 LTS - and I suspect on a lot of 
other variants neither.

Apparently that is a problem of Erlang and not RabbitMQ, but I propose 
as a temporary workaround to not let the package-installer start the 
service since that fails and causes the whole installation to report 
error and abort. Instead either display a message that one needs to set 
NODENAME to rabbit at localhost (or actually change the file that is being 
installed by default to this value) so that it works out of the box as 
it probably should.

CU

Ren?

From regal at nine.ch  Fri Sep  7 17:04:40 2012
From: regal at nine.ch (=?ISO-8859-1?Q?Ren=E9_Gallati?=)
Date: Fri, 07 Sep 2012 18:04:40 +0200
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
 Ubuntu (potential all Debian-likes)
In-Reply-To: <504A17C2.3090207@rabbitmq.com>
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
	<504A17C2.3090207@rabbitmq.com>
Message-ID: <504A1B18.3090408@nine.ch>

On 09/07/2012 05:50 PM, Emile Joubert wrote:
>
> Hi Ren?,
>
> On 07/09/12 14:49, Rene Gallati wrote:
>> as a service provider I was tasked to install RabbitMQ for a customer
>> system. No problem, it's in Ubuntu's default repository, right?
>
> While not addressing your question I want to point out that version
> 2.7.1-0ubuntu4 shipping with 12.04 LTS makes it especially difficult to
> diagnose startup errors like the one you encountered and should
> therefore be avoided. You will find that the startup error log
> (/var/log/rabbitmq/startup_err by default) contains the frustratingly
> glib "rabbitmq failed to start" in case any error occurs. If at all
> possible use the latest version from the rabbitmq.com website instead.

Yeah I tripped on that too. That was when I removed it and installed the 
one from the official repository as detailed in 
http://www.rabbitmq.com/install-debian.html

That one then had better logging and told me "unable to resolve 
hostname" which brought me to the solution. Since the problem seems to 
exist in both versions and I found some forums/messages about "not 
resolving" at startup and how to fix it (via NODENAME entry) and came to 
the findings I am detailing here I thought I need to let you know.

Currently my workaround is simply to force a pre-existing configuration 
file down to the host in question with NODENAME set so the installation 
of the package does not trigger errors and consequently alerts. We're a 
service provider with thousands of managed services and hosts and we 
don't install programs by hand but via management software (in this 
case: puppet) so throwing an error at package installation is a big 
no-no for us.

Happy weekend

Ren?




From tim at rabbitmq.com  Fri Sep  7 17:21:52 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 7 Sep 2012 17:21:52 +0100
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
	Ubuntu (potential all Debian-likes)
In-Reply-To: <504A15FC.70500@nine.ch>
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
	<504A0F66.2040500@rabbitmq.com> <504A15FC.70500@nine.ch>
Message-ID: <08B0810C-76F2-4BBC-937F-3CA40695865B@rabbitmq.com>

On 7 Sep 2012, at 16:42, Ren? Gallati wrote:
>> 
> 
> There are some subtle differences here. The machine has a perfect resolvable hostname. The difference is, if the hostname does NOT resolve to 127.0.0.1 (which I expect is pretty much standard) then it does not work.
> 

I'm not able to replicate this problem actually. Setting it to the 10.*.*.* IP seems to work fine.

> 
>> And for the record every installation of Ubuntu I've seen (including a
>> recent 12.04 LTS install), does add the hostname to /etc/hosts. But this
>> is not necessary - on my main development machine the hostname actually
>> resolves over DNS, and RabbitMQ starts fine.
> 
> Yes they add the hostname but not to the *127.0.0.1* entry. That is the difference. And without that the current standard package won't start on a freshly installed Ubuntu Linux 12.04 LTS - and I suspect on a lot of other variants neither.
> 

In my 12.04 LTS it is set to 127.0.0.1 - it's possible I did that myself and forgot (I set it up over the weekend) *but* I didn't have anything useful installed so I don't know why I'd do that.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/4b4d8ca8/attachment.htm>

From simon at rabbitmq.com  Fri Sep  7 18:10:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 07 Sep 2012 18:10:06 +0100
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
 Ubuntu (potential all Debian-likes)
In-Reply-To: <504A15FC.70500@nine.ch>
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
	<504A0F66.2040500@rabbitmq.com> <504A15FC.70500@nine.ch>
Message-ID: <504A2A6E.8060601@rabbitmq.com>

On 07/09/12 16:42, Ren? Gallati wrote:
> There are some subtle differences here. The machine has a perfect
> resolvable hostname. The difference is, if the hostname does NOT resolve
> to 127.0.0.1 (which I expect is pretty much standard) then it does not
> work.

This really is not what I'm seeing here, honestly. Can you send me the 
contents of /var/rabbitmq/log when it fails to start?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From bytor99999 at gmail.com  Sat Sep  8 05:35:39 2012
From: bytor99999 at gmail.com (bytor99999)
Date: Fri, 7 Sep 2012 21:35:39 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't install any plugins. Installed on Mac
 Snow Leopard via MacPorts.
In-Reply-To: <e33fbdcc-2373-4a4b-90f6-479d58821a63@googlegroups.com>
References: <e33fbdcc-2373-4a4b-90f6-479d58821a63@googlegroups.com>
Message-ID: <99374233-03e4-4b49-ae47-0fb04f01cafb@googlegroups.com>

I think it was two parts. First I installed using MacPorts which installed 
version 2.7.1, not the latest 2.8.6

So I uninstalled via MacPorts and reinstalled through downloading the 2.8.6 
tar.gz file, unzipping it and running it from the script. And there I found 
the rabbitmq-plugins script and was able to add and see the management 
console.

Thanks

Mark

On Thursday, September 6, 2012 4:55:45 PM UTC-7, bytor99999 wrote:
>
> So I installed RabbitMQ via Macports and it installed perfectly, the 
> server runs. However, when I try to enable plugins like the management 
> plugin, the command in the documentation doesn't work. There is no..
>
> rabbitmq-plugins enable rabbitmq_management
>
>
> command for me to run. These are the results.
>
> new-host-4:/ bytor99999$ rabbitmq-plugins enable rabbitmq_management
> -bash: rabbitmq-plugins: command not found
>
> I also have issues finding where it was actually installed. Couldn't find 
> any config files. I did find the log files.
>
> Thanks
>
> Mark
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120907/3d61b47a/attachment.htm>

From sbjung at t-online.de  Sun Sep  9 08:29:06 2012
From: sbjung at t-online.de (Roland Jung)
Date: Sun, 09 Sep 2012 09:29:06 +0200
Subject: [rabbitmq-discuss] RABBITMQ C/C++ client
In-Reply-To: <CALPqkipjG3skA8xb_Tj3OgKsrg8rr+v4-=Cv1Kz1tGpz5o1bYA@mail.gmail.com>
References: <1T9i4G-0YXpwG0@fwd11.aul.t-online.de>
	<87txvagpor.wl%francesco@rabbitmq.com>
	<CALPqkipjG3skA8xb_Tj3OgKsrg8rr+v4-=Cv1Kz1tGpz5o1bYA@mail.gmail.com>
Message-ID: <504C4542.7090108@t-online.de>

Thanks a lot for you help. I will try the SSL branches (SSL / 
SSL-plumbing) and hope that they are in a stable state.

My alternative solutions:

1. Try Qpid c++ client API (interoperability concerns)
2. Use of stunnel as a SSL proxy
3. Develop my own SSL proxy with the rabbitmq Java API

are therefore obsolete.

Best regards
Roland


Am 07.09.2012 11:36, schrieb Brett Cameron:
> What's currently there in rabbitmq-c is a bit crude but will work 
> (https://github.com/alanxz/rabbitmq-c/issues/14; 
> https://github.com/alanxz/rabbitmq-c/tree/ssl), but do heed Alan's 
> comments! Unfortunately I've not had time to tidy it up further...
>
> Brett
>
>
> On Fri, Sep 7, 2012 at 9:14 PM, Francesco Mazzoli 
> <francesco at rabbitmq.com <mailto:francesco at rabbitmq.com>> wrote:
>
>     At Thu, 06 Sep 2012 21:48:48 +0200,
>     sbjung at t-online.de <mailto:sbjung at t-online.de> wrote:
>     > i am looking for a rabbitmq c/c++ client with SSL support.
>     >
>     > can anyone help?
>
>     Sadly I can't find anything like that on
>     <https://rabbitmq.com/devtools.html>,
>     which indicates that we're not aware of one.
>
>     rabbitmq-c will probably support that at some point, you can
>     follow the
>     development at <https://github.com/alanxz/rabbitmq-c/issues/14>.
>
>     --
>     Francesco * Often in error, never in doubt
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120909/a8dfbc00/attachment.htm>

From brett.r.cameron at gmail.com  Sun Sep  9 09:52:03 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Sun, 9 Sep 2012 20:52:03 +1200
Subject: [rabbitmq-discuss] RABBITMQ C/C++ client
In-Reply-To: <504C4542.7090108@t-online.de>
References: <1T9i4G-0YXpwG0@fwd11.aul.t-online.de>
	<87txvagpor.wl%francesco@rabbitmq.com>
	<CALPqkipjG3skA8xb_Tj3OgKsrg8rr+v4-=Cv1Kz1tGpz5o1bYA@mail.gmail.com>
	<504C4542.7090108@t-online.de>
Message-ID: <CALPqkipiMN_NpWkC26uST2qZGnKz9=oVeZPP1jubKyN0MuEmUg@mail.gmail.com>

Roland,

The stunnel approach works pretty well and would maybe be my initial
fallback position...

Brett

On Sun, Sep 9, 2012 at 7:29 PM, Roland Jung <sbjung at t-online.de> wrote:

>  Thanks a lot for you help. I will try the SSL branches (SSL /
> SSL-plumbing) and hope that they are in a stable state.
>
> My alternative solutions:
>
> 1. Try Qpid c++ client API (interoperability concerns)
> 2. Use of stunnel as a SSL proxy
> 3. Develop my own SSL proxy with the rabbitmq Java API
>
> are therefore obsolete.
>
> Best regards
> Roland
>
>
> Am 07.09.2012 11:36, schrieb Brett Cameron:
>
> What's currently there in rabbitmq-c is a bit crude but will work (
> https://github.com/alanxz/rabbitmq-c/issues/14;
> https://github.com/alanxz/rabbitmq-c/tree/ssl), but do heed Alan's
> comments! Unfortunately I've not had time to tidy it up further...
>
> Brett
>
>
> On Fri, Sep 7, 2012 at 9:14 PM, Francesco Mazzoli <francesco at rabbitmq.com>wrote:
>
>> At Thu, 06 Sep 2012 21:48:48 +0200,
>> sbjung at t-online.de wrote:
>> > i am looking for a rabbitmq c/c++ client with SSL support.
>> >
>> > can anyone help?
>>
>> Sadly I can't find anything like that on <
>> https://rabbitmq.com/devtools.html>,
>> which indicates that we're not aware of one.
>>
>> rabbitmq-c will probably support that at some point, you can follow the
>> development at <https://github.com/alanxz/rabbitmq-c/issues/14>.
>>
>> --
>> Francesco * Often in error, never in doubt
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120909/e7044082/attachment.htm>

From thg.bot at gmail.com  Sun Sep  9 12:52:57 2012
From: thg.bot at gmail.com (Theo Bot)
Date: Sun, 9 Sep 2012 13:52:57 +0200
Subject: [rabbitmq-discuss] non-blocking perl consumer
Message-ID: <CA+rsMFpjCnZ5JAHk3HZgFY-b5y689fcoyFv90NFLrY56csA0kg@mail.gmail.com>

Hi,

For my perl project I require the following:
1. Subscribe, non-exclusively, to 2 different queues
2. One consuming all messages
3. One with a routing key

Since the documentation is rather sober is there anybody able to give an
example on how to code this in perl?
-- 
Kind regards

Theo Bot
Network Management Engineer
LinkedIn: http://www.linkedin.com/in/theobot
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120909/84470f6f/attachment.htm>

From tim at rabbitmq.com  Mon Sep 10 09:19:03 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 10 Sep 2012 09:19:03 +0100
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading
	Ubuntu	10.04 to 12.04
In-Reply-To: <C740F225-B2E4-4CCD-81DC-DD141F0E2FD6@mazemedia.se>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<9685628E-7C33-4472-B8B5-D121CD46FAD3@rabbitmq.com>
	<73EDD258-46E7-4792-8C48-0E459F76D6A8@rabbitmq.com>
	<87B612C1-37C9-4E5E-9470-A546735DA59D@rabbitmq.com>
	<loom.20120907T125644-905@post.gmane.org>
	<C740F225-B2E4-4CCD-81DC-DD141F0E2FD6@mazemedia.se>
Message-ID: <80D9C0EB-FE02-46FB-AB29-79E40577110E@rabbitmq.com>

Can the machine's hostname be resolved by Erlang? What does /etc/hosts look like and what does `hostname` return?

On 7 Sep 2012, at 12:17, Fredrik Stark wrote:

>> The startup and main logs are available here: 
>> http://dpaste.com/797684/ 
> 
> I just realized that i only posted the startup_* logs, but there are no other log files there.
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Mon Sep 10 09:22:15 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 10 Sep 2012 09:22:15 +0100
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading
	Ubuntu	10.04 to 12.04
In-Reply-To: <80D9C0EB-FE02-46FB-AB29-79E40577110E@rabbitmq.com>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<9685628E-7C33-4472-B8B5-D121CD46FAD3@rabbitmq.com>
	<73EDD258-46E7-4792-8C48-0E459F76D6A8@rabbitmq.com>
	<87B612C1-37C9-4E5E-9470-A546735DA59D@rabbitmq.com>
	<loom.20120907T125644-905@post.gmane.org>
	<C740F225-B2E4-4CCD-81DC-DD141F0E2FD6@mazemedia.se>
	<80D9C0EB-FE02-46FB-AB29-79E40577110E@rabbitmq.com>
Message-ID: <3E17C5EE-7265-4228-9583-C78F196144F0@rabbitmq.com>


On 10 Sep 2012, at 09:19, Tim Watson wrote:

> Can the machine's hostname be resolved by Erlang? What does /etc/hosts look like and what does `hostname` return?

Sorry, I obviously missed that you said this in the beginning of the thread. 

From emile at rabbitmq.com  Mon Sep 10 10:41:46 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 10 Sep 2012 10:41:46 +0100
Subject: [rabbitmq-discuss] non-blocking perl consumer
In-Reply-To: <CA+rsMFpjCnZ5JAHk3HZgFY-b5y689fcoyFv90NFLrY56csA0kg@mail.gmail.com>
References: <CA+rsMFpjCnZ5JAHk3HZgFY-b5y689fcoyFv90NFLrY56csA0kg@mail.gmail.com>
Message-ID: <504DB5DA.3070800@rabbitmq.com>

Hi Theo,

On 09/09/12 12:52, Theo Bot wrote:
> Since the documentation is rather sober is there anybody able to give an
> example on how to code this in perl?

Have you taken a look at the Perl implementation of the tutorials? See
the Perl link on http://www.rabbitmq.com/getstarted.html

This should be enough to get you started in case you are also using
Net::RabbitFoot. If you are using a different library then I would
suggest checking whether that library includes examples of the kind you
require. Also see http://www.rabbitmq.com/devtools.html#perl-dev


-Emile



From simon at rabbitmq.com  Mon Sep 10 10:37:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Sep 2012 10:37:33 +0100
Subject: [rabbitmq-discuss] Federated Exchange Advice
In-Reply-To: <CAG8tyE7uodG_Fo_cxQ80b_cZb5zVeOCisQpnMDXE5Wrb+i3Bnw@mail.gmail.com>
References: <7307b1d8-d53f-457b-8660-59786afc673d@googlegroups.com>
	<50487033.6030108@rabbitmq.com>
	<CAG8tyE7uodG_Fo_cxQ80b_cZb5zVeOCisQpnMDXE5Wrb+i3Bnw@mail.gmail.com>
Message-ID: <504DB4DD.5030906@rabbitmq.com>

On 06/09/2012 7:58PM, Ilya Volodarsky wrote:
> Thanks Simon. I was using RabbitMQ management console to set up the
> exchange to exchange bindings, and the upstream exchanges showed up as
> "production-ingestion from rabbit at hostname",

No. This is not the upstream exchange per se - this is an internal part 
of the federation mechanism. Binding to this exchange will give 
unpredictable results.

> and when I tried to bind
> ingestion to production-ingestion, it wouldn't let me saying that the
> exchange didnt exist.

Well we need to get to the bottom of that. Did it exist? I suspect a 
typo to be honest.

> I had to give the full upstream exchange name
> which looked precarious since it contained the actual hostname of the
> connecting computer.

No, really don't do that.

> Do you think that doing that / or using RMQ management console could
> have something to do with it?

Using mgmt should have nothing to do with it.

Cheers, Simon

From emile at rabbitmq.com  Mon Sep 10 11:38:55 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 10 Sep 2012 11:38:55 +0100
Subject: [rabbitmq-discuss] rabbitmq won't start after upgrading Ubuntu
 10.04 to 12.04
In-Reply-To: <5049F6E2.7000803@rabbitmq.com>
References: <2BC2631D-472C-4F63-A891-4824AA298F4A@mazemedia.com>
	<5049C471.9070305@rabbitmq.com>
	<AF66F5D5-EEE5-4C79-B8D7-A7E0238B8ECD@mazemedia.se>
	<5049E55A.3000205@rabbitmq.com>
	<6213E5DF-460D-452E-AEA4-8B0920799739@mazemedia.se>
	<5049F6E2.7000803@rabbitmq.com>
Message-ID: <504DC33F.4010703@rabbitmq.com>


Hi Frederick,

On 07/09/12 14:30, Emile Joubert wrote:
> peculiarity. You could either try to solve that, so that debug output

I'm sorry to see from your recent tweet that you have given up on trying
to solve this issue:
https://twitter.com/schmilblick/status/244754105002774528

As a test I've set up a 64-bit server instance of the previous LTS
release (10.04) and performed do-release-upgrade (to 12.04.1 LTS) on it.
The Erlang package correctly upgraded from R13B03 (erts 5.7.4) to R14B04
(erts 5.8.5) and the rabbitmq-server package successfully upgraded from
v1.7.2 to 2.7.1-0ubuntu4. Installing version 2.7.1-0ubuntu4 and
2.8.6-1_all of the broker separately also succeeded.

I'm not able to reproduce any of the errors that you report and I
suspect the cause might be network setup, or some configuration from
prior to the upgrade. If you are willing to assist us in further
investigation to get to the root cause then please let us know what
possible causes you have already ruled out so that we can suggest
further diagnostic tests.


-Emile


From regal at nine.ch  Mon Sep 10 12:31:19 2012
From: regal at nine.ch (=?UTF-8?B?UmVuw6kgR2FsbGF0aQ==?=)
Date: Mon, 10 Sep 2012 13:31:19 +0200
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
 Ubuntu (potential all Debian-likes)
In-Reply-To: <504A2A6E.8060601@rabbitmq.com>
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
	<504A0F66.2040500@rabbitmq.com> <504A15FC.70500@nine.ch>
	<504A2A6E.8060601@rabbitmq.com>
Message-ID: <504DCF87.2030601@nine.ch>

On 09/07/2012 07:10 PM, Simon MacMullen wrote:
> On 07/09/12 16:42, Ren? Gallati wrote:
>> There are some subtle differences here. The machine has a perfect
>> resolvable hostname. The difference is, if the hostname does NOT resolve
>> to 127.0.0.1 (which I expect is pretty much standard) then it does not
>> work.
>
> This really is not what I'm seeing here, honestly. Can you send me the
> contents of /var/rabbitmq/log when it fails to start?
>
> Cheers, Simon
>

I spent some time playing with my personal systems over the weekend 
where everything worked great. I could trace the problem back to the 
firewall config opening up the ports too late which causes 
rabbitmq-server not to be able to connect to itself and lets the 
installation abort.

So it boils down to a race condition, or rather a wrong sequence of 
installation / setting up which causes a failure in the start of 
rabbitmq-server and not a broken package/installer. We have a relative 
restrictive default firewall policy and it just bit back.

Sorry to having caused a fuzz.

While trying to fix this I found that I basically have to allow all 
traffic on $extip since it appears that beam.smp is binding 2 random 
ports and needs to be accessible there, is that correct? Ie. just 
allowing 4369 and 5672 the latter of which btw. is the only port it 
binds as ipv6 is not enough. Rabbitmq starts but hangs while starting 
and the init script never returns until I allow access to the randomly 
bound ports. Can I pre-set these ports with some configuration directive 
or are they truly random?


CU

Ren?





From matthias at rabbitmq.com  Mon Sep 10 13:01:18 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 10 Sep 2012 13:01:18 +0100
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <5048A4A1.9090307@seegrid.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
	<7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
	<50486CC1.1060209@rabbitmq.com> <5048A4A1.9090307@seegrid.com>
Message-ID: <504DD68E.3000908@rabbitmq.com>

Brennan,

On 06/09/12 14:26, Brennan Sellner wrote:
> Which of the following causes Rabbit to touch disk (and possibly fsync)?
>    - Redeclaring an existing durable exchange

doesn't.

>    - Binding a non-durable queue to a durable exchange

doesn't.

> Does Rabbit hit the disk synchronously before sending the bind-ok method

Yes. the same goes for {queue,exchange}.{declare,delete} and 'unbind'.


Matthias.

From nekulin123 at gmail.com  Mon Sep 10 12:04:43 2012
From: nekulin123 at gmail.com (=?UTF-8?B?0J3QuNC60L7Qu9Cw0Lkg0JjQt9C80LDQudC70L7Qsg==?=)
Date: Mon, 10 Sep 2012 04:04:43 -0700 (PDT)
Subject: [rabbitmq-discuss] undefined symbol: AMQP_ASSIGN_CONNECTION
Message-ID: <eff515fe-a993-402e-aaf0-410667872af3@googlegroups.com>

$ch = new AMQPChannel($cnn);
Error  php: symbol lookup error: /usr/lib/php5/20090626/amqp.so: undefined 
symbol: AMQP_ASSIGN_CONNECTION
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/3babcd26/attachment.htm>

From simon at rabbitmq.com  Mon Sep 10 14:07:43 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 10 Sep 2012 14:07:43 +0100
Subject: [rabbitmq-discuss] FYI: RabbitMQ default installation broken on
 Ubuntu (potential all Debian-likes)
In-Reply-To: <504DCF87.2030601@nine.ch>
References: <6ee12e22-5be5-403a-9b64-cb24fcb43f0c@googlegroups.com>
	<504A0F66.2040500@rabbitmq.com> <504A15FC.70500@nine.ch>
	<504A2A6E.8060601@rabbitmq.com> <504DCF87.2030601@nine.ch>
Message-ID: <504DE61F.2010407@rabbitmq.com>

On 10/09/2012 12:31PM, Ren? Gallati wrote:
> So it boils down to a race condition, or rather a wrong sequence of
> installation / setting up which causes a failure in the start of
> rabbitmq-server and not a broken package/installer. We have a relative
> restrictive default firewall policy and it just bit back.
>
> Sorry to having caused a fuzz.

Ah cool, thanks for getting back to us.

> While trying to fix this I found that I basically have to allow all
> traffic on $extip since it appears that beam.smp is binding 2 random
> ports and needs to be accessible there, is that correct? Ie. just
> allowing 4369 and 5672 the latter of which btw. is the only port it
> binds as ipv6 is not enough. Rabbitmq starts but hangs while starting
> and the init script never returns until I allow access to the randomly
> bound ports. Can I pre-set these ports with some configuration directive
> or are they truly random?

These are the ports for Erlang inter-process communication, you can lock 
them down a bit more as documented here:

http://www.rabbitmq.com/clustering.html#firewall

e.g. a RabbitMQ config file like:

[{kernel, [{inet_dist_listen_min, 10001},
            {inet_dist_listen_max, 10001}]}].

to lock it down to a single port.

Cheers, Simon

From michael.s.klishin at gmail.com  Mon Sep 10 14:11:30 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 10 Sep 2012 17:11:30 +0400
Subject: [rabbitmq-discuss] undefined symbol: AMQP_ASSIGN_CONNECTION
In-Reply-To: <eff515fe-a993-402e-aaf0-410667872af3@googlegroups.com>
References: <eff515fe-a993-402e-aaf0-410667872af3@googlegroups.com>
Message-ID: <CAE3HoVQh_pku2VDXQf57+uZ0ko_TAoG+S2nJMgOy_Nx=yjfoeA@mail.gmail.com>

2012/9/10 ??????? ???????? <nekulin123 at gmail.com>

> $ch = new AMQPChannel($cnn);
> Error  php: symbol lookup error: /usr/lib/php5/20090626/amqp.so: undefined
> symbol: AMQP_ASSIGN_CONNECTION
>

Nickolay,

That's a little bit too terse. What library and version is that? What Linux
distribution and architecture are you using?
Can you please post a small script that library maintainer can use to
reproduce the issue?

Thanks,
-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/c15e75fc/attachment.htm>

From matthias at rabbitmq.com  Mon Sep 10 14:24:27 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 10 Sep 2012 14:24:27 +0100
Subject: [rabbitmq-discuss] Publisher Authentication
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD5F8B1F1C@G4W3209.americas.hpqcorp.net>
References: <CAAEFr-cN3RjcOorcG62YkruE56Rt=8wgFiFXV+SaqC9bGQbY+w@mail.gmail.com>
	<CAE0Sz=xT5BzmQ6Dw9RoAbU3_KtYpHtX43W4GGSsrEx8rf9MKWg@mail.gmail.com>
	<5F389C517756284F80239F55BCA5DDDD5F8B1F1C@G4W3209.americas.hpqcorp.net>
Message-ID: <504DEA0B.5000105@rabbitmq.com>

Andrea,

On 06/09/12 09:40, Rosa, Andrea (HP Cloud Services) wrote:
> Some months ago I tested the SASL EXTERNAL support for authenticate both
> clients and server, it worked well apart an issue with revoked certificates.
>
> It seems that the plugin was not able to verify a certificate against a
> CRL, and in my understanding (and if I remember correctly) that was a
> limitation due to SSL erlang library.

Correct - there is no built-in support for CRLs in the Erlang SSL libraries.

You should however be able to plug in your own CRL logic by supplying a 
suitable verify_fun in the ssl configuration. See 
http://www.erlang.org/doc/man/ssl.html.

Regards,

Matthias.

From theo.bot at proxy.nl  Mon Sep 10 15:47:44 2012
From: theo.bot at proxy.nl (Theo Bot)
Date: Mon, 10 Sep 2012 16:47:44 +0200
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <CA+rsMFrRPRp29y+f2C2rfRaH0xpUONXeQfrUxqFPA0yR4CwY1Q@mail.gmail.com>

Hi

I recently installed RabbitMQ 2.8.6-1 on a CentOS 6.3 box. However when I
turn on the tracing (rabbitmqctl trace_on) the log says:
=INFO REPORT==== 10-Sep-2012::14:57:10 ===
Enabling tracing for vhost '/'

However no tracing queue appears. Am I missing something?

-- 
Regards,

Theo Bot
Network Management Engineer
Website: http://www.proxy.nl
LinkedIn: http://www.linkedin.com/in/theobot
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/db0c9a44/attachment.htm>

From steve at rabbitmq.com  Mon Sep 10 17:23:34 2012
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 10 Sep 2012 17:23:34 +0100
Subject: [rabbitmq-discuss] Can't install any plugins. Installed on Mac
	Snow Leopard via MacPorts.
In-Reply-To: <99374233-03e4-4b49-ae47-0fb04f01cafb@googlegroups.com>
References: <e33fbdcc-2373-4a4b-90f6-479d58821a63@googlegroups.com>
	<99374233-03e4-4b49-ae47-0fb04f01cafb@googlegroups.com>
Message-ID: <D6E2EA3B-7C07-40F0-9EE5-E58A37FA82B5@rabbitmq.com>

Hi Mark,
If you are running with the latest MacPorts you should be getting version 2.8.5 at least.  Have you issued  sudo port selfupdate recently?

Macports installs the source (and compiles it) in its own generated areas (so as to keep version clashes to a minimum) and puts links to the executables in the /opt/local/bin directory. Macports should have updated your path (and your profile) to include both ../bin and ../sbin (and put a note in the profile to say what it has done).

sudo port selfupdate will ensure you are running with the latest version of Macports and have the latest indexes.  Uninstall rabbitmq-server first (you don't want two versions running simultaneously).

If you have the latest version then rabbitmq-plugins ought to be available as a command.

If you install the stand-alone version of rabbitmq-server (with plugins) -- which should work under Mac -- then the PATH is not modified, and the commands are in the bin subdirectory of the install directory.  Please read http://www.rabbitmq.com/install-generic-unix.html for information about the locations of files in this case.

Steve Powell  (a part-time bunny)
----------yet more definitions from the SPD----------
corrugate (n.) T.V. soap scandal.
olympic (n.) A camp road-digger.
jamboree (n.) A conserve made from French cheese.

On 8 Sep 2012, at 05:35, bytor99999 wrote:

> I think it was two parts. First I installed using MacPorts which installed version 2.7.1, not the latest 2.8.6
> 
> So I uninstalled via MacPorts and reinstalled through downloading the 2.8.6 tar.gz file, unzipping it and running it from the script. And there I found the rabbitmq-plugins script and was able to add and see the management console.
> 
> Thanks
> 
> Mark
> 
> On Thursday, September 6, 2012 4:55:45 PM UTC-7, bytor99999 wrote:
> So I installed RabbitMQ via Macports and it installed perfectly, the server runs. However, when I try to enable plugins like the management plugin, the command in the documentation doesn't work. There is no..
> 
> rabbitmq-plugins enable rabbitmq_management
> 
> command for me to run. These are the results.
> 
> new-host-4:/ bytor99999$ rabbitmq-plugins enable rabbitmq_management
> -bash: rabbitmq-plugins: command not found
> 
> I also have issues finding where it was actually installed. Couldn't find any config files. I did find the log files.
> 
> Thanks
> 
> Mark
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/b3e0c631/attachment.htm>

From prudhviy at gmail.com  Mon Sep 10 18:47:20 2012
From: prudhviy at gmail.com (Bhaskar teja)
Date: Mon, 10 Sep 2012 23:17:20 +0530
Subject: [rabbitmq-discuss] Dynamic queue problem
Message-ID: <CAEMO9cCR7AZDuQ_J5yYuyYQHbROUiw41AavgyDs0jd1-X-8=zQ@mail.gmail.com>

Hi,

Our website has a daily traffic of around 50k users and we are using
rabbitmq for generating web notifications asynchronously.

Right now we are using a design pattern as follows,
Producer:
     Exchange name - "web_notifications"
     Type - direct
     Routing key - "documents"
Consumer:
     Exchange name - "web_notifications"
     Type - direct
     Routing key - "documents"
     Queue name - dynamically generated (no name given)

so here when ever we change the python code in consumer, we have to
restart the consumer daemon process. The problem is when ever consumer
restarts, it declares a new queue to the exchange and the old one is
left away in which some messages are ready to consume.

How can we connect to the old dynamic queue so that we dont loose any
messages in that queue?
Is it a bad idea to use dynamically declared queues over named queues?
What are the advantages dynamic queue vs named queues?


Thank you,
Bhaskar teja

From francesco at rabbitmq.com  Mon Sep 10 19:00:53 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 10 Sep 2012 19:00:53 +0100
Subject: [rabbitmq-discuss] Dynamic queue problem
In-Reply-To: <CAEMO9cCR7AZDuQ_J5yYuyYQHbROUiw41AavgyDs0jd1-X-8=zQ@mail.gmail.com>
References: <CAEMO9cCR7AZDuQ_J5yYuyYQHbROUiw41AavgyDs0jd1-X-8=zQ@mail.gmail.com>
Message-ID: <878vchsqp6.wl%francesco@rabbitmq.com>

At Mon, 10 Sep 2012 23:17:20 +0530,
Bhaskar teja wrote:
> How can we connect to the old dynamic queue so that we dont loose any messages
> in that queue?

In AMQP you can use an empty queue name to connect to the last created queue -
if you're not creating any other queues in the meantime that will help.

Otherwise you can simply get the queue name and have an option to connect to an
already declared queue, and manually provide that name.

Or...

> Is it a bad idea to use dynamically declared queues over named queues?
> What are the advantages dynamic queue vs named queues?

If you can give a name to a queue, I'd do it.  Dynamic queue are generally used
for disposable queue (e.g. queue with auto_delete).  Not having to think about
the name has its advantages, but can get annoying, as you experienced.

--
Francesco * Often in error, never in doubt

From matthias at rabbitmq.com  Mon Sep 10 19:14:03 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 10 Sep 2012 19:14:03 +0100
Subject: [rabbitmq-discuss] Dynamic queue problem
In-Reply-To: <878vchsqp6.wl%francesco@rabbitmq.com>
References: <CAEMO9cCR7AZDuQ_J5yYuyYQHbROUiw41AavgyDs0jd1-X-8=zQ@mail.gmail.com>
	<878vchsqp6.wl%francesco@rabbitmq.com>
Message-ID: <504E2DEB.5000405@rabbitmq.com>

On 10/09/12 19:00, Francesco Mazzoli wrote:
> At Mon, 10 Sep 2012 23:17:20 +0530, Bhaskar teja wrote:
>> How can we connect to the old dynamic queue so that we dont loose
>> any messages in that queue?
>
> In AMQP you can use an empty queue name to connect to the last
> created queue - if you're not creating any other queues in the
> meantime that will help.

That "most recently declared queue" feature of AMQP operates per
channel, which isn't going to help the OP when restarting their consumers.

> If you can give a name to a queue, I'd do it.

Exactly.

> Dynamic queue are generally used for disposable queue (e.g. queue
> with auto_delete).

'exclusive', actually. auto_delete is typically employed in the context 
of having multiple consumers of a queue. That implies they all need to 
know the queue's name, which therefore usually won't be server-generated.

Matthias.

From videlalvaro at gmail.com  Mon Sep 10 19:19:02 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 10 Sep 2012 20:19:02 +0200
Subject: [rabbitmq-discuss] Dynamic queue problem
In-Reply-To: <504E2DEB.5000405@rabbitmq.com>
References: <CAEMO9cCR7AZDuQ_J5yYuyYQHbROUiw41AavgyDs0jd1-X-8=zQ@mail.gmail.com>
	<878vchsqp6.wl%francesco@rabbitmq.com>
	<504E2DEB.5000405@rabbitmq.com>
Message-ID: <CAMcAHLVkupLOLmUwDL=3TwfUnOJK3WBVf8zjJNW43YanYpqgUw@mail.gmail.com>

Also keep in mind that a queue_declare always returns the queue name, even
if it was generated by the server. So provided your queue is not
auto-deleted then you could keep that name somewhere and use it for your
new consumer

-Alvaro

On Mon, Sep 10, 2012 at 8:14 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 10/09/12 19:00, Francesco Mazzoli wrote:
>
>> At Mon, 10 Sep 2012 23:17:20 +0530, Bhaskar teja wrote:
>>
>>> How can we connect to the old dynamic queue so that we dont loose
>>> any messages in that queue?
>>>
>>
>> In AMQP you can use an empty queue name to connect to the last
>> created queue - if you're not creating any other queues in the
>> meantime that will help.
>>
>
> That "most recently declared queue" feature of AMQP operates per
> channel, which isn't going to help the OP when restarting their consumers.
>
>
>  If you can give a name to a queue, I'd do it.
>>
>
> Exactly.
>
>
>  Dynamic queue are generally used for disposable queue (e.g. queue
>> with auto_delete).
>>
>
> 'exclusive', actually. auto_delete is typically employed in the context of
> having multiple consumers of a queue. That implies they all need to know
> the queue's name, which therefore usually won't be server-generated.
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/a3392cf7/attachment.htm>

From prudhviy at gmail.com  Mon Sep 10 19:23:42 2012
From: prudhviy at gmail.com (Bhaskar teja)
Date: Mon, 10 Sep 2012 23:53:42 +0530
Subject: [rabbitmq-discuss] Dynamic queue problem
In-Reply-To: <878vchsqp6.wl%francesco@rabbitmq.com>
References: <CAEMO9cCR7AZDuQ_J5yYuyYQHbROUiw41AavgyDs0jd1-X-8=zQ@mail.gmail.com>
	<878vchsqp6.wl%francesco@rabbitmq.com>
Message-ID: <CAEMO9cC+we7h1jvz2hPH7XrTWezy-iwFH6suM6QzFjypYeC=eA@mail.gmail.com>

We have 20 different kinds of web notifications. we categorized them
into 5 * 4 and gave a routing key for each kind like -- documents
                                          -- wall
                                          -- issues
                                          -- tasks
each having 5 notifications of its kind. we have plans to make
rabbitmq handle e-mails via consumers. In future we thought of having
topic exchanges so that single event message from web app to rabbitmq
can route the messages appropriately like,
  --- web_notifs.documents
  --- mail.documents
  --- logging.documents
so we declared dynamic queues so that routing keys match via *.documents.
Is there a better way to design this with named queues, so that we can
run a single consumer for now?

How can i get the old dynamic queue name? I could not find any api in
python pika module.


On 9/10/12, Francesco Mazzoli <francesco at rabbitmq.com> wrote:
> At Mon, 10 Sep 2012 23:17:20 +0530,
> Bhaskar teja wrote:
>> How can we connect to the old dynamic queue so that we dont loose any
>> messages
>> in that queue?
>
> In AMQP you can use an empty queue name to connect to the last created queue
> -
> if you're not creating any other queues in the meantime that will help.
>
> Otherwise you can simply get the queue name and have an option to connect to
> an
> already declared queue, and manually provide that name.
>
> Or...
>
>> Is it a bad idea to use dynamically declared queues over named queues?
>> What are the advantages dynamic queue vs named queues?
>
> If you can give a name to a queue, I'd do it.  Dynamic queue are generally
> used
> for disposable queue (e.g. queue with auto_delete).  Not having to think
> about
> the name has its advantages, but can get annoying, as you experienced.
>
> --
> Francesco * Often in error, never in doubt
>


-- 
Thank you,
Bhaskar teja

From francesco at rabbitmq.com  Mon Sep 10 19:47:20 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 10 Sep 2012 19:47:20 +0100
Subject: [rabbitmq-discuss] Dynamic queue problem
In-Reply-To: <CAEMO9cC+we7h1jvz2hPH7XrTWezy-iwFH6suM6QzFjypYeC=eA@mail.gmail.com>
References: <CAEMO9cCR7AZDuQ_J5yYuyYQHbROUiw41AavgyDs0jd1-X-8=zQ@mail.gmail.com>
	<878vchsqp6.wl%francesco@rabbitmq.com>
	<CAEMO9cC+we7h1jvz2hPH7XrTWezy-iwFH6suM6QzFjypYeC=eA@mail.gmail.com>
Message-ID: <87627lsojr.wl%francesco@rabbitmq.com>


Please be aware of Matthias' corrections to my post:
<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-September/022394.html>

At Mon, 10 Sep 2012 23:53:42 +0530,
Bhaskar teja wrote:
> We have 20 different kinds of web notifications. we categorized them into 5 *
> 4 and gave a routing key for each kind like -- documents
>                                           -- wall
>                                           -- issues
>                                           -- tasks
> each having 5 notifications of its kind. we have plans to make rabbitmq handle
> e-mails via consumers. In future we thought of having topic exchanges so that
> single event message from web app to rabbitmq can route the messages
> appropriately like,
>   --- web_notifs.documents
>   --- mail.documents
>   --- logging.documents
> so we declared dynamic queues so that routing keys match via *.documents.
> Is there a better way to design this with named queues, so that we can run a
> single consumer for now?

Can't you just name it `all-documents' or something like that?

> How can i get the old dynamic queue name? I could not find any api in python
> pika module.

I think that you have to pass a callback to the `queue_declare' function, but
the docs are unclear on the subject.

--
Francesco * Often in error, never in doubt

From prudhviy at gmail.com  Mon Sep 10 20:27:00 2012
From: prudhviy at gmail.com (Bhaskar teja)
Date: Tue, 11 Sep 2012 00:57:00 +0530
Subject: [rabbitmq-discuss] Dynamic queue problem
In-Reply-To: <87627lsojr.wl%francesco@rabbitmq.com>
References: <CAEMO9cCR7AZDuQ_J5yYuyYQHbROUiw41AavgyDs0jd1-X-8=zQ@mail.gmail.com>
	<878vchsqp6.wl%francesco@rabbitmq.com>
	<CAEMO9cC+we7h1jvz2hPH7XrTWezy-iwFH6suM6QzFjypYeC=eA@mail.gmail.com>
	<87627lsojr.wl%francesco@rabbitmq.com>
Message-ID: <CAEMO9cC6YkRhCRvqztEJVdn18P05+-q6HwDfhPZYa0TivqWi6A@mail.gmail.com>

Thank you,

Please let me know if the following design pattern is good enough,

Producer:
  Exchange name - "event-notifications"
  Type - topic
  Routing key - "mail.mobile.web.documents"

Consumer  for web notifications:
  Exchange name - "event-notifications"
  Type - topic
  Routing key - "#.web.documents"
  Queue name - "web_notifications"

Consumer  for mobile notifications:
  Exchange name - "event-notifications"
  Type - topic
  Routing key - "#.mobile.#.documents"
  Queue name - "mobile_notifications"

Consumer  for mail notifications:
  Exchange name - "event-notifications"
  Type - topic
  Routing key - "mail.#.documents"
  Queue name - "mail_notifications"


On 9/11/12, Francesco Mazzoli <francesco at rabbitmq.com> wrote:
>
> Please be aware of Matthias' corrections to my post:
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-September/022394.html>
>
> At Mon, 10 Sep 2012 23:53:42 +0530,
> Bhaskar teja wrote:
>> We have 20 different kinds of web notifications. we categorized them into
>> 5 *
>> 4 and gave a routing key for each kind like -- documents
>>                                           -- wall
>>                                           -- issues
>>                                           -- tasks
>> each having 5 notifications of its kind. we have plans to make rabbitmq
>> handle
>> e-mails via consumers. In future we thought of having topic exchanges so
>> that
>> single event message from web app to rabbitmq can route the messages
>> appropriately like,
>>   --- web_notifs.documents
>>   --- mail.documents
>>   --- logging.documents
>> so we declared dynamic queues so that routing keys match via *.documents.
>> Is there a better way to design this with named queues, so that we can run
>> a
>> single consumer for now?
>
> Can't you just name it `all-documents' or something like that?
>
>> How can i get the old dynamic queue name? I could not find any api in
>> python
>> pika module.
>
> I think that you have to pass a callback to the `queue_declare' function,
> but
> the docs are unclear on the subject.
>
> --
> Francesco * Often in error, never in doubt
>


-- 
Thank you,
Bhaskar teja

From THorton at Timetrade.com  Mon Sep 10 19:13:23 2012
From: THorton at Timetrade.com (Tyler Horton)
Date: Mon, 10 Sep 2012 13:13:23 -0500
Subject: [rabbitmq-discuss] How to run RabbitMQ server as a different system
	user?
Message-ID: <CC73A603.3DD2%thorton@timetrade.com>

I have Rabbit 2.8.4 running on RHEL5.  The installation instructions (http://www.rabbitmq.com/install-rpm.html) say:

Note: The server is set up to run as system user rabbitmq. If you change the location of the Mnesia database or the logs, you must ensure the files are owned by this user (and also update the environment variables).

Is it possible to run as a user other than "rabbitmq"?  I am not interested in changing Mnesia at all, unless it is required to change the user.  Is re-installation required or can my existing install be salvaged?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/52a50ea7/attachment.htm>

From kayode81until at gmail.com  Mon Sep 10 20:14:58 2012
From: kayode81until at gmail.com (kayslay)
Date: Mon, 10 Sep 2012 12:14:58 -0700 (PDT)
Subject: [rabbitmq-discuss] None of the specified endpoints were reachable
Message-ID: <544eb68a-0f6e-4b9f-b4f0-a3964dd6e549@googlegroups.com>

I have RabbitMQ running on my Windows 7 machine.  I ran it via the command 
prompt .  I am able to verify that it is up.  When I try to connect to it 
locally,
   ConnectionFactory cf = new ConnectionFactory();
            cf.Uri = "amqp://localhost"
            using (IConnection conn = cf.CreateConnection())
            {
the CreateConnection call throws an exception saying
"None of the specified endpoints were reachable" 
I was able to verify that RabbitMQ was running by executing rabbitmq-server.
Is there something I'm missing, I'm new to RabbitMQ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/452a88fc/attachment.htm>

From matthias at rabbitmq.com  Mon Sep 10 20:41:25 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 10 Sep 2012 20:41:25 +0100
Subject: [rabbitmq-discuss] None of the specified endpoints were
	reachable
In-Reply-To: <544eb68a-0f6e-4b9f-b4f0-a3964dd6e549@googlegroups.com>
References: <544eb68a-0f6e-4b9f-b4f0-a3964dd6e549@googlegroups.com>
Message-ID: <504E4265.1090607@rabbitmq.com>

On 10/09/12 20:14, kayslay wrote:
> the CreateConnection call throws an exception saying
> "None of the specified endpoints were reachable"

Catch the exception and display its ToString(). That should provide more 
details on the problem encountered.

Matthias.

From bsellner at seegrid.com  Mon Sep 10 20:42:21 2012
From: bsellner at seegrid.com (Brennan Sellner)
Date: Mon, 10 Sep 2012 15:42:21 -0400
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <504DD68E.3000908@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
	<7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
	<50486CC1.1060209@rabbitmq.com> <5048A4A1.9090307@seegrid.com>
	<504DD68E.3000908@rabbitmq.com>
Message-ID: <504E429D.80801@seegrid.com>

On 09/10/2012 08:01 AM, Matthias Radestock wrote:
> Brennan,
> 
> On 06/09/12 14:26, Brennan Sellner wrote:
>> Which of the following causes Rabbit to touch disk (and possibly fsync)?
>>    - Redeclaring an existing durable exchange
> 
> doesn't.
> 
>>    - Binding a non-durable queue to a durable exchange
> 
> doesn't.
> 
>> Does Rabbit hit the disk synchronously before sending the bind-ok method
> 
> Yes. the same goes for {queue,exchange}.{declare,delete} and 'unbind'.

Well, there goes that theory.  Thanks for the info!

I'll see if I can reproduce this in a more controlled environment.  If
anyone has further ideas in the meantime, I'm all ears.

Thanks,

-Brennan



From matthias at rabbitmq.com  Mon Sep 10 20:52:25 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 10 Sep 2012 20:52:25 +0100
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <504E429D.80801@seegrid.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
	<7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
	<50486CC1.1060209@rabbitmq.com> <5048A4A1.9090307@seegrid.com>
	<504DD68E.3000908@rabbitmq.com> <504E429D.80801@seegrid.com>
Message-ID: <504E44F9.1090900@rabbitmq.com>

On 10/09/12 20:42, Brennan Sellner wrote:
> Well, there goes that theory.  Thanks for the info!
>
> I'll see if I can reproduce this in a more controlled environment.  If
> anyone has further ideas in the meantime, I'm all ears.

Set up some syscall tracing on the rabbit process to see what it's up to 
when you encounter the delay. That would reveal any unexpected fsync's, 
for example.

Matthias.


From kayode81until at gmail.com  Mon Sep 10 21:29:59 2012
From: kayode81until at gmail.com (kayslay)
Date: Mon, 10 Sep 2012 13:29:59 -0700 (PDT)
Subject: [rabbitmq-discuss] None of the specified endpoints were
	reachable
In-Reply-To: <544eb68a-0f6e-4b9f-b4f0-a3964dd6e549@googlegroups.com>
References: <544eb68a-0f6e-4b9f-b4f0-a3964dd6e549@googlegroups.com>
Message-ID: <f70d5ac0-1893-4a94-96e0-de2488789967@googlegroups.com>

When I do that I get the following exception:
None of the specified endpoints were reachable
Endpoints attempted:
------------------------------------------------
endpoint=amqp-0-9://localhost:5672, attempts=1
System.Net.Sockets.SocketException (0x80004005): An invalid argument was 
supplie
d
   at System.Net.Sockets.Socket..ctor(AddressFamily addressFamily, 
SocketType so
cketType, ProtocolType protocolType)
   at System.Net.Sockets.TcpClient.initialize()
   at System.Net.Sockets.TcpClient..ctor(AddressFamily family)
   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9..ctor(AmqpTcpEndpoint 
endpoint
)
   at 
RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateFrameHandler(AmqpTc
pEndpoint endpoint)
   at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32 
maxRedirects,
IDictionary connectionAttempts, IDictionary connectionErrors, 
AmqpTcpEndpoint[]&
 mostRecentKnownHosts, AmqpTcpEndpoint endpoint)
================================================
Stack trace:
   at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects)
   at RabbitMQ.Client.ConnectionFactory.CreateConnection()
   at ServerConsole.AddServer.Main(String[] args)


On Monday, September 10, 2012 3:14:58 PM UTC-4, kayslay wrote:
>
> I have RabbitMQ running on my Windows 7 machine.  I ran it via the command 
> prompt .  I am able to verify that it is up.  When I try to connect to it 
> locally,
>    ConnectionFactory cf = new ConnectionFactory();
>             cf.Uri = "amqp://localhost"
>             using (IConnection conn = cf.CreateConnection())
>             {
> the CreateConnection call throws an exception saying
> "None of the specified endpoints were reachable" 
> I was able to verify that RabbitMQ was running by executing 
> rabbitmq-server.
> Is there something I'm missing, I'm new to RabbitMQ?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/33749854/attachment.htm>

From ymoya at uci.cu  Mon Sep 10 21:53:44 2012
From: ymoya at uci.cu (Yurisleidy =?utf-8?Q?Hern=C3=A1ndez?= Moya)
Date: Mon, 10 Sep 2012 16:53:44 -0400 (CDT)
Subject: [rabbitmq-discuss] Exchange to Exchange Bindings
In-Reply-To: <mailman.1.1347274801.24796.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <8d767b62-20c5-477b-a035-943f97facb89@ucimail1.uci.cu>

I'm testing the Exchange to Exchange Bindings extension but the queue does not receive the messages. any idea why? 
this is my code : 

ConnectionFactory factory = new ConnectionFactory(); 
factory.setHost("localhost"); 
Connection connection = factory.newConnection(); 
Channel channel = connection.createChannel(); 

channel.exchangeDeclare("ex1", "fanout"); 
channel.exchangeDeclare("ex2", "fanout"); 
channel.exchangeBind("ex1", "ex2", ""); 

channel.queueDeclare("queue", false, false, false, null); 
channel.queueBind("queue", "ex2", ""); 

String message = "msg"; 

channel.basicPublish("ex1", "", null, message.getBytes()); 
System.out.println(" [x] Sent '" + message + "'"); 

channel.close(); 
connection.close(); 

regards, 
Yuri 


10mo. ANIVERSARIO DE LA CREACION DE LA UNIVERSIDAD DE LAS CIENCIAS INFORMATICAS...
CONECTADOS AL FUTURO, CONECTADOS A LA REVOLUCION

http://www.uci.cu
http://www.facebook.com/universidad.uci
http://www.flickr.com/photos/universidad_uci
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/fd4a02fb/attachment.htm>

From matthias at rabbitmq.com  Mon Sep 10 23:41:18 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 10 Sep 2012 23:41:18 +0100
Subject: [rabbitmq-discuss] Exchange to Exchange Bindings
In-Reply-To: <8d767b62-20c5-477b-a035-943f97facb89@ucimail1.uci.cu>
References: <8d767b62-20c5-477b-a035-943f97facb89@ucimail1.uci.cu>
Message-ID: <504E6C8E.9060604@rabbitmq.com>

Yuri,

On 10/09/12 21:53, Yurisleidy Hern?ndez Moya wrote:
> I'm testing the Exchange to Exchange Bindings extension but the queue
> does not receive the messages. any idea why?
> this is my code:
>
>   ConnectionFactory factory = new ConnectionFactory();
>          factory.setHost("localhost");
>          Connection connection = factory.newConnection();
>          Channel channel = connection.createChannel();
>
>          channel.exchangeDeclare("ex1", "fanout");
>          channel.exchangeDeclare("ex2", "fanout");
>          channel.exchangeBind("ex1", "ex2", "");
>
>          channel.queueDeclare("queue", false, false, false, null);
>          channel.queueBind("queue", "ex2", "");
>
>          String message = "msg";
>
>          channel.basicPublish("ex1", "", null, message.getBytes());
>          System.out.println(" [x] Sent '" + message + "'");
>
>          channel.close();
>          connection.close();

That binding is the wrong way round. Take a careful look at the 
definition of the parameters at 
http://www.rabbitmq.com/javadoc/com/rabbitmq/client/Channel.html#exchangeBind%28java.lang.String,%20java.lang.String,%20java.lang.String%29


Regards,

matthias.


From matthias at rabbitmq.com  Tue Sep 11 00:02:39 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Sep 2012 00:02:39 +0100
Subject: [rabbitmq-discuss] None of the specified endpoints were
	reachable
In-Reply-To: <f70d5ac0-1893-4a94-96e0-de2488789967@googlegroups.com>
References: <544eb68a-0f6e-4b9f-b4f0-a3964dd6e549@googlegroups.com>
	<f70d5ac0-1893-4a94-96e0-de2488789967@googlegroups.com>
Message-ID: <504E718F.4070005@rabbitmq.com>

On 10/09/12 21:29, kayslay wrote:
> When I do that I get the following exception:
> None of the specified endpoints were reachable
> Endpoints attempted:
> ------------------------------------------------
> endpoint=amqp-0-9://localhost:5672, attempts=1
> System.Net.Sockets.SocketException (0x80004005): An invalid argument was
> supplie
> d
>     at System.Net.Sockets.Socket..ctor(AddressFamily addressFamily,
> SocketType so
> cketType, ProtocolType protocolType)
>     at System.Net.Sockets.TcpClient.initialize()
>     at System.Net.Sockets.TcpClient..ctor(AddressFamily family)
>     at RabbitMQ.Client.Impl.SocketFrameHandler_0_9..ctor(AmqpTcpEndpoint
> endpoint
> )
>     at
> RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateFrameHandler(AmqpTc
> pEndpoint endpoint)
>     at RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
> maxRedirects,
> IDictionary connectionAttempts, IDictionary connectionErrors,
> AmqpTcpEndpoint[]&
>   mostRecentKnownHosts, AmqpTcpEndpoint endpoint)
> ================================================
> Stack trace:
>     at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
> maxRedirects)
>     at RabbitMQ.Client.ConnectionFactory.CreateConnection()
>     at ServerConsole.AddServer.Main(String[] args)

Looks like it's dying at

     new TcpClient(AddressFamily.InterNetwork)

in 
http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/7fd0545a04f8/projects/client/RabbitMQ.Client/src/client/impl/SocketFrameHandler_0_9.cs#l83

which, on the surface of it, suggests that your system is unwilling to 
let the client speak IPv4. Can you think of a reason why that would be 
the case?

I suggest sticking that line into a mini program of its own, to see 
whether that fails too.


Regards,

Matthias.

From allenriddle at google.com  Mon Sep 10 22:06:18 2012
From: allenriddle at google.com (Allen Riddle)
Date: Mon, 10 Sep 2012 14:06:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Publisher confirms performance
Message-ID: <e153dc14-8c5a-4f05-89e7-2a81d6edc2a7@googlegroups.com>

I am curious what people are seeing in their production deployments of 
RabbitMQ using publisher confirms in a cluster of nodes with durable 
queues. I'm running a four core Intel Core i7 MacBook Pro, 2 GHz with 8 GB 
of memory. With local benchmarks against a cluster with 2 nodes, I'm 
synchronously publishing messages and confirming each, and it takes roughly 
46 ms on average per message. When I take away the publisher confirms 
piece, it falls down to 8 ms, and when I remove durable queues, there is a 
net zero difference. Does this behavior line up with what everyone else is 
sees? I'm curious if I have a bad setting somewhere or is publisher 
confirms really that slow. Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/caffd886/attachment.htm>

From matthias at rabbitmq.com  Tue Sep 11 00:36:20 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Sep 2012 00:36:20 +0100
Subject: [rabbitmq-discuss] Publisher confirms performance
In-Reply-To: <e153dc14-8c5a-4f05-89e7-2a81d6edc2a7@googlegroups.com>
References: <e153dc14-8c5a-4f05-89e7-2a81d6edc2a7@googlegroups.com>
Message-ID: <504E7974.7070908@rabbitmq.com>

Allen,

On 10/09/12 22:06, Allen Riddle wrote:
> I am curious what people are seeing in their production deployments
> of RabbitMQ using publisher confirms in a cluster of nodes with
> durable queues.

Do you see the same results when running your tests against a single
node instead of a cluster? I suspect so, but would be good to get
confirmation of that.

Also, I am assuming you are running a recent (2.8.x) version of rabbit, 
right?

> With local benchmarks against a cluster with 2 nodes, I'm
> synchronously publishing messages and confirming each, and it takes
> roughly 46 ms on average per message.

You are asking RabbitMQ to confirm that the message has been written to
disk. That requires an fsync. Which is very, very expensive.

You can amortise that cost by: a) dealing with confirms asynchronously,
rather than waiting for a confirmation after every publish, and b)
publishing on multiple connections/channels, as long as that is
compatible with the message ordering guarantees your app requires.

> When I take away the publisher confirms piece, it falls down to 8 ms,

Be careful what you are measuring here. If you don't wait for confirms 
then publishing is an entirely asynchronous operation, so if you are 
simply timing the duration of the 'publish' API call then you may just 
be timing how long it takes for the client API to stuff the message into 
a local buffer.

Anyway, taking away confirms means that the client won't have to wait 
for a round trip to the server, and the fsync delay there.

> and when I remove durable queues, there is a net zero difference.

Not sure what you mean here. Zero difference compared to what? Making 
the queues non-durable eliminates the need to wait for an fsync. There's 
still the roundtrip latency though.

Regards,

Matthias.

From jerryk at rbcon.com  Tue Sep 11 01:11:10 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Mon, 10 Sep 2012 17:11:10 -0700
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <CA+rsMFrRPRp29y+f2C2rfRaH0xpUONXeQfrUxqFPA0yR4CwY1Q@mail.gmail.com>
References: <CA+rsMFrRPRp29y+f2C2rfRaH0xpUONXeQfrUxqFPA0yR4CwY1Q@mail.gmail.com>
Message-ID: <CAE0Sz=xZBfCDfGGaguLXodynOkqrF=LbhzkgUYwAOAdUtRYAVg@mail.gmail.com>

You're missing the part where you create and bind the queue... :-)  See the
documentation:

http://www.rabbitmq.com/firehose.html

When you enable tracing with 'rabbitmqctl trace_on' notifications are
published to the exchange amq.rabbitmq.trace; it's the user's
responsibility to create a queue and bind it in order to receive these
messages.

Best regards,
Jerry

On Mon, Sep 10, 2012 at 7:47 AM, Theo Bot <theo.bot at proxy.nl> wrote:

> Hi
>
> I recently installed RabbitMQ 2.8.6-1 on a CentOS 6.3 box. However when I
> turn on the tracing (rabbitmqctl trace_on) the log says:
> =INFO REPORT==== 10-Sep-2012::14:57:10 ===
> Enabling tracing for vhost '/'
>
> However no tracing queue appears. Am I missing something?
>
> --
> Regards,
>
> Theo Bot
> Network Management Engineer
> Website: http://www.proxy.nl
> LinkedIn: http://www.linkedin.com/in/theobot
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/c2cb16aa/attachment.htm>

From fmeshkinpour at fonality.com  Tue Sep 11 02:49:09 2012
From: fmeshkinpour at fonality.com (Farshad Meshkinpour)
Date: Mon, 10 Sep 2012 18:49:09 -0700
Subject: [rabbitmq-discuss] user authorization to access vhost via http API
Message-ID: <CAO4q6_8d99QfLBpdMQD=zeDAyPmOKVggH5dV1_idYPFwx4mMvQ@mail.gmail.com>

Hello,

I have two users:  admin and foo.  I have three vhosts: /, /v1, /v1/v1a/.

admin has access to all three vhosts.
foo has access to /v1/v1a vhost only.

I am using http api to access the queues in vhost /v1/v1a/.  admin can
access and get info about all queues in the vhost /v1/v1a.  But foo gets
401 Unauthorized.

What additional authorization should foo have to access /v1/v1a?

Any help is greatly appreciated.

Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120910/f2984d12/attachment.htm>

From theo.bot at proxy.nl  Tue Sep 11 07:33:21 2012
From: theo.bot at proxy.nl (Theo Bot)
Date: Tue, 11 Sep 2012 08:33:21 +0200
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <CAE0Sz=xZBfCDfGGaguLXodynOkqrF=LbhzkgUYwAOAdUtRYAVg@mail.gmail.com>
References: <CA+rsMFrRPRp29y+f2C2rfRaH0xpUONXeQfrUxqFPA0yR4CwY1Q@mail.gmail.com>
	<CAE0Sz=xZBfCDfGGaguLXodynOkqrF=LbhzkgUYwAOAdUtRYAVg@mail.gmail.com>
Message-ID: <CA+rsMFr9a7jTiPtwrcfPB+XG3fm+EYMKDuSnjn-V0SUM4Rurog@mail.gmail.com>

Hey Jerry,

When I try to create the queue, i get: ACCESS_REFUSED - queue name
'amq.rabbitmq.trace' contains reserved prefix 'amq.*'

Can it be configured from the configfile?

Theo

On Tue, Sep 11, 2012 at 2:11 AM, Jerry Kuch <jerryk at rbcon.com> wrote:

> You're missing the part where you create and bind the queue... :-)  See
> the documentation:
>
> http://www.rabbitmq.com/firehose.html
>
> When you enable tracing with 'rabbitmqctl trace_on' notifications are
> published to the exchange amq.rabbitmq.trace; it's the user's
> responsibility to create a queue and bind it in order to receive these
> messages.
>
> Best regards,
> Jerry
>
> On Mon, Sep 10, 2012 at 7:47 AM, Theo Bot <theo.bot at proxy.nl> wrote:
>
>> Hi
>>
>> I recently installed RabbitMQ 2.8.6-1 on a CentOS 6.3 box. However when I
>> turn on the tracing (rabbitmqctl trace_on) the log says:
>> =INFO REPORT==== 10-Sep-2012::14:57:10 ===
>> Enabling tracing for vhost '/'
>>
>> However no tracing queue appears. Am I missing something?
>>
>> --
>> Regards,
>>
>> Theo Bot
>> Network Management Engineer
>> Website: http://www.proxy.nl
>> LinkedIn: http://www.linkedin.com/in/theobot
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Met vriendelijke groet,

Theo Bot
Network Management Engineer
Tel: +31653965698
e-mail: theo.bot at proxy.nl
Website: http://www.proxy.nl
LinkedIn: http://www.linkedin.com/in/theobot
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/e91c85d8/attachment.htm>

From matthias at rabbitmq.com  Tue Sep 11 09:58:36 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 11 Sep 2012 09:58:36 +0100
Subject: [rabbitmq-discuss] configuring tracing
In-Reply-To: <CA+rsMFr9a7jTiPtwrcfPB+XG3fm+EYMKDuSnjn-V0SUM4Rurog@mail.gmail.com>
References: <CA+rsMFrRPRp29y+f2C2rfRaH0xpUONXeQfrUxqFPA0yR4CwY1Q@mail.gmail.com>
	<CAE0Sz=xZBfCDfGGaguLXodynOkqrF=LbhzkgUYwAOAdUtRYAVg@mail.gmail.com>
	<CA+rsMFr9a7jTiPtwrcfPB+XG3fm+EYMKDuSnjn-V0SUM4Rurog@mail.gmail.com>
Message-ID: <504EFD3C.1000007@rabbitmq.com>

Theo,

On 11/09/12 07:33, Theo Bot wrote:
> When I try to create the queue, i get: ACCESS_REFUSED - queue name
> 'amq.rabbitmq.trace' contains reserved prefix 'amq.*'

Just name the queue something else.

And don't forget to bind it to the tracing exchange.

I get the impression that you are not quite up to speed yet with core 
AMQP concepts. I recommend reading our tutorials - 
http://www.rabbitmq.com/getstarted.html.

Regards,

Matthias.

From simon at rabbitmq.com  Tue Sep 11 10:44:11 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 11 Sep 2012 10:44:11 +0100
Subject: [rabbitmq-discuss] user authorization to access vhost via http
 API
In-Reply-To: <CAO4q6_8d99QfLBpdMQD=zeDAyPmOKVggH5dV1_idYPFwx4mMvQ@mail.gmail.com>
References: <CAO4q6_8d99QfLBpdMQD=zeDAyPmOKVggH5dV1_idYPFwx4mMvQ@mail.gmail.com>
Message-ID: <504F07EB.2020908@rabbitmq.com>

On 11/09/12 02:49, Farshad Meshkinpour wrote:
> Hello,

Hi.

> I have two users:  admin and foo.  I have three vhosts: /, /v1, /v1/v1a/.
>
> admin has access to all three vhosts.
> foo has access to /v1/v1a vhost only.
>
> I am using http api to access the queues in vhost /v1/v1a/.  admin can
> access and get info about all queues in the vhost /v1/v1a.  But foo gets
> 401 Unauthorized.
>
> What additional authorization should foo have to access /v1/v1a?

foo needs to have:

1) some configure / write / read permissions for the vhost "/v1/v1a" 
(sounds like you've already done this, but I just want to confirm)

2) a tag to allow access to the HTTP API at all, at least "management"
(see http://www.rabbitmq.com/management.html#permissions)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From albertaixendri at gmail.com  Tue Sep 11 10:16:44 2012
From: albertaixendri at gmail.com (Albert Aixendri)
Date: Tue, 11 Sep 2012 02:16:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Trouble with udp exchange
Message-ID: <28012e91-0c78-4723-95a7-0c007ccfa675@googlegroups.com>



Hello,


I am trying to create an udp exchange in order to receive syslog events, 
but I have some trouble.


To create the ez plugin I have cloned the source plugin from 
https://github.com/tonyg/udp-exchange and I have followed the instructions 
from plugin development page. I have got it and I have enabled it. Then 
when I try to create the udp exchange via web management but I have got the 
following error:


{error,

    {exit,

        {{function_clause,

             [{udp_exchange,endpoint_params,

                  [{exchange,

                       {resource,<<"/">>,exchange,<<"syslog">>},

                       'x-udp',true,false,false,

                       [{<<"port">>,longstr,<<"5514">>}],

                       undefined}]},

              {udp_exchange,validate,1},

              {rabbit_exchange,declare,6},

              {rabbit_channel,handle_method,3},

              {rabbit_channel,handle_cast,2},

              {gen_server2,handle_msg,2},

              {proc_lib,init_p_do_apply,3}]},

         {gen_server,call,

             [<0.364.0>,

              {call,

                  {'exchange.declare',0,<<"syslog">>,<<"x-udp">>,false,true,

                      false,false,false,

                      [{<<"port">>,longstr,<<"5514">>}]},

                  none,<0.252.0>},

              infinity]}},

        [{gen_server,call,3},

         {rabbit_mgmt_util,'-amqp_request/5-fun-0-',4},

         {rabbit_mgmt_util,with_channel,5},

         {rabbit_mgmt_util,http_to_amqp,5},

         {webmachine_resource,resource_call,3},

         {webmachine_resource,do,3},

         {webmachine_decision_core,resource_call,1},

         {webmachine_decision_core,accept_helper,0}]}}


As you can see I have specified the port argument.


Thanks in advance.


Albert.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/f4df9a95/attachment.htm>

From simon at rabbitmq.com  Tue Sep 11 11:31:54 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 11 Sep 2012 11:31:54 +0100
Subject: [rabbitmq-discuss] Trouble with udp exchange
In-Reply-To: <28012e91-0c78-4723-95a7-0c007ccfa675@googlegroups.com>
References: <28012e91-0c78-4723-95a7-0c007ccfa675@googlegroups.com>
Message-ID: <504F131A.5080301@rabbitmq.com>

On 11/09/12 10:16, Albert Aixendri wrote:
> To create the ez plugin I have cloned the source plugin from
> https://github.com/tonyg/udp-exchange and I have followed the
> instructions from plugin development page. I have got it and I have
> enabled it. Then when I try to create the udp exchange via web
> management but I have got the following error:

So I suspect that you have compiled the UDP exchange against hg default, 
but are then running it against RabbitMQ 2.8.x. The error you posted 
looks like an inconsistency in the #exchange{} record, which has indeed 
changed post-2.8.x.

So, to recompile against 2.8.x:

$ cd rabbitmq-public-umbrella
$ make clean
$ make BRANCH=rabbitmq_v2_8_x named_update
$ cd udp-exchange
$ make

Hopefully that should sort you out.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From hadas100.b at gmail.com  Tue Sep 11 12:10:49 2012
From: hadas100.b at gmail.com (Hadas)
Date: Tue, 11 Sep 2012 04:10:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Create a queue
Message-ID: <4e0f50c9-c93e-4845-afdb-32b487c2c2b8@googlegroups.com>

 Do I need to create queue manually or the RabbitMQ create it automatically?

Thanks in advance!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/01da56ae/attachment.htm>

From michael.s.klishin at gmail.com  Tue Sep 11 13:11:49 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 11 Sep 2012 16:11:49 +0400
Subject: [rabbitmq-discuss] Create a queue
In-Reply-To: <4e0f50c9-c93e-4845-afdb-32b487c2c2b8@googlegroups.com>
References: <4e0f50c9-c93e-4845-afdb-32b487c2c2b8@googlegroups.com>
Message-ID: <CAE3HoVTWkq3z2C8ojAiWpSUVF4M-=4V1u+warW-uO2toRhrgDQ@mail.gmail.com>

2012/9/11 Hadas <hadas100.b at gmail.com>

> Do I need to create queue manually or the RabbitMQ create it automatically?


Hadas,

Applications declare queues, exchanges and bindings between them.
See http://www.rabbitmq.com/tutorials/amqp-concepts.html

-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/47f6bbd0/attachment.htm>

From francesco at rabbitmq.com  Tue Sep 11 13:14:04 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 11 Sep 2012 13:14:04 +0100
Subject: [rabbitmq-discuss] Create a queue
In-Reply-To: <4e0f50c9-c93e-4845-afdb-32b487c2c2b8@googlegroups.com>
References: <4e0f50c9-c93e-4845-afdb-32b487c2c2b8@googlegroups.com>
Message-ID: <87ehm8zrhv.wl%francesco@rabbitmq.com>

At Tue, 11 Sep 2012 04:10:49 -0700 (PDT),
Hadas wrote:
>  Do I need to create queue manually or the RabbitMQ create it automatically?
> 
> Thanks in advance!

You seem confused about what RabbitMQ is, please read the tutorials:
<http://www.rabbitmq.com/getstarted.html>.

--
Francesco * Often in error, never in doubt

From michael.justin at gmx.net  Tue Sep 11 14:41:39 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 11 Sep 2012 15:41:39 +0200
Subject: [rabbitmq-discuss] AMQP message "Type" - STOMP mapping?
Message-ID: <k2nf2m$2j3$1@ger.gmane.org>

Hello,

do I understand correctly that the AMQP message property "Type" is 
supported between the C# client (RabbitMQ's .NET library) and the broker 
but the value of this property is not transported on to STOMP clients as 
a message header property?

In the Delphi/Habari STOMP client, the messages can have a property 
"JMSType" which will be transmitted as a STOMP header property ("type").

Does a workaround exist to exchange the AMQP "Type" property of a 
message with STOMP clients?

Many thanks in advance,
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From kayode81until at gmail.com  Tue Sep 11 14:52:59 2012
From: kayode81until at gmail.com (KL)
Date: Tue, 11 Sep 2012 09:52:59 -0400
Subject: [rabbitmq-discuss] None of the specified endpoints were
	reachable
In-Reply-To: <504E718F.4070005@rabbitmq.com>
References: <544eb68a-0f6e-4b9f-b4f0-a3964dd6e549@googlegroups.com>
	<f70d5ac0-1893-4a94-96e0-de2488789967@googlegroups.com>
	<504E718F.4070005@rabbitmq.com>
Message-ID: <CAMoZ-W5-Kk7U_QiRZDDFf5t+7qvDUtTcdy7ABnjAqDg7gBUG6A@mail.gmail.com>

I tried it, it looks like the Socket.OSSupportsIPv6 returns true, so it
attempts to create an IPv6 socket and that is what throws an exception.
 Any thoughts on what I can do at this point?
Thanks

On Mon, Sep 10, 2012 at 7:02 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 10/09/12 21:29, kayslay wrote:
>
>> When I do that I get the following exception:
>>
>> None of the specified endpoints were reachable
>> Endpoints attempted:
>> ------------------------------**------------------
>> endpoint=amqp-0-9://localhost:**5672, attempts=1
>> System.Net.Sockets.**SocketException (0x80004005): An invalid argument
>> was
>> supplie
>> d
>>     at System.Net.Sockets.Socket..**ctor(AddressFamily addressFamily,
>> SocketType so
>> cketType, ProtocolType protocolType)
>>     at System.Net.Sockets.TcpClient.**initialize()
>>     at System.Net.Sockets.TcpClient..**ctor(AddressFamily family)
>>     at RabbitMQ.Client.Impl.**SocketFrameHandler_0_9..ctor(**
>> AmqpTcpEndpoint
>> endpoint
>> )
>>     at
>> RabbitMQ.Client.Framing.Impl.**v0_9_1.ProtocolBase.**
>> CreateFrameHandler(AmqpTc
>> pEndpoint endpoint)
>>     at RabbitMQ.Client.**ConnectionFactory.**FollowRedirectChain(Int32
>> maxRedirects,
>> IDictionary connectionAttempts, IDictionary connectionErrors,
>> AmqpTcpEndpoint[]&
>>   mostRecentKnownHosts, AmqpTcpEndpoint endpoint)
>> ==============================**==================
>> Stack trace:
>>     at RabbitMQ.Client.**ConnectionFactory.**CreateConnection(Int32
>> maxRedirects)
>>     at RabbitMQ.Client.**ConnectionFactory.**CreateConnection()
>>     at ServerConsole.AddServer.Main(**String[] args)
>>
>
> Looks like it's dying at
>
>     new TcpClient(AddressFamily.**InterNetwork)
>
> in http://hg.rabbitmq.com/**rabbitmq-dotnet-client/file/**
> 7fd0545a04f8/projects/client/**RabbitMQ.Client/src/client/**
> impl/SocketFrameHandler_0_9.**cs#l83<http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/7fd0545a04f8/projects/client/RabbitMQ.Client/src/client/impl/SocketFrameHandler_0_9.cs#l83>
>
> which, on the surface of it, suggests that your system is unwilling to let
> the client speak IPv4. Can you think of a reason why that would be the case?
>
> I suggest sticking that line into a mini program of its own, to see
> whether that fails too.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/cb941fe0/attachment.htm>

From kayode81until at gmail.com  Tue Sep 11 14:54:22 2012
From: kayode81until at gmail.com (KL)
Date: Tue, 11 Sep 2012 09:54:22 -0400
Subject: [rabbitmq-discuss] None of the specified endpoints were
	reachable
In-Reply-To: <CAMoZ-W5-Kk7U_QiRZDDFf5t+7qvDUtTcdy7ABnjAqDg7gBUG6A@mail.gmail.com>
References: <544eb68a-0f6e-4b9f-b4f0-a3964dd6e549@googlegroups.com>
	<f70d5ac0-1893-4a94-96e0-de2488789967@googlegroups.com>
	<504E718F.4070005@rabbitmq.com>
	<CAMoZ-W5-Kk7U_QiRZDDFf5t+7qvDUtTcdy7ABnjAqDg7gBUG6A@mail.gmail.com>
Message-ID: <CAMoZ-W4DVO16DSqJ=NmFNDVS3_b42+xj=ONiSwkOCiftbYMjLQ@mail.gmail.com>

I'm sorry, that exception gets caught and it throws again trying to create
an IPV4 client, I'll check with my network admins on this.
Thanks

On Tue, Sep 11, 2012 at 9:52 AM, KL <kayode81until at gmail.com> wrote:

> I tried it, it looks like the Socket.OSSupportsIPv6 returns true, so it
> attempts to create an IPv6 socket and that is what throws an exception.
>  Any thoughts on what I can do at this point?
> Thanks
>
>
> On Mon, Sep 10, 2012 at 7:02 PM, Matthias Radestock <matthias at rabbitmq.com
> > wrote:
>
>> On 10/09/12 21:29, kayslay wrote:
>>
>>> When I do that I get the following exception:
>>>
>>> None of the specified endpoints were reachable
>>> Endpoints attempted:
>>> ------------------------------**------------------
>>> endpoint=amqp-0-9://localhost:**5672, attempts=1
>>> System.Net.Sockets.**SocketException (0x80004005): An invalid argument
>>> was
>>> supplie
>>> d
>>>     at System.Net.Sockets.Socket..**ctor(AddressFamily addressFamily,
>>> SocketType so
>>> cketType, ProtocolType protocolType)
>>>     at System.Net.Sockets.TcpClient.**initialize()
>>>     at System.Net.Sockets.TcpClient..**ctor(AddressFamily family)
>>>     at RabbitMQ.Client.Impl.**SocketFrameHandler_0_9..ctor(**
>>> AmqpTcpEndpoint
>>> endpoint
>>> )
>>>     at
>>> RabbitMQ.Client.Framing.Impl.**v0_9_1.ProtocolBase.**
>>> CreateFrameHandler(AmqpTc
>>> pEndpoint endpoint)
>>>     at RabbitMQ.Client.**ConnectionFactory.**FollowRedirectChain(Int32
>>> maxRedirects,
>>> IDictionary connectionAttempts, IDictionary connectionErrors,
>>> AmqpTcpEndpoint[]&
>>>   mostRecentKnownHosts, AmqpTcpEndpoint endpoint)
>>> ==============================**==================
>>> Stack trace:
>>>     at RabbitMQ.Client.**ConnectionFactory.**CreateConnection(Int32
>>> maxRedirects)
>>>     at RabbitMQ.Client.**ConnectionFactory.**CreateConnection()
>>>     at ServerConsole.AddServer.Main(**String[] args)
>>>
>>
>> Looks like it's dying at
>>
>>     new TcpClient(AddressFamily.**InterNetwork)
>>
>> in http://hg.rabbitmq.com/**rabbitmq-dotnet-client/file/**
>> 7fd0545a04f8/projects/client/**RabbitMQ.Client/src/client/**
>> impl/SocketFrameHandler_0_9.**cs#l83<http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/7fd0545a04f8/projects/client/RabbitMQ.Client/src/client/impl/SocketFrameHandler_0_9.cs#l83>
>>
>> which, on the surface of it, suggests that your system is unwilling to
>> let the client speak IPv4. Can you think of a reason why that would be the
>> case?
>>
>> I suggest sticking that line into a mini program of its own, to see
>> whether that fails too.
>>
>>
>> Regards,
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/df0df4ba/attachment.htm>

From francesco at rabbitmq.com  Tue Sep 11 15:17:55 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 11 Sep 2012 15:17:55 +0100
Subject: [rabbitmq-discuss] How to run RabbitMQ server as a different
	system	user?
In-Reply-To: <CC73A603.3DD2%thorton@timetrade.com>
References: <CC73A603.3DD2%thorton@timetrade.com>
Message-ID: <877gs0zlrg.wl%francesco@rabbitmq.com>

Hi Tyler,

At Mon, 10 Sep 2012 13:13:23 -0500,
Tyler Horton wrote:
> I have Rabbit 2.8.4 running on RHEL5.  The installation instructions
> (http://www.rabbitmq.com/install-rpm.html) say:
> 
> Note: The server is set up to run as system user rabbitmq. If you change the
> location of the Mnesia database or the logs, you must ensure the files are
> owned by this user (and also update the environment variables).
> 
> Is it possible to run as a user other than "rabbitmq"?  I am not interested in
> changing Mnesia at all, unless it is required to change the user.  Is
> re-installation required or can my existing install be salvaged?

I'm not familiar with centos, but you can run RabbitMQ directly using the
`rabbitmq-server' script (usually in /usr/lib/rabbitmq/bin) as any user.  You
will have to provide a writable mnesia directory and pid file via environmental
variables (`RABBITMQ_MNESIA_DIR' and `RABBITMQ_PID_FILE').

--
Francesco * Often in error, never in doubt

From jignesh.purohit at atos.net  Tue Sep 11 15:55:41 2012
From: jignesh.purohit at atos.net (Purohit, Jignesh)
Date: Tue, 11 Sep 2012 14:55:41 +0000
Subject: [rabbitmq-discuss] RabbitMQ Clustering with SSL
Message-ID: <A93D83B22B468A4BB8FF60A8EF5248E00DCC0F5F@inicxdb01>

Hi All,

We are facing problem in RabbitMQ clustering on two existing node enable for SSL. First we have set up SSL on both the nodes on SSL default port 5671 and then we have applied cluster set up with two disk nodes. After successful cluster set up we can able to see the cluster environment on management console which shows two disk nodes clustered.


1.       But after few hours While verifying it, we observed the management console doesn't appear so we checked the services and its stops on both the machines.



So we have started service of first node and then we can see the management console and it shows the second server disk node gets down. The time duration between set up and testing was hardly 1 hr. 30 mins. Node didn't went up by following command. We followed attached installation document for RabbitMQ installation. We also checked the cookies files and its correct.

rabbitmqctl start_app

rabbitmq-server -detached.

2.       To manage the cluster set up, we have created another disk node on the machine with diff name and same port (5671). The node is created successfully and shown the active status in management console. But the node working is not correct and is as follows.

1.       The messages are not transport properly on the queues generated after clustering. The queues are mirror queues. The queue status also shows "?" and when any message send to the queue, the management console is not able to open the queue detail window and the page gets hanged. It seems it goes into some loop. When we restart the RabbitMQ service, the page display properly but the queue status is same.

2.       When we shut down the first node and shift the focus on 2nd node then the messages get deleted from all the queues and not able to retrieve the messages. The queues are persistence and durable queues. When we send the message on 2nd node then the behaviours of queue is same as mentioned in #1.

3.       If any node of RabbitMQ or its service get shut down abruptly then is there any provision to send notifications to administrator? Currently this functionality is exists for other Windows services

If anybody knows how to start the shutdown node then kindly let us know.
Regards


Jignesh Purohit
Technical Architect

Mail To: jignesh.purohit at atos.net<mailto:jignesh.purohit at atos.net>



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/f36e0cf9/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 78 bytes
Desc: image001.gif
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/f36e0cf9/attachment.gif>

From francesco at rabbitmq.com  Tue Sep 11 16:04:23 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Tue, 11 Sep 2012 16:04:23 +0100
Subject: [rabbitmq-discuss] Dynamic queue problem
In-Reply-To: <CAEMO9cC6YkRhCRvqztEJVdn18P05+-q6HwDfhPZYa0TivqWi6A@mail.gmail.com>
References: <CAEMO9cCR7AZDuQ_J5yYuyYQHbROUiw41AavgyDs0jd1-X-8=zQ@mail.gmail.com>
	<878vchsqp6.wl%francesco@rabbitmq.com>
	<CAEMO9cC+we7h1jvz2hPH7XrTWezy-iwFH6suM6QzFjypYeC=eA@mail.gmail.com>
	<87627lsojr.wl%francesco@rabbitmq.com>
	<CAEMO9cC6YkRhCRvqztEJVdn18P05+-q6HwDfhPZYa0TivqWi6A@mail.gmail.com>
Message-ID: <874nn4zjm0.wl%francesco@rabbitmq.com>

At Tue, 11 Sep 2012 00:57:00 +0530,
Bhaskar teja wrote:
> 
> Thank you,
> 
> Please let me know if the following design pattern is good enough,
> 
> Producer:
>   Exchange name - "event-notifications"
>   Type - topic
>   Routing key - "mail.mobile.web.documents"
> 
> Consumer  for web notifications:
>   Exchange name - "event-notifications"
>   Type - topic
>   Routing key - "#.web.documents"
>   Queue name - "web_notifications"
> 
> Consumer  for mobile notifications:
>   Exchange name - "event-notifications"
>   Type - topic
>   Routing key - "#.mobile.#.documents"
>   Queue name - "mobile_notifications"
> 
> Consumer  for mail notifications:
>   Exchange name - "event-notifications"
>   Type - topic
>   Routing key - "mail.#.documents"
>   Queue name - "mail_notifications"
> 

That will work, but you don't need the hashes if your topic is always going to
be of the form `*.*.*.*'.

--
Francesco * Often in error, never in doubt

From ahiler at gmail.com  Tue Sep 11 16:07:49 2012
From: ahiler at gmail.com (Adam Hiler)
Date: Tue, 11 Sep 2012 08:07:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Can't receive STOMP messages in ISAPI.dll under
 IIS 6 (Delphi/Habari client)
Message-ID: <f498ff31-759e-4179-adc7-249060ae353e@googlegroups.com>

Hello,

I am having difficulty receiving messages inside my application which is an 
ISAPI dll written in Delphi.  I am not trying to use IIS for the RabbitMQ 
communication, but for other RPC purposes.

We use RemObjects for our RPC implementation.  The server side is compiled 
as an ISAPI DLL and runs under IIS (v6 and possibly v7).  My test 
environment is IIS 6 on Windows 2003 Server.  In that Delphi ISAPI dll we 
want to talk to a RabbitMQ broker for server-side work queue processing.  
Using the Habarisoft Delphi toolkit I can send messages fine, but I cannot 
receive them if the code is hosted as ISAPI under IIS.  It does not appear 
to be a normal firewall issue because I can compile the same code as a 
standalone EXE and it runs fine, sending and receiving, on the same Windows 
2003 server.  If I put a message in the queue first with the RabbitMQ HTTP 
Management Tool, then start the ISAPI server (by sending a command to it 
through its web-site, forcing the isapi dll to be loaded), I can see 
various things in the RabbitMQ console:

The connection that appears is STOMP 1.0.

 The "name" is 192.168.124.129:4298 -> 192.168.124.128:61613

I can also see that the "ready" count goes from 1 to 0 and the 
"unacknowledged" count goes from 0 to 1 and stays there.  If I stop the 
app-pool, the message will revert to ready.  Again, I can run this exact 
code and get acknowledgements and reply messages if I do not run it as an 
ISAPI dll under IIS, but still run it on the same machine.

Thanks for any help.  

Adam Hiler

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/69360664/attachment.htm>

From tetlika at gmail.com  Tue Sep 11 17:35:55 2012
From: tetlika at gmail.com (tetlika)
Date: Tue, 11 Sep 2012 09:35:55 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq cluster on amazon ec2
Message-ID: <1f39992f-9451-45cb-be40-cdc28a223e1a@h16g2000vby.googlegroups.com>

hi!

I'm planning to set up a rabbitmq cluster in amazon ec2

For nodes interconnections I use route53, and my all my nodes have
corresponding fqdns which are automatically assigned.

As far as I can see - rabbitmq works with short hostnames (like host1,
rabbit2, etc.), even if a node has a hostname like host.example.com -
it refuses to work with that.

To use a hosts file it will be like nightmare in case of node failure
and changing ip address in different hosts files.

Is there a nice workaround for that?

Thanks.

From jerryk at rbcon.com  Tue Sep 11 21:24:15 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Tue, 11 Sep 2012 13:24:15 -0700
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <CA+rsMFr9a7jTiPtwrcfPB+XG3fm+EYMKDuSnjn-V0SUM4Rurog@mail.gmail.com>
References: <CA+rsMFrRPRp29y+f2C2rfRaH0xpUONXeQfrUxqFPA0yR4CwY1Q@mail.gmail.com>
	<CAE0Sz=xZBfCDfGGaguLXodynOkqrF=LbhzkgUYwAOAdUtRYAVg@mail.gmail.com>
	<CA+rsMFr9a7jTiPtwrcfPB+XG3fm+EYMKDuSnjn-V0SUM4Rurog@mail.gmail.com>
Message-ID: <CAE0Sz=zN1YbiLhO2UPx-ZESfekSF-VMoGSDaMSXRuS3xFxxBcQ@mail.gmail.com>

Hi, Theo:

Choose a name for the queue that doesn't contain the reserved prefix, e.g.
"foobar" or "barbapapa" or something else of your choice. :-)

Best regards,
Jerry

On Mon, Sep 10, 2012 at 11:33 PM, Theo Bot <theo.bot at proxy.nl> wrote:

> Hey Jerry,
>
> When I try to create the queue, i get: ACCESS_REFUSED - queue name
> 'amq.rabbitmq.trace' contains reserved prefix 'amq.*'
>
> Can it be configured from the configfile?
>
> Theo
>
>
> On Tue, Sep 11, 2012 at 2:11 AM, Jerry Kuch <jerryk at rbcon.com> wrote:
>
>> You're missing the part where you create and bind the queue... :-)  See
>> the documentation:
>>
>> http://www.rabbitmq.com/firehose.html
>>
>> When you enable tracing with 'rabbitmqctl trace_on' notifications are
>> published to the exchange amq.rabbitmq.trace; it's the user's
>> responsibility to create a queue and bind it in order to receive these
>> messages.
>>
>> Best regards,
>> Jerry
>>
>> On Mon, Sep 10, 2012 at 7:47 AM, Theo Bot <theo.bot at proxy.nl> wrote:
>>
>>> Hi
>>>
>>> I recently installed RabbitMQ 2.8.6-1 on a CentOS 6.3 box. However when
>>> I turn on the tracing (rabbitmqctl trace_on) the log says:
>>> =INFO REPORT==== 10-Sep-2012::14:57:10 ===
>>> Enabling tracing for vhost '/'
>>>
>>> However no tracing queue appears. Am I missing something?
>>>
>>> --
>>> Regards,
>>>
>>> Theo Bot
>>> Network Management Engineer
>>> Website: http://www.proxy.nl
>>> LinkedIn: http://www.linkedin.com/in/theobot
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Met vriendelijke groet,
>
>
> Theo Bot
> Network Management Engineer
> Tel: +31653965698
> e-mail: theo.bot at proxy.nl
>
> Website: http://www.proxy.nl
> LinkedIn: http://www.linkedin.com/in/theobot
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/722abee6/attachment.htm>

From allenriddle at google.com  Tue Sep 11 21:40:20 2012
From: allenriddle at google.com (Allen Riddle)
Date: Tue, 11 Sep 2012 14:40:20 -0600
Subject: [rabbitmq-discuss] Publisher confirms performance
In-Reply-To: <504E7974.7070908@rabbitmq.com>
References: <e153dc14-8c5a-4f05-89e7-2a81d6edc2a7@googlegroups.com>
	<504E7974.7070908@rabbitmq.com>
Message-ID: <CAMCjWUtY9uQsm68J80w8saPsisa0AbE2OQDQ-2Gm6WYEzOn5yQ@mail.gmail.com>

Matthias,

Thanks for the response, I really appreciate it. I am running 2.8.x. Good
points on all the measuring too. I probably wasn't clear enough in my post,
but what I was saying was if I remove the confirms piece, and make the
queue non-durable, the speed of publishing a single message is < 1 ms. I'm
using Ruby and a rudimentary AMQP client that doesn't do any buffering.

Coupled with your explanations and a little bit of research, it sounds like
publisher confirms is only beneficial when done handled asynchronously. I
am trying to publish messages from a Ruby web server. Ruby's threading
model is very weak and uses in-process green threads. Because of this, I
was trying to avoid running any additional threads to perform the async
confirms.

It really sounds like with my implementation, I'm doing what RabbitMQ
transactions does with minor overhead because of an additional network
call. I don't think I had a great enough understanding of confirms when I
started this, it sounds like it's only beneficial over transactions if you
can receive the confirms asynchronously. Is that true? Thanks again for
your help.

On Mon, Sep 10, 2012 at 5:36 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Allen,
>
>
> On 10/09/12 22:06, Allen Riddle wrote:
>
>> I am curious what people are seeing in their production deployments
>> of RabbitMQ using publisher confirms in a cluster of nodes with
>> durable queues.
>>
>
> Do you see the same results when running your tests against a single
> node instead of a cluster? I suspect so, but would be good to get
> confirmation of that.
>
> Also, I am assuming you are running a recent (2.8.x) version of rabbit,
> right?
>
>
>  With local benchmarks against a cluster with 2 nodes, I'm
>> synchronously publishing messages and confirming each, and it takes
>> roughly 46 ms on average per message.
>>
>
> You are asking RabbitMQ to confirm that the message has been written to
> disk. That requires an fsync. Which is very, very expensive.
>
> You can amortise that cost by: a) dealing with confirms asynchronously,
> rather than waiting for a confirmation after every publish, and b)
> publishing on multiple connections/channels, as long as that is
> compatible with the message ordering guarantees your app requires.
>
>
>  When I take away the publisher confirms piece, it falls down to 8 ms,
>>
>
> Be careful what you are measuring here. If you don't wait for confirms
> then publishing is an entirely asynchronous operation, so if you are simply
> timing the duration of the 'publish' API call then you may just be timing
> how long it takes for the client API to stuff the message into a local
> buffer.
>
> Anyway, taking away confirms means that the client won't have to wait for
> a round trip to the server, and the fsync delay there.
>
>
>  and when I remove durable queues, there is a net zero difference.
>>
>
> Not sure what you mean here. Zero difference compared to what? Making the
> queues non-durable eliminates the need to wait for an fsync. There's still
> the roundtrip latency though.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/4a8144b6/attachment.htm>

From theo.bot at proxy.nl  Wed Sep 12 07:35:35 2012
From: theo.bot at proxy.nl (Theo Bot)
Date: Wed, 12 Sep 2012 08:35:35 +0200
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <CAE0Sz=zN1YbiLhO2UPx-ZESfekSF-VMoGSDaMSXRuS3xFxxBcQ@mail.gmail.com>
References: <CA+rsMFrRPRp29y+f2C2rfRaH0xpUONXeQfrUxqFPA0yR4CwY1Q@mail.gmail.com>
	<CAE0Sz=xZBfCDfGGaguLXodynOkqrF=LbhzkgUYwAOAdUtRYAVg@mail.gmail.com>
	<CA+rsMFr9a7jTiPtwrcfPB+XG3fm+EYMKDuSnjn-V0SUM4Rurog@mail.gmail.com>
	<CAE0Sz=zN1YbiLhO2UPx-ZESfekSF-VMoGSDaMSXRuS3xFxxBcQ@mail.gmail.com>
Message-ID: <CA+rsMFpnrRtgs60XZtvk7zbhi7FStZoHHomOHW+_r1b1rGQGWg@mail.gmail.com>

Jerry

I installed the tracer plugin. Worked right away.

Thanks

Theo

On Tue, Sep 11, 2012 at 10:24 PM, Jerry Kuch <jerryk at rbcon.com> wrote:

> Hi, Theo:
>
> Choose a name for the queue that doesn't contain the reserved prefix, e.g.
> "foobar" or "barbapapa" or something else of your choice. :-)
>
> Best regards,
> Jerry
>
>
> On Mon, Sep 10, 2012 at 11:33 PM, Theo Bot <theo.bot at proxy.nl> wrote:
>
>> Hey Jerry,
>>
>> When I try to create the queue, i get: ACCESS_REFUSED - queue name
>> 'amq.rabbitmq.trace' contains reserved prefix 'amq.*'
>>
>> Can it be configured from the configfile?
>>
>> Theo
>>
>>
>> On Tue, Sep 11, 2012 at 2:11 AM, Jerry Kuch <jerryk at rbcon.com> wrote:
>>
>>> You're missing the part where you create and bind the queue... :-)  See
>>> the documentation:
>>>
>>> http://www.rabbitmq.com/firehose.html
>>>
>>> When you enable tracing with 'rabbitmqctl trace_on' notifications are
>>> published to the exchange amq.rabbitmq.trace; it's the user's
>>> responsibility to create a queue and bind it in order to receive these
>>> messages.
>>>
>>> Best regards,
>>> Jerry
>>>
>>> On Mon, Sep 10, 2012 at 7:47 AM, Theo Bot <theo.bot at proxy.nl> wrote:
>>>
>>>> Hi
>>>>
>>>> I recently installed RabbitMQ 2.8.6-1 on a CentOS 6.3 box. However when
>>>> I turn on the tracing (rabbitmqctl trace_on) the log says:
>>>> =INFO REPORT==== 10-Sep-2012::14:57:10 ===
>>>> Enabling tracing for vhost '/'
>>>>
>>>> However no tracing queue appears. Am I missing something?
>>>>
>>>> --
>>>> Regards,
>>>>
>>>> Theo Bot
>>>> Network Management Engineer
>>>> Website: http://www.proxy.nl
>>>> LinkedIn: http://www.linkedin.com/in/theobot
>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>>
>> --
>> Met vriendelijke groet,
>>
>>
>> Theo Bot
>> Network Management Engineer
>> Tel: +31653965698
>> e-mail: theo.bot at proxy.nl
>>
>> Website: http://www.proxy.nl
>> LinkedIn: http://www.linkedin.com/in/theobot
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Met vriendelijke groet,

Theo Bot
Network Management Engineer
Tel: +31653965698
e-mail: theo.bot at proxy.nl
Website: http://www.proxy.nl
LinkedIn: http://www.linkedin.com/in/theobot
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120912/644dd11c/attachment.htm>

From francesco at rabbitmq.com  Wed Sep 12 08:13:13 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 12 Sep 2012 08:13:13 +0100
Subject: [rabbitmq-discuss] Create a queue
In-Reply-To: <CAC_NAZnuCYnvdfkxWSfmPOWsrsGKaYyZxri1x+eAvW9uUmLzQw@mail.gmail.com>
References: <4e0f50c9-c93e-4845-afdb-32b487c2c2b8@googlegroups.com>
	<87ehm8zrhv.wl%francesco@rabbitmq.com>
	<CAC_NAZnuCYnvdfkxWSfmPOWsrsGKaYyZxri1x+eAvW9uUmLzQw@mail.gmail.com>
Message-ID: <87ligfiuie.wl%francesco@rabbitmq.com>

Hi, please keep the mailing list in.

At Wed, 12 Sep 2012 10:08:39 +0300,
Hadas wrote:
> I see in the sample :?channel.queue_declare(queue='hello'),
> but I dont want to treate my queue in the code.
> I want to declare the queue once in the beginning and send to message it with
> enpoint in the config.

You can easily do that via the management plugin, and then use the already
declare queue in your code.

--
Francesco * Often in error, never in doubt

From bruno at chalopin.fr  Wed Sep 12 07:29:41 2012
From: bruno at chalopin.fr (Bruno CHALOPIN)
Date: Tue, 11 Sep 2012 23:29:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Windows clean reinstall
In-Reply-To: <b3c88a47-4ba9-4a21-aebb-87bb9ffeb779@googlegroups.com>
References: <b3c88a47-4ba9-4a21-aebb-87bb9ffeb779@googlegroups.com>
Message-ID: <6919b21b-a83b-4446-af03-c5a3de3023f2@googlegroups.com>

Hi,

Search in your c:\users\Admin folder (local admin or domain admin), you'll 
see the .erlang.cookie file. Then in AppData\Roaming there's a RAbbitMQ 
folder containings the logs, the mnesia database and the enable_plugins 
file. Delete all these between a stop/start of the service and you should 
be fine (make backup before for more security ;-) ).

Regards

Bruno

Le jeudi 6 septembre 2012 23:16:16 UTC+2, Phil S a ?crit :
>
> I am attempting a clean reinstall of rabbitmq in my test environment: 
> windows 2008, rabbitmq installed as a service. Uninstall and install both 
> succeed but on starting back up my old users, plugins and queues are still 
> active. I suppose there is a proper way to do a clean reinstall but I can't 
> find it documented. Any ideas?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120911/df990123/attachment.htm>

From emile at rabbitmq.com  Wed Sep 12 10:17:14 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 12 Sep 2012 10:17:14 +0100
Subject: [rabbitmq-discuss] rabbitmq cluster on amazon ec2
In-Reply-To: <1f39992f-9451-45cb-be40-cdc28a223e1a@h16g2000vby.googlegroups.com>
References: <1f39992f-9451-45cb-be40-cdc28a223e1a@h16g2000vby.googlegroups.com>
Message-ID: <5050531A.9070900@rabbitmq.com>


Hi,

On 11/09/12 17:35, tetlika wrote:
> As far as I can see - rabbitmq works with short hostnames (like host1,
> rabbit2, etc.), even if a node has a hostname like host.example.com -
> it refuses to work with that.

First make sure you really need clustering. Unless all hosts are in the
same zone federation might be a better option. See
http://www.rabbitmq.com/distributed.html
for a discussion.

If you control DNS and all hosts are in the same domain then configuring
a default search domain should be sufficient. That will have a similar
effect to placing entries  in the /etc/hosts files for each node.

If the conditions for that solution are not met then you could manually
change all the instances of "-sname" to "-name" in the broker startup
scripts. Unfortunately the default release of rabbitmq-server does not
offer this as a configuration option and this configuration has not
received much testing. If you do select this option then we would
appreciate your feedback.


-Emile


From emile at rabbitmq.com  Wed Sep 12 10:49:49 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 12 Sep 2012 10:49:49 +0100
Subject: [rabbitmq-discuss] Can't receive STOMP messages in ISAPI.dll
 under IIS 6 (Delphi/Habari client)
In-Reply-To: <f498ff31-759e-4179-adc7-249060ae353e@googlegroups.com>
References: <f498ff31-759e-4179-adc7-249060ae353e@googlegroups.com>
Message-ID: <50505ABD.9070907@rabbitmq.com>

Hi Adam,

On 11/09/12 16:07, Adam Hiler wrote:
> I am having difficulty receiving messages inside my application which is
> an ISAPI dll written in Delphi.  I am not trying to use IIS for the
> RabbitMQ communication, but for other RPC purposes.

I am informed by Michael Justin (the library author) that his analysis
of the issue is in progress, and I assume he will be in contact with you.


-Emile


From hadas100.b at gmail.com  Wed Sep 12 12:19:12 2012
From: hadas100.b at gmail.com (Hadas)
Date: Wed, 12 Sep 2012 11:19:12 +0000 (UTC)
Subject: [rabbitmq-discuss] binding exchange to client and server in wcf,
	but it auto generate new queue on rabbitmq server, why?
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>	<3a5f03340907291200j40f91712ne6fe28aa3ce5191f@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD8FA14BFAE8@EXMBX01.wealthcraft.local>
	<4A785F38.3000804@lshift.net>
Message-ID: <loom.20120912T131333-428@post.gmane.org>

I succeeded to send message to the durable queue I created.
but my wcf don't listen to the queues.

what should I do to fix it?




From emile at rabbitmq.com  Wed Sep 12 13:22:04 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 12 Sep 2012 13:22:04 +0100
Subject: [rabbitmq-discuss] binding exchange to client and server in wcf,
 but it auto generate new queue on rabbitmq server, why?
In-Reply-To: <loom.20120912T131333-428@post.gmane.org>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>	<3a5f03340907291200j40f91712ne6fe28aa3ce5191f@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD8FA14BFAE8@EXMBX01.wealthcraft.local>
	<4A785F38.3000804@lshift.net>
	<loom.20120912T131333-428@post.gmane.org>
Message-ID: <50507E6C.2050106@rabbitmq.com>


Hi,

On 12/09/12 12:19, Hadas wrote:
> binding exchange to client and server in wcf, but it auto generate new queue on rabbitmq server, why?

Client queues are transient, therefore auto-generated.

> I succeeded to send message to the durable queue I created.
> but my wcf don't listen to the queues.
> 
> what should I do to fix it?

You have not provided sufficient information to diagnose the problem.

You should check that you are able to run the WCF examples included with
the project. That will validate your environment. If that works then
please explain what you mean by "wcf don't listen to the queues".


-Emile


From hadas100.b at gmail.com  Wed Sep 12 13:33:09 2012
From: hadas100.b at gmail.com (Hadas)
Date: Wed, 12 Sep 2012 15:33:09 +0300
Subject: [rabbitmq-discuss] binding exchange to client and server in wcf,
 but it auto generate new queue on rabbitmq server, why?
In-Reply-To: <50507E6C.2050106@rabbitmq.com>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
	<3a5f03340907291200j40f91712ne6fe28aa3ce5191f@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD8FA14BFAE8@EXMBX01.wealthcraft.local>
	<4A785F38.3000804@lshift.net>
	<loom.20120912T131333-428@post.gmane.org>
	<50507E6C.2050106@rabbitmq.com>
Message-ID: <CAC_NAZk7OmJxpuYR3ZuZO7--aS2dryqLcpJ9K_hRVwgA+5wqAg@mail.gmail.com>

Thanks for respones!

I use msmq for send and recive  message message.
In the WCF's config I have enpoint for the msmq queue. when message arrives
to the queue ,WCF recive it and run code.

now I want to use the RabbitMQ. the sending to queue works fine, but my
changes in the config in order to use RabbitMQ don't work.
my config now:
(I add the bindingExtensions and binding for RabbitMQ)

  <endpoint name="Queue" address="soap.amqp://amq.direct/Queue"
binding="rabbitMQBinding" bindingConfiguration="rabbitMQConfig"
contract="IMessageSender">


this is the queue's bindings
   From             |Routing key            | Arguments
amq.direct<http://localhost:55672/#/exchanges/%2F/amq.direct>
      | /ParseTemplateQueue   |
(AMQP default) <http://localhost:55672/#/exchanges/%2F/amq.default>  |
ParseTemplateQueue
   |
Any help?

2012/9/12 Emile Joubert <emile at rabbitmq.com>

>
> Hi,
>
> On 12/09/12 12:19, Hadas wrote:
> > binding exchange to client and server in wcf, but it auto generate new
> queue on rabbitmq server, why?
>
> Client queues are transient, therefore auto-generated.
>
> > I succeeded to send message to the durable queue I created.
> > but my wcf don't listen to the queues.
> >
> > what should I do to fix it?
>
> You have not provided sufficient information to diagnose the problem.
>
> You should check that you are able to run the WCF examples included with
> the project. That will validate your environment. If that works then
> please explain what you mean by "wcf don't listen to the queues".
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120912/dd9068d7/attachment.htm>

From tetlika at gmail.com  Wed Sep 12 15:02:13 2012
From: tetlika at gmail.com (Vladimir)
Date: Wed, 12 Sep 2012 17:02:13 +0300
Subject: [rabbitmq-discuss] rabbitma and fqdn
Message-ID: <CACYV5xywC711HePgsXLcKpyKj30jvdSyvnxt55BEHZ-bzMU2VA@mail.gmail.com>

hi!

I'm trying to make rabbitmq to work with fqdn on amazon ec2

so I'd change "sname" for "name" in rabbitmq scripts to make the rabbit
work with fqdn (in scripts rabbitmq-server and rabbitmqctl)

than I'm setting up:

 export HOSTNAME="cachequeuesrv2.staging.ninternal.com"


starting rabbitmq and it fails sayin':

ERROR: epmd error for host "cachequeuesrv2": nxdomain (non-existing domain)

so why it says  ""cachequeuesrv2": nxdomain (non-existing domain)",
while HOSTNAME="cachequeuesrv2.staging.ninternal.com" ?

thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120912/6519c317/attachment.htm>

From simon at rabbitmq.com  Wed Sep 12 15:24:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 12 Sep 2012 15:24:19 +0100
Subject: [rabbitmq-discuss] AMQP message "Type" - STOMP mapping?
In-Reply-To: <k2nf2m$2j3$1@ger.gmane.org>
References: <k2nf2m$2j3$1@ger.gmane.org>
Message-ID: <50509B13.4020909@rabbitmq.com>

On 11/09/12 14:41, Michael Justin wrote:
> do I understand correctly that the AMQP message property "Type" is
> supported between the C# client (RabbitMQ's .NET library) and the broker
> but the value of this property is not transported on to STOMP clients as
> a message header property?

Yes.

> In the Delphi/Habari STOMP client, the messages can have a property
> "JMSType" which will be transmitted as a STOMP header property ("type").
>
> Does a workaround exist to exchange the AMQP "Type" property of a
> message with STOMP clients?

I'm not sure there is one, other than to say "use 'content-type' 
instead". Which may not be exactly what you wanted to hear.

For reasons lost in the mists of time our STOMP adapter ignores:

* expiration
* timestamp
* type
* user-id
* app-id

I'm not sure there's any reason not just to add support for these, so 
you could hold out for a future release.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tetlika at gmail.com  Wed Sep 12 15:38:49 2012
From: tetlika at gmail.com (Vladimir)
Date: Wed, 12 Sep 2012 17:38:49 +0300
Subject: [rabbitmq-discuss] rabbitma and fqdn
In-Reply-To: <CACYV5xywC711HePgsXLcKpyKj30jvdSyvnxt55BEHZ-bzMU2VA@mail.gmail.com>
References: <CACYV5xywC711HePgsXLcKpyKj30jvdSyvnxt55BEHZ-bzMU2VA@mail.gmail.com>
Message-ID: <CACYV5xwHudroR+YpGwLR9L9Tbt9GpfcB1nvkkEMJX3w7V-zeSQ@mail.gmail.com>

fixed after

 export RABBITMQ_NODENAME="rabbit at CACHEQUEUESRV2.staging.ninternal.com"


2012/9/12 Vladimir <tetlika at gmail.com>

> hi!
>
> I'm trying to make rabbitmq to work with fqdn on amazon ec2
>
> so I'd change "sname" for "name" in rabbitmq scripts to make the rabbit
> work with fqdn (in scripts rabbitmq-server and rabbitmqctl)
>
> than I'm setting up:
>
>  export HOSTNAME="cachequeuesrv2.staging.ninternal.com"
>
>
> starting rabbitmq and it fails sayin':
>
> ERROR: epmd error for host "cachequeuesrv2": nxdomain (non-existing domain)
>
> so why it says  ""cachequeuesrv2": nxdomain (non-existing domain)",
> while HOSTNAME="cachequeuesrv2.staging.ninternal.com" ?
>
> thanks
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120912/305b1469/attachment.htm>

From matthias at rabbitmq.com  Wed Sep 12 15:45:50 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 12 Sep 2012 15:45:50 +0100
Subject: [rabbitmq-discuss] Publisher confirms performance
In-Reply-To: <CAMCjWUtY9uQsm68J80w8saPsisa0AbE2OQDQ-2Gm6WYEzOn5yQ@mail.gmail.com>
References: <e153dc14-8c5a-4f05-89e7-2a81d6edc2a7@googlegroups.com>
	<504E7974.7070908@rabbitmq.com>
	<CAMCjWUtY9uQsm68J80w8saPsisa0AbE2OQDQ-2Gm6WYEzOn5yQ@mail.gmail.com>
Message-ID: <5050A01E.9000404@rabbitmq.com>

Allen,

On 11/09/12 21:40, Allen Riddle wrote:
> I'm using Ruby and a rudimentary AMQP client that doesn't do any
> buffering.

There is always buffering, e.g. in the OS network layer.

> I don't think I had a great enough understanding of confirms when I
> started this, it sounds like it's only beneficial over transactions
> if you can receive the confirms asynchronously. Is that true?

There is no difference between publishing a bunch of messages and then

a) waiting until all have been confirmed, or

b) issuing a tx.commit and waiting for the commit-ok


Regards,

Matthias.

From curylod at asme.org  Wed Sep 12 20:37:34 2012
From: curylod at asme.org (Dave Curylo)
Date: Wed, 12 Sep 2012 15:37:34 -0400
Subject: [rabbitmq-discuss] Binding to topic exchange with a negation
	wildcard
Message-ID: <CAAqmy6OzvP0h-manYSxS1WYck0bm2LnMZAd9=T7K6pYKU2r6uw@mail.gmail.com>

I am publishing messages to a topic exchange on about 50 different topics.
 Most consumers will want all these topics except for a very few.  Is it
possible to bind a queue to a topic exchange with a condition that the
topic does NOT match a certain wildcard?

For example, I'm publishing on
a.b.c.1
a.b.c.2
a.b.c.3
a.b.c.4
a.b.c.5

It would be nice if we could bind with something like this:
a.b.c.#!3 // match topics starting with a.b.c and anything other 3

And that would give messages on all topics except a.b.c.3:
a.b.c.1
a.b.c.2
a.b.c.4
a.b.c.5

Possible?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120912/92710410/attachment.htm>

From matt at crocodoc.com  Wed Sep 12 21:43:14 2012
From: matt at crocodoc.com (Matt Long)
Date: Wed, 12 Sep 2012 13:43:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster nodes stop/start order can lead to
	failures
Message-ID: <4e96ad11-4d71-4858-8faa-9323e5a6b8e2@googlegroups.com>

Say I have node1 and node2 both running as disc nodes in a cluster (there 
are no other nodes in the cluster). If I stop rabbitmq-server on node1 and 
then stop rabbitmq-server on node2, I'm unable to then start 
rabbitmq-server again on node1...in particular, the start command hangs for 
~35 seconds before showing FAILED...

Is this the expected behavior? Note that starting node2 after having 
stopped node1 and then node2 works fine; I'm assuming because node2 was 
aware that node1 had went offline prior to its stopping.

The relevant bit from the startup_log on node1 is :
BOOT FAILED
===========

Timeout contacting cluster nodes: ['rabbit at node2'].

Here's all the details:

*node1*$ sudo service rabbitmq-server stop
Stopping rabbitmq-server: rabbitmq-server.

*node2*$ sudo service rabbitmq-server stop
Stopping rabbitmq-server: rabbitmq-server.

*node1*$ sudo service rabbitmq-server start
Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
_err}
rabbitmq-server.

Contents of startup_err:

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) 
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})

Tail end of startup_log:

-- rabbit boot start
starting file handle cache server                                     
...done
starting worker pool                                                 
 ...done
starting database                                                     ...

BOOT FAILED
===========

Timeout contacting cluster nodes: ['rabbit at node2'].

DIAGNOSTICS
===========

nodes in question: ['rabbit at node2']

hosts, their running nodes and ports:
- node2: []

current node details:
- node name: 'rabbit at node1'
- home dir: /var/lib/rabbitmq
- cookie hash: xxxredactedxxxxxxxxxxx==


{"Kernel pid 
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120912/c1c5d73b/attachment.htm>

From mpietrek at skytap.com  Wed Sep 12 23:57:27 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 12 Sep 2012 15:57:27 -0700
Subject: [rabbitmq-discuss] Unintended message flow using federation?
Message-ID: <CACLE7iwzJ7Vt8HxzuLkK6vcfzM8hiNw1yUKsgEDX+t7qD-qigg@mail.gmail.com>

I'm using federation with a topic exchange between two RabbitMQ nodes. As
part of this, I've defined an exchange, 'skytap' which is a topic exchange
(yes, I know it's not *really* a topic exchange).

The upstream sets for the skytap exchange are pointed to each other, as
described in the Federation doc as a "Pair of federated exchanges". For
routing keys, I'm using something of the form "foo.XXX", where XXX is
either 'east' or 'west'.

On server 'A', I have a queue 'foo' bound to the skytap exchange, using a
routing key of 'foo.west'. On server 'B', I have a queue 'foo' bound to the
skytap exchange, using a routing key of 'foo.east'.

This all generally works as expected. In particular, I have a client app
running on server 'A' that publishes using the 'foo.west' routing key. In
other words, everything should be happening locally to server 'A'.

However, via the Management Web UI, I'm noticing that there seems to be
message traffic to server 'B'. In particular, on the Exchanges tab for
server 'B' if I select the 'skytap' exchange, I see:

Channel                                  | publish  | confirm
<rabbit at xxx.3.299.0> (1)       | 20/s      | 20/s

However (as I'd expect), no messages go into the 'foo' queue (or any other
queue) on server 'B'. Likewise, on the queue tab of server 'A', the queue
named "skytap -> rabbit at serverA.blah.blah", shows incoming/deliver/ack
rates of 20/s as well.

This runs counter to what I'd expect from reading the Federation doc,
specifically: "Therefore the federated exchange only receives messages for
which it has a subscription."

Am I misunderstanding something, or perhaps don't have things configured
optimally?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120912/6d73180e/attachment.htm>

From mpietrek at skytap.com  Thu Sep 13 00:51:09 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 12 Sep 2012 16:51:09 -0700
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
Message-ID: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>

I'm experience a problem where "rabbitmqctl stop" takes a very long time
(5+ minutes, or never) shuts down.

This is RabbitMQ 2.8.6 and Erlang R15B01 on Ubuntu 10.04.

The broker is running with the Federation plug-in in use, FWIW.

The last little bits of console output are:

--------
Mnesia(rabbit at mq1): write performed by {tid,307,<0.151.0>} on record:
    {rabbit_durable_route,
            {binding,
                {resource,<<"/">>,exchange,<<"skytap">>},
                <<"cmcmd.us-west.default">>,
                {resource,<<"/">>,queue,<<"cmcmd">>},
                []},
            const}
Mnesia(rabbit at mq1): Transaction log dump initiated by time_threshold:
{needs_dump,40}
Mnesia(rabbit at mq1): delete_object performed by {dirty,<0.237.0>} on record:
    {rabbit_listener,rabbit at mq1,amqp,"mq1.blah.com",
                         {0,0,0,0},
                         5672}
Mnesia(rabbit at mq1): Transaction log dump initiated by time_threshold:
already_dumped
Mnesia(rabbit at mq1): Transaction log dump initiated by time_threshold:
already_dumped
Mnesia(rabbit at mq1): Transaction log dump initiated by time_threshold:
already_dumped
--------

The rabbit at mq1.log file:

-------
=INFO REPORT==== 12-Sep-2012::16:38:14 ===
Stopping Rabbit

=INFO REPORT==== 12-Sep-2012::16:38:14 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent

=INFO REPORT==== 12-Sep-2012::16:38:14 ===
    application: rabbitmq_federation
    exited: stopped
    type: permanent

=INFO REPORT==== 12-Sep-2012::16:38:14 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=INFO REPORT==== 12-Sep-2012::16:38:14 ===
stopped TCP Listener on 0.0.0.0:5672

=WARNING REPORT==== 12-Sep-2012::16:38:14 ===
Connection (<0.299.0>) closing: internal error in channel (<0.306.0>):
shutdown
-------

And the rabbitm at mq1-sasl log:

--------
=SUPERVISOR REPORT==== 12-Sep-2012::16:38:14 ===
     Supervisor: {<0.304.0>,amqp_channel_sup}
     Context:    child_terminated
     Reason:     shutdown
     Offender:   [{pid,<0.306.0>},
                  {name,channel},
                  {mfa,{amqp_channel,start_link,
                                     [direct,<0.299.0>,1,<0.305.0>,
                                      #Fun<amqp_channel_sup.0.24953263>]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 12-Sep-2012::16:38:14 ===
     Supervisor: {<0.304.0>,amqp_channel_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.306.0>},
                  {name,channel},
                  {mfa,{amqp_channel,start_link,
                                     [direct,<0.299.0>,1,<0.305.0>,
                                      #Fun<amqp_channel_sup.0.24953263>]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]
--------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120912/2590ecda/attachment.htm>

From mpietrek at skytap.com  Thu Sep 13 01:00:32 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 12 Sep 2012 17:00:32 -0700
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
Message-ID: <CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>

Hold on, there's more output that appeared after I sent the original email.
This instance took 14 minutes to shut down.

The additional rabbit at mq1-sasl.log file looks like this:

=CRASH REPORT==== 12-Sep-2012::16:51:56 ===
  crasher:
    initial call: amqp_main_reader:init/1
    pid: <0.316.0>
    registered_name: []
    exception exit: {socket_error,etimedout}
      in function  gen_server:terminate/6 (gen_server.erl, line 747)
    ancestors: [<0.314.0>,<0.310.0>,amqp_sup,<0.245.0>]
    messages: []
    links: [<0.314.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 2142252
  neighbours:

=CRASH REPORT==== 12-Sep-2012::16:51:56 ===
  crasher:
    initial call: amqp_gen_connection:init/1
    pid: <0.311.0>
    registered_name: []
    exception exit: {socket_error,etimedout}
      in function  gen_server:terminate/6 (gen_server.erl, line 747)
    ancestors: [<0.310.0>,amqp_sup,<0.245.0>]
    messages: []
    links: [<0.310.0>,#Port<0.5488>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 805
  neighbours:

=SUPERVISOR REPORT==== 12-Sep-2012::16:51:56 ===
     Supervisor: {<0.314.0>,amqp_connection_type_sup}
     Context:    child_terminated
     Reason:     {socket_error,etimedout}
     Offender:   [{pid,<0.316.0>},
                  {name,main_reader},
                  {mfa,
                      {amqp_main_reader,start_link,
                          [#Port<0.5488>,<0.311.0>,<0.313.0>,
                           {method,rabbit_framing_amqp_0_9_1}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 12-Sep-2012::16:51:56 ===
     Supervisor: {<0.314.0>,amqp_connection_type_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.316.0>},
                  {name,main_reader},
                  {mfa,
                      {amqp_main_reader,start_link,
                          [#Port<0.5488>,<0.311.0>,<0.313.0>,
                           {method,rabbit_framing_amqp_0_9_1}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 12-Sep-2012::16:51:56 ===
     Supervisor: {<0.310.0>,amqp_connection_sup}
     Context:    child_terminated
     Reason:     {socket_error,etimedout}
     Offender:   [{pid,<0.311.0>},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params_network,<<"guest">>,<<"guest">>,
                               <<"/">>,"slg1matt1.mgmt.xyz.com",
                               5672,0,0,0,infinity,none,
                               [#Fun<amqp_auth_mechanisms.plain.3>,
                                #Fun<amqp_auth_mechanisms.amqplain.3>],
                               [],[]},
                           #Fun<amqp_connection_sup.0.39273983>,
                           #Fun<amqp_connection_sup.2.54430129>,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 12-Sep-2012::16:51:56 ===
     Supervisor: {<0.310.0>,amqp_connection_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.311.0>},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params_network,<<"guest">>,<<"guest">>,
                               <<"/">>,"slg1matt1.mgmt.xyz.com",
                               5672,0,0,0,infinity,none,
                               [#Fun<amqp_auth_mechanisms.plain.3>,
                                #Fun<amqp_auth_mechanisms.amqplain.3>],
                               [],[]},
                           #Fun<amqp_connection_sup.0.39273983>,
                           #Fun<amqp_connection_sup.2.54430129>,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 12-Sep-2012::16:51:56 ===
     Supervisor: {<0.310.0>,amqp_connection_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.314.0>},
                  {name,connection_type_sup},
                  {mfa,
                      {amqp_connection_type_sup,start_link_network,
                          [#Port<0.5488>,<0.311.0>,<0.313.0>]}},
                  {restart_type,transient},
                  {shutdown,infinity},
                  {child_type,supervisor}]


=CRASH REPORT==== 12-Sep-2012::16:51:56 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.200.0>
    registered_name: []
    exception exit: {undef,
                     [{rabbit_federation_old_status,report,
                       [{upstream,
                         {amqp_params_network,<<"guest">>,<<"guest">>,
                          <<"/">>,"slg1matt1.mgmt.xyz.com",5672,0,
                          0,0,infinity,none,
                          [#Fun<amqp_auth_mechanisms.plain.3>,
                           #Fun<amqp_auth_mechanisms.amqplain.3>],
                          [],[]},

<<"skytap">>,1000,1,1,none,none,none,"upstream-slg"},
                        {resource,<<"/">>,exchange,<<"skytap">>},
                        {shutdown,
                         {gen_server,call,
                          [<0.319.0>,
                           {call,
                            {'exchange.unbind',0,
                             <<"federation: skytap ->
rabbit at mq1.matt.internal.xyz.com B">>,
                             <<"skytap">>,

<<"ConfigurationManager.us-east.default">>,false,
                             []},
                            none,<0.200.0>},
                           infinity]}}],
                       []},
                      {rabbit_federation_link,terminate,2,[]},
                      {gen_server2,terminate,3,[]},
                      {proc_lib,init_p_do_apply,3,
                       [{file,"proc_lib.erl"},{line,227}]}]}
      in function  gen_server2:terminate/3
    ancestors: [<0.199.0>,<0.196.0>,rabbit_federation_link_sup_sup,
                  rabbit_federation_sup,rabbit_sup,<0.145.0>]
    messages: [{'$gen_cast',
                      {enqueue,23,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},

<<"ConfigurationManager.us-west.default">>,
                                   {resource,<<"/">>,queue,
                                       <<"ConfigurationManager">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,24,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},

<<"ConfigurationManager.us-west.default">>,
                                   {resource,<<"/">>,exchange,
                                       <<"federation: skytap ->
rabbit at slg1matt1.mgmt.xyz.com B">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,25,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"charon.us-east.default">>,
                                   {resource,<<"/">>,exchange,
                                       <<"federation: skytap ->
rabbit at slg1matt1.mgmt.xyz.com B">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,26,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"charon.us-west.default">>,
                                   {resource,<<"/">>,queue,<<"charon">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,27,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"charon.us-west.default">>,
                                   {resource,<<"/">>,exchange,
                                       <<"federation: skytap ->
rabbit at slg1matt1.mgmt.xyz.com B">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,28,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"cmcmd.us-east.default">>,
                                   {resource,<<"/">>,exchange,
                                       <<"federation: skytap ->
rabbit at slg1matt1.mgmt.xyz.com B">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,29,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"cmcmd.us-west.default">>,
                                   {resource,<<"/">>,queue,<<"cmcmd">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,30,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"cmcmd.us-west.default">>,
                                   {resource,<<"/">>,exchange,
                                       <<"federation: skytap ->
rabbit at slg1matt1.mgmt.xyz.com B">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,31,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"system_test.us-east.default">>,
                                   {resource,<<"/">>,exchange,
                                       <<"federation: skytap ->
rabbit at slg1matt1.mgmt.xyz.com B">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,32,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"system_test.us-west.default">>,
                                   {resource,<<"/">>,exchange,
                                       <<"federation: skytap ->
rabbit at slg1matt1.mgmt.xyz.com B">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,33,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"system_test.us-west.default">>,

{resource,<<"/">>,queue,<<"system_test">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,34,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"unit_test.us-east.default">>,
                                   {resource,<<"/">>,exchange,
                                       <<"federation: skytap ->
rabbit at slg1matt1.mgmt.xyz.com B">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,35,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"unit_test.us-west.default">>,
                                   {resource,<<"/">>,exchange,
                                       <<"federation: skytap ->
rabbit at slg1matt1.mgmt.xyz.com B">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,36,
                          {remove_bindings,
                              [{binding,
                                   {resource,<<"/">>,exchange,<<"skytap">>},
                                   <<"unit_test.us-west.default">>,
                                   {resource,<<"/">>,queue,<<"unit_test">>},
                                   []}]}}},
                  {'$gen_cast',
                      {enqueue,37,
                          {add_binding,
                              {binding,
                                  {resource,<<"/">>,exchange,<<"skytap">>},
                                  <<"charon.us-west.default">>,
                                  {resource,<<"/">>,queue,<<"charon">>},
                                  []}}}},
                  {'$gen_cast',
                      {enqueue,38,
                          {add_binding,
                              {binding,
                                  {resource,<<"/">>,exchange,<<"skytap">>},

<<"ConfigurationManager.us-west.default">>,
                                  {resource,<<"/">>,queue,
                                      <<"ConfigurationManager">>},
                                  []}}}},
                  {'$gen_cast',
                      {enqueue,39,
                          {add_binding,
                              {binding,
                                  {resource,<<"/">>,exchange,<<"skytap">>},
                                  <<"unit_test.us-west.default">>,
                                  {resource,<<"/">>,queue,<<"unit_test">>},
                                  []}}}},
                  {'$gen_cast',
                      {enqueue,40,
                          {add_binding,
                              {binding,
                                  {resource,<<"/">>,exchange,<<"skytap">>},
                                  <<"system_test.us-west.default">>,

{resource,<<"/">>,queue,<<"system_test">>},
                                  []}}}},
                  {'$gen_cast',
                      {enqueue,41,
                          {add_binding,
                              {binding,
                                  {resource,<<"/">>,exchange,<<"skytap">>},
                                  <<"cmcmd.us-west.default">>,
                                  {resource,<<"/">>,queue,<<"cmcmd">>},
                                  []}}}},
                  {'DOWN',#Ref<0.0.0.1656>,process,<0.306.0>,shutdown},
                  {'EXIT',<0.199.0>,shutdown},
                  {'DOWN',#Ref<0.0.0.1688>,process,<0.319.0>,shutdown}]
    links: []
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 4181
    stack_size: 24
    reductions: 1851087
  neighbours:

=SUPERVISOR REPORT==== 12-Sep-2012::16:51:56 ===
     Supervisor: {<0.199.0>,
                                           rabbit_federation_link_sup}
     Context:    shutdown_error
     Reason:     {undef,
                  [{rabbit_federation_old_status,report,
                    [{upstream,
                      {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                       "slg1matt1.mgmt.xyz.com",5672,0,0,0,
                       infinity,none,
                       [#Fun<amqp_auth_mechanisms.plain.3>,
                        #Fun<amqp_auth_mechanisms.amqplain.3>],
                       [],[]},
                      <<"skytap">>,1000,1,1,none,none,none,"upstream-slg"},
                     {resource,<<"/">>,exchange,<<"skytap">>},
                     {shutdown,
                      {gen_server,call,
                       [<0.319.0>,
                        {call,
                         {'exchange.unbind',0,
                          <<"federation: skytap ->
rabbit at mq1.matt.internal.xyz.com B">>,
                          <<"skytap">>,

<<"ConfigurationManager.us-east.default">>,false,[]},
                         none,<0.200.0>},
                        infinity]}}],
                    []},
                   {rabbit_federation_link,terminate,2,[]},
                   {gen_server2,terminate,3,[]},
                   {proc_lib,init_p_do_apply,3,
                    [{file,"proc_lib.erl"},{line,227}]}]}
     Offender:   [{pid,<0.200.0>},
                  {name,
                      {upstream,
                          {amqp_params_network,<<"guest">>,<<"guest">>,
                              <<"/">>,"slg1matt1.mgmt.xyz.com",
                              5672,0,0,0,infinity,none,
                              [#Fun<amqp_auth_mechanisms.plain.3>,
                               #Fun<amqp_auth_mechanisms.amqplain.3>],
                              [],[]},
                          <<"skytap">>,1000,1,1,none,none,none,
                          "upstream-slg"}},
                  {mfa,
                      {rabbit_federation_link,start_link,
                          [{{upstream,

{amqp_params_network,<<"guest">>,<<"guest">>,
                                    <<"/">>,
                                    "slg1matt1.mgmt.xyz.com",5672,
                                    0,0,0,infinity,none,
                                    [#Fun<amqp_auth_mechanisms.plain.3>,
                                     #Fun<amqp_auth_mechanisms.amqplain.3>],
                                    [],[]},
                                <<"skytap">>,1000,1,1,none,none,none,
                                "upstream-slg"},
                            {resource,<<"/">>,exchange,<<"skytap">>}}]}},
                  {restart_type,{permanent,1}},
                  {shutdown,4294967295},
                  {child_type,worker}]

On Wed, Sep 12, 2012 at 4:51 PM, Matt Pietrek <mpietrek at skytap.com> wrote:

> I'm experience a problem where "rabbitmqctl stop" takes a very long time
> (5+ minutes, or never) shuts down.
>
> This is RabbitMQ 2.8.6 and Erlang R15B01 on Ubuntu 10.04.
>
> The broker is running with the Federation plug-in in use, FWIW.
>
> The last little bits of console output are:
>
> --------
> Mnesia(rabbit at mq1): write performed by {tid,307,<0.151.0>} on record:
>     {rabbit_durable_route,
>             {binding,
>                 {resource,<<"/">>,exchange,<<"skytap">>},
>                 <<"cmcmd.us-west.default">>,
>                 {resource,<<"/">>,queue,<<"cmcmd">>},
>                 []},
>             const}
> Mnesia(rabbit at mq1): Transaction log dump initiated by time_threshold:
> {needs_dump,40}
> Mnesia(rabbit at mq1): delete_object performed by {dirty,<0.237.0>} on
> record:
>     {rabbit_listener,rabbit at mq1,amqp,"mq1.blah.com",
>                          {0,0,0,0},
>                          5672}
> Mnesia(rabbit at mq1): Transaction log dump initiated by time_threshold:
> already_dumped
> Mnesia(rabbit at mq1): Transaction log dump initiated by time_threshold:
> already_dumped
> Mnesia(rabbit at mq1): Transaction log dump initiated by time_threshold:
> already_dumped
> --------
>
> The rabbit at mq1.log file:
>
> -------
> =INFO REPORT==== 12-Sep-2012::16:38:14 ===
> Stopping Rabbit
>
> =INFO REPORT==== 12-Sep-2012::16:38:14 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
> =INFO REPORT==== 12-Sep-2012::16:38:14 ===
>     application: rabbitmq_federation
>     exited: stopped
>     type: permanent
>
> =INFO REPORT==== 12-Sep-2012::16:38:14 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
> =INFO REPORT==== 12-Sep-2012::16:38:14 ===
> stopped TCP Listener on 0.0.0.0:5672
>
> =WARNING REPORT==== 12-Sep-2012::16:38:14 ===
> Connection (<0.299.0>) closing: internal error in channel (<0.306.0>):
> shutdown
> -------
>
> And the rabbitm at mq1-sasl log:
>
> --------
> =SUPERVISOR REPORT==== 12-Sep-2012::16:38:14 ===
>      Supervisor: {<0.304.0>,amqp_channel_sup}
>      Context:    child_terminated
>      Reason:     shutdown
>      Offender:   [{pid,<0.306.0>},
>                   {name,channel},
>                   {mfa,{amqp_channel,start_link,
>                                      [direct,<0.299.0>,1,<0.305.0>,
>                                       #Fun<amqp_channel_sup.0.24953263>]}},
>                   {restart_type,intrinsic},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 12-Sep-2012::16:38:14 ===
>      Supervisor: {<0.304.0>,amqp_channel_sup}
>      Context:    shutdown
>      Reason:     reached_max_restart_intensity
>      Offender:   [{pid,<0.306.0>},
>                   {name,channel},
>                   {mfa,{amqp_channel,start_link,
>                                      [direct,<0.299.0>,1,<0.305.0>,
>                                       #Fun<amqp_channel_sup.0.24953263>]}},
>                   {restart_type,intrinsic},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
> --------
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120912/99994bd7/attachment.htm>

From hussaintamboli18 at gmail.com  Thu Sep 13 07:04:53 2012
From: hussaintamboli18 at gmail.com (Hussain Tamboli)
Date: Thu, 13 Sep 2012 11:34:53 +0530
Subject: [rabbitmq-discuss] Use RabbitMQ with a message gateway
Message-ID: <CAKP50W4KDM0Rw+=b4QOhyviiA3OnruMwmb_+65USxepfKm_CuQ@mail.gmail.com>

Hi,
Let's say that I have to create a SMS or an email app using RabbitMQ. Or an
app with it's own clients with user accounts to handle the messaging
service.
How do I do this?
Thanks in advance.


*Hussain Tamboli*
Software Developer
[image: Screen-Magic Mobile Media pvt ltd.]

Designed with WiseStamp -
<http://r1.wisestamp.com/r/landing?u=a75d3bb40c4ca423&v=3.11.21&t=1347516147092&promo=10&dest=http%3A%2F%2Fwww.wisestamp.com%2Femail-install%3Futm_source%3Dextension%26utm_medium%3Demail%26utm_campaign%3Dpromo_10>Get
yours<http://r1.wisestamp.com/r/landing?u=a75d3bb40c4ca423&v=3.11.21&t=1347516147092&promo=10&dest=http%3A%2F%2Fwww.wisestamp.com%2Femail-install%3Futm_source%3Dextension%26utm_medium%3Demail%26utm_campaign%3Dpromo_10>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/892dc2e0/attachment.htm>

From simon at rabbitmq.com  Thu Sep 13 09:28:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Sep 2012 09:28:55 +0100
Subject: [rabbitmq-discuss] Cluster nodes stop/start order can lead to
 failures
In-Reply-To: <4e96ad11-4d71-4858-8faa-9323e5a6b8e2@googlegroups.com>
References: <4e96ad11-4d71-4858-8faa-9323e5a6b8e2@googlegroups.com>
Message-ID: <50519947.5060906@rabbitmq.com>

On 12/09/2012 9:43PM, Matt Long wrote:
> Say I have node1 and node2 both running as disc nodes in a cluster
> (there are no other nodes in the cluster). If I stop rabbitmq-server on
> node1 and then stop rabbitmq-server on node2, I'm unable to then start
> rabbitmq-server again on node1...in particular, the start command hangs
> for ~35 seconds before showing FAILED...

That's correct - it's waiting 30s for node2 to become available.

> Is this the expected behavior?

Yes. The point is that node2 could have been running for a long time 
while node1 was down; all sorts of things could have happened. node1 
doesn't know. If node1 were to start and then allow node2 to join later, 
we could end up in a situation where the nodes have diverged and need to 
be merged manually... not good.

> Note that starting node2 after having
> stopped node1 and then node2 works fine; I'm assuming because node2 was
> aware that node1 had went offline prior to its stopping.

Yes.

So the answer is either to start all the nodes in the reverse order to 
how they were stopped, or start them all simultaneously (so that the 30s 
wait period is enough).

Cheers, Simon

From simon at rabbitmq.com  Thu Sep 13 09:40:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Sep 2012 09:40:55 +0100
Subject: [rabbitmq-discuss] Binding to topic exchange with a negation
 wildcard
In-Reply-To: <CAAqmy6OzvP0h-manYSxS1WYck0bm2LnMZAd9=T7K6pYKU2r6uw@mail.gmail.com>
References: <CAAqmy6OzvP0h-manYSxS1WYck0bm2LnMZAd9=T7K6pYKU2r6uw@mail.gmail.com>
Message-ID: <50519C17.4020102@rabbitmq.com>

On 12/09/2012 8:37PM, Dave Curylo wrote:
> Is it possible to bind a queue to a topic exchange with a condition that
> the topic does NOT match a certain wildcard?

The topic exchange doesn't have that logic. But you can fake it with the 
alternate exchange feature, at the cost of a few more exchanges.

Declare a fanout exchange you'll publish to (let's call it 
"my-exchange"). Declare a fanout exchange called "junk".

The when each consumer declares a queue, it also declares a topic 
exchange and a fanout exchange. The alternate-exchange for the topic 
exchange should be set to the fanout exchange. It then binds the topic 
exchange to "my-exchange", and "junk" to the topic exchange, with a 
routing key equal to the topics it doesn't want.

Thus messages with the "bad" routing key go:

   [my-exchange] -> [per-consumer-topic] -> [junk]

and the rest go:

   [my-exchange] -> [per-consumer-topic] -> [per-consumer-fanout] -> 
[per-consumer-queue]

I think that's the simplest you can make it. But exchanges are cheap in 
general, it's just routing logic.

But I wonder whether some sort of more explicit negation feature would 
be feasible / useful. Hmm.

Cheers, Simon

From emile at rabbitmq.com  Thu Sep 13 10:24:54 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 13 Sep 2012 10:24:54 +0100
Subject: [rabbitmq-discuss] binding exchange to client and server in wcf,
 but it auto generate new queue on rabbitmq server, why?
In-Reply-To: <CAC_NAZk7OmJxpuYR3ZuZO7--aS2dryqLcpJ9K_hRVwgA+5wqAg@mail.gmail.com>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
	<3a5f03340907291200j40f91712ne6fe28aa3ce5191f@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD8FA14BFAE8@EXMBX01.wealthcraft.local>
	<4A785F38.3000804@lshift.net>
	<loom.20120912T131333-428@post.gmane.org>
	<50507E6C.2050106@rabbitmq.com>
	<CAC_NAZk7OmJxpuYR3ZuZO7--aS2dryqLcpJ9K_hRVwgA+5wqAg@mail.gmail.com>
Message-ID: <5051A666.4070908@rabbitmq.com>


Hi,

On 12/09/12 13:33, Hadas wrote:
> now I want to use the RabbitMQ. the sending to queue works fine, but my

I understand you want to replace MSMQ with RabbitMQ, and some parts are
not working.

I would suggest first running the WCF examples included with the
RabbitMQ client library. This will validate your environment and provide
a working baseline that you can compare your further work against.

> address="soap.amqp://amq.direct/Queue"

Using the word "Queue" for a service name can be confusing, Service
names will be created as bindings.

> From            |	Routing key           | 	Arguments 	
> amq.direct      | 	/ParseTemplateQueue   |	
> (AMQP default)  | 	ParseTemplateQueue    |

I would expect this if the service was called "ParseTemplateQueue".


-Emile

From tim at rabbitmq.com  Thu Sep 13 10:48:41 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 13 Sep 2012 10:48:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
Message-ID: <51E696F9-30DD-492B-89A3-DE227EC73F30@rabbitmq.com>


On 13 Sep 2012, at 00:51, Matt Pietrek wrote:

> I'm experience a problem where "rabbitmqctl stop" takes a very long time (5+ minutes, or never) shuts down.
> 

We recently fixed a bug that could cause rabbit shutdown to hang indefinitely. The fix will come out in the next bugfix release, probably.

From tim at rabbitmq.com  Thu Sep 13 10:53:08 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 13 Sep 2012 10:53:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
Message-ID: <7A889C96-E05E-4719-9BBF-5A54767CB227@rabbitmq.com>


On 13 Sep 2012, at 01:00, Matt Pietrek wrote:

> Hold on, there's more output that appeared after I sent the original email. This instance took 14 minutes to shut down.
> 

The bug that we fixed (that I mentioned a moment ago) would deadlock, rather than just taking a long time though. 

> The additional rabbit at mq1-sasl.log file looks like this:
> 
> =CRASH REPORT==== 12-Sep-2012::16:51:56 ===
>   crasher:
>     initial call: gen:init_it/6
>     pid: <0.200.0>
>     registered_name: []
>     exception exit: {undef,
>                      [{rabbit_federation_old_status,report,
>                        [{upstream,

I'm *not* a federation guru, but that looks a bit suspicious to me. There is a rabbitmq-old-federation plugin which you shouldn't be using AFAIK - you are using rabbitmq-federation and not old-federation right?

From tim at rabbitmq.com  Thu Sep 13 10:56:44 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 13 Sep 2012 10:56:44 +0100
Subject: [rabbitmq-discuss] Use RabbitMQ with a message gateway
In-Reply-To: <CAKP50W4KDM0Rw+=b4QOhyviiA3OnruMwmb_+65USxepfKm_CuQ@mail.gmail.com>
References: <CAKP50W4KDM0Rw+=b4QOhyviiA3OnruMwmb_+65USxepfKm_CuQ@mail.gmail.com>
Message-ID: <6A9F5EC6-673D-48A7-9992-29315DA9CA30@rabbitmq.com>

Hussain,

On 13 Sep 2012, at 07:04, Hussain Tamboli wrote:

> Hi,
> Let's say that I have to create a SMS or an email app using RabbitMQ. Or an app with it's own clients with user accounts to handle the messaging service. 
> How do I do this?
> Thanks in advance.

This is a very general question. Could you be just a little bit more specific when asking for help? Whilst many on this list are happy to discuss various ways in which to design and build solutions using rabbit, I can say that for my part, I'm not really sure what you are asking for. 

Cheers,
Tim

From hadas100.b at gmail.com  Thu Sep 13 11:03:27 2012
From: hadas100.b at gmail.com (Hadas)
Date: Thu, 13 Sep 2012 13:03:27 +0300
Subject: [rabbitmq-discuss] binding exchange to client and server in wcf,
 but it auto generate new queue on rabbitmq server, why?
In-Reply-To: <5051A666.4070908@rabbitmq.com>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
	<3a5f03340907291200j40f91712ne6fe28aa3ce5191f@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD8FA14BFAE8@EXMBX01.wealthcraft.local>
	<4A785F38.3000804@lshift.net>
	<loom.20120912T131333-428@post.gmane.org>
	<50507E6C.2050106@rabbitmq.com>
	<CAC_NAZk7OmJxpuYR3ZuZO7--aS2dryqLcpJ9K_hRVwgA+5wqAg@mail.gmail.com>
	<5051A666.4070908@rabbitmq.com>
Message-ID: <CAC_NAZn9iN1AAwrygv9LcAq3o=G_uwSEggf4qecF+LtB_0zFKg@mail.gmail.com>

Hi,

The queue's names is ok, the true address is
address="soap.amqp://amq.direct/ParseTemplateQueue".

I try the 'AnthonySteele-RabbitMQ-.Net-demos-259a724' sample. It works fine.
But it uses code for create channel and I want to use enpoint in the
app.config.
(I didn't find sample with using config)
Thanks

2012/9/13 Emile Joubert <emile at rabbitmq.com>

>
> Hi,
>
> On 12/09/12 13:33, Hadas wrote:
> > now I want to use the RabbitMQ. the sending to queue works fine, but my
>
> I understand you want to replace MSMQ with RabbitMQ, and some parts are
> not working.
>
> I would suggest first running the WCF examples included with the
> RabbitMQ client library. This will validate your environment and provide
> a working baseline that you can compare your further work against.
>
> > address="soap.amqp://amq.direct/Queue"
>
> Using the word "Queue" for a service name can be confusing, Service
> names will be created as bindings.
>
> > From            |     Routing key           |         Arguments
> > amq.direct      |     /ParseTemplateQueue   |
> > (AMQP default)  |     ParseTemplateQueue    |
>
> I would expect this if the service was called "ParseTemplateQueue".
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/3d2f5cdd/attachment.htm>

From emile at rabbitmq.com  Thu Sep 13 11:21:17 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 13 Sep 2012 11:21:17 +0100
Subject: [rabbitmq-discuss] binding exchange to client and server in wcf,
 but it auto generate new queue on rabbitmq server, why?
In-Reply-To: <CAC_NAZn9iN1AAwrygv9LcAq3o=G_uwSEggf4qecF+LtB_0zFKg@mail.gmail.com>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
	<3a5f03340907291200j40f91712ne6fe28aa3ce5191f@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD8FA14BFAE8@EXMBX01.wealthcraft.local>
	<4A785F38.3000804@lshift.net>
	<loom.20120912T131333-428@post.gmane.org>
	<50507E6C.2050106@rabbitmq.com>
	<CAC_NAZk7OmJxpuYR3ZuZO7--aS2dryqLcpJ9K_hRVwgA+5wqAg@mail.gmail.com>
	<5051A666.4070908@rabbitmq.com>
	<CAC_NAZn9iN1AAwrygv9LcAq3o=G_uwSEggf4qecF+LtB_0zFKg@mail.gmail.com>
Message-ID: <5051B39D.1010102@rabbitmq.com>

Hi,

On 13/09/12 11:03, Hadas wrote:
> I try the 'AnthonySteele-RabbitMQ-.Net-demos-259a724' sample. It works fine.

Those examples do not make use of WCF. I had mistakenly assumed your
problem was related to WCF. If you explain in more detail what you did,
what results you expected and what results you received; then it might
be possible to offer help.


-Emile


From simon at rabbitmq.com  Thu Sep 13 11:44:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Sep 2012 11:44:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <7A889C96-E05E-4719-9BBF-5A54767CB227@rabbitmq.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<7A889C96-E05E-4719-9BBF-5A54767CB227@rabbitmq.com>
Message-ID: <5051B914.6070706@rabbitmq.com>

On 13/09/12 10:53, Tim Watson wrote:
> I'm*not*  a federation guru, but that looks a bit suspicious to me.
> There is a rabbitmq-old-federation plugin which you shouldn't be
> using AFAIK - you are using rabbitmq-federation and not
> old-federation right?

I've just looked into this - looks like a bodged backport on the 2.8.x 
branch. Fortunately the consequences are not severe - some noise in the 
logs, basically.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From watson.timothy at gmail.com  Thu Sep 13 11:48:07 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 13 Sep 2012 11:48:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <5051B914.6070706@rabbitmq.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<7A889C96-E05E-4719-9BBF-5A54767CB227@rabbitmq.com>
	<5051B914.6070706@rabbitmq.com>
Message-ID: <F0359A53-A468-44D7-9642-3743A596E761@rabbitmq.com>

On 13 Sep 2012, at 11:44, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 13/09/12 10:53, Tim Watson wrote:
>> I'm*not*  a federation guru, but that looks a bit suspicious to me.
>> There is a rabbitmq-old-federation plugin which you shouldn't be
>> using AFAIK - you are using rabbitmq-federation and not
>> old-federation right?
> 
> I've just looked into this - looks like a bodged backport on the 2.8.x branch. Fortunately the consequences are not severe - some noise in the logs, basically.
> 

Ah ok. Thanks For clearing that up. The rabbit shutdown bug (in supervisor2) that we fixed is a deadlock, so the delayed shutdown must be something else.

From francesco at rabbitmq.com  Thu Sep 13 11:55:58 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 13 Sep 2012 11:55:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ Clustering with SSL
In-Reply-To: <A93D83B22B468A4BB8FF60A8EF5248E00DCC0F5F@inicxdb01>
References: <A93D83B22B468A4BB8FF60A8EF5248E00DCC0F5F@inicxdb01>
Message-ID: <87txv2xkch.wl%francesco@rabbitmq.com>

Hi Jignesh,

At Tue, 11 Sep 2012 14:55:41 +0000,
Purohit, Jignesh wrote:
> We are facing problem in RabbitMQ clustering on two existing node enable for
> SSL. First we have set up SSL on both the nodes on SSL default port 5671 and
> then we have applied cluster set up with two disk nodes. After successful
> cluster set up we can able to see the cluster environment on management
> console which shows two disk nodes clustered.

I'm not sure what you mean here with "set up SSL".  I guess that you're opening
SSL connections to clustered nodes - if your intention is to encrypt the
inter-node communications, that is a bit tricky (see
<http://www.erlang.org/doc/apps/ssl/ssl_distribution.html>).

> 1.  But after few hours While verifying it, we observed the management console
>     doesn?t appear so we checked the services and its stops on both the
>     machines.

If I understand correctly you have a durable, HA queue on a two nodes cluster,
where both nodes are on disc.

Then after some activity the queue disappears.  I need more details on the
activity on the queue and on the broker, and the logs on both nodes, otherwise
it is impossible for us to know what's going on.

Also, what version of RabbitMQ are you using?
 
> So we have started service of first node and then we can see the management
> console and it shows the second server disk node gets down. The time duration
> between set up and testing was hardly 1 hr. 30 mins. Node didn?t went up by
> following command. We followed attached installation document for RabbitMQ
> installation. We also checked the cookies files and its correct.

I don't understand this.  You say that you can't bring a node up, but why was it
down in the first place?  Do you start your cluster with one node running?  Did
it crash? I need more details.

> 2.  To manage the cluster set up, we have created another disk node on the
>     machine with diff name and same port (5671). The node is created
>     successfully and shown the active status in management console. But the
>     node working is not correct and is as follows.

Again, it's unclear what this is referring to - is this what you do when trying
to set up a cluster at the beginning?  In any case, trying to run two cluster
node on the same port on the same machine won't work.

> 1.  The messages are not transport properly on the queues generated after
>     clustering. The queues are mirror queues. The queue status also shows ???
>     and when any message send to the queue, the management console is not able
>     to open the queue detail window and the page gets hanged. It seems it goes
>     into some loop. When we restart the RabbitMQ service, the page display
>     properly but the queue status is same.

Is this referring to the queue crash described above, or is it another issue?

> 2.  When we shut down the first node and shift the focus on 2^nd node then the
>     messages get deleted from all the queues and not able to retrieve the
>     messages. The queues are persistence and durable queues. When we send the
>     message on 2^nd node then the behaviours of queue is same as mentioned in
>     #1.

I am really struggling to understand what's going on here, please try to explain
more clearly.

> 3.  If any node of RabbitMQ or its service get shut down abruptly then is
>     there any provision to send notifications to administrator? Currently this
>     functionality is exists for other Windows services

If the node gets shut down abruptly, then surely it has no way to notify the
administrator.  You can surely set up some monitoring for port on which RabbitMQ
is listening to, but my Windows experience is limited and I'm not sure what the
best way to do that is.

--
Francesco * Often in error, never in doubt

From simon at rabbitmq.com  Thu Sep 13 12:02:43 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Sep 2012 12:02:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
Message-ID: <5051BD53.3000401@rabbitmq.com>

On 13/09/12 01:00, Matt Pietrek wrote:
> {socket_error,etimedout}

So I think this is the interesting bit.

Clearly we should not be hanging around waiting for sockets to time out 
during shutdown (these are client sockets BTW, i.e. for federation 
links). But is there some sort of firewall or network weirdness that 
could be causing these timeouts?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Sep 13 12:06:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Sep 2012 12:06:45 +0100
Subject: [rabbitmq-discuss] Unintended message flow using federation?
In-Reply-To: <CACLE7iwzJ7Vt8HxzuLkK6vcfzM8hiNw1yUKsgEDX+t7qD-qigg@mail.gmail.com>
References: <CACLE7iwzJ7Vt8HxzuLkK6vcfzM8hiNw1yUKsgEDX+t7qD-qigg@mail.gmail.com>
Message-ID: <5051BE45.5040707@rabbitmq.com>

Hi Matt. This is a limitation in the federation binding logic that we've 
recently noticed - bindings get transmitted "too far" upstream. We're 
hoping to get it fixed in the next major release.

Cheers, Simon

On 12/09/12 23:57, Matt Pietrek wrote:
> I'm using federation with a topic exchange between two RabbitMQ nodes.
> As part of this, I've defined an exchange, 'skytap' which is a topic
> exchange (yes, I know it's not *really* a topic exchange).
>
> The upstream sets for the skytap exchange are pointed to each other, as
> described in the Federation doc as a "Pair of federated exchanges". For
> routing keys, I'm using something of the form "foo.XXX", where XXX is
> either 'east' or 'west'.
>
> On server 'A', I have a queue 'foo' bound to the skytap exchange, using
> a routing key of 'foo.west'. On server 'B', I have a queue 'foo' bound
> to the skytap exchange, using a routing key of 'foo.east'.
>
> This all generally works as expected. In particular, I have a client app
> running on server 'A' that publishes using the 'foo.west' routing key.
> In other words, everything should be happening locally to server 'A'.
>
> However, via the Management Web UI, I'm noticing that there seems to be
> message traffic to server 'B'. In particular, on the Exchanges tab for
> server 'B' if I select the 'skytap' exchange, I see:
>
> Channel                                  | publish  | confirm
> <rabbit at xxx.3.299.0> (1)       | 20/s      | 20/s
>
> However (as I'd expect), no messages go into the 'foo' queue (or any
> other queue) on server 'B'. Likewise, on the queue tab of server 'A',
> the queue named "skytap -> rabbit at serverA.blah.blah", shows
> incoming/deliver/ack rates of 20/s as well.
>
> This runs counter to what I'd expect from reading the Federation doc,
> specifically: "Therefore the federated exchange only receives messages
> for which it has a subscription."
>
> Am I misunderstanding something, or perhaps don't have things configured
> optimally?
>
> Thanks,
>
> Matt
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From purohit.jignesh at gmail.com  Thu Sep 13 09:54:58 2012
From: purohit.jignesh at gmail.com (Jignesh Purohit)
Date: Thu, 13 Sep 2012 01:54:58 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ cluster set up issue - Node is not
	starting up
Message-ID: <5b17ed3c-ad92-43a8-81b7-d4993d7cf125@googlegroups.com>

We are facing problem in RabbitMQ clustering on two existing node enable 
for SSL on windows server machines. First we have set up SSL on both the 
nodes on SSL default port 5671 and then we have applied cluster set up with 
two disk nodes. After successful cluster set up we can able to see the 
cluster environment on management console which shows two disk nodes 
clustered.

1. But after few hours While verifying it, we observed the management 
console doesn?t appear so we checked the services and its stops on both the 
machines. 

So we have started service of first node and then we can see the management 
console and it shows the second server disk node gets down. The time 
duration between set up and testing was hardly 1 hr. 30 mins. Node didn?t 
went up by following command. We followed attached installation document 
for RabbitMQ installation. We also checked the cookies files and its 
correct.
rabbitmqctl start_app
rabbitmq-server -detached.
2. To manage the cluster set up, we have created another disk node on the 
machine with diff name and same port (5671). The node is created 
successfully and shown the active status in management console. But the 
node working is not correct and is as follows.
1. The messages are not transport properly on the queues generated after 
clustering. The queues are mirror queues. The queue status also shows ??? 
and when any message send to the queue, the management console is not able 
to open the queue detail window and the page gets hanged. It seems it goes 
into some loop. When we restart the RabbitMQ service, the page display 
properly but the queue status is same. 
2. When we shut down the first node and shift the focus on 2nd node then 
the messages get deleted from all the queues and not able to retrieve the 
messages. The queues are persistence and durable queues. When we send the 
message on 2nd node then the behaviours of queue is same as mentioned in #1.
3. If any node of RabbitMQ or its service get shut down abruptly then is 
there any provision to send notifications to administrator? Currently this 
functionality is exists for other Windows services 

If anybody knows how to start the shutdown node then kindly let us know.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/26e7234a/attachment.htm>

From purohit.jignesh at gmail.com  Thu Sep 13 09:57:15 2012
From: purohit.jignesh at gmail.com (Jignesh Purohit)
Date: Thu, 13 Sep 2012 01:57:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster nodes stop/start order can lead to
	failures
In-Reply-To: <4e96ad11-4d71-4858-8faa-9323e5a6b8e2@googlegroups.com>
References: <4e96ad11-4d71-4858-8faa-9323e5a6b8e2@googlegroups.com>
Message-ID: <8ad1ab95-fa5c-4fda-b8f3-b096664147e9@googlegroups.com>

Hi Matt,

I too facing the same problem so kindly let me know if you get any solution 
for this problem.

Regards
Jignesh Purohit


On Thursday, September 13, 2012 2:13:14 AM UTC+5:30, Matt Long wrote:
>
> Say I have node1 and node2 both running as disc nodes in a cluster (there 
> are no other nodes in the cluster). If I stop rabbitmq-server on node1 and 
> then stop rabbitmq-server on node2, I'm unable to then start 
> rabbitmq-server again on node1...in particular, the start command hangs for 
> ~35 seconds before showing FAILED...
>
> Is this the expected behavior? Note that starting node2 after having 
> stopped node1 and then node2 works fine; I'm assuming because node2 was 
> aware that node1 had went offline prior to its stopping.
>
> The relevant bit from the startup_log on node1 is :
> BOOT FAILED
> ===========
>
> Timeout contacting cluster nodes: ['rabbit at node2'].
>
> Here's all the details:
>
> *node1*$ sudo service rabbitmq-server stop
> Stopping rabbitmq-server: rabbitmq-server.
>
> *node2*$ sudo service rabbitmq-server stop
> Stopping rabbitmq-server: rabbitmq-server.
>
> *node1*$ sudo service rabbitmq-server start
> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
> _err}
> rabbitmq-server.
>
> Contents of startup_err:
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) 
> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
>
> Tail end of startup_log:
>
> -- rabbit boot start
> starting file handle cache server                                     
> ...done
> starting worker pool                                                 
>  ...done
> starting database                                                     ...
>
> BOOT FAILED
> ===========
>
> Timeout contacting cluster nodes: ['rabbit at node2'].
>
> DIAGNOSTICS
> ===========
>
> nodes in question: ['rabbit at node2']
>
> hosts, their running nodes and ports:
> - node2: []
>
> current node details:
> - node name: 'rabbit at node1'
> - home dir: /var/lib/rabbitmq
> - cookie hash: xxxredactedxxxxxxxxxxx==
>
>
> {"Kernel pid 
> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/6032055b/attachment.htm>

From tim at rabbitmq.com  Thu Sep 13 12:44:41 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 13 Sep 2012 12:44:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <5051BD53.3000401@rabbitmq.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<5051BD53.3000401@rabbitmq.com>
Message-ID: <B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>

Matt

On 13 Sep 2012, at 12:02, Simon MacMullen wrote:

> On 13/09/12 01:00, Matt Pietrek wrote:
>> {socket_error,etimedout}
> 
> So I think this is the interesting bit.
> 
> Clearly we should not be hanging around waiting for sockets to time out during shutdown (these are client sockets BTW, i.e. for federation links). But is there some sort of firewall or network weirdness that could be causing these timeouts?

Is it a possibility that firewall/network configuration between the two nodes is causing packets to get dropped?

From joemonvarghese80 at gmail.com  Thu Sep 13 13:36:49 2012
From: joemonvarghese80 at gmail.com (Joemon Varghese)
Date: Thu, 13 Sep 2012 18:06:49 +0530
Subject: [rabbitmq-discuss] Rabbit MQ Log
Message-ID: <CALnUTWXW893+uUg74bzs6PWxeaa2=L44T1WmuQUQppVu7fAV4Q@mail.gmail.com>

Hi,

Is there any way to get the Rabbit MQ logs.Like message id that processed
yesterday.

Thanks and Regards,
Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/419113f6/attachment.htm>

From wayne at prjatk.com  Thu Sep 13 13:39:04 2012
From: wayne at prjatk.com (Wayne Douglas)
Date: Thu, 13 Sep 2012 13:39:04 +0100
Subject: [rabbitmq-discuss] Rabbit MQ Log
In-Reply-To: <CALnUTWXW893+uUg74bzs6PWxeaa2=L44T1WmuQUQppVu7fAV4Q@mail.gmail.com>
References: <CALnUTWXW893+uUg74bzs6PWxeaa2=L44T1WmuQUQppVu7fAV4Q@mail.gmail.com>
Message-ID: <CAGfvhtnnu3VMr7Hozq-ksdfVLKsxUv+Ow5AOTWKpqkpavtghLQ@mail.gmail.com>

it's in AppData/Roaming/RabbitMQ/Log no?

On Thu, Sep 13, 2012 at 1:36 PM, Joemon Varghese <joemonvarghese80 at gmail.com
> wrote:

> Hi,
>
> Is there any way to get the Rabbit MQ logs.Like message id that processed
> yesterday.
>
> Thanks and Regards,
> Joe
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
*--------------------*
*
*
*w://*
*
*
*t: 07525424882*
*
*
*--------------------*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/9f5336c7/attachment.htm>

From emile at rabbitmq.com  Thu Sep 13 14:28:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 13 Sep 2012 14:28:57 +0100
Subject: [rabbitmq-discuss] Rabbit MQ Log
In-Reply-To: <CALnUTWXW893+uUg74bzs6PWxeaa2=L44T1WmuQUQppVu7fAV4Q@mail.gmail.com>
References: <CALnUTWXW893+uUg74bzs6PWxeaa2=L44T1WmuQUQppVu7fAV4Q@mail.gmail.com>
Message-ID: <5051DF99.1000207@rabbitmq.com>


Hi,

On 13/09/12 13:36, Joemon Varghese wrote:
> Is there any way to get the Rabbit MQ logs.Like message id that
> processed yesterday.

The default log location for a few of the main platforms is listed here:
http://www.rabbitmq.com/relocate.html

The contents of messages is not logged. You should look at the tracer if
that is what you need, though it does not operate retroactively:
http://www.rabbitmq.com/firehose.html



-Emile


From eugene.doktorov at gmail.com  Thu Sep 13 15:04:16 2012
From: eugene.doktorov at gmail.com (eugene)
Date: Thu, 13 Sep 2012 07:04:16 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ - big delays when establishing Kombu
	connection
Message-ID: <1347545056419-21989.post@n5.nabble.com>

Hi guys,

We're experiencing big delays (2-25 secs) when using celery's send_task
method

Our environment:
 - client: celery 3.0.7
 - server: celery 3.0.7, rabbitmq 2.8.6
 - typical ping 
	icmp_seq=1 ttl=64 time=0.390 ms
	icmp_seq=2 ttl=64 time=0.375 ms
	icmp_seq=3 ttl=64 time=54.6 ms
	icmp_seq=4 ttl=64 time=0.384 ms
  - no memory or CPU problems are observed on client or server nodes
  - delay occurs with or without using rabbitmq cluster

I investigated problem a bit:
 - enabled Kombu output on client
 - ran tcpdump on client & server
 - was not able to make Kombu log on the server side. Tried
KOMBU_LOG_DEBUG=1 celeryd -l debug

Looking at logs I noticed that:
 - delay ALWAYS happens between the same amqp messages while establishing
Kombu connection.(TCP connection seams to be established fast)
 - server side tcpdump reflects the same delay
 - publishing, processing & receiving results are fast.

Below is client output from Kombu & tcpdump. I redirected them into the same
file:

Where to go from this point? I'd really appreciate some advice.


Thank you!

Eugene



Logs:
 - prodback1.elevate.56418 - celery client
 - 10.0.1.60.amqp - celery server (using rabbitmq) 
 - delay is between 16:30:03.623661 and 16:30:06.848230


<<LOG BEGIN>>

[Kombu connection:0x2c75350] acquired
*[Kombu connection:0x2c75350] establishing connection...*
16:30:03.623330 IP (tos 0x0, ttl 64, id 56366, offset 0, flags [DF], proto
TCP (6), length 60)
    prodback1.elevate.56418 > 10.0.1.60.amqp: Flags [S], cksum 0x167e
(incorrect -> 0x6113), seq 2858003468, win 5840, options [mss 1460,sackOK,TS
val 12218402 ecr 0,nop,wscale 7], length 0
E..<.. at .@.H>
...
..<.b.(.Y...........~.........
..p"........

16:30:03.623661 IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto TCP
(6), length 60)
    10.0.1.60.amqp > prodback1.elevate.56418: Flags [S.], cksum 0xcd0b
(correct), seq 1781605121, ack 2858003469, win 14480, options [mss
1460,sackOK,TS val 3557232892 ecr 12218402,nop,wscale 7], length 0
E..<.. at .@.$m
..<
....(.bj1#..Y.^M..8............
......p"....

16:30:03.623686 IP (tos 0x0, ttl 64, id 56367, offset 0, flags [DF], proto
TCP (6), length 52)
    prodback1.elevate.56418 > 10.0.1.60.amqp: Flags [.], cksum 0x1676
(incorrect -> 0x343a), seq 1, ack 1, win 46, options [nop,nop,TS val
12218402 ecr 3557232892], length 0
E..4./@. at .HE
...
..<.b.(.Y.^Mj1#......v.....
..p"....

16:30:03.624252 IP (tos 0x0, ttl 64, id 56368, offset 0, flags [DF], proto
TCP (6), length 60)
    prodback1.elevate.56418 > 10.0.1.60.amqp: Flags [P.], cksum 0x167e
(incorrect -> 0x988b), seq 1:9, ack 1, win 46, options [nop,nop,TS val
12218402 ecr 3557232892], length 8
E..<.0 at .@.H<
...
..<.b.(.Y.^Mj1#......~.....
..p"....AMQP....

*16:30:03.624547* IP (tos 0x0, ttl 64, id 13311, offset 0, flags [DF], proto
TCP (6), length 52)
    10.0.1.60.amqp > prodback1.elevate.56418: Flags [.], cksum 0x33ed
(correct), seq 1, ack 9, win 114, options [nop,nop,TS val 3557232893 ecr
12218402], length 0
E..43. at .@..u
..<
....(.bj1#..Y.....r3......
......p"

*<<my comments:
Here is the delay
always happens between these 2 amqp messages. Never in other places
In this case: 3.2 secs. Seen 25 secs.
Server side tcpdump has the same delay>>*

*16:30:06.848230* IP (tos 0x0, ttl 64, id 13312, offset 0, flags [DF], proto
TCP (6), length 299)
    10.0.1.60.amqp > prodback1.elevate.56418: Flags [P.], cksum 0x351f
(correct), seq 1:248, ack 9, win 114, options [nop,nop,TS val 3557236117 ecr
12218402], length 247
E..+4. at .@..}
..<
....(.bj1#..Y.....r5......
......p"........
.
.......capabilitiesF....	copyrightS...$Copyright (C) 2007-2012 VMware,
Inc..informationS...5Licensed under the MPL.  See
http://www.rabbitmq.com/.platformS...
Erlang/OTP.productS....RabbitMQ.versionS....2.8.6....PLAIN
AMQPLAIN....en_US.

16:30:06.848351 IP (tos 0x0, ttl 64, id 56369, offset 0, flags [DF], proto
TCP (6), length 52)
    prodback1.elevate.56418 > 10.0.1.60.amqp: Flags [.], cksum 0x1676
(incorrect -> 0x19ee), seq 9, ack 248, win 54, options [nop,nop,TS val
12221646 ecr 3557236117], length 0
E..4.1 at .@.HC
...
..<.b.(.Y..j1#....6.v.....
..|.....

16:30:06.849300 IP (tos 0x0, ttl 64, id 56370, offset 0, flags [DF], proto
TCP (6), length 175)
    prodback1.elevate.56418 > 10.0.1.60.amqp: Flags [P.], cksum 0x16f1
(incorrect -> 0xbb31), seq 9:132, ack 248, win 54, options [nop,nop,TS val
12221647 ecr 3557236117], length 123
E....2 at .@.G.
...
..<.b.(.Y..j1#....6.......
..|...........s.
.....5.libraryS....Python
amqplib.library_versionS....1.0.2.AMQPLAIN...#.LOGINS....guest.PASSWORDS....guest.en_US.

16:30:06.849577 IP (tos 0x0, ttl 64, id 13313, offset 0, flags [DF], proto
TCP (6), length 52)
    10.0.1.60.amqp > prodback1.elevate.56418: Flags [.], cksum 0x1935
(correct), seq 248, ack 132, win 114, options [nop,nop,TS val 3557236118 ecr
12221647], length 0
E..44. at .@..s
..<
....(.bj1#..Y.....r.5.....
......|.

16:30:06.849696 IP (tos 0x0, ttl 64, id 13314, offset 0, flags [DF], proto
TCP (6), length 72)
    10.0.1.60.amqp > prodback1.elevate.56418: Flags [P.], cksum 0xe14a
(correct), seq 248:268, ack 132, win 114, options [nop,nop,TS val 3557236118
ecr 12221647], length 20
E..H4. at .@..^
..<
....(.bj1#..Y.....r.J.....
......|.........
...........

16:30:06.849864 IP (tos 0x0, ttl 64, id 56371, offset 0, flags [DF], proto
TCP (6), length 72)
    prodback1.elevate.56418 > 10.0.1.60.amqp: Flags [P.], cksum 0x168a
(incorrect -> 0xe072), seq 132:152, ack 268, win 54, options [nop,nop,TS val
12221647 ecr 3557236118], length 20
E..H.3 at .@.H-
...
..<.b.(.Y..j1$^M...6.......
..|.............
...........

16:30:06.849942 IP (tos 0x0, ttl 64, id 56372, offset 0, flags [DF], proto 
TCP (6), length 68)
    prodback1.elevate.56418 > 10.0.1.60.amqp: Flags [P.], cksum 0x1686
(incorrect -> 0xae61), seq 152:168, ack 268, win 54, options [nop,nop,TS val
12221647 ecr 3557236118], length 16
E..D.4 at .@.H0
...
..<.b.(.Y..j1$^M...6.......
..|.............
.(./...

*[Kombu connection:0x2c75350] connection established:
<kombu.transport.amqplib.Connection object at 0x2d20a50>*
[Kombu connection:0x2c75350] create channel
[Kombu channel:1] exchange_declare(nowait=False, exchange='fetcher',
durable=True, arguments=None, type='direct', auto_delete=False)
[Kombu channel:1] queue_declare(passive=False, nowait=False,
exclusive=False, durable=True, queue='fetcher', arguments=None,
auto_delete=False)
[Kombu channel:1] queue_bind(queue='fetcher', arguments=None, nowait=False,
routing_key='fetcher_task', exchange='fetcher')
[Kombu channel:1]
prepare_message("(dp1\nS'retries'\np2\nI0\nsS'task'\np3\nS'fetcher.ping'\np4\nsS'kwargs'\np5\n(dp6\nsS'eta'\np7\nNsS'args'\np8\n(lp9\nsS'id'\np10\nS'610ba4f3-4fa4-46c4-a07e-2c71909a8c12'\np11\nsS'expires'\np12\nNsS'utc'\np13\nI00\ns.",
priority=None, headers={}, properties={'delivery_mode': 2},
content_type='application/x-python-serialize', content_encoding='binary')
[Kombu channel:1] basic_publish(<amqplib.client_0_8.basic_message.Message
object at 0x2d20f90>, mandatory=None, routing_key='fetcher_task',
immediate=None, exchange='fetcher')

<<LOG END>>

no delays from this point




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-big-delays-when-establishing-Kombu-connection-tp21989.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ask at rabbitmq.com  Thu Sep 13 15:53:25 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Thu, 13 Sep 2012 15:53:25 +0100
Subject: [rabbitmq-discuss] RabbitMQ - big delays when establishing
	Kombu connection
In-Reply-To: <1347545056419-21989.post@n5.nabble.com>
References: <1347545056419-21989.post@n5.nabble.com>
Message-ID: <E128B350-0FBF-4CB4-8EB5-6147F694A330@rabbitmq.com>


On 13 Sep 2012, at 15:04, eugene <eugene.doktorov at gmail.com> wrote:

> Hi guys,
> 
> We're experiencing big delays (2-25 secs) when using celery's send_task
> method
> 
> Our environment:
> - client: celery 3.0.7
> - server: celery 3.0.7, rabbitmq 2.8.6
> - typical ping 
> 	icmp_seq=1 ttl=64 time=0.390 ms
> 	icmp_seq=2 ttl=64 time=0.375 ms
> 	icmp_seq=3 ttl=64 time=54.6 ms
> 	icmp_seq=4 ttl=64 time=0.384 ms
> - no memory or CPU problems are observed on client or server nodes
> - delay occurs with or without using rabbitmq cluster
> 
> I investigated problem a bit:
> - enabled Kombu output on client
> - ran tcpdump on client & server
> - was not able to make Kombu log on the server side. Tried
> KOMBU_LOG_DEBUG=1 celeryd -l debug
> 
> Looking at logs I noticed that:
> - delay ALWAYS happens between the same amqp messages while establishing
> Kombu connection.(TCP connection seams to be established fast)
> - server side tcpdump reflects the same delay
> - publishing, processing & receiving results are fast.
> 
> Below is client output from Kombu & tcpdump. I redirected them into the same
> file:
> 
> Where to go from this point? I'd really appreciate some advice.

Eugene,

Have you been able to reproduce using librabbitmq instead of amqplib?

From Michael.Laing at nytimes.com  Thu Sep 13 15:53:26 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Thu, 13 Sep 2012 10:53:26 -0400
Subject: [rabbitmq-discuss] Binding to topic exchange with a negation
 wildcard
In-Reply-To: <50519C17.4020102@rabbitmq.com>
Message-ID: <CC776AF2.4953%Michael.Laing@nytimes.com>

We would find a regular expression matching option for topic exchanges
most useful.

My 2 cents :)

Michael

On 9/13/12 4:40 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>On 12/09/2012 8:37PM, Dave Curylo wrote:
>> Is it possible to bind a queue to a topic exchange with a condition that
>> the topic does NOT match a certain wildcard?
>
>The topic exchange doesn't have that logic. But you can fake it with the
>alternate exchange feature, at the cost of a few more exchanges.
>
>Declare a fanout exchange you'll publish to (let's call it
>"my-exchange"). Declare a fanout exchange called "junk".
>
>The when each consumer declares a queue, it also declares a topic
>exchange and a fanout exchange. The alternate-exchange for the topic
>exchange should be set to the fanout exchange. It then binds the topic
>exchange to "my-exchange", and "junk" to the topic exchange, with a
>routing key equal to the topics it doesn't want.
>
>Thus messages with the "bad" routing key go:
>
>   [my-exchange] -> [per-consumer-topic] -> [junk]
>
>and the rest go:
>
>   [my-exchange] -> [per-consumer-topic] -> [per-consumer-fanout] ->
>[per-consumer-queue]
>
>I think that's the simplest you can make it. But exchanges are cheap in
>general, it's just routing logic.
>
>But I wonder whether some sort of more explicit negation feature would
>be feasible / useful. Hmm.
>
>Cheers, Simon
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Thu Sep 13 16:20:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Sep 2012 16:20:38 +0100
Subject: [rabbitmq-discuss] Regex exchange? (was: Binding to topic exchange
	with a negation wildcard)
In-Reply-To: <CC776AF2.4953%Michael.Laing@nytimes.com>
References: <CC776AF2.4953%Michael.Laing@nytimes.com>
Message-ID: <5051F9C6.4040909@rabbitmq.com>

On 13/09/12 15:53, Laing, Michael P. wrote:
> We would find a regular expression matching option for topic exchanges
> most useful.
>
> My 2 cents:)

Well, there's a reason AMQP didn't just specify regexs for topic 
exchanges in the first place - it won't go anything like as fast when 
you have a reasonable number of bindings.

Basically, the topic globbing in AMQP is simple enough that we don't 
have to look at every binding for every message (and yes, this really 
does make a huge difference!):

http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1/
http://www.rabbitmq.com/blog/2011/03/28/very-fast-and-scalable-topic-routing-part-2/

If we were to have a regex exchange, we'd have to check every binding 
against every published message. There's no clever way to do it.

However.

You might not actually care, if your RabbitMQ broker is nowhere near CPU 
bound already. And it would be pretty easy to write. So is there general 
interest in a regex exchange? (With the proviso that it would be notably 
slower than the existing topic exchange...)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Michael.Laing at nytimes.com  Thu Sep 13 17:05:53 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Thu, 13 Sep 2012 12:05:53 -0400
Subject: [rabbitmq-discuss] Regex exchange? (was: Binding to topic
 exchange with a negation wildcard)
In-Reply-To: <5051F9C6.4040909@rabbitmq.com>
Message-ID: <CC77761F.4960%Michael.Laing@nytimes.com>

Interesting! It's more of a "nice-to-have" option for me, much less
important than good performance, reliable federation, etc.

Multiple bindings and sender-selected distribution add richness as well
that mitigate the need.

And we have a scheme for distilling complex combinations of subscriber
roles and topic interests into multiple pairs of symmetric 128 character
strings which, with separating periods, create 255 char keys that are used
for binding 'sieves' and publishing 'patterns' respectively in topic
exchanges.

Seems quite fast. Actually my developers are still scratching their heads
and not actually using it yet - but it's good to get out in front of them
sometimes :)

Plus there's a lot of headroom left in the scheme if we fully exploit the
depth of each character position, so we should be able to stay out front
for awhile?

ml

On 9/13/12 11:20 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:

>On 13/09/12 15:53, Laing, Michael P. wrote:
>> We would find a regular expression matching option for topic exchanges
>> most useful.
>>
>> My 2 cents:)
>
>Well, there's a reason AMQP didn't just specify regexs for topic
>exchanges in the first place - it won't go anything like as fast when
>you have a reasonable number of bindings.
>
>Basically, the topic globbing in AMQP is simple enough that we don't
>have to look at every binding for every message (and yes, this really
>does make a huge difference!):
>
>http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routi
>ng-part-1/
>http://www.rabbitmq.com/blog/2011/03/28/very-fast-and-scalable-topic-routi
>ng-part-2/
>
>If we were to have a regex exchange, we'd have to check every binding
>against every published message. There's no clever way to do it.
>
>However.
>
>You might not actually care, if your RabbitMQ broker is nowhere near CPU
>bound already. And it would be pretty easy to write. So is there general
>interest in a regex exchange? (With the proviso that it would be notably
>slower than the existing topic exchange...)
>
>Cheers, Simon
>
>-- 
>Simon MacMullen
>RabbitMQ, VMware


From mpietrek at skytap.com  Thu Sep 13 17:18:48 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 13 Sep 2012 09:18:48 -0700
Subject: [rabbitmq-discuss] Unintended message flow using federation?
In-Reply-To: <5051BE45.5040707@rabbitmq.com>
References: <CACLE7iwzJ7Vt8HxzuLkK6vcfzM8hiNw1yUKsgEDX+t7qD-qigg@mail.gmail.com>
	<5051BE45.5040707@rabbitmq.com>
Message-ID: <CACLE7iy8zPVCdU2C_hWTcRJKzjG0OPGYJv5rno-wCrxFxDLXBQ@mail.gmail.com>

Thanks for the quick reply Simon.

While I was hoping it was just something I'd messed up, I'm still glad that
it's a known issue and that there are plans to resolve it. In the short
term I believe we're OK living with this behavior.

Matt

On Thu, Sep 13, 2012 at 4:06 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi Matt. This is a limitation in the federation binding logic that we've
> recently noticed - bindings get transmitted "too far" upstream. We're
> hoping to get it fixed in the next major release.
>
> Cheers, Simon
>
>
> On 12/09/12 23:57, Matt Pietrek wrote:
>
>> I'm using federation with a topic exchange between two RabbitMQ nodes.
>> As part of this, I've defined an exchange, 'skytap' which is a topic
>> exchange (yes, I know it's not *really* a topic exchange).
>>
>> The upstream sets for the skytap exchange are pointed to each other, as
>> described in the Federation doc as a "Pair of federated exchanges". For
>> routing keys, I'm using something of the form "foo.XXX", where XXX is
>> either 'east' or 'west'.
>>
>> On server 'A', I have a queue 'foo' bound to the skytap exchange, using
>> a routing key of 'foo.west'. On server 'B', I have a queue 'foo' bound
>> to the skytap exchange, using a routing key of 'foo.east'.
>>
>> This all generally works as expected. In particular, I have a client app
>> running on server 'A' that publishes using the 'foo.west' routing key.
>> In other words, everything should be happening locally to server 'A'.
>>
>> However, via the Management Web UI, I'm noticing that there seems to be
>> message traffic to server 'B'. In particular, on the Exchanges tab for
>> server 'B' if I select the 'skytap' exchange, I see:
>>
>> Channel                                  | publish  | confirm
>> <rabbit at xxx.3.299.0> (1)       | 20/s      | 20/s
>>
>> However (as I'd expect), no messages go into the 'foo' queue (or any
>> other queue) on server 'B'. Likewise, on the queue tab of server 'A',
>> the queue named "skytap -> rabbit at serverA.blah.blah", shows
>> incoming/deliver/ack rates of 20/s as well.
>>
>> This runs counter to what I'd expect from reading the Federation doc,
>> specifically: "Therefore the federated exchange only receives messages
>> for which it has a subscription."
>>
>> Am I misunderstanding something, or perhaps don't have things configured
>> optimally?
>>
>> Thanks,
>>
>> Matt
>>
>>
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/7403a7f1/attachment.htm>

From matthias at rabbitmq.com  Thu Sep 13 17:32:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 13 Sep 2012 17:32:56 +0100
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
Message-ID: <50520AB8.7040908@rabbitmq.com>

Dear Rabbit users,

AMQP's basic.publish method has two flags - mandatory and immediate - 
that trigger checks at the server and result in messages getting 
returned to clients with basic.return when the necessary conditions 
aren't met. See 
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish for the 
details.

I can just about see why 'mandatory' may be useful, but 'immediate' has 
always struck me as a bizarre and I fear that anybody using it may well 
do so w/o fully understanding the semantics - can't blame them, it *is* 
bizarre. Because of that, and since it complicates the code in many 
places, we are considering dropping support for 'immediate'.

So is anybody actually using the 'immediate' flag?


Regards,

Matthias.

From milan.gornik at gmail.com  Thu Sep 13 17:31:47 2012
From: milan.gornik at gmail.com (mgornik)
Date: Thu, 13 Sep 2012 09:31:47 -0700 (PDT)
Subject: [rabbitmq-discuss] What is a proper workflow for ACKs?
Message-ID: <1347553907242-21995.post@n5.nabble.com>

Hello!


From mpietrek at skytap.com  Thu Sep 13 18:06:56 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 13 Sep 2012 10:06:56 -0700
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<5051BD53.3000401@rabbitmq.com>
	<B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>
Message-ID: <CACLE7ixuiiz6MNuLXHYdLoSnu+p5Drp7++3wvo8umQFCn2=2KQ@mail.gmail.com>

> Is it a possibility that firewall/network configuration between the two
nodes is causing packets to get dropped?

It seems unlikely. The two nodes are on opposite sides of the US, so
there's some normal latency between them. However, the connections are
generally reliable and I'm pumping many messages/second through the
federation before shutting the brokers down. (Xref my other thread about
extraneous federation exchange traffic.)


On Thu, Sep 13, 2012 at 4:44 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Matt
>
> On 13 Sep 2012, at 12:02, Simon MacMullen wrote:
>
> > On 13/09/12 01:00, Matt Pietrek wrote:
> >> {socket_error,etimedout}
> >
> > So I think this is the interesting bit.
> >
> > Clearly we should not be hanging around waiting for sockets to time out
> during shutdown (these are client sockets BTW, i.e. for federation links).
> But is there some sort of firewall or network weirdness that could be
> causing these timeouts?
>
> Is it a possibility that firewall/network configuration between the two
> nodes is causing packets to get dropped?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/50af31b4/attachment.htm>

From johnc at codecobblers.com  Thu Sep 13 19:07:51 2012
From: johnc at codecobblers.com (servobit)
Date: Thu, 13 Sep 2012 11:07:51 -0700 (PDT)
Subject: [rabbitmq-discuss] amqp 1.0.4 blocking consume seems to block
 forever even though new messages are on the queue
Message-ID: <9af5dd67-245f-4c9e-b90d-452fdaa1e8d2@googlegroups.com>

Hi All.

When I start my AMQP 1.0.4 PHP client, Assuming there are pending messages 
in the queue,  I can read all of the pending messages from the queue.  I am 
doing this using consume( 'processMsg') which is a blocking call.

The strange thing is, after I process and ACK the pending messages on the 
Queue, any new messages I add to the queue are not "picked up" by the 
consume callback.  In other words, it seems as if the exchange + channel 
conn has gone stale.

If I restart my client, the pending messages are picked up without a 
problem.

It appears the consume call expires (for lack of better term) almost 
exactly @ the 2 minute mark. 
My broker is SwiftMQ.  Unfortunately, I don't have access to config 
settings on the broker at the moment.

Any help would be greatly appreciated.  BTW, I saw the same problem with 
STOMP, which I believe is no longer supported anyway.


Here is my main loop:

            // run forever
            while(1) {

                try {

                    if ( $this->conn == null ){
                        self::init();
                    }
                    
                    if ( ! $this->channel->isConnected() ) {
                        self::trace(__METHOD__ . " " . " Channel is not 
connected, reconnecting...");
                        self::init( );
                    }

                    // keep our connection alive
                    if ( isset( $this->conn )){
                        if ( $this->conn->isConnected() == false ){
                            // reinit
                            self::init();
                        }
                    }
                    
                    $result = $this->readMsg( );

                }catch( Exception $e ){
                    self::trace(__METHOD__ . " Error: " . 
$e->getTraceAsString()  );
                }
            }

Here is the readMsg( ) method:

        /**
         * read a message from the Broker queue
         * @return  $result (true or false)
         */
public function readMsg(  ) {
            // read the messages from the queue, acknowledge if no errs so
            // the messages are removed from the queue.  If we don't ack, 
            // messages will remain in the queue and will be marked as 
"redelivered".
            
            // CALLBACK
            $result = $this->consumer->consume( 'processMsg' );
                    
            return $result;
          
}

And here is the callback:

/**
 * CALLBACK - Note we are called via queue->consume which uses Synchronous 
I/O (Blocking)
 * 
* process the envelope body
* @param $amqpEnvelope
* @return false when done - see php AMQP docs for consume and returning to 
the calling thread.
* @throws Exception
*/
function processMsg( $amqpEnvelope, $consumer ) {

    try {
        
        if ( $amqpEnvelope == null || empty($amqpEnvelope) ){
            return false; // still blocking
        }
        
        $payload = $amqpEnvelope->getBody( );
        
        if ($payload == null ){
            return false; // still blocking
        }

        $deliveryTag = $amqpEnvelope->getDeliveryTag();

        trace( __FUNCTION__ . " Delivery Tag: " . $deliveryTag );
        
        $response = sendRemoteWebserviceRequest( $payload );
        
        processRemoteWebserviceResponse( $response );
        
        $consumer->ack( $deliveryTag );
        
        // return false indicating we are done (weird, but that's what the 
docs show)
        return false; 


    }catch( AMQPChannelException $e ) {
        throw $e;
    }catch( AMQPConnectionException $e ){
        throw $e;
    }catch( Exception $e ){
        //
        // When known application errs occur, we need to ack the message 
and remove
        // it from the queue.
        if ( strpos($amqpEnvelope->getBody( ), '<error>Title already 
exists' ) !== false){
            $consumer->ack( $amqpEnvelope->getDeliveryTag() );
        }
        throw $e;
    }
}


Note that if I re-establish the connection / exchange / queue that this is 
a non-issue.  Although I don't want to have to do this.
FWIW, I have one subscriber and one queue.

Best,

John

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/056df8d6/attachment.htm>

From simon at rabbitmq.com  Thu Sep 13 19:24:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 13 Sep 2012 19:24:39 +0100
Subject: [rabbitmq-discuss] amqp 1.0.4 blocking consume seems to block
 forever even though new messages are on the queue
In-Reply-To: <9af5dd67-245f-4c9e-b90d-452fdaa1e8d2@googlegroups.com>
References: <9af5dd67-245f-4c9e-b90d-452fdaa1e8d2@googlegroups.com>
Message-ID: <505224E7.9000408@rabbitmq.com>

On 13/09/2012 7:07PM, servobit wrote:
> My broker is SwiftMQ.

...so I don't know how much help you'll get here. But maybe the author 
of the client you're using is on this list :-)

Cheers, Simon

From tim at rabbitmq.com  Thu Sep 13 19:32:09 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 13 Sep 2012 19:32:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <CACLE7ixuiiz6MNuLXHYdLoSnu+p5Drp7++3wvo8umQFCn2=2KQ@mail.gmail.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<5051BD53.3000401@rabbitmq.com>
	<B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>
	<CACLE7ixuiiz6MNuLXHYdLoSnu+p5Drp7++3wvo8umQFCn2=2KQ@mail.gmail.com>
Message-ID: <49F9DCE2-2ED2-4791-94FC-1FB57D237A8C@rabbitmq.com>

On 13 Sep 2012, at 18:06, Matt Pietrek wrote:

> > Is it a possibility that firewall/network configuration between the two nodes is causing packets to get dropped?
> 
> It seems unlikely. The two nodes are on opposite sides of the US, so there's some normal latency between them. However, the connections are generally reliable and I'm pumping many messages/second through the federation before shutting the brokers down. (Xref my other thread about extraneous federation exchange traffic.)
> 

Hmn, I wonder if this is somehow linked to the 'leaky bindings' mentioned in that thread - I doubt it somehow. Are you in control of the network - can we be sure that packets aren't being dropped for some reason or another? As Simon intimated, the behaviour you're seeing appears to be client sockets hanging around during shutdown until a timeout is triggered. Perhaps we're not seeing the expected FIN - I'm attempting to reproduce this at the moment. 

From eugene.doktorov at gmail.com  Thu Sep 13 19:36:09 2012
From: eugene.doktorov at gmail.com (eugene)
Date: Thu, 13 Sep 2012 11:36:09 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ - big delays when establishing
	Kombu connection
In-Reply-To: <E128B350-0FBF-4CB4-8EB5-6147F694A330@rabbitmq.com>
References: <1347545056419-21989.post@n5.nabble.com>
	<E128B350-0FBF-4CB4-8EB5-6147F694A330@rabbitmq.com>
Message-ID: <1347561369474-22001.post@n5.nabble.com>

Hi Ask,

Thank you for replying!

I'm not sure how to check if celery/rabbit are using librabbitmq

Here go output from 'locate' command:
SERVER
[eugene.doktorov at ip-10-0-1-60 mlayer]$ sudo locate librabbitmq
/usr/lib/python2.6/site-packages/kombu/transport/librabbitmq.py
/usr/lib/python2.6/site-packages/kombu/transport/librabbitmq.pyc
/usr/lib64/python2.6/site-packages/_librabbitmq.so
/usr/lib64/python2.6/site-packages/librabbitmq
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info
/usr/lib64/python2.6/site-packages/librabbitmq/__init__.py
/usr/lib64/python2.6/site-packages/librabbitmq/__init__.pyc
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/PKG-INFO
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/SOURCES.txt
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/dependency_links.txt
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/installed-files.txt
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/not-zip-safe
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/top_level.txt
/usr/local/lib/librabbitmq.so
/usr/local/lib/pkgconfig/librabbitmq.pc

CLIENT

[eugene.doktorov at prodback1 rabbitmq-c]$ sudo locate librabbitmq
/usr/lib/python2.6/site-packages/kombu/transport/librabbitmq.py
/usr/lib/python2.6/site-packages/kombu/transport/librabbitmq.pyc
/usr/lib64/python2.6/site-packages/_librabbitmq.so
/usr/lib64/python2.6/site-packages/librabbitmq
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info
/usr/lib64/python2.6/site-packages/librabbitmq/__init__.py
/usr/lib64/python2.6/site-packages/librabbitmq/__init__.pyc
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/PKG-INFO
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/SOURCES.txt
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/dependency_links.txt
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/installed-files.txt
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/not-zip-safe
/usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/top_level.txt
/usr/local/lib/librabbitmq.so
/usr/local/lib/pkgconfig/librabbitmq.pc


Is it enough to say that librabbitmq is used?
BTW, I still see the same delays

Eugene




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-big-delays-when-establishing-Kombu-connection-tp21989p22001.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mpietrek at skytap.com  Thu Sep 13 20:26:17 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 13 Sep 2012 12:26:17 -0700
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <49F9DCE2-2ED2-4791-94FC-1FB57D237A8C@rabbitmq.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<5051BD53.3000401@rabbitmq.com>
	<B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>
	<CACLE7ixuiiz6MNuLXHYdLoSnu+p5Drp7++3wvo8umQFCn2=2KQ@mail.gmail.com>
	<49F9DCE2-2ED2-4791-94FC-1FB57D237A8C@rabbitmq.com>
Message-ID: <CACLE7ixf0Jeq1hNSM8ojqaBGTC+4ELpaf2JfbaPtaQV0L0hiMA@mail.gmail.com>

We "own" the network in that it's a direct connection between two
datacenters. It's not a particularly high speed connection, but it's
generally reliable. I've done some ping tests between the two nodes and
while an occasional packet will drop every once in awhile, it's not a
really horrible connection. The average ping round trip time is areound
80ms.

I'd be surprised if it's a dropped packet, as the shutdown on both brokers
seems to consistently take a long time. I just reproed this again, and one
broker took 1000 seconds to shut down, while the other took 995. I have the
logs from this repro, but a quick glance doesn't show anything radically
different. Let me know if there's anything else I can supply.



On Thu, Sep 13, 2012 at 11:32 AM, Tim Watson <tim at rabbitmq.com> wrote:

> On 13 Sep 2012, at 18:06, Matt Pietrek wrote:
>
> > > Is it a possibility that firewall/network configuration between the
> two nodes is causing packets to get dropped?
> >
> > It seems unlikely. The two nodes are on opposite sides of the US, so
> there's some normal latency between them. However, the connections are
> generally reliable and I'm pumping many messages/second through the
> federation before shutting the brokers down. (Xref my other thread about
> extraneous federation exchange traffic.)
> >
>
> Hmn, I wonder if this is somehow linked to the 'leaky bindings' mentioned
> in that thread - I doubt it somehow. Are you in control of the network -
> can we be sure that packets aren't being dropped for some reason or
> another? As Simon intimated, the behaviour you're seeing appears to be
> client sockets hanging around during shutdown until a timeout is triggered.
> Perhaps we're not seeing the expected FIN - I'm attempting to reproduce
> this at the moment.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/e1134866/attachment.htm>

From tim at rabbitmq.com  Thu Sep 13 20:30:21 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 13 Sep 2012 20:30:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <CACLE7ixf0Jeq1hNSM8ojqaBGTC+4ELpaf2JfbaPtaQV0L0hiMA@mail.gmail.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<5051BD53.3000401@rabbitmq.com>
	<B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>
	<CACLE7ixuiiz6MNuLXHYdLoSnu+p5Drp7++3wvo8umQFCn2=2KQ@mail.gmail.com>
	<49F9DCE2-2ED2-4791-94FC-1FB57D237A8C@rabbitmq.com>
	<CACLE7ixf0Jeq1hNSM8ojqaBGTC+4ELpaf2JfbaPtaQV0L0hiMA@mail.gmail.com>
Message-ID: <DF417068-6E61-4473-97DE-3B618014B590@rabbitmq.com>


On 13 Sep 2012, at 20:26, Matt Pietrek wrote:

> We "own" the network in that it's a direct connection between two datacenters. It's not a particularly high speed connection, but it's generally reliable. I've done some ping tests between the two nodes and while an occasional packet will drop every once in awhile, it's not a really horrible connection. The average ping round trip time is areound 80ms.
> 
> I'd be surprised if it's a dropped packet, as the shutdown on both brokers seems to consistently take a long time. I just reproed this again, and one broker took 1000 seconds to shut down, while the other took 995. I have the logs from this repro, but a quick glance doesn't show anything radically different. Let me know if there's anything else I can supply.
> 

Ok - do send the second pair of logs (or a scrubbed version if you need to hide private data) please, as we're keen to get to the bottom of this.

From mpietrek at skytap.com  Thu Sep 13 21:05:45 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 13 Sep 2012 13:05:45 -0700
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <DF417068-6E61-4473-97DE-3B618014B590@rabbitmq.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<5051BD53.3000401@rabbitmq.com>
	<B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>
	<CACLE7ixuiiz6MNuLXHYdLoSnu+p5Drp7++3wvo8umQFCn2=2KQ@mail.gmail.com>
	<49F9DCE2-2ED2-4791-94FC-1FB57D237A8C@rabbitmq.com>
	<CACLE7ixf0Jeq1hNSM8ojqaBGTC+4ELpaf2JfbaPtaQV0L0hiMA@mail.gmail.com>
	<DF417068-6E61-4473-97DE-3B618014B590@rabbitmq.com>
Message-ID: <CACLE7iz-D4xkRy7JuP4F5g0NFtsTWW5htJ+fyuboVXTspKJA0Q@mail.gmail.com>

Here you to Tim:

The scrubbed rabbit at mq1.log:
--------
=INFO REPORT==== 13-Sep-2012::12:00:21 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent

=INFO REPORT==== 13-Sep-2012::12:00:21 ===
    application: rabbitmq_federation
    exited: stopped
    type: permanent

=INFO REPORT==== 13-Sep-2012::12:00:21 ===
Stopping Rabbit

=INFO REPORT==== 13-Sep-2012::12:00:21 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=WARNING REPORT==== 13-Sep-2012::12:00:21 ===
Connection (<0.1659.0>) closing: internal error in channel (<0.1666.0>):
shutdown

=INFO REPORT==== 13-Sep-2012::12:00:21 ===
stopped TCP Listener on 0.0.0.0:5672

=ERROR REPORT==== 13-Sep-2012::12:17:00 ===
** Generic server <0.1676.0> terminating
** Last message in was {inet_async,#Port<0.5748>,5106,{error,etimedout}}
** When Server state == {state,#Port<0.5748>,<0.1671.0>,<0.1673.0>,
                               {method,rabbit_framing_amqp_0_9_1},
                               none}
** Reason for termination ==
** {socket_error,etimedout}

=ERROR REPORT==== 13-Sep-2012::12:17:00 ===
** Generic server <0.1671.0> terminating
** Last message in was {socket_error,etimedout}
** When Server state == {state,amqp_network_connection,
                            {state,#Port<0.5748>,0,<0.1675.0>,131072,
                                undefined,false},
                            <0.1670.0>,<0.1673.0>,
                            {amqp_params_network,<<"guest">>,<<"guest">>,
                                <<"/">>,"slg1matt1.xyz.com",
                                5672,0,0,0,infinity,none,
                                [#Fun<amqp_auth_mechanisms.plain.3>,
                                 #Fun<amqp_auth_mechanisms.amqplain.3>],
                                [],[]},
                            0,
                            [{<<"capabilities">>,table,
                              [{<<"publisher_confirms">>,bool,true},
                               {<<"exchange_exchange_bindings">>,bool,true},
                               {<<"basic.nack">>,bool,true},
                               {<<"consumer_cancel_notify">>,bool,true}]},
                             {<<"copyright">>,longstr,
                              <<"Copyright (C) 2007-2012 VMware, Inc.">>},
                             {<<"information">>,longstr,
                              <<"Licensed under the MPL.  See
http://www.rabbitmq.com/">>},
                             {<<"platform">>,longstr,<<"Erlang/OTP">>},
                             {<<"product">>,longstr,<<"RabbitMQ">>},
                             {<<"version">>,longstr,<<"2.8.6">>}],
                            #Fun<amqp_connection_sup.0.39273983>,
                            #Fun<amqp_connection_sup.2.54430129>,false}
** Reason for termination ==
** {socket_error,etimedout}

=ERROR REPORT==== 13-Sep-2012::12:17:00 ===
** Generic server <0.1657.0> terminating
** Last message in was {'EXIT',<0.197.0>,shutdown}
** When Server state == {state,
                         {upstream,
                          {amqp_params_network,<<"guest">>,<<"guest">>,
                           <<"/">>,"slg1matt1.xyz.com",5672,0,
                           0,0,infinity,none,
                           [#Fun<amqp_auth_mechanisms.plain.3>,
                            #Fun<amqp_auth_mechanisms.amqplain.3>],
                           [],[]},

<<"skytap">>,1000,1,1,none,none,none,"upstream-slg"},
                         <0.1671.0>,<0.1683.0>,
                         <<"federation: skytap -> rabbit at mq1.matt.xyz.com
">>,
                         <<"federation: skytap -> rabbit at mq1.matt.xyz.comA">>,
                         {0,nil},
                         115,
                         {dict,10,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],
                            [[{<<"charon.us-east.default">>,[]}|
                              {set,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],
                                 [{resource,<<"/">>,exchange,
                                   <<"federation: skytap ->
rabbit at slg1matt1.xyz.com A">>}],
                                 [],[],[]}}}]],
                            [],
                            [[{<<"cmcmd.us-east.default">>,[]}|
                              {set,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],
                                 [{resource,<<"/">>,exchange,
                                   <<"federation: skytap ->
rabbit at slg1matt1.xyz.com A">>}],
                                 [],[],[]}}}],
                             [{<<"charon.us-west.default">>,[]}|
                              {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],
                                 [{resource,<<"/">>,queue,<<"charon">>}],
                                 [],[],[],[],[],[],[],[],
                                 [{resource,<<"/">>,exchange,
                                   <<"federation: skytap ->
rabbit at slg1matt1.xyz.com A">>}],
                                 [],[],[]}}}]],
                            [],
                            [[{<<"cmcmd.us-west.default">>,[]}|
                              {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],
                                 [{resource,<<"/">>,queue,<<"cmcmd">>}],
                                 [],[],[],[],[],[],
                                 [{resource,<<"/">>,exchange,
                                   <<"federation: skytap ->
rabbit at slg1matt1.xyz.com A">>}],
                                 [],[],[]}}}]],
                            [],
                            [[{<<"system_test.us-east.default">>,[]}|
                              {set,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],
                                 [{resource,<<"/">>,exchange,
                                   <<"federation: skytap ->
rabbit at slg1matt1.xyz.com A">>}],
                                 [],[],[]}}}]],
                            [],
                            [[{<<"system_test.us-west.default">>,[]}|
                              {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],

[{resource,<<"/">>,queue,<<"system_test">>}],
                                 [],[],[],[],[],[],[],[],[],[],
                                 [{resource,<<"/">>,exchange,
                                   <<"federation: skytap ->
rabbit at slg1matt1.xyz.com A">>}],
                                 [],[],[]}}}]],
                            [],[],
                            [[{<<"unit_test.us-east.default">>,[]}|
                              {set,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],
                                 [{resource,<<"/">>,exchange,
                                   <<"federation: skytap ->
rabbit at slg1matt1.xyz.com A">>}],
                                 [],[],[]}}}]],
                            [[{<<"ConfigurationManager.us-east.default">>,
                               []}|
                              {set,1,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],[],[],[],[],
                                 [{resource,<<"/">>,exchange,
                                   <<"federation: skytap ->
rabbit at slg1matt1.xyz.com A">>}],
                                 [],[],[]}}}]],
                            [[{<<"unit_test.us-west.default">>,[]}|
                              {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],[],
                                 [{resource,<<"/">>,queue,<<"unit_test">>}],
                                 [],[],[],
                                 [{resource,<<"/">>,exchange,
                                   <<"federation: skytap ->
rabbit at slg1matt1.xyz.com A">>}],
                                 [],[],[]}}}]],
                            [[{<<"ConfigurationManager.us-west.default">>,
                               []}|
                              {set,2,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                               {{[],[],[],[],[],[],[],
                                 [{resource,<<"/">>,queue,
                                   <<"ConfigurationManager">>}],
                                 [],[],[],[],
                                 [{resource,<<"/">>,exchange,
                                   <<"federation: skytap ->
rabbit at slg1matt1.xyz.com A">>}],
                                 [],[],[]}}}]]}}},
                         <0.1659.0>,<0.1666.0>,
                         {resource,<<"/">>,exchange,<<"skytap">>},
                         {0,nil}}
** Reason for termination ==
** {undef,
       [{rabbit_federation_old_status,report,
            [{upstream,
                 {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                     "slg1matt1.xyz.com",5672,0,0,0,infinity,
                     none,
                     [#Fun<amqp_auth_mechanisms.plain.3>,
                      #Fun<amqp_auth_mechanisms.amqplain.3>],
                     [],[]},
                 <<"skytap">>,1000,1,1,none,none,none,"upstream-slg"},
             {resource,<<"/">>,exchange,<<"skytap">>},
             shutdown],
            []},
        {rabbit_federation_link,terminate,2,[]},
        {gen_server2,terminate,3,[]},
        {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
** In 'terminate' callback with reason ==
** shutdown

=INFO REPORT==== 13-Sep-2012::12:17:00 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 13-Sep-2012::12:17:00 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 13-Sep-2012::12:17:00 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 13-Sep-2012::12:17:00 ===
Halting Erlang VM
--------

And the scrubbed rabbit at mq1-sasl.log:

--------
=SUPERVISOR REPORT==== 13-Sep-2012::12:00:21 ===
     Supervisor: {<0.1664.0>,amqp_channel_sup}
     Context:    child_terminated
     Reason:     shutdown
     Offender:   [{pid,<0.1666.0>},
                  {name,channel},
                  {mfa,{amqp_channel,start_link,
                                     [direct,<0.1659.0>,1,<0.1665.0>,
                                      #Fun<amqp_channel_sup.0.24953263>]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 13-Sep-2012::12:00:21 ===
     Supervisor: {<0.1664.0>,amqp_channel_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.1666.0>},
                  {name,channel},
                  {mfa,{amqp_channel,start_link,
                                     [direct,<0.1659.0>,1,<0.1665.0>,
                                      #Fun<amqp_channel_sup.0.24953263>]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 13-Sep-2012::12:17:00 ===
  crasher:
    initial call: amqp_main_reader:init/1
    pid: <0.1676.0>
    registered_name: []
    exception exit: {socket_error,etimedout}
      in function  gen_server:terminate/6 (gen_server.erl, line 747)
    ancestors: [<0.1674.0>,<0.1670.0>,amqp_sup,<0.240.0>]
    messages: []
    links: [<0.1674.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 2529
  neighbours:

=CRASH REPORT==== 13-Sep-2012::12:17:00 ===
  crasher:
    initial call: amqp_gen_connection:init/1
    pid: <0.1671.0>
    registered_name: []
    exception exit: {socket_error,etimedout}
      in function  gen_server:terminate/6 (gen_server.erl, line 747)
    ancestors: [<0.1670.0>,amqp_sup,<0.240.0>]
    messages: []
    links: [<0.1670.0>,#Port<0.5748>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 805
  neighbours:

=SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
     Supervisor: {<0.1670.0>,amqp_connection_sup}
     Context:    child_terminated
     Reason:     {socket_error,etimedout}
     Offender:   [{pid,<0.1671.0>},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params_network,<<"guest">>,<<"guest">>,
                               <<"/">>,"slg1matt1.xyz.com",
                               5672,0,0,0,infinity,none,
                               [#Fun<amqp_auth_mechanisms.plain.3>,
                                #Fun<amqp_auth_mechanisms.amqplain.3>],
                               [],[]},
                           #Fun<amqp_connection_sup.0.39273983>,
                           #Fun<amqp_connection_sup.2.54430129>,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
     Supervisor: {<0.1670.0>,amqp_connection_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.1671.0>},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params_network,<<"guest">>,<<"guest">>,
                               <<"/">>,"slg1matt1.xyz.com",
                               5672,0,0,0,infinity,none,
                               [#Fun<amqp_auth_mechanisms.plain.3>,
                                #Fun<amqp_auth_mechanisms.amqplain.3>],
                               [],[]},
                           #Fun<amqp_connection_sup.0.39273983>,
                           #Fun<amqp_connection_sup.2.54430129>,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
     Supervisor: {<0.1674.0>,
                                           amqp_connection_type_sup}
     Context:    child_terminated
     Reason:     {socket_error,etimedout}
     Offender:   [{pid,<0.1676.0>},
                  {name,main_reader},
                  {mfa,
                      {amqp_main_reader,start_link,
                          [#Port<0.5748>,<0.1671.0>,<0.1673.0>,
                           {method,rabbit_framing_amqp_0_9_1}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
     Supervisor: {<0.1674.0>,
                                           amqp_connection_type_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.1676.0>},
                  {name,main_reader},
                  {mfa,
                      {amqp_main_reader,start_link,
                          [#Port<0.5748>,<0.1671.0>,<0.1673.0>,
                           {method,rabbit_framing_amqp_0_9_1}]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 13-Sep-2012::12:17:00 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.1657.0>
    registered_name: []
    exception exit: {undef,
                        [{rabbit_federation_old_status,report,
                             [{upstream,
                                  {amqp_params_network,<<"guest">>,
                                      <<"guest">>,<<"/">>,
                                      "slg1matt1.xyz.com",
                                      5672,0,0,0,infinity,none,
                                      [#Fun<amqp_auth_mechanisms.plain.3>,

#Fun<amqp_auth_mechanisms.amqplain.3>],
                                      [],[]},
                                  <<"skytap">>,1000,1,1,none,none,none,
                                  "upstream-slg"},
                              {resource,<<"/">>,exchange,<<"skytap">>},
                              shutdown],
                             []},
                         {rabbit_federation_link,terminate,2,[]},
                         {gen_server2,terminate,3,[]},
                         {proc_lib,init_p_do_apply,3,
                             [{file,"proc_lib.erl"},{line,227}]}]}
      in function  gen_server2:terminate/3
    ancestors: [<0.197.0>,<0.194.0>,rabbit_federation_link_sup_sup,
                  rabbit_federation_sup,rabbit_sup,<0.143.0>]
    messages: [{'DOWN',#Ref<0.0.0.8909>,process,<0.1683.0>,shutdown}]
    links: []
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 9640
  neighbours:

=SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
     Supervisor: {<0.197.0>,
                                           rabbit_federation_link_sup}
     Context:    shutdown_error
     Reason:     {undef,
                     [{rabbit_federation_old_status,report,
                          [{upstream,
                               {amqp_params_network,<<"guest">>,<<"guest">>,
                                   <<"/">>,
                                   "slg1matt1.xyz.com",5672,0,
                                   0,0,infinity,none,
                                   [#Fun<amqp_auth_mechanisms.plain.3>,
                                    #Fun<amqp_auth_mechanisms.amqplain.3>],
                                   [],[]},
                               <<"skytap">>,1000,1,1,none,none,none,
                               "upstream-slg"},
                           {resource,<<"/">>,exchange,<<"skytap">>},
                           shutdown],
                          []},
                      {rabbit_federation_link,terminate,2,[]},
                      {gen_server2,terminate,3,[]},
                      {proc_lib,init_p_do_apply,3,
                          [{file,"proc_lib.erl"},{line,227}]}]}
     Offender:   [{pid,<0.1657.0>},
                  {name,
                      {upstream,
                          {amqp_params_network,<<"guest">>,<<"guest">>,
                              <<"/">>,"slg1matt1.xyz.com",
                              5672,0,0,0,infinity,none,
                              [#Fun<amqp_auth_mechanisms.plain.3>,
                               #Fun<amqp_auth_mechanisms.amqplain.3>],
                              [],[]},
                          <<"skytap">>,1000,1,1,none,none,none,
                          "upstream-slg"}},
                  {mfa,
                      {rabbit_federation_link,start_link,
                          [{{upstream,

{amqp_params_network,<<"guest">>,<<"guest">>,
                                    <<"/">>,
                                    "slg1matt1.xyz.com",5672,
                                    0,0,0,infinity,none,
                                    [#Fun<amqp_auth_mechanisms.plain.3>,
                                     #Fun<amqp_auth_mechanisms.amqplain.3>],
                                    [],[]},
                                <<"skytap">>,1000,1,1,none,none,none,
                                "upstream-slg"},
                            {resource,<<"/">>,exchange,<<"skytap">>}}]}},
                  {restart_type,{permanent,1}},
                  {shutdown,4294967295},
                  {child_type,worker}]

--------

On Thu, Sep 13, 2012 at 12:30 PM, Tim Watson <tim at rabbitmq.com> wrote:

>
> On 13 Sep 2012, at 20:26, Matt Pietrek wrote:
>
> > We "own" the network in that it's a direct connection between two
> datacenters. It's not a particularly high speed connection, but it's
> generally reliable. I've done some ping tests between the two nodes and
> while an occasional packet will drop every once in awhile, it's not a
> really horrible connection. The average ping round trip time is areound
> 80ms.
> >
> > I'd be surprised if it's a dropped packet, as the shutdown on both
> brokers seems to consistently take a long time. I just reproed this again,
> and one broker took 1000 seconds to shut down, while the other took 995. I
> have the logs from this repro, but a quick glance doesn't show anything
> radically different. Let me know if there's anything else I can supply.
> >
>
> Ok - do send the second pair of logs (or a scrubbed version if you need to
> hide private data) please, as we're keen to get to the bottom of this.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/480453f5/attachment.htm>

From curylod at asme.org  Thu Sep 13 21:27:34 2012
From: curylod at asme.org (Dave Curylo)
Date: Thu, 13 Sep 2012 16:27:34 -0400
Subject: [rabbitmq-discuss] Regex exchange? (was: Binding to topic
	exchange with a negation wildcard)
In-Reply-To: <CC77761F.4960%Michael.Laing@nytimes.com>
References: <5051F9C6.4040909@rabbitmq.com>
	<CC77761F.4960%Michael.Laing@nytimes.com>
Message-ID: <CAAqmy6MLJ9F-B+pXpSuB2bB67QhqXgBTK=CGm-T-Z_BHj34APQ@mail.gmail.com>

I'm not so interested in regex, and certainly wouldn't prefer that over
performance. In my case, I have control over the names of topics, so I'm
not going to be matching any complex patterns that would see the need for a
regex.  If it's easy enough to add, I'm sure there are others that could
take advantage of it.

On Thu, Sep 13, 2012 at 12:05 PM, Laing, Michael P. <
Michael.Laing at nytimes.com> wrote:

> Interesting! It's more of a "nice-to-have" option for me, much less
> important than good performance, reliable federation, etc.
>
> Multiple bindings and sender-selected distribution add richness as well
> that mitigate the need.
>
> And we have a scheme for distilling complex combinations of subscriber
> roles and topic interests into multiple pairs of symmetric 128 character
> strings which, with separating periods, create 255 char keys that are used
> for binding 'sieves' and publishing 'patterns' respectively in topic
> exchanges.
>
> Seems quite fast. Actually my developers are still scratching their heads
> and not actually using it yet - but it's good to get out in front of them
> sometimes :)
>
> Plus there's a lot of headroom left in the scheme if we fully exploit the
> depth of each character position, so we should be able to stay out front
> for awhile?
>
> ml
>
> On 9/13/12 11:20 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
>
> >On 13/09/12 15:53, Laing, Michael P. wrote:
> >> We would find a regular expression matching option for topic exchanges
> >> most useful.
> >>
> >> My 2 cents:)
> >
> >Well, there's a reason AMQP didn't just specify regexs for topic
> >exchanges in the first place - it won't go anything like as fast when
> >you have a reasonable number of bindings.
> >
> >Basically, the topic globbing in AMQP is simple enough that we don't
> >have to look at every binding for every message (and yes, this really
> >does make a huge difference!):
> >
> >
> http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routi
> >ng-part-1/
> >
> http://www.rabbitmq.com/blog/2011/03/28/very-fast-and-scalable-topic-routi
> >ng-part-2/
> >
> >If we were to have a regex exchange, we'd have to check every binding
> >against every published message. There's no clever way to do it.
> >
> >However.
> >
> >You might not actually care, if your RabbitMQ broker is nowhere near CPU
> >bound already. And it would be pretty easy to write. So is there general
> >interest in a regex exchange? (With the proviso that it would be notably
> >slower than the existing topic exchange...)
> >
> >Cheers, Simon
> >
> >--
> >Simon MacMullen
> >RabbitMQ, VMware
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/5afd7956/attachment.htm>

From curylod at asme.org  Thu Sep 13 21:47:52 2012
From: curylod at asme.org (Dave Curylo)
Date: Thu, 13 Sep 2012 16:47:52 -0400
Subject: [rabbitmq-discuss] Binding to topic exchange with a negation
	wildcard
In-Reply-To: <CC776AF2.4953%Michael.Laing@nytimes.com>
References: <50519C17.4020102@rabbitmq.com>
	<CC776AF2.4953%Michael.Laing@nytimes.com>
Message-ID: <CAAqmy6MvHUGDf0YUkQtn==9AQ_oeQySU38KUBF=-kB9SYk-c4A@mail.gmail.com>

The fanout + alternate-exchange for junk works, except I can't make these
extra exchanges exclusive like I can when declaring a server assigned,
exclusive, autodelete queue with queueDeclare(). That's probably not a big
deal, as nobody would likely guess the names of these extra exchanges.

I think I'd take a simple negation binding over a full regex if there are
performance implications. Negation bindings obviously would need to be
declared before other bindings or a match could be found before it got to
the negation, but I think that's reasonable - typical rules processing
works this way. It doesn't seem like with these types of negations would
have performance implications with the caveat that they must be earlier in
the list of bindings.

On Thu, Sep 13, 2012 at 10:53 AM, Laing, Michael P. <
Michael.Laing at nytimes.com> wrote:

> We would find a regular expression matching option for topic exchanges
> most useful.
>
> My 2 cents :)
>
> Michael
>
> On 9/13/12 4:40 AM, "Simon MacMullen" <simon at rabbitmq.com> wrote:
>
> >On 12/09/2012 8:37PM, Dave Curylo wrote:
> >> Is it possible to bind a queue to a topic exchange with a condition that
> >> the topic does NOT match a certain wildcard?
> >
> >The topic exchange doesn't have that logic. But you can fake it with the
> >alternate exchange feature, at the cost of a few more exchanges.
> >
> >Declare a fanout exchange you'll publish to (let's call it
> >"my-exchange"). Declare a fanout exchange called "junk".
> >
> >The when each consumer declares a queue, it also declares a topic
> >exchange and a fanout exchange. The alternate-exchange for the topic
> >exchange should be set to the fanout exchange. It then binds the topic
> >exchange to "my-exchange", and "junk" to the topic exchange, with a
> >routing key equal to the topics it doesn't want.
> >
> >Thus messages with the "bad" routing key go:
> >
> >   [my-exchange] -> [per-consumer-topic] -> [junk]
> >
> >and the rest go:
> >
> >   [my-exchange] -> [per-consumer-topic] -> [per-consumer-fanout] ->
> >[per-consumer-queue]
> >
> >I think that's the simplest you can make it. But exchanges are cheap in
> >general, it's just routing logic.
> >
> >But I wonder whether some sort of more explicit negation feature would
> >be feasible / useful. Hmm.
> >
> >Cheers, Simon
> >_______________________________________________
> >rabbitmq-discuss mailing list
> >rabbitmq-discuss at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120913/664e4c6d/attachment.htm>

From matthias at rabbitmq.com  Thu Sep 13 22:18:55 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 13 Sep 2012 22:18:55 +0100
Subject: [rabbitmq-discuss] Binding to topic exchange with a negation
 wildcard
In-Reply-To: <CAAqmy6MvHUGDf0YUkQtn==9AQ_oeQySU38KUBF=-kB9SYk-c4A@mail.gmail.com>
References: <50519C17.4020102@rabbitmq.com>
	<CC776AF2.4953%Michael.Laing@nytimes.com>
	<CAAqmy6MvHUGDf0YUkQtn==9AQ_oeQySU38KUBF=-kB9SYk-c4A@mail.gmail.com>
Message-ID: <50524DBF.803@rabbitmq.com>

Dave,

On 13/09/12 21:47, Dave Curylo wrote:
> The fanout + alternate-exchange for junk works, except I can't make
> these extra exchanges exclusive like I can when declaring a server
> assigned, exclusive, autodelete queue with queueDeclare(). That's
> probably not a big deal, as nobody would likely guess the names of these
> extra exchanges.

If you make the names cryptographically strong names then nobody can 
guess them.

> I think I'd take a simple negation binding over a full regex if there
>  are performance implications. [...] It doesn't seem like with these
> types of negations would have performance implications.

Firstly, the semantics of multiple bindings with the same destination is 
that of disjunction - the message is routed to the destination if it 
matches one or more of the bindings. By contrast, what you seem to want 
is a conjunction of negations. Or, equivalently, a negated disjunction. 
I suppose the later could be expressed as a single binding, using 
binding parameters to hold all the constituent parts, but it would be 
far from natural.

Secondly, we don't store bindings in a list. There is a fairly 
sophisticated data structure and algorithm underpinning the topic 
matching. See

http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1/

and

http://www.rabbitmq.com/blog/2011/03/28/very-fast-and-scalable-topic-routing-part-2/

I am pretty sure negation doesn't fit in there and indeed I wouldn't be 
surprised to discover that introducing negation results in a theoretical 
matching complexity of O(binding_count).


Regards,

Matthias.

From brett.r.cameron at gmail.com  Fri Sep 14 08:49:23 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 14 Sep 2012 19:49:23 +1200
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
In-Reply-To: <50520AB8.7040908@rabbitmq.com>
References: <50520AB8.7040908@rabbitmq.com>
Message-ID: <43EAA0A5-FB57-46DD-8701-B08B118C4B40@gmail.com>

Matthias,

I'd support this move. Have never used "immediate".

Regards,
Brett


Sent from my iPod

On 14/09/2012, at 4:32 AM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Dear Rabbit users,
> 
> AMQP's basic.publish method has two flags - mandatory and immediate - that trigger checks at the server and result in messages getting returned to clients with basic.return when the necessary conditions aren't met. See http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish for the details.
> 
> I can just about see why 'mandatory' may be useful, but 'immediate' has always struck me as a bizarre and I fear that anybody using it may well do so w/o fully understanding the semantics - can't blame them, it *is* bizarre. Because of that, and since it complicates the code in many places, we are considering dropping support for 'immediate'.
> 
> So is anybody actually using the 'immediate' flag?
> 
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mabra77 at gmail.com  Fri Sep 14 09:42:42 2012
From: mabra77 at gmail.com (mabra)
Date: Fri, 14 Sep 2012 01:42:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Looking for architecture garphics/images
Message-ID: <7e4e2ce4-02e6-430f-87bb-647f9c849c5d@googlegroups.com>

Hi All !

I am completely new on RabbitMQ and coming from MSMQ. I am looking for
a detailed graph, which shows, which components are needed and with
which features. I inspected the docs so far, but was not able to find
something like this.

Any links, pointers etc. would be really very welcomed!

Thanks,
++mabra

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120914/275a17a8/attachment.htm>

From tim at rabbitmq.com  Fri Sep 14 10:05:45 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 14 Sep 2012 10:05:45 +0100
Subject: [rabbitmq-discuss] Looking for architecture garphics/images
In-Reply-To: <7e4e2ce4-02e6-430f-87bb-647f9c849c5d@googlegroups.com>
References: <7e4e2ce4-02e6-430f-87bb-647f9c849c5d@googlegroups.com>
Message-ID: <9AB6DDCB-D35A-45CA-A976-69B4CB11162E@rabbitmq.com>

Hi

On 14 Sep 2012, at 09:42, mabra wrote:

> Hi All !
> 
> I am completely new on RabbitMQ and coming from MSMQ. I am looking for
> a detailed graph, which shows, which components are needed and with
> which features. I inspected the docs so far, but was not able to find
> something like this.
> 
> Any links, pointers etc. would be really very welcomed!

When you ask 'which components are needed' are you asking about the dependencies required to install/use rabbit? If so, these are listed in http://www.rabbitmq.com/platforms.html and http://www.rabbitmq.com/which-erlang.html. If there is anything else you need to know, please ask!

Tim

From emile at rabbitmq.com  Fri Sep 14 11:17:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 14 Sep 2012 11:17:29 +0100
Subject: [rabbitmq-discuss] What is a proper workflow for ACKs?
In-Reply-To: <1347553907242-21995.post@n5.nabble.com>
References: <1347553907242-21995.post@n5.nabble.com>
Message-ID: <50530439.4070600@rabbitmq.com>


Hi,

On 13/09/12 17:31, mgornik wrote:
> Is there a way for me to implement this or should I treat ACKs differently?

I think the problem you describe stems from the difference between "at
least once" semantics offered by the broker and "exactly once" semantics
that you require.

One approach to obtain "exactly once" semantics is to add a unique
identifier to messages and make use of a de-duplication cache on the
client side. If a de-duplication cache was in place and an ack gets lost
then the message will be de-duplicated at subsequent delivery.

There is no point persisting acks for the purpose of issuing them after
a crash. You should persist a unique message id instead.


-Emile


From wayne at prjatk.com  Fri Sep 14 12:18:40 2012
From: wayne at prjatk.com (Wayne Douglas)
Date: Fri, 14 Sep 2012 12:18:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ - with IronPython and Visual Studio!?
Message-ID: <CAGfvht=J0Q0hiU5hUDhO8+uKqGmg1v50Gb7LEmKmWv4WR5N80g@mail.gmail.com>

Has anyone tried this?

Is it worth giving it a go? I'm a complete nubz on Python and a fair nubz
with rmq :)

-- 
*--------------------*
*
*
*w://*
*
*
*t: 07525424882*
*
*
*--------------------*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120914/99bb5fd2/attachment.htm>

From milan.gornik at gmail.com  Fri Sep 14 12:31:44 2012
From: milan.gornik at gmail.com (mgornik)
Date: Fri, 14 Sep 2012 04:31:44 -0700 (PDT)
Subject: [rabbitmq-discuss] What is a proper workflow for ACKs?
In-Reply-To: <50530439.4070600@rabbitmq.com>
References: <1347553907242-21995.post@n5.nabble.com>
	<50530439.4070600@rabbitmq.com>
Message-ID: <1347622304126-22013.post@n5.nabble.com>

Hi Emile,

Thank you very much for your reply! I started building such solution in the
meantime. I have one additional question. My first try (with persisting
DeliveryTag and trying to issue acknowledgements from new
connection/channel) was relying on IModel.BasicAck throwing exception when
RabbitMQ has not received ack properly. To me, it seems that it really
detected those messages which were not able to be acknowledged properly. Can
I rely on that behavior (and then persist only MessageIDs of messages which
failed to ack) or should I perists all MessageIDs of all processed messages?
I would like to avoid having to persist all IDs.

Milan



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/What-is-a-proper-workflow-for-ACKs-tp21995p22013.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Fri Sep 14 12:53:19 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 14 Sep 2012 12:53:19 +0100
Subject: [rabbitmq-discuss] What is a proper workflow for ACKs?
In-Reply-To: <1347622304126-22013.post@n5.nabble.com>
References: <1347553907242-21995.post@n5.nabble.com>
	<50530439.4070600@rabbitmq.com>
	<1347622304126-22013.post@n5.nabble.com>
Message-ID: <50531AAF.7040305@rabbitmq.com>

Hi Milan,

On 14/09/12 12:31, mgornik wrote:
> relying on IModel.BasicAck throwing exception when
> RabbitMQ has not received ack properly.

Attempting to acknowledge a message on a different channel from the one
it was received on will always fail and does not provide much useful
information to the client or the broker.

Unfortunately it is not possible to predict whether an acknowledgement
might be lost, so all message IDs must enter the de-duplication cache.
The cache could be limited by number or age of messages if you are
worried about it becoming too big. I suggest you select a size at least
large enough to contain the longest queue on the broker.


-Emile


From randall at trellisapp.com  Fri Sep 14 12:53:04 2012
From: randall at trellisapp.com (Randall Richard)
Date: Fri, 14 Sep 2012 07:53:04 -0400
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
In-Reply-To: <50520AB8.7040908@rabbitmq.com>
References: <50520AB8.7040908@rabbitmq.com>
Message-ID: <CADCLBRhVk_ov8gcLkzNF9RmZiewt81htnpnpymm0Wp-R_DbPvg@mail.gmail.com>

Just curious, are there any benefits for removing it -- is it preventing /
complicating support for other features?

-Randall

On Thu, Sep 13, 2012 at 12:32 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Dear Rabbit users,
>
> AMQP's basic.publish method has two flags - mandatory and immediate - that
> trigger checks at the server and result in messages getting returned to
> clients with basic.return when the necessary conditions aren't met. See
> http://www.rabbitmq.com/amqp-**0-9-1-reference.html#basic.**publish<http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish>for the details.
>
> I can just about see why 'mandatory' may be useful, but 'immediate' has
> always struck me as a bizarre and I fear that anybody using it may well do
> so w/o fully understanding the semantics - can't blame them, it *is*
> bizarre. Because of that, and since it complicates the code in many places,
> we are considering dropping support for 'immediate'.
>
> So is anybody actually using the 'immediate' flag?
>
>
> Regards,
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120914/108ffac2/attachment.htm>

From matthias at rabbitmq.com  Fri Sep 14 12:59:30 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 14 Sep 2012 12:59:30 +0100
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
In-Reply-To: <CADCLBRhVk_ov8gcLkzNF9RmZiewt81htnpnpymm0Wp-R_DbPvg@mail.gmail.com>
References: <50520AB8.7040908@rabbitmq.com>
	<CADCLBRhVk_ov8gcLkzNF9RmZiewt81htnpnpymm0Wp-R_DbPvg@mail.gmail.com>
Message-ID: <50531C22.8080808@rabbitmq.com>

Randall,

On 14/09/12 12:53, Randall Richard wrote:
> Just curious, are there any benefits for removing it -- is it preventing
> / complicating support for other features?

Yes. It accounts for a fair bit logic scattered across the code base and 
we've just found another case where in order to significantly improve 
performance of mirrored queues we'd have to make yet more code aware of 
the 'immediate' flag.

Matthias.


From milan.gornik at gmail.com  Fri Sep 14 13:02:11 2012
From: milan.gornik at gmail.com (mgornik)
Date: Fri, 14 Sep 2012 05:02:11 -0700 (PDT)
Subject: [rabbitmq-discuss] What is a proper workflow for ACKs?
In-Reply-To: <50531AAF.7040305@rabbitmq.com>
References: <1347553907242-21995.post@n5.nabble.com>
	<50530439.4070600@rabbitmq.com>
	<1347622304126-22013.post@n5.nabble.com>
	<50531AAF.7040305@rabbitmq.com>
Message-ID: <1347624131937-22017.post@n5.nabble.com>

Unfortunately, I can't afford keeping all IDs of all messages sent through
Rabbit. Can you tell me in which cases would ACK get lost after it is being
accepted by IModel.BasicAck without exception being thrown? I am asking
because I would like to asses the risk I'm taking if I decide to rely on
catching exceptions and inserting to deduplication cache from there.

Btw thanks again for the prompt reply.
Milan



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/What-is-a-proper-workflow-for-ACKs-tp21995p22017.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Fri Sep 14 13:03:03 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 14 Sep 2012 13:03:03 +0100
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
In-Reply-To: <CADCLBRhVk_ov8gcLkzNF9RmZiewt81htnpnpymm0Wp-R_DbPvg@mail.gmail.com>
References: <50520AB8.7040908@rabbitmq.com>
	<CADCLBRhVk_ov8gcLkzNF9RmZiewt81htnpnpymm0Wp-R_DbPvg@mail.gmail.com>
Message-ID: <50531CF7.6050608@rabbitmq.com>

On 14/09/12 12:53, Randall Richard wrote:
> Just curious, are there any benefits for removing it -- is it preventing
> / complicating support for other features?

Well, the specific thing that we've bumped into in this case is that 
support for immediate is greatly slowing down HA queues. We could be 
smarter about this, at the cost of tangling the code further. So if we 
want to make HA queues faster (and we do!) we can either keep immediate 
and add a bunch of code at the same time, or remove immediate and delete 
a bunch of code.

There are quite a number of places where we have notably greater 
complexity just to support this weird feature that (we suspect) no-one 
uses. It just feels very disproportionate.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Fri Sep 14 13:25:37 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 14 Sep 2012 13:25:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ - with IronPython and Visual
	Studio!?
In-Reply-To: <CAGfvht=J0Q0hiU5hUDhO8+uKqGmg1v50Gb7LEmKmWv4WR5N80g@mail.gmail.com>
References: <CAGfvht=J0Q0hiU5hUDhO8+uKqGmg1v50Gb7LEmKmWv4WR5N80g@mail.gmail.com>
Message-ID: <CACOPnvenF9-Aqt603qQzPs0_3k+1SQQKJYY498D5gpRt8f7NdQ@mail.gmail.com>

Yes, it is worth giving it a go.

:-)

On Fri, Sep 14, 2012 at 12:18 PM, Wayne Douglas <wayne at prjatk.com> wrote:
> Has anyone tried this?
>
> Is it worth giving it a go? I'm a complete nubz on Python and a fair nubz
> with rmq :)
>
> --
> --------------------
>
> w://
>
> t: 07525424882
>
> --------------------
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From randall at trellisapp.com  Fri Sep 14 13:34:01 2012
From: randall at trellisapp.com (Randall Richard)
Date: Fri, 14 Sep 2012 08:34:01 -0400
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
In-Reply-To: <50531CF7.6050608@rabbitmq.com>
References: <50520AB8.7040908@rabbitmq.com>
	<CADCLBRhVk_ov8gcLkzNF9RmZiewt81htnpnpymm0Wp-R_DbPvg@mail.gmail.com>
	<50531CF7.6050608@rabbitmq.com>
Message-ID: <CADCLBRhwn7_L1bXBtEpoe8mikjo96DGinoPBPLZCDsOhY6D1gg@mail.gmail.com>

Matthias / Simon, thanks for the background.  I'm not using the immediate
flag, but I've considered using it.

Admittedly, I'm not fully aware of exactly how it works.  It would be
helpful to have a better understanding of the semantics.  Can you explain
what the publisher is notified of (if anything?) when there are 10 queues
bound to an exchange named HighPriority, a message with immediate flag true
is published to HighPriority, and 7 out of the 10 queues have the message
consumed immediately.

-Randall

On Fri, Sep 14, 2012 at 8:03 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 14/09/12 12:53, Randall Richard wrote:
>
>> Just curious, are there any benefits for removing it -- is it preventing
>> / complicating support for other features?
>>
>
> Well, the specific thing that we've bumped into in this case is that
> support for immediate is greatly slowing down HA queues. We could be
> smarter about this, at the cost of tangling the code further. So if we want
> to make HA queues faster (and we do!) we can either keep immediate and add
> a bunch of code at the same time, or remove immediate and delete a bunch of
> code.
>
> There are quite a number of places where we have notably greater
> complexity just to support this weird feature that (we suspect) no-one
> uses. It just feels very disproportionate.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120914/a5317ecc/attachment.htm>

From matthias at rabbitmq.com  Fri Sep 14 13:48:12 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 14 Sep 2012 13:48:12 +0100
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
In-Reply-To: <CADCLBRhwn7_L1bXBtEpoe8mikjo96DGinoPBPLZCDsOhY6D1gg@mail.gmail.com>
References: <50520AB8.7040908@rabbitmq.com>
	<CADCLBRhVk_ov8gcLkzNF9RmZiewt81htnpnpymm0Wp-R_DbPvg@mail.gmail.com>
	<50531CF7.6050608@rabbitmq.com>
	<CADCLBRhwn7_L1bXBtEpoe8mikjo96DGinoPBPLZCDsOhY6D1gg@mail.gmail.com>
Message-ID: <5053278C.2060309@rabbitmq.com>

Richard,

On 14/09/12 13:34, Randall Richard wrote:
> Admittedly, I'm not fully aware of exactly how it works.  It would be
> helpful to have a better understanding of the semantics.  Can you
> explain what the publisher is notified of (if anything?) when there are
> 10 queues bound to an exchange named HighPriority, a message with
> immediate flag true is published to HighPriority, and 7 out of the 10
> queues have the message consumed immediately.

No notification is sent to the publisher in that case. A basic.return is 
only sent if *no* queues were able to send the message to a consumer 
immediately.

Here are a few more warts about 'immediate':

- while a message might get sent out to a consumer straight away, there 
is of course no guarantee that such a message will reach the consumer, 
get processed and ack'ed. If any of these steps go wrong the message 
will end up in the queue (unless the consuming happened with no-ack, in 
which case it is simply lost), even though supposedly it was delivered 
immediately.

- a queue can have a consumer and yet 'immediate' delivery may fail (and 
a basic.return issued) because:
a) the consumer isn't quick enough and a backlog of messages has built up,
b) the consumer has configured a 'basic.qos' prefetch count and that the 
limit has been reached

- the interaction with transactions is not at all obvious. This does 
apply to 'mandatory' too though. See 
http://www.rabbitmq.com/semantics.html#tx

Regards,

Matthias.

From emile at rabbitmq.com  Fri Sep 14 13:59:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 14 Sep 2012 13:59:45 +0100
Subject: [rabbitmq-discuss] What is a proper workflow for ACKs?
In-Reply-To: <1347624131937-22017.post@n5.nabble.com>
References: <1347553907242-21995.post@n5.nabble.com>
	<50530439.4070600@rabbitmq.com>
	<1347622304126-22013.post@n5.nabble.com>
	<50531AAF.7040305@rabbitmq.com>
	<1347624131937-22017.post@n5.nabble.com>
Message-ID: <50532A41.3080403@rabbitmq.com>

Hi,

On 14/09/12 13:02, mgornik wrote:
> Unfortunately, I can't afford keeping all IDs of all messages sent through
> Rabbit. Can you tell me in which cases would ACK get lost after it is being
> accepted by IModel.BasicAck without exception being thrown?

If an ACK is lost then the message consumer will always see the network
connection drop and hence an exception. Without any synchronous calls on
the channel it may be hard to determine how many ACKs were lost. You
could use transactions to make this determination:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.tx


-Emile



From randall at trellisapp.com  Fri Sep 14 14:20:32 2012
From: randall at trellisapp.com (Randall Richard)
Date: Fri, 14 Sep 2012 09:20:32 -0400
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
In-Reply-To: <5053278C.2060309@rabbitmq.com>
References: <50520AB8.7040908@rabbitmq.com>
	<CADCLBRhVk_ov8gcLkzNF9RmZiewt81htnpnpymm0Wp-R_DbPvg@mail.gmail.com>
	<50531CF7.6050608@rabbitmq.com>
	<CADCLBRhwn7_L1bXBtEpoe8mikjo96DGinoPBPLZCDsOhY6D1gg@mail.gmail.com>
	<5053278C.2060309@rabbitmq.com>
Message-ID: <CADCLBRiRQGnNqR7ar_dnazooGk9-JtGwDgoqO7nS35CKE8hu_A@mail.gmail.com>

Matthias, thanks for the explanation.  Considering your points below, I now
have a better understanding on your thought that the actual use-cases and
practicality to publish messages with the immediate flag are minimal.  In
light of the details, I won't be using it -- faster mirrored queues sounds
better to me.  :o)

-Randall

On Fri, Sep 14, 2012 at 8:48 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Richard,
>
>
> On 14/09/12 13:34, Randall Richard wrote:
>
>> Admittedly, I'm not fully aware of exactly how it works.  It would be
>> helpful to have a better understanding of the semantics.  Can you
>> explain what the publisher is notified of (if anything?) when there are
>> 10 queues bound to an exchange named HighPriority, a message with
>> immediate flag true is published to HighPriority, and 7 out of the 10
>> queues have the message consumed immediately.
>>
>
> No notification is sent to the publisher in that case. A basic.return is
> only sent if *no* queues were able to send the message to a consumer
> immediately.
>
> Here are a few more warts about 'immediate':
>
> - while a message might get sent out to a consumer straight away, there is
> of course no guarantee that such a message will reach the consumer, get
> processed and ack'ed. If any of these steps go wrong the message will end
> up in the queue (unless the consuming happened with no-ack, in which case
> it is simply lost), even though supposedly it was delivered immediately.
>
> - a queue can have a consumer and yet 'immediate' delivery may fail (and a
> basic.return issued) because:
> a) the consumer isn't quick enough and a backlog of messages has built up,
> b) the consumer has configured a 'basic.qos' prefetch count and that the
> limit has been reached
>
> - the interaction with transactions is not at all obvious. This does apply
> to 'mandatory' too though. See http://www.rabbitmq.com/**semantics.html#tx<http://www.rabbitmq.com/semantics.html#tx>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120914/a107124f/attachment.htm>

From ask at rabbitmq.com  Fri Sep 14 15:09:34 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Fri, 14 Sep 2012 15:09:34 +0100
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
In-Reply-To: <5053278C.2060309@rabbitmq.com>
References: <50520AB8.7040908@rabbitmq.com>
	<CADCLBRhVk_ov8gcLkzNF9RmZiewt81htnpnpymm0Wp-R_DbPvg@mail.gmail.com>
	<50531CF7.6050608@rabbitmq.com>
	<CADCLBRhwn7_L1bXBtEpoe8mikjo96DGinoPBPLZCDsOhY6D1gg@mail.gmail.com>
	<5053278C.2060309@rabbitmq.com>
Message-ID: <88D531DE-3393-4881-BBD5-61D5922BD804@rabbitmq.com>


On 14 Sep 2012, at 13:48, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Richard,
> 
> On 14/09/12 13:34, Randall Richard wrote:
>> Admittedly, I'm not fully aware of exactly how it works.  It would be
>> helpful to have a better understanding of the semantics.  Can you
>> explain what the publisher is notified of (if anything?) when there are
>> 10 queues bound to an exchange named HighPriority, a message with
>> immediate flag true is published to HighPriority, and 7 out of the 10
>> queues have the message consumed immediately.
> 
> No notification is sent to the publisher in that case. A basic.return is only sent if *no* queues were able to send the message to a consumer immediately.
> 
> Here are a few more warts about 'immediate':
> 
> - while a message might get sent out to a consumer straight away, there is of course no guarantee that such a message will reach the consumer, get processed and ack'ed. If any of these steps go wrong the message will end up in the queue (unless the consuming happened with no-ack, in which case it is simply lost), even though supposedly it was delivered immediately.
> 
> - a queue can have a consumer and yet 'immediate' delivery may fail (and a basic.return issued) because:
> a) the consumer isn't quick enough and a backlog of messages has built up,
> b) the consumer has configured a 'basic.qos' prefetch count and that the limit has been reached


Couldn't it be possible emulate immediate by delivering to a TTL'ed queue, then having a dead-letter queue that the publisher consumes from to be notified that a message has not been consumed?

From matthias at rabbitmq.com  Fri Sep 14 15:20:20 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 14 Sep 2012 15:20:20 +0100
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
In-Reply-To: <88D531DE-3393-4881-BBD5-61D5922BD804@rabbitmq.com>
References: <50520AB8.7040908@rabbitmq.com>
	<CADCLBRhVk_ov8gcLkzNF9RmZiewt81htnpnpymm0Wp-R_DbPvg@mail.gmail.com>
	<50531CF7.6050608@rabbitmq.com>
	<CADCLBRhwn7_L1bXBtEpoe8mikjo96DGinoPBPLZCDsOhY6D1gg@mail.gmail.com>
	<5053278C.2060309@rabbitmq.com>
	<88D531DE-3393-4881-BBD5-61D5922BD804@rabbitmq.com>
Message-ID: <50533D24.6060302@rabbitmq.com>

On 14/09/12 15:09, Ask Solem wrote:
> Couldn't it be possible emulate immediate by delivering to a TTL'ed
> queue, then having a dead-letter queue that the publisher consumes
> from to be notified that a message has not been consumed?

Yes. It's not an exact emulation, but arguably more flexible, e.g. it 
gives greater control over how the 'returned' messages are dealt with.

Matthias.

From tim at rabbitmq.com  Fri Sep 14 12:58:43 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 14 Sep 2012 12:58:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ - with IronPython and Visual
	Studio!?
In-Reply-To: <CAGfvht=J0Q0hiU5hUDhO8+uKqGmg1v50Gb7LEmKmWv4WR5N80g@mail.gmail.com>
References: <CAGfvht=J0Q0hiU5hUDhO8+uKqGmg1v50Gb7LEmKmWv4WR5N80g@mail.gmail.com>
Message-ID: <730E5739-9A04-4346-BFF5-CB4056113EEB@rabbitmq.com>

Hi

On 14 Sep 2012, at 12:18, Wayne Douglas wrote:

> Has anyone tried this?
> 
> Is it worth giving it a go? I'm a complete nubz on Python and a fair nubz with rmq :)
> 

I'm not sure what the IronPython support in Visual Studio is like, but the .NET libraries should be perfectly usable from IronPython.

From tim at rabbitmq.com  Fri Sep 14 15:34:59 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 14 Sep 2012 15:34:59 +0100
Subject: [rabbitmq-discuss] channel 1 badfun
In-Reply-To: <46E312EB-C6DE-4733-ABA1-D03293465DB1@rabbitmq.com>
References: <CBF8856C-7C53-4DC3-B0D7-71CBEA6716EC@merrells.com>
	<E78BB53C-99EE-478E-B369-1C830E147B3A@rabbitmq.com>
	<46E312EB-C6DE-4733-ABA1-D03293465DB1@rabbitmq.com>
Message-ID: <3CD80CD5-B243-4FB1-985D-EF77447F893C@rabbitmq.com>

Hi John,

Any word on this? Did you check the things that I mentioned below and did you continue to see this behaviour?

Cheers,
Tim

On 1 Sep 2012, at 12:44, Tim Watson wrote:

> John, can you confirm a few things for me please.
> 
> 1. Are both nodes running the same version of rabbit and erlang
> 
> 2. Do the checksums for the rabbit_amqqueue.beam files (in the ebin directory within the broker install dir) match for both nodes
> 
> 3. is hipe compilation enabled
> 
> Cheers
> 
> On 30 Aug 2012, at 23:17, Tim Watson <tim at rabbitmq.com> wrote:
> 
>> Hi John
>> 
>> On 25 Aug 2012, at 00:39, John Merrells wrote:
>> 
>>> 
>>> We have a two node cluster of RabbitMQ 2.8.6 on Erlang 5.8.5.
>>> 
>>> Sometimes one of the servers will peg the cpu and messages will
>>> stop passing through the system. We don't have a reliable way of
>>> reproducing this...
>>> 
>> 
>> There are a few conditions that can cause this to happen. What other symptoms happen when this occurs? Does memory usage go up as well? Does the CPU usage come down eventually, or get stuck?
>> 
>>> But, we do have some curious error reports in the logs. I've read
>>> through rabbit_amqqueue.erl and delegate.erl and I think that
>>> one server is telling the other to execute some function in 
>>> rabbit_amqqueue... but I don't see why that function would be 
>>> 'bad'.
>>> 
>>> Anyone any thoughts on the cpu issue, or this error report?
>>> 
>> 
>> Well we'd certainly like to get to the bottom of it asap. Can you please tell us a bit more about your setup please:
>> 
>> a. cluster setup (i.e., disk vs ram nodes)
>> b. how many queues, are there any HA queues?
>> c. how you're interacting with the broker/cluster (publishers, consumers, exchanges and bindings and so on)
>> 
>> Also if there's any more of the logs (and sasl logs) for both nodes you're able to share, that would also help. If this occurs again and you're able to run `rabbitmqctl report` on the affected node, that would be great.
>> 
>> Cheers,
>> Tim
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From wayne at prjatk.com  Fri Sep 14 15:46:44 2012
From: wayne at prjatk.com (Wayne Douglas)
Date: Fri, 14 Sep 2012 15:46:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ - with IronPython and Visual
	Studio!?
In-Reply-To: <730E5739-9A04-4346-BFF5-CB4056113EEB@rabbitmq.com>
References: <CAGfvht=J0Q0hiU5hUDhO8+uKqGmg1v50Gb7LEmKmWv4WR5N80g@mail.gmail.com>
	<730E5739-9A04-4346-BFF5-CB4056113EEB@rabbitmq.com>
Message-ID: <CAGfvhtn7ir=ouLPY2N4QCGrmJB1M7FgkCZyCSiSCTJbz1OStCA@mail.gmail.com>

i don't mean using the .net client

i was thinking about using it as if it were pure python following the
tutorials

again -  complete nubzz

I have downloaded Ubuntu since the original email and thinking I'll just do
it from there using the "hello, world" tutorial as a starting block.

I use rmq through MassTransit and although it's good I didn't feel I "got"
rmq at all

these tutorials are helping no end :)

On Fri, Sep 14, 2012 at 12:58 PM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi
>
> On 14 Sep 2012, at 12:18, Wayne Douglas wrote:
>
> > Has anyone tried this?
> >
> > Is it worth giving it a go? I'm a complete nubz on Python and a fair
> nubz with rmq :)
> >
>
> I'm not sure what the IronPython support in Visual Studio is like, but the
> .NET libraries should be perfectly usable from IronPython.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
*--------------------*
*
*
*w://*
*
*
*t: 07525424882*
*
*
*--------------------*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120914/ab17d25c/attachment.htm>

From Michael.Laing at nytimes.com  Fri Sep 14 16:40:58 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Fri, 14 Sep 2012 11:40:58 -0400
Subject: [rabbitmq-discuss] is anybody using 'immediate' publish?
In-Reply-To: <50520AB8.7040908@rabbitmq.com>
Message-ID: <CC78C806.49E4%Michael.Laing@nytimes.com>

Plus 1 for faster HA queues and less complexity in the code base.

Michael
NYTimes

On 9/13/12 12:32 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Dear Rabbit users,
>
>AMQP's basic.publish method has two flags - mandatory and immediate -
>that trigger checks at the server and result in messages getting
>returned to clients with basic.return when the necessary conditions
>aren't met. See 
>http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish for the
>details.
>
>I can just about see why 'mandatory' may be useful, but 'immediate' has
>always struck me as a bizarre and I fear that anybody using it may well
>do so w/o fully understanding the semantics - can't blame them, it *is*
>bizarre. Because of that, and since it complicates the code in many
>places, we are considering dropping support for 'immediate'.
>
>So is anybody actually using the 'immediate' flag?
>
>
>Regards,
>
>Matthias.
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From laurent at junctionnetworks.com  Fri Sep 14 17:23:14 2012
From: laurent at junctionnetworks.com (Laurent Domb)
Date: Fri, 14 Sep 2012 12:23:14 -0400
Subject: [rabbitmq-discuss] shovel ipv6 resolving dns name
Message-ID: <333C9868-2079-4349-B12D-56F70FA7051C@junctionnetworks.com>

Hi, 

I set up a test shovel which shovels messages from New York to LA. When I use ipv6 ipaddresses the shovel works. If I exchange the ipv6 addresses with the actual  DNS name it fails. It seems to connect to the ipv4 address first and then just fails. The error msg I get is: 

"{{badmatch,{error,econnrefused}},
 [{rabbit_shovel_worker,make_conn_and_chan,1},
  {rabbit_shovel_worker,handle_cast,2},
  {gen_server2,handle_msg,2},
  {proc_lib,init_p_do_apply,3}]}
"

Is there an erlang kernel option the say go ipv6 first? 



[
{rabbitmq_shovel,
       [{shovels,
         [{banana_order_shovel,
           [{sources,      [{broker, "amqp://guest:jnctn2012 at 2320:104:2001::205a:5672"},
                            {declarations,
                               [{'queue.declare',
                                       [{queue, <<"backup_orders">>},
                                         durable]},
                                {'exchange.declare',
                                       [{exchange, <<"incoming_orders">>},
                                        {type, <<"direct">>},
                                        durable]},
                                {'queue.bind',
                                    [{exchange, <<"incoming_orders">>},
                                     {queue, <<"backup_orders">>},
                                     {routing_key, <<"bananas">>}]}
                               ]}]},
            {destinations, [{broker, "amqp://guest:jnctn2012 at 2320:104:2001::2020::5672"},
                            {declarations,
                               [{'queue.declare',
                                    [{queue, <<"warehouse_foodsection">>},
                                      durable]},
                                {'exchange.declare',
                                       [{exchange, <<"incoming_orders">>},
                                        {type, <<"direct">>},
                                        durable]},
                                {'queue.bind',
                                    [{exchange, <<"incoming_orders">>},
                                     {queue, <<"warehouse_foodsection">>},
                                     {routing_key, <<"bananas">>}]}
                               ]}]},
            {queue, <<"backup_orders">>},
            {prefetch_count, 5},
            {ack_mode, on_confirm},
            {publish_properties, [{delivery_mode, 2}]},
            {publish_fields, [{exchange, <<"incoming_orders">>},
                              {routing_key, <<"bananas">>}]},
            {reconnect_delay, 5}
           ]}
          ]
        }]
     },
....
....
....
...
].


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120914/1442e714/attachment.htm>

From bsellner at seegrid.com  Fri Sep 14 21:07:54 2012
From: bsellner at seegrid.com (Brennan Sellner)
Date: Fri, 14 Sep 2012 16:07:54 -0400
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <504E44F9.1090900@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
	<7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
	<50486CC1.1060209@rabbitmq.com> <5048A4A1.9090307@seegrid.com>
	<504DD68E.3000908@rabbitmq.com> <504E429D.80801@seegrid.com>
	<504E44F9.1090900@rabbitmq.com>
Message-ID: <50538E9A.2020509@seegrid.com>

On 09/10/2012 03:52 PM, Matthias Radestock wrote:
> On 10/09/12 20:42, Brennan Sellner wrote:
>> Well, there goes that theory.  Thanks for the info!
>>
>> I'll see if I can reproduce this in a more controlled environment.  If
>> anyone has further ideas in the meantime, I'm all ears.
>
> Set up some syscall tracing on the rabbit process to see what it's up to
> when you encounter the delay. That would reveal any unexpected fsync's,
> for example.

Short version
-------------

It appears that cleaning up a queue (e.g. auto-delete on channel close) 
requires Rabbit to fsync, even if the queue is non-durable, contains 
only non-persistent messages, and is bound to a non-durable exchange.  A 
portion of our system is still using a query-response architecture, so 
short-lived queues are quite common.  Is there any way to declare a 
queue such that Rabbit doesn't touch the disk at any point in the 
queue's life cycle?

Long version / background
-------------------------

All righty, I think I have a root cause.  In a previous thread 
(http://rabbitmq.1065348.n5.nabble.com/librabbitmq-c-and-amqp-channel-close-tt20334.html), 
we reported that amqp_channel_close was occasionally taking a long time. 
  As a result of that conversation, we implemented an alternate version 
that didn't wait for close-ok, and threw away the close-ok frame when it 
eventually arrived.

It appears that the long-running cleanup done in response to 
amqp_channel_close is at fault here, and is attributed to one of the 
subsequent calls, with the specific one dependent on when the fsync falls.

I've implemented a pair of self-contained test programs that replicate 
the problem, using only librabbitmq-c (the source is available if anyone 
wants it):

amqp-test-recv:
   - Declare a queue and bind it to testSendExchange
   - Consume from the queue infinitely
   - Send a reply to each arriving message
     - To the default exchange
     - Route with the reply-to header of the received message

amqp-test-send:
   - Loops infinitely:
     - Open a channel
     - Declare a server-named queue
     - Consume from it
     - Send a message to testSendExchange, filling in reply-to
     - Wait for the method, header, and body frames of the reply
     - Close the channel *asynchronously*
     - Increment the channel number to be used

amqp-test-send's loop runs at 80 - 220 Hz, depending on system load.

If these are run on the same host as Rabbit, and we hit the hard drive 
hard (e.g. continuously copy large files), we see a slow (0.5 - 7 
seconds) response every few seconds.

If we instead close the channel synchronously in amqp-test-send, the 
slow responses are exclusively associated with amqp_channel_close.

I've experimented with a variety of parameters, and it's pretty 
conclusive that the problem is with cleaning up the server-named reply 
queues.  If I declare them as non-auto-delete, Rabbit doesn't hit the 
disk, and we don't see any timeouts.  However, the queues accumulate, 
and when amqp-test-send is killed, Rabbit is hugely slowed while 
performing all the cleanup.  Ditto if I operate in a single channel, 
rather than closing and recreating the channel on each loop.

So.  The question is: is it possible to declare a queue that's entirely 
transitory, and doesn't result in Rabbit having to hit the disk at any 
point in the queue's life cycle?  I'm currently declaring non-passive, 
non-durable, exclusive, auto-delete queues.  Switching to non-exclusive 
has no effect.  It really seems like there should be *some* way to have 
a lightweight, ephemeral queue...

Thanks,

-Brennan

From supersonicclay at gmail.com  Fri Sep 14 22:24:23 2012
From: supersonicclay at gmail.com (Clay Anderson)
Date: Fri, 14 Sep 2012 14:24:23 -0700 (PDT)
Subject: [rabbitmq-discuss] Looking for architecture garphics/images
In-Reply-To: <7e4e2ce4-02e6-430f-87bb-647f9c849c5d@googlegroups.com>
References: <7e4e2ce4-02e6-430f-87bb-647f9c849c5d@googlegroups.com>
Message-ID: <32c237a7-fb7b-4e4f-849d-d1f89ffed771@googlegroups.com>

These might help:
http://www.rabbitmq.com/resources/erlang-exchange-talk-final/ex.html
http://www.rabbitmq.com/resources/erlang-exchange-talk-final/diagrams/the-rabbitmq-universe.png
 
http://www.slideshare.net/norbu09/rabbitmq-1731778 
http://www.rabbitmq.com/tutorials/amqp-concepts.html 

Plugins (features):
http://www.rabbitmq.com/plugins.html 


On Friday, September 14, 2012 2:42:42 AM UTC-6, mabra wrote:
>
> Hi All !
>
> I am completely new on RabbitMQ and coming from MSMQ. I am looking for
> a detailed graph, which shows, which components are needed and with
> which features. I inspected the docs so far, but was not able to find
> something like this.
>
> Any links, pointers etc. would be really very welcomed!
>
> Thanks,
> ++mabra
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120914/02c419c3/attachment.htm>

From matthias at rabbitmq.com  Fri Sep 14 22:32:55 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 14 Sep 2012 22:32:55 +0100
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <50538E9A.2020509@seegrid.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
	<7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
	<50486CC1.1060209@rabbitmq.com> <5048A4A1.9090307@seegrid.com>
	<504DD68E.3000908@rabbitmq.com> <504E429D.80801@seegrid.com>
	<504E44F9.1090900@rabbitmq.com> <50538E9A.2020509@seegrid.com>
Message-ID: <5053A287.1020400@rabbitmq.com>

Brennan,

On 14/09/12 21:07, Brennan Sellner wrote:
> It appears that cleaning up a queue (e.g. auto-delete on channel
> close) requires Rabbit to fsync, even if the queue is non-durable.

Confirmed. That is certainly unexpected, so I have filed a bug.

What appears to be happening is that we attempt to remove the entries
for the queue from the durable queue and binding tables. Even though
there are no such entries mnesia still writes to its disk log, which we 
subsequently detect and request an fsync.

Looks like we need to get smarter here.

> So.  The question is: is it possible to declare a queue that's
> entirely transitory, and doesn't result in Rabbit having to hit the
> disk at any point in the queue's life cycle?

Apparently not.

> It really seems like there should be *some* way to have a
> lightweight, ephemeral queue...

Yes.


Thanks for your help in tracking this down.


Regards,

Matthias.

From bsellner at seegrid.com  Sat Sep 15 04:22:48 2012
From: bsellner at seegrid.com (Brennan Sellner)
Date: Fri, 14 Sep 2012 23:22:48 -0400
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <5053A287.1020400@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
	<7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
	<50486CC1.1060209@rabbitmq.com> <5048A4A1.9090307@seegrid.com>
	<504DD68E.3000908@rabbitmq.com> <504E429D.80801@seegrid.com>
	<504E44F9.1090900@rabbitmq.com> <50538E9A.2020509@seegrid.com>
	<5053A287.1020400@rabbitmq.com>
Message-ID: <5053F488.7080909@seegrid.com>

Matthias,

On 09/14/2012 05:32 PM, Matthias Radestock wrote:
> What appears to be happening is that we attempt to remove the entries
> for the queue from the durable queue and binding tables. Even though
> there are no such entries mnesia still writes to its disk log, which we
> subsequently detect and request an fsync.
> 
> Looks like we need to get smarter here.

Thanks for the confirmation -- I'll try to architect around it for now.
 I can consolidate some of the queries to use a shared response queue +
correlation id, though not all.  That may get us by until there's a
proper fix.

Thanks!

-Brennan


From matthias at rabbitmq.com  Sat Sep 15 16:06:57 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 15 Sep 2012 16:06:57 +0100
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <5053F488.7080909@seegrid.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
	<7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
	<50486CC1.1060209@rabbitmq.com> <5048A4A1.9090307@seegrid.com>
	<504DD68E.3000908@rabbitmq.com> <504E429D.80801@seegrid.com>
	<504E44F9.1090900@rabbitmq.com> <50538E9A.2020509@seegrid.com>
	<5053A287.1020400@rabbitmq.com> <5053F488.7080909@seegrid.com>
Message-ID: <50549991.6010408@rabbitmq.com>

Brennan,

On 15/09/12 04:22, Brennan Sellner wrote:
>   I can consolidate some of the queries to use a shared response queue +
> correlation id, though not all.

You'd certainly want to avoid designs that create one queue per message, 
e.g. one reply queue per request-response interactions. That's a bit of 
an AMQP anti-pattern ;)

Also, your workaround of making the channel closure asynchronous is a 
good one and will be beneficial even when there is no fsync.

Regards,

Matthias.

From bsellner at seegrid.com  Sat Sep 15 17:04:21 2012
From: bsellner at seegrid.com (Brennan Sellner)
Date: Sat, 15 Sep 2012 12:04:21 -0400
Subject: [rabbitmq-discuss] Occasional slow message on a local machine
In-Reply-To: <50549991.6010408@rabbitmq.com>
References: <500DACA4.206@seegrid.com> <878ve9ijm5.wl%francesco@rabbitmq.com>
	<5047C1CD.10607@seegrid.com>
	<295CF69A-BD84-4080-BE4C-658DD4E98D55@rabbitmq.com>
	<504868BA.9020505@seegrid.com> <504869E1.5010205@rabbitmq.com>
	<7765B277-3620-463D-8D29-1D8AD199D961@rabbitmq.com>
	<50486CC1.1060209@rabbitmq.com> <5048A4A1.9090307@seegrid.com>
	<504DD68E.3000908@rabbitmq.com> <504E429D.80801@seegrid.com>
	<504E44F9.1090900@rabbitmq.com> <50538E9A.2020509@seegrid.com>
	<5053A287.1020400@rabbitmq.com> <5053F488.7080909@seegrid.com>
	<50549991.6010408@rabbitmq.com>
Message-ID: <5054A705.3060104@seegrid.com>

Matthias,

On 09/15/2012 11:06 AM, Matthias Radestock wrote:
> You'd certainly want to avoid designs that create one queue per message,
> e.g. one reply queue per request-response interactions. That's a bit of
> an AMQP anti-pattern ;)

Yeah, I know. :-)  In this case, there are a number of very
short-running scripts that start, connect, make one or a few queries,
then shut down.  We're phasing them out, but need to support them in the
meantime.

> Also, your workaround of making the channel closure asynchronous is a
> good one and will be beneficial even when there is no fsync.

Good to know.  I'll clean it up and push it to github in case it's of
use to others.

Thanks,

-Brennan


From mabra77 at gmail.com  Sat Sep 15 19:54:46 2012
From: mabra77 at gmail.com (mabra)
Date: Sat, 15 Sep 2012 11:54:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Looking for architecture garphics/images
In-Reply-To: <32c237a7-fb7b-4e4f-849d-d1f89ffed771@googlegroups.com>
References: <7e4e2ce4-02e6-430f-87bb-647f9c849c5d@googlegroups.com>
	<32c237a7-fb7b-4e4f-849d-d1f89ffed771@googlegroups.com>
Message-ID: <21725f33-ef1f-4037-8b8a-8d419d7bb4c0@googlegroups.com>

Hi !

Much thanks and sorry for my blindness - could not just parse everything
in the early beginning ;-)

So, my first resume is: On each machine, where I need realiable messages
outgoing, I would need a server. The destination could just be down and
a client has no persistant store. Will see, how lightweight it can be for
ultra small computers, where I would need messaging [Raspberry.PI].

This looks like MSMQ, something I've used until today. This has the charme
to be present - by "one mouse click" on each windows machine, but has
several drawbacks, like not beeing able to work together with other
archs like my debian and it does not have different transports.

Thanks!

++mabra


On Friday, September 14, 2012 11:24:24 PM UTC+2, Clay Anderson wrote:
>
> These might help:
> http://www.rabbitmq.com/resources/erlang-exchange-talk-final/ex.html
>
> http://www.rabbitmq.com/resources/erlang-exchange-talk-final/diagrams/the-rabbitmq-universe.png
>  
> http://www.slideshare.net/norbu09/rabbitmq-1731778 
> http://www.rabbitmq.com/tutorials/amqp-concepts.html 
>
> Plugins (features):
> http://www.rabbitmq.com/plugins.html 
>
>
> On Friday, September 14, 2012 2:42:42 AM UTC-6, mabra wrote:
>>
>> Hi All !
>>
>> I am completely new on RabbitMQ and coming from MSMQ. I am looking for
>> a detailed graph, which shows, which components are needed and with
>> which features. I inspected the docs so far, but was not able to find
>> something like this.
>>
>> Any links, pointers etc. would be really very welcomed!
>>
>> Thanks,
>> ++mabra
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120915/8a57af2f/attachment.htm>

From mark.hingston at vardr.com  Mon Sep 17 05:31:22 2012
From: mark.hingston at vardr.com (Mark Hingston)
Date: Mon, 17 Sep 2012 14:31:22 +1000
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
Message-ID: <5056A79A.1030008@vardr.com>

Hi guys,

I'm new to the list so please forgive me if I forgot any important info. 
First of all thanks to the rabbitmq devs for releasing a great product :)

I'm running Rabbitmq 2.8.4 and connecting to it with a celery / kombu / 
amqplib client. I'm running on Ubuntu 12.04.1 LTS on an Amazon EC2 
instance. After running for quite some time without issue, I saw this 
warning in the Rabbit log:


=INFO REPORT==== 16-Sep-2012::06:49:17 ===

=INFO REPORT==== 16-Sep-2012::06:49:17 ===
Disk free space limit now below limit. Free bytes:2000396288 
Limit:1000000000

=INFO REPORT==== 16-Sep-2012::06:49:17 ===
     alarm_handler: {clear,{resource_limit,disk,rabbit at mq1}}


The amount of free space reported in the log is around twice the amount 
of space that rabbit requires in this instance, so I can't understand 
why this log occurred. Following this rabbit did seem to rate limit all 
clients, so I believe that it was acting as though we had breached the 
limit. There were no subsequent rabbit logs for the next ~24 hours. Not 
knowing much about rate limiting, etc, we actually restarted our amqp 
clients and then rabbit itself, after which everything seemed to start 
working fine again.

This is the output of rabbitmq status (done on the next day, which was 
when i realised there was a throttling issue):

Status of node rabbit at mq1 ...
[{pid,828},
  {running_applications,
      [{rabbitmq_management,"RabbitMQ Management Console","2.8.4"},
       {xmerl,"XML parser","1.2.10"},
       {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.4"},
       {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.4"},
       {webmachine,"webmachine","1.7.0-rmq2.8.4-hg"},
       {mochiweb,"MochiMedia Web Server","1.3-rmq2.8.4-git"},
       {inets,"INETS  CXC 138 49","5.7.1"},
       {rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","2.8.4"},
       {rabbit,"RabbitMQ","2.8.4"},
       {mnesia,"MNESIA  CXC 138 12","4.5"},
       {os_mon,"CPO  CXC 138 46","2.2.7"},
       {sasl,"SASL  CXC 138 11","2.1.10"},
       {amqp_client,"RabbitMQ AMQP Client","2.8.4"},
       {stdlib,"ERTS  CXC 138 10","1.17.5"},
       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
  {os,{unix,linux}},
  {erlang_version,
      "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:2:2] [rq:2] 
[async-threads:30] [kernel-poll:true]\n"},
  {memory,
      [{total,35645328},
       {processes,12347544},
       {processes_used,12333872},
       {system,23297784},
       {atom,1548841},
       {atom_used,1538490},
       {binary,301336},
       {code,17536634},
       {ets,2116424}]},
  {vm_memory_high_watermark,0.3999999998873157},
  {vm_memory_limit,709948211},
  {disk_free_limit,1000000000},
  {disk_free,1808924672},
  {file_descriptors,
[{total_limit,924},{total_used,10},{sockets_limit,829},{sockets_used,6}]},
  {processes,[{limit,1048576},{used,225}]},
  {run_queue,0},
  {uptime,8035}]
...done.

Any help you guys could give with tracking down the cause of this issue 
would be appreciated.

Cheers,
Mark

From matthias at rabbitmq.com  Mon Sep 17 07:07:27 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Sep 2012 07:07:27 +0100
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
In-Reply-To: <5056A79A.1030008@vardr.com>
References: <5056A79A.1030008@vardr.com>
Message-ID: <5056BE1F.5060103@rabbitmq.com>

Mark,

On 17/09/12 05:31, Mark Hingston wrote:
> =INFO REPORT==== 16-Sep-2012::06:49:17 ===
> Disk free space limit now below limit. Free bytes:2000396288
> Limit:1000000000
>
> =INFO REPORT==== 16-Sep-2012::06:49:17 ===
>      alarm_handler: {clear,{resource_limit,disk,rabbit at mq1}}
>
>
> The amount of free space reported in the log is around twice the amount
> of space that rabbit requires in this instance, so I can't understand
> why this log occurred.

That log message actually tells you that everything is fine (again). 
Note the "clear" in the alarm_handler entry.

The text is rather misleading though so I've just committed a fix to 
make it less ambiguous in the next release.

> Any help you guys could give with tracking down the cause of this issue
> would be appreciated.

The problem must have occurred earlier, i.e. there should be a message 
in the logs when the alarm was 'set' (rather than 'clear'ed).

Regards,

Matthias.

From mark.hingston at vardr.com  Mon Sep 17 07:43:17 2012
From: mark.hingston at vardr.com (Mark Hingston)
Date: Mon, 17 Sep 2012 16:43:17 +1000
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
Message-ID: <5056C685.4040709@vardr.com>

Thanks for the reply Matthias. The log change sounds like a good idea.


As for our situation here, the two log messages that I posted were the 
only messages that existed in the log file. That log file covered the 
24-hour period previous to when I noticed the issue and at least 24 
hours before that, most likely back to when rabbitmq was started. We 
didn't see a log saying that the alarm was 'set' previous to the clear 
message. We also didn't see that alarm set afterwards, though we did 
observe that for the next ~24 hours after the 'clear' log, 
rabbitmq/celery were acting very much like the way others have described 
in discussions such as:

https://groups.google.com/forum/#!msg/celery-users/G-tq8SsHkuA/01Ndr2VBZhwJ

The most important behaviour we observed was that our celery worker was 
not receiving rabbit messages, although they seemed to be being sent by 
the producers. So that make me think it's quite likely that rabbitmq did 
think that it was above the disk space threshold and was rate limiting 
producers.

Is it possible we need to change our logging settings in order to see 
these logs?


Some more information about the issue that we saw:


As commented above, this was the only contents of the log when we 
noticed the issue:

=INFO REPORT==== 16-Sep-2012::06:49:17 ===
Disk free space limit now below limit. Free bytes:2000396288 
Limit:1000000000

=INFO REPORT==== 16-Sep-2012::06:49:17 ===
     alarm_handler: {clear,{resource_limit,disk,rabbit at mq1}}


Then we restarted our single celery worker process and we saw these logs:

=INFO REPORT==== 17-Sep-2012::01:16:58 ===
closing AMQP connection <0.1053.112> (10.255.115.80:59994 -> 
10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::01:16:58 ===
closing AMQP connection <0.1045.112> (10.255.115.80:59993 -> 
10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::01:16:59 ===
accepting AMQP connection <0.11515.221> (10.255.115.80:58122 -> 
10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:02 ===
closing AMQP connection <0.11515.221> (10.255.115.80:58122 -> 
10.255.115.80:5672):
{channel0_error,opening,
                 {error,{badarg,{error,bad_module}},
                        'connection.open',
                        [{rabbit_reader,control_throttle,1},
                         {rabbit_reader,handle_method0,2},
                         {rabbit_reader,handle_method0,3},
                         {rabbit_reader,handle_input,3},
                         {rabbit_reader,recvloop,2},
                         {rabbit_reader,start_connection,7},
                         {proc_lib,init_p_do_apply,3}]}}

and the two "accept" / "closing (badarg, bad_module)" logs kept 
repeating as our celery client tried to reconnect. However it was never 
able to reconnect. This message had us a bit baffled.


Then when we restarted rabbitmq, we saw the normal startup logs for 
rabbit, including:

...

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
Memory limit set to 677MB of 1692MB total.

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
Disk free limit set to 953MB

...


followed by:

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
accepting AMQP connection <0.287.0> (10.255.115.80:59031 -> 
10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
accepting AMQP connection <0.295.0> (10.255.115.80:59032 -> 
10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::01:25:33 ===
accepting STOMP connection <0.350.0> (10.255.115.80:42428 -> 
10.255.115.80:61613)

=INFO REPORT==== 17-Sep-2012::01:29:24 ===
accepting AMQP connection <0.2291.0> (10.255.115.80:59376 -> 
10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::05:17:54 ===
accepting AMQP connection <0.18051.3> (10.255.115.80:47455 -> 
10.255.115.80:5672)


And this seemed to be the point at which our celery worker was happy 
again and could receive messages.

However, at this point the messages that had not been delivered to the 
celery worker process were not all of a sudden delivered - they appeared 
to have vanished. This happened despite the fact that I'm confident that 
our celery queue and messages on that queue were both marked as 
persistent. I'm not sure I understand rate limiting well enough to know 
whether or not I should have expected to see these messages be sent to 
our consumer when we restarted rabbitmq.



Also BTW, maybe I have this wrong, but it seems strange that the rabbit 
documentation (http://www.rabbitmq.com/configure.html) refers to the 
default Disk free limit as 1GB but that our default install has it set 
to 1000000000 , which rabbit reports on startup as "Disk free limit set 
to 953MB". Prob should be 1073741824? (Sorry for the massive nitpick) :)

Thanks,
Mark

From matthias at rabbitmq.com  Mon Sep 17 08:21:24 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Sep 2012 08:21:24 +0100
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
In-Reply-To: <5056C685.4040709@vardr.com>
References: <5056C685.4040709@vardr.com>
Message-ID: <5056CF74.8010502@rabbitmq.com>

Mark,

On 17/09/12 07:43, Mark Hingston wrote:
> As for our situation here, the two log messages that I posted were
> the only messages that existed in the log file. That log file covered
> the 24-hour period previous to when I noticed the issue and at least
> 24 hours before that, most likely back to when rabbitmq was started.
> We didn't see a log saying that the alarm was 'set' previous to the
> clear message.

The alarm must have been set previously, and there must have been a
corresponding log message.

The first message a starting rabbit writes to the logs is usually
something like

=INFO REPORT==== 17-Sep-2012::07:54:14 ===
Limiting to approx 16284 file handles (14653 sockets)

If you don't see that in your logs then they don't go back far enough.

>  The most important behaviour we observed was that our celery worker
> was not receiving rabbit messages, although they seemed to be being
> sent by the producers. So that make me think it's quite likely that
> rabbitmq did think that it was above the disk space threshold and was
> rate limiting producers.

I suggest that in the future you look at the management UI. That makes 
it very clear (things go 'red') when there is an alarm condition and 
when connections are getting throttled or blocked.

> =ERROR REPORT==== 17-Sep-2012::01:17:02 === closing AMQP connection
> <0.11515.221> (10.255.115.80:58122 -> 10.255.115.80:5672):
> {channel0_error,opening, {error,{badarg,{error,bad_module}},
> 'connection.open', [{rabbit_reader,control_throttle,1},
> {rabbit_reader,handle_method0,2}, {rabbit_reader,handle_method0,3},
> {rabbit_reader,handle_input,3}, {rabbit_reader,recvloop,2},
> {rabbit_reader,start_connection,7}, {proc_lib,init_p_do_apply,3}]}}
>
> and the two "accept" / "closing (badarg, bad_module)" logs kept
> repeating as our celery client tried to reconnect. However it was
> never able to reconnect. This message had us a bit baffled.

Something must have been seriously broken. Can you post the rabbit log 
*and sasl log* from around the time of the above message?

> However, at this point the messages that had not been delivered to
> the celery worker process were not all of a sudden delivered - they
> appeared to have vanished. This happened despite the fact that I'm
> confident that our celery queue and messages on that queue were both
> marked as persistent. I'm not sure I understand rate limiting well
> enough to know whether or not I should have expected to see these
> messages be sent to our consumer when we restarted rabbitmq.

Throttling/blocking affects producers (only). Messages published by a 
blocked producer will end up in various buffers at the client / network 
/ server and be lost when the server is restarted. That's just normal 
TCP/IP behaviour.

> Also BTW, maybe I have this wrong, but it seems strange that the
> rabbit documentation (http://www.rabbitmq.com/configure.html) refers
> to the default Disk free limit as 1GB but that our default install
> has it set to 1000000000 , which rabbit reports on startup as "Disk
> free limit set to 953MB". Prob should be 1073741824? (Sorry for the
> massive nitpick) :)

It's the other way round - it should be reported as 1000MB since for 
disk space (unlike memory) the units are decimal. Will be fixed in the 
next release.

Regards,

Matthias.

From mark.hingston at vardr.com  Mon Sep 17 08:57:33 2012
From: mark.hingston at vardr.com (Mark Hingston)
Date: Mon, 17 Sep 2012 17:57:33 +1000
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
In-Reply-To: <5056CF74.8010502@rabbitmq.com>
References: <5056C685.4040709@vardr.com> <5056CF74.8010502@rabbitmq.com>
Message-ID: <5056D7ED.2090102@vardr.com>

On 17/09/12 5:21 PM, Matthias Radestock wrote:
> Mark,
>
> On 17/09/12 07:43, Mark Hingston wrote:
>> As for our situation here, the two log messages that I posted were
>> the only messages that existed in the log file. That log file covered
>> the 24-hour period previous to when I noticed the issue and at least
>> 24 hours before that, most likely back to when rabbitmq was started.
>> We didn't see a log saying that the alarm was 'set' previous to the
>> clear message.
>
> The alarm must have been set previously, and there must have been a
> corresponding log message.

Indeed there is - sorry I had misunderstood how the log rotation works. 
Below is the excerpt from the logs that shows what happened before the 
'clear'.

=INFO REPORT==== 16-Sep-2012::06:49:06 ===
Disk free space limit now exceeded. Free bytes:888758272 Limit:1000000000

=ERROR REPORT==== 16-Sep-2012::06:49:06 ===
** gen_event handler rabbit_alarm crashed.
** Was installed in alarm_handler
** Last event was: {set_alarm,{{resource_limit,disk,rabbit at mq1},[]}}
** When handler state == {alarms,
                           {dict,6,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                            {{[],
                              [[<0.1053.112>|
{rabbit_reader,conserve_resources,[]}]],
                              [],[],[],[],[],[],[],
                              [[<0.1045.112>|
{rabbit_reader,conserve_resources,[]}]],
                              [[<0.106.101>|
{rabbit_stomp_reader,conserve_resources,[]}]],
                              [[<0.2522.112>|
{rabbit_reader,conserve_resources,[]}]],
                              [[<0.18285.113>|
{rabbit_reader,conserve_resources,[]}]],
                              [],[],
                              [[<0.15164.198>|
{rabbit_reader,conserve_resources,[]}]]}}},
                           {dict,0,16,16,8,80,48,
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                              []}}}}
** Reason == {'function not exported',
                  [{rabbit_stomp_reader,conserve_resources,
                       [<0.106.101>,disk,true]},
                   {dict,fold_bucket,3},
                   {dict,fold_seg,4},
                   {dict,fold_segs,4},
                   {rabbit_alarm,maybe_alert,4},
                   {rabbit_alarm,handle_event,2},
                   {gen_event,server_update,4},
                   {gen_event,server_notify,4}]}

=INFO REPORT==== 16-Sep-2012::06:49:06 ===
     alarm_handler: {set,{{resource_limit,disk,rabbit at mq1},[]}}

=INFO REPORT==== 16-Sep-2012::06:49:16 ===
Rotating logs with suffix ''

...

=INFO REPORT==== 16-Sep-2012::06:49:17 ===
Disk free space limit now below limit. Free bytes:2000396288 
Limit:1000000000


So this is starting to make more sense to me, however after the 'clear' 
line I would have expected the rabbitmq server to un-'block' clients and 
go back to processing messages, but it didn't.


> Something must have been seriously broken. Can you post the rabbit log 
> *and sasl log* from around the time of the above message?
>

Attached are the rabbitmq logs. The sasl log was empty.

>> However, at this point the messages that had not been delivered to
>> the celery worker process were not all of a sudden delivered - they
>> appeared to have vanished. This happened despite the fact that I'm
>> confident that our celery queue and messages on that queue were both
>> marked as persistent. I'm not sure I understand rate limiting well
>> enough to know whether or not I should have expected to see these
>> messages be sent to our consumer when we restarted rabbitmq.
>
> Throttling/blocking affects producers (only). Messages published by a 
> blocked producer will end up in various buffers at the client / 
> network / server and be lost when the server is restarted. That's just 
> normal TCP/IP behaviour.
>

Given what you've said, I'm trying to understand how to best handle this 
situation from the client. There's an existing bug relating to this 
issue here: https://github.com/celery/kombu/issues/136. However, I don't 
understand what (if any) indication the amqp client receives that it is 
being 'blocked' / rate limited by the rabbitmq server. Can you shed any 
light on that?
-------------- next part --------------

=INFO REPORT==== 16-Sep-2012::06:49:17 ===
Disk free space limit now below limit. Free bytes:2000396288 Limit:1000000000

=INFO REPORT==== 16-Sep-2012::06:49:17 ===
    alarm_handler: {clear,{resource_limit,disk,rabbit at mq1}}

=INFO REPORT==== 17-Sep-2012::01:16:58 ===
closing AMQP connection <0.1053.112> (10.255.115.80:59994 -> 10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::01:16:58 ===
closing AMQP connection <0.1045.112> (10.255.115.80:59993 -> 10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::01:16:59 ===
accepting AMQP connection <0.11515.221> (10.255.115.80:58122 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:02 ===
closing AMQP connection <0.11515.221> (10.255.115.80:58122 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:02 ===
accepting AMQP connection <0.11542.221> (10.255.115.80:58129 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:05 ===
closing AMQP connection <0.11542.221> (10.255.115.80:58129 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:05 ===
accepting AMQP connection <0.11571.221> (10.255.115.80:58134 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:08 ===
closing AMQP connection <0.11571.221> (10.255.115.80:58134 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:08 ===
accepting AMQP connection <0.11599.221> (10.255.115.80:58139 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:11 ===
closing AMQP connection <0.11599.221> (10.255.115.80:58139 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:11 ===
accepting AMQP connection <0.11628.221> (10.255.115.80:58143 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:14 ===
closing AMQP connection <0.11628.221> (10.255.115.80:58143 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:14 ===
accepting AMQP connection <0.11655.221> (10.255.115.80:58147 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:17 ===
closing AMQP connection <0.11655.221> (10.255.115.80:58147 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:17 ===
accepting AMQP connection <0.11698.221> (10.255.115.80:58156 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:20 ===
closing AMQP connection <0.11698.221> (10.255.115.80:58156 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:20 ===
accepting AMQP connection <0.11725.221> (10.255.115.80:58161 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:23 ===
closing AMQP connection <0.11725.221> (10.255.115.80:58161 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:23 ===
accepting AMQP connection <0.11754.221> (10.255.115.80:58166 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:26 ===
closing AMQP connection <0.11754.221> (10.255.115.80:58166 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:26 ===
accepting AMQP connection <0.11781.221> (10.255.115.80:58172 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:29 ===
closing AMQP connection <0.11781.221> (10.255.115.80:58172 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:29 ===
accepting AMQP connection <0.11811.221> (10.255.115.80:58176 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:32 ===
closing AMQP connection <0.11811.221> (10.255.115.80:58176 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:32 ===
accepting AMQP connection <0.11838.221> (10.255.115.80:58183 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:35 ===
closing AMQP connection <0.11838.221> (10.255.115.80:58183 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:35 ===
accepting AMQP connection <0.11867.221> (10.255.115.80:58189 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:38 ===
closing AMQP connection <0.11867.221> (10.255.115.80:58189 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:38 ===
accepting AMQP connection <0.11895.221> (10.255.115.80:58194 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:41 ===
closing AMQP connection <0.11895.221> (10.255.115.80:58194 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:41 ===
accepting AMQP connection <0.11925.221> (10.255.115.80:58199 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:44 ===
closing AMQP connection <0.11925.221> (10.255.115.80:58199 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:44 ===
accepting AMQP connection <0.11951.221> (10.255.115.80:58204 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:47 ===
closing AMQP connection <0.11951.221> (10.255.115.80:58204 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:47 ===
accepting AMQP connection <0.11982.221> (10.255.115.80:58209 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:50 ===
closing AMQP connection <0.11982.221> (10.255.115.80:58209 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:50 ===
accepting AMQP connection <0.12008.221> (10.255.115.80:58214 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:53 ===
closing AMQP connection <0.12008.221> (10.255.115.80:58214 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:53 ===
accepting AMQP connection <0.12039.221> (10.255.115.80:58220 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:56 ===
closing AMQP connection <0.12039.221> (10.255.115.80:58220 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:56 ===
accepting AMQP connection <0.12064.221> (10.255.115.80:58225 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:17:59 ===
closing AMQP connection <0.12064.221> (10.255.115.80:58225 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:17:59 ===
accepting AMQP connection <0.12096.221> (10.255.115.80:58230 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:02 ===
closing AMQP connection <0.12096.221> (10.255.115.80:58230 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:02 ===
accepting AMQP connection <0.12121.221> (10.255.115.80:58237 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:05 ===
closing AMQP connection <0.12121.221> (10.255.115.80:58237 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:05 ===
accepting AMQP connection <0.12152.221> (10.255.115.80:58242 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:08 ===
closing AMQP connection <0.12152.221> (10.255.115.80:58242 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:08 ===
accepting AMQP connection <0.12187.221> (10.255.115.80:58247 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:11 ===
closing AMQP connection <0.12187.221> (10.255.115.80:58247 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:11 ===
accepting AMQP connection <0.12218.221> (10.255.115.80:58252 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:14 ===
closing AMQP connection <0.12218.221> (10.255.115.80:58252 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:14 ===
accepting AMQP connection <0.12243.221> (10.255.115.80:58255 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:17 ===
closing AMQP connection <0.12243.221> (10.255.115.80:58255 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:17 ===
accepting AMQP connection <0.12288.221> (10.255.115.80:58263 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:20 ===
closing AMQP connection <0.12288.221> (10.255.115.80:58263 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:20 ===
accepting AMQP connection <0.12313.221> (10.255.115.80:58268 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:23 ===
closing AMQP connection <0.12313.221> (10.255.115.80:58268 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:23 ===
accepting AMQP connection <0.12344.221> (10.255.115.80:58275 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:26 ===
closing AMQP connection <0.12344.221> (10.255.115.80:58275 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:26 ===
accepting AMQP connection <0.12370.221> (10.255.115.80:58280 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:29 ===
closing AMQP connection <0.12370.221> (10.255.115.80:58280 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:29 ===
accepting AMQP connection <0.12401.221> (10.255.115.80:58284 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:32 ===
closing AMQP connection <0.12401.221> (10.255.115.80:58284 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:32 ===
accepting AMQP connection <0.12426.221> (10.255.115.80:58291 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:35 ===
closing AMQP connection <0.12426.221> (10.255.115.80:58291 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:35 ===
accepting AMQP connection <0.12457.221> (10.255.115.80:58297 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:38 ===
closing AMQP connection <0.12457.221> (10.255.115.80:58297 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:38 ===
accepting AMQP connection <0.12483.221> (10.255.115.80:58302 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:41 ===
closing AMQP connection <0.12483.221> (10.255.115.80:58302 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:41 ===
accepting AMQP connection <0.12514.221> (10.255.115.80:58306 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:44 ===
closing AMQP connection <0.12514.221> (10.255.115.80:58306 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:44 ===
accepting AMQP connection <0.12539.221> (10.255.115.80:58312 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:47 ===
closing AMQP connection <0.12539.221> (10.255.115.80:58312 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:47 ===
accepting AMQP connection <0.12571.221> (10.255.115.80:58316 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:50 ===
closing AMQP connection <0.12571.221> (10.255.115.80:58316 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:50 ===
accepting AMQP connection <0.12596.221> (10.255.115.80:58322 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:53 ===
closing AMQP connection <0.12596.221> (10.255.115.80:58322 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:53 ===
accepting AMQP connection <0.12627.221> (10.255.115.80:58328 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:56 ===
closing AMQP connection <0.12627.221> (10.255.115.80:58328 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:56 ===
accepting AMQP connection <0.12653.221> (10.255.115.80:58333 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:18:59 ===
closing AMQP connection <0.12653.221> (10.255.115.80:58333 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:18:59 ===
accepting AMQP connection <0.12684.221> (10.255.115.80:58339 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:02 ===
closing AMQP connection <0.12684.221> (10.255.115.80:58339 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:02 ===
accepting AMQP connection <0.12709.221> (10.255.115.80:58347 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:05 ===
closing AMQP connection <0.12709.221> (10.255.115.80:58347 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:05 ===
accepting AMQP connection <0.12740.221> (10.255.115.80:58351 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:08 ===
closing AMQP connection <0.12740.221> (10.255.115.80:58351 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:09 ===
accepting AMQP connection <0.12766.221> (10.255.115.80:58356 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:12 ===
closing AMQP connection <0.12766.221> (10.255.115.80:58356 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:12 ===
accepting AMQP connection <0.12798.221> (10.255.115.80:58360 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:15 ===
closing AMQP connection <0.12798.221> (10.255.115.80:58360 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:15 ===
accepting AMQP connection <0.12822.221> (10.255.115.80:58367 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:18 ===
closing AMQP connection <0.12822.221> (10.255.115.80:58367 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:18 ===
accepting AMQP connection <0.12868.221> (10.255.115.80:58373 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:21 ===
closing AMQP connection <0.12868.221> (10.255.115.80:58373 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:21 ===
accepting AMQP connection <0.12894.221> (10.255.115.80:58381 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:24 ===
closing AMQP connection <0.12894.221> (10.255.115.80:58381 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:24 ===
accepting AMQP connection <0.12924.221> (10.255.115.80:58385 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:27 ===
closing AMQP connection <0.12924.221> (10.255.115.80:58385 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:27 ===
accepting AMQP connection <0.12951.221> (10.255.115.80:58391 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:30 ===
closing AMQP connection <0.12951.221> (10.255.115.80:58391 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:30 ===
accepting AMQP connection <0.12981.221> (10.255.115.80:58396 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:33 ===
closing AMQP connection <0.12981.221> (10.255.115.80:58396 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:33 ===
accepting AMQP connection <0.13007.221> (10.255.115.80:58402 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:36 ===
closing AMQP connection <0.13007.221> (10.255.115.80:58402 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:36 ===
accepting AMQP connection <0.13037.221> (10.255.115.80:58408 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:39 ===
closing AMQP connection <0.13037.221> (10.255.115.80:58408 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:39 ===
accepting AMQP connection <0.13064.221> (10.255.115.80:58412 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:42 ===
closing AMQP connection <0.13064.221> (10.255.115.80:58412 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:42 ===
accepting AMQP connection <0.13094.221> (10.255.115.80:58418 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:45 ===
closing AMQP connection <0.13094.221> (10.255.115.80:58418 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:45 ===
accepting AMQP connection <0.13120.221> (10.255.115.80:58424 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:48 ===
closing AMQP connection <0.13120.221> (10.255.115.80:58424 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:48 ===
accepting AMQP connection <0.13151.221> (10.255.115.80:58428 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:51 ===
closing AMQP connection <0.13151.221> (10.255.115.80:58428 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:51 ===
accepting AMQP connection <0.13177.221> (10.255.115.80:58434 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:54 ===
closing AMQP connection <0.13177.221> (10.255.115.80:58434 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:54 ===
accepting AMQP connection <0.13207.221> (10.255.115.80:58438 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:19:57 ===
closing AMQP connection <0.13207.221> (10.255.115.80:58438 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:19:57 ===
accepting AMQP connection <0.13234.221> (10.255.115.80:58444 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:00 ===
closing AMQP connection <0.13234.221> (10.255.115.80:58444 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:00 ===
accepting AMQP connection <0.13264.221> (10.255.115.80:58449 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:03 ===
closing AMQP connection <0.13264.221> (10.255.115.80:58449 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:03 ===
accepting AMQP connection <0.13290.221> (10.255.115.80:58457 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:06 ===
closing AMQP connection <0.13290.221> (10.255.115.80:58457 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:06 ===
accepting AMQP connection <0.13320.221> (10.255.115.80:58460 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:09 ===
closing AMQP connection <0.13320.221> (10.255.115.80:58460 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:09 ===
accepting AMQP connection <0.13347.221> (10.255.115.80:58465 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:12 ===
closing AMQP connection <0.13347.221> (10.255.115.80:58465 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:12 ===
accepting AMQP connection <0.13377.221> (10.255.115.80:58470 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:15 ===
closing AMQP connection <0.13377.221> (10.255.115.80:58470 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:15 ===
accepting AMQP connection <0.13417.221> (10.255.115.80:58478 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:18 ===
closing AMQP connection <0.13417.221> (10.255.115.80:58478 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:18 ===
accepting AMQP connection <0.13447.221> (10.255.115.80:58483 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:21 ===
closing AMQP connection <0.13447.221> (10.255.115.80:58483 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:21 ===
accepting AMQP connection <0.13475.221> (10.255.115.80:58488 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:24 ===
closing AMQP connection <0.13475.221> (10.255.115.80:58488 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:24 ===
accepting AMQP connection <0.13503.221> (10.255.115.80:58494 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:27 ===
closing AMQP connection <0.13503.221> (10.255.115.80:58494 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:27 ===
accepting AMQP connection <0.13532.221> (10.255.115.80:58499 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:30 ===
closing AMQP connection <0.13532.221> (10.255.115.80:58499 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:30 ===
accepting AMQP connection <0.13560.221> (10.255.115.80:58502 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:33 ===
closing AMQP connection <0.13560.221> (10.255.115.80:58502 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:33 ===
accepting AMQP connection <0.13588.221> (10.255.115.80:58509 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:36 ===
closing AMQP connection <0.13588.221> (10.255.115.80:58509 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:36 ===
accepting AMQP connection <0.13616.221> (10.255.115.80:58515 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:39 ===
closing AMQP connection <0.13616.221> (10.255.115.80:58515 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:39 ===
accepting AMQP connection <0.13645.221> (10.255.115.80:58520 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:42 ===
closing AMQP connection <0.13645.221> (10.255.115.80:58520 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:42 ===
accepting AMQP connection <0.13673.221> (10.255.115.80:58526 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:45 ===
closing AMQP connection <0.13673.221> (10.255.115.80:58526 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:45 ===
accepting AMQP connection <0.13701.221> (10.255.115.80:58532 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:48 ===
closing AMQP connection <0.13701.221> (10.255.115.80:58532 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:48 ===
accepting AMQP connection <0.13730.221> (10.255.115.80:58536 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:51 ===
closing AMQP connection <0.13730.221> (10.255.115.80:58536 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:51 ===
accepting AMQP connection <0.13758.221> (10.255.115.80:58542 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:54 ===
closing AMQP connection <0.13758.221> (10.255.115.80:58542 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:54 ===
accepting AMQP connection <0.13786.221> (10.255.115.80:58546 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:20:57 ===
closing AMQP connection <0.13786.221> (10.255.115.80:58546 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:20:57 ===
accepting AMQP connection <0.13815.221> (10.255.115.80:58551 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:00 ===
closing AMQP connection <0.13815.221> (10.255.115.80:58551 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:00 ===
accepting AMQP connection <0.13843.221> (10.255.115.80:58556 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:03 ===
closing AMQP connection <0.13843.221> (10.255.115.80:58556 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:03 ===
accepting AMQP connection <0.13872.221> (10.255.115.80:58563 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:06 ===
closing AMQP connection <0.13872.221> (10.255.115.80:58563 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:06 ===
accepting AMQP connection <0.13899.221> (10.255.115.80:58568 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:09 ===
closing AMQP connection <0.13899.221> (10.255.115.80:58568 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:09 ===
accepting AMQP connection <0.13930.221> (10.255.115.80:58573 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:12 ===
closing AMQP connection <0.13930.221> (10.255.115.80:58573 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:12 ===
accepting AMQP connection <0.13957.221> (10.255.115.80:58577 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:15 ===
closing AMQP connection <0.13957.221> (10.255.115.80:58577 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:15 ===
accepting AMQP connection <0.14000.221> (10.255.115.80:58586 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:18 ===
closing AMQP connection <0.14000.221> (10.255.115.80:58586 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:18 ===
accepting AMQP connection <0.14027.221> (10.255.115.80:58589 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:21 ===
closing AMQP connection <0.14027.221> (10.255.115.80:58589 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:21 ===
accepting AMQP connection <0.14057.221> (10.255.115.80:58594 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:24 ===
closing AMQP connection <0.14057.221> (10.255.115.80:58594 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:24 ===
accepting AMQP connection <0.14083.221> (10.255.115.80:58598 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:27 ===
closing AMQP connection <0.14083.221> (10.255.115.80:58598 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:27 ===
accepting AMQP connection <0.14114.221> (10.255.115.80:58603 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:30 ===
closing AMQP connection <0.14114.221> (10.255.115.80:58603 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:30 ===
accepting AMQP connection <0.14140.221> (10.255.115.80:58607 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:33 ===
closing AMQP connection <0.14140.221> (10.255.115.80:58607 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:33 ===
accepting AMQP connection <0.14171.221> (10.255.115.80:58613 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:36 ===
closing AMQP connection <0.14171.221> (10.255.115.80:58613 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:36 ===
accepting AMQP connection <0.14196.221> (10.255.115.80:58618 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:39 ===
closing AMQP connection <0.14196.221> (10.255.115.80:58618 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:39 ===
accepting AMQP connection <0.14228.221> (10.255.115.80:58623 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:42 ===
closing AMQP connection <0.14228.221> (10.255.115.80:58623 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:42 ===
accepting AMQP connection <0.14253.221> (10.255.115.80:58629 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:45 ===
closing AMQP connection <0.14253.221> (10.255.115.80:58629 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:45 ===
accepting AMQP connection <0.14284.221> (10.255.115.80:58634 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:48 ===
closing AMQP connection <0.14284.221> (10.255.115.80:58634 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:48 ===
accepting AMQP connection <0.14310.221> (10.255.115.80:58637 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:51 ===
closing AMQP connection <0.14310.221> (10.255.115.80:58637 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:51 ===
accepting AMQP connection <0.14341.221> (10.255.115.80:58643 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:54 ===
closing AMQP connection <0.14341.221> (10.255.115.80:58643 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:54 ===
accepting AMQP connection <0.14366.221> (10.255.115.80:58649 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:21:57 ===
closing AMQP connection <0.14366.221> (10.255.115.80:58649 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:21:57 ===
accepting AMQP connection <0.14403.221> (10.255.115.80:58654 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:00 ===
closing AMQP connection <0.14403.221> (10.255.115.80:58654 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:00 ===
accepting AMQP connection <0.14427.221> (10.255.115.80:58658 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:03 ===
closing AMQP connection <0.14427.221> (10.255.115.80:58658 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:03 ===
accepting AMQP connection <0.14459.221> (10.255.115.80:58666 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:06 ===
closing AMQP connection <0.14459.221> (10.255.115.80:58666 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:06 ===
accepting AMQP connection <0.14484.221> (10.255.115.80:58670 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:09 ===
closing AMQP connection <0.14484.221> (10.255.115.80:58670 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:09 ===
accepting AMQP connection <0.14516.221> (10.255.115.80:58675 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:12 ===
closing AMQP connection <0.14516.221> (10.255.115.80:58675 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:12 ===
accepting AMQP connection <0.14541.221> (10.255.115.80:58680 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:15 ===
closing AMQP connection <0.14541.221> (10.255.115.80:58680 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:15 ===
accepting AMQP connection <0.14585.221> (10.255.115.80:58688 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:18 ===
closing AMQP connection <0.14585.221> (10.255.115.80:58688 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:18 ===
accepting AMQP connection <0.14611.221> (10.255.115.80:58692 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:21 ===
closing AMQP connection <0.14611.221> (10.255.115.80:58692 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:21 ===
accepting AMQP connection <0.14642.221> (10.255.115.80:58698 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:24 ===
closing AMQP connection <0.14642.221> (10.255.115.80:58698 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:24 ===
accepting AMQP connection <0.14667.221> (10.255.115.80:58702 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:27 ===
closing AMQP connection <0.14667.221> (10.255.115.80:58702 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:27 ===
accepting AMQP connection <0.14699.221> (10.255.115.80:58708 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:30 ===
closing AMQP connection <0.14699.221> (10.255.115.80:58708 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:30 ===
accepting AMQP connection <0.14724.221> (10.255.115.80:58713 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:33 ===
closing AMQP connection <0.14724.221> (10.255.115.80:58713 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:33 ===
accepting AMQP connection <0.14755.221> (10.255.115.80:58719 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:36 ===
closing AMQP connection <0.14755.221> (10.255.115.80:58719 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:36 ===
accepting AMQP connection <0.14780.221> (10.255.115.80:58725 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:39 ===
closing AMQP connection <0.14780.221> (10.255.115.80:58725 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:39 ===
accepting AMQP connection <0.14812.221> (10.255.115.80:58731 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:42 ===
closing AMQP connection <0.14812.221> (10.255.115.80:58731 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:42 ===
accepting AMQP connection <0.14837.221> (10.255.115.80:58735 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:45 ===
closing AMQP connection <0.14837.221> (10.255.115.80:58735 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:45 ===
accepting AMQP connection <0.14868.221> (10.255.115.80:58740 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:48 ===
closing AMQP connection <0.14868.221> (10.255.115.80:58740 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:48 ===
accepting AMQP connection <0.14894.221> (10.255.115.80:58743 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:51 ===
closing AMQP connection <0.14894.221> (10.255.115.80:58743 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:51 ===
accepting AMQP connection <0.14925.221> (10.255.115.80:58749 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:54 ===
closing AMQP connection <0.14925.221> (10.255.115.80:58749 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:54 ===
accepting AMQP connection <0.14950.221> (10.255.115.80:58755 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:22:57 ===
closing AMQP connection <0.14950.221> (10.255.115.80:58755 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:22:57 ===
accepting AMQP connection <0.14982.221> (10.255.115.80:58761 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:00 ===
closing AMQP connection <0.14982.221> (10.255.115.80:58761 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:00 ===
accepting AMQP connection <0.15007.221> (10.255.115.80:58766 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:03 ===
closing AMQP connection <0.15007.221> (10.255.115.80:58766 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:03 ===
accepting AMQP connection <0.15038.221> (10.255.115.80:58774 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:06 ===
closing AMQP connection <0.15038.221> (10.255.115.80:58774 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:06 ===
accepting AMQP connection <0.15067.221> (10.255.115.80:58778 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:09 ===
closing AMQP connection <0.15067.221> (10.255.115.80:58778 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:09 ===
accepting AMQP connection <0.15099.221> (10.255.115.80:58782 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:12 ===
closing AMQP connection <0.15099.221> (10.255.115.80:58782 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:12 ===
accepting AMQP connection <0.15124.221> (10.255.115.80:58786 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:15 ===
closing AMQP connection <0.15124.221> (10.255.115.80:58786 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:15 ===
accepting AMQP connection <0.15168.221> (10.255.115.80:58794 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:18 ===
closing AMQP connection <0.15168.221> (10.255.115.80:58794 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:18 ===
accepting AMQP connection <0.15194.221> (10.255.115.80:58798 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:21 ===
closing AMQP connection <0.15194.221> (10.255.115.80:58798 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:21 ===
accepting AMQP connection <0.15225.221> (10.255.115.80:58805 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:24 ===
closing AMQP connection <0.15225.221> (10.255.115.80:58805 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:24 ===
accepting AMQP connection <0.15250.221> (10.255.115.80:58810 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:27 ===
closing AMQP connection <0.15250.221> (10.255.115.80:58810 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:27 ===
accepting AMQP connection <0.15282.221> (10.255.115.80:58816 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:30 ===
closing AMQP connection <0.15282.221> (10.255.115.80:58816 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:30 ===
accepting AMQP connection <0.15307.221> (10.255.115.80:58821 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:33 ===
closing AMQP connection <0.15307.221> (10.255.115.80:58821 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:33 ===
accepting AMQP connection <0.15338.221> (10.255.115.80:58827 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:36 ===
closing AMQP connection <0.15338.221> (10.255.115.80:58827 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:36 ===
accepting AMQP connection <0.15363.221> (10.255.115.80:58833 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:39 ===
closing AMQP connection <0.15363.221> (10.255.115.80:58833 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:39 ===
accepting AMQP connection <0.15395.221> (10.255.115.80:58837 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:42 ===
closing AMQP connection <0.15395.221> (10.255.115.80:58837 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:42 ===
accepting AMQP connection <0.15420.221> (10.255.115.80:58842 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:45 ===
closing AMQP connection <0.15420.221> (10.255.115.80:58842 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:45 ===
accepting AMQP connection <0.15451.221> (10.255.115.80:58847 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:48 ===
closing AMQP connection <0.15451.221> (10.255.115.80:58847 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:48 ===
accepting AMQP connection <0.15477.221> (10.255.115.80:58851 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:51 ===
closing AMQP connection <0.15477.221> (10.255.115.80:58851 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:51 ===
accepting AMQP connection <0.15508.221> (10.255.115.80:58857 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:54 ===
closing AMQP connection <0.15508.221> (10.255.115.80:58857 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:54 ===
accepting AMQP connection <0.15533.221> (10.255.115.80:58863 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:23:57 ===
closing AMQP connection <0.15533.221> (10.255.115.80:58863 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:23:57 ===
accepting AMQP connection <0.15565.221> (10.255.115.80:58869 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:00 ===
closing AMQP connection <0.15565.221> (10.255.115.80:58869 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:00 ===
accepting AMQP connection <0.15590.221> (10.255.115.80:58874 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:03 ===
closing AMQP connection <0.15590.221> (10.255.115.80:58874 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:03 ===
accepting AMQP connection <0.15621.221> (10.255.115.80:58882 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:06 ===
closing AMQP connection <0.15621.221> (10.255.115.80:58882 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:06 ===
accepting AMQP connection <0.15646.221> (10.255.115.80:58885 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:09 ===
closing AMQP connection <0.15646.221> (10.255.115.80:58885 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:09 ===
accepting AMQP connection <0.15679.221> (10.255.115.80:58890 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:12 ===
closing AMQP connection <0.15679.221> (10.255.115.80:58890 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:12 ===
accepting AMQP connection <0.15707.221> (10.255.115.80:58894 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:15 ===
closing AMQP connection <0.15707.221> (10.255.115.80:58894 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:15 ===
accepting AMQP connection <0.15748.221> (10.255.115.80:58901 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:18 ===
closing AMQP connection <0.15748.221> (10.255.115.80:58901 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:18 ===
accepting AMQP connection <0.15777.221> (10.255.115.80:58906 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:21 ===
closing AMQP connection <0.15777.221> (10.255.115.80:58906 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:21 ===
accepting AMQP connection <0.15805.221> (10.255.115.80:58913 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:24 ===
closing AMQP connection <0.15805.221> (10.255.115.80:58913 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:24 ===
accepting AMQP connection <0.15833.221> (10.255.115.80:58918 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:27 ===
closing AMQP connection <0.15833.221> (10.255.115.80:58918 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:27 ===
accepting AMQP connection <0.15862.221> (10.255.115.80:58924 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:30 ===
closing AMQP connection <0.15862.221> (10.255.115.80:58924 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:30 ===
accepting AMQP connection <0.15890.221> (10.255.115.80:58929 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:33 ===
closing AMQP connection <0.15890.221> (10.255.115.80:58929 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:33 ===
accepting AMQP connection <0.15918.221> (10.255.115.80:58935 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:36 ===
closing AMQP connection <0.15918.221> (10.255.115.80:58935 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:36 ===
accepting AMQP connection <0.15946.221> (10.255.115.80:58940 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:39 ===
closing AMQP connection <0.15946.221> (10.255.115.80:58940 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:39 ===
accepting AMQP connection <0.15975.221> (10.255.115.80:58946 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:42 ===
closing AMQP connection <0.15975.221> (10.255.115.80:58946 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:42 ===
accepting AMQP connection <0.16003.221> (10.255.115.80:58950 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:45 ===
closing AMQP connection <0.16003.221> (10.255.115.80:58950 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:45 ===
accepting AMQP connection <0.16031.221> (10.255.115.80:58955 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:48 ===
closing AMQP connection <0.16031.221> (10.255.115.80:58955 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:48 ===
accepting AMQP connection <0.16060.221> (10.255.115.80:58959 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:51 ===
closing AMQP connection <0.16060.221> (10.255.115.80:58959 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:51 ===
accepting AMQP connection <0.16088.221> (10.255.115.80:58965 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:54 ===
closing AMQP connection <0.16088.221> (10.255.115.80:58965 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:54 ===
accepting AMQP connection <0.16116.221> (10.255.115.80:58971 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:24:57 ===
closing AMQP connection <0.16116.221> (10.255.115.80:58971 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:24:57 ===
accepting AMQP connection <0.16145.221> (10.255.115.80:58977 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:25:00 ===
closing AMQP connection <0.16145.221> (10.255.115.80:58977 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:25:00 ===
accepting AMQP connection <0.16173.221> (10.255.115.80:58982 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:25:03 ===
closing AMQP connection <0.16173.221> (10.255.115.80:58982 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:25:03 ===
accepting AMQP connection <0.16201.221> (10.255.115.80:58990 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:25:06 ===
closing AMQP connection <0.16201.221> (10.255.115.80:58990 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:25:06 ===
accepting AMQP connection <0.16229.221> (10.255.115.80:58993 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:25:09 ===
closing AMQP connection <0.16229.221> (10.255.115.80:58993 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:25:09 ===
accepting AMQP connection <0.16258.221> (10.255.115.80:58998 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:25:12 ===
closing AMQP connection <0.16258.221> (10.255.115.80:58998 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:25:12 ===
accepting AMQP connection <0.16286.221> (10.255.115.80:59001 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:25:15 ===
closing AMQP connection <0.16286.221> (10.255.115.80:59001 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:25:15 ===
accepting AMQP connection <0.16327.221> (10.255.115.80:59009 -> 10.255.115.80:5672)

=ERROR REPORT==== 17-Sep-2012::01:25:18 ===
closing AMQP connection <0.16327.221> (10.255.115.80:59009 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:25:18 ===
accepting AMQP connection <0.16356.221> (10.255.115.80:59014 -> 10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::01:25:21 ===
Stopping Rabbit

=INFO REPORT==== 17-Sep-2012::01:25:21 ===
stopped STOMP TCP Listener on [::]:61613

=INFO REPORT==== 17-Sep-2012::01:25:21 ===
    application: rabbitmq_stomp
    exited: stopped
    type: permanent

=INFO REPORT==== 17-Sep-2012::01:25:21 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent

=INFO REPORT==== 17-Sep-2012::01:25:21 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=INFO REPORT==== 17-Sep-2012::01:25:21 ===
stopped TCP Listener on [::]:5672

=ERROR REPORT==== 17-Sep-2012::01:25:21 ===
closing AMQP connection <0.16356.221> (10.255.115.80:59014 -> 10.255.115.80:5672):
{channel0_error,opening,
                {error,{badarg,{error,bad_module}},
                       'connection.open',
                       [{rabbit_reader,control_throttle,1},
                        {rabbit_reader,handle_method0,2},
                        {rabbit_reader,handle_method0,3},
                        {rabbit_reader,handle_input,3},
                        {rabbit_reader,recvloop,2},
                        {rabbit_reader,start_connection,7},
                        {proc_lib,init_p_do_apply,3}]}}

=INFO REPORT==== 17-Sep-2012::01:25:21 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 17-Sep-2012::01:25:21 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 17-Sep-2012::01:25:21 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 17-Sep-2012::01:25:21 ===
Halting Erlang VM

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
Memory limit set to 677MB of 1692MB total.

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
Disk free limit set to 953MB

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
rabbit_stomp: default user 'guest' enabled

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
started STOMP TCP Listener on [::]:61613

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
Management agent started.

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
Management plugin started. Port: 55672, path: /

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
Statistics database started.

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
accepting AMQP connection <0.287.0> (10.255.115.80:59031 -> 10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::01:25:27 ===
accepting AMQP connection <0.295.0> (10.255.115.80:59032 -> 10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::01:25:33 ===
accepting STOMP connection <0.350.0> (10.255.115.80:42428 -> 10.255.115.80:61613)

=INFO REPORT==== 17-Sep-2012::01:29:24 ===
accepting AMQP connection <0.2291.0> (10.255.115.80:59376 -> 10.255.115.80:5672)

=INFO REPORT==== 17-Sep-2012::05:17:54 ===
accepting AMQP connection <0.18051.3> (10.255.115.80:47455 -> 10.255.115.80:5672)
-------------- next part --------------

=INFO REPORT==== 10-Sep-2012::02:56:54 ===
accepting AMQP connection <0.9918.69> (10.255.115.80:41643 -> 10.255.115.80:5672)

=WARNING REPORT==== 10-Sep-2012::03:29:01 ===
closing AMQP connection <0.1904.48> (10.255.115.80:57920 -> 10.255.115.80:5672):
connection_closed_abruptly

=INFO REPORT==== 10-Sep-2012::03:29:17 ===
accepting AMQP connection <0.26102.69> (10.255.115.80:51046 -> 10.255.115.80:5672)

=WARNING REPORT==== 10-Sep-2012::03:30:27 ===
closing AMQP connection <0.26102.69> (10.255.115.80:51046 -> 10.255.115.80:5672):
connection_closed_abruptly

=INFO REPORT==== 10-Sep-2012::03:35:13 ===
accepting AMQP connection <0.29064.69> (10.255.115.80:53027 -> 10.255.115.80:5672)

=WARNING REPORT==== 10-Sep-2012::03:37:58 ===
closing AMQP connection <0.29064.69> (10.255.115.80:53027 -> 10.255.115.80:5672):
connection_closed_abruptly

=INFO REPORT==== 10-Sep-2012::03:38:45 ===
accepting AMQP connection <0.30832.69> (10.255.115.80:54238 -> 10.255.115.80:5672)

=WARNING REPORT==== 11-Sep-2012::13:17:44 ===
closing AMQP connection <0.30832.69> (10.255.115.80:54238 -> 10.255.115.80:5672):
connection_closed_abruptly

=WARNING REPORT==== 11-Sep-2012::13:17:45 ===
closing AMQP connection <0.9918.69> (10.255.115.80:41643 -> 10.255.115.80:5672):
connection_closed_abruptly

=INFO REPORT==== 11-Sep-2012::13:17:45 ===
closing AMQP connection <0.345.48> (10.255.115.80:57048 -> 10.255.115.80:5672)

=INFO REPORT==== 11-Sep-2012::13:17:45 ===
closing AMQP connection <0.337.48> (10.255.115.80:57047 -> 10.255.115.80:5672)

=INFO REPORT==== 11-Sep-2012::13:17:46 ===
accepting AMQP connection <0.22976.100> (10.255.115.80:39054 -> 10.255.115.80:5672)

=INFO REPORT==== 11-Sep-2012::13:17:46 ===
accepting AMQP connection <0.22984.100> (10.255.115.80:39055 -> 10.255.115.80:5672)

=INFO REPORT==== 11-Sep-2012::13:17:59 ===
closing STOMP connection <0.318.0> (10.255.115.80:56139 -> 10.255.115.80:61613)

=INFO REPORT==== 11-Sep-2012::13:37:33 ===
accepting STOMP connection <0.106.101> (10.255.115.80:51267 -> 10.255.115.80:61613)

=INFO REPORT==== 11-Sep-2012::13:38:18 ===
accepting AMQP connection <0.508.101> (10.255.115.80:39706 -> 10.255.115.80:5672)

=INFO REPORT==== 12-Sep-2012::01:29:34 ===
accepting AMQP connection <0.27845.111> (10.255.115.80:59319 -> 10.255.115.80:5672)

=WARNING REPORT==== 12-Sep-2012::01:41:30 ===
closing AMQP connection <0.508.101> (10.255.115.80:39706 -> 10.255.115.80:5672):
connection_closed_abruptly

=WARNING REPORT==== 12-Sep-2012::01:41:30 ===
closing AMQP connection <0.27845.111> (10.255.115.80:59319 -> 10.255.115.80:5672):
connection_closed_abruptly

=INFO REPORT==== 12-Sep-2012::01:41:30 ===
closing AMQP connection <0.22984.100> (10.255.115.80:39055 -> 10.255.115.80:5672)

=INFO REPORT==== 12-Sep-2012::01:41:30 ===
closing AMQP connection <0.22976.100> (10.255.115.80:39054 -> 10.255.115.80:5672)

=INFO REPORT==== 12-Sep-2012::01:41:31 ===
accepting AMQP connection <0.1045.112> (10.255.115.80:59993 -> 10.255.115.80:5672)

=INFO REPORT==== 12-Sep-2012::01:41:31 ===
accepting AMQP connection <0.1053.112> (10.255.115.80:59994 -> 10.255.115.80:5672)

=INFO REPORT==== 12-Sep-2012::01:44:25 ===
accepting AMQP connection <0.2522.112> (10.255.115.80:60115 -> 10.255.115.80:5672)

=INFO REPORT==== 12-Sep-2012::03:21:38 ===
accepting AMQP connection <0.18285.113> (10.255.115.80:36869 -> 10.255.115.80:5672)

=INFO REPORT==== 16-Sep-2012::00:14:26 ===
accepting AMQP connection <0.15164.198> (10.255.115.80:46552 -> 10.255.115.80:5672)

=INFO REPORT==== 16-Sep-2012::06:49:06 ===
Disk free space limit now exceeded. Free bytes:888758272 Limit:1000000000

=ERROR REPORT==== 16-Sep-2012::06:49:06 ===
** gen_event handler rabbit_alarm crashed.
** Was installed in alarm_handler
** Last event was: {set_alarm,{{resource_limit,disk,rabbit at mq1},[]}}
** When handler state == {alarms,
                          {dict,6,16,16,8,80,48,
                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],
                             [[<0.1053.112>|
                               {rabbit_reader,conserve_resources,[]}]],
                             [],[],[],[],[],[],[],
                             [[<0.1045.112>|
                               {rabbit_reader,conserve_resources,[]}]],
                             [[<0.106.101>|
                               {rabbit_stomp_reader,conserve_resources,[]}]],
                             [[<0.2522.112>|
                               {rabbit_reader,conserve_resources,[]}]],
                             [[<0.18285.113>|
                               {rabbit_reader,conserve_resources,[]}]],
                             [],[],
                             [[<0.15164.198>|
                               {rabbit_reader,conserve_resources,[]}]]}}},
                          {dict,0,16,16,8,80,48,
                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}}}
** Reason == {'function not exported',
                 [{rabbit_stomp_reader,conserve_resources,
                      [<0.106.101>,disk,true]},
                  {dict,fold_bucket,3},
                  {dict,fold_seg,4},
                  {dict,fold_segs,4},
                  {rabbit_alarm,maybe_alert,4},
                  {rabbit_alarm,handle_event,2},
                  {gen_event,server_update,4},
                  {gen_event,server_notify,4}]}

=INFO REPORT==== 16-Sep-2012::06:49:06 ===
    alarm_handler: {set,{{resource_limit,disk,rabbit at mq1},[]}}

=INFO REPORT==== 16-Sep-2012::06:49:16 ===
Rotating logs with suffix ''
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at mq1.log.2.gz
Type: application/x-gzip
Size: 3025 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120917/15192d52/attachment.bin>

From matthias at rabbitmq.com  Mon Sep 17 10:41:25 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 17 Sep 2012 10:41:25 +0100
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
In-Reply-To: <5056D7ED.2090102@vardr.com>
References: <5056C685.4040709@vardr.com> <5056CF74.8010502@rabbitmq.com>
	<5056D7ED.2090102@vardr.com>
Message-ID: <5056F045.8080002@rabbitmq.com>

Mark,

On 17/09/12 08:57, Mark Hingston wrote:
> Below is the excerpt from the logs that shows what happened before the
> 'clear'.
>
> =INFO REPORT==== 16-Sep-2012::06:49:06 ===
> Disk free space limit now exceeded. Free bytes:888758272 Limit:1000000000
>
> =ERROR REPORT==== 16-Sep-2012::06:49:06 ===
> ** gen_event handler rabbit_alarm crashed.
> ** Was installed in alarm_handler
> ** Last event was: {set_alarm,{{resource_limit,disk,rabbit at mq1},[]}}
> ** When handler state == {alarms,
>                            {dict,6,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                             {{[],
>                               [[<0.1053.112>|
> {rabbit_reader,conserve_resources,[]}]],
>                               [],[],[],[],[],[],[],
>                               [[<0.1045.112>|
> {rabbit_reader,conserve_resources,[]}]],
>                               [[<0.106.101>|
> {rabbit_stomp_reader,conserve_resources,[]}]],
>                               [[<0.2522.112>|
> {rabbit_reader,conserve_resources,[]}]],
>                               [[<0.18285.113>|
> {rabbit_reader,conserve_resources,[]}]],
>                               [],[],
>                               [[<0.15164.198>|
> {rabbit_reader,conserve_resources,[]}]]}}},
>                            {dict,0,16,16,8,80,48,
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                               []}}}}
> ** Reason == {'function not exported',
>                   [{rabbit_stomp_reader,conserve_resources,
>                        [<0.106.101>,disk,true]},
>                    {dict,fold_bucket,3},
>                    {dict,fold_seg,4},
>                    {dict,fold_segs,4},
>                    {rabbit_alarm,maybe_alert,4},
>                    {rabbit_alarm,handle_event,2},
>                    {gen_event,server_update,4},
>                    {gen_event,server_notify,4}]}

Ah. That's a bug in the stomp plug-in. It's been around since 2.8.3. 
Will fix.

The upshot is that from then onwards alarm handling is broken, which 
explains why the subsequent clearing of the disk alarm wasn't unblocking 
producers for you.

>> Throttling/blocking affects producers (only). Messages published by a
>> blocked producer will end up in various buffers at the client /
>> network / server and be lost when the server is restarted. That's just
>> normal TCP/IP behaviour.
>>
> Given what you've said, I'm trying to understand how to best handle this
> situation from the client. There's an existing bug relating to this
> issue here: https://github.com/celery/kombu/issues/136. However, I don't
> understand what (if any) indication the amqp client receives that it is
> being 'blocked' / rate limited by the rabbitmq server. Can you shed any
> light on that?

There is nothing unsual about "rate limiting" / throttling. Flow control 
is an integral part of TCP/IP - *all* TCP/IP connections are flow 
controlled. It's how TCP/IP deals with congested networks and slow servers.

The fact that the server is "slow" because it encountered an alarm 
condition is neither here or there - as far as the client is concerned 
it's just talking to a slow server.

So your question really comes down to how would you expect a client to 
detect and deal with a slow server / congested network.

Regards,

Matthias.

From pierre-yves.ayoul at orange.com  Mon Sep 17 11:04:24 2012
From: pierre-yves.ayoul at orange.com (pierre-yves.ayoul at orange.com)
Date: Mon, 17 Sep 2012 12:04:24 +0200
Subject: [rabbitmq-discuss] 500 internal server error
Message-ID: <28614_1347876266_5056F5A9_28614_247_12_74A36E9067938043AAE806107EB739925C83844728@PUEXCB1E.nanterre.francetelecom.fr>

Hello,

I need to purge a specific queue, so I was trying to get the queues name with following commande "rabbitmqadmin list queues", but I receive the following message... can somebody help me please? :

Traceback (most recent call last):
  File "/usr/local/bin/rabbitmqadmin", line 682, in <module>
    main()
  File "/usr/local/bin/rabbitmqadmin", line 203, in main
    method()
  File "/usr/local/bin/rabbitmqadmin", line 321, in invoke_list
    format_list(self.get(uri), cols, self.options)
  File "/usr/local/bin/rabbitmqadmin", line 226, in get
    return self.http("GET", path, "")
  File "/usr/local/bin/rabbitmqadmin", line 264, in http
    % (resp.status, resp.reason, path, resp.read()))
Exception: Received 500 Internal Server Error for path /queues
<html><head><title>500 Internal Server Error</title></head><body><h1>Internal Server Error</h1>The server encountered an error while processing this request:<br><pre>{error,
    {error,function_clause,
        [{rabbit_mgmt_format,queue,
             [{amqqueue,
                  {resource,<<"my_host">>,queue,
                      <<"BusinessCacheComponent-1">>},
                  true,false,none,false,[],<0.209.0>,[],undefined}]},
         {rabbit_mgmt_wm_queues,'-basic/1-lc$^0/1-0-',1},
         {rabbit_mgmt_wm_queues,augmented,2},
         {rabbit_mgmt_wm_queues,to_json,2},
         {webmachine_resource,resource_call,3},
         {webmachine_resource,do,3},
         {webmachine_decision_core,resource_call,1},
         {webmachine_decision_core,decision,1}]}}</pre><P><HR><ADDRESS>mochiweb+webmachine web server</ADDRESS></body></html>



Regards,

PY

_________________________________________________________________________________________________________________________

Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc
pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler
a l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d'alteration,
France Telecom - Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information that may be protected by law;
they should not be distributed, used or copied without authorisation.
If you have received this email in error, please notify the sender and delete this message and its attachments.
As emails may be altered, France Telecom - Orange is not liable for messages that have been modified, changed or falsified.
Thank you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120917/796ec2cf/attachment.htm>

From simon at rabbitmq.com  Mon Sep 17 11:33:15 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 17 Sep 2012 11:33:15 +0100
Subject: [rabbitmq-discuss] 500 internal server error
In-Reply-To: <28614_1347876266_5056F5A9_28614_247_12_74A36E9067938043AAE806107EB739925C83844728@PUEXCB1E.nanterre.francetelecom.fr>
References: <28614_1347876266_5056F5A9_28614_247_12_74A36E9067938043AAE806107EB739925C83844728@PUEXCB1E.nanterre.francetelecom.fr>
Message-ID: <5056FC6B.2060302@rabbitmq.com>

On 17/09/12 11:04, pierre-yves.ayoul at orange.com wrote:
> {error,function_clause,
>   [{rabbit_mgmt_format,queue,
>     [{amqqueue,
>       {resource,<<"my_host">>,queue,
>         <<"BusinessCacheComponent-1">>},
>       true,false,none,false,[],<0.209.0>,[],undefined}]},

So this looks like rabbitmq-server and rabbitmq-management disagreeing 
on the format of an #amqqueue{} record. This would suggest that the 
server and the plugin are from two different releases.

Have you installed anything in an unusual way? Do you have self-compiled 
bits lying around? Which version are you running? Have you overridden 
RABBITMQ_PLUGINS_DIR?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matwey.kornilov at gmail.com  Mon Sep 17 11:56:17 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Mon, 17 Sep 2012 14:56:17 +0400
Subject: [rabbitmq-discuss] federation plugin: x-federation exchange
	declaring
Message-ID: <k36vkh$9lo$1@ger.gmane.org>


Hi,

I am not quite sure, that I am understanding federation plugin well. But my 
case is following:

I have one setup "A": the rabbitmq-server, and a few clients, which are 
communicating with each other.

Then I need to clone this on the other hardware at the different place. Say 
setup "B". And there is one exception, one of my 'direct' exchanges must be 
common for this two setups. I've set up federation plugin on "B", it has 
been connected to "A" and everything seems to be ok so far.

My python clients fail at "B" with the following error:

pika.exceptions.AMQPChannelError: (406, "PRECONDITION_FAILED - cannot 
redeclare exchange 'my-exchange' in vhost '/' with different type, durable, 
internal or autodelete value")

This is because they are pub/sub subscribers. I declare the exchange, bind 
to it, and wait for incoming messages. Obviously, It is somehow connected 
with that 'my-echange' has been already created by federation-plugin.

Is there a way to avoid modification of client code to keep same versions of 
my python clients on both "A" and "B"? Where 'my-exchange' is 'direct' and 
'x-federation' with backtype 'direct' respectively.



From simon at rabbitmq.com  Mon Sep 17 12:00:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 17 Sep 2012 12:00:49 +0100
Subject: [rabbitmq-discuss] federation plugin: x-federation
	exchange	declaring
In-Reply-To: <k36vkh$9lo$1@ger.gmane.org>
References: <k36vkh$9lo$1@ger.gmane.org>
Message-ID: <505702E1.8040003@rabbitmq.com>

On 17/09/12 11:56, Matwey V. Kornilov wrote:
> Is there a way to avoid modification of client code to keep same versions of
> my python clients on both "A" and "B"? Where 'my-exchange' is 'direct' and
> 'x-federation' with backtype 'direct' respectively.

Not with 2.8.6.

This is a known irritation of using federation. In the next major 
release the "x-federation" type is going away, you'll just declare 
exchanges as normal and then apply federation to them separately. But 
right now I'm afraid you'll need to modify your clients.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From francesco at rabbitmq.com  Mon Sep 17 12:05:32 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 17 Sep 2012 12:05:32 +0100
Subject: [rabbitmq-discuss] federation plugin: x-federation
	exchange	declaring
In-Reply-To: <k36vkh$9lo$1@ger.gmane.org>
References: <k36vkh$9lo$1@ger.gmane.org>
Message-ID: <87obl4rjsz.wl%francesco@rabbitmq.com>

At Mon, 17 Sep 2012 14:56:17 +0400,
Matwey V.  Kornilov wrote:
> My python clients fail at "B" with the following error:
> 
> pika.exceptions.AMQPChannelError: (406, "PRECONDITION_FAILED - cannot
> redeclare exchange 'my-exchange' in vhost '/' with different type, durable,
> internal or autodelete value")

The problem here is that you're trying to redeclare an exchange already declared
by federation, but with different arguments.  If you take care in using the same
arguments when declaring it, it won't fail.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Mon Sep 17 12:07:49 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 17 Sep 2012 12:07:49 +0100
Subject: [rabbitmq-discuss] federation plugin:
	x-federation	exchange	declaring
In-Reply-To: <87obl4rjsz.wl%francesco@rabbitmq.com>
References: <k36vkh$9lo$1@ger.gmane.org> <87obl4rjsz.wl%francesco@rabbitmq.com>
Message-ID: <87mx0orjp6.wl%francesco@rabbitmq.com>

At Mon, 17 Sep 2012 12:05:32 +0100,
Francesco Mazzoli wrote:
> The problem here is that you're trying to redeclare an exchange already declared
> by federation, but with different arguments.  If you take care in using the same
> arguments when declaring it, it won't fail.

Actually, forget my answer, and refer to what Simon said instead :).

--
Francesco * Often in error, never in doubt

From emile at rabbitmq.com  Mon Sep 17 13:57:30 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 17 Sep 2012 13:57:30 +0100
Subject: [rabbitmq-discuss] shovel ipv6 resolving dns name
In-Reply-To: <333C9868-2079-4349-B12D-56F70FA7051C@junctionnetworks.com>
References: <333C9868-2079-4349-B12D-56F70FA7051C@junctionnetworks.com>
Message-ID: <50571E3A.6060003@rabbitmq.com>

Hi Laurent,

On 14/09/12 17:23, Laurent Domb wrote:
> I set up a test shovel which shovels messages from New York to LA. When
> I use ipv6 ipaddresses the shovel works. If I exchange the ipv6
> addresses with the actual  DNS name it fails. It seems to connect to the
> ipv4 address first and then just fails. The error msg I get is: 
> 
> "{{badmatch,{error,econnrefused}},

Thanks for reporting this. I have filed a bug. Please continue to use IP
addresses until the solution is released.


-Emile


From ask at rabbitmq.com  Mon Sep 17 15:39:26 2012
From: ask at rabbitmq.com (Ask Solem)
Date: Mon, 17 Sep 2012 15:39:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ - big delays when establishing
	Kombu connection
In-Reply-To: <1347561369474-22001.post@n5.nabble.com>
References: <1347545056419-21989.post@n5.nabble.com>
	<E128B350-0FBF-4CB4-8EB5-6147F694A330@rabbitmq.com>
	<1347561369474-22001.post@n5.nabble.com>
Message-ID: <87246121-ADA7-4060-84EE-68E3B1CCD1EA@rabbitmq.com>


On 13 Sep 2012, at 19:36, eugene <eugene.doktorov at gmail.com> wrote:

> Hi Ask,
> 
> Thank you for replying!
> 
> I'm not sure how to check if celery/rabbit are using librabbitmq
> 
> Here go output from 'locate' command:
> SERVER
> [eugene.doktorov at ip-10-0-1-60 mlayer]$ sudo locate librabbitmq
> /usr/lib/python2.6/site-packages/kombu/transport/librabbitmq.py
> /usr/lib/python2.6/site-packages/kombu/transport/librabbitmq.pyc
> /usr/lib64/python2.6/site-packages/_librabbitmq.so
> /usr/lib64/python2.6/site-packages/librabbitmq
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info
> /usr/lib64/python2.6/site-packages/librabbitmq/__init__.py
> /usr/lib64/python2.6/site-packages/librabbitmq/__init__.pyc
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/PKG-INFO
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/SOURCES.txt
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/dependency_links.txt
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/installed-files.txt
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/not-zip-safe
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/top_level.txt
> /usr/local/lib/librabbitmq.so
> /usr/local/lib/pkgconfig/librabbitmq.pc
> 
> CLIENT
> 
> [eugene.doktorov at prodback1 rabbitmq-c]$ sudo locate librabbitmq
> /usr/lib/python2.6/site-packages/kombu/transport/librabbitmq.py
> /usr/lib/python2.6/site-packages/kombu/transport/librabbitmq.pyc
> /usr/lib64/python2.6/site-packages/_librabbitmq.so
> /usr/lib64/python2.6/site-packages/librabbitmq
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info
> /usr/lib64/python2.6/site-packages/librabbitmq/__init__.py
> /usr/lib64/python2.6/site-packages/librabbitmq/__init__.pyc
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/PKG-INFO
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/SOURCES.txt
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/dependency_links.txt
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/installed-files.txt
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/not-zip-safe
> /usr/lib64/python2.6/site-packages/librabbitmq-0.9.9-py2.6.egg-info/top_level.txt
> /usr/local/lib/librabbitmq.so
> /usr/local/lib/pkgconfig/librabbitmq.pc
> 
> 
> Is it enough to say that librabbitmq is used?
> BTW, I still see the same delays
> 

The kombu 'amqp://' alias uses librabbitmq if installed,
but to make sure you can specify it explicitly by using librabbitmq://


From mark.hingston at vardr.com  Tue Sep 18 03:22:49 2012
From: mark.hingston at vardr.com (Mark Hingston)
Date: Tue, 18 Sep 2012 12:22:49 +1000
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
In-Reply-To: <5056F045.8080002@rabbitmq.com>
References: <5056C685.4040709@vardr.com> <5056CF74.8010502@rabbitmq.com>
	<5056D7ED.2090102@vardr.com> <5056F045.8080002@rabbitmq.com>
Message-ID: <5057DAF9.3070601@vardr.com>

On 17/09/12 7:41 PM, Matthias Radestock wrote:
> Ah. That's a bug in the stomp plug-in. It's been around since 2.8.3. 
> Will fix.
>
> The upshot is that from then onwards alarm handling is broken, which 
> explains why the subsequent clearing of the disk alarm wasn't 
> unblocking producers for you.

Ok, thanks for the explanation. So is my best option to disable the 
stomp plugin until this is fixed?


> The fact that the server is "slow" because it encountered an alarm 
> condition is neither here or there - as far as the client is concerned 
> it's just talking to a slow server.
>
> So your question really comes down to how would you expect a client to 
> detect and deal with a slow server / congested network.
>

Thanks for the explanation. I guess now I'm trying to figure out what 
the best way is to defend against this situation so that my messages 
don't get lost. To make this happen I was thinking that the client 
should not report the message successfully sent to our upstream 
components until it gets some confirmation from rabbit that the message 
has been actually added to a queue. Wrt, it looks like a while back 
Simon MacMullen gave this answer in the topic: "Guaranteed delivery":

" At the moment the only way you can guarantee that a publish has gone
through is to publish inside a transaction - when the transaction commit
completes the message is on disk (assuming durable queue / persistent
message). This is a little heavyweight though. In the future we intend
to introduce streaming publisher acks to do the same job in a more async
way."

Is there any chance a more lightweight alternative to accomplish this 
has emerged in the past couple of years?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120918/1f9ab845/attachment.htm>

From mark.hingston at vardr.com  Tue Sep 18 03:49:17 2012
From: mark.hingston at vardr.com (Mark Hingston)
Date: Tue, 18 Sep 2012 12:49:17 +1000
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
In-Reply-To: <5057DAF9.3070601@vardr.com>
References: <5056C685.4040709@vardr.com> <5056CF74.8010502@rabbitmq.com>
	<5056D7ED.2090102@vardr.com> <5056F045.8080002@rabbitmq.com>
	<5057DAF9.3070601@vardr.com>
Message-ID: <5057E12D.60700@vardr.com>

On 18/09/12 12:22 PM, Mark Hingston wrote:
> Is there any chance a more lightweight alternative to accomplish this 
> has emerged in the past couple of years?
Looks like publisher confirms are what I want, and celery recently began 
to support them (in version 0.9.1 I believe)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120918/9930a635/attachment.htm>

From mark.hingston at vardr.com  Tue Sep 18 04:00:02 2012
From: mark.hingston at vardr.com (Mark Hingston)
Date: Tue, 18 Sep 2012 13:00:02 +1000
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
In-Reply-To: <5057E12D.60700@vardr.com>
References: <5056C685.4040709@vardr.com> <5056CF74.8010502@rabbitmq.com>
	<5056D7ED.2090102@vardr.com> <5056F045.8080002@rabbitmq.com>
	<5057DAF9.3070601@vardr.com> <5057E12D.60700@vardr.com>
Message-ID: <5057E3B2.4090906@vardr.com>

On 18/09/12 12:49 PM, Mark Hingston wrote:
> On 18/09/12 12:22 PM, Mark Hingston wrote:
>> Is there any chance a more lightweight alternative to accomplish this 
>> has emerged in the past couple of years?
> Looks like publisher confirms are what I want, and celery recently 
> began to support them (in version 0.9.1 I believe)
Apologies - it's py-amqp (https://github.com/celery/py-amqp) version 
0.9.1 that recently began to support publisher confirms. As for if / 
when celery supports using publisher confirms, I'm yet to find out.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120918/29871c3a/attachment.htm>

From matthias at rabbitmq.com  Tue Sep 18 06:46:55 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 18 Sep 2012 06:46:55 +0100
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
In-Reply-To: <5057DAF9.3070601@vardr.com>
References: <5056C685.4040709@vardr.com> <5056CF74.8010502@rabbitmq.com>
	<5056D7ED.2090102@vardr.com> <5056F045.8080002@rabbitmq.com>
	<5057DAF9.3070601@vardr.com>
Message-ID: <50580ACF.5040900@rabbitmq.com>

Mark,

On 18/09/12 03:22, Mark Hingston wrote:
> On 17/09/12 7:41 PM, Matthias Radestock wrote:
>> Ah. That's a bug in the stomp plug-in. It's been around since 2.8.3.
>> Will fix.
>
> Ok, thanks for the explanation. So is my best option to disable the
> stomp plugin until this is fixed?

Yes, if you can live w/o it. Or make sure you don't hit the alarms ;)

>> So your question really comes down to how would you expect a client to
>> detect and deal with a slow server / congested network.
>
> Thanks for the explanation. I guess now I'm trying to figure out what
> the best way is to defend against this situation so that my messages
> don't get lost.

As you noted, publisher confirms would be one way and are definitely the 
way to go when wanting to ensure that no messages are lost, ever, on 
their delivery to rabbit. I don't know about their status in celery.

However, before you go down that route, consider carefully what other 
failure modes there are in your system. It's all very well to ensure 
that the message delivery to rabbit is reliable, but if the connecting 
application can explode and lose messages then that may not actually 
gain you very much.

On the rabbit/connection side, messages will only be lost if the 
connection is dropped or rabbit encounters some catastrophic internal 
error. Alarm conditions are transitory, i.e. you can recover from them 
w/o restarting rabbit, by, say, consuming messages (to free up memory) 
or clearing some disk space.

So depending on how reliable your network and machines are (and leaving 
aside the alarm-handler-killing stomp bug), the most likely place for 
messages to get dropped may not actually be on the rabbit side.

Regards,

Matthias

From mark.hingston at vardr.com  Tue Sep 18 08:11:33 2012
From: mark.hingston at vardr.com (Mark Hingston)
Date: Tue, 18 Sep 2012 17:11:33 +1000
Subject: [rabbitmq-discuss] Confusing disk free space limit warning
In-Reply-To: <50580ACF.5040900@rabbitmq.com>
References: <5056C685.4040709@vardr.com> <5056CF74.8010502@rabbitmq.com>
	<5056D7ED.2090102@vardr.com> <5056F045.8080002@rabbitmq.com>
	<5057DAF9.3070601@vardr.com> <50580ACF.5040900@rabbitmq.com>
Message-ID: <50581EA5.8010006@vardr.com>

On 18/09/12 3:46 PM, Matthias Radestock wrote:

>>> So your question really comes down to how would you expect a client to
>>> detect and deal with a slow server / congested network.
>>
>> Thanks for the explanation. I guess now I'm trying to figure out what
>> the best way is to defend against this situation so that my messages
>> don't get lost.
>
> As you noted, publisher confirms would be one way and are definitely 
> the way to go when wanting to ensure that no messages are lost, ever, 
> on their delivery to rabbit. I don't know about their status in celery.
>
> However, before you go down that route, consider carefully what other 
> failure modes there are in your system. It's all very well to ensure 
> that the message delivery to rabbit is reliable, but if the connecting 
> application can explode and lose messages then that may not actually 
> gain you very much.
>
> On the rabbit/connection side, messages will only be lost if the 
> connection is dropped or rabbit encounters some catastrophic internal 
> error. Alarm conditions are transitory, i.e. you can recover from them 
> w/o restarting rabbit, by, say, consuming messages (to free up memory) 
> or clearing some disk space.
>
> So depending on how reliable your network and machines are (and 
> leaving aside the alarm-handler-killing stomp bug), the most likely 
> place for messages to get dropped may not actually be on the rabbit side.

Thanks for that - I'll keep it in mind. I've raised the question of how 
best to handle this situation when running celery in this thread over at 
the celery group:

https://groups.google.com/forum/#!msg/celery-users/G-tq8SsHkuA/01Ndr2VBZhwJ

From inetfuture at gmail.com  Tue Sep 18 15:26:51 2012
From: inetfuture at gmail.com (=?ISO-8859-1?B?aW5ldGZ1dHVyZQ==?=)
Date: Tue, 18 Sep 2012 22:26:51 +0800
Subject: [rabbitmq-discuss] The best practice of deploying
Message-ID: <tencent_03F24DFF0091E4F90FEC5798@qq.com>

Hi,
    I am wondering which of these would be better:one node per machine or multiple nodes per machine(it/they serve the same application)?
    Dose one node can fully use resources of a machine? Dose run more than one node on a single machine will be better?
    I'm using RabbitMQ with Celery, there would be a few machines to run RabbitMQ nodes(in a single cluster), so I need to decide that how many node to deploy on per machine. I'm wondering this because in usually practice, like multiple processes/threads, "multiple" will do better, but I'm not sure how RabbitMQ dose.


Thanks,
Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120918/63b9e562/attachment.htm>

From quortex at gmail.com  Tue Sep 18 16:58:51 2012
From: quortex at gmail.com (Mark Everett)
Date: Tue, 18 Sep 2012 08:58:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Security Privileges Question
Message-ID: <c58b1913-46e4-40d1-85ab-920619170590@googlegroups.com>

Hey,

I need to be able to make a client create queues when they do not exist and 
read from queues. However, I do NOT want the client to be able to write 
messages to the queue.

Is this possible? Thanks in advance.

Cheers,
Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120918/63736fe1/attachment.htm>

From simon at rabbitmq.com  Tue Sep 18 17:15:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 18 Sep 2012 17:15:44 +0100
Subject: [rabbitmq-discuss] The best practice of deploying
In-Reply-To: <tencent_03F24DFF0091E4F90FEC5798@qq.com>
References: <tencent_03F24DFF0091E4F90FEC5798@qq.com>
Message-ID: <50589E30.3060204@rabbitmq.com>

In ancient times Erlang's multi-core support was not great, and we used 
to suggest installing N nodes on an N core machine.

But those days are long past, and doing the above just introduces 
additional overhead, both CPU overhead to the broker and administrative 
overhead to the sysadmin.

Just install one mode per machine.

There is a valid use case for more than one node per machine for 
learning about clustering and sometimes for testing, but not for production.

Cheers, Simon

On 18/09/12 15:26, inetfuture wrote:
> Hi,
> I am wondering which of these would be better:one node per machine or
> multiple nodes per machine(it/they serve the same application)?
> Dose one node can fully use resources of a machine? Dose run more than
> one node on a single machine will be better?
> I'm using RabbitMQ with Celery, there would be a few machines to run
> RabbitMQ nodes(in a single cluster), so I need to decide that how many
> node to deploy on per machine. I'm wondering this because in usually
> practice, like multiple processes/threads, "multiple" will do better,
> but I'm not sure how RabbitMQ dose.
>
> Thanks,
> Aaron
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From michael.john.barry at gmail.com  Tue Sep 18 19:37:06 2012
From: michael.john.barry at gmail.com (Mike Barry)
Date: Tue, 18 Sep 2012 11:37:06 -0700 (PDT)
Subject: [rabbitmq-discuss] HA with C#. Ending server does not cause
	HandleBasicCancel
Message-ID: <ddd18971-490b-4a95-81ca-cfe06f7684b8@googlegroups.com>

Hello,

I have a 2 node (both disk) cluster setup. In an attempt to simulate a node 
failure I am killing the erlang process hosting rabbit on the master for a 
durable queue. I would expect to get a HandleBasicCancel as defined in the 
documentation, however I am only getting an OnCancel. Is this expected? 
Should I be simulating a node failure in another way? I tried setting the 
client capabilities but it seems the C# client sends true for 
consumer_cancel_notify no matter what I specify. I validate this via the 
management website for the connection and see:

capabilities 
publisher_confirms: true
exchange_exchange_bindings: true
consumer_cancel_notify: true
basic.nack: true

I create the queue with the following code:

ConnectionFactory factory = new ConnectionFactory();                       
        
factory.HostName = "localhost";                

this.connection = factory.CreateConnection();                
this.channel = this.connection.CreateModel();                               
 
this.queueConsumer = new FabricNotificationQueueConsumer(this.region, 
this.groupName, this.serializer,
                                                                        
 this.cache);

Dictionary<string, object> queueArgs = new Dictionary<string, object>();
queueArgs.Add("x-ha-policy", "all");

this.channel.QueueDeclare(QueueName, true, false, false, queueArgs);
this.channel.QueueBind(QueueName, exchange, string.Format("{0}.{1}.*", 
this.region, this.groupName));
this.channel.BasicConsume(QueueName, true, this.queueConsumer);

Thanks for your help,
Mike


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120918/19362ef7/attachment.htm>

From jerryk at rbcon.com  Tue Sep 18 21:14:02 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Tue, 18 Sep 2012 13:14:02 -0700
Subject: [rabbitmq-discuss] Security Privileges Question
In-Reply-To: <c58b1913-46e4-40d1-85ab-920619170590@googlegroups.com>
References: <c58b1913-46e4-40d1-85ab-920619170590@googlegroups.com>
Message-ID: <CAE0Sz=y=ThbSau7yk7cMNBpuOROj9NGS5zA-2K7=z28wBBpGSQ@mail.gmail.com>

Hi, Mark:

See the convenient table in http://www.rabbitmq.com/access-control.html

To prevent publishing, deprive your client of the write privilege for the
exchange in question.  Creating queues will require the configure
permission on the queue's name, and binding the newly created queue to the
exchange requires you to be able to write the queue and read the exchange.

More exotic limitations are possible if you write your own custom auth
backend, although that will require you to write Erlang code and understand
a few of Rabbit's internal interfaces, how to compile a plug-in, etc.

Best regards,
Jerry

On Tue, Sep 18, 2012 at 8:58 AM, Mark Everett <quortex at gmail.com> wrote:

> Hey,
>
> I need to be able to make a client create queues when they do not exist
> and read from queues. However, I do NOT want the client to be able to write
> messages to the queue.
>
> Is this possible? Thanks in advance.
>
> Cheers,
> Mark
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120918/a19307fc/attachment.htm>

From tim at rabbitmq.com  Wed Sep 19 09:37:43 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 19 Sep 2012 09:37:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <CACLE7iz-D4xkRy7JuP4F5g0NFtsTWW5htJ+fyuboVXTspKJA0Q@mail.gmail.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<5051BD53.3000401@rabbitmq.com>
	<B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>
	<CACLE7ixuiiz6MNuLXHYdLoSnu+p5Drp7++3wvo8umQFCn2=2KQ@mail.gmail.com>
	<49F9DCE2-2ED2-4791-94FC-1FB57D237A8C@rabbitmq.com>
	<CACLE7ixf0Jeq1hNSM8ojqaBGTC+4ELpaf2JfbaPtaQV0L0hiMA@mail.gmail.com>
	<DF417068-6E61-4473-97DE-3B618014B590@rabbitmq.com>
	<CACLE7iz-D4xkRy7JuP4F5g0NFtsTWW5htJ+fyuboVXTspKJA0Q@mail.gmail.com>
Message-ID: <B35E667D-AF62-4901-9556-38F7ABD9A49C@rabbitmq.com>

Hi Matt,

Just to keep you up to date - we're still investigating this. I will reply here once we've got to the bottom of it.

Cheers,
Tim

On 13 Sep 2012, at 21:05, Matt Pietrek wrote:

> Here you to Tim:
> 
> The scrubbed rabbit at mq1.log:
> --------
> =INFO REPORT==== 13-Sep-2012::12:00:21 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
> 
> =INFO REPORT==== 13-Sep-2012::12:00:21 ===
>     application: rabbitmq_federation
>     exited: stopped
>     type: permanent
> 
> =INFO REPORT==== 13-Sep-2012::12:00:21 ===
> Stopping Rabbit
> 
> =INFO REPORT==== 13-Sep-2012::12:00:21 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
> 
> =WARNING REPORT==== 13-Sep-2012::12:00:21 ===
> Connection (<0.1659.0>) closing: internal error in channel (<0.1666.0>): shutdown
> 
> =INFO REPORT==== 13-Sep-2012::12:00:21 ===
> stopped TCP Listener on 0.0.0.0:5672
> 
> =ERROR REPORT==== 13-Sep-2012::12:17:00 ===
> ** Generic server <0.1676.0> terminating 
> ** Last message in was {inet_async,#Port<0.5748>,5106,{error,etimedout}}
> ** When Server state == {state,#Port<0.5748>,<0.1671.0>,<0.1673.0>,
>                                {method,rabbit_framing_amqp_0_9_1},
>                                none}
> ** Reason for termination == 
> ** {socket_error,etimedout}
> 
> =ERROR REPORT==== 13-Sep-2012::12:17:00 ===
> ** Generic server <0.1671.0> terminating 
> ** Last message in was {socket_error,etimedout}
> ** When Server state == {state,amqp_network_connection,
>                             {state,#Port<0.5748>,0,<0.1675.0>,131072,
>                                 undefined,false},
>                             <0.1670.0>,<0.1673.0>,
>                             {amqp_params_network,<<"guest">>,<<"guest">>,
>                                 <<"/">>,"slg1matt1.xyz.com",
>                                 5672,0,0,0,infinity,none,
>                                 [#Fun<amqp_auth_mechanisms.plain.3>,
>                                  #Fun<amqp_auth_mechanisms.amqplain.3>],
>                                 [],[]},
>                             0,
>                             [{<<"capabilities">>,table,
>                               [{<<"publisher_confirms">>,bool,true},
>                                {<<"exchange_exchange_bindings">>,bool,true},
>                                {<<"basic.nack">>,bool,true},
>                                {<<"consumer_cancel_notify">>,bool,true}]},
>                              {<<"copyright">>,longstr,
>                               <<"Copyright (C) 2007-2012 VMware, Inc.">>},
>                              {<<"information">>,longstr,
>                               <<"Licensed under the MPL.  See http://www.rabbitmq.com/">>},
>                              {<<"platform">>,longstr,<<"Erlang/OTP">>},
>                              {<<"product">>,longstr,<<"RabbitMQ">>},
>                              {<<"version">>,longstr,<<"2.8.6">>}],
>                             #Fun<amqp_connection_sup.0.39273983>,
>                             #Fun<amqp_connection_sup.2.54430129>,false}
> ** Reason for termination == 
> ** {socket_error,etimedout}
> 
> =ERROR REPORT==== 13-Sep-2012::12:17:00 ===
> ** Generic server <0.1657.0> terminating
> ** Last message in was {'EXIT',<0.197.0>,shutdown}
> ** When Server state == {state,
>                          {upstream,
>                           {amqp_params_network,<<"guest">>,<<"guest">>,
>                            <<"/">>,"slg1matt1.xyz.com",5672,0,
>                            0,0,infinity,none,
>                            [#Fun<amqp_auth_mechanisms.plain.3>,
>                             #Fun<amqp_auth_mechanisms.amqplain.3>],
>                            [],[]},
>                           <<"skytap">>,1000,1,1,none,none,none,"upstream-slg"},
>                          <0.1671.0>,<0.1683.0>,
>                          <<"federation: skytap -> rabbit at mq1.matt.xyz.com">>,
>                          <<"federation: skytap -> rabbit at mq1.matt.xyz.com A">>,
>                          {0,nil},
>                          115,
>                          {dict,10,16,16,8,80,48,
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                           {{[],
>                             [[{<<"charon.us-east.default">>,[]}|
>                               {set,1,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],[],[],[],[],[],
>                                  [{resource,<<"/">>,exchange,
>                                    <<"federation: skytap -> rabbit at slg1matt1.xyz.com A">>}],
>                                  [],[],[]}}}]],
>                             [],
>                             [[{<<"cmcmd.us-east.default">>,[]}|
>                               {set,1,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],[],[],[],[],[],
>                                  [{resource,<<"/">>,exchange,
>                                    <<"federation: skytap -> rabbit at slg1matt1.xyz.com A">>}],
>                                  [],[],[]}}}],
>                              [{<<"charon.us-west.default">>,[]}|
>                               {set,2,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],
>                                  [{resource,<<"/">>,queue,<<"charon">>}],
>                                  [],[],[],[],[],[],[],[],
>                                  [{resource,<<"/">>,exchange,
>                                    <<"federation: skytap -> rabbit at slg1matt1.xyz.com A">>}],
>                                  [],[],[]}}}]],
>                             [],
>                             [[{<<"cmcmd.us-west.default">>,[]}|
>                               {set,2,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],
>                                  [{resource,<<"/">>,queue,<<"cmcmd">>}],
>                                  [],[],[],[],[],[],
>                                  [{resource,<<"/">>,exchange,
>                                    <<"federation: skytap -> rabbit at slg1matt1.xyz.com A">>}],
>                                  [],[],[]}}}]],
>                             [],
>                             [[{<<"system_test.us-east.default">>,[]}|
>                               {set,1,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],[],[],[],[],[],
>                                  [{resource,<<"/">>,exchange,
>                                    <<"federation: skytap -> rabbit at slg1matt1.xyz.com A">>}],
>                                  [],[],[]}}}]],
>                             [],
>                             [[{<<"system_test.us-west.default">>,[]}|
>                               {set,2,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],
>                                  [{resource,<<"/">>,queue,<<"system_test">>}],
>                                  [],[],[],[],[],[],[],[],[],[],
>                                  [{resource,<<"/">>,exchange,
>                                    <<"federation: skytap -> rabbit at slg1matt1.xyz.com A">>}],
>                                  [],[],[]}}}]],
>                             [],[],
>                             [[{<<"unit_test.us-east.default">>,[]}|
>                               {set,1,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],[],[],[],[],[],
>                                  [{resource,<<"/">>,exchange,
>                                    <<"federation: skytap -> rabbit at slg1matt1.xyz.com A">>}],
>                                  [],[],[]}}}]],
>                             [[{<<"ConfigurationManager.us-east.default">>,
>                                []}|
>                               {set,1,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],[],[],[],[],[],
>                                  [{resource,<<"/">>,exchange,
>                                    <<"federation: skytap -> rabbit at slg1matt1.xyz.com A">>}],
>                                  [],[],[]}}}]],
>                             [[{<<"unit_test.us-west.default">>,[]}|
>                               {set,2,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],[],
>                                  [{resource,<<"/">>,queue,<<"unit_test">>}],
>                                  [],[],[],
>                                  [{resource,<<"/">>,exchange,
>                                    <<"federation: skytap -> rabbit at slg1matt1.xyz.com A">>}],
>                                  [],[],[]}}}]],
>                             [[{<<"ConfigurationManager.us-west.default">>,
>                                []}|
>                               {set,2,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],
>                                  [{resource,<<"/">>,queue,
>                                    <<"ConfigurationManager">>}],
>                                  [],[],[],[],
>                                  [{resource,<<"/">>,exchange,
>                                    <<"federation: skytap -> rabbit at slg1matt1.xyz.com A">>}],
>                                  [],[],[]}}}]]}}},
>                          <0.1659.0>,<0.1666.0>,
>                          {resource,<<"/">>,exchange,<<"skytap">>},
>                          {0,nil}}
> ** Reason for termination == 
> ** {undef,
>        [{rabbit_federation_old_status,report,
>             [{upstream,
>                  {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
>                      "slg1matt1.xyz.com",5672,0,0,0,infinity,
>                      none,
>                      [#Fun<amqp_auth_mechanisms.plain.3>,
>                       #Fun<amqp_auth_mechanisms.amqplain.3>],
>                      [],[]},
>                  <<"skytap">>,1000,1,1,none,none,none,"upstream-slg"},
>              {resource,<<"/">>,exchange,<<"skytap">>},
>              shutdown],
>             []},
>         {rabbit_federation_link,terminate,2,[]},
>         {gen_server2,terminate,3,[]},
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
> ** In 'terminate' callback with reason ==
> ** shutdown
> 
> =INFO REPORT==== 13-Sep-2012::12:17:00 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
> 
> =INFO REPORT==== 13-Sep-2012::12:17:00 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
> 
> =INFO REPORT==== 13-Sep-2012::12:17:00 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
> 
> =INFO REPORT==== 13-Sep-2012::12:17:00 ===
> Halting Erlang VM
> --------
> 
> And the scrubbed rabbit at mq1-sasl.log:
> 
> --------
> =SUPERVISOR REPORT==== 13-Sep-2012::12:00:21 ===
>      Supervisor: {<0.1664.0>,amqp_channel_sup}
>      Context:    child_terminated
>      Reason:     shutdown
>      Offender:   [{pid,<0.1666.0>},
>                   {name,channel},
>                   {mfa,{amqp_channel,start_link,
>                                      [direct,<0.1659.0>,1,<0.1665.0>,
>                                       #Fun<amqp_channel_sup.0.24953263>]}},
>                   {restart_type,intrinsic},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
> 
> 
> =SUPERVISOR REPORT==== 13-Sep-2012::12:00:21 ===
>      Supervisor: {<0.1664.0>,amqp_channel_sup}
>      Context:    shutdown
>      Reason:     reached_max_restart_intensity
>      Offender:   [{pid,<0.1666.0>},
>                   {name,channel},
>                   {mfa,{amqp_channel,start_link,
>                                      [direct,<0.1659.0>,1,<0.1665.0>,
>                                       #Fun<amqp_channel_sup.0.24953263>]}},
>                   {restart_type,intrinsic},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
> 
> 
> =CRASH REPORT==== 13-Sep-2012::12:17:00 ===
>   crasher:
>     initial call: amqp_main_reader:init/1
>     pid: <0.1676.0>
>     registered_name: []
>     exception exit: {socket_error,etimedout}
>       in function  gen_server:terminate/6 (gen_server.erl, line 747)
>     ancestors: [<0.1674.0>,<0.1670.0>,amqp_sup,<0.240.0>]
>     messages: []
>     links: [<0.1674.0>]
>     dictionary: []
>     trap_exit: false
>     status: running
>     heap_size: 2584
>     stack_size: 24
>     reductions: 2529
>   neighbours:
> 
> =CRASH REPORT==== 13-Sep-2012::12:17:00 ===
>   crasher:
>     initial call: amqp_gen_connection:init/1
>     pid: <0.1671.0>
>     registered_name: []
>     exception exit: {socket_error,etimedout}
>       in function  gen_server:terminate/6 (gen_server.erl, line 747)
>     ancestors: [<0.1670.0>,amqp_sup,<0.240.0>]
>     messages: []
>     links: [<0.1670.0>,#Port<0.5748>]
>     dictionary: []
>     trap_exit: false
>     status: running
>     heap_size: 1597
>     stack_size: 24
>     reductions: 805
>   neighbours:
> 
> =SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
>      Supervisor: {<0.1670.0>,amqp_connection_sup}
>      Context:    child_terminated
>      Reason:     {socket_error,etimedout}
>      Offender:   [{pid,<0.1671.0>},
>                   {name,connection},
>                   {mfa,
>                       {amqp_gen_connection,start_link,
>                           [amqp_network_connection,
>                            {amqp_params_network,<<"guest">>,<<"guest">>,
>                                <<"/">>,"slg1matt1.xyz.com",
>                                5672,0,0,0,infinity,none,
>                                [#Fun<amqp_auth_mechanisms.plain.3>,
>                                 #Fun<amqp_auth_mechanisms.amqplain.3>],
>                                [],[]},
>                            #Fun<amqp_connection_sup.0.39273983>,
>                            #Fun<amqp_connection_sup.2.54430129>,[]]}},
>                   {restart_type,intrinsic},
>                   {shutdown,brutal_kill},
>                   {child_type,worker}]
> 
> 
> =SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
>      Supervisor: {<0.1670.0>,amqp_connection_sup}
>      Context:    shutdown
>      Reason:     reached_max_restart_intensity
>      Offender:   [{pid,<0.1671.0>},
>                   {name,connection},
>                   {mfa,
>                       {amqp_gen_connection,start_link,
>                           [amqp_network_connection,
>                            {amqp_params_network,<<"guest">>,<<"guest">>,
>                                <<"/">>,"slg1matt1.xyz.com",
>                                5672,0,0,0,infinity,none,
>                                [#Fun<amqp_auth_mechanisms.plain.3>,
>                                 #Fun<amqp_auth_mechanisms.amqplain.3>],
>                                [],[]},
>                            #Fun<amqp_connection_sup.0.39273983>,
>                            #Fun<amqp_connection_sup.2.54430129>,[]]}},
>                   {restart_type,intrinsic},
>                   {shutdown,brutal_kill},
>                   {child_type,worker}]
> 
> 
> =SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
>      Supervisor: {<0.1674.0>,
>                                            amqp_connection_type_sup}
>      Context:    child_terminated
>      Reason:     {socket_error,etimedout}
>      Offender:   [{pid,<0.1676.0>},
>                   {name,main_reader},
>                   {mfa,
>                       {amqp_main_reader,start_link,
>                           [#Port<0.5748>,<0.1671.0>,<0.1673.0>,
>                            {method,rabbit_framing_amqp_0_9_1}]}},
>                   {restart_type,transient},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
> 
> 
> =SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
>      Supervisor: {<0.1674.0>,
>                                            amqp_connection_type_sup}
>      Context:    shutdown
>      Reason:     reached_max_restart_intensity
>      Offender:   [{pid,<0.1676.0>},
>                   {name,main_reader},
>                   {mfa,
>                       {amqp_main_reader,start_link,
>                           [#Port<0.5748>,<0.1671.0>,<0.1673.0>,
>                            {method,rabbit_framing_amqp_0_9_1}]}},
>                   {restart_type,transient},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
> 
> 
> =CRASH REPORT==== 13-Sep-2012::12:17:00 ===
>   crasher:
>     initial call: gen:init_it/6
>     pid: <0.1657.0>
>     registered_name: []
>     exception exit: {undef,
>                         [{rabbit_federation_old_status,report,
>                              [{upstream,
>                                   {amqp_params_network,<<"guest">>,
>                                       <<"guest">>,<<"/">>,
>                                       "slg1matt1.xyz.com",
>                                       5672,0,0,0,infinity,none,
>                                       [#Fun<amqp_auth_mechanisms.plain.3>,
>                                        #Fun<amqp_auth_mechanisms.amqplain.3>],
>                                       [],[]},
>                                   <<"skytap">>,1000,1,1,none,none,none,
>                                   "upstream-slg"},
>                               {resource,<<"/">>,exchange,<<"skytap">>},
>                               shutdown],
>                              []},
>                          {rabbit_federation_link,terminate,2,[]},
>                          {gen_server2,terminate,3,[]},
>                          {proc_lib,init_p_do_apply,3,
>                              [{file,"proc_lib.erl"},{line,227}]}]}
>       in function  gen_server2:terminate/3 
>     ancestors: [<0.197.0>,<0.194.0>,rabbit_federation_link_sup_sup,
>                   rabbit_federation_sup,rabbit_sup,<0.143.0>]
>     messages: [{'DOWN',#Ref<0.0.0.8909>,process,<0.1683.0>,shutdown}]
>     links: []
>     dictionary: []
>     trap_exit: true
>     status: running
>     heap_size: 2584
>     stack_size: 24
>     reductions: 9640
>   neighbours:
> 
> =SUPERVISOR REPORT==== 13-Sep-2012::12:17:00 ===
>      Supervisor: {<0.197.0>,
>                                            rabbit_federation_link_sup}
>      Context:    shutdown_error
>      Reason:     {undef,
>                      [{rabbit_federation_old_status,report,
>                           [{upstream,
>                                {amqp_params_network,<<"guest">>,<<"guest">>,
>                                    <<"/">>,
>                                    "slg1matt1.xyz.com",5672,0,
>                                    0,0,infinity,none,
>                                    [#Fun<amqp_auth_mechanisms.plain.3>,
>                                     #Fun<amqp_auth_mechanisms.amqplain.3>],
>                                    [],[]},
>                                <<"skytap">>,1000,1,1,none,none,none,
>                                "upstream-slg"},
>                            {resource,<<"/">>,exchange,<<"skytap">>},
>                            shutdown],
>                           []},
>                       {rabbit_federation_link,terminate,2,[]},
>                       {gen_server2,terminate,3,[]},
>                       {proc_lib,init_p_do_apply,3,
>                           [{file,"proc_lib.erl"},{line,227}]}]}
>      Offender:   [{pid,<0.1657.0>},
>                   {name,
>                       {upstream,
>                           {amqp_params_network,<<"guest">>,<<"guest">>,
>                               <<"/">>,"slg1matt1.xyz.com",
>                               5672,0,0,0,infinity,none,
>                               [#Fun<amqp_auth_mechanisms.plain.3>,
>                                #Fun<amqp_auth_mechanisms.amqplain.3>],
>                               [],[]},
>                           <<"skytap">>,1000,1,1,none,none,none,
>                           "upstream-slg"}},
>                   {mfa,
>                       {rabbit_federation_link,start_link,
>                           [{{upstream,
>                                 {amqp_params_network,<<"guest">>,<<"guest">>,
>                                     <<"/">>,
>                                     "slg1matt1.xyz.com",5672,
>                                     0,0,0,infinity,none,
>                                     [#Fun<amqp_auth_mechanisms.plain.3>,
>                                      #Fun<amqp_auth_mechanisms.amqplain.3>],
>                                     [],[]},
>                                 <<"skytap">>,1000,1,1,none,none,none,
>                                 "upstream-slg"},
>                             {resource,<<"/">>,exchange,<<"skytap">>}}]}},
>                   {restart_type,{permanent,1}},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
> 
> --------
> 
> On Thu, Sep 13, 2012 at 12:30 PM, Tim Watson <tim at rabbitmq.com> wrote:
> 
> On 13 Sep 2012, at 20:26, Matt Pietrek wrote:
> 
> > We "own" the network in that it's a direct connection between two datacenters. It's not a particularly high speed connection, but it's generally reliable. I've done some ping tests between the two nodes and while an occasional packet will drop every once in awhile, it's not a really horrible connection. The average ping round trip time is areound 80ms.
> >
> > I'd be surprised if it's a dropped packet, as the shutdown on both brokers seems to consistently take a long time. I just reproed this again, and one broker took 1000 seconds to shut down, while the other took 995. I have the logs from this repro, but a quick glance doesn't show anything radically different. Let me know if there's anything else I can supply.
> >
> 
> Ok - do send the second pair of logs (or a scrubbed version if you need to hide private data) please, as we're keen to get to the bottom of this.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/f14419ad/attachment.htm>

From emiliano.calori at selyon.com  Wed Sep 19 09:45:18 2012
From: emiliano.calori at selyon.com (emiliano.calori)
Date: Wed, 19 Sep 2012 01:45:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Introducing RabbitMQ-Web-STOMP plugin!
In-Reply-To: <4FB0F4C6.1050904@rabbitmq.com>
References: <CABzX+qyf=pKtpRyZMcOjt72gDnuDJ9TBigX3qSrPqvwCOrRdyw@mail.gmail.com>
	<CAE3HoVQNVThPvLigMTO0qO7w=Y2r4owa3av98iuf=9X52TNGvw@mail.gmail.com>
	<4FB0F4C6.1050904@rabbitmq.com>
Message-ID: <1348044318144-22064.post@n5.nabble.com>

Very useful plugin.
Any news about when it will be included in the RabbitMQ release?
Regards.

Emiliano Calori




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Introducing-RabbitMQ-Web-STOMP-plugin-tp11794p22064.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed Sep 19 10:24:40 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Sep 2012 10:24:40 +0100
Subject: [rabbitmq-discuss] Introducing RabbitMQ-Web-STOMP plugin!
In-Reply-To: <1348044318144-22064.post@n5.nabble.com>
References: <CABzX+qyf=pKtpRyZMcOjt72gDnuDJ9TBigX3qSrPqvwCOrRdyw@mail.gmail.com>	<CAE3HoVQNVThPvLigMTO0qO7w=Y2r4owa3av98iuf=9X52TNGvw@mail.gmail.com>	<4FB0F4C6.1050904@rabbitmq.com>
	<1348044318144-22064.post@n5.nabble.com>
Message-ID: <50598F58.7050505@rabbitmq.com>

On 19/09/12 09:45, emiliano.calori wrote:
> Any news about when it will be included in the RabbitMQ release?

The next "feature" release, i.e. not 2.8.x. Which *hopefully* should be 
in a month or so. Although we've been saying that for a while.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Sep 19 10:50:28 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 19 Sep 2012 10:50:28 +0100
Subject: [rabbitmq-discuss] HA with C#. Ending server does not cause
	HandleBasicCancel
In-Reply-To: <ddd18971-490b-4a95-81ca-cfe06f7684b8@googlegroups.com>
References: <ddd18971-490b-4a95-81ca-cfe06f7684b8@googlegroups.com>
Message-ID: <50599564.8080405@rabbitmq.com>


Hi Mike,

On 18/09/12 19:37, Mike Barry wrote:
> I would expect to get a HandleBasicCancel as
> defined in the documentation, however I am only getting an OnCancel. Is
> this expected? 

No, HandleBasicCancel should be called.

> this.queueConsumer = new FabricNotificationQueueConsumer(this.region,
> this.groupName, this.serializer,

I'm not able to replicate this problem, which makes me wonder whether
FabricNotificationQueueConsumer might be implicated somehow. Using
DefaultBasicConsumer I can confirm that HandleBasicCancel is correctly
called when the broker issues a basic.cancel. I suggest you try a
simpler example using DefaultBasicConsumer to see if you still get this
error.


-Emile



From james.mcmahon at TASC.COM  Wed Sep 19 11:09:18 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Wed, 19 Sep 2012 10:09:18 +0000
Subject: [rabbitmq-discuss] Introducing RabbitMQ-Web-STOMP plugin!
In-Reply-To: <50598F58.7050505@rabbitmq.com>
References: <CABzX+qyf=pKtpRyZMcOjt72gDnuDJ9TBigX3qSrPqvwCOrRdyw@mail.gmail.com>
	<CAE3HoVQNVThPvLigMTO0qO7w=Y2r4owa3av98iuf=9X52TNGvw@mail.gmail.com>
	<4FB0F4C6.1050904@rabbitmq.com>
	<1348044318144-22064.post@n5.nabble.com>,
	<50598F58.7050505@rabbitmq.com>
Message-ID: <242E9559AA2C354CB60C81A952FCBEB5014CC8@TSEAMB01>

For those unfamiliar with STOMP, could you give us an idea of what it would typically be used for? Does it give us a means to send and receive messages through rabbitMQ from a RESTful like web interface?

Thanks in advance for your insights.

- Jim
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Simon MacMullen [simon at rabbitmq.com]
Sent: Wednesday, September 19, 2012 5:24 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Introducing RabbitMQ-Web-STOMP plugin!

On 19/09/12 09:45, emiliano.calori wrote:
> Any news about when it will be included in the RabbitMQ release?

The next "feature" release, i.e. not 2.8.x. Which *hopefully* should be
in a month or so. Although we've been saying that for a while.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.

From ian.cross at gmail.com  Wed Sep 19 12:45:30 2012
From: ian.cross at gmail.com (Ian)
Date: Wed, 19 Sep 2012 04:45:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustered nodes failure
Message-ID: <20be5e39-2566-4cdc-97eb-8972ddba8f2a@googlegroups.com>

Hi all,

I wonder if anyone can help diagnose problems we've been having with our 
2-node clustered rabbit which sporadically seizes up completely. None of 
the applications can get through to Rabbit though it is still up and 
running. CPU and RAM spike up to 100%. The Management UI cannot be reached 
and we end up having to restart the nodes to get service back. Sometimes it 
does not come back gracefully requiring reboot.

Some stats: 

   - Both nodes are 4 Core 8GB RAM CentOS 6.2 virtual machines, running on 
   VMWare ESXi 4.1 host. We are running RabbitMQ version 2.7.1 on Erlang 
   R14B04.
   - Looking at our metrics right now I see around:
      - 1000 queues
      - 4000 channels
      - 8000 bindings
      - 16 exchanges
   - Memory usage, erlang processes, file descriptors, socket descriptors 
   are generally low and healthy

Analysing errors in the rabbit logs from a recent failure reveals:

   - Before the failure we have a bunch of background errors which may be 
   the fault of our applications like "no binding X between exchange Y in 
   vhost '/' and queue Z in vhost '/'"
   - As we ramp up to the failure we see
      - Two errors like this:
         - ?** Generic server <0.16813.1677> terminating  ** Last message 
         in was {'$gen_cast',                             
         {run_backing_queue,rabbit_mirror_queue_master,                                 
         #Fun<rabbit_mirror_queue_master.4.85178772>}}  ** When Server state == 
         {lim,0,undefined,false,[],0}  ** Reason for termination ==   ** 
         {function_clause,         [{rabbit_limiter,handle_cast,              
         [{run_backing_queue,rabbit_mirror_queue_master,                   
         #Fun<rabbit_mirror_queue_master.4.85178772>},               
         {lim,0,undefined,false,[],0}]},          
         {gen_server2,handle_msg,2},          {proc_lib,init_p_do_apply,3}]}  ?
      - A handful like this:
         - ?connection <0.14270.7735>, channel 38 - error:  
         {amqp_error,command_invalid,"second 'channel.open' seen",'channel.open'}  ?
         - A couple of these:
         - ?connection <0.158.6322>, channel 135 - error:  
         {amqp_error,not_found,              "no queue 
         'InRunning.WebClient.SessionId[l0mpn3egx5n0yj0lbs1hcehj]' in vhost 
         '/'",              'basic.get'}  ?
         - And then all these:
         - exception on TCP connection <0.14270.7735> from 
         WWW.XXX.YYY.ZZZ:59106  {inet_error,enotconn}  
         - exception on TCP connection <0.14577.1677> from 
         WWW.XXX.YYY.ZZZ:53163  {inet_error,enotconn}  
         - exception on TCP connection <0.1520.5487> from 
         WWW.XXX.YYY.ZZZ:53435  {timeout,running}  
         - exception on TCP connection <0.158.6322> from 
         WWW.XXX.YYY.ZZZ:63187  {writer,send_failed,{error,enotconn}}  
         - exception on TCP connection <0.17097.1918> from 
         WWW.XXX.YYY.ZZZ:55161  {writer,send_failed,{error,enotconn}}  
         - exception on TCP connection <0.18340.7733> from 
         WWW.XXX.YYY.ZZZ:52868  {inet_error,enotconn}  
         - exception on TCP connection <0.24514.6782> from 
         WWW.XXX.YYY.ZZZ:64362  {timeout,blocking}  
         - exception on TCP connection <0.24518.6782> from 
         WWW.XXX.YYY.ZZZ:61252  {timeout,blocking}  
         - exception on TCP connection <0.24524.6782> from 
         WWW.XXX.YYY.ZZZ:55845  {timeout,blocking}  
         - exception on TCP connection <0.24528.6782> from 
         WWW.XXX.YYY.ZZZ:53434  {timeout,blocking}  
         - exception on TCP connection <0.24532.6782> from 
         WWW.XXX.YYY.ZZZ:54398  {timeout,blocking}  
         - exception on TCP connection <0.24536.6782> from 
         WWW.XXX.YYY.ZZZ:58878  {timeout,blocking}  
         - exception on TCP connection <0.24552.6782> from 
         WWW.XXX.YYY.ZZZ:63155  {timeout,blocking}  
         - exception on TCP connection <0.2577.2793> from 
         WWW.XXX.YYY.ZZZ:52752  {writer,send_failed,{error,enotconn}}  
         - exception on TCP connection <0.26105.2580> from 
         WWW.XXX.YYY.ZZZ:50364  {writer,send_failed,{error,enotconn}}  
         - exception on TCP connection <0.27505.6740> from 
         WWW.XXX.YYY.ZZZ:56170  {writer,send_failed,{error,enotconn}}  
         - exception on TCP connection <0.27741.2921> from 
         WWW.XXX.YYY.ZZZ:54600  {writer,send_failed,{error,enotconn}}  
         - exception on TCP connection <0.28602.6323> from 
         WWW.XXX.YYY.ZZZ:56863  {writer,send_failed,{error,enotconn}}  
         - exception on TCP connection <0.30059.3135> from 
         WWW.XXX.YYY.ZZZ:57078  {writer,send_failed,{error,closed}}  
         - exception on TCP connection <0.5634.2393> from 
         WWW.XXX.YYY.ZZZ:53807  {writer,send_failed,{error,enotconn}}  
         - exception on TCP connection <0.6691.6783> from 
         WWW.XXX.YYY.ZZZ:64363  {timeout,blocking}  
      
Can anyone help?

Thanks,

Ian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/d3482850/attachment.htm>

From simon at rabbitmq.com  Wed Sep 19 13:08:31 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Sep 2012 13:08:31 +0100
Subject: [rabbitmq-discuss] Clustered nodes failure
In-Reply-To: <20be5e39-2566-4cdc-97eb-8972ddba8f2a@googlegroups.com>
References: <20be5e39-2566-4cdc-97eb-8972ddba8f2a@googlegroups.com>
Message-ID: <5059B5BF.3020704@rabbitmq.com>

Hi Ian.

We've fixed quite a lot of bugs in mirrored queues since 2.7.1. So I 
would have to suggest an upgrade to 2.8.6 first of all.

Cheers, Simon

On 19/09/12 12:45, Ian wrote:
> Hi all,
>
> I wonder if anyone can help diagnose problems we've been having with our
> 2-node clustered rabbit which sporadically seizes up completely. None of
> the applications can get through to Rabbit though it is still up and
> running. CPU and RAM spike up to 100%. The Management UI cannot be
> reached and we end up having to restart the nodes to get service back.
> Sometimes it does not come back gracefully requiring reboot.
>
> Some stats:
>
>     * Both nodes are 4 Core 8GB RAM CentOS 6.2 virtual machines, running
>       on VMWare ESXi 4.1 host. We are running RabbitMQ version 2.7.1 on
>       Erlang R14B04.
>     * Looking at our metrics right now I see around:
>           o 1000 queues
>           o 4000 channels
>           o 8000 bindings
>           o 16 exchanges
>     * Memory usage, erlang processes, file descriptors, socket
>       descriptors are generally low and healthy
>
> Analysing errors in the rabbit logs from a recent failure reveals:
>
>     * Before the failure we have a bunch of background errors which may
>       be the fault of our applications like "no binding X between
>       exchange Y in vhost '/' and queue Z in vhost '/'"
>     * As we ramp up to the failure we see
>           o Two errors like this:
>                 + ?** Generic server <0.16813.1677> terminating ** Last
>                   message in was {'$gen_cast',
>                   {run_backing_queue,rabbit_mirror_queue_master,
>                   #Fun<rabbit_mirror_queue_master.4.85178772>}} ** When
>                   Server state == {lim,0,undefined,false,[],0} ** Reason
>                   for termination == ** {function_clause,
>                   [{rabbit_limiter,handle_cast,
>                   [{run_backing_queue,rabbit_mirror_queue_master,
>                   #Fun<rabbit_mirror_queue_master.4.85178772>},
>                   {lim,0,undefined,false,[],0}]},
>                   {gen_server2,handle_msg,2},
>                   {proc_lib,init_p_do_apply,3}]} ?
>           o A handful like this:
>                 + ?connection <0.14270.7735>, channel 38 - error:
>                   {amqp_error,command_invalid,"second 'channel.open'
>                   seen",'channel.open'} ?
>           o A couple of these:
>                 + ?connection <0.158.6322>, channel 135 - error:
>                   {amqp_error,not_found, "no queue
>                   'InRunning.WebClient.SessionId[l0mpn3egx5n0yj0lbs1hcehj]'
>                   in vhost '/'", 'basic.get'} ?
>           o And then all these:
>                 + exception on TCP connection <0.14270.7735> from
>                   WWW.XXX.YYY.ZZZ:59106 {inet_error,enotconn}
>                 + exception on TCP connection <0.14577.1677> from
>                   WWW.XXX.YYY.ZZZ:53163 {inet_error,enotconn}
>                 + exception on TCP connection <0.1520.5487> from
>                   WWW.XXX.YYY.ZZZ:53435 {timeout,running}
>                 + exception on TCP connection <0.158.6322> from
>                   WWW.XXX.YYY.ZZZ:63187
>                   {writer,send_failed,{error,enotconn}}
>                 + exception on TCP connection <0.17097.1918> from
>                   WWW.XXX.YYY.ZZZ:55161
>                   {writer,send_failed,{error,enotconn}}
>                 + exception on TCP connection <0.18340.7733> from
>                   WWW.XXX.YYY.ZZZ:52868 {inet_error,enotconn}
>                 + exception on TCP connection <0.24514.6782> from
>                   WWW.XXX.YYY.ZZZ:64362 {timeout,blocking}
>                 + exception on TCP connection <0.24518.6782> from
>                   WWW.XXX.YYY.ZZZ:61252 {timeout,blocking}
>                 + exception on TCP connection <0.24524.6782> from
>                   WWW.XXX.YYY.ZZZ:55845 {timeout,blocking}
>                 + exception on TCP connection <0.24528.6782> from
>                   WWW.XXX.YYY.ZZZ:53434 {timeout,blocking}
>                 + exception on TCP connection <0.24532.6782> from
>                   WWW.XXX.YYY.ZZZ:54398 {timeout,blocking}
>                 + exception on TCP connection <0.24536.6782> from
>                   WWW.XXX.YYY.ZZZ:58878 {timeout,blocking}
>                 + exception on TCP connection <0.24552.6782> from
>                   WWW.XXX.YYY.ZZZ:63155 {timeout,blocking}
>                 + exception on TCP connection <0.2577.2793> from
>                   WWW.XXX.YYY.ZZZ:52752
>                   {writer,send_failed,{error,enotconn}}
>                 + exception on TCP connection <0.26105.2580> from
>                   WWW.XXX.YYY.ZZZ:50364
>                   {writer,send_failed,{error,enotconn}}
>                 + exception on TCP connection <0.27505.6740> from
>                   WWW.XXX.YYY.ZZZ:56170
>                   {writer,send_failed,{error,enotconn}}
>                 + exception on TCP connection <0.27741.2921> from
>                   WWW.XXX.YYY.ZZZ:54600
>                   {writer,send_failed,{error,enotconn}}
>                 + exception on TCP connection <0.28602.6323> from
>                   WWW.XXX.YYY.ZZZ:56863
>                   {writer,send_failed,{error,enotconn}}
>                 + exception on TCP connection <0.30059.3135> from
>                   WWW.XXX.YYY.ZZZ:57078 {writer,send_failed,{error,closed}}
>                 + exception on TCP connection <0.5634.2393> from
>                   WWW.XXX.YYY.ZZZ:53807
>                   {writer,send_failed,{error,enotconn}}
>                 + exception on TCP connection <0.6691.6783> from
>                   WWW.XXX.YYY.ZZZ:64363 {timeout,blocking}
>
> Can anyone help?
>
> Thanks,
>
> Ian
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Sep 19 13:16:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 19 Sep 2012 13:16:57 +0100
Subject: [rabbitmq-discuss] Introducing RabbitMQ-Web-STOMP plugin!
In-Reply-To: <242E9559AA2C354CB60C81A952FCBEB5014CC8@TSEAMB01>
References: <CABzX+qyf=pKtpRyZMcOjt72gDnuDJ9TBigX3qSrPqvwCOrRdyw@mail.gmail.com>	<CAE3HoVQNVThPvLigMTO0qO7w=Y2r4owa3av98iuf=9X52TNGvw@mail.gmail.com>	<4FB0F4C6.1050904@rabbitmq.com>	<1348044318144-22064.post@n5.nabble.com>,
	<50598F58.7050505@rabbitmq.com>
	<242E9559AA2C354CB60C81A952FCBEB5014CC8@TSEAMB01>
Message-ID: <5059B7B9.6060301@rabbitmq.com>

Not so much; STOMP is a different protocol to HTTP (although with a 
vaguely HTTP-like flavour). And this plugin is really targeted to 
browsers that support websockets, Javascript, etc (OK, it falls back 
when websockets aren't available, but ideally it wants them).

If you're looking for a pure HTTP interface to send and receive messages 
in RabbitMQ there's a simple one in the management plugin.

Cheers, Simon

On 19/09/12 11:09, McMahon, James S (TASC) wrote:
> For those unfamiliar with STOMP, could you give us an idea of what it
> would typically be used for? Does it give us a means to send and
> receive messages through rabbitMQ from a RESTful like web interface?
>
> Thanks in advance for your insights.
>
> - Jim ________________________________________ From:
> rabbitmq-discuss-bounces at lists.rabbitmq.com
> [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Simon
> MacMullen [simon at rabbitmq.com] Sent: Wednesday, September 19, 2012
> 5:24 AM To: Discussions about RabbitMQ Subject: Re:
> [rabbitmq-discuss] Introducing RabbitMQ-Web-STOMP plugin!
>
> On 19/09/12 09:45, emiliano.calori wrote:
>> Any news about when it will be included in the RabbitMQ release?
>
> The next "feature" release, i.e. not 2.8.x. Which *hopefully* should
> be in a month or so. Although we've been saying that for a while.
>
> Cheers, Simon
>
> -- Simon MacMullen RabbitMQ, VMware
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> CONFIDENTIALITY NOTICE: This message and any attachments or files
> transmitted with it (collectively, the "Message") are intended only
> for the addressee and may contain information that is privileged,
> proprietary and/or prohibited from disclosure by law or contract. If
> you are not the intended recipient: (a) please do not read, copy or
> retransmit the Message; (b) permanently delete and/or destroy all
> electronic and hard copies of the Message; (c) notify us by return
> email; and (d) you are hereby notified that any dissemination,
> distribution or copying of the Message is strictly prohibited.
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From michael.john.barry at gmail.com  Wed Sep 19 13:22:31 2012
From: michael.john.barry at gmail.com (Mike Barry)
Date: Wed, 19 Sep 2012 08:22:31 -0400
Subject: [rabbitmq-discuss] HA with C#. Ending server does not cause
	HandleBasicCancel
In-Reply-To: <50599564.8080405@rabbitmq.com>
References: <ddd18971-490b-4a95-81ca-cfe06f7684b8@googlegroups.com>
	<50599564.8080405@rabbitmq.com>
Message-ID: <CADEAqANT-3=XgZ3U9duW4+MGTF70iBUqsW8J0QNV6=bF1p9P6g@mail.gmail.com>

Emile,

Sorry, I should have included that code, but I have a very simple consumer
that derives from DefaultBasicConsumer. Are you suggesting I do it in a
different manner to verify behavior? I should have mentioned I am using
2.8.6 and running the client and server on the same machine.

Thanks,
Mike

internal class FabricNotificationQueueConsumer : DefaultBasicConsumer
    {
        private static readonly Lazy<ILog> logger =

        internal FabricNotificationQueueConsumer()
        {
        }

        public override void HandleBasicDeliver(
            string consumerTag,
            ulong deliveryTag,
            bool redelivered,
            string exchange,
            string routingKey,
            IBasicProperties properties,
            byte[] body)
        {
            logger.Info("Message!");
        }

        public override void OnCancel()
        {
                logger.Value.Warn("OnCancel!");
        }

        public override void HandleBasicCancelOk(string consumerTag)
        {
            logger.Value.Warn("HandleBasicCancelOk!");
        }

        public override void HandleBasicCancel(string consumerTag)
        {
            logger.Value.Warn("HandleBasicCancel!");
     }

On Wed, Sep 19, 2012 at 5:50 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Mike,
>
> On 18/09/12 19:37, Mike Barry wrote:
> > I would expect to get a HandleBasicCancel as
> > defined in the documentation, however I am only getting an OnCancel. Is
> > this expected?
>
> No, HandleBasicCancel should be called.
>
> > this.queueConsumer = new FabricNotificationQueueConsumer(this.region,
> > this.groupName, this.serializer,
>
> I'm not able to replicate this problem, which makes me wonder whether
> FabricNotificationQueueConsumer might be implicated somehow. Using
> DefaultBasicConsumer I can confirm that HandleBasicCancel is correctly
> called when the broker issues a basic.cancel. I suggest you try a
> simpler example using DefaultBasicConsumer to see if you still get this
> error.
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/881a3f33/attachment.htm>

From hadas100.b at gmail.com  Wed Sep 19 15:59:41 2012
From: hadas100.b at gmail.com (Hadas)
Date: Wed, 19 Sep 2012 17:59:41 +0300
Subject: [rabbitmq-discuss] binding exchange to client and server in wcf,
 but it auto generate new queue on rabbitmq server, why?
In-Reply-To: <5051B39D.1010102@rabbitmq.com>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
	<3a5f03340907291200j40f91712ne6fe28aa3ce5191f@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD8FA14BFAE8@EXMBX01.wealthcraft.local>
	<4A785F38.3000804@lshift.net>
	<loom.20120912T131333-428@post.gmane.org>
	<50507E6C.2050106@rabbitmq.com>
	<CAC_NAZk7OmJxpuYR3ZuZO7--aS2dryqLcpJ9K_hRVwgA+5wqAg@mail.gmail.com>
	<5051A666.4070908@rabbitmq.com>
	<CAC_NAZn9iN1AAwrygv9LcAq3o=G_uwSEggf4qecF+LtB_0zFKg@mail.gmail.com>
	<5051B39D.1010102@rabbitmq.com>
Message-ID: <CAC_NAZmhoye9qXbePsCsMx9aqHUbKnRPZDgOk8PUShX4hnCDsg@mail.gmail.com>

Thanks for all your help!

I see your answer to change the queue declaration in
RabbitMQInputChannel.cs.cs file .
I have changed this to the next row and it works fine:
      //Create a queue for messages destined to this service, bind it to
the service URI routing key
      string queue =
m_model.QueueDeclare(LocalAddress.Uri.AbsolutePath.TrimStart('/'),true,false,false,null);



2012/9/13 Emile Joubert <emile at rabbitmq.com>

> Hi,
>
> On 13/09/12 11:03, Hadas wrote:
> > I try the 'AnthonySteele-RabbitMQ-.Net-demos-259a724' sample. It works
> fine.
>
> Those examples do not make use of WCF. I had mistakenly assumed your
> problem was related to WCF. If you explain in more detail what you did,
> what results you expected and what results you received; then it might
> be possible to offer help.
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/75d55ab6/attachment.htm>

From samuel.net at gmail.com  Wed Sep 19 17:10:12 2012
From: samuel.net at gmail.com (Samuel Chen)
Date: Thu, 20 Sep 2012 00:10:12 +0800
Subject: [rabbitmq-discuss] Strange start error issue
Message-ID: <CAFnnZrhd9ctbcRSV_JskQg6tNZp5jy_yy7-BreKD+wDAKrQ+qQ@mail.gmail.com>

Hi all

I'm new to RabbitMQ. We are facing a strange issue against rabbit_mgmt_db.
I could not find any similar issues by searching on google or
stackoverflow. So I wonder if anyone could help to diagnose this problem.
Thanks in advance.

We have a 2-node clustered RabbitMQ integrated with Celery. It worked well
for several months.
The issue occurred the first time on Jul 4th. After restarted, it worked
for about 2 months. Yesterday the issue occurred twice (one is after
restarted).
The stat was that a child (rabbit_mgmt_db??) was killed automatically.  By
some failures of restarting automatically, it reached the max restart
intensity. Eventually it was shutdown.
(Anther situation is that we deployed to 2-node cluster from 1 node server
at the end of June. Note sure if it caused this issue.)

The hosts are virtual servers with 8/12G ram and 30G disk.
One node is disc node and the other is ram.
The load balance was very low (around 100M ram, few tasks) . Disk has 2.5G
free space.
Log as below.

Thanks for any help.

SUPERVISOR REPORT==== 18-Sep-2012::14:53:13 ===
>
>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>      Context:    child_terminated
>
>      Reason:     killed
>
>      Offender:   [{pid,<0.28804.1777>},
>
>                   {name,rabbit_mgmt_db},
>
>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                   {restart_type,permanent},
>
>                   {shutdown,4294967295},
>
>                   {child_type,worker}]
>
>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>      Context:    start_error
>
>      Reason:     {already_started,<19704.13906.2335>}
>
>      Offender:   [{pid,<0.28804.1777>},
>
>                   {name,rabbit_mgmt_db},
>
>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                   {restart_type,permanent},
>
>                   {shutdown,4294967295},
>
>                   {child_type,worker}]
>
>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>      Context:    start_error
>
>      Reason:     {already_started,<19704.13906.2335>}
>
>      Offender:   [{pid,<0.28804.1777>},
>
>                   {name,rabbit_mgmt_db},
>
>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                   {restart_type,permanent},
>
>                   {shutdown,4294967295},
>
>                   {child_type,worker}]
>
>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>      Context:    start_error
>
>      Reason:     {already_started,<19704.13906.2335>}
>
>      Offender:   [{pid,<0.28804.1777>},
>
>                   {name,rabbit_mgmt_db},
>
>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                   {restart_type,permanent},
>
>                   {shutdown,4294967295},
>
>                   {child_type,worker}]
>
>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>      Context:    start_error
>
>      Reason:     {already_started,<19704.13906.2335>}
>
>      Offender:   [{pid,<0.28804.1777>},
>
>                   {name,rabbit_mgmt_db},
>
>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                   {restart_type,permanent},
>
>                   {shutdown,4294967295},
>
>                   {child_type,worker}]
>
>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>      Context:    start_error
>
>      Reason:     {already_started,<19704.13906.2335>}
>
>      Offender:   [{pid,<0.28804.1777>},
>
>                   {name,rabbit_mgmt_db},
>
>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                   {restart_type,permanent},
>
>                   {shutdown,4294967295},
>
>                   {child_type,worker}]
>
>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>      Supervisor: {local,rabbit_mgmt_sup}
>
>      Context:    shutdown
>
>      Reason:     reached_max_restart_intensity
>
>      Offender:   [{pid,<0.28803.1777>},
>
>                   {name,mirroring},
>
>                   {mfa,
>
>                       {mirrored_supervisor,start_internal,
>
>                           [rabbit_mgmt_sup,
>
>                            [{rabbit_mgmt_db,
>
>                                 {rabbit_mgmt_db,start_link,[]},
>
>                                 permanent,4294967295,worker,
>
>                                 [rabbit_mgmt_db]}]]}},
>
>                   {restart_type,permanent},
>
>                   {shutdown,4294967295},
>
>                   {child_type,worker}]
>
>

- Sam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/e2b15b1c/attachment.htm>

From ian.cross at gmail.com  Wed Sep 19 19:47:36 2012
From: ian.cross at gmail.com (Ian Cross)
Date: Wed, 19 Sep 2012 19:47:36 +0100
Subject: [rabbitmq-discuss] Clustered nodes failure
In-Reply-To: <5059B5BF.3020704@rabbitmq.com>
References: <20be5e39-2566-4cdc-97eb-8972ddba8f2a@googlegroups.com>
	<5059B5BF.3020704@rabbitmq.com>
Message-ID: <CAGJqB46QPN5tP5JxAVuXwTXVtXG+vXsBahEqKi2DLLmMjER4Ew@mail.gmail.com>

Hi Simon,

Thanks for that - we'll upgrade this cluster to 2.8.6 as you suggest and
let you know how we get on.

Ian.

On Wed, Sep 19, 2012 at 1:08 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi Ian.
>
> We've fixed quite a lot of bugs in mirrored queues since 2.7.1. So I would
> have to suggest an upgrade to 2.8.6 first of all.
>
> Cheers, Simon
>
> On 19/09/12 12:45, Ian wrote:
>
>> Hi all,
>>
>> I wonder if anyone can help diagnose problems we've been having with our
>> 2-node clustered rabbit which sporadically seizes up completely. None of
>> the applications can get through to Rabbit though it is still up and
>> running. CPU and RAM spike up to 100%. The Management UI cannot be
>> reached and we end up having to restart the nodes to get service back.
>> Sometimes it does not come back gracefully requiring reboot.
>>
>> Some stats:
>>
>>     * Both nodes are 4 Core 8GB RAM CentOS 6.2 virtual machines, running
>>       on VMWare ESXi 4.1 host. We are running RabbitMQ version 2.7.1 on
>>       Erlang R14B04.
>>     * Looking at our metrics right now I see around:
>>           o 1000 queues
>>           o 4000 channels
>>           o 8000 bindings
>>           o 16 exchanges
>>     * Memory usage, erlang processes, file descriptors, socket
>>       descriptors are generally low and healthy
>>
>> Analysing errors in the rabbit logs from a recent failure reveals:
>>
>>     * Before the failure we have a bunch of background errors which may
>>       be the fault of our applications like "no binding X between
>>       exchange Y in vhost '/' and queue Z in vhost '/'"
>>     * As we ramp up to the failure we see
>>           o Two errors like this:
>>                 + ?** Generic server <0.16813.1677> terminating ** Last
>>                   message in was {'$gen_cast',
>>                   {run_backing_queue,rabbit_**mirror_queue_master,
>>                   #Fun<rabbit_mirror_queue_**master.4.85178772>}} ** When
>>                   Server state == {lim,0,undefined,false,[],0} ** Reason
>>                   for termination == ** {function_clause,
>>                   [{rabbit_limiter,handle_cast,
>>                   [{run_backing_queue,rabbit_**mirror_queue_master,
>>                   #Fun<rabbit_mirror_queue_**master.4.85178772>},
>>                   {lim,0,undefined,false,[],0}]}**,
>>                   {gen_server2,handle_msg,2},
>>                   {proc_lib,init_p_do_apply,3}]} ?
>>           o A handful like this:
>>                 + ?connection <0.14270.7735>, channel 38 - error:
>>                   {amqp_error,command_invalid,"**second 'channel.open'
>>                   seen",'channel.open'} ?
>>           o A couple of these:
>>                 + ?connection <0.158.6322>, channel 135 - error:
>>                   {amqp_error,not_found, "no queue
>>                   'InRunning.WebClient.**SessionId[**
>> l0mpn3egx5n0yj0lbs1hcehj]'
>>                   in vhost '/'", 'basic.get'} ?
>>           o And then all these:
>>                 + exception on TCP connection <0.14270.7735> from
>>                   WWW.XXX.YYY.ZZZ:59106 {inet_error,enotconn}
>>                 + exception on TCP connection <0.14577.1677> from
>>                   WWW.XXX.YYY.ZZZ:53163 {inet_error,enotconn}
>>                 + exception on TCP connection <0.1520.5487> from
>>                   WWW.XXX.YYY.ZZZ:53435 {timeout,running}
>>                 + exception on TCP connection <0.158.6322> from
>>                   WWW.XXX.YYY.ZZZ:63187
>>                   {writer,send_failed,{error,**enotconn}}
>>                 + exception on TCP connection <0.17097.1918> from
>>                   WWW.XXX.YYY.ZZZ:55161
>>                   {writer,send_failed,{error,**enotconn}}
>>                 + exception on TCP connection <0.18340.7733> from
>>                   WWW.XXX.YYY.ZZZ:52868 {inet_error,enotconn}
>>                 + exception on TCP connection <0.24514.6782> from
>>                   WWW.XXX.YYY.ZZZ:64362 {timeout,blocking}
>>                 + exception on TCP connection <0.24518.6782> from
>>                   WWW.XXX.YYY.ZZZ:61252 {timeout,blocking}
>>                 + exception on TCP connection <0.24524.6782> from
>>                   WWW.XXX.YYY.ZZZ:55845 {timeout,blocking}
>>                 + exception on TCP connection <0.24528.6782> from
>>                   WWW.XXX.YYY.ZZZ:53434 {timeout,blocking}
>>                 + exception on TCP connection <0.24532.6782> from
>>                   WWW.XXX.YYY.ZZZ:54398 {timeout,blocking}
>>                 + exception on TCP connection <0.24536.6782> from
>>                   WWW.XXX.YYY.ZZZ:58878 {timeout,blocking}
>>                 + exception on TCP connection <0.24552.6782> from
>>                   WWW.XXX.YYY.ZZZ:63155 {timeout,blocking}
>>                 + exception on TCP connection <0.2577.2793> from
>>                   WWW.XXX.YYY.ZZZ:52752
>>                   {writer,send_failed,{error,**enotconn}}
>>                 + exception on TCP connection <0.26105.2580> from
>>                   WWW.XXX.YYY.ZZZ:50364
>>                   {writer,send_failed,{error,**enotconn}}
>>                 + exception on TCP connection <0.27505.6740> from
>>                   WWW.XXX.YYY.ZZZ:56170
>>                   {writer,send_failed,{error,**enotconn}}
>>                 + exception on TCP connection <0.27741.2921> from
>>                   WWW.XXX.YYY.ZZZ:54600
>>                   {writer,send_failed,{error,**enotconn}}
>>                 + exception on TCP connection <0.28602.6323> from
>>                   WWW.XXX.YYY.ZZZ:56863
>>                   {writer,send_failed,{error,**enotconn}}
>>                 + exception on TCP connection <0.30059.3135> from
>>                   WWW.XXX.YYY.ZZZ:57078 {writer,send_failed,{error,**
>> closed}}
>>                 + exception on TCP connection <0.5634.2393> from
>>                   WWW.XXX.YYY.ZZZ:53807
>>                   {writer,send_failed,{error,**enotconn}}
>>                 + exception on TCP connection <0.6691.6783> from
>>                   WWW.XXX.YYY.ZZZ:64363 {timeout,blocking}
>>
>> Can anyone help?
>>
>> Thanks,
>>
>> Ian
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/cc135e8b/attachment.htm>

From mpietrek at skytap.com  Wed Sep 19 20:21:12 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 19 Sep 2012 12:21:12 -0700
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <B35E667D-AF62-4901-9556-38F7ABD9A49C@rabbitmq.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<5051BD53.3000401@rabbitmq.com>
	<B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>
	<CACLE7ixuiiz6MNuLXHYdLoSnu+p5Drp7++3wvo8umQFCn2=2KQ@mail.gmail.com>
	<49F9DCE2-2ED2-4791-94FC-1FB57D237A8C@rabbitmq.com>
	<CACLE7ixf0Jeq1hNSM8ojqaBGTC+4ELpaf2JfbaPtaQV0L0hiMA@mail.gmail.com>
	<DF417068-6E61-4473-97DE-3B618014B590@rabbitmq.com>
	<CACLE7iz-D4xkRy7JuP4F5g0NFtsTWW5htJ+fyuboVXTspKJA0Q@mail.gmail.com>
	<B35E667D-AF62-4901-9556-38F7ABD9A49C@rabbitmq.com>
Message-ID: <CACLE7ixEcFQNBtNmATs1GN4z7XXiNw==oVQJ9us0-7XxmYWmdA@mail.gmail.com>

Excellent. Thanks for the update. I really do appreciate it.

Just for my own curiosity, do you have any sort of local repro, or are you
still just trying to make sense of my logs?

Matt

On Wednesday, September 19, 2012, Tim Watson wrote:

> Hi Matt,
>
> Just to keep you up to date - we're still investigating this. I will reply
> here once we've got to the bottom of it.
>
> Cheers,
> Tim
>
> On 13 Sep 2012, at 21:05, Matt Pietrek wrote:
>
> Here you to Tim:
>
> The scrubbed rabbit at mq1.log:
> --------
> =INFO REPORT==== 13-Sep-2012::12:00:21 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
> =INFO REPORT==== 13-Sep-2012::12:00:21 ===
>     application: rabbitmq_federation
>     exited: stopped
>     type: permanent
>
> =INFO REPORT==== 13-Sep-2012::12:00:21 ===
> Stopping Rabbit
>
> =INFO REPORT==== 13-Sep-2012::12:00:21 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
> =WARNING REPORT==== 13-Sep-2012::12:00:21 ===
> Connection (<0.1659.0>) closing: internal error in channel (<0.1666.0>):
> shutdown
>
> =INFO REPORT==== 13-Sep-2012::12:00:21 ===
> stopped TCP Listener on 0.0.0.0:5672
>
> =ERROR REPORT==== 13-Sep-2012::12:17:00 ===
> ** Generic server <0.1676.0> terminating
> ** Last message in was {inet_async,#Port<0.5748>,5106,{error,etimedout}}
> ** When Server state == {state,#Port<0.5748>,<0.1671.0>,<0.1673.0>,
>                                {method,rabbit_framing_amqp_0_9_1},
>                                none}
> ** Reason for termination ==
> ** {socket_error,etimedout}
>
> =ERROR REPORT==== 13-Sep-2012::12:17:00 ===
> ** Generic server <0.1671.0> terminating
> ** Last message in was {socket_error,etimedout}
> ** When Server state == {state,amqp_network_connection,
>                             {state,#Port<0.5748>,0,<0.1675.0>,131072,
>                                 undefined,false},
>                             <0.1670.0>,<0.1673.0>,
>                             {amqp_params_network,<<"guest">>,<<"guest">>,
>                                 <<"/">>,"slg1matt1.xyz.com",
>                                 5672,0,0,0,infinity,none,
>                                 [#Fun<amqp_auth_mechanisms.plain.3>,
>                                  #Fun<amqp_auth_mechanisms.amqplain.3>],
>                                 [],[]},
>                             0,
>                             [{<<"capabilities">>,table,
>                               [{<<"publisher_confirms">>,bool,true},
>
> {<<"exchange_exchange_bindings">>,bool,true},
>                                {<<"basic.nack">>,bool,true},
>                                {<<"consumer_cancel_notify">>,bool,true}]},
>                              {<<"copyright">>,longstr,
>                               <<"Copyright (C) 2007-2012 VMware, Inc.">>},
>                              {<<"information">>,longstr,
>                               <<"Licensed under the MPL.  See
> http://www.rabbitmq.com/">>},
>                              {<<"platform">>,longstr,<<"Erlang/OTP">>},
>                              {<<"product">>,longstr,<<"RabbitMQ">>},
>                              {<<"version">>,longstr,<<"2.8.6">>}],
>                             #Fun<amqp_connection_sup.0.39273983>,
>                             #Fun<amqp_connection_sup.2.54430129>,false}
> ** Reason for termination ==
> ** {socket_error,etimedout}
>
> =ERROR REPORT==== 13-Sep-2012::12:17:00 ===
> ** Generic server <0.1657.0> terminating
> ** Last message in was {'EXIT',<0.197.0>,shutdown}
> ** When Server state == {state,
>                          {upstream,
>                           {amqp_params_network,<<"guest">>,<<"guest">>,
>                            <<"/">>,"slg1matt1.xyz.com",5672,0,
>                            0,0,infinity,none,
>                            [#Fun<amqp_auth_mechanisms.plain.3>,
>                             #Fun<amqp_auth_mechanisms.amqplain.3>],
>                            [],[]},
>
> <<"skytap">>,1000,1,1,none,none,none,"upstream-slg"},
>                          <0.1671.0>,<0.1683.0>,
>                          <<"federation: skytap ->
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/caff2425/attachment.htm>

From ward.mark at gmail.com  Wed Sep 19 22:02:10 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Wed, 19 Sep 2012 14:02:10 -0700 (PDT)
Subject: [rabbitmq-discuss] c# how to get ConfirmSelect errors
Message-ID: <8310a7bd-e688-4363-9c15-dec84723a5d5@googlegroups.com>

Hi,

I am not sure where or how to get an error generated from having 
ConfirmSelect() active on a model.  When I use BasicPublish I do not get an 
exception when sending but when I call WaitForConfirmsOrDie I do get an 
exception RabbitMQ.Client.Exceptions.AlreadyClosedException.  I assume that 
is because the BasicPublish + ConfirmSelect closed the model upon the error 
but I don't seem to be able to receive the event of the error before 
calling the WaitForConfirmsOrDie.

How would I setup my program to be notified of each message that failed 
when using ConfirmSelect?  I have tried CallbackException but I am not 
getting events on permission errors.

-Mark

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/e6acffcd/attachment.htm>

From tim at rabbitmq.com  Wed Sep 19 22:17:40 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 19 Sep 2012 22:17:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <CACLE7ixEcFQNBtNmATs1GN4z7XXiNw==oVQJ9us0-7XxmYWmdA@mail.gmail.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<5051BD53.3000401@rabbitmq.com>
	<B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>
	<CACLE7ixuiiz6MNuLXHYdLoSnu+p5Drp7++3wvo8umQFCn2=2KQ@mail.gmail.com>
	<49F9DCE2-2ED2-4791-94FC-1FB57D237A8C@rabbitmq.com>
	<CACLE7ixf0Jeq1hNSM8ojqaBGTC+4ELpaf2JfbaPtaQV0L0hiMA@mail.gmail.com>
	<DF417068-6E61-4473-97DE-3B618014B590@rabbitmq.com>
	<CACLE7iz-D4xkRy7JuP4F5g0NFtsTWW5htJ+fyuboVXTspKJA0Q@mail.gmail.com>
	<B35E667D-AF62-4901-9556-38F7ABD9A49C@rabbitmq.com>
	<CACLE7ixEcFQNBtNmATs1GN4z7XXiNw==oVQJ9us0-7XxmYWmdA@mail.gmail.com>
Message-ID: <9BD373B8-8A11-45CA-8CE4-A0AD7EC5F29C@rabbitmq.com>

Hi Matt

On 19 Sep 2012, at 20:21, Matt Pietrek wrote:

> Excellent. Thanks for the update. I really do appreciate it.
> 
> Just for my own curiosity, do you have any sort of local repro, or are you still just trying to make sense of my logs?
> 

Very much the latter at the moment. We've filed a bug to investigate and I'm going to apply some specific packet filtering during shutdown to see what kind of impact a lost FIN/SYN might make. I'm also going to be reviewing the supervision hierarchy in the erlang client (which federation uses) to see if there's and shutdown/timeout choices that aren't quite right.

From fourat at gmail.com  Thu Sep 20 00:36:32 2012
From: fourat at gmail.com (fourat)
Date: Wed, 19 Sep 2012 16:36:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Rejecting and requeuing a message to postpone it
Message-ID: <1348097791989-22078.post@n5.nabble.com>

Hi,

When consuming messages from a queue, it is necessary to reject some
messages because an action cannot take place for the moment (service down or
whatever ...), this can be done through basic.reject(requeue=True) but when
the queue is allmost empty (having the unique message i have already
rejected), the broker push that message hundreds of times per second to my
consumer which keeps rejecting/requeuing it, and that's would kill my
consumer.

Is there any possibility to not to have this behaviour, the ideal way is to
schedule the delivery in future time, but i didnt find any way to do it ...

How would you resolve such an issue ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rejecting-and-requeuing-a-message-to-postpone-it-tp22078.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alex.gadea at apptik.com  Thu Sep 20 03:23:07 2012
From: alex.gadea at apptik.com (Alex Gadea)
Date: Wed, 19 Sep 2012 19:23:07 -0700 (PDT)
Subject: [rabbitmq-discuss] How to handle distribution of message to either
	1 OR many topics
Message-ID: <2b27726b-cbe0-4df2-a704-84e6ccf9c939@googlegroups.com>

I have a message, and need it to be handled by a variable number of queues. 
 The queues handle different purposes - email, audit, webhook processing, 
s3 storage.  Each message can have any, some or all of those topics as 
targets.  For example, I could have three messages:

message 1: audit.webhook
message 2: webhook
message 3: email.audit.webhook.s3

Note that although I demonstrated 4 topics, there could potentially be 
100s.  Can this be handled by a topic exchange?  For example, would topic 
*.webhook.* miss message 2?   Could I add three topics to a queue 
webhook.*, *.webhook.* and *.webhook to handle all potential messages, or 
do I have to know the exact position of where webhook would wind up - ie: 
*.*.webhook.*.*.* or would *.webhook.* be sufficient to capture both 
message 1 and message 3?

Thanks, I'm new to Rabbitmq and just trying to figure out how flexible the 
messaging topics can be.

Alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/6a76ede4/attachment.htm>

From bhpchg at gmail.com  Thu Sep 20 03:55:49 2012
From: bhpchg at gmail.com (Chris)
Date: Wed, 19 Sep 2012 19:55:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Stopping RabbitMQ on Ubuntu
Message-ID: <0726f473-a332-44b0-a52d-96d5c4de7fdb@googlegroups.com>


I am new to RabbitMQ, and just installed a version on Ubuntu 10.04.

I was playing around with the command line tool `rabbitmqctl`, and found 
something strange.

When I issue: 'sudo -u root rabbitmqctl stop', all other RabbitMQ processes 
are shut down, except for one: /usr/lib/erlang/erts-5.7.4/bin/epmd -daemon, 
which is owned by user 'rabbitmq'.

What is this process? and does it mean that RabbitMQ is not completely shut 
down on my system? If that is the case, how should I stop RabbitMQ 
properly. Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120919/cce355b5/attachment.htm>

From jordannpotter at gmail.com  Thu Sep 20 08:40:34 2012
From: jordannpotter at gmail.com (Jordan)
Date: Thu, 20 Sep 2012 00:40:34 -0700 (PDT)
Subject: [rabbitmq-discuss] TTL on Messages
Message-ID: <d73ecd47-d9bd-4d01-89b9-0b40c542cffb@googlegroups.com>

Hey guys,

I'm currently using node-amqp <https://github.com/postwait/node-amqp>, and 
would like to set an expiration on my messages.

I recently learned about the 'x-message-ttl' flag, but I'm not quite sure 
how to properly use it.  In particular, if a message expires, do I have any 
way of knowing *which* message it was?  Perhaps a correlation id?

Thanks for the help!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/7955a0bf/attachment.htm>

From dada.chao.liu at gmail.com  Thu Sep 20 08:45:44 2012
From: dada.chao.liu at gmail.com (liubida)
Date: Thu, 20 Sep 2012 00:45:44 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq fake-death && no breath. key word in
 log : mirrored_supervisor rabbit_mgmt_db
Message-ID: <97f32760-fca4-4bd7-af53-b9029cde0c2e@googlegroups.com>

hi all,

dose anybody could point me just the direction for finding the reason for a 
fake-dead with the RabbitMQ. 
it seem the rabbitmq could not receive messages in some point, without any 
warning. 
i have constructed a cluster with 2 nodes, one disc and one ram. 
if i type the command "rabbitmqctl stop_app && rabbitmqctl start_app", the 
troubleshoot disappered.


here is the disc node's sasl.log

=SUPERVISOR REPORT==== 18-Sep-2012::14:53:13 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    child_terminated
     Reason:     killed
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    start_error
     Reason:     {already_started,<19704.13906.2335>}
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    start_error
     Reason:     {already_started,<19704.13906.2335>}
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    start_error
     Reason:     {already_started,<19704.13906.2335>}
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    start_error
     Reason:     {already_started,<19704.13906.2335>}
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    start_error
     Reason:     {already_started,<19704.13906.2335>}
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    start_error
     Reason:     {already_started,<19704.13906.2335>}
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    start_error
     Reason:     {already_started,<19704.13906.2335>}
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    start_error
     Reason:     {already_started,<19704.13906.2335>}
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    start_error
     Reason:     {already_started,<19704.13906.2335>}
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    start_error
     Reason:     {already_started,<19704.13906.2335>}
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {<0.28802.1777>,mirrored_supervisor}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.28804.1777>},
                  {name,rabbit_mgmt_db},
                  {mfa,{rabbit_mgmt_db,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    child_terminated
     Reason:     shutdown
     Offender:   [{pid,<0.28803.1777>},
                  {name,mirroring},
                  {mfa,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.28803.1777>},
                  {name,mirroring},
                  {mfa,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


the ram node's sasl.log
=SUPERVISOR REPORT==== 18-Sep-2012::17:24:50 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    child_terminated
     Reason:     shutdown
     Offender:   [{pid,<0.14161.2335>},
                  {name,mirroring},
                  {mfa,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 18-Sep-2012::17:24:50 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.14161.2335>},
                  {name,mirroring},
                  {mfa,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]

Thanks for any help.
 

--bidaliu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/a9892d40/attachment.htm>

From samuel.net at gmail.com  Thu Sep 20 10:19:27 2012
From: samuel.net at gmail.com (Samuel Chen)
Date: Thu, 20 Sep 2012 17:19:27 +0800
Subject: [rabbitmq-discuss] Strange start error issue
In-Reply-To: <CAFnnZrhd9ctbcRSV_JskQg6tNZp5jy_yy7-BreKD+wDAKrQ+qQ@mail.gmail.com>
References: <CAFnnZrhd9ctbcRSV_JskQg6tNZp5jy_yy7-BreKD+wDAKrQ+qQ@mail.gmail.com>
Message-ID: <CAFnnZrhJGxsPc0iwGk8mpkrBFtge7LBv8Rw-Jepo5jaXh8=9hw@mail.gmail.com>

I would update some info about the issue:

When the issue occurs, the status of rabbitMQ cluster is still running. But
the message from Celery will not be processed until we restart rabbit.
At the same time, the web admin UI shutdown. So I was doubting if the
management plugin caused this issue.

Anybody could help?
thanks.

On Thu, Sep 20, 2012 at 12:10 AM, Samuel Chen <samuel.net at gmail.com> wrote:

> Hi all
>
> I'm new to RabbitMQ. We are facing a strange issue against rabbit_mgmt_db.
> I could not find any similar issues by searching on google or
> stackoverflow. So I wonder if anyone could help to diagnose this problem.
> Thanks in advance.
>
> We have a 2-node clustered RabbitMQ integrated with Celery. It worked well
> for several months.
> The issue occurred the first time on Jul 4th. After restarted, it worked
> for about 2 months. Yesterday the issue occurred twice (one is after
> restarted).
> The stat was that a child (rabbit_mgmt_db??) was killed automatically.  By
> some failures of restarting automatically, it reached the max restart
> intensity. Eventually it was shutdown.
> (Anther situation is that we deployed to 2-node cluster from 1 node server
> at the end of June. Note sure if it caused this issue.)
>
> The hosts are virtual servers with 8/12G ram and 30G disk.
> One node is disc node and the other is ram.
> The load balance was very low (around 100M ram, few tasks) . Disk has 2.5G
> free space.
> Log as below.
>
> Thanks for any help.
>
> SUPERVISOR REPORT==== 18-Sep-2012::14:53:13 ===
>>
>>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>>
>>      Context:    child_terminated
>>
>>      Reason:     killed
>>
>>      Offender:   [{pid,<0.28804.1777>},
>>
>>                   {name,rabbit_mgmt_db},
>>
>>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>>
>>                   {restart_type,permanent},
>>
>>                   {shutdown,4294967295},
>>
>>                   {child_type,worker}]
>>
>>
>>>
>>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>>
>>      Context:    start_error
>>
>>      Reason:     {already_started,<19704.13906.2335>}
>>
>>      Offender:   [{pid,<0.28804.1777>},
>>
>>                   {name,rabbit_mgmt_db},
>>
>>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>>
>>                   {restart_type,permanent},
>>
>>                   {shutdown,4294967295},
>>
>>                   {child_type,worker}]
>>
>>
>>>
>>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>>
>>      Context:    start_error
>>
>>      Reason:     {already_started,<19704.13906.2335>}
>>
>>      Offender:   [{pid,<0.28804.1777>},
>>
>>                   {name,rabbit_mgmt_db},
>>
>>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>>
>>                   {restart_type,permanent},
>>
>>                   {shutdown,4294967295},
>>
>>                   {child_type,worker}]
>>
>>
>>>
>>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>>
>>      Context:    start_error
>>
>>      Reason:     {already_started,<19704.13906.2335>}
>>
>>      Offender:   [{pid,<0.28804.1777>},
>>
>>                   {name,rabbit_mgmt_db},
>>
>>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>>
>>                   {restart_type,permanent},
>>
>>                   {shutdown,4294967295},
>>
>>                   {child_type,worker}]
>>
>>
>>>
>>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>>
>>      Context:    start_error
>>
>>      Reason:     {already_started,<19704.13906.2335>}
>>
>>      Offender:   [{pid,<0.28804.1777>},
>>
>>                   {name,rabbit_mgmt_db},
>>
>>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>>
>>                   {restart_type,permanent},
>>
>>                   {shutdown,4294967295},
>>
>>                   {child_type,worker}]
>>
>>
>>>
>>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>      Supervisor: {<0.28802.1777>,mirrored_supervisor}
>>
>>      Context:    start_error
>>
>>      Reason:     {already_started,<19704.13906.2335>}
>>
>>      Offender:   [{pid,<0.28804.1777>},
>>
>>                   {name,rabbit_mgmt_db},
>>
>>                   {mfa,{rabbit_mgmt_db,start_link,[]}},
>>
>>                   {restart_type,permanent},
>>
>>                   {shutdown,4294967295},
>>
>>                   {child_type,worker}]
>>
>>
>>>
>>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>      Supervisor: {local,rabbit_mgmt_sup}
>>
>>      Context:    shutdown
>>
>>      Reason:     reached_max_restart_intensity
>>
>>      Offender:   [{pid,<0.28803.1777>},
>>
>>                   {name,mirroring},
>>
>>                   {mfa,
>>
>>                       {mirrored_supervisor,start_internal,
>>
>>                           [rabbit_mgmt_sup,
>>
>>                            [{rabbit_mgmt_db,
>>
>>                                 {rabbit_mgmt_db,start_link,[]},
>>
>>                                 permanent,4294967295,worker,
>>
>>                                 [rabbit_mgmt_db]}]]}},
>>
>>                   {restart_type,permanent},
>>
>>                   {shutdown,4294967295},
>>
>>                   {child_type,worker}]
>>
>>
>
> - Sam
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/0cb0da2a/attachment.htm>

From francesco at rabbitmq.com  Thu Sep 20 10:19:32 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Thu, 20 Sep 2012 10:19:32 +0100
Subject: [rabbitmq-discuss] TTL on Messages
In-Reply-To: <d73ecd47-d9bd-4d01-89b9-0b40c542cffb@googlegroups.com>
References: <d73ecd47-d9bd-4d01-89b9-0b40c542cffb@googlegroups.com>
Message-ID: <871uhxxd97.wl%francesco@rabbitmq.com>

At Thu, 20 Sep 2012 00:40:34 -0700 (PDT),
Jordan wrote:
> I recently learned about the 'x-message-ttl' flag, but I'm not quite sure how
> to properly use it.  In particular, if a message expires, do I have any way of
> knowing *which* message it was?  Perhaps a correlation id?

You can use a DLX to redirect expired messages to some exchange:
<http://www.rabbitmq.com/dlx.html>.

--
Francesco * Often in error, never in doubt

From simon at rabbitmq.com  Thu Sep 20 10:36:59 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Sep 2012 10:36:59 +0100
Subject: [rabbitmq-discuss] Stopping RabbitMQ on Ubuntu
In-Reply-To: <0726f473-a332-44b0-a52d-96d5c4de7fdb@googlegroups.com>
References: <0726f473-a332-44b0-a52d-96d5c4de7fdb@googlegroups.com>
Message-ID: <505AE3BB.30107@rabbitmq.com>

Hi Chris. That's the Erlang Port Mapper Daemon. It's a feature of the 
Erlang runtime that helps Erlang nodes to find each other.

It's a pretty tiny thing and doesn't contain much state (other than 
"what Erlang nodes are running on this system?") so it's not a huge deal 
for it to still be running.

Although it's running as user rabbitmq, it was started automatically by 
the Erlang VM when we started. We've considered adding "epmd -kill" to 
our shutdown script - but that would break any other Erlang apps running 
on the system; it's more "global" than RabbitMQ.

I hope this makes sense.

Cheers, Simon

On 20/09/12 03:55, Chris wrote:
>
> I am new to RabbitMQ, and just installed a version on Ubuntu 10.04.
>
> I was playing around with the command line tool `rabbitmqctl`, and found
> something strange.
>
> When I issue: 'sudo -u root rabbitmqctl stop', all other RabbitMQ
> processes are shut down, except for one:
> /usr/lib/erlang/erts-5.7.4/bin/epmd -daemon, which is owned by user
> 'rabbitmq'.
>
> What is this process? and does it mean that RabbitMQ is not completely
> shut down on my system? If that is the case, how should I stop RabbitMQ
> properly. Thanks!
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From 0x6e6562 at gmail.com  Thu Sep 20 10:44:17 2012
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 20 Sep 2012 10:44:17 +0100
Subject: [rabbitmq-discuss] binding_not_found
Message-ID: <CAB-G1jhYN75tv=Nxq1TgZN64ywhEbep3F-x29zHf-d=enMa3xA@mail.gmail.com>

Hi,

This is probably quite a stupid question, but I was wondering under
what conditions a binding_not_found exception can occur in a 2.8.6
broker.

A very cursory glance at the source indicates that if I try to bind a
durable queue to a durable exchange, and if in addition to this, a
binding already exists in the database, then the call to add a binding
will return a binding_not_found:

case (not (SrcDurable andalso DstDurable) orelse
          mnesia:read({rabbit_durable_route, B}) =:= []) of
        true  -> ...
        false -> rabbit_misc:const({error, binding_not_found})
end.

Do I see this correctly?

Cheers,

Ben

From 0x6e6562 at gmail.com  Thu Sep 20 10:57:06 2012
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 20 Sep 2012 10:57:06 +0100
Subject: [rabbitmq-discuss] binding_not_found
In-Reply-To: <CAB-G1jhYN75tv=Nxq1TgZN64ywhEbep3F-x29zHf-d=enMa3xA@mail.gmail.com>
References: <CAB-G1jhYN75tv=Nxq1TgZN64ywhEbep3F-x29zHf-d=enMa3xA@mail.gmail.com>
Message-ID: <CAB-G1ji4KPxrfCrhW+pzV_FEMhY0YzKYjw3j-=ytLn4NYeyy9g@mail.gmail.com>

On Thu, Sep 20, 2012 at 10:44 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
> This is probably quite a stupid question, but I was wondering under
> what conditions a binding_not_found exception can occur in a 2.8.6
> broker.

On second glance I've found a second instance of binding_not_found
that can occur when removing a binding, so I'll investigate whether
this is the source of the error.

Cheers,

Ben

From simon at rabbitmq.com  Thu Sep 20 11:02:27 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Sep 2012 11:02:27 +0100
Subject: [rabbitmq-discuss] binding_not_found
In-Reply-To: <CAB-G1jhYN75tv=Nxq1TgZN64ywhEbep3F-x29zHf-d=enMa3xA@mail.gmail.com>
References: <CAB-G1jhYN75tv=Nxq1TgZN64ywhEbep3F-x29zHf-d=enMa3xA@mail.gmail.com>
Message-ID: <505AE9B3.4040408@rabbitmq.com>

On 20/09/12 10:44, Ben Hood wrote:
> Hi,

Hi.

> This is probably quite a stupid question, but I was wondering under
> what conditions a binding_not_found exception can occur in a 2.8.6
> broker.

I assume you mean "...in response to queue.bind". There is - of course - 
a completely obvious case in response to queue.unbind.

> A very cursory glance at the source indicates that if I try to bind a
> durable queue to a durable exchange, and if in addition to this, a
> binding already exists in the database, then the call to add a binding
> will return a binding_not_found:
>
> case (not (SrcDurable andalso DstDurable) orelse
>            mnesia:read({rabbit_durable_route, B}) =:= []) of
>          true  ->  ...
>          false ->  rabbit_misc:const({error, binding_not_found})
> end.
>
> Do I see this correctly?

Not quite. The extra information is that in order to get there, we have 
to have gone past a point in add/2 where we already know that there is 
no binding in the rabbit_route table. So we only return 
binding_not_found if the binding is in rabbit_durable_route but not 
rabbit_route (and the binding is between two durable things and thus 
should be durable).

The idea is that rabbit_{route,queue} contains all effective 
bindings/queues, and rabbit_durable_{route,queue} contains all durable 
bindings/queues. It's obvious how something can be effective but not 
durable, but how can it be durable but not effective?

The answer is: when it points to a durable queue in a cluster which is 
located on a node which is down (or mirrored across a set of nodes all 
of which are down). In this circumstance (only) we will return NOT_FOUND 
to queue.declare and queue.bind operations.

And yes, there is already a bug open to make this clearer.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Sep 20 11:12:35 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 20 Sep 2012 11:12:35 +0100
Subject: [rabbitmq-discuss] Rejecting and requeuing a message to
 postpone it
In-Reply-To: <1348097791989-22078.post@n5.nabble.com>
References: <1348097791989-22078.post@n5.nabble.com>
Message-ID: <505AEC13.8080405@rabbitmq.com>

Hi,

On 20/09/12 00:36, fourat wrote:
> How would you resolve such an issue ?

You can simulate delayed publishing by publishing to a queue with the
required per-message TTL as well as a dead-letter-exchange (DLX)
configured. When the TTL expires it will be published to the DLX, so the
nett  effect is delayed publishing.
http://www.rabbitmq.com/ttl.html#per-queue-message-ttl
http://www.rabbitmq.com/dlx.html

You might also consider delaying the requeue operation on the client
until the prerequisite service is available.

You could also craft a solution by taking the "redelivered" parameter
into account. This boolean flag indicates whether a message has been
previously delivered. Attempting to requeue a message that has already
been redelivered might signal the onset of a loop and this might be a
good place to introduce a delay or additional logic to prevent the loop.
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.deliver.redelivered


Emile

From emile at rabbitmq.com  Thu Sep 20 11:24:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 20 Sep 2012 11:24:52 +0100
Subject: [rabbitmq-discuss] HA with C#. Ending server does not cause
	HandleBasicCancel
In-Reply-To: <CADEAqANT-3=XgZ3U9duW4+MGTF70iBUqsW8J0QNV6=bF1p9P6g@mail.gmail.com>
References: <ddd18971-490b-4a95-81ca-cfe06f7684b8@googlegroups.com>
	<50599564.8080405@rabbitmq.com>
	<CADEAqANT-3=XgZ3U9duW4+MGTF70iBUqsW8J0QNV6=bF1p9P6g@mail.gmail.com>
Message-ID: <505AEEF4.9030802@rabbitmq.com>

Hi Mike,

On 19/09/12 13:22, Mike Barry wrote:
> Sorry, I should have included that code, but I have a very simple
> consumer that derives from DefaultBasicConsumer. Are you suggesting I do
> it in a different manner to verify behavior? I should have mentioned I
> am using 2.8.6 and running the client and server on the same machine. 

I don't think this issue is very sensitive to minor version differences
as these features as well-established.

I would suggest trying to replicate the problem using
DefaultBasicConsumer. Also make sure the expected callback is not racing
with the termination of your program - add a sleep before exiting if
necessary.


-Emile

From emile at rabbitmq.com  Thu Sep 20 11:38:07 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 20 Sep 2012 11:38:07 +0100
Subject: [rabbitmq-discuss] c# how to get ConfirmSelect errors
In-Reply-To: <8310a7bd-e688-4363-9c15-dec84723a5d5@googlegroups.com>
References: <8310a7bd-e688-4363-9c15-dec84723a5d5@googlegroups.com>
Message-ID: <505AF20F.2090700@rabbitmq.com>

Hi Mark,

On 19/09/12 22:02, Mark Ward wrote:
> How would I setup my program to be notified of each message that failed
> when using ConfirmSelect?  I have tried CallbackException but I am not
> getting events on permission errors.

The publisher needs to remember all messages that are published, and it
can forget about those that are confirmed. Messages that are yet to be
forgotten about at the time of the crash will need to be redelivered as
they might have been lost.

-Emile





From emile at rabbitmq.com  Thu Sep 20 11:52:49 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 20 Sep 2012 11:52:49 +0100
Subject: [rabbitmq-discuss] How to handle distribution of message to
 either 1 OR many topics
In-Reply-To: <2b27726b-cbe0-4df2-a704-84e6ccf9c939@googlegroups.com>
References: <2b27726b-cbe0-4df2-a704-84e6ccf9c939@googlegroups.com>
Message-ID: <505AF581.3000207@rabbitmq.com>

Hi Alex,

On 20/09/12 03:23, Alex Gadea wrote:
> message 1: audit.webhook
> message 2: webhook
> message 3: email.audit.webhook.s3

You should take a look at section 3.1.3.3 (The Topic Exchange Type) in
the AMQP 0-9-1 specification which explains this:
http://www.rabbitmq.com/protocol.html

The 5th tutorial also has some useful information:
http://www.rabbitmq.com/tutorials/tutorial-five-python.html

#.webhook.# should capture all 3 messages.

If the publisher known exactly where a message should be routed then you
might want to consider Sender-selected distribution. However if you have
100s of destination queues then this is probably not relevant:
http://www.rabbitmq.com/sender-selected.html


-Emile


From gmr at meetme.com  Thu Sep 20 12:28:18 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Thu, 20 Sep 2012 06:28:18 -0500
Subject: [rabbitmq-discuss] Exchange to exchange bindings in python
	(pika)
In-Reply-To: <50472FD6.4030605@rabbitmq.com>
References: <CAAqmy6M+J6dwUsdCmuXMbPs63k51MDP=k2BfWEVKR=YU5LXFAA@mail.gmail.com>
	<D9E68005B2F84C8AA41BB29546F31959@meetme.com>
	<CAAqmy6MiYE13m=ptkgtmvMN3e8ctMmD5ARVNi0X0oQ_3iGBxTw@mail.gmail.com>
	<50472FD6.4030605@rabbitmq.com>
Message-ID: <CAKwdTWdoJ4r-XSDF21_NGGzAuzz=3KWP4y_AwD4BR1DF46Fmag@mail.gmail.com>

The method exchange_bind is not defined on the channel, I will add to the
0.9.6 tree. Exchange.Bind can be accessed with the following code (tested
with pypi installed 0.9.5):

import pika
from pika.spec import Exchange

connection =
pika.BlockingConnection(pika.ConnectionParameters(host='127.0.0.1'))
channel = connection.channel()

def exchange_bound(frame):
  print 'Exchange Bound'

channel.transport.rpc(spec.Exchange.Bind(source='topicEx',
destination='anotherEx', routing_key='#'), exchange_bound,
[Exchange.BindOk])

On Wed, Sep 5, 2012 at 5:56 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Dave,
>
> apologies for the late response...
>
>
> On 23/08/12 04:24, Dave Curylo wrote:
>
>> I get this error attempting to call channel.exchange_bind:
>>
>> 'BlockingChannel' object has no attribute 'exchange_bind'
>>
>> This is my source:
>>
>> import pika
>> connection =
>> pika.BlockingConnection(pika.**ConnectionParameters(host='10.**0.1.100'))
>> channel = connection.channel()
>> channel.exchange_bind(source='**topicEx', destination='anotherEx',
>> routing_key='#')
>>
>> I'm running pika version 0.9.5.
>>  >>> pika.__version__
>> '0.9.5'
>>
>> What am I missing that keeps me from being able to do exchange to
>> exchange bindings?
>>
>
> There's no mention of exchange_bind in the pika docs, though if Gavin says
> that it's supported then presumably it is. And looking at the code on
> github, that does indeed appear to be the case, though I am no python
> expert.
>
> You may want to ask on the pika google group - https://groups.google.com/*
> *forum/#!forum/pika-python<https://groups.google.com/forum/#!forum/pika-python>- or file a bug on github.
>
> Regards,
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/ef060138/attachment.htm>

From gmr at meetme.com  Thu Sep 20 12:29:51 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Thu, 20 Sep 2012 06:29:51 -0500
Subject: [rabbitmq-discuss] Exchange to exchange bindings in python
	(pika)
In-Reply-To: <CAKwdTWdoJ4r-XSDF21_NGGzAuzz=3KWP4y_AwD4BR1DF46Fmag@mail.gmail.com>
References: <CAAqmy6M+J6dwUsdCmuXMbPs63k51MDP=k2BfWEVKR=YU5LXFAA@mail.gmail.com>
	<D9E68005B2F84C8AA41BB29546F31959@meetme.com>
	<CAAqmy6MiYE13m=ptkgtmvMN3e8ctMmD5ARVNi0X0oQ_3iGBxTw@mail.gmail.com>
	<50472FD6.4030605@rabbitmq.com>
	<CAKwdTWdoJ4r-XSDF21_NGGzAuzz=3KWP4y_AwD4BR1DF46Fmag@mail.gmail.com>
Message-ID: <CAKwdTWe-F_R=VfBmDzC6NuMJtEq5a8i7OyXfFQTEekvLorL6Tg@mail.gmail.com>

And I see a bug from my test code and what I pasted... The
channel.transport.rpc line should be:

channel.transport.rpc(Exchange.Bind(source='topicEx',
destination='anotherEx', routing_key='#'), exchange_bound,
[Exchange.BindOk])

On Thu, Sep 20, 2012 at 6:28 AM, Gavin M. Roy <gmr at meetme.com> wrote:

> The method exchange_bind is not defined on the channel, I will add to the
> 0.9.6 tree. Exchange.Bind can be accessed with the following code (tested
> with pypi installed 0.9.5):
>
> import pika
> from pika.spec import Exchange
>
> connection =
> pika.BlockingConnection(pika.ConnectionParameters(host='127.0.0.1'))
> channel = connection.channel()
>
> def exchange_bound(frame):
>   print 'Exchange Bound'
>
> channel.transport.rpc(spec.Exchange.Bind(source='topicEx',
> destination='anotherEx', routing_key='#'), exchange_bound,
> [Exchange.BindOk])
>
> On Wed, Sep 5, 2012 at 5:56 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:
>
>> Dave,
>>
>> apologies for the late response...
>>
>>
>> On 23/08/12 04:24, Dave Curylo wrote:
>>
>>> I get this error attempting to call channel.exchange_bind:
>>>
>>> 'BlockingChannel' object has no attribute 'exchange_bind'
>>>
>>> This is my source:
>>>
>>> import pika
>>> connection =
>>> pika.BlockingConnection(pika.**ConnectionParameters(host='10.**
>>> 0.1.100'))
>>> channel = connection.channel()
>>> channel.exchange_bind(source='**topicEx', destination='anotherEx',
>>> routing_key='#')
>>>
>>> I'm running pika version 0.9.5.
>>>  >>> pika.__version__
>>> '0.9.5'
>>>
>>> What am I missing that keeps me from being able to do exchange to
>>> exchange bindings?
>>>
>>
>> There's no mention of exchange_bind in the pika docs, though if Gavin
>> says that it's supported then presumably it is. And looking at the code on
>> github, that does indeed appear to be the case, though I am no python
>> expert.
>>
>> You may want to ask on the pika google group - https://groups.google.com/
>> **forum/#!forum/pika-python<https://groups.google.com/forum/#!forum/pika-python>- or file a bug on github.
>>
>> Regards,
>>
>> Matthias.
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
>
> --
>
> Gavin M. Roy
> Chief Technology Officer
>
>  <http://www.meetme.com/>
> 100 Union Square Drive
> New Hope, PA 18938
> p. +1.215.862.1162 x263
> f. +1.215.862.0465
>
> <https://www.facebook.com/pages/MeetMe/21931227129>   <https://twitter.com/meetme>
>     <http://www.youtube.com/user/MeetMeVideos>
>
> The public market leader in social discovery. (NYSE MKT: MEET)
>
>


-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/242efce1/attachment.htm>

From stephen.t.young at gmail.com  Thu Sep 20 14:29:12 2012
From: stephen.t.young at gmail.com (Stephen Young)
Date: Thu, 20 Sep 2012 06:29:12 -0700 (PDT)
Subject: [rabbitmq-discuss] TTL on Messages
In-Reply-To: <d73ecd47-d9bd-4d01-89b9-0b40c542cffb@googlegroups.com>
References: <d73ecd47-d9bd-4d01-89b9-0b40c542cffb@googlegroups.com>
Message-ID: <40aedefc-8b23-40f9-90df-2270b4f686bd@googlegroups.com>

TTL is set on a queue basis, so publishing to queue *ttl_queue_1s* that has 
been initialized {x-message-ttl: 1000} the message will be dropped by 
rabbitmq after one second. Messages themselves cannot set their own TTL, as 
far as I'm aware.
The best approach I've found to tracking what gets dropped is using dead 
letter exchanges (http://www.rabbitmq.com/dlx.html) - so you'd configure 
your TTL queue with {x-dead-letter-exchange: other_exchange} and then route 
the requests through there and track on the client side what has been 
dropped.

On Thursday, September 20, 2012 3:40:34 AM UTC-4, Jordan wrote:
>
> Hey guys,
>
> I'm currently using node-amqp <https://github.com/postwait/node-amqp>, 
> and would like to set an expiration on my messages.
>
> I recently learned about the 'x-message-ttl' flag, but I'm not quite sure 
> how to properly use it.  In particular, if a message expires, do I have any 
> way of knowing *which* message it was?  Perhaps a correlation id?
>
> Thanks for the help!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/83193eb3/attachment.htm>

From emile at rabbitmq.com  Thu Sep 20 14:42:40 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 20 Sep 2012 14:42:40 +0100
Subject: [rabbitmq-discuss] How to handle distribution of message to
 either 1 OR many topics
In-Reply-To: <BLU002-W4640A835B706296963AD1FFA9A0@phx.gbl>
References: <2b27726b-cbe0-4df2-a704-84e6ccf9c939@googlegroups.com>,
	<505AF581.3000207@rabbitmq.com>
	<BLU002-W4640A835B706296963AD1FFA9A0@phx.gbl>
Message-ID: <505B1D50.5010902@rabbitmq.com>

Hi Alex,

On 20/09/12 13:58, Alex Gadea wrote:
> Is there anything to gain by this performance wise?  Are
> exchanges lighter than queues in terms of routing (I'd wind up having
> the same number of final destination queues).

Bear in mind that queues don't perform routing, only exchanges route
messages.

I'd be surprised if intermediate topic exchanges are significantly
faster than a single topic exchange, but the best way to confirm is to
test this with your own topics and workload and make the comparison.

A different possible motivation for intermediate exchanges is that it
might make administration more manageable.


-Emile





From ward.mark at gmail.com  Thu Sep 20 14:45:56 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 20 Sep 2012 06:45:56 -0700 (PDT)
Subject: [rabbitmq-discuss] c# how to get ConfirmSelect errors
In-Reply-To: <8310a7bd-e688-4363-9c15-dec84723a5d5@googlegroups.com>
References: <8310a7bd-e688-4363-9c15-dec84723a5d5@googlegroups.com>
Message-ID: <0163c372-1f8a-4979-a265-3409da22980d@googlegroups.com>

Hi Emile,

Thanks for the response.  I had come across the post 
http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/ and 
after looking at it again I noticed the example contained 
"setconfirmListener" which has now been renamed to "addConfirmListener". 
 It appears the .NET version of the rabbitMQ client does not have this 
method or ability.  It would appear this is what I am looking for but I 
have not found it in the .NET version.  Is this a lacking feature in the 
.NET version or am I not looking in the right place?

I have the ability to identify the batch of message the fault occurred in 
but I am seeking if I can identify specifically the messages in the batch. 
 I am still working through the idea if it will work if the system knows 
that a message did fail but does not know which ones.  Then working through 
if the system will work with the possibility of 1 or more publications of 
the same messages will not negatively impact the implementation.  I may 
have to implement tracking unique message ids to prevent duplicate message 
processing.

-Mark



Hi Mark, 

On 19/09/12 22:02, Mark Ward wrote: 
> How would I setup my program to be notified of each message that failed 
> when using ConfirmSelect?  I have tried CallbackException but I am not 
> getting events on permission errors. 

The publisher needs to remember all messages that are published, and it 
can forget about those that are confirmed. Messages that are yet to be 
forgotten about at the time of the crash will need to be redelivered as 
they might have been lost. 

-Emile  

On Wednesday, September 19, 2012 4:02:10 PM UTC-5, Mark Ward wrote:
>
> Hi,
>
> I am not sure where or how to get an error generated from having 
> ConfirmSelect() active on a model.  When I use BasicPublish I do not get an 
> exception when sending but when I call WaitForConfirmsOrDie I do get an 
> exception RabbitMQ.Client.Exceptions.AlreadyClosedException.  I assume that 
> is because the BasicPublish + ConfirmSelect closed the model upon the error 
> but I don't seem to be able to receive the event of the error before 
> calling the WaitForConfirmsOrDie.
>
> How would I setup my program to be notified of each message that failed 
> when using ConfirmSelect?  I have tried CallbackException but I am not 
> getting events on permission errors.
>
> -Mark
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/d2fd38d2/attachment.htm>

From clarsen at euphoriaaudio.com  Thu Sep 20 15:34:39 2012
From: clarsen at euphoriaaudio.com (Chris Larsen)
Date: Thu, 20 Sep 2012 10:34:39 -0400
Subject: [rabbitmq-discuss] Crash on badmatch
Message-ID: <00a101cd973d$112fffd0$338fff70$@euphoriaaudio.com>

Hi folks, we had a problem today where the MQ server kept crashing and we
think it was due to some client pushing in a bad message as we were able to
keep the server up only after removing access to some users. We're still
trying to track down the exact client that was causing the issues. However
the cause of the crash was listed in the logs as bellow. I couldn't find any
references to "badmatch" errors on the list before so I was wondering if
anyone has seen it?

 

We're running Rabbitmq 2.8.5 on erlang 1:15.b.1-1~ubuntu~lucid. Thanks!

 

=ERROR REPORT==== 20-Sep-2012::12:59:37 ===

** Generic server <0.229.0> terminating

** Last message in was {'$gen_cast',{combine,1001,999}}

** When Server state == {state,

                            {dict,0,16,16,8,80,48,

 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                 []},

                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],

                                  [],[]}}},

                            [#Fun<rabbit_msg_store.15.106110853>],

                            {gc_state,

 
"/mnt/drbd0/rabbit at localhost/msg_store_persistent",

                                rabbit_msg_store_ets_index,

                                {state,458823,

 
"/mnt/drbd0/rabbit at localhost/msg_store_persistent"},

                                454726,462920,<0.226.0>}}

** Reason for termination == 

**
{{badmatch,{[{msg_location,<<119,180,79,244,242,22,59,63,219,227,203,29,171,

                                138,191,149>>,

                              1,999,2301,298},

 
{msg_location,<<15,166,249,210,74,141,92,125,164,106,201,179,

                                247,29,128,81>>,

                              1,999,4643,297},

 
{msg_location,<<61,32,10,20,15,47,161,44,66,91,98,119,129,10,

                                230,135>>,

                              1,999,7239,297},

 
{msg_location,<<242,222,190,244,108,107,42,177,98,113,130,255,

                                211,78,44,242>>,

                              1,999,7791,297},

 
{msg_location,<<107,45,44,203,166,43,87,116,132,109,19,63,113,

                                184,191,143>>,

                              1,999,9877,297},

..... { THOUSANDS OF LINES } .....

 
{msg_location,<<167,233,20,236,134,250,109,211,72,107,129,39,

                                57,87,109,67>>,

                              1,999,1580282,254}],

               378139}},

    [{rabbit_msg_store,combine_files,3,[]},

     {rabbit_msg_store_gc,attempt_action,3,[]},

     {rabbit_msg_store_gc,handle_cast,2,[]},

     {gen_server2,handle_msg,2,[]},

     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}

 

=ERROR REPORT==== 20-Sep-2012::13:31:15 ===

Error description:

   {shutdown,

       {gen_server,call,

           [{rabbit_amqqueue_sup,rabbit at localhost},

            {start_child,

                [{amqqueue,

                     {resource,<<"/exchange/queu">>,queue,

                         <<"/queue/hostname:1983">>},

                     true,false,none,[],<0.2434.0>,[],undefined}]},

            infinity]}}

 

Log files (may contain more information):

   /var/log/rabbitmq/rabbit at localhost.log

   /var/log/rabbitmq/rabbit at localhost-sasl.log

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/6cd0d752/attachment.htm>

From simon at rabbitmq.com  Thu Sep 20 15:55:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Sep 2012 15:55:38 +0100
Subject: [rabbitmq-discuss] Crash on badmatch
In-Reply-To: <00a101cd973d$112fffd0$338fff70$@euphoriaaudio.com>
References: <00a101cd973d$112fffd0$338fff70$@euphoriaaudio.com>
Message-ID: <505B2E6A.3070908@rabbitmq.com>

Ouch.

'badmatch' is a rather generic error message - pattern matching did not 
succeed. In the case you've encountered, pattern matching is used as an 
assertion. More specifically, the message store was attempting to merge 
two files, and in doing so found that one of them was not the size it 
expected.

So it's possible you've found a bug. If you see this happening again, 
please zip up all the logs and also the message stores + Mnesia 
themselves (/mnt/drbd0/rabbit at localhost/) since we may need to do quite 
a bit of digging to find out what's happened.

On the other hand, the message store is quite mature code; it hasn't 
changed in a while and it gets a lot of use. So I wouldn't *entirely* 
rule out RAM / HDD corruption as a cause either.

Cheers, Simon

On 20/09/12 15:34, Chris Larsen wrote:
> Hi folks, we had a problem today where the MQ server kept crashing and
> we think it was due to some client pushing in a bad message as we were
> able to keep the server up only after removing access to some users.
> We?re still trying to track down the exact client that was causing the
> issues. However the cause of the crash was listed in the logs as bellow.
> I couldn?t find any references to ?badmatch? errors on the list before
> so I was wondering if anyone has seen it?
>
> We?re running Rabbitmq 2.8.5 on erlang 1:15.b.1-1~ubuntu~lucid. Thanks!
>
> =ERROR REPORT==== 20-Sep-2012::12:59:37 ===
>
> ** Generic server <0.229.0> terminating
>
> ** Last message in was {'$gen_cast',{combine,1001,999}}
>
> ** When Server state == {state,
>
> {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
> []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>
> [],[]}}},
>
> [#Fun<rabbit_msg_store.15.106110853>],
>
> {gc_state,
>
> "/mnt/drbd0/rabbit at localhost/msg_store_persistent",
>
> rabbit_msg_store_ets_index,
>
> {state,458823,
>
> "/mnt/drbd0/rabbit at localhost/msg_store_persistent"},
>
> 454726,462920,<0.226.0>}}
>
> ** Reason for termination ==
>
> **
> {{badmatch,{[{msg_location,<<119,180,79,244,242,22,59,63,219,227,203,29,171,
>
> 138,191,149>>,
>
> 1,999,2301,298},
>
> {msg_location,<<15,166,249,210,74,141,92,125,164,106,201,179,
>
> 247,29,128,81>>,
>
> 1,999,4643,297},
>
> {msg_location,<<61,32,10,20,15,47,161,44,66,91,98,119,129,10,
>
> 230,135>>,
>
> 1,999,7239,297},
>
> {msg_location,<<242,222,190,244,108,107,42,177,98,113,130,255,
>
> 211,78,44,242>>,
>
> 1,999,7791,297},
>
> {msg_location,<<107,45,44,203,166,43,87,116,132,109,19,63,113,
>
> 184,191,143>>,
>
> 1,999,9877,297},
>
> ..... { THOUSANDS OF LINES } .....
>
> {msg_location,<<167,233,20,236,134,250,109,211,72,107,129,39,
>
> 57,87,109,67>>,
>
> 1,999,1580282,254}],
>
> 378139}},
>
> [{rabbit_msg_store,combine_files,3,[]},
>
> {rabbit_msg_store_gc,attempt_action,3,[]},
>
> {rabbit_msg_store_gc,handle_cast,2,[]},
>
> {gen_server2,handle_msg,2,[]},
>
> {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}
>
> =ERROR REPORT==== 20-Sep-2012::13:31:15 ===
>
> Error description:
>
> {shutdown,
>
> {gen_server,call,
>
> [{rabbit_amqqueue_sup,rabbit at localhost},
>
> {start_child,
>
> [{amqqueue,
>
> {resource,<<"/exchange/queu">>,queue,
>
> <<"/queue/hostname:1983">>},
>
> true,false,none,[],<0.2434.0>,[],undefined}]},
>
> infinity]}}
>
> Log files (may contain more information):
>
> /var/log/rabbitmq/rabbit at localhost.log
>
> /var/log/rabbitmq/rabbit at localhost-sasl.log
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From m.luchak at smartasking.com  Thu Sep 20 16:04:12 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Thu, 20 Sep 2012 11:04:12 -0400 (EDT)
Subject: [rabbitmq-discuss] Crash on badmatch
In-Reply-To: <505B2E6A.3070908@rabbitmq.com>
References: <00a101cd973d$112fffd0$338fff70$@euphoriaaudio.com> 
	<505B2E6A.3070908@rabbitmq.com>
Message-ID: <1348153452.374715897@apps.rackspace.com>


Hi everyone,
 
Is there a way to return what Q a msg arrived on (in java client) ?
 
I have a channel with multiple consumers subscribed to multiple Qs and I would like to take action depending on the name of the queue that the message arrived on... something like "delivery.getEnvelope().getExchange()" - great, I have the exchange but is there a similar property for consumer or channel to get the Q that the msg arrived on?
 
thanks very much,
Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/9c8b4ab9/attachment.htm>

From simon at rabbitmq.com  Thu Sep 20 16:14:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Sep 2012 16:14:01 +0100
Subject: [rabbitmq-discuss] Identifying queues in consuming channels
In-Reply-To: <1348153452.374715897@apps.rackspace.com>
References: <00a101cd973d$112fffd0$338fff70$@euphoriaaudio.com>
	<505B2E6A.3070908@rabbitmq.com>
	<1348153452.374715897@apps.rackspace.com>
Message-ID: <505B32B9.9010509@rabbitmq.com>

On 20/09/12 16:04, m.luchak at smartasking.com wrote:
> Hi everyone,

Please start new threads for new topics. This really has nothing to do 
with badmatch in the message store.

> Is there a way to return what Q a msg arrived on (in java client) ?
>
> I have a channel with multiple consumers subscribed to multiple Qs and I
> would like to take action depending on the name of the queue that the
> message arrived on... something like
> "delivery.getEnvelope().getExchange()" - great, I have the exchange but
> is there a similar property for consumer or channel to get the Q that
> the msg arrived on?

Not the queue directly, but each consumer has a consumer tag, which 
shows up in handleDelivery(). So you can either let the server give you 
a consumer tag at basicConsume() time, and maintain a map of consumer 
tag -> queue name, or you can specify the consumer tag yourself as the 
queue name, then you don't need to maintain the mapping.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Sep 20 18:01:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Sep 2012 18:01:01 +0100
Subject: [rabbitmq-discuss] rabbitmq fake-death && no breath. key word
 in log : mirrored_supervisor rabbit_mgmt_db
In-Reply-To: <97f32760-fca4-4bd7-af53-b9029cde0c2e@googlegroups.com>
References: <97f32760-fca4-4bd7-af53-b9029cde0c2e@googlegroups.com>
Message-ID: <505B4BCD.5000804@rabbitmq.com>

Hi.

This looks like a race with management DB failover that we've already 
fixed, but which has not yet made it into any release. This will be 
fixed in the next bugfix release. Until then if you are affected you can 
work around it by running the management plugin on only one node in the 
cluster (and just have rabbitmq_management_agent on the others).

Cheers, Simon

On 20/09/12 08:45, liubida wrote:
> hi all,
>
> dose anybody could point me just the direction for finding the reason
> for a fake-dead with the RabbitMQ.
> it seem the rabbitmq could not receive messages in some point, without
> any warning.
> i have constructed a cluster with 2 nodes, one disc and one ram.
> if i type the command "rabbitmqctl stop_app && rabbitmqctl start_app",
> the troubleshoot disappered.
>
>
> here is the disc node's sasl.log
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:13 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: child_terminated
> Reason: killed
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: start_error
> Reason: {already_started,<19704.13906.2335>}
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: start_error
> Reason: {already_started,<19704.13906.2335>}
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: start_error
> Reason: {already_started,<19704.13906.2335>}
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: start_error
> Reason: {already_started,<19704.13906.2335>}
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: start_error
> Reason: {already_started,<19704.13906.2335>}
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: start_error
> Reason: {already_started,<19704.13906.2335>}
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: start_error
> Reason: {already_started,<19704.13906.2335>}
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: start_error
> Reason: {already_started,<19704.13906.2335>}
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: start_error
> Reason: {already_started,<19704.13906.2335>}
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: start_error
> Reason: {already_started,<19704.13906.2335>}
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {<0.28802.1777>,mirrored_supervisor}
> Context: shutdown
> Reason: reached_max_restart_intensity
> Offender: [{pid,<0.28804.1777>},
> {name,rabbit_mgmt_db},
> {mfa,{rabbit_mgmt_db,start_link,[]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {local,rabbit_mgmt_sup}
> Context: child_terminated
> Reason: shutdown
> Offender: [{pid,<0.28803.1777>},
> {name,mirroring},
> {mfa,
> {mirrored_supervisor,start_internal,
> [rabbit_mgmt_sup,
> [{rabbit_mgmt_db,
> {rabbit_mgmt_db,start_link,[]},
> permanent,4294967295,worker,
> [rabbit_mgmt_db]}]]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
> Supervisor: {local,rabbit_mgmt_sup}
> Context: shutdown
> Reason: reached_max_restart_intensity
> Offender: [{pid,<0.28803.1777>},
> {name,mirroring},
> {mfa,
> {mirrored_supervisor,start_internal,
> [rabbit_mgmt_sup,
> [{rabbit_mgmt_db,
> {rabbit_mgmt_db,start_link,[]},
> permanent,4294967295,worker,
> [rabbit_mgmt_db]}]]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> the ram node's sasl.log
> =SUPERVISOR REPORT==== 18-Sep-2012::17:24:50 ===
> Supervisor: {local,rabbit_mgmt_sup}
> Context: child_terminated
> Reason: shutdown
> Offender: [{pid,<0.14161.2335>},
> {name,mirroring},
> {mfa,
> {mirrored_supervisor,start_internal,
> [rabbit_mgmt_sup,
> [{rabbit_mgmt_db,
> {rabbit_mgmt_db,start_link,[]},
> permanent,4294967295,worker,
> [rabbit_mgmt_db]}]]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
>
> =SUPERVISOR REPORT==== 18-Sep-2012::17:24:50 ===
> Supervisor: {local,rabbit_mgmt_sup}
> Context: shutdown
> Reason: reached_max_restart_intensity
> Offender: [{pid,<0.14161.2335>},
> {name,mirroring},
> {mfa,
> {mirrored_supervisor,start_internal,
> [rabbit_mgmt_sup,
> [{rabbit_mgmt_db,
> {rabbit_mgmt_db,start_link,[]},
> permanent,4294967295,worker,
> [rabbit_mgmt_db]}]]}},
> {restart_type,permanent},
> {shutdown,4294967295},
> {child_type,worker}]
>
> Thanks for any help.
>
> --bidaliu
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Sep 20 18:05:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 20 Sep 2012 18:05:58 +0100
Subject: [rabbitmq-discuss] Strange start error issue
In-Reply-To: <CAFnnZrhd9ctbcRSV_JskQg6tNZp5jy_yy7-BreKD+wDAKrQ+qQ@mail.gmail.com>
References: <CAFnnZrhd9ctbcRSV_JskQg6tNZp5jy_yy7-BreKD+wDAKrQ+qQ@mail.gmail.com>
Message-ID: <505B4CF6.5030109@rabbitmq.com>

Hi.

I think you must be from the same organisation as "liubida", the log 
file is identical, so see my answer there:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-September/022560.html

Cheers, Simon

On 19/09/12 17:10, Samuel Chen wrote:
> Hi all
>
> I'm new to RabbitMQ. We are facing a strange issue against
> rabbit_mgmt_db. I could not find any similar issues by searching on
> google or stackoverflow. So I wonder if anyone could help to diagnose
> this problem. Thanks in advance.
>
> We have a 2-node clustered RabbitMQ integrated with Celery. It worked
> well for several months.
> The issue occurred the first time on Jul 4th. After restarted, it worked
> for about 2 months. Yesterday the issue occurred twice (one is after
> restarted).
> The stat was that a child (rabbit_mgmt_db??) was killed automatically.
>   By some failures of restarting automatically, it reached the max
> restart intensity. Eventually it was shutdown.
> (Anther situation is that we deployed to 2-node cluster from 1 node
> server at the end of June. Note sure if it caused this issue.)
>
> The hosts are virtual servers with 8/12G ram and 30G disk.
> One node is disc node and the other is ram.
> The load balance was very low (around 100M ram, few tasks) . Disk has
> 2.5G free space.
> Log as below.
>
> Thanks for any help.
>
>         SUPERVISOR REPORT==== 18-Sep-2012::14:53:13 ===
>
>               Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>               Context:    child_terminated
>
>               Reason:     killed
>
>               Offender:   [{pid,<0.28804.1777>},
>
>                            {name,rabbit_mgmt_db},
>
>                            {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                            {restart_type,permanent},
>
>                            {shutdown,4294967295},
>
>                            {child_type,worker}]
>
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>               Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>               Context:    start_error
>
>               Reason:     {already_started,<19704.13906.2335>}
>
>               Offender:   [{pid,<0.28804.1777>},
>
>                            {name,rabbit_mgmt_db},
>
>                            {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                            {restart_type,permanent},
>
>                            {shutdown,4294967295},
>
>                            {child_type,worker}]
>
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>               Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>               Context:    start_error
>
>               Reason:     {already_started,<19704.13906.2335>}
>
>               Offender:   [{pid,<0.28804.1777>},
>
>                            {name,rabbit_mgmt_db},
>
>                            {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                            {restart_type,permanent},
>
>                            {shutdown,4294967295},
>
>                            {child_type,worker}]
>
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>               Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>               Context:    start_error
>
>               Reason:     {already_started,<19704.13906.2335>}
>
>               Offender:   [{pid,<0.28804.1777>},
>
>                            {name,rabbit_mgmt_db},
>
>                            {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                            {restart_type,permanent},
>
>                            {shutdown,4294967295},
>
>                            {child_type,worker}]
>
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>               Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>               Context:    start_error
>
>               Reason:     {already_started,<19704.13906.2335>}
>
>               Offender:   [{pid,<0.28804.1777>},
>
>                            {name,rabbit_mgmt_db},
>
>                            {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                            {restart_type,permanent},
>
>                            {shutdown,4294967295},
>
>                            {child_type,worker}]
>
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>               Supervisor: {<0.28802.1777>,mirrored_supervisor}
>
>               Context:    start_error
>
>               Reason:     {already_started,<19704.13906.2335>}
>
>               Offender:   [{pid,<0.28804.1777>},
>
>                            {name,rabbit_mgmt_db},
>
>                            {mfa,{rabbit_mgmt_db,start_link,[]}},
>
>                            {restart_type,permanent},
>
>                            {shutdown,4294967295},
>
>                            {child_type,worker}]
>
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>
>               Supervisor: {local,rabbit_mgmt_sup}
>
>               Context:    shutdown
>
>               Reason:     reached_max_restart_intensity
>
>               Offender:   [{pid,<0.28803.1777>},
>
>                            {name,mirroring},
>
>                            {mfa,
>
>                                {mirrored_supervisor,start_internal,
>
>                                    [rabbit_mgmt_sup,
>
>                                     [{rabbit_mgmt_db,
>
>                                          {rabbit_mgmt_db,start_link,[]},
>
>                                          permanent,4294967295,worker,
>
>                                          [rabbit_mgmt_db]}]]}},
>
>                            {restart_type,permanent},
>
>                            {shutdown,4294967295},
>
>                            {child_type,worker}]
>
>
>
> - Sam
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From ward.mark at gmail.com  Thu Sep 20 19:32:26 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 20 Sep 2012 11:32:26 -0700 (PDT)
Subject: [rabbitmq-discuss] IModel Dispose locks if called during
	ConnectionShutdown event
Message-ID: <32f1e400-39ac-494b-aa79-ee79b6e8fa92@googlegroups.com>

Hi,

I have a framework that upon receiving an event from the 
IConnection.ConnectionShutdown event will call dispose for all IModel it 
has.  What I have found is the IModel.Dispose or IModel.Close will lock up 
and is blocked if called from the ConnectionShutdown event handler.  I am 
not sure if this is expected behavior of the IModel to lock up like this. 
 I understand the closing of the connection will clean up all models and I 
may look into making my code detect if during a ConnectionShutdown event to 
not dispose or close the model as the connection will manage this.

Is it expected for IModel dispose/close to lock if called during a 
ConnectionShutdown event?  If it is expected I assume it will be okay to 
null the reference to the models on the connection that fired the 
ConnectionShutdown event and not cause any problems?

-Mark

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/326cd347/attachment.htm>

From ward.mark at gmail.com  Thu Sep 20 19:40:41 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Thu, 20 Sep 2012 11:40:41 -0700 (PDT)
Subject: [rabbitmq-discuss] IModel Dispose locks if called during
	ConnectionShutdown event
In-Reply-To: <32f1e400-39ac-494b-aa79-ee79b6e8fa92@googlegroups.com>
References: <32f1e400-39ac-494b-aa79-ee79b6e8fa92@googlegroups.com>
Message-ID: <e5a262dd-995a-4786-8451-b54e4f7c2f2f@googlegroups.com>

I may have found the area of the deadlock.

RabbitMQ.Util.BlockingCell

In the Value get on the Monitor.wait(this);



On Thursday, September 20, 2012 1:32:26 PM UTC-5, Mark Ward wrote:
>
> Hi,
>
> I have a framework that upon receiving an event from the 
> IConnection.ConnectionShutdown event will call dispose for all IModel it 
> has.  What I have found is the IModel.Dispose or IModel.Close will lock up 
> and is blocked if called from the ConnectionShutdown event handler.  I am 
> not sure if this is expected behavior of the IModel to lock up like this. 
>  I understand the closing of the connection will clean up all models and I 
> may look into making my code detect if during a ConnectionShutdown event to 
> not dispose or close the model as the connection will manage this.
>
> Is it expected for IModel dispose/close to lock if called during a 
> ConnectionShutdown event?  If it is expected I assume it will be okay to 
> null the reference to the models on the connection that fired the 
> ConnectionShutdown event and not cause any problems?
>
> -Mark
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/29e809af/attachment.htm>

From jonathan.s.oliver42 at gmail.com  Thu Sep 20 20:52:50 2012
From: jonathan.s.oliver42 at gmail.com (Jonathan Oliver)
Date: Thu, 20 Sep 2012 12:52:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster nodes stop/start order can lead to
	failures
In-Reply-To: <8ad1ab95-fa5c-4fda-b8f3-b096664147e9@googlegroups.com>
References: <4e96ad11-4d71-4858-8faa-9323e5a6b8e2@googlegroups.com>
	<8ad1ab95-fa5c-4fda-b8f3-b096664147e9@googlegroups.com>
Message-ID: <9c2c6423-65f7-4a18-82d7-edbfc6b17272@googlegroups.com>

Wouldn't having no less than 3 nodes help with this? I would imagine that 
the last node, even if it's a RAM node, would have the latest exchanges, 
bindings, etc. and would be able to deliver them authoritatively to the any 
node coming back online.  Obviously changes to exchanges and bindings could 
not occur during the time period during which no durable nodes are 
available, but I can't see why a RAM node couldn't help in this scenario. 
 I haven't yet tested this scenario just yet, but it's simple enough to 
prove with a few AWS cloud instances.

On Thursday, September 13, 2012 2:57:15 AM UTC-6, Jignesh Purohit wrote:
>
> Hi Matt,
>
> I too facing the same problem so kindly let me know if you get any 
> solution for this problem.
>
> Regards
> Jignesh Purohit
>
>
> On Thursday, September 13, 2012 2:13:14 AM UTC+5:30, Matt Long wrote:
>>
>> Say I have node1 and node2 both running as disc nodes in a cluster (there 
>> are no other nodes in the cluster). If I stop rabbitmq-server on node1 and 
>> then stop rabbitmq-server on node2, I'm unable to then start 
>> rabbitmq-server again on node1...in particular, the start command hangs for 
>> ~35 seconds before showing FAILED...
>>
>> Is this the expected behavior? Note that starting node2 after having 
>> stopped node1 and then node2 works fine; I'm assuming because node2 was 
>> aware that node1 had went offline prior to its stopping.
>>
>> The relevant bit from the startup_log on node1 is :
>> BOOT FAILED
>> ===========
>>
>> Timeout contacting cluster nodes: ['rabbit at node2'].
>>
>> Here's all the details:
>>
>> *node1*$ sudo service rabbitmq-server stop
>> Stopping rabbitmq-server: rabbitmq-server.
>>
>> *node2*$ sudo service rabbitmq-server stop
>> Stopping rabbitmq-server: rabbitmq-server.
>>
>> *node1*$ sudo service rabbitmq-server start
>> Starting rabbitmq-server: FAILED - check /var/log/rabbitmq/startup_{log, 
>> _err}
>> rabbitmq-server.
>>
>> Contents of startup_err:
>>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller) 
>> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
>>
>> Tail end of startup_log:
>>
>> -- rabbit boot start
>> starting file handle cache server                                     
>> ...done
>> starting worker pool                                                 
>>  ...done
>> starting database                                                     ...
>>
>> BOOT FAILED
>> ===========
>>
>> Timeout contacting cluster nodes: ['rabbit at node2'].
>>
>> DIAGNOSTICS
>> ===========
>>
>> nodes in question: ['rabbit at node2']
>>
>> hosts, their running nodes and ports:
>> - node2: []
>>
>> current node details:
>> - node name: 'rabbit at node1'
>> - home dir: /var/lib/rabbitmq
>> - cookie hash: xxxredactedxxxxxxxxxxx==
>>
>>
>> {"Kernel pid 
>> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/684f10a6/attachment.htm>

From alex.gadea at apptik.com  Thu Sep 20 13:58:07 2012
From: alex.gadea at apptik.com (Alex Gadea)
Date: Thu, 20 Sep 2012 08:58:07 -0400
Subject: [rabbitmq-discuss] How to handle distribution of message to
 either 1 OR many topics
In-Reply-To: <505AF581.3000207@rabbitmq.com>
References: <2b27726b-cbe0-4df2-a704-84e6ccf9c939@googlegroups.com>,
	<505AF581.3000207@rabbitmq.com>
Message-ID: <BLU002-W4640A835B706296963AD1FFA9A0@phx.gbl>

Thanks, that was exactly what I was looking for.  I should have seen that initially.  One followup question, I was thinking that I could have one exchange that distributed to multiple exchanges before distributing to queues.  This may allow me to hang multiple queues off of some exchanges thereby maybe reducing the initial distribution algorithm's search path.  Is there anything to gain by this performance wise?  Are exchanges lighter than queues in terms of routing (I'd wind up having the same number of final destination queues).
Thanks,Alex

> Date: Thu, 20 Sep 2012 11:52:49 +0100
> From: emile at rabbitmq.com
> To: rabbitmq-discuss at lists.rabbitmq.com
> CC: alex.gadea at apptik.com
> Subject: Re: [rabbitmq-discuss] How to handle distribution of message to either 1 OR many topics
> 
> Hi Alex,
> 
> On 20/09/12 03:23, Alex Gadea wrote:
> > message 1: audit.webhook
> > message 2: webhook
> > message 3: email.audit.webhook.s3
> 
> You should take a look at section 3.1.3.3 (The Topic Exchange Type) in
> the AMQP 0-9-1 specification which explains this:
> http://www.rabbitmq.com/protocol.html
> 
> The 5th tutorial also has some useful information:
> http://www.rabbitmq.com/tutorials/tutorial-five-python.html
> 
> #.webhook.# should capture all 3 messages.
> 
> If the publisher known exactly where a message should be routed then you
> might want to consider Sender-selected distribution. However if you have
> 100s of destination queues then this is probably not relevant:
> http://www.rabbitmq.com/sender-selected.html
> 
> 
> -Emile
> 
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/1787e7b3/attachment.htm>

From jordannpotter at gmail.com  Thu Sep 20 21:03:06 2012
From: jordannpotter at gmail.com (Jordan)
Date: Thu, 20 Sep 2012 13:03:06 -0700 (PDT)
Subject: [rabbitmq-discuss] TTL on Messages
In-Reply-To: <40aedefc-8b23-40f9-90df-2270b4f686bd@googlegroups.com>
References: <d73ecd47-d9bd-4d01-89b9-0b40c542cffb@googlegroups.com>
	<40aedefc-8b23-40f9-90df-2270b4f686bd@googlegroups.com>
Message-ID: <0e615cc5-cab0-4afa-be7e-fdaec70039ff@googlegroups.com>

Ah, got it.  I'll look into dead letter exchanges.  Thanks so much!

On Thursday, September 20, 2012 6:29:12 AM UTC-7, Stephen Young wrote:
>
> TTL is set on a queue basis, so publishing to queue *ttl_queue_1s* that 
> has been initialized {x-message-ttl: 1000} the message will be dropped by 
> rabbitmq after one second. Messages themselves cannot set their own TTL, as 
> far as I'm aware.
> The best approach I've found to tracking what gets dropped is using dead 
> letter exchanges (http://www.rabbitmq.com/dlx.html) - so you'd configure 
> your TTL queue with {x-dead-letter-exchange: other_exchange} and then route 
> the requests through there and track on the client side what has been 
> dropped.
>
> On Thursday, September 20, 2012 3:40:34 AM UTC-4, Jordan wrote:
>>
>> Hey guys,
>>
>> I'm currently using node-amqp <https://github.com/postwait/node-amqp>, 
>> and would like to set an expiration on my messages.
>>
>> I recently learned about the 'x-message-ttl' flag, but I'm not quite 
>> sure how to properly use it.  In particular, if a message expires, do I 
>> have any way of knowing *which* message it was?  Perhaps a correlation 
>> id?
>>
>> Thanks for the help!
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120920/f521c0a3/attachment.htm>

From lreese at softlayer.com  Thu Sep 20 23:53:04 2012
From: lreese at softlayer.com (lreese)
Date: Thu, 20 Sep 2012 15:53:04 -0700 (PDT)
Subject: [rabbitmq-discuss] HA queue disappears when a node rejoins
	the	cluster
In-Reply-To: <87wr0hwqv5.wl%francesco@rabbitmq.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<871uiqx8y6.wl%francesco@rabbitmq.com>
	<CACLE7izRCjP+Lcch6o7vwa78mrMvDr+dRqb-c8jiM4X0UWMAVQ@mail.gmail.com>
	<87wr0hwqv5.wl%francesco@rabbitmq.com>
Message-ID: <1348181584102-22109.post@n5.nabble.com>

Francesco Mazzoli-2 wrote
> Hi Matt,
> 
> It turns out that I was testing it wrong - I can reproduce the problem,
> and we
> tracked down the cause. Thanks a lot for reporting this, even if fixing it
> won't be fun...

Hi Francesco,

I believe that we have encountered a similar issue this morning with our
RabbitMQ cluster (2.7.1 / R15B). We are moving to a new cluster (and new
version) soon, but before we do that I'd like to keep track of the bug you
found and verify it's what we actually encountered. Could you provide the
bug identifier (if one exists yet) that can be looked up in the source
repository so that I can attempt to determine this? I believe our scenario
was caused by network segmentation, which may match up with what I've read
on this thread.

Thanks in advance,

Logan Reese



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/HA-queue-disappears-when-a-node-rejoins-the-cluster-tp21576p22109.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From samuel.net at gmail.com  Fri Sep 21 03:46:58 2012
From: samuel.net at gmail.com (Samuel Chen)
Date: Fri, 21 Sep 2012 10:46:58 +0800
Subject: [rabbitmq-discuss] Strange start error issue
In-Reply-To: <505B4CF6.5030109@rabbitmq.com>
References: <CAFnnZrhd9ctbcRSV_JskQg6tNZp5jy_yy7-BreKD+wDAKrQ+qQ@mail.gmail.com>
	<505B4CF6.5030109@rabbitmq.com>
Message-ID: <CAFnnZri-GD5v-kwsw8xfrYgNLUW=edc4Mp=1xvC-gc8u3VYpow@mail.gmail.com>

Hi Simon,

liubida is my colleague. So we are facing the same problem. We know these
each other's mail at the next morning :)

Thank you very much for you kindly answer.

Samuel


On Fri, Sep 21, 2012 at 1:05 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi.
>
> I think you must be from the same organisation as "liubida", the log file
> is identical, so see my answer there:
>
> http://lists.rabbitmq.com/**pipermail/rabbitmq-discuss/**
> 2012-September/022560.html<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-September/022560.html>
>
> Cheers, Simon
>
>
> On 19/09/12 17:10, Samuel Chen wrote:
>
>> Hi all
>>
>> I'm new to RabbitMQ. We are facing a strange issue against
>> rabbit_mgmt_db. I could not find any similar issues by searching on
>> google or stackoverflow. So I wonder if anyone could help to diagnose
>> this problem. Thanks in advance.
>>
>> We have a 2-node clustered RabbitMQ integrated with Celery. It worked
>> well for several months.
>> The issue occurred the first time on Jul 4th. After restarted, it worked
>> for about 2 months. Yesterday the issue occurred twice (one is after
>> restarted).
>> The stat was that a child (rabbit_mgmt_db??) was killed automatically.
>>   By some failures of restarting automatically, it reached the max
>> restart intensity. Eventually it was shutdown.
>> (Anther situation is that we deployed to 2-node cluster from 1 node
>> server at the end of June. Note sure if it caused this issue.)
>>
>> The hosts are virtual servers with 8/12G ram and 30G disk.
>> One node is disc node and the other is ram.
>> The load balance was very low (around 100M ram, few tasks) . Disk has
>> 2.5G free space.
>> Log as below.
>>
>> Thanks for any help.
>>
>>         SUPERVISOR REPORT==== 18-Sep-2012::14:53:13 ===
>>
>>               Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>>
>>               Context:    child_terminated
>>
>>               Reason:     killed
>>
>>               Offender:   [{pid,<0.28804.1777>},
>>
>>                            {name,rabbit_mgmt_db},
>>
>>                            {mfa,{rabbit_mgmt_db,start_**link,[]}},
>>
>>                            {restart_type,permanent},
>>
>>                            {shutdown,4294967295},
>>
>>                            {child_type,worker}]
>>
>>
>>
>>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>               Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>>
>>               Context:    start_error
>>
>>               Reason:     {already_started,<19704.13906.**2335>}
>>
>>               Offender:   [{pid,<0.28804.1777>},
>>
>>                            {name,rabbit_mgmt_db},
>>
>>                            {mfa,{rabbit_mgmt_db,start_**link,[]}},
>>
>>                            {restart_type,permanent},
>>
>>                            {shutdown,4294967295},
>>
>>                            {child_type,worker}]
>>
>>
>>
>>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>               Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>>
>>               Context:    start_error
>>
>>               Reason:     {already_started,<19704.13906.**2335>}
>>
>>               Offender:   [{pid,<0.28804.1777>},
>>
>>                            {name,rabbit_mgmt_db},
>>
>>                            {mfa,{rabbit_mgmt_db,start_**link,[]}},
>>
>>                            {restart_type,permanent},
>>
>>                            {shutdown,4294967295},
>>
>>                            {child_type,worker}]
>>
>>
>>
>>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>               Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>>
>>               Context:    start_error
>>
>>               Reason:     {already_started,<19704.13906.**2335>}
>>
>>               Offender:   [{pid,<0.28804.1777>},
>>
>>                            {name,rabbit_mgmt_db},
>>
>>                            {mfa,{rabbit_mgmt_db,start_**link,[]}},
>>
>>                            {restart_type,permanent},
>>
>>                            {shutdown,4294967295},
>>
>>                            {child_type,worker}]
>>
>>
>>
>>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>               Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>>
>>               Context:    start_error
>>
>>               Reason:     {already_started,<19704.13906.**2335>}
>>
>>               Offender:   [{pid,<0.28804.1777>},
>>
>>                            {name,rabbit_mgmt_db},
>>
>>                            {mfa,{rabbit_mgmt_db,start_**link,[]}},
>>
>>                            {restart_type,permanent},
>>
>>                            {shutdown,4294967295},
>>
>>                            {child_type,worker}]
>>
>>
>>
>>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>               Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>>
>>               Context:    start_error
>>
>>               Reason:     {already_started,<19704.13906.**2335>}
>>
>>               Offender:   [{pid,<0.28804.1777>},
>>
>>                            {name,rabbit_mgmt_db},
>>
>>                            {mfa,{rabbit_mgmt_db,start_**link,[]}},
>>
>>                            {restart_type,permanent},
>>
>>                            {shutdown,4294967295},
>>
>>                            {child_type,worker}]
>>
>>
>>
>>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>>
>>               Supervisor: {local,rabbit_mgmt_sup}
>>
>>               Context:    shutdown
>>
>>               Reason:     reached_max_restart_intensity
>>
>>               Offender:   [{pid,<0.28803.1777>},
>>
>>                            {name,mirroring},
>>
>>                            {mfa,
>>
>>                                {mirrored_supervisor,start_**internal,
>>
>>                                    [rabbit_mgmt_sup,
>>
>>                                     [{rabbit_mgmt_db,
>>
>>                                          {rabbit_mgmt_db,start_link,[]}**
>> ,
>>
>>                                          permanent,4294967295,worker,
>>
>>                                          [rabbit_mgmt_db]}]]}},
>>
>>                            {restart_type,permanent},
>>
>>                            {shutdown,4294967295},
>>
>>                            {child_type,worker}]
>>
>>
>>
>> - Sam
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/42d90a50/attachment.htm>

From rjones at ekit-inc.com  Fri Sep 21 02:28:44 2012
From: rjones at ekit-inc.com (Richard Jones)
Date: Fri, 21 Sep 2012 11:28:44 +1000
Subject: [rabbitmq-discuss] Issues with the complexity of building RabbitMQ
Message-ID: <98B0E1F1-711F-4DE8-AD8B-B45DDC37B95D@ekit-inc.com>

A colleague of mine has spent the better part of the last two days building RabbitMQ for our Solaris systems. He's run into numerous problems along the way, partly in thanks to Solaris, but today he finally had Erlang built and could move on to building RabbitMQ itself.

One part of the build had him quite stumped - it needed git! He spent some time building git (as the latest version didn't build and he had to look for an older version). Even then git failed to work properly for some of the checkouts (ugh), so he manually exported a snapshot of the appropriate repository. Then he realised that the RabbitMQ build was patching the git checkout using local patches.

That seems strange. Why not fork the git repositories in question and apply the patches there?

It also seems that the git pulls were for plugins that could've just been bundled with the RabbitMQ source.

These things aren't super annoying on their own, and certainly Solaris isn't helping, but as I mentioned this has been quite the laborious task for him to get everything built.


    Richard

ps. I'm posting this on request of @monadic - I'm not subscribed to the list so please CC me if you need to discuss this post with me.


From shane at hathawaymix.org  Fri Sep 21 08:25:36 2012
From: shane at hathawaymix.org (Shane Hathaway)
Date: Fri, 21 Sep 2012 01:25:36 -0600
Subject: [rabbitmq-discuss] Issues with the complexity of building
	RabbitMQ
In-Reply-To: <98B0E1F1-711F-4DE8-AD8B-B45DDC37B95D@ekit-inc.com>
References: <98B0E1F1-711F-4DE8-AD8B-B45DDC37B95D@ekit-inc.com>
Message-ID: <505C1670.5070904@hathawaymix.org>

On 09/20/2012 07:28 PM, Richard Jones wrote:
> A colleague of mine has spent the better part of the last two days
> building RabbitMQ for our Solaris systems. He's run into numerous
> problems along the way, partly in thanks to Solaris, but today he
> finally had Erlang built and could move on to building RabbitMQ
> itself.
>
> One part of the build had him quite stumped - it needed git! He spent
> some time building git (as the latest version didn't build and he had
> to look for an older version). Even then git failed to work properly
> for some of the checkouts (ugh), so he manually exported a snapshot
> of the appropriate repository. Then he realised that the RabbitMQ
> build was patching the git checkout using local patches.

Personally, I reverted back to RabbitMQ 2.8.4, which does not need git 
(or anything else from the Internet) to build from source.  2.8.5 might 
be similar.

Shane

From matthias at rabbitmq.com  Fri Sep 21 09:00:08 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 21 Sep 2012 09:00:08 +0100
Subject: [rabbitmq-discuss] Issues with the complexity of building
	RabbitMQ
In-Reply-To: <505C1670.5070904@hathawaymix.org>
References: <98B0E1F1-711F-4DE8-AD8B-B45DDC37B95D@ekit-inc.com>
	<505C1670.5070904@hathawaymix.org>
Message-ID: <505C1E88.5040405@rabbitmq.com>

Shane, Richard,

On 21/09/12 08:25, Shane Hathaway wrote:
> On 09/20/2012 07:28 PM, Richard Jones wrote:
>> One part of the build had him quite stumped - it needed git! He spent
>> some time building git (as the latest version didn't build and he had
>> to look for an older version). Even then git failed to work properly
>> for some of the checkouts (ugh), so he manually exported a snapshot
>> of the appropriate repository. Then he realised that the RabbitMQ
>> build was patching the git checkout using local patches.
>
> Personally, I reverted back to RabbitMQ 2.8.4, which does not need git
> (or anything else from the Internet) to build from source.  2.8.5 might
> be similar.

We are aware of this problem (see, e.g. 
http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-sources-release-td21582.html#a21583) 
and 
http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-v2-8-6-installation-Command-make-hangs-forever-td21709.html#a21860) 
and will fix it in the next release.

I am curious though, why do you need to build from source in the first 
place. The generic unix downloads should work just fine on Solaris.

Regards,

Matthias.

From brendan at soundcloud.com  Fri Sep 21 09:01:31 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Fri, 21 Sep 2012 10:01:31 +0200
Subject: [rabbitmq-discuss] Controlling upstream federation queue names
Message-ID: <CAHZsVQa4iUcHdCLCVBAqy0YAhgQf=EE1S_vopktgx7swcyN3FA@mail.gmail.com>

Hi,

Say I have two downstream brokers connected to a single upstream,
upon which lives a single exchange.

Can I configure the plugin, to create the upstream federation queues,
with the same name so that they round-robin over messages coming
off the upstream exchange, to ensure messages are delivered to
_either_ of the downstream pair (rather than both)?

(Make sense?)

Regards,
Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/16c828e0/attachment.htm>

From emile at rabbitmq.com  Fri Sep 21 10:51:51 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 21 Sep 2012 10:51:51 +0100
Subject: [rabbitmq-discuss] c# how to get ConfirmSelect errors
In-Reply-To: <0163c372-1f8a-4979-a265-3409da22980d@googlegroups.com>
References: <8310a7bd-e688-4363-9c15-dec84723a5d5@googlegroups.com>
	<0163c372-1f8a-4979-a265-3409da22980d@googlegroups.com>
Message-ID: <505C38B7.6050208@rabbitmq.com>


Mark,

On 20/09/12 14:45, Mark Ward wrote:
> "setconfirmListener" which has now been renamed to "addConfirmListener".
>  It appears the .NET version of the rabbitMQ client does not have this
> method or ability.  It would appear this is what I am looking for but I
> have not found it in the .NET version.  Is this a lacking feature in the
> .NET version or am I not looking in the right place?

The method is called IModel.ConfirmSelect(). ("Enable publisher
acknowledgements.")

> I have the ability to identify the batch of message the fault occurred
> in but I am seeking if I can identify specifically the messages in the
> batch.

If you make the batch size 1 then you will be able to identify the
individual message that was being published when the error occurred. You
will also compromise performance.


-Emile


From azimi.majid at yahoo.com  Fri Sep 21 10:46:34 2012
From: azimi.majid at yahoo.com (Majid Azimi)
Date: Fri, 21 Sep 2012 02:46:34 -0700 (PDT)
Subject: [rabbitmq-discuss] acknowledgement in client side
Message-ID: <1348220794.70341.YahooMailNeo@web125202.mail.ne1.yahoo.com>

hi guys,

I have some questions about acknowledgement in client side:

1. if basic.publish finishes executing and there is no exception thrown, 
this means message has been received in message server? or we need to 
enable transactions or use confirmSelect() to be sure?

2. Is it possible to use txSelect() in consumer side?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/68c879ed/attachment.htm>

From matthias at rabbitmq.com  Fri Sep 21 10:58:32 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 21 Sep 2012 10:58:32 +0100
Subject: [rabbitmq-discuss] c# how to get ConfirmSelect errors
In-Reply-To: <505C38B7.6050208@rabbitmq.com>
References: <8310a7bd-e688-4363-9c15-dec84723a5d5@googlegroups.com>
	<0163c372-1f8a-4979-a265-3409da22980d@googlegroups.com>
	<505C38B7.6050208@rabbitmq.com>
Message-ID: <505C3A48.7010001@rabbitmq.com>

On 21/09/12 10:51, Emile Joubert wrote:
> On 20/09/12 14:45, Mark Ward wrote:
>> "setconfirmListener" which has now been renamed to "addConfirmListener".
>>   It appears the .NET version of the rabbitMQ client does not have this
>> method or ability.  It would appear this is what I am looking for but I
>> have not found it in the .NET version.  Is this a lacking feature in the
>> .NET version or am I not looking in the right place?
>
> The method is called IModel.ConfirmSelect(). ("Enable publisher
> acknowledgements.")

i.e. 
https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.8.6/rabbitmq-dotnet-client-2.8.6-client-htmldoc/html/type-RabbitMQ.Client.IModel.html#method-M:RabbitMQ.Client.IModel.ConfirmSelect

which enables confirms.

If you want to receive an event for confirms, use the 
Basic{Ack,Nack}EventHandlers:

https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.8.6/rabbitmq-dotnet-client-2.8.6-client-htmldoc/html/type-RabbitMQ.Client.IModel.html#event-E:RabbitMQ.Client.IModel.BasicAcks

https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.8.6/rabbitmq-dotnet-client-2.8.6-client-htmldoc/html/type-RabbitMQ.Client.IModel.html#event-E:RabbitMQ.Client.IModel.BasicNacks

>> I have the ability to identify the batch of message the fault occurred
>> in but I am seeking if I can identify specifically the messages in the
>> batch.
>
> If you make the batch size 1 then you will be able to identify the
> individual message that was being published when the error occurred.

One can do better than that.

Each message is associated with a sequence number on publish. A client 
can obtain that sequence number with IModel.NextPublishSeqNo - 
https://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.8.6/rabbitmq-dotnet-client-2.8.6-client-htmldoc/html/type-RabbitMQ.Client.IModel.html#property-P:RabbitMQ.Client.IModel.NextPublishSeqNo

These very same sequence numbers get referenced in the DeliveryTags of 
the Basic{Ack,Nack}Events, i.e. you get told exactly what messages were 
confirmed / rejected.

This is explained in http://www.rabbitmq.com/confirms.html

Regards,

Matthias.

From simon at rabbitmq.com  Fri Sep 21 10:59:46 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Sep 2012 10:59:46 +0100
Subject: [rabbitmq-discuss] acknowledgement in client side
In-Reply-To: <1348220794.70341.YahooMailNeo@web125202.mail.ne1.yahoo.com>
References: <1348220794.70341.YahooMailNeo@web125202.mail.ne1.yahoo.com>
Message-ID: <505C3A92.7080609@rabbitmq.com>

On 21/09/12 10:46, Majid Azimi wrote:
> hi guys,
>
> I have some questions about acknowledgement in client side*:
>
> 1. if basic.publish finishes executing and there is no exception thrown,
> this means message has been received in message server? or we need to
> enable transactions or use confirmSelect() to be sure?

You need to use tx or confirms. Just having basic.publish finish means 
that the message has gone out on the network.

(And the reason for this is that if the basic.publish were to know that 
the server had received the message, we'd need a network round trip per 
publish, and performance would go WAY down.)

> 2. Is it possible to use txSelect() in consumer side?

Yes, acks/rejects are transactional.

http://www.rabbitmq.com/semantics.html

Cheers, Simon]

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Fri Sep 21 11:15:33 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 21 Sep 2012 11:15:33 +0100
Subject: [rabbitmq-discuss] IModel Dispose locks if called during
 ConnectionShutdown event
In-Reply-To: <e5a262dd-995a-4786-8451-b54e4f7c2f2f@googlegroups.com>
References: <32f1e400-39ac-494b-aa79-ee79b6e8fa92@googlegroups.com>
	<e5a262dd-995a-4786-8451-b54e4f7c2f2f@googlegroups.com>
Message-ID: <505C3E45.2070807@rabbitmq.com>


Hi Mark,

On 20/09/12 19:40, Mark Ward wrote:
> I may have found the area of the deadlock.
> 
> RabbitMQ.Util.BlockingCell
> 
> In the Value get on the Monitor.wait(this);

This question is similar to a previous one from Derek Greer which you
may want to take a look at:
http://markmail.org/message/3f64mebpams5icv5

The channel/IModel will be cleaned up by the library. There is no need
to do this from within the ConnectionShutdown event handler, and
attempting to do so will lead to the problems you describe.

(Btw, what is the framework you mentioned that is exhibiting this
behaviour?)

-Emile


From simon at rabbitmq.com  Fri Sep 21 11:11:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Sep 2012 11:11:33 +0100
Subject: [rabbitmq-discuss] Controlling upstream federation queue names
In-Reply-To: <CAHZsVQa4iUcHdCLCVBAqy0YAhgQf=EE1S_vopktgx7swcyN3FA@mail.gmail.com>
References: <CAHZsVQa4iUcHdCLCVBAqy0YAhgQf=EE1S_vopktgx7swcyN3FA@mail.gmail.com>
Message-ID: <505C3D55.9080507@rabbitmq.com>

On 21/09/12 09:01, Brendan Hay wrote:
> Hi,

Hi.

> Say I have two downstream brokers connected to a single upstream,
> upon which lives a single exchange.
>
> Can I configure the plugin, to create the upstream federation queues,
> with the same name so that they round-robin over messages coming
> off the upstream exchange, to ensure messages are delivered to
> _either_ of the downstream pair (rather than both)?

Sort of.

You could set the 'local_nodename' for each broker to the same value. 
They will both identify themselves the same way to the upstream, and 
thus share queues.

But they won't be aware of each other, and they will thus stomp on each 
other's bindings upstream. So that's not good.

Maybe we need to separate the federation from the round-robinning? You 
could use the consistent hash exchange upstream as a source, and then 
bind two exchanges as local destinations to that, and then federate with 
those two exchanges. You won't share the upstream queues but you'll get 
a similar round-robinning effect (the difference being that if one link 
goes down messages will back up for it, rather than the other link 
taking the strain).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From azimi.majid at yahoo.com  Fri Sep 21 13:42:31 2012
From: azimi.majid at yahoo.com (Majid Azimi)
Date: Fri, 21 Sep 2012 05:42:31 -0700 (PDT)
Subject: [rabbitmq-discuss] transacted channel vs txSelect()
Message-ID: <1348231351.47978.YahooMailNeo@web125206.mail.ne1.yahoo.com>

1. What is 
difference between using transacted channel using txSelect() and not 
transacted channel and manually acknowledging he message? It seems to me they do the same thing.

2. When using basicConsume() in 
transacted channel what is acknowledging mode? autoack = true? In JMS 
when we use transacted session there is nothing like manual 
acknowledging. Is this true here? 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/6092176c/attachment.htm>

From francesco at rabbitmq.com  Fri Sep 21 14:13:35 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 21 Sep 2012 14:13:35 +0100
Subject: [rabbitmq-discuss] Cluster nodes stop/start order can lead
	to	failures
In-Reply-To: <9c2c6423-65f7-4a18-82d7-edbfc6b17272@googlegroups.com>
References: <4e96ad11-4d71-4858-8faa-9323e5a6b8e2@googlegroups.com>
	<8ad1ab95-fa5c-4fda-b8f3-b096664147e9@googlegroups.com>
	<9c2c6423-65f7-4a18-82d7-edbfc6b17272@googlegroups.com>
Message-ID: <87k3vn8qo0.wl%francesco@rabbitmq.com>

At Thu, 20 Sep 2012 12:52:50 -0700 (PDT),
Jonathan Oliver wrote:
> Wouldn't having no less than 3 nodes help with this? I would imagine that the
> last node, even if it's a RAM node, would have the latest exchanges, bindings,
> etc. and would be able to deliver them authoritatively to the any node coming
> back online.

The rule is simple: when all the nodes in a cluster go down, the last disc node
to go down must be the first one to go up.  This guarantees that the node with
the most up-to-date data is the first one to reappear.

Having a standalone RAM node is a different scenario, and one that should be
avoided (and in fact we try to prevent users from doing so, and we will do more
in the future), since when if the RAM node fails there will be loss of data,
moreover...

> Obviously changes to exchanges and bindings could not occur during the time
> period during which no durable nodes are available

there's nothing that prevents bindings to be created on RAM nodes (but as said
before that's asking for loss of data).

> but I can't see why a RAM node couldn't help in this scenario.

Having 3 nodes simply defers the problem - the limitation of having to bring the
last node to go down up remains.  If the last node to stand is a RAM node then
if that node fails the first node to be brought up must be the last disc node
anyway.

> I haven't yet tested this scenario just yet, but it's simple enough to prove
> with a few AWS cloud instances.

You don't need AWS instances, everything can be done locally, see
<https://rabbitmq.com/clustering.html#single-machine>.

--
Francesco * Often in error, never in doubt

From francesco at rabbitmq.com  Fri Sep 21 14:18:10 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 21 Sep 2012 14:18:10 +0100
Subject: [rabbitmq-discuss] HA queue disappears when a node
	rejoins	the	cluster
In-Reply-To: <1348181584102-22109.post@n5.nabble.com>
References: <CACLE7iycxx1iksjuk7OYji4og1LO6dyhm369DNgLJ78bfJaKSQ@mail.gmail.com>
	<871uiqx8y6.wl%francesco@rabbitmq.com>
	<CACLE7izRCjP+Lcch6o7vwa78mrMvDr+dRqb-c8jiM4X0UWMAVQ@mail.gmail.com>
	<87wr0hwqv5.wl%francesco@rabbitmq.com>
	<1348181584102-22109.post@n5.nabble.com>
Message-ID: <87ipb78qgd.wl%francesco@rabbitmq.com>

Hi Logan,

At Thu, 20 Sep 2012 15:53:04 -0700 (PDT),
lreese wrote:
> I believe that we have encountered a similar issue this morning with our
> RabbitMQ cluster (2.7.1 / R15B). We are moving to a new cluster (and new
> version) soon, but before we do that I'd like to keep track of the bug you
> found and verify it's what we actually encountered. Could you provide the bug
> identifier (if one exists yet) that can be looked up in the source repository
> so that I can attempt to determine this? I believe our scenario was caused by
> network segmentation, which may match up with what I've read on this thread.

The bug branch is `bug25118'
(<https://github.com/rabbitmq/rabbitmq-server/tree/bug25118>), which has been
already merged into the master branch.  The changes will make it into the next
bugfix release.

--
Francesco * Often in error, never in doubt

From brendan at soundcloud.com  Fri Sep 21 14:52:34 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Fri, 21 Sep 2012 15:52:34 +0200
Subject: [rabbitmq-discuss] Controlling upstream federation queue names
In-Reply-To: <505C3D55.9080507@rabbitmq.com>
References: <CAHZsVQa4iUcHdCLCVBAqy0YAhgQf=EE1S_vopktgx7swcyN3FA@mail.gmail.com>
	<505C3D55.9080507@rabbitmq.com>
Message-ID: <CAHZsVQaNvfwCkF1vN5zKr22SwPGdy_47HGrb9YP4V8GVrfp1UQ@mail.gmail.com>

Hrmm!

Not entirely ideal .. I'd had visions of hacking this wee beastie to be
overridable/configurable:
https://github.com/rabbitmq/rabbitmq-federation/blob/master/src/rabbit_federation_link.erl#L520

Going the route of changing exchange types and other upstream finger pokery
is not an option, unfortunately.

I'll stick to using an insentient shovel config, to ensure sharing upstream
queues in the meantime.

Cheers,
Brendan


On Fri, Sep 21, 2012 at 12:11 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 21/09/12 09:01, Brendan Hay wrote:
>
>> Hi,
>>
>
> Hi.
>
>
>  Say I have two downstream brokers connected to a single upstream,
>> upon which lives a single exchange.
>>
>> Can I configure the plugin, to create the upstream federation queues,
>> with the same name so that they round-robin over messages coming
>> off the upstream exchange, to ensure messages are delivered to
>> _either_ of the downstream pair (rather than both)?
>>
>
> Sort of.
>
> You could set the 'local_nodename' for each broker to the same value. They
> will both identify themselves the same way to the upstream, and thus share
> queues.
>
> But they won't be aware of each other, and they will thus stomp on each
> other's bindings upstream. So that's not good.
>
> Maybe we need to separate the federation from the round-robinning? You
> could use the consistent hash exchange upstream as a source, and then bind
> two exchanges as local destinations to that, and then federate with those
> two exchanges. You won't share the upstream queues but you'll get a similar
> round-robinning effect (the difference being that if one link goes down
> messages will back up for it, rather than the other link taking the strain).
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/f4ca2da4/attachment.htm>

From dbgreer at gmail.com  Fri Sep 21 14:59:49 2012
From: dbgreer at gmail.com (Derek Greer)
Date: Fri, 21 Sep 2012 08:59:49 -0500
Subject: [rabbitmq-discuss] Fwd: .Net RabbitMQ.Client Issue: Deadlock on
	ConnectionShutdown
In-Reply-To: <CAAzMECn9zeFrj-hT2V1jt1SKythiWX4CiuUyZ6Htd=x8Up6NFw@mail.gmail.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
	<503367A3.5060107@rabbitmq.com>
	<CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>
	<50339D74.9080305@rabbitmq.com>
	<CAAzMECnZXCsFFurezzxeLNkagz+f9-_onNq1KX2Nd7eG5Zpc5Q@mail.gmail.com>
	<5033B390.3060105@rabbitmq.com>
	<CAAzMECn9zeFrj-hT2V1jt1SKythiWX4CiuUyZ6Htd=x8Up6NFw@mail.gmail.com>
Message-ID: <CAAzMECn4efkgJoLV-8DLmenSJJsvQ14tonjRNag9NCWeznM6-A@mail.gmail.com>

I just realized I sent this response directly to Emile instead of back to
the list, so copying the list now.

---------- Forwarded message ----------
From: Derek Greer <dbgreer at gmail.com>
Date: Tue, Aug 21, 2012 at 11:21 AM
Subject: Re: [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on
ConnectionShutdown
To: Emile Joubert <emile at rabbitmq.com>


Thanks for the example.  I'll take a look at how its being done there.

Concerning subscriptions, I'm referring to a logical subscription not any
particular component of the rabbitmq API.  I have a Subscription class that
represents a logical subscription which contains a Renew(IConnection
connection) method which stops the current thread and restarts it with the
newly available connection.  I'm wanting to loop through all my
Subscription instances and call Renew() after I have a new connection.
 Part of the Renew() logic is to stop the current thread, and part of the
normal course of stopping is to attempt to close the channel/model.


On Tue, Aug 21, 2012 at 11:13 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Derek,
>
> On 21/08/12 16:38, Derek Greer wrote:
> > I'm trying to deal with connection shutdown logic as an atomic
> > operation.  Here's the scenario I'm trying to implement:
>
> I hesitate to mention it, because this library has been deprecated but
> not yet completely removed:
> http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/
>
> In it you will find an example of how one might go about reconnecting to
> a broker. Be warned that this code will be removed soon and is not
> guaranteed to work with recent versions of the broker.
>
> >       o refresh each subscription with the new connection
>
> It is not possible to maintain the previous subscription to the broker
> and somehow inject a new channel and/or connection into it. You will
> need to re-establish all contained channels and all associated
> subscriptions when the connection shuts down.
>
> > aside, don't you agree that ConnectionShutdown should be the event you
> > should subscribe to when you want to know about connection shutdowns?
>
> Yes.
>
> > As far as the blocking, I'm perplexed as to why we wouldn't be seeing
> > the same results.
>
> When I run your Consumer.exe  standalone I also get the same exception
> as before.
>
>
>
> -Emile
>
>
>


-- 
___________________________________________
Derek Greer
dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
lostechies.com <http://derekgreer.lostechies.com/> |
freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
 | aspiringcraftsman.com
___________________________________________





-- 
___________________________________________
Derek Greer
dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
lostechies.com <http://derekgreer.lostechies.com/> |
freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
 | aspiringcraftsman.com
___________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/7a6a5797/attachment.htm>

From emile at rabbitmq.com  Fri Sep 21 15:25:30 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 21 Sep 2012 15:25:30 +0100
Subject: [rabbitmq-discuss] Fwd: .Net RabbitMQ.Client Issue: Deadlock on
 ConnectionShutdown
In-Reply-To: <CAAzMECn4efkgJoLV-8DLmenSJJsvQ14tonjRNag9NCWeznM6-A@mail.gmail.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
	<503367A3.5060107@rabbitmq.com>
	<CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>
	<50339D74.9080305@rabbitmq.com>
	<CAAzMECnZXCsFFurezzxeLNkagz+f9-_onNq1KX2Nd7eG5Zpc5Q@mail.gmail.com>
	<5033B390.3060105@rabbitmq.com>
	<CAAzMECn9zeFrj-hT2V1jt1SKythiWX4CiuUyZ6Htd=x8Up6NFw@mail.gmail.com>
	<CAAzMECn4efkgJoLV-8DLmenSJJsvQ14tonjRNag9NCWeznM6-A@mail.gmail.com>
Message-ID: <505C78DA.8030806@rabbitmq.com>

Hi Derek,

On 21/09/12 14:59, Derek Greer wrote:
> I'm wanting to loop through all my
> Subscription instances and call Renew() after I have a new connection.
>  Part of the Renew() logic is to stop the current thread, and part of the
> normal course of stopping is to attempt to close the channel/model.

You shouldn't close the channel/IModel from within a shutdown callback.
Also consider performing connection re-establishment rather than channel
re-establishment/renewal.

-Emile


From dbgreer at gmail.com  Fri Sep 21 15:24:44 2012
From: dbgreer at gmail.com (Derek Greer)
Date: Fri, 21 Sep 2012 09:24:44 -0500
Subject: [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on
	ConnectionShutdown
In-Reply-To: <CAAzMECn4efkgJoLV-8DLmenSJJsvQ14tonjRNag9NCWeznM6-A@mail.gmail.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
	<503367A3.5060107@rabbitmq.com>
	<CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>
	<50339D74.9080305@rabbitmq.com>
	<CAAzMECnZXCsFFurezzxeLNkagz+f9-_onNq1KX2Nd7eG5Zpc5Q@mail.gmail.com>
	<5033B390.3060105@rabbitmq.com>
	<CAAzMECn9zeFrj-hT2V1jt1SKythiWX4CiuUyZ6Htd=x8Up6NFw@mail.gmail.com>
	<CAAzMECn4efkgJoLV-8DLmenSJJsvQ14tonjRNag9NCWeznM6-A@mail.gmail.com>
Message-ID: <CAAzMECn9108i4E3AqNxr1kr9omicnYs-VvRUjGUDimdfk6qegw@mail.gmail.com>

Since this thread was recently referenced
here<http://markmail.org/search/Re:+%5Brabbitmq-discuss%5D+IModel+Dispose+locks+if+called+during+ConnectionShutdown+event#query:Re%3A%20%5Brabbitmq-discuss%5D%20IModel%20Dispose%20locks%20if%20called%20during%20ConnectionShutdown%20event+page:1+mid:rnnrrzk7bcknavtw+state:results>,
 I
thought I'd follow up on this issue.

First, shortly after encountering this issue, I obtained a new HP laptop at
work which did not exhibit the blocking behavior upon calling
IModel.Close(), but rather threw an IOException as observed and mentioned
by Emile earlier in this thread.  The other machine which displays the
error is a Dell laptop, though I'm not sure what the difference is that
would account for the change in behavior.  Either way, the behavior is
undesired.



On Fri, Sep 21, 2012 at 8:59 AM, Derek Greer <dbgreer at gmail.com> wrote:

> I just realized I sent this response directly to Emile instead of back to
> the list, so copying the list now.
>
>
> ---------- Forwarded message ----------
> From: Derek Greer <dbgreer at gmail.com>
> Date: Tue, Aug 21, 2012 at 11:21 AM
> Subject: Re: [rabbitmq-discuss] .Net RabbitMQ.Client Issue: Deadlock on
> ConnectionShutdown
> To: Emile Joubert <emile at rabbitmq.com>
>
>
> Thanks for the example.  I'll take a look at how its being done there.
>
> Concerning subscriptions, I'm referring to a logical subscription not any
> particular component of the rabbitmq API.  I have a Subscription class that
> represents a logical subscription which contains a Renew(IConnection
> connection) method which stops the current thread and restarts it with the
> newly available connection.  I'm wanting to loop through all my
> Subscription instances and call Renew() after I have a new connection.
>  Part of the Renew() logic is to stop the current thread, and part of the
> normal course of stopping is to attempt to close the channel/model.
>
>
> On Tue, Aug 21, 2012 at 11:13 AM, Emile Joubert <emile at rabbitmq.com>wrote:
>
>> Hi Derek,
>>
>> On 21/08/12 16:38, Derek Greer wrote:
>> > I'm trying to deal with connection shutdown logic as an atomic
>> > operation.  Here's the scenario I'm trying to implement:
>>
>> I hesitate to mention it, because this library has been deprecated but
>> not yet completely removed:
>> http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/
>>
>> In it you will find an example of how one might go about reconnecting to
>> a broker. Be warned that this code will be removed soon and is not
>> guaranteed to work with recent versions of the broker.
>>
>> >       o refresh each subscription with the new connection
>>
>> It is not possible to maintain the previous subscription to the broker
>> and somehow inject a new channel and/or connection into it. You will
>> need to re-establish all contained channels and all associated
>> subscriptions when the connection shuts down.
>>
>> > aside, don't you agree that ConnectionShutdown should be the event you
>> > should subscribe to when you want to know about connection shutdowns?
>>
>> Yes.
>>
>> > As far as the blocking, I'm perplexed as to why we wouldn't be seeing
>> > the same results.
>>
>> When I run your Consumer.exe  standalone I also get the same exception
>> as before.
>>
>>
>>
>> -Emile
>>
>>
>>
>
>
> --
> ___________________________________________
> Derek Greer
> dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
> lostechies.com <http://derekgreer.lostechies.com/> | freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
>  | aspiringcraftsman.com
> ___________________________________________
>
>
>
>
>
> --
> ___________________________________________
> Derek Greer
> dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
> lostechies.com <http://derekgreer.lostechies.com/> | freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
>  | aspiringcraftsman.com
> ___________________________________________
>
>
>


-- 
___________________________________________
Derek Greer
dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
lostechies.com <http://derekgreer.lostechies.com/> |
freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
 | aspiringcraftsman.com
___________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/66e62407/attachment.htm>

From dbgreer at gmail.com  Fri Sep 21 15:48:59 2012
From: dbgreer at gmail.com (Derek Greer)
Date: Fri, 21 Sep 2012 09:48:59 -0500
Subject: [rabbitmq-discuss] Fwd: .Net RabbitMQ.Client Issue: Deadlock on
	ConnectionShutdown
In-Reply-To: <505C78DA.8030806@rabbitmq.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
	<503367A3.5060107@rabbitmq.com>
	<CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>
	<50339D74.9080305@rabbitmq.com>
	<CAAzMECnZXCsFFurezzxeLNkagz+f9-_onNq1KX2Nd7eG5Zpc5Q@mail.gmail.com>
	<5033B390.3060105@rabbitmq.com>
	<CAAzMECn9zeFrj-hT2V1jt1SKythiWX4CiuUyZ6Htd=x8Up6NFw@mail.gmail.com>
	<CAAzMECn4efkgJoLV-8DLmenSJJsvQ14tonjRNag9NCWeznM6-A@mail.gmail.com>
	<505C78DA.8030806@rabbitmq.com>
Message-ID: <CAAzMECnYZByaUQUCAguhOnOu=JAAKoKZxq-zGfsj-zGFj2owTg@mail.gmail.com>

I appreciate the guidance that you shouldn't call IModel.Close() from a
shutdown callback due to the way the code is currently designed, but I
submit that this is a design flaw within the .Net client and that ideally
you should be able to do this.

As far as considering connection renewal rather than channel renewal, I
don't understand how this would be possible. You yourself said:

*"It is not possible to maintain the previous subscription to the broker*
*and somehow inject a new channel and/or connection into it. You will*
*need to re-establish all contained channels and all associated*
*subscriptions when the connection shuts down."*



If I'm misunderstanding what you mean by this, please provide a bit more
detail as to what you're referring to.


Currently, I'm working around the issue with the following code:

//
------------------------------------------------------------------------------------------
// Closing/disposing channels on IConnection.ConnectionShutdown causes a
deadlock, so
// the ISession.SessionShutdown event is used here to infer a connection
shutdown.
//
------------------------------------------------------------------------------------------
((ConnectionBase) connection).m_session0.SessionShutdown +=
UnexpectedConnectionShutdown;

This obviously isn't ideal, as the SessionShutdown isn't intended to be
part of the public API.  I also not completely sure why it works, I just
know that it satisfies my integration test suite.

Again, the problem I'm trying to address is to model a Subscription which
can be cancelled on demand (i.e. the user wants to maintain the connection,
but wants to unsubscribe from receiving a given message type), and which
can be renewed when a new connection is obtained.  Using the
IModel.ModelShutdown event here isn't what someone would want to do from a
design perspective, as there are things I want to do on connection shutdown
that I don't want to do on every model shutdown.  It just simply isn't the
right event for the case at hand.  I also can't just not call
IModel.Close() in all cases.

Bottom line, I see a design flaw here that needs to be recognized and
addressed.

Speaking of which, this mailing list is a horrible way to deal with product
specific bug reports.  Why doesn't your team use github or some other
facility which has a proper bug tracking system?







On Fri, Sep 21, 2012 at 9:25 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Derek,
>
> On 21/09/12 14:59, Derek Greer wrote:
> > I'm wanting to loop through all my
> > Subscription instances and call Renew() after I have a new connection.
> >  Part of the Renew() logic is to stop the current thread, and part of the
> > normal course of stopping is to attempt to close the channel/model.
>
> You shouldn't close the channel/IModel from within a shutdown callback.
> Also consider performing connection re-establishment rather than channel
> re-establishment/renewal.
>
> -Emile
>
>


-- 
___________________________________________
Derek Greer
dbgreer at gmail.com     | @derekgreer <http://twitter.com/derekgreer>
lostechies.com <http://derekgreer.lostechies.com/> |
freshbrewedcode.com<http://derekgreer.freshbrewedcode.com>
 | aspiringcraftsman.com
___________________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/e83595d1/attachment.htm>

From tcostasouza at gmail.com  Fri Sep 21 15:41:22 2012
From: tcostasouza at gmail.com (Thiago Souza)
Date: Fri, 21 Sep 2012 07:41:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Question about message ttl
Message-ID: <e9538b8c-72b1-4734-a0ec-3c3a534a8ebb@googlegroups.com>

Hi there,

    Does consuming and rejecting a message resets it's TTL counter?

Cheers,
Thiago Souza
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/840315c2/attachment.htm>

From simon at rabbitmq.com  Fri Sep 21 17:43:42 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 21 Sep 2012 17:43:42 +0100
Subject: [rabbitmq-discuss] Question about message ttl
In-Reply-To: <e9538b8c-72b1-4734-a0ec-3c3a534a8ebb@googlegroups.com>
References: <e9538b8c-72b1-4734-a0ec-3c3a534a8ebb@googlegroups.com>
Message-ID: <505C993E.1010401@rabbitmq.com>

On 21/09/12 15:41, Thiago Souza wrote:
> Does consuming and rejecting a message resets it's TTL counter?

Hi.

"The original expiry time of a message is preserved if it is requeued 
(for example due to the use of an AMQP method that features a requeue 
parameter, or due to a channel closure)."

  -- http://www.rabbitmq.com/ttl.html

So no. I think this makes sense, since the message doesn't go back to 
the beginning of the queue either.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tcostasouza at gmail.com  Fri Sep 21 18:01:29 2012
From: tcostasouza at gmail.com (Thiago Souza)
Date: Fri, 21 Sep 2012 14:01:29 -0300
Subject: [rabbitmq-discuss] Question about message ttl
In-Reply-To: <505C993E.1010401@rabbitmq.com>
References: <e9538b8c-72b1-4734-a0ec-3c3a534a8ebb@googlegroups.com>
	<505C993E.1010401@rabbitmq.com>
Message-ID: <CAOsHXW07OG6msOXSigmaYUu1RtE-Ybxk8C8b-fRVHv7NQzPs+A@mail.gmail.com>

Hi,

    This is actually pretty good to my case =D

Thanks!


On Fri, Sep 21, 2012 at 1:43 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 21/09/12 15:41, Thiago Souza wrote:
>
>> Does consuming and rejecting a message resets it's TTL counter?
>>
>
> Hi.
>
> "The original expiry time of a message is preserved if it is requeued (for
> example due to the use of an AMQP method that features a requeue parameter,
> or due to a channel closure)."
>
>  -- http://www.rabbitmq.com/ttl.**html <http://www.rabbitmq.com/ttl.html>
>
> So no. I think this makes sense, since the message doesn't go back to the
> beginning of the queue either.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120921/a0addb80/attachment.htm>

From alex.gadea at apptik.com  Fri Sep 21 20:06:38 2012
From: alex.gadea at apptik.com (Alex Gadea)
Date: Fri, 21 Sep 2012 12:06:38 -0700 (PDT)
Subject: [rabbitmq-discuss] Many vhosts with fewer exchanges per vhost,
 or one vhost with many exchanges?
Message-ID: <c36b7e15-f069-4457-b96c-8d0f7bd002fd@googlegroups.com>


From shane at hathawaymix.org  Fri Sep 21 20:51:53 2012
From: shane at hathawaymix.org (Shane Hathaway)
Date: Fri, 21 Sep 2012 13:51:53 -0600
Subject: [rabbitmq-discuss] Issues with the complexity of building
	RabbitMQ
In-Reply-To: <505C1E88.5040405@rabbitmq.com>
References: <98B0E1F1-711F-4DE8-AD8B-B45DDC37B95D@ekit-inc.com>
	<505C1670.5070904@hathawaymix.org> <505C1E88.5040405@rabbitmq.com>
Message-ID: <505CC559.7050309@hathawaymix.org>

On 09/21/2012 02:00 AM, Matthias Radestock wrote:
> I am curious though, why do you need to build from source in the first
> place. The generic unix downloads should work just fine on Solaris.

Sometimes building from source is actually easier when your tools 
support it.  I'm using http://pypi.python.org/pypi/rod.recipe.rabbitmq .

Shane


From matthias at rabbitmq.com  Sat Sep 22 06:31:05 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 22 Sep 2012 06:31:05 +0100
Subject: [rabbitmq-discuss] Issues with the complexity of building
	RabbitMQ
In-Reply-To: <505CC559.7050309@hathawaymix.org>
References: <98B0E1F1-711F-4DE8-AD8B-B45DDC37B95D@ekit-inc.com>
	<505C1670.5070904@hathawaymix.org> <505C1E88.5040405@rabbitmq.com>
	<505CC559.7050309@hathawaymix.org>
Message-ID: <505D4D19.5060900@rabbitmq.com>

Shane,

On 21/09/12 20:51, Shane Hathaway wrote:
> On 09/21/2012 02:00 AM, Matthias Radestock wrote:
>> I am curious though, why do you need to build from source in the first
>> place. The generic unix downloads should work just fine on Solaris.
>
> Sometimes building from source is actually easier when your tools
> support it.

Easier than running 'tar'?

> I'm using http://pypi.python.org/pypi/rod.recipe.rabbitmq .

Ouch. Why is that building from source rather than taking the 
generic-unix tar?

Btw, what OS are you on?


Regards,

Matthias.

From csheargm at gmail.com  Fri Sep 21 23:54:25 2012
From: csheargm at gmail.com (Chris)
Date: Fri, 21 Sep 2012 15:54:25 -0700 (PDT)
Subject: [rabbitmq-discuss] 30% performance degradation with user access
	controls enabled
Message-ID: <078b46b8-09e5-4b94-a4ab-da2c1414dc29@googlegroups.com>

Based on descriptions on RabbitMQ access control,  
http://www.rabbitmq.com/access-control.html : "RabbitMQ may cache the 
results of access control checks on a per-connection or per-channel basis." 
Based on this statement, rabbitmq access control operations should not 
impose too much load on the server performance. 

But in our test, we have 5000 client connections over SSL, each client is 
set with a configure/write/read permissions like this:

Configure: {client_name}.*|^amq\.gen.*|^amq\.default|^vsm.*          

Write: {client_name}.*|^amq\.gen.*|^amq\.default    

Read: {client_name}.*|^amq\.gen.*|^amq\.default|^vsm.*


One publisher publishes 10 message per second to an exchange, message size 
is 1KB,  each client/consumer creates a queue and bind to this exchange, 
and we have a total of 5000 unique clients with its own queues. 



From matthias at rabbitmq.com  Sat Sep 22 09:55:42 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 22 Sep 2012 09:55:42 +0100
Subject: [rabbitmq-discuss] 30% performance degradation with user access
 controls enabled
In-Reply-To: <078b46b8-09e5-4b94-a4ab-da2c1414dc29@googlegroups.com>
References: <078b46b8-09e5-4b94-a4ab-da2c1414dc29@googlegroups.com>
Message-ID: <505D7D0E.80206@rabbitmq.com>

Chris,

On 21/09/12 23:54, Chris wrote:
> Based on descriptions on RabbitMQ access control,
> http://www.rabbitmq.com/access-control.html : "RabbitMQ may cache the
> results of access control checks on a per-connection or per-channel
> basis." Based on this statement, rabbitmq access control operations
> should not impose too much load on the server performance.
>
> But in our test, we have 5000 client connections over SSL, each client
> is set with a configure/write/read permissions like this:
>
> Configure: {client_name}.*|^amq\.gen.*|^amq\.default|^vsm.*
> Write: {client_name}.*|^amq\.gen.*|^amq\.default
> Read: {client_name}.*|^amq\.gen.*|^amq\.default|^vsm.*
>
> One publisher publishes 10 message per second to an exchange, message
> size is 1KB,  each client/consumer creates a queue and bind to this
> exchange, and we have a total of 5000 unique clients with its own queues.
>
>  From the client side, we can receive about 8000 messages per second.
>
> But if we do not set any user permissions, simply use rabbitmq system
> default guest user, and create 5000 unique connections/queues to the
> server, our client side message rate is 12000 messages per second.
>
>
> My question is: what contributes to the 30% performance degradation?

I suspect there is some difference other than the permissions between 
the two tests. Please send us the output of 'rabbitmqctl report' from 
each test.

Where did you get the rates from? The management UI? If so a screenshot 
of what you are seeing in each case would be good.


Regards,

Matthias.

From simon at rabbitmq.com  Sat Sep 22 11:12:38 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sat, 22 Sep 2012 11:12:38 +0100
Subject: [rabbitmq-discuss] Many vhosts with fewer exchanges per vhost,
 or one vhost with many exchanges?
In-Reply-To: <c36b7e15-f069-4457-b96c-8d0f7bd002fd@googlegroups.com>
References: <c36b7e15-f069-4457-b96c-8d0f7bd002fd@googlegroups.com>
Message-ID: <505D8F16.60203@rabbitmq.com>

On 21/09/2012 8:06PM, Alex Gadea wrote:
>  From a performance and resource viewpoint, is it better to have many
> vhosts (100s) with 1 or 2 exchanges each or have a handful of vhosts
> with 100s of exchanges per vhost.  Or does it not matter?

It doesn't matter. Vhosts only really exist as security contexts, they 
don't have any performance implications.

Cheers, Simon

From shane at hathawaymix.org  Sat Sep 22 23:27:07 2012
From: shane at hathawaymix.org (Shane Hathaway)
Date: Sat, 22 Sep 2012 16:27:07 -0600
Subject: [rabbitmq-discuss] Issues with the complexity of building
	RabbitMQ
In-Reply-To: <505D4D19.5060900@rabbitmq.com>
References: <98B0E1F1-711F-4DE8-AD8B-B45DDC37B95D@ekit-inc.com>
	<505C1670.5070904@hathawaymix.org> <505C1E88.5040405@rabbitmq.com>
	<505CC559.7050309@hathawaymix.org> <505D4D19.5060900@rabbitmq.com>
Message-ID: <505E3B3B.4080102@hathawaymix.org>

On 09/21/2012 11:31 PM, Matthias Radestock wrote:
> Easier than running 'tar'?

Yes.  Using Buildout, RabbitMQ gets built with everything else and I 
don't have to think about it.

>> I'm using http://pypi.python.org/pypi/rod.recipe.rabbitmq .
>
> Ouch. Why is that building from source rather than taking the
> generic-unix tar?

"Ouch?"  No.  The recipe is simple and works.  I suspect the recipe is 
intended to support Windows as well (most Buildout recipes do), but I've 
never tried that.

> Btw, what OS are you on?

Ubuntu.

Shane


From matthias at rabbitmq.com  Sun Sep 23 00:24:54 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 23 Sep 2012 00:24:54 +0100
Subject: [rabbitmq-discuss] Issues with the complexity of building
	RabbitMQ
In-Reply-To: <505E3B3B.4080102@hathawaymix.org>
References: <98B0E1F1-711F-4DE8-AD8B-B45DDC37B95D@ekit-inc.com>
	<505C1670.5070904@hathawaymix.org> <505C1E88.5040405@rabbitmq.com>
	<505CC559.7050309@hathawaymix.org> <505D4D19.5060900@rabbitmq.com>
	<505E3B3B.4080102@hathawaymix.org>
Message-ID: <505E48C6.1080104@rabbitmq.com>

Shane,

On 22/09/12 23:27, Shane Hathaway wrote:
> Using Buildout, RabbitMQ gets built with everything else and I don't
> have to think about it.

Interesting. Can one / do you install Erlang that way too, and does that 
also involve building from source?

>>> I'm using http://pypi.python.org/pypi/rod.recipe.rabbitmq .
>>
>> Ouch. Why is that building from source rather than taking the
>> generic-unix tar?
>
> "Ouch?"  No.  The recipe is simple and works.  I suspect the recipe
> is intended to support Windows as well (most Buildout recipes do),
> but I've never tried that.

The recipe won't work on Windows (cygwin excepted, perhaps).

Even if the intention was to support multiple platforms, grabbing the
appropriate binary packages would still be a better choice than
building from source. That's what, say, the mongodb recipe does. I guess
we should get in touch with the rabbitmq recipe author.


Regards,

Matthias.

From jordannpotter at gmail.com  Sun Sep 23 02:37:28 2012
From: jordannpotter at gmail.com (Jordan)
Date: Sat, 22 Sep 2012 18:37:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Dead Letter and Unknown Field?
Message-ID: <9d3f2e12-b725-41ba-b116-c38f4ba8fd1b@googlegroups.com>

I'm trying to perform rpc on top of rabbitmq.  However, if a rpc request 
sits idle in the queue for 2 seconds, I want the message to be dropped from 
the queue and for the client to throw an error.

To do this, I've been playing around with dead letter exchanges.  However, 
I keep seeing:

/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:350
        throw new Error("Unknown field value type " + 
buffer[buffer.read-1]);
              ^
Error: Unknown field value type 65
    at parseTable 
(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:350:15)
    at parseFields 
(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:410:17)
    at AMQPParser._parseHeaderFrame 
(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:469:20)
    at frameEnd 
(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:190:16)
    at frame (/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:172:14)
    at header 
(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:159:14)
    at frameEnd 
(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:205:16)
    at frame (/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:172:14)
    at AMQPParser.header [as parse] 
(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:159:14)
    at AMQPParser.execute 
(/Users/jordan/agles/web/back/node_modules/amqp/amqp.js:231:21)



Here's my clientTest.coffee:

amqp = require 'amqp'

connection = amqp.createConnection()
connection.on 'ready', () ->
await
connection.exchange 'rpc exchange', type: 'direct', defer exchange
connection.exchange 'dead letter exchange', type: 'fanout', defer 
deadLetterExchange

await
connection.queue '', exclusive: true, defer responseQueue
connection.queue '', exclusive: true, defer deadLetterQueue

deadLetterQueue.bind deadLetterExchange, ''

responseQueue.subscribe (message, headers, deliveryInformation) =>
console.log 'responseQueue received: ' + message.data

deadLetterQueue.subscribe (message, headers, deliveryInformation) =>
console.log 'deadLetterQueue received: ' + message.data

startMakingRandomRequests exchange, responseQueue

startMakingRandomRequests = (exchange, responseQueue) ->
setInterval (()-> makeRandomRequest exchange, responseQueue), 2000

makeRandomRequest = (exchange, responseQueue) ->
message = Math.random().toString()
exchange.publish 'rpc', message,
replyTo: responseQueue.name
console.log 'sent: ' + message


And here's my serverTest.coffee:

amqp = require 'amqp'

connection = amqp.createConnection()
connection.on 'ready', () =>
await
connection.exchange 'rpc exchange', type: 'direct', defer exchange
connection.exchange 'dead letter exchange', type: 'fanout', defer 
deadLetterExchange

queueArguments = 
'x-message-ttl': 0
'x-dead-letter-exchange': 'dead letter exchange'

await 
connection.queue '', arguments: queueArguments, defer queue

queue.bind exchange, 'rpc'

queue.subscribe ack: true, (message, headers, deliveryInformation) ->
console.log 'received: ' + message.data
connection.publish deliveryInformation.replyTo, message.data
console.log 'sent: ' + message.data
# queue.shift()  NOT GOING TO SHIFT SO I CAN TEST DEAD LETTER



Does anyone have any idea what's going on here?  Hopefully I'm making a 
stupid mistake :(

Thanks guys,
Jordan 







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120922/64904ec0/attachment.htm>

From matthias at rabbitmq.com  Sun Sep 23 09:11:44 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 23 Sep 2012 09:11:44 +0100
Subject: [rabbitmq-discuss] Dead Letter and Unknown Field?
In-Reply-To: <9d3f2e12-b725-41ba-b116-c38f4ba8fd1b@googlegroups.com>
References: <9d3f2e12-b725-41ba-b116-c38f4ba8fd1b@googlegroups.com>
Message-ID: <505EC440.1010702@rabbitmq.com>

Jordan,

On 23/09/12 02:37, Jordan wrote:
> I'm trying to perform rpc on top of rabbitmq.  However, if a rpc request
> sits idle in the queue for 2 seconds, I want the message to be dropped
> from the queue and for the client to throw an error.
>
> To do this, I've been playing around with dead letter exchanges.
>   However, I keep seeing:
>
>     /Users/jordan/agles/web/back/node_modules/amqp/amqp.js:350
>              throw new Error("Unknown field value type " +
>     buffer[buffer.read-1]);
>                    ^
>     Error: Unknown field value type 65

Looks like you are running into 
https://github.com/postwait/node-amqp/issues/86, which, afaict, got 
fixed in https://github.com/postwait/node-amqp/pull/105 and merged about 
a month ago (though for some reason the issue wasn't closed). So I 
suggest you grab the latest node-amqp from github.

Regards,

Matthias.

From jordannpotter at gmail.com  Sun Sep 23 09:19:08 2012
From: jordannpotter at gmail.com (Jordan Potter)
Date: Sun, 23 Sep 2012 01:19:08 -0700
Subject: [rabbitmq-discuss] Dead Letter and Unknown Field?
In-Reply-To: <505EC440.1010702@rabbitmq.com>
References: <9d3f2e12-b725-41ba-b116-c38f4ba8fd1b@googlegroups.com>
	<505EC440.1010702@rabbitmq.com>
Message-ID: <CAGnf-jiAsU5QSOvztH5Q-gD8Oc4mGhVfM2L5251tqm7R4Xaujg@mail.gmail.com>

Oh, I've been using npm to install amqp.  Why wouldn't that version be up
to date?...

On Sun, Sep 23, 2012 at 1:11 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Jordan,
>
> On 23/09/12 02:37, Jordan wrote:
>
>> I'm trying to perform rpc on top of rabbitmq.  However, if a rpc request
>> sits idle in the queue for 2 seconds, I want the message to be dropped
>> from the queue and for the client to throw an error.
>>
>> To do this, I've been playing around with dead letter exchanges.
>>   However, I keep seeing:
>>
>>     /Users/jordan/agles/web/back/**node_modules/amqp/amqp.js:350
>>              throw new Error("Unknown field value type " +
>>     buffer[buffer.read-1]);
>>                    ^
>>     Error: Unknown field value type 65
>>
>
> Looks like you are running into https://github.com/postwait/**
> node-amqp/issues/86 <https://github.com/postwait/node-amqp/issues/86>,
> which, afaict, got fixed in https://github.com/postwait/**
> node-amqp/pull/105 <https://github.com/postwait/node-amqp/pull/105> and
> merged about a month ago (though for some reason the issue wasn't closed).
> So I suggest you grab the latest node-amqp from github.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120923/1eab1b1a/attachment.htm>

From matthias at rabbitmq.com  Sun Sep 23 09:26:46 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 23 Sep 2012 09:26:46 +0100
Subject: [rabbitmq-discuss] Dead Letter and Unknown Field?
In-Reply-To: <CAGnf-jiAsU5QSOvztH5Q-gD8Oc4mGhVfM2L5251tqm7R4Xaujg@mail.gmail.com>
References: <9d3f2e12-b725-41ba-b116-c38f4ba8fd1b@googlegroups.com>
	<505EC440.1010702@rabbitmq.com>
	<CAGnf-jiAsU5QSOvztH5Q-gD8Oc4mGhVfM2L5251tqm7R4Xaujg@mail.gmail.com>
Message-ID: <505EC7C6.70208@rabbitmq.com>

On 23/09/12 09:19, Jordan Potter wrote:
> Oh, I've been using npm to install amqp.  Why wouldn't that version be
> up to date?...

The version in the npm package registry was last updated five months ago 
- see https://npmjs.org/package/amqp.

Simply point npm at the github version.

Matthias.

From saurabhsharma218 at gmail.com  Sun Sep 23 09:03:28 2012
From: saurabhsharma218 at gmail.com (sharma)
Date: Sun, 23 Sep 2012 01:03:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Modifying requeued Message header
Message-ID: <f431ef67-5176-44ce-a0a7-aae1bb04f05b@googlegroups.com>

Hi ,
Before putting in dead-letter queue , i want to process my message a 
certain no of times lets say 3 , so for this how can i change the message 
header , so when i received that letter to process again , i can easily 
figure out , how may times this message is replayed , so that i can put 
this message into dead-letter.

Or is there another way to do this , apart from changing message header.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120923/746ecb4a/attachment.htm>

From jordannpotter at gmail.com  Sun Sep 23 09:32:00 2012
From: jordannpotter at gmail.com (Jordan Potter)
Date: Sun, 23 Sep 2012 01:32:00 -0700
Subject: [rabbitmq-discuss] Dead Letter and Unknown Field?
In-Reply-To: <505EC7C6.70208@rabbitmq.com>
References: <9d3f2e12-b725-41ba-b116-c38f4ba8fd1b@googlegroups.com>
	<505EC440.1010702@rabbitmq.com>
	<CAGnf-jiAsU5QSOvztH5Q-gD8Oc4mGhVfM2L5251tqm7R4Xaujg@mail.gmail.com>
	<505EC7C6.70208@rabbitmq.com>
Message-ID: <CAGnf-jgJ=PHyry-_dDHTm9FkSKYV4rd4evpwFbaESxyt7z7wfA@mail.gmail.com>

Oh, dayum.  Thanks so much!!

On Sun, Sep 23, 2012 at 1:26 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 23/09/12 09:19, Jordan Potter wrote:
>
>> Oh, I've been using npm to install amqp.  Why wouldn't that version be
>> up to date?...
>>
>
> The version in the npm package registry was last updated five months ago -
> see https://npmjs.org/package/amqp**.
>
> Simply point npm at the github version.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120923/2f9bc221/attachment.htm>

From shane at hathawaymix.org  Sun Sep 23 10:39:32 2012
From: shane at hathawaymix.org (Shane Hathaway)
Date: Sun, 23 Sep 2012 03:39:32 -0600
Subject: [rabbitmq-discuss] Issues with the complexity of building
	RabbitMQ
In-Reply-To: <505E48C6.1080104@rabbitmq.com>
References: <98B0E1F1-711F-4DE8-AD8B-B45DDC37B95D@ekit-inc.com>
	<505C1670.5070904@hathawaymix.org> <505C1E88.5040405@rabbitmq.com>
	<505CC559.7050309@hathawaymix.org> <505D4D19.5060900@rabbitmq.com>
	<505E3B3B.4080102@hathawaymix.org> <505E48C6.1080104@rabbitmq.com>
Message-ID: <505ED8D4.6020001@hathawaymix.org>

On 09/22/2012 05:24 PM, Matthias Radestock wrote:
> Shane,
>
> On 22/09/12 23:27, Shane Hathaway wrote:
>> Using Buildout, RabbitMQ gets built with everything else and I don't
>> have to think about it.
>
> Interesting. Can one / do you install Erlang that way too, and does that
> also involve building from source?

It probably could be done, but I don't install Erlang from source 
because the system package is sufficient.

Shane


From Dhinesh.P at saint-gobain.com  Mon Sep 24 07:13:36 2012
From: Dhinesh.P at saint-gobain.com (Dhinesh, P [ Maples - IT ])
Date: Mon, 24 Sep 2012 11:43:36 +0530
Subject: [rabbitmq-discuss] Re : XML, txt and image file data transfer..
Message-ID: <00946F8B780BAB43A04111EEAA7B47F603B1E244@L00EXCEC1.zl.if.atcsg.net>

Dear Friends,

 

Can anyone help to us for below requirements..

 

?  We need to send the XML or txt file data transfer via RabbitMQ 2.8.4 using python 2.7 from producer to consumer.

 

Currently we are using the method for the text file, where the text file contents are read by using this function |f = open('D:\\test\\test.txt', "r")

   text = f.read()

   str=text

   message =str

channel.basic_publish(exchange='testing_room',routing_key='file',body=message)               

                                                                                                                                                                                                                                print " Sent "|                                                                    

in python and send it to the Queue and the same data has been received by the consumer and created as a file.

 

1.Requesting you guidance is there any other method to transfer the TXT File 

 

                We tried the similar process for XML files, but when we receive the content "/n" (New Line)  in consumer, below given the which we have received message.

                

                '<?xml version="1.0" encoding="UTF-8" ?>   \n<ZACGPGRDOC>  \n<IDOC BEGIN="1">\n<ZACGPGRHEADER SEGMENT="1">\n  <MAT_DOC>10000106</MAT_DOC>      \n  <MAT_YEAR>2012</MAT_YEAR> \n  <POST_DATE>17.05.2012</POST_DATE> \n  <LISEC_PO>260000760</LISEC_PO> \n  <STATUS>Original</STATUS> \n<ZACGPGRITEM SEGMENT="1">\n  <ITEMNO>00001</ITEMNO> \n  <CURR>INR</CURR> \n  </ZACGPGRITEM>\n</ZACGPGRHEADER>\n</IDOC>\n</ZACGPGRDOC>'

 

                Here below given the screen shot also FYR..

 

 

 

2.Requesting your guidance and solution

 

3.Need to open the xml or txt file and ready the content.

 

4.Send that content as message from producer to consumer, which data is in the xml or txt file.

 

5.Is it possible to install python 2.7 into AIX 6.1 server. if it is possible, kindly share it.

 

6.is there any way to possible to send the small image files from producer to consumer.

 

 

Thanks in advance,

 

Dhinesh P

Server support (SGGI-IT)

Mobile No :-  +91-9787447156

Land line :- 044-27160262

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/81cccc34/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 54154 bytes
Desc: image002.jpg
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/81cccc34/attachment.jpeg>

From a.shneyderman at gmail.com  Mon Sep 24 08:41:28 2012
From: a.shneyderman at gmail.com (Alex Shneyderman)
Date: Mon, 24 Sep 2012 09:41:28 +0200
Subject: [rabbitmq-discuss] HA-aware clients?
Message-ID: <CA+smePKkfo29ppxhhKFUeJkMo5S0YUWJ8F5aQzL_AkKeZij7TQ@mail.gmail.com>

Hi all!


There is something I do not really understand about how client is
taking advantage of the HA features of RabbitMQ. So, I setup two
servers. And I have a queue that is mirrored. My client connects to
one server. (I can give it an array of addresses but the documentation
says it will connect to the first server that is not down). So say I
have that client talking to server1 for a while. Server1 goes down, is
there a way for the client to re-establish connection to server2 while
server1 is being fixed up? I mean I am pretty sure client can I am
just not sure if this is the logic that is already implemented on the
client that is provided by rabbit (Java in my case, but I would also
be interested to know if erlang client works automagically) or is this
something I have to do on my own (I guess I could listen to shutdown
event and reconnect manually)?

Cheers,
Alex.

From tim at rabbitmq.com  Mon Sep 24 09:55:37 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 24 Sep 2012 09:55:37 +0100
Subject: [rabbitmq-discuss] Re : XML, txt and image file data transfer..
In-Reply-To: <00946F8B780BAB43A04111EEAA7B47F603B1E244@L00EXCEC1.zl.if.atcsg.net>
References: <00946F8B780BAB43A04111EEAA7B47F603B1E244@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <50602009.2040700@rabbitmq.com>

Dhinesh,

On 09/24/2012 07:13 AM, Dhinesh, P [ Maples - IT ] wrote:
>
> 1.Requesting you guidance is there any other method to transfer the 
> TXT File
>

No, there is no kind of 'attachments' API in AMQP like the one in soap. 
If you want to 'know' something about the content in the consumer then 
you can set headers in the message yourself and handle these explicitly, 
dealing with stuff like content-type, encoding, mime-type, etc. It's all 
under your control, as the body and headers are treated as opaque by the 
broker.

>                 We tried the similar process for XML files, but when 
> we receive the content "/n" (New Line)  in consumer, below given the 
> which we have received message.
>
> '<?xml version="1.0" encoding="UTF-8" ?> \n<ZACGPGRDOC>  \n<IDOC 
> BEGIN="1">\n<ZACGPGRHEADER SEGMENT="1">\n <MAT_DOC>10000106</MAT_DOC> 
> \n <MAT_YEAR>2012</MAT_YEAR>\n <POST_DATE>17.05.2012</POST_DATE>\n 
> <LISEC_PO>260000760</LISEC_PO> \n 
> <STATUS>Original</STATUS>\n<ZACGPGRITEM SEGMENT="1">\n 
> <ITEMNO>00001</ITEMNO> \n <CURR>INR</CURR> \n 
> </ZACGPGRITEM>\n</ZACGPGRHEADER>\n</IDOC>\n</ZACGPGRDOC>'
>

This looks absolutely fine. The python shell prints newlines escaped 
like this, but if you shove the text into a file then it'll look the way 
you expect.

>                 Here below given the screen shot also FYR..
>
> 2.Requesting your guidance and solution
>

To which problem?

> 3.Need to open the xml or txt file and ready the content.
>

You're have already opened the file and ready [sic] the content right?

> 4.Send that content as message from producer to consumer, which data 
> is in the xml or txt file.
>

You said you've already done this?

> 5.Is it possible to install python 2.7 into AIX 6.1 server. if it is 
> possible, kindly share it.
>

Try asking on the python mailing lists?

> 6.is there any way to possible to send the small image files from 
> producer to consumer.
>

Yes. Do exactly the same thing as for text and xml - as I mentioned 
above, the content of the message is opaque to the broker.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/25272f9b/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 54154 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/25272f9b/attachment.jpeg>

From tim at rabbitmq.com  Mon Sep 24 09:57:39 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 24 Sep 2012 09:57:39 +0100
Subject: [rabbitmq-discuss] HA-aware clients?
In-Reply-To: <CA+smePKkfo29ppxhhKFUeJkMo5S0YUWJ8F5aQzL_AkKeZij7TQ@mail.gmail.com>
References: <CA+smePKkfo29ppxhhKFUeJkMo5S0YUWJ8F5aQzL_AkKeZij7TQ@mail.gmail.com>
Message-ID: <50602083.2050408@rabbitmq.com>

Hi Alex,

You'll need to handle reconnecting explicitly in the client(s) yourself. 
What HA does is ensure that any time you connect to a node on which a 
queue is mirrored, you get a consistent view of the queue and obviously 
it deals with failover when a node dies.

HTH

Tim

On 09/24/2012 08:41 AM, Alex Shneyderman wrote:
> Hi all!
>
>
> There is something I do not really understand about how client is
> taking advantage of the HA features of RabbitMQ. So, I setup two
> servers. And I have a queue that is mirrored. My client connects to
> one server. (I can give it an array of addresses but the documentation
> says it will connect to the first server that is not down). So say I
> have that client talking to server1 for a while. Server1 goes down, is
> there a way for the client to re-establish connection to server2 while
> server1 is being fixed up? I mean I am pretty sure client can I am
> just not sure if this is the logic that is already implemented on the
> client that is provided by rabbit (Java in my case, but I would also
> be interested to know if erlang client works automagically) or is this
> something I have to do on my own (I guess I could listen to shutdown
> event and reconnect manually)?
>
> Cheers,
> Alex.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias.reik at gmail.com  Mon Sep 24 10:20:23 2012
From: matthias.reik at gmail.com (Matthias Reik)
Date: Mon, 24 Sep 2012 11:20:23 +0200
Subject: [rabbitmq-discuss] HA-aware clients?
In-Reply-To: <50602083.2050408@rabbitmq.com>
References: <CA+smePKkfo29ppxhhKFUeJkMo5S0YUWJ8F5aQzL_AkKeZij7TQ@mail.gmail.com>
	<50602083.2050408@rabbitmq.com>
Message-ID: <CAJ1JW0fgjFaXQZaV7j76E63EuMFv-kVGoq9940=8-hO9AwgkXA@mail.gmail.com>

If you are using Spring, the latest version (1.1.1 IIRC) is allowing you to
specify several servers, and it will handle the reconnect should one of the
connections go down. We are using this in our production env and it works
very nicely.

Cheers
Maze


On Mon, Sep 24, 2012 at 10:57 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Alex,
>
> You'll need to handle reconnecting explicitly in the client(s) yourself.
> What HA does is ensure that any time you connect to a node on which a queue
> is mirrored, you get a consistent view of the queue and obviously it deals
> with failover when a node dies.
>
> HTH
>
> Tim
>
>
> On 09/24/2012 08:41 AM, Alex Shneyderman wrote:
>
>> Hi all!
>>
>>
>> There is something I do not really understand about how client is
>> taking advantage of the HA features of RabbitMQ. So, I setup two
>> servers. And I have a queue that is mirrored. My client connects to
>> one server. (I can give it an array of addresses but the documentation
>> says it will connect to the first server that is not down). So say I
>> have that client talking to server1 for a while. Server1 goes down, is
>> there a way for the client to re-establish connection to server2 while
>> server1 is being fixed up? I mean I am pretty sure client can I am
>> just not sure if this is the logic that is already implemented on the
>> client that is provided by rabbit (Java in my case, but I would also
>> be interested to know if erlang client works automagically) or is this
>> something I have to do on my own (I guess I could listen to shutdown
>> event and reconnect manually)?
>>
>> Cheers,
>> Alex.
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/762c7eb5/attachment.htm>

From emile at rabbitmq.com  Mon Sep 24 10:35:08 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 24 Sep 2012 10:35:08 +0100
Subject: [rabbitmq-discuss] Modifying requeued Message header
In-Reply-To: <f431ef67-5176-44ce-a0a7-aae1bb04f05b@googlegroups.com>
References: <f431ef67-5176-44ce-a0a7-aae1bb04f05b@googlegroups.com>
Message-ID: <5060294C.10701@rabbitmq.com>

Hi,

On 23/09/12 09:03, sharma wrote:
> Or is there another way to do this , apart from changing message header.

You cannot make arbitrary changes to a message header after publishing,
but you can emulate the effect of this by consuming and republishing a
copy of the message with different headers.

If you have a workflow with 3 steps then one option is to set up a
pipeline with 3 queues where each processor receives the message and
publishes it on to the next step.

---

As an aside, you can detect whether a message has been previously
delivered and requeued by inspecting the "redelivered" flag:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.deliver.redelivered
This is a boolean field, so you can't use this to distinguish between
different numbers of redeliveries greater than one.

Another possibly relevant feature is that dead-lettered message retain a
record of time and reason (among other fields) each time that
dead-lettering takes place. See the documentation at
http://www.rabbitmq.com/dlx.html



-Emile


From emile at rabbitmq.com  Mon Sep 24 11:03:07 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 24 Sep 2012 11:03:07 +0100
Subject: [rabbitmq-discuss] Fwd: .Net RabbitMQ.Client Issue: Deadlock on
 ConnectionShutdown
In-Reply-To: <CAAzMECnYZByaUQUCAguhOnOu=JAAKoKZxq-zGfsj-zGFj2owTg@mail.gmail.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
	<503367A3.5060107@rabbitmq.com>
	<CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>
	<50339D74.9080305@rabbitmq.com>
	<CAAzMECnZXCsFFurezzxeLNkagz+f9-_onNq1KX2Nd7eG5Zpc5Q@mail.gmail.com>
	<5033B390.3060105@rabbitmq.com>
	<CAAzMECn9zeFrj-hT2V1jt1SKythiWX4CiuUyZ6Htd=x8Up6NFw@mail.gmail.com>
	<CAAzMECn4efkgJoLV-8DLmenSJJsvQ14tonjRNag9NCWeznM6-A@mail.gmail.com>
	<505C78DA.8030806@rabbitmq.com>
	<CAAzMECnYZByaUQUCAguhOnOu=JAAKoKZxq-zGfsj-zGFj2owTg@mail.gmail.com>
Message-ID: <50602FDB.3020809@rabbitmq.com>

On 21/09/12 15:48, Derek Greer wrote:
> As far as considering connection renewal rather than channel renewal, I
> don't understand how this would be possible. You yourself said:

I propose that you look at the problem from another perspective. If a
connection crashes then forget about that connection and all the
channels contained in it. The library will clean them up. Return to the
point of control where the connection was established and reconnect and
re-establish brand new AMQP subscriptions.

> Again, the problem I'm trying to address is to model a Subscription
> which can be cancelled on demand (i.e. the user wants to maintain the
> connection, but wants to unsubscribe from receiving a given message
> type), and which can be renewed when a new connection is obtained.

We are using the word "subscription" for at least two different things:
AMQP subscriptions (which cannot be renewed)
The view that your user sees (and cope with reconnections transparently)

Cancelling an AMQP subscription is simple, because there is an explicit
method for it. "Renewing" an AMQP subscription is not possible. Creating
the illusion of renewable subscriptions is design problem that the
RabbitMQ client library does not address.

>  Using the IModel.ModelShutdown event here isn't what someone would want
> to do from a design perspective, as there are things I want to do on
> connection shutdown that I don't want to do on every model shutdown.  It
> just simply isn't the right event for the case at hand.  I also can't
> just not call IModel.Close() in all cases.
> 
> Bottom line, I see a design flaw here that needs to be recognized and
> addressed.  

The absence if renewable subscriptions may well be considered a flaw.
Instead of trying to be all things to all people, the library instead
offers the building blocks to build solutions that can hopefully suit
every user. Signalling connection and channel lifetime events is an
important component building block.

> Speaking of which, this mailing list is a horrible way to deal with
> product specific bug reports.  Why doesn't your team use github or
> some other facility which has a proper bug tracking system?

We thank you for your feedback and will take it into consideration in
any future decision about this matter.



-Emile



From bra at fsn.hu  Mon Sep 24 12:30:10 2012
From: bra at fsn.hu (Attila Nagy)
Date: Mon, 24 Sep 2012 13:30:10 +0200
Subject: [rabbitmq-discuss] Headers exchange with rabbitmq-c?
Message-ID: <50604442.8050507@fsn.hu>

Hi,

I would like to use headers exchange with rabbitmq-c, but I couldn't yet 
find out how could I specify custom headers for a message.
Could somebody help me out (and the others who asked this on the net) 
with an example?

Thanks,

From alexis at rabbitmq.com  Mon Sep 24 12:50:28 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 24 Sep 2012 12:50:28 +0100
Subject: [rabbitmq-discuss] HA-aware clients?
In-Reply-To: <CAJ1JW0fgjFaXQZaV7j76E63EuMFv-kVGoq9940=8-hO9AwgkXA@mail.gmail.com>
References: <CA+smePKkfo29ppxhhKFUeJkMo5S0YUWJ8F5aQzL_AkKeZij7TQ@mail.gmail.com>
	<50602083.2050408@rabbitmq.com>
	<CAJ1JW0fgjFaXQZaV7j76E63EuMFv-kVGoq9940=8-hO9AwgkXA@mail.gmail.com>
Message-ID: <CACOPnvc0Thxmwt0JgO4Go4t0KPdOO86MV_0Rv2n8FiTVHaSZhg@mail.gmail.com>

It's 1.1.2 but: yes.


On Mon, Sep 24, 2012 at 10:20 AM, Matthias Reik <matthias.reik at gmail.com> wrote:
> If you are using Spring, the latest version (1.1.1 IIRC) is allowing you to
> specify several servers, and it will handle the reconnect should one of the
> connections go down. We are using this in our production env and it works
> very nicely.
>
> Cheers
> Maze
>
>
>
> On Mon, Sep 24, 2012 at 10:57 AM, Tim Watson <tim at rabbitmq.com> wrote:
>>
>> Hi Alex,
>>
>> You'll need to handle reconnecting explicitly in the client(s) yourself.
>> What HA does is ensure that any time you connect to a node on which a queue
>> is mirrored, you get a consistent view of the queue and obviously it deals
>> with failover when a node dies.
>>
>> HTH
>>
>> Tim
>>
>>
>> On 09/24/2012 08:41 AM, Alex Shneyderman wrote:
>>>
>>> Hi all!
>>>
>>>
>>> There is something I do not really understand about how client is
>>> taking advantage of the HA features of RabbitMQ. So, I setup two
>>> servers. And I have a queue that is mirrored. My client connects to
>>> one server. (I can give it an array of addresses but the documentation
>>> says it will connect to the first server that is not down). So say I
>>> have that client talking to server1 for a while. Server1 goes down, is
>>> there a way for the client to re-establish connection to server2 while
>>> server1 is being fixed up? I mean I am pretty sure client can I am
>>> just not sure if this is the logic that is already implemented on the
>>> client that is provided by rabbit (Java in my case, but I would also
>>> be interested to know if erlang client works automagically) or is this
>>> something I have to do on my own (I guess I could listen to shutdown
>>> event and reconnect manually)?
>>>
>>> Cheers,
>>> Alex.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jon.bergli.heier at zisson.no  Mon Sep 24 13:17:24 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Mon, 24 Sep 2012 12:17:24 +0000
Subject: [rabbitmq-discuss] Startup problems after network issues
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6BBC@osl02-exc-001>

Hello.

During the weekend we had some minor network issues, after which one of the cluster nodes crashed and won't start up again.
On the management interface of the remaining node I'm seeing the following message:
"Statistics database could not be contacted. Message rates and queue lengths will not be shown."
I've attached some logs from the failing node I think should be relevant.
Any clues as to why the node fails, and what can I do to bring it up again?
I haven't tried rebooting the VM yet, in case there's anything else I could test or more information I could fetch.

Jon
-------------- next part --------------
A non-text attachment was scrubbed...
Name: st-rmq-001.log.gz
Type: application/x-gzip
Size: 79080 bytes
Desc: st-rmq-001.log.gz
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/0c2a0b2d/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: st-rmq-001-sasl.log.gz
Type: application/x-gzip
Size: 7979 bytes
Desc: st-rmq-001-sasl.log.gz
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/0c2a0b2d/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: st-rmq-001-startup_log
Type: application/octet-stream
Size: 3803 bytes
Desc: st-rmq-001-startup_log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/0c2a0b2d/attachment.obj>

From bra at fsn.hu  Mon Sep 24 13:22:15 2012
From: bra at fsn.hu (Attila Nagy)
Date: Mon, 24 Sep 2012 14:22:15 +0200
Subject: [rabbitmq-discuss] Headers exchange with rabbitmq-c?
In-Reply-To: <50604442.8050507@fsn.hu>
References: <50604442.8050507@fsn.hu>
Message-ID: <50605077.5010504@fsn.hu>

So far I have tried this, without success:

     amqp_table_entry_t entries[1];
     amqp_table_t table;

     entries[0].key = amqp_cstring_bytes("test");
     entries[0].value.kind = AMQP_FIELD_KIND_UTF8;
     entries[0].value.value.bytes = amqp_cstring_bytes("test");

     table.num_entries = 1;
     table.entries = entries;
     qsort(table.entries, table.num_entries, sizeof(amqp_table_entry_t), 
&amqp_table_entry_cmp);

     amqp_basic_properties_t props;
     props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG | 
AMQP_BASIC_DELIVERY_MODE_FLAG;
     props.content_type = amqp_cstring_bytes("text/plain");
     props.delivery_mode = 2; /* persistent delivery mode */
     props.headers = table;
     amqp_basic_publish(
             self->conn,
             1,
             amqp_cstring_bytes("test"),
             amqp_cstring_bytes(""),
             0,
             0,
             &props,
             amqp_cstring_bytes("test"));

On 09/24/12 13:30, Attila Nagy wrote:
> Hi,
>
> I would like to use headers exchange with rabbitmq-c, but I couldn't 
> yet find out how could I specify custom headers for a message.
> Could somebody help me out (and the others who asked this on the net) 
> with an example?
>
> Thanks,


From bra at fsn.hu  Mon Sep 24 13:31:56 2012
From: bra at fsn.hu (Attila Nagy)
Date: Mon, 24 Sep 2012 14:31:56 +0200
Subject: [rabbitmq-discuss] Headers exchange with rabbitmq-c?
In-Reply-To: <50605077.5010504@fsn.hu>
References: <50604442.8050507@fsn.hu> <50605077.5010504@fsn.hu>
Message-ID: <506052BC.3010208@fsn.hu>

Wow, this mailing list is wonderful, somehow it planted the solution 
into my mind. :)

Here is the example -I missed the AMQP_BASIC_HEADERS_FLAG.

     amqp_table_entry_t entries[1];
     amqp_table_t table;

     entries[0].key = amqp_cstring_bytes("test");
     entries[0].value.kind = AMQP_FIELD_KIND_UTF8;
     entries[0].value.value.bytes = amqp_cstring_bytes("test");

     table.num_entries = 1;
     table.entries = entries;
     qsort(table.entries, table.num_entries, sizeof(amqp_table_entry_t), 
&amqp_table_entry_cmp);

     amqp_basic_properties_t props;
     props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG | 
AMQP_BASIC_DELIVERY_MODE_FLAG | AMQP_BASIC_HEADERS_FLAG;
     props.content_type = amqp_cstring_bytes("text/plain");
     props.delivery_mode = 2; /* persistent delivery mode */
     props.headers = table;
     amqp_basic_publish(
             self->conn,
             1,
             amqp_cstring_bytes("test"),
             amqp_cstring_bytes(""),
             0,
             0,
             &props,
             amqp_cstring_bytes("test"));

On 09/24/12 14:22, Attila Nagy wrote:
> So far I have tried this, without success:
>
>     amqp_table_entry_t entries[1];
>     amqp_table_t table;
>
>     entries[0].key = amqp_cstring_bytes("test");
>     entries[0].value.kind = AMQP_FIELD_KIND_UTF8;
>     entries[0].value.value.bytes = amqp_cstring_bytes("test");
>
>     table.num_entries = 1;
>     table.entries = entries;
>     qsort(table.entries, table.num_entries, 
> sizeof(amqp_table_entry_t), &amqp_table_entry_cmp);
>
>     amqp_basic_properties_t props;
>     props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG | 
> AMQP_BASIC_DELIVERY_MODE_FLAG;
>     props.content_type = amqp_cstring_bytes("text/plain");
>     props.delivery_mode = 2; /* persistent delivery mode */
>     props.headers = table;
>     amqp_basic_publish(
>             self->conn,
>             1,
>             amqp_cstring_bytes("test"),
>             amqp_cstring_bytes(""),
>             0,
>             0,
>             &props,
>             amqp_cstring_bytes("test"));
>
> On 09/24/12 13:30, Attila Nagy wrote:
>> Hi,
>>
>> I would like to use headers exchange with rabbitmq-c, but I couldn't 
>> yet find out how could I specify custom headers for a message.
>> Could somebody help me out (and the others who asked this on the net) 
>> with an example?
>>
>> Thanks,
>


From dbgreer at gmail.com  Mon Sep 24 15:19:50 2012
From: dbgreer at gmail.com (Derek Greer)
Date: Mon, 24 Sep 2012 09:19:50 -0500
Subject: [rabbitmq-discuss] Fwd: .Net RabbitMQ.Client Issue: Deadlock on
	ConnectionShutdown
In-Reply-To: <CAAzMECkhKwO+jEeOHsfuJLJL5N88O9=UwwKyKNQauDVf1ZyMYw@mail.gmail.com>
References: <6c426e89-1311-44c7-9668-7d435706fb85@googlegroups.com>
	<503367A3.5060107@rabbitmq.com>
	<CAAzMECkDMm0crNEX979+AvpbP0oJHM6BygNbUHpdfRGT2-ET1w@mail.gmail.com>
	<50339D74.9080305@rabbitmq.com>
	<CAAzMECnZXCsFFurezzxeLNkagz+f9-_onNq1KX2Nd7eG5Zpc5Q@mail.gmail.com>
	<5033B390.3060105@rabbitmq.com>
	<CAAzMECn9zeFrj-hT2V1jt1SKythiWX4CiuUyZ6Htd=x8Up6NFw@mail.gmail.com>
	<CAAzMECn4efkgJoLV-8DLmenSJJsvQ14tonjRNag9NCWeznM6-A@mail.gmail.com>
	<505C78DA.8030806@rabbitmq.com>
	<CAAzMECnYZByaUQUCAguhOnOu=JAAKoKZxq-zGfsj-zGFj2owTg@mail.gmail.com>
	<50602FDB.3020809@rabbitmq.com>
	<CAAzMECkhKwO+jEeOHsfuJLJL5N88O9=UwwKyKNQauDVf1ZyMYw@mail.gmail.com>
Message-ID: <CAAzMECnsCj1CKWZ_LBYQFvHsrb3Ed+B07tS=_gpixL3mrDQtrg@mail.gmail.com>

>
> I propose that you look at the problem from another perspective. If a
> connection crashes then forget about that connection and all the
> channels contained in it. The library will clean them up. Return to the
> point of control where the connection was established and reconnect and
> re-establish brand new AMQP subscriptions.
>
>
I appreciate the suggestion and will give this some thought.


>
> The absence if renewable subscriptions may well be considered a flaw.
> Instead of trying to be all things to all people, the library instead
> offers the building blocks to build solutions that can hopefully suit
> every user. Signalling connection and channel lifetime events is an
> important component building block.
>
>
I'm not suggesting that the RabbitMQ client library provide renewable
subscriptions, but only that the building blocks provided not preclude
higher-level concepts such as this from being created by others.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/dae30e4d/attachment.htm>

From alexis at rabbitmq.com  Mon Sep 24 15:32:32 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 24 Sep 2012 15:32:32 +0100
Subject: [rabbitmq-discuss] Headers exchange with rabbitmq-c?
In-Reply-To: <506052BC.3010208@fsn.hu>
References: <50604442.8050507@fsn.hu> <50605077.5010504@fsn.hu>
	<506052BC.3010208@fsn.hu>
Message-ID: <CACOPnvc9QyHbWJT5JSz-C7-tt7jQMRLJH3i=se0H+0GXVJJC=g@mail.gmail.com>

On Mon, Sep 24, 2012 at 1:31 PM, Attila Nagy <bra at fsn.hu> wrote:
> Wow, this mailing list is wonderful, somehow it planted the solution into my
> mind. :)

:-)




> Here is the example -I missed the AMQP_BASIC_HEADERS_FLAG.
>
>
>     amqp_table_entry_t entries[1];
>     amqp_table_t table;
>
>     entries[0].key = amqp_cstring_bytes("test");
>     entries[0].value.kind = AMQP_FIELD_KIND_UTF8;
>     entries[0].value.value.bytes = amqp_cstring_bytes("test");
>
>     table.num_entries = 1;
>     table.entries = entries;
>     qsort(table.entries, table.num_entries, sizeof(amqp_table_entry_t),
> &amqp_table_entry_cmp);
>
>     amqp_basic_properties_t props;
>     props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG |
> AMQP_BASIC_DELIVERY_MODE_FLAG | AMQP_BASIC_HEADERS_FLAG;
>
>     props.content_type = amqp_cstring_bytes("text/plain");
>     props.delivery_mode = 2; /* persistent delivery mode */
>     props.headers = table;
>     amqp_basic_publish(
>             self->conn,
>             1,
>             amqp_cstring_bytes("test"),
>             amqp_cstring_bytes(""),
>             0,
>             0,
>             &props,
>             amqp_cstring_bytes("test"));
>
> On 09/24/12 14:22, Attila Nagy wrote:
>>
>> So far I have tried this, without success:
>>
>>     amqp_table_entry_t entries[1];
>>     amqp_table_t table;
>>
>>     entries[0].key = amqp_cstring_bytes("test");
>>     entries[0].value.kind = AMQP_FIELD_KIND_UTF8;
>>     entries[0].value.value.bytes = amqp_cstring_bytes("test");
>>
>>     table.num_entries = 1;
>>     table.entries = entries;
>>     qsort(table.entries, table.num_entries, sizeof(amqp_table_entry_t),
>> &amqp_table_entry_cmp);
>>
>>     amqp_basic_properties_t props;
>>     props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG |
>> AMQP_BASIC_DELIVERY_MODE_FLAG;
>>     props.content_type = amqp_cstring_bytes("text/plain");
>>     props.delivery_mode = 2; /* persistent delivery mode */
>>     props.headers = table;
>>     amqp_basic_publish(
>>             self->conn,
>>             1,
>>             amqp_cstring_bytes("test"),
>>             amqp_cstring_bytes(""),
>>             0,
>>             0,
>>             &props,
>>             amqp_cstring_bytes("test"));
>>
>> On 09/24/12 13:30, Attila Nagy wrote:
>>>
>>> Hi,
>>>
>>> I would like to use headers exchange with rabbitmq-c, but I couldn't yet
>>> find out how could I specify custom headers for a message.
>>> Could somebody help me out (and the others who asked this on the net)
>>> with an example?
>>>
>>> Thanks,
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tiago.alves at muzzley.com  Mon Sep 24 15:14:11 2012
From: tiago.alves at muzzley.com (Tiago Alves)
Date: Mon, 24 Sep 2012 07:14:11 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ STOMP Adapter - How to get the RPC
	reply messages?
Message-ID: <cd91aecb-ce3c-4355-b02a-119fdf7c579f@googlegroups.com>

Hi,

I'm trying to perform an RPC with RabbitMQ's STOMP adapter. As the client 
lib I'm using the STOMP over WebSocket (
https://github.com/jmesnil/stomp-websocket/) library.


From zanfranceschi at gmail.com  Mon Sep 24 20:56:27 2012
From: zanfranceschi at gmail.com (Francisco Aguiar Zanfranceschi)
Date: Mon, 24 Sep 2012 12:56:27 -0700 (PDT)
Subject: [rabbitmq-discuss] Pub/Sub Guaranteed Delivery
Message-ID: <51e7c978-6638-488c-92bc-20e951a247d1@googlegroups.com>

Hi all. I'm new here and to RabbitMQ.

I'm hoping if someone can advise me with an idea i'm having to guarantee 
messages delivery to all subscribers in a pub/sub scenario.

The out of the box pub/sub technique in Rabbit doesn't delivery messages to 
down/offline subscribers. This way, I have been thinking of having a sort 
of subscribers manager that would create queues for each one -- no fanout. 
I guess the attached diagram describes better what I'm thinking. I know 
there's the price of a higher coupling, but I think it's still simple.

Another point: I don't want to use other frameworks by now (NServiceBus, 
Twisted, MassTransit, etc) as my current scenario is really heterogeneous. 

Any advice, suggestion, or real cases will be really appreciated.

Thanks in advance.

Francisco Zanfranceschi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/dd601949/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQ PubSub.png
Type: image/png
Size: 20244 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/dd601949/attachment.png>

From alexis at rabbitmq.com  Mon Sep 24 23:18:45 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 24 Sep 2012 23:18:45 +0100
Subject: [rabbitmq-discuss] Pub/Sub Guaranteed Delivery
In-Reply-To: <51e7c978-6638-488c-92bc-20e951a247d1@googlegroups.com>
References: <51e7c978-6638-488c-92bc-20e951a247d1@googlegroups.com>
Message-ID: <CACOPnvfyLgvt87zG4bevGQz=pk0eNFwti73Kkzawq1ALCCa2MQ@mail.gmail.com>

"The out of the box pub/sub technique in Rabbit doesn't delivery
messages to down/offline subscribers."

Really?

See pub/sub here: http://www.rabbitmq.com/tutorials/tutorial-four-python.html

In the example Q1 is able to retain a message until C1 reconnects.

alexis



On Mon, Sep 24, 2012 at 8:56 PM, Francisco Aguiar Zanfranceschi
<zanfranceschi at gmail.com> wrote:
> Hi all. I'm new here and to RabbitMQ.
>
> I'm hoping if someone can advise me with an idea i'm having to guarantee
> messages delivery to all subscribers in a pub/sub scenario.
>
> The out of the box pub/sub technique in Rabbit doesn't delivery messages to
> down/offline subscribers. This way, I have been thinking of having a sort of
> subscribers manager that would create queues for each one -- no fanout. I
> guess the attached diagram describes better what I'm thinking. I know
> there's the price of a higher coupling, but I think it's still simple.
>
> Another point: I don't want to use other frameworks by now (NServiceBus,
> Twisted, MassTransit, etc) as my current scenario is really heterogeneous.
>
> Any advice, suggestion, or real cases will be really appreciated.
>
> Thanks in advance.
>
> Francisco Zanfranceschi
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From wchrisjohnson at gmail.com  Tue Sep 25 01:25:59 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Mon, 24 Sep 2012 20:25:59 -0400
Subject: [rabbitmq-discuss] Bugs in Mgmt Console
Message-ID: <CC867256.2255A%wchrisjohnson@gmail.com>

Hi,

These are probably already known issues, but I'm seeing the management
console fail frequently while attempting to delete exchanges, delete queues,
unbind queues, etc. Generally the errors take the form of:

ReferenceError: Can't find variable: exchanges

Got response code 500 with body
Internal Server Error
The server encountered an error while processing this request:
{error,
    {case_clause,
        {amqp_params_direct,<<"admin">>,<<"dhbdh_public">>,
            'rabbit at blahblah-messageq0000',none,[]}},
    [{amqp_connection,start,2},
     {rabbit_mgmt_util,with_channel,5},
     {webmachine_resource,resource_call,3},
     {webmachine_resource,do,3},
     {webmachine_decision_core,resource_call,1},
     {webmachine_decision_core,decision,1},
     {webmachine_decision_core,handle_request,2},
     {rabbit_webmachine,'-makeloop/1-fun-0-',3}]}

The above was seen while attempting unbind a queue from an exchange.
I am running RabbitMQ 2.8.6 on Erlang R13B03 on Ubuntu 11
Chris




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/7905eb31/attachment.htm>

From wongkamhoong at gmail.com  Tue Sep 25 03:46:18 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Tue, 25 Sep 2012 10:46:18 +0800
Subject: [rabbitmq-discuss] Often failed to produce message due to TIMEOUT
	WAITING FOR ACK
Message-ID: <CAHv8OSQS_QMK5e9binBCN1vsTepk7bpp2sBwG40umVOC00AdsA@mail.gmail.com>

Hi RabbitMQ Team,

*My RabbitMQ*
Version : 2.8.6
Cluster Environment : Yes, All Nodes in Disk Mode
waitForConfirmsOrDie: Yes, 10000

Recently I found that my program often failed to produce messages to the
RabbitMQ server due to following exception:

*EXCEPTION LOG*
2012-09-24 11:53:19,665 WARN [INMSG-6] RabbitMQQueueSession - Failed to
produce message
{"creationDate":1348458796689,"lastModified":1348458796689,"queueMessage":{"id":44519977,"creationDate":1348458796688,"shortCode":28933,"serviceId":602,"lastModified":1348458796688,"operatorCode":13,"mcc":502,"msgId":"6e04.7dc9180b350b.00000195","class":"nplay.json.data.SnsInMessageValue","scheduledTime":1348458796688,"dataValue":{"message":"@ohhAzirahAzid:
start matrik aku suka duduk kat
library","creationDate":1348458796688,"shortCode":28933,"lastModified":1348458796688,"mcc":502,"operatorCode":13,"msisdn":60134406223,"class":"nplay.json.data.SmsOutMessageValue","scheduledTime":1348458796688}}}
: priority 4 to QUEUE_SMS_IN_4
com.rabbitmq.client.ShutdownSignalException: clean channel shutdown;
reason: #method<channel.close>(reply-code=406, reply-text=TIMEOUT WAITING
FOR ACK, class-id=0, method-id=0)
        at
com.rabbitmq.client.impl.ChannelN.waitForConfirms(ChannelN.java:182)
        at
com.rabbitmq.client.impl.ChannelN.waitForConfirmsOrDie(ChannelN.java:217)
        at
nplay.json.rabbitmq.client.RabbitMQQueueSession.produceTextMessage(RabbitMQQueueSession.java:124)
        at
nplay.common.mq.AQueueClient.produceTextMessage(AQueueClient.java:111)
        at
nplay.json.rabbitmq.client.QueueJsonRabbitMQClient.produceTextMessage(QueueJsonRabbitMQClient.java:289)
        at nplay.common.mq.AQueueClient.send(AQueueClient.java:185)
        at nplay.common.mq.AQueueClient.send(AQueueClient.java:275)
        at
nplay.endpoint.json.smpp.SnsInHandler.sendQueueMessage(SnsInHandler.java:21)
        at
nplay.endpoint.json.smpp.SnsInHandler.sendQueueMessage(SnsInHandler.java:11)
        at
nplay.endpoint.json.smpp.AIncomingMessageHandler.update(AIncomingMessageHandler.java:60)
        at nplay.endpoint.json.AJsonHandler.update(AJsonHandler.java:25)
        at java.util.Observable.notifyObservers(Observable.java:142)
        at
nplay.endpoint.common.ASpringEventSource.process(ASpringEventSource.java:202)
        at
nplay.endpoint.common.ASpringEventSource.run(ASpringEventSource.java:157)
        at java.lang.Thread.run(Thread.java:619)
        at
nplay.common.util.ThreadManager$ManagableThread.run(ThreadManager.java:52)
Caused by: com.rabbitmq.client.ShutdownSignalException: clean channel
shutdown; reason: #method<channel.close>(reply-code=406, reply-text=TIMEOUT
WAITING FOR ACK, class-id=0, method-id=0)
        at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:521)
        at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:480)
        at
com.rabbitmq.client.impl.ChannelN.waitForConfirmsOrDie(ChannelN.java:222)
        ... 14 more


Based on the log, the problem seems like related to "*NACKS Received*" and "
*ChannelN*" code throw the TimeoutException with reply-code *406 *
(PRECONDITION_FAILED).

I check all RabbitMQ servers are still working fine and I believe the time
I set for *waitForConfirmsOrDie *(10000) should be sufficient enough.


Can you advise me on the problem? How to solve it?


Thanks & Regards,
Wong
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/e9b68dba/attachment.htm>

From MJeffery at fnb.co.za  Tue Sep 25 05:50:50 2012
From: MJeffery at fnb.co.za (Jeffery, Mark)
Date: Tue, 25 Sep 2012 04:50:50 +0000
Subject: [rabbitmq-discuss] Bugs in Mgmt Console
In-Reply-To: <CC867256.2255A%wchrisjohnson@gmail.com>
References: <CC867256.2255A%wchrisjohnson@gmail.com>
Message-ID: <01e2ijvmct3vdgx16nhcaq3y.1348548536003@email.android.com>

Hello

Isn't R14B the minimum Erlang version for the management console ?

Jeff

Chris Johnson <wchrisjohnson at gmail.com> wrote:



Hi,

These are probably already known issues, but I'm seeing the management console fail frequently while attempting to delete exchanges, delete queues, unbind queues, etc. Generally the errors take the form of:


ReferenceError: Can't find variable: exchanges

Got response code 500 with body

Internal Server Error
The server encountered an error while processing this request:

{error,
    {case_clause,
        {amqp_params_direct,<<"admin">>,<<"dhbdh_public">>,
            'rabbit at blahblah-messageq0000',none,[]}},
    [{amqp_connection,start,2},
     {rabbit_mgmt_util,with_channel,5},
     {webmachine_resource,resource_call,3},
     {webmachine_resource,do,3},
     {webmachine_decision_core,resource_call,1},
     {webmachine_decision_core,decision,1},
     {webmachine_decision_core,handle_request,2},
     {rabbit_webmachine,'-makeloop/1-fun-0-',3}]}


The above was seen while attempting unbind a queue from an exchange.

I am running RabbitMQ 2.8.6 on Erlang R13B03 on Ubuntu 11

Chris



To read FirstRand Bank's Disclaimer for this email click on the following address or copy into your Internet browser: 
https://www.fnb.co.za/disclaimer.html 

If you are unable to access the Disclaimer, send a blank e-mail to
firstrandbankdisclaimer at fnb.co.za and we will send you a copy of the Disclaimer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/efbd161f/attachment.htm>

From jervisliu at gmail.com  Tue Sep 25 05:51:00 2012
From: jervisliu at gmail.com (Jervis Liu)
Date: Tue, 25 Sep 2012 12:51:00 +0800
Subject: [rabbitmq-discuss] rabbitmq_web_stomp and
 rabbitmq_web_stomp_examples plugins for the current RabbitMQ release
 (2.8.6)?
Message-ID: <CAM9W9p3UBMLv5JH3hUCzG1n9ni0-er5peHJF1cx6U-O_DfDPBA@mail.gmail.com>

Hi,

I would like the try the rabbitmq_web_stomp and its corresponding demo
documented by this post:
http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/.
However I could not find a version of rabbitmq_web_stomp and
rabbitmq_web_stomp_examples plugins that are compatible with the
current RabbitMQ release (2.8.6).

I can only find rabbitmq_web_stomp-2.8.2.ez and
rabbitmq_web_stomp_examples-2.8.2.ez. I've tried these two plugins,
they do not work with 2.8.6. Is there any place I can find the last
binary version of these two plugins? If not, can someone kindly help
to confirm if the source code of
https://github.com/rabbitmq/rabbitmq-web-stomp and
https://github.com/rabbitmq/rabbitmq-web-stomp-examples still work
with 2.8.6?

Thanks,
Jervis

From matthias at rabbitmq.com  Tue Sep 25 07:21:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 07:21:07 +0100
Subject: [rabbitmq-discuss] rabbitmq_web_stomp and
 rabbitmq_web_stomp_examples plugins for the current RabbitMQ release
 (2.8.6)?
In-Reply-To: <CAM9W9p3UBMLv5JH3hUCzG1n9ni0-er5peHJF1cx6U-O_DfDPBA@mail.gmail.com>
References: <CAM9W9p3UBMLv5JH3hUCzG1n9ni0-er5peHJF1cx6U-O_DfDPBA@mail.gmail.com>
Message-ID: <50614D53.4060501@rabbitmq.com>

Jervis,

On 25/09/12 05:51, Jervis Liu wrote:
> I would like the try the rabbitmq_web_stomp and its corresponding demo
> documented by this post:
> http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/.
> However I could not find a version of rabbitmq_web_stomp and
> rabbitmq_web_stomp_examples plugins that are compatible with the
> current RabbitMQ release (2.8.6).
>
> I can only find rabbitmq_web_stomp-2.8.2.ez and
> rabbitmq_web_stomp_examples-2.8.2.ez. I've tried these two plugins,
> they do not work with 2.8.6.

They *should* work with 2.8.6. What problems are you seeing? Any errors 
in the logs?

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Sep 25 07:32:04 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 07:32:04 +0100
Subject: [rabbitmq-discuss] Often failed to produce message due to
 TIMEOUT WAITING FOR ACK
In-Reply-To: <CAHv8OSQS_QMK5e9binBCN1vsTepk7bpp2sBwG40umVOC00AdsA@mail.gmail.com>
References: <CAHv8OSQS_QMK5e9binBCN1vsTepk7bpp2sBwG40umVOC00AdsA@mail.gmail.com>
Message-ID: <50614FE4.3010105@rabbitmq.com>

Wong,

On 25/09/12 03:46, Wong Kam Hoong wrote:
> com.rabbitmq.client.ShutdownSignalException: clean channel shutdown;
> reason: #method<channel.close>(reply-code=406, reply-text=TIMEOUT
> WAITING FOR ACK, class-id=0, method-id=0)
>          at
> com.rabbitmq.client.impl.ChannelN.waitForConfirms(ChannelN.java:182)
>
> Based on the log, the problem seems like related to "*NACKS Received*"
> and "*ChannelN*" code throw the TimeoutException with reply-code *406
> *(PRECONDITION_FAILED).

I don't think it has anything to do with nacks - unless you are actually 
seeing some exception mentioning nacks.

Looks like a straightforward timeout.

> I check all RabbitMQ servers are still working fine and I believe the
> time I set for *waitForConfirmsOrDie *(10000) should be sufficient enough.

10s should indeed generally be long enough. But one can certainly 
envision scenarios where it won't be. What's the general health of your 
rabbit when this happens? Plenty of free memory and disk? No strange 
errors in the logs? Are you using mirrored/HA queues at all? Could there 
possibly be a spike, i.e. lots of messages getting published in a short 
space of time?


Regards,

Matthias.

From matthias at rabbitmq.com  Tue Sep 25 07:44:19 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 07:44:19 +0100
Subject: [rabbitmq-discuss] Bugs in Mgmt Console
In-Reply-To: <CC867256.2255A%wchrisjohnson@gmail.com>
References: <CC867256.2255A%wchrisjohnson@gmail.com>
Message-ID: <506152C3.1070402@rabbitmq.com>

Chris,

On 25/09/12 01:25, Chris Johnson wrote:
> The server encountered an error while processing this request:
>
> {error,
>      {case_clause,
>          {amqp_params_direct,<<"admin">>,<<"dhbdh_public">>,
>              'rabbit at blahblah-messageq0000',none,[]}},
>      [{amqp_connection,start,2},
>       {rabbit_mgmt_util,with_channel,5},
>       {webmachine_resource,resource_call,3},
>       {webmachine_resource,do,3},
>       {webmachine_decision_core,resource_call,1},
>       {webmachine_decision_core,decision,1},
>       {webmachine_decision_core,handle_request,2},
>       {rabbit_webmachine,'-makeloop/1-fun-0-',3}]}
>
>
> The above was seen while attempting unbind a queue from an exchange.
>
> I am runningRabbitMQ*2.8.6*  on Erlang*R13B03*  on Ubuntu 11

The above error references code that hasn't been in rabbit since version 
2.5.1 (June 2011). So you are either running an old version of rabbit 
or, worse, a mixed version (e.g. some plug-ins and the broker 
disagreeing on the version).

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Sep 25 07:45:39 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 07:45:39 +0100
Subject: [rabbitmq-discuss] Bugs in Mgmt Console
In-Reply-To: <01e2ijvmct3vdgx16nhcaq3y.1348548536003@email.android.com>
References: <CC867256.2255A%wchrisjohnson@gmail.com>
	<01e2ijvmct3vdgx16nhcaq3y.1348548536003@email.android.com>
Message-ID: <50615313.6070802@rabbitmq.com>

On 25/09/12 05:50, Jeffery, Mark wrote:
> Isn't R14B the minimum Erlang version for the management console ?

Nah. R13B01 is sufficient. See http://www.rabbitmq.com/which-erlang.html

Matthias.

From gaurharidass at gmail.com  Tue Sep 25 07:34:43 2012
From: gaurharidass at gmail.com (gaurhari dass)
Date: Mon, 24 Sep 2012 23:34:43 -0700 (PDT)
Subject: [rabbitmq-discuss] need help getting error in rabbitmq in c++
 (Logging in: connection closed unexpectedly),
 is there any clean ccode to access rabbitmq functionality in c++
Message-ID: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120924/bd9ae08d/attachment.htm>

From matthias at rabbitmq.com  Tue Sep 25 07:53:21 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 07:53:21 +0100
Subject: [rabbitmq-discuss] need help getting error in rabbitmq in c++
 (Logging in: connection closed unexpectedly),
 is there any clean ccode to access rabbitmq functionality in c++
In-Reply-To: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
References: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
Message-ID: <506154E1.7020806@rabbitmq.com>

On 25/09/12 07:34, gaurhari dass wrote:
> (Logging in: connection closed unexpectedly)

Check the rabbitmq logs; they should contain more information as to what 
went wrong.

> is there any clean ccode to access rabbitmq functionality in c++

https://github.com/alanxz/SimpleAmqpClient

Regards,

Matthias

From matthias at rabbitmq.com  Tue Sep 25 08:09:00 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 08:09:00 +0100
Subject: [rabbitmq-discuss] transacted channel vs txSelect()
In-Reply-To: <1348231351.47978.YahooMailNeo@web125206.mail.ne1.yahoo.com>
References: <1348231351.47978.YahooMailNeo@web125206.mail.ne1.yahoo.com>
Message-ID: <5061588C.3000407@rabbitmq.com>

On 21/09/12 13:42, Majid Azimi wrote:
> 1. What is difference between using transacted channel using txSelect()
> and not transacted channel and manually acknowledging he message? It
> seems to me they do the same thing.

There is indeed little point to using transactions in pure consumers.

One thing you do get with consumers in tx mode, is a confirmation - in 
form of the tx.commit-ok - that the acks have reached the server. They 
could still get lost in a server crash after that point though.

> 2. When using basicConsume() in transacted channel what is acknowledging
> mode? autoack = true? In JMS when we use transacted session there is
> nothing like manual acknowledging. Is this true here?

The ack mode is selected with the autoAck flag of basicConsume. See 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.8.6/rabbitmq-java-client-javadoc-2.8.6/com/rabbitmq/client/Channel.html#basicConsume%28java.lang.String,%20boolean,%20com.rabbitmq.client.Consumer%29

In tx mode, acks (and nacks/rejects) are transactional, i.e. they are 
acted upon only on commit and undone on rollback.

Regards,

Matthias.

From gaurharidass at gmail.com  Tue Sep 25 08:37:07 2012
From: gaurharidass at gmail.com (gaurhari dass)
Date: Tue, 25 Sep 2012 00:37:07 -0700 (PDT)
Subject: [rabbitmq-discuss] need help getting error in rabbitmq in c++
 (Logging in: connection closed unexpectedly),
 is there any clean ccode to access rabbitmq functionality in c++
In-Reply-To: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
References: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
Message-ID: <74825382-5cfd-4e4a-a039-25c537e96fc7@googlegroups.com>


Hi Matthias,

thanks for your immediate response. It would be more usefull if you can
provide us the log file location details, in ubuntu environment.

The steps we are following are

We have downloaded the C client from the below link and compiled the
source successfully for the consumer example. but when we run the
consumer process, it successfully created the connection with the
rabbitmq ip and port and got the socket fd 3. but failed to logging in
with the guest username and password. and returned below error. Please
help us to resolve the issue.

Logging in: connection closed unexpectedly

Thanks
Gaurhari
On Tuesday, September 25, 2012 12:04:43 PM UTC+5:30, gaurhari dass wrote:
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/57b17b67/attachment.htm>

From matthias at rabbitmq.com  Tue Sep 25 08:51:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 08:51:56 +0100
Subject: [rabbitmq-discuss] need help getting error in rabbitmq in c++
 (Logging in: connection closed unexpectedly),
 is there any clean ccode to access rabbitmq functionality in c++
In-Reply-To: <74825382-5cfd-4e4a-a039-25c537e96fc7@googlegroups.com>
References: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
	<74825382-5cfd-4e4a-a039-25c537e96fc7@googlegroups.com>
Message-ID: <5061629C.20409@rabbitmq.com>

Gaurhari,

On 25/09/12 08:37, gaurhari dass wrote:
> It would be more usefull if you can
> provide us the log file location details, in ubuntu environment.

See http://www.rabbitmq.com/relocate.html - so the logs should be in 
/var/log/rabbitmq on a standard Ubuntu installation of RabbitMQ.

Regards,

Matthias.

From gaurharidass at gmail.com  Tue Sep 25 10:13:40 2012
From: gaurharidass at gmail.com (gaurhari dass)
Date: Tue, 25 Sep 2012 02:13:40 -0700 (PDT)
Subject: [rabbitmq-discuss] need help getting error in rabbitmq in c++
 (Logging in: connection closed unexpectedly),
 is there any clean ccode to access rabbitmq functionality in c++
In-Reply-To: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
References: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
Message-ID: <fb1f648c-8b46-486f-9684-09a5b34f1c68@googlegroups.com>

Hi Matthias,



When we start the rabbitmq server using rabbitmq-server command, it is 
running an instance on 44154 port. the information details are pasted below 
for your reference, but as per the log the consumer is trying to establish 
a connection  on 5672 port. rabbitmq log details are pasted for your ref.

Please help us to resolve this issue by setting the port details for the 
rabbitmq server.


*rabbitmq-server command output:*

- samsung-Samsung-Desktop-
System: [{rabbit,44154},
                                   {rabbitmqprelaunch6179,43183}]

*Rabbitmq log file details*

=INFO REPORT==== 25-Sep-2012::12:08:59 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 25-Sep-2012::12:08:59 ===
Halting Erlang VM

=INFO REPORT==== 25-Sep-2012::12:23:43 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 25-Sep-2012::12:23:43 ===
Memory limit set to 1574MB of 3935MB total.

=INFO REPORT==== 25-Sep-2012::12:23:43 ===
Disk free limit set to 953MB

=INFO REPORT==== 25-Sep-2012::12:23:43 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 25-Sep-2012::12:23:43 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 25-Sep-2012::12:23:43 ===
started TCP Listener on [::]:5672


Thanks


On Tuesday, September 25, 2012 12:04:43 PM UTC+5:30, gaurhari dass wrote:
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/56d66f96/attachment.htm>

From simon at rabbitmq.com  Tue Sep 25 10:27:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Sep 2012 10:27:49 +0100
Subject: [rabbitmq-discuss] need help getting error in rabbitmq in c++
 (Logging in: connection closed unexpectedly),
 is there any clean ccode to access rabbitmq functionality in c++
In-Reply-To: <fb1f648c-8b46-486f-9684-09a5b34f1c68@googlegroups.com>
References: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
	<fb1f648c-8b46-486f-9684-09a5b34f1c68@googlegroups.com>
Message-ID: <50617915.6070801@rabbitmq.com>

On 25/09/2012 10:13AM, gaurhari dass wrote:
> When we start the rabbitmq server using rabbitmq-server command, it is
> running an instance on 44154 port. the information details are pasted
> below for your reference, but as per the log the consumer is trying to
> establish a connection  on 5672 port. rabbitmq log details are pasted
> for your ref.
>
> Please help us to resolve this issue by setting the port details for the
> rabbitmq server.

That port (44154) is the port used for Erlang distribution, not for 
AMQP. We could probably make this clearer.

But that text is part of an error message that gets displayed when you 
attempt to start two RabbitMQ servers with the same node name. Is that 
what you are doing?

> =INFO REPORT==== 25-Sep-2012::12:23:43 ===
> started TCP Listener on [::]:5672

The log shows port 5672 being opened as we would expect. So what actual 
error are you seeing when clients try to connect?

Cheers, Simon

From gaurharidass at gmail.com  Tue Sep 25 10:57:38 2012
From: gaurharidass at gmail.com (gaurhari dass)
Date: Tue, 25 Sep 2012 02:57:38 -0700 (PDT)
Subject: [rabbitmq-discuss] need help getting error in rabbitmq in c++
 (Logging in: connection closed unexpectedly),
 is there any clean ccode to access rabbitmq functionality in c++
In-Reply-To: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
References: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
Message-ID: <aa3a96fb-5cd5-4871-8075-9a78b03af0cb@googlegroups.com>

Hi Simon,
 
 
when ever to try to run the consumer process getting the error.
 
Logging in: connection closed unexpectedly
 
also please help us in setting the port details for the rabbitmq server and 
where I can find rabbitmq.config file in the ubuntu machine? 
so that, we can use that port to login as a consumer process.
 
Thanks
Shankaralingegowda

On Tuesday, September 25, 2012 12:04:43 PM UTC+5:30, gaurhari dass wrote:

>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/ea637df1/attachment.htm>

From gaurharidass at gmail.com  Tue Sep 25 11:15:57 2012
From: gaurharidass at gmail.com (gaurhari dass)
Date: Tue, 25 Sep 2012 03:15:57 -0700 (PDT)
Subject: [rabbitmq-discuss] need help getting error in rabbitmq in c++
 (Logging in: connection closed unexpectedly),
 is there any clean ccode to access rabbitmq functionality in c++
In-Reply-To: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
References: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
Message-ID: <63f3242d-cc96-4132-8634-3c7df360009e@googlegroups.com>


Hi Simon,

We managed to run Consumer processs, and the successfully logged in. but 
while creating the queeu, we are getting the below error. this looks like 
some permission error, please help us to resolve by changing the 
permission, it will be better, if you can provice the command to change the 
permossion.

=INFO REPORT==== 25-Sep-2012::15:38:21 ===
Memory limit set to 1574MB of 3935MB total.

=INFO REPORT==== 25-Sep-2012::15:38:21 ===
Disk free limit set to 953MB

=INFO REPORT==== 25-Sep-2012::15:38:21 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 25-Sep-2012::15:38:21 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 25-Sep-2012::15:38:21 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 25-Sep-2012::15:39:06 ===
accepting AMQP connection <0.471.0> (107.108.189.141:51321 -> 
107.108.189.141:5672)

=ERROR REPORT==== 25-Sep-2012::15:39:06 ===
connection <0.471.0>, channel 1 - error:
{amqp_error,access_refused,
            "access to queue 'amq.gen-gxQhb_
hqv1EvS6sKFk3F13' in vhost '/' refused for user 'guest'",
            'queue.declare'}

=WARNING REPORT==== 25-Sep-2012::15:39:06 ===
closing AMQP connection <0.471.0> (107.108.189.141:51321 -> 
107.108.189.141:5672):
connection_closed_abruptly

Thanks
Gaurhari

On Tuesday, September 25, 2012 12:04:43 PM UTC+5:30, gaurhari dass wrote:
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/15e952d7/attachment.htm>

From gaurharidass at gmail.com  Tue Sep 25 12:11:11 2012
From: gaurharidass at gmail.com (gaurhari dass)
Date: Tue, 25 Sep 2012 04:11:11 -0700 (PDT)
Subject: [rabbitmq-discuss] need help getting error in rabbitmq in c++
 (Logging in: connection closed unexpectedly),
 is there any clean ccode to access rabbitmq functionality in c++
In-Reply-To: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
References: <09af9f39-5707-4bb5-93a2-d07f2517604a@googlegroups.com>
Message-ID: <5f6d1722-f533-4489-851b-e97756a7f8da@googlegroups.com>

Hi,

We managed to run Consumer and Producer process,
Steps are:
Create the rabbitmq user using rabbitmqctl arr_user
set the permission for the user using set permission rabbitmqctl 
set_permission

download the c library from web
compile the source separatly for Cosumer and Producer
 once the Binary are ready, run the process using the below command

./Consumer 127.0.0.1 5672

./Producer 127.0.0.1 5672 10 10

this will send 10 messages to mentioned queues

make sure that, you have created queue using amqp-declare_queue and created 
vhost using rabbitmqctl add_vohosts

Thanks


On Tuesday, September 25, 2012 12:04:43 PM UTC+5:30, gaurhari dass wrote:
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/bf544e4b/attachment.htm>

From zanfranceschi at gmail.com  Tue Sep 25 13:10:32 2012
From: zanfranceschi at gmail.com (Francisco Aguiar Zanfranceschi)
Date: Tue, 25 Sep 2012 05:10:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Pub/Sub Guaranteed Delivery
In-Reply-To: <51e7c978-6638-488c-92bc-20e951a247d1@googlegroups.com>
References: <51e7c978-6638-488c-92bc-20e951a247d1@googlegroups.com>
Message-ID: <2f0c96f7-4709-4e4c-8a68-6acd225a7c52@googlegroups.com>

I'd like to say that's probably easier if I ask what's the best way to 
guarantee all subscribers receive all messages even when they go offline 
using RabbitMQ. I imagine all of us had that challenge or will have it 
sooner or later. I'm sorry to kind of bump this discussion.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/0c42563a/attachment.htm>

From awilliam at whitemice.org  Tue Sep 25 13:54:55 2012
From: awilliam at whitemice.org (Adam Tauno Williams)
Date: Tue, 25 Sep 2012 08:54:55 -0400
Subject: [rabbitmq-discuss] Identifying TCP Listeners.
In-Reply-To: <1334165564.3639.3.camel@p105s6207.site>
References: <1334141345.2819.17.camel@workstation.wmmi.net>
	<1334141521.2819.18.camel@workstation.wmmi.net>
	<4F85640B.7020101@rabbitmq.com>
	<1334164518.2328.3.camel@p105s6207.site>
	<1334165564.3639.3.camel@p105s6207.site>
Message-ID: <1348577695.3609.1.camel@linux-nysu.site>

On Wed, 2012-04-11 at 13:32 -0400, Adam Tauno Williams wrote: 
> On Wed, 2012-04-11 at 13:15 -0400, Adam Tauno Williams wrote:
> > On Wed, 2012-04-11 at 11:59 +0100, Michael Bridgen wrote:
> > > On 04/11/2012 11:52 AM, Adam Tauno Williams wrote:
> > > > On Wed, 2012-04-11 at 06:49 -0400, Adam Tauno Williams wrote:
> > > >> How can I determine what 'service' is active on a port via RabbitMQ?
> > > >> I've figured out all but TCP/49974
> > > >> 0 0.0.0.0:4369  epmd [Erlang Port Mapper]
> > > >> 0.0.0.0:49974   beam.smp [????]
> > > >
> > > > Actually, this port seems to 'float', as it is different every time I
> > > > restart Rabbit.
> > > I expect it's Erlang distribution -- i.e., it's the port the node 
> > > advertises in epmd so other nodes can communicate with it.
> > 
> > Ah, that sound's reasonable.
> > From netstat:
> > tcp   0   0 0.0.0.0:50000  0.0.0.0:*    LISTEN      1434/beam.smp       
> > tcp   0   0 0.0.0.0:4369   0.0.0.0:*    LISTEN      1296/epmd           
> > tcp   0   0 0.0.0.0:55672  0.0.0.0:*    LISTEN      1434/beam.smp       
> > tcp   0   0 127.0.0.1:5672 0.0.0.0:*    LISTEN      1434/beam.smp 
> > Are there any configuration parameters to control how that port is
> > bound, selected, or published?
> With - 
> rabbitmq-server-2.8.1-1.suse.noarch
> erlang-R15B-2.1.i586
>  - I can specify -
> {
>   kernel, [ {inet_dist_use_interface, [ {"127.0.0.1"} ] } ]
>  }
>  - /etc/rabbitmq/rabbitmq.config  and the server still starts, but it
> has no effect on how the epmd or beam.smp bind.

I was finally able to achieve getting my test instance of RabbitMQ and
all its components to only listen on the localhost interface.  It
requires are combination of both environment variables and configuration
file [ugh].

<http://www.whitemiceconsulting.com/2012/09/idjits-guide-to-installing-rabbitmq-on.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/d53925bf/attachment.pgp>

From wchrisjohnson at gmail.com  Tue Sep 25 14:26:00 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Tue, 25 Sep 2012 09:26:00 -0400
Subject: [rabbitmq-discuss] FW:  Bugs in Mgmt Console
In-Reply-To: <506152C3.1070402@rabbitmq.com>
Message-ID: <CC872617.225BD%wchrisjohnson@gmail.com>

Matthias, 

Here's the contents of the plugins folder - anything look out of place for
Rabbit 2.8.6?

212 -rw-r--r-- 1 root root 216658 2012-08-22 10:41 amqp_client-2.8.6.ez
100 -rw-r--r-- 1 root root  99441 2012-08-22 10:41
eldap-2.8.6-gite309de4.ez
 48 -rw-r--r-- 1 root root  48798 2012-08-22 10:41 erlando-2.8.6.ez
280 -rw-r--r-- 1 root root 283700 2012-08-22 10:41
mochiweb-2.3.1-rmq2.8.6-gitd541e9a.ez
 20 -rw-r--r-- 1 root root  17067 2012-08-22 10:41
rabbitmq_auth_backend_ldap-2.8.6.ez
 12 -rw-r--r-- 1 root root  10587 2012-08-22 10:41
rabbitmq_auth_mechanism_ssl-2.8.6.ez
  8 -rw-r--r-- 1 root root   7452 2012-08-22 10:41
rabbitmq_consistent_hash_exchange-2.8.6.ez
 96 -rw-r--r-- 1 root root  95367 2012-08-22 10:41
rabbitmq_federation-2.8.6.ez
 12 -rw-r--r-- 1 root root   8244 2012-08-22 10:41
rabbitmq_federation_management-2.8.6.ez
  4 -rw-r--r-- 1 root root   2893 2012-08-22 10:41
rabbitmq_jsonrpc-2.8.6.ez
 68 -rw-r--r-- 1 root root  67232 2012-08-22 10:41
rabbitmq_jsonrpc_channel-2.8.6.ez
 52 -rw-r--r-- 1 root root  52970 2012-08-22 10:41
rabbitmq_jsonrpc_channel_examples-2.8.6.ez
368 -rw-r--r-- 1 root root 376061 2012-08-22 10:41
rabbitmq_management-2.8.6.ez
 20 -rw-r--r-- 1 root root  16557 2012-08-22 10:41
rabbitmq_management_agent-2.8.6.ez
 32 -rw-r--r-- 1 root root  32493 2012-08-22 10:41
rabbitmq_management_visualiser-2.8.6.ez
 28 -rw-r--r-- 1 root root  25762 2012-08-22 10:41
rabbitmq_mochiweb-2.8.6.ez
 36 -rw-r--r-- 1 root root  36541 2012-08-22 10:41 rabbitmq_shovel-2.8.6.ez
 16 -rw-r--r-- 1 root root  13019 2012-08-22 10:41
rabbitmq_shovel_management-2.8.6.ez
 88 -rw-r--r-- 1 root root  86988 2012-08-22 10:41 rabbitmq_stomp-2.8.6.ez
 44 -rw-r--r-- 1 root root  42203 2012-08-22 10:41
rabbitmq_tracing-2.8.6.ez
  4 -rw-r--r-- 1 root root     59 2012-08-22 10:41 README
 48 -rw-r--r-- 1 root root  45556 2012-08-22 10:41
rfc4627_jsonrpc-2.8.6-gita5e7ad7.ez
140 -rw-r--r-- 1 root root 142912 2012-08-22 10:41
webmachine-1.9.1-rmq2.8.6-git52e62bc.ez


Chris


On 9/25/12 2:44 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Chris,
>
>On 25/09/12 01:25, Chris Johnson wrote:
>> The server encountered an error while processing this request:
>>
>> {error,
>>      {case_clause,
>>          {amqp_params_direct,<<"admin">>,<<"dhbdh_public">>,
>>              'rabbit at blahblah-messageq0000',none,[]}},
>>      [{amqp_connection,start,2},
>>       {rabbit_mgmt_util,with_channel,5},
>>       {webmachine_resource,resource_call,3},
>>       {webmachine_resource,do,3},
>>       {webmachine_decision_core,resource_call,1},
>>       {webmachine_decision_core,decision,1},
>>       {webmachine_decision_core,handle_request,2},
>>       {rabbit_webmachine,'-makeloop/1-fun-0-',3}]}
>>
>>
>> The above was seen while attempting unbind a queue from an exchange.
>>
>> I am runningRabbitMQ*2.8.6*  on Erlang*R13B03*  on Ubuntu 11
>
>The above error references code that hasn't been in rabbit since version
>2.5.1 (June 2011). So you are either running an old version of rabbit
>or, worse, a mixed version (e.g. some plug-ins and the broker
>disagreeing on the version).
>
>Regards,
>
>Matthias.



From matthias at rabbitmq.com  Tue Sep 25 14:48:06 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 14:48:06 +0100
Subject: [rabbitmq-discuss] FW:  Bugs in Mgmt Console
In-Reply-To: <CC872617.225BD%wchrisjohnson@gmail.com>
References: <CC872617.225BD%wchrisjohnson@gmail.com>
Message-ID: <5061B616.1050400@rabbitmq.com>

Chris,

On 25/09/12 14:26, Chris Johnson wrote:
> Here's the contents of the plugins folder - anything look out of place for
> Rabbit 2.8.6?

That looks fine. But I suspect that is not (all) you are running.

Check what 'rabbitmqctl status' returns - it should list the versions of 
all activated plugins as well as rabbit itself.

Matthias.

From wchrisjohnson at gmail.com  Tue Sep 25 14:53:48 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Tue, 25 Sep 2012 09:53:48 -0400
Subject: [rabbitmq-discuss] FW:  FW:  Bugs in Mgmt Console
In-Reply-To: <5061B616.1050400@rabbitmq.com>
Message-ID: <CC872F65.2260E%wchrisjohnson@gmail.com>

Here's the results:

[{pid,1767},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.6"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.6"},
      {amqp_client,"RabbitMQ AMQP Client","2.3.1"},
      {rabbit,"RabbitMQ","2.8.6"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.6"},
      {webmachine,"webmachine","1.9.1-rmq2.8.6-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.6-gitd541e9a"},
      {inets,"INETS  CXC 138 49","5.2"},
      {xmerl,"XML parser","1.2.3"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R13B03 (erts-5.7.4) [source] [64-bit] [rq:1]
[async-threads:30] [hipe] [kernel-poll:true]\n"},
 {memory,
     [{total,35903840},
      {processes,13281144},
      {processes_used,13269840},
      {system,22622696},
      {atom,1510745},
      {atom_used,1486651},
      {binary,184688},
      {code,18011700},
      {ets,1439672}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,788712652},
 {disk_free_limit,1000000000},
 {disk_free,1753387008},
 {file_descriptors,
     
[{total_limit,924},{total_used,6},{sockets_limit,829},{sockets_used,4}]},
 {processes,[{limit,1048576},{used,368}]},
 {run_queue,0},
 {uptime,47201}]



On 9/25/12 9:48 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Chris,
>
>On 25/09/12 14:26, Chris Johnson wrote:
>> Here's the contents of the plugins folder - anything look out of place
>>for
>> Rabbit 2.8.6?
>
>That looks fine. But I suspect that is not (all) you are running.
>
>Check what 'rabbitmqctl status' returns - it should list the versions of
>all activated plugins as well as rabbit itself.
>
>Matthias.



From matthias at rabbitmq.com  Tue Sep 25 15:02:49 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 15:02:49 +0100
Subject: [rabbitmq-discuss] FW:  FW:  Bugs in Mgmt Console
In-Reply-To: <CC872F65.2260E%wchrisjohnson@gmail.com>
References: <CC872F65.2260E%wchrisjohnson@gmail.com>
Message-ID: <5061B989.8000808@rabbitmq.com>

Chris,

On 25/09/12 14:53, Chris Johnson wrote:
> Here's the results:
> [...]
> [{pid,1767},
>        {amqp_client,"RabbitMQ AMQP Client","2.3.1"},

There's your problem.

It's probably picking that up from some old rabbit installation, e.g. 
the default one that ships with Natty, which is 2.3.1.

I am finding it hard to image that this problem would occur in a 
straightforward install of the rabbit .deb, which is what you should be 
doing on Ubuntu, since that ought to eradicate all traces of the old 
version.

Regards,

Matthias.

From wchrisjohnson at gmail.com  Tue Sep 25 15:39:18 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Tue, 25 Sep 2012 10:39:18 -0400
Subject: [rabbitmq-discuss] FW:  FW:  FW:  Bugs in Mgmt Console
In-Reply-To: <5061B989.8000808@rabbitmq.com>
Message-ID: <CC873997.2265B%wchrisjohnson@gmail.com>

We are installing via chef based on the latest .deb package (2.8.6). We
are also installing the rabbitmq-erlang-client based on v.2.3.1 - that is
our problem. Our chef guy can't find a more recent version of the client
lib as a .deb - is it even necessary to install that, or do we get it as a
part of the standard server install? Can we just drop the client .ez file
into the plugins folder?

Chris
   


On 9/25/12 10:02 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Chris,
>
>On 25/09/12 14:53, Chris Johnson wrote:
>> Here's the results:
>> [...]
>> [{pid,1767},
>>        {amqp_client,"RabbitMQ AMQP Client","2.3.1"},
>
>There's your problem.
>
>It's probably picking that up from some old rabbit installation, e.g.
>the default one that ships with Natty, which is 2.3.1.
>
>I am finding it hard to image that this problem would occur in a
>straightforward install of the rabbit .deb, which is what you should be
>doing on Ubuntu, since that ought to eradicate all traces of the old
>version.
>
>Regards,
>
>Matthias.



From wchrisjohnson at gmail.com  Tue Sep 25 15:41:14 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Tue, 25 Sep 2012 10:41:14 -0400
Subject: [rabbitmq-discuss] FW:  FW:  FW:  Bugs in Mgmt Console
In-Reply-To: <5061B989.8000808@rabbitmq.com>
Message-ID: <CC873A98.2266C%wchrisjohnson@gmail.com>

I just realized what that is from - we were trying to install the latest
version of erlang...


On 9/25/12 10:02 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Chris,
>
>On 25/09/12 14:53, Chris Johnson wrote:
>> Here's the results:
>> [...]
>> [{pid,1767},
>>        {amqp_client,"RabbitMQ AMQP Client","2.3.1"},
>
>There's your problem.
>
>It's probably picking that up from some old rabbit installation, e.g.
>the default one that ships with Natty, which is 2.3.1.
>
>I am finding it hard to image that this problem would occur in a
>straightforward install of the rabbit .deb, which is what you should be
>doing on Ubuntu, since that ought to eradicate all traces of the old
>version.
>
>Regards,
>
>Matthias.



From wchrisjohnson at gmail.com  Tue Sep 25 16:55:17 2012
From: wchrisjohnson at gmail.com (Chris Johnson)
Date: Tue, 25 Sep 2012 11:55:17 -0400
Subject: [rabbitmq-discuss] FW:  FW:  FW:  Bugs in Mgmt Console
In-Reply-To: <5061B989.8000808@rabbitmq.com>
Message-ID: <CC874AFD.22738%wchrisjohnson@gmail.com>

Yep. We used to have rabbitmq 2.8.1 installed on this cluster, as well as
the rabbitmq-erlang-client, v.2.3.1. I'm not exactly sure why the erlang
client was installed, but everything worked fine.

We recently upgraded to the latest rabbitmq .deb, 2.8.6, with no change to
the erlang client. When we installed 2.8.6, the issues started appearing.
We just removed the rabbitmq-erlang-client, rebooted the cluster, and now
I am able to remove exchanges within the web console.

Thanks!


On 9/25/12 10:02 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Chris,
>
>On 25/09/12 14:53, Chris Johnson wrote:
>> Here's the results:
>> [...]
>> [{pid,1767},
>>        {amqp_client,"RabbitMQ AMQP Client","2.3.1"},
>
>There's your problem.
>
>It's probably picking that up from some old rabbit installation, e.g.
>the default one that ships with Natty, which is 2.3.1.
>
>I am finding it hard to image that this problem would occur in a
>straightforward install of the rabbit .deb, which is what you should be
>doing on Ubuntu, since that ought to eradicate all traces of the old
>version.
>
>Regards,
>
>Matthias.



From simon at rabbitmq.com  Tue Sep 25 16:55:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 25 Sep 2012 16:55:55 +0100
Subject: [rabbitmq-discuss] FW:  FW:  FW:  Bugs in Mgmt Console
In-Reply-To: <CC873997.2265B%wchrisjohnson@gmail.com>
References: <CC873997.2265B%wchrisjohnson@gmail.com>
Message-ID: <5061D40B.7060802@rabbitmq.com>

On 25/09/12 15:39, Chris Johnson wrote:
> We are installing via chef based on the latest .deb package (2.8.6). We
> are also installing the rabbitmq-erlang-client based on v.2.3.1 - that is
> our problem. Our chef guy can't find a more recent version of the client
> lib as a .deb - is it even necessary to install that, or do we get it as a
> part of the standard server install?

Not for the server - all the plugins including the Erlang client have 
been bundled with the server install since 2.7.0.

Obviously if you have your own Erlang app which uses the client, you'll 
want to install it separately. But in that case, put it somewhere the 
server can't find it :-)

> Can we just drop the client .ez file into the plugins folder?

You shouldn't do that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Tue Sep 25 17:10:45 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 25 Sep 2012 17:10:45 +0100
Subject: [rabbitmq-discuss] Pub/Sub Guaranteed Delivery
In-Reply-To: <2f0c96f7-4709-4e4c-8a68-6acd225a7c52@googlegroups.com>
References: <51e7c978-6638-488c-92bc-20e951a247d1@googlegroups.com>
	<2f0c96f7-4709-4e4c-8a68-6acd225a7c52@googlegroups.com>
Message-ID: <CACOPnveygWXQxdRuTV=-ATGp8b+=6QW3cLr+JGcZObrU2FPo5w@mail.gmail.com>

On Tue, Sep 25, 2012 at 1:10 PM, Francisco Aguiar Zanfranceschi
<zanfranceschi at gmail.com> wrote:
> I'd like to say that's probably easier if I ask what's the best way to
> guarantee all subscribers receive all messages even when they go offline
> using RabbitMQ. I imagine all of us had that challenge or will have it
> sooner or later. I'm sorry to kind of bump this discussion.

You want to make sure that each consumer (subscribed client) can have
its messages held in a queue, while it is offline, so that it can get
the messages when it reconnects.  This is achievable using the pattern
I linked to in my previous post on this thread.

Then, you need to make sure that when it does connect, the messages
get to the consumer and only after you know that happened, is the
message deleted from the queue.  This is achievable by using
acknowledgement.

Does this answer your question?

It is also important to understand the failure scenarios clearly,
whenever words like "guarantee" are bandied about ;-)

From zanfranceschi at gmail.com  Tue Sep 25 17:55:40 2012
From: zanfranceschi at gmail.com (Francisco Aguiar Zanfranceschi)
Date: Tue, 25 Sep 2012 09:55:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Pub/Sub Guaranteed Delivery
In-Reply-To: <CACOPnveygWXQxdRuTV=-ATGp8b+=6QW3cLr+JGcZObrU2FPo5w@mail.gmail.com>
References: <51e7c978-6638-488c-92bc-20e951a247d1@googlegroups.com>
	<2f0c96f7-4709-4e4c-8a68-6acd225a7c52@googlegroups.com>
	<CACOPnveygWXQxdRuTV=-ATGp8b+=6QW3cLr+JGcZObrU2FPo5w@mail.gmail.com>
Message-ID: <94f6ab53-67c8-4d2a-a03e-a2273e350b0a@googlegroups.com>

Thanks for your reply, Alexis. I guess what you said I can see in a non 
pub/sub (using fanout) scenario (persistent, durable, ack)... Am I 
understanding your response right? I've searched extensively for this 
answer, but I found there is no out of the box solution in RabbitMQ (and 
most of other queue solutions), so I'm trying to find good practices to 
achieve it -- pub/sub technique to "guarantee" messages are delivered to 
all subscribers. I'm trying to avoid the idea of building a custom 
lightweight middleware (although my diagram represents one in some sense).

I couldn't find the post you mentioned -- would you mind pointing it to me, 
please?

Thanks again.

Francisco

On Tuesday, 25 September 2012 13:10:47 UTC-3, Alexis Richardson wrote:
>
> On Tue, Sep 25, 2012 at 1:10 PM, Francisco Aguiar Zanfranceschi 
> <zanfra... at gmail.com <javascript:>> wrote: 
> > I'd like to say that's probably easier if I ask what's the best way to 
> > guarantee all subscribers receive all messages even when they go offline 
> > using RabbitMQ. I imagine all of us had that challenge or will have it 
> > sooner or later. I'm sorry to kind of bump this discussion. 
>
> You want to make sure that each consumer (subscribed client) can have 
> its messages held in a queue, while it is offline, so that it can get 
> the messages when it reconnects.  This is achievable using the pattern 
> I linked to in my previous post on this thread. 
>
> Then, you need to make sure that when it does connect, the messages 
> get to the consumer and only after you know that happened, is the 
> message deleted from the queue.  This is achievable by using 
> acknowledgement. 
>
> Does this answer your question? 
>
> It is also important to understand the failure scenarios clearly, 
> whenever words like "guarantee" are bandied about ;-) 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/daed7367/attachment.htm>

From apolanski at gmail.com  Tue Sep 25 18:44:56 2012
From: apolanski at gmail.com (Adam Polanski)
Date: Tue, 25 Sep 2012 10:44:56 -0700 (PDT)
Subject: [rabbitmq-discuss] C# posted messages to topic queue aren't going
 away when subscriber acks
Message-ID: <84838a93-ef22-47e6-8a55-f1737dfe9ca2@googlegroups.com>

I'm using C# .net client, posting messages to a durable,noAutodelete topic 
queue while running several client threads that subscribe using bindings 
such as 'web.page' and 'session.begin', I'm not using wildcards anywhere 
yet.

The clients create their own queues, the messages get from the topic queue 
to each clients subscription queue, then the clients are retrieving the 
messages, processing and acknowledging them. The messages that are on the 
main topic queue are sometimes draining to the relevant subscription 
queues, but not always, so over time, some messages are being left on the 
queue (even after having been processed by a subscription).

I'm guessing that this is an indication that I'm not handling the queues 
correctly, is there anything obvious I could have missed?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/63d2bea2/attachment.htm>

From mikekhristo at gmail.com  Tue Sep 25 18:21:30 2012
From: mikekhristo at gmail.com (MK)
Date: Tue, 25 Sep 2012 10:21:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit won't restart - no next heap size found
Message-ID: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>

 

i have a box with 68G of memory? rabbit was running and had 300M messages 
in a queue. It was using 36G out of 56G allocated memory, but showed an 
alert due to low disk space. i cleared up disk space and tried to restart 
rabbitmq-server? now it wont start:

Crash dump was written to: erl_crash.dump

no next heap size found: -1623298710, offset 0



The erl_crash.dump is 31MB, but happy to send it to someone if they think 
they can help with this critical issue.


Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/2ec6d398/attachment.htm>

From eduardo.pinheiro at muzzley.com  Tue Sep 25 19:00:36 2012
From: eduardo.pinheiro at muzzley.com (edu)
Date: Tue, 25 Sep 2012 11:00:36 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ STOMP Adapter - How to get the RPC
	reply messages?
In-Reply-To: <cd91aecb-ce3c-4355-b02a-119fdf7c579f@googlegroups.com>
References: <cd91aecb-ce3c-4355-b02a-119fdf7c579f@googlegroups.com>
Message-ID: <1a9542cb-197d-4c28-867a-cdba01e99786@googlegroups.com>

Looking forward for an answer.....

On Monday, September 24, 2012 3:14:11 PM UTC+1, Tiago Alves wrote:
>
> Hi,
>
> I'm trying to perform an RPC with RabbitMQ's STOMP adapter. As the client 
> lib I'm using the STOMP over WebSocket (
> https://github.com/jmesnil/stomp-websocket/) library.
>
> From the documentation (http://www.rabbitmq.com/stomp.html#d.tqd) I see 
> that I have to set the reply-to header. I've done that by specifying 
> something like "reply-to: /temp-queue/foo" and I saw in my server-side 
> client (node-amqp) that the replyTo header is set correctly 
> (example: replyTo: '/reply-queue/amq.gen-w2jykNGp4DNDBADm3C4Cdx'). Still in 
> my server-side client, I can reply to the message just by publishing a 
> message to "/reply-queue/amq.gen-w2jykNGp4DNDBADm3C4Cdx".
>
> However, how do I get this reply it in my client code where the RPC call 
> was initiated? The documentation states "SEND and SUBSCRIBE frames *must 
> not* contain /temp-queue destinations (...) subscriptions to reply queues 
> are created automatically."
>
> So, how do I subscribe to the reply-to queue? How can I get the results of 
> RPC calls?
>
> Thanks in advance.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/c9a5a024/attachment.htm>

From matthias at rabbitmq.com  Tue Sep 25 19:18:32 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 19:18:32 +0100
Subject: [rabbitmq-discuss] Rabbit won't restart - no next heap size
	found
In-Reply-To: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>
References: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>
Message-ID: <5061F578.6080300@rabbitmq.com>

On 25/09/12 18:21, MK wrote:
> i have a box with 68G of memory? rabbit was running and had 300M
> messages in a queue.

Congratulations, that must be one of the fattest rabbits out there :)

> It was using 36G out of 56G allocated memory, but
> showed an alert due to low disk space. i cleared up disk space and tried
> to restart rabbitmq-server? now it wont start:
>
> Crash dump was written to: erl_crash.dump
>
> no next heap size found: -1623298710, offset 0
>
> The erl_crash.dump is 31MB, but happy to send it to someone if they
> think they can help with this critical issue.

This is more likely an Erlang rather than Rabbit problem.

What version of Erlang are you running? On what O/S? And what version of 
Rabbit?

Regards,

Matthias.

From mikekhristo at gmail.com  Tue Sep 25 20:23:16 2012
From: mikekhristo at gmail.com (Mike Khristo)
Date: Tue, 25 Sep 2012 12:23:16 -0700
Subject: [rabbitmq-discuss] Rabbit won't restart - no next heap size
	found
In-Reply-To: <5061F578.6080300@rabbitmq.com>
References: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>
	<5061F578.6080300@rabbitmq.com>
Message-ID: <CAJ0FASqDONKd-UL-EbitRqA6h3zaeqxAG9LZFKmoQTsFyck0=A@mail.gmail.com>

node           : rabbit at rabbit-3
app descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.6/sbin/../ebin/
rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : /etc/rabbitmq/rabbitmq.config
cookie hash    : grkqGrreXu49Gonx6B/2AA==
log            : /var/log/rabbitmq/rabbit at rabbit-3.log
sasl log       : /var/log/rabbitmq/rabbit at rabbit-3-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at rabbit-3
erlang version : 5.8.3


Ubuntu 11.10

On Tue, Sep 25, 2012 at 11:18 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 25/09/12 18:21, MK wrote:
>
>> i have a box with 68G of memory? rabbit was running and had 300M
>> messages in a queue.
>>
>
> Congratulations, that must be one of the fattest rabbits out there :)
>
>
>  It was using 36G out of 56G allocated memory, but
>> showed an alert due to low disk space. i cleared up disk space and tried
>> to restart rabbitmq-server? now it wont start:
>>
>> Crash dump was written to: erl_crash.dump
>>
>> no next heap size found: -1623298710, offset 0
>>
>> The erl_crash.dump is 31MB, but happy to send it to someone if they
>> think they can help with this critical issue.
>>
>
> This is more likely an Erlang rather than Rabbit problem.
>
> What version of Erlang are you running? On what O/S? And what version of
> Rabbit?
>
> Regards,
>
> Matthias.
>



-- 
-mk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/1880e7a0/attachment.htm>

From matthias at rabbitmq.com  Tue Sep 25 20:29:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 20:29:29 +0100
Subject: [rabbitmq-discuss] Rabbit won't restart - no next heap size
	found
In-Reply-To: <CAJ0FASqDONKd-UL-EbitRqA6h3zaeqxAG9LZFKmoQTsFyck0=A@mail.gmail.com>
References: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>
	<5061F578.6080300@rabbitmq.com>
	<CAJ0FASqDONKd-UL-EbitRqA6h3zaeqxAG9LZFKmoQTsFyck0=A@mail.gmail.com>
Message-ID: <50620619.8050108@rabbitmq.com>

Mike,

On 25/09/12 20:23, Mike Khristo wrote:
> node           : rabbit at rabbit-3
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.6/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : /etc/rabbitmq/rabbitmq.config
> cookie hash    : grkqGrreXu49Gonx6B/2AA==
> log            : /var/log/rabbitmq/rabbit at rabbit-3.log
> sasl log       : /var/log/rabbitmq/rabbit at rabbit-3-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at rabbit-3
> erlang version : 5.8.3

That Erlang is quite old - R14B02 - I suggest you upgrade to the latest 
(R15B02). Hopefully then your rabbit will start up again.

Regards,

Matthias.

From alexis at rabbitmq.com  Tue Sep 25 21:02:49 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 25 Sep 2012 21:02:49 +0100
Subject: [rabbitmq-discuss] Pub/Sub Guaranteed Delivery
In-Reply-To: <94f6ab53-67c8-4d2a-a03e-a2273e350b0a@googlegroups.com>
References: <51e7c978-6638-488c-92bc-20e951a247d1@googlegroups.com>
	<2f0c96f7-4709-4e4c-8a68-6acd225a7c52@googlegroups.com>
	<CACOPnveygWXQxdRuTV=-ATGp8b+=6QW3cLr+JGcZObrU2FPo5w@mail.gmail.com>
	<94f6ab53-67c8-4d2a-a03e-a2273e350b0a@googlegroups.com>
Message-ID: <CACOPnvdwnW0oTdoZBJU4xLyU1Hu+PHcbQEBg_OazDptsixW+QA@mail.gmail.com>

On Tue, Sep 25, 2012 at 5:55 PM, Francisco Aguiar Zanfranceschi
<zanfranceschi at gmail.com> wrote:
> Thanks for your reply, Alexis. I guess what you said I can see in a non
> pub/sub (using fanout) scenario (persistent, durable, ack)... Am I
> understanding your response right?

No, in the sense that persistent, durable, ack are all things that
work with Rabbit pub/sub.  This example is not using fanout:

http://www.rabbitmq.com/tutorials/tutorial-four-python.html


> I've searched extensively for this
> answer, but I found there is no out of the box solution in RabbitMQ (and
> most of other queue solutions), so I'm trying to find good practices to
> achieve it -- pub/sub technique to "guarantee" messages are delivered to all
> subscribers. I'm trying to avoid the idea of building a custom lightweight
> middleware (although my diagram represents one in some sense).
>
> I couldn't find the post you mentioned -- would you mind pointing it to me,
> please?


It's this one: http://www.rabbitmq.com/tutorials/tutorial-four-python.html

alexis


> Thanks again.
>
> Francisco
>
>
> On Tuesday, 25 September 2012 13:10:47 UTC-3, Alexis Richardson wrote:
>>
>> On Tue, Sep 25, 2012 at 1:10 PM, Francisco Aguiar Zanfranceschi
>> <zanfra... at gmail.com> wrote:
>> > I'd like to say that's probably easier if I ask what's the best way to
>> > guarantee all subscribers receive all messages even when they go offline
>> > using RabbitMQ. I imagine all of us had that challenge or will have it
>> > sooner or later. I'm sorry to kind of bump this discussion.
>>
>> You want to make sure that each consumer (subscribed client) can have
>> its messages held in a queue, while it is offline, so that it can get
>> the messages when it reconnects.  This is achievable using the pattern
>> I linked to in my previous post on this thread.
>>
>> Then, you need to make sure that when it does connect, the messages
>> get to the consumer and only after you know that happened, is the
>> message deleted from the queue.  This is achievable by using
>> acknowledgement.
>>
>> Does this answer your question?
>>
>> It is also important to understand the failure scenarios clearly,
>> whenever words like "guarantee" are bandied about ;-)

From mikekhristo at gmail.com  Tue Sep 25 22:10:16 2012
From: mikekhristo at gmail.com (Mike Khristo)
Date: Tue, 25 Sep 2012 14:10:16 -0700
Subject: [rabbitmq-discuss] Rabbit won't restart - no next heap size
	found
In-Reply-To: <50620619.8050108@rabbitmq.com>
References: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>
	<5061F578.6080300@rabbitmq.com>
	<CAJ0FASqDONKd-UL-EbitRqA6h3zaeqxAG9LZFKmoQTsFyck0=A@mail.gmail.com>
	<50620619.8050108@rabbitmq.com>
Message-ID: <CAJ0FASogr824Uw37GnpMKG4_su60wC1uXnxVTfWd+CdkAQySwA@mail.gmail.com>

Upgraded to erlang 5.9.2.


eheap_alloc: Cannot allocate 11037567056 bytes of memory (of type "heap").


How can I get rabbit to start w/o using so much memory? It was only using
30G out of the 68G avail while it was running.... This is a production box
and I need to get access to the 300M messages asap.

Thanks!



On Tue, Sep 25, 2012 at 12:29 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Mike,
>
>
> On 25/09/12 20:23, Mike Khristo wrote:
>
>> node           : rabbit at rabbit-3
>> app descriptor :
>> /usr/lib/rabbitmq/lib/**rabbitmq_server-2.8.6/sbin/../**ebin/rabbit.app
>> home dir       : /var/lib/rabbitmq
>> config file(s) : /etc/rabbitmq/rabbitmq.config
>> cookie hash    : grkqGrreXu49Gonx6B/2AA==
>> log            : /var/log/rabbitmq/rabbit@**rabbit-3.log
>> sasl log       : /var/log/rabbitmq/rabbit@**rabbit-3-sasl.log
>> database dir   : /var/lib/rabbitmq/mnesia/**rabbit at rabbit-3
>> erlang version : 5.8.3
>>
>
> That Erlang is quite old - R14B02 - I suggest you upgrade to the latest
> (R15B02). Hopefully then your rabbit will start up again.
>
> Regards,
>
> Matthias.
>



-- 
-mk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/0d8bceae/attachment.htm>

From dstolyarov at dataminr.com  Tue Sep 25 22:47:18 2012
From: dstolyarov at dataminr.com (Dmitriy Stolyarov)
Date: Tue, 25 Sep 2012 14:47:18 -0700 (PDT)
Subject: [rabbitmq-discuss] memory flow control
Message-ID: <0f493c8c-38e1-4a17-95a9-de57d4fd3539@googlegroups.com>

Hi,
Is there a way to have the producer throw an exception instead of just 
being blocked when high memory water mark is reached on the server? (Using 
java client)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/123bc8c3/attachment.htm>

From zanfranceschi at gmail.com  Tue Sep 25 22:51:36 2012
From: zanfranceschi at gmail.com (Francisco Aguiar Zanfranceschi)
Date: Tue, 25 Sep 2012 14:51:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Pub/Sub Guaranteed Delivery
In-Reply-To: <CACOPnvdwnW0oTdoZBJU4xLyU1Hu+PHcbQEBg_OazDptsixW+QA@mail.gmail.com>
References: <51e7c978-6638-488c-92bc-20e951a247d1@googlegroups.com>
	<2f0c96f7-4709-4e4c-8a68-6acd225a7c52@googlegroups.com>
	<CACOPnveygWXQxdRuTV=-ATGp8b+=6QW3cLr+JGcZObrU2FPo5w@mail.gmail.com>
	<94f6ab53-67c8-4d2a-a03e-a2273e350b0a@googlegroups.com>
	<CACOPnvdwnW0oTdoZBJU4xLyU1Hu+PHcbQEBg_OazDptsixW+QA@mail.gmail.com>
Message-ID: <45caa709-977b-42f1-b7b7-2290760fd360@googlegroups.com>

Thanks again, Alexis.

On Tuesday, 25 September 2012 17:02:51 UTC-3, Alexis Richardson wrote:
>
> On Tue, Sep 25, 2012 at 5:55 PM, Francisco Aguiar Zanfranceschi 
> <zanfra... at gmail.com <javascript:>> wrote: 
> > Thanks for your reply, Alexis. I guess what you said I can see in a non 
> > pub/sub (using fanout) scenario (persistent, durable, ack)... Am I 
> > understanding your response right? 
>
> No, in the sense that persistent, durable, ack are all things that 
> work with Rabbit pub/sub.  This example is not using fanout: 
>
> http://www.rabbitmq.com/tutorials/tutorial-four-python.html 
>
>
> > I've searched extensively for this 
> > answer, but I found there is no out of the box solution in RabbitMQ (and 
> > most of other queue solutions), so I'm trying to find good practices to 
> > achieve it -- pub/sub technique to "guarantee" messages are delivered to 
> all 
> > subscribers. I'm trying to avoid the idea of building a custom 
> lightweight 
> > middleware (although my diagram represents one in some sense). 
> > 
> > I couldn't find the post you mentioned -- would you mind pointing it to 
> me, 
> > please? 
>
>
> It's this one: http://www.rabbitmq.com/tutorials/tutorial-four-python.html 
>
> alexis 
>
>
> > Thanks again. 
> > 
> > Francisco 
> > 
> > 
> > On Tuesday, 25 September 2012 13:10:47 UTC-3, Alexis Richardson wrote: 
> >> 
> >> On Tue, Sep 25, 2012 at 1:10 PM, Francisco Aguiar Zanfranceschi 
> >> <zanfra... at gmail.com> wrote: 
> >> > I'd like to say that's probably easier if I ask what's the best way 
> to 
> >> > guarantee all subscribers receive all messages even when they go 
> offline 
> >> > using RabbitMQ. I imagine all of us had that challenge or will have 
> it 
> >> > sooner or later. I'm sorry to kind of bump this discussion. 
> >> 
> >> You want to make sure that each consumer (subscribed client) can have 
> >> its messages held in a queue, while it is offline, so that it can get 
> >> the messages when it reconnects.  This is achievable using the pattern 
> >> I linked to in my previous post on this thread. 
> >> 
> >> Then, you need to make sure that when it does connect, the messages 
> >> get to the consumer and only after you know that happened, is the 
> >> message deleted from the queue.  This is achievable by using 
> >> acknowledgement. 
> >> 
> >> Does this answer your question? 
> >> 
> >> It is also important to understand the failure scenarios clearly, 
> >> whenever words like "guarantee" are bandied about ;-) 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120925/9ee3a888/attachment.htm>

From matthias at rabbitmq.com  Tue Sep 25 23:07:09 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 25 Sep 2012 23:07:09 +0100
Subject: [rabbitmq-discuss] Rabbit won't restart - no next heap size
	found
In-Reply-To: <CAJ0FASogr824Uw37GnpMKG4_su60wC1uXnxVTfWd+CdkAQySwA@mail.gmail.com>
References: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>
	<5061F578.6080300@rabbitmq.com>
	<CAJ0FASqDONKd-UL-EbitRqA6h3zaeqxAG9LZFKmoQTsFyck0=A@mail.gmail.com>
	<50620619.8050108@rabbitmq.com>
	<CAJ0FASogr824Uw37GnpMKG4_su60wC1uXnxVTfWd+CdkAQySwA@mail.gmail.com>
Message-ID: <50622B0D.7050709@rabbitmq.com>

Mike,

On 25/09/12 22:10, Mike Khristo wrote:
> Upgraded to erlang 5.9.2.
>
> eheap_alloc: Cannot allocate 11037567056 bytes of memory (of type
> "heap").

That's better. Sort of.

> How can I get rabbit to start w/o using so much memory?

You probably can't.

> It was only using 30G out of the 68G avail while it was running

That is more than the 0.4*total_memory default high watermark. 
Presumably you have altered that threshold in the config. There's a 
reason it's set to 0.4 by default - rabbit can take up all the rest 
temporarily in some circumstances. So you were living on the edge somewhat.

> This is a production box and I need to get access to the 300M
> messages asap.

I suggest you configure some temporary swap space. That should hopefully 
allow rabbit to start up and recover all the messages. And, with any 
luck, once it's done all that memory usage might drop off a bit.

Would be good to keep an eye on memory use during that startup/recovery 
phase and send us that plus the log files. And if you have some disk 
space to spare where you can stash away a copy of the database dir 
before you start rabbit that would be great.

With all that info we might be able to identify whether we are missing a 
trick somewhere in conserving memory during startup, and address that in 
a future release.


Regards,

Matthias.

From jervisliu at gmail.com  Wed Sep 26 03:50:40 2012
From: jervisliu at gmail.com (Jervis Liu)
Date: Wed, 26 Sep 2012 10:50:40 +0800
Subject: [rabbitmq-discuss] rabbitmq_web_stomp and
 rabbitmq_web_stomp_examples plugins for the current RabbitMQ release
 (2.8.6)?
In-Reply-To: <50614D53.4060501@rabbitmq.com>
References: <CAM9W9p3UBMLv5JH3hUCzG1n9ni0-er5peHJF1cx6U-O_DfDPBA@mail.gmail.com>
	<50614D53.4060501@rabbitmq.com>
Message-ID: <CAM9W9p0uiPqxrvmpvK-GBqmc4vr+ux6O8F+2gbiADmu9p4BmCA@mail.gmail.com>

The plugin installation works fine. When I restart rabbitMQ, it gives
a status of [fail]:

root at hw2:~# sudo /etc/init.d/rabbitmq-server restart
 * Restarting message broker rabbitmq-server                             [fail]

The log from startup_err:

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,cowboy,{shutdown,{cowboy_app,start,[normal,[]]}}})

The erl_crash.dump file is quite big, about 1.5M. I can send the file
if anyone wants to take a look. At the same time, I've enclosed part
of the dump file below, in case the information is enough for you to
see the problem:

=erl_crash_dump:0.1
Tue Sep 25 23:35:14 2012
Slogan: Kernel pid terminated (application_controller)
({application_start_failure,cowboy,{shutdown,{cowboy_app,start,[normal,[]]}}})
System version: Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:2:2]
[rq:2] [async-threads:30] [hipe] [kernel-poll:true]
Compiled: Fri Sep 24 19:15:42 2010
Atoms: 21311
=memory
total: 30364704
processes: 8915176
processes_used: 8788744
system: 21449528
atom: 1515601
atom_used: 1494056
binary: 13280
code: 18016857
ets: 59944
=hash_table:atom_tab
size: 19289
used: 12941
objs: 21311
depth: 8
=index_table:atom_tab
size: 21504
limit: 1048576
entries: 21311
=hash_table:module_code
size: 797
used: 506
objs: 529
depth: 2
=index_table:module_code
size: 1024
limit: 65536
entries: 529
=hash_table:export_list
size: 6421
used: 4826
objs: 8797
depth: 7
=index_table:export_list
size: 9216
limit: 524288
entries: 8797
=hash_table:secondary_export_table
size: 97
used: 0
objs: 0
depth: 0
=hash_table:process_reg
size: 11
used: 3
objs: 3
depth: 1
=hash_table:fun_table
size: 2411
used: 1912
objs: 3842
depth: 7
=hash_table:node_table
size: 5
used: 1
objs: 1
depth: 1
=hash_table:dist_table
size: 5
used: 1
objs: 1
depth: 1
=allocated_areas
sys_misc: 84020
static: 991232
atom_space: 327760 306575
atom_table: 326457
module_table: 14684
export_table: 125212
register_table: 180
fun_table: 19378
module_refs: 16384
loaded_code: 16593895
dist_table: 579
node_table: 179
bits_bufs_size: 0
bif_timer: 80056
link_lh: 0
proc: 108752 2440
atom_entry: 861384 861024
export_entry: 848376 848088
module_entry: 60752 59520
reg_proc: 4096 216
monitor_sh: 2952 72
nlink_sh: 13792 432
fun_entry: 341280 339696
db_tab: 35928 984
driver_event_data_state: 56 56
driver_select_data_state: 704 64


On Tue, Sep 25, 2012 at 2:21 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Jervis,
>
>
> On 25/09/12 05:51, Jervis Liu wrote:
>>
>> I would like the try the rabbitmq_web_stomp and its corresponding demo
>> documented by this post:
>> http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/.
>> However I could not find a version of rabbitmq_web_stomp and
>> rabbitmq_web_stomp_examples plugins that are compatible with the
>> current RabbitMQ release (2.8.6).
>>
>> I can only find rabbitmq_web_stomp-2.8.2.ez and
>> rabbitmq_web_stomp_examples-2.8.2.ez. I've tried these two plugins,
>> they do not work with 2.8.6.
>
>
> They *should* work with 2.8.6. What problems are you seeing? Any errors in
> the logs?
>
> Regards,
>
> Matthias.

From wongkamhoong at gmail.com  Wed Sep 26 07:18:16 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Wed, 26 Sep 2012 14:18:16 +0800
Subject: [rabbitmq-discuss] Often failed to produce message due to
 TIMEOUT WAITING FOR ACK
In-Reply-To: <50614FE4.3010105@rabbitmq.com>
References: <CAHv8OSQS_QMK5e9binBCN1vsTepk7bpp2sBwG40umVOC00AdsA@mail.gmail.com>
	<50614FE4.3010105@rabbitmq.com>
Message-ID: <CAHv8OSRtNX7Z+hPp072HRmv3QjV_+=-TX9hmgZ02+1zvBZJwaA@mail.gmail.com>

Hi  Matthias,

What's the general health of your rabbit when this happens?
The RabbitMQ nodes seems fine during the incident happened:

*Master Node Usage*
Memory : 300M
CPU %  : Average 30%

*Slave Node Usage*
Memory : 130M
CPU %  : Average 30%

Plenty of free memory and disk?
Yes, there are plenty of free memory and disk space in both servers.

Are you using mirrored/HA queues at all?
Yes, I'm using HA in all queues.

Could there possibly be a spike, i.e. lots of messages getting published in
a short space of time?
No, I checked there are only few messages during that time, e.g. 2012-09-26
03:28:32 => 4 messages

No strange errors in the logs?
After the incident happened RabbitMQ did logged warning, e.g.

*RabbitMQ Log*
*
*
=WARNING REPORT==== 26-Sep-2012::03:29:25 ===
closing AMQP connection <0.8661.18> (192.168.0.100:46151 ->
192.168.0.100:5672):
connection_closed_abruptly

=INFO REPORT==== 26-Sep-2012::03:29:37 ===
accepting AMQP connection <0.8897.18> (192.168.0.100:43836 ->
192.168.0.100:5672)


Regards,
Wong

On Tue, Sep 25, 2012 at 2:32 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Wong,
>
>
> On 25/09/12 03:46, Wong Kam Hoong wrote:
>
>> com.rabbitmq.client.**ShutdownSignalException: clean channel shutdown;
>> reason: #method<channel.close>(reply-**code=406, reply-text=TIMEOUT
>> WAITING FOR ACK, class-id=0, method-id=0)
>>          at
>> com.rabbitmq.client.impl.**ChannelN.waitForConfirms(**ChannelN.java:182)
>>
>> Based on the log, the problem seems like related to "*NACKS Received*"
>> and "*ChannelN*" code throw the TimeoutException with reply-code *406
>> *(PRECONDITION_FAILED).
>>
>
> I don't think it has anything to do with nacks - unless you are actually
> seeing some exception mentioning nacks.
>
> Looks like a straightforward timeout.
>
>  I check all RabbitMQ servers are still working fine and I believe the
>> time I set for *waitForConfirmsOrDie *(10000) should be sufficient enough.
>>
>
> 10s should indeed generally be long enough. But one can certainly envision
> scenarios where it won't be. What's the general health of your rabbit when
> this happens? Plenty of free memory and disk? No strange errors in the
> logs? Are you using mirrored/HA queues at all? Could there possibly be a
> spike, i.e. lots of messages getting published in a short space of time?
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/ebb8abc7/attachment.htm>

From matthias at rabbitmq.com  Wed Sep 26 08:17:28 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 26 Sep 2012 08:17:28 +0100
Subject: [rabbitmq-discuss] Often failed to produce message due to
 TIMEOUT WAITING FOR ACK
In-Reply-To: <CAHv8OSRtNX7Z+hPp072HRmv3QjV_+=-TX9hmgZ02+1zvBZJwaA@mail.gmail.com>
References: <CAHv8OSQS_QMK5e9binBCN1vsTepk7bpp2sBwG40umVOC00AdsA@mail.gmail.com>
	<50614FE4.3010105@rabbitmq.com>
	<CAHv8OSRtNX7Z+hPp072HRmv3QjV_+=-TX9hmgZ02+1zvBZJwaA@mail.gmail.com>
Message-ID: <5062AC08.9060606@rabbitmq.com>

Wong,

On 26/09/12 07:18, Wong Kam Hoong wrote:
> *_Master Node Usage_*
> Memory : 300M
> CPU %  : Average 30%
>
> _*Slave Node Usage*_
> Memory : 130M
> CPU %  : Average 30%
>
> there are only few messages during that time, e.g.
> 2012-09-26 03:28:32 => 4 messages

If the CPU is averaging 30% when the load is so low then the machines 
must be doing something else too. I notice from...

> =INFO REPORT==== 26-Sep-2012::03:29:37 ===
> accepting AMQP connection <0.8897.18> (192.168.0.100:43836
> <http://192.168.0.100:43836/> -> 192.168.0.100:5672
> <http://192.168.0.100:5672/>)

...that your clients are on the same machine as one of the nodes. Could 
it be that the machine was busy with other tasks, such as your application?

Also, 3:29 in the morning is just the sort of time that I'd expect 
systems to run various housekeeping tasks which could hammer the CPU or 
disk. Those can result in significant delays, particularly when your 
messages persistent.

I recommend increasing the timeout substantially, e.g. to 1 minute. That 
way if the problem really is just due to load it will go away.

> Are you using mirrored/HA queues at all?
> Yes, I'm using HA in all queues.

We are aware of two bugs in 2.8.x that can cause confirms to go missing. 
One of them involved setting an x-message-ttl=0 on queues and use of the 
'immediate' flag on publish. So if you are doing that then, well, don't 
:). The 2nd issue involves (re)starting of nodes. So check whether any 
of the nodes in your cluster (re)started around the time of the problem.

Regards,

Matthias.

From tim at rabbitmq.com  Wed Sep 26 09:03:47 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 26 Sep 2012 09:03:47 +0100
Subject: [rabbitmq-discuss] memory flow control
In-Reply-To: <0f493c8c-38e1-4a17-95a9-de57d4fd3539@googlegroups.com>
References: <0f493c8c-38e1-4a17-95a9-de57d4fd3539@googlegroups.com>
Message-ID: <B21A00AB-5549-4287-904F-95172A8689B9@rabbitmq.com>


On 25 Sep 2012, at 22:47, Dmitriy Stolyarov wrote:

> Hi,
> Is there a way to have the producer throw an exception instead of just being blocked when high memory water mark is reached on the server? (Using java client)_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

That isn't possible with the current incarnation of the java client, and I'm not entirely sure how one would expect that to work in practice either. But anyway the short answer is no, that's not possible. There are probably things you could do to work around it, such as having a separate worker thread on which you poll the management API to check and see if you've reached the high watermark, but it doesn't feel like a very satisfying solution overall.

What are you trying to achieve here - why do you want an exception when the high water mark is reached, how will your application respond to that?

From emile at rabbitmq.com  Wed Sep 26 10:01:37 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 26 Sep 2012 10:01:37 +0100
Subject: [rabbitmq-discuss] C# posted messages to topic queue aren't
 going away when subscriber acks
In-Reply-To: <84838a93-ef22-47e6-8a55-f1737dfe9ca2@googlegroups.com>
References: <84838a93-ef22-47e6-8a55-f1737dfe9ca2@googlegroups.com>
Message-ID: <5062C471.1050705@rabbitmq.com>

Hi,

On 25/09/12 18:44, Adam Polanski wrote:
> posting messages to a durable,noAutodelete topic queue

I assume you mean topic exchange.

> retrieving the messages, processing and acknowledging them. The messages
> that are on the main topic queue are sometimes draining to the relevant
> subscription queues, but not always, so over time, some messages are
> being left on the queue (even after having been processed by a
> subscription).

If a message that has been processed reappears in the queue then it must
have been consumed without auto-ack, and the broker never received the
acknowledgement. The message will be returned to the queue if the
message consumer requeues the message, or if the connection between the
consumer and the broker drops.


-Emile

From emile at rabbitmq.com  Wed Sep 26 11:08:46 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 26 Sep 2012 11:08:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ STOMP Adapter - How to get the RPC
 reply messages?
In-Reply-To: <cd91aecb-ce3c-4355-b02a-119fdf7c579f@googlegroups.com>
References: <cd91aecb-ce3c-4355-b02a-119fdf7c579f@googlegroups.com>
Message-ID: <5062D42E.6030608@rabbitmq.com>

Hi,

On 24/09/12 15:14, Tiago Alves wrote:
> (example: replyTo: '/reply-queue/amq.gen-w2jykNGp4DNDBADm3C4Cdx'). Still

That not a recognised header instead of "replyTo" it should be "reply-to".

> in my server-side client, I can reply to the message just by publishing
> a message to "/reply-queue/amq.gen-w2jykNGp4DNDBADm3C4Cdx".

Correct, assuming your server-side uses STOMP.

> So, how do I subscribe to the reply-to queue? How can I get the results
> of RPC calls?

You don't have to - the subscription is made for you automatically when
you use the "reply-to" header.

I would suggest that you verify this by hand first and only then move on
to confirming that it also works with your websockets library.


-Emile



From m.luchak at smartasking.com  Wed Sep 26 13:14:48 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Wed, 26 Sep 2012 08:14:48 -0400 (EDT)
Subject: [rabbitmq-discuss] =?utf-8?q?list=5Fbindings_for_a_specific_excha?=
	=?utf-8?q?nge?=
Message-ID: <1348661688.614322421@apps.rackspace.com>


Hi All,
 
I'm looking to return the bindings on a specific exchange and take action based on this information.  Using rabbitmqctl I can retrieve this information and I was hoping to write a script on top of rabbitmqctl to parse the return of list_binding.
 
But before I do...
 
Am I re-inventing the wheel here - is there a plug-in that I am ignorant of that has this kind of functionality?
 
thanks,
matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/d4457afc/attachment.htm>

From simon at rabbitmq.com  Wed Sep 26 13:20:53 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 26 Sep 2012 13:20:53 +0100
Subject: [rabbitmq-discuss] list_bindings for a specific exchange
In-Reply-To: <1348661688.614322421@apps.rackspace.com>
References: <1348661688.614322421@apps.rackspace.com>
Message-ID: <5062F325.3010802@rabbitmq.com>

On 26/09/12 13:14, m.luchak at smartasking.com wrote:
> I'm looking to return the bindings on a specific exchange and take
> action based on this information. Using rabbitmqctl I can retrieve this
> information and I was hoping to write a script on top of rabbitmqctl to
> parse the return of list_binding.
>
> But before I do...
>
> Am I re-inventing the wheel here - is there a plug-in that I am ignorant
> of that has this kind of functionality?

Not for rabbitmqctl.

The management HTTP API gives you these:

/api/exchanges/<vhost>/<name>/bindings/source
/api/exchanges/<vhost>/<name>/bindings/destination

(the destination one is for e2e bindings).

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_8_6/priv/www/api/index.html


Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Wed Sep 26 13:22:34 2012
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 26 Sep 2012 13:22:34 +0100
Subject: [rabbitmq-discuss] rabbitmq_web_stomp and
 rabbitmq_web_stomp_examples plugins for the current RabbitMQ release
 (2.8.6)?
In-Reply-To: <CAM9W9p0uiPqxrvmpvK-GBqmc4vr+ux6O8F+2gbiADmu9p4BmCA@mail.gmail.com>
References: <CAM9W9p3UBMLv5JH3hUCzG1n9ni0-er5peHJF1cx6U-O_DfDPBA@mail.gmail.com>
	<50614D53.4060501@rabbitmq.com>
	<CAM9W9p0uiPqxrvmpvK-GBqmc4vr+ux6O8F+2gbiADmu9p4BmCA@mail.gmail.com>
Message-ID: <CABzX+qz489OQTPpDCAKAyn_3-Qb9fTWCZprVBEhA5BruvTTE+g@mail.gmail.com>

On Wed, Sep 26, 2012 at 3:50 AM, Jervis Liu <jervisliu at gmail.com> wrote:
> =erl_crash_dump:0.1
> System version: Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:2:2]

Sorry to say, but R13B03 is _not_ supported by Rabbitmq-web-stomp.

As described in the original blog post:
 http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/

> You need at least Erlang R14 (more info).

Cheers,
 Marek

From m.luchak at smartasking.com  Wed Sep 26 15:25:27 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Wed, 26 Sep 2012 10:25:27 -0400 (EDT)
Subject: [rabbitmq-discuss] =?utf-8?q?Admin_User_other_than_guest_-_have_I?=
	=?utf-8?q?_missed_a_step=3F?=
Message-ID: <1348669527.354424035@apps.rackspace.com>


Hi All,
 
Following along with the web admin plug-in flow I created a new admin user - time to delete guest ;), but, am unable to log-in with this new user.
 
 rabbitmqctl list_users:
newuser [administrator]
 
I ran 
rabbitmqctl stop
./invoke-rc.d rabbitmq-server start


and the broker is running... but still cannot log-in with the new user
Also, cannot connect to the broker with a client configured to use this new user..
 
Have I missed something? (2.8.6 - ubuntu)
 
thanks,
Matthew 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/1136aa13/attachment.htm>

From emile at rabbitmq.com  Wed Sep 26 15:33:20 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 26 Sep 2012 15:33:20 +0100
Subject: [rabbitmq-discuss] Startup problems after network issues
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6BBC@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6BBC@osl02-exc-001>
Message-ID: <50631230.9090701@rabbitmq.com>

Hi Jon,

On 24/09/12 13:17, Jon Bergli Heier wrote:
> During the weekend we had some minor network issues, after which one
> of the cluster nodes crashed and won't start up again.

The error in the logfile {mnesia_locker, ... ,granted} appears as the
result of a netsplit (nodes being unable to communicate). This is not a
situation the broker makes any attempt to deal with. If your cluster
will be subject to network interruptions on a regular basis then
consider some of the other distribution strategies:
http://www.rabbitmq.com/distributed.html

The simplest way of starting the failed node is to reset its database
and rejoin the cluster. The database can be reset by moving the database
directory out of the way. Mirrored queues should not be affected by the
loss of one node (as long as the remaining nodes were synchronised), but
any non-mirrored queues (together with their contents) that were defined
on the failing node will be lost.


-Emile


From gpothier at niclabs.cl  Wed Sep 26 15:38:33 2012
From: gpothier at niclabs.cl (Guillaume Pothier)
Date: Wed, 26 Sep 2012 10:38:33 -0400
Subject: [rabbitmq-discuss] Server memory leak with 2.8.6
Message-ID: <CA+T=oM0a1iCRkVuLa5zdZsMCE4cds=_n6cQQsAyqBeF8EK__XA@mail.gmail.com>

Hi, I have a problem that I think is the same as the one described there:
http://rabbitmq.1065348.n5.nabble.com/Excessive-memory-consumption-of-one-server-in-cluster-setup-td21617.html

We have a rather low volume application, with message rates well below
1000/sec. There is only one server. At some times, although neither the
size of the queues nor the message rates increase, Rabbit starts to very
quickly consume huge amounts of memory. It often goes up to its high
watermark limit and stops processing messages, and has to be restarted.

The attached screenshots show graphs of the total number of messages in all
queues vs. the memory used by Rabbit. They clearly show that the memory
increases are not linked to the size of the queues. I have the output of
rabbitmqctl report available, but as it is rather big I put it there:
http://depositfiles.com/files/e4nxc07f2

I'll be glad to help diagnosing this issue.

Kind regards,
Guillaume Pothier
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/0d6bd665/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: zabbix-1day.png
Type: image/png
Size: 38670 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/0d6bd665/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: zabbix-1week.png
Type: image/png
Size: 35710 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/0d6bd665/attachment-0001.png>

From simon at rabbitmq.com  Wed Sep 26 15:45:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 26 Sep 2012 15:45:26 +0100
Subject: [rabbitmq-discuss] Admin User other than guest - have I missed
 a step?
In-Reply-To: <1348669527.354424035@apps.rackspace.com>
References: <1348669527.354424035@apps.rackspace.com>
Message-ID: <50631506.8040709@rabbitmq.com>

On 26/09/12 15:25, m.luchak at smartasking.com wrote:
> Hi All,

Hi.

> Following along with the web admin plug-in flow I created a new admin
> user - time to delete guest ;), but, am unable to log-in with this new user.
>
> rabbitmqctl list_users:
>
> newuser [administrator]
>
> I ran
>
> rabbitmqctl stop
>
> ./invoke-rc.d rabbitmq-server start

(You don't need to restart here.)

> and the broker is running... but still cannot log-in with the new user
>
> Also, cannot connect to the broker with a client configured to use this
> new user..
>
> Have I missed something? (2.8.6 - ubuntu)

Have you granted this user permission to access any virtual hosts?

Have you checked you've got the password right?

The server logs might be of assistance in showing what is not working.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Sep 26 15:55:12 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 26 Sep 2012 15:55:12 +0100
Subject: [rabbitmq-discuss] Admin User other than guest - have I missed
 a step?
In-Reply-To: <1348670993.647818496@apps.rackspace.com>
References: <1348669527.354424035@apps.rackspace.com>
	<50631506.8040709@rabbitmq.com>
	<1348670993.647818496@apps.rackspace.com>
Message-ID: <50631750.9090801@rabbitmq.com>

(Please keep rabbitmq-discuss CCed)

On 26/09/12 15:49, m.luchak at smartasking.com wrote:
> hmmm.. I thought just creating as admin would automagically grant
> permissions...I've got the password correct.. when I access through the
> web admin "/api/users/newuser/permissions" it returns []

Well, the administrator tag is an additional thing used by mgmt, 
basically allowing the ability to do things which are not part of AMQP. 
Users still need regualr permissions for anything AMQPish (including 
things like declaring queues if done through mgmt).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From eugene.doktorov at gmail.com  Wed Sep 26 16:14:35 2012
From: eugene.doktorov at gmail.com (eugene)
Date: Wed, 26 Sep 2012 08:14:35 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit - Crash?
Message-ID: <1348672475476-22219.post@n5.nabble.com>

Hi,

RabbitMQ 2.8.6 terminated leaving the following in logs:

=ERROR REPORT==== 25-Sep-2012::23:36:07 ===
** Generic server mnesia_sync terminating
** Last message in was timeout
** When Server state == {state,[{<0.31634.9>,#Ref<0.0.8.19505>}],true}
** Reason for termination ==
**
{{badmatch,{error,{file_error,"/var/lib/rabbitmq/mnesia/rabbit at stgback/LATEST.LOG",
                                 enospc}}},
    [{mnesia_sync,handle_info,2},
     {gen_server,handle_msg,5},
     {proc_lib,init_p_do_apply,3}]}

=ERROR REPORT==== 25-Sep-2012::23:36:07 ===
** Generic server <0.31634.9> terminating
** Last message in was {basic_cancel,<0.31633.9>,<<"633">>,
                                     {'basic.cancel_ok',<<"633">>}}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"/">>,queue,
                           <<"704b40896d5947df8a0838616ba18462">>},
                          false,true,none,
                          [{<<"x-expires">>,signedint,300000}],
                          <0.31634.9>,[],undefined},
                         none,true,rabbit_variable_queue,
                         {vqstate,
                          {0,{[],[]}},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {0,{[],[]}},
                          0,
                          {0,nil},
                          undefined,
                          {0,nil},
                          {qistate,
                          
"/var/lib/rabbitmq/mnesia/rabbit at stgback/queues/D297LZX7459XHE45UP1X6ZYM1",
                           {{dict,0,16,16,8,80,48,
                            
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                             {{[],[],[],[],[]
                                                       
What could be the reason?
What additional info is necessary?

I looked through /var/lib/rabbitmq/mnesia/rabbit at stgback/LATEST.LOG. Some
binary format, no obvious things found.

Thank you!

Eugene






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbit-Crash-tp22219.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Wed Sep 26 16:35:16 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 26 Sep 2012 16:35:16 +0100
Subject: [rabbitmq-discuss] Server memory leak with 2.8.6
In-Reply-To: <CA+T=oM0a1iCRkVuLa5zdZsMCE4cds=_n6cQQsAyqBeF8EK__XA@mail.gmail.com>
References: <CA+T=oM0a1iCRkVuLa5zdZsMCE4cds=_n6cQQsAyqBeF8EK__XA@mail.gmail.com>
Message-ID: <506320B4.1010000@rabbitmq.com>

Hi,

On 26/09/12 15:38, Guillaume Pothier wrote:
> I have the output of rabbitmqctl report available, but as it is rather big

I don't see anything obvious. Queues only account for 100-150Mb of RAM,
so lack of correlation in the graphs is understandable. Have you tried
to correlate RAM usage with any other parameters (such as network bandwith)?

Could you please supply the output of this command the next time RAM
usage stays inexplicably high?

rabbitmqctl eval
'lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
Pid, process_info(Pid)} || Pid <- processes()])), 30).'


-Emile



From alan.antonuk at gmail.com  Wed Sep 26 16:37:44 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 26 Sep 2012 11:37:44 -0400
Subject: [rabbitmq-discuss] Support for Python 3.x in rabbitmq-codegen
Message-ID: <CAAt2po+c6vrsjMzxojZcz0MbYuNfHQKaGK=MPgkjV=GmZpYnhA@mail.gmail.com>

I've made one very small change to the amqp_codegen.py in the
rabbitmq-codegen repository to support running it under python 3.x (after
running the 2to3 utility on it)

The change and other supporting information can be found here:
https://github.com/rabbitmq/rabbitmq-codegen/pull/2

Would the RabbitMQ team be willing to accept this change?

Thanks
-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/8afe3dba/attachment.htm>

From gpothier at niclabs.cl  Wed Sep 26 16:43:33 2012
From: gpothier at niclabs.cl (Guillaume Pothier)
Date: Wed, 26 Sep 2012 11:43:33 -0400
Subject: [rabbitmq-discuss] Server memory leak with 2.8.6
In-Reply-To: <506320B4.1010000@rabbitmq.com>
References: <CA+T=oM0a1iCRkVuLa5zdZsMCE4cds=_n6cQQsAyqBeF8EK__XA@mail.gmail.com>
	<506320B4.1010000@rabbitmq.com>
Message-ID: <CA+T=oM1xd1mG-mW6wtTvxT7CJast_=JfL+LMFOo9ENjCj2J0Yg@mail.gmail.com>

We tried to correlate it with disk activity, and we didn't see any
relation. We haven't tried with network traffic, we'll try that.
Thanks for the help, I'll run the command you indicated next time we see
this behavior.
Regards,
g

On Wed, Sep 26, 2012 at 12:35 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 26/09/12 15:38, Guillaume Pothier wrote:
> > I have the output of rabbitmqctl report available, but as it is rather
> big
>
> I don't see anything obvious. Queues only account for 100-150Mb of RAM,
> so lack of correlation in the graphs is understandable. Have you tried
> to correlate RAM usage with any other parameters (such as network
> bandwith)?
>
> Could you please supply the output of this command the next time RAM
> usage stays inexplicably high?
>
> rabbitmqctl eval
> 'lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
> Pid, process_info(Pid)} || Pid <- processes()])), 30).'
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/6d514ff1/attachment.htm>

From simon at rabbitmq.com  Wed Sep 26 16:44:49 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 26 Sep 2012 16:44:49 +0100
Subject: [rabbitmq-discuss] Rabbit - Crash?
In-Reply-To: <1348672475476-22219.post@n5.nabble.com>
References: <1348672475476-22219.post@n5.nabble.com>
Message-ID: <506322F1.9070302@rabbitmq.com>

On 26/09/12 16:14, eugene wrote:
> RabbitMQ 2.8.6 terminated leaving the following in logs:

<snip>

> {{badmatch,{error,{file_error,"/var/lib/rabbitmq/mnesia/rabbit at stgback/LATEST.LOG",
>                                   enospc}}},

You ran out of disc space, which RabbitMQ does not handle well.

Which is why we added disc space monitoring in 2.8.2 - when you get to < 
1GB free disc space RabbitMQ should start blocking publishes.

But in your case it (presumably) didn't. Or else you managed to get 
RabbitMQ to fill up the disc without accepting publishes.

In either case I am curious as to how you managed to do that :-) Have 
you changed the disc space limit? Were you declaring vast numbers of 
queues / exchanges / etc? Is 
/var/lib/rabbitmq/mnesia/rabbit at stgback/LATEST.LOG on a tiny partition? 
Can you post the contents of /var/log/rabbitmq somewhere?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From cybertoast at gmail.com  Wed Sep 26 16:52:57 2012
From: cybertoast at gmail.com (Sundar)
Date: Wed, 26 Sep 2012 11:52:57 -0400
Subject: [rabbitmq-discuss] Problem with rabbitmq-server.init
Message-ID: <CAHyXxcf-j3qjaM133SAKM-kUHs+DtL84626AT6iLF88n+w9FUA@mail.gmail.com>

The rabbitmq Fedora init script does not daemonize correctly (AFAICT). The
current script also does not match the Debian daemonization (using
start-stop-daemon).

Following is a patch to use "daemon" to make it work (I think). I'd
appreciate any feedback. I'm also not sure how to submit a pull/patch
request so if this is not the right place to submit this please could
someone point me to the right place. I cloned the code from
http://hg.rabbitmq.com/rabbitmq-server

Thanks much.

$ hg diff
diff -r 8792fb52db8a packaging/RPMS/Fedora/rabbitmq-server.init
--- a/packaging/RPMS/Fedora/rabbitmq-server.init    Wed Sep 26 13:57:55
2012 +0100
+++ b/packaging/RPMS/Fedora/rabbitmq-server.init    Wed Sep 26 11:44:21
2012 -0400
@@ -10,8 +10,6 @@
 # Provides:          rabbitmq-server
 # Required-Start:    $remote_fs $network
 # Required-Stop:     $remote_fs $network
-# Default-Start:     3 4 5
-# Default-Stop:      0 1 2 6
 # Description:       RabbitMQ broker
 # Short-Description: Enable AMQP service provided by RabbitMQ broker
 ### END INIT INFO
@@ -26,12 +24,16 @@
 INIT_LOG_DIR=/var/log/rabbitmq
 PID_FILE=/var/run/rabbitmq/pid

-START_PROG= # Set when building package
+START_PROG="daemon --user=$USER"
 LOCK_FILE=/var/lock/subsys/$NAME

 test -x $DAEMON || exit 0
 test -x $CONTROL || exit 0

+# Source function library for the "daemon" function
+. /etc/rc.d/init.d/functions
+
+
 RETVAL=0
 set -e
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120926/6c8cc2cb/attachment.htm>

From jon.bergli.heier at zisson.no  Wed Sep 26 17:04:37 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Wed, 26 Sep 2012 16:04:37 +0000
Subject: [rabbitmq-discuss] Startup problems after network issues
In-Reply-To: <50631230.9090701@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6BBC@osl02-exc-001>,
	<50631230.9090701@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6D30@osl02-exc-001>

Hi, thanks for the reply. There shouldn't be any reasons for interruptions between the nodes, so hopefully that won't turn into a problem.

I'm still having some trouble bringing the node up however, even after resetting the database (I assume you mean the /var/lib/rabbitmq/mnesia directory).
Even after moving the directory I keep getting the exact same message as you can see at the end of the log file I attached on the last email (from the rabbitmq_management plugin).
I've also tried commenting out cluster_nodes in rabbitmq.config and followed the clustering guide (http://www.rabbitmq.com/clustering.html) but still no luck.
(Note that I haven't done any changes to rmq-002, which is still running)

Jon

________________________________________
From: Emile Joubert [emile at rabbitmq.com]
Sent: Wednesday, September 26, 2012 16:33
To: Discussions about RabbitMQ
Cc: Jon Bergli Heier
Subject: Re: [rabbitmq-discuss] Startup problems after network issues

Hi Jon,

On 24/09/12 13:17, Jon Bergli Heier wrote:
> During the weekend we had some minor network issues, after which one
> of the cluster nodes crashed and won't start up again.

The error in the logfile {mnesia_locker, ... ,granted} appears as the
result of a netsplit (nodes being unable to communicate). This is not a
situation the broker makes any attempt to deal with. If your cluster
will be subject to network interruptions on a regular basis then
consider some of the other distribution strategies:
http://www.rabbitmq.com/distributed.html

The simplest way of starting the failed node is to reset its database
and rejoin the cluster. The database can be reset by moving the database
directory out of the way. Mirrored queues should not be affected by the
loss of one node (as long as the remaining nodes were synchronised), but
any non-mirrored queues (together with their contents) that were defined
on the failing node will be lost.


-Emile

From eugene.doktorov at gmail.com  Wed Sep 26 17:13:19 2012
From: eugene.doktorov at gmail.com (eugene)
Date: Wed, 26 Sep 2012 09:13:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit - Crash?
In-Reply-To: <506322F1.9070302@rabbitmq.com>
References: <1348672475476-22219.post@n5.nabble.com>
	<506322F1.9070302@rabbitmq.com>
Message-ID: <1348675999382-22226.post@n5.nabble.com>

Hi Simon,

Thank you for replying!

I think you're right. The node Rabbit is running on is a development one
with limited disk space.

Knowing that, I put the following in rabbit config:

  {rabbit, [{disk_free_limit, 2097152}
             ]},

It might have influenced.
I just did not expect rabbit to crash, rather to raise some alarms.

Regards,

Eugene






--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbit-Crash-tp22219p22226.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed Sep 26 23:45:48 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 26 Sep 2012 23:45:48 +0100
Subject: [rabbitmq-discuss] Rabbit - Crash?
In-Reply-To: <1348675999382-22226.post@n5.nabble.com>
References: <1348672475476-22219.post@n5.nabble.com>
	<506322F1.9070302@rabbitmq.com>
	<1348675999382-22226.post@n5.nabble.com>
Message-ID: <5063859C.3050807@rabbitmq.com>

Eugene,

On 26/09/12 17:13, eugene wrote:
> I think you're right. The node Rabbit is running on is a development one
> with limited disk space.
>
> Knowing that, I put the following in rabbit config:
>
>    {rabbit, [{disk_free_limit, 2097152}
>               ]},
>
> It might have influenced.
> I just did not expect rabbit to crash, rather to raise some alarms.

I suspect the rabbit logs will show that an alarm was raised.

Rabbit's response to such an alarm is to block all publishers, since 
messages are generally the main source of memory and disk space growth 
in rabbit, by some margin.

However, other activities such as declaring durable exchanges/queues 
require disk space too. So does writing the log file (which, if it's on 
the same partition as the db dir will eat into the latter's space). 
Rabbit makes no attempt to curtail these activities.

Regards,

Matthias.

From emile at rabbitmq.com  Thu Sep 27 10:06:02 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 27 Sep 2012 10:06:02 +0100
Subject: [rabbitmq-discuss] Startup problems after network issues
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6D30@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6BBC@osl02-exc-001>,
	<50631230.9090701@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA5D4D6D30@osl02-exc-001>
Message-ID: <506416FA.7080806@rabbitmq.com>

Hi Jon,

On 26/09/12 17:04, Jon Bergli Heier wrote:
> I've also tried commenting out cluster_nodes in rabbitmq.config

Does the node that fails to start log anything to the console, the
startup log, the SASL log or the regular log? Are the enabled plugins
and configuration file for that node valid?


-Emile


From simon at rabbitmq.com  Thu Sep 27 10:14:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 27 Sep 2012 10:14:41 +0100
Subject: [rabbitmq-discuss] Rabbit - Crash?
In-Reply-To: <5063859C.3050807@rabbitmq.com>
References: <1348672475476-22219.post@n5.nabble.com>	<506322F1.9070302@rabbitmq.com>	<1348675999382-22226.post@n5.nabble.com>
	<5063859C.3050807@rabbitmq.com>
Message-ID: <50641901.60409@rabbitmq.com>

On 26/09/12 23:45, Matthias Radestock wrote:
>> I think you're right. The node Rabbit is running on is a development one
>> with limited disk space.
>>
>> Knowing that, I put the following in rabbit config:
>>
>>    {rabbit, [{disk_free_limit, 2097152}
>>               ]},
>>
>> It might have influenced.
>> I just did not expect rabbit to crash, rather to raise some alarms.
>
> I suspect the rabbit logs will show that an alarm was raised.
>
> Rabbit's response to such an alarm is to block all publishers, since
> messages are generally the main source of memory and disk space growth
> in rabbit, by some margin.

In addition, if the alarm goes off when there is only 2MB of disc space 
left, you're essentially stuck anyway - even blocking publishers is very 
unlikely to happen fast enough to stop you from consuming disc space 
before you run out of space.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Sep 27 10:33:51 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 27 Sep 2012 10:33:51 +0100
Subject: [rabbitmq-discuss] Server memory leak with 2.8.6
In-Reply-To: <CA+T=oM1xd1mG-mW6wtTvxT7CJast_=JfL+LMFOo9ENjCj2J0Yg@mail.gmail.com>
References: <CA+T=oM0a1iCRkVuLa5zdZsMCE4cds=_n6cQQsAyqBeF8EK__XA@mail.gmail.com>
	<506320B4.1010000@rabbitmq.com>
	<CA+T=oM1xd1mG-mW6wtTvxT7CJast_=JfL+LMFOo9ENjCj2J0Yg@mail.gmail.com>
Message-ID: <50641D7F.9080106@rabbitmq.com>

Hi Guillaume,

On 26/09/12 16:43, Guillaume Pothier wrote:
>     rabbitmqctl eval
>     'lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
>     Pid, process_info(Pid)} || Pid <- processes()])), 30).'


From jon.bergli.heier at zisson.no  Thu Sep 27 10:40:03 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Thu, 27 Sep 2012 09:40:03 +0000
Subject: [rabbitmq-discuss] Startup problems after network issues
In-Reply-To: <506416FA.7080806@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6BBC@osl02-exc-001>,
	<50631230.9090701@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA5D4D6D30@osl02-exc-001>,
	<506416FA.7080806@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6D64@osl02-exc-001>

Hi,

I don't see any messages on the console when starting the node.
There are messages in the logs however, I've attached these with the output from the latest attempt.
This is from after trying to join the cluster, with cluster_nodes still commented out. If I reset the database
without joining the cluster the node starts without any problems (but not clustered of course). I haven't
seen any errors related to the config file, so I guess that should be ok. rabbitmq_management is the
only plugin listed in the enabled_plugins file. The node seems to start up if I remove this, and
rabbitmqctl cluster_status then reports both nodes as running (on both nodes).

Jon
________________________________________
From: Emile Joubert [emile at rabbitmq.com]
Sent: Thursday, September 27, 2012 11:06
To: Jon Bergli Heier
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Startup problems after network issues

Hi Jon,

On 26/09/12 17:04, Jon Bergli Heier wrote:
> I've also tried commenting out cluster_nodes in rabbitmq.config

Does the node that fails to start log anything to the console, the
startup log, the SASL log or the regular log? Are the enabled plugins
and configuration file for that node valid?


-Emile

-------------- next part --------------
A non-text attachment was scrubbed...
Name: st-rmq-001.2.log
Type: text/x-log
Size: 4813 bytes
Desc: st-rmq-001.2.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/97c332bb/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: st-rmq-001-sasl.2.log
Type: text/x-log
Size: 2394 bytes
Desc: st-rmq-001-sasl.2.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/97c332bb/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: startup_log.2
Type: application/octet-stream
Size: 3821 bytes
Desc: startup_log.2
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/97c332bb/attachment.obj>

From tiago.alves at muzzley.com  Thu Sep 27 11:55:00 2012
From: tiago.alves at muzzley.com (Tiago Alves)
Date: Thu, 27 Sep 2012 11:55:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ STOMP Adapter - How to get the RPC
 reply messages?
In-Reply-To: <5062D42E.6030608@rabbitmq.com>
References: <cd91aecb-ce3c-4355-b02a-119fdf7c579f@googlegroups.com>
	<5062D42E.6030608@rabbitmq.com>
Message-ID: <CABsGVpaeSOq=DJOaB_Rmf_XJXbM_fbW3wA62gtbhPj-eqjrn_w@mail.gmail.com>

Thank you for the help, Emile.

Our server-side client is an AMQP client in node.js (node-amqp) that
connects directly to RabbitMQ. That's why I've mentioned that we have a
"replyTo" queue and not a "reply-to" in that client. (We do send the
message with a "reply-to" header in the STOMP client)

We've made progress and are now able to send back the reply from our
server-side client. We figured out that a reply queue such as
"/reply-queue/amq.gen-w2jykNGp4DNDBADm3C4Cdx" simply corresponds to the
RabbitMQ queue "amq.gen-w2jykNGp4DNDBADm3C4Cdx" in the default exchange.
Thus, we're now removing the "/reply-queue/" part of the replyTo header,
and using the result as the destination queue for the response. We're
assuming that this should/could be done transparently by an AMQP client
with the notion that RPC messages from STOMP clients will need this replyTo
string manipulation. Is this correct?

More details about a working solution can be found in this Stack Overflow
answer: http://stackoverflow.com/a/12591697

Thank you,
Tiago

On Wed, Sep 26, 2012 at 11:08 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 24/09/12 15:14, Tiago Alves wrote:
> > (example: replyTo: '/reply-queue/amq.gen-w2jykNGp4DNDBADm3C4Cdx'). Still
>
> That not a recognised header instead of "replyTo" it should be "reply-to".
>
> > in my server-side client, I can reply to the message just by publishing
> > a message to "/reply-queue/amq.gen-w2jykNGp4DNDBADm3C4Cdx".
>
> Correct, assuming your server-side uses STOMP.
>
> > So, how do I subscribe to the reply-to queue? How can I get the results
> > of RPC calls?
>
> You don't have to - the subscription is made for you automatically when
> you use the "reply-to" header.
>
> I would suggest that you verify this by hand first and only then move on
> to confirming that it also works with your websockets library.
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/daa6d6b4/attachment.htm>

From emile at rabbitmq.com  Thu Sep 27 12:10:32 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 27 Sep 2012 12:10:32 +0100
Subject: [rabbitmq-discuss] Problem with rabbitmq-server.init
In-Reply-To: <CAHyXxcf-j3qjaM133SAKM-kUHs+DtL84626AT6iLF88n+w9FUA@mail.gmail.com>
References: <CAHyXxcf-j3qjaM133SAKM-kUHs+DtL84626AT6iLF88n+w9FUA@mail.gmail.com>
Message-ID: <50643428.1040802@rabbitmq.com>

Hi,

Unfortunately most of these edits will be lost due to actions taken by
the Makefile in the same directory.

On 26/09/12 16:52, Sundar wrote:
> -# Default-Start:     3 4 5
> -# Default-Stop:      0 1 2 6

The RPM Makefile already does this.

> -START_PROG= # Set when building package
> +START_PROG="daemon --user=$USER"

Thanks for the suggestion. The START_PROG for the RPM package is
"runuser". We are aware that this is not suitable for all RPM
distributions (notably SuSE) and we intend to correct that.



Emile

From emile at rabbitmq.com  Thu Sep 27 12:20:28 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 27 Sep 2012 12:20:28 +0100
Subject: [rabbitmq-discuss] Problem with rabbitmq-server.init
In-Reply-To: <50643428.1040802@rabbitmq.com>
References: <CAHyXxcf-j3qjaM133SAKM-kUHs+DtL84626AT6iLF88n+w9FUA@mail.gmail.com>
	<50643428.1040802@rabbitmq.com>
Message-ID: <5064367C.9030102@rabbitmq.com>

On 27/09/12 12:10, Emile Joubert wrote:
> "runuser". We are aware that this is not suitable for all RPM
> distributions (notably SuSE) and we intend to correct that.

Let me correct that: START_PROG is currently set to runuser for Fedora
and setsid for SuSE-based distributions. We intend to make the scripts
more idiomatic for SuSE.

It is not clear from your patch what problem you are trying to solve.
Perhaps if you explain more what you intended to achieve we can help.


-Emile



From emile at rabbitmq.com  Thu Sep 27 14:34:53 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 27 Sep 2012 14:34:53 +0100
Subject: [rabbitmq-discuss] Startup problems after network issues
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6D64@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6BBC@osl02-exc-001>,
	<50631230.9090701@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA5D4D6D30@osl02-exc-001>,
	<506416FA.7080806@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA5D4D6D64@osl02-exc-001>
Message-ID: <506455FD.7040509@rabbitmq.com>

Hi Jon,

On 27/09/12 10:40, Jon Bergli Heier wrote:
> This is from after trying to join the cluster, with cluster_nodes
> still commented out.

The log entries indicate that the database was not reset at this time.

> If I reset the database without joining the cluster the node starts
> without any problems (but not clustered of course).

Great. You will need to reset the database. Do you see any errors if you
attempt to join the cluster after resetting the database?


-Emile




From jon.bergli.heier at zisson.no  Thu Sep 27 15:02:13 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Thu, 27 Sep 2012 14:02:13 +0000
Subject: [rabbitmq-discuss] Startup problems after network issues
In-Reply-To: <506455FD.7040509@rabbitmq.com>
References: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6BBC@osl02-exc-001>,
	<50631230.9090701@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA5D4D6D30@osl02-exc-001>,
	<506416FA.7080806@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA5D4D6D64@osl02-exc-001>,
	<506455FD.7040509@rabbitmq.com>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6DA3@osl02-exc-001>

Hi,

I still get errors when trying to join the cluster with rabbitmq_management enabled,
even after a reset. Please see the attached file for exact shell commands and output.

Jon

________________________________________
From: Emile Joubert [emile at rabbitmq.com]
Sent: Thursday, September 27, 2012 15:34
To: Jon Bergli Heier
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Startup problems after network issues

Hi Jon,

On 27/09/12 10:40, Jon Bergli Heier wrote:
> This is from after trying to join the cluster, with cluster_nodes
> still commented out.

The log entries indicate that the database was not reset at this time.

> If I reset the database without joining the cluster the node starts
> without any problems (but not clustered of course).

Great. You will need to reset the database. Do you see any errors if you
attempt to join the cluster after resetting the database?


-Emile



-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: st-rmq-002-shell.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/c4576224/attachment.txt>

From dada.chao.liu at gmail.com  Thu Sep 27 14:54:45 2012
From: dada.chao.liu at gmail.com (Chao Liu)
Date: Thu, 27 Sep 2012 21:54:45 +0800
Subject: [rabbitmq-discuss] rabbitmq fake-death && no breath. key word
 in log : mirrored_supervisor rabbit_mgmt_db
In-Reply-To: <505B4BCD.5000804@rabbitmq.com>
References: <97f32760-fca4-4bd7-af53-b9029cde0c2e@googlegroups.com>
	<505B4BCD.5000804@rabbitmq.com>
Message-ID: <CACS0wKXmRmRqyDDiLuCeSHOhmVu_ozbaxywxH8mBg9UEQRCV3A@mail.gmail.com>

hello,  Simon MacMullen.
today, rabbitmq down again.
the output of the sasl.log is the same with the last one. but there are
something new in the .log.
Could u help me to find out the problem ?  thanks

*disc node's log*
*
*
=INFO REPORT==== 27-Sep-2012::19:59:12 ===
rabbit on node rabbit at zw_124_156 down

=WARNING REPORT==== 27-Sep-2012::19:59:13 ===
Mnesia(rabbit at zw_124_177): ** WARNING ** Mnesia is overloaded: {dump_log,

time_threshold}

=INFO REPORT==== 27-Sep-2012::19:59:13 ===
    application: rabbitmq_management
    exited: shutdown
    type: temporary

-------------------------------------------------------
*ram node's log*
*
*
=ERROR REPORT==== 27-Sep-2012::19:54:11 ===
** Node rabbit at zw_124_177 not responding **
** Removing (timedout) connection **

=INFO REPORT==== 27-Sep-2012::19:54:11 ===
rabbit on node rabbit at zw_124_177 down

=INFO REPORT==== 27-Sep-2012::19:54:53 ===
Statistics database started.

=INFO REPORT==== 27-Sep-2012::19:59:13 ===
global: Name conflict terminating {rabbit_mgmt_db,<7123.24214.2613>}

=INFO REPORT==== 27-Sep-2012::19:59:13 ===
    application: rabbitmq_management
    exited: shutdown
    type: temporary


thanks.





2012/9/21 Simon MacMullen <simon at rabbitmq.com>

> Hi.
>
> This looks like a race with management DB failover that we've already
> fixed, but which has not yet made it into any release. This will be fixed
> in the next bugfix release. Until then if you are affected you can work
> around it by running the management plugin on only one node in the cluster
> (and just have rabbitmq_management_agent on the others).
>
> Cheers, Simon
>
> On 20/09/12 08:45, liubida wrote:
>
>> hi all,
>>
>> dose anybody could point me just the direction for finding the reason
>> for a fake-dead with the RabbitMQ.
>> it seem the rabbitmq could not receive messages in some point, without
>> any warning.
>> i have constructed a cluster with 2 nodes, one disc and one ram.
>> if i type the command "rabbitmqctl stop_app && rabbitmqctl start_app",
>> the troubleshoot disappered.
>>
>>
>> here is the disc node's sasl.log
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:13 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: child_terminated
>> Reason: killed
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: start_error
>> Reason: {already_started,<19704.13906.**2335>}
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: start_error
>> Reason: {already_started,<19704.13906.**2335>}
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: start_error
>> Reason: {already_started,<19704.13906.**2335>}
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: start_error
>> Reason: {already_started,<19704.13906.**2335>}
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: start_error
>> Reason: {already_started,<19704.13906.**2335>}
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: start_error
>> Reason: {already_started,<19704.13906.**2335>}
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: start_error
>> Reason: {already_started,<19704.13906.**2335>}
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: start_error
>> Reason: {already_started,<19704.13906.**2335>}
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: start_error
>> Reason: {already_started,<19704.13906.**2335>}
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: start_error
>> Reason: {already_started,<19704.13906.**2335>}
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {<0.28802.1777>,mirrored_**supervisor}
>> Context: shutdown
>> Reason: reached_max_restart_intensity
>> Offender: [{pid,<0.28804.1777>},
>> {name,rabbit_mgmt_db},
>> {mfa,{rabbit_mgmt_db,start_**link,[]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {local,rabbit_mgmt_sup}
>> Context: child_terminated
>> Reason: shutdown
>> Offender: [{pid,<0.28803.1777>},
>> {name,mirroring},
>> {mfa,
>> {mirrored_supervisor,start_**internal,
>> [rabbit_mgmt_sup,
>> [{rabbit_mgmt_db,
>> {rabbit_mgmt_db,start_link,[]}**,
>> permanent,4294967295,worker,
>> [rabbit_mgmt_db]}]]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>> Supervisor: {local,rabbit_mgmt_sup}
>> Context: shutdown
>> Reason: reached_max_restart_intensity
>> Offender: [{pid,<0.28803.1777>},
>> {name,mirroring},
>> {mfa,
>> {mirrored_supervisor,start_**internal,
>> [rabbit_mgmt_sup,
>> [{rabbit_mgmt_db,
>> {rabbit_mgmt_db,start_link,[]}**,
>> permanent,4294967295,worker,
>> [rabbit_mgmt_db]}]]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> the ram node's sasl.log
>> =SUPERVISOR REPORT==== 18-Sep-2012::17:24:50 ===
>> Supervisor: {local,rabbit_mgmt_sup}
>> Context: child_terminated
>> Reason: shutdown
>> Offender: [{pid,<0.14161.2335>},
>> {name,mirroring},
>> {mfa,
>> {mirrored_supervisor,start_**internal,
>> [rabbit_mgmt_sup,
>> [{rabbit_mgmt_db,
>> {rabbit_mgmt_db,start_link,[]}**,
>> permanent,4294967295,worker,
>> [rabbit_mgmt_db]}]]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>>
>> =SUPERVISOR REPORT==== 18-Sep-2012::17:24:50 ===
>> Supervisor: {local,rabbit_mgmt_sup}
>> Context: shutdown
>> Reason: reached_max_restart_intensity
>> Offender: [{pid,<0.14161.2335>},
>> {name,mirroring},
>> {mfa,
>> {mirrored_supervisor,start_**internal,
>> [rabbit_mgmt_sup,
>> [{rabbit_mgmt_db,
>> {rabbit_mgmt_db,start_link,[]}**,
>> permanent,4294967295,worker,
>> [rabbit_mgmt_db]}]]}},
>> {restart_type,permanent},
>> {shutdown,4294967295},
>> {child_type,worker}]
>>
>> Thanks for any help.
>>
>> --bidaliu
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/b59efdec/attachment.htm>

From gpothier at niclabs.cl  Thu Sep 27 15:20:03 2012
From: gpothier at niclabs.cl (Guillaume Pothier)
Date: Thu, 27 Sep 2012 10:20:03 -0400
Subject: [rabbitmq-discuss] Server memory leak with 2.8.6
In-Reply-To: <50641D7F.9080106@rabbitmq.com>
References: <CA+T=oM0a1iCRkVuLa5zdZsMCE4cds=_n6cQQsAyqBeF8EK__XA@mail.gmail.com>
	<506320B4.1010000@rabbitmq.com>
	<CA+T=oM1xd1mG-mW6wtTvxT7CJast_=JfL+LMFOo9ENjCj2J0Yg@mail.gmail.com>
	<50641D7F.9080106@rabbitmq.com>
Message-ID: <CA+T=oM31gDphx2UDVzfekBG+EzbhjwYXtc9onDAcUBJxvM0__A@mail.gmail.com>

Thanks Emile, I will try with these stanzas and tell you how it goes.
Regards,
g

On Thu, Sep 27, 2012 at 6:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Guillaume,
>
> On 26/09/12 16:43, Guillaume Pothier wrote:
> >     rabbitmqctl eval
> >     'lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
> >     Pid, process_info(Pid)} || Pid <- processes()])), 30).'
>
> From the output to this command that you sent me off-list it looks like
> statistics are generated too fast for the management database to keep
> up. Can I suggest that you turn off fine grained statistics (this will
> disable display of message rates) by adding this stanza to the config file:
>
>  {rabbitmq_management_agent, [{force_fine_statistics, false}]}
>
> and increase the statistics collection interval from 5000ms to higher
> number and see if that helps:
>
>  {rabbit, [{collect_statistics_interval, 10000}]}
>
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/99572ef9/attachment.htm>

From emile at rabbitmq.com  Thu Sep 27 15:53:43 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 27 Sep 2012 15:53:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.7 released
Message-ID: <50646877.8040306@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 2.8.7.

This is a bugfix release with corrections to the broker and Erlang
client, as well as the STOMP and management plugins.

See the attached release notes for more details.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                     The RabbitMQ Team
                     (http://www.rabbitmq.com)



-- 
Emile Joubert

RabbitMQ
SpringSource, a division of VMware
VMware




-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.8.7.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/3933f1a0/attachment.txt>

From cybertoast at gmail.com  Thu Sep 27 16:50:36 2012
From: cybertoast at gmail.com (Sundar)
Date: Thu, 27 Sep 2012 11:50:36 -0400
Subject: [rabbitmq-discuss] Problem with rabbitmq-server.init
In-Reply-To: <5064367C.9030102@rabbitmq.com>
References: <CAHyXxcf-j3qjaM133SAKM-kUHs+DtL84626AT6iLF88n+w9FUA@mail.gmail.com>
	<50643428.1040802@rabbitmq.com> <5064367C.9030102@rabbitmq.com>
Message-ID: <CAHyXxcf2VqK6eR+zGUmi4MLKOYhPAskamTgwjWrmZPw8VOLGCg@mail.gmail.com>

Hi Emile,
The problem is that I am trying to solve is as follows. I use
Fabric<http://fabfile.org>or
Ansible <http://ansible.cc> for my deployment process. Part of the
deployment process is to start/stop/restart certain services. What I found
is that running /etc/init.d/rabbitmq-server start would start the service,
but that the service would die right after the deployment task completed.

My understanding of debugging this problem is that the process is started
under the context of the deployer's connection to the remote host (the SSH
session) but as soon as that context dies the backgrounded process
(rabbitmq-server) also died. I was able to test this theory by putting in a
long wait at the end of the init.d/rabbitmq-server script and noticed that
the service stayed up during the wait, but as soon as the Ansible/Fabric
script exited the rabbitmq-server process also died. Note that this does
NOT happen under normal login. As a stop-gap fix I used nohup to ensure
that the process did not die, but upon discussion with others I was lead to
think that the init.d script may be malfunctioning.

Looking into the problem further I found that the Debian init script used
start-stop-daemon. The equivalent in RHEL seems to be the "daemon" function
in /etc/rc.d/init.d/functions. It's possible that I misunderstood this to
be present in all RHEL-type machines (it's present on my RHEL5.6+ and
CentOS 5.6+ machines).

Please let me know if the proposed fix is incorrect/problematic. I found
that applying this patch solved my problem, but perhaps there's a better
way to ensure that the backgrounded process (i.e., $START_PROG $DAEMON &)
does not die upon termination of the caller's shell context.

Thanks much.

On Thu, Sep 27, 2012 at 7:20 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> On 27/09/12 12:10, Emile Joubert wrote:
> > "runuser". We are aware that this is not suitable for all RPM
> > distributions (notably SuSE) and we intend to correct that.
>
> Let me correct that: START_PROG is currently set to runuser for Fedora
> and setsid for SuSE-based distributions. We intend to make the scripts
> more idiomatic for SuSE.
>
> It is not clear from your patch what problem you are trying to solve.
> Perhaps if you explain more what you intended to achieve we can help.
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120927/c34ff2a5/attachment.htm>

From emile at rabbitmq.com  Fri Sep 28 09:36:37 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 28 Sep 2012 09:36:37 +0100
Subject: [rabbitmq-discuss] Problem with rabbitmq-server.init
In-Reply-To: <CAHyXxcf2VqK6eR+zGUmi4MLKOYhPAskamTgwjWrmZPw8VOLGCg@mail.gmail.com>
References: <CAHyXxcf-j3qjaM133SAKM-kUHs+DtL84626AT6iLF88n+w9FUA@mail.gmail.com>
	<50643428.1040802@rabbitmq.com> <5064367C.9030102@rabbitmq.com>
	<CAHyXxcf2VqK6eR+zGUmi4MLKOYhPAskamTgwjWrmZPw8VOLGCg@mail.gmail.com>
Message-ID: <50656195.40901@rabbitmq.com>

Hi,

On 27/09/12 16:50, Sundar wrote:
> services. What I found is that running /etc/init.d/rabbitmq-server start
> would start the service, but that the service would die right after the
> deployment task completed.

Ok, now I understand the problem. Unfortunately your fix has missed the
v2.8.7 release, but we will include this in a future release. The
release notes should contain a comment to that effect when it gets
released. Thanks for reporting and solving the problem.


-Emile



From vitaly.krugl.numenta at gmail.com  Fri Sep 28 09:58:48 2012
From: vitaly.krugl.numenta at gmail.com (vitaly)
Date: Fri, 28 Sep 2012 01:58:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Haigha/gevent example for haigha 0.5.7
Message-ID: <e9b1c30e-3a44-4b54-b85f-80b65f74d46c@googlegroups.com>

I submitted a pull request in agoragames/haigha github with a haigha/gevent 
"Hello World" example app: https://github.com/agoragames/haigha/pull/27.

Hopes this helps,
Vitaly
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120928/d6cc071d/attachment.htm>

From vitaly.krugl.numenta at gmail.com  Fri Sep 28 10:02:17 2012
From: vitaly.krugl.numenta at gmail.com (vitaly)
Date: Fri, 28 Sep 2012 02:02:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Haigha fix for the warning "DeprecationWarning:
 gevent.coros has been renamed to gevent.lock"
Message-ID: <d13cd30b-8fb5-4a0a-8266-a2bbb20e3bdd@googlegroups.com>

This issue occurs with gevent 1.0b2 and newer; A pull request has been 
submitted to fix it: https://github.com/agoragames/haigha/issues/17.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120928/721506c9/attachment.htm>

From jon.bergli.heier at zisson.no  Fri Sep 28 10:12:33 2012
From: jon.bergli.heier at zisson.no (Jon Bergli Heier)
Date: Fri, 28 Sep 2012 09:12:33 +0000
Subject: [rabbitmq-discuss] Startup problems after network issues
In-Reply-To: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6DA3@osl02-exc-001>
References: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6BBC@osl02-exc-001>,
	<50631230.9090701@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA5D4D6D30@osl02-exc-001>,
	<506416FA.7080806@rabbitmq.com>
	<AD8BDDA3D61AC241BA02DED7063643BA5D4D6D64@osl02-exc-001>,
	<506455FD.7040509@rabbitmq.com>,
	<AD8BDDA3D61AC241BA02DED7063643BA5D4D6DA3@osl02-exc-001>
Message-ID: <AD8BDDA3D61AC241BA02DED7063643BA5D4D6DE6@osl02-exc-001>

Hi,

This seems to have sorted itself out after upgrading the nodes to 2.8.7.

Jon

________________________________________
From: Jon Bergli Heier
Sent: Thursday, September 27, 2012 16:02
To: Emile Joubert
Cc: Discussions about RabbitMQ
Subject: RE: [rabbitmq-discuss] Startup problems after network issues

Hi,

I still get errors when trying to join the cluster with rabbitmq_management enabled,
even after a reset. Please see the attached file for exact shell commands and output.

Jon

________________________________________
From: Emile Joubert [emile at rabbitmq.com]
Sent: Thursday, September 27, 2012 15:34
To: Jon Bergli Heier
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Startup problems after network issues

Hi Jon,

On 27/09/12 10:40, Jon Bergli Heier wrote:
> This is from after trying to join the cluster, with cluster_nodes
> still commented out.

The log entries indicate that the database was not reset at this time.

> If I reset the database without joining the cluster the node starts
> without any problems (but not clustered of course).

Great. You will need to reset the database. Do you see any errors if you
attempt to join the cluster after resetting the database?


-Emile



From lionel.cons at cern.ch  Fri Sep 28 13:30:20 2012
From: lionel.cons at cern.ch (Lionel Cons)
Date: Fri, 28 Sep 2012 14:30:20 +0200
Subject: [rabbitmq-discuss] Unnecessarily complex packaging (Fedora)
Message-ID: <20120928141742.5a8c.abe10f7e5afbbb3a79ce619739541149@cern.ch>

I've looked at the init script as part of rabbitmq-server-2.8.7-1.noarch.rpm
and I find it unnecessarily complex.

The script contains:

NAME=rabbitmq-server
DAEMON=/usr/sbin/${NAME}
CONTROL=/usr/sbin/rabbitmqctl
START_PROG="runuser rabbitmq --session-command"

To start RabbitMQ, START_PROG is used:

  RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON \

But not to stop it:

  $CONTROL stop ${PID_FILE} > ${INIT_LOG_DIR}/shutdown_log 2> ${INIT_LOG_DIR}/shutdown_err

This magically works because /usr/sbin/rabbitmqctl is a wrapper (optionally)
using su and calling the eponymous script under /usr/lib/rabbitmq/bin.

/usr/sbin/rabbitmq-server is also a wrapper (the exact same one in fact) but
this is not needed since the change of user is already done by START_PROG in
/etc/rc.d/init.d/rabbitmq-server.

Hence my questions:
 - why using sometimes runuser and sometimes su to change user?
 - why changing user in two different places (init script and wrapper)?

Cheers,

Lionel

From simon at rabbitmq.com  Fri Sep 28 13:54:17 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Sep 2012 13:54:17 +0100
Subject: [rabbitmq-discuss] Unnecessarily complex packaging (Fedora)
In-Reply-To: <20120928141742.5a8c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20120928141742.5a8c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <50659DF9.6030805@rabbitmq.com>

On 28/09/12 13:30, Lionel Cons wrote:
> I've looked at the init script as part of rabbitmq-server-2.8.7-1.noarch.rpm
> and I find it unnecessarily complex.

It *is* complex. I *think* all the complexity is necessary.

<snip description of how it all works>

> Hence my questions:
>   - why using sometimes runuser and sometimes su to change user?

We originally always used su. However, su is considered to start a login 
session, which means that under some common PAM configurations the 
"rabbitmq" user was considered always logged in. This prevented users 
from shutting down desktops / laptops on which rabbitmq-server was 
installed.

So why not use runuser all the time? Well, we want to try to keep the 
distro-specific parts of the server package as minimal as possible - the 
init script is distro specific but the wrapper scripts are not.

So on Debian / Ubuntu we start the server with start-stop-daemon rather 
than runuser. In fact it's not obvious that runuser is right for RPMs 
either, see thread here: 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-September/022706.html. 
Maybe we should be using "daemon" instead, at least on RHEL/Fedora RPMs.

But if we use start-stop-daemon / daemon to start the server, we 
certainly shouldn't use the same thing to invoke rabbitmqctl. 
rabbitmqctl is not a daemon. And we use rabbitmqctl to stop the server.

>   - why changing user in two different places (init script and wrapper)?

We need to change user in the init script in order to do the 
distro-specific magic that marks the process as a daemon. We need to 
change user in the wrapper so that rabbitmqctl can work. We also (to 
some extent) want to support running the server by invoking 
/usr/sbin/rabbitmq-server, in case you only want to start it for 
development.

So it's certainly possible that this could be arranged differently. We 
could have a separate wrapper for rabbitmq-server and make that wrapper 
vary by distro. I don't think that would count as any simpler though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From cybertoast at gmail.com  Fri Sep 28 14:41:27 2012
From: cybertoast at gmail.com (Sundar)
Date: Fri, 28 Sep 2012 09:41:27 -0400
Subject: [rabbitmq-discuss] Problem with rabbitmq-server.init
In-Reply-To: <50656195.40901@rabbitmq.com>
References: <CAHyXxcf-j3qjaM133SAKM-kUHs+DtL84626AT6iLF88n+w9FUA@mail.gmail.com>
	<50643428.1040802@rabbitmq.com> <5064367C.9030102@rabbitmq.com>
	<CAHyXxcf2VqK6eR+zGUmi4MLKOYhPAskamTgwjWrmZPw8VOLGCg@mail.gmail.com>
	<50656195.40901@rabbitmq.com>
Message-ID: <CAHyXxcd-G0eJ1ztd6Y_ONRWsPfPC5K5=My_rSQ2ztoE-H6qBdw@mail.gmail.com>

Thanks Emile.

On Fri, Sep 28, 2012 at 4:36 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 27/09/12 16:50, Sundar wrote:
> > services. What I found is that running /etc/init.d/rabbitmq-server start
> > would start the service, but that the service would die right after the
> > deployment task completed.
>
> Ok, now I understand the problem. Unfortunately your fix has missed the
> v2.8.7 release, but we will include this in a future release. The
> release notes should contain a comment to that effect when it gets
> released. Thanks for reporting and solving the problem.
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120928/20db5949/attachment.htm>

From clarsen at euphoriaaudio.com  Fri Sep 28 15:41:34 2012
From: clarsen at euphoriaaudio.com (Chris Larsen)
Date: Fri, 28 Sep 2012 10:41:34 -0400
Subject: [rabbitmq-discuss] Rabbitmq 2.5.1 Bad argument crash
Message-ID: <00e901cd9d87$5bab9650$1302c2f0$@euphoriaaudio.com>

Hey everyone, we had a problem today with 2.5.1 where the broker kept
crashing on us. We think it's just a bad message but wanted to verify that.
The other nodes in our cluster don't seem to be running into any issues. I
found something similar in the post about Stomp packets at
http://groups.google.com/group/rabbitmq-discuss/tree/browse_frm/month/2011-0
2/ce709a4aacac8569?rnum=31
<http://groups.google.com/group/rabbitmq-discuss/tree/browse_frm/month/2011-
02/ce709a4aacac8569?rnum=31&_done=%2Fgroup%2Frabbitmq-discuss%2Fbrowse_frm%2
Fmonth%2F2011-02%3F>
&_done=%2Fgroup%2Frabbitmq-discuss%2Fbrowse_frm%2Fmonth%2F2011-02%3F but
we're not pushing anything through Stomp that we're aware of (though the
plugin is enabled on the system). What do ya'll think? Thanks!

 

Ubuntu 2.6.38-10-server #46~lucid1-Ubuntu

Erlang: 1:13.b.3-dfsg-2ubuntu2.1

 

=CRASH REPORT==== 28-Sep-2012::13:39:19 ===

  crasher:

    initial call: rabbit_writer:mainloop/2

    pid: <0.1778.2>

    registered_name: []

    exception error: bad argument

      in function  size/1

         called as size(2)

      in call from rabbit_binary_generator:encode_property/2

      in call from rabbit_binary_generator:encode_properties/6

      in call from rabbit_binary_generator:ensure_content_encoded/2

      in call from rabbit_binary_generator:build_simple_content_frames/4

      in call from rabbit_writer:assemble_frames/5

      in call from rabbit_writer:internal_send_command_async/3

      in call from rabbit_writer:handle_message/2

    ancestors: [<0.1777.2>,<0.1773.2>,<0.1771.2>,rabbit_tcp_client_sup,

                  rabbit_sup,<0.127.0>]

    messages: [{inet_reply,#Port<0.6160>,ok}]

    links: [<0.1777.2>]

    dictionary: []

    trap_exit: false

    status: running

    heap_size: 610

    stack_size: 24

    reductions: 210

  neighbours:

 

=SUPERVISOR REPORT==== 28-Sep-2012::13:39:19 ===

     Supervisor: {<0.1777.2>,rabbit_channel_sup}

     Context:    child_terminated

     Reason:     badarg

     Offender:   [{pid,<0.1778.2>},

                  {name,writer},

                  {mfa,{rabbit_writer,start_link,

                                      [#Port<0.6160>,1,131072,

 
rabbit_framing_amqp_0_9_1,<0.1774.2>]}},

                  {restart_type,intrinsic},

                  {shutdown,4294967295},

                  {child_type,worker}]

 

 

=SUPERVISOR REPORT==== 28-Sep-2012::13:39:19 ===

     Supervisor: {<0.1777.2>,rabbit_channel_sup}

     Context:    shutdown

     Reason:     reached_max_restart_intensity

     Offender:   [{pid,<0.1778.2>},

                  {name,writer},

                  {mfa,{rabbit_writer,start_link,

                                      [#Port<0.6160>,1,131072,

 
rabbit_framing_amqp_0_9_1,<0.1774.2>]}},

                  {restart_type,intrinsic},

                  {shutdown,4294967295},

                  {child_type,worker}]

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120928/3f85bb5d/attachment.htm>

From simon at rabbitmq.com  Fri Sep 28 15:50:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Sep 2012 15:50:32 +0100
Subject: [rabbitmq-discuss] Rabbitmq 2.5.1 Bad argument crash
In-Reply-To: <00e901cd9d87$5bab9650$1302c2f0$@euphoriaaudio.com>
References: <00e901cd9d87$5bab9650$1302c2f0$@euphoriaaudio.com>
Message-ID: <5065B938.8070609@rabbitmq.com>

Hi.

Yes, this looks like a bad message. Such a message can be created by a 
buggy plugin (as at the link below), or a buggy Erlang application using 
the direct client. It's very unlikely to have come in over AMQP.

So do you have messages arriving over things that are not AMQP?

Cheers, Simon

On 28/09/12 15:41, Chris Larsen wrote:
> Hey everyone, we had a problem today with 2.5.1 where the broker kept
> crashing on us. We think it?s just a bad message but wanted to verify
> that. The other nodes in our cluster don?t seem to be running into any
> issues. I found something similar in the post about Stomp packets at
> http://groups.google.com/group/rabbitmq-discuss/tree/browse_frm/month/2011-02/ce709a4aacac8569?rnum=31&_done=%2Fgroup%2Frabbitmq-discuss%2Fbrowse_frm%2Fmonth%2F2011-02%3F
> <http://groups.google.com/group/rabbitmq-discuss/tree/browse_frm/month/2011-02/ce709a4aacac8569?rnum=31&_done=%2Fgroup%2Frabbitmq-discuss%2Fbrowse_frm%2Fmonth%2F2011-02%3F>
> but we?re not pushing anything through Stomp that we?re aware of (though
> the plugin is enabled on the system). What do ya?ll think? Thanks!
>
> Ubuntu 2.6.38-10-server #46~lucid1-Ubuntu
>
> Erlang: 1:13.b.3-dfsg-2ubuntu2.1
>
> =CRASH REPORT==== 28-Sep-2012::13:39:19 ===
>
> crasher:
>
> initial call: rabbit_writer:mainloop/2
>
> pid: <0.1778.2>
>
> registered_name: []
>
> exception error: bad argument
>
> in function size/1
>
> called as size(2)
>
> in call from rabbit_binary_generator:encode_property/2
>
> in call from rabbit_binary_generator:encode_properties/6
>
> in call from rabbit_binary_generator:ensure_content_encoded/2
>
> in call from rabbit_binary_generator:build_simple_content_frames/4
>
> in call from rabbit_writer:assemble_frames/5
>
> in call from rabbit_writer:internal_send_command_async/3
>
> in call from rabbit_writer:handle_message/2
>
> ancestors: [<0.1777.2>,<0.1773.2>,<0.1771.2>,rabbit_tcp_client_sup,
>
> rabbit_sup,<0.127.0>]
>
> messages: [{inet_reply,#Port<0.6160>,ok}]
>
> links: [<0.1777.2>]
>
> dictionary: []
>
> trap_exit: false
>
> status: running
>
> heap_size: 610
>
> stack_size: 24
>
> reductions: 210
>
> neighbours:
>
> =SUPERVISOR REPORT==== 28-Sep-2012::13:39:19 ===
>
> Supervisor: {<0.1777.2>,rabbit_channel_sup}
>
> Context: child_terminated
>
> Reason: badarg
>
> Offender: [{pid,<0.1778.2>},
>
> {name,writer},
>
> {mfa,{rabbit_writer,start_link,
>
> [#Port<0.6160>,1,131072,
>
> rabbit_framing_amqp_0_9_1,<0.1774.2>]}},
>
> {restart_type,intrinsic},
>
> {shutdown,4294967295},
>
> {child_type,worker}]
>
> =SUPERVISOR REPORT==== 28-Sep-2012::13:39:19 ===
>
> Supervisor: {<0.1777.2>,rabbit_channel_sup}
>
> Context: shutdown
>
> Reason: reached_max_restart_intensity
>
> Offender: [{pid,<0.1778.2>},
>
> {name,writer},
>
> {mfa,{rabbit_writer,start_link,
>
> [#Port<0.6160>,1,131072,
>
> rabbit_framing_amqp_0_9_1,<0.1774.2>]}},
>
> {restart_type,intrinsic},
>
> {shutdown,4294967295},
>
> {child_type,worker}]
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From clarsen at euphoriaaudio.com  Fri Sep 28 16:16:05 2012
From: clarsen at euphoriaaudio.com (Chris Larsen)
Date: Fri, 28 Sep 2012 11:16:05 -0400
Subject: [rabbitmq-discuss] Rabbitmq 2.5.1 Bad argument crash
In-Reply-To: <5065B938.8070609@rabbitmq.com>
References: <00e901cd9d87$5bab9650$1302c2f0$@euphoriaaudio.com>
	<5065B938.8070609@rabbitmq.com>
Message-ID: <011801cd9d8c$2e620350$8b2609f0$@euphoriaaudio.com>

> Yes, this looks like a bad message. Such a message can be created by a
buggy plugin (as at the link below), or a buggy Erlang application using >
the direct client. It's very unlikely to have come in over AMQP.

> So do you have messages arriving over things that are not AMQP?

Thanks a ton for your fast response Simon. We don't think that's the case,
but who know's what the devs are doing. I'll poke them and see if that's the
case. Thanks!


From simon at rabbitmq.com  Fri Sep 28 16:32:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 28 Sep 2012 16:32:45 +0100
Subject: [rabbitmq-discuss] Support for Python 3.x in rabbitmq-codegen
In-Reply-To: <CAAt2po+c6vrsjMzxojZcz0MbYuNfHQKaGK=MPgkjV=GmZpYnhA@mail.gmail.com>
References: <CAAt2po+c6vrsjMzxojZcz0MbYuNfHQKaGK=MPgkjV=GmZpYnhA@mail.gmail.com>
Message-ID: <5065C31D.4010307@rabbitmq.com>

On 26/09/12 16:37, Alan Antonuk wrote:
> Would the RabbitMQ team be willing to accept this change?

Yes, that looks plausible. Although probably after the weekend now.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From gmr at meetme.com  Fri Sep 28 16:52:36 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 28 Sep 2012 11:52:36 -0400
Subject: [rabbitmq-discuss] pika 0.9.6 and Reconnection Strategies
Message-ID: <CAKwdTWcESvm1wdC0cMawFer3Kq_P6wCdf=Dz4oUjjgdiRiO0kg@mail.gmail.com>

Hi all,

I'm trying to get 0.9.6 wrapped up and out the door (finally). If you're a
Python developer and use Pika, I wanted to solicit your feedback.

As I've been going through, adding tests and cleaning up the code, I've
come to the opinion that Reconnection Strategies, at least in their current
form are not very useful. There are a few reasons for this:

1) They do not restore state, meaning your application will still have to
know when you are disconnected and it will have to reestablish all of the
channels and if it's a consumer, re-issue any state based commands, such as
Basic.Consume, Confirm.Select etc. If the ReconnectionStrategy classes
could restore state, I'd see much more value in them.

2) As it is, the apps using the asynchronous adapters can listen for the
connection close event and handle this on their own. Again if anyone was
using the ReconnectionStrategy classes for re-establishing the connection,
they would have to do the rest of the work this way, anyway.

3) BlockingConnection, which seems to be the most popular adapter, can not
use them. Since it currently reimplements the connection closing to raise
an exception when the connection is remotely closed or dropped, it could
not expect the event to be fired. A design decision would have to be made
to force users of BlockingConnection to use an callback for handling
connections being closed in order to support reconnections strategies or
keep it the way it is, which is a more pythonic approach.

That being said, I am leaning towards dropping them as part of the core
library. If I do this, I would include an example that re-implements the
SimpleReconnectionStrategy class as a demo consumer that shows how to
create a reconnectable consumer application.

If you're a pika user, do you use the SRS or your own ReconnectionStrategy
extended class? Are you in favor of removing it or keeping it?  If I end up
going the route of removing it, it will mean I can get 0.9.6 out, possibly
this weekend. Keeping it may mean another week or two.

As a side note, 0.9.6pre1 is in the master branch on github and could use
some testing outside of my environment. If you're interested and able, you
can install it via pip install -e git+git://
github.com/pika/pika.git#egg=pika-v0.9.6pre1

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120928/855ac4b5/attachment.htm>

From clarsen at euphoriaaudio.com  Fri Sep 28 16:55:55 2012
From: clarsen at euphoriaaudio.com (Chris Larsen)
Date: Fri, 28 Sep 2012 11:55:55 -0400
Subject: [rabbitmq-discuss] Rabbitmq 2.5.1 Bad argument crash
In-Reply-To: <011801cd9d8c$2e620350$8b2609f0$@euphoriaaudio.com>
References: <00e901cd9d87$5bab9650$1302c2f0$@euphoriaaudio.com>	<5065B938.8070609@rabbitmq.com>
	<011801cd9d8c$2e620350$8b2609f0$@euphoriaaudio.com>
Message-ID: <012a01cd9d91$becf5550$3c6dfff0$@euphoriaaudio.com>

> Thanks a ton for your fast response Simon. We don't think that's the case,
but who know's what the devs are doing. I'll poke them and see if > that's
the case. Thanks!

Response from devs "We are using pika 0.9.5 client library on Python side
and amqp-client 2.8.1 on Java side."


From jeff at ocjtech.us  Fri Sep 28 17:59:18 2012
From: jeff at ocjtech.us (Jeffrey Ollie)
Date: Fri, 28 Sep 2012 11:59:18 -0500
Subject: [rabbitmq-discuss] Unnecessarily complex packaging (Fedora)
In-Reply-To: <50659DF9.6030805@rabbitmq.com>
References: <20120928141742.5a8c.abe10f7e5afbbb3a79ce619739541149@cern.ch>
	<50659DF9.6030805@rabbitmq.com>
Message-ID: <CAD-DQxQ5=8YjbyscosWpssLLCaRRvUiUr0rWHyfXfvPvQgcNpw@mail.gmail.com>

On Fri, Sep 28, 2012 at 7:54 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 28/09/12 13:30, Lionel Cons wrote:
>>
>> I've looked at the init script as part of
>> rabbitmq-server-2.8.7-1.noarch.rpm
>> and I find it unnecessarily complex.
>
> It *is* complex. I *think* all the complexity is necessary.

The complexity is not necessary, at least on Fedora 16 and up.  By
switching to a native systemd service file, the startup is much, much
simpler:

#####################################
[Unit]
Description=RabbitMQ Messaging Server
After=syslog.target network.target

[Service]
EnvironmentFile=-/etc/sysconfig/rabbitmq
User=rabbitmq
ExecStart=/usr/lib/rabbitmq/bin/rabbitmq-server
ExecStop=/usr/lib/rabbitmq/bin/rabbitmqctl stop

[Install]
WantedBy=multi-user.target
#####################################

Of course, that doesn't help RHEL, at least not until RHEL switches to systemd.

-- 
Jeff Ollie

From mpietrek at skytap.com  Fri Sep 28 20:23:38 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 28 Sep 2012 12:23:38 -0700
Subject: [rabbitmq-discuss] Errors starting RabbitMQ when cluster membership
	changes
Message-ID: <CACLE7iznHVn6b1Q9f=EGks64y2Hy4p17k8PMtT4JS6n_ORnc5A@mail.gmail.com>

In my environment, I have numerous RabbitMQ nodes for testing purposes, and
frequently changing around cluster configuration (e.g. which nodes are part
of a cluster).

Using 2.8.6 and subsequently 2.8.7 on Erlang R15B01, I've observed several
times recently where RabbitMQ has failed to start on a node. The reason
seems to be related to a node that is no longer part of the cluster.

For example, at one point I had a three node cluster: play, play2, and
util. I then removed util from the cluster, although to be honest, simply
by changing the rabbitmq.config file, rather than explicitly running
rabbitmqctl stop_app while the cluster is still running.

My steps:

   - Running as three node cluster, stop all brokers
   - Create a new rabbitmq.config file with just two brokers
   - Attempt to start the new cluster.


Here's my revised RabbitMQ config file. Note references to rabbit at util,
which is no longer part of the cluster:
--------
[
{rabbit, [{cluster_nodes, [rabbit at play,rabbit at play2]}, {disk_free_limit,
104857600}]},
{mnesia, [{debug, trace}]}
].
--------


The rabbit at play.log file:

=ERROR REPORT==== 28-Sep-2012::11:31:11 ===
Mnesia(rabbit at play): ** ERROR ** (core dumped to file:
"/home/mpietrek/MnesiaCore.rabbit at play_1348_857071_113813")
 ** FATAL ** Failed to merge schema: Bad cookie in table definition
mirrored_sup_childspec: rabbit at play =
{cstruct,mirrored_sup_childspec,ordered_set,[rabbit at util,rabbit at play2
,rabbit at play
],[],[],0,read_write,false,[],[],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],[],{{1346,266106,862481},rabbit at play
},{{4,0},{rabbit at util,{1348,781672,983885}}}}, rabbit at util =
{cstruct,mirrored_sup_childspec,ordered_set,[rabbit at util
],[],[],0,read_write,false,[],[],false,mirrored_sup_childspec,[key,mirroring_pid,childspec],[],[],[],{{1348,854318,794171},rabbit at util
},{{2,0},[]}}


=ERROR REPORT==== 28-Sep-2012::11:31:21 ===
** Generic server mnesia_monitor terminating
** Last message in was {'EXIT',<0.44.0>,killed}
** When Server state == {state,<0.44.0>,[],[],true,[],undefined,[]}
** Reason for termination ==
** killed

=ERROR REPORT==== 28-Sep-2012::11:31:21 ===
** Generic server mnesia_recover terminating
** Last message in was {'EXIT',<0.44.0>,killed}
** When Server state ==
{state,<0.44.0>,undefined,undefined,undefined,0,false,
                               true,[]}
** Reason for termination ==
** killed

=ERROR REPORT==== 28-Sep-2012::11:31:21 ===
** Generic server mnesia_snmp_sup terminating
** Last message in was {'EXIT',<0.44.0>,killed}
** When Server state == {state,
                            {local,mnesia_snmp_sup},
                            simple_one_for_one,
                            [{child,undefined,mnesia_snmp_sup,
                                 {mnesia_snmp_hook,start,[]},
                                 transient,3000,worker,
                                 [mnesia_snmp_sup,mnesia_snmp_hook,
                                  supervisor]}],
                            undefined,0,86400000,[],mnesia_snmp_sup,[]}
** Reason for termination ==
** killed

=ERROR REPORT==== 28-Sep-2012::11:31:21 ===
** Generic server mnesia_subscr terminating
** Last message in was {'EXIT',<0.44.0>,killed}
** When Server state == {state,<0.44.0>,57361}
** Reason for termination ==
** killed

=INFO REPORT==== 28-Sep-2012::11:31:21 ===
    application: mnesia
    exited: {shutdown,{mnesia_sup,start,[normal,[]]}}
    type: permanent


And finally, the output from rabbitmq-server:

Mnesia(rabbit at play): mnesia_late_loader starting: <0.81.0>
Mnesia(rabbit at play): Transaction {tid,21431,<0.82.0>} calling
#Fun<mnesia_schema.42.93736344> with [] failed:
 {aborted,{throw,[66,97,100,32,99,111,111,107,105,101,32,105,110,32,116,97,98,
                  108,101,32,100,101,102,105,110,105,116,105,111,110,32,
                  "mirrored_sup_childspec",58,32,"rabbit at play",32,61,32,
                  [123,

["cstruct",44,"mirrored_sup_childspec",44,"ordered_set",44,
                    [91,["rabbit at util",44,"rabbit at play2",44,"rabbit at play
"],93],

44,"[]",44,"[]",44,"0",44,"read_write",44,"false",44,"[]",
                    44,"[]",44,"false",44,"mirrored_sup_childspec",44,
                    [91,["key",44,"mirroring_pid",44,"childspec"],93],
                    44,"[]",44,"[]",44,"[]",44,
                    [123,
                     [[123,["1346",44,"266106",44,"862481"],125],
                      44,"rabbit at play"],
                     125],
                    44,
                    [123,
                     [[123,["4",44,"0"],125],
                      44,
                      [123,
                       ["rabbit at util",44,
                        [123,["1348",44,"781672",44,"983885"],125]],
                       125]],
                     125]],
                   125],
                  44,32,"rabbit at util",32,61,32,
                  [123,

["cstruct",44,"mirrored_sup_childspec",44,"ordered_set",44,
                    [91,["rabbit at util"],93],

44,"[]",44,"[]",44,"0",44,"read_write",44,"false",44,"[]",
                    44,"[]",44,"false",44,"mirrored_sup_childspec",44,
                    [91,["key",44,"mirroring_pid",44,"childspec"],93],
                    44,"[]",44,"[]",44,"[]",44,
                    [123,
                     [[123,["1348",44,"854318",44,"794171"],125],
                      44,"rabbit at util"],
                     125],
                    44,
                    [123,[[123,["2",44,"0"],125],44,"[]"],125]],
                   125],
                  "\n"]}}
Mnesia(rabbit at play): mnesia_monitor got FATAL ERROR from: <0.81.0>
Mnesia(rabbit at play): mnesia_subscr terminated: killed
{"Kernel pid
terminated",application_controller,"{application_start_failure,mnesia,{shutdown,{mnesia_sup,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,mnesia,{shutdown,{mnesia_sup,start,[normal,[]]}}})

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120928/3464fc19/attachment.htm>

From m.luchak at smartasking.com  Fri Sep 28 20:34:33 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Fri, 28 Sep 2012 15:34:33 -0400 (EDT)
Subject: [rabbitmq-discuss] =?utf-8?q?Heartbeat_-=3E_re-establish_connecti?=
	=?utf-8?q?on_flow_Question?=
Message-ID: <1348860873.98315930@apps.rackspace.com>


Hi All,
 
We are running rabbitmq on Android and continue to have serious problems with maintaining a 3G tcp consumer connection.  We have implemented heartbeats but I am struggling to understand the flow to monitor and re-establish connections.  If I understand correctly:
 
Enabling heartbeats WITHOUT handling ShutdownSignalException would actually be counter productive as a number of missed heartbeats would close the connection.
 
 
Is the "right way to do it" :
 
Enable heartbeats on the server
 
Setting (in Java) factory.setRequestedHeartbeat(HEARTBEAT_TIMEOUT);  will "auto-magically" enable      heartbeats on the client and no other call is neccessary to send heartbeats <- (big doubt here)
 
Handle ShutdownSignalException cause and reconnect if it was a hard close..
 
Does that sound about right?
 
thanks all,
Matthew
 
 
 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120928/3a075a31/attachment.htm>

From mikekhristo at gmail.com  Fri Sep 28 22:06:56 2012
From: mikekhristo at gmail.com (Mike Khristo)
Date: Fri, 28 Sep 2012 14:06:56 -0700
Subject: [rabbitmq-discuss] Rabbit won't restart - no next heap size
	found
In-Reply-To: <50622B0D.7050709@rabbitmq.com>
References: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>
	<5061F578.6080300@rabbitmq.com>
	<CAJ0FASqDONKd-UL-EbitRqA6h3zaeqxAG9LZFKmoQTsFyck0=A@mail.gmail.com>
	<50620619.8050108@rabbitmq.com>
	<CAJ0FASogr824Uw37GnpMKG4_su60wC1uXnxVTfWd+CdkAQySwA@mail.gmail.com>
	<50622B0D.7050709@rabbitmq.com>
Message-ID: <CAJ0FASqb90V8juMj06ZWyj47-H5KCUXUc+9Jr=-Cr+VLfxSg9g@mail.gmail.com>

Added a 200G swap... it used some of it, but still seg faults at
startup. Is there any way to split up the data on disk so I can get 2
rabbits up with half the data each?

Any other ideas on how to start this? I need urgent access to the 300M
queued messages

Thanks for the help so far...



On Tue, Sep 25, 2012 at 3:07 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Mike,
>
>
> On 25/09/12 22:10, Mike Khristo wrote:
>>
>> Upgraded to erlang 5.9.2.
>>
>> eheap_alloc: Cannot allocate 11037567056 bytes of memory (of type
>> "heap").
>
>
> That's better. Sort of.
>
>
>> How can I get rabbit to start w/o using so much memory?
>
>
> You probably can't.
>
>
>> It was only using 30G out of the 68G avail while it was running
>
>
> That is more than the 0.4*total_memory default high watermark. Presumably
> you have altered that threshold in the config. There's a reason it's set to
> 0.4 by default - rabbit can take up all the rest temporarily in some
> circumstances. So you were living on the edge somewhat.
>
>
>> This is a production box and I need to get access to the 300M
>> messages asap.
>
>
> I suggest you configure some temporary swap space. That should hopefully
> allow rabbit to start up and recover all the messages. And, with any luck,
> once it's done all that memory usage might drop off a bit.
>
> Would be good to keep an eye on memory use during that startup/recovery
> phase and send us that plus the log files. And if you have some disk space
> to spare where you can stash away a copy of the database dir before you
> start rabbit that would be great.
>
> With all that info we might be able to identify whether we are missing a
> trick somewhere in conserving memory during startup, and address that in a
> future release.
>
>
> Regards,
>
> Matthias.



-- 
-mk

From matthias at rabbitmq.com  Sat Sep 29 08:41:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 29 Sep 2012 08:41:29 +0100
Subject: [rabbitmq-discuss] Rabbit won't restart - no next heap size
	found
In-Reply-To: <CAJ0FASqb90V8juMj06ZWyj47-H5KCUXUc+9Jr=-Cr+VLfxSg9g@mail.gmail.com>
References: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>
	<5061F578.6080300@rabbitmq.com>
	<CAJ0FASqDONKd-UL-EbitRqA6h3zaeqxAG9LZFKmoQTsFyck0=A@mail.gmail.com>
	<50620619.8050108@rabbitmq.com>
	<CAJ0FASogr824Uw37GnpMKG4_su60wC1uXnxVTfWd+CdkAQySwA@mail.gmail.com>
	<50622B0D.7050709@rabbitmq.com>
	<CAJ0FASqb90V8juMj06ZWyj47-H5KCUXUc+9Jr=-Cr+VLfxSg9g@mail.gmail.com>
Message-ID: <5066A629.3010702@rabbitmq.com>

Mike,

On 28/09/12 22:06, Mike Khristo wrote:
> Added a 200G swap... it used some of it, but still seg faults at
> startup.

Did it fail with the same error, i.e. "eheap_alloc: Cannot allocate ....
bytes of memory"? That would be kinda surprising.

Is there anything in the log files?

There are scenarios in which an error can trigger the writing of an 
enormous log message, and it's the latter that is exhausting memory. If 
so, the log should contain the error.

> Is there any way to split up the data on disk so I can get 2 rabbits
> up with half the data each?

Hmm. The following should work:

1) make a backup of the rabbit database dir

2) cd into the database dir and remove the "clean shutdown" markers with
    rm -f `find . -name "clean.dot"`
If rabbit was shut down cleanly there should be one of these per queue 
plus one each in the msg_store_persistent and msg_store_transient dirs. 
If rabbit wasn't shut down cleanly and those files aren't present then 
not to worry.

3) in the msg_store_persistent dir remove half the *.rdq files

4) start rabbit

Then process all the messages in that rabbit, stop it, restore the 
backup and repeat the above but this time removing the other half of the 
*.rdq files.


Regards,

Matthias.

From buck.robert.j at gmail.com  Fri Sep 28 22:28:12 2012
From: buck.robert.j at gmail.com (Bob Buck)
Date: Fri, 28 Sep 2012 14:28:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Problems getting reply_to to work
Message-ID: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>

Simple case, issue a request to a back end server to generate a report
and respond back with the report as a message.

http://pastebin.com/FvwcVqtH

Above is the pastebin of the code sample.

I get no message response, and at the server the metadata.reply_to is
an empty string ??? (even though in the management console I see
something like "amq.gen-wVDstTQg3NTbQVTjfqcDuO".

I am fairly new to AMQP, so this is likely a noob issue.

Does anyone see what I could be doing wrong? I've spent a number of
hours on this and I don't see why this does not work for me.

Thanks in advance.

Bob

From schalexey at gmail.com  Sat Sep 29 10:32:42 2012
From: schalexey at gmail.com (aJIeks)
Date: Sat, 29 Sep 2012 02:32:42 -0700 (PDT)
Subject: [rabbitmq-discuss] Using RabbitMQ with Qt
In-Reply-To: <4FD31A18.3020501@yandex.ru>
References: <4FD31A18.3020501@yandex.ru>
Message-ID: <1348911162319-22262.post@n5.nabble.com>

Hello, maybe this will be helpfull: https://github.com/fuCtor/QAMQP

This is my implementation of AMQP 0.9.1 protocol with pure Qt 4 without
other dependencies.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Using-RabbitMQ-with-Qt-tp16233p22262.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alex at inferiorhumanorgans.com  Sat Sep 29 14:20:49 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Sat, 29 Sep 2012 06:20:49 -0700
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
Message-ID: <20120929132049.GA88595@bloaty>

I just noticed one of our devices had a fairly low amount of free disk space...

As it turns out, there was a 600MB crash dump (erl_crash.dump) from Rabbit.
I've deleted it for now, but in the future, what would be useful to do with
these?  At 600MB it's a bit unwieldy to transfer over a cellular connection.

- alex


From michael.s.klishin at gmail.com  Sun Sep 30 06:49:22 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 30 Sep 2012 08:49:22 +0300
Subject: [rabbitmq-discuss] Problems getting reply_to to work
In-Reply-To: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>
References: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>
Message-ID: <CAE3HoVQD0pJeDEHBPkSMhcXV1Xdn1ekwtnwd3OLTp_DiTcsvcw@mail.gmail.com>

2012/9/29 Bob Buck <buck.robert.j at gmail.com>

> I get no message response, and at the server the metadata.reply_to is
> an empty string ??? (even though in the management console I see
> something like "amq.gen-wVDstTQg3NTbQVTjfqcDuO".
>
> I am fairly new to AMQP, so this is likely a noob issue.
>

Just for the record, the question was answered on the amqp gem mailing list:

https://groups.google.com/forum/?fromgroups=#!topic/ruby-amqp/jhwMFdhEgPM
-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120930/16fcd1a4/attachment.htm>

From matthias at rabbitmq.com  Sun Sep 30 08:18:00 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 30 Sep 2012 08:18:00 +0100
Subject: [rabbitmq-discuss] Problems getting reply_to to work
In-Reply-To: <CAE3HoVQD0pJeDEHBPkSMhcXV1Xdn1ekwtnwd3OLTp_DiTcsvcw@mail.gmail.com>
References: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>
	<CAE3HoVQD0pJeDEHBPkSMhcXV1Xdn1ekwtnwd3OLTp_DiTcsvcw@mail.gmail.com>
Message-ID: <5067F228.1050202@rabbitmq.com>

Michael,

On 30/09/12 06:49, Michael Klishin wrote:
> 2012/9/29 Bob Buck <buck.robert.j at gmail.com
> <mailto:buck.robert.j at gmail.com>>
>
>     I get no message response, and at the server the metadata.reply_to is
>     an empty string ??? (even though in the management console I see
>     something like "amq.gen-wVDstTQg3NTbQVTjfqcDuO".
>
> Just for the record, the question was answered on the amqp gem mailing list:
>
> https://groups.google.com/forum/?fromgroups=#!topic/ruby-amqp/jhwMFdhEgPM

Interesting. Why doesn't the 'response_queue.subscribe' trigger the 
setting of the name?

As an aside, there is a spurious "immediate => true" in the 
exchange.publish. I hope that isn't cribbed from some example code, 
since we are dropping support for 'immediate' in the next major rabbit 
release.

Regards,

Matthias.

From matthias at rabbitmq.com  Sun Sep 30 10:10:10 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 30 Sep 2012 10:10:10 +0100
Subject: [rabbitmq-discuss] Using RabbitMQ with Qt
In-Reply-To: <1348911162319-22262.post@n5.nabble.com>
References: <4FD31A18.3020501@yandex.ru>
	<1348911162319-22262.post@n5.nabble.com>
Message-ID: <50680C72.4090401@rabbitmq.com>

On 29/09/12 10:32, aJIeks wrote:
> Hello, maybe this will be helpfull: https://github.com/fuCtor/QAMQP
>
> This is my implementation of AMQP 0.9.1 protocol with pure Qt 4 without
> other dependencies.

I've added the link to http://www.rabbitmq.com/devtools.html#c-dev.

Matthias.

From matthias at rabbitmq.com  Sun Sep 30 10:20:38 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 30 Sep 2012 10:20:38 +0100
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <20120929132049.GA88595@bloaty>
References: <20120929132049.GA88595@bloaty>
Message-ID: <50680EE6.6050301@rabbitmq.com>

Alex,

On 29/09/12 14:20, Alex Zepeda wrote:
> I just noticed one of our devices had a fairly low amount of free disk space...
>
> As it turns out, there was a 600MB crash dump (erl_crash.dump) from Rabbit.
> I've deleted it for now, but in the future, what would be useful to do with
> these?  At 600MB it's a bit unwieldy to transfer over a cellular connection.

The first handful of lines of the erl_crash.dump are the most 
interesting, so you could keep/transfer just that and discard the rest.

Regards,

Matthias.

From buck.robert.j at gmail.com  Sun Sep 30 13:56:47 2012
From: buck.robert.j at gmail.com (Robert Buck)
Date: Sun, 30 Sep 2012 08:56:47 -0400
Subject: [rabbitmq-discuss] Problems getting reply_to to work
In-Reply-To: <5067F228.1050202@rabbitmq.com>
References: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>
	<CAE3HoVQD0pJeDEHBPkSMhcXV1Xdn1ekwtnwd3OLTp_DiTcsvcw@mail.gmail.com>
	<5067F228.1050202@rabbitmq.com>
Message-ID: <CADf7wwXDeh-Eu7Uh+JyfW2RauLLY_0+cspfV-mQJ2+DeCX8Rdw@mail.gmail.com>

Yes, "immediate" was cribbed from the sample code, as was much of the code
I put together, well, at least the concepts were cribbed that is.

So I should yank immediate? Or is there an alternate thing I should do?

I am not sure why 'response_queue.subscribe' doesn't trigger the setting of
the name. It's rather weird in that regard, neither the client nor the
server see the generated queue name. I would be guessing that the Ruby amqp
gem is broken in this regard?

Bob

On Sun, Sep 30, 2012 at 3:18 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Michael,
>
> On 30/09/12 06:49, Michael Klishin wrote:
>
>> 2012/9/29 Bob Buck <buck.robert.j at gmail.com
>> <mailto:buck.robert.j at gmail.**com <buck.robert.j at gmail.com>>>
>>
>>
>>     I get no message response, and at the server the metadata.reply_to is
>>     an empty string ??? (even though in the management console I see
>>     something like "amq.gen-**wVDstTQg3NTbQVTjfqcDuO".
>>
>> Just for the record, the question was answered on the amqp gem mailing
>> list:
>>
>> https://groups.google.com/**forum/?fromgroups=#!topic/**
>> ruby-amqp/jhwMFdhEgPM<https://groups.google.com/forum/?fromgroups=#!topic/ruby-amqp/jhwMFdhEgPM>
>>
>
> Interesting. Why doesn't the 'response_queue.subscribe' trigger the
> setting of the name?
>
> As an aside, there is a spurious "immediate => true" in the
> exchange.publish. I hope that isn't cribbed from some example code, since
> we are dropping support for 'immediate' in the next major rabbit release.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120930/a7ea5798/attachment.htm>

From matthias at rabbitmq.com  Sun Sep 30 14:13:33 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 30 Sep 2012 14:13:33 +0100
Subject: [rabbitmq-discuss] Problems getting reply_to to work
In-Reply-To: <CADf7wwXDeh-Eu7Uh+JyfW2RauLLY_0+cspfV-mQJ2+DeCX8Rdw@mail.gmail.com>
References: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>
	<CAE3HoVQD0pJeDEHBPkSMhcXV1Xdn1ekwtnwd3OLTp_DiTcsvcw@mail.gmail.com>
	<5067F228.1050202@rabbitmq.com>
	<CADf7wwXDeh-Eu7Uh+JyfW2RauLLY_0+cspfV-mQJ2+DeCX8Rdw@mail.gmail.com>
Message-ID: <5068457D.2000603@rabbitmq.com>

Robert,

On 30/09/12 13:56, Robert Buck wrote:
> Yes, "immediate" was cribbed from the sample code, as was much of the
> code I put together, well, at least the concepts were cribbed that is.

Could you post a link to the sample code, please, so that Michael can 
remove the use of 'immediate' from it?

> So I should yank immediate?

Yes, but that has nothing to do with the problem you were seeing.

> I am not sure why 'response_queue.subscribe' doesn't trigger the setting
> of the name. It's rather weird in that regard, neither the client nor
> the server see the generated queue name. I would be guessing that the
> Ruby amqp gem is broken in this regard?

'broken' might be a bit harsh, 'surprising' perhaps ;) Anyway, this is 
one for Michael.

Regards,

Matthias.

From buck.robert.j at gmail.com  Sun Sep 30 16:43:58 2012
From: buck.robert.j at gmail.com (Robert Buck)
Date: Sun, 30 Sep 2012 11:43:58 -0400
Subject: [rabbitmq-discuss] Problems getting reply_to to work
In-Reply-To: <5068457D.2000603@rabbitmq.com>
References: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>
	<CAE3HoVQD0pJeDEHBPkSMhcXV1Xdn1ekwtnwd3OLTp_DiTcsvcw@mail.gmail.com>
	<5067F228.1050202@rabbitmq.com>
	<CADf7wwXDeh-Eu7Uh+JyfW2RauLLY_0+cspfV-mQJ2+DeCX8Rdw@mail.gmail.com>
	<5068457D.2000603@rabbitmq.com>
Message-ID: <CADf7wwWbzbTVtspGedDzghzhKp8z5kB6nPNr9Kr34zPA_q6BGQ@mail.gmail.com>

Hi, Thanks.

Doing a recursive grep, I see several references in the amqp ruby project
where this exists. In my case, since I am doing request-reply, here is one
notable example:

./examples/patterns/request_reply/client.rb
./examples/patterns/request_reply/server.rb

Immediate is also referenced in the RabbitMQ docs,

http://www.rabbitmq.com/api-guide.html

Cheers,

Bob

On Sun, Sep 30, 2012 at 9:13 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Robert,
>
>
> On 30/09/12 13:56, Robert Buck wrote:
>
>> Yes, "immediate" was cribbed from the sample code, as was much of the
>> code I put together, well, at least the concepts were cribbed that is.
>>
>
> Could you post a link to the sample code, please, so that Michael can
> remove the use of 'immediate' from it?
>
>
>  So I should yank immediate?
>>
>
> Yes, but that has nothing to do with the problem you were seeing.
>
>
>  I am not sure why 'response_queue.subscribe' doesn't trigger the setting
>> of the name. It's rather weird in that regard, neither the client nor
>> the server see the generated queue name. I would be guessing that the
>> Ruby amqp gem is broken in this regard?
>>
>
> 'broken' might be a bit harsh, 'surprising' perhaps ;) Anyway, this is one
> for Michael.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120930/f3dab7c6/attachment.htm>

From matthias at rabbitmq.com  Sun Sep 30 16:53:46 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 30 Sep 2012 16:53:46 +0100
Subject: [rabbitmq-discuss] Problems getting reply_to to work
In-Reply-To: <CADf7wwWbzbTVtspGedDzghzhKp8z5kB6nPNr9Kr34zPA_q6BGQ@mail.gmail.com>
References: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>
	<CAE3HoVQD0pJeDEHBPkSMhcXV1Xdn1ekwtnwd3OLTp_DiTcsvcw@mail.gmail.com>
	<5067F228.1050202@rabbitmq.com>
	<CADf7wwXDeh-Eu7Uh+JyfW2RauLLY_0+cspfV-mQJ2+DeCX8Rdw@mail.gmail.com>
	<5068457D.2000603@rabbitmq.com>
	<CADf7wwWbzbTVtspGedDzghzhKp8z5kB6nPNr9Kr34zPA_q6BGQ@mail.gmail.com>
Message-ID: <50686B0A.70202@rabbitmq.com>

On 30/09/12 16:43, Robert Buck wrote:
> Doing a recursive grep, I see several references in the amqp ruby
> project where this exists. In my case, since I am doing request-reply,
> here is one notable example:
>
> ./examples/patterns/request_reply/client.rb
> ./examples/patterns/request_reply/server.rb

Thanks. Michael, could you eradicate those, please?

> Immediate is also referenced in the RabbitMQ docs,
>
> http://www.rabbitmq.com/api-guide.html

Those will disappear when we remove support for 'immediate' from the broker.

Matthias.

