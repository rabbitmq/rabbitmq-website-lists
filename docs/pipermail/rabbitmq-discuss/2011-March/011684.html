<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmqctl%20list_queues%20explanation%20needed&In-Reply-To=%3C008C9FE0-AA67-4541-B027-40FE6C47DF89%40shopsocially.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011683.html">
   <LINK REL="Next"  HREF="011687.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmqctl list_queues explanation needed</H1>
    <B>Sunil Arora</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmqctl%20list_queues%20explanation%20needed&In-Reply-To=%3C008C9FE0-AA67-4541-B027-40FE6C47DF89%40shopsocially.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmqctl list_queues explanation needed">sunil at shopsocially.com
       </A><BR>
    <I>Tue Mar  8 10:15:00 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011683.html">[rabbitmq-discuss] rabbitmqctl list_queues explanation needed
</A></li>
        <LI>Next message: <A HREF="011687.html">[rabbitmq-discuss] rabbitmqctl list_queues explanation needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11684">[ date ]</a>
              <a href="thread.html#11684">[ thread ]</a>
              <a href="subject.html#11684">[ subject ]</a>
              <a href="author.html#11684">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Emile,

This is indeed helpful.

I investigated more and found out the reason behind those increasing queues.

We are using celeryd (<A HREF="http://celeryproject.com">http://celeryproject.com</A>) and we were suppose to turn off a particular settings to disable this growing queues. celery was dumping new queue for every background job that was being posted to RabbitMQ and we didn't need that.

Now I want to delete these acknowledged messages. what is the best way to do it ?  I do not want to flush to unacknowledged messages.

Thanks
Sunil



On 08-Mar-2011, at 3:26 PM, Emile Joubert wrote:

&gt;<i> Hi Sunil,
</I>&gt;<i> 
</I>&gt;<i> On 08/03/11 07:02, Sunil Arora wrote:
</I>&gt;&gt;<i> Hi folks,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> We are trying to determine what is going under the hood in our
</I>&gt;&gt;<i> rabbitmq server because It because unresponsive last night and we
</I>&gt;&gt;<i> have to restart it. When I say unresponsive, it means it was no
</I>&gt;&gt;<i> longer accepting AMQP connections from our webservers.
</I>&gt;<i> 
</I>&gt;<i> That means the broker probably came under memory pressure. The logfile should confirm that. Rabbit will start accepting connections as soon as enough memory is freed. The broker will continue to deliver messages to consumers while under memory pressure.
</I>&gt;<i> 
</I>&gt;&gt;<i> When we run following command:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> /usr/sbin/rabbitmqctl list_queues name memory messages
</I>&gt;&gt;<i> messages_unacknowledged consumers
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> We see a stream of output given as follows which has around 10K
</I>&gt;&gt;<i> entries.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> b9e5e34bcb6c46229baf5bfdfc0deb81	21688	1	0	0
</I>&gt;&gt;<i> bf52747edf2a4b1dbe919a0439bc03fa	21688	1	0	0
</I>&gt;&gt;<i> 39254dd407374dba9dd9f67fc7157613	21688	1	0	0
</I>&gt;&gt;<i> 7bc47977255e4414a975bbdfc9fbc7d3	21688	1	0	0
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Now, I do not understand why memory is being consumed if  messages
</I>&gt;&gt;<i> are acknowledged already. Our expectation is once the message has
</I>&gt;&gt;<i> been delivered and consumed, ack'd, it should not consume any memory
</I>&gt;&gt;<i> in the system.
</I>&gt;<i> 
</I>&gt;<i> The broker forgets about messages as soon as they are acknowledged, so acknowledged messages can't be responsible for memory usage. The memory reported by &quot;rabbitmqctl list_queues&quot; is for all call stack, heap and internal structures associated with the internal Erlang queue process. In your case the total memory used by queues will amount to about 200Mb if each queue contains 1 message.
</I>&gt;<i> 
</I>&gt;<i> If your application doesn't need 10000 simultaneously active queues then you should drained and delete them. Otherwise you will need to add more RAM to your broker.
</I>&gt;<i> 
</I>&gt;<i> Rabbit has the ability to hibernate inactive queue processes, which will save some memory. Frequently checking the queue status using &quot;rabbitmqctl list_queues&quot; or use of the management &amp; monitoring plugin could prevent that from happening.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Regards
</I>&gt;<i> 
</I>&gt;<i> Emile
</I>&gt;<i> 
</I>
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011683.html">[rabbitmq-discuss] rabbitmqctl list_queues explanation needed
</A></li>
	<LI>Next message: <A HREF="011687.html">[rabbitmq-discuss] rabbitmqctl list_queues explanation needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11684">[ date ]</a>
              <a href="thread.html#11684">[ thread ]</a>
              <a href="subject.html#11684">[ subject ]</a>
              <a href="author.html#11684">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
