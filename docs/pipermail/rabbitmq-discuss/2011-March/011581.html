<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fwd: socket error while using rabbitmq and a NAT (Network address translation)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fwd%3A%20socket%20error%20while%20using%20rabbitmq%20and%20a%20NAT%0A%20%28Network%20address%20translation%29&In-Reply-To=%3CAANLkTikV54%2B1bcF0YwvykV40fU8B4WrCTC_DXBnqvnpm%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011578.html">
   <LINK REL="Next"  HREF="011582.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fwd: socket error while using rabbitmq and a NAT (Network address translation)</H1>
    <B>mysurf mail</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fwd%3A%20socket%20error%20while%20using%20rabbitmq%20and%20a%20NAT%0A%20%28Network%20address%20translation%29&In-Reply-To=%3CAANLkTikV54%2B1bcF0YwvykV40fU8B4WrCTC_DXBnqvnpm%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Fwd: socket error while using rabbitmq and a NAT (Network address translation)">stammailbox at gmail.com
       </A><BR>
    <I>Wed Mar  2 12:38:36 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011578.html">[rabbitmq-discuss] Failed to build rabbitmq-server on an aix6.1 system
</A></li>
        <LI>Next message: <A HREF="011582.html">[rabbitmq-discuss] Fwd: socket error while using rabbitmq and a NAT (Network address translation)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11581">[ date ]</a>
              <a href="thread.html#11581">[ thread ]</a>
              <a href="subject.html#11581">[ subject ]</a>
              <a href="author.html#11581">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I ran the multicast main . from the computer with the good connection it
seemed to work.
from the computer with the bad connection - it seemed to not work.

I was seconds away from taking this to the IT , but then I remembered that
both computes run the RabbitMQ client 1.7.0 successfully .

Maybe you can tell me what changed in the implementation of the 2.3.1 or the
erlang??

I am adding the output file for the multicast. it has outputs from both
computers.

I really appreciate your help. I hope this will resolve soon as we are in a
mess currently in the production system.
Thanks.


On Wed, Mar 2, 2011 at 1:01 PM, Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> It is very strange to see an AMQP connection work perfectly via the tracer
</I>&gt;<i> but fail without it.
</I>&gt;<i>
</I>&gt;<i> (Does the broker listen on the same port in both cases? If not, does the
</I>&gt;<i> underlying network treat both ports the same?)
</I>&gt;<i>
</I>&gt;<i> Can you replicate these results with any of the built-in Java examples that
</I>&gt;<i> are provided with RabbitMQ? I would suggest using the MulticastMain tool
</I>&gt;<i> with and without the Tracer. This will eliminate the possibility of AMQP
</I>&gt;<i> protocol errors causing the problem.
</I>&gt;<i>
</I>&gt;<i> &gt; DataInputStream.readUnsignedByte()
</I>&gt;<i> This is not the cause of the problem. It probably just means that the
</I>&gt;<i> underlying connection has been forcefully closed.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; It happens only from certain computers.
</I>&gt;<i> Do these computers have anything in common with each other that they do not
</I>&gt;<i> have in common with the computers that don't produce errors?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Emile
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 02/03/11 09:41, mysurf mail wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We debugged the tracer and saw that it uses java.net.socket. The
</I>&gt;&gt;<i> connection was ok through the tracer.
</I>&gt;&gt;<i> Now,  we closed the tracer and connected directly to the rabbit.
</I>&gt;&gt;<i> We  attached the source and debugged factory.newconnmection() we saw the
</I>&gt;&gt;<i> exception occured in DataInputStream.readUnsignedByte() . (it throws an
</I>&gt;&gt;<i> EOFException when ch&lt;0) .
</I>&gt;&gt;<i> any ideas?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Wed, Mar 2, 2011 at 9:41 AM, mysurf mail &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">stammailbox at gmail.com</A>
</I>&gt;&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">stammailbox at gmail.com</A>&gt;&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Flash News :
</I>&gt;&gt;<i>    I am sorry to bother you a lot this morning . But I have an
</I>&gt;&gt;<i>    interesting finding
</I>&gt;&gt;<i>    When I activate my client with the tracer - it connects well to the
</I>&gt;&gt;<i>    rabbitmq server .
</I>&gt;&gt;<i>    when I connect directly - it throws that exception .
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    So maybe my problem is with the connection string ?
</I>&gt;&gt;<i>    here it is - I only replace the  ip and port
</I>&gt;&gt;<i>    BasicChannel(Username, Password, VirtualHost, BrokerIp, BrokerPort,
</I>&gt;&gt;<i>    Heartbeat);
</I>&gt;&gt;<i>    BasicChannel(Username, Password, VirtualHost, &quot;127.0.0.1&quot;,5672,
</I>&gt;&gt;<i>    Heartbeat);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    and my ctor is
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    public BasicChannel(final String username, final String password, final
</I>&gt;&gt;<i> String virtualHost, final String brokerIp, final int brokerPort, int
</I>&gt;&gt;<i> heartbeat) {
</I>&gt;&gt;<i>             ConnectionFactory factory = new ConnectionFactory();
</I>&gt;&gt;<i>             factory.setUsername(username);
</I>&gt;&gt;<i>             factory.setPassword(password);
</I>&gt;&gt;<i>             factory.setVirtualHost(virtualHost);
</I>&gt;&gt;<i>             factory.setRequestedHeartbeat(heartbeat);
</I>&gt;&gt;<i>             factory.setHost(brokerIp);
</I>&gt;&gt;<i>             factory.setPort(brokerPort);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>             connection = null;
</I>&gt;&gt;<i>             try {
</I>&gt;&gt;<i>                 connection = factory.newConnection();
</I>&gt;&gt;<i>             } catch (IOException e) {
</I>&gt;&gt;<i>                 throw new PlatformException(&quot;could not create connection&quot;,
</I>&gt;&gt;<i> e);
</I>&gt;&gt;<i>             }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Thanks
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/4399b363/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/4399b363/attachment.htm</A>&gt;
-------------- next part --------------
GoodComputer

C:\workspace\thirdparty\rabbitmq\rabbitmq-java-client-bin-2.3.1&gt;runjava com.rabbitmq.e
starting consumer #0
starting producer #0
recving rate: 0 msg/s, min/avg/max latency: 4744/4744/4744 microseconds
sending rate: 16186 msg/s
recving rate: 11764 msg/s, min/avg/max latency: 1598/124824/277785 microseconds
recving rate: 10631 msg/s, min/avg/max latency: 267152/462700/609950 microseconds
sending rate: 16116 msg/s
sending rate: 16950 msg/s
recving rate: 11096 msg/s, min/avg/max latency: 607182/802149/941896 microseconds
sending rate: 16703 msg/s
recving rate: 11400 msg/s, min/avg/max latency: 937387/1117620/1270633 microseconds
recving rate: 11208 msg/s, min/avg/max latency: 1270782/1437044/1593934 microseconds
sending rate: 16596 msg/s
sending rate: 16562 msg/s
recving rate: 10827 msg/s, min/avg/max latency: 1593183/1797937/1986645 microseconds
recving rate: 11304 msg/s, min/avg/max latency: 1985082/2140123/2293316 microseconds
sending rate: 16652 msg/s
sending rate: 17220 msg/s
recving rate: 11227 msg/s, min/avg/max latency: 2290855/2443425/2622044 microseconds
sending rate: 16654 msg/s
recving rate: 10139 msg/s, min/avg/max latency: 2622215/2852111/3002576 microseconds
sending rate: 16555 msg/s
recving rate: 11057 msg/s, min/avg/max latency: 2995418/3177957/3362374 microseconds
sending rate: 17122 msg/s
recving rate: 11464 msg/s, min/avg/max latency: 3359459/3521971/3688621 microseconds
sending rate: 16755 msg/s
recving rate: 10929 msg/s, min/avg/max latency: 3687067/3868810/4061715 microseconds
sending rate: 16832 msg/s
recving rate: 9792 msg/s, min/avg/max latency: 4060436/4221286/4471434 microseconds
sending rate: 16683 msg/s
recving rate: 11018 msg/s, min/avg/max latency: 4471275/4637660/4818107 microseconds
sending rate: 16814 msg/s
recving rate: 11250 msg/s, min/avg/max latency: 4815837/4991481/5166424 microseconds
sending rate: 16994 msg/s
recving rate: 11511 msg/s, min/avg/max latency: 5158614/5312865/5484297 microseconds

BadComputer

C:\workspace\thirdparty\rabbitmq\rabbitmq-java-client-bin-2.3.1&gt;runjava com.rabb
itmq.examples.MulticastMain -h 192.168.100.251 -p 1434  -e X1X1X1X1
starting consumer #0
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011578.html">[rabbitmq-discuss] Failed to build rabbitmq-server on an aix6.1 system
</A></li>
	<LI>Next message: <A HREF="011582.html">[rabbitmq-discuss] Fwd: socket error while using rabbitmq and a NAT (Network address translation)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11581">[ date ]</a>
              <a href="thread.html#11581">[ thread ]</a>
              <a href="subject.html#11581">[ subject ]</a>
              <a href="author.html#11581">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
