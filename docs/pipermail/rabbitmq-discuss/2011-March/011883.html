<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] server crashes with very fast consumers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20server%20crashes%20with%20very%20fast%20consumers&In-Reply-To=%3C78220.69521.qm%40web31810.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011851.html">
   <LINK REL="Next"  HREF="011754.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] server crashes with very fast consumers</H1>
    <B>alex chen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20server%20crashes%20with%20very%20fast%20consumers&In-Reply-To=%3C78220.69521.qm%40web31810.mail.mud.yahoo.com%3E"
       TITLE="[rabbitmq-discuss] server crashes with very fast consumers">chen650 at yahoo.com
       </A><BR>
    <I>Thu Mar 17 05:27:51 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011851.html">[rabbitmq-discuss] server crashes with very fast consumers
</A></li>
        <LI>Next message: <A HREF="011754.html">[rabbitmq-discuss] RabbitMq Installation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11883">[ date ]</a>
              <a href="thread.html#11883">[ thread ]</a>
              <a href="subject.html#11883">[ subject ]</a>
              <a href="author.html#11883">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matthew,

Thanks for investigating this problem! I tried rabbitmq-server from hg tip, but 
it still crashed when the message consuming rate reached 300 MB/sec.  When you 
ran the test, did you load at least 60 GB messages to 1000 queues?  each message 
is 20 KB in size.

My machine is RAID-10 with 4 SSD disks:  
480GB (1%) RAID-10/2 == 4 x 240GB SSD SATA/300
Maybe your test machine has only 1 SSD disk so the consuming rate could not 
reach 300 MB/sec?

Thanks.

-alex



________________________________
From: Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt;
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Sent: Wed, March 16, 2011 3:49:57 AM
Subject: Re: [rabbitmq-discuss] server crashes with very fast consumers

Hi Alex,

On Thu, Mar 10, 2011 at 09:48:08PM -0800, alex chen wrote:
&gt;<i> I am testing rabbit server with SSD.  The broker process would crash when many 
</I>
&gt;<i> consumers start to consume backed up messages.  Because SSD if very fast, the 
</I>&gt;<i> consuming rate reached more than 200 MB/sec.  After several minutes, the broker 
</I>&gt;<i>
</I>&gt;<i> process would use all cpu resources (800% on 8 cores) and crash.
</I>
I test all the time on an Intel G2 drive. I've never seen it cause a
crash, even in scenarios such as yours. Furthermore, I find it somewhat
unlikely that if the server process did die, it didn't spit out any sort
of error on its way out. There must be /something/ somewhere that
suggests a bit more as to what went wrong, whether it's in syslog, or
dmesg, or rabbit's various logs.

I did however yesterday find and fix a bug where inexplicably a function
that normally takes about 0.5s ended up in some very strange cases
taking &gt; 80s. After a lot of head scratching and debugging, I never
understood why this variance existed. However, I rewrote the function
and it's now much faster all the time. This particular bug has been
through QA and is now on default and should be in the next release, thus
if you want to try compiling from default and repeating your test, we'd
be interested in knowing whether you see any change.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/2b4de9ad/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/2b4de9ad/attachment.htm</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011851.html">[rabbitmq-discuss] server crashes with very fast consumers
</A></li>
	<LI>Next message: <A HREF="011754.html">[rabbitmq-discuss] RabbitMq Installation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11883">[ date ]</a>
              <a href="thread.html#11883">[ thread ]</a>
              <a href="subject.html#11883">[ subject ]</a>
              <a href="author.html#11883">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
