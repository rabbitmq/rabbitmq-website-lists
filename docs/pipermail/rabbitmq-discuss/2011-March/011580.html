<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20socket%20error%20while%20using%20rabbitmq%20and%20a%20NAT%0A%20%28Network%20address%20translation%29&In-Reply-To=%3C4D6E2373.9050508%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011576.html">
   <LINK REL="Next"  HREF="011540.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20socket%20error%20while%20using%20rabbitmq%20and%20a%20NAT%0A%20%28Network%20address%20translation%29&In-Reply-To=%3C4D6E2373.9050508%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)">emile at rabbitmq.com
       </A><BR>
    <I>Wed Mar  2 11:01:07 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011576.html">[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
</A></li>
        <LI>Next message: <A HREF="011540.html">[rabbitmq-discuss] Cannot connect to rabbitmq from all computers -	including wireshark logs.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11580">[ date ]</a>
              <a href="thread.html#11580">[ thread ]</a>
              <a href="subject.html#11580">[ subject ]</a>
              <a href="author.html#11580">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

It is very strange to see an AMQP connection work perfectly via the 
tracer but fail without it.

(Does the broker listen on the same port in both cases? If not, does the 
underlying network treat both ports the same?)

Can you replicate these results with any of the built-in Java examples 
that are provided with RabbitMQ? I would suggest using the MulticastMain 
tool with and without the Tracer. This will eliminate the possibility of 
AMQP protocol errors causing the problem.

 &gt; DataInputStream.readUnsignedByte()
This is not the cause of the problem. It probably just means that the 
underlying connection has been forcefully closed.

 &gt; It happens only from certain computers.
Do these computers have anything in common with each other that they do 
not have in common with the computers that don't produce errors?



-Emile


On 02/03/11 09:41, mysurf mail wrote:
&gt;<i>
</I>&gt;<i> We debugged the tracer and saw that it uses java.net.socket. The
</I>&gt;<i> connection was ok through the tracer.
</I>&gt;<i> Now,  we closed the tracer and connected directly to the rabbit.
</I>&gt;<i> We  attached the source and debugged factory.newconnmection() we saw the
</I>&gt;<i> exception occured in DataInputStream.readUnsignedByte() . (it throws an
</I>&gt;<i> EOFException when ch&lt;0) .
</I>&gt;<i> any ideas?
</I>&gt;<i>
</I>&gt;<i> On Wed, Mar 2, 2011 at 9:41 AM, mysurf mail &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">stammailbox at gmail.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">stammailbox at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     Flash News :
</I>&gt;<i>     I am sorry to bother you a lot this morning . But I have an
</I>&gt;<i>     interesting finding
</I>&gt;<i>     When I activate my client with the tracer - it connects well to the
</I>&gt;<i>     rabbitmq server .
</I>&gt;<i>     when I connect directly - it throws that exception .
</I>&gt;<i>
</I>&gt;<i>     So maybe my problem is with the connection string ?
</I>&gt;<i>     here it is - I only replace the  ip and port
</I>&gt;<i>     BasicChannel(Username, Password, VirtualHost, BrokerIp, BrokerPort,
</I>&gt;<i>     Heartbeat);
</I>&gt;<i>     BasicChannel(Username, Password, VirtualHost, &quot;127.0.0.1&quot;,5672,
</I>&gt;<i>     Heartbeat);
</I>&gt;<i>
</I>&gt;<i>     and my ctor is
</I>&gt;<i>
</I>&gt;<i>     public BasicChannel(final String username, final String password, final String virtualHost, final String brokerIp, final int brokerPort, int heartbeat) {
</I>&gt;<i>              ConnectionFactory factory = new ConnectionFactory();
</I>&gt;<i>              factory.setUsername(username);
</I>&gt;<i>              factory.setPassword(password);
</I>&gt;<i>              factory.setVirtualHost(virtualHost);
</I>&gt;<i>              factory.setRequestedHeartbeat(heartbeat);
</I>&gt;<i>              factory.setHost(brokerIp);
</I>&gt;<i>              factory.setPort(brokerPort);
</I>&gt;<i>
</I>&gt;<i>              connection = null;
</I>&gt;<i>              try {
</I>&gt;<i>                  connection = factory.newConnection();
</I>&gt;<i>              } catch (IOException e) {
</I>&gt;<i>                  throw new PlatformException(&quot;could not create connection&quot;, e);
</I>&gt;<i>              }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Thanks
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011576.html">[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
</A></li>
	<LI>Next message: <A HREF="011540.html">[rabbitmq-discuss] Cannot connect to rabbitmq from all computers -	including wireshark logs.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11580">[ date ]</a>
              <a href="thread.html#11580">[ thread ]</a>
              <a href="subject.html#11580">[ subject ]</a>
              <a href="author.html#11580">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
