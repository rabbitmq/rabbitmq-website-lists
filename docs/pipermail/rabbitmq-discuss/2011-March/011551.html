<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20socket%20error%20while%20using%20rabbitmq%20and%20a%20NAT%0A%20%28Network%20address%20translation%29&In-Reply-To=%3CAANLkTinHroXSm_RcHeocQFDA%2B10QVsyNePXQ-DbyTtzB%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011549.html">
   <LINK REL="Next"  HREF="011552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)</H1>
    <B>mysurf mail</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20socket%20error%20while%20using%20rabbitmq%20and%20a%20NAT%0A%20%28Network%20address%20translation%29&In-Reply-To=%3CAANLkTinHroXSm_RcHeocQFDA%2B10QVsyNePXQ-DbyTtzB%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)">stammailbox at gmail.com
       </A><BR>
    <I>Tue Mar  1 14:57:17 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011549.html">[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
</A></li>
        <LI>Next message: <A HREF="011552.html">[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11551">[ date ]</a>
              <a href="thread.html#11551">[ thread ]</a>
              <a href="subject.html#11551">[ subject ]</a>
              <a href="author.html#11551">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,


I setup a trace at the client app server. Set the listen port and connection
port and got a log for the unsuccessful factory.newConnection() . I added it
in attached the tracelog.txt.

now regarding the other references you gave me

1 Protocol errors:
 Acknowledging with an unknown delivery tag
 Redeclaring exchanges with different parameters

you recommended not acking more than once. This whole thing started when we
upgraded the rabbitmq version and Matthias sujested we will change the
consumer to ack (i.e. we changed it to channel.basicConsume(queueName,
FALSE, queueingConsumer);)
(This is if I understood him right )
So How can I control the acking . How do I know if I ack more then once. I
think I never send an ack consciously. only through the subscibe .

I hope the second and the third will be solved with the trace.

and thanks again.

On Tue, Mar 1, 2011 at 3:41 PM, Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 01/03/11 12:55, mysurf mail wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi Emile,
</I>&gt;&gt;<i> I have a few questions:
</I>&gt;&gt;<i> 1. On the rabbitmq server we have a few Erlang versions. Should that
</I>&gt;&gt;<i> create a problem .
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Keep in mind that different features of RabbitMQ have different minimum
</I>&gt;<i> requirements (e.g. SSL and some plugins). This is especially important in a
</I>&gt;<i> multi-version environment. It is best to use the latest version across the
</I>&gt;<i> board if possible (unless it is an alpha version containing an A).
</I>&gt;<i>
</I>&gt;<i>
</I>
&gt;<i>  (For now, I finished removing the older ones, so currently we have only
</I>&gt;&gt;<i> 5.8.2 and the problem still exists
</I>&gt;&gt;<i> 2. I have added the logs file from the rabbitmq server. I am the ip that
</I>&gt;&gt;<i> ends with 170.120 and my last trial had an exception.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It is unusual to have the broker listen on port 1434. From the log there
</I>&gt;<i> are at least 3 kinds of problems:
</I>&gt;<i>
</I>&gt;<i> 1 Protocol errors:
</I>&gt;<i>  Acknowledging with an unknown delivery tag
</I>&gt;<i>  Redeclaring exchanges with different parameters
</I>&gt;<i>  These will lead to a channel or connection closure.
</I>&gt;<i>
</I>&gt;<i> 2 1-Mar-2011::14:15:02
</I>&gt;<i>  Handshake timeout
</I>&gt;<i>  This will close the connection
</I>&gt;<i>
</I>&gt;<i> 3 1-Mar-2011::14:18:46
</I>&gt;<i>  Abrupt connection termination
</I>&gt;<i>
</I>&gt;<i> The first can be solved by making sure that you don't acknowledge messages
</I>&gt;<i> more than once, and that you declare exchanges with identical parameters.
</I>&gt;<i> The second and third may have a related root cause, which the tracer or
</I>&gt;<i> network diagnostic tools should help to identify.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  3. Now about that tracer. I have been having some hard time finding
</I>&gt;&gt;<i> documentation for it.
</I>&gt;&gt;<i> Should I run it from the client (it comes with the client packacge) or
</I>&gt;&gt;<i> in the server? I am running it in the client.
</I>&gt;&gt;<i> my rabbit node port is 1434.  so I am running it with
</I>&gt;&gt;<i> .\runjava.bat co m.rabbitmq.tools.Tracer 1434 192.168.100.251 5672
</I>&gt;&gt;<i> are my parameters ok ?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> See <A HREF="http://www.rabbitmq.com/examples.html#tracer">http://www.rabbitmq.com/examples.html#tracer</A> .
</I>&gt;<i> Judging by your logfile you want to use 1434 as the connectPort argument
</I>&gt;<i> instead of 5672.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  I used rabbit node port as listenport and 5672 as connect port. I also
</I>&gt;&gt;<i> switched them but no luck . I didnt see anything on the cmd when I
</I>&gt;&gt;<i> invoked my produce command.
</I>&gt;&gt;<i> here it is
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You should configure AMQP clients to connect to the tracer instead of to
</I>&gt;<i> the broker directly. The port should be the one given as the first argument
</I>&gt;<i> (listenPort) and the host should be the IP number of the machine running the
</I>&gt;<i> tracer.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Emile
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110301/c5c30ca3/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110301/c5c30ca3/attachment-0001.htm</A>&gt;
-------------- next part --------------
C:\workspace\thirdparty\rabbitmq\rabbitmq-java-client-bin-2.3.1&gt;.\runjava.bat co
m.rabbitmq.tools.Tracer 5673 192.168.100.251 1434


Usage: Tracer [&lt;listenport&gt; [&lt;connecthost&gt; [&lt;connectport&gt;]]]
Invoked as: Tracer 5673 192.168.100.251 1434
com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
com.rabbitmq.tools.Tracer.SUPPRESS_COMMAND_BODIES = false
1298990430343: conn#0 ch#0 &lt;- {#method&lt;connection.start&gt;(version-major=0,version
-minor=9,server properties={product=RabbitMQ, platform=Erlang/OTP, information=L
icensed under the MPL.  See <A HREF="http://www.rabbitmq.com/,">http://www.rabbitmq.com/,</A> copyright=Copyright (C) 20
07-2011 VMware, Inc., version=2.3.1},mechanisms=PLAIN AMQPLAIN,locales=en_US),nu
ll,&quot;&quot;}
1298990430437: conn#0 ch#0 -&gt; {#method&lt;connection.start-ok&gt;(client-properties={p
roduct=RabbitMQ, information=Licensed under the MPL. See <A HREF="http://www.rabbitmq.com">http://www.rabbitmq.com</A>
/, platform=Java, copyright=Copyright (C) 2007-2011 VMware, Inc., version=2.3.1}
,mechanism=PLAIN,response= guest guest,locale=en_US),null,&quot;&quot;}
1298990430593: conn#0 ch#0 &lt;- {#method&lt;connection.tune&gt;(channel-max=0,frame-max=
131072,heartbeat=0),null,&quot;&quot;}
1298990430593: conn#0 ch#0 -&gt; {#method&lt;connection.tune-ok&gt;(channel-max=0,frame-m
ax=131072,heartbeat=30),null,&quot;&quot;}
1298990430609: conn#0 ch#0 -&gt; {#method&lt;connection.open&gt;(virtual-host=/,capabilit
ies=,insist=false),null,&quot;&quot;}
1298990430796: conn#0 ch#0 &lt;- {#method&lt;connection.open-ok&gt;(known-hosts=),null,&quot;&quot;
}
1298990430812: conn#0 ch#1 -&gt; {#method&lt;channel.open&gt;(out-of-band=),null,&quot;&quot;}
1298990431000: conn#0 ch#1 &lt;- {#method&lt;channel.open-ok&gt;(channel-id=),null,&quot;&quot;}
1298990431000: conn#0 ch#1 -&gt; {#method&lt;exchange.declare&gt;(ticket=0,exchange=toMan
ager,type=direct,passive=false,durable=false,auto-delete=false,internal=false,no
wait=false,arguments={}),null,&quot;&quot;}
1298990431296: conn#0 ch#1 &lt;- {#method&lt;exchange.declare-ok&gt;(),null,&quot;&quot;}
1298990431296: conn#0 ch#1 -&gt; {#method&lt;queue.declare&gt;(ticket=0,queue=,passive=fa
lse,durable=false,exclusive=false,auto-delete=false,nowait=false,arguments={}),n
ull,&quot;&quot;}
1298990431531: conn#0 ch#1 &lt;- {#method&lt;queue.declare-ok&gt;(queue=amq.gen-Ip9tTe7JX
G83iXqJQbld7w==,message-count=0,consumer-count=0),null,&quot;&quot;}
1298990431531: conn#0 ch#1 -&gt; {#method&lt;queue.bind&gt;(ticket=0,queue=,exchange=toMa
nager,routing-key=rtk,nowait=false,arguments={}),null,&quot;&quot;}
1298990431718: conn#0 ch#1 &lt;- {#method&lt;queue.bind-ok&gt;(),null,&quot;&quot;}
1298990431718: conn#0 ch#1 -&gt; {#method&lt;basic.consume&gt;(ticket=0,queue=,consumer-t
ag=,no-local=false,no-ack=false,exclusive=false,nowait=false,arguments={}),null,
&quot;&quot;}
1298990431921: conn#0 ch#1 &lt;- {#method&lt;basic.consume-ok&gt;(consumer-tag=amq.ctag-9
f5ZhEsESDHdJtp1jbv3iA==),null,&quot;&quot;}
1298990460625: conn#0 ch#0 -&gt; Frame(type=8, channel=0, 0 bytes of payload)
1298990460843: conn#0 ch#0 &lt;- Frame(type=8, channel=0, 0 bytes of payload)
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011549.html">[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
</A></li>
	<LI>Next message: <A HREF="011552.html">[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11551">[ date ]</a>
              <a href="thread.html#11551">[ thread ]</a>
              <a href="subject.html#11551">[ subject ]</a>
              <a href="author.html#11551">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
