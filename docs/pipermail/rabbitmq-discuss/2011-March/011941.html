<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Fwd: Problem with plugin development guide example
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fwd%3A%20Problem%20with%20plugin%20development%20guide%0A%20example&In-Reply-To=%3CF78BCF638F95D74A99D036114107EDB5028DD5DB3B%40EXCH-MBX-3.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011939.html">
   <LINK REL="Next"  HREF="011942.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Fwd: Problem with plugin development guide example</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Fwd%3A%20Problem%20with%20plugin%20development%20guide%0A%20example&In-Reply-To=%3CF78BCF638F95D74A99D036114107EDB5028DD5DB3B%40EXCH-MBX-3.vmware.com%3E"
       TITLE="[rabbitmq-discuss] Fwd: Problem with plugin development guide example">jerryk at vmware.com
       </A><BR>
    <I>Fri Mar 18 21:02:19 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011939.html">[rabbitmq-discuss] Fwd: Problem with plugin development guide	example
</A></li>
        <LI>Next message: <A HREF="011942.html">[rabbitmq-discuss] Fwd: Problem with plugin development guide	example
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11941">[ date ]</a>
              <a href="thread.html#11941">[ thread ]</a>
              <a href="subject.html#11941">[ subject ]</a>
              <a href="author.html#11941">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Jim.

Attached is a gzipped tar file containing rabbitmq-empty-plugin, a close to absolutely bare bones plugin I made by stripping down one of my projects.

If you uncompress it under your checkout of rabbitmq-public-umbrella, you should be able to just go into that directory and type 'make'.

Then go over to your rabbitmq-server directory, which should be a sibling of the directory where the uncompressed empty plugin lives under your public-umbrella.  In the plugins subdirectory of rabbitmq-server create a symbolic link:

ln -s ../../rabbitmq-empty-plugin rabbitmq-empty-plugin

Now 'make run' to start up your broker.

If all goes well you'll see &quot;rabbit_empty_plugin-0.1.0&quot; appear in the &quot;plugins activated&quot; section of the broker's start-up preamble.

Once the Erlang REPL prompt appears again you can try:

appmon:start().

Explore the app tree that appears and you should see rabbit_empty_plugin present as a child of your rabbit process.  If you double click on the rabbit_empty_plugin node you'll see the supervision tree for the empty plugin.

Note that at the moment it really does nothing except start up.  The rabbit_empty_plugin is an instance of the Erlang 'application' behaviour, and it starts an OTP supervisor called 'rabbit_empty_sup' which lords over an Erlang process called 'rabbit_empty_worker', enforcing the restart policy indicated in the code with an iron, OTP-ish fist.

By grepping around for where the word &quot;empty&quot; appears in the .erl and .app files, and the Makefile, you should be able to mutate this into the basis of your very own Rabbit plugin.

Good luck.  Please let us know if we can help out further.

Best regards,
Jerry

P.S.  You mentioned that you were new to Erlang.  The Manning book below:

<A HREF="http://www.manning.com/logan/">http://www.manning.com/logan/</A>

is a good resource, and has better coverage of the OTP libraries and design principles than you'll find in many other places.  Armstrong's book is also likely to be helpful to you if you're going to be using Erlang much:

<A HREF="http://www.pragprog.com/titles/jaerlang/programming-erlang">http://www.pragprog.com/titles/jaerlang/programming-erlang</A>

________________________________________
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jimirrer at gmail.com</A> [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jimirrer at gmail.com</A>] On Behalf Of Jim Irrer [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>]
Sent: Friday, March 18, 2011 12:50 PM
To: Jerry Kuch
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide example

Jerry -

Yes, that would be great.  All I'm looking for is a hello world example of
a plugin to get me started.

Thanks,

- Jim

Jim Irrer     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>&gt;       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Mar 18, 2011 at 1:32 PM, Jerry Kuch &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jerryk at vmware.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jerryk at vmware.com</A>&gt;&gt; wrote:
Jim:

I also have a vague recollection that a month or two ago I found a couple out of date spots in the plugin development guide that might cause you grief.  I did put together a basic plugin for other reasons, that I could conceivably husk out and share with you as a starting point you might find convenient?

Best regards,
Jerry
________________________________________
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>&gt; [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>&gt;] On Behalf Of Jim Irrer [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>&gt;]
Sent: Friday, March 18, 2011 9:22 AM
To: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
Cc: Jim Irrer
Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide      example

That was helpful - I got farther - but not there yet.

I did the checkout of the umbrella with the command above:

hg clone <A HREF="http://hg.rabbitmq.com/rabbitmq-public-umbrella">http://hg.rabbitmq.com/rabbitmq-public-umbrella</A> -r bug23568

but I did the 'make co' without any special parameters, so I assumed
that it did hg commands with respect to the bug23568 branch.

I built the metronome project as outlined on the Rabbit site and added
the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
start it up I get:

linus:make run
RABBITMQ_NODE_IP_ADDRESS=&quot;&quot; RABBITMQ_NODE_PORT=&quot;5679&quot; RABBITMQ_LOG_BASE=&quot;/tmp&quot; RABBITMQ_MNESIA_DIR=&quot;/tmp/rabbitmq-bunny-mnesia&quot; RABBITMQ_PLUGINS_EXPAND_DIR=&quot;/tmp/rabbitmq-bunny-plugins-scratch&quot; \
               RABBITMQ_ALLOW_INPUT=true \
               RABBITMQ_SERVER_START_ARGS=&quot;&quot; \
               ./scripts/rabbitmq-server
Activating RabbitMQ plugins ...
*WARNING* Undefined function amqp_connection:start_direct/0
*WARNING* Undefined function gb_trees:map/2
*WARNING* Undefined function os:timestamp/0
*WARNING* Undefined function random:seed/1
*WARNING* Undefined function ssl:ssl_accept/3
2 plugins activated:
* amqp_client-0.0.0
* rabbit_metronome-0.0.0

Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2] [async-threads:30] [hipe] [kernel-poll:true]


+---+   +---+
|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   +---+   +-------+
</I>|<i>                   |
</I>|<i> RabbitMQ  +---+   |
</I>|<i>           |   |   |
</I>|<i> v%%VSN%%  +---+   |
</I>|<i>                   |
</I>+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>

node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">bunny at linus</A>
app descriptor : /devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /home/irrer
config file(s) : (none)
cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
log            : /tmp/bunny.log
sasl log       : /tmp/bunny-sasl.log
database dir   : /tmp/rabbitmq-bunny-mnesia
erlang version : 5.6.5

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting plugin registry                                              ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism plain                                         ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting alarm handler                                                ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting exchange recovery                                            ...done
starting queue supervisor and queue recovery                          ...done
-- message delivery logic ready
starting error log relay                                              ...done
starting networking                                                   ...done
starting notify cluster nodes                                         ...done
starting direct_client                                                ...done

broker running
Eshell V5.6.5  (abort with ^G)
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">bunny at linus</A>)1&gt; Erlang has closed
                                {&quot;Kernel pid terminated&quot;,application_controller,&quot;{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}&quot;}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})

And as advertised it creates a big honkin' dump file.

I also had to create symbolic links so that the code would build.  In my
rabbitmq-public-umbrella/rabbit_metronome directory I created:

amqp_client -&gt; ../rabbitmq-erlang-client/dist/amqp_client
rabbit_common -&gt; ../rabbitmq-erlang-client/dist/rabbit_common

The server works fine if run without adding plugins, but when I add them
it bombs, so I know the plugins are the problem (Right?).

I'm new to Erlang (interesting language), so all I did was cut and paste
the example Erlang code, so if that code is out of date then it would be a problem.

Also: I changed the port to 5679 so it would not interfere with the official
installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
to 'bunny'.

Thanks,

- Jim

Jim Irrer     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>&gt;&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">irrer at umich.edu</A>&gt;&gt;       (734) 647-4409&lt;tel:%28734%29%20647-4409&gt;&lt;tel:%28734%29%20647-4409&gt;
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt;&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt;&gt;&gt; wrote:
On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
&gt;<i> If I checkout the latest server code, will I get the bug23274 fix?
</I>
Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
go through QA. None of the documentation regarding writing plugins has
been updated.

&gt;<i> If not, what is the Mercurial command to get it?
</I>
hg clone <A HREF="http://hg.rabbitmq.com/rabbitmq-public-umbrella">http://hg.rabbitmq.com/rabbitmq-public-umbrella</A> -r bug23568

But you'll need to make sure all the plugins are also on branch bug23568
for them to work with the new build system.

If you're writing plugins from scratch, be sure to read the
rabbitmq-public-umbrella/README.makefiles file, which has a helpful
section on &quot;Creating a new package&quot;.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>


-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq-empty-plugin.tar.gz
Type: application/x-gzip
Size: 4353 bytes
Desc: rabbitmq-empty-plugin.tar.gz
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/1a3e76f9/attachment-0001.bin">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/1a3e76f9/attachment-0001.bin</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011939.html">[rabbitmq-discuss] Fwd: Problem with plugin development guide	example
</A></li>
	<LI>Next message: <A HREF="011942.html">[rabbitmq-discuss] Fwd: Problem with plugin development guide	example
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11941">[ date ]</a>
              <a href="thread.html#11941">[ thread ]</a>
              <a href="subject.html#11941">[ subject ]</a>
              <a href="author.html#11941">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
