<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmqctl%20list_queues%20explanation%20needed&In-Reply-To=%3C4D75FD44.6000909%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011682.html">
   <LINK REL="Next"  HREF="011684.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmqctl list_queues explanation needed</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmqctl%20list_queues%20explanation%20needed&In-Reply-To=%3C4D75FD44.6000909%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmqctl list_queues explanation needed">emile at rabbitmq.com
       </A><BR>
    <I>Tue Mar  8 09:56:20 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011682.html">[rabbitmq-discuss] rabbitmqctl list_queues explanation needed
</A></li>
        <LI>Next message: <A HREF="011684.html">[rabbitmq-discuss] rabbitmqctl list_queues explanation needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11683">[ date ]</a>
              <a href="thread.html#11683">[ thread ]</a>
              <a href="subject.html#11683">[ subject ]</a>
              <a href="author.html#11683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sunil,

On 08/03/11 07:02, Sunil Arora wrote:
&gt;<i> Hi folks,
</I>&gt;<i>
</I>&gt;<i> We are trying to determine what is going under the hood in our
</I>&gt;<i> rabbitmq server because It because unresponsive last night and we
</I>&gt;<i> have to restart it. When I say unresponsive, it means it was no
</I>&gt;<i> longer accepting AMQP connections from our webservers.
</I>
That means the broker probably came under memory pressure. The logfile 
should confirm that. Rabbit will start accepting connections as soon as 
enough memory is freed. The broker will continue to deliver messages to 
consumers while under memory pressure.

&gt;<i> When we run following command:
</I>&gt;<i>
</I>&gt;<i> /usr/sbin/rabbitmqctl list_queues name memory messages
</I>&gt;<i> messages_unacknowledged consumers
</I>&gt;<i>
</I>&gt;<i> We see a stream of output given as follows which has around 10K
</I>&gt;<i> entries.
</I>&gt;<i>
</I>&gt;<i> b9e5e34bcb6c46229baf5bfdfc0deb81	21688	1	0	0
</I>&gt;<i> bf52747edf2a4b1dbe919a0439bc03fa	21688	1	0	0
</I>&gt;<i> 39254dd407374dba9dd9f67fc7157613	21688	1	0	0
</I>&gt;<i> 7bc47977255e4414a975bbdfc9fbc7d3	21688	1	0	0
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Now, I do not understand why memory is being consumed if  messages
</I>&gt;<i> are acknowledged already. Our expectation is once the message has
</I>&gt;<i> been delivered and consumed, ack'd, it should not consume any memory
</I>&gt;<i> in the system.
</I>
The broker forgets about messages as soon as they are acknowledged, so 
acknowledged messages can't be responsible for memory usage. The memory 
reported by &quot;rabbitmqctl list_queues&quot; is for all call stack, heap and 
internal structures associated with the internal Erlang queue process. 
In your case the total memory used by queues will amount to about 200Mb 
if each queue contains 1 message.

If your application doesn't need 10000 simultaneously active queues then 
you should drained and delete them. Otherwise you will need to add more 
RAM to your broker.

Rabbit has the ability to hibernate inactive queue processes, which will 
save some memory. Frequently checking the queue status using 
&quot;rabbitmqctl list_queues&quot; or use of the management &amp; monitoring plugin 
could prevent that from happening.


Regards

Emile

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011682.html">[rabbitmq-discuss] rabbitmqctl list_queues explanation needed
</A></li>
	<LI>Next message: <A HREF="011684.html">[rabbitmq-discuss] rabbitmqctl list_queues explanation needed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11683">[ date ]</a>
              <a href="thread.html#11683">[ thread ]</a>
              <a href="subject.html#11683">[ subject ]</a>
              <a href="author.html#11683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
