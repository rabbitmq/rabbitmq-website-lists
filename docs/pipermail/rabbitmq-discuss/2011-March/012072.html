<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster size limit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20size%20limit&In-Reply-To=%3CAANLkTin47sO5gcQ%3D-LzAH55PdTNn%2BC1EzUHM6EdwLVLJ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012071.html">
   <LINK REL="Next"  HREF="012084.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster size limit</H1>
    <B>Advait Alai</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20size%20limit&In-Reply-To=%3CAANLkTin47sO5gcQ%3D-LzAH55PdTNn%2BC1EzUHM6EdwLVLJ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Cluster size limit">advaitalai at gmail.com
       </A><BR>
    <I>Mon Mar 28 08:14:08 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012071.html">[rabbitmq-discuss] Cluster size limit
</A></li>
        <LI>Next message: <A HREF="012084.html">[rabbitmq-discuss] Cluster size limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12072">[ date ]</a>
              <a href="thread.html#12072">[ thread ]</a>
              <a href="subject.html#12072">[ subject ]</a>
              <a href="author.html#12072">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alexis,

Thanks for the inputs.

On Mon, Mar 28, 2011 at 2:55 AM, Alexis Richardson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis at rabbitmq.com</A>&gt;wrote:

&gt;<i> Advait
</I>&gt;<i>
</I>&gt;<i> There is no benefit to clustering terminal nodes which (as I
</I>&gt;<i> understand it) are not sharing internal state with each other.
</I>&gt;<i> Instead look to share queues and exchanges by running them on brokers,
</I>&gt;<i> and connecting multiple terminal nodes to those brokers.
</I>&gt;<i>
</I>
I am running the entire setup -- VMs and the network on a single system. Does
that count as sharing the same internal state? The VMs mount the same bare
file system, so, for example, I could skip replicating erlang-cookies before
clustering (/var/lib/rabbitmq is common). Of course, they have
virtualized/individual network stacks and interfaces.


&gt;<i> You should run RabbitMQ clients at terminal nodes.  Connect them to
</I>&gt;<i> brokers running at non-terminal nodes.  For broker-broker links, use
</I>&gt;<i> Shovel.  We are working on a federation model that is more flexible
</I>&gt;<i> than shovel - if you are interested, talk to Simon (cc'd).
</I>&gt;<i>
</I>
Ah, this might be a problem, as I cannot run any third party applications on
non terminal nodes. These nodes are primitives of NS-3 -- just objects
responsible for routing etc. Since I did not have any control on non
terminal nodes, I had to cluster terminal nodes and assumed that the
middleware would take care of setting up overlay paths from publishers to
subscribers. My bad, should've understood how clustering worked before
starting :-/

But coming back to the errors cropping up, is there a way to increase the
cluster limit size, even if there is no added benefit of clustering this
way?

@Simon -- could you please direct me to any documentation for the federation
model I could use here? Thanks


&gt;<i> On Sun, Mar 27, 2011 at 9:33 PM, Advait Alai &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">advaitalai at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; However - RabbitMQ clustering is not designed as a way to create
</I>&gt;<i> &gt;&gt; pubsub overlays for the wide area.  Its primary goal is scalability of
</I>&gt;<i> &gt;&gt; one broker by adding nodes on the same LAN.  This is for, eg, cases
</I>&gt;<i> &gt;&gt; where the number of subscriptions (or &quot;bindings&quot;) on the broker grows
</I>&gt;<i> &gt;&gt; beyond what one machine can physically cope with.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Now, this does not stop you wiring up 1,000s of RabbitMQ brokers.  But
</I>&gt;<i> &gt;&gt; using RabbitMQ clustering is the wrong way to do that.  Can you tell
</I>&gt;<i> &gt;&gt; us a bit more about the pubsub topology you want to study, please?
</I>&gt;<i> &gt;&gt; That may help us suggest the optimal way to solve your problem..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The topology looks like this: <A HREF="http://imgur.com/8iep0">http://imgur.com/8iep0</A> (taken
</I>&gt;<i> &gt; from
</I>&gt;<i> <A HREF="http://ctieware.eng.monash.edu.au/twiki/bin/view/Simulation/LargePacket-switchingNetworkTopologies">http://ctieware.eng.monash.edu.au/twiki/bin/view/Simulation/LargePacket-switchingNetworkTopologies</A>
</I>&gt;<i> )
</I>&gt;<i> &gt; The terminal nodes shown in the topology are either publishers or
</I>&gt;<i> &gt; subscribers, and I want RabbitMQ to run as a middleware over the entire
</I>&gt;<i> &gt; network. The network (routers and links) are simulated by NS3, So it is
</I>&gt;<i> &gt; essentially a set of point to point links, where each link is a separate
</I>&gt;<i> &gt; network. The terminal nodes are VMs (that would run the amqp/rabbitmq
</I>&gt;<i> &gt; scripts) which I am attempting to cluster so they can use a common set of
</I>&gt;<i> &gt; queues and exchanges. So all terminal nodes are in different LANs.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Also, can you explain why QoS studies require the study of 1,000s of
</I>&gt;<i> &gt;&gt; nodes?  Perhaps you mean 1,000s of clients?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm not sure I understood -- I'm trying to provide high fidelity results,
</I>&gt;<i> so
</I>&gt;<i> &gt; I thought the testbed should be atleast of the same order of size as the
</I>&gt;<i> &gt; network on which it needs to be deployed (&gt;50000 nodes). There are a few
</I>&gt;<i> &gt; strict IEEE standards regarding this network that specify the minimum QoS
</I>&gt;<i> &gt; guarantees required.
</I>&gt;<i> &gt; Is there an easier way to do this?
</I>&gt;<i> &gt; Thanks
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Sun, Mar 27, 2011 at 7:11 PM, Advait Alai &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">advaitalai at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;&gt; &gt; Thanks for the reply --
</I>&gt;<i> &gt;&gt; &gt; On Sun, Mar 27, 2011 at 9:38 PM, Jerry Kuch &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jerryk at vmware.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; 150 is a pretty big sounding cluster...  Out of curiosity, what's
</I>&gt;<i> &gt;&gt; &gt;&gt; motivating you to go so big (if you don't mind saying)?
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; I am doing a QoS analysis of publish-subscribe overlays using RabbitMQ
</I>&gt;<i> &gt;&gt; &gt; in
</I>&gt;<i> &gt;&gt; &gt; wide area networks (These are country wide networks, so even a 1000
</I>&gt;<i> &gt;&gt; &gt; nodes
</I>&gt;<i> &gt;&gt; &gt; might be insufficient :-)) So stuff like packet delay, loss,
</I>&gt;<i> &gt;&gt; &gt; out-of-order
</I>&gt;<i> &gt;&gt; &gt; delivery etc.
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; On that note, because RabbitMQ clustering is based on Erlang
</I>&gt;<i> &gt;&gt; &gt;&gt; distribution,
</I>&gt;<i> &gt;&gt; &gt;&gt; the current practical limit you'll probably run up against is
</I>&gt;<i> somewhat
</I>&gt;<i> &gt;&gt; &gt;&gt; lower
</I>&gt;<i> &gt;&gt; &gt;&gt; than the 150 you have in mind.  Something more like 32 to 64.
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; Is there a configuration that would let me scale to &gt;64 nodes, even if
</I>&gt;<i> &gt;&gt; &gt; it
</I>&gt;<i> &gt;&gt; &gt; would not be practical? And in case Erlang does not scale well, I'll
</I>&gt;<i> &gt;&gt; &gt; probably have to resort to entirely another middleware -- any
</I>&gt;<i> &gt;&gt; &gt; suggestions
</I>&gt;<i> &gt;&gt; &gt; that would work on a larger number of nodes?
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; If you can say more about your goals it's likely that someone on the
</I>&gt;<i> &gt;&gt; &gt;&gt; Rabbit team can suggest something helpful.
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; The analysis I'm carrying out on &gt;100 nodes is actually on a single
</I>&gt;<i> &gt;&gt; &gt; system.
</I>&gt;<i> &gt;&gt; &gt; These 'nodes' are actually many light weight linux containers (more or
</I>&gt;<i> &gt;&gt; &gt; less
</I>&gt;<i> &gt;&gt; &gt; virtual machines) connected by a simulated NS3 network topology. But I
</I>&gt;<i> &gt;&gt; &gt; doubt
</I>&gt;<i> &gt;&gt; &gt; this would be the cause of the clustering problem, as &lt;50 nodes were
</I>&gt;<i> &gt;&gt; &gt; clustering without any difficulty.
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; On Mar 26, 2011, at 10:32 PM, &quot;Advait Alai&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">advaitalai at gmail.com</A>&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; wrote:
</I>&gt;<i> &gt;&gt; &gt;&gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Hi,
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; I'm trying to add 150 nodes to a RabbitMQ cluster. After around 50
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; nodes, the stop-reset-cluster-start iteration starts giving the
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; error:
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Stopping node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node130</A> ...
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; ...done.
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Resetting node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node130</A> ...
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; ...done.
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Clustering node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node130</A> with [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node117</A>] ...
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; ...done.
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Starting node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node130</A> ...
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Error: {cannot_start_application,rabbit,
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;            {bad_return,
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;                {{rabbit,start,[normal,[]]},
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;                 {'EXIT',{rabbit,failure_during_boot}}}}}
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Note that I am sequentially adding nodes to build a cluster (as an
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; initialization step) before creating any queues/exchanges or
</I>&gt;<i> running
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; any
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; amqp script.
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; How do I solve this problem? Is it because RabbitMQ imposes a hard
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; cluster size limit?
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Also, does RabbitMQ scale well to around 1000 nodes?
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; Thanks
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; _______________________________________________
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;&gt; &gt;&gt; &gt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt; _______________________________________________
</I>&gt;<i> &gt;&gt; &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;&gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;&gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110328/1b0ec0f6/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110328/1b0ec0f6/attachment.htm</A>&gt;
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012071.html">[rabbitmq-discuss] Cluster size limit
</A></li>
	<LI>Next message: <A HREF="012084.html">[rabbitmq-discuss] Cluster size limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12072">[ date ]</a>
              <a href="thread.html#12072">[ thread ]</a>
              <a href="subject.html#12072">[ subject ]</a>
              <a href="author.html#12072">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
