<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ latency and message lost issue.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20latency%20and%20message%20lost%20issue.&In-Reply-To=%3CC9265FDC5DBE6249ADFA9B769D3D2A170118E76F56%40EUMSGMAIL001.markit.partners%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011618.html">
   <LINK REL="Next"  HREF="011627.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ latency and message lost issue.</H1>
    <B>Shixin Song</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20latency%20and%20message%20lost%20issue.&In-Reply-To=%3CC9265FDC5DBE6249ADFA9B769D3D2A170118E76F56%40EUMSGMAIL001.markit.partners%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ latency and message lost issue.">Shixin.Song at markit.com
       </A><BR>
    <I>Thu Mar  3 12:53:32 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011618.html">[rabbitmq-discuss] RabbitMQ latency and message lost issue.
</A></li>
        <LI>Next message: <A HREF="011627.html">[rabbitmq-discuss] RabbitMQ latency and message lost issue.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11621">[ date ]</a>
              <a href="thread.html#11621">[ thread ]</a>
              <a href="subject.html#11621">[ subject ]</a>
              <a href="author.html#11621">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Marek,

Thanks a lot for your reply. I get the general idea about how to deal with it. Now I am looking at the first solution which to tell rabbit drop the message when it's too old. I saw the sample code from the link indicating how to do it in Java. But I am using C client library at this moment.  It seems that there is no queue declare interface at this moment. Could you indicate me that how to do it in C library. Here is the part of my code :

        conn = amqp_new_connection();

        die_on_error(sockfd = amqp_open_socket(hostName.c_str(), portNumber), &quot;Opening socket&quot;);
        amqp_set_sockfd(conn, sockfd);
        die_on_amqp_error(amqp_login(conn, virtualHost.c_str()
                                                , 0
                                                , 131072,
                                                0,
                                                AMQP_SASL_METHOD_PLAIN,
                                                userName.c_str(),
                                                password.c_str()),
                                        &quot;Logging in&quot;);
        amqp_channel_open(conn, 1);
        die_on_amqp_error(amqp_get_rpc_reply(conn), &quot;Opening channel&quot;);

...............................

    die_on_error(amqp_basic_publish(conn,
                                    1,
                                    amqp_cstring_bytes(&quot;TestExchange&quot;),
                                    amqp_cstring_bytes(topic_str.c_str()),
                                    0,
                                    0,
                                    NULL,
                                    message_bytes),
                 &quot;Publishing&quot;);

Thanks a lot.

Best regards
Shixin

________________________________________
From: Marek Majkowski [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">majek04 at gmail.com</A>]
Sent: Thursday, March 03, 2011 1:34 PM
To: Shixin Song
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] RabbitMQ latency and message lost issue.

On Wed, Mar 2, 2011 at 13:43, Shixin Song &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">Shixin.Song at markit.com</A>&gt; wrote:
&gt;<i> To whom it may concern,
</I>&gt;<i>
</I>&gt;<i> I am testing RabbitMQ at this moment. I have installed rabbitmq server and developed C++ client library using rabbitmq C library.
</I>&gt;<i>
</I>&gt;<i> I found out that RabbitMQ never drops the message which means it has 0 message loss. But in my case, the latency is much more important than the message loss. Some message loss is acceptable in order to limit the maximal message latency. Could any one inform me how to configure rabbitmq to let it drop some messages when the latency is too high or the queue is reached to a maximum value.
</I>&gt;<i>
</I>
You can tell rabbit to drop messages 'older than' something -
<A HREF="http://www.rabbitmq.com/extensions.html#queue-ttl">http://www.rabbitmq.com/extensions.html#queue-ttl</A>

Also take a look at immediate flag to basic.publish (this will forbid
message from
being published if it can't be delivered to a consumer immediately)
<A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish">http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish</A>

But it's your responsibility to ensure that messages are being consumed
fast enough. Queue.ttl and 'immediate' may help, but eventually
RabbitMQ is a queuing system constructed to queue messages - not lose
them randomly.

Cheers,
  Marek

This e-mail, including accompanying communications and attachments, is strictly confidential and only for the intended recipient. Any retention, use or disclosure not expressly authorised by Markit is prohibited. This email is subject to all waivers and other terms at the following link: <A HREF="http://www.markit.com/en/about/legal/email-disclaimer.page">http://www.markit.com/en/about/legal/email-disclaimer.page</A>

We have recently moved to our new head office located at Ropemaker Place, 25 Ropemaker Street, London, EC2Y 9LY.
Please visit <A HREF="http://www.markit.com/en/about/contact/contact-us.page?">http://www.markit.com/en/about/contact/contact-us.page?</A> for contact information on our offices worldwide.
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011618.html">[rabbitmq-discuss] RabbitMQ latency and message lost issue.
</A></li>
	<LI>Next message: <A HREF="011627.html">[rabbitmq-discuss] RabbitMQ latency and message lost issue.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11621">[ date ]</a>
              <a href="thread.html#11621">[ thread ]</a>
              <a href="subject.html#11621">[ subject ]</a>
              <a href="author.html#11621">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
