<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Message returned as unroutable even if consumer is listening
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Message%20returned%20as%20unroutable%20even%20if%0A%20consumer%20is%20listening&In-Reply-To=%3CAANLkTimBv%2Bior9wutznmsaRq4Wri9bQ9JgxKSxneBpE3%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011623.html">
   <LINK REL="Next"  HREF="011632.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Message returned as unroutable even if consumer is listening</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Message%20returned%20as%20unroutable%20even%20if%0A%20consumer%20is%20listening&In-Reply-To=%3CAANLkTimBv%2Bior9wutznmsaRq4Wri9bQ9JgxKSxneBpE3%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Message returned as unroutable even if consumer is listening">majek04 at gmail.com
       </A><BR>
    <I>Thu Mar  3 13:10:56 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011623.html">[rabbitmq-discuss] Message returned as unroutable even if consumer is listening
</A></li>
        <LI>Next message: <A HREF="011632.html">[rabbitmq-discuss] Message returned as unroutable even if consumer is listening
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11624">[ date ]</a>
              <a href="thread.html#11624">[ thread ]</a>
              <a href="subject.html#11624">[ subject ]</a>
              <a href="author.html#11624">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Mar 3, 2011 at 12:55, Jiri Krutil &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jiri at krutil.com</A>&gt; wrote:
&gt;<i> Marek,
</I>&gt;<i>
</I>&gt;&gt;<i> As you can see immediate-&gt;&quot;undelivered&quot;, mandatory-&gt;&quot;unroutable&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You can try using rabbitmq-management plugin to debug if your
</I>&gt;&gt;<i> exchanges/bindings/queues are configured properly.
</I>&gt;&gt;<i> (you may also try rabbitmqctl, but it's harder to use)
</I>&gt;<i>
</I>&gt;<i> Thanks for your response. I think that our configuration is correct.
</I>&gt;<i>
</I>&gt;<i> The thing we don't understand is that our messages are being returned by the
</I>&gt;<i> broker because of &quot;no consumers&quot;, even if we can see a consumer listening
</I>&gt;<i> (both via rabbitmqctl and the management plugin).
</I>&gt;<i>
</I>&gt;<i> In all other environments this design seems to work fine. We are trying to
</I>&gt;<i> find out what is wrong with the single broker installation that does not
</I>&gt;<i> want to accept any messages.
</I>
Okay. You're probably using basic.qos and/or acknowledgments.

'Immediate' is interpreted by rabbit as follows:
 - pick up a consumer from 'free' consumers list
 - deliver message.

If no consumer is 'free' rabbit will return the message.

The problem is when a consumer is treated as 'free'.

The consumer is always 'free' if it's not using acknowledgments.
In such case rabbit will just push all the messages to it.
(well, it's more complicated, rabbit may still dislike the
consumer if the network connection is too slow)

If consumer is using acks _and_ is not acking messages
fast enough - rabbit will have to queue the messages.
The queue size will grow and rabbit will not be able
to 'immediately' deliver messages.

If you set basic.qos(N) - rabbit will move the consumer
off the 'free' list if the consumer has N unacknowledged
messages.
If you don't set basic.qos, I think rabbit will deliver
100 messages before moving the consumer off the 'free' state.

Is your consumer fast enough?

Cheers,
  Marek
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011623.html">[rabbitmq-discuss] Message returned as unroutable even if consumer is listening
</A></li>
	<LI>Next message: <A HREF="011632.html">[rabbitmq-discuss] Message returned as unroutable even if consumer is listening
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11624">[ date ]</a>
              <a href="thread.html#11624">[ thread ]</a>
              <a href="subject.html#11624">[ subject ]</a>
              <a href="author.html#11624">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
