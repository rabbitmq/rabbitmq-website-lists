<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] ERL crashes when messages are being pumped into a queue under win32 envir
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ERL%20crashes%20when%20messages%20are%20being%20pumped%0A%20into%20a%20queue%20under%20win32%20envir&In-Reply-To=%3C4D949CF4.4070504%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012136.html">
   <LINK REL="Next"  HREF="012143.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] ERL crashes when messages are being pumped into a queue under win32 envir</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ERL%20crashes%20when%20messages%20are%20being%20pumped%0A%20into%20a%20queue%20under%20win32%20envir&In-Reply-To=%3C4D949CF4.4070504%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] ERL crashes when messages are being pumped into a queue under win32 envir">emile at rabbitmq.com
       </A><BR>
    <I>Thu Mar 31 16:25:40 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012136.html">[rabbitmq-discuss] ERL crashes when messages are being pumped into a queue under win32 envir
</A></li>
        <LI>Next message: <A HREF="012143.html">[rabbitmq-discuss] multiple routing keys on a queue.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12199">[ date ]</a>
              <a href="thread.html#12199">[ thread ]</a>
              <a href="subject.html#12199">[ subject ]</a>
              <a href="author.html#12199">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Ming,

On 30/03/11 10:40, Ming Li wrote:
&gt;<i> 1.using RabbitMQ2.4.0(windows bundle).winxp,creates an exchange and a queue.
</I>&gt;<i>
</I>&gt;<i> 2.use multiple sender to send messages into the created queue,only a
</I>&gt;<i> single receiverreceiving message from the same queue.
</I>&gt;<i>
</I>&gt;<i> 3.while running, what i discovered is that the ERL's RAM usage continue
</I>&gt;<i> to increase and then crash when it reaches a certain percentage
</I>&gt;<i>
</I>&gt;<i> Is there a way to prevent it from crashing?
</I>
Are you sure it's the broker that runs out of memory and not the 
receiver? Is the receiver and the rabbit broker running on the same 
hardware?

I see that the channel is not setting QoS. This will cause the broker to 
deliver messages to the receiver QueueingBasicConsumer as quickly as it 
can, and the receiver could run out of memory as a result. This is more 
likely to occur if the consumer is slower than the sender. The solution 
to this problem is to set the QoS prefetch count (IModel.BasicQos) to a 
small number and use explicit acknowledgements.

If it really is the broker that runs out of memory could you confirm 
whether the broker logfile contains entries with both &quot;alarm_handler&quot; 
and &quot;vm_memory_high_watermark&quot;? What else appears in the broker logfile 
near the time of the crash?

-Emile

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012136.html">[rabbitmq-discuss] ERL crashes when messages are being pumped into a queue under win32 envir
</A></li>
	<LI>Next message: <A HREF="012143.html">[rabbitmq-discuss] multiple routing keys on a queue.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12199">[ date ]</a>
              <a href="thread.html#12199">[ thread ]</a>
              <a href="subject.html#12199">[ subject ]</a>
              <a href="author.html#12199">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
