<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] EndOfStreamException SharedQueue closed with .net client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20EndOfStreamException%20SharedQueue%20closed%20with%0A%20.net%20client&In-Reply-To=%3C4D8C6B90.1080003%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012022.html">
   <LINK REL="Next"  HREF="012028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] EndOfStreamException SharedQueue closed with .net client</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20EndOfStreamException%20SharedQueue%20closed%20with%0A%20.net%20client&In-Reply-To=%3C4D8C6B90.1080003%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] EndOfStreamException SharedQueue closed with .net client">emile at rabbitmq.com
       </A><BR>
    <I>Fri Mar 25 10:16:48 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012022.html">[rabbitmq-discuss] EndOfStreamException SharedQueue closed with	.net client
</A></li>
        <LI>Next message: <A HREF="012028.html">[rabbitmq-discuss] EndOfStreamException SharedQueue closed with	.net client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12026">[ date ]</a>
              <a href="thread.html#12026">[ thread ]</a>
              <a href="subject.html#12026">[ subject ]</a>
              <a href="author.html#12026">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Dex,

On 24/03/11 23:13, Dex wrote:
&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> new to RabbitMQ here :) Version 2.4.0, erlang 5.8.3, win7 x64, .Net 4
</I>&gt;<i>
</I>&gt;<i> Learning the API, I've based the code below on the examples in the
</I>&gt;<i> dotnet client user guide.
</I>&gt;<i>
</I>&gt;<i> When run, the Task thread will dequeue the message fine, but will
</I>&gt;<i> throw when starting to de-queue again:
</I>
The problem is the combination of these two lines:

&gt;<i> 			consumerChannel.BasicConsume(consumerQueue, true, consumer);
</I>
&gt;<i> 					consumerChannel.BasicAck(e.DeliveryTag, false);
</I>
You are consuming from the queue in auto-ack mode and explicitly 
acknowledging the message. This amounts to a duplicate acknowledgement 
which is forbidden. The broker is required by the AMQP specification to 
raise a channel exception in this situation. The exception you see is a 
result of this.

The solution is either to set the auto-ack flag to false when 
registering the consumer or to remove the explicit acknowledgement.

You are closing the channel and connection in the wrong order in the 
task, but the previous error prevents this code from being reached.

In this case you only need a single connection. You can create a 
consumer channel and a producer channel over the same connection. At the 
moment your program won't terminate, because the separate consumer 
connection remains open and the task doesn't know that the main thread 
has terminated.


Regards

Emile




</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012022.html">[rabbitmq-discuss] EndOfStreamException SharedQueue closed with	.net client
</A></li>
	<LI>Next message: <A HREF="012028.html">[rabbitmq-discuss] EndOfStreamException SharedQueue closed with	.net client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12026">[ date ]</a>
              <a href="thread.html#12026">[ thread ]</a>
              <a href="subject.html#12026">[ subject ]</a>
              <a href="author.html#12026">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
