<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Pathological dead queue behavior in a cluster.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pathological%20dead%20queue%20behavior%20in%20a%20cluster.&In-Reply-To=%3CAANLkTikNdoO1hd%3DMfkPr93KwrY8gVsyM%3DoeYGdAhCq4C%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012157.html">
   <LINK REL="Next"  HREF="012161.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Pathological dead queue behavior in a cluster.</H1>
    <B>Jason J. W. Williams</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pathological%20dead%20queue%20behavior%20in%20a%20cluster.&In-Reply-To=%3CAANLkTikNdoO1hd%3DMfkPr93KwrY8gVsyM%3DoeYGdAhCq4C%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Pathological dead queue behavior in a cluster.">jasonjwwilliams at gmail.com
       </A><BR>
    <I>Wed Mar 30 22:17:19 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012157.html">[rabbitmq-discuss] Ubuntu + RabbitMQ 2.4.0 EC2 AMI
</A></li>
        <LI>Next message: <A HREF="012161.html">[rabbitmq-discuss] Pathological dead queue behavior in a	cluster.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12160">[ date ]</a>
              <a href="thread.html#12160">[ thread ]</a>
              <a href="subject.html#12160">[ subject ]</a>
              <a href="author.html#12160">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Guys,

I've run into an interesting edge case that I don't seem to have a solution
for. I've got a local cluster with three nodes (2 disk, 1 RAM) called:
rabbit, rabbit_1 and rabbit_2.

If I attach a consumer (<A HREF="https://gist.github.com/895274">https://gist.github.com/895274</A>) to rabbit_1
(declares queue, exchange and bindings) and start consuming, I can publish (
<A HREF="https://gist.github.com/895275">https://gist.github.com/895275</A>) to rabbit or rabbit_2 and the messages are
consumed as expected. At this point the queue is living on rabbit and my
consumer for it is attached to rabbit_1.

If I shutdown rabbit, the queue on it disappears as expected (the queue at
this point is non-durable). However, the queue's consumer on rabbit_1 sits
there fat dumb and happy even though no queue exists anymore. Is this
expected behavior?

To further test, I changed the queue to a durable one and replayed the
previous events. Except this time since the consumer was still fat dumb and
happy, I restarted the rabbit node. Then I published again. Still nothing on
the consumer and the queue (which had returned) had a queue count of 0.
Doing a list_bindings showed the binding to still exist. But no amount of
publishing would end up in the restored queue or the consumer. The only
thing that allowed the queue to receive messages again (and the consumer to
receive them) was to redeclare the binding. This seems like an error since
the binding was reported as still existing.

Any help or pointers are greatly appreciated, as with this behavior
consumers of queue in a cluster could sit forever and never consume a
message after a failed node (and if the queue was durable, messages appear
to be blackholed despite the node being restored). This was on RabbitMQ
2.4.0 on OS X 10.6.7.

Thank you in advance.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/e94339c1/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/e94339c1/attachment-0001.htm</A>&gt;
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012157.html">[rabbitmq-discuss] Ubuntu + RabbitMQ 2.4.0 EC2 AMI
</A></li>
	<LI>Next message: <A HREF="012161.html">[rabbitmq-discuss] Pathological dead queue behavior in a	cluster.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12160">[ date ]</a>
              <a href="thread.html#12160">[ thread ]</a>
              <a href="subject.html#12160">[ subject ]</a>
              <a href="author.html#12160">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
