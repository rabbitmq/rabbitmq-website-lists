<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster size limit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20size%20limit&In-Reply-To=%3CBANLkTinRp5uU2cqJiZz%3DHknsUHEWiqETkw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012070.html">
   <LINK REL="Next"  HREF="012072.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster size limit</H1>
    <B>Alexis Richardson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20size%20limit&In-Reply-To=%3CBANLkTinRp5uU2cqJiZz%3DHknsUHEWiqETkw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Cluster size limit">alexis at rabbitmq.com
       </A><BR>
    <I>Sun Mar 27 22:25:59 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012070.html">[rabbitmq-discuss] Cluster size limit
</A></li>
        <LI>Next message: <A HREF="012072.html">[rabbitmq-discuss] Cluster size limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12071">[ date ]</a>
              <a href="thread.html#12071">[ thread ]</a>
              <a href="subject.html#12071">[ subject ]</a>
              <a href="author.html#12071">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Advait

There is no benefit to clustering terminal nodes which (as I
understand it) are not sharing internal state with each other.
Instead look to share queues and exchanges by running them on brokers,
and connecting multiple terminal nodes to those brokers.

You should run RabbitMQ clients at terminal nodes.  Connect them to
brokers running at non-terminal nodes.  For broker-broker links, use
Shovel.  We are working on a federation model that is more flexible
than shovel - if you are interested, talk to Simon (cc'd).

Does this help?

alexis




On Sun, Mar 27, 2011 at 9:33 PM, Advait Alai &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">advaitalai at gmail.com</A>&gt; wrote:
&gt;&gt;<i> However - RabbitMQ clustering is not designed as a way to create
</I>&gt;&gt;<i> pubsub overlays for the wide area. &#160;Its primary goal is scalability of
</I>&gt;&gt;<i> one broker by adding nodes on the same LAN. &#160;This is for, eg, cases
</I>&gt;&gt;<i> where the number of subscriptions (or &quot;bindings&quot;) on the broker grows
</I>&gt;&gt;<i> beyond what one machine can physically cope with.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Now, this does not stop you wiring up 1,000s of RabbitMQ brokers. &#160;But
</I>&gt;&gt;<i> using RabbitMQ clustering is the wrong way to do that. &#160;Can you tell
</I>&gt;&gt;<i> us a bit more about the pubsub topology you want to study, please?
</I>&gt;&gt;<i> That may help us suggest the optimal way to solve your problem..
</I>&gt;<i>
</I>&gt;<i> The topology looks like this:&#160;<A HREF="http://imgur.com/8iep0&#160;(taken">http://imgur.com/8iep0&#160;(taken</A>
</I>&gt;<i> from&#160;<A HREF="http://ctieware.eng.monash.edu.au/twiki/bin/view/Simulation/LargePacket-switchingNetworkTopologies">http://ctieware.eng.monash.edu.au/twiki/bin/view/Simulation/LargePacket-switchingNetworkTopologies</A>)
</I>&gt;<i> The terminal nodes shown in the topology are either publishers or
</I>&gt;<i> subscribers, and I want RabbitMQ to run as a middleware over the entire
</I>&gt;<i> network. The network (routers and links) are simulated by NS3, So it is
</I>&gt;<i> essentially a set of point to point links, where each link is a separate
</I>&gt;<i> network. The terminal nodes are VMs (that would run the amqp/rabbitmq
</I>&gt;<i> scripts) which I am attempting to cluster so they can use a common set of
</I>&gt;<i> queues and exchanges. So all terminal nodes are in different LANs.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also, can you explain why QoS studies require the study of 1,000s of
</I>&gt;&gt;<i> nodes? &#160;Perhaps you mean 1,000s of clients?
</I>&gt;<i>
</I>&gt;<i> I'm not sure I understood -- I'm trying to provide high fidelity results, so
</I>&gt;<i> I thought the testbed should be atleast of the same order of size as the
</I>&gt;<i> network on which it needs to be deployed (&gt;50000 nodes). There are a few
</I>&gt;<i> strict IEEE standards regarding this network that specify the minimum QoS
</I>&gt;<i> guarantees required.
</I>&gt;<i> Is there an easier way to do this?
</I>&gt;<i> Thanks
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Sun, Mar 27, 2011 at 7:11 PM, Advait Alai &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">advaitalai at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; Thanks for the reply --
</I>&gt;&gt;<i> &gt; On Sun, Mar 27, 2011 at 9:38 PM, Jerry Kuch &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jerryk at vmware.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; 150 is a pretty big sounding cluster... &#160;Out of curiosity, what's
</I>&gt;&gt;<i> &gt;&gt; motivating you to go so big (if you don't mind saying)?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I am doing a QoS analysis of publish-subscribe overlays using RabbitMQ
</I>&gt;&gt;<i> &gt; in
</I>&gt;&gt;<i> &gt; wide area networks (These are country wide networks, so even a 1000
</I>&gt;&gt;<i> &gt; nodes
</I>&gt;&gt;<i> &gt; might be insufficient :-)) So stuff like packet delay, loss,
</I>&gt;&gt;<i> &gt; out-of-order
</I>&gt;&gt;<i> &gt; delivery etc.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; On that note, because RabbitMQ clustering is based on Erlang
</I>&gt;&gt;<i> &gt;&gt; distribution,
</I>&gt;&gt;<i> &gt;&gt; the current practical limit you'll probably run up against is somewhat
</I>&gt;&gt;<i> &gt;&gt; lower
</I>&gt;&gt;<i> &gt;&gt; than the 150 you have in mind. &#160;Something more like 32 to 64.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Is there a configuration that would let me scale to &gt;64 nodes, even if
</I>&gt;&gt;<i> &gt; it
</I>&gt;&gt;<i> &gt; would not be practical? And in case Erlang does not scale well, I'll
</I>&gt;&gt;<i> &gt; probably have to resort to entirely another middleware -- any
</I>&gt;&gt;<i> &gt; suggestions
</I>&gt;&gt;<i> &gt; that would work on a larger number of nodes?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; If you can say more about your goals it's likely that someone on the
</I>&gt;&gt;<i> &gt;&gt; Rabbit team can suggest something helpful.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; The analysis I'm carrying out on &gt;100 nodes is actually on a single
</I>&gt;&gt;<i> &gt; system.
</I>&gt;&gt;<i> &gt; These 'nodes' are actually many light weight linux containers (more or
</I>&gt;&gt;<i> &gt; less
</I>&gt;&gt;<i> &gt; virtual machines) connected by a simulated NS3 network topology. But I
</I>&gt;&gt;<i> &gt; doubt
</I>&gt;&gt;<i> &gt; this would be the cause of the clustering problem, as &lt;50 nodes were
</I>&gt;&gt;<i> &gt; clustering without any difficulty.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; On Mar 26, 2011, at 10:32 PM, &quot;Advait Alai&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">advaitalai at gmail.com</A>&gt;
</I>&gt;&gt;<i> &gt;&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; Hi,
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; I'm trying to add 150 nodes to a RabbitMQ cluster. After around 50
</I>&gt;&gt;<i> &gt;&gt; &gt; nodes, the stop-reset-cluster-start iteration starts giving the
</I>&gt;&gt;<i> &gt;&gt; &gt; error:
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; Stopping node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node130</A> ...
</I>&gt;&gt;<i> &gt;&gt; &gt; ...done.
</I>&gt;&gt;<i> &gt;&gt; &gt; Resetting node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node130</A> ...
</I>&gt;&gt;<i> &gt;&gt; &gt; ...done.
</I>&gt;&gt;<i> &gt;&gt; &gt; Clustering node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node130</A> with [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node117</A>] ...
</I>&gt;&gt;<i> &gt;&gt; &gt; ...done.
</I>&gt;&gt;<i> &gt;&gt; &gt; Starting node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node130</A> ...
</I>&gt;&gt;<i> &gt;&gt; &gt; Error: {cannot_start_application,rabbit,
</I>&gt;&gt;<i> &gt;&gt; &gt; &#160; &#160; &#160; &#160; &#160; &#160;{bad_return,
</I>&gt;&gt;<i> &gt;&gt; &gt; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;{{rabbit,start,[normal,[]]},
</I>&gt;&gt;<i> &gt;&gt; &gt; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; {'EXIT',{rabbit,failure_during_boot}}}}}
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; Note that I am sequentially adding nodes to build a cluster (as an
</I>&gt;&gt;<i> &gt;&gt; &gt; initialization step) before creating any queues/exchanges or running
</I>&gt;&gt;<i> &gt;&gt; &gt; any
</I>&gt;&gt;<i> &gt;&gt; &gt; amqp script.
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; How do I solve this problem? Is it because RabbitMQ imposes a hard
</I>&gt;&gt;<i> &gt;&gt; &gt; cluster size limit?
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; Also, does RabbitMQ scale well to around 1000 nodes?
</I>&gt;&gt;<i> &gt;&gt; &gt;
</I>&gt;&gt;<i> &gt;&gt; &gt; Thanks
</I>&gt;&gt;<i> &gt;&gt; &gt; _______________________________________________
</I>&gt;&gt;<i> &gt;&gt; &gt; rabbitmq-discuss mailing list
</I>&gt;&gt;<i> &gt;&gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> &gt;&gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012070.html">[rabbitmq-discuss] Cluster size limit
</A></li>
	<LI>Next message: <A HREF="012072.html">[rabbitmq-discuss] Cluster size limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12071">[ date ]</a>
              <a href="thread.html#12071">[ thread ]</a>
              <a href="subject.html#12071">[ subject ]</a>
              <a href="author.html#12071">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
