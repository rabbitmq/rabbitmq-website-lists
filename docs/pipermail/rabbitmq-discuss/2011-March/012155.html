<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] 2.4.0 channel and connection close behavior
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%202.4.0%20channel%20and%20connection%20close%20behavior&In-Reply-To=%3C20110330194131.GA1577%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012153.html">
   <LINK REL="Next"  HREF="012158.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] 2.4.0 channel and connection close behavior</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%202.4.0%20channel%20and%20connection%20close%20behavior&In-Reply-To=%3C20110330194131.GA1577%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] 2.4.0 channel and connection close behavior">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Mar 30 20:41:32 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012153.html">[rabbitmq-discuss] 2.4.0 channel and connection close behavior
</A></li>
        <LI>Next message: <A HREF="012158.html">[rabbitmq-discuss] 2.4.0 channel and connection close behavior
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12155">[ date ]</a>
              <a href="thread.html#12155">[ thread ]</a>
              <a href="subject.html#12155">[ subject ]</a>
              <a href="author.html#12155">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Mar 30, 2011 at 02:34:24PM -0400, Aaron Westendorf wrote:
&gt;<i> In 2.3.0 and prior, I could send the connection close even if there
</I>&gt;<i> were pending channel closures, but in 2.4.0, if I send a channel close
</I>&gt;<i> followed immediately by a connection close, I stop receiving frames
</I>&gt;<i> altogether.  This occurred with one channel (beyond 0) and 500
</I>&gt;<i> channels.  I didn't enable heartbeats so perhaps frame processing was
</I>&gt;<i> still alive but I simply never received a close_ok on the channel or
</I>&gt;<i> connection.
</I>&gt;<i> 
</I>&gt;<i> I assume that this is a bug but could easily be a stricter
</I>&gt;<i> interpretation of the spec.
</I>
I think it's a different interpretation of the spec. Certainly we
changed some code in those areas to solve another genuine bug, where a
close_oks were not being sent (the issue is: if both a client and the
server send channel.close (or connection.close) to each other at the
same time (they pass in mid-air), _both_ client and server should reply
with (channel|connection).close_ok.

Now in the course of fixing that, we may have changed behaviour
elsewhere, but I believe that the spec is silent as to what should
happen if the client sends channel.close and then immediately follows
that with connection.close. The only guarantee you'll have is that you
should get back the connection.close_ok. I don't believe the spec says
that the connection.close_ok should be delayed until all pending channel
closes complete - after all, why special case the channel.close? - no
other methods are waited upon when a connection.close occurs.

However, from your description above, it sounds like you're not even
getting the connection.close_ok back. Is that really the case?

Matthew
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012153.html">[rabbitmq-discuss] 2.4.0 channel and connection close behavior
</A></li>
	<LI>Next message: <A HREF="012158.html">[rabbitmq-discuss] 2.4.0 channel and connection close behavior
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12155">[ date ]</a>
              <a href="thread.html#12155">[ thread ]</a>
              <a href="subject.html#12155">[ subject ]</a>
              <a href="author.html#12155">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
