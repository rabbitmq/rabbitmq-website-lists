<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Spying on &quot;mandatory&quot; messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Spying%20on%20%22mandatory%22%20messages&In-Reply-To=%3C20110324150517.GE29884%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012004.html">
   <LINK REL="Next"  HREF="012006.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Spying on &quot;mandatory&quot; messages</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Spying%20on%20%22mandatory%22%20messages&In-Reply-To=%3C20110324150517.GE29884%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Spying on &quot;mandatory&quot; messages">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Mar 24 15:05:17 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012004.html">[rabbitmq-discuss] Spying on &quot;mandatory&quot; messages
</A></li>
        <LI>Next message: <A HREF="012006.html">[rabbitmq-discuss] Spying on &quot;mandatory&quot; messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12005">[ date ]</a>
              <a href="thread.html#12005">[ thread ]</a>
              <a href="subject.html#12005">[ subject ]</a>
              <a href="author.html#12005">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Charly,

On Thu, Mar 24, 2011 at 03:35:35PM +0100, Charly Hamy wrote:
&gt;<i> For the req/res scenario, I'm using the mandatory flag on my messages, so
</I>&gt;<i> that sending a request message to a disconnected component (no corresponding
</I>&gt;<i> queue declared on the broker) returns an error to the sender. This works as
</I>&gt;<i> expected.
</I>
Well... you're using mandatory as a poor-man's form of resource
monitoring.

&gt;<i> But now, I would want to plug new components to spy on those flows of
</I>&gt;<i> requests and responses, without interfering with the ongoing
</I>&gt;<i> communications... which is not by default compatible with my use of the
</I>&gt;<i> mandatory flag : when a &quot;spy&quot; component is monitorng request/response
</I>&gt;<i> messages, those messages end-up in its queue, then even if the actual target
</I>&gt;<i> component for those messages is not present on the broker (no queue), no
</I>&gt;<i> error is returned to the sender.
</I>
Indeed, which is why mandatory is probably a mis-feature and should not
be used. Basically, AMQP does not really provide any sort of sane
resource monitoring. We've added in the 2.4.0 release consumer-death
notifications, but that's not going to help you here. You really have a
choice: make the queue non-exclusive and non-autodelete. Thus it always
stays there and will always receive messages. Then, you have your
clients just consume from it. The queue will do round-robining between
the consumers and all should be well, but you might have reasons why you
want the queue to be exclusive or autodelete. The other option is to use
some other tool to do monitoring of your consumers and to address that
problem outside of AMQP/RabbitMQ.

Best wishes,

Matthew
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012004.html">[rabbitmq-discuss] Spying on &quot;mandatory&quot; messages
</A></li>
	<LI>Next message: <A HREF="012006.html">[rabbitmq-discuss] Spying on &quot;mandatory&quot; messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12005">[ date ]</a>
              <a href="thread.html#12005">[ thread ]</a>
              <a href="subject.html#12005">[ subject ]</a>
              <a href="author.html#12005">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
