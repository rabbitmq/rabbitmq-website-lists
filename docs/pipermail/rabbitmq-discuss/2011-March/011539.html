<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20socket%20error%20while%20using%20rabbitmq%20and%20a%20NAT%0A%20%28Network%20address%20translation%29&In-Reply-To=%3CAANLkTi%3Dd12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011577.html">
   <LINK REL="Next"  HREF="011544.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)</H1>
    <B>mysurf mail</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20socket%20error%20while%20using%20rabbitmq%20and%20a%20NAT%0A%20%28Network%20address%20translation%29&In-Reply-To=%3CAANLkTi%3Dd12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)">stammailbox at gmail.com
       </A><BR>
    <I>Tue Mar  1 09:14:14 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="011577.html">[rabbitmq-discuss] Losing messages, why?
</A></li>
        <LI>Next message: <A HREF="011544.html">[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11539">[ date ]</a>
              <a href="thread.html#11539">[ thread ]</a>
              <a href="subject.html#11539">[ subject ]</a>
              <a href="author.html#11539">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
Thanks for your response.

I followed your advice and here are my results.
 I see myself in the connection list when I invoke a connection from a
computer that gets the exception. I see it with &quot;starting&quot;  status and
instantly it disappears. (I use new exchange name and no exchange is
created)

I tried to follow your advice about the tracer but i didn't find enough info
about the file runjava.bat in 2.3.1 (it exists only in the 1.7.0 package.
not the 2.3.1.)

it happens from almost half of the servers. not only the ones with the NAT.
thanks.

On Mon, Feb 28, 2011 at 5:34 PM, Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> There is no reason why an AMQP connection won't work over NAT. This is
</I>&gt;<i> equally for version 1.7.0 and 2.3.1. It is likely that the cause for this
</I>&gt;<i> error is at the network layer.
</I>&gt;<i>
</I>&gt;<i> Does the broker logfile contain any other relevant messages other than the
</I>&gt;<i> one about the abrupt disconnection?
</I>&gt;<i>
</I>&gt;<i> Can you get &quot;rabbitmqctl list_connections&quot; on the broker to list the
</I>&gt;<i> connection from the client at any time?
</I>&gt;<i> Are you able to establish an AMQP channel and issue the basicConsume(), or
</I>&gt;<i> does the error occur earlier during connection establishment?
</I>&gt;<i>
</I>&gt;<i> Do you have any way of checking the state of the connection on the NAT
</I>&gt;<i> device?
</I>&gt;<i>
</I>&gt;<i> Establishing the AMQP connection via the AMQP Tracer (
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html">http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html</A> ) might
</I>&gt;<i> also provide useful diagnostic information.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Emile
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 27/02/11 13:06, mysurf mail wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi ,
</I>&gt;&gt;<i> I am writing a new mail because my last issue was solved .
</I>&gt;&gt;<i> It is just that on a certain computer my application stopped working.
</I>&gt;&gt;<i> So it is a new issue and I will explain and paste the exception below.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Basically, I did three things :
</I>&gt;&gt;<i> 1. I upgraded from 1.7.0 to 2.3.1 (installed a new erlang also)
</I>&gt;&gt;<i> 2. I upgraded the client jars
</I>&gt;&gt;<i> 3. changed the protocol to ack = true;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> channel.basicConsume(queueName, true, queueingConsumer);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> well, that certain computer is behind a firewall, and has a NAT (Network
</I>&gt;&gt;<i> Address Translation ).
</I>&gt;&gt;<i> It did work prior to the upgrade with the NAT (mySQL also handles it
</I>&gt;&gt;<i> pretty well).
</I>&gt;&gt;<i> with the same ports.
</I>&gt;&gt;<i> Maybe it is the bidirectional channel (since I added acking? I dont
</I>&gt;&gt;<i> think so...).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> what I can see is that.
</I>&gt;&gt;<i> when the client tries to connect it writes in the logs
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Connection closed abruptly
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And now, behold, the exception :
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [...]
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110301/304bf057/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110301/304bf057/attachment-0001.htm</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011577.html">[rabbitmq-discuss] Losing messages, why?
</A></li>
	<LI>Next message: <A HREF="011544.html">[rabbitmq-discuss] socket error while using rabbitmq and a NAT (Network address translation)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11539">[ date ]</a>
              <a href="thread.html#11539">[ thread ]</a>
              <a href="subject.html#11539">[ subject ]</a>
              <a href="author.html#11539">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
