<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consistent Hash Exchange
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consistent%20Hash%20Exchange&In-Reply-To=%3C50E70E03.4000306%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024786.html">
   <LINK REL="Next"  HREF="024801.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consistent Hash Exchange</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consistent%20Hash%20Exchange&In-Reply-To=%3C50E70E03.4000306%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Consistent Hash Exchange">simon at rabbitmq.com
       </A><BR>
    <I>Fri Jan  4 17:14:43 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="024786.html">[rabbitmq-discuss] Consistent Hash Exchange
</A></li>
        <LI>Next message: <A HREF="024801.html">[rabbitmq-discuss] Consistent Hash Exchange
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24787">[ date ]</a>
              <a href="thread.html#24787">[ thread ]</a>
              <a href="subject.html#24787">[ subject ]</a>
              <a href="author.html#24787">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So some of this comes down to &quot;it depends what you want to do&quot;. If you 
are doing some routing based on the routing key (before?) the messages 
hit the CHX then you presumably are using e2e bindings like so:

                 /&gt; Q1
          &gt; CHX1 -&gt; Q2
         /       \&gt; Q3
        /        /&gt; Q4
P -&gt; X --&gt; CHX2 -&gt; Q5
        \        \&gt; Q6
         \       /&gt; Q7
          &gt; CHX3 -&gt; Q8
                 \&gt; Q9

with routing for message type at X and then load balancing at CHX{1,2,3}.

So if the X in question is a topic exchange then option i) should work 
fine in the scenario above. Putting the hash at either end is fine, the 
key becomes a tree structure for routing anyway.

I don't know what exchange type you are currently using although I guess 
topic; if you are using a direct exchange you would either have to 
switch to topic or change your publishers to publish to one of several 
CHXs rather than to one DX with one of several routing keys.

Options ii) and iii) struggle with the fact that the CHX doesn't 
currently support hashing on anything other than the routing key.

Cheers, Simon

On 04/01/13 15:13, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew.collinge at comparethemarket.com</A> wrote:
&gt;<i> We are looking at using your consistent hash exchange for partitioning
</I>&gt;<i> messages that we need to be processes synchronously based on a partition
</I>&gt;<i> key (GUID in our case). The issue we currently face is that we are
</I>&gt;<i> already using the routing key for subscriptions based on message type.
</I>&gt;<i> As there will be messages of multiple types for the same partition key
</I>&gt;<i> this will result in different routing keys and therefore different
</I>&gt;<i> hashes of those keys for message that we want partitioned into the same
</I>&gt;<i> destination queue.
</I>&gt;<i>
</I>&gt;<i> What would be the best way to go about trying to achieve this? I have
</I>&gt;<i> thought of the following options but do not know the relative merits
</I>&gt;<i> with respect to performance and the inner workings of RabbitMQ:
</I>&gt;<i>
</I>&gt;<i> i)Hash based on the first or last portion of a routing key
</I>&gt;<i> (&lt;HashME&gt;.Iamused.For.Other.Routing)
</I>&gt;<i>
</I>&gt;<i> ii)Hash based on a Message Header
</I>&gt;<i>
</I>&gt;<i> iii)Hash based on a Message Property
</I>&gt;<i>
</I>&gt;<i> Is there any approach that you would advocate or indeed strongly advise
</I>&gt;<i> against?
</I>&gt;<i>
</I>&gt;<i> Thank you in advance.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024786.html">[rabbitmq-discuss] Consistent Hash Exchange
</A></li>
	<LI>Next message: <A HREF="024801.html">[rabbitmq-discuss] Consistent Hash Exchange
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24787">[ date ]</a>
              <a href="thread.html#24787">[ thread ]</a>
              <a href="subject.html#24787">[ subject ]</a>
              <a href="author.html#24787">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
