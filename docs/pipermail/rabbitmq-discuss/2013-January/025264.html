<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consumer Clients as Tomcat Web Applications and	Work Queue Configuration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumer%20Clients%20as%20Tomcat%20Web%20Applications%20and%0A%09Work%20Queue%20Configuration&In-Reply-To=%3CCAC_yGURXNFrgJ6SM7vb5QjZn2m5GKBXgucUFvuQ4QodNzrz3yA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025281.html">
   <LINK REL="Next"  HREF="025265.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consumer Clients as Tomcat Web Applications and	Work Queue Configuration</H1>
    <B>Kevin Behr</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumer%20Clients%20as%20Tomcat%20Web%20Applications%20and%0A%09Work%20Queue%20Configuration&In-Reply-To=%3CCAC_yGURXNFrgJ6SM7vb5QjZn2m5GKBXgucUFvuQ4QodNzrz3yA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Consumer Clients as Tomcat Web Applications and	Work Queue Configuration">behrk2 at gmail.com
       </A><BR>
    <I>Thu Jan 31 01:33:18 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025281.html">[rabbitmq-discuss] Erlang R15B03
</A></li>
        <LI>Next message: <A HREF="025265.html">[rabbitmq-discuss] Federation Management error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25264">[ date ]</a>
              <a href="thread.html#25264">[ thread ]</a>
              <a href="subject.html#25264">[ subject ]</a>
              <a href="author.html#25264">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone,

I have five RabbitMQ consumer clients that are written and deployed as
Tomcat web applications.  My original intention was to consume messages in
the typical fashion:

while (true) {
QueueingConsumer.Delivery delivery = consumer.nextDelivery();
 String message = new String(delivery.getBody());
System.out.println(&quot; [x] Received '&quot; + message + &quot;'&quot;);
}

However, I was unable to stop the Tomcat application by using the while
loop (see my post @
<A HREF="http://stackoverflow.com/questions/14164517/trouble-stopping-a-tomcat-server-that-is-running-a-web-application-with-a-while">http://stackoverflow.com/questions/14164517/trouble-stopping-a-tomcat-server-that-is-running-a-web-application-with-a-while</A>
).

Instead, I now use a Java ScheduledExecutorService which will call a
consumer once every *x *milliseconds.

scheduler = Executors.newSingleThreadScheduledExecutor();
scheduler.scheduleAtFixedRate(new ScheduledConsumer(), 0, 15000,
TimeUnit.MILLISECONDS);

I modified the consumer to only retrieve one individual message,
using Channel.basicGet:

GetResponse response = channel.basicGet(queueName, autoAck);

This workaround has been working for me without any problems.  However, I'm
starting to wonder if I am going about it all wrong.  You see, I now need
to set up a work queue model, so that I can scale my resources and deploy
additional consumers as the need arises.  So I could spin up a new Tomcat
server and deploy my consumer .war files, and voila.  But it was brought to
my attention that by using Channel.basicGet, I am not in fact truly
consuming - messages are not being pushed down.  I am instead &quot;pulling&quot;
messages.

Therefore, I assume that my consumers will not enjoy the luxury of fair,
round robin dispatching.  Consumer client &quot;A&quot; might retrieve more messages
than consumer client &quot;B&quot;, solely because of the fixed rate at which it was
set to consume.

My questions are as follows:

   1. Is it a bad idea to deploy consumers as Tomcat web applications?  Are
   there any advantages or disadvantages as compared to the alternative of
   running system level Java clients?

   2. In the case of work queues, am I better off retrieving messages that
   are pushed down to my clients, and setting a prefetchCount
   (channel.basicQos(1)) to ensure that I only receive one message at a time?


I would appreciate any advice or suggestions.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/f5b4c38c/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130130/f5b4c38c/attachment.htm</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025281.html">[rabbitmq-discuss] Erlang R15B03
</A></li>
	<LI>Next message: <A HREF="025265.html">[rabbitmq-discuss] Federation Management error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25264">[ date ]</a>
              <a href="thread.html#25264">[ thread ]</a>
              <a href="subject.html#25264">[ subject ]</a>
              <a href="author.html#25264">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
