<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Performance Hit when using Federation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Performance%20Hit%20when%20using%20Federation&In-Reply-To=%3C510963F4.10505%40cray.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025252.html">
   <LINK REL="Next"  HREF="025257.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Performance Hit when using Federation</H1>
    <B>Eric Cozzi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Performance%20Hit%20when%20using%20Federation&In-Reply-To=%3C510963F4.10505%40cray.com%3E"
       TITLE="[rabbitmq-discuss] Performance Hit when using Federation">n16483 at cray.com
       </A><BR>
    <I>Wed Jan 30 18:18:28 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025252.html">[rabbitmq-discuss] Performance Hit when using Federation
</A></li>
        <LI>Next message: <A HREF="025257.html">[rabbitmq-discuss] Why connection.CreateModel in C#?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25253">[ date ]</a>
              <a href="thread.html#25253">[ thread ]</a>
              <a href="subject.html#25253">[ subject ]</a>
              <a href="author.html#25253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wouldn't republishing more so affect latency, not throughput? I'd expect 
that the federated brokers should be able to republish the messages 
nearly as quickly as they received them. Sure there is going to be 
processing time to perform the network read, queue and re-send the 
message, but that shouldn't affect 'how many' messages a federated 
broker can send in a second?

One of the use cases that we're look at is being able to make an RPC 
call where the client and server are potentially on disparate, 
non-routable networks. Essentially, there would only be a few gateway 
nodes that would span both networks. We're looking at installing 
RabbitMQ on these gateway nodes, and at other key points in our system. 
Thus, we need to be able to support RPC across several intermediate 
RabbitMQ brokers. Federation seemed a natural fit, but is there 
another/better option? The shovel plugin doesn't look to me like it 
would easily fill our need, if I'm not mistaken.

As for having a mode where federation optimized speed over reliability, 
that might be interesting to us.

Eric

On 01/30/2013 11:59 AM, Simon MacMullen wrote:
&gt;<i> On 30/01/13 17:26, Eric Cozzi wrote:
</I>&gt;&gt;<i> Hello all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am investigating RabbitMQ for a project where we would need to
</I>&gt;&gt;<i> federate multiple brokers. From my testing, I'm seeing acceptable
</I>&gt;&gt;<i> throughput results as long as the server and client are bot talking to
</I>&gt;&gt;<i> the same RabbitMQ server instance. However, as soon as I have the Server
</I>&gt;&gt;<i> and Client talking to different servers using a federated exchange, I'm
</I>&gt;&gt;<i> only seeing 1/4 of the throughput. Is this expected?
</I>&gt;<i>
</I>&gt;<i> Well, federation does require that the message be published on the 
</I>&gt;<i> source broker, consumed and republished by the federation plugin and 
</I>&gt;<i> finally consumed for real. So I would expect 1/2 the throughput for a 
</I>&gt;<i> simple Producer -&gt; Broker A -&gt; Broker B -&gt; Consumer case.
</I>&gt;<i>
</I>&gt;<i> Where federation *helps* throughput is when most of your messages can 
</I>&gt;<i> be local. Ultimately if every message has to go everywhere, you have a 
</I>&gt;<i> scaling problem anyway :-)
</I>&gt;<i>
</I>&gt;<i> However, I wouldn't expect 1/4 the throughput... except that 
</I>&gt;<i> federation does transfer messages using confirms and acks. If your 
</I>&gt;<i> publishers and consumers are *not* using confirms / acks then they 
</I>&gt;<i> could go faster enough that the federation step in the middle would be 
</I>&gt;<i> that much more expensive. Does that sound like what might be happening?
</I>&gt;<i>
</I>&gt;<i> And would anyone be interested in an optional mode for federation to 
</I>&gt;<i> disable confirms and acks, going faster at the expense of guaranteed 
</I>&gt;<i> delivery?
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I></PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025252.html">[rabbitmq-discuss] Performance Hit when using Federation
</A></li>
	<LI>Next message: <A HREF="025257.html">[rabbitmq-discuss] Why connection.CreateModel in C#?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25253">[ date ]</a>
              <a href="thread.html#25253">[ thread ]</a>
              <a href="subject.html#25253">[ subject ]</a>
              <a href="author.html#25253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
