<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Performance Issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Performance%20Issue&In-Reply-To=%3CCAABB5w9FiJm_76kLF%2BCH7YautOM6ugxrGoru4PgM0z0TCnt5fA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024920.html">
   <LINK REL="Next"  HREF="024922.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Performance Issue</H1>
    <B>Pavel Kogan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Performance%20Issue&In-Reply-To=%3CCAABB5w9FiJm_76kLF%2BCH7YautOM6ugxrGoru4PgM0z0TCnt5fA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Performance Issue">pavel.kogan at cortica.com
       </A><BR>
    <I>Mon Jan 14 21:21:16 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="024920.html">[rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue
</A></li>
        <LI>Next message: <A HREF="024922.html">[rabbitmq-discuss] Performance Issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24921">[ date ]</a>
              <a href="thread.html#24921">[ thread ]</a>
              <a href="subject.html#24921">[ subject ]</a>
              <a href="author.html#24921">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I have a rabbit server on single dedicated CentOS machine (Quad Core with
16Gb RAM) connected to 1Gbit LAN.
I have many queues running, but total number of messages is not very high
for such a machine.

The problem is following:
1) I connect client A to some queue (with many many messages ready) with
some routing key - it processes 150 messages per sec (its limit).
2) I connect another client A in parallel on identical server to same queue
with same routing key. Now I have 2 identical consumers on same queue and
messages are distributed on round robin
    manner, but somehow second unit receives only 50 messages per sec.
3) If I disconnect A1, A2 starts working normally. If I connect A1 back it
becomes a slow node.

The model is TOPIC with acknowledgments.
Attached screenshots from manager and top command on rabbit machine.
Did anyone experience similar problem?

Thanks a lot,
   Pavel


Publish*148*msg/s
Deliver*744*msg/s
Redelivered*0.00*msg/s
Acknowledge*746*msg/s








NameFile descriptors (?)(used / available)Socket descriptors (?)(used /
available)Erlang processes(used / available)MemoryDisk spaceUptimeType
297 / 1024
135 / 829
16815 / 1048576
826.6MB
6.2GB high waterm


Tasks: 598 total,   1 running, 597 sleeping,   0 stopped,   0 zombie
Cpu0  : 29.8%us,  6.0%sy,  0.0%ni, 64.2%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu1  : 33.2%us,  5.6%sy,  0.0%ni, 61.1%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu2  : 34.7%us,  6.1%sy,  0.0%ni, 59.3%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu3  : 30.1%us,  4.7%sy,  0.0%ni, 64.5%id,  0.7%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu4  : 29.7%us,  5.3%sy,  0.0%ni, 65.0%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Cpu5  : 34.2%us,  6.2%sy,  0.0%ni, 56.8%id,  0.0%wa,  0.0%hi,  2.7%si,
 0.0%st
Cpu6  : 19.9%us,  3.4%sy,  0.0%ni, 76.4%id,  0.0%wa,  0.0%hi,  0.3%si,
 0.0%st
Cpu7  :  2.3%us,  1.0%sy,  0.0%ni, 96.7%id,  0.0%wa,  0.0%hi,  0.0%si,
 0.0%st
Mem:  16217336k total, 13285852k used,  2931484k free,   191072k buffers
Swap:  2097144k total,     4904k used,  2092240k free, 10533540k cached

 PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND


19404 rabbitmq  20   0 3551m 806m 2480 S 254.6  5.1  21417:07 beam.smp
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/9862b272/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/9862b272/attachment.htm</A>&gt;
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024920.html">[rabbitmq-discuss] RabbitMQ 3.0 Policy ha-all delete issue
</A></li>
	<LI>Next message: <A HREF="024922.html">[rabbitmq-discuss] Performance Issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24921">[ date ]</a>
              <a href="thread.html#24921">[ thread ]</a>
              <a href="subject.html#24921">[ subject ]</a>
              <a href="author.html#24921">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
