<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Connection error on RabbitMQ consumer behind	haproxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Connection%20error%20on%20RabbitMQ%20consumer%20behind%0A%09haproxy&In-Reply-To=%3CCADD0VadOdz3w3pR_iWSV0%3DUfQM9_eKmOEk%2BBr8wAU5WYbu81-Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024823.html">
   <LINK REL="Next"  HREF="024856.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Connection error on RabbitMQ consumer behind	haproxy</H1>
    <B>B MK</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Connection%20error%20on%20RabbitMQ%20consumer%20behind%0A%09haproxy&In-Reply-To=%3CCADD0VadOdz3w3pR_iWSV0%3DUfQM9_eKmOEk%2BBr8wAU5WYbu81-Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Connection error on RabbitMQ consumer behind	haproxy">bmkgeek at gmail.com
       </A><BR>
    <I>Tue Jan  8 11:56:15 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="024823.html">[rabbitmq-discuss] RabbitMQ 3.0.1, Erlang R15B03 Management plugin error
</A></li>
        <LI>Next message: <A HREF="024856.html">[rabbitmq-discuss] Connection error on RabbitMQ consumer behind haproxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24822">[ date ]</a>
              <a href="thread.html#24822">[ thread ]</a>
              <a href="subject.html#24822">[ subject ]</a>
              <a href="author.html#24822">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I am using rabbit mq cluster. My consumer is connected this cluster via
haproxy.

Consumer raised the following exception connected through the haproxy. If
consumer directly connected to the node will not raise any exceptions.

2013-01-08 16:25:09,745 WARN | SimpleAsyncTaskExecutor-1 |
o.s.amqp.rabbit.listener.SimpleMessageListenerContainer | Consumer raised
exception, processing can restart if the connection factory supports it.
Exception summary: com.rabbitmq.client.ShutdownSignalException: connection
error; reason: java.io.EOFException

See my ha-proxy configuration.

global
    log 127.0.0.1    local0
    log 127.0.0.1    local1 notice
    #log loghost    local0 info
    maxconn 4096
    #chroot /usr/share/haproxy
    user haproxy
    group haproxy
    daemon
    #debug
    #quiet

defaults
    log    global
#    mode    http
#    option    httplog
    option    dontlognull
    retries    3
    option redispatch
    maxconn    5000
    contimeout    10000
    clitimeout    60000
    srvtimeout    60000


listen rabbitmq_producer_cluster 0.0.0.0:5672
    mode tcp
    balance roundrobin

    server rabbit_1 rabbit1:5672 check inter 5000 rise 2 fall 3
    server rabbit_2 rabbit2:5672 check inter 5000 rise 2 fall 3
    #server rabbit_3 rabbit3:5672 check inter 5000 rise 2 fall 3

listen rabbitmq_consumer_cluster 0.0.0.0:5673
    mode tcp
    balance roundrobin
    option tcpka

    server rabbit_1 rabbit1:5672 check inter 5000 rise 2 fall 3
    server rabbit_2 rabbit2:5672 backup check inter 5000 rise 2 fall 3
    #server rabbit_3 rabbit3:5672 check inter 5000 rise 2 fall 3

listen private_monitoring :8100
    mode http
    option httplog
    stats enable
    stats uri   /stats
    stats refresh 5s
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/661353de/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130108/661353de/attachment.htm</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024823.html">[rabbitmq-discuss] RabbitMQ 3.0.1, Erlang R15B03 Management plugin error
</A></li>
	<LI>Next message: <A HREF="024856.html">[rabbitmq-discuss] Connection error on RabbitMQ consumer behind haproxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24822">[ date ]</a>
              <a href="thread.html#24822">[ thread ]</a>
              <a href="subject.html#24822">[ subject ]</a>
              <a href="author.html#24822">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
