<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How to use federation with clustering for best HA-behaviour?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20use%20federation%20with%20clustering%20for%0A%20best%20HA-behaviour%3F&In-Reply-To=%3C50F7DD06.1020601%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024965.html">
   <LINK REL="Next"  HREF="024991.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How to use federation with clustering for best HA-behaviour?</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20use%20federation%20with%20clustering%20for%0A%20best%20HA-behaviour%3F&In-Reply-To=%3C50F7DD06.1020601%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] How to use federation with clustering for best HA-behaviour?">simon at rabbitmq.com
       </A><BR>
    <I>Thu Jan 17 11:14:14 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="024965.html">[rabbitmq-discuss] How to use federation with clustering for best	HA-behaviour?
</A></li>
        <LI>Next message: <A HREF="024991.html">[rabbitmq-discuss] How to use federation with clustering for best HA-behaviour?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24988">[ date ]</a>
              <a href="thread.html#24988">[ thread ]</a>
              <a href="subject.html#24988">[ subject ]</a>
              <a href="author.html#24988">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/01/13 17:40, Adam Aquilon wrote:
&gt;<i> I'm trying to understand how to achieve the best possible High
</I>&gt;<i> Availability-setup with RabbitMQ. The documentation seems to say
</I>&gt;<i> that I don't need to mirror the queues created by the federation
</I>&gt;<i> plugin, but then I don't get uninterrupted traffic.
</I>
Oh, the queues used by federation are not magic - if you need them to 
work in case of node failure in a cluster then they should be mirrored.

&gt;<i> Once I created a policy that included &quot;ha-mode&quot;:&quot;all&quot; for federated
</I>&gt;<i> queues, I could crash single cluster nodes with no interruption in
</I>&gt;<i> traffic. Did I misunderstand the documentation or is there something
</I>&gt;<i> else going on here?
</I>
No, you understand right. Where in the documentation did it say that? I 
can't see anything obvious but I might be suffering from familiarity 
blindness.

&gt;<i> Background:
</I>&gt;<i>
</I>&gt;<i> Currently, I have six test nodes running on my linux box, arranged
</I>&gt;<i> in three clusters of two nodes each: {n1,n2}, {n3,n4} and {n5,n6}.
</I>&gt;<i>
</I>&gt;<i> The clusters are called &quot;kista&quot;, &quot;linkoping&quot; and &quot;lindholmen&quot;
</I>&gt;<i> respectively. They are meant to represent different sites.
</I>&gt;<i> For the details, please see the end of this email which has
</I>&gt;<i> output from rabbitmqadmin.
</I>&gt;<i>
</I>&gt;<i> I've defined separate upstreams and upstream-sets for each one-way
</I>&gt;<i> link between clusters. (Is that the way to do it?)
</I>
I see that you are using upstream sets to get redundancy in federation 
links - that's not really what they're intended for (we expect each 
upstream in an upstream set to point to a different cluster), so this 
will lead to message ordering getting broken as both upstreams connect 
to the same queue simultaneously.

However, there's no way at the moment for an upstream to point to 
multiple cluster nodes, with the intention of connecting to exactly one 
of them, so I don't think you have a choice. There should be though; I 
have filed a bug to do this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024965.html">[rabbitmq-discuss] How to use federation with clustering for best	HA-behaviour?
</A></li>
	<LI>Next message: <A HREF="024991.html">[rabbitmq-discuss] How to use federation with clustering for best HA-behaviour?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24988">[ date ]</a>
              <a href="thread.html#24988">[ thread ]</a>
              <a href="subject.html#24988">[ subject ]</a>
              <a href="author.html#24988">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
