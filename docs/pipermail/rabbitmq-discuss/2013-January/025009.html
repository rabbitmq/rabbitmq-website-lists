<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq boot failure	with	&quot;tables_not_present&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20boot%20failure%0A%09with%09%22tables_not_present%22&In-Reply-To=%3CD963620277BBFD4B87CF34F284738F2D3AA6F96C%40ORSMSX102.amr.corp.intel.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025010.html">
   <LINK REL="Next"  HREF="025012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq boot failure	with	&quot;tables_not_present&quot;</H1>
    <B>Zhao, Shanyu</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20boot%20failure%0A%09with%09%22tables_not_present%22&In-Reply-To=%3CD963620277BBFD4B87CF34F284738F2D3AA6F96C%40ORSMSX102.amr.corp.intel.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq boot failure	with	&quot;tables_not_present&quot;">shanyu.zhao at intel.com
       </A><BR>
    <I>Thu Jan 17 17:35:03 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025010.html">[rabbitmq-discuss] Rabbitmq boot failure	with	&quot;tables_not_present&quot;
</A></li>
        <LI>Next message: <A HREF="025012.html">[rabbitmq-discuss] Rabbitmq boot failure	with	&quot;tables_not_present&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25009">[ date ]</a>
              <a href="thread.html#25009">[ thread ]</a>
              <a href="subject.html#25009">[ subject ]</a>
              <a href="author.html#25009">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jerry,
sudo(&quot;bash -c 'echo XXXXXXXXXXXXXXXX &gt; /var/lib/rabbitmq/.erlang.cookie'&quot;)
sudo(&quot;chown rabbitmq /var/lib/rabbitmq/.erlang.cookie&quot;)
sudo(&quot;chmod 600 /var/lib/rabbitmq/.erlang.cookie&quot;)
sudo(&quot;rm -fr /var/lib/rabbitmq/mnesia&quot;)

That is indeed a fine way to get rid of your Mnesia contents including clustering info and any metadata that needs to be shared amongst the nodes (queue, exchange, binding, user, vhost, etc. definitions).

On the other hand, after you've done it, you've got no really good reason to expect your nodes to act as clustered.
What I want to achieve after redeployment is to erase previous states completely and let the cluster starts with a clean state, that's why I erased the /mnesia folder (is there a better way to do that?). The problem is sometimes the error messages show up for a few minutes then everything works fine after that, but other times I saw the error message being logged for 80 minutes before the cluster works correctly. Do you have any suggestions?

Are you establishing your clusters using the rabbitmq command line tools or by statically encoding their properties in your rabbitmq.config files?  You're going to have to repeat whichever you did when you bring a newly redeployed cluster, having gone through the cleansing you outline above, back online.

You might consider setting up scripts to execute the appropriate commands, as per our clustering guide, on the appropriate nodes after you've done the scripted clean-up you describe.

Oh, I used rabbitmq.conf to config clustering, like Simon has pointed it out in another email, here is what it looks like:
[
{rabbit,
  [
    {tcp_listeners, [5672]},
    {cluster_nodes, {['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-0-2-97</A>', '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-0-2-106</A>'], disc}}
  ]
}
].
I have the same config file shown above on the two rabbitmq servers 10.0.2.97 and 10.0.2.106.

Do you have any suggestions that what might have gone wrong? This configuration works fine in about 80% of time, when the &quot;tables_not_present&quot; error only show up for a few minutes. In about 20% of time, this error appears in the log file for as long as several hours, but in the end the cluster successfully established. Is this a normal behavior?

Thanks,
Shanyu

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/34fc0f38/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/34fc0f38/attachment.htm</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025010.html">[rabbitmq-discuss] Rabbitmq boot failure	with	&quot;tables_not_present&quot;
</A></li>
	<LI>Next message: <A HREF="025012.html">[rabbitmq-discuss] Rabbitmq boot failure	with	&quot;tables_not_present&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25009">[ date ]</a>
              <a href="thread.html#25009">[ thread ]</a>
              <a href="subject.html#25009">[ subject ]</a>
              <a href="author.html#25009">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
