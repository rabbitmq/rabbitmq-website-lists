<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%202.5-2.6.1%20java%20hanging%20on%20close%20of%0A%20connection&In-Reply-To=%3C53391561-a6fc-4d66-9aee-ef184be772d2%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024939.html">
   <LINK REL="Next"  HREF="024950.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of connection</H1>
    <B>Sankalp Acharya</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%202.5-2.6.1%20java%20hanging%20on%20close%20of%0A%20connection&In-Reply-To=%3C53391561-a6fc-4d66-9aee-ef184be772d2%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of connection">sankalp.acharya at gmail.com
       </A><BR>
    <I>Tue Jan 15 20:55:06 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="024939.html">[rabbitmq-discuss] message added time - queue
</A></li>
        <LI>Next message: <A HREF="024950.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24949">[ date ]</a>
              <a href="thread.html#24949">[ thread ]</a>
              <a href="subject.html#24949">[ subject ]</a>
              <a href="author.html#24949">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Incidentally, we figured out what the problem is.

It seems that when the watermark checking was added in RabbitMQ 2.8.1, 
there was a feature that was added that basically blocks all currently-open 
connections until the watermark thresholds are cleared. What was happening 
on our build servers is that the test instance of RabbitMQ was just barely 
crossing the disk watermark threshold to where the MQ server started 
blocking connections. This would happen intermittently, depending on which 
side of the watermark the free disk space was at.

It seems that the connection blocking, in turn, *also* blocks close 
requests from being ack'd! This certainly seems like a bug to me &#8211; I'm not 
sure why the server should deny already-connected clients the ability to 
close their connections.

At any rate, I wanted to post to this thread in case anyone else ran into 
this error.

Sankalp Acharya
WhaleShark Media

On Friday, January 11, 2013 3:58:31 PM UTC-6, Sankalp Acharya wrote:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> We are seeing this same exact behavior, but on a newer version of RabbitMQ 
</I>&gt;<i> (2.8.2).
</I>&gt;<i>
</I>&gt;<i> What's strange is that the problem had not been occurring until recently. 
</I>&gt;<i> We are also using Spring AMQP (1.1.3), and we have virtually the same use 
</I>&gt;<i> case (running from unit tests, the test tries to wind down, and on 
</I>&gt;<i> disposing the Spring context, it tries to close the 
</I>&gt;<i> CachingConnectionFactory, upon which we are trying to close the connection 
</I>&gt;<i> to RabbitMQ, etc.)
</I>&gt;<i>
</I>&gt;<i> Is there something else we are missing, that we need to do (either in the 
</I>&gt;<i> configuration of our CachingConnectionFactory, or in the rest of our Spring 
</I>&gt;<i> wireup) in order to not run into this issue?
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Sankalp Acharya
</I>&gt;<i> WhaleShark Media
</I>&gt;<i>
</I>&gt;<i> On Wednesday, March 7, 2012 9:11:45 AM UTC-6, Simon MacMullen wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 07/03/12 14:41, Benjamin Bennett wrote:
</I>&gt;&gt;<i> &gt; Just wondering if this has been fixed in the latest releases?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, it was fixed in 2.7.1.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers, Simon
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i> Simon MacMullen
</I>&gt;&gt;<i> RabbitMQ, VMware
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq... at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/1352cbae/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130115/1352cbae/attachment.htm</A>&gt;
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024939.html">[rabbitmq-discuss] message added time - queue
</A></li>
	<LI>Next message: <A HREF="024950.html">[rabbitmq-discuss] Rabbitmq 2.5-2.6.1 java hanging on close of connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24949">[ date ]</a>
              <a href="thread.html#24949">[ thread ]</a>
              <a href="subject.html#24949">[ subject ]</a>
              <a href="author.html#24949">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
