<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] two factor authentication with tokens
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20two%20factor%20authentication%20with%20tokens&In-Reply-To=%3C50F821B3.3080001%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024999.html">
   <LINK REL="Next"  HREF="024834.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] two factor authentication with tokens</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20two%20factor%20authentication%20with%20tokens&In-Reply-To=%3C50F821B3.3080001%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] two factor authentication with tokens">simon at rabbitmq.com
       </A><BR>
    <I>Thu Jan 17 16:07:15 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="024999.html">[rabbitmq-discuss] two factor authentication with tokens
</A></li>
        <LI>Next message: <A HREF="024834.html">[rabbitmq-discuss] RabbitMQ support JMS in the future?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25006">[ date ]</a>
              <a href="thread.html#25006">[ thread ]</a>
              <a href="subject.html#25006">[ subject ]</a>
              <a href="author.html#25006">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/01/13 13:17, Ben Hood wrote:
&gt;<i> What I don't understand about your observation may stem from my
</I>&gt;<i> misunderstanding the flow of the handshake during AMQP connection
</I>&gt;<i> establishment. I was assuming that due to the sequence of AMQP frames
</I>&gt;<i>  defined in the protocol, Rabbit would initially delegate the
</I>&gt;<i> authentication to my custom rabbit_auth_mechanism, which could
</I>&gt;<i> present vhost X. Once this callback has successfully done everything
</I>&gt;<i> it needs to do and returns a user back to Rabbit, then the client
</I>&gt;<i> would be able to send a connection.open frame. At this point, the
</I>&gt;<i> client could potentially encode vhost Y into that frame, and hence
</I>&gt;<i> effectively by-pass the logic of the custom rabbit_auth_mechanism.
</I>
Well, assuming you have a rabbit_auth_mechanism and a
rabbit_auth_backend that know about each other, you can have your
rabbit_auth_mechanism return a #user{} containing knowledge of how
authentication was done, and the rabbit_auth_backend could then
reference this when checking whether to allow vhost access. So you can't
determine the auth mechanism based on the vhost (as you state, the
protocol does not allow that) but you can ensure that invalid auth
mechanism / vhost combinations don't grant access, which is the
important bit.

&gt;<i> Having said all of this, in the meantime I've come up with an
</I>&gt;<i> alternative solution - just run separate Rabbit instances for each
</I>&gt;<i> vhost.
</I>
...but this is of course simpler.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024999.html">[rabbitmq-discuss] two factor authentication with tokens
</A></li>
	<LI>Next message: <A HREF="024834.html">[rabbitmq-discuss] RabbitMQ support JMS in the future?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25006">[ date ]</a>
              <a href="thread.html#25006">[ thread ]</a>
              <a href="subject.html#25006">[ subject ]</a>
              <a href="author.html#25006">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
