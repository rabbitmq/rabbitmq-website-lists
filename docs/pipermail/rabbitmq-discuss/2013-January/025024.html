<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] ReturnListener is not invoked
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ReturnListener%20is%20not%20invoked&In-Reply-To=%3C50F8EE8A.4050602%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025023.html">
   <LINK REL="Next"  HREF="025044.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] ReturnListener is not invoked</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ReturnListener%20is%20not%20invoked&In-Reply-To=%3C50F8EE8A.4050602%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] ReturnListener is not invoked">matthias at rabbitmq.com
       </A><BR>
    <I>Fri Jan 18 06:41:14 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025023.html">[rabbitmq-discuss] ReturnListener is not invoked
</A></li>
        <LI>Next message: <A HREF="025044.html">[rabbitmq-discuss] ReturnListener is not invoked
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25024">[ date ]</a>
              <a href="thread.html#25024">[ thread ]</a>
              <a href="subject.html#25024">[ subject ]</a>
              <a href="author.html#25024">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/01/13 23:04, Dmitriy Bannikov wrote:
&gt;<i> I've created a test Java class which tries to publish message into a
</I>&gt;<i> fake queue.
</I>&gt;<i> In Windows this message is failing, and ReturnListener shows it's
</I>&gt;<i> output. In Linux there're not error or fails.
</I>&gt;<i>
</I>&gt;<i> I've just upgraded rabbitmq from 2.8.6 to 3.0.1 on both WIndows and
</I>&gt;<i> Linux machines.
</I>&gt;<i>
</I>&gt;<i> Code is following:  [...]
</I>&gt;<i>          channel.basicPublish(&quot;&quot;, &quot;fake_queue_112233&quot;, true, true,
</I>&gt;<i> props, &quot;Test String&quot;.getBytes());
</I>
That call has the 'immediate' flag set. The RabbitMQ server stopped 
supporting that in 3.0.0, so the above will result in an 
connection-level error.

But since publishing is asynchronous, a client won't see that error 
unless it a) stays around long enough for the error to arrive, and b) 
either performs some other action on the channel or has an appropriate 
error handler (in case of the Java client a ShutdownListener) configured 
on the channel. Since the basicPublish is the last thing your program 
does, and no handler is installed, the error won't show up. And since 
the error that is generated is a connection level error, the connection 
will be closed and the program terminates. If you, say, added a 
connection.close() at the end of your program, you'd get an error.

Now, if you were just setting mandatory, or running 2.8.6 (where 
'immediate' doesn't result in an error) then the return listener should 
get invoked. And since a return is a not an error, the connection will 
stay alive and the program won't terminate. Indeed all that happens for 
me, on Linux, when I try it.

As to why this would behave differently on windows and linux, I suspect 
the upgrade of the broker didn't actually happen on the former, so it's 
still running 2.8.6.

Regards,

Matthias.
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025023.html">[rabbitmq-discuss] ReturnListener is not invoked
</A></li>
	<LI>Next message: <A HREF="025044.html">[rabbitmq-discuss] ReturnListener is not invoked
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25024">[ date ]</a>
              <a href="thread.html#25024">[ thread ]</a>
              <a href="subject.html#25024">[ subject ]</a>
              <a href="author.html#25024">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
