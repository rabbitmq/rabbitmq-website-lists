<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Performance Issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Performance%20Issue&In-Reply-To=%3CCAMcAHLWZJ%2B6EapjJK1jH%3Dz%3DY3wQWGACmDCYm1YE4UfqxjnPdMQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024921.html">
   <LINK REL="Next"  HREF="024923.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Performance Issue</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Performance%20Issue&In-Reply-To=%3CCAMcAHLWZJ%2B6EapjJK1jH%3Dz%3DY3wQWGACmDCYm1YE4UfqxjnPdMQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Performance Issue">videlalvaro at gmail.com
       </A><BR>
    <I>Mon Jan 14 21:33:21 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="024921.html">[rabbitmq-discuss] Performance Issue
</A></li>
        <LI>Next message: <A HREF="024923.html">[rabbitmq-discuss] Performance Issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24922">[ date ]</a>
              <a href="thread.html#24922">[ thread ]</a>
              <a href="subject.html#24922">[ subject ]</a>
              <a href="author.html#24922">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Maybe you could take a look at your basic_qos settings, setting the
prefetch_count to some reasonable number?

See <A HREF="http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos">http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos</A>

and
<A HREF="http://www.rabbitmq.com/blog/2011/10/27/performance-of-queues-when-less-is-more/">http://www.rabbitmq.com/blog/2011/10/27/performance-of-queues-when-less-is-more/</A>

Regards,

Alvaro


On Mon, Jan 14, 2013 at 10:21 PM, Pavel Kogan &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pavel.kogan at cortica.com</A>&gt;wrote:

&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I have a rabbit server on single dedicated CentOS machine (Quad Core with
</I>&gt;<i> 16Gb RAM) connected to 1Gbit LAN.
</I>&gt;<i> I have many queues running, but total number of messages is not very high
</I>&gt;<i> for such a machine.
</I>&gt;<i>
</I>&gt;<i> The problem is following:
</I>&gt;<i> 1) I connect client A to some queue (with many many messages ready) with
</I>&gt;<i> some routing key - it processes 150 messages per sec (its limit).
</I>&gt;<i> 2) I connect another client A in parallel on identical server to same
</I>&gt;<i> queue with same routing key. Now I have 2 identical consumers on same queue
</I>&gt;<i> and messages are distributed on round robin
</I>&gt;<i>     manner, but somehow second unit receives only 50 messages per sec.
</I>&gt;<i> 3) If I disconnect A1, A2 starts working normally. If I connect A1 back it
</I>&gt;<i> becomes a slow node.
</I>&gt;<i>
</I>&gt;<i> The model is TOPIC with acknowledgments.
</I>&gt;<i> Attached screenshots from manager and top command on rabbit machine.
</I>&gt;<i> Did anyone experience similar problem?
</I>&gt;<i>
</I>&gt;<i> Thanks a lot,
</I>&gt;<i>    Pavel
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Publish*148*msg/s
</I>&gt;<i> Deliver*744*msg/s
</I>&gt;<i> Redelivered*0.00*msg/s
</I>&gt;<i> Acknowledge*746*msg/s
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Name File descriptors (?)(used / available) Socket descriptors (?)(used /
</I>&gt;<i> available) Erlang processes(used / available) MemoryDisk space UptimeType
</I>&gt;<i> 297 / 1024
</I>&gt;<i> 135 / 829
</I>&gt;<i> 16815 / 1048576
</I>&gt;<i> 826.6MB
</I>&gt;<i> 6.2GB high waterm
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Tasks: 598 total,   1 running, 597 sleeping,   0 stopped,   0 zombie
</I>&gt;<i> Cpu0  : 29.8%us,  6.0%sy,  0.0%ni, 64.2%id,  0.0%wa,  0.0%hi,  0.0%si,
</I>&gt;<i>  0.0%st
</I>&gt;<i> Cpu1  : 33.2%us,  5.6%sy,  0.0%ni, 61.1%id,  0.0%wa,  0.0%hi,  0.0%si,
</I>&gt;<i>  0.0%st
</I>&gt;<i> Cpu2  : 34.7%us,  6.1%sy,  0.0%ni, 59.3%id,  0.0%wa,  0.0%hi,  0.0%si,
</I>&gt;<i>  0.0%st
</I>&gt;<i> Cpu3  : 30.1%us,  4.7%sy,  0.0%ni, 64.5%id,  0.7%wa,  0.0%hi,  0.0%si,
</I>&gt;<i>  0.0%st
</I>&gt;<i> Cpu4  : 29.7%us,  5.3%sy,  0.0%ni, 65.0%id,  0.0%wa,  0.0%hi,  0.0%si,
</I>&gt;<i>  0.0%st
</I>&gt;<i> Cpu5  : 34.2%us,  6.2%sy,  0.0%ni, 56.8%id,  0.0%wa,  0.0%hi,  2.7%si,
</I>&gt;<i>  0.0%st
</I>&gt;<i> Cpu6  : 19.9%us,  3.4%sy,  0.0%ni, 76.4%id,  0.0%wa,  0.0%hi,  0.3%si,
</I>&gt;<i>  0.0%st
</I>&gt;<i> Cpu7  :  2.3%us,  1.0%sy,  0.0%ni, 96.7%id,  0.0%wa,  0.0%hi,  0.0%si,
</I>&gt;<i>  0.0%st
</I>&gt;<i> Mem:  16217336k total, 13285852k used,  2931484k free,   191072k buffers
</I>&gt;<i> Swap:  2097144k total,     4904k used,  2092240k free, 10533540k cached
</I>&gt;<i>
</I>&gt;<i>  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 19404 rabbitmq  20   0 3551m 806m 2480 S 254.6  5.1  21417:07 beam.smp
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/09463306/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130114/09463306/attachment.htm</A>&gt;
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024921.html">[rabbitmq-discuss] Performance Issue
</A></li>
	<LI>Next message: <A HREF="024923.html">[rabbitmq-discuss] Performance Issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24922">[ date ]</a>
              <a href="thread.html#24922">[ thread ]</a>
              <a href="subject.html#24922">[ subject ]</a>
              <a href="author.html#24922">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
