<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] ReturnListener is not invoked
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ReturnListener%20is%20not%20invoked&In-Reply-To=%3Cc44e9322-9f6c-4272-bb61-c74210f32d9c%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025021.html">
   <LINK REL="Next"  HREF="025024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] ReturnListener is not invoked</H1>
    <B>Dmitriy Bannikov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ReturnListener%20is%20not%20invoked&In-Reply-To=%3Cc44e9322-9f6c-4272-bb61-c74210f32d9c%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] ReturnListener is not invoked">dmitriy.bannikov at gmail.com
       </A><BR>
    <I>Thu Jan 17 23:04:23 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025021.html">[rabbitmq-discuss] How to handle poison messages (version	3.0.1)?
</A></li>
        <LI>Next message: <A HREF="025024.html">[rabbitmq-discuss] ReturnListener is not invoked
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25023">[ date ]</a>
              <a href="thread.html#25023">[ thread ]</a>
              <a href="subject.html#25023">[ subject ]</a>
              <a href="author.html#25023">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I have a problem with ReturnListener - failed messages are not invoking it 
in Linux. 

Same code works fine in Windows.

I've created a test Java class which tries to publish message into a fake 
queue. 
In Windows this message is failing, and ReturnListener shows it's output. 
In Linux there're not error or fails.

I've just upgraded rabbitmq from 2.8.6 to 3.0.1 on both WIndows and Linux 
machines.

Code is following:

package my.test.rabbitmq;

import com.rabbitmq.client.AMQP;
import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.ReturnListener;

import java.io.IOException;

public class RabbitMQReturn
{

    public static void main(String[] args) throws Exception
    {
        ConnectionFactory factory = new ConnectionFactory();

        factory.setHost(&quot;localhost&quot;);
        factory.setUsername(&quot;testusr&quot;);
        factory.setPassword(&quot;testpwd&quot;);
        factory.setPort(5672);

        Connection connection = factory.newConnection();

        final Channel channel = connection.createChannel();

        channel.addReturnListener(new ReturnListener()
        {
            @Override
            public void handleReturn(int i, String s, String s2, String s3, 
AMQP.BasicProperties basicProperties,
                    byte[] bytes) throws IOException
            {
                System.err.println(&quot;Sending failed: &quot; + s + &quot; [&quot; + i + &quot;]&quot;);
            }
        });

        AMQP.BasicProperties props = new 
AMQP.BasicProperties(&quot;application/octet-stream&quot;,
                null,
                null,
                2,
                0, null, null, null,
                null, null, null, null,
                null, null);

        channel.basicPublish(&quot;&quot;, &quot;fake_queue_112233&quot;, true, true, props, 
&quot;Test String&quot;.getBytes());
    }
}


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/b511b0b8/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130117/b511b0b8/attachment.htm</A>&gt;
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025021.html">[rabbitmq-discuss] How to handle poison messages (version	3.0.1)?
</A></li>
	<LI>Next message: <A HREF="025024.html">[rabbitmq-discuss] ReturnListener is not invoked
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25023">[ date ]</a>
              <a href="thread.html#25023">[ thread ]</a>
              <a href="subject.html#25023">[ subject ]</a>
              <a href="author.html#25023">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
