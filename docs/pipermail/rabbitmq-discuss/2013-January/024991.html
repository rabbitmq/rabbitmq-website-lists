<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How to use federation with clustering for best HA-behaviour?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20use%20federation%20with%20clustering%20for%0A%20best%20HA-behaviour%3F&In-Reply-To=%3Cop.wq12swt0h82nkl%40e778e7d1af99b9.eemea.ericsson.se%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024988.html">
   <LINK REL="Next"  HREF="024993.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How to use federation with clustering for best HA-behaviour?</H1>
    <B>Adam Aquilon</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20use%20federation%20with%20clustering%20for%0A%20best%20HA-behaviour%3F&In-Reply-To=%3Cop.wq12swt0h82nkl%40e778e7d1af99b9.eemea.ericsson.se%3E"
       TITLE="[rabbitmq-discuss] How to use federation with clustering for best HA-behaviour?">adam.aquilon at ericsson.com
       </A><BR>
    <I>Thu Jan 17 12:39:58 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="024988.html">[rabbitmq-discuss] How to use federation with clustering for best HA-behaviour?
</A></li>
        <LI>Next message: <A HREF="024993.html">[rabbitmq-discuss] How to use federation with clustering for	best HA-behaviour?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24991">[ date ]</a>
              <a href="thread.html#24991">[ thread ]</a>
              <a href="subject.html#24991">[ subject ]</a>
              <a href="author.html#24991">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 17 Jan 2013 12:14:14 +0100, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> Oh, the queues used by federation are not magic - if you need them to
</I>&gt;<i> work in case of node failure in a cluster then they should be mirrored.
</I>
Ah, good!

In the federation plugin docs (<A HREF="http://www.rabbitmq.com/federation.html">http://www.rabbitmq.com/federation.html</A>)
it says:

&quot;ha-policy
  Determines the &quot;x-ha-policy&quot; argument for the upstream queue (see expires). This is only of interest when connecting to old brokers which determine queue HA mode using this argument. Default is 'none', meaning the queue is not HA.&quot;

So what it says is not entirely true -- you also need it for &quot;federation
HA&quot; behaviour.


&gt;<i> No, you understand right. Where in the documentation did it say that? I
</I>&gt;<i> can't see anything obvious but I might be suffering from familiarity
</I>&gt;<i> blindness.
</I>
Hmm, I just tried to find it, but I've read so many forums and comments
so it might have been some non-official post somewhere, but I'm pretty
sure it was made by someone associated with Rabbit or I wouldn't have
relied on it. Although, when I think about it, I probably didn't check
on the age of the post so maybe the comment was valid for an earlier
RabbitMQ version.

(I also forgot to mention that I'm running 3.0.1.)


&gt;<i> I see that you are using upstream sets to get redundancy in federation
</I>&gt;<i> links - that's not really what they're intended for (we expect each
</I>&gt;<i> upstream in an upstream set to point to a different cluster), so this
</I>&gt;<i> will lead to message ordering getting broken as both upstreams connect
</I>&gt;<i> to the same queue simultaneously.
</I>
Hmm, that is a problem for us. Message ordering is important.

(My simple test setup didn't take message ordering into account.)


&gt;<i> However, there's no way at the moment for an upstream to point to
</I>&gt;<i> multiple cluster nodes, with the intention of connecting to exactly one
</I>&gt;<i> of them, so I don't think you have a choice. There should be though.
</I>
Is there some whitepaper or similar that describes in more detail how
the federation plugin (and/or RabbitMQ) handles single-node failures?

(I'm Erlang literate, so I could perhaps look at the code. But code
usually takes a while to decipher so it would be quicker if there was
a 'shortcut'. :-)


&gt;<i> I have filed a bug to do this.
</I>
Thank you!  I'm hoping for a quick solution, as we are currently in the
process of choosing a message broker for internal CI use and as a fan
of Erlang, I'd rather use RabbitMQ. :-)


BTW, you wouldn't happen to have some tips on how to do upgrades without
downtime?

I've studied the documentation for clustered installations and it seems
you don't use the Erlang facilities for 'upgrading on the fly' and that
any upgrade *will* require downtime. (A problem for any company, but
especially for a large one...)


Kind regards,
Adam A.
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024988.html">[rabbitmq-discuss] How to use federation with clustering for best HA-behaviour?
</A></li>
	<LI>Next message: <A HREF="024993.html">[rabbitmq-discuss] How to use federation with clustering for	best HA-behaviour?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24991">[ date ]</a>
              <a href="thread.html#24991">[ thread ]</a>
              <a href="subject.html#24991">[ subject ]</a>
              <a href="author.html#24991">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
