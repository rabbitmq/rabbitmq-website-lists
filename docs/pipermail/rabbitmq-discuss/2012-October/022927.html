<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Failure to return from call to newConnection()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Failure%20to%20return%20from%20call%20to%0A%20newConnection%28%29&In-Reply-To=%3C242E9559AA2C354CB60C81A952FCBEB5018098%40TSEAMB01%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022925.html">
   <LINK REL="Next"  HREF="022976.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Failure to return from call to newConnection()</H1>
    <B>McMahon, James S (TASC)</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Failure%20to%20return%20from%20call%20to%0A%20newConnection%28%29&In-Reply-To=%3C242E9559AA2C354CB60C81A952FCBEB5018098%40TSEAMB01%3E"
       TITLE="[rabbitmq-discuss] Failure to return from call to newConnection()">james.mcmahon at TASC.COM
       </A><BR>
    <I>Tue Oct  9 17:11:41 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022925.html">[rabbitmq-discuss] Failure to return from call to	newConnection()
</A></li>
        <LI>Next message: <A HREF="022976.html">[rabbitmq-discuss] Failure to return from call to	newConnection()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22927">[ date ]</a>
              <a href="thread.html#22927">[ thread ]</a>
              <a href="subject.html#22927">[ subject ]</a>
              <a href="author.html#22927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>       Let me try again, more carefully applying terminology.

      I've got a java class to receive messages through a direct exchange. In my class, I establish a new ConnectionFactory, factory. I use factory.setHost, under the impression that this is how I would tell it where to find my rabbitMQ server. For discussion purposes, let's say my rabbitMQ server runs on 123.456.666.6. I use factory.setPort, under the impression that this is how I indicate on which port my rabbitMQ server is listening. I've been using 5672, which I believe is the default used by rabbitMQ server.


     All of the following is executed on the same physical machine, co-resident with the rabbitMQ server.


     I execute my java class a first time in a command shell like this:

java -cp %CP% myClass EXCHANGE_A   123.456.666.6   5672

In that shell window, the class returns with a message that it is waiting for any messages posted to rabbitMQ for EXCHANGE_A.


     In a second shell window I try to execute a second instance of this class, for a second and different directed exchange:

java -cp %CP% myClass EXCHANGE_B   123.456.666.6   5672

This is not successful. When myClass reaches the point where it tries to do this

Connection connection = factory.newConnection();

it sits there until it eventually times out.


     If in that second shell window I execute the command as follows, without stipulating the IP or port

java -cp %CP% myClass EXCHANGE_B

it returns immediately, telling me that it is waiting for any messages posted to rabbitMQ for EXCHANGE_B. It was successful executing newConnection.


    There's no firewall. All of these are on one physical computer for testing purposes. What am I not understanding correctly that causes this

java -cp %CP% myClass EXCHANGE_B   123.456.666.6   5672

to time out?

________________________________________
From: Simon MacMullen [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>]
Sent: Tuesday, October 09, 2012 10:53 AM
To: McMahon, James S (TASC)
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Failure to return from call to newConnection()

I am not quite sure what you are saying. You can only start one service
*listening* to a given port IP address combination (i.e. you can only
have one RabbitMQ *server* on a given port on a given interface). But
I'm not sure if that's what you mean by &quot;listening&quot;. Normally we refer
to the server as &quot;listening&quot; and the client as &quot;connecting&quot;.

But definitely more than one client can connect to a server on the same
IP address / port.

I'm also not sure what you mean by &quot;it goes to my rabbitMQ server
instance locally, rather than through IP and port&quot;. Connections are
always to an IP address and port.

But &quot;Connection timed out&quot; means that you are trying to connect to a
host which is not responding at all, even to reject your connection
attempt - probably because there is a firewall in the way. Honestly,
that's what's happening.

Cheers, Simon

On 09/10/12 11:19, McMahon, James S (TASC) wrote:
&gt;<i> Thank you for your help, Simon. I did look more closely at the
</I>&gt;<i> situation as you suggested. It seems that I can only start one
</I>&gt;<i> process listening to a specific port at IP address of the rabbitMQ
</I>&gt;<i> server. I can't start the second listening to the same port at the
</I>&gt;<i> same address.
</I>&gt;<i>
</I>&gt;<i> In one command shell, I start my listener on port 5672. It works
</I>&gt;<i> great. I then start up a second command shell, the first still
</I>&gt;<i> running. I tell the second instance of my listener process to listen
</I>&gt;<i> to the same port. It never returns, and I get the connection timed
</I>&gt;<i> out error. If I start my second process without pointing it to a port
</I>&gt;<i> or using an IP address, it works just fine. To the untrained (ie,
</I>&gt;<i> me), this tells me that the second works because it goes to my
</I>&gt;<i> rabbitMQ server instance locally, rather than through IP and port.
</I>&gt;<i>
</I>&gt;<i> So in summary: two listener processes in different command shells on
</I>&gt;<i> the same physical laptop, started from the command line. Trying to
</I>&gt;<i> listen on the same port, to the same rabbitMQ server instance at IP.
</I>&gt;<i> Not being familiar with port configurations and limitations,
</I>&gt;<i> shouldn't I be able to have multiple listener processes listening to
</I>&gt;<i> incoming on the same port? The evidence appears to say &quot;no&quot;. Why is
</I>&gt;<i> that?
</I>&gt;<i>
</I>&gt;<i> - Jim
</I>&gt;<i>
</I>&gt;<i> ________________________________________ From: Simon MacMullen
</I>&gt;<i> [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>] Sent: Monday, October 08, 2012 5:22 PM To:
</I>&gt;<i> Discussions about RabbitMQ Cc: McMahon, James S (TASC) Subject: Re:
</I>&gt;<i> [rabbitmq-discuss] Failure to return from call to newConnection()
</I>&gt;<i>
</I>&gt;<i> The stack trace you have posted really does look like a standard case
</I>&gt;<i> of the TCP connection timing out. I suggest you make absolutely sure
</I>&gt;<i> that you really are connecting to the host/port you think you are.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> On 08/10/2012 9:02PM, McMahon, James S (TASC) wrote:
</I>&gt;&gt;<i> I am experiencing a problem that I have been unable to pin down.
</I>&gt;&gt;<i> When I attempt to use a java class to listen for messages bound to
</I>&gt;&gt;<i> a particular exchange by a particular routing key, I get a
</I>&gt;&gt;<i> &quot;Connection timed out&quot; error. Here is my code:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> public class ReceiveLogsDirect {
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> private static final String EXCHANGE_NAME = &quot;ABC_SERVER&quot;;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> public static void main(String[] argv) throws Exception {
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> String hostName = &quot;localhost&quot;; int portNumber = 5672;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> if (argv.length &lt; 1 || argv.length == 2 || argv.length &gt; 3){
</I>&gt;&gt;<i> System.err.println(&quot;Usage: ReceiveLogsDirect [session ID] [RabbitMQ
</I>&gt;&gt;<i> server IP, optional] [RabbitMQ server port #, optional]&quot;);
</I>&gt;&gt;<i> System.exit(1); } else if (argv.length == 1) { hostName =
</I>&gt;&gt;<i> &quot;localhost&quot;; portNumber = 5672; // default port that rabbitMQ
</I>&gt;&gt;<i> listens to } else if  (argv.length == 3) { hostName = argv[1];
</I>&gt;&gt;<i> portNumber = Integer.parseInt(argv[2]); }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ConnectionFactory factory = new ConnectionFactory();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> factory.setHost(hostName); factory.setPort(portNumber);
</I>&gt;&gt;<i> factory.setUsername(&quot;guest&quot;); factory.setPassword(&quot;guest&quot;);
</I>&gt;&gt;<i> factory.setVirtualHost(&quot;/&quot;);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> System.out.println(&quot; [*] HERE 1&quot;); Connection connection =
</I>&gt;&gt;<i> factory.newConnection(); System.out.println(&quot; [*] HERE 2&quot;); Channel
</I>&gt;&gt;<i> channel = connection.createChannel();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> channel.exchangeDeclare(EXCHANGE_NAME, &quot;direct&quot;); String queueName
</I>&gt;&gt;<i> = channel.queueDeclare().getQueue();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> channel.queueBind(queueName, EXCHANGE_NAME, argv[0]);
</I>&gt;&gt;<i> System.out.println(&quot; [*] bindingKey &quot; + argv[0]  +  &quot; is bound to
</I>&gt;&gt;<i> queue on exchange &quot; + EXCHANGE_NAME );
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> System.out.println(&quot; [*] Waiting for messages. To exit press
</I>&gt;&gt;<i> CTRL+C&quot;);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> QueueingConsumer consumer = new QueueingConsumer(channel);
</I>&gt;&gt;<i> channel.basicConsume(queueName, true, consumer);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> while (true) { QueueingConsumer.Delivery delivery =
</I>&gt;&gt;<i> consumer.nextDelivery(); String message = new
</I>&gt;&gt;<i> String(delivery.getBody()); String routingKey =
</I>&gt;&gt;<i> delivery.getEnvelope().getRoutingKey();
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> System.out.println(&quot; [x] Received message for &quot; + routingKey + &quot;
</I>&gt;&gt;&gt;&gt;&gt;<i> &quot; + message);
</I>&gt;&gt;<i> } }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I used simple print statements to pinpoint the source of the
</I>&gt;&gt;<i> problem at the line where I call newConnection().
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The error I get is this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [*] HERE 1 Exception in thread &quot;main&quot; java.net.ConnectException:
</I>&gt;&gt;<i> Connection timed out: connect at
</I>&gt;&gt;<i> java.net.PlainSocketImpl.socketConnect(Native Method) at
</I>&gt;&gt;<i> java.net.PlainSocketImpl.doConnect(Unknown Source) at
</I>&gt;&gt;<i> java.net.PlainSocketImpl.connectToAddress(Unknown Source) at
</I>&gt;&gt;<i> java.net.PlainSocketImpl.connect(Unknown Source) at
</I>&gt;&gt;<i> java.net.SocksSocketImpl.connect(Unknown Source) at
</I>&gt;&gt;<i> java.net.Socket.connect(Unknown Source) at
</I>&gt;&gt;<i> com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:441)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>at
&gt;&gt;<i> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:480)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>at
&gt;&gt;<i> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:509)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>at
&gt;&gt;<i> com.tasc.prism.queue.ReceiveLogsDirect.main(ReceiveLogsDirect.java:55)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>My install of rabbitMQ is 2.7.0. Oddly, I have been able to
&gt;&gt;<i> execute this in another command shell window and it works. I am
</I>&gt;&gt;<i> wondering why I'm having trouble in the second shell? Surely I must
</I>&gt;&gt;<i> be able to execute multiple instances of ReceiveLogsDirect
</I>&gt;&gt;<i> simultaneously, right?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Could it be a runtime environment problem? I set my class path
</I>&gt;&gt;<i> exactly the same in both shells.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any thoughts or similar experience with such a problem? Thank you.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - Jim
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> CONFIDENTIALITY NOTICE: This message and any attachments or files
</I>&gt;&gt;<i> transmitted with it (collectively, the &quot;Message&quot;) are intended only
</I>&gt;&gt;<i> for the addressee and may contain information that is privileged,
</I>&gt;&gt;<i> proprietary and/or prohibited from disclosure by law or contract.
</I>&gt;&gt;<i> If you are not the intended recipient: (a) please do not read, copy
</I>&gt;&gt;<i> or retransmit the Message; (b) permanently delete and/or destroy
</I>&gt;&gt;<i> all electronic and hard copies of the Message; (c) notify us by
</I>&gt;&gt;<i> return email; and (d) you are hereby notified that any
</I>&gt;&gt;<i> dissemination, distribution or copying of the Message is strictly
</I>&gt;&gt;<i> prohibited.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________ rabbitmq-discuss
</I>&gt;&gt;<i> mailing list <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>CONFIDENTIALITY NOTICE: This message and any attachments or files
transmitted with it (collectively, the &quot;Message&quot;) are intended only for
the addressee and may contain information that is privileged,
proprietary and/or prohibited from disclosure by law or contract. If you
are not the intended recipient: (a) please do not read, copy or
retransmit the Message; (b) permanently delete and/or destroy all
electronic and hard copies of the Message; (c) notify us by return
email; and (d) you are hereby notified that any dissemination,
distribution or copying of the Message is strictly prohibited.
&gt;<i>
</I>

--
Simon MacMullen
RabbitMQ, VMware
CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the &quot;Message&quot;) are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022925.html">[rabbitmq-discuss] Failure to return from call to	newConnection()
</A></li>
	<LI>Next message: <A HREF="022976.html">[rabbitmq-discuss] Failure to return from call to	newConnection()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22927">[ date ]</a>
              <a href="thread.html#22927">[ thread ]</a>
              <a href="subject.html#22927">[ subject ]</a>
              <a href="author.html#22927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
