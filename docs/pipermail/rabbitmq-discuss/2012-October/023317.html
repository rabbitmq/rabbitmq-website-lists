<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Termination of queue after sending a message.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Termination%20of%20queue%20after%20sending%20a%20message.&In-Reply-To=%3C5087DA4E.8020503%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023315.html">
   <LINK REL="Next"  HREF="023318.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Termination of queue after sending a message.</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Termination%20of%20queue%20after%20sending%20a%20message.&In-Reply-To=%3C5087DA4E.8020503%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Termination of queue after sending a message.">simon at rabbitmq.com
       </A><BR>
    <I>Wed Oct 24 13:08:46 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023315.html">[rabbitmq-discuss] Termination of queue after sending a message.
</A></li>
        <LI>Next message: <A HREF="023318.html">[rabbitmq-discuss] Termination of queue after sending a message.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23317">[ date ]</a>
              <a href="thread.html#23317">[ thread ]</a>
              <a href="subject.html#23317">[ subject ]</a>
              <a href="author.html#23317">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/10/12 12:40, Ernest Staszuk wrote:
&gt;<i> Hi,
</I>
Hi!

&gt;<i>      3. Another consumer got this message while listening on
</I>&gt;<i> &quot;failed-messages-queue&quot;,
</I>&gt;<i>          stored content and headers in memory and sent acknowledgement.
</I>
Note that at this point it looks like it garbled the &quot;x-death&quot; header, 
flattening it to a string.

&gt;<i>      4. After a certain time there is made an attempt to sent message
</I>&gt;<i> stored in memory
</I>&gt;<i>          to the queue form which it was rejected at first (explicitly
</I>&gt;<i> saying to the &quot;to-process&quot; queue).
</I>&gt;<i>          To be more precise we are trying to send a message to exchange
</I>&gt;<i> null with routing key &quot;to-process&quot;.
</I>&gt;<i>
</I>&gt;<i> And then queue &quot;to-process&quot; vanished unexpectedly. In logs of RabbitMQ
</I>&gt;<i> we found error.
</I>
The queue crashed.

&gt;<i> Due this we have some questions:
</I>&gt;<i>      - Why did that happen? Is something wrong with what we are doing?
</I>
Yes, you flattened the header...

&gt;<i>      - Why queue terminated? In my opinion this should never happen
</I>&gt;<i> (even if the message we sent back was broken, I mean isn't that a
</I>&gt;<i> security issue?).
</I>
...but we should still handle that properly! So we would definitely 
consider this a bug.

&gt;<i>      - What did happened to the messages that was in &quot;to-process&quot; queue?
</I>&gt;<i> Is there any way to find and restore them?
</I>
In-memory messages will be lost. On-disc messages should come back once 
the node is restarted.

&gt;<i>      - Does terminating a (durable) queue can result in messages lossing?
</I>
Yes. Non-persistent messages in the queue will be lost anyway. 
Persistent messages can be lost if they have not yet made it to disc. 
Any messages which have been confirmed to clients (or where the client 
has seen a transaction commit successfully) will definitely be on disc 
and should be recovered.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023315.html">[rabbitmq-discuss] Termination of queue after sending a message.
</A></li>
	<LI>Next message: <A HREF="023318.html">[rabbitmq-discuss] Termination of queue after sending a message.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23317">[ date ]</a>
              <a href="thread.html#23317">[ thread ]</a>
              <a href="subject.html#23317">[ subject ]</a>
              <a href="author.html#23317">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
