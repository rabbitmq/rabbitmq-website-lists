<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Response times for publisher confirms
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Response%20times%20for%20publisher%20confirms&In-Reply-To=%3CCACxyq579SGwzuFpX_xQikkYOP5yX139UQuoi_r1r-qYCO9WwgA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023169.html">
   <LINK REL="Next"  HREF="023075.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Response times for publisher confirms</H1>
    <B>Aaron Pfeifer</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Response%20times%20for%20publisher%20confirms&In-Reply-To=%3CCACxyq579SGwzuFpX_xQikkYOP5yX139UQuoi_r1r-qYCO9WwgA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Response times for publisher confirms">aaron.pfeifer at gmail.com
       </A><BR>
    <I>Mon Oct 15 16:32:38 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023169.html">[rabbitmq-discuss] AMQP restart
</A></li>
        <LI>Next message: <A HREF="023075.html">[rabbitmq-discuss] Response times for publisher confirms
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23059">[ date ]</a>
              <a href="thread.html#23059">[ thread ]</a>
              <a href="subject.html#23059">[ subject ]</a>
              <a href="author.html#23059">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey everyone -

We've been running some tests on a RabbitMQ stack that we have running in
EC2 and encountered some unexpected behaviors in the response times for
publisher confirms and wanted to see if folks here had an idea of what the
root cause might be.

First, some details on the stack:
* EC2 m1.xlarge (15GB memory, 8 EC2 compute units, 64-bit, 1 Gigabit
Ethernet)
* Ubuntu 10.04
* Erlang R13B03
* RabbitMQ 2.8.5
* Mounted to 4 RAID0 ephemeral drives (I believe 400GB each)

...and some details on the setup:
* 16 durable, fanout exchanges
* 16 durable queues
* Each exchange mapped to a single queue
* Each message published as persistent

We have about 5,000 connections (over many servers) publishing a message
once every 15s.  Each connection has publisher confirms enabled.  Each
message is approximately 10-15KB in size (give or take).  While running
this test we tracked the following data:

* Maximum amount of time to receive a confirm: <A HREF="http://i.imgur.com/SrXJP.png">http://i.imgur.com/SrXJP.png</A>
* Average amount of time to receive a confirm: <A HREF="http://i.imgur.com/ryWmr.png">http://i.imgur.com/ryWmr.png</A>

Looking at this graph seems to indicate that there's something going on in
RabbitMQ about every 10 minutes that causes a significant increase in the
amount of time it takes to receive a publisher confirm.

To get some further data about what was happening during each of these
spikes, we logged the following data through vmstat and iostat on the
machine: <A HREF="https://gist.github.com/3874134.">https://gist.github.com/3874134.</A>  You'll notice that during this
spike we experience a significant decrease in the amount of data being
written to disk and a significant increase in the await time on each disk.

And just a little background: we were planning on using durable queues and
publisher confirms to verify that the message was actually received by
RabbitMQ.  I believe I've also read that publisher confirms are typically
preferred to transactions.

Is this expected behavior for the type of test we're running?  If so, is
there anything we can do to make things a bit more consistent?

Thanks for any thoughts!

-Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/e0a41547/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/e0a41547/attachment.htm</A>&gt;
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023169.html">[rabbitmq-discuss] AMQP restart
</A></li>
	<LI>Next message: <A HREF="023075.html">[rabbitmq-discuss] Response times for publisher confirms
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23059">[ date ]</a>
              <a href="thread.html#23059">[ thread ]</a>
              <a href="subject.html#23059">[ subject ]</a>
              <a href="author.html#23059">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
