<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Re-subscribing to a queue in a cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Re-subscribing%20to%20a%20queue%20in%20a%20cluster&In-Reply-To=%3CBD46CD450E3D7843BCE36FF301A8BC4C2AA318A6%40LCEEXMB02.LCE.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022891.html">
   <LINK REL="Next"  HREF="022894.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Re-subscribing to a queue in a cluster</H1>
    <B>Adam Brightwell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Re-subscribing%20to%20a%20queue%20in%20a%20cluster&In-Reply-To=%3CBD46CD450E3D7843BCE36FF301A8BC4C2AA318A6%40LCEEXMB02.LCE.com%3E"
       TITLE="[rabbitmq-discuss] Re-subscribing to a queue in a cluster">abrightwell at LCE.com
       </A><BR>
    <I>Fri Oct  5 00:13:45 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022891.html">[rabbitmq-discuss] do we need to delete data folder during rpm upgrades?
</A></li>
        <LI>Next message: <A HREF="022894.html">[rabbitmq-discuss] Re-subscribing to a queue in a cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22854">[ date ]</a>
              <a href="thread.html#22854">[ thread ]</a>
              <a href="subject.html#22854">[ subject ]</a>
              <a href="author.html#22854">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello All,

I have been banging my head up against this one for a little while now and
I was hoping that the group could help me wrap my head around the proper
&quot;workflow&quot; for re-subscribing to a mirrored-queue in when a node is &quot;lost&quot;.
So, to better understand my scenario here is a line by line description:

1. Create a cluster of two nodes.  Let's call them Node A and Node B.

2. Create a mirrored-queue on Node A and set its &quot;x-ha-policy&quot; to &quot;all&quot; so
that it will be mirrored across to Node B.
3. Subscribe to the mirrored-queue on with a consumer through Node B.
4. Publish message on Node B. Validated consumer received message.
5. Publish message on Node A. Validated consumer received message.
6. &quot;Lose&quot; Node A. (either shutdown or kill to simulate catastrophic
failure)
7. The consumer's &quot;handleCancel(consumerTag)&quot; method is called.

This is where I realize I am suppose to handle the canceling of the
consumer.  I have tried the following in order to &quot;re-subscribe&quot; to the
mirrored-queue that is now owned by Node B since Node A is no longer in
the picture.


1. Create new consumer and call basicConsume on the original channel.
2. Close original channel, recreate channel and call basicConsume with the
new channel.
3. Close the original channel, close the original Connection.  Reconnect,
recreate channel, call basicConsume with the new channel.

Not one of these approaches works.  With each, I have published messages
to the mirrored-queue on Node B.  The messages are either not consumed OR
they will be consumed and unacknowledged.  In the latter case, they are
not being processed by my consumer or at least not making it to the
&quot;handleDelivery()&quot; method.


What am I missing?

Any help, guidance, pointers or words of wisdom from the community would
be greatly appreciated.

Thanks,
Adam

</PRE>






































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022891.html">[rabbitmq-discuss] do we need to delete data folder during rpm upgrades?
</A></li>
	<LI>Next message: <A HREF="022894.html">[rabbitmq-discuss] Re-subscribing to a queue in a cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22854">[ date ]</a>
              <a href="thread.html#22854">[ thread ]</a>
              <a href="subject.html#22854">[ subject ]</a>
              <a href="author.html#22854">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
