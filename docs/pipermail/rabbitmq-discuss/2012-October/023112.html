<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Use a mysql databse table as the provider for rabbitmq queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Use%20a%20mysql%20databse%20table%20as%20the%20provider%0A%20for%20rabbitmq%20queue&In-Reply-To=%3C507E8664.9050609%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023107.html">
   <LINK REL="Next"  HREF="023115.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Use a mysql databse table as the provider for rabbitmq queue</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Use%20a%20mysql%20databse%20table%20as%20the%20provider%0A%20for%20rabbitmq%20queue&In-Reply-To=%3C507E8664.9050609%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Use a mysql databse table as the provider for rabbitmq queue">tim at rabbitmq.com
       </A><BR>
    <I>Wed Oct 17 11:20:20 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023107.html">[rabbitmq-discuss] Re : rabbitmqadmin configuration
</A></li>
        <LI>Next message: <A HREF="023115.html">[rabbitmq-discuss] Use a mysql databse table as the provider for rabbitmq queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23112">[ date ]</a>
              <a href="thread.html#23112">[ thread ]</a>
              <a href="subject.html#23112">[ subject ]</a>
              <a href="author.html#23112">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

Please keep the list on CC - the info is useful for everyone. :)

On 10/17/2012 11:05 AM, Ryan R. wrote:
&gt;<i> Hi,
</I>&gt;<i> Thanks for that long and quite detailed answer.
</I>&gt;<i>
</I>&gt;<i> Based on what you're saying plugging the rabbitmq provider directly on 
</I>&gt;<i> the table would not be ideal and would most likely bring issues that 
</I>&gt;<i> I'd rather avoid.
</I>&gt;<i>
</I>
That's certainly my view.

&gt;<i> That said, could you provide some insight on a potentielly viable 
</I>&gt;<i> solution for my project.
</I>&gt;<i> Reminder :
</I>&gt;<i> I want to keep my applications separate in terms of DB and code (avoid 
</I>&gt;<i> triggers if possible)
</I>&gt;<i> The reason for this is that depending on the situations, I would 
</I>&gt;<i> deploy only one, two, or more applications out of the whole project ( 
</I>&gt;<i> which roughly includes about 5 separate applications, each of which 
</I>&gt;<i> needs to be fully usable withou the others as well as with, without 
</I>&gt;<i> changing code not db config)
</I>&gt;<i>
</I>
 From what I'm hearing, the primary concern here is that we want to be 
able to deploy any application in isolation and have it still work, 
regardless of whether or not the others are up an running. This is 
exactly the kind of scenario where messaging is supposed to help! If it 
was me, I would look at data first and foremost, and ask myself what 
information needs to be publicised. In each application I would publish 
that information, not via the database (which I would keep for internal 
use), but by publishing data to an exchange on the RabbitMQ broker. 
Publication is asynchronous and will not fail if there are no consumers 
- the data will simply get routed to a queue and sit there until someone 
eventually 'asks for it'. Then I would look at what external information 
my application(s) might want to consume. I would set up each application 
to consume only data it needs, again from the messaging broker not the 
database. Consuming can be asynchronous or synchronous - you can choose 
which - and worker threads or other similar tools can be used make this 
information available to the 'main application code' when required. A 
nice client library may do some or all of this 'worker/listener with 
callbacks' stuff for you.

Now lets consider that design for a moment. Each application publishes 
data (asynchronously) regardless of whether or not someone is around to 
consume it. If there are no consumers, the data sits around in the 
queue. If you don't want this, then you can have the data expire 
immediately or after some timeout - rabbit will allow you do configure 
all of these patterns quite easily. The consuming part introduces 
slightly more new paths on your code, as you've got to decide how to get 
received messages from the consuming callbacks, back into the 
application code, but this isn't too hard. You can configure rabbit so 
that each message is consumed by only one application, or a copy is sent 
to all consumers, or you can route messages to specific consumers based 
on routing keys. The possibilities are numerous, and many good examples 
are available in the tutorials on our website!!!

Now the only common thing that you've got to deal with in each 
application is plugging in the messaging sub system - i.e., each 
application needs to hook up to RabbitMQ using a client API and write a 
bit of glue code for publishing and consuming. Apart from that common 
factor, which if your applications are all written in the same language, 
can be delegated to a shared library, you've kept those applications 
completely decoupled.

I hope that helps you to get started thinking about ways in which rabbit 
could help with your project. I do recommend going through the tutorials 
to get an idea of some of what's possible, and do feel free to come back 
here and ask about anything that's unclear or just to discuss ideas with 
the rest of the community.

Cheers,
Tim

&gt;<i> Cheers,
</I>&gt;<i> Ryan.
</I>&gt;<i>
</I>&gt;<i> 2012/10/17 Tim Watson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>&gt;&gt;
</I>&gt;<i>
</I>&gt;<i>     Hi,
</I>&gt;<i>
</I>&gt;<i>     On 10/17/2012 09:58 AM, Shadowalker wrote:
</I>&gt;&gt;<i>     Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     I've just stumbled upon rabbitmq and I think it could very well
</I>&gt;&gt;<i>     help in a project that I'm currently working on. But there's one
</I>&gt;&gt;<i>     thing that I'd like to get some input about though :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     My project consist of one, two or more applications that, though
</I>&gt;&gt;<i>     separated, need to keep some of their datas synchronized.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     For example say I have two use cases that could happen at the
</I>&gt;&gt;<i>     same time :
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     First project has a app A and a app B : when app A insert some
</I>&gt;&gt;<i>     specific data in its db i need to get a meesage to appB to do the
</I>&gt;&gt;<i>     corresponding action on its own db
</I>&gt;&gt;<i>     Second project has only app A and when I insert stuff in A's db
</I>&gt;&gt;<i>     it shouldn't send anything anywhere.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     In both cases, I'll like to have app A and app B identical : I
</I>&gt;&gt;<i>     don't want to have to change app A's code jsut because app B is here.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     So my question is : Is there anyway to plug the raabitmq consumer
</I>&gt;&gt;<i>     directly onto a specific table in app A's database so that every
</I>&gt;&gt;<i>     time  something happens appB can come and consume the data.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     Well, I'm not sure I would choose this approach personally, and
</I>&gt;<i>     I'll explain why. But as I'm rather attention deficit I'll cut to
</I>&gt;<i>     the chase first and say &quot;yes - it is *possible* to do this - but
</I>&gt;<i>     you'll have to put in a lot of work to make it happen&quot; and as I
</I>&gt;<i>     said, I certainly wouldn't recommend doing it. Now I'll explain
</I>&gt;<i>     why it's a bad idea IMHO and then I'll explain how you can do it
</I>&gt;<i>     if you insist on following this path.
</I>&gt;<i>
</I>&gt;<i>     First of all, you are creating a very tight coupling between the
</I>&gt;<i>     application and the database schema, which will be difficult to
</I>&gt;<i>     work with if the design changes (which most do) over time.
</I>&gt;<i>     Secondly, you are going to be running code *inside the database
</I>&gt;<i>     server* which is fraught with danger. Thirdly, it's going to be
</I>&gt;<i>     very difficult to test and/or debug when things go wrong. Our
</I>&gt;<i>     industry tends to favour integrating systems using messaging
</I>&gt;<i>     technology so much because doing so decouples applications from
</I>&gt;<i>     one another, at least to a certain extent.
</I>&gt;<i>
</I>&gt;<i>     The deceptively simple alternative to messaging, and it is often
</I>&gt;<i>     ineffective and costly to develop and maintain, is to share data
</I>&gt;<i>     using files and/or a shared database. Both applications share
</I>&gt;<i>     tables and/or schemas and either poll for changes using worker
</I>&gt;<i>     processes (or threads) on the one hand, or utilise notification
</I>&gt;<i>     features of the database system itself on the other (e,g.,
</I>&gt;<i>     Microsoft SQL Server Notification Services). But this approach is
</I>&gt;<i>     full of problems, ranging from contention for reads/writes on
</I>&gt;<i>     shared tables, to timing issues where both applications make very
</I>&gt;<i>     subtle implicit assumptions about the order in which the various
</I>&gt;<i>     participants in the system are interacting with the database,
</I>&gt;<i>     leading to functional errors.
</I>&gt;<i>
</I>&gt;<i>     One reason that messaging based integration has been so successful
</I>&gt;<i>     is that it gets us *away* from these problems, and allows
</I>&gt;<i>     applications to simplify their model of interaction with the
</I>&gt;<i>     outside world. AMQP in particular allows an application developer
</I>&gt;<i>     to think in terms of asynchronously publishing events (for
</I>&gt;<i>     consumption elsewhere) or consuming data in a variety of ways,
</I>&gt;<i>     based purely on the usage pattern required.
</I>&gt;<i>
</I>&gt;<i>     Let's assume that you did implement this capability and whenever
</I>&gt;<i>     your publishing application writes to the database, a message gets
</I>&gt;<i>     sent to an exchange on a rabbit broker somewhere, which the other
</I>&gt;<i>     application is consuming via some queue. What happens if the
</I>&gt;<i>     machine or data centre the broker is running on crashes? What
</I>&gt;<i>     happens if the broker becomes overloaded and starts to assert tcp
</I>&gt;<i>     back-pressure on the publisher - which, remember, is running
</I>&gt;<i>     inside a database!? What happens if the database server has to be
</I>&gt;<i>     restarted? And each of these 'what happens' questions must be
</I>&gt;<i>     answered from the perspective of
</I>&gt;<i>
</I>&gt;<i>     1. the code running inside the database server
</I>&gt;<i>     2. the application writing to the database
</I>&gt;<i>     3. the application listening to the queue(s)
</I>&gt;<i>     4. the RabbitMQ broker itself
</I>&gt;<i>
</I>&gt;<i>     That is an *awful* lot of moving parts, one of which is critical
</I>&gt;<i>     to your infrastructure (i.e., the database server) and largely not
</I>&gt;<i>     under you control (in so much as the semantics for running user
</I>&gt;<i>     defined code inside the database server and the error handling
</I>&gt;<i>     behaviour of such, are likely to be highly constrained). Even in
</I>&gt;<i>     an environment where you're running your user defined function in
</I>&gt;<i>     an external operating system process (e.g., Oracle UDFs written in
</I>&gt;<i>     java) the failure modes are terrifying. Even in an environment
</I>&gt;<i>     which gives you a very clear picture of the constrained runtime in
</I>&gt;<i>     which you're operating (e.g., custom .NET code running inside MS
</I>&gt;<i>     SQL Server as a UDF or stored procedure) there are questions about
</I>&gt;<i>     how stable and safe this approach is. And even in those
</I>&gt;<i>     environments, where stability and safety *can* be understood and
</I>&gt;<i>     controlled to some extent, there is still the question of
</I>&gt;<i>     semantics. If the publication fails, what does the application
</I>&gt;<i>     writing to the database see? Does the insert/update fail? Doing so
</I>&gt;<i>     would require making a synchronous call in the trigger/callback,
</I>&gt;<i>     which would block the database server and create contention for
</I>&gt;<i>     the table! Failing to make the call synchronous would lead to
</I>&gt;<i>     silent failures however! There are no happy endings here, I can
</I>&gt;<i>     assure you.
</I>&gt;<i>
</I>&gt;<i>     Now that I hope I've put you off this idea, here's how you can do
</I>&gt;<i>     it if you disagree. Write a user defined function in C (consulting
</I>&gt;<i>     <A HREF="http://dev.mysql.com/doc/refman/5.1/en/adding-udf.html">http://dev.mysql.com/doc/refman/5.1/en/adding-udf.html</A> or whatever
</I>&gt;<i>     resources you have available to assist in this) and in your user
</I>&gt;<i>     defined function, use the RabbitMQ native/C client (librabbitmq)
</I>&gt;<i>     to talk to rabbit. The details of doing all of this are left as an
</I>&gt;<i>     exercise to the daring. Do bare in mind that MySQL UDFs *must* be
</I>&gt;<i>     thread safe, that librabbitmq has no explicit support for
</I>&gt;<i>     threading whatsoever and that blocking in a udf is probably the
</I>&gt;<i>     first step on the road to bedlam.
</I>&gt;<i>
</I>&gt;<i>     Cheers,
</I>&gt;<i>     Tim
</I>&gt;&gt;<i>     Cheers,
</I>&gt;&gt;<i>     Shadowalker.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     _______________________________________________
</I>&gt;&gt;<i>     rabbitmq-discuss mailing list
</I>&gt;&gt;<i>     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>  &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i>     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/2c4e2d7c/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/2c4e2d7c/attachment.htm</A>&gt;
</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023107.html">[rabbitmq-discuss] Re : rabbitmqadmin configuration
</A></li>
	<LI>Next message: <A HREF="023115.html">[rabbitmq-discuss] Use a mysql databse table as the provider for rabbitmq queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23112">[ date ]</a>
              <a href="thread.html#23112">[ thread ]</a>
              <a href="subject.html#23112">[ subject ]</a>
              <a href="author.html#23112">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
