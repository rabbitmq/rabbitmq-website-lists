<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Memory watermark alert not resetting.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Memory%20watermark%20alert%20not%20resetting.&In-Reply-To=%3CCACx7p4Cnf6C16C05vL5CU66R16mWWmSK9cU-uPmi2WgP8-OMOg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022849.html">
   <LINK REL="Next"  HREF="022866.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Memory watermark alert not resetting.</H1>
    <B>Raviv Pavel</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Memory%20watermark%20alert%20not%20resetting.&In-Reply-To=%3CCACx7p4Cnf6C16C05vL5CU66R16mWWmSK9cU-uPmi2WgP8-OMOg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Memory watermark alert not resetting.">raviv at gigya-inc.com
       </A><BR>
    <I>Thu Oct  4 16:38:46 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022849.html">[rabbitmq-discuss] Memory watermark alert not resetting.
</A></li>
        <LI>Next message: <A HREF="022866.html">[rabbitmq-discuss] Memory watermark alert not resetting.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22864">[ date ]</a>
              <a href="thread.html#22864">[ thread ]</a>
              <a href="subject.html#22864">[ subject ]</a>
              <a href="author.html#22864">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Upgraded the other node (there are two) and it fails to start.
Here is the startup log:


+---+   +---+
|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   +---+   +-------+
</I>|<i>                   |
</I>|<i> RabbitMQ  +---+   |
</I>|<i>           |   |   |
</I>|<i>   v2.8.7  +---+   |
</I>|<i>                   |
</I>+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>

node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mongo-qa2</A>
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.8.7/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : pu0BlS9+G2N9yLfd51TkmA==
log            : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mongo-qa2.log</A>
sasl log       : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mongo-qa2-sasl.log</A>
database dir   : /var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mongo-qa2</A>
erlang version : 5.8.4

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
 ...done
starting database                                                     ...

BOOT FAILED
===========

Error description:
   {error,{failed_to_cluster_with,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mongo-qa1</A>'],
                                  &quot;Mnesia could not connect to any disc
nodes.&quot;}}

Log files (may contain more information):
   /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mongo-qa2.log</A>
   /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mongo-qa2-sasl.log</A>

Stack trace:
   [{rabbit_mnesia,init_db,3},
    {rabbit_mnesia,init,0},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
    {rabbit,run_boot_step,1},
    {rabbit,'-start/2-lc$^0/1-0-',1},
    {rabbit,start,2},
    {application_master,start_it_old,4}]

{&quot;Kernel pid
terminated&quot;,application_controller,&quot;{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}&quot;}


Thanks
*--*Raviv
*
*



On Thu, Oct 4, 2012 at 5:34 PM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> Hard to believe that's to do with the server not starting - can you post a
</I>&gt;<i> more complete log?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 04/10/12 16:32, Raviv Pavel wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> After upgrading the server won't start. from the logs:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> =ERROR REPORT==== 4-Oct-2012::17:11:59 ===
</I>&gt;&gt;<i> ** Generic server &lt;0.341.0&gt; terminating
</I>&gt;&gt;<i> ** Last message in was {'$gen_cast',
</I>&gt;&gt;<i>                             {method,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   {'queue.declare',0,&lt;&lt;&quot;es1&quot;&gt;&gt;,**false,true,false,
</I>&gt;&gt;<i>                                     false,false,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   [{&lt;&lt;&quot;x-ha-policy&quot;&gt;&gt;,longstr,&lt;&lt;**&quot;all&quot;&gt;&gt;}]},
</I>&gt;&gt;<i>                                 none,noflow}}
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks
</I>&gt;&gt;<i> /--/Raviv
</I>&gt;&gt;<i> /
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> /
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Oct 4, 2012 at 5:05 PM, Raviv Pavel &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">raviv at gigya-inc.com</A>
</I>&gt;&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">raviv at gigya-inc.com</A>&gt;&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     All queues are empty and &quot;rabbitmqctl list_queues name memory&quot; shows
</I>&gt;&gt;<i>     they use about 3K each.
</I>&gt;&gt;<i>     VM memory stats are much lower then the one shown in the overview.
</I>&gt;&gt;<i>     We're using 2.8.1 - I'll try upgrading to 2.8.7
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Thanks
</I>&gt;&gt;<i>     /--/Raviv
</I>&gt;&gt;<i>     /
</I>&gt;&gt;<i>     /
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     On Thu, Oct 4, 2012 &lt;tel:2012&gt; at 4:57 PM, Matthias Radestock
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt;**&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         On 04/10/12 15:53, Simon MacMullen wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>             On 04/10/12 13:01, Raviv Pavel wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                 Based on the management UI, memory usage doesn't drop
</I>&gt;&gt;<i>                 and publishers are
</I>&gt;&gt;<i>                 still blocked.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>             Hmm. In that case my first guess would be that the queue you
</I>&gt;&gt;<i>             deleted /
</I>&gt;&gt;<i>             purged wasn't the queue which was using all the memory.
</I>&gt;&gt;<i>             Check the memory
</I>&gt;&gt;<i>             use of other queues - this can be found on the queue details
</I>&gt;&gt;<i>             page, or
</I>&gt;&gt;<i>             with &quot;rabbitmqctl list_queues name memory&quot;. Also, check the
</I>&gt;&gt;<i>             VM-wide
</I>&gt;&gt;<i>             memory statistics (on the node details page, under
</I>&gt;&gt;<i>             &quot;advanced&quot;. This
</I>&gt;&gt;<i>             might give a clue as to where the memory is going.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         ...and please make sure you are running the latest version of
</I>&gt;&gt;<i>         RabbitMQ (2.8.7, atm), since we have fixed a few memory leaks in
</I>&gt;&gt;<i>         the in recent versions.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Matthias.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/6aa90c75/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/6aa90c75/attachment.htm</A>&gt;
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022849.html">[rabbitmq-discuss] Memory watermark alert not resetting.
</A></li>
	<LI>Next message: <A HREF="022866.html">[rabbitmq-discuss] Memory watermark alert not resetting.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22864">[ date ]</a>
              <a href="thread.html#22864">[ thread ]</a>
              <a href="subject.html#22864">[ subject ]</a>
              <a href="author.html#22864">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
