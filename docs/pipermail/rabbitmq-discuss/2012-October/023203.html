<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] nodename variable and mnesia directory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20nodename%20variable%20and%20mnesia%20directory&In-Reply-To=%3CE94F626F5C43D14F8B8479C5EBD79038A85DD854%40vmexchange02.seegrid.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023199.html">
   <LINK REL="Next"  HREF="023210.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] nodename variable and mnesia directory</H1>
    <B>Elizabeth Liao</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20nodename%20variable%20and%20mnesia%20directory&In-Reply-To=%3CE94F626F5C43D14F8B8479C5EBD79038A85DD854%40vmexchange02.seegrid.local%3E"
       TITLE="[rabbitmq-discuss] nodename variable and mnesia directory">eliao at seegrid.com
       </A><BR>
    <I>Fri Oct 19 19:44:26 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023199.html">[rabbitmq-discuss] nodename variable and mnesia directory
</A></li>
        <LI>Next message: <A HREF="023210.html">[rabbitmq-discuss] nodename variable and mnesia directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23203">[ date ]</a>
              <a href="thread.html#23203">[ thread ]</a>
              <a href="subject.html#23203">[ subject ]</a>
              <a href="author.html#23203">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Tim,

I'm going to back up a bit because it seems that I've misunderstood something previously.

&gt;<i>The first thing I'm going to say is that this isn't really a desirable
</I>state of affairs. Why do you need to change NODENAME at all, just
because the host name has changed? This seems like an odd step to me -
can you explain the rationale behind it?

I had an earlier problem changing the hostname and restarting the rabbitmq-server. The proposed fix was to add the NODENAME variable which I'm guessing was not right? :
<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html</A>

&gt;<i>Can you explain a bit more about this 'bug' please? What exactly is
</I>going wrong?

The bug is on our end where the NODENAME is set to an empty string. Of course this is moot if NODENAME doesn't even have to be set in the first place.

Liz
________________________________________
From: Tim Watson [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>]
Sent: Friday, October 19, 2012 12:48 PM
To: Discussions about RabbitMQ
Cc: Elizabeth Liao
Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory

Hi

On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.
</I>
The first thing I'm going to say is that this isn't really a desirable
state of affairs. Why do you need to change NODENAME at all, just
because the host name has changed? This seems like an odd step to me -
can you explain the rationale behind it?

&gt;<i> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.
</I>
Can you explain a bit more about this 'bug' please? What exactly is
going wrong?

&gt;<i> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.
</I>
Now this makes no sense at all to me. If you are trying to recover
'without killing the erlang process' then how are you planning on
changing the NODENAME? Once an erlang node has become part of a
distributed system, you cannot arbitrarily change the node's name
without restarting the net_kernel AFAIK so I can't see how this is even
possible. Also, because you're stating that 'rabbit started up properly'
I'm assuming that you have in fact taken the node offline (using
`rabbitmqctl stop` or one of the various service scripts that invokes
it) and that you are now starting the node again. The rabbit startup
scripts (and associated infrastructure) is not set up to handle changing
the name of a node post-installation in this manner, so I would not
expect this to work smoothly.

&gt;<i> A couple of questions:
</I>&gt;<i> Is this the proper way to fix the situation?
</I>
No. As I said a moment ago, rabbit is not set up for this kind of
scenario so I'd be very cautious about doing this and would really
recommend against it.

&gt;<i> Will this have unintended consequences?
</I>
I have no idea, but it is entirely possible that various things could
break in obscure and alarming ways. I really would not do this if I were
you.

&gt;<i> We are running rabbitmq-server-2.8.6 and erlang-R15B.
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>
Liz. I would like to help you find a safe work-around so that you can
use rabbit in your environment. I would really like to understand why
the changing of a machine's host-name is causing problems for you. I
fully realise that after changing the hostname, it is possible that a
restart may be required (although I'd have to do some research to verify
whether or not this is a hard requirement). But I cannot understand why
a change to the machine's host name requires changing the rabbit
NODENAME at all, unless you've altered the rabbit start scripts to use
'longnames' configuration (i.e., including the complete host name in the
node name) in which case, a simple solution to your problem might be to
switch back to using 'shortnames'. If erlang is started using -sname
rabbit@`hostname -s` and your /etc/hosts configuration supports
resolving the machine's IP to the short version of the name, then
changing the hostname shouldn't cause all of these headaches.

For example, if I launch rabbit with something like this:

env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672
RABBITMQ_LOG_BASE=&quot;/tmp&quot;
RABBITMQ_MNESIA_DIR=&quot;/tmp/rabbitmq-rabbit-mnesia&quot;
RABBITMQ_PID_FILE=&quot;/tmp/rabbitmq-rabbit.pid&quot;
RABBITMQ_PLUGINS_EXPAND_DIR=&quot;/tmp/rabbitmq-rabbit-plugins-scratch&quot;
RABBITMQ_ENABLED_PLUGINS_FILE=&quot;/tmp/enabled-plugins&quot;
RABBITMQ_CONFIG_FILE=&quot;/tmp/etc/rabbit&quot; ./scripts/rabbitmq-server

Then change the hostname, then stop rabbit and start it again,
everything is fine.

Cheers,
Tim

&gt;<i> Liz
</I>&gt;<i> Email Confidentiality Notice
</I>&gt;<i>
</I>&gt;<i> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023199.html">[rabbitmq-discuss] nodename variable and mnesia directory
</A></li>
	<LI>Next message: <A HREF="023210.html">[rabbitmq-discuss] nodename variable and mnesia directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23203">[ date ]</a>
              <a href="thread.html#23203">[ thread ]</a>
              <a href="subject.html#23203">[ subject ]</a>
              <a href="author.html#23203">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
