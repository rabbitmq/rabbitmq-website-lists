<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Memory watermark alert not resetting.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Memory%20watermark%20alert%20not%20resetting.&In-Reply-To=%3CCACx7p4A3yJKOP6CN_Z-OwnMvsD%3D%3DLNSBGXtUz%2B%2BtLmpWC%3Db6aQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022851.html">
   <LINK REL="Next"  HREF="022890.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Memory watermark alert not resetting.</H1>
    <B>Raviv Pavel</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Memory%20watermark%20alert%20not%20resetting.&In-Reply-To=%3CCACx7p4A3yJKOP6CN_Z-OwnMvsD%3D%3DLNSBGXtUz%2B%2BtLmpWC%3Db6aQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Memory watermark alert not resetting.">raviv at gigya-inc.com
       </A><BR>
    <I>Mon Oct  8 09:57:11 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022851.html">[rabbitmq-discuss] Memory watermark alert not resetting.
</A></li>
        <LI>Next message: <A HREF="022890.html">[rabbitmq-discuss] Memory watermark alert not resetting.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22886">[ date ]</a>
              <a href="thread.html#22886">[ thread ]</a>
              <a href="subject.html#22886">[ subject ]</a>
              <a href="author.html#22886">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Makes sense.
I'm trying to reproduce with higher watermark by publishing messages,
consuming them but not acking (this is what happened in production) but
can't get the memory to go above the watermark.
Can you explain or point me to an explanation of Rabbit's memory usage?

Also, When hitting the watermark, the server seems to block the producer on
the socket level, instead of sending a flow control message. Since the .Net
SDK doesn't expose a send timeout, publishing is blocked forever.
Any reason for not exposing such timeout?


Thanks
*--*Raviv
*
*



On Thu, Oct 4, 2012 at 6:17 PM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 04/10/12 16:57, Raviv Pavel wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Back to the original problem:
</I>&gt;&gt;<i> 1. I set the watermark very low so I can reach it, effectively  78MB
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ah. Was this what you had done in the first place?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  2. server starts with empty queues and memory usage is 66MB
</I>&gt;&gt;<i> 3. I start publishing messages and reach the watermark
</I>&gt;&gt;<i> 4. publisher gets blocked
</I>&gt;&gt;<i> 5. I purge the queue but memory stays the same
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> When you set the watermark very low, close to the &quot;empty&quot; memory use, it
</I>&gt;<i> is very possible that the memory level will go over and never go under
</I>&gt;<i> again. Caches, lazy instantiation and so on. RabbitMQ is not designed for
</I>&gt;<i> highly constrained memory environments.
</I>&gt;<i>
</I>&gt;<i> Cheers. Simon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121008/656c98df/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121008/656c98df/attachment.htm</A>&gt;
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022851.html">[rabbitmq-discuss] Memory watermark alert not resetting.
</A></li>
	<LI>Next message: <A HREF="022890.html">[rabbitmq-discuss] Memory watermark alert not resetting.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22886">[ date ]</a>
              <a href="thread.html#22886">[ thread ]</a>
              <a href="subject.html#22886">[ subject ]</a>
              <a href="author.html#22886">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
