<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] question on message ordering guarantees
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20question%20on%20message%20ordering%20guarantees&In-Reply-To=%3C507FDD3F.9080608%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023153.html">
   <LINK REL="Next"  HREF="023159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] question on message ordering guarantees</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20question%20on%20message%20ordering%20guarantees&In-Reply-To=%3C507FDD3F.9080608%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] question on message ordering guarantees">tim at rabbitmq.com
       </A><BR>
    <I>Thu Oct 18 11:43:11 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023153.html">[rabbitmq-discuss] question on message ordering guarantees
</A></li>
        <LI>Next message: <A HREF="023159.html">[rabbitmq-discuss] question on message ordering guarantees
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23158">[ date ]</a>
              <a href="thread.html#23158">[ thread ]</a>
              <a href="subject.html#23158">[ subject ]</a>
              <a href="author.html#23158">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

On 10/18/2012 10:30 AM, Artur Ejsmont wrote:
&gt;<i> Hi there everyone,
</I>&gt;<i>
</I>&gt;<i> I am working on a rabbitmq based messaging system and i was wondering 
</I>&gt;<i> if you could help me out :)
</I>&gt;<i>
</I>&gt;<i> I was wondering how could i enforce events being processed in the 
</I>&gt;<i> order they are published?
</I>&gt;<i>
</I>
So from <A HREF="http://www.rabbitmq.com/semantics.html,">http://www.rabbitmq.com/semantics.html,</A> we can see:

&quot;Section 4.7 of the AMQP 0-9-1 core specification explains the 
conditions under which ordering is guaranteed: messages published in one 
channel, passing through one exchange and one queue and one outgoing 
channel will be received in the same order that they were sent. RabbitMQ 
offers stronger guarantees since release 2.7.0.

Messages can be returned to the queue using AMQP methods that feature a 
requeue parameter (basic.recover, basic.reject and basic.nack), or due 
to a channel closing while holding unacknowledged messages. Any of these 
scenarios caused messages to be requeued at the back of the queue for 
RabbitMQ releases earlier than 2.7.0. From RabbitMQ release 2.7.0, 
messages *are always held in the queue in publication order*, *even in 
the presence of requeueing or channel closure*.

With release 2.7.0 and later *it is still possible for individual 
consumers to observe messages out of order if the queue has multiple 
subscribers*. This is due to the actions of other subscribers who may 
requeue messages. From the perspective of the queue the messages are 
always held in the publication order.&quot;

So you've got to think about it in those terms. It's exactly the same 
with ActiveMQ message groups, because they are based on the Exclusive 
Consumer feature, which states: &quot;The broker will pick a single 
MessageConsumer to get all the messages for a queue to ensure ordering. 
If that consumer fails, the broker will auto failover and choose another 
consumer.&quot; (<A HREF="http://activemq.apache.org/exclusive-consumer.html">http://activemq.apache.org/exclusive-consumer.html</A>) except 
that groups are parallel, so: &quot;... logically Message Groups are kinda 
like a parallel Exclusive Consumer 
&lt;<A HREF="http://activemq.apache.org/exclusive-consumer.html">http://activemq.apache.org/exclusive-consumer.html</A>&gt;. Rather than all 
messages going to a single consumer, the standard JMS header 
*JMSXGroupID* is used to define which /message group/ the message 
belongs to. The Message Group feature then ensures that all messages for 
the same message group will be sent to the same JMS consumer - while 
that consumer stays alive. As soon as the consumer dies another will be 
chosen.&quot; (<A HREF="http://activemq.apache.org/message-groups.html">http://activemq.apache.org/message-groups.html</A>).

You might be able kludge something similar using the consistent hash 
exchange plugin 
(<A HREF="http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/rabbitmq_v2_8_7/README.md">http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/rabbitmq_v2_8_7/README.md</A>) 
but you will *not* get the same kind of guarantees.

We have been asked about this feature before and will probably implement 
something like it in a future release.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/a09740b3/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/a09740b3/attachment.htm</A>&gt;
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023153.html">[rabbitmq-discuss] question on message ordering guarantees
</A></li>
	<LI>Next message: <A HREF="023159.html">[rabbitmq-discuss] question on message ordering guarantees
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23158">[ date ]</a>
              <a href="thread.html#23158">[ thread ]</a>
              <a href="subject.html#23158">[ subject ]</a>
              <a href="author.html#23158">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
