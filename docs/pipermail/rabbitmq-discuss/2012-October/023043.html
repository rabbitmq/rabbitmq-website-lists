<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Memory limit cleanup, hanging connections.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Memory%20limit%20cleanup%2C%20hanging%20connections.&In-Reply-To=%3C507BE920.4080405%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023039.html">
   <LINK REL="Next"  HREF="023049.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Memory limit cleanup, hanging connections.</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Memory%20limit%20cleanup%2C%20hanging%20connections.&In-Reply-To=%3C507BE920.4080405%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Memory limit cleanup, hanging connections.">simon at rabbitmq.com
       </A><BR>
    <I>Mon Oct 15 11:44:48 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023039.html">[rabbitmq-discuss] Memory limit cleanup, hanging connections.
</A></li>
        <LI>Next message: <A HREF="023049.html">[rabbitmq-discuss] Memory limit cleanup, hanging connections.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23043">[ date ]</a>
              <a href="thread.html#23043">[ thread ]</a>
              <a href="subject.html#23043">[ subject ]</a>
              <a href="author.html#23043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/10/12 10:49, Irmo Manie wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> We ran into a situation where we hit a memory limit by queues being
</I>&gt;<i> filled upt, causing all connections to be in a blocked or blocking state.
</I>&gt;<i>
</I>&gt;<i> We're killed all connections from the client side and deleted the filled
</I>&gt;<i> up queues.
</I>&gt;<i> While the broker is still cleaning up /msg_store_transient (which is
</I>&gt;<i> horribly slow), it also still lists all the connections as alive, being
</I>&gt;<i> still blocked.
</I>&gt;<i>
</I>&gt;<i> Is it possible that when the broker is still in memory alarm mode, the
</I>&gt;<i> connections (blocked) are not checked for their heartbeat and therefore
</I>&gt;<i> are kept alive?
</I>
Yes, that's absolutely correct. The blocked connections don't perform 
any network operations at all - which means that not only don't they 
check for heartbeats, they don't even detect the TCP connection being 
torn down. As soon as the memory alarm clears, the connections will 
unblock, notice the TCP connection having gone away, and vanish.

&gt;<i> And what is the cause of the slowness of the cleanup when deleting
</I>&gt;<i> queues with only transient messages?
</I>
If you've &quot;filled up&quot; all your queues then they will have been paging to 
disc for some time - cleaning all that up can be quite slow.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023039.html">[rabbitmq-discuss] Memory limit cleanup, hanging connections.
</A></li>
	<LI>Next message: <A HREF="023049.html">[rabbitmq-discuss] Memory limit cleanup, hanging connections.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23043">[ date ]</a>
              <a href="thread.html#23043">[ thread ]</a>
              <a href="subject.html#23043">[ subject ]</a>
              <a href="author.html#23043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
