<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem with RabbitMQ HA cluster on	EC2	(Windows)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20RabbitMQ%20HA%20cluster%20on%0A%09EC2%09%28Windows%29&In-Reply-To=%3C09ea01cdabb3%24cc78b1d0%24656a1570%24%40psonar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023086.html">
   <LINK REL="Next"  HREF="023114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem with RabbitMQ HA cluster on	EC2	(Windows)</H1>
    <B>Richard Urwin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20RabbitMQ%20HA%20cluster%20on%0A%09EC2%09%28Windows%29&In-Reply-To=%3C09ea01cdabb3%24cc78b1d0%24656a1570%24%40psonar.com%3E"
       TITLE="[rabbitmq-discuss] Problem with RabbitMQ HA cluster on	EC2	(Windows)">richard at psonar.com
       </A><BR>
    <I>Tue Oct 16 16:34:56 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023086.html">[rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2	(Windows)
</A></li>
        <LI>Next message: <A HREF="023114.html">[rabbitmq-discuss] Problem with RabbitMQ HA cluster on	EC2	(Windows)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23091">[ date ]</a>
              <a href="thread.html#23091">[ thread ]</a>
              <a href="subject.html#23091">[ subject ]</a>
              <a href="author.html#23091">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Tim,

 

Thanks for the rapid response!

 

OK, so I added the following into each hosts file:

 

IP-0AF23E1E       10.XX.XX.XX

IP-0AD25792      10.XX.XX.XX

 

The names now match everywhere and are correctly mapped to the private IPs.

 

Now when I run:

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin&gt;rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at IP-0AF23E1E</A>

 

I have success:

 

Clustering node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at IP-0AD25792</A>' with ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at IP-0AF23E1E</A>'] ...

...done.

 

&#8230;and checking the cluster status with:

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin&gt;rabbitmqctl cluster_status

 

&#8230;gives:

 

Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at IP-0AD25792</A>' ...

[{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at IP-0AF23E1E</A>']},{ram,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at IP-0AD25792</A>']}]},

{running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at IP-0AF23E1E</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at IP-0AD25792</A>']}]

...done.

 

BUT:

 

I had to open all of the ports within the EC2 security group and Windows firewall.

 

As mentioned, I have this (and only this) in my rabbit.config:

 

[{kernel, [{inet_dist_listen_min, 55700}, {inet_dist_listen_max, 55800}]}].

 

But it doesn&#8217;t appear to be restricting the ports (since when I restrict the firewalls back to that range, it can&#8217;t cluster.)

 

Can you see what&#8217;s wrong?

 

Thanks,

Rich

 

 

From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Tim Watson
Sent: 16 October 2012 15:29
To: Discussions about RabbitMQ
Cc: &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
Subject: Re: [rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2 (Windows)

 

Hi


On 16 Oct 2012, at 13:46, &quot;Richard Urwin&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">richard at psonar.com</A>&gt; wrote:

Hi everyone,

 

 

Snip

 

 

The problem is when attempting to cluster. Running the command:

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin&gt;rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ec2-XX-XX-XX-XX.compute-1.amazonaws.com</A>

 

I get the result:

 

Clustering node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at IP-0XXXXXXX</A>' with ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ec2-</A> XX-XX-XX-XX.compute-1.amazonaws.com'] ...

Error: {no_running_cluster_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ec2-</A> XX-XX-XX-XX.compute-1.amazonaws.com'], ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ec2-</A> XX-XX-XX-XX.compute-1.amazonaws.com']}

 

I think this is because I&#8217;m attempting to use the EC2 Public DNS.

 

I then added mappings to my hosts file, to map to my two instances:

 

10.XXX.XX.XX     rabbit01               # Public DNS: ec2-XX-XX-XX-XX.compute-1.amazonaws.com

10.XXX.XX.XX     rabbit02               # Public DNS: ec2-XX-XX-XX-XX.compute-1.amazonaws.com

 

Running the command (with different hostname):

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin&gt;rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ec2-XX-XX-XX-XX.compute-1.amazonaws.com</A>&gt; 

 

I get the same result:

 

Clustering node 'rabbit@ IP-0AAXXXXX&#8217; with [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A>] ...

Error: {no_running_cluster_nodes,[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A>],[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A>]}

 

 

Ok but what do those rabbits think the node names are?





I know this mapping can be used to access the other Windows computer, because I can use it to access the management console in a web browser:

 

<A HREF="http://rabbit02:55672/#/">http://rabbit02:55672/#/</A>

 

 

That doesn't mean that erlang knows the nodes as <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit2</A> though.





I then tried to change the computer name from IP-0AAXXXXX to rabbit01 (in case this was a problem) but upon reboot, it hadn&#8217;t changed. 

 

 

When you start rabbit on the host, run rabbitmqctl status on the host itself and see what the node name looks like. This needs to match up so that all the nodes have a consistent view of the names. I would expect some /etc/hosts configuration to solve any naming difficulties. Remember that rabbit uses short names (without the domain) by default.





Does anyone have any suggestions?

 

Thanks,

Rich

_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/48af0e43/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/48af0e43/attachment.htm</A>&gt;
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023086.html">[rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2	(Windows)
</A></li>
	<LI>Next message: <A HREF="023114.html">[rabbitmq-discuss] Problem with RabbitMQ HA cluster on	EC2	(Windows)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23091">[ date ]</a>
              <a href="thread.html#23091">[ thread ]</a>
              <a href="subject.html#23091">[ subject ]</a>
              <a href="author.html#23091">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
