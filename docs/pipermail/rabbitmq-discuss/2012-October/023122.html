<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Monitoring A Queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Monitoring%20A%20Queue&In-Reply-To=%3C507EAF6B.5080504%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023093.html">
   <LINK REL="Next"  HREF="023123.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Monitoring A Queue</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Monitoring%20A%20Queue&In-Reply-To=%3C507EAF6B.5080504%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Monitoring A Queue">simon at rabbitmq.com
       </A><BR>
    <I>Wed Oct 17 14:15:23 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023093.html">[rabbitmq-discuss] Fwd: Monitoring A Queue
</A></li>
        <LI>Next message: <A HREF="023123.html">[rabbitmq-discuss] Monitoring A Queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23122">[ date ]</a>
              <a href="thread.html#23122">[ thread ]</a>
              <a href="subject.html#23122">[ subject ]</a>
              <a href="author.html#23122">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

On 15/10/12 17:10, Jason Antman wrote:
&gt;<i> I've been examining the JSON results from the management API
</I>&gt;<i> (/api/queues/vhost_name/queue_name), and have come to the following
</I>&gt;<i> conclusions:
</I>&gt;<i> 1) There are no monotonically increasing counters of the number of
</I>&gt;<i> messages in to the queue and number of messages out of the queue.
</I>&gt;<i> Therefore, there's no way for me to figure the rate on an arbitrary time
</I>&gt;<i> scale.
</I>
I'm afraid so, yes. message_stats.publish and message_stats.deliver_get 
are an approximation of what you want, but they only count messages from 
currently open channels. This may change in future, we're aware of it as 
a limitation.

But you may be able to get away with using those if your applications 
tend to keep connections open for a long time.

&gt;<i> 2) The &quot;messages&quot; element in the JSON array is the number of messages
</I>&gt;<i> currently sitting in the queue, not a counter of the number that have
</I>&gt;<i> passed through it.
</I>
Yes.

&gt;<i> 3) The API does provide backing_queue_status.avg_ingress_rate and
</I>&gt;<i> backing_queue_status.avg_egress_rate. Going by Matthew's post to
</I>&gt;<i> &quot;Monitoring Message Throughput&quot;
</I>&gt;<i> (<A HREF="http://rabbitmq.1065348.n5.nabble.com/Monitoring-Message-Throughput-td17436.html#a17438">http://rabbitmq.1065348.n5.nabble.com/Monitoring-Message-Throughput-td17436.html#a17438</A>)
</I>
It's worth noting that that thread is quite old - it predates the 
management plugin for a start.

&gt;<i> from February, 2010, I gather that these values are averaged over
</I>&gt;<i> approx. 10 seconds. I'm also assuming that ingress is *every* message
</I>&gt;<i> into the queue, and egress is... *every* message grabbed from the queue,
</I>&gt;<i> regardless of ACK? So even if consumers are not acking any messages,
</I>&gt;<i> this rate will still show them?
</I>
Maybe. The trouble is that those stats are maintained by the backing 
queue for its own purposes, they're only coincidentally useful for 
anyone else.

One issue is that the backing_queue_status only counts messages that 
actually make it into the backing queue. Messages can fly through the 
queue and never touch the backing queue if there is an autoack consumer 
ready to receive them.

&gt;<i> Are these correct?
</I>&gt;<i>
</I>&gt;<i> It would be really helpful if someone could explain exactly what
</I>&gt;<i> avg_in/egress_rate and avg_ack_in/egress_rate mean.
</I>
Hope this helps.

&gt;<i> I also found some reference to a Ticket 23 (though I don't see any links
</I>&gt;<i> to the RMQ ticketing system) that dealt with monitoring:
</I>&gt;<i> <A HREF="http://grokbase.com/t/rabbitmq/rabbitmq-discuss/10ag2hejbb/ticket-23-new-comment-monitoring-message-throughput">http://grokbase.com/t/rabbitmq/rabbitmq-discuss/10ag2hejbb/ticket-23-new-comment-monitoring-message-throughput</A>
</I>
Oh, that was someone who lost control of their ticketing system(!) and 
starting spamming us. Ignore it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023093.html">[rabbitmq-discuss] Fwd: Monitoring A Queue
</A></li>
	<LI>Next message: <A HREF="023123.html">[rabbitmq-discuss] Monitoring A Queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23122">[ date ]</a>
              <a href="thread.html#23122">[ thread ]</a>
              <a href="subject.html#23122">[ subject ]</a>
              <a href="author.html#23122">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
