<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Repairing a a crashed cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Repairing%20a%20a%20crashed%20cluster&In-Reply-To=%3C507599EF.7040307%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022946.html">
   <LINK REL="Next"  HREF="022955.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Repairing a a crashed cluster</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Repairing%20a%20a%20crashed%20cluster&In-Reply-To=%3C507599EF.7040307%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Repairing a a crashed cluster">simon at rabbitmq.com
       </A><BR>
    <I>Wed Oct 10 16:53:19 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022946.html">[rabbitmq-discuss] Repairing a a crashed cluster
</A></li>
        <LI>Next message: <A HREF="022955.html">[rabbitmq-discuss] Repairing a a crashed cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22950">[ date ]</a>
              <a href="thread.html#22950">[ thread ]</a>
              <a href="subject.html#22950">[ subject ]</a>
              <a href="author.html#22950">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/10/12 14:49, Dave Seltzer wrote:
&gt;<i> My instinct, for the sake of uptime, is to say: &quot;okay, forget node2,
</I>&gt;<i> lets break the cluster and bring node1 online&quot;.
</I>&gt;<i>
</I>&gt;<i> My problem is that according to the docs I need to issue a &quot;rabbitmqctl
</I>&gt;<i> force_reset&quot;, which I can't do unless the server is running.
</I>&gt;<i>
</I>&gt;<i> I tried starting it using &quot;rabbitmq-server -detached&quot; but the server
</I>&gt;<i> just exited after loading plugins.
</I>&gt;<i>
</I>&gt;<i> Does anyone know the right course of action in this scenario?
</I>
Hi. The bad news is that the released versions of RabbitMQ do not handle 
this situation well. The good news is that the next release will do better.

However, in your situation it is possible to break the cluster and bring 
node1 up. But it's a bit fiddly.

First of all, you will need to start node1 with the environment variable 
RABBITMQ_NODE_ONLY set to some value. This will start the Erlang VM 
without attempting to start RabbitMQ or Mnesia. Exactly how you do this 
depends on how you have RabbitMQ installed, but on Unix you would 
typically add that to /etc/rabbitmq/rabbitmq-env.conf. Note that our 
init scripts wait for RabbitMQ to start, so /etc/init.d/rabbitmq-server 
will hang, but the node will start.

Once you have the node running, you can then invoke:

   rabbitmqctl eval 'mnesia:start(),[mnesia:force_load_table(T) || T &lt;- 
rabbit_mnesia:table_names()],mnesia:del_table_copy(schema, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>).'

(all as one line), with node2 substituted in. This should respond with:

   {atomic,ok}

Then you can invoke

   rabbitmqctl stop

to stop node1 again. At this point it should have forgotten node2 and be 
able to start again normally.

Note that we don't use &quot;rabbitmqctl force_reset&quot; since that would reset 
node1, and the point is to make it forget node2.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022946.html">[rabbitmq-discuss] Repairing a a crashed cluster
</A></li>
	<LI>Next message: <A HREF="022955.html">[rabbitmq-discuss] Repairing a a crashed cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22950">[ date ]</a>
              <a href="thread.html#22950">[ thread ]</a>
              <a href="subject.html#22950">[ subject ]</a>
              <a href="author.html#22950">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
