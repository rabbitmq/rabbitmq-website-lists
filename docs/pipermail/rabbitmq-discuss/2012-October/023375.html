<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Batching messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Batching%20messages&In-Reply-To=%3C56DFE0E5-83F0-4F04-B382-C2D46C053856%40kvrgic.se%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023333.html">
   <LINK REL="Next"  HREF="023376.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Batching messages</H1>
    <B>Srdan Kvrgic</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Batching%20messages&In-Reply-To=%3C56DFE0E5-83F0-4F04-B382-C2D46C053856%40kvrgic.se%3E"
       TITLE="[rabbitmq-discuss] Batching messages">srdan at burtcorp.com
       </A><BR>
    <I>Fri Oct 26 11:14:09 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023333.html">[rabbitmq-discuss] Batching messages
</A></li>
        <LI>Next message: <A HREF="023376.html">[rabbitmq-discuss] Batching messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23375">[ date ]</a>
              <a href="thread.html#23375">[ thread ]</a>
              <a href="subject.html#23375">[ subject ]</a>
              <a href="author.html#23375">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Oct 25, 2012, at 11:54 , Tim Watson wrote:

&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> On 10/25/2012 06:33 AM, Srdan Kvrgic wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Short story:
</I>&gt;&gt;<i> Are there any plans to support batching of messages within the rabbitmq eco-system?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Long story:
</I>&gt;<i> [snip]
</I>&gt;&gt;<i> Optimally you would want a system that sends and receives batches of messages but allows you to reject single messages. Have your cake and eat it, as it were...
</I>&gt;<i> 
</I>&gt;<i> Sounds good, but...
</I>&gt;<i> 
</I>&gt;<i> AMQP already provides batching delivery capabilities and these have been discussed previously, for example <A HREF="https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/CidFKmJrBFI.">https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/CidFKmJrBFI.</A> But what you seem to be running up against is the fact that your many small messages limit throughput, so you want to bundle them up. I would suggest putting a processor between the publisher and consumer which unpacks the batches and forwards individual messages to the target exchange. This could be achieved by writing a custom exchange type, configured to understand how to 'unpack' the batch and where to route the forwarded messages to. The consumers would then receive these individual messages (possibly in batches!) and could reject some or all of them, but that rejection would not be apparent to the outside world in any way! So you'd need to then change your design somewhat, perhaps by putting 'failed' messages onto a different 'error queue' *or* by rejecting them and setting up a TTL and Dead Letter eXchange on the destination queue so that you can identify failures transparently. In either case, you'd want to add some kind of x-batch-id header to the 'broken up' messages so that your reprocessing procedure is able to identify the source batch from which they came.
</I>
Are you talking about writing an extension to rabbit-mq as such? I'm not sure I follow your solution. Or rather, it doesn't seem like something it's very easy or practical. =)


&gt;<i> Doing this 'in the broker' doesn't really make sense to me. How would transactions and/or confirms continue to work, for example?
</I>
Actually the consumer parts seems to be to be already working like this.. You already get prefetches and what not, I don't see why those shouldn't be delivered in a single data transfer. Perhaps they already are?

The publisher side of this on the other hand doesn't do this by default. I'll have to try disabling Nagle's algorithm to see if that gives use the wings..


&gt;&gt;<i> Also automatic de-/compression in the driver. That also was a great performance boost when the batches started getting big. Lzf ftw!
</I>&gt;<i> 
</I>&gt;<i> Hmn, that's an interesting one! Which client library are you using?
</I>
Running jruby we use java libraries for anything performance critical. Like com.ning.compress.lzf.LZFEncoder for compressions. Unless you're talking about the entire library for tracking, batching, routing and compressing. In that case we use autobahn <A HREF="https://github.com/burtcorp/autobahn/">https://github.com/burtcorp/autobahn/</A>

//S



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/e6cb09fe/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/e6cb09fe/attachment.htm</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023333.html">[rabbitmq-discuss] Batching messages
</A></li>
	<LI>Next message: <A HREF="023376.html">[rabbitmq-discuss] Batching messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23375">[ date ]</a>
              <a href="thread.html#23375">[ thread ]</a>
              <a href="subject.html#23375">[ subject ]</a>
              <a href="author.html#23375">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
