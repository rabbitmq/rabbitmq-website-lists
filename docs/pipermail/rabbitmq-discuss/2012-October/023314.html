<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Termination of queue after sending a message.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Termination%20of%20queue%20after%20sending%20a%20message.&In-Reply-To=%3C5087D220.201%40comarch.pl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023195.html">
   <LINK REL="Next"  HREF="022994.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Termination of queue after sending a message.</H1>
    <B>Ernest Staszuk</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Termination%20of%20queue%20after%20sending%20a%20message.&In-Reply-To=%3C5087D220.201%40comarch.pl%3E"
       TITLE="[rabbitmq-discuss] Termination of queue after sending a message.">ernest.staszuk at comarch.pl
       </A><BR>
    <I>Wed Oct 24 12:33:52 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023195.html">[rabbitmq-discuss] RabbbitMQ and Biztalk Port
</A></li>
        <LI>Next message: <A HREF="022994.html">[rabbitmq-discuss] How to change TTL after declared queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23314">[ date ]</a>
              <a href="thread.html#23314">[ thread ]</a>
              <a href="subject.html#23314">[ subject ]</a>
              <a href="author.html#23314">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

while using RabbitMQ we encountered problems with queue termination.

I enclose log (with vulnerable parts censored). RabbitMQ version we used 
was 2.8.7 ran on Erlang R15B.
We ran into this issue while sending back to queue dead-lettered message 
as follows:

     1. Message from a queue named let's say &quot;to-process&quot; is delivered
         to consumer and then rejected due to failure.
     2. Since queue &quot;to-process&quot; has dead-letter exchange set to 
&quot;failed-messages&quot;
         it falls down there and then to queue &quot;failed-messages-queue&quot;.
     3. Another consumer got this message while listening on 
&quot;failed-messages-queue&quot;,
         stored content and headers in memory and sent acknowledgement.
     4. After a certain time there is made an attempt to sent message 
stored in memory
         to the queue form which it was rejected at first (explicitly 
saying to the &quot;to-process&quot; queue).
         To be more precise we are trying to send a message to exchange 
null with routing key &quot;to-process&quot;.

And then queue &quot;to-process&quot; vanished unexpectedly. In logs of RabbitMQ 
we found error.

Due this we have some questions:
     - Why did that happen? Is something wrong with what we are doing?
     - Why queue terminated? In my opinion this should never happen 
(even if the message we sent back was broken, I mean isn't that a 
security issue?).
     - What did happened to the messages that was in &quot;to-process&quot; queue? 
Is there any way to find and restore them?
     - Does terminating a (durable) queue can result in messages lossing?

Thank you in advance for the time spent on my problem.

Best regards,
Ernest Staszuk


</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023195.html">[rabbitmq-discuss] RabbbitMQ and Biztalk Port
</A></li>
	<LI>Next message: <A HREF="022994.html">[rabbitmq-discuss] How to change TTL after declared queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23314">[ date ]</a>
              <a href="thread.html#23314">[ thread ]</a>
              <a href="subject.html#23314">[ subject ]</a>
              <a href="author.html#23314">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
