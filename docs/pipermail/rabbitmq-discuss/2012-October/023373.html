<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Batching messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Batching%20messages&In-Reply-To=%3C5EDBAA62-2A69-4BB6-AD1B-528306BD6DAC%40kvrgic.se%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023332.html">
   <LINK REL="Next"  HREF="023336.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Batching messages</H1>
    <B>Srdan Kvrgic</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Batching%20messages&In-Reply-To=%3C5EDBAA62-2A69-4BB6-AD1B-528306BD6DAC%40kvrgic.se%3E"
       TITLE="[rabbitmq-discuss] Batching messages">srdan at kvrgic.se
       </A><BR>
    <I>Fri Oct 26 10:13:03 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023332.html">[rabbitmq-discuss] Batching messages
</A></li>
        <LI>Next message: <A HREF="023336.html">[rabbitmq-discuss] RabbitMQ, push a script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23373">[ date ]</a>
              <a href="thread.html#23373">[ thread ]</a>
              <a href="subject.html#23373">[ subject ]</a>
              <a href="author.html#23373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Oct 25, 2012, at 12:06 , Emile Joubert wrote:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> On 25/10/12 06:33, Srdan Kvrgic wrote:
</I>&gt;&gt;<i> You think?
</I>&gt;<i> 
</I>&gt;<i> There may be other ways of achieving higher throughput that you should
</I>&gt;<i> explore first before investing in more complex solutions. A potential
</I>&gt;<i> improvement would be to use auto-ack or to acknowledge messages in
</I>&gt;<i> batches. And not to use persistence unless necessary. I assume you have
</I>&gt;<i> exhausted other options.
</I>
Auto-acking isn't really an option in production for us, but we do already only ack every 50th message or

&gt;<i> Do you get any throughput improvement if you turn off Nagle's algorithm?
</I>&gt;<i> Both publishing and consuming can be asynchronous when using RabbitMQ.
</I>&gt;<i> If that were not the case then the throughput due to batching would be
</I>&gt;<i> more dramatic. I suspect you will see some improvement due to network
</I>&gt;<i> batching when turning off Nagle's algorithm.
</I>
Interesting. I'd never heard of it. Must try it out.

&gt;<i> If the above don't give acceptable gains and you really need batching of
</I>&gt;<i> messages then this can be implemented in a library that sits between
</I>&gt;<i> your application and the broker. Such a library would be in the best
</I>&gt;<i> position to judge the throughput/latency trade-off and limit the batches
</I>&gt;<i> based on size or latency constraints. It should be able to pack messages
</I>&gt;<i> on the publishing side and unpack on the consuming side.
</I>&gt;<i> 
</I>&gt;<i> A possible approach that a library might take to rejecting an individual
</I>&gt;<i> message would be to acknowledge the aggregate batch message and to
</I>&gt;<i> re-publish the rejected message with a suitable header. Message ordering
</I>&gt;<i> will be lost, but this might be a close enough approximation to
</I>&gt;<i> rejecting an individual message in many cases.
</I>
That's funny because this is what we've found ourselves building. And it's working. Pretty good. The problem is, every once in a while we'll end up changing the format of a particular message, or have it come string-encoded in a different way. A server might then well parse the message, discover it can't make any sense of it and try to repost it in the screwed up way it parsed it first which leaves the message being constantly requeued.

All this is not really a problem for us. This is not a cry for help or anything dramatic like that. We've got a bunch of libraries in place that give us all the functionality we need. I just thought this feature could be useful for new rabbitmq users allowing them easier batching without laying down weeks of work and a world of gotchas. =)

Kind Regards,
Srdan

</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023332.html">[rabbitmq-discuss] Batching messages
</A></li>
	<LI>Next message: <A HREF="023336.html">[rabbitmq-discuss] RabbitMQ, push a script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23373">[ date ]</a>
              <a href="thread.html#23373">[ thread ]</a>
              <a href="subject.html#23373">[ subject ]</a>
              <a href="author.html#23373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
