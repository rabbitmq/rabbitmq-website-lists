<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Batching messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Batching%20messages&In-Reply-To=%3CCACOPnvfrMqXj-5vX3KKOq1YE88qK64m-ssETJ%3DeVFJbErdq0oQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023375.html">
   <LINK REL="Next"  HREF="023379.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Batching messages</H1>
    <B>Alexis Richardson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Batching%20messages&In-Reply-To=%3CCACOPnvfrMqXj-5vX3KKOq1YE88qK64m-ssETJ%3DeVFJbErdq0oQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Batching messages">alexis at rabbitmq.com
       </A><BR>
    <I>Fri Oct 26 11:23:05 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023375.html">[rabbitmq-discuss] Batching messages
</A></li>
        <LI>Next message: <A HREF="023379.html">[rabbitmq-discuss] Batching messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23376">[ date ]</a>
              <a href="thread.html#23376">[ thread ]</a>
              <a href="subject.html#23376">[ subject ]</a>
              <a href="author.html#23376">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>ISTM that basic.publish could be extended to accept a set of messages
as the payload parameter in lieu of a single message.  Then all
metadata would be the same for all messages in a batch.  In particular
all routing would be the same.  This would improve throughput
especially when the disk is involved.  Once in the queue, messages
would appear as individual data and could be confirmed, consumed, etc,
out-of-batch, but still in-order.



On Fri, Oct 26, 2012 at 11:14 AM, Srdan Kvrgic &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srdan at burtcorp.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On Oct 25, 2012, at 11:54 , Tim Watson wrote:
</I>&gt;<i>
</I>&gt;<i> Hi
</I>&gt;<i>
</I>&gt;<i> On 10/25/2012 06:33 AM, Srdan Kvrgic wrote:
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Short story:
</I>&gt;<i>
</I>&gt;<i> Are there any plans to support batching of messages within the rabbitmq
</I>&gt;<i> eco-system?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Long story:
</I>&gt;<i>
</I>&gt;<i> [snip]
</I>&gt;<i>
</I>&gt;<i> Optimally you would want a system that sends and receives batches of
</I>&gt;<i> messages but allows you to reject single messages. Have your cake and eat
</I>&gt;<i> it, as it were...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Sounds good, but...
</I>&gt;<i>
</I>&gt;<i> AMQP already provides batching delivery capabilities and these have been
</I>&gt;<i> discussed previously, for example
</I>&gt;<i> <A HREF="https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/CidFKmJrBFI.">https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/CidFKmJrBFI.</A>
</I>&gt;<i> But what you seem to be running up against is the fact that your many small
</I>&gt;<i> messages limit throughput, so you want to bundle them up. I would suggest
</I>&gt;<i> putting a processor between the publisher and consumer which unpacks the
</I>&gt;<i> batches and forwards individual messages to the target exchange. This could
</I>&gt;<i> be achieved by writing a custom exchange type, configured to understand how
</I>&gt;<i> to 'unpack' the batch and where to route the forwarded messages to. The
</I>&gt;<i> consumers would then receive these individual messages (possibly in
</I>&gt;<i> batches!) and could reject some or all of them, but that rejection would not
</I>&gt;<i> be apparent to the outside world in any way! So you'd need to then change
</I>&gt;<i> your design somewhat, perhaps by putting 'failed' messages onto a different
</I>&gt;<i> 'error queue' *or* by rejecting them and setting up a TTL and Dead Letter
</I>&gt;<i> eXchange on the destination queue so that you can identify failures
</I>&gt;<i> transparently. In either case, you'd want to add some kind of x-batch-id
</I>&gt;<i> header to the 'broken up' messages so that your reprocessing procedure is
</I>&gt;<i> able to identify the source batch from which they came.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Are you talking about writing an extension to rabbit-mq as such? I'm not
</I>&gt;<i> sure I follow your solution. Or rather, it doesn't seem like something it's
</I>&gt;<i> very easy or practical. =)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Doing this 'in the broker' doesn't really make sense to me. How would
</I>&gt;<i> transactions and/or confirms continue to work, for example?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Actually the consumer parts seems to be to be already working like this..
</I>&gt;<i> You already get prefetches and what not, I don't see why those shouldn't be
</I>&gt;<i> delivered in a single data transfer. Perhaps they already are?
</I>&gt;<i>
</I>&gt;<i> The publisher side of this on the other hand doesn't do this by default.
</I>&gt;<i> I'll have to try disabling Nagle's algorithm to see if that gives use the
</I>&gt;<i> wings..
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Also automatic de-/compression in the driver. That also was a great
</I>&gt;<i> performance boost when the batches started getting big. Lzf ftw!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hmn, that's an interesting one! Which client library are you using?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Running jruby we use java libraries for anything performance critical. Like
</I>&gt;<i> com.ning.compress.lzf.LZFEncoder for compressions. Unless you're talking
</I>&gt;<i> about the entire library for tracking, batching, routing and compressing. In
</I>&gt;<i> that case we use autobahn <A HREF="https://github.com/burtcorp/autobahn/">https://github.com/burtcorp/autobahn/</A>
</I>&gt;<i>
</I>&gt;<i> //S
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I></PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023375.html">[rabbitmq-discuss] Batching messages
</A></li>
	<LI>Next message: <A HREF="023379.html">[rabbitmq-discuss] Batching messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23376">[ date ]</a>
              <a href="thread.html#23376">[ thread ]</a>
              <a href="subject.html#23376">[ subject ]</a>
              <a href="author.html#23376">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
