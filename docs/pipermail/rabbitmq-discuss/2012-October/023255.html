<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Channel thread-safety
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Channel%20thread-safety&In-Reply-To=%3CCAE3HoVTr6esOVC4A6PkKBiZm__PO5%3DuB-7Hj%3DoXyKN_5eDtdbg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023253.html">
   <LINK REL="Next"  HREF="023263.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Channel thread-safety</H1>
    <B>Michael Klishin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Channel%20thread-safety&In-Reply-To=%3CCAE3HoVTr6esOVC4A6PkKBiZm__PO5%3DuB-7Hj%3DoXyKN_5eDtdbg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Channel thread-safety">michael.s.klishin at gmail.com
       </A><BR>
    <I>Mon Oct 22 20:46:23 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023253.html">[rabbitmq-discuss] Channel thread-safety
</A></li>
        <LI>Next message: <A HREF="023263.html">[rabbitmq-discuss] Channel thread-safety
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23255">[ date ]</a>
              <a href="thread.html#23255">[ thread ]</a>
              <a href="subject.html#23255">[ subject ]</a>
              <a href="author.html#23255">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2012/10/22 Laurent Vauthrin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">lvauthrin at gmail.com</A>&gt;

&gt;<i> My questions are:
</I>&gt;<i> 1. Should we be using a channel per thread considering that we're
</I>&gt;<i> synchronizing the basicPublish call anyway?
</I>&gt;<i>
</I>
Yes. Channels are just integer on the wire and a little bit of memory
allocated on the JVM heap. They are very cheap
for all intents and purposes and you are much more likely to max out your
OS and hardware resources (assuming 1 channel per JVM thread) before
you run into issues with channel objects.


&gt;<i> 2. Can we just share one channel across all threads and not synchronize
</I>&gt;<i> the call to basicPublish?
</I>&gt;<i>
</I>

No. The real issue with shared channels is that large messages will result
in multiple protocol frames being sent
for a single basicPublish operation. When publishing on the same channel
from multiple threads, this may result
in frames being delivered out of order:

T1 =&gt; basicPublish =&gt; [Frame11] [Frame12] [Frame13]
T2 =&gt; basicPublish =&gt; [Frame21] [Frame22] [Frame23]

may result in the following delivery order, all on the same channel:

[Frame11][Frame21][Frame12][Frame13][Frame22][Frame23]

and because all frames are on the same channel, RabbitMQ won't be able to
tell how to reconstruct your messages.
-- 
MK

<A HREF="http://github.com/michaelklishin">http://github.com/michaelklishin</A>
<A HREF="http://twitter.com/michaelklishin">http://twitter.com/michaelklishin</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/9625fb67/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/9625fb67/attachment.htm</A>&gt;
</PRE>












































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023253.html">[rabbitmq-discuss] Channel thread-safety
</A></li>
	<LI>Next message: <A HREF="023263.html">[rabbitmq-discuss] Channel thread-safety
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23255">[ date ]</a>
              <a href="thread.html#23255">[ thread ]</a>
              <a href="subject.html#23255">[ subject ]</a>
              <a href="author.html#23255">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
