<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] do we need to delete data folder during rpm upgrades?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20do%20we%20need%20to%20delete%20data%20folder%20during%20rpm%0A%20upgrades%3F&In-Reply-To=%3C5072AEA7.1050909%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022874.html">
   <LINK REL="Next"  HREF="022854.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] do we need to delete data folder during rpm upgrades?</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20do%20we%20need%20to%20delete%20data%20folder%20during%20rpm%0A%20upgrades%3F&In-Reply-To=%3C5072AEA7.1050909%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] do we need to delete data folder during rpm upgrades?">simon at rabbitmq.com
       </A><BR>
    <I>Mon Oct  8 11:44:55 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022874.html">[rabbitmq-discuss] do we need to delete data folder during rpm	upgrades?
</A></li>
        <LI>Next message: <A HREF="022854.html">[rabbitmq-discuss] Re-subscribing to a queue in a cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22891">[ date ]</a>
              <a href="thread.html#22891">[ thread ]</a>
              <a href="subject.html#22891">[ subject ]</a>
              <a href="author.html#22891">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Are you starting all nodes (near) simultaneously post upgrade?

During cluster upgrade we get the first node to start to do the mnesia 
upgrade, others then don't do that part. I think the error you are 
seeing is consistent with there being two &quot;first&quot; nodes in the upgrade.

In future we might be able to add better locking around this, although 
for various reasons it's not as easy as it sounds.

Cheers, Simon

On 05/10/2012 6:52PM, Nithya Vijayakumar wrote:
&gt;<i> Thanks Simon. After the rpm upgrade, when we try to start the nodes and
</I>&gt;<i> they error out. We also tried killall -u rabbitmq before restart. Issue
</I>&gt;<i> doesn't happen always, only once in a while.
</I>&gt;<i>
</I>&gt;<i>         {merge_schema_failed,
</I>&gt;<i>
</I>&gt;<i>                 &quot;Bad cookie in table definition rabbit_topic_trie_node:...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> After we delete the data folder, rabbitmq starts fine. We would prefer
</I>&gt;<i> not to delete the data folder as we need to copy out the queues and
</I>&gt;<i> users and restore them.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Nithya
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, Oct 5, 2012 at 2:35 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     On 04/10/12 23:28, Nithya Vijayakumar wrote:
</I>&gt;<i>
</I>&gt;<i>         We recently upgraded from 2.7.1 to 2.8.6. After the rpm upgrade,
</I>&gt;<i>         in some
</I>&gt;<i>         instances we notice that our two node HA setup doesn't start
</I>&gt;<i>         until the
</I>&gt;<i>         data folder is deleted. Is this required for upgrades? Is there any
</I>&gt;<i>         format/schema change that might be needing this?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>     There are schema changes, but RabbitMQ should take care of them for
</I>&gt;<i>     you automatically. What are you seeing when it doesn't start?
</I>&gt;<i>
</I>&gt;<i>     Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>     --
</I>&gt;<i>     Simon MacMullen
</I>&gt;<i>     RabbitMQ, VMware
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022874.html">[rabbitmq-discuss] do we need to delete data folder during rpm	upgrades?
</A></li>
	<LI>Next message: <A HREF="022854.html">[rabbitmq-discuss] Re-subscribing to a queue in a cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22891">[ date ]</a>
              <a href="thread.html#22891">[ thread ]</a>
              <a href="subject.html#22891">[ subject ]</a>
              <a href="author.html#22891">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
