<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Driver connecting to multiple instances in a	cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Driver%20connecting%20to%20multiple%20instances%20in%20a%0A%09cluster&In-Reply-To=%3CCAE0Sz%3DwwE6gu4dbmCRCi_PsDyfPeoCFCOP9_gLoabGSmELgSmw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022959.html">
   <LINK REL="Next"  HREF="022980.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Driver connecting to multiple instances in a	cluster</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Driver%20connecting%20to%20multiple%20instances%20in%20a%0A%09cluster&In-Reply-To=%3CCAE0Sz%3DwwE6gu4dbmCRCi_PsDyfPeoCFCOP9_gLoabGSmELgSmw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Driver connecting to multiple instances in a	cluster">jerryk at rbcon.com
       </A><BR>
    <I>Wed Oct 10 21:54:10 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022959.html">[rabbitmq-discuss] Driver connecting to multiple instances in a	cluster
</A></li>
        <LI>Next message: <A HREF="022980.html">[rabbitmq-discuss] Driver connecting to multiple instances in a	cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22960">[ date ]</a>
              <a href="thread.html#22960">[ thread ]</a>
              <a href="subject.html#22960">[ subject ]</a>
              <a href="author.html#22960">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Srdan:

Out of curiosity, what sort of benchmarked throughput improvement did you
experience connecting directly to the cluster node on which the destination
queue lived?

Best regards,
Jerry

On Wed, Oct 10, 2012 at 11:40 AM, Srdan Kvrgic &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srdan at burtcorp.com</A>&gt; wrote:

&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> The itch:
</I>&gt;<i> The rabbitmq driver connects and sends message to only one of the rabbitmq
</I>&gt;<i> instances in a cluster limiting performance at high speeds due to
</I>&gt;<i> inter-instance message forwarding.
</I>&gt;<i>
</I>&gt;<i> The background:
</I>&gt;<i> We've been using rabbitmq for a long time now and with the 2.8 release
</I>&gt;<i> it's become cemented as an integral part of our system. It's great. The
</I>&gt;<i> thing is, we send a lot of messages through the system - thousands a
</I>&gt;<i> second. And we use multiple queues over a cluster of rabbitmq servers. The
</I>&gt;<i> problem with that is that the driver will only connect to one of the
</I>&gt;<i> rabbitmq instances and rely on the cluster to forward messages to queues
</I>&gt;<i> hosted on the other instance.
</I>&gt;<i>
</I>&gt;<i> Let me put it to you this way. Assume we have a cluster (MQ1, MQ2) with
</I>&gt;<i> two queues (fragments1, fragments2) under same exchange. The client
</I>&gt;<i> connects to MQ1.
</I>&gt;<i>
</I>&gt;<i> If the client wants to send a message to fragments 1, the message will be
</I>&gt;<i> sent by client and received and routed by MQ1.
</I>&gt;<i>
</I>&gt;<i> On the other hand, if the client wants to post a message on fragments2,
</I>&gt;<i> MQ1 will have to forward the message to MQ2 which means the message will be
</I>&gt;<i> sent from client, received by MQ1, sent by MQ1 and received and routed by
</I>&gt;<i> MQ2.
</I>&gt;<i>
</I>&gt;<i> This is a neat solution but when running at high speed it becomes a
</I>&gt;<i> bottleneck. So, we created autobahn which is a jruby transport layer
</I>&gt;<i> wrapper that automatically connects to all MQ instances and sends the
</I>&gt;<i> message to the server that hosts the queue. That gave us a massive boost in
</I>&gt;<i> throughput. Yey us.
</I>&gt;<i>
</I>&gt;<i> So why am I on the figurative soap-box? The problem's solved, right? Why
</I>&gt;<i> am I not on a beach under an umbrella wearing a stupid-ass hat and sipping
</I>&gt;<i> on a Bahama-mama? Well.. The throughput improvement was so substantial that
</I>&gt;<i> I couldn't help feeling this should be the driver's default behavior.
</I>&gt;<i>
</I>&gt;<i> Right?
</I>&gt;<i>
</I>&gt;<i> Is anything like this planned? Are we the only ones who've encountered
</I>&gt;<i> this? It wasn't very tricky to implement really..
</I>&gt;<i>
</I>&gt;<i> Kind regards,
</I>&gt;<i> Srdan
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Srdan Urban Kvrgic
</I>&gt;<i> LABS, Burt
</I>&gt;<i>
</I>&gt;<i> www.burtcorp.com
</I>&gt;<i> <A HREF="http://twitter.com/srdan">http://twitter.com/srdan</A> | <A HREF="http://twitter.com/burtcorp">http://twitter.com/burtcorp</A>
</I>&gt;<i> &#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;&#8211;
</I>&gt;<i> The Analytics Platform for Online Media
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/e8dc1606/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/e8dc1606/attachment.htm</A>&gt;
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022959.html">[rabbitmq-discuss] Driver connecting to multiple instances in a	cluster
</A></li>
	<LI>Next message: <A HREF="022980.html">[rabbitmq-discuss] Driver connecting to multiple instances in a	cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22960">[ date ]</a>
              <a href="thread.html#22960">[ thread ]</a>
              <a href="subject.html#22960">[ subject ]</a>
              <a href="author.html#22960">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
