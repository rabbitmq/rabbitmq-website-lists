<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Driver connecting to multiple instances in a cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Driver%20connecting%20to%20multiple%20instances%20in%20a%0A%20cluster&In-Reply-To=%3C50766BE2.9030109%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022981.html">
   <LINK REL="Next"  HREF="022962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Driver connecting to multiple instances in a cluster</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Driver%20connecting%20to%20multiple%20instances%20in%20a%0A%20cluster&In-Reply-To=%3C50766BE2.9030109%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Driver connecting to multiple instances in a cluster">matthias at rabbitmq.com
       </A><BR>
    <I>Thu Oct 11 07:49:06 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022981.html">[rabbitmq-discuss] Driver connecting to multiple instances in a	cluster
</A></li>
        <LI>Next message: <A HREF="022962.html">[rabbitmq-discuss] Perfomance Calculations?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22967">[ date ]</a>
              <a href="thread.html#22967">[ thread ]</a>
              <a href="subject.html#22967">[ subject ]</a>
              <a href="author.html#22967">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Srdan,

On 10/10/12 19:40, Srdan Kvrgic wrote:
&gt;<i> Let me put it to you this way. Assume we have a cluster (MQ1, MQ2)
</I>&gt;<i> with two queues (fragments1, fragments2) under same exchange. The
</I>&gt;<i> client connects to MQ1.
</I>&gt;<i>
</I>&gt;<i> If the client wants to send a message to fragments 1, the message
</I>&gt;<i> will be sent by client and received and routed by MQ1.
</I>&gt;<i>
</I>&gt;<i> On the other hand, if the client wants to post a message on
</I>&gt;<i> fragments2, MQ1 will have to forward the message to MQ2 which means
</I>&gt;<i> the message will be sent from client, received by MQ1, sent by MQ1
</I>&gt;<i> and received and routed by MQ2.
</I>
...and if the consumer(s) for MQ2 are connected to MQ1 then there is a 
second hop to traverse.

And yes, this is fairly expensive.

&gt;<i> This is a neat solution but when running at high speed it becomes a
</I>&gt;<i> bottleneck. So, we created autobahn which is a jruby transport layer
</I>&gt;<i> wrapper that automatically connects to all MQ instances and sends the
</I>&gt;<i> message to the server that hosts the queue. That gave us a massive
</I>&gt;<i> boost in throughput. Yey us.
</I>&gt;<i>
</I>&gt;<i> So why am I on the figurative soap-box? The problem's solved, right?
</I>&gt;<i> Why am I not on a beach under an umbrella wearing a stupid-ass hat
</I>&gt;<i> and sipping on a Bahama-mama? Well.. The throughput improvement was
</I>&gt;<i> so substantial that I couldn't help feeling this should be the
</I>&gt;<i> driver's default behavior.
</I>
Unfortunately that is impossible in the general case:

1) In AMQP a single published message can get routed to multiple queues. 
Indeed that is typical for pub-sub type applications. If those queues 
reside on different nodes then there is no 'right' node to publish to.

2) AMQP is a connection-oriented protocol, and the notion of sessions, 
manifested in AMQP's concept of channels, is important. For example, 
ordering guarantees, transactions/confirms, qos prefetching and error 
handling are all scoped to channels. So performing operations across 
multiple connections has different behaviour than when doing so across a 
single connection. This may not matter to some applications, but in 
general it does.

3) There is no way for a client to find out which node a queue resides 
on, other than going via the management interface, which is not 
something you'd want to happen in a plain AMQP client.

4) A mirrored queue's master node of queue can change during its 
lifetime due to failover events.


Regards,

Matthias.
</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022981.html">[rabbitmq-discuss] Driver connecting to multiple instances in a	cluster
</A></li>
	<LI>Next message: <A HREF="022962.html">[rabbitmq-discuss] Perfomance Calculations?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22967">[ date ]</a>
              <a href="thread.html#22967">[ thread ]</a>
              <a href="subject.html#22967">[ subject ]</a>
              <a href="author.html#22967">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
