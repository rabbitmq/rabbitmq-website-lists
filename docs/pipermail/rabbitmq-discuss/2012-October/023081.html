<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2 (Windows)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20RabbitMQ%20HA%20cluster%20on%20EC2%20%28Windows%29&In-Reply-To=%3C08bd01cdab9c%243d2671f0%24b77355d0%24%40psonar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023083.html">
   <LINK REL="Next"  HREF="023086.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2 (Windows)</H1>
    <B>Richard Urwin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20RabbitMQ%20HA%20cluster%20on%20EC2%20%28Windows%29&In-Reply-To=%3C08bd01cdab9c%243d2671f0%24b77355d0%24%40psonar.com%3E"
       TITLE="[rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2 (Windows)">richard at psonar.com
       </A><BR>
    <I>Tue Oct 16 13:46:18 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="023083.html">[rabbitmq-discuss] &quot;service rabbitmq-server start&quot; hangs when using python's Popen from subprocess.
</A></li>
        <LI>Next message: <A HREF="023086.html">[rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2	(Windows)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23081">[ date ]</a>
              <a href="thread.html#23081">[ thread ]</a>
              <a href="subject.html#23081">[ subject ]</a>
              <a href="author.html#23081">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everyone,

 

I&#8217;m having problems clustering RabbitMQ on EC2 in Windows.

 

Apologies for the length of this post, but I thought it best to include all my steps:

a)      to help with diagnosis

b)      for anyone else who wants to set up a Windows RabbitMQ HA cluster on EC2 (if we manage to resolve the issue!)

 

Here&#8217;s what I&#8217;ve done so far:

 

1)      Started 2x EC2 Windows Server 2008 RC2 instances in a &#8216;Rabbit&#8217; security group

 

2)      On each EC2 instance:

-          Installed Erlang R15B02 Windows 64 Bit Binary File with MSVCR100

-          installed RabbitMQ v2.8.7

-          installed the management plugin

-          reinstalled the service to enable the plugin: <A HREF="http://www.rabbitmq.com/plugins.html#windows-restart">http://www.rabbitmq.com/plugins.html#windows-restart</A>

 

-          opened up Windows Firewall port 4369 (for Erlang Epmd)

-          opened up Windows Firewall port 5672 (the node port)

-          opened up Windows Firewall port range 55700-55800 (for erlang node kernel communication)

-          opened up Windows Firewall port 55672 (for the management website, not strictly necessary)

 

-          copied an identical &#8216;.erlang.cookie&#8217; file to:

o   C:\Windows

o   C:\Users\Administrator

 

-          Created &#8216;rabbit.config&#8217;:

o   Located in C:\Users\Administrator\AppData\Roaming\RabbitMQ&#8217;

o   with contents: [{kernel, [{inet_dist_listen_min, 55700}, {inet_dist_listen_max, 55800}]}].

 

3)      In the &#8216;Rabbit&#8217; security group:

-          opened up ports 4369, 5672, 55672, 55700-55800

 

NOTE: I initially had problems installing on one instance, creating an AMI from the installation and starting up another instance from that AMI &#8211; &#8216;rabbitmqctl status&#8217; always indicated the node wasn&#8217;t running, so I uninstalled RabbitMQ then reinstalled it and this worked. My guess would be it&#8217;s something related to the computer name, but I&#8217;m not sure what, since the database should have been recreated with the new instance name (if indeed it did change) when it started up. I can&#8217;t think of anything else that would cause this (any suggestions?)

 

4)      Followed the clustering instructions: <A HREF="http://www.rabbitmq.com/clustering.html.">http://www.rabbitmq.com/clustering.html.</A>

 

The problem is when attempting to cluster. Running the command:

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin&gt;rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ec2-XX-XX-XX-XX.compute-1.amazonaws.com</A>

 

I get the result:

 

Clustering node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at IP-0XXXXXXX</A>' with ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ec2-</A> XX-XX-XX-XX.compute-1.amazonaws.com'] ...

Error: {no_running_cluster_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ec2-</A> XX-XX-XX-XX.compute-1.amazonaws.com'], ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ec2-</A> XX-XX-XX-XX.compute-1.amazonaws.com']}

 

I think this is because I&#8217;m attempting to use the EC2 Public DNS.

 

I then added mappings to my hosts file, to map to my two instances:

 

10.XXX.XX.XX     rabbit01               # Public DNS: ec2-XX-XX-XX-XX.compute-1.amazonaws.com

10.XXX.XX.XX     rabbit02               # Public DNS: ec2-XX-XX-XX-XX.compute-1.amazonaws.com

 

Running the command (with different hostname):

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin&gt;rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ec2-XX-XX-XX-XX.compute-1.amazonaws.com</A>&gt; 

 

I get the same result:

 

Clustering node 'rabbit@ IP-0AAXXXXX&#8217; with [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A>] ...

Error: {no_running_cluster_nodes,[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A>],[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit02</A>]}

 

I know this mapping can be used to access the other Windows computer, because I can use it to access the management console in a web browser:

 

<A HREF="http://rabbit02:55672/#/">http://rabbit02:55672/#/</A>

 

I then tried to change the computer name from IP-0AAXXXXX to rabbit01 (in case this was a problem) but upon reboot, it hadn&#8217;t changed. 

 

Does anyone have any suggestions?

 

Thanks,

Rich

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/31a17364/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/31a17364/attachment.htm</A>&gt;
</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023083.html">[rabbitmq-discuss] &quot;service rabbitmq-server start&quot; hangs when using python's Popen from subprocess.
</A></li>
	<LI>Next message: <A HREF="023086.html">[rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2	(Windows)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23081">[ date ]</a>
              <a href="thread.html#23081">[ thread ]</a>
              <a href="subject.html#23081">[ subject ]</a>
              <a href="author.html#23081">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
