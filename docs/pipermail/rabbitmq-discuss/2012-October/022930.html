<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbit won't restart - no next heap size	found
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20won%27t%20restart%20-%20no%20next%20heap%20size%0A%09found&In-Reply-To=%3C50746D28.9010203%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022951.html">
   <LINK REL="Next"  HREF="022931.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbit won't restart - no next heap size	found</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20won%27t%20restart%20-%20no%20next%20heap%20size%0A%09found&In-Reply-To=%3C50746D28.9010203%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Rabbit won't restart - no next heap size	found">matthias at rabbitmq.com
       </A><BR>
    <I>Tue Oct  9 19:30:00 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="022951.html">[rabbitmq-discuss] Querying broker info like rabbitmqctl does?
</A></li>
        <LI>Next message: <A HREF="022931.html">[rabbitmq-discuss] Rabbit won't restart - no next heap size	found
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22930">[ date ]</a>
              <a href="thread.html#22930">[ thread ]</a>
              <a href="subject.html#22930">[ subject ]</a>
              <a href="author.html#22930">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Mike,

did you make any progress on this?

We have since discovered that rabbit can use lot of memory on recovery 
from an unclean shutdown, so this may well be the problem you are 
running into. We'll fix that in an upcoming release, but meanwhile the 
suggestions below should get you going.

Matthias.
On 29/09/12 08:41, Matthias Radestock wrote:
&gt;<i> Mike,
</I>&gt;<i>
</I>&gt;<i> On 28/09/12 22:06, Mike Khristo wrote:
</I>&gt;&gt;<i> Added a 200G swap... it used some of it, but still seg faults at
</I>&gt;&gt;<i> startup.
</I>&gt;<i>
</I>&gt;<i> Did it fail with the same error, i.e. &quot;eheap_alloc: Cannot allocate ....
</I>&gt;<i> bytes of memory&quot;? That would be kinda surprising.
</I>&gt;<i>
</I>&gt;<i> Is there anything in the log files?
</I>&gt;<i>
</I>&gt;<i> There are scenarios in which an error can trigger the writing of an
</I>&gt;<i> enormous log message, and it's the latter that is exhausting memory. If
</I>&gt;<i> so, the log should contain the error.
</I>&gt;<i>
</I>&gt;&gt;<i> Is there any way to split up the data on disk so I can get 2 rabbits
</I>&gt;&gt;<i> up with half the data each?
</I>&gt;<i>
</I>&gt;<i> Hmm. The following should work:
</I>&gt;<i>
</I>&gt;<i> 1) make a backup of the rabbit database dir
</I>&gt;<i>
</I>&gt;<i> 2) cd into the database dir and remove the &quot;clean shutdown&quot; markers with
</I>&gt;<i>     rm -f `find . -name &quot;clean.dot&quot;`
</I>&gt;<i> If rabbit was shut down cleanly there should be one of these per queue
</I>&gt;<i> plus one each in the msg_store_persistent and msg_store_transient dirs.
</I>&gt;<i> If rabbit wasn't shut down cleanly and those files aren't present then
</I>&gt;<i> not to worry.
</I>&gt;<i>
</I>&gt;<i> 3) in the msg_store_persistent dir remove half the *.rdq files
</I>&gt;<i>
</I>&gt;<i> 4) start rabbit
</I>&gt;<i>
</I>&gt;<i> Then process all the messages in that rabbit, stop it, restore the
</I>&gt;<i> backup and repeat the above but this time removing the other half of the
</I>&gt;<i> *.rdq files.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022951.html">[rabbitmq-discuss] Querying broker info like rabbitmqctl does?
</A></li>
	<LI>Next message: <A HREF="022931.html">[rabbitmq-discuss] Rabbit won't restart - no next heap size	found
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22930">[ date ]</a>
              <a href="thread.html#22930">[ thread ]</a>
              <a href="subject.html#22930">[ subject ]</a>
              <a href="author.html#22930">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
