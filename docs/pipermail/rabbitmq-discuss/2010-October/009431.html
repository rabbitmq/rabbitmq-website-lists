<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How to ensure the message delivery using	shared queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20ensure%20the%20message%20delivery%20using%0A%09shared%20queues&In-Reply-To=%3C4A14EF4C-9C4B-4645-B5CC-F44F32020B08%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009373.html">
   <LINK REL="Next"  HREF="009374.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How to ensure the message delivery using	shared queues</H1>
    <B>Rob Harrop</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20ensure%20the%20message%20delivery%20using%0A%09shared%20queues&In-Reply-To=%3C4A14EF4C-9C4B-4645-B5CC-F44F32020B08%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] How to ensure the message delivery using	shared queues">rob at rabbitmq.com
       </A><BR>
    <I>Thu Oct 14 15:19:41 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009373.html">[rabbitmq-discuss] How to ensure the message delivery using shared queues
</A></li>
        <LI>Next message: <A HREF="009374.html">[rabbitmq-discuss] Guaranteed delivery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9431">[ date ]</a>
              <a href="thread.html#9431">[ thread ]</a>
              <a href="subject.html#9431">[ subject ]</a>
              <a href="author.html#9431">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

For your queue setup you should make sure that you are creating a durable queue. If the queue is not durable it will just disappear when the server is restarted.

On the publish side, you want to make sure that you set delivery mode to 2 (persistent). By default, delivery mode is set to 1 (transient). In Java this looks like:

	AMQP.BasicProperties props = new AMQP.BasicProperties();
	props.setDeliveryMode(2);

	channel.basicPublish(&quot;amq.direct&quot;, &quot;test&quot;, props, &quot;test&quot;.getBytes());

You might want to do your publish transactionally to be certain that the messages have been written to disk. Once you get back tx.commit_ok you can be sure that persistent messages published in that transaction are written to disk.

On the consume side, you can work with noAck=false and only acknowledge the messages when they are successfully processed. 

If a Channel closes without acknowledging a message that has been delivered to it for a given queue, then that message will be redelivered to another consumer on that queue.

I hope this helps. Let me know if you need any more detail.

Rob

On 11 Oct 2010, at 12:13, padl wrote:

&gt;<i> 
</I>&gt;<i> hi
</I>&gt;<i> 
</I>&gt;<i> I am a novice user. I just want to know when we use shared queue how to
</I>&gt;<i> ensure the delivery and durability of message?
</I>&gt;<i> 
</I>&gt;<i> Any help will be appreciable.
</I>&gt;<i> 
</I>&gt;<i> Thank You
</I>&gt;<i> -- 
</I>&gt;<i> View this message in context: <A HREF="http://old.nabble.com/How-to-ensure-the-message-delivery-using-shared-queues-tp29933060p29933060.html">http://old.nabble.com/How-to-ensure-the-message-delivery-using-shared-queues-tp29933060p29933060.html</A>
</I>&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009373.html">[rabbitmq-discuss] How to ensure the message delivery using shared queues
</A></li>
	<LI>Next message: <A HREF="009374.html">[rabbitmq-discuss] Guaranteed delivery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9431">[ date ]</a>
              <a href="thread.html#9431">[ thread ]</a>
              <a href="subject.html#9431">[ subject ]</a>
              <a href="author.html#9431">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
