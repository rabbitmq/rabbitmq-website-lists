<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ clustering and node failure recovery strategies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20clustering%20and%20node%20failure%0A%20recovery%20strategies&In-Reply-To=%3C20101007104702.GB2363%40dakota%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009316.html">
   <LINK REL="Next"  HREF="009306.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ clustering and node failure recovery strategies</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20clustering%20and%20node%20failure%0A%20recovery%20strategies&In-Reply-To=%3C20101007104702.GB2363%40dakota%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ clustering and node failure recovery strategies">alexandru at rabbitmq.com
       </A><BR>
    <I>Thu Oct  7 11:47:02 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009316.html">[rabbitmq-discuss] RabbitMQ clustering and node failure recovery strategies
</A></li>
        <LI>Next message: <A HREF="009306.html">[rabbitmq-discuss] RabbitMQ clustering and node failure recovery strategies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9317">[ date ]</a>
              <a href="thread.html#9317">[ thread ]</a>
              <a href="subject.html#9317">[ subject ]</a>
              <a href="author.html#9317">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> What do you mean by maskerading? Is cloning
</I>&gt;<i> IP/hostname/cookie enough? How about Mnesia?
</I>
IIRC, just clustering a new node with the same nodename as the down node
should be enough.  So, the same hostname and cookie should do it.

If you clone everything, you'll probably end up with a setup similar to
the one in our HA guide.

Really though, deleting queues and immediately declaring them on a
different node doesn't seem right.  You're probably better of using
non-durable queues.

Alex

On Thu, Oct 07, 2010 at 02:58:13AM -0700, Armax wrote:
&gt;<i> 
</I>&gt;<i> That helps, thanks! What do you mean by maskerading? Is cloning
</I>&gt;<i> IP/hostname/cookie enough? How about Mnesia?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Alexandru Scvor&#355;ov wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;&gt; I have been reading the mailing list to gather information about
</I>&gt;<i> &gt;&gt; scalable
</I>&gt;<i> &gt;&gt; and HA configurations for RabbitMQ. From my understanding, I assune
</I>&gt;<i> &gt;&gt; that if
</I>&gt;<i> &gt;&gt; a RabbitMQ node in a cluster fails all the queues and messages on that
</I>&gt;<i> &gt;&gt; node
</I>&gt;<i> &gt;&gt; will be lost until the node is not recovered and any attempt of
</I>&gt;<i> &gt;&gt; re-creating
</I>&gt;<i> &gt;&gt; the queues on another node is forbidden by the cluster implementation.
</I>&gt;<i> &gt;&gt; Is
</I>&gt;<i> &gt;&gt; still the case in the latest RabbitMQ release?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; We're talking about durable queues.  Yes, this is still the case with
</I>&gt;<i> &gt; the latest broker.  You can't recreate the lost queue on a different
</I>&gt;<i> &gt; node
</I>&gt;<i> &gt; because it causes all sorts of problems if the original node comes back
</I>&gt;<i> &gt; up.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;&gt; I was thinking about fail-over strategies and I was wondering if there
</I>&gt;<i> &gt;&gt; is
</I>&gt;<i> &gt;&gt; any way to say to the cluster to forget about the binding
</I>&gt;<i> &gt;&gt; (queue-cluster
</I>&gt;<i> &gt;&gt; node) after the failure. If I did that, then I could re-create the
</I>&gt;<i> &gt;&gt; queue on
</I>&gt;<i> &gt;&gt; another node.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; The only way to remove a queue from a downed node is either to restart
</I>&gt;<i> &gt; the node and remove the queue, or have another node masquerade as that
</I>&gt;<i> &gt; node and remove it.  In the second case, you lose the messages.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If you don't care about losing some messages, you can just use
</I>&gt;<i> &gt; non-durable queues.  This way, when the node goes down, the queue is
</I>&gt;<i> &gt; deleted from the cluster and can be redeclared on any other node.  Of
</I>&gt;<i> &gt; course, whatever messages were on the queue are lost.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Does this help?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Cheers,
</I>&gt;<i> &gt; Alex
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Wed, Oct 06, 2010 at 02:26:57AM -0700, Armax wrote:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Hi,
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; I have been reading the mailing list to gather information about scalable
</I>&gt;<i> &gt;&gt; and HA configurations for RabbitMQ. From my understanding, I assune that
</I>&gt;<i> &gt;&gt; if
</I>&gt;<i> &gt;&gt; a RabbitMQ node in a cluster fails all the queues and messages on that
</I>&gt;<i> &gt;&gt; node
</I>&gt;<i> &gt;&gt; will be lost until the node is not recovered and any attempt of
</I>&gt;<i> &gt;&gt; re-creating
</I>&gt;<i> &gt;&gt; the queues on another node is forbidden by the cluster implementation. Is
</I>&gt;<i> &gt;&gt; still the case in the latest RabbitMQ release?
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; I was thinking about fail-over strategies and I was wondering if there is
</I>&gt;<i> &gt;&gt; any way to say to the cluster to forget about the binding (queue-cluster
</I>&gt;<i> &gt;&gt; node) after the failure. If I did that, then I could re-create the queue
</I>&gt;<i> &gt;&gt; on
</I>&gt;<i> &gt;&gt; another node. 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; If this is not available, is there a specific reason why this is not
</I>&gt;<i> &gt;&gt; possible?
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Many thanks and keep up the good work :)
</I>&gt;<i> &gt;&gt; -- 
</I>&gt;<i> &gt;&gt; View this message in context:
</I>&gt;<i> &gt;&gt; <A HREF="http://old.nabble.com/RabbitMQ-clustering-and-node-failure-recovery-strategies-tp29894938p29894938.html">http://old.nabble.com/RabbitMQ-clustering-and-node-failure-recovery-strategies-tp29894938p29894938.html</A>
</I>&gt;<i> &gt;&gt; Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> View this message in context: <A HREF="http://old.nabble.com/RabbitMQ-clustering-and-node-failure-recovery-strategies-tp29894938p29904767.html">http://old.nabble.com/RabbitMQ-clustering-and-node-failure-recovery-strategies-tp29894938p29904767.html</A>
</I>&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009316.html">[rabbitmq-discuss] RabbitMQ clustering and node failure recovery strategies
</A></li>
	<LI>Next message: <A HREF="009306.html">[rabbitmq-discuss] RabbitMQ clustering and node failure recovery strategies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9317">[ date ]</a>
              <a href="thread.html#9317">[ thread ]</a>
              <a href="subject.html#9317">[ subject ]</a>
              <a href="author.html#9317">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
