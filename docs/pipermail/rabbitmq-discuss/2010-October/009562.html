<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] persistent messages stored where?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20persistent%20messages%20stored%20where%3F&In-Reply-To=%3C20101020211952.GA5796%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009561.html">
   <LINK REL="Next"  HREF="009565.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] persistent messages stored where?</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20persistent%20messages%20stored%20where%3F&In-Reply-To=%3C20101020211952.GA5796%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] persistent messages stored where?">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Oct 20 22:19:53 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009561.html">[rabbitmq-discuss] persistent messages stored where?
</A></li>
        <LI>Next message: <A HREF="009565.html">[rabbitmq-discuss] problem to understand configuration regarding Rabbitmq server in client?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9562">[ date ]</a>
              <a href="thread.html#9562">[ thread ]</a>
              <a href="subject.html#9562">[ subject ]</a>
              <a href="author.html#9562">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Oct 20, 2010 at 02:05:15PM -0700, Steve Haneman wrote:
&gt;<i> I'm looking to find out how much disk space 1,000,000 10k messages take up on disk.  I pushed the messages and then shut down the server.  If I do a &quot;du -sh&quot; in the /var/lib/rabbitmq/mnesia/ directory, is that it?
</I>
Yes. However, I can just do the sums for the best case. Worst case will
be double (due to dead space on disk that's pending GC etc).

Per message, we have about a 200 byte overhead for the erlang data
structure that holds the message. We then have a further 25 bytes
overhead on disk (the on disk format is self-describing).

But then we have further cost per queue (a message can go to several
queues). Per queue, assuming the queue journal is flushed, we'll have 18
bytes per message, assuming the message isn't delivered.

So, if you have 1e6 * 10kB msgs going to one queue, I reckon you'll be
looking at about 1e6 * (10240 + 250) bytes (assuming 1kB == 1024B),
which I make to be about 9.77GB.

But as I say, that's best case. It can be anywhere between that and
double that, depending on what's going on in the system.

Thus for 10kB msgs, we're looking at about a 2.5% inflation on disk.

Does that match what you measure? (You'll find the numbers are a bit
bigger because of other stuff you'll be measuring, including mnesia
databases etc. But the trend should be about the same)

Matthew
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009561.html">[rabbitmq-discuss] persistent messages stored where?
</A></li>
	<LI>Next message: <A HREF="009565.html">[rabbitmq-discuss] problem to understand configuration regarding Rabbitmq server in client?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9562">[ date ]</a>
              <a href="thread.html#9562">[ thread ]</a>
              <a href="subject.html#9562">[ subject ]</a>
              <a href="author.html#9562">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
