<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [Malformed Packet] in wireshark after a	Channel.open frame
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5BMalformed%20Packet%5D%20in%20wireshark%20after%20a%0A%09Channel.open%20frame&In-Reply-To=%3CAANLkTinZDMV_ixHB-OkUkim-WESOsJL5HBhG2VB1Twfo%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009628.html">
   <LINK REL="Next"  HREF="009641.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [Malformed Packet] in wireshark after a	Channel.open frame</H1>
    <B>Bruno Thomas</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5BMalformed%20Packet%5D%20in%20wireshark%20after%20a%0A%09Channel.open%20frame&In-Reply-To=%3CAANLkTinZDMV_ixHB-OkUkim-WESOsJL5HBhG2VB1Twfo%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] [Malformed Packet] in wireshark after a	Channel.open frame">thomasbam at gmail.com
       </A><BR>
    <I>Tue Oct 26 16:41:29 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009628.html">[rabbitmq-discuss] problem with new persiter with 1000	topics/queues
</A></li>
        <LI>Next message: <A HREF="009641.html">[rabbitmq-discuss] [Malformed Packet] in wireshark after a	Channel.open frame
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9640">[ date ]</a>
              <a href="thread.html#9640">[ thread ]</a>
              <a href="subject.html#9640">[ subject ]</a>
              <a href="author.html#9640">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello rabbitmq list,


We try hard to understand what's happening with our integration tests :

When we don't send http request to our application after, say 10 to 15
min, when the first request is occuring, (sending stats messages to
rabbit), the shutdownListener is called with the cause
&quot;java.net.SocketException: Connection reset&quot;.

The shutdownListener is launching a thread that is trying to reconnect
with rabbit (when its cause is not initiated by the application), and
during that time, the messages are put in a queue. When the connection
is reestablished, the messages in the queue are sent. We did this
reconnection thread because we needed to restart the webapps (messages
producers) when the rabbitmq broker was shutdown.

We did tcpdump traces, and when we analysed the frames, we saw that :
- there were not TCP connection resets
- whenever there was Channel.open frame, the next one is tagged as a
malformed packet by wireshark (the Open-Ok)

Is it normal to have these malformed packets ?

Then the connection is reestablished and the messages are sent and
received by consumers.

The problem is that the 2 first basicPublish (before the
shutdownListener is called) are sent without IOException so the
messages are lost. The consumers receive null messages.
Did you see this kind of situation ?

Thank you for your answers.

Bruno Thomas
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009628.html">[rabbitmq-discuss] problem with new persiter with 1000	topics/queues
</A></li>
	<LI>Next message: <A HREF="009641.html">[rabbitmq-discuss] [Malformed Packet] in wireshark after a	Channel.open frame
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9640">[ date ]</a>
              <a href="thread.html#9640">[ thread ]</a>
              <a href="subject.html#9640">[ subject ]</a>
              <a href="author.html#9640">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
