<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Is the &quot;master&quot; node mandatory ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Is%20the%20%22master%22%20node%20mandatory%20%3F&In-Reply-To=%3C4CBE9802.20300%40ubikod.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009515.html">
   <LINK REL="Next"  HREF="009508.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Is the &quot;master&quot; node mandatory ?</H1>
    <B>Vincent Barat</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Is%20the%20%22master%22%20node%20mandatory%20%3F&In-Reply-To=%3C4CBE9802.20300%40ubikod.com%3E"
       TITLE="[rabbitmq-discuss] Is the &quot;master&quot; node mandatory ?">vbarat at ubikod.com
       </A><BR>
    <I>Wed Oct 20 08:19:30 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009515.html">[rabbitmq-discuss] Is the &quot;master&quot; node mandatory ?
</A></li>
        <LI>Next message: <A HREF="009508.html">[rabbitmq-discuss] shutdown_error debugging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9533">[ date ]</a>
              <a href="thread.html#9533">[ thread ]</a>
              <a href="subject.html#9533">[ subject ]</a>
              <a href="author.html#9533">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>  Thank you for this long reply, I was not aware about that.

In our use case, all queues are not persistent. Thus, when a node 
fails, all messages of all queues it handles are lost (since 
messages are not replicated between nodes).
This situation is ok for us (anyway there is nothing we can do to 
prevent this, except to upgrade to RabbitMQ 2.0 with persistent 
queues, something we plan to do, but throughput being our main 
concern, we need to benchmark it first).

For the moment, what we must ensure is not to lose the global list 
of exchanges declared by producers on node failure.
AFAIK, this list is maintained in mnesia. If all nodes fails, 
because they are all RAM nodes, we lose this exchange list. But in 
that case, producers would recreate all exchange at reconnection 
time, whatever the node that is restarted first.

To summarize, the list of exchanges and queues are recreated at 
reconnection time by producers and consumers, thus, the &quot;state&quot; of 
the cluster can be lost. That's why I think we can use RAM node 
only. But maybe the &quot;state&quot; of the cluster is not limited to the 
list of exchanges and queues ?


Le 19/10/10 18:35, Matthew Sackman a &#233;crit :
&gt;<i> On Tue, Oct 19, 2010 at 06:28:47PM +0200, Vincent Barat wrote:
</I>&gt;&gt;<i> My two nodes are RAM nodes actually.
</I>&gt;<i> Ahh. From <A HREF="http://rabbitmq.com/clustering.html:">http://rabbitmq.com/clustering.html:</A>
</I>&gt;<i>
</I>&gt;<i> &quot;Because state is replicated across all nodes in the cluster, it is
</I>&gt;<i> sufficient to have just one disk node within a cluster, to store the
</I>&gt;<i> state of the cluster safely. Beware, however, that RabbitMQ will not
</I>&gt;<i> stop you from creating a cluster with only RAM nodes. Should you do
</I>&gt;<i> this, and suffer a power failure to the entire cluster, the entire state
</I>&gt;<i> of the cluster, including all messages, will be lost.&quot;
</I>&gt;<i>
</I>&gt;<i> I think we used to prevent you from building RAM-node-only clusters. We
</I>&gt;<i> must have changed behaviour there a while ago. It makes sense that the
</I>&gt;<i> last node to die needs to be brought up first: if a node goes down and
</I>&gt;<i> it knew that it was part of a cluster, then when coming back up, it'll
</I>&gt;<i> remember it was part of a cluster and try to reconnect to it - it will
</I>&gt;<i> be very aware that any data it holds (in this case, none!) will likely
</I>&gt;<i> be out of date and it needs to resync from the other nodes in the
</I>&gt;<i> cluster - it'll have no knowledge that the other nodes also went down.
</I>&gt;<i>
</I>&gt;<i> That said, it's been a while since I played around with clusters so my
</I>&gt;<i> information might be out of date.
</I>&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I></PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009515.html">[rabbitmq-discuss] Is the &quot;master&quot; node mandatory ?
</A></li>
	<LI>Next message: <A HREF="009508.html">[rabbitmq-discuss] shutdown_error debugging
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9533">[ date ]</a>
              <a href="thread.html#9533">[ thread ]</a>
              <a href="subject.html#9533">[ subject ]</a>
              <a href="author.html#9533">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
