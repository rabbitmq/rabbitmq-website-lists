<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Simpler STOMP Behaviour
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Simpler%20STOMP%20Behaviour&In-Reply-To=%3CA3C35442-9402-4BE0-8AE8-EAA995279A1F%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009227.html">
   <LINK REL="Next"  HREF="009228.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Simpler STOMP Behaviour</H1>
    <B>Rob Harrop</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Simpler%20STOMP%20Behaviour&In-Reply-To=%3CA3C35442-9402-4BE0-8AE8-EAA995279A1F%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Simpler STOMP Behaviour">rob at rabbitmq.com
       </A><BR>
    <I>Fri Oct  1 15:35:07 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009227.html">[rabbitmq-discuss] last sticky wicket on map/reduce
</A></li>
        <LI>Next message: <A HREF="009228.html">[rabbitmq-discuss] Simpler STOMP Behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9224">[ date ]</a>
              <a href="thread.html#9224">[ thread ]</a>
              <a href="subject.html#9224">[ subject ]</a>
              <a href="author.html#9224">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>All,

Before starting work on moving the STOMP gateway to STOMP 1.1, we're doing some work to simplify the default behaviour of the STOMP gateway. 

This work is proceeding on branch bug23122 of rabbitmq-stomp. I've committed DESIGN.md which outlines the new proposed behaviour. This is reproduced here for convenience, but for those who are interested please track bug23122 and provide your feedback.

Regards,

Rob

DESIGN.md
----------------------
# STOMP Adapter Enhancements

This document outlines proposed changes to the way in which the STOMP adapter handles destinations and routing.

IMPORTANT: Support for all existing custom headers will be removed. 

## Destinations 

In the current STOMP adapter, much of the destination configuration is handled by custom headers, including `routing_key` and `exchange`. 

This design proposes to remove the custom headers, and use only the `destination` header with compound values that define the exchange, routing key and queue names.

### Standard AMQP Destinations

Any exchange/queue or exchange/routing key combination can be accessed using destinations prefixed with `/exchange`.

For `SUBSCRIBE` frames, a destination of the form `/exchange/&lt;name&gt;[/&lt;pattern&gt;]` can be used. This destination will:

1. Create an anonymous, auto-delete queue on `&lt;name&gt;` exchange.
2. If `&lt;pattern&gt;` is supplied, bind the queue to `&lt;name&gt;` exchange using `&lt;pattern&gt;`
3. Register a subscription against the queue, for the current STOMP session

For `SEND` frames, a destination of the form `/exchange/&lt;name&gt;[/&lt;routing-key&gt;]` can be used. This destination will:

1. Send to exchange `&lt;name&gt;`with the routing key `&lt;routing-key&gt;`

### Queue Destinations

For simple queue destinations with round-robin delivery semantics, destinations of the form `/queue/&lt;name&gt;` can be used.

For both `SEND` and `SUBSCRIBE` frames, these destinations will create the queue `&lt;name&gt;` and bind it to the `amq.direct` exchange with routing key `&lt;name&gt;`.

For `SEND` frames, the message will be sent to the `amq.direct` exchange with the routing key `&lt;name&gt;`. For `SUBSCRIBE` frames, a subscription against the queue `&lt;name&gt;` will be created for the current STOMP session.

Given that both `SEND` and `SUBSCRIBE` frames cause the queue to be created, the ordering constraint, client codes doesn't need to worry about creating a subscription before sending messages. Furthermore, the created queues are set to `auto-delete=false` so they will last until they are deleted by the user. 

### Topic Destinations

For simple topic destinations which deliver a copy of each message to all active subscribers, destinations of the form `/topic/&lt;name&gt;` can be used.

For `SEND` frames, the message will be sent to the `amq.topic` exchange with the routing key `&lt;name&gt;`. 

For `SUBSCRIBE` frames, an exclusive queue will be created and bound to the `amq.topic` exchange with routing key `&lt;name&gt;`. A subscription will be created against the exclusive queue.

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009227.html">[rabbitmq-discuss] last sticky wicket on map/reduce
</A></li>
	<LI>Next message: <A HREF="009228.html">[rabbitmq-discuss] Simpler STOMP Behaviour
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9224">[ date ]</a>
              <a href="thread.html#9224">[ thread ]</a>
              <a href="subject.html#9224">[ subject ]</a>
              <a href="author.html#9224">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
