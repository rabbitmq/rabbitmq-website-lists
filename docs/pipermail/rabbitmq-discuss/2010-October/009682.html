<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] problem with new persiter with 1000	topics/queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20problem%20with%20new%20persiter%20with%201000%0A%09topics/queues&In-Reply-To=%3C104757.10144.qm%40web31809.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009679.html">
   <LINK REL="Next"  HREF="009683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] problem with new persiter with 1000	topics/queues</H1>
    <B>alex chen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20problem%20with%20new%20persiter%20with%201000%0A%09topics/queues&In-Reply-To=%3C104757.10144.qm%40web31809.mail.mud.yahoo.com%3E"
       TITLE="[rabbitmq-discuss] problem with new persiter with 1000	topics/queues">chen650 at yahoo.com
       </A><BR>
    <I>Thu Oct 28 23:35:09 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009679.html">[rabbitmq-discuss] problem with new persiter with 1000	topics/queues
</A></li>
        <LI>Next message: <A HREF="009683.html">[rabbitmq-discuss] problem with new persiter with 1000	topics/queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9682">[ date ]</a>
              <a href="thread.html#9682">[ thread ]</a>
              <a href="subject.html#9682">[ subject ]</a>
              <a href="author.html#9682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias,


&gt;<i> Delivered but unacknowledged messages are held in RAM. This is something
</I>we are going to change in a future release. Meanwhile, are you setting a prefetch count? That will bound the number of unacked messages and thus the memory taken up by them.

I am setting prefetch count to 50.  each message is 20 KB.  so total usage should be
1000 queue * 20 KB * 50 which is about 1GB.   After all the messages were consumed, the broker's memory still remained at 4GB.  Is this expected or a problem with memory leak?   

Another observation with 2.1.1 is that the most rdq files in msg_store_persistent were not deleted until all the messages were consumed.  because the broker was so busy &quot;rabbitmqctl list_queues&quot; could not return the queue length, so i am not sure if the delay in deleting rdq files was caused by some consumers were lagging behind.  When i used release 2.0.0, the rdq files were deleted while the consumers were running.  Not sure if this contributed to the memory growth or not.

thank for looking into these problems!  it is greatly appreciated.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101028/2664a490/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20101028/2664a490/attachment.htm</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009679.html">[rabbitmq-discuss] problem with new persiter with 1000	topics/queues
</A></li>
	<LI>Next message: <A HREF="009683.html">[rabbitmq-discuss] problem with new persiter with 1000	topics/queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9682">[ date ]</a>
              <a href="thread.html#9682">[ thread ]</a>
              <a href="subject.html#9682">[ subject ]</a>
              <a href="author.html#9682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
