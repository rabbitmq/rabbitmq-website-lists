<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publish while processing?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publish%20while%20processing%3F&In-Reply-To=%3C4CC05509.5070609%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009460.html">
   <LINK REL="Next"  HREF="009463.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publish while processing?</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publish%20while%20processing%3F&In-Reply-To=%3C4CC05509.5070609%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Publish while processing?">emile at rabbitmq.com
       </A><BR>
    <I>Thu Oct 21 15:58:17 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009460.html">[rabbitmq-discuss] Publish while processing?
</A></li>
        <LI>Next message: <A HREF="009463.html">[rabbitmq-discuss] management plugin missing queue details (on	version 2.1.0)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9585">[ date ]</a>
              <a href="thread.html#9585">[ thread ]</a>
              <a href="subject.html#9585">[ subject ]</a>
              <a href="author.html#9585">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Dave.

On 15/10/10 17:22, Dave Gorman wrote:
&gt;<i> I have a couple messaging scenarios I need help with... 
</I>&gt;<i> 1) I would like to have a subscriber listening to &quot;raw&quot; queue; then do
</I>&gt;<i> some preprocessing and publish a new message, such as &quot;preprocessed&quot; to
</I>&gt;<i> the same exchange.
</I>&gt;<i> 2) I would also like to have a subscriber that would process and push to
</I>&gt;<i> a different exchange.
</I>&gt;<i> 
</I>&gt;<i> I noticed in the .Net Client User Guide that it says do not call
</I>&gt;<i> .basicPublish during a callback as it blocks threads. 
</I>&gt;<i> 
</I>&gt;<i> using (IConnection conn = connectionFactory.CreateConnection())
</I>&gt;<i> {
</I>&gt;<i>     using (IModel model = conn.CreateModel())
</I>&gt;<i>     {
</I>&gt;<i>         var sub = new Subscription(model, &quot;rtls&quot;);
</I>&gt;<i>         foreach (BasicDeliverEventArgs iter in sub)
</I>&gt;<i>         {
</I>&gt;<i>             var message = System.Text.Encoding.UTF8.GetString(iter.Body);
</I>&gt;<i>             //want to crunch and publish to different exchange or same
</I>&gt;<i> exchange
</I>&gt;<i>             //  ***.BasicPublish(...);
</I>&gt;<i> 
</I>&gt;<i>             sub.Ack(iter);
</I>&gt;<i>         }
</I>&gt;<i> 
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> I would like to successfully process and publish the new message before
</I>&gt;<i> I send the ack() on the original message; just so I'm sure every message
</I>&gt;<i> is processed.
</I>&gt;<i> 
</I>&gt;<i> Is this the proper way to process or will that cause threading issues?
</I>
When using Subscription the threading issues warned about in the user
guide do not arise, because callbacks are not invoked from the
connection thread. Subscription makes use of QueueingBasicConsumer
internally and prevents a deadline scenario.

You should therefore be able to replace &quot;***&quot; with &quot;model&quot; in your
example above.

Regards

Emile

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009460.html">[rabbitmq-discuss] Publish while processing?
</A></li>
	<LI>Next message: <A HREF="009463.html">[rabbitmq-discuss] management plugin missing queue details (on	version 2.1.0)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9585">[ date ]</a>
              <a href="thread.html#9585">[ thread ]</a>
              <a href="subject.html#9585">[ subject ]</a>
              <a href="author.html#9585">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
