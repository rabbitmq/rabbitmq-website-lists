<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Lose messages between restarts of broker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lose%20messages%20between%20restarts%20of%20broker&In-Reply-To=%3C20101027222357.GC18601%40wellquite.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009667.html">
   <LINK REL="Next"  HREF="009674.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Lose messages between restarts of broker</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lose%20messages%20between%20restarts%20of%20broker&In-Reply-To=%3C20101027222357.GC18601%40wellquite.org%3E"
       TITLE="[rabbitmq-discuss] Lose messages between restarts of broker">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Oct 27 23:23:58 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009667.html">[rabbitmq-discuss] Lose messages between restarts of broker
</A></li>
        <LI>Next message: <A HREF="009674.html">[rabbitmq-discuss] Lose messages between restarts of broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9668">[ date ]</a>
              <a href="thread.html#9668">[ thread ]</a>
              <a href="subject.html#9668">[ subject ]</a>
              <a href="author.html#9668">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Oct 27, 2010 at 05:15:31PM -0500, Dave Gorman wrote:
&gt;<i> I then publish 10,000 messages and I've set the exchange to durable, the
</I>&gt;<i> queue to durable, and the message delivery to &quot;2&quot; - as I understand this to
</I>&gt;<i> be the configuration for messages to be durable. I then use the rabbitmqctl
</I>&gt;<i> list_queues to show the 10,000 messages. I close the broker window, to mimic
</I>&gt;<i> a hard shutdown of a server. When I start the broker back up and list the
</I>&gt;<i> queues I see 8,428 messages.
</I>&gt;<i> 
</I>&gt;<i> Do you know why I would lose messages?
</I>
Yes. The settings you've described result in Rabbit taking a &quot;best
effort&quot; approach to writing messages to disk. Rabbit will aggressively
buffer pending messages in RAM and may indeed never write some such
messages to disk.

If you really need messages to go safely to disk, then you should put
the channel into transactional mode (tx.select), and issue a tx.commit
when you have published your 10000 messages. When you get the
tx.commit-ok message back, it is guaranteed the messages are safely
written to disk (persistent messages sent to a durable queue).

Obviously, the frequency with which you issue the tx.commit determines
the number of messages that can be lost: if you do a tx.commit after
every single publish then you'll lose at most one message (death during
publish/commit). Doing that, whilst very safe, has a substantial impact
on performance.

Best wishes,

Matthew
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009667.html">[rabbitmq-discuss] Lose messages between restarts of broker
</A></li>
	<LI>Next message: <A HREF="009674.html">[rabbitmq-discuss] Lose messages between restarts of broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9668">[ date ]</a>
              <a href="thread.html#9668">[ thread ]</a>
              <a href="subject.html#9668">[ subject ]</a>
              <a href="author.html#9668">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
