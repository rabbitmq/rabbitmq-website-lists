<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%3F%20short-string%20encoding%20and%20rabbitmq%202.0.1&In-Reply-To=%3CCF7D2F03-0683-4C5E-A8B0-B357FA3894B1%40setf.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009594.html">
   <LINK REL="Next"  HREF="009600.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1</H1>
    <B>james anderson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%3F%20short-string%20encoding%20and%20rabbitmq%202.0.1&In-Reply-To=%3CCF7D2F03-0683-4C5E-A8B0-B357FA3894B1%40setf.de%3E"
       TITLE="[rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1">james.anderson at setf.de
       </A><BR>
    <I>Fri Oct 22 12:44:22 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009594.html">[rabbitmq-discuss] RabbitMQ windows service fails to start	(distribution name conflict?)
</A></li>
        <LI>Next message: <A HREF="009600.html">[rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9599">[ date ]</a>
              <a href="thread.html#9599">[ thread ]</a>
              <a href="subject.html#9599">[ subject ]</a>
              <a href="author.html#9599">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>good morning;

the grammar on page 31 of amqp0-9-1.pdf[1] describes an encoding for  
field-values in field-tables which would permit short strings to be  
encoded as 's'&lt;length&gt;&lt;data&gt;.

i am running rabbitmg, version 2.1.0-1, installed as per the download  
page[2].

if i attempt to send to that server a basic.publish for which the  
properties includes a field table which contains a short string, the  
request causes an exception, and the respective connection appears to  
be rendered zombie. the error report is:

=ERROR REPORT==== 22-Oct-2010::00:07:02 ===
** Generic server &lt;0.23205.8&gt; terminating
** Last message in was {'$gen_cast',
                            {method,
                                {'basic.publish',0,&lt;&lt;&quot;spocq.store&quot;&gt;&gt;,
                                    &lt;&lt;&quot;foaf&quot;&gt;&gt;,false,false},
                                {content,60,none,
                                     
&lt;&lt;255,248,10,84,69,88,84,47,80,76,65,73,78,
                                       
10,73,83,79,45,56,56,53,57,45,49,0,0,0,48,
                                       
12,69,76,69,77,69,78,84,45,84,89,80,69,
                                       
115,6,83,84,82,73,78,71,7,80,65,67,75,65,
                                       
71,69,115,17,68,69,46,83,69,84,70,46,65,
                                       
77,81,80,46,85,83,69,82,1,0,0,0,0,0,0,0,0,
                                      0,0,0,0,0,0,0,0&gt;&gt;,
                                    rabbit_framing_amqp_0_9_1,
                                    [&lt;&lt;&quot;a test message&quot;&gt;&gt;]}}}
** When Server state == {ch,running,1,&lt;0.23202.8&gt;,&lt;0.23204.8&gt;,undefined,
                             #Fun&lt;rabbit_channel_sup.0.58069862&gt;,none,
                             {set,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                    [],[]}}},
                             1,
                             {[],[]},
                             {[],[]},
                             &lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;/&quot;&gt;&gt;,&lt;&lt;&quot;spocq.store&quot;&gt;&gt;,
                             {dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                     [],[]}}},
                             {dict,0,16,16,8,80,48,
                                   {[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                    [],[]},
                                   {{[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                     [],[]}}},
                             &lt;0.23201.8&gt;,
                             {state,none,undefined}}
** Reason for termination ==
** {function_clause,
        [{rabbit_binary_parser,parse_table,
              
[&lt;&lt;84,82,73,78,71,7,80,65,67,75,65,71,69,115,17,68,69,46,83,69,
                84,70,46,65,77,81,80,46,85,83,69,82&gt;&gt;]},
         {rabbit_binary_parser,parse_table,1},
         {rabbit_binary_parser,parse_property,2},
         {rabbit_binary_parser,parse_properties,6},
         {rabbit_framing_amqp_0_9_1,decode_properties,2},
         {rabbit_binary_parser,ensure_content_decoded,1},
         {rabbit_channel,handle_method,3},
         {rabbit_channel,handle_cast,2}]}

i understand this, and the code in the repository[3] to indicate that  
the 115,6,83 at the start of the fourth line of the content vector,  
above, was decoded as a short 16/signed instead of the intended six  
byte short string. given which state, the subsequent vector  
&lt;&lt;84,82,73,78,71,7,80, ...&gt;&gt; matched no pattern. do i understand  
these events correctly?


---
[1] <A HREF="https://www.amqp.org/confluence/download/attachments/720900/">https://www.amqp.org/confluence/download/attachments/720900/</A> 
amqp0-9-1.pdf
[2] <A HREF="http://www.rabbitmq.com/debian.html#apt">http://www.rabbitmq.com/debian.html#apt</A>
[3] <A HREF="http://hg.rabbitmq.com/rabbitmq-server/file/ec44d2fa3842/src/">http://hg.rabbitmq.com/rabbitmq-server/file/ec44d2fa3842/src/</A> 
rabbit_binary_parser.erl#l57
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009594.html">[rabbitmq-discuss] RabbitMQ windows service fails to start	(distribution name conflict?)
</A></li>
	<LI>Next message: <A HREF="009600.html">[rabbitmq-discuss] ? short-string encoding and rabbitmq 2.0.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9599">[ date ]</a>
              <a href="thread.html#9599">[ thread ]</a>
              <a href="subject.html#9599">[ subject ]</a>
              <a href="author.html#9599">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
