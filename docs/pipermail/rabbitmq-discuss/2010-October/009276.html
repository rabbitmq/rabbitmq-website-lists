<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Questions on RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Questions%20on%20RabbitMQ&In-Reply-To=%3CAANLkTikTq04iJQVtdWUG6gJbm6B58Seqbsp6Ke1Ehc8G%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009294.html">
   <LINK REL="Next"  HREF="009277.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Questions on RabbitMQ</H1>
    <B>Ralf Kistner</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Questions%20on%20RabbitMQ&In-Reply-To=%3CAANLkTikTq04iJQVtdWUG6gJbm6B58Seqbsp6Ke1Ehc8G%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Questions on RabbitMQ">ralf.kistner at gmail.com
       </A><BR>
    <I>Sun Oct  3 18:25:49 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009294.html">[rabbitmq-discuss] Authorization in RabbitMQ
</A></li>
        <LI>Next message: <A HREF="009277.html">[rabbitmq-discuss] Shutdown Listener on Java Client API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9276">[ date ]</a>
              <a href="thread.html#9276">[ thread ]</a>
              <a href="subject.html#9276">[ subject ]</a>
              <a href="author.html#9276">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the response.

EventMachine looks perfect for my Ruby script.

I'm already using MongoDB for other parts of my application, so I'll
use it to implement a similar approach to what you suggested.
My messages will mostly be binary data, but that shouldn't make a big
difference.

I'll use an additional consumer (on routing key &quot;#&quot;) , to ensure that
the messages are all persisted even when my consumer is broken and
silently discards messages (this happened to me in the past).

Ralf


On Sat, Sep 25, 2010 at 2:59 PM, Jon Brisbin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jon at jbrisbin.com</A>&gt; wrote:
&gt;<i> On Sep 25, 2010, at 6:07 AM, Ralf Kistner wrote:
</I>&gt;<i>
</I>&gt;<i> 2 a. Are there any recommended practices for running a (Ruby) process
</I>&gt;<i> to consume messages in an infinite loop?
</I>&gt;<i>
</I>&gt;<i> Check out the AMQP stuff in Ruby. It uses EventMachine. EM will run until
</I>&gt;<i> you tell it to stop, which is what you're looking for.
</I>&gt;<i>
</I>&gt;<i> 2 b. The Ruby script would occasionally be unable to process a
</I>&gt;<i> message. This could be because of a temporary lock on the database, an
</I>&gt;<i> invalid message from the mobile client, or a bug on the server. The
</I>&gt;<i> ideal would be for these messages to be retried a few times, then
</I>&gt;<i> moved to a different queue if it still fails. The messages in the
</I>&gt;<i> queue could then be inspected manually, and moved back to the original
</I>&gt;<i> queue when the bug was fixed.
</I>&gt;<i> How would this be accomplished? Does RabbitMQ have something like a
</I>&gt;<i> dead letter queue? Or would I have to move the message to a different
</I>&gt;<i> queue myself (in the Ruby script), in case of an error?
</I>&gt;<i> Note that I can't return any messages to the sender, I want to keep it
</I>&gt;<i> on the server in a different queue.
</I>&gt;<i>
</I>&gt;<i> Redelivery is something I'm working on in my own application. I use it to
</I>&gt;<i> update databases at remote locations that might or might not be online. If I
</I>&gt;<i> get a timeout error, I write my message into a Riak bucket. There is a
</I>&gt;<i> Quartz-based job that runs every five minutes that checks this retry bucket
</I>&gt;<i> and simply deletes the messages and dumps them back into the broker. I
</I>&gt;<i> haven't put it in yet, but I'm planning on implementing a &quot;maxRetries&quot; so
</I>&gt;<i> that when a message exceeds the retry number, it will be either sent to a
</I>&gt;<i> notification queue where it gets emailed, or moved to another Riak bucket
</I>&gt;<i> where I can write an RSS feed over the top of it.
</I>&gt;<i>
</I>&gt;<i> 3. What is the best way to create a backup of all the message sent to
</I>&gt;<i> the server? Does RabbitMQ automatically do this, or should I write an
</I>&gt;<i> additional consumer to create a backup?
</I>&gt;<i>
</I>&gt;<i> A NoSQL store where you keep the entire message in JSON format seems to me
</I>&gt;<i> the safest and most performant way to persist messages with enough
</I>&gt;<i> information to be able to resubmit the message at a later time. I have
</I>&gt;<i> security tokens in the headers (I don't use logins but tokens) and of course
</I>&gt;<i> I have to capture the exchange and routing key information. I use JSON data
</I>&gt;<i> for my messages, so this fits nicely together but you could also base64
</I>&gt;<i> encode your data.
</I>&gt;<i> You could use an additional consumer (e.g. on routing key &quot;#&quot;) but I let the
</I>&gt;<i> consumer decide whether to persist a message to Riak or not.
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i> J. Brisbin
</I>&gt;<i> <A HREF="http://jbrisbin.com/">http://jbrisbin.com/</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009294.html">[rabbitmq-discuss] Authorization in RabbitMQ
</A></li>
	<LI>Next message: <A HREF="009277.html">[rabbitmq-discuss] Shutdown Listener on Java Client API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9276">[ date ]</a>
              <a href="thread.html#9276">[ thread ]</a>
              <a href="subject.html#9276">[ subject ]</a>
              <a href="author.html#9276">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
