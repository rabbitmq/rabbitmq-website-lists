<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] I have a question about disc nodes..
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20I%20have%20a%20question%20about%20disc%20nodes..&In-Reply-To=%3C20101004161431.GA2818%40dakota.eng.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009286.html">
   <LINK REL="Next"  HREF="009288.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] I have a question about disc nodes..</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20I%20have%20a%20question%20about%20disc%20nodes..&In-Reply-To=%3C20101004161431.GA2818%40dakota.eng.vmware.com%3E"
       TITLE="[rabbitmq-discuss] I have a question about disc nodes..">alexandru at rabbitmq.com
       </A><BR>
    <I>Mon Oct  4 17:14:31 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009286.html">[rabbitmq-discuss] I have a question about disc nodes..
</A></li>
        <LI>Next message: <A HREF="009288.html">[rabbitmq-discuss] Using Toke
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9287">[ date ]</a>
              <a href="thread.html#9287">[ thread ]</a>
              <a href="subject.html#9287">[ subject ]</a>
              <a href="author.html#9287">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

&gt;<i> I have setup a cluster with 2 disc nodes and 1 or more ram nodes,
</I>&gt;<i> I create a durable exchange and a durable queue
</I>&gt;<i> I check the list_queues, list_bindings command on each server and it works.
</I>&gt;<i> If i take down the first disc node all the queues disappear...
</I>
When you declare a queue, it's only created on the node you declared it
on (but it's accessible from all nodes in the cluster).  This means that
if the node is taken down, all of its queues disappear.  What's worse,
if you then try to redeclare a persistent queue on another node,
you'll get a 404 &quot;Not Found&quot; error.

So, what you're seeing is expected behaviour.

&gt;<i>  how can i make the queue persist if at least 1 disc node is
</I>&gt;<i> online?
</I>
Have a look at our HA with RabbitMQ Guide [1].  It gives you the steps
necessary to create an active/passive RabbitMQ Cluster (so, when the
first disk nodes goes down, the second just takes its place).  Of
course, this would mean one of the two disk nodes would not be used
until the other fails.

The might be other things you could try.  What are you trying to achieve?

If you don't care about losing some messages, why not just have each
client declare the queue when it needs it?  (i.e. just do a
queue.declare before using the queue).  This way, if the queue's
missing, it will be created, but if it's already there, you'll just use
the old one.

Cheers,
Alex

[1] <A HREF="http://www.rabbitmq.com/pacemaker.html">http://www.rabbitmq.com/pacemaker.html</A>


On Mon, Oct 04, 2010 at 11:48:47AM -0400, Pedram Nimreezi wrote:
&gt;<i> I have setup a cluster with 2 disc nodes and 1 or more ram nodes,
</I>&gt;<i> 
</I>&gt;<i> I create a durable exchange and a durable queue
</I>&gt;<i> 
</I>&gt;<i> I check the list_queues, list_bindings command on each server and it works.
</I>&gt;<i> 
</I>&gt;<i> If i take down the first disc node all the queues disappear...
</I>&gt;<i> 
</I>&gt;<i> Is this normal?  how can i make the queue persist if at least 1 disc node is
</I>&gt;<i> online?
</I>&gt;<i> 
</I>&gt;<i> I don't care if i lose the messages from the server that failed, but I can't
</I>&gt;<i> let the queues just disappear..
</I>&gt;<i> 
</I>&gt;<i> I'm routing to a direct topic bound to queues using routing keys under the
</I>&gt;<i> same name..
</I>&gt;<i> 
</I>&gt;<i> The list_exchanges still shows the exchange, but the queues are missing as
</I>&gt;<i> soon as disc node1 is brought down..
</I>&gt;<i> 
</I>&gt;<i> regadless if ram nodes or another disc node is up...  Please advise..
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> /* Sincerely
</I>&gt;<i> -------------------------------------------------------------- */
</I>&gt;<i> Pedram N.
</I>&gt;<i> Every man is guilty of every good he did not do - Voltaire
</I>
&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009286.html">[rabbitmq-discuss] I have a question about disc nodes..
</A></li>
	<LI>Next message: <A HREF="009288.html">[rabbitmq-discuss] Using Toke
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9287">[ date ]</a>
              <a href="thread.html#9287">[ thread ]</a>
              <a href="subject.html#9287">[ subject ]</a>
              <a href="author.html#9287">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
