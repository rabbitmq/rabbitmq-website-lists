<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queue replication (I know, I know)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20replication%20%28I%20know%2C%20I%20know%29&In-Reply-To=%3C4CBEBED1.8070107%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009532.html">
   <LINK REL="Next"  HREF="009549.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queue replication (I know, I know)</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20replication%20%28I%20know%2C%20I%20know%29&In-Reply-To=%3C4CBEBED1.8070107%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Queue replication (I know, I know)">simon at rabbitmq.com
       </A><BR>
    <I>Wed Oct 20 11:05:05 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="009532.html">[rabbitmq-discuss] Queue replication (I know, I know)
</A></li>
        <LI>Next message: <A HREF="009549.html">[rabbitmq-discuss] Queue replication (I know, I know)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9538">[ date ]</a>
              <a href="thread.html#9538">[ thread ]</a>
              <a href="subject.html#9538">[ subject ]</a>
              <a href="author.html#9538">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/10/10 05:14, Derek Chen-Becker wrote:
&gt;<i> What's more interesting is that if I copy the /var/lib/rabbitmq
</I>&gt;<i> directory to the backup host *without stopping the primary broker*, and
</I>&gt;<i> then stop the primary and start the backup, everything still appears to
</I>&gt;<i> work fine. Now, I suspect that with the low volume I'm pushing here I'm
</I>&gt;<i> just getting lucky and not copying files in an inconsistent state,
</I>
Probably not. Rabbit is designed to repair queues when it comes up 
again, so if you're copying queues when they're inconsistent it'll get 
fixed by the time the backup broker is accepting connections. Of course, 
if you're unlucky, you could lose a few messages in such a process but 
from what you've said before it sounds like that isn't your biggest concern?

Of course with buffering involved messages can take a while to be 
written to disk. Transactions around publishes will help here - when you 
get commit-ok back you know any persistent messages are on disk.

&gt;<i> but
</I>&gt;<i> it made me think of possibly another approach to making backups: would
</I>&gt;<i> it be possible to implement a &quot;pause/snapshot&quot; for the broker such that
</I>&gt;<i> it would flush data, hold off on writes, etc. so that I could copy the
</I>&gt;<i> data in a consistent state. I could then issue a &quot;resume&quot; and all of the
</I>&gt;<i> clients would just continue on their merry way. At least this way the
</I>&gt;<i> sockets and socket bindings would stay open so that as far as clients
</I>&gt;<i> are concerned my broker is just being reaaaaallly slow.
</I>
Hmm, interesting idea. I'll see if we're interested in doing that. We're 
currently looking at how to make the HA experience better so this might 
be a possibility.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009532.html">[rabbitmq-discuss] Queue replication (I know, I know)
</A></li>
	<LI>Next message: <A HREF="009549.html">[rabbitmq-discuss] Queue replication (I know, I know)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9538">[ date ]</a>
              <a href="thread.html#9538">[ thread ]</a>
              <a href="subject.html#9538">[ subject ]</a>
              <a href="author.html#9538">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
