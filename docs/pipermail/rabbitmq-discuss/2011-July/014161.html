<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ and Spring
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20Spring&In-Reply-To=%3C27D6B27DB616654BBEF4DDB8B31EAF916B590E9526%40vs-msx01.IT-NG.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014174.html">
   <LINK REL="Next"  HREF="014214.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ and Spring</H1>
    <B>Arno Puschmann</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20and%20Spring&In-Reply-To=%3C27D6B27DB616654BBEF4DDB8B31EAF916B590E9526%40vs-msx01.IT-NG.local%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ and Spring">arno.puschmann at acodeas.de
       </A><BR>
    <I>Tue Jul 26 08:27:13 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014174.html">[rabbitmq-discuss] Read messages non-blocking in RabbitMQ
</A></li>
        <LI>Next message: <A HREF="014214.html">[rabbitmq-discuss] RabbitMQ and Spring
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14161">[ date ]</a>
              <a href="thread.html#14161">[ thread ]</a>
              <a href="subject.html#14161">[ subject ]</a>
              <a href="author.html#14161">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm trying to use RabbitMQ in a Spring Application. I have installed RabbitMQ Server 2.5.1 and using Spring 3.0.5.

I have the following Bean-Configuration

&lt;bean id=&quot;rabbitConnFactory&quot; class=&quot;org.springframework.amqp.rabbit.connection.SingleConnectionFactory&quot;&gt;
	&lt;property name=&quot;host&quot; value=&quot;localhost&quot; /&gt;
	&lt;property name=&quot;username&quot; value=&quot;guest&quot; /&gt;
	&lt;property name=&quot;password&quot; value=&quot;guest&quot; /&gt;
	&lt;property name=&quot;virtualHost&quot; value=&quot;/&quot; /&gt;
	&lt;property name=&quot;port&quot; value=&quot;5672&quot; /&gt;
&lt;/bean&gt;

&lt;bean id=&quot;admin&quot; class=&quot;org.springframework.amqp.rabbit.core.RabbitAdmin&quot;&gt;
	&lt;constructor-arg ref=&quot;rabbitConnFactory&quot; /&gt;
&lt;/bean&gt;

&lt;bean id=&quot;template&quot; class=&quot;org.springframework.amqp.rabbit.core.RabbitTemplate&quot;&gt;
 	&lt;property name=&quot;connectionFactory&quot; ref=&quot;rabbitConnFactory&quot; /&gt;
	&lt;property name=&quot;routingKey&quot; value=&quot;test.queue&quot;/&gt;
	&lt;property name=&quot;queue&quot; value=&quot;junitqueue&quot;/&gt;
	&lt;property name=&quot;messageConverter&quot; ref=&quot;messageConverter&quot; /&gt;
&lt;/bean&gt;

&lt;bean id=&quot;messageListener&quot; class=&quot;de.ami.ws.Queue.Receiver&quot; /&gt;


Finally I want to access to my RabbitMQ-Server. So I Autowired my Properties and call

template.convertAndSend(object);

but after this there is no message on the queue and the no exception is thrown.


Trying the same with this Code then it works.

			Connection connection = rabbitConnFactory.createConnection();
			Channel channel = connection.createChannel(true);
			channel.exchangeDeclare(EXCHANGE_NAME, &quot;direct&quot;, true);
			channel.queueDeclare(QUEUE_NAME, true, false, false, null);
			channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, ROUTING_KEY);

			ByteArrayOutputStream baos = new ByteArrayOutputStream();
			ObjectOutputStream oos;
			oos = new ObjectOutputStream(baos);
			oos.writeObject(object);
			oos.close();
			byte[] ByteMessage = baos.toByteArray();

			channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, null, ByteMessage);
			channel.close();
			connection.close();

But this is not a solution for a Spring Application.

By the way i get a Exception if I try to use the Spring-AMQP-Cient-Version 2.5.1 im my pom.xml.

java.lang.IllegalAccessError: tried to access method com.rabbitmq.client.impl.AMQBasicProperties.&lt;init&gt;()V from class org.springframework.amqp.rabbit.support.RabbitUtils
	at org.springframework.amqp.rabbit.support.RabbitUtils.extractBasicProperties(RabbitUtils.java:195)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.doSend(RabbitTemplate.java:332)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.access$000(RabbitTemplate.java:51)
	at org.springframework.amqp.rabbit.core.RabbitTemplate$1.doInRabbit(RabbitTemplate.java:141)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:297)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:139)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.convertAndSend(RabbitTemplate.java:156)
	at org.springframework.amqp.rabbit.core.RabbitTemplate.convertAndSend(RabbitTemplate.java:148)

Have anybody some Experience or a solution?

Thanks.

Arno Puschmann
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014174.html">[rabbitmq-discuss] Read messages non-blocking in RabbitMQ
</A></li>
	<LI>Next message: <A HREF="014214.html">[rabbitmq-discuss] RabbitMQ and Spring
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14161">[ date ]</a>
              <a href="thread.html#14161">[ thread ]</a>
              <a href="subject.html#14161">[ subject ]</a>
              <a href="author.html#14161">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
