<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Persistent messages and durable queue	questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Persistent%20messages%20and%20durable%20queue%0A%09questions&In-Reply-To=%3C0F51CD98-3C30-4029-855A-228B79C3FD71%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013725.html">
   <LINK REL="Next"  HREF="013788.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Persistent messages and durable queue	questions</H1>
    <B>Rob Harrop</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Persistent%20messages%20and%20durable%20queue%0A%09questions&In-Reply-To=%3C0F51CD98-3C30-4029-855A-228B79C3FD71%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Persistent messages and durable queue	questions">rob at rabbitmq.com
       </A><BR>
    <I>Thu Jul  7 14:34:38 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013725.html">[rabbitmq-discuss] FW: rabbit upgrade - liftweb amqp problems
</A></li>
        <LI>Next message: <A HREF="013788.html">[rabbitmq-discuss] Persistent messages and durable queue	questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13729">[ date ]</a>
              <a href="thread.html#13729">[ thread ]</a>
              <a href="subject.html#13729">[ subject ]</a>
              <a href="author.html#13729">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>



On 24 Jun 2011, at 18:33, Elias Levy &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">fearsome.lucidity at gmail.com</A>&gt; wrote:

&gt;<i> On Wed, Jun 22, 2011 at 1:15 AM, Rob Harrop &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rob at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> When there is a consumer ready to receive the message, the message will only be written to disk if:
</I>&gt;<i> 
</I>&gt;<i> 1. The queue is durable
</I>&gt;<i> 2. The message is peristent
</I>&gt;<i> 3. Automatic ack is disabled
</I>&gt;<i> 
</I>&gt;<i> Rob,
</I>&gt;<i> 
</I>&gt;<i> Thanks for your response.  I was afraid that might be the case.  That said, I've read with interest the discussion on the upcoming HA queue feature.  It's exactly what we are looking for.  Hopefully it will be release in not too long a time.
</I>
HA queues will be in the next major release.

&gt;<i>  
</I>&gt;<i> You can use publisher confirms to allow your application code to know when a message has successfully been routed or when it has been lost.
</I>&gt;<i> 
</I>&gt;<i> See: <A HREF="http://www.rabbitmq.com/extensions.html#confirms">http://www.rabbitmq.com/extensions.html#confirms</A>
</I>&gt;<i> 
</I>&gt;<i> Alas, I believe, publisher confirms do not solve the problem. As I stated, I expect only a subset of the messages published to the topic exchange to have matching bindings.  Most messages will not be routed anywhere.  Publisher confirms will return basic.ack for such messages.  That is all well and good under normal conditions.  
</I>&gt;<i> 
</I>&gt;<i> But if there is a node with a queue with a binding that matches the message, and that node goes down, then it is my understanding that the rest of the cluster will discard the binding since the queue is no longer reachable.  If that is the case, then publisher confirms will return a basic.ack rather than a basic.nack.  Thus the publisher will not know that there was a queue with a binding that matched the message, but its just not available at this time.
</I>&gt;<i> 
</I>&gt;<i> Is my understanding incorrect?
</I>
Well, it's quite subtle. If the message was routed when the queue was up, a back is sent if the queue goes down before the message can be written to disk.

If the binding has been removed due to queue down then no nack will be sent.

Are you trying to ensure that a given message reaches a known set of queues?
&gt;<i> 
</I>&gt;<i> This becomes less of an issue once the HA queues feature is shipped, as I configure the cluster the deliver the message to a queue even in the face a configurable number of nodes being down.
</I>&gt;<i> 
</I>&gt;<i> Elias Levy
</I>&gt;<i> 
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/fc02c034/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110707/fc02c034/attachment.htm</A>&gt;
</PRE>
















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013725.html">[rabbitmq-discuss] FW: rabbit upgrade - liftweb amqp problems
</A></li>
	<LI>Next message: <A HREF="013788.html">[rabbitmq-discuss] Persistent messages and durable queue	questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13729">[ date ]</a>
              <a href="thread.html#13729">[ thread ]</a>
              <a href="subject.html#13729">[ subject ]</a>
              <a href="author.html#13729">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
