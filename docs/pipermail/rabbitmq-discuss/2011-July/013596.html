<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-c%20--%20multiple%20exectables%20receiving%0A%20same%20message&In-Reply-To=%3C8A1A883E3F171B42A81817DEC138352C1DB3305B83%40MX06A.corp.emc.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013595.html">
   <LINK REL="Next"  HREF="013593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message</H1>
    <B>Lowell.Boggs at emc.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-c%20--%20multiple%20exectables%20receiving%0A%20same%20message&In-Reply-To=%3C8A1A883E3F171B42A81817DEC138352C1DB3305B83%40MX06A.corp.emc.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message">Lowell.Boggs at emc.com
       </A><BR>
    <I>Fri Jul  1 15:44:22 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013595.html">[rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message
</A></li>
        <LI>Next message: <A HREF="013593.html">[rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13596">[ date ]</a>
              <a href="thread.html#13596">[ thread ]</a>
              <a href="subject.html#13596">[ subject ]</a>
              <a href="author.html#13596">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>That's it!  

I was using &quot;&quot; as the queue name.

Now that I am sharing a queue, they load balancing magically works.

Whew, that sure saved me a lot of debug time.

Thanks!

Lowell 

-----Original Message-----
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at gmail.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at gmail.com</A>] On Behalf Of Alexis Richardson
Sent: Friday, July 01, 2011 9:08 AM
To: Boggs Jr., Lowell
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simone.busoli at gmail.com</A>; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message

Lowell

How many queues do you have bound to the exchange?  You should have
one queue.  Then, connect both executables to that queue.

alexis


On Fri, Jul 1, 2011 at 2:56 PM,  &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">Lowell.Boggs at emc.com</A>&gt; wrote:
&gt;<i> HI Simon -- thanks for trying to help!
</I>&gt;<i>
</I>&gt;<i> The two executables&#160;are not in fact receiving the messages in a round-robin
</I>&gt;<i> fashion.&#160; They are both receiving all of the messages.
</I>&gt;<i>
</I>&gt;<i> I send 4000 messages and both executables receive all 4000 in sequence.&#160; It
</I>&gt;<i> was my understanding that the point of the tutorial was to demonstrate a
</I>&gt;<i> round robin delivery of 1/2 of the messages to each consumer so as to
</I>&gt;<i> accomplish load balancing.&#160; The examples in the tutorial page show that of
</I>&gt;<i> the 5 messages sent as a test, 3 went to one python consumer task and the 2
</I>&gt;<i> going to the other.
</I>&gt;<i>
</I>&gt;<i> Our use of the rabbit-mq entirely depends on this load balancing feature.
</I>&gt;<i> If I can't get this to work like the tutorial, we need to pursue a different
</I>&gt;<i> messaging solution.&#160; I guess I'll have to copy the python examples out of
</I>&gt;<i> the tutorial and see if the tutorial actually works -- maybe the actual
</I>&gt;<i> python source will tell me what I' might be doing wrong.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> &#160;&#160; Lowell
</I>&gt;<i>
</I>&gt;<i> ________________________________
</I>&gt;<i> From: Simone Busoli [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simone.busoli at gmail.com</A>]
</I>&gt;<i> Sent: Thursday, June 30, 2011 5:06 PM
</I>&gt;<i> To: Boggs Jr., Lowell
</I>&gt;<i> Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving
</I>&gt;<i> same message
</I>&gt;<i>
</I>&gt;<i> Hi Lowell,
</I>&gt;<i>
</I>&gt;<i> The second tutorial does not use a topic exchange, but even with a topic
</I>&gt;<i> exchange the situation would be the same. The key point here is that your
</I>&gt;<i> workers are reading messages from the same queue. The exchange, topic or
</I>&gt;<i> anything else, as soon as it has delivered a message to a queue is out of
</I>&gt;<i> the game. The queue receives the message because it's bound to the exchange.
</I>&gt;<i> Then you have two or more workers reading from the same queue, thereby
</I>&gt;<i> receiving each one message in a round-robin fashion.
</I>&gt;<i>
</I>&gt;<i> On Jun 30, 2011 11:29 PM, &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">Lowell.Boggs at emc.com</A>&gt; wrote:
</I>&gt;&gt;<i> I am confused by my experiments with rabbitmq-c.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I was trying to follow the task worker tutorial:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://www.rabbitmq.com/tutorials/tutorial-two-python.html">http://www.rabbitmq.com/tutorials/tutorial-two-python.html</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Of course, I'm using C interfaces not the python or Java interfaces.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Being a newbie it is probable that I'm doing something wrong, but:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The tutorial implies to me that if I have:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * one exchange+topic
</I>&gt;&gt;<i> * two worker executables that read from it
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> then
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * due to round-robin processing, some messages will go to one executable
</I>&gt;&gt;<i> * other messages will go to the other
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However, I am seeing that both exectuables receive all the messages --
</I>&gt;&gt;<i> which is not at all what I want.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is this supposed to work with the default version of rabbitmq-c?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Immediately upon logging into the channel, in the consumers, I am setting
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> basic_qos(conn, 1, 0, 1, 0);
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also, I am calling basic_consume like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> amqp_basic_consume(conn,
</I>&gt;&gt;<i> 1,
</I>&gt;&gt;<i> amqp_cstring_bytes(queuename),
</I>&gt;&gt;<i> amqp_empty_bytes,
</I>&gt;&gt;<i> 0,
</I>&gt;&gt;<i> 0,
</I>&gt;&gt;<i> 0,
</I>&gt;&gt;<i> amqp_empty_table
</I>&gt;&gt;<i> );
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The exchange that i am using is amq.direct. I have tried an empty string
</I>&gt;&gt;<i> queue name as well as &quot;hello&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am calling basic_ack() as soon as I receive the messages in both worker
</I>&gt;&gt;<i> executables -- well, after I log their reception.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any ideas?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Lowell
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013595.html">[rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message
</A></li>
	<LI>Next message: <A HREF="013593.html">[rabbitmq-discuss] rabbitmq-c -- multiple exectables receiving same message
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13596">[ date ]</a>
              <a href="thread.html#13596">[ thread ]</a>
              <a href="subject.html#13596">[ subject ]</a>
              <a href="author.html#13596">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
