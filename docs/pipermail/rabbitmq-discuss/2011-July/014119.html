<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Asynchronous request-reply across shovel
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Asynchronous%20request-reply%20across%20shovel&In-Reply-To=%3CCAOn7oW_m1G-3xKOBRi_oDj4pPECvJmP69yy5idSMVPUKZTu8Vg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014173.html">
   <LINK REL="Next"  HREF="014120.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Asynchronous request-reply across shovel</H1>
    <B>Simone Busoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Asynchronous%20request-reply%20across%20shovel&In-Reply-To=%3CCAOn7oW_m1G-3xKOBRi_oDj4pPECvJmP69yy5idSMVPUKZTu8Vg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Asynchronous request-reply across shovel">simone.busoli at gmail.com
       </A><BR>
    <I>Fri Jul 22 23:01:45 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014173.html">[rabbitmq-discuss] Reading messages without acking them
</A></li>
        <LI>Next message: <A HREF="014120.html">[rabbitmq-discuss] How to read from multiple queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14119">[ date ]</a>
              <a href="thread.html#14119">[ thread ]</a>
              <a href="subject.html#14119">[ subject ]</a>
              <a href="author.html#14119">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, I'm stuck with trying to find a way to implement generic asynchronous
request-reply which works well across shovels. It is going to be somewhat
contrived since I'm building a generic bus int .NET using RabbitMQ as the
transport, so please bear with me.
So far it used to work like this: when performing a request I created a
temporary queue and sent its name in the ReplyTo field, then the receiver of
the request sent its reply on the default exchange using this queue name as
the routing key.

Now what I would like to do it make it work across shovels, but my
implementation (the way I would like it to be) ideally imposes some
decoupling between the request message and the reply message which prevents
me from being able to achieve this result.

To explain, the request message and the reply message are supposed to be
published to different exchanges to make it work across a shovel. This is
because, supposing I have two servers, the request has to be published to an
exchange that is &quot;shoveled&quot; from server1 to server2, while the reply in
order to come back to the requestor needs to be published to an exchange
shoveled from server2 to server1. I hope it makes sense so far.

What I would like to do is avoiding, when performing the request, to know
what exchange the reply will be published to, as I don't even want to let
the requestor be aware of what kind of reply the application is going to
receive; it could be a RequestSuccessfulMessage or a RequestFailedMessage
for instance. Of course my application will have &quot;handlers&quot; for both of
them, but the requestor needen't know about that.
As an additional detail, in the system I am setting up the channel that
dispatches messages is already subscribing to the response exchange because,
by convention, I am subscribing to all message types for whom there is a
suitable consumer in the application by using their exposed exchange name (I
decorate every message type with an attribute containing the name of the
exchange that message type is published to) and a string representation of
message type as the binding key, but in a request/reply scenario I don't
want every instance of my application to receive the reply message, just the
one which sent the request, therefore the reply has to come through a
different combination of exchange/routing key.

Any advice is welcome, you can look at the code
here&lt;<A HREF="http://code.google.com/p/mexexp/source/checkout">http://code.google.com/p/mexexp/source/checkout</A>&gt;. There
is a failing test
in RabbitMQ\Tests.Integration\Bus\RequestReply\Request_and_reply.cs which
exposes the problem. The tests are self contained except that they expect a
rabbitmq server to be running on localhost (there is one embedded in the
repo in folder RabbitMQServer, you can start that one directly)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110723/3234b3f2/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110723/3234b3f2/attachment.htm</A>&gt;
</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014173.html">[rabbitmq-discuss] Reading messages without acking them
</A></li>
	<LI>Next message: <A HREF="014120.html">[rabbitmq-discuss] How to read from multiple queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14119">[ date ]</a>
              <a href="thread.html#14119">[ thread ]</a>
              <a href="subject.html#14119">[ subject ]</a>
              <a href="author.html#14119">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
