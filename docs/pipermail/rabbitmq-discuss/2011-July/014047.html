<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Channel takes everyone down?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Channel%20takes%20everyone%20down%3F&In-Reply-To=%3C20110720210009.GA12886%40dakota%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014019.html">
   <LINK REL="Next"  HREF="014050.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Channel takes everyone down?</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Channel%20takes%20everyone%20down%3F&In-Reply-To=%3C20110720210009.GA12886%40dakota%3E"
       TITLE="[rabbitmq-discuss] Channel takes everyone down?">alexandru at rabbitmq.com
       </A><BR>
    <I>Wed Jul 20 22:00:09 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014019.html">[rabbitmq-discuss] Channel takes everyone down?
</A></li>
        <LI>Next message: <A HREF="014050.html">[rabbitmq-discuss] Channel takes everyone down?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14047">[ date ]</a>
              <a href="thread.html#14047">[ thread ]</a>
              <a href="subject.html#14047">[ subject ]</a>
              <a href="author.html#14047">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi James,

&gt;<i> However, when a consumer has a non-normal exit, the channel goes down,
</I>&gt;<i> but the exit signal bubbles up all the way to where *all* other channels
</I>&gt;<i> go down as well.
</I>
I've just tried it and you're right: sending a non-normal exit to a
channel will cause the connection to go down, taking all the other
channels with it.

For what it's worth, this also happens with 2.5.1 and we don't have any
plans to change this behaviour right now.  It happens because channels
don't trap exits.

I'm afraid there isn't anyway to do it automatically.  You could start
a separate process that traps exits and is linked to your consumer.
When you receive an exit from the consumer, close its channel cleanly.
So, a very basic supervisor.

Maybe something like this:
  <A HREF="https://gist.github.com/1095910">https://gist.github.com/1095910</A>

Run() is what I think you're doing.  Run2() starts up a separate thread
to monitor the consumer and close its channel when the time comes.
That's 2.5.1 code, btw: the parameters for connection:open/1 changed a
bit.

Hope this helps.

Cheers,
Alex

On Tue, Jul 19, 2011 at 02:20:59PM -0700, James Aimonetti wrote:
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i> 
</I>&gt;<i> My setup is as follows: I have a channel per consumer, and I'm trying to
</I>&gt;<i> link the consumer to the channel so that if either dies, the other goes
</I>&gt;<i> down (most consumers are ephemeral and easy to restart, those that are
</I>&gt;<i> longer living trap exits).
</I>&gt;<i> 
</I>&gt;<i> However, when a consumer has a non-normal exit, the channel goes down,
</I>&gt;<i> but the exit signal bubbles up all the way to where *all* other channels
</I>&gt;<i> go down as well.
</I>&gt;<i> 
</I>&gt;<i> Any pointers how to link a consumer to its channel without taking the
</I>&gt;<i> whole tree of channels down?
</I>&gt;<i> 
</I>&gt;<i> This is with rabbitmq server and erlang-client 2.4.1 and r14b03.
</I>&gt;<i> 
</I>&gt;<i> Thanks!
</I>&gt;<i> 
</I>&gt;<i> James
</I>&gt;<i> 
</I>&gt;<i> - -- 
</I>&gt;<i> James Aimonetti
</I>&gt;<i> Distributed Systems Engineer / DJ MC_
</I>&gt;<i> 
</I>&gt;<i> 2600hz | <A HREF="http://2600hz.com">http://2600hz.com</A>
</I>&gt;<i> sip:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">james at 2600hz.com</A>
</I>&gt;<i> tel: 415.886.7905
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v1.4.10 (GNU/Linux)
</I>&gt;<i> Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org/">http://enigmail.mozdev.org/</A>
</I>&gt;<i> 
</I>&gt;<i> iQEcBAEBAgAGBQJOJfU6AAoJENc77s1OYoGg/LoH/jIA8jdA7nUsZC+hbTstmkxv
</I>&gt;<i> RkYg05yyB2qMp5yvoE54NL7U7LjpM6DZtCGrubbva5s9bYpRvQgQrO6XbAV17bTV
</I>&gt;<i> nEyY+31L2IpAxX2hFOjIpMqiQ85iMlXZ+zzHnQ5vnaKlxPuhlpgRdaMdX/0ca+8W
</I>&gt;<i> cMZF/FkNcX9Trwsz+XmOdKdKK0ctzZ7N4T6/5aIPzpObGBGuvZQG+b62txYf3x6Y
</I>&gt;<i> 5Y0vPXlIDcQrU9yZ7osSG9q2DuW6qzDL9zMBZ8M8UwZoDhLRUw4DxZO3PnI+FZJz
</I>&gt;<i> npJcpMeQXNopE6K1idEkFfVmB+XBgcS3a9FGlruuhiBrMLWWmpjpKBJaZ+CRPFU=
</I>&gt;<i> =/7L/
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014019.html">[rabbitmq-discuss] Channel takes everyone down?
</A></li>
	<LI>Next message: <A HREF="014050.html">[rabbitmq-discuss] Channel takes everyone down?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14047">[ date ]</a>
              <a href="thread.html#14047">[ thread ]</a>
              <a href="subject.html#14047">[ subject ]</a>
              <a href="author.html#14047">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
