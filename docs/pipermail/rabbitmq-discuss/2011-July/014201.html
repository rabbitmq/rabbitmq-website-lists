<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Frequently getting {badmatch, {error, einval} from one of my rabbimq nodes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Frequently%20getting%20%7Bbadmatch%2C%20%7Berror%2C%0A%20einval%7D%20from%20one%20of%20my%20rabbimq%20nodes&In-Reply-To=%3C20110727163850.GC3188%40dakota.eng.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014094.html">
   <LINK REL="Next"  HREF="014023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Frequently getting {badmatch, {error, einval} from one of my rabbimq nodes</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Frequently%20getting%20%7Bbadmatch%2C%20%7Berror%2C%0A%20einval%7D%20from%20one%20of%20my%20rabbimq%20nodes&In-Reply-To=%3C20110727163850.GC3188%40dakota.eng.vmware.com%3E"
       TITLE="[rabbitmq-discuss] Frequently getting {badmatch, {error, einval} from one of my rabbimq nodes">alexandru at rabbitmq.com
       </A><BR>
    <I>Wed Jul 27 17:38:50 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014094.html">[rabbitmq-discuss] Frequently getting {badmatch, {error, einval} from one of my rabbimq nodes
</A></li>
        <LI>Next message: <A HREF="014023.html">[rabbitmq-discuss] Management Plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14201">[ date ]</a>
              <a href="thread.html#14201">[ thread ]</a>
              <a href="subject.html#14201">[ subject ]</a>
              <a href="author.html#14201">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Chak,

I've been trying for a while, but I can't reproduce this.

That error is coming from deep inside Erlang's inet driver.  As far as I
can tell, the only way to get that error would be to call
prim_inet:async_recv/3 on a socket with a {packet, Packet} setting
different from 'raw'.  But this can't happen on any version of rabbit.

Could you give us a more detailed description of the program?  Is it a
plugin?  Is it doing anything special with the connection? (like setting
socket options after the connection is established) Is there any chance
we could see the code?

You mentioned it starts at the very beginning.  Does this mean the
problem goes away after some time?

Cheers,
Alex


On Thu, Jul 21, 2011 at 07:48:29PM -0700, Chak Hedik wrote:
&gt;<i> Hi Alex,
</I>&gt;<i> 
</I>&gt;<i> Seems like this error is still there and it seems like either it
</I>&gt;<i> occurred when worker entering the loop and send another message to the
</I>&gt;<i> same queue within the loop or occurred when function retry, means
</I>&gt;<i> function call itself for a retry (pretty much like loop also).
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Chak
</I>&gt;<i> 
</I>&gt;<i> On Jul 21, 6:40&#160;am, Chak Hedik &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">chakhe... at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; Hi Alex,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; *Ubuntu Server 11.04 64-Bit
</I>&gt;<i> &gt; *RabbitMQ 2.3.1 (Default ubuntu package)
</I>&gt;<i> &gt; *Erlang Client 2.3.1 (Default ubuntu package)
</I>&gt;<i> &gt; *Erlang R13B03 (Default ubuntu package)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Is there something in the server logs that corresponds to this error?
</I>&gt;<i> &gt; - That's the only thing appeared in the logs.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You say your other nodes don't have similar issues. &#160;Is there
</I>&gt;<i> &gt; something
</I>&gt;<i> &gt; special about this node?
</I>&gt;<i> &gt; - Nothing special, pretty much the same but handle more messages than
</I>&gt;<i> &gt; others. 1 worker handling 1 queue.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It is strange behaviour and it happen at the very beginning where the
</I>&gt;<i> &gt; worker up for the first time (no message in queue yet). I've created
</I>&gt;<i> &gt; another node and put this worker there and will wait and see if
</I>&gt;<i> &gt; similar error appear again or not today.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks for your reply.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Chak
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Jul 21, 5:14&#160;am, Alexandru Scvor&#355;ov &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexan... at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Hi Chak,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Could you please answer the following questions:
</I>&gt;<i> &gt; &gt; * What OS are you using?
</I>&gt;<i> &gt; &gt; * What version of RabbitMQ?
</I>&gt;<i> &gt; &gt; * What version of the Erlang client?
</I>&gt;<i> &gt; &gt; * What version of Erlang?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt; ** Reason for termination ==
</I>&gt;<i> &gt; &gt; &gt; ** {{badmatch,{error,einval}},
</I>&gt;<i> &gt; &gt; &gt; &#160; &#160; [{amqp_main_reader,handle_inet_async,2},
</I>&gt;<i> &gt; &gt; &gt; &#160; &#160; &#160;{gen_server,handle_msg,5},
</I>&gt;<i> &gt; &gt; &gt; &#160; &#160; &#160;{proc_lib,init_p_do_apply,3}]}
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Looks like something strange is taking down the socket, which in turn is
</I>&gt;<i> &gt; &gt; taking down the entire connection. &#160;If you have more than one
</I>&gt;<i> &gt; &gt; connection, the others should be fine.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Is there something in the server logs that corresponds to this error?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; You say your other nodes don't have similar issues. &#160;Is there something
</I>&gt;<i> &gt; &gt; special about this node?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Cheers,
</I>&gt;<i> &gt; &gt; Alex
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; On Wed, Jul 20, 2011 at 12:12:32AM -0700, Chak Hedik wrote:
</I>&gt;<i> &gt; &gt; &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt; I frequently getting this terminating error from one of my nodes :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt; ** Generic server &lt;0.28067.2&gt; terminating
</I>&gt;<i> &gt; &gt; &gt; ** Last message in was {inet_async,#Port&lt;0.15349&gt;,9049,
</I>&gt;<i> &gt; &gt; &gt; {ok,&lt;&lt;0,10,0,51,206&gt;&gt;}}
</I>&gt;<i> &gt; &gt; &gt; ** When Server state == {state,#Port&lt;0.15349&gt;,&lt;0.28063.2&gt;,&lt;0.28064.2&gt;,
</I>&gt;<i> &gt; &gt; &gt; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;{method,rabbit_framing_amqp_0_9_1},
</I>&gt;<i> &gt; &gt; &gt; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;{1,0,4}}
</I>&gt;<i> &gt; &gt; &gt; ** Reason for termination ==
</I>&gt;<i> &gt; &gt; &gt; ** {{badmatch,{error,einval}},
</I>&gt;<i> &gt; &gt; &gt; &#160; &#160; [{amqp_main_reader,handle_inet_async,2},
</I>&gt;<i> &gt; &gt; &gt; &#160; &#160; &#160;{gen_server,handle_msg,5},
</I>&gt;<i> &gt; &gt; &gt; &#160; &#160; &#160;{proc_lib,init_p_do_apply,3}]}
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt; While several other nodes with the same setup didn't have the same
</I>&gt;<i> &gt; &gt; &gt; issue. May I know what it means and willl it affect my queues?How do I
</I>&gt;<i> &gt; &gt; &gt; fix this?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt; Thank,
</I>&gt;<i> &gt; &gt; &gt; Chak
</I>&gt;<i> &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; &gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; &gt; &gt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014094.html">[rabbitmq-discuss] Frequently getting {badmatch, {error, einval} from one of my rabbimq nodes
</A></li>
	<LI>Next message: <A HREF="014023.html">[rabbitmq-discuss] Management Plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14201">[ date ]</a>
              <a href="thread.html#14201">[ thread ]</a>
              <a href="subject.html#14201">[ subject ]</a>
              <a href="author.html#14201">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
