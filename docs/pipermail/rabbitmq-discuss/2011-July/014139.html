<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Slow shutdown issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Slow%20shutdown%20issue&In-Reply-To=%3C7E8DA6E9-4761-450F-A54D-631FEFF1D753%40gilt.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014096.html">
   <LINK REL="Next"  HREF="014102.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Slow shutdown issue</H1>
    <B>Raymond Murthi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Slow%20shutdown%20issue&In-Reply-To=%3C7E8DA6E9-4761-450F-A54D-631FEFF1D753%40gilt.com%3E"
       TITLE="[rabbitmq-discuss] Slow shutdown issue">rmurthi at gilt.com
       </A><BR>
    <I>Sun Jul 24 22:02:57 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014096.html">[rabbitmq-discuss] Slow shutdown issue
</A></li>
        <LI>Next message: <A HREF="014102.html">[rabbitmq-discuss] Slow shutdown issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14139">[ date ]</a>
              <a href="thread.html#14139">[ thread ]</a>
              <a href="subject.html#14139">[ subject ]</a>
              <a href="author.html#14139">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Marek/Matthew, 

Thank you for your replies. They have been really helpful for me. I did further tests and everything looks much clearer now.

@Marek: yup, I explicitly overloaded the queue to understand where messages go after the memory is used up. I suppose it could also happen when all consumers somehow stop consuming or in faster publisher/slow consumer scenarios. We would like to put some monitoring in place to prevent that from happening though.  

@Matthew: Does declaring queue as exclusive mean that the broker can only accept one connection to the queue? If so, isn't it preventing both sender and consumer to connect to the queue at the same time? I tried and as expected, I got an exception for doing so.


-Ray

On Jul 22, 2011, at 4:59 AM, Marek Majkowski wrote:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I don't know the answers to all your questions.
</I>&gt;<i> 
</I>&gt;<i> On Thu, Jul 21, 2011 at 20:18, Raymond Murthi &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rmurthi at gilt.com</A>&gt; wrote:
</I>&gt;&gt;<i> I am pretty new on RabbitMQ and I am trying to do a stress test on RabbitMQ (v. 2.5.1) using the following properties: 1kb persistent message, nondurable queue, and without any ready consumer (that is, just writing to the queue). However, every time I overload the RAM (13.7GB high watermark) and force RabbitMQ to write to disk, I always experience a very long wait time whenever I want to shutdown the server/stopping the app/purging the queue. The wait time could be over an hour depending on the number of messages I sent (I sent over 5 millions messages). I  also notice that RabbitMQ tries to dump the messages from the memory to the disk (under /msg_store_transient) - since nothing is consumed.
</I>&gt;<i> 
</I>&gt;<i> This is quite a hard thing for rabbit - you're using it as a database
</I>&gt;<i> rather than messaging system!
</I>&gt;<i> 
</I>&gt;&gt;<i> Is it a common behavior? I read the documentation and it looks like it is (but isn't it too long?).
</I>&gt;&gt;<i> How to kill the process immediately?
</I>&gt;<i> 
</I>&gt;<i> I can only suggest what you already know: queue_purge or queue_delete.
</I>&gt;<i> 
</I>&gt;&gt;<i> And why are messages stored under /msg_store_transient instead of /msg_store_persistent? What  is the difference between the two directories?
</I>&gt;<i> 
</I>&gt;<i> You said you are sending messages to a nondurable queue - so in a case
</I>&gt;<i> of broker shutdown, the queue will be lost. If you want to use
</I>&gt;<i> persistance, you need to send persistent messages to a durable queue.
</I>&gt;<i> That's why you see messages in the msg_store_transient.
</I>&gt;<i> 
</I>&gt;<i> I would be interested to hear what are the results of your test for
</I>&gt;<i> persistent/durable messages!
</I>&gt;<i> (though rabbit will probably initally be slower)
</I>&gt;<i> 
</I>&gt;&gt;<i> I would like to understand on the memory/disk usage and how messages are stored.
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i>  Marek
</I>
Thanks, 
-Ray

</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014096.html">[rabbitmq-discuss] Slow shutdown issue
</A></li>
	<LI>Next message: <A HREF="014102.html">[rabbitmq-discuss] Slow shutdown issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14139">[ date ]</a>
              <a href="thread.html#14139">[ thread ]</a>
              <a href="subject.html#14139">[ subject ]</a>
              <a href="author.html#14139">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
