<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] unexplained broker shutdown
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20unexplained%20broker%20shutdown&In-Reply-To=%3C20110718122048.GA2614%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013959.html">
   <LINK REL="Next"  HREF="013950.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] unexplained broker shutdown</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20unexplained%20broker%20shutdown&In-Reply-To=%3C20110718122048.GA2614%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] unexplained broker shutdown">matthew at rabbitmq.com
       </A><BR>
    <I>Mon Jul 18 13:20:48 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="013959.html">[rabbitmq-discuss] unexplained broker shutdown
</A></li>
        <LI>Next message: <A HREF="013950.html">[rabbitmq-discuss] unexplained broker shutdown
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13960">[ date ]</a>
              <a href="thread.html#13960">[ thread ]</a>
              <a href="subject.html#13960">[ subject ]</a>
              <a href="author.html#13960">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Jul 18, 2011 at 02:04:13PM +0200, PADIOU Pierre-Marie (MORPHO) wrote:
&gt;<i> Can the broker make the decision to page messages even if there is plenty of ram left (say 30GB out of 40GB?), just on its estimation?
</I>
Yes.

The worst possible implementation of paging would be to wait until all
RAM is used up, and then write out potentially millions of messages.

Essentially, Rabbit has to decide how to allocate RAM (and actually more
importantly, disk bandwidth) to queues. In many ways, it tries to
prioritise the allocation of RAM to queues that are very active (i.e.
lots of msgs being received by and/or sent by the queue) because such
queues would not be able to cope with the performance hit of being
written to disk.

To avoid the crow-bar effect of suddenly having to write out millions of
messages, Rabbit starts writing out messages fairly early on. In most
cases, should RAM remain relatively plentiful, these msgs will be only
written async, and never read, because a copy will remain in RAM until
memory pressure is such that the RAM copy has to be discarded.

Due to taking into account the effects of garbage collection and other
issues, it's possible that Rabbit, with default configuration, will
start paging out messages to disk when it's using only 8% of the RAM
installed in the machine.

The goal is for Rabbit to try and stay as responsive as possible in all
its operations for as long as possible, as memory gets tighter and
tighter. Once that goal fails (i.e. we have to block publishers because,
ultimately, they're publishing msgs faster than we can write them to
disk), the next goal is to ensure that Rabbit will always be able to
recover (assuming disk space is plentiful) to the point where it will be
able to accept the next message sent to it.

Matthew
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013959.html">[rabbitmq-discuss] unexplained broker shutdown
</A></li>
	<LI>Next message: <A HREF="013950.html">[rabbitmq-discuss] unexplained broker shutdown
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13960">[ date ]</a>
              <a href="thread.html#13960">[ thread ]</a>
              <a href="subject.html#13960">[ subject ]</a>
              <a href="author.html#13960">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
