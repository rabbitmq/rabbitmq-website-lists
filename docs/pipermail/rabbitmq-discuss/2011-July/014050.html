<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Channel takes everyone down?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Channel%20takes%20everyone%20down%3F&In-Reply-To=%3C4E274998.4000602%402600hz.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014047.html">
   <LINK REL="Next"  HREF="014056.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Channel takes everyone down?</H1>
    <B>James Aimonetti</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Channel%20takes%20everyone%20down%3F&In-Reply-To=%3C4E274998.4000602%402600hz.com%3E"
       TITLE="[rabbitmq-discuss] Channel takes everyone down?">james at 2600hz.com
       </A><BR>
    <I>Wed Jul 20 22:33:12 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014047.html">[rabbitmq-discuss] Channel takes everyone down?
</A></li>
        <LI>Next message: <A HREF="014056.html">[rabbitmq-discuss] Channel takes everyone down?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14050">[ date ]</a>
              <a href="thread.html#14050">[ thread ]</a>
              <a href="subject.html#14050">[ subject ]</a>
              <a href="author.html#14050">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Alex,

Thanks for the response. I did indeed have a solution similar to Run2(),
but was finding channels were leaking, in that the third party
monitoring process wasn't shutting the channels down when the consumer
exited.

Linking the two was my quick solution to the problem but I guess not
feasible at the moment. I'll re-work my monitoring code and see if I
can't sniff out the leak.

Thanks again,

James

On 07/20/2011 02:00 PM, Alexandru Scvor&#355;ov wrote:
&gt;<i> Hi James,
</I>&gt;<i> 
</I>&gt;&gt;<i> However, when a consumer has a non-normal exit, the channel goes down,
</I>&gt;&gt;<i> but the exit signal bubbles up all the way to where *all* other channels
</I>&gt;&gt;<i> go down as well.
</I>&gt;<i> 
</I>&gt;<i> I've just tried it and you're right: sending a non-normal exit to a
</I>&gt;<i> channel will cause the connection to go down, taking all the other
</I>&gt;<i> channels with it.
</I>&gt;<i> 
</I>&gt;<i> For what it's worth, this also happens with 2.5.1 and we don't have any
</I>&gt;<i> plans to change this behaviour right now.  It happens because channels
</I>&gt;<i> don't trap exits.
</I>&gt;<i> 
</I>&gt;<i> I'm afraid there isn't anyway to do it automatically.  You could start
</I>&gt;<i> a separate process that traps exits and is linked to your consumer.
</I>&gt;<i> When you receive an exit from the consumer, close its channel cleanly.
</I>&gt;<i> So, a very basic supervisor.
</I>&gt;<i> 
</I>&gt;<i> Maybe something like this:
</I>&gt;<i>   <A HREF="https://gist.github.com/1095910">https://gist.github.com/1095910</A>
</I>&gt;<i> 
</I>&gt;<i> Run() is what I think you're doing.  Run2() starts up a separate thread
</I>&gt;<i> to monitor the consumer and close its channel when the time comes.
</I>&gt;<i> That's 2.5.1 code, btw: the parameters for connection:open/1 changed a
</I>&gt;<i> bit.
</I>&gt;<i> 
</I>&gt;<i> Hope this helps.
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> Alex
</I>&gt;<i> 
</I>&gt;<i> On Tue, Jul 19, 2011 at 02:20:59PM -0700, James Aimonetti wrote:
</I>&gt;<i> My setup is as follows: I have a channel per consumer, and I'm trying to
</I>&gt;<i> link the consumer to the channel so that if either dies, the other goes
</I>&gt;<i> down (most consumers are ephemeral and easy to restart, those that are
</I>&gt;<i> longer living trap exits).
</I>&gt;<i> 
</I>&gt;<i> However, when a consumer has a non-normal exit, the channel goes down,
</I>&gt;<i> but the exit signal bubbles up all the way to where *all* other channels
</I>&gt;<i> go down as well.
</I>&gt;<i> 
</I>&gt;<i> Any pointers how to link a consumer to its channel without taking the
</I>&gt;<i> whole tree of channels down?
</I>&gt;<i> 
</I>&gt;<i> This is with rabbitmq server and erlang-client 2.4.1 and r14b03.
</I>&gt;<i> 
</I>&gt;<i> Thanks!
</I>&gt;<i> 
</I>&gt;<i> James
</I>&gt;<i> 
</I>_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>

- -- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | <A HREF="http://2600hz.com">http://2600hz.com</A>
sip:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">james at 2600hz.com</A>
tel: 415.886.7905
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org/">http://enigmail.mozdev.org/</A>

iQEcBAEBAgAGBQJOJ0mYAAoJENc77s1OYoGgX60H/iY53s3e2MrlWtEyK7CQgePL
Bltt1OhOq2Ag2ohsz8HOf8G8X9VbSbeAwx5hJdKpZD+gF1MGuXIc55AClGxQRnD4
CTewQZVJbB6b+ClkiRXBo4yllwmTLzA/MdKAycQSpcmNF6yRZxcFwqsOmXUk+p52
xhxetuPjP1TVpUUTFIfitqdz6NDxd659nnx4YIAoTI1A37FAwpmwZtCvJFCa12ug
oVG9hwsMoP9Dz+N6GHr36p8IQfSeeQOaR/ZCaJESQkHAvqx9Jmior6P+YZyD6Th3
c7/Os2GOGrP6rUv9i6YytgA1coLDOKTLn1c6HZfSwzck7GpkFZtgMlodMibyoLM=
=1fsj
-----END PGP SIGNATURE-----
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014047.html">[rabbitmq-discuss] Channel takes everyone down?
</A></li>
	<LI>Next message: <A HREF="014056.html">[rabbitmq-discuss] Channel takes everyone down?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14050">[ date ]</a>
              <a href="thread.html#14050">[ thread ]</a>
              <a href="subject.html#14050">[ subject ]</a>
              <a href="author.html#14050">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
