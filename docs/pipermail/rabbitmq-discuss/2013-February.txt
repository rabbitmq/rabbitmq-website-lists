From oldhomelh at gmail.com  Fri Feb  1 01:44:35 2013
From: oldhomelh at gmail.com (andy lin)
Date: Thu, 31 Jan 2013 17:44:35 -0800 (PST)
Subject: [rabbitmq-discuss] why a flowing Connection can make all Connection
	blocked
Message-ID: <1359683075316-24811.post@n5.nabble.com>

<http://rabbitmq.1065348.n5.nabble.com/file/n24811/ss.jpg> 
the connection is in the state of flowing ,as far as I know, the state can
only influence one connection,but when it occur,my all connection can't
receive and send message .So it looks like that the rabbitmq server can't
work.  

<http://rabbitmq.1065348.n5.nabble.com/file/n24811/333.jpg> 

in the picture ,you can see no message will be received , so I doubt that
the phenomenon doesn't fit the rabbitmq flow mechanism and why?  
Also ,I have a question that if producer and consumer use a common flowing
connection,it means the consumer are  controlled too ,that is  to say , the
consumer can't receive message any more?




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/why-a-flowing-Connection-can-make-all-Connection-blocked-tp24811.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From aggarwalsandeep at optonline.net  Fri Feb  1 04:05:36 2013
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Thu, 31 Jan 2013 20:05:36 -0800 (PST)
Subject: [rabbitmq-discuss] HA Proxy setup on CentOS Linux
Message-ID: <6a731cf3-c9ab-4c88-8bc8-5de9ea6ea15a@googlegroups.com>

Hello -

I'm trying to make use HA Proxy to provide for auto fail-over and load 
balancing between my clustered nodes. I've got my RabbitMQ cluster setup 
all good and the mirrored queues are working fine. However, I'm running 
into problems while trying to make HA proxy work on my Linux server (CentOS 
5.8). 

Basically, I was able to download the HA proxy source files and compile 
them on the Linux server. But when I'm trying to run the program, it does 
not seem to be listening on the expected ports. 

Does someone has any experience working on such a setup?

Thanks,
Sandy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130131/401189d4/attachment.htm>

From james.r.carr at gmail.com  Fri Feb  1 07:24:50 2013
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 1 Feb 2013 01:24:50 -0600
Subject: [rabbitmq-discuss] Problem installing RabbitMQ with Puppet on
 CentOS 6.2
In-Reply-To: <506EAC55.7040003@rabbitmq.com>
References: <5a61a2fa-495c-49dd-8345-d6a591ea2832@googlegroups.com>
	<506EAC55.7040003@rabbitmq.com>
Message-ID: <CAJreXKCEDVDY+6-U3uJHSq8HA02TJewGEvP4pJyz3gwHqBnrCA@mail.gmail.com>

I thought I'd point out the original author solved his problems:
http://serverfault.com/questions/434942/veewee-vagrant-puppet-erlang-and-rabbitmq

Only posting this on the list to help others who come across it as I
had the exact same problem this evening. :)


Thanks,
James


On Fri, Oct 5, 2012 at 4:45 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Hmm. There's nothing very obvious that I can think of. I've looked in the
> OTP source and that message really only appears if HOME is not set.
>
> Things you might try:
>
> * Run /usr/lib/rabbitmq/bin/rabbitmq-plugins instead, to remove a wrapper
> script
>
> * Edit /usr/lib/rabbitmq/bin/rabbitmq-plugins to insert "echo $HOME" just
> before "exec erl", see if it's really set at that point.
>
> * If all else fails, edit the enabled plugins file directly rather than
> invoking rabbitmq-plugins. Set the contents of /etc/rabbitmq/enabled_plugins
> to exactly the string:
>
> [rabbitmq_management].
>
> including the full stop.
>
> Cheers, Simon
>
>
> On 05/10/12 07:05, Tobias Wissm?ller wrote:
>>
>> Hi Everyone,
>>
>> I encounter a strange problem when applying my puppet module I have
>> created for installing RabbitMQ. To be more precise, I encounter the
>> problem when enabling the plugins.
>>
>> The relevant resources look as follows:
>>
>> |$version = "2.8.7"
>> $url     =
>> "http://www.rabbitmq.com/releases/rabbitmq-server/v${version}/rabbitmq-server-${version}-1.noarch.rpm"
>>
>> package{"erlang":
>>      ensure => "present",
>> }
>>
>> package{"rabbitmq-server":
>>      provider => "rpm",
>>      source   => $url,
>>      require  => Package["erlang"]
>> }
>>
>> exec{"rabbitmq-plugins":
>>      path    => "/usr/bin:/usr/sbin:/bin",
>>      command => "rabbitmq-plugins enable rabbitmq_management",
>>      require => Package["rabbitmq-server"]
>> }|
>>
>>
>> The error I get:
>>
>> |/Stage[main]/Rabbitmq/Exec[rabbitmq-plugins]/returns: erlexec: HOME must
>> be set|
>>
>> |/Stage[main]/Rabbitmq/Service[rabbitmq-server]: Dependency
>> Exec[rabbitmq-plugins] has failures: true
>> |
>>
>> The thing is, that HOME is set. Have checked that during a puppet run by
>> creating an exec resource to echo HOME.
>>
>> When I log into the box that I create with veewee and vagrant, I can
>> execute "rabbitmq-plugins enable rabbitmq_management" without any
>> problems. But I always get the error from within puppet.
>>
>> Starting rabbitmq-server leaves me with the following:
>>
>> |[{pid,2834},
>> {running_applications,[{rabbit,"RabbitMQ","2.8.7"},
>>                      {ssl,"Erlang/OTP SSL application","4.1.6"},
>>                      {public_key,"Public key infrastructure","0.13"},
>>                      {crypto,"CRYPTO version 2","2.0.4"},
>>                      {mnesia,"MNESIA  CXC 138 12","4.5"},
>>                      {os_mon,"CPO  CXC 138 46","2.2.7"},
>>                      {sasl,"SASL  CXC 138 11","2.1.10"},
>>                      {stdlib,"ERTS  CXC 138 10","1.17.5"},
>>                      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>> {os,{unix,linux}},
>> {erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1]
>> [async-threads:30] [kernel-poll:true]\n"},
>> {memory,[{total,24993120},
>>        {processes,10328496},
>>        {processes_used,10321296},
>>        {system,14664624},
>>        {atom,1175905},
>>        {atom_used,1143841},
>>        {binary,17192},
>>        {code,11416020},
>>        {ets,766168}]},
>> {vm_memory_high_watermark,0.4},
>> {vm_memory_limit,205851852},
>> {disk_free_limit,1000000000},
>> {disk_free,7089795072},
>> {file_descriptors,[{total_limit,924},
>>                  {total_used,4},
>>                  {sockets_limit,829},
>>                  {sockets_used,2}]},
>> {processes,[{limit,1048576},{used,131}]},
>> {run_queue,0},
>> {uptime,6}]|
>>
>>
>> The whole puppet manifest can be found under
>>
>> https://github.com/tobias-wissmueller/dev_ops_central/blob/master/modules/rabbitmq/manifests/init.pp
>>
>> Also have posted this problem over at Serverfault
>>
>> <http://serverfault.com/questions/434942/veewee-vagrant-puppet-erlang-and-rabbitmq>.
>>
>>
>> Any help is highly appreciated since I am totally stuck here.
>>
>> Thanks a lot!
>>
>> Cheers,
>> Tobi
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From danbarua at gmail.com  Fri Feb  1 10:18:41 2013
From: danbarua at gmail.com (Dan B)
Date: Fri, 1 Feb 2013 02:18:41 -0800 (PST)
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
Message-ID: <5ecae15e-8684-40b0-a485-6e8bc1a78bc1@googlegroups.com>

What happens when you close your application, do the queues get cleaned up 
or do they stick around?

On Friday, 25 January 2013 14:59:08 UTC, Max E. Kuznecov wrote:
>
> Hello
>
> In my application I have a pool of temporary queues, used for RPC-like 
> messaging.
> Queues are created with flags durable and exclusive.
>
> I'm observing a constant growth in queues memory as the time passes 
> despite the fact rabbitmqctl shows zeros in messages column.
> The output looks like this:
>
> rabbitmqctl list_queues memory name messages consumers | sort -rn | head
> 10772176        amq.gen-qnA00cF1K0o2vq1KyO9_yQ  0       1
> 10772104        amq.gen-os12dLIRtGJYqEwG7xpZOA  0       1
> 10771888        amq.gen-YJkYswabMY0eUQi057xdHA  1       0
> 10771888        amq.gen-X8_I9wVBb6H2bHb_yt5zrw  0       0
> 10771888        amq.gen-wLAXnQjySs9QgVlaZOlXaw  0       0
> ....
>
> And this number just continues to grow until memory high watermark is hit.
> Maybe I'm missing something but how is this possible? Message rate is 
> about 50 msg/s, it is not so high.
> Is it possible somehow to find out why is memory not being freed?
>
> rabbitmq version 3.0.1 on linux x86_64 box with erlang client API.
>
> Thank you.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130201/a1e0d001/attachment.htm>

From simon at rabbitmq.com  Fri Feb  1 10:31:29 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 01 Feb 2013 10:31:29 +0000
Subject: [rabbitmq-discuss] Problem installing RabbitMQ with Puppet on
 CentOS 6.2
In-Reply-To: <CAJreXKCEDVDY+6-U3uJHSq8HA02TJewGEvP4pJyz3gwHqBnrCA@mail.gmail.com>
References: <5a61a2fa-495c-49dd-8345-d6a591ea2832@googlegroups.com>
	<506EAC55.7040003@rabbitmq.com>
	<CAJreXKCEDVDY+6-U3uJHSq8HA02TJewGEvP4pJyz3gwHqBnrCA@mail.gmail.com>
Message-ID: <510B9981.3030803@rabbitmq.com>

Ah, thanks for the pointer.

Hmm, maybe we should explicitly set HOME in these scripts...

Cheers, Simon

On 01/02/13 07:24, James Carr wrote:
> I thought I'd point out the original author solved his problems:
> http://serverfault.com/questions/434942/veewee-vagrant-puppet-erlang-and-rabbitmq
>
> Only posting this on the list to help others who come across it as I
> had the exact same problem this evening. :)
>
>
> Thanks,
> James
>
>
> On Fri, Oct 5, 2012 at 4:45 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>> Hmm. There's nothing very obvious that I can think of. I've looked in the
>> OTP source and that message really only appears if HOME is not set.
>>
>> Things you might try:
>>
>> * Run /usr/lib/rabbitmq/bin/rabbitmq-plugins instead, to remove a wrapper
>> script
>>
>> * Edit /usr/lib/rabbitmq/bin/rabbitmq-plugins to insert "echo $HOME" just
>> before "exec erl", see if it's really set at that point.
>>
>> * If all else fails, edit the enabled plugins file directly rather than
>> invoking rabbitmq-plugins. Set the contents of /etc/rabbitmq/enabled_plugins
>> to exactly the string:
>>
>> [rabbitmq_management].
>>
>> including the full stop.
>>
>> Cheers, Simon
>>
>>
>> On 05/10/12 07:05, Tobias Wissm?ller wrote:
>>>
>>> Hi Everyone,
>>>
>>> I encounter a strange problem when applying my puppet module I have
>>> created for installing RabbitMQ. To be more precise, I encounter the
>>> problem when enabling the plugins.
>>>
>>> The relevant resources look as follows:
>>>
>>> |$version = "2.8.7"
>>> $url     =
>>> "http://www.rabbitmq.com/releases/rabbitmq-server/v${version}/rabbitmq-server-${version}-1.noarch.rpm"
>>>
>>> package{"erlang":
>>>       ensure => "present",
>>> }
>>>
>>> package{"rabbitmq-server":
>>>       provider => "rpm",
>>>       source   => $url,
>>>       require  => Package["erlang"]
>>> }
>>>
>>> exec{"rabbitmq-plugins":
>>>       path    => "/usr/bin:/usr/sbin:/bin",
>>>       command => "rabbitmq-plugins enable rabbitmq_management",
>>>       require => Package["rabbitmq-server"]
>>> }|
>>>
>>>
>>> The error I get:
>>>
>>> |/Stage[main]/Rabbitmq/Exec[rabbitmq-plugins]/returns: erlexec: HOME must
>>> be set|
>>>
>>> |/Stage[main]/Rabbitmq/Service[rabbitmq-server]: Dependency
>>> Exec[rabbitmq-plugins] has failures: true
>>> |
>>>
>>> The thing is, that HOME is set. Have checked that during a puppet run by
>>> creating an exec resource to echo HOME.
>>>
>>> When I log into the box that I create with veewee and vagrant, I can
>>> execute "rabbitmq-plugins enable rabbitmq_management" without any
>>> problems. But I always get the error from within puppet.
>>>
>>> Starting rabbitmq-server leaves me with the following:
>>>
>>> |[{pid,2834},
>>> {running_applications,[{rabbit,"RabbitMQ","2.8.7"},
>>>                       {ssl,"Erlang/OTP SSL application","4.1.6"},
>>>                       {public_key,"Public key infrastructure","0.13"},
>>>                       {crypto,"CRYPTO version 2","2.0.4"},
>>>                       {mnesia,"MNESIA  CXC 138 12","4.5"},
>>>                       {os_mon,"CPO  CXC 138 46","2.2.7"},
>>>                       {sasl,"SASL  CXC 138 11","2.1.10"},
>>>                       {stdlib,"ERTS  CXC 138 10","1.17.5"},
>>>                       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>>> {os,{unix,linux}},
>>> {erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1]
>>> [async-threads:30] [kernel-poll:true]\n"},
>>> {memory,[{total,24993120},
>>>         {processes,10328496},
>>>         {processes_used,10321296},
>>>         {system,14664624},
>>>         {atom,1175905},
>>>         {atom_used,1143841},
>>>         {binary,17192},
>>>         {code,11416020},
>>>         {ets,766168}]},
>>> {vm_memory_high_watermark,0.4},
>>> {vm_memory_limit,205851852},
>>> {disk_free_limit,1000000000},
>>> {disk_free,7089795072},
>>> {file_descriptors,[{total_limit,924},
>>>                   {total_used,4},
>>>                   {sockets_limit,829},
>>>                   {sockets_used,2}]},
>>> {processes,[{limit,1048576},{used,131}]},
>>> {run_queue,0},
>>> {uptime,6}]|
>>>
>>>
>>> The whole puppet manifest can be found under
>>>
>>> https://github.com/tobias-wissmueller/dev_ops_central/blob/master/modules/rabbitmq/manifests/init.pp
>>>
>>> Also have posted this problem over at Serverfault
>>>
>>> <http://serverfault.com/questions/434942/veewee-vagrant-puppet-erlang-and-rabbitmq>.
>>>
>>>
>>> Any help is highly appreciated since I am totally stuck here.
>>>
>>> Thanks a lot!
>>>
>>> Cheers,
>>> Tobi
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Feb  1 10:41:42 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 01 Feb 2013 10:41:42 +0000
Subject: [rabbitmq-discuss] why a flowing Connection can make all
 Connection blocked
In-Reply-To: <1359683075316-24811.post@n5.nabble.com>
References: <1359683075316-24811.post@n5.nabble.com>
Message-ID: <510B9BE6.8050001@rabbitmq.com>

On 01/02/13 01:44, andy lin wrote:
> <http://rabbitmq.1065348.n5.nabble.com/file/n24811/ss.jpg>
> the connection is in the state of flowing ,as far as I know, the state can
> only influence one connection,but when it occur,my all connection can't
> receive and send message .So it looks like that the rabbitmq server can't
> work.

The flow control you show there will only restrict one connection at a 
time, yes. Note that in general per-connection flow control should not 
block for long periods of time, it should be more of a rate-limiting thing.

If you are seeing all connections block, has the memory or disk alarm 
gone off? See http://www.rabbitmq.com/memory.html

> <http://rabbitmq.1065348.n5.nabble.com/file/n24811/333.jpg>
>
> in the picture ,you can see no message will be received , so I doubt that
> the phenomenon doesn't fit the rabbitmq flow mechanism and why?

I can't tell what that picture is intended to show.

> Also ,I have a question that if producer and consumer use a common flowing
> connection,it means the consumer are  controlled too ,that is  to say , the
> consumer can't receive message any more?

Yes. So in general you should use different connections for sending and 
receiving messages.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Fri Feb  1 10:44:47 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Feb 2013 10:44:47 +0000
Subject: [rabbitmq-discuss] hostname change
In-Reply-To: <2E74050D-BD49-4800-BE80-F40ABB31F78E@dushin.net>
References: <1359383662020-24717.post@n5.nabble.com>
	<2E74050D-BD49-4800-BE80-F40ABB31F78E@dushin.net>
Message-ID: <510B9C9F.6000401@rabbitmq.com>

Fred,

On 29/01/13 19:56, Dushin Fred wrote:
> I am using the RABBITMQ_NODENAME environment variable, but that
> appears to only set the first part of the node name.

RABBITMQ_NODENAME can contain the full node name, and indeed generally 
should since otherwise...

> The directory name (under ${RABBITMQ_MNESIA_BASE}) does not contain
> the @$HOSTNAME suffix, but if I do a recursive grep through the
> directory, I still find artifacts with my previous host name.

...which is bad since a change in hostname would result in rabbit 
attempting to work with an mnesia db that is tied to a different node 
(i.e. containing the old hostname).

> And a hostname reset (and
> reboot) results in a fresh DB, even if I start the broker by
> explicitly setting HOSTNAME to the previous value.

That is odd. The startup scripts construct the node name from $HOSTNAME 
if the latter is set. See 
http://hg.rabbitmq.com/rabbitmq-server/file/fefbea5d28eb/scripts/rabbitmq-env#l37. 
And provided you haven't also set RABBITMQ_NODENAME, which would 
override that setting.

And a quick experiment confirms that is working as expected.

Note though that $HOSTNAME must be resolvable, or you'll see something like

ERROR: epmd error for host "oldhost": nxdomain (non-existing domain)

on startup.


Regards,

Matthias.

From michael.s.klishin at gmail.com  Fri Feb  1 11:17:24 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 1 Feb 2013 15:17:24 +0400
Subject: [rabbitmq-discuss] How to debug queue memory leak
In-Reply-To: <5ecae15e-8684-40b0-a485-6e8bc1a78bc1@googlegroups.com>
References: <b428c3a8-1a26-40a8-a5aa-8bac4446d350@googlegroups.com>
	<5ecae15e-8684-40b0-a485-6e8bc1a78bc1@googlegroups.com>
Message-ID: <CAE3HoVQ_geqaXY=A6MFf7CCmOFd3pXTW+zB-x6jX0xj5i3rn-A@mail.gmail.com>

2013/2/1 Dan B <danbarua at gmail.com>

> What happens when you close your application, do the queues get cleaned up
> or do they stick around?


It depends on queue parameters. Whether messages stick around depends on
publishing settings.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130201/da5bfe6f/attachment.htm>

From dev440 at gmail.com  Fri Feb  1 13:09:18 2013
From: dev440 at gmail.com (chetan dev)
Date: Fri, 1 Feb 2013 18:39:18 +0530
Subject: [rabbitmq-discuss] Regarding Unack messages
Message-ID: <CAB0ZxM5quvP5=A+OQFmfCSGhSQatFxx5TmCqCw_fz7DnmgGaNw@mail.gmail.com>

Hi,

Suppose there are  few messages and rabbitmq consumer fetches them one by
one but they are left  unacknowledged.
Connection remains open. When all the messages are processed
without acknowledgement, rabbitmq consumer stops fetching other messages
from the queue

How do i handle such situation



Thanks

-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130201/1041477e/attachment.htm>

From ask at rabbitmq.com  Fri Feb  1 13:14:16 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Fri, 1 Feb 2013 13:14:16 +0000
Subject: [rabbitmq-discuss] using rabbitmq to rendevous unrelated
	processes
In-Reply-To: <CA+QY9tu5+0kWdppXtrZ+N+82Rm9GGNLfb6dpKN7MA-XCejpKXg@mail.gmail.com>
References: <CA+QY9tu5+0kWdppXtrZ+N+82Rm9GGNLfb6dpKN7MA-XCejpKXg@mail.gmail.com>
Message-ID: <9538E1F3-3D8A-483E-BB3F-FE487254E8E4@rabbitmq.com>


On Jan 31, 2013, at 5:09 PM, E R <pc88mxer at gmail.com> wrote:

> I'm wondering if I can use rabbitmq to solve this problem...
> 
> A web client makes a web request which initiates a background server job to perform some work. The client wants to get the result of the server job, but the initial connection might timeout or get broken in which case the web client will re-connect to wait for the result. I want the server job to be able to put the result of the job some place where it can be picked up by the web client at its convenience, and I don't want the web client to have to busy wait for the result.
> 
> Note that is it possible that the web client never picks up the result as well as the job never creating a result, so I need a way to release any created resources after a certain time limit (ie. the client knows that if it doesn't get a result after X minutes it should make a fresh request.)
> 

Hey E,

If you're using Python there's a great plug-in for Celery called Jobtastic:
http://policystat.github.com/jobtastic/

Even if you're not using Python or Celery you could check it out for inspiration.

You *can* accomplish this by using one queue for every job, and declare the queues with the x-expires argument so that if no one is trying to retrieve the result, the queues are removed after some time.

This can be a problem if you have millions (or even hundreds of thousands) of jobs at the same time,
as it means there'll be equally many queues.


Currently I think the best solution here is to store the result in the database.
If you don't want to poll you can create a single 'notification' queue for anyone waiting for a result
(pseudocode below), but chances are you will want to use async javascript on the web to
poll in the background anyway:



An implementation could be:

def wait_for(job_id):
    exchange_name = 'result_notify'
    exchange_declare(exchange_name, type='direct')
    my_notifiy_queue = 'result_notify.%s' % (process_id, ))
    queue_declare(my_notify_queue), auto_delete=True)
    queue_bind(my_notify_queue, exchange_name, str(job_id))

    if result_in_database(job_id):
       return retrieve_result(job_id)
    else:
       basic_consume(my_notify_queue, callback)
       if wait_for_notification(job_id):
           return retrieve_result(job_id)
    

From videlalvaro at gmail.com  Fri Feb  1 13:14:40 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 1 Feb 2013 14:14:40 +0100
Subject: [rabbitmq-discuss] Regarding Unack messages
In-Reply-To: <CAB0ZxM5quvP5=A+OQFmfCSGhSQatFxx5TmCqCw_fz7DnmgGaNw@mail.gmail.com>
References: <CAB0ZxM5quvP5=A+OQFmfCSGhSQatFxx5TmCqCw_fz7DnmgGaNw@mail.gmail.com>
Message-ID: <CAMcAHLV16RdoP-Z0=XY1m9wLi5s1dz=CJN==x_sxJEJVPuEukw@mail.gmail.com>

I'm not sure I understand your question, but I guess you might want to take
a look at basic.qos and prefetch count

http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos

Regards,

Alvaro


On Fri, Feb 1, 2013 at 2:09 PM, chetan dev <dev440 at gmail.com> wrote:

> Hi,
>
> Suppose there are  few messages and rabbitmq consumer fetches them one by
> one but they are left  unacknowledged.
> Connection remains open. When all the messages are processed
> without acknowledgement, rabbitmq consumer stops fetching other messages
> from the queue
>
> How do i handle such situation
>
>
>
> Thanks
>
> --
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130201/7f3fca18/attachment.htm>

From tim+rabbitmq.com at coote.org  Fri Feb  1 13:29:29 2013
From: tim+rabbitmq.com at coote.org (Tim Coote)
Date: Fri, 1 Feb 2013 13:29:29 +0000
Subject: [rabbitmq-discuss] rabbitmq on yocto/openembedded
In-Reply-To: <CAMcAHLW-Kj1kP8v6M1uy93AUm+DbJ5tpnnfb+j5yOsUa8okhEg@mail.gmail.com>
References: <EB217F54-482B-4411-904F-8EFF6C111BC5@coote.org>
	<50C70436.6010006@rabbitmq.com>
	<CAMcAHLW-Kj1kP8v6M1uy93AUm+DbJ5tpnnfb+j5yOsUa8okhEg@mail.gmail.com>
Message-ID: <70D0C9E5-1896-448C-B408-EF048E9DF046@coote.org>

I think that I've now got Erlang installed - 'hello world' works, anyway, and openembedded has created what looks like a sensible rpm: erlang-R15B-r3.armv5te

However, the generic unix install seems unable to get going - I get an erlang crash dump and the /var/log/rabbitmq at nodename does not tell me very much about where to look, if I start the server with rabbitmq-server (as user rabbitmq or as user root):

[code]
=INFO REPORT==== 31-Jan-2013::22:26:04 ===
Error description:
   undef

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at qemuarm.log
   /var/log/rabbitmq/rabbit at qemuarm-sasl.log

Stack trace:
   [{mnesia,system_info,[directory],[]},
    {rabbit_mnesia,ensure_mnesia_dir,0,[]},
    {rabbit_node_monitor,prepare_cluster_status_files,0,[]},
    {rabbit,'-boot/0-fun-1-',0,[]},
    {rabbit,start_it,1,[]},
    {init,start_it,1,[]},
    {init,start_em,1,[]}]
[/code]


I've checked the file permissions (or got around them by running as root.)  How do I go about debugging a rabbitmq install?  Are there smoke tests for erlang/rabbit that I can try that check out the set up? or something else - the documentation that I've found so far seems to assume that I can get past this point, so I'd assume that I'm making some silly mistake somewhere.

Tim
On 11 Dec 2012, at 10:07, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi,
> 
> I know the Erlang Solutions guys have been playing with Erlang Embedded, you can find more info here: https://www.erlang-solutions.com/downloads/download-erlang-otp
> 
> I know they also have a github repo for it somewhere.
> 
> Regards,
> 
> Alvaro
> 
> 
> 
> On Tue, Dec 11, 2012 at 11:00 AM, Emile Joubert <emile at rabbitmq.com> wrote:
> 
> Hi Tim,
> 
> On 10/12/12 21:26, Tim Coote wrote:
> > Has anyone got any insights into getting rabbitmq onto an open
> > embedded/yocto linux build?
> 
> I suspect the biggest challenge will be to get a sufficiently recent
> version of Erlang installed. Once you have that the generic Unix binary
> should run just fine.
> 
> For details about the generic Unix tarball:
> http://www.rabbitmq.com/install-generic-unix.html
> 
> For details about required versions of Erlang for various features:
> http://www.rabbitmq.com/which-erlang.html
> 
> 
> 
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130201/2d219035/attachment.htm>

From simon at rabbitmq.com  Fri Feb  1 13:41:11 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 01 Feb 2013 13:41:11 +0000
Subject: [rabbitmq-discuss] rabbitmq on yocto/openembedded
In-Reply-To: <70D0C9E5-1896-448C-B408-EF048E9DF046@coote.org>
References: <EB217F54-482B-4411-904F-8EFF6C111BC5@coote.org>
	<50C70436.6010006@rabbitmq.com>
	<CAMcAHLW-Kj1kP8v6M1uy93AUm+DbJ5tpnnfb+j5yOsUa8okhEg@mail.gmail.com>
	<70D0C9E5-1896-448C-B408-EF048E9DF046@coote.org>
Message-ID: <510BC5F7.6030605@rabbitmq.com>

I don't know if this is a silly mistake somewhere. The error description 
is 'undef', encountered invoking mnesia:system_info(directory) - i.e. 
that function wasn't found. Since that's the very first interaction 
RabbitMQ has with Mnesia, I suspect Mnesia just isn't there at all. I'm 
not sure I understand how you created the Erlang RPM, but could it be 
the case that Mnesia wasn't built at all?

Cheers, Simon

On 01/02/13 13:29, Tim Coote wrote:
> I think that I've now got Erlang installed - 'hello world' works,
> anyway, and openembedded has created what looks like a sensible rpm:
> erlang-R15B-r3.armv5te
>
> However, the generic unix install seems unable to get going - I get an
> erlang crash dump and the /var/log/rabbitmq at nodename does not tell me
> very much about where to look, if I start the server with
> rabbitmq-server (as user rabbitmq or as user root):
>
> [code]
> =INFO REPORT==== 31-Jan-2013::22:26:04 ===
> Error description:
>     undef
>
> Log files (may contain more information):
>     /var/log/rabbitmq/rabbit at qemuarm.log
> <mailto:var/log/rabbitmq/rabbit at qemuarm.log>
>     /var/log/rabbitmq/rabbit at qemuarm-sasl.log
> <mailto:var/log/rabbitmq/rabbit at qemuarm-sasl.log>
>
> Stack trace:
>     [{mnesia,system_info,[directory],[]},
>      {rabbit_mnesia,ensure_mnesia_dir,0,[]},
>      {rabbit_node_monitor,prepare_cluster_status_files,0,[]},
>      {rabbit,'-boot/0-fun-1-',0,[]},
>      {rabbit,start_it,1,[]},
>      {init,start_it,1,[]},
>      {init,start_em,1,[]}]
> [/code]
>
>
> I've checked the file permissions (or got around them by running as
> root.)  How do I go about debugging a rabbitmq install?  Are there smoke
> tests for erlang/rabbit that I can try that check out the set up? or
> something else - the documentation that I've found so far seems to
> assume that I can get past this point, so I'd assume that I'm making
> some silly mistake somewhere.
>
> Tim
> On 11 Dec 2012, at 10:07, Alvaro Videla <videlalvaro at gmail.com
> <mailto:videlalvaro at gmail.com>> wrote:
>
>> Hi,
>>
>> I know the Erlang Solutions guys have been playing with Erlang
>> Embedded, you can find more info here:
>> https://www.erlang-solutions.com/downloads/download-erlang-otp
>>
>> I know they also have a github repo for it somewhere.
>>
>> Regards,
>>
>> Alvaro
>>
>>
>>
>> On Tue, Dec 11, 2012 at 11:00 AM, Emile Joubert <emile at rabbitmq.com
>> <mailto:emile at rabbitmq.com>> wrote:
>>
>>
>>     Hi Tim,
>>
>>     On 10/12/12 21:26, Tim Coote wrote:
>>     > Has anyone got any insights into getting rabbitmq onto an open
>>     > embedded/yocto linux build?
>>
>>     I suspect the biggest challenge will be to get a sufficiently recent
>>     version of Erlang installed. Once you have that the generic Unix
>>     binary
>>     should run just fine.
>>
>>     For details about the generic Unix tarball:
>>     http://www.rabbitmq.com/install-generic-unix.html
>>
>>     For details about required versions of Erlang for various features:
>>     http://www.rabbitmq.com/which-erlang.html
>>
>>
>>
>>     -Emile
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com
>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From tim+rabbitmq.com at coote.org  Fri Feb  1 14:37:07 2013
From: tim+rabbitmq.com at coote.org (Tim Coote)
Date: Fri, 1 Feb 2013 14:37:07 +0000
Subject: [rabbitmq-discuss] rabbitmq on yocto/openembedded
In-Reply-To: <510BC5F7.6030605@rabbitmq.com>
References: <EB217F54-482B-4411-904F-8EFF6C111BC5@coote.org>
	<50C70436.6010006@rabbitmq.com>
	<CAMcAHLW-Kj1kP8v6M1uy93AUm+DbJ5tpnnfb+j5yOsUa8okhEg@mail.gmail.com>
	<70D0C9E5-1896-448C-B408-EF048E9DF046@coote.org>
	<510BC5F7.6030605@rabbitmq.com>
Message-ID: <EFEE44D7-DD85-4EE0-BD68-D63A02CDF72A@coote.org>

Could well be. Thanks for the spot. Let me check.

Tim
On 1 Feb 2013, at 13:41, Simon MacMullen <simon at rabbitmq.com> wrote:

> I don't know if this is a silly mistake somewhere. The error description is 'undef', encountered invoking mnesia:system_info(directory) - i.e. that function wasn't found. Since that's the very first interaction RabbitMQ has with Mnesia, I suspect Mnesia just isn't there at all. I'm not sure I understand how you created the Erlang RPM, but could it be the case that Mnesia wasn't built at all?
> 
> Cheers, Simon
> 
> On 01/02/13 13:29, Tim Coote wrote:
>> I think that I've now got Erlang installed - 'hello world' works,
>> anyway, and openembedded has created what looks like a sensible rpm:
>> erlang-R15B-r3.armv5te
>> 
>> However, the generic unix install seems unable to get going - I get an
>> erlang crash dump and the /var/log/rabbitmq at nodename does not tell me
>> very much about where to look, if I start the server with
>> rabbitmq-server (as user rabbitmq or as user root):
>> 
>> [code]
>> =INFO REPORT==== 31-Jan-2013::22:26:04 ===
>> Error description:
>>    undef
>> 
>> Log files (may contain more information):
>>    /var/log/rabbitmq/rabbit at qemuarm.log
>> <mailto:var/log/rabbitmq/rabbit at qemuarm.log>
>>    /var/log/rabbitmq/rabbit at qemuarm-sasl.log
>> <mailto:var/log/rabbitmq/rabbit at qemuarm-sasl.log>
>> 
>> Stack trace:
>>    [{mnesia,system_info,[directory],[]},
>>     {rabbit_mnesia,ensure_mnesia_dir,0,[]},
>>     {rabbit_node_monitor,prepare_cluster_status_files,0,[]},
>>     {rabbit,'-boot/0-fun-1-',0,[]},
>>     {rabbit,start_it,1,[]},
>>     {init,start_it,1,[]},
>>     {init,start_em,1,[]}]
>> [/code]
>> 
>> 
>> I've checked the file permissions (or got around them by running as
>> root.)  How do I go about debugging a rabbitmq install?  Are there smoke
>> tests for erlang/rabbit that I can try that check out the set up? or
>> something else - the documentation that I've found so far seems to
>> assume that I can get past this point, so I'd assume that I'm making
>> some silly mistake somewhere.
>> 
>> Tim
>> On 11 Dec 2012, at 10:07, Alvaro Videla <videlalvaro at gmail.com
>> <mailto:videlalvaro at gmail.com>> wrote:
>> 
>>> Hi,
>>> 
>>> I know the Erlang Solutions guys have been playing with Erlang
>>> Embedded, you can find more info here:
>>> https://www.erlang-solutions.com/downloads/download-erlang-otp
>>> 
>>> I know they also have a github repo for it somewhere.
>>> 
>>> Regards,
>>> 
>>> Alvaro
>>> 
>>> 
>>> 
>>> On Tue, Dec 11, 2012 at 11:00 AM, Emile Joubert <emile at rabbitmq.com
>>> <mailto:emile at rabbitmq.com>> wrote:
>>> 
>>> 
>>>    Hi Tim,
>>> 
>>>    On 10/12/12 21:26, Tim Coote wrote:
>>>    > Has anyone got any insights into getting rabbitmq onto an open
>>>    > embedded/yocto linux build?
>>> 
>>>    I suspect the biggest challenge will be to get a sufficiently recent
>>>    version of Erlang installed. Once you have that the generic Unix
>>>    binary
>>>    should run just fine.
>>> 
>>>    For details about the generic Unix tarball:
>>>    http://www.rabbitmq.com/install-generic-unix.html
>>> 
>>>    For details about required versions of Erlang for various features:
>>>    http://www.rabbitmq.com/which-erlang.html
>>> 
>>> 
>>> 
>>>    -Emile
>>>    _______________________________________________
>>>    rabbitmq-discuss mailing list
>>>    rabbitmq-discuss at lists.rabbitmq.com
>>>    <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>>    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware


From tim+rabbitmq.com at coote.org  Fri Feb  1 14:50:58 2013
From: tim+rabbitmq.com at coote.org (Tim Coote)
Date: Fri, 1 Feb 2013 14:50:58 +0000
Subject: [rabbitmq-discuss] rabbitmq on yocto/openembedded
In-Reply-To: <510BC5F7.6030605@rabbitmq.com>
References: <EB217F54-482B-4411-904F-8EFF6C111BC5@coote.org>
	<50C70436.6010006@rabbitmq.com>
	<CAMcAHLW-Kj1kP8v6M1uy93AUm+DbJ5tpnnfb+j5yOsUa8okhEg@mail.gmail.com>
	<70D0C9E5-1896-448C-B408-EF048E9DF046@coote.org>
	<510BC5F7.6030605@rabbitmq.com>
Message-ID: <67E93A94-F9EE-4361-AA49-F1C1BCA00971@coote.org>

looks like no mnesia - missing from the original openembedded recipes. Damn.  I'll try to work out how to construct mnesia, now.
On 1 Feb 2013, at 13:41, Simon MacMullen <simon at rabbitmq.com> wrote:

> I don't know if this is a silly mistake somewhere. The error description is 'undef', encountered invoking mnesia:system_info(directory) - i.e. that function wasn't found. Since that's the very first interaction RabbitMQ has with Mnesia, I suspect Mnesia just isn't there at all. I'm not sure I understand how you created the Erlang RPM, but could it be the case that Mnesia wasn't built at all?
> 
> Cheers, Simon
> 
> On 01/02/13 13:29, Tim Coote wrote:
>> I think that I've now got Erlang installed - 'hello world' works,
>> anyway, and openembedded has created what looks like a sensible rpm:
>> erlang-R15B-r3.armv5te
>> 
>> However, the generic unix install seems unable to get going - I get an
>> erlang crash dump and the /var/log/rabbitmq at nodename does not tell me
>> very much about where to look, if I start the server with
>> rabbitmq-server (as user rabbitmq or as user root):
>> 
>> [code]
>> =INFO REPORT==== 31-Jan-2013::22:26:04 ===
>> Error description:
>>    undef
>> 
>> Log files (may contain more information):
>>    /var/log/rabbitmq/rabbit at qemuarm.log
>> <mailto:var/log/rabbitmq/rabbit at qemuarm.log>
>>    /var/log/rabbitmq/rabbit at qemuarm-sasl.log
>> <mailto:var/log/rabbitmq/rabbit at qemuarm-sasl.log>
>> 
>> Stack trace:
>>    [{mnesia,system_info,[directory],[]},
>>     {rabbit_mnesia,ensure_mnesia_dir,0,[]},
>>     {rabbit_node_monitor,prepare_cluster_status_files,0,[]},
>>     {rabbit,'-boot/0-fun-1-',0,[]},
>>     {rabbit,start_it,1,[]},
>>     {init,start_it,1,[]},
>>     {init,start_em,1,[]}]
>> [/code]
>> 
>> 
>> I've checked the file permissions (or got around them by running as
>> root.)  How do I go about debugging a rabbitmq install?  Are there smoke
>> tests for erlang/rabbit that I can try that check out the set up? or
>> something else - the documentation that I've found so far seems to
>> assume that I can get past this point, so I'd assume that I'm making
>> some silly mistake somewhere.
>> 
>> Tim
>> On 11 Dec 2012, at 10:07, Alvaro Videla <videlalvaro at gmail.com
>> <mailto:videlalvaro at gmail.com>> wrote:
>> 
>>> Hi,
>>> 
>>> I know the Erlang Solutions guys have been playing with Erlang
>>> Embedded, you can find more info here:
>>> https://www.erlang-solutions.com/downloads/download-erlang-otp
>>> 
>>> I know they also have a github repo for it somewhere.
>>> 
>>> Regards,
>>> 
>>> Alvaro
>>> 
>>> 
>>> 
>>> On Tue, Dec 11, 2012 at 11:00 AM, Emile Joubert <emile at rabbitmq.com
>>> <mailto:emile at rabbitmq.com>> wrote:
>>> 
>>> 
>>>    Hi Tim,
>>> 
>>>    On 10/12/12 21:26, Tim Coote wrote:
>>>    > Has anyone got any insights into getting rabbitmq onto an open
>>>    > embedded/yocto linux build?
>>> 
>>>    I suspect the biggest challenge will be to get a sufficiently recent
>>>    version of Erlang installed. Once you have that the generic Unix
>>>    binary
>>>    should run just fine.
>>> 
>>>    For details about the generic Unix tarball:
>>>    http://www.rabbitmq.com/install-generic-unix.html
>>> 
>>>    For details about required versions of Erlang for various features:
>>>    http://www.rabbitmq.com/which-erlang.html
>>> 
>>> 
>>> 
>>>    -Emile
>>>    _______________________________________________
>>>    rabbitmq-discuss mailing list
>>>    rabbitmq-discuss at lists.rabbitmq.com
>>>    <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>>    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware


From pingping.s830 at gmail.com  Fri Feb  1 16:37:43 2013
From: pingping.s830 at gmail.com (p)
Date: Fri, 1 Feb 2013 08:37:43 -0800 (PST)
Subject: [rabbitmq-discuss] configure rabbitmq disk_free_limit
Message-ID: <f1c5f1ad-d421-486b-bf62-22773462e341@googlegroups.com>


From watson.timothy at gmail.com  Fri Feb  1 16:49:38 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 1 Feb 2013 16:49:38 +0000
Subject: [rabbitmq-discuss] configure rabbitmq disk_free_limit
In-Reply-To: <f1c5f1ad-d421-486b-bf62-22773462e341@googlegroups.com>
References: <f1c5f1ad-d421-486b-bf62-22773462e341@googlegroups.com>
Message-ID: <569589E5-91AF-4285-A7FF-3233B6593B98@rabbitmq.com>

Have you been through http://www.rabbitmq.com/configure.html#configuration-file?

On 1 Feb 2013, at 16:37, p <pingping.s830 at gmail.com> wrote:

> From some resources I read, it says that when disk_free_limit > disk_free, the connections would be blocked preventing messages from being published. In order to modify the limit, we can modify the value inside rabbitmq.config file but I noticed that I don't have that file under /etc/rabbitmq, though it was mentioned that that file can be created manually, I don't really find any documentation that gives steps of setting up that file. Is there any other way to modify that configuration apart from modifying it inside the config file? Any help would be much appreciated. Thanks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From aaronblew at gmail.com  Fri Feb  1 17:31:14 2013
From: aaronblew at gmail.com (Aaron Blew)
Date: Fri, 1 Feb 2013 09:31:14 -0800
Subject: [rabbitmq-discuss] RabbitMQ Producer Flow Control
Message-ID: <CAJsfpELF=heJrjK0hbi7aWm5XcCnMhVtn8+OUT22e7uTTT6-dg@mail.gmail.com>

Hi all,
I'm currently using RabbitMQ 2.8.1 as the backbone of my Logstash
architecture.  Currently I've got 5 RabbitMQ servers running shovels that
push messages onto the "mothership", where data is consumed by a Logstash
agent that feeds into various endpoints.

The issue is that under high load the Logstash consumer on the mothership
isn't fast enough at to keep up with the data coming in (generally above
4,000 messages/sec).  Normally this wouldn't be a problem since we've got
capacity to buffer things on the mothership, but RabbitMQ starts rate
limiting the shovels that are sending data in, which compounds the issue
since the nodes shoveling data don't have as much IO capacity as the
mothership does.  If I stop the slow consumer on the mothership, the
shovels play data in as fast as they can acknowledge it.

Ideally I'd be able to turn off producer flow control on the mothership
side so the shovels wouldn't be slowed down except in cases where I'm
approaching high watermarks or something along those lines.

Can anyone offer any suggestions on how I might be able to adjust the
behavior?

Thanks,
-Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130201/919d9ce2/attachment.htm>

From oldhomelh at gmail.com  Sat Feb  2 06:38:46 2013
From: oldhomelh at gmail.com (andy lin)
Date: Fri, 1 Feb 2013 22:38:46 -0800 (PST)
Subject: [rabbitmq-discuss] why a flowing Connection can make all
	Connection blocked
In-Reply-To: <510B9BE6.8050001@rabbitmq.com>
References: <1359683075316-24811.post@n5.nabble.com>
	<510B9BE6.8050001@rabbitmq.com>
Message-ID: <1359787126555-24829.post@n5.nabble.com>

     I have checked ,but I find   no  memory  or disk  alarm going off,and
only one connection show flowing state ,others show running state,But all
Connection can't receive or send.Maybe other reason?





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/why-a-flowing-Connection-can-make-all-Connection-blocked-tp24811p24829.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From zhujun.corp at gmail.com  Sat Feb  2 07:29:30 2013
From: zhujun.corp at gmail.com (uniguyit)
Date: Fri, 1 Feb 2013 23:29:30 -0800 (PST)
Subject: [rabbitmq-discuss] Appear ''SharedQueue closed" Error when i
 send RabbitMQ Message in MonoProject(iOS)
In-Reply-To: <1358599114463-24584.post@n5.nabble.com>
References: <1358599114463-24584.post@n5.nabble.com>
Message-ID: <1359790170862-24831.post@n5.nabble.com>

i can't solve this problem yet



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Appear-SharedQueue-closed-Error-when-i-send-RabbitMQ-Message-in-MonoProject-iOS-tp24584p24831.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim+rabbitmq.com at coote.org  Sat Feb  2 09:20:17 2013
From: tim+rabbitmq.com at coote.org (Tim Coote)
Date: Sat, 2 Feb 2013 09:20:17 +0000
Subject: [rabbitmq-discuss] rabbitmq on yocto/openembedded
In-Reply-To: <510BC5F7.6030605@rabbitmq.com>
References: <EB217F54-482B-4411-904F-8EFF6C111BC5@coote.org>
	<50C70436.6010006@rabbitmq.com>
	<CAMcAHLW-Kj1kP8v6M1uy93AUm+DbJ5tpnnfb+j5yOsUa8okhEg@mail.gmail.com>
	<70D0C9E5-1896-448C-B408-EF048E9DF046@coote.org>
	<510BC5F7.6030605@rabbitmq.com>
Message-ID: <6FDA9011-832A-49E1-9845-F7D50D62124B@coote.org>

Looks like the rpm is populated with a minimal erlang subset. Is there a dependency list for rabbitmq on erlang libraries?  I added in mnesia and then found that os_mon was required, so if there's a definitive list, it would save me a few iterations?

Tim
On 1 Feb 2013, at 13:41, Simon MacMullen <simon at rabbitmq.com> wrote:

> I don't know if this is a silly mistake somewhere. The error description is 'undef', encountered invoking mnesia:system_info(directory) - i.e. that function wasn't found. Since that's the very first interaction RabbitMQ has with Mnesia, I suspect Mnesia just isn't there at all. I'm not sure I understand how you created the Erlang RPM, but could it be the case that Mnesia wasn't built at all?
> 
> Cheers, Simon
> 
> On 01/02/13 13:29, Tim Coote wrote:
>> I think that I've now got Erlang installed - 'hello world' works,
>> anyway, and openembedded has created what looks like a sensible rpm:
>> erlang-R15B-r3.armv5te
>> 
>> However, the generic unix install seems unable to get going - I get an
>> erlang crash dump and the /var/log/rabbitmq at nodename does not tell me
>> very much about where to look, if I start the server with
>> rabbitmq-server (as user rabbitmq or as user root):
>> 
>> [code]
>> =INFO REPORT==== 31-Jan-2013::22:26:04 ===
>> Error description:
>>    undef
>> 
>> Log files (may contain more information):
>>    /var/log/rabbitmq/rabbit at qemuarm.log
>> <mailto:var/log/rabbitmq/rabbit at qemuarm.log>
>>    /var/log/rabbitmq/rabbit at qemuarm-sasl.log
>> <mailto:var/log/rabbitmq/rabbit at qemuarm-sasl.log>
>> 
>> Stack trace:
>>    [{mnesia,system_info,[directory],[]},
>>     {rabbit_mnesia,ensure_mnesia_dir,0,[]},
>>     {rabbit_node_monitor,prepare_cluster_status_files,0,[]},
>>     {rabbit,'-boot/0-fun-1-',0,[]},
>>     {rabbit,start_it,1,[]},
>>     {init,start_it,1,[]},
>>     {init,start_em,1,[]}]
>> [/code]
>> 
>> 
>> I've checked the file permissions (or got around them by running as
>> root.)  How do I go about debugging a rabbitmq install?  Are there smoke
>> tests for erlang/rabbit that I can try that check out the set up? or
>> something else - the documentation that I've found so far seems to
>> assume that I can get past this point, so I'd assume that I'm making
>> some silly mistake somewhere.
>> 
>> Tim
>> On 11 Dec 2012, at 10:07, Alvaro Videla <videlalvaro at gmail.com
>> <mailto:videlalvaro at gmail.com>> wrote:
>> 
>>> Hi,
>>> 
>>> I know the Erlang Solutions guys have been playing with Erlang
>>> Embedded, you can find more info here:
>>> https://www.erlang-solutions.com/downloads/download-erlang-otp
>>> 
>>> I know they also have a github repo for it somewhere.
>>> 
>>> Regards,
>>> 
>>> Alvaro
>>> 
>>> 
>>> 
>>> On Tue, Dec 11, 2012 at 11:00 AM, Emile Joubert <emile at rabbitmq.com
>>> <mailto:emile at rabbitmq.com>> wrote:
>>> 
>>> 
>>>    Hi Tim,
>>> 
>>>    On 10/12/12 21:26, Tim Coote wrote:
>>>    > Has anyone got any insights into getting rabbitmq onto an open
>>>    > embedded/yocto linux build?
>>> 
>>>    I suspect the biggest challenge will be to get a sufficiently recent
>>>    version of Erlang installed. Once you have that the generic Unix
>>>    binary
>>>    should run just fine.
>>> 
>>>    For details about the generic Unix tarball:
>>>    http://www.rabbitmq.com/install-generic-unix.html
>>> 
>>>    For details about required versions of Erlang for various features:
>>>    http://www.rabbitmq.com/which-erlang.html
>>> 
>>> 
>>> 
>>>    -Emile
>>>    _______________________________________________
>>>    rabbitmq-discuss mailing list
>>>    rabbitmq-discuss at lists.rabbitmq.com
>>>    <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>>    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware


From tim at rabbitmq.com  Sat Feb  2 10:10:48 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Sat, 2 Feb 2013 10:10:48 +0000
Subject: [rabbitmq-discuss] Appear ''SharedQueue closed" Error when i
	send RabbitMQ Message in MonoProject(iOS)
In-Reply-To: <1359790170862-24831.post@n5.nabble.com>
References: <1358599114463-24584.post@n5.nabble.com>
	<1359790170862-24831.post@n5.nabble.com>
Message-ID: <D2F69F46-741F-4D3B-929F-FE8CAFF39589@rabbitmq.com>

Emile asked if there was anything in the logs or if there had been any network interruptions. Was there - on both counts - or not?

On 2 Feb 2013, at 07:29, uniguyit wrote:

> i can't solve this problem yet
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Appear-SharedQueue-closed-Error-when-i-send-RabbitMQ-Message-in-MonoProject-iOS-tp24584p24831.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Sat Feb  2 10:14:53 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Sat, 2 Feb 2013 10:14:53 +0000
Subject: [rabbitmq-discuss] rabbitmq on yocto/openembedded
In-Reply-To: <6FDA9011-832A-49E1-9845-F7D50D62124B@coote.org>
References: <EB217F54-482B-4411-904F-8EFF6C111BC5@coote.org>
	<50C70436.6010006@rabbitmq.com>
	<CAMcAHLW-Kj1kP8v6M1uy93AUm+DbJ5tpnnfb+j5yOsUa8okhEg@mail.gmail.com>
	<70D0C9E5-1896-448C-B408-EF048E9DF046@coote.org>
	<510BC5F7.6030605@rabbitmq.com>
	<6FDA9011-832A-49E1-9845-F7D50D62124B@coote.org>
Message-ID: <5906B6DB-BFE7-40CE-B9B9-CC1D31CFEB17@rabbitmq.com>

Hi Tim

On 2 Feb 2013, at 09:20, Tim Coote wrote:

> Looks like the rpm is populated with a minimal erlang subset. Is there a dependency list for rabbitmq on erlang libraries?  I added in mnesia and then found that os_mon was required, so if there's a definitive list, it would save me a few iterations?
> 

Erlang uses the .app resource file to specify dependencies, and Rabbit's lists only those two:

$ cat ~/../../rabbitmq-umbrella/rabbitmq-server/ebin/rabbit.app | grep {applications
     {applications,[kernel,stdlib,sasl,mnesia,os_mon]},
$

If you're using plugins however, you'll need to look at their dependencies too. Both mnesia and os_mon depend only on kernel, stdlib and sasl.

Cheers,
Tim

> Tim
> On 1 Feb 2013, at 13:41, Simon MacMullen <simon at rabbitmq.com> wrote:
> 
>> I don't know if this is a silly mistake somewhere. The error description is 'undef', encountered invoking mnesia:system_info(directory) - i.e. that function wasn't found. Since that's the very first interaction RabbitMQ has with Mnesia, I suspect Mnesia just isn't there at all. I'm not sure I understand how you created the Erlang RPM, but could it be the case that Mnesia wasn't built at all?
>> 
>> Cheers, Simon
>> 
>> On 01/02/13 13:29, Tim Coote wrote:
>>> I think that I've now got Erlang installed - 'hello world' works,
>>> anyway, and openembedded has created what looks like a sensible rpm:
>>> erlang-R15B-r3.armv5te
>>> 
>>> However, the generic unix install seems unable to get going - I get an
>>> erlang crash dump and the /var/log/rabbitmq at nodename does not tell me
>>> very much about where to look, if I start the server with
>>> rabbitmq-server (as user rabbitmq or as user root):
>>> 
>>> [code]
>>> =INFO REPORT==== 31-Jan-2013::22:26:04 ===
>>> Error description:
>>>   undef
>>> 
>>> Log files (may contain more information):
>>>   /var/log/rabbitmq/rabbit at qemuarm.log
>>> <mailto:var/log/rabbitmq/rabbit at qemuarm.log>
>>>   /var/log/rabbitmq/rabbit at qemuarm-sasl.log
>>> <mailto:var/log/rabbitmq/rabbit at qemuarm-sasl.log>
>>> 
>>> Stack trace:
>>>   [{mnesia,system_info,[directory],[]},
>>>    {rabbit_mnesia,ensure_mnesia_dir,0,[]},
>>>    {rabbit_node_monitor,prepare_cluster_status_files,0,[]},
>>>    {rabbit,'-boot/0-fun-1-',0,[]},
>>>    {rabbit,start_it,1,[]},
>>>    {init,start_it,1,[]},
>>>    {init,start_em,1,[]}]
>>> [/code]
>>> 
>>> 
>>> I've checked the file permissions (or got around them by running as
>>> root.)  How do I go about debugging a rabbitmq install?  Are there smoke
>>> tests for erlang/rabbit that I can try that check out the set up? or
>>> something else - the documentation that I've found so far seems to
>>> assume that I can get past this point, so I'd assume that I'm making
>>> some silly mistake somewhere.
>>> 
>>> Tim
>>> On 11 Dec 2012, at 10:07, Alvaro Videla <videlalvaro at gmail.com
>>> <mailto:videlalvaro at gmail.com>> wrote:
>>> 
>>>> Hi,
>>>> 
>>>> I know the Erlang Solutions guys have been playing with Erlang
>>>> Embedded, you can find more info here:
>>>> https://www.erlang-solutions.com/downloads/download-erlang-otp
>>>> 
>>>> I know they also have a github repo for it somewhere.
>>>> 
>>>> Regards,
>>>> 
>>>> Alvaro
>>>> 
>>>> 
>>>> 
>>>> On Tue, Dec 11, 2012 at 11:00 AM, Emile Joubert <emile at rabbitmq.com
>>>> <mailto:emile at rabbitmq.com>> wrote:
>>>> 
>>>> 
>>>>   Hi Tim,
>>>> 
>>>>   On 10/12/12 21:26, Tim Coote wrote:
>>>>> Has anyone got any insights into getting rabbitmq onto an open
>>>>> embedded/yocto linux build?
>>>> 
>>>>   I suspect the biggest challenge will be to get a sufficiently recent
>>>>   version of Erlang installed. Once you have that the generic Unix
>>>>   binary
>>>>   should run just fine.
>>>> 
>>>>   For details about the generic Unix tarball:
>>>>   http://www.rabbitmq.com/install-generic-unix.html
>>>> 
>>>>   For details about required versions of Erlang for various features:
>>>>   http://www.rabbitmq.com/which-erlang.html
>>>> 
>>>> 
>>>> 
>>>>   -Emile
>>>>   _______________________________________________
>>>>   rabbitmq-discuss mailing list
>>>>   rabbitmq-discuss at lists.rabbitmq.com
>>>>   <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>>>   https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> 
>>> 
>>> 
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>> 
>> 
>> -- 
>> Simon MacMullen
>> RabbitMQ, VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jesper.louis.andersen at gmail.com  Sat Feb  2 18:28:29 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Sat, 2 Feb 2013 19:28:29 +0100
Subject: [rabbitmq-discuss] Patches for the RabbitMQ Erlang client
Message-ID: <CAGrdgiX6EB-zV-0BUs0tfwh_8YWwCura4HEu6OLxgDQz_0dYTg@mail.gmail.com>

Hi RabbitMQ people, and developers

The RabbitMQ erlang client probably needs the following patches in upstream:

https://github.com/jlouis/amqp_client/commit/6cd8c68649a197334a8514bfd8720b758c71638a
https://github.com/jlouis/amqp_client/commit/7195c305bf039fa940c71ea9f3beb7cfbf4a30bd

Which I have been applying for too long for it to be funny now. They fix
some irritating complaints from the code when the amqp_client shuts down.
Please review them and apply them as you see fit. If you don't apply one of
them, I am interested in knowing why :)

If you apply them, please give credit to their author, Vladimir Baranov,
who found them originally. Github can provide patches for your convenience:

https://github.com/jlouis/amqp_client/commit/7195c305bf039fa940c71ea9f3beb7cfbf4a30bd.patch
https://github.com/jlouis/amqp_client/commit/6cd8c68649a197334a8514bfd8720b758c71638a.patch

They apply on top of 3.0.1 cleanly at my end and given the non-changes
between 3.0.1 and 3.0.2 in the erlang client, these would also apply for
3.0.2 I think.

Jesper Louis Andersen,
  Erlang Solutions Ltd.

-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130202/d7c1c95b/attachment.htm>

From rob at bsdsoftware.co.il  Sun Feb  3 11:25:14 2013
From: rob at bsdsoftware.co.il (Rob Woolfson)
Date: Sun, 3 Feb 2013 13:25:14 +0200
Subject: [rabbitmq-discuss] version 3.0.2 upgrade with lvc
Message-ID: <CAEuJcXNav-20yVUT9iVrYUCKfFg8v9AQ_-GEgZGcZsQRKQjOdQ@mail.gmail.com>

We recently upgraded to 3.0.2 to 2.8.7 to stay current.  Unfortunately our
LVC exchange now seems to be giving us some trouble.  When we create a
queue and bind to the exchange we get the following error in Java:
java.io.IOException
        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
        at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:124)
        at com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:790)
        at com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:805)
        at com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:61)
        at com.bsd.BsdConsumer$1.run(BsdConsumer.java:152)
        at java.lang.Thread.run(Thread.java:679)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
reason: {#method<connection.close>(reply-code=541,
reply-text=INTERNAL_ERROR, class-id=0, method-id=0), null, ""}
        at
com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
        at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
        at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
        at
com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:216)
        at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
        ... 5 more

Do you have any suggestions of what we can do to sort this out?

It is possible that LVC does not work with the new version of RabbitMQ?

-- 
Rob Woolfson - CTO
mobile:+972-544904157
office:+972-3-5353751
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130203/9d46ec3f/attachment.htm>

From jerryk at rbcon.com  Sun Feb  3 16:48:05 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Sun, 3 Feb 2013 08:48:05 -0800
Subject: [rabbitmq-discuss] version 3.0.2 upgrade with lvc
In-Reply-To: <CAEuJcXNav-20yVUT9iVrYUCKfFg8v9AQ_-GEgZGcZsQRKQjOdQ@mail.gmail.com>
References: <CAEuJcXNav-20yVUT9iVrYUCKfFg8v9AQ_-GEgZGcZsQRKQjOdQ@mail.gmail.com>
Message-ID: <CAE0Sz=yN=K0Ajrpb2d4Muw61vV_cJHduHC1JLXe6H6cSrguHDA@mail.gmail.com>

Can you post logs from the broker against which this client is failing?
 You may see more information there about what's going wrong in the LVC
exchange's processing and what's causing the internal error that the client
is seeing.

Best regards,
Jerry

On Sun, Feb 3, 2013 at 3:25 AM, Rob Woolfson <rob at bsdsoftware.co.il> wrote:

> We recently upgraded to 3.0.2 to 2.8.7 to stay current.  Unfortunately our
> LVC exchange now seems to be giving us some trouble.  When we create a
> queue and bind to the exchange we get the following error in Java:
> java.io.IOException
>         at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106)
>         at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102)
>         at
> com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:124)
>         at com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:790)
>         at com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:805)
>         at com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:61)
>         at com.bsd.BsdConsumer$1.run(BsdConsumer.java:152)
>         at java.lang.Thread.run(Thread.java:679)
> Caused by: com.rabbitmq.client.ShutdownSignalException: connection error;
> reason: {#method<connection.close>(reply-code=541,
> reply-text=INTERNAL_ERROR, class-id=0, method-id=0), null, ""}
>         at
> com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
>         at
> com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
>         at
> com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
>         at
> com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:216)
>         at
> com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
>         ... 5 more
>
> Do you have any suggestions of what we can do to sort this out?
>
> It is possible that LVC does not work with the new version of RabbitMQ?
>
> --
> Rob Woolfson - CTO
> mobile:+972-544904157
> office:+972-3-5353751
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130203/bbdc8717/attachment.htm>

From asen_arizanov at abv.bg  Mon Feb  4 07:54:26 2013
From: asen_arizanov at abv.bg (Arizanov)
Date: Sun, 3 Feb 2013 23:54:26 -0800 (PST)
Subject: [rabbitmq-discuss] How to handle 'RabbitMQ cluster unaccessible'
 issues? Is using shovels the best solution?
Message-ID: <d2777947-5cc3-4ee6-afe4-45aca918604f@googlegroups.com>

Hi guys,

We are doing some realtime replication of critical data and there may be 
cases when the RabbitMQ cluster is unaccessible. E.g. the cluster is being 
patched or there just a network connectivity issue. On one side we can have 
local rabbitmq installations inside the webserver and shovels, which 
transmit the data to the cluster. On the other side, we can develop our own 
database and a service over it, which is scheduled to transmit the messages 
to the cluster when it becomes available. So is using the 'shovel' the best 
practise? Does the statement 
"A shovel behaves like a well-written client application, which connects to 
its source and destination, reads and writes messages, and copes with 
connection failures." from http://www.rabbitmq.com/shovel.html means so?

Thank a lot in advance,
Asen Arizanov,
Senior Software Developer,
Telerik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130203/04f57f4b/attachment.htm>

From emile at rabbitmq.com  Mon Feb  4 10:06:47 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 04 Feb 2013 10:06:47 +0000
Subject: [rabbitmq-discuss] HA Proxy setup on CentOS Linux
In-Reply-To: <6a731cf3-c9ab-4c88-8bc8-5de9ea6ea15a@googlegroups.com>
References: <6a731cf3-c9ab-4c88-8bc8-5de9ea6ea15a@googlegroups.com>
Message-ID: <510F8837.2050205@rabbitmq.com>

Hi,

On 01/02/13 04:05, Sandeep Aggarwal wrote:
> Basically, I was able to download the HA proxy source files and compile
> them on the Linux server. But when I'm trying to run the program, it
> does not seem to be listening on the expected ports.

If you don't get an answer here then I suggest you ask your question at
a dedicated HAProxy forum instead.



-Emile



From simon at rabbitmq.com  Mon Feb  4 10:44:11 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Feb 2013 10:44:11 +0000
Subject: [rabbitmq-discuss] rabbitmq on yocto/openembedded
In-Reply-To: <5906B6DB-BFE7-40CE-B9B9-CC1D31CFEB17@rabbitmq.com>
References: <EB217F54-482B-4411-904F-8EFF6C111BC5@coote.org>
	<50C70436.6010006@rabbitmq.com>
	<CAMcAHLW-Kj1kP8v6M1uy93AUm+DbJ5tpnnfb+j5yOsUa8okhEg@mail.gmail.com>
	<70D0C9E5-1896-448C-B408-EF048E9DF046@coote.org>
	<510BC5F7.6030605@rabbitmq.com>
	<6FDA9011-832A-49E1-9845-F7D50D62124B@coote.org>
	<5906B6DB-BFE7-40CE-B9B9-CC1D31CFEB17@rabbitmq.com>
Message-ID: <510F90FB.5030904@rabbitmq.com>

On 02/02/13 10:14, Tim Watson wrote:
> If you're using plugins however, you'll need to look at their
> dependencies too

To cut to the chase:

rabbitmq-management needs xmerl. I think that's it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Mon Feb  4 10:43:02 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 04 Feb 2013 10:43:02 +0000
Subject: [rabbitmq-discuss] How to handle 'RabbitMQ cluster
 unaccessible' issues? Is using shovels the best solution?
In-Reply-To: <d2777947-5cc3-4ee6-afe4-45aca918604f@googlegroups.com>
References: <d2777947-5cc3-4ee6-afe4-45aca918604f@googlegroups.com>
Message-ID: <510F90B6.6000508@rabbitmq.com>

Hi

On 02/04/2013 07:54 AM, Arizanov wrote:
> Hi guys,
>
> We are doing some realtime replication of critical data and there may 
> be cases when the RabbitMQ cluster is unaccessible. E.g. the cluster 
> is being patched or there just a network connectivity issue. On one 
> side we can have local rabbitmq installations inside the webserver and 
> shovels, which transmit the data to the cluster. On the other side, we 
> can develop our own database and a service over it, which is scheduled 
> to transmit the messages to the cluster when it becomes available. So 
> is using the 'shovel' the best practise? Does the statement
> "A shovel behaves like a well-written client application, which 
> connects to its source and destination, reads and writes messages, and 
> copes with connection failures." from 
> http://www.rabbitmq.com/shovel.html means so?
>

Reading from ...,

"Whereas federation aims to mirror messages from one exchange to another 
(with optimisations to ensure that messages are not forwarded unless 
needed), the shovel simply consumes messages from a queue on one broker, 
and forwards them to an exchange on another. "

So with the Shovel, because you "Choose Availability and Partition 
Tolerance from the CAP theorem 
<http://en.wikipedia.org/wiki/CAP_theorem>", there is the possibility 
that you'll end up with duplicate messages. You can tweak the 
'republish' semantics to compensate for this if you like, and of course 
yes the Shovel will attempt to reconnect (and this is also configurable) 
on connection failure.

You might want to consider Federation if you don't need to low level of 
control that the Shovel offers.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/68b82885/attachment.htm>

From simon at rabbitmq.com  Mon Feb  4 10:58:10 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Feb 2013 10:58:10 +0000
Subject: [rabbitmq-discuss] rabbitmq on yocto/openembedded
In-Reply-To: <510F90FB.5030904@rabbitmq.com>
References: <EB217F54-482B-4411-904F-8EFF6C111BC5@coote.org>
	<50C70436.6010006@rabbitmq.com>
	<CAMcAHLW-Kj1kP8v6M1uy93AUm+DbJ5tpnnfb+j5yOsUa8okhEg@mail.gmail.com>
	<70D0C9E5-1896-448C-B408-EF048E9DF046@coote.org>
	<510BC5F7.6030605@rabbitmq.com>
	<6FDA9011-832A-49E1-9845-F7D50D62124B@coote.org>
	<5906B6DB-BFE7-40CE-B9B9-CC1D31CFEB17@rabbitmq.com>
	<510F90FB.5030904@rabbitmq.com>
Message-ID: <510F9442.1010507@rabbitmq.com>

On 04/02/13 10:44, Simon MacMullen wrote:
> On 02/02/13 10:14, Tim Watson wrote:
>> If you're using plugins however, you'll need to look at their
>> dependencies too
>
> To cut to the chase:
>
> rabbitmq-management needs xmerl. I think that's it.

In fact I just noticed that rabbitmq-server needs xmerl in rare 
circumstances too, but we don't declare a dependency. I'll get that 
fixed, but in the mean time you should probably make sure you have xmerl.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Feb  4 10:59:59 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 04 Feb 2013 10:59:59 +0000
Subject: [rabbitmq-discuss] Regarding Unack messages
In-Reply-To: <CAB0ZxM5quvP5=A+OQFmfCSGhSQatFxx5TmCqCw_fz7DnmgGaNw@mail.gmail.com>
References: <CAB0ZxM5quvP5=A+OQFmfCSGhSQatFxx5TmCqCw_fz7DnmgGaNw@mail.gmail.com>
Message-ID: <510F94AF.6060003@rabbitmq.com>

Hi,

On 01/02/13 13:09, chetan dev wrote:
> When all the messages are processed without acknowledgement, rabbitmq
> consumer stops fetching other messages from the queue
> 
> How do i handle such situation

It is not clear what you mean by "other messages". If there are no
further messages to deliver then the broker has no choice but to wait
for more message to arrive from publishers before sending them on to
consumers. You might also look at the "Message Acknowledgement" section
in the second tutorial:

http://www.rabbitmq.com/tutorials/tutorial-two-python.html




-Emile





From simon at rabbitmq.com  Mon Feb  4 11:30:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Feb 2013 11:30:07 +0000
Subject: [rabbitmq-discuss] RabbitMQ Producer Flow Control
In-Reply-To: <CAJsfpELF=heJrjK0hbi7aWm5XcCnMhVtn8+OUT22e7uTTT6-dg@mail.gmail.com>
References: <CAJsfpELF=heJrjK0hbi7aWm5XcCnMhVtn8+OUT22e7uTTT6-dg@mail.gmail.com>
Message-ID: <510F9BBF.1080907@rabbitmq.com>

Hi. There's a bug in versions of RabbitMQ prior to 2.8.4 where under 
some circumstances queues can over-prioritise getting rid of message to 
such an extent that they don't accept any more until empty.

I recommend an upgrade to 2.8.7 at least, or preferably 3.0.2.

And in this case flow control is just the messenger, so you don't want 
to shoot it :-)

Cheers, Simon

On 01/02/13 17:31, Aaron Blew wrote:
> Hi all,
> I'm currently using RabbitMQ 2.8.1 as the backbone of my Logstash
> architecture.  Currently I've got 5 RabbitMQ servers running shovels
> that push messages onto the "mothership", where data is consumed by a
> Logstash agent that feeds into various endpoints.
>
> The issue is that under high load the Logstash consumer on the
> mothership isn't fast enough at to keep up with the data coming in
> (generally above 4,000 messages/sec).  Normally this wouldn't be a
> problem since we've got capacity to buffer things on the mothership, but
> RabbitMQ starts rate limiting the shovels that are sending data in,
> which compounds the issue since the nodes shoveling data don't have as
> much IO capacity as the mothership does.  If I stop the slow consumer on
> the mothership, the shovels play data in as fast as they can acknowledge it.
>
> Ideally I'd be able to turn off producer flow control on the mothership
> side so the shovels wouldn't be slowed down except in cases where I'm
> approaching high watermarks or something along those lines.
>
> Can anyone offer any suggestions on how I might be able to adjust the
> behavior?
>
> Thanks,
> -Aaron
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Feb  4 11:44:40 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Feb 2013 11:44:40 +0000
Subject: [rabbitmq-discuss] version 3.0.2 upgrade with lvc
In-Reply-To: <CAEuJcXNav-20yVUT9iVrYUCKfFg8v9AQ_-GEgZGcZsQRKQjOdQ@mail.gmail.com>
References: <CAEuJcXNav-20yVUT9iVrYUCKfFg8v9AQ_-GEgZGcZsQRKQjOdQ@mail.gmail.com>
Message-ID: <510F9F28.70901@rabbitmq.com>

On 03/02/13 11:25, Rob Woolfson wrote:
> It is possible that LVC does not work with the new version of RabbitMQ?

Damn, yes, you're right. I just pushed a changeset to my fork 
(https://github.com/simonmacmullen/rabbitmq-lvc-plugin) that should fix 
this.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From rob at bsdsoftware.co.il  Mon Feb  4 12:04:38 2013
From: rob at bsdsoftware.co.il (Rob Woolfson)
Date: Mon, 4 Feb 2013 14:04:38 +0200
Subject: [rabbitmq-discuss] version 3.0.2 upgrade with lvc
In-Reply-To: <510F9F28.70901@rabbitmq.com>
References: <CAEuJcXNav-20yVUT9iVrYUCKfFg8v9AQ_-GEgZGcZsQRKQjOdQ@mail.gmail.com>
	<510F9F28.70901@rabbitmq.com>
Message-ID: <CAEuJcXNNvpr46Z5FPhJJ1g+0+9sYuO31KEevztH-CqMk_ctF=w@mail.gmail.com>

Simon,
Thanks very much.
I reverted to 2.8.7 when we couldnt fix this on our end.  I will re upgrade
to 3.0.2 in the next few days and test that the changes work.
Thanks again


On Mon, Feb 4, 2013 at 1:44 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 03/02/13 11:25, Rob Woolfson wrote:
>
>> It is possible that LVC does not work with the new version of RabbitMQ?
>>
>
> Damn, yes, you're right. I just pushed a changeset to my fork (
> https://github.com/**simonmacmullen/rabbitmq-lvc-**plugin<https://github.com/simonmacmullen/rabbitmq-lvc-plugin>)
> that should fix this.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Rob Woolfson - CTO
mobile:+972-544904157
office:+972-3-5353751
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/553c47ff/attachment.htm>

From mcintoshj at gmail.com  Mon Feb  4 15:16:23 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 4 Feb 2013 09:16:23 -0600
Subject: [rabbitmq-discuss] Shovel from a user with a Password with @ symbol
Message-ID: <CAD6m6fHfrPzErtiD2++n-=SuzcGo+WtpRPT-GqNN=tDk230TCA@mail.gmail.com>

So I hit a snag configuring our shovel.  We'd created a password with the
"@" symbol - but shovel sees this as a setting for the host.  Is there an
escape syntax I'm missing or some other configuration to allow @ symbols in
the password, or should we just avoid using these?  Additionally, any
thoughts to storing the password in an encrypted format instead of the
plaintext that it is right now?
Thanks!
Jason

-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/765a08aa/attachment.htm>

From videlalvaro at gmail.com  Mon Feb  4 16:00:52 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 4 Feb 2013 17:00:52 +0100
Subject: [rabbitmq-discuss] Interval exchange
Message-ID: <CAMcAHLWNXVZqtRfTgMPGKSew=0QxPQaqD00pWz=Xrfa7oJBYtg@mail.gmail.com>

Hi,

Would be there any utility in an exchange that bind queues using intervals
as binding keys?

Something along the lines:

- ">=50" (All messages with routing key greater than 50"
- "5-90,95,100" (All messages with rkey from 5 up to 90; 95 and 100)

Or maybe the notation specified here:
http://en.wikipedia.org/wiki/Interval_(mathematics)

So then messages would be published with integers as routing keys and be
routed if they are inside an interval.

One use case I could see for this is implementing some sort of priorities
for message processing. Another could be a very simple load balancing of
messages.

Any thoughts?

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/ffcf00b1/attachment.htm>

From rob at bsdsoftware.co.il  Mon Feb  4 10:07:00 2013
From: rob at bsdsoftware.co.il (Rob Woolfson)
Date: Mon, 4 Feb 2013 12:07:00 +0200
Subject: [rabbitmq-discuss] version 3.0.2 upgrade with lvc
Message-ID: <CAEuJcXMPORRz8iDjODubq46nFCUe-qg_VuAdu68+q6rvRWc6Ug@mail.gmail.com>

I have attached the log from yesterday


Can you post logs from the broker against which this client is failing? You
may see more information there about what's going wrong in the LVC
exchange's processing and what's causing the internal error that the client
is seeing.

Best regards, Jerry

On Sun, Feb 3, 2013 at 3:25 AM, Rob Woolfson <ro... at bsdsoftware.co.il>
wrote:

We recently upgraded to 3.0.2 to 2.8.7 to stay current. Unfortunately our
LVC exchange now seems to be giving us some trouble. When we create a queue
and bind to the exchange we get the following error in Java:
java.io.IOException at
com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:106) at
com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:102) at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:124) at
com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:790) at
com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:805) at
com.rabbitmq.client.impl.ChannelN.queueBind(ChannelN.java:61) at
com.bsd.BsdConsumer$1.run(BsdConsumer.java:152) at
java.lang.Thread.run(Thread.java:679) Caused by:
com.rabbitmq.client.ShutdownSignalException: connection error; reason:
{#method<connection.close>(reply-code=541, reply-text=INTERNAL_ERROR,
class-id=0, method-id=0), null, ""} at
com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67) at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:33)
at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:343)
at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:216) at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118) ...
5 more

Do you have any suggestions of what we can do to sort this out?

It is possible that LVC does not work with the new version of RabbitMQ

_______________________________________________ rabbitmq-discuss mailing
list rabb... at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________ rabbitmq-discuss mailing
list rabb... at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/587ae68f/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at linuxTest-sasl.log.1
Type: application/octet-stream
Size: 5169687 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/587ae68f/attachment-0001.obj>

From rokrejc82 at gmail.com  Mon Feb  4 13:38:24 2013
From: rokrejc82 at gmail.com (Rok Rejc)
Date: Mon, 4 Feb 2013 05:38:24 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Management console not working
Message-ID: <4cd9b4f4-48c4-417b-87d8-830aade33b69@googlegroups.com>

 

I have started with RabbitMQ. I have a (windows) machine on which I 
installed two RabbitMQ nodes as a service - I have choose the nodename, 
port and service name for each of them. The services are running normally 
(i see that they are listening in a netstat-a).

I have also installed management plugin with "rabbitmq-plugins enable 
rabbitmq_management" and restarted both services. But the plugin isn't 
running - I dont see it listening in a netstat and I can't connect to the 
management console via browser.

Any idea what could be wrong? Is there any log to see what is going on?


Many thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/d6029e11/attachment.htm>

From tomas at drencak.com  Mon Feb  4 15:43:52 2013
From: tomas at drencak.com (=?UTF-8?Q?Tom=C3=A1=C5=A1_Dren=C4=8D=C3=A1k?=)
Date: Mon, 4 Feb 2013 07:43:52 -0800 (PST)
Subject: [rabbitmq-discuss] Multitenant application
Message-ID: <0b7ae8fb-b764-4626-acb4-5528a1e76073@googlegroups.com>

Hi,
I'd like to use rabbitmq as "backend" for android application. Android 
device will communicate through rabbitmq with the server mostly with RPC. 

If device will send a message to the server through messaging I need to 
tell that this particular message belongs to this user. 
I need it for data filtering, so user reads/manipulates only his data. 

How can I do this in RabbitMQ?

Thanks!

  Tomas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/6d750189/attachment.htm>

From mcintoshj at gmail.com  Mon Feb  4 17:20:57 2013
From: mcintoshj at gmail.com (Jason McIntosh)
Date: Mon, 4 Feb 2013 11:20:57 -0600
Subject: [rabbitmq-discuss] esl-erlang support from rpms
Message-ID: <CAD6m6fEMSsn+5FCXpr+ZPngbTApcYGOhi55etkaqFhKLz05BSg@mail.gmail.com>

Is there any way to get a set of RPM's that consider the esl-erlang
libraries acceptable as an erlang library?  Should just be a
erlang|esl-erlang config for the rpm spec file.  The esl-erlang is the one
I'm finding on the main erlang home page.  It has the advantage of having
HIPE support working by default on CentOS/RHEL systems.

Thanks!
Jason

-- 
Jason McIntosh
http://mcintosh.poetshome.com/blog/
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/9bd3eb50/attachment.htm>

From jerryk at rbcon.com  Mon Feb  4 17:22:32 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Mon, 4 Feb 2013 09:22:32 -0800
Subject: [rabbitmq-discuss] Multitenant application
In-Reply-To: <0b7ae8fb-b764-4626-acb4-5528a1e76073@googlegroups.com>
References: <0b7ae8fb-b764-4626-acb4-5528a1e76073@googlegroups.com>
Message-ID: <CAE0Sz=zBzkz39J1jtPmaxOxwkaA2ZyMQa-2HdcJ6fNePpAVxMA@mail.gmail.com>

Start with this:

http://www.rabbitmq.com/access-control.html

That will give you a sense for how user and permission management works in
the Rabbit broker and give you some material on which to start your
thinking...

Best regards,
Jerry


On Mon, Feb 4, 2013 at 7:43 AM, Tom?? Dren??k <tomas at drencak.com> wrote:

> Hi,
> I'd like to use rabbitmq as "backend" for android application. Android
> device will communicate through rabbitmq with the server mostly with RPC.
>
> If device will send a message to the server through messaging I need to
> tell that this particular message belongs to this user.
> I need it for data filtering, so user reads/manipulates only his data.
>
> How can I do this in RabbitMQ?
>
> Thanks!
>
>   Tomas
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/e9174473/attachment.htm>

From simon at rabbitmq.com  Mon Feb  4 17:38:44 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Feb 2013 17:38:44 +0000
Subject: [rabbitmq-discuss] esl-erlang support from rpms
In-Reply-To: <CAD6m6fEMSsn+5FCXpr+ZPngbTApcYGOhi55etkaqFhKLz05BSg@mail.gmail.com>
References: <CAD6m6fEMSsn+5FCXpr+ZPngbTApcYGOhi55etkaqFhKLz05BSg@mail.gmail.com>
Message-ID: <510FF224.5020604@rabbitmq.com>

On 04/02/13 17:20, Jason McIntosh wrote:
> Is there any way to get a set of RPM's that consider the esl-erlang
> libraries acceptable as an erlang library?  Should just be a
> erlang|esl-erlang config for the rpm spec file.  The esl-erlang is the
> one I'm finding on the main erlang home page.  It has the advantage of
> having HIPE support working by default on CentOS/RHEL systems.

When we last looked at this we found that it wasn't so simple. The RPM 
docs say to use "or" rather than "|":

http://rpm5.org/docs/rpm-guide.html#id3102747

...but that seems to break completely on RPM 4 systems. (You end up with 
an RPM which depends on "erlang" and "esl-erlang" and "or".)

So is the "|" a Debianism there, or does it really work for RPMs?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Feb  4 17:51:33 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Feb 2013 17:51:33 +0000
Subject: [rabbitmq-discuss] Shovel from a user with a Password with @
 symbol
In-Reply-To: <CAD6m6fHfrPzErtiD2++n-=SuzcGo+WtpRPT-GqNN=tDk230TCA@mail.gmail.com>
References: <CAD6m6fHfrPzErtiD2++n-=SuzcGo+WtpRPT-GqNN=tDk230TCA@mail.gmail.com>
Message-ID: <510FF525.4030000@rabbitmq.com>

On 04/02/13 15:16, Jason McIntosh wrote:
> So I hit a snag configuring our shovel.  We'd created a password with
> the "@" symbol - but shovel sees this as a setting for the host.  Is
> there an escape syntax I'm missing or some other configuration to allow
> @ symbols in the password, or should we just avoid using these?

URL encode it: amqp://user:p%40ssw0rd at hostname

>   Additionally, any thoughts to storing the password in an encrypted
> format instead of the plaintext that it is right now?

If it was symmetrically encrypted then you'd need to store the 
encryption key with it :-)

But you can use public key encryption - if you set up a bunch of SSL 
certs you can have clients authenticated by their client certificates, see:

http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/rabbitmq_v3_0_2/README

and then specify auth_mechanism=external in URIs and you no longer need 
a password. (Hmm, the docs for that should be... more findable.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mcsseifer at gmail.com  Mon Feb  4 18:31:48 2013
From: mcsseifer at gmail.com (=?UTF-8?B?0KLQuNC80YPRgA==?=)
Date: Mon, 4 Feb 2013 22:31:48 +0400
Subject: [rabbitmq-discuss] Is it error?
Message-ID: <CAEQ7gRNMWhP942G8OJKXaMC7WMBJyzimexESdwaTMhZGJXQB8Q@mail.gmail.com>

I found strange behavior in some case. What i do:

1. Connect to server
2. Open channel with name is '1'
3. Declare queue with passive = 1

And after that i try declare queue with passive = 0 if i receive 404 error
in third step. Receive error like 'Declare Exchange: Resource temporary
unavailable'. Is it actual behavior?

I use Net::RabbitMQ connector for perl.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/cddc55ab/attachment.htm>

From aaronblew at gmail.com  Mon Feb  4 18:48:35 2013
From: aaronblew at gmail.com (Aaron Blew)
Date: Mon, 4 Feb 2013 10:48:35 -0800
Subject: [rabbitmq-discuss] RabbitMQ Producer Flow Control
In-Reply-To: <510F9BBF.1080907@rabbitmq.com>
References: <CAJsfpELF=heJrjK0hbi7aWm5XcCnMhVtn8+OUT22e7uTTT6-dg@mail.gmail.com>
	<510F9BBF.1080907@rabbitmq.com>
Message-ID: <CAJsfpEKm8BGsunVhdoqFvLGpfHWqDcwpEwPhFhQs80p_MDD+1A@mail.gmail.com>

Hey Simon,
Thanks for getting back to me.  After upgrading to 2.8.7 I'm still unable
to flow messages in to the head node faster than 4,000/sec while the
consumer is working.  I appreciate that flow control is trying to prevent
the server from being over-run, but in some situations it would be very
beneficial for an administrator to override this behavior.  Are there any
plans to add this kind of behavior?  I'm currently seriously considering a
switch to ActiveMQ/stomp since it gives me the knobs to tweak this behavior
both in real time and via configuration.

Thanks!
-Aaron


On Mon, Feb 4, 2013 at 3:30 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. There's a bug in versions of RabbitMQ prior to 2.8.4 where under some
> circumstances queues can over-prioritise getting rid of message to such an
> extent that they don't accept any more until empty.
>
> I recommend an upgrade to 2.8.7 at least, or preferably 3.0.2.
>
> And in this case flow control is just the messenger, so you don't want to
> shoot it :-)
>
> Cheers, Simon
>
>
> On 01/02/13 17:31, Aaron Blew wrote:
>
>> Hi all,
>> I'm currently using RabbitMQ 2.8.1 as the backbone of my Logstash
>> architecture.  Currently I've got 5 RabbitMQ servers running shovels
>> that push messages onto the "mothership", where data is consumed by a
>> Logstash agent that feeds into various endpoints.
>>
>> The issue is that under high load the Logstash consumer on the
>> mothership isn't fast enough at to keep up with the data coming in
>> (generally above 4,000 messages/sec).  Normally this wouldn't be a
>> problem since we've got capacity to buffer things on the mothership, but
>> RabbitMQ starts rate limiting the shovels that are sending data in,
>> which compounds the issue since the nodes shoveling data don't have as
>> much IO capacity as the mothership does.  If I stop the slow consumer on
>> the mothership, the shovels play data in as fast as they can acknowledge
>> it.
>>
>> Ideally I'd be able to turn off producer flow control on the mothership
>> side so the shovels wouldn't be slowed down except in cases where I'm
>> approaching high watermarks or something along those lines.
>>
>> Can anyone offer any suggestions on how I might be able to adjust the
>> behavior?
>>
>> Thanks,
>> -Aaron
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/5ceffeb2/attachment.htm>

From nigelbenns at rogers.com  Tue Feb  5 03:36:48 2013
From: nigelbenns at rogers.com (Nigel Benns)
Date: Mon, 4 Feb 2013 19:36:48 -0800 (PST)
Subject: [rabbitmq-discuss] RHEL init script rabbitmqctl status
Message-ID: <41d505d4-00ca-43c1-9d8f-1d9b7cc9c8d8@googlegroups.com>

the startup script for RHEL requires that the rabbitmqctl status command 
returns a non zero code if the server is down.
Due to this the startup script always says that the server is currently 
running and fails to start.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/f39e3fd5/attachment.htm>

From tim at rabbitmq.com  Tue Feb  5 09:48:15 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 5 Feb 2013 09:48:15 +0000
Subject: [rabbitmq-discuss] Is it error?
In-Reply-To: <CAEQ7gRNMWhP942G8OJKXaMC7WMBJyzimexESdwaTMhZGJXQB8Q@mail.gmail.com>
References: <CAEQ7gRNMWhP942G8OJKXaMC7WMBJyzimexESdwaTMhZGJXQB8Q@mail.gmail.com>
Message-ID: <6E85014A-B303-4D66-97AC-ECE2C1D77825@rabbitmq.com>

On 4 Feb 2013, at 18:31, ????? wrote:

> I found strange behavior in some case. What i do:
> 
> 1. Connect to server
> 2. Open channel with name is '1'

Channel's don't have *name* property, so I'm not sure what you're talking about here.

> 3. Declare queue with passive = 1
> 

Does the queue already exist, or are you trying to create it here?

> And after that i try declare queue with passive = 0 if i receive 404 error in third step. Receive error like 'Declare Exchange: Resource temporary unavailable'. Is it actual behavior?


From http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.passive

"bit passive
 If set, the server will reply with Declare-Ok if the queue already exists with the same name, and raise an error if not."

So you would end up with a channel error if the queue doesn't already exit and will need to open a new channel. If that's the case, then it's likely the behaviour you're seeing is consistent but the client error is confusing. The 404 channel error means "The client attempted to work with a server entity that does not exist".

Cheers,
Tim

From simon at rabbitmq.com  Tue Feb  5 10:25:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 05 Feb 2013 10:25:49 +0000
Subject: [rabbitmq-discuss] RHEL init script rabbitmqctl status
In-Reply-To: <41d505d4-00ca-43c1-9d8f-1d9b7cc9c8d8@googlegroups.com>
References: <41d505d4-00ca-43c1-9d8f-1d9b7cc9c8d8@googlegroups.com>
Message-ID: <5110DE2D.1060605@rabbitmq.com>

On 05/02/13 03:36, Nigel Benns wrote:
> the startup script for RHEL requires that the rabbitmqctl status command
> returns a non zero code if the server is down.

Yes...

# /usr/sbin/rabbitmqctl status
Status of node rabbit at misscorporate ...
Error: unable to connect to node rabbit at misscorporate: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at misscorporate]

hosts, their running nodes and ports:
- misscorporate: [{rabbitmqctl3349,33827}]

current node details:
- node name: rabbitmqctl3349 at misscorporate
- home dir: /var/lib/rabbitmq
- cookie hash: ZKeuRAz4wbII6wR8itQT0Q==

# echo $?
2

> Due to this the startup script always says that the server is currently
> running and fails to start.

So I can't reproduce this.

I tested this with RabbitMQ 3.0.2 and Erlang R14B on CentOS 5.5. You?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Feb  5 10:31:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 05 Feb 2013 10:31:52 +0000
Subject: [rabbitmq-discuss] RabbitMQ Management console not working
In-Reply-To: <4cd9b4f4-48c4-417b-87d8-830aade33b69@googlegroups.com>
References: <4cd9b4f4-48c4-417b-87d8-830aade33b69@googlegroups.com>
Message-ID: <5110DF98.6020503@rabbitmq.com>

Which version of RabbitMQ have you installed? Before 3.0.0 you had to 
reinstall the service as well as restarting it.

Checking the logs in %APPDATA%\RabbitMQ\log might give you a clue too - 
there should be lines like:

=INFO REPORT==== 1-Feb-2013::12:46:17 ===
Management agent started.

=INFO REPORT==== 1-Feb-2013::12:46:17 ===
Management plugin started. Port: 15672

=INFO REPORT==== 1-Feb-2013::12:46:17 ===
Statistics database started.

Cheers, Simon

On 04/02/13 13:38, Rok Rejc wrote:
> I have started with RabbitMQ. I have a (windows) machine on which I
> installed two RabbitMQ nodes as a service - I have choose the nodename,
> port and service name for each of them. The services are running
> normally (i see that they are listening in a netstat-a).
>
> I have also installed management plugin with "rabbitmq-plugins enable
> rabbitmq_management" and restarted both services. But the plugin isn't
> running - I dont see it listening in a netstat and I can't connect to
> the management console via browser.
>
> Any idea what could be wrong? Is there any log to see what is going on?
>
>
> Many thanks
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Feb  5 11:21:10 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 05 Feb 2013 11:21:10 +0000
Subject: [rabbitmq-discuss] RabbitMQ Producer Flow Control
In-Reply-To: <CAJsfpEKm8BGsunVhdoqFvLGpfHWqDcwpEwPhFhQs80p_MDD+1A@mail.gmail.com>
References: <CAJsfpELF=heJrjK0hbi7aWm5XcCnMhVtn8+OUT22e7uTTT6-dg@mail.gmail.com>
	<510F9BBF.1080907@rabbitmq.com>
	<CAJsfpEKm8BGsunVhdoqFvLGpfHWqDcwpEwPhFhQs80p_MDD+1A@mail.gmail.com>
Message-ID: <5110EB26.9060704@rabbitmq.com>

Hi Aaron - there's currently no way to turn RabbitMQ's flow control off 
since it's doing something different from ActiveMQ's flow control 
(assuming I read their documentation correctly).

RabbitMQ's flow control is there to make sure that messages are accepted 
by the broker at no more than the rate that the queues can enqueue them. 
In other words, if flow control were turned off, messages would back up 
very quickly in the channel and connection processes, and memory use 
shoots for the sky very quickly.

As I understand it ActiveMQ uses flow control to limit message ingress 
rates to prevent queues from becoming too big - in other words it kicks 
in earlier than RabbitMQ's control. The consequence of turning it off is 
just that queues get bigger - in other words, ActiveMQ with flow control 
off is equivalent to RabbitMQ with flow control on. I think.

The real question then is why your queue is only able to accept 4k 
messages / sec. If they are persistent messages in a durable queue I 
would expect that - that's the cost of getting the messages onto disc. 
Ditto if the messages are non-persistent but the queues are large enough 
to need to page to disc. Oh, and mirrored queues were quite slow in 2.x 
too, they're much faster now. Could any of these things account for the 
performance you're seeing?

Cheers, Simon

On 04/02/13 18:48, Aaron Blew wrote:
> Hey Simon,
> Thanks for getting back to me.  After upgrading to 2.8.7 I'm still
> unable to flow messages in to the head node faster than 4,000/sec while
> the consumer is working.  I appreciate that flow control is trying to
> prevent the server from being over-run, but in some situations it would
> be very beneficial for an administrator to override this behavior.  Are
> there any plans to add this kind of behavior?  I'm currently seriously
> considering a switch to ActiveMQ/stomp since it gives me the knobs to
> tweak this behavior both in real time and via configuration.
>
> Thanks!
> -Aaron
>
>
> On Mon, Feb 4, 2013 at 3:30 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hi. There's a bug in versions of RabbitMQ prior to 2.8.4 where under
>     some circumstances queues can over-prioritise getting rid of message
>     to such an extent that they don't accept any more until empty.
>
>     I recommend an upgrade to 2.8.7 at least, or preferably 3.0.2.
>
>     And in this case flow control is just the messenger, so you don't
>     want to shoot it :-)
>
>     Cheers, Simon
>
>
>     On 01/02/13 17:31, Aaron Blew wrote:
>
>         Hi all,
>         I'm currently using RabbitMQ 2.8.1 as the backbone of my Logstash
>         architecture.  Currently I've got 5 RabbitMQ servers running shovels
>         that push messages onto the "mothership", where data is consumed
>         by a
>         Logstash agent that feeds into various endpoints.
>
>         The issue is that under high load the Logstash consumer on the
>         mothership isn't fast enough at to keep up with the data coming in
>         (generally above 4,000 messages/sec).  Normally this wouldn't be a
>         problem since we've got capacity to buffer things on the
>         mothership, but
>         RabbitMQ starts rate limiting the shovels that are sending data in,
>         which compounds the issue since the nodes shoveling data don't
>         have as
>         much IO capacity as the mothership does.  If I stop the slow
>         consumer on
>         the mothership, the shovels play data in as fast as they can
>         acknowledge it.
>
>         Ideally I'd be able to turn off producer flow control on the
>         mothership
>         side so the shovels wouldn't be slowed down except in cases
>         where I'm
>         approaching high watermarks or something along those lines.
>
>         Can anyone offer any suggestions on how I might be able to
>         adjust the
>         behavior?
>
>         Thanks,
>         -Aaron
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From chaitanya.gaur at gmail.com  Tue Feb  5 06:16:39 2013
From: chaitanya.gaur at gmail.com (alice7)
Date: Mon, 4 Feb 2013 22:16:39 -0800 (PST)
Subject: [rabbitmq-discuss] Failed to create cookie z
Message-ID: <29ad20a8-37b2-4fca-9cd0-a689066be827@googlegroups.com>

HI Guys,
I just installed new erlang and new rabbit mq on my machine.
And when I trying to enable the management module it is giving this error:


C:\Program Files (x86)\erl5.10\erts-5.10\bin>erl.exe -sname rabbit
{error_logger,{{2013,2,5},{0,8,58}},"Failed to create cookie file 
'z:/.erlang.co
okie': enoent",[]}
{error_logger,{{2013,2,5},{0,8,58}},crash_report,[[{initial_call,{auth,init,['Ar
gument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{"Failed 
to
create cookie file 'z:/.erlang.cookie': 
enoent",[{auth,init_cookie,0,[{file,"aut
h.erl"},{line,285}]},{auth,init,1,[{file,"auth.erl"},{line,139}]},{gen_server,in
it_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file
,"proc_lib.erl"},{line,239}]}]},[{gen_server,init_it,6,[{file,"gen_server.erl"},
{line,328}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]}},
{ancestors,[net_sup,kernel_sup,<0.10.0>]},{messages,[]},{links,[<0.17.0>]},{dict
ionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,27},{re
ductions,917}],[]]}
{error_logger,{{2013,2,5},{0,8,58}},supervisor_report,[{supervisor,{local,net_su
p}},{errorContext,start_error},{reason,{"Failed to create cookie file 
'z:/.erlan
g.cookie': 
enoent",[{auth,init_cookie,0,[{file,"auth.erl"},{line,285}]},{auth,in
it,1,[{file,"auth.erl"},{line,139}]},{gen_server,init_it,6,[{file,"gen_server.er
l"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}
]}},{offender,[{pid,undefined},{name,auth},{mfargs,{auth,start_link,[]}},{restar
t_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2013,2,5},{0,8,58}},supervisor_report,[{supervisor,{local,kernel
_sup}},{errorContext,start_error},{reason,{shutdown,{failed_to_start_child,auth,
{"Failed to create cookie file 'z:/.erlang.cookie': 
enoent",[{auth,init_cookie,0
,[{file,"auth.erl"},{line,285}]},{auth,init,1,[{file,"auth.erl"},{line,139}]},{g
en_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_ap
ply,3,[{file,"proc_lib.erl"},{line,239}]}]}}}},{offender,[{pid,undefined},{name,
net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shu
tdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2013,2,5},{0,8,58}},crash_report,[[{initial_call,{application_ma
ster,init,['Argument__1','Argument__2','Argument__3','Argument__4']}},{pid,<0.9.
0>},{registered_name,[]},{error_info,{exit,{{shutdown,{failed_to_start_child,net
_sup,{shutdown,{failed_to_start_child,auth,{"Failed to create cookie file 
'z:/.e
rlang.cookie': 
enoent",[{auth,init_cookie,0,[{file,"auth.erl"},{line,285}]},{aut
h,init,1,[{file,"auth.erl"},{line,139}]},{gen_server,init_it,6,[{file,"gen_serve
r.erl"},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,23
9}]}]}}}}},{kernel,start,[normal,[]]}},[{application_master,init,4,[{file,"appli
cation_master.erl"},{line,138}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.er
l"},{line,239}]}]}},{ancestors,[<0.8.0>]},{messages,[{'EXIT',<0.10.0>,normal}]},
{links,[<0.8.0>,<0.7.0>]},{dictionary,[]},{trap_exit,true},{status,running},{hea
p_size,610},{stack_size,27},{reductions,150}],[]]}
{error_logger,{{2013,2,5},{0,8,58}},std_info,[{application,kernel},{exited,{{shu
tdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,auth,{"Fai
led to create cookie file 'z:/.erlang.cookie': 
enoent",[{auth,init_cookie,0,[{fi
le,"auth.erl"},{line,285}]},{auth,init,1,[{file,"auth.erl"},{line,139}]},{gen_se
rver,init_it,6,[{file,"gen_server.erl"},{line,304}]},{proc_lib,init_p_do_apply,3
,[{file,"proc_lib.erl"},{line,239}]}]}}}}},{kernel,start,[normal,[]]}}},{type,pe
rmanent}]}
{"Kernel pid 
terminated",application_controller,"{application_start_failure,kern
el,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,au
th,{\"Failed to create cookie file 'z:/.erlang.cookie': 
enoent\",[{auth,init_coo
kie,0,[{file,\"auth.erl\"},{line,285}]},{auth,init,1,[{file,\"auth.erl\"},{line,
139}]},{gen_server,init_it,6,[{file,\"gen_server.erl\"},{line,304}]},{proc_lib,i
nit_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,239}]}]}}}}},{kernel,start,[norm
al,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) 
({application_start_failure,kerne
l,{{shutdown,{failed_to_start_child,net_sup,{shutdown,{failed_to_start_child,aut
h,{"Failed to create cookie file 'z:/.

Any ideas guys?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130204/9eb67f5a/attachment.htm>

From emile at rabbitmq.com  Tue Feb  5 12:07:07 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 05 Feb 2013 12:07:07 +0000
Subject: [rabbitmq-discuss] Failed to create cookie z
In-Reply-To: <29ad20a8-37b2-4fca-9cd0-a689066be827@googlegroups.com>
References: <29ad20a8-37b2-4fca-9cd0-a689066be827@googlegroups.com>
Message-ID: <5110F5EB.8080308@rabbitmq.com>

Hi,

On 05/02/13 06:16, alice7 wrote:
> I just installed new erlang and new rabbit mq on my machine.
> And when I trying to enable the management module it is giving this error:
> 
> C:\Program Files (x86)\erl5.10\erts-5.10\bin>erl.exe -sname rabbit

Why are you starting the broker in this way instead of using one of the
supplied .BAT files? Are you sure the shell environment is correctly
populated for that to succeed?

> {error_logger,{{2013,2,5},{0,8,58}},"Failed to create cookie file
> 'z:/.erlang.cookie': enoent",[]}

"ENOENT" means "No such file or directory". Are you sure you have a Z:
drive? If you have installed the broker manually then make sure you read
http://www.rabbitmq.com/install-windows-manual.html .





-Emile




From emile at rabbitmq.com  Tue Feb  5 12:52:58 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 05 Feb 2013 12:52:58 +0000
Subject: [rabbitmq-discuss] Interval exchange
In-Reply-To: <CAMcAHLWNXVZqtRfTgMPGKSew=0QxPQaqD00pWz=Xrfa7oJBYtg@mail.gmail.com>
References: <CAMcAHLWNXVZqtRfTgMPGKSew=0QxPQaqD00pWz=Xrfa7oJBYtg@mail.gmail.com>
Message-ID: <511100AA.8020403@rabbitmq.com>

Hi Alvaro,

On 04/02/13 16:00, Alvaro Videla wrote:
> Any thoughts?

That's a pretty neat idea. Your proposal can also generalise to
real/floating point numbers and higher dimensions.

The priorities use-case normally has small exclusive intervals so it
will be just as easy to bind queues with individual integers/routing
keys. The load balancing use-case can be met with a random or consistent
hash exchange. Are there any other compelling use-cases?



-Emile




From emile at rabbitmq.com  Tue Feb  5 13:39:06 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 05 Feb 2013 13:39:06 +0000
Subject: [rabbitmq-discuss] Patches for the RabbitMQ Erlang client
In-Reply-To: <CAGrdgiX6EB-zV-0BUs0tfwh_8YWwCura4HEu6OLxgDQz_0dYTg@mail.gmail.com>
References: <CAGrdgiX6EB-zV-0BUs0tfwh_8YWwCura4HEu6OLxgDQz_0dYTg@mail.gmail.com>
Message-ID: <51110B7A.6020004@rabbitmq.com>



Hi,

Thanks for your contribution.

On 02/02/13 18:28, Jesper Louis Andersen wrote:
> They fix some irritating complaints from the code

Can you provide any more information about what these complaints look
like and explain how to provoke them?

> If you apply them, please give credit to their author, Vladimir Baranov,
> who found them originally.

Would you or Vladimir be prepared to sign a contributor agreement in the
event that your patches are accepted? Who should I send it to?



-Emile





From mcsseifer at gmail.com  Tue Feb  5 13:52:22 2013
From: mcsseifer at gmail.com (=?UTF-8?B?0KLQuNC80YPRgA==?=)
Date: Tue, 5 Feb 2013 17:52:22 +0400
Subject: [rabbitmq-discuss] Is it error?
In-Reply-To: <6E85014A-B303-4D66-97AC-ECE2C1D77825@rabbitmq.com>
References: <CAEQ7gRNMWhP942G8OJKXaMC7WMBJyzimexESdwaTMhZGJXQB8Q@mail.gmail.com>
	<6E85014A-B303-4D66-97AC-ECE2C1D77825@rabbitmq.com>
Message-ID: <CAEQ7gRNHwpSXzDfuQXThTWkp4LTYPy7BCB==od_n3YtuYCh3Cg@mail.gmail.com>

My client raise error on 404 error.
I use passive mode for detect exists queue or not. And if it not exists
then i try create it without passive. So, i realy cant do something like
that:

connection->channel_close(1);
connecton->channel_open(1);

because "Opening channel: server connection error 503, message:
COMMAND_INVALID - second 'channel.open'"

Instead this i reopen connect to server, but its not good way.


2013/2/5 Tim Watson <tim at rabbitmq.com>

> On 4 Feb 2013, at 18:31, ????? wrote:
>
> > I found strange behavior in some case. What i do:
> >
> > 1. Connect to server
> > 2. Open channel with name is '1'
>
> Channel's don't have *name* property, so I'm not sure what you're talking
> about here.
>
> > 3. Declare queue with passive = 1
> >
>
> Does the queue already exist, or are you trying to create it here?
>
> > And after that i try declare queue with passive = 0 if i receive 404
> error in third step. Receive error like 'Declare Exchange: Resource
> temporary unavailable'. Is it actual behavior?
>
>
> From
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.passive
>
> "bit passive
>  If set, the server will reply with Declare-Ok if the queue already exists
> with the same name, and raise an error if not."
>
> So you would end up with a channel error if the queue doesn't already exit
> and will need to open a new channel. If that's the case, then it's likely
> the behaviour you're seeing is consistent but the client error is
> confusing. The 404 channel error means "The client attempted to work with a
> server entity that does not exist".
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/a100e6dc/attachment.htm>

From dev440 at gmail.com  Tue Feb  5 13:55:50 2013
From: dev440 at gmail.com (chetan dev)
Date: Tue, 5 Feb 2013 19:25:50 +0530
Subject: [rabbitmq-discuss] Regarding Unack messages
In-Reply-To: <510F94AF.6060003@rabbitmq.com>
References: <CAB0ZxM5quvP5=A+OQFmfCSGhSQatFxx5TmCqCw_fz7DnmgGaNw@mail.gmail.com>
	<510F94AF.6060003@rabbitmq.com>
Message-ID: <CAB0ZxM4ehjstAZwrw+YaVYi4PeThbP2R5Saah4VdrKcB2Wjk-Q@mail.gmail.com>

Hi,

Thanks for your reply , my actual situation is as follows
A queue contains few messages.
I have set basic.qos to 5 now a consumer picks 5 messages at a time
.Messages are  sent one by one but they are left unacknowledged so they
remain in queue but after these 5 messages rabbitmq should serve 5 other
messages from the queue but rabbitmq consumer stop fetching other messages .
so my question is what actually happens and how do i handle this situation?
Thanks



On Mon, Feb 4, 2013 at 4:29 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 01/02/13 13:09, chetan dev wrote:
> > When all the messages are processed without acknowledgement, rabbitmq
> > consumer stops fetching other messages from the queue
> >
> > How do i handle such situation
>
> It is not clear what you mean by "other messages". If there are no
> further messages to deliver then the broker has no choice but to wait
> for more message to arrive from publishers before sending them on to
> consumers. You might also look at the "Message Acknowledgement" section
> in the second tutorial:
>
> http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>
>
>
>
> -Emile
>
>
>
>
>


-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/419612f9/attachment.htm>

From simon at rabbitmq.com  Tue Feb  5 13:56:17 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 05 Feb 2013 13:56:17 +0000
Subject: [rabbitmq-discuss] Is it error?
In-Reply-To: <CAEQ7gRNHwpSXzDfuQXThTWkp4LTYPy7BCB==od_n3YtuYCh3Cg@mail.gmail.com>
References: <CAEQ7gRNMWhP942G8OJKXaMC7WMBJyzimexESdwaTMhZGJXQB8Q@mail.gmail.com>
	<6E85014A-B303-4D66-97AC-ECE2C1D77825@rabbitmq.com>
	<CAEQ7gRNHwpSXzDfuQXThTWkp4LTYPy7BCB==od_n3YtuYCh3Cg@mail.gmail.com>
Message-ID: <51110F81.1040806@rabbitmq.com>

On 05/02/13 13:52, ????? wrote:
> I use passive mode for detect exists queue or not. And if it not exists
> then i try create it without passive.

But why do that? Why not just declare it actively? That's how 
queue.declare is meant to be used; it's a no-op if the queue already exists.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Tue Feb  5 13:57:39 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 5 Feb 2013 14:57:39 +0100
Subject: [rabbitmq-discuss] Is it error?
In-Reply-To: <CAEQ7gRNHwpSXzDfuQXThTWkp4LTYPy7BCB==od_n3YtuYCh3Cg@mail.gmail.com>
References: <CAEQ7gRNMWhP942G8OJKXaMC7WMBJyzimexESdwaTMhZGJXQB8Q@mail.gmail.com>
	<6E85014A-B303-4D66-97AC-ECE2C1D77825@rabbitmq.com>
	<CAEQ7gRNHwpSXzDfuQXThTWkp4LTYPy7BCB==od_n3YtuYCh3Cg@mail.gmail.com>
Message-ID: <CAMcAHLU7d8Z9a+_D+hTCXMOuoeBSvnDB5_b=G55zDdfckNmjRQ@mail.gmail.com>

I don't know what you are trying to do, but the idea behind the "declare"
methods is that you don't need to issue a "queue_declare" passive=true just
to see if the queue is there, if not then create it with another
queue_declare.

"queue_declare" won't do anything if the queue already exists, so you
shouldn't need to use it twice.


On Tue, Feb 5, 2013 at 2:52 PM, ????? <mcsseifer at gmail.com> wrote:

> My client raise error on 404 error.
> I use passive mode for detect exists queue or not. And if it not exists
> then i try create it without passive. So, i realy cant do something like
> that:
>
> connection->channel_close(1);
> connecton->channel_open(1);
>
> because "Opening channel: server connection error 503, message:
> COMMAND_INVALID - second 'channel.open'"
>
> Instead this i reopen connect to server, but its not good way.
>
>
> 2013/2/5 Tim Watson <tim at rabbitmq.com>
>
>> On 4 Feb 2013, at 18:31, ????? wrote:
>>
>> > I found strange behavior in some case. What i do:
>> >
>> > 1. Connect to server
>> > 2. Open channel with name is '1'
>>
>> Channel's don't have *name* property, so I'm not sure what you're talking
>> about here.
>>
>> > 3. Declare queue with passive = 1
>> >
>>
>> Does the queue already exist, or are you trying to create it here?
>>
>> > And after that i try declare queue with passive = 0 if i receive 404
>> error in third step. Receive error like 'Declare Exchange: Resource
>> temporary unavailable'. Is it actual behavior?
>>
>>
>> From
>> http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.passive
>>
>> "bit passive
>>  If set, the server will reply with Declare-Ok if the queue already
>> exists with the same name, and raise an error if not."
>>
>> So you would end up with a channel error if the queue doesn't already
>> exit and will need to open a new channel. If that's the case, then it's
>> likely the behaviour you're seeing is consistent but the client error is
>> confusing. The 404 channel error means "The client attempted to work with a
>> server entity that does not exist".
>>
>> Cheers,
>> Tim
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/31ce6d4d/attachment.htm>

From emile at rabbitmq.com  Tue Feb  5 14:04:26 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 05 Feb 2013 14:04:26 +0000
Subject: [rabbitmq-discuss] Regarding Unack messages
In-Reply-To: <CAB0ZxM4ehjstAZwrw+YaVYi4PeThbP2R5Saah4VdrKcB2Wjk-Q@mail.gmail.com>
References: <CAB0ZxM5quvP5=A+OQFmfCSGhSQatFxx5TmCqCw_fz7DnmgGaNw@mail.gmail.com>
	<510F94AF.6060003@rabbitmq.com>
	<CAB0ZxM4ehjstAZwrw+YaVYi4PeThbP2R5Saah4VdrKcB2Wjk-Q@mail.gmail.com>
Message-ID: <5111116A.6010806@rabbitmq.com>

Hi,

On 05/02/13 13:55, chetan dev wrote:

> A queue contains few messages.
> I have set basic.qos to 5 now a consumer picks 5 messages at a time
> .Messages are  sent one by one but they are left unacknowledged so they
> remain in queue but after these 5 messages rabbitmq should serve 5 other
> messages from the queue but rabbitmq consumer stop fetching other messages .
> so my question is what actually happens and how do i handle this situation?
The basic.qos prefetch count places a limit on how many unacknowledged
messages a consumer may hold. If you want a consumer to hold more than 5
unacknowledged messages then you should raise the limit from 5 to a
larger number, commensurate with requirements.

If you want to maintain the prefetch count limit, but have the consumer
obtain the next 5 messages then the consumer must first acknowledge the
last 5 messages.



-Emile







From steve at dnsbed.com  Tue Feb  5 14:17:27 2013
From: steve at dnsbed.com (Steve)
Date: Tue, 05 Feb 2013 22:17:27 +0800
Subject: [rabbitmq-discuss] about the deliver confirm
Message-ID: <51111477.5000305@dnsbed.com>

Hello,

The defaut options for a deliver are no-ack=false and auto-ack=true, is
it? For auto-ack=true does it mean the broker will notify the producer
automatically that the message has been delivered into the queue
successfully?

Thanks.

From emile at rabbitmq.com  Tue Feb  5 16:39:12 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 05 Feb 2013 16:39:12 +0000
Subject: [rabbitmq-discuss] about the deliver confirm
In-Reply-To: <51111477.5000305@dnsbed.com>
References: <51111477.5000305@dnsbed.com>
Message-ID: <511135B0.50809@rabbitmq.com>


Hi Steve,

On 05/02/13 14:17, Steve wrote:
> The defaut options for a deliver are no-ack=false and auto-ack=true, is it?

The specification does not define any defaults, but your client library
may. "no-ack" and "auto-ack" are synonyms, so their defaults will be the
same.

> For auto-ack=true does it mean the broker will notify the producer
> automatically that the message has been delivered into the queue
> successfully?

No. You may be confusing any combination of basic.return, publishing
with the mandatory flag and publisher confirms. I suggest you read the
text of the tutorials which introduces messaging concepts:

http://www.rabbitmq.com/getstarted.html
http://www.rabbitmq.com/tutorials/amqp-concepts.html



-Emile







From pekowski at gmail.com  Tue Feb  5 17:50:53 2013
From: pekowski at gmail.com (Ray Pekowski)
Date: Tue, 5 Feb 2013 09:50:53 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <50AFC3AB-981C-42D8-AB02-31496E42D8B4@rabbitmq.com>
References: <CAJcv3CSQBm3nq_YBTpmnZ7h8J9SNt-dO=BHkUGw3XRPyaKR8zA@mail.gmail.com>
	<50AFC3AB-981C-42D8-AB02-31496E42D8B4@rabbitmq.com>
Message-ID: <1360086653814-24874.post@n5.nabble.com>

Ask Solem-3 wrote
>> On Jan 22, 2013, at 1:58 PM, Ask Solem 
> <ask at rabbitmq.com>
>  wrote:
> 
> I've spent some time reviewing the code, but it's really hard to follow,
> and it's
> reinventing a lot of things that Kombu already supports.   Having two sets
> of
> implementations means that we both have to debug and maintain it, this
> code could
> definitely be reduced by a lot.

Thank you for taking the time to review the code.  Yes, it is confusing and
perhaps impossible to fully understand without also reading amqp.py
(https://github.com/openstack/nova/blob/master/nova/openstack/common/rpc/amqp.py),
which is a common module between the kombu and Qpid implementations for
OpenStack.


Ask Solem-3 wrote
> One thing that I'm unable to understand is whether it's creating a channel
> or not
> (other than the Connection.default_channel), and if so if it creates a
> channel for
> every request.  This would be bad since creating channels is very
> expensive (at least in amqplib/py-amqp).

It does not create a new channel on each request.  The channel object is
held in a impl_kombu.Connection class instance and instances of
impl_kombu.Connection are pooled.  You can find the pool implementation in
amqp.py that I mentioned earlier.


Ask Solem-3 wrote
> Also, it seems that the reply messages are persistent, do they have to be?

The reply messages are RPC replies are implemented in the DirectPublisher
class which has {'durable': False} for its exchange and queue options.  The
RPC call is done via the TopicPublisher class and it has the durable option
that defaults to False, but can be overridden using a OpenStack nova.conf
file configuration setting.

BTW, one of the questions that has come up is whether it makes sense for the
RPC reply queues to mirrored.  Is HA generally thought of as important for
RPC replies?  I just am not sure.  Our current implementation has mirroring
turned off for reply queues, but we are trying to figure out if that was
just an oversight.

Ray








--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-scaling-with-OpenStack-tp24646p24874.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From developmentalmadness at gmail.com  Tue Feb  5 19:58:28 2013
From: developmentalmadness at gmail.com (Mark Miller)
Date: Tue, 5 Feb 2013 11:58:28 -0800 (PST)
Subject: [rabbitmq-discuss] Publisher confirms clarification
Message-ID: <004c7a73-681f-40a3-84cb-4b7c67faef15@googlegroups.com>

Publisher confirms define handled sucessfully as follows:

   - an un-routable mandatory or immediate message is confirmed right after 
   the *basic.return*;
   - otherwise, a transient message is confirmed the moment it is enqueued; 
   and,
   - a persistent message is confirmed when it is persisted to disk or when 
   it is consumed on every queue.


So my question is about the 3rd point: Is this a "whichever comes first" 
situation? If the message is consumed and ack'd on all queues before it 
gets persisted to disk then the confirmation will be sent? Or if the 
message is persisted to disk hasn't been ack'd then the confirm will still 
be sent?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/b35fb285/attachment.htm>

From jerryk at rbcon.com  Tue Feb  5 20:43:37 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Tue, 5 Feb 2013 12:43:37 -0800
Subject: [rabbitmq-discuss] Publisher confirms clarification
In-Reply-To: <004c7a73-681f-40a3-84cb-4b7c67faef15@googlegroups.com>
References: <004c7a73-681f-40a3-84cb-4b7c67faef15@googlegroups.com>
Message-ID: <F2AC9EE5-71B9-4D8E-BA14-2BBB5F1CA2B5@rbcon.com>

See chapter 11 of RabbitMQ in Action for a nice flow chart covering how messages are handled. 

The publisher confirm goes out when what you asked for (at least) has happened. For a persistent message this means persistence to disc in any queue and any mirrors thereof it was destined for.  If circumstances are such that there was a ready, connected consumer chewing on an empty queue it's possible that the persistence will be skipped and the message directly delivered in which case the transmission of the confirm signifies this event. 

Best regards,
Jerry

Sent from my iPad.

On Feb 5, 2013, at 11:58 AM, Mark Miller <developmentalmadness at gmail.com> wrote:

> Publisher confirms define handled sucessfully as follows:
> an un-routable mandatory or immediate message is confirmed right after the basic.return;
> otherwise, a transient message is confirmed the moment it is enqueued; and,
> a persistent message is confirmed when it is persisted to disk or when it is consumed on every queue.
> 
> So my question is about the 3rd point: Is this a "whichever comes first" situation? If the message is consumed and ack'd on all queues before it gets persisted to disk then the confirmation will be sent? Or if the message is persisted to disk hasn't been ack'd then the confirm will still be sent?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/79d6a994/attachment.htm>

From richard at raseley.com  Wed Feb  6 00:22:23 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 5 Feb 2013 16:22:23 -0800
Subject: [rabbitmq-discuss] Topic Exchange Question
Message-ID: <CAO=6ox_Cx29+fQG6faEY4Jqn8vkZWriB2uon3uOKY-qi6fiqiQ@mail.gmail.com>

Can a topic exchange be used to route messages both to a queue but also to
another exchange (to be routed to queues by that second exchange)? I have
been looking for documentation that talks about such a configuration, but I
am only seeing exchange to queue documentation.

Thank you in advance for any assistance.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/8c2e1553/attachment.htm>

From videlalvaro at gmail.com  Wed Feb  6 00:31:43 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 6 Feb 2013 01:31:43 +0100
Subject: [rabbitmq-discuss] Topic Exchange Question
In-Reply-To: <CAO=6ox_Cx29+fQG6faEY4Jqn8vkZWriB2uon3uOKY-qi6fiqiQ@mail.gmail.com>
References: <CAO=6ox_Cx29+fQG6faEY4Jqn8vkZWriB2uon3uOKY-qi6fiqiQ@mail.gmail.com>
Message-ID: <CAMcAHLUnfog6Mm95upUtaQ5emOeBbUjbj8J-dShShSL3uo=ZaQ@mail.gmail.com>

Yes, it can be done:

See: http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/
and: http://www.rabbitmq.com/e2e.html

Regards,

Alvaro


On Wed, Feb 6, 2013 at 1:22 AM, Richard Raseley <richard at raseley.com> wrote:

> Can a topic exchange be used to route messages both to a queue but also to
> another exchange (to be routed to queues by that second exchange)? I have
> been looking for documentation that talks about such a configuration, but I
> am only seeing exchange to queue documentation.
>
> Thank you in advance for any assistance.
>
> Regards,
>
> Richard
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/fadb929a/attachment.htm>

From richard at raseley.com  Wed Feb  6 06:19:08 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 5 Feb 2013 22:19:08 -0800
Subject: [rabbitmq-discuss] Topic Exchange Question
In-Reply-To: <CAMcAHLUnfog6Mm95upUtaQ5emOeBbUjbj8J-dShShSL3uo=ZaQ@mail.gmail.com>
References: <CAO=6ox_Cx29+fQG6faEY4Jqn8vkZWriB2uon3uOKY-qi6fiqiQ@mail.gmail.com>
	<CAMcAHLUnfog6Mm95upUtaQ5emOeBbUjbj8J-dShShSL3uo=ZaQ@mail.gmail.com>
Message-ID: <CAO=6ox9fpZuEsSJ7=_dsRjHfJhhKkVkBG2qtXcWynL5B0pNW+Q@mail.gmail.com>

Thank you for that information.

I am in the process of setting up some test machines now, but based on what
I am reading it seems that the bound exchanges must be instantiated within
the same RabbitMQ instance or cluster.

In my situation I'd like to have a topic exchange that could route to a
local queue or "foreign" exchange based on the topic. Would you comment on
whether or not that is possible with the "exchange.bind" method?

Regards,

Richard

On Feb 5, 2013 4:33 PM, "Alvaro Videla" <videlalvaro at gmail.com> wrote:
>
> Yes, it can be done:
>
> See:
http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/
> and: http://www.rabbitmq.com/e2e.html
>
> Regards,
>
> Alvaro
>
>
> On Wed, Feb 6, 2013 at 1:22 AM, Richard Raseley <richard at raseley.com>
wrote:
>>
>> Can a topic exchange be used to route messages both to a queue but also
to another exchange (to be routed to queues by that second exchange)? I
have been looking for documentation that talks about such a configuration,
but I am only seeing exchange to queue documentation.
>>
>> Thank you in advance for any assistance.
>>
>> Regards,
>>
>> Richard
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/4bc80600/attachment.htm>

From mengql112233 at gmail.com  Wed Feb  6 07:58:59 2013
From: mengql112233 at gmail.com (Qinglong.Meng)
Date: Wed, 6 Feb 2013 15:58:59 +0800
Subject: [rabbitmq-discuss] [rabbitmql] pika throw exception following the
	Toturials
Message-ID: <CAPKora-fDXTx6OVj54krmDiypz44UntPDWeJvyxd3LsRd19Y0g@mail.gmail.com>

Hi,
    When I following the Totuials 'Hello World!', and I use pika==0.9.8, I
got  pika excetion:
    pika.exceptions.AMQPConnectionError: (0, '')
File "/root/workspace/rabbitmq/01sample/011publisher.py", line 19, in
<module>
  conn =
pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
File
"/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py",
line 61, in __init__
  super(BaseConnection, self).__init__(parameters, on_open_callback)
File
"/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/connection.py",
line 513, in __init__
  self._connect()
File
"/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/connection.py",
line 804, in _connect
  self._adapter_connect()
File
"/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
line 146, in _adapter_connect
  self.process_data_events()
File
"/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
line 88, in process_data_events
  if self._handle_read():
File
"/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
line 184, in _handle_read
  super(BlockingConnection, self)._handle_read()
File
"/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py",
line 300, in _handle_read
  return self._handle_error(error)
File
"/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py",
line 264, in _handle_error
  self._handle_disconnect()
File
"/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
line 181, in _handle_disconnect
  self._on_connection_closed(None, True)
File
"/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
line 235, in _on_connection_closed
  raise exceptions.AMQPConnectionError(*self.closing)

Can anybody help me..

Tks very much
Best Regards,

-- 

Lawrency Meng
mail: mengql112233 at gmail.com
_______________________________________________
Mailing list: https://launchpad.net/~openstack
Post to     : openstack at lists.launchpad.net
Unsubscribe : https://launchpad.net/~openstack
More help   : https://help.launchpad.net/ListHelp
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/70e2d366/attachment.htm>

From danbuchko at gmail.com  Tue Feb  5 17:55:26 2013
From: danbuchko at gmail.com (DLB9000)
Date: Tue, 5 Feb 2013 09:55:26 -0800 (PST)
Subject: [rabbitmq-discuss] Testing lightweight publisher confirms
In-Reply-To: <4ED7925F.1090605@rabbitmq.com>
References: <CAAN_EDqkZYgNVKGgkLNB62H0zekNaVA1VXQoN9CYXb7a+TbbNg@mail.gmail.com>
	<4ED78F47.3030608@rabbitmq.com> <4ED7925F.1090605@rabbitmq.com>
Message-ID: <946601de-4294-42eb-96f4-baf2b9834c84@googlegroups.com>



On Thursday, December 1, 2011 9:42:39 AM UTC-5, Simon MacMullen wrote:

> Ah, hang on. One way to "crash" a queue is to have it running on a 
> single node in a cluster and take that node down. So:

> 1) Create a two node cluster, node1 and node2.
> 2) Create a non-mirrored queue on node1.
> 3) Start a publisher using confirms on node2, publishing to that queue.
> 4) Stop node1.

> You should see nacks then I think.

Tried this, but was still unable to generate a NACK.

Dan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/c06c0198/attachment.htm>

From aminer at groupon.com  Tue Feb  5 20:11:17 2013
From: aminer at groupon.com (aminer at groupon.com)
Date: Tue, 5 Feb 2013 12:11:17 -0800 (PST)
Subject: [rabbitmq-discuss] Correct way of determining which node is
 master?
In-Reply-To: <20120222201004.GB29288@wellquite.org>
References: <CB692AB0.2EDD5%mpietrek@skytap.com>
	<4F44BC43.7070701@rabbitmq.com>
	<CACLE7iwZ0L8fd8Ke=xzBtGdQX8weMvhnhRGp4q3pT1M8LAm_+Q@mail.gmail.com>
	<20120222201004.GB29288@wellquite.org>
Message-ID: <c6506d1e-5e48-4d17-aabf-acd9b9ed3898@googlegroups.com>

I'm faced with much the same issue Matt P. mentions, but I wanted to make 
sure I understand how this works.  Is the following correct?

The system is set up to have a set of three hosts each running a single 
RabbitMQ node.  A load-balancer routes traffic evenly between all the 
nodes, and has a health-check to determine whether each node is active and 
healthy.  The entire cluster is served by a single external IP address 
(which points to the load balancer).

Within the cluster, let's say I have a topic exchange, and a number of 
clients who each subscribe to a specific topic (several clients to a topic) 
by creating a permanent, named queue for themselves and binding it to the 
exchange.  The messages come from another server whose sole function is to 
generate these messages and publish them to the exchange.  Let's assume 
everyone connects successfully and a while passes during which everyone 
gets their messages as expected.

Then, one node fails.  The load balancer detects this and stop routing new 
connections to that machine.  All clients connected to that node lose their 
connections and re-connect (through the load balancer) to one of the 
functioning nodes.  They re-subscribe to their named queues, and find all 
the messages they missed while they were re-connecting are waiting for them 
(assuming the mirroring was up-to-date when the one node failed), and 
continue to receive all new messages posted to their topics.

The server publishing the messages opens and closes its connection each 
time it needs to publish a message, so it notices nothing.  The load 
balancer automatically routes it to a functioning node, and publishes to 
the exchange which automatically routes the message to the queue no matter 
what node is current the master node for that queue.

Am I missing anything here?  Thanks very much for any help!


On Wednesday, February 22, 2012 12:10:05 PM UTC-8, Matthew Sackman wrote:
>
> On Wed, Feb 22, 2012 at 10:39:04AM -0800, Matt Pietrek wrote:
> > | Messages are *always* read from the master node (for a given queue).
> > 
> > This is very helpful. Going a step further, is it true to say that in a
> > cluster where we mirror all queues, there's really no benefit to 
> assigning
> > the VIP to one node over another?
>
> Correct, though for performance reasons you might like to ensure the
> masters are roughly uniformly spread over all the nodes.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/d7dc9fad/attachment.htm>

From kkuhl05 at gmail.com  Wed Feb  6 03:41:50 2013
From: kkuhl05 at gmail.com (Kevin Kuhl)
Date: Tue, 5 Feb 2013 19:41:50 -0800 (PST)
Subject: [rabbitmq-discuss] Clustering On EC2
In-Reply-To: <13317489.438.1323707018401.JavaMail.geo-discussion-forums@yqf20>
References: <32642325.2073.1323331885802.JavaMail.geo-discussion-forums@yqfd21>
	<4EE5FA76.4050308@rabbitmq.com>
	<13317489.438.1323707018401.JavaMail.geo-discussion-forums@yqf20>
Message-ID: <a2e4ee2e-ef58-4985-b591-09c6a116de1a@googlegroups.com>

Hi Michael

I know its been a while, but do you have any insight on the solution you 
found here? I'm having a similar problem with creating a highly available 
cluster. We need to use the hostname defaulted on EC2 (ip-xx-xx-xx...) 
because its mapped to DNS and will allow our nodes to communicate. Any 
change to this is not recognizable over DNS in amazon, so setting our own 
will not work unless we manually map them in /etc/hosts. This won't work 
because we will need to handle the case where these machines can die and we 
need to be able to configure them dynamically.

Thanks,
Kevin

On Monday, December 12, 2011 10:23:38 AM UTC-6, Michael Delaney wrote:
>
> thanks michael,
> i'm going to test it tonight
> regards
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/4f70f371/attachment.htm>

From kkuhl05 at gmail.com  Wed Feb  6 04:00:25 2013
From: kkuhl05 at gmail.com (Kevin Kuhl)
Date: Tue, 5 Feb 2013 20:00:25 -0800 (PST)
Subject: [rabbitmq-discuss] Hostname Issues with EC2 Cluster
Message-ID: <fc79ee0a-f433-41f3-9e85-ea23762c476c@googlegroups.com>

Hi all,

I want to set up a 3 node cluster on EC2. We plan to set up a recovery 
configuration in amazon so that if we lose a server, we pull up a new one 
to replace it and cluster it. We;ve been able to set up a cluster manually 
by using the default hostname that resolves over DNS (ip-xx-xx-xx-xx); each 
of the machines can see eachother. This name however, will not work in 
production because it's the INTERNAL DNS reference which changes over time. 
If a failure occurs this will be different on launch and break the cluster 
(right?). 

The ideal situation would be to cluster these with static references to 
each machine. like rabbit at server1, 2, 3 where at any point a new one would 
come up and could join the cluster.

I read this 
article: http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/

Which works most of the way, but the part that's not explained is, once you 
set your own hostname and try to cluster them, how can they see eachother 
if the hostnames are not available over the EC2 network.

Hope this makes sense, any ideas or best practices are greatly appreciated!!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130205/34ab153f/attachment.htm>

From tim at rabbitmq.com  Wed Feb  6 08:32:18 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 6 Feb 2013 08:32:18 +0000
Subject: [rabbitmq-discuss] Topic Exchange Question
In-Reply-To: <CAO=6ox9fpZuEsSJ7=_dsRjHfJhhKkVkBG2qtXcWynL5B0pNW+Q@mail.gmail.com>
References: <CAO=6ox_Cx29+fQG6faEY4Jqn8vkZWriB2uon3uOKY-qi6fiqiQ@mail.gmail.com>
	<CAMcAHLUnfog6Mm95upUtaQ5emOeBbUjbj8J-dShShSL3uo=ZaQ@mail.gmail.com>
	<CAO=6ox9fpZuEsSJ7=_dsRjHfJhhKkVkBG2qtXcWynL5B0pNW+Q@mail.gmail.com>
Message-ID: <39E29AA7-C9FC-4A05-A2B9-8D5D69067FB3@rabbitmq.com>

Hi Richard,

On 6 Feb 2013, at 06:19, Richard Raseley wrote:

> Thank you for that information.
> 
> I am in the process of setting up some test machines now, but based on what I am reading it seems that the bound exchanges must be instantiated within the same RabbitMQ instance or cluster.
> 
> In my situation I'd like to have a topic exchange that could route to a local queue or "foreign" exchange based on the topic.

If you want to have interactions between exchanges on separate Rabbit nodes, then you should look at the federation plugin.

> Would you comment on whether or not that is possible with the "exchange.bind" method?
> 

It's not going to be quite that simple, no. But federation may do what you want, with a bit of configuration.


From meyer at paperplanes.de  Wed Feb  6 08:54:45 2013
From: meyer at paperplanes.de (Mathias Meyer)
Date: Wed, 6 Feb 2013 09:54:45 +0100
Subject: [rabbitmq-discuss] Hostname Issues with EC2 Cluster
In-Reply-To: <fc79ee0a-f433-41f3-9e85-ea23762c476c@googlegroups.com>
References: <fc79ee0a-f433-41f3-9e85-ea23762c476c@googlegroups.com>
Message-ID: <01D33170BD6744ABA7409F96BA317DE6@paperplanes.de>

Kevin,

I'd personally recommend setting either CNAMEs for the external EC2 hostnames (these will always resolve to the internal IP within Amazon's network and to the external IP outside of it) in your own DNS setup or to use custom hostnames that you store in /etc/hosts cluster-wide.

For the former, the path we followed, you need to hook into the DHCP process and provide your own domain as a search path for DNS lookup, then you can have hostnames like rabbitmq1.yourdomain.com configured with your own domains.

Hope this helps!

Cheers, Mathias 




On Wednesday, 6. February 2013 at 05:00, Kevin Kuhl wrote:

> Hi all,
> 
> I want to set up a 3 node cluster on EC2. We plan to set up a recovery configuration in amazon so that if we lose a server, we pull up a new one to replace it and cluster it. We;ve been able to set up a cluster manually by using the default hostname that resolves over DNS (ip-xx-xx-xx-xx); each of the machines can see eachother. This name however, will not work in production because it's the INTERNAL DNS reference which changes over time. If a failure occurs this will be different on launch and break the cluster (right?). 
> 
> The ideal situation would be to cluster these with static references to each machine. like rabbit at server1, 2, 3 where at any point a new one would come up and could join the cluster.
> 
> I read this article: http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/
> 
> Which works most of the way, but the part that's not explained is, once you set your own hostname and try to cluster them, how can they see eachother if the hostnames are not available over the EC2 network.
> 
> Hope this makes sense, any ideas or best practices are greatly appreciated!!
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From emile at rabbitmq.com  Wed Feb  6 09:32:16 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 06 Feb 2013 09:32:16 +0000
Subject: [rabbitmq-discuss] Correct way of determining which node is
	master?
In-Reply-To: <c6506d1e-5e48-4d17-aabf-acd9b9ed3898@googlegroups.com>
References: <CB692AB0.2EDD5%mpietrek@skytap.com>
	<4F44BC43.7070701@rabbitmq.com>
	<CACLE7iwZ0L8fd8Ke=xzBtGdQX8weMvhnhRGp4q3pT1M8LAm_+Q@mail.gmail.com>
	<20120222201004.GB29288@wellquite.org>
	<c6506d1e-5e48-4d17-aabf-acd9b9ed3898@googlegroups.com>
Message-ID: <51122320.8080209@rabbitmq.com>


Hi,

On 05/02/13 20:11, aminer at groupon.com wrote:
> All clients connected to that node lose their connections and
> re-connect

In the scenario you describe this should work fine, because the node
that a client connects to will be the same as the master node for the
private queue. In general it is possible to connect to one node, while
consuming from a queue which has its master on a different node. In that
case consumers must be prepared to receive notification that the master
is now on a different node (receive basic.cancel) and resubscribe to the
queue.





-Emile








From bme at saseco.dk  Wed Feb  6 11:01:15 2013
From: bme at saseco.dk (Bernhard Mogens Ege)
Date: Wed, 6 Feb 2013 11:01:15 +0000
Subject: [rabbitmq-discuss] Send message to queue
Message-ID: <C44C93396408924FBBF479F57FD429FC058DBED8@AM2PRD0210MB361.eurprd02.prod.outlook.com>

I am looking at the SimpleRPCClient/server and the documentation of the ReplyTo field and I am puzzled by the apparent possibility to publish directly to a queue with BasicPublish. BasicPublish (according to documentation) takes an exchangename and a routing key and sends the message. But for some reason, putting a queuename into the routing key field apparently works. Is this normal behavior and if so, where is it documented?

Also, if I use BasicPublish and EventingBasicConsumer, can I use the ReplyTo field as I see fit, i.e. the API doesn't act on the contents of the ReplyTo field?

Thanks,

Bernhard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/6f76363c/attachment.htm>

From simon at rabbitmq.com  Wed Feb  6 11:15:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Feb 2013 11:15:23 +0000
Subject: [rabbitmq-discuss] Send message to queue
In-Reply-To: <C44C93396408924FBBF479F57FD429FC058DBED8@AM2PRD0210MB361.eurprd02.prod.outlook.com>
References: <C44C93396408924FBBF479F57FD429FC058DBED8@AM2PRD0210MB361.eurprd02.prod.outlook.com>
Message-ID: <51123B4B.6010005@rabbitmq.com>

On 06/02/13 11:01, Bernhard Mogens Ege wrote:
> But for some reason, putting a queuename into the routing key
> field apparently works. Is this normal behavior

Yes.

> and if so, where is it documented?

A number of places,

http://www.rabbitmq.com/tutorials/amqp-concepts.html#exchange-default
http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.queue

are two such.

> Also, if I use BasicPublish and EventingBasicConsumer, can I use the
> ReplyTo field as I see fit, i.e. the API doesn?t act on the contents of
> the ReplyTo field?

Yes, the expectation is that it will usually be a queue name but we 
don't enforce that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Feb  6 11:15:16 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 06 Feb 2013 11:15:16 +0000
Subject: [rabbitmq-discuss] Send message to queue
In-Reply-To: <C44C93396408924FBBF479F57FD429FC058DBED8@AM2PRD0210MB361.eurprd02.prod.outlook.com>
References: <C44C93396408924FBBF479F57FD429FC058DBED8@AM2PRD0210MB361.eurprd02.prod.outlook.com>
Message-ID: <51123B44.9060902@rabbitmq.com>

Hi,

On 06/02/13 11:01, Bernhard Mogens Ege wrote:
> Is this normal behavior and if so, where is it documented?

Yes, see http://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf
2.1.2.4 Automatic Mode

> Also, if I use BasicPublish and EventingBasicConsumer, can I use the
> ReplyTo field as I see fit, i.e. the API doesn?t act on the contents of
> the ReplyTo field?

The broker won't act on it.




-Emile





From simon at rabbitmq.com  Wed Feb  6 11:19:30 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Feb 2013 11:19:30 +0000
Subject: [rabbitmq-discuss] Testing lightweight publisher confirms
In-Reply-To: <946601de-4294-42eb-96f4-baf2b9834c84@googlegroups.com>
References: <CAAN_EDqkZYgNVKGgkLNB62H0zekNaVA1VXQoN9CYXb7a+TbbNg@mail.gmail.com>
	<4ED78F47.3030608@rabbitmq.com> <4ED7925F.1090605@rabbitmq.com>
	<946601de-4294-42eb-96f4-baf2b9834c84@googlegroups.com>
Message-ID: <51123C42.3040909@rabbitmq.com>

On 05/02/13 17:55, DLB9000 wrote:
> On Thursday, December 1, 2011 9:42:39 AM UTC-5, Simon MacMullen wrote:
>
>  > Ah, hang on. One way to "crash" a queue is to have it running on a
>  > single node in a cluster and take that node down. So:
>
>  > 1) Create a two node cluster, node1 and node2.
>  > 2) Create a non-mirrored queue on node1.
>  > 3) Start a publisher using confirms on node2, publishing to that queue.
>  > 4) Stop node1.
>
>  > You should see nacks then I think.
>
>
> Tried this, but was still unable to generate a NACK.

Yes, sorry, my previous suggestion doesn't work. We only generate nacks 
for queues that have died unexpectedly. So you need to actually kill a 
queue. This is in general meant to be hard :-), but with "rabbitmqctl 
eval" you can do anything:

$ rabbitmqctl eval '{ok, Q} = 
rabbit_amqqueue:lookup(rabbit_misc:r(<<"/">>, queue, <<"test">>)), 
[{pid, Pid}] = rabbit_amqqueue:info(Q, [pid]), exit(Pid, bang).'

The above command kills the queue "test" in the virtual host "/". I've 
just tested this, and it does indeed cause nacks to be sent.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From fred at dushin.net  Wed Feb  6 12:28:26 2013
From: fred at dushin.net (Dushin Fred)
Date: Wed, 6 Feb 2013 07:28:26 -0500
Subject: [rabbitmq-discuss] hostname change
In-Reply-To: <510B9C9F.6000401@rabbitmq.com>
References: <1359383662020-24717.post@n5.nabble.com>
	<2E74050D-BD49-4800-BE80-F40ABB31F78E@dushin.net>
	<510B9C9F.6000401@rabbitmq.com>
Message-ID: <19C544C5-A7F0-4860-9EEA-5DD2A7E08768@dushin.net>

Thanks for that, Matthias,

I have conformed that I can set the full node name using the RABBITMQ_NODENAME environment variable and an explicit machine name in the @ part of the expression, e.g.,

RABBITMQ_NODENAME=bunny at localhost

and the broker is now resilient to hostname changes.  (I suspect I will not be able to easily cluster it as a result, but that is a separate topic).

I went back and looked over the docs and thought of suggesting some clarifying remarks, but in retrospect they are probably clear enough.  I think I was thrown off by the example at [1], where the NODENAME is set to "bunny".

As usual, thank you for your timely and dependable response.

-Fred

[1] http://www.rabbitmq.com/configure.html

On Feb 1, 2013, at 5:44 AM, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Fred,
> 
> On 29/01/13 19:56, Dushin Fred wrote:
>> I am using the RABBITMQ_NODENAME environment variable, but that
>> appears to only set the first part of the node name.
> 
> RABBITMQ_NODENAME can contain the full node name, and indeed generally should since otherwise...
> 
>> The directory name (under ${RABBITMQ_MNESIA_BASE}) does not contain
>> the @$HOSTNAME suffix, but if I do a recursive grep through the
>> directory, I still find artifacts with my previous host name.
> 
> ...which is bad since a change in hostname would result in rabbit attempting to work with an mnesia db that is tied to a different node (i.e. containing the old hostname).
> 
>> And a hostname reset (and
>> reboot) results in a fresh DB, even if I start the broker by
>> explicitly setting HOSTNAME to the previous value.
> 
> That is odd. The startup scripts construct the node name from $HOSTNAME if the latter is set. See http://hg.rabbitmq.com/rabbitmq-server/file/fefbea5d28eb/scripts/rabbitmq-env#l37. And provided you haven't also set RABBITMQ_NODENAME, which would override that setting.
> 
> And a quick experiment confirms that is working as expected.
> 
> Note though that $HOSTNAME must be resolvable, or you'll see something like
> 
> ERROR: epmd error for host "oldhost": nxdomain (non-existing domain)
> 
> on startup.
> 
> 
> Regards,
> 
> Matthias.


From fred at dushin.net  Wed Feb  6 12:36:52 2013
From: fred at dushin.net (Dushin Fred)
Date: Wed, 6 Feb 2013 07:36:52 -0500
Subject: [rabbitmq-discuss] Shovel from a user with a Password with @
	symbol
In-Reply-To: <510FF525.4030000@rabbitmq.com>
References: <CAD6m6fHfrPzErtiD2++n-=SuzcGo+WtpRPT-GqNN=tDk230TCA@mail.gmail.com>
	<510FF525.4030000@rabbitmq.com>
Message-ID: <0EB1E199-1AB8-443A-9097-BE8EC729CE30@dushin.net>


On Feb 4, 2013, at 12:51 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> 
> But you can use public key encryption - if you set up a bunch of SSL certs you can have clients authenticated by their client certificates, see:
> 
> http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/file/rabbitmq_v3_0_2/README
> 
> and then specify auth_mechanism=external in URIs and you no longer need a password. (Hmm, the docs for that should be... more findable.)

One other thing I found is that I had to add the 'EXTERNAL' atom to the auth_mechanisms property for the rabbit application in my rabbitmq.conf file, e.g.,

{auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']}

which I don't think is in the README.  (Am I right about that?  I have two brokers doing mutual auth through the shovel, and I couldn't get them to accept an SSL connection without that setting.)

It's probably obvious to the initiated, but I hadn't gone through the mechanics of the auth_mechanisms property when I set it up.

-Fred

From Marek.Cermak at Honeywell.com  Wed Feb  6 13:25:11 2013
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Wed, 6 Feb 2013 13:25:11 +0000
Subject: [rabbitmq-discuss] problematic ACKs of messages
Message-ID: <F1A539826FC33E4CA602BB52E5C4502222B36465@FR44EX3004.global.ds.honeywell.com>

Hi everybody,
we use erlang client and we have sometime problem ACKing messages. Connection is opened as a direct (from rabbit plugin), delivery is handled in gen_server

handle_info({#'basic.deliver'{} = Deliver, Content}, State) ->
	#'basic.deliver'{delivery_tag = DTag, routing_key = BindingKey} = Deliver,
...
working with the message
...
amqp_channel:cast(SrcChannel, #'basic.ack'{delivery_tag = DTag}).
lager:info("received, ack sent - ~p", [DTag]),
...

Lager outputs i.e.
2013-02-06 10:47:15.661 [info] <0.813.0> received, ack sent - 1

and then there's an error like this
2013-02-06 10:47:15.664 [error] <0.173.0> connection <0.718.0>, channel 1 - error: {amqp_error,precondition_failed,"unknown delivery tag 2",'basic.ack'}

although the process sent delivery tag 1. Version of Rabbit is 2.8.4. Where is the problem? Thanks.

Regards,
Marek


From michael.s.klishin at gmail.com  Wed Feb  6 13:47:32 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 6 Feb 2013 17:47:32 +0400
Subject: [rabbitmq-discuss] problematic ACKs of messages
In-Reply-To: <F1A539826FC33E4CA602BB52E5C4502222B36465@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B36465@FR44EX3004.global.ds.honeywell.com>
Message-ID: <CAE3HoVQJbDerijOQ+jstc1mFQMQas+10D4DYnYXh4j9SGS5Z0g@mail.gmail.com>

2013/2/6 Cermak, Marek <Marek.Cermak at honeywell.com>

> Where is the problem? Thanks.


Can it be that you are ack-ing on a different channel? delivery tags are
scoped per channel.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/35d31cd7/attachment.htm>

From Marek.Cermak at Honeywell.com  Wed Feb  6 14:01:22 2013
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Wed, 6 Feb 2013 14:01:22 +0000
Subject: [rabbitmq-discuss] problematic ACKs of messages
In-Reply-To: <CAE3HoVQJbDerijOQ+jstc1mFQMQas+10D4DYnYXh4j9SGS5Z0g@mail.gmail.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B36465@FR44EX3004.global.ds.honeywell.com>
	<CAE3HoVQJbDerijOQ+jstc1mFQMQas+10D4DYnYXh4j9SGS5Z0g@mail.gmail.com>
Message-ID: <F1A539826FC33E4CA602BB52E5C4502222B37495@FR44EX3004.global.ds.honeywell.com>

Hi,
I am subscribed to a single queue using only a single channel in the whole process.

Marek

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: 06 February, 2013 14:48
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] problematic ACKs of messages


2013/2/6 Cermak, Marek <Marek.Cermak at honeywell.com<mailto:Marek.Cermak at honeywell.com>>
Where is the problem? Thanks.

Can it be that you are ack-ing on a different channel? delivery tags are scoped per channel.
--
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/a114da6a/attachment.htm>

From simon at rabbitmq.com  Wed Feb  6 14:49:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Feb 2013 14:49:05 +0000
Subject: [rabbitmq-discuss] Shovel from a user with a Password with @
 symbol
In-Reply-To: <0EB1E199-1AB8-443A-9097-BE8EC729CE30@dushin.net>
References: <CAD6m6fHfrPzErtiD2++n-=SuzcGo+WtpRPT-GqNN=tDk230TCA@mail.gmail.com>
	<510FF525.4030000@rabbitmq.com>
	<0EB1E199-1AB8-443A-9097-BE8EC729CE30@dushin.net>
Message-ID: <51126D61.2090404@rabbitmq.com>

On 06/02/13 12:36, Dushin Fred wrote:
> One other thing I found is that I had to add the 'EXTERNAL' atom to
> the auth_mechanisms property for the rabbit application in my
> rabbitmq.conf file, e.g.,
>
> {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']}
>
> which I don't think is in the README.

Ah no. It's here: http://www.rabbitmq.com/authentication.html but should 
probably be in the README too. Will add.

>  (Am I right about that?  I
> have two brokers doing mutual auth through the shovel, and I couldn't
> get them to accept an SSL connection without that setting.)

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From james.r.carr at gmail.com  Wed Feb  6 15:53:19 2013
From: james.r.carr at gmail.com (James Carr)
Date: Wed, 6 Feb 2013 09:53:19 -0600
Subject: [rabbitmq-discuss] Experience using EC2's Load Balancers?
Message-ID: <CAJreXKB7uAbvYK7TkKYAMxWDZScrNDFcSHUQa-o=yHB6qBuFCw@mail.gmail.com>

Hi All,

I've been contemplating replacing our haproxy based load balancers
with EC2's Elastic Load Balancers and I'm curious what others
experiences with this has been. if I remember correctly it is
connected to an EBS volume which means it can go down whenever EBS
goes down.

Experiences?

Thanks,
James

From mdolian at engineyard.com  Wed Feb  6 16:52:05 2013
From: mdolian at engineyard.com (mdolian at engineyard.com)
Date: Wed, 6 Feb 2013 08:52:05 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ crashing upon starting with a
	clustering setup on EC2
Message-ID: <a5c31386-79fe-4c1e-a2a7-f3bb81597eef@googlegroups.com>

I'm trying to cluster 2 nodes on EC2.  I have the erlang cookie in place on 
both instances and I verified this.  Both instances have the same 
rabbitmq.config file:

[
  {rabbit, [
    {cluster_nodes, 
['ip-10-114-25-195.ec2.internal','ip-10-158-69-124.ec2.internal']},
    {default_user, <<"guest">>},
    {default_pass, <<"guest">>}
  ]}
].

When I try to start up a single node, I get the following crash report in 
the log:  

=CRASH REPORT==== 6-Feb-2013::11:38:00 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.112.0>
    registered_name: []
    exception exit: {bad_return,{{rabbit,start,[normal,[]]},
                                 {'EXIT',{rabbit,failure_during_boot}}}}
      in function  application_master:init/4
    ancestors: [<0.111.0>]
    messages: [{'EXIT',<0.114.0>,normal}]
    links: [<0.111.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 245
  neighbours:

Everything works fine when I pull out the cluster_nodes configuration.  I'm 
not quite sure what I'm doing wrong.  I've also tried using rabbit1, 
rabbit2 as hostnames with /etc/hosts mapped to their internal IP address 
but ran into the same issue.  Any help would be greatly appreciated.

Thanks!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/fdb5ba5b/attachment.htm>

From richard at raseley.com  Wed Feb  6 17:27:28 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 6 Feb 2013 09:27:28 -0800
Subject: [rabbitmq-discuss] Topic Exchange Question
In-Reply-To: <39E29AA7-C9FC-4A05-A2B9-8D5D69067FB3@rabbitmq.com>
References: <CAO=6ox_Cx29+fQG6faEY4Jqn8vkZWriB2uon3uOKY-qi6fiqiQ@mail.gmail.com>
	<CAMcAHLUnfog6Mm95upUtaQ5emOeBbUjbj8J-dShShSL3uo=ZaQ@mail.gmail.com>
	<CAO=6ox9fpZuEsSJ7=_dsRjHfJhhKkVkBG2qtXcWynL5B0pNW+Q@mail.gmail.com>
	<39E29AA7-C9FC-4A05-A2B9-8D5D69067FB3@rabbitmq.com>
Message-ID: <CAO=6ox-XwUCvNjD9Z_p4nGtzJTgy9gLV8Lnv7voF07Ke+=WJaA@mail.gmail.com>

Thank you for that information. I will look into federation and then
respond to the list if I come across a good answer to my question.

Regards,

Richard


On Wed, Feb 6, 2013 at 12:32 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Richard,
>
> On 6 Feb 2013, at 06:19, Richard Raseley wrote:
>
> > Thank you for that information.
> >
> > I am in the process of setting up some test machines now, but based on
> what I am reading it seems that the bound exchanges must be instantiated
> within the same RabbitMQ instance or cluster.
> >
> > In my situation I'd like to have a topic exchange that could route to a
> local queue or "foreign" exchange based on the topic.
>
> If you want to have interactions between exchanges on separate Rabbit
> nodes, then you should look at the federation plugin.
>
> > Would you comment on whether or not that is possible with the
> "exchange.bind" method?
> >
>
> It's not going to be quite that simple, no. But federation may do what you
> want, with a bit of configuration.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/f082f76e/attachment.htm>

From mpietrek at skytap.com  Wed Feb  6 19:49:15 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 6 Feb 2013 11:49:15 -0800
Subject: [rabbitmq-discuss] Help getting 2.8.7 to run after removing 3.0.2
	(maybe_upgrade_mnesia???)
Message-ID: <CACLE7iwN7RtffL-_BcSoN-BF=mQKyHjHFZB1j-Bh5K3fTDWWCQ@mail.gmail.com>

So, I was recently experimenting with 3.0.2 and needing to go back to 2.8.7
for some additional experimentation.

However, RabbitMQ 2.8.7 won't start for me any more. I'm using Erlang R15B01

Here's the console spew for the mq1 node, which I'm unable to start:

--------
Activating RabbitMQ plugins ...
8 plugins activated:
* amqp_client-0.0.0
* mochiweb-2.3.1-rmq0.0.0-gitd541e9a
* rabbitmq_federation-0.0.0
* rabbitmq_federation_management-0.0.0
* rabbitmq_management-0.0.0
* rabbitmq_management_agent-0.0.0
* rabbitmq_mochiweb-0.0.0
* webmachine-1.9.1-rmq0.0.0-git52e62bc

{"init terminating in do_boot",{function_clause,[{lists,usort,[['rabbit at mq1
'|{['rabbit at mq1','rabbit at play','rabbit at play2
'],disc}]],[{file,"lists.erl"},{line,992}]},{rabbit_upgrade,maybe_upgrade_mnesia,0,[{file,"src/rabbit_upgrade.erl"},{line,126}]},{rabbit,prepare,0,[{file,"src/rabbit.erl"},{line,288}]},{init,eval_script,8,[]},{init,do_boot,3,[]}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()
--------

I've blown away both the rabbit at mq1 and
rabbit at mq1-plugins-expanddirectories multiple times.
In the past, blowing away these directories has always worked to get me to
a "fresh state" where Rabbit would always start. Is there some additional
places that are referenced?

Here's the rabbitmq.config file for mq1:

--------
[
{rabbit, [{cluster_nodes, {['rabbit at mq1','rabbit at play','rabbit at play2'],
disc}}, {disk_free_limit, 104857600}]},
{mnesia, [{debug, trace}]},
{rabbitmq_federation, [{exchanges, [[{type, "topic"}, {upstream_set,
"skytap_upstreams"}, {virtual_host, "/"}, {exchange, "skytap"}]]},
{upstream_sets, [{"skytap_upstreams", [[{connection, "upstream-us-west"},
{max_hops, 1}, {exchange, "skytap"}],[{connection, "upstream-us-east"},
{max_hops, 1}, {exchange, "skytap"}]]}]},
{connections, [{"upstream-us-west", [{username, "guest"}, {ha_policy,
"all"}, {host, "mq2"}, {heartbeat, 5}, {password, "guest"}, {port, 5672}]},
{"upstream-us-east", [{username, "guest"}, {ha_policy, "all"}, {host,
"mq3"}, {heartbeat, 5}, {password, "guest"}, {port, 5672}]}]},
{local_nodename, "mq_mpietrek"}]}
].
--------

Just for laughs I've taken out the play and play2 nodes from the config
file and I get the same problem, so I don't think it's clustering related.

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/783047e2/attachment.htm>

From mcsseifer at gmail.com  Wed Feb  6 20:12:02 2013
From: mcsseifer at gmail.com (=?UTF-8?B?0KLQuNC80YPRgA==?=)
Date: Thu, 7 Feb 2013 00:12:02 +0400
Subject: [rabbitmq-discuss] Is it error?
In-Reply-To: <CAMcAHLU7d8Z9a+_D+hTCXMOuoeBSvnDB5_b=G55zDdfckNmjRQ@mail.gmail.com>
References: <CAEQ7gRNMWhP942G8OJKXaMC7WMBJyzimexESdwaTMhZGJXQB8Q@mail.gmail.com>
	<6E85014A-B303-4D66-97AC-ECE2C1D77825@rabbitmq.com>
	<CAEQ7gRNHwpSXzDfuQXThTWkp4LTYPy7BCB==od_n3YtuYCh3Cg@mail.gmail.com>
	<CAMcAHLU7d8Z9a+_D+hTCXMOuoeBSvnDB5_b=G55zDdfckNmjRQ@mail.gmail.com>
Message-ID: <CAEQ7gRNsqhef6LhoG4KchBHb+mfu3FcrfRsxrqKrGOwVKtq5PQ@mail.gmail.com>

I have some manage CLI script which must show info about exchanges and
queues and must declare it if need. How i can take info about this wihout
web managment plugin?


2013/2/5 Alvaro Videla <videlalvaro at gmail.com>

> I don't know what you are trying to do, but the idea behind the "declare"
> methods is that you don't need to issue a "queue_declare" passive=true just
> to see if the queue is there, if not then create it with another
> queue_declare.
>
> "queue_declare" won't do anything if the queue already exists, so you
> shouldn't need to use it twice.
>
>
> On Tue, Feb 5, 2013 at 2:52 PM, ????? <mcsseifer at gmail.com> wrote:
>
>> My client raise error on 404 error.
>> I use passive mode for detect exists queue or not. And if it not exists
>> then i try create it without passive. So, i realy cant do something like
>> that:
>>
>> connection->channel_close(1);
>> connecton->channel_open(1);
>>
>> because "Opening channel: server connection error 503, message:
>> COMMAND_INVALID - second 'channel.open'"
>>
>> Instead this i reopen connect to server, but its not good way.
>>
>>
>> 2013/2/5 Tim Watson <tim at rabbitmq.com>
>>
>>> On 4 Feb 2013, at 18:31, ????? wrote:
>>>
>>> > I found strange behavior in some case. What i do:
>>> >
>>> > 1. Connect to server
>>> > 2. Open channel with name is '1'
>>>
>>> Channel's don't have *name* property, so I'm not sure what you're
>>> talking about here.
>>>
>>> > 3. Declare queue with passive = 1
>>> >
>>>
>>> Does the queue already exist, or are you trying to create it here?
>>>
>>> > And after that i try declare queue with passive = 0 if i receive 404
>>> error in third step. Receive error like 'Declare Exchange: Resource
>>> temporary unavailable'. Is it actual behavior?
>>>
>>>
>>> From
>>> http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.passive
>>>
>>> "bit passive
>>>  If set, the server will reply with Declare-Ok if the queue already
>>> exists with the same name, and raise an error if not."
>>>
>>> So you would end up with a channel error if the queue doesn't already
>>> exit and will need to open a new channel. If that's the case, then it's
>>> likely the behaviour you're seeing is consistent but the client error is
>>> confusing. The 404 channel error means "The client attempted to work with a
>>> server entity that does not exist".
>>>
>>> Cheers,
>>> Tim
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/cc384ed7/attachment.htm>

From ethanmski at gmail.com  Wed Feb  6 19:39:39 2013
From: ethanmski at gmail.com (Ethan Mick)
Date: Wed, 6 Feb 2013 14:39:39 -0500
Subject: [rabbitmq-discuss] RabbitMQ cluster doesn't restart as it should
Message-ID: <BD029459BD7D40388E447BB2A8E54925@gmail.com>

Hey guys, 

First time posting here, so let me know if I'm doing this all wrong.  I'm having an issue with my RabbitMQ brokers, in a cluster, not being able to come back. I posted all details here, but I can copy it in if you want:

http://serverfault.com/questions/475667/rabbitmq-cluster-goes-down-but-cannot-come-back-up

Does anyone have any thoughts as to why this happens? 

-- 
Ethan Mick

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/4f7bda91/attachment.htm>

From mpietrek at skytap.com  Wed Feb  6 22:12:57 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 6 Feb 2013 14:12:57 -0800
Subject: [rabbitmq-discuss] Config file syntax changes between 2.8.7 and
	3.0.X
Message-ID: <CACLE7ixfjsFKd1-wT7OfqXSDUQw-K5vxnu4qKtOEhvdMY6zwpg@mail.gmail.com>

So I've lost a few follicles today, and found what looks like two subtle
differences in config file syntax between 2.8.X and 3.0.X. I have a program
that auto-generates the rabbitmq.config file, and I'm trying to make it
work equally well with 2.8.X and 3.0.X brokers.

I'm looking for verification that I'm understanding things, as well as any
gotchas that I should be aware of.


*1) Specifying a node as a 'disc' node in the cluster config*

In http://previous.rabbitmq.com/clustering.html, the cluster node list
example looks like this:

{cluster_nodes, ['rabbit at rabbit1', 'rabbit at rabbit2']},

In the current 3.0.X clustering.html, it show this:

{cluster_nodes, {['rabbit at rabbit1', 'rabbit at rabbit2', 'rabbit at rabbit3'], disc}},

Note the addition of the 'disc' near the end.

Is the 'disc' only allowed in 3.0.X config files? I know 'disc' is the
default, but in a 3.0.X cluster, I was seeing a node start as 'ram' unless
I specified it. But then trying to start a 2.8.7 broker with 'disc"
specified resulted in the inability to start it.


*2) Configuring the Management API port*

In the http://previous.rabbitmq.com/management.html, the management port
looks to be configured like this:

{rabbitmq_mochiweb, [{listeners, [{mgmt, [{port, 55555}]}]}]},


whereas in 3.0.X, it looks like the port is configured like this:

{rabbitmq_management, [{listener, [{port, 12345}]}]},

Is the 2.8.7 syntax not allowed in 3.0.X?

Thanks for your help,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/75527090/attachment.htm>

From richard at raseley.com  Thu Feb  7 03:53:30 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 6 Feb 2013 19:53:30 -0800
Subject: [rabbitmq-discuss] Join_Cluster Question
Message-ID: <CAO=6ox_QwkgPdzVodocp-GtfGZy8iXXfqPx_aLMjJagiVsKPBg@mail.gmail.com>

When creating a cluster using "rabbitmqctl join_cluster rabbit at hostname"
can you use an IP address or FQDN instead of a hostname after the @?

I am not sure if my issues is being caused by lack of name resolution or a
malformed command and the documentation (found here:
http://www.rabbitmq.com/man/rabbitmqctl.1.man.html) didn't seem to specify
what a valid value was.

Thank you in advance.

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130206/2dd07026/attachment.htm>

From tim at rabbitmq.com  Thu Feb  7 10:51:35 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 7 Feb 2013 10:51:35 +0000
Subject: [rabbitmq-discuss] Join_Cluster Question
In-Reply-To: <CAO=6ox_QwkgPdzVodocp-GtfGZy8iXXfqPx_aLMjJagiVsKPBg@mail.gmail.com>
References: <CAO=6ox_QwkgPdzVodocp-GtfGZy8iXXfqPx_aLMjJagiVsKPBg@mail.gmail.com>
Message-ID: <C4668B26-61D3-4EF4-BCA2-E671F4509AE9@rabbitmq.com>

Hi Richard,

On 7 Feb 2013, at 03:53, Richard Raseley wrote:

> When creating a cluster using "rabbitmqctl join_cluster rabbit at hostname" can you use an IP address or FQDN instead of a hostname after the @?
> 

Well, Erlang does allow you to use an IP address after the node name, but whilst running `rabbitmqctl status -n rabbit@<hostname>` might work for me, using the IP address instead of the hostname doesn't:

t4 at iske:rabbitmq-server $ ./scripts/rabbitmqctl status -n rabbit at 192.168.1.75
Status of node 'rabbit at 192.168.1.75' ...
Error: unable to connect to node 'rabbit at 192.168.1.75': nodedown

=ERROR REPORT==== 7-Feb-2013::10:45:22 ===
** System NOT running to use fully qualified hostnames **
** Hostname 192.168.1.75 is illegal **


Erlang seems to think that rabbit@<ip-address> is a fully qualified hostname, whilst rabbit@<hostname> is fine:

t4 at iske:rabbitmq-server $ ./scripts/rabbitmqctl status -n rabbit at yddraig
Status of node rabbit at yddraig ...
......


Rabbit's start scripts launch the Erlang runtime using -sname (see http://www.erlang.org/doc/man/erl.html for details) so an FQDN isn't going to work here.

> I am not sure if my issues is being caused by lack of name resolution or a malformed command and the documentation (found here: http://www.rabbitmq.com/man/rabbitmqctl.1.man.html) didn't seem to specify what a valid value was.
> 

The command is fine - if it wasn't you'd get an appropriate error message saying so. Lack of name resolution is almost certainly the problem here.

Cheers,
Tim


From marc at teichtahl.com  Thu Feb  7 10:50:54 2013
From: marc at teichtahl.com (Marc Teichtahl)
Date: Thu, 7 Feb 2013 02:50:54 -0800 (PST)
Subject: [rabbitmq-discuss] Round robin Topic exchange s
Message-ID: <ccbc0c2b-bf26-469b-a63a-342ea48af8f0@googlegroups.com>



Im seeking some advise as to how best configure my rabbitMQ exchanges.

Im trying to use a topic exchange in a round robin methodology. Each 
consumer has its own (uniquely) named queue attached to a topic exchange. I 
would like the exchange to round robin messages to each consumer queue for 
the "same" topic - lets say *.log for example.

I have tried multiple combinations and only seem to be able to 
simultaneously deliver messages to the consumer queues which effectively 
means Im processing the message twice, once in each consumer.

for clarity I also have a fanout exchange, which I use to "control" the 
consumers (start, stop etc).this should remain in place in any outcome.

Any guidance on how best to achieve the stated outcome would be great.


Marc
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/6631b5fc/attachment.htm>

From simon at rabbitmq.com  Thu Feb  7 11:06:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Feb 2013 11:06:21 +0000
Subject: [rabbitmq-discuss] Config file syntax changes between 2.8.7 and
 3.0.X
In-Reply-To: <CACLE7ixfjsFKd1-wT7OfqXSDUQw-K5vxnu4qKtOEhvdMY6zwpg@mail.gmail.com>
References: <CACLE7ixfjsFKd1-wT7OfqXSDUQw-K5vxnu4qKtOEhvdMY6zwpg@mail.gmail.com>
Message-ID: <51138AAD.3020109@rabbitmq.com>

On 06/02/13 22:12, Matt Pietrek wrote:
> *1) Specifying a node as a 'disc' node in the cluster config*
>
> In http://previous.rabbitmq.com/clustering.html, the cluster node list
> example looks like this:
>
> {cluster_nodes, ['rabbit at rabbit1', 'rabbit at rabbit2']},
>
> In the current 3.0.X clustering.html, it show this:
>
> {cluster_nodes, {['rabbit at rabbit1', 'rabbit at rabbit2', 'rabbit at rabbit3'], disc}},
>
> Note the addition of the 'disc' near the end.
>
> Is the 'disc' only allowed in 3.0.X config files? I know 'disc' is the
> default, but in a 3.0.X cluster, I was seeing a node start as 'ram'
> unless I specified it. But then trying to start a 2.8.7 broker with
> 'disc" specified resulted in the inability to start it.

The two configs are actually a bit more different than that; the meaning 
of the list of nodes differs.

In 2.x the list of nodes must contain *all* the disc nodes in the 
cluster; in order to become a disc node the node itself must be listed 
there.

In 3.x the list of nodes denotes a list of nodes to try communicating 
with. RabbitMQ will find one which is up, get the real state of the 
cluster from that node, and join as either a disc or ram node according 
to the config.

For backwards compatibility 3.x has the ability to read the 2.x style 
config - in which case the node type will be inferred from whether the 
node is in the list of nodes. A warning also gets written to logs in 
this case.

> *2) Configuring the Management API port*
>
> In the http://previous.rabbitmq.com/management.html, the management port
> looks to be configured like this:
>
> {rabbitmq_mochiweb, [{listeners, [{mgmt, [{port, 55555}]}]}]},
>
>
> whereas in 3.0.X, it looks like the port is configured like this:
>
> {rabbitmq_management, [{listener, [{port, 12345}]}]},
>
>
> Is the 2.8.7 syntax not allowed in 3.0.X?

No, that's just changed outright.

The good news is we are not planning to make breaking changes like this 
again any time soon...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Feb  7 11:07:06 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Feb 2013 11:07:06 +0000
Subject: [rabbitmq-discuss] Help getting 2.8.7 to run after removing
 3.0.2 (maybe_upgrade_mnesia???)
In-Reply-To: <CACLE7iwN7RtffL-_BcSoN-BF=mQKyHjHFZB1j-Bh5K3fTDWWCQ@mail.gmail.com>
References: <CACLE7iwN7RtffL-_BcSoN-BF=mQKyHjHFZB1j-Bh5K3fTDWWCQ@mail.gmail.com>
Message-ID: <51138ADA.3020201@rabbitmq.com>

On 06/02/13 19:49, Matt Pietrek wrote:
> So, I was recently experimenting with 3.0.2 and needing to go back to
> 2.8.7 for some additional experimentation.

I assume from your other message that you sorted this out - please let 
us know if that's not the case.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Feb  7 11:10:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Feb 2013 11:10:34 +0000
Subject: [rabbitmq-discuss] Round robin Topic exchange s
In-Reply-To: <ccbc0c2b-bf26-469b-a63a-342ea48af8f0@googlegroups.com>
References: <ccbc0c2b-bf26-469b-a63a-342ea48af8f0@googlegroups.com>
Message-ID: <51138BAA.9040005@rabbitmq.com>

Sorry, it's not very clear what 'I would like the exchange to round 
robin messages to each consumer queue for the "same" topic' means.

Do you mean something like: for each message, evaluate the routing as a 
topic exchange normally would, giving a list of queues. But then rather 
than routing to all those queues, just route to one, in some round robin 
fashion?

Or something else?

Cheers, Simon

On 07/02/13 10:50, Marc Teichtahl wrote:
> Im seeking some advise as to how best configure my rabbitMQ exchanges.
>
> Im trying to use a topic exchange in a round robin methodology. Each
> consumer has its own (uniquely) named queue attached to a topic
> exchange. I would like the exchange to round robin messages to each
> consumer queue for the "same" topic - lets say *.log for example.
>
> I have tried multiple combinations and only seem to be able to
> simultaneously deliver messages to the consumer queues which effectively
> means Im processing the message twice, once in each consumer.
>
> for clarity I also have a fanout exchange, which I use to "control" the
> consumers (start, stop etc).this should remain in place in any outcome.
>
> Any guidance on how best to achieve the stated outcome would be great.
>
>
> Marc
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From ernest.staszuk at comarch.pl  Thu Feb  7 11:39:58 2013
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Thu, 07 Feb 2013 12:39:58 +0100
Subject: [rabbitmq-discuss] Join_Cluster Question
In-Reply-To: <CAO=6ox_QwkgPdzVodocp-GtfGZy8iXXfqPx_aLMjJagiVsKPBg@mail.gmail.com>
References: <CAO=6ox_QwkgPdzVodocp-GtfGZy8iXXfqPx_aLMjJagiVsKPBg@mail.gmail.com>
Message-ID: <5113928E.7030109@comarch.pl>

You could try to prepare special entries in your systems hosts file, 
that worked for me.

I don't remember if these entries had to be actual hostname for remote 
machine or could be faked.

Best regards,
Ernest Staszuk

On 02/07/2013 04:53 AM, Richard Raseley wrote:
> When creating a cluster using "rabbitmqctl join_cluster 
> rabbit at hostname" can you use an IP address or FQDN instead of a 
> hostname after the @?
>
> I am not sure if my issues is being caused by lack of name resolution 
> or a malformed command and the documentation (found here: 
> http://www.rabbitmq.com/man/rabbitmqctl.1.man.html) didn't seem to 
> specify what a valid value was.
>
> Thank you in advance.
>
> Regards,
>
> Richard
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/879755a6/attachment.htm>

From gdanycan at slip-software.com  Thu Feb  7 12:35:20 2013
From: gdanycan at slip-software.com (Gilles Danycan)
Date: Thu, 7 Feb 2013 13:35:20 +0100 (CET)
Subject: [rabbitmq-discuss] flow control threshold
In-Reply-To: <2106681331.68897.1360240455846.JavaMail.root@ns22265.ovh.net>
Message-ID: <1283396821.68900.1360240520749.JavaMail.root@ns22265.ovh.net>


Hi All, 

I have a serious problem to consume and requeue messages on a specific queue. i think the flow control is blocking connection... 
I'm using RabbitMQ 3.0.2, Erlang R15B03 on a debian server : 64go ram , 8 cpu. 

i have a script (named consumer) consuming and requeue messages on a queue named "mainQueue" (actually 900 000 messages into this queue) and another one publishing messages on the same queue (arround 200mess/s). 
each message is arroung 15kbytes and deliverymode =2 and durable. 

usually the script consumer is able to get and requeue messages at 1000mess/s, sometimes the same script is in hold, it doesn't consumer messages.., i see in connections that the connection is in state : flow 

i found documentation about flow control but i would like more advices about how to determine the flow control specificaly with my configuration and how to change the threshold . 


i send you below more details about the rabbit mq server status.. 



Connections: 328 
Channels: 328 
Exchanges: 120 
Queues: 111 
Consumers: 0 



File descriptors (?) Socket descriptors (?) Erlang processes Memory Disk space Uptime Type 
	

527 1048576 available 	

330 943626 available 	

2937 1048576 available 	

2.7GB 25.2GB high watermark 	

1.7TB 953.7MB low watermark 	2h 32m 	Disc Stats * 

Thanks for your help, 

Regards, 
Gilles 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/522ad3ea/attachment.htm>

From emile at rabbitmq.com  Thu Feb  7 13:01:18 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 07 Feb 2013 13:01:18 +0000
Subject: [rabbitmq-discuss] RabbitMQ cluster doesn't restart as it should
In-Reply-To: <BD029459BD7D40388E447BB2A8E54925@gmail.com>
References: <BD029459BD7D40388E447BB2A8E54925@gmail.com>
Message-ID: <5113A59E.6070207@rabbitmq.com>


Hi,

On 06/02/13 19:39, Ethan Mick wrote:
> Does anyone have any thoughts as to why this happens?

I'm not able to reproduce the problem after following your transcript
step-by-step. What version of Erlang are you using? Is anything unusual
reported in the logfile or sasl logfile for r_hare0 or r_hare1 at the
last shutdown before you reach the error condition? What is contained in
the cluster_nodes.config and nodes_running_at_shutdown files for those
two nodes (in their respective Mnesia folders) after you shut them down
just prior to reaching the error condition? Are you able to reproduce
the error on any other system?



-Emile





From emile at rabbitmq.com  Thu Feb  7 13:38:15 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 07 Feb 2013 13:38:15 +0000
Subject: [rabbitmq-discuss] RabbitMQ crashing upon starting with a
 clustering setup on EC2
In-Reply-To: <a5c31386-79fe-4c1e-a2a7-f3bb81597eef@googlegroups.com>
References: <a5c31386-79fe-4c1e-a2a7-f3bb81597eef@googlegroups.com>
Message-ID: <5113AE47.1020206@rabbitmq.com>


Hi,

On 06/02/13 16:52, mdolian at engineyard.com wrote:
> When I try to start up a single node, I get the following crash report
> in the log:  

Try using nodes with short hostnames in the config file. See
 http://www.rabbitmq.com/clustering.html
for the correct format of nodes that are accepted. You can find the
short name by running "hostname -s" or start Erlang with "erl -sname
foo" and inspecting the prompt (the part after "foo@"). If you can start
a node without clustering then you can find the node name reported in
"rabbitmqctl status" also.

Make sure to check the advice at
  http://www.rabbitmq.com/clustering.html#firewall
and
  http://www.rabbitmq.com/ec2.html




-Emile








From Petr.Gotthard at Honeywell.com  Thu Feb  7 13:52:18 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 7 Feb 2013 13:52:18 +0000
Subject: [rabbitmq-discuss] Virtual host switch in the 3.0.2 web management
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2A66B5CA@FR44EX3005.global.ds.honeywell.com>

Hello,

The "Virtual host" switch in the top right corner of the web management of RabbitMQ 3.0.2 (at Firefox 18.0.2) behaves strange when I select something else than "All", i.e. when I select a specific virtual host name. (I have two virtual hosts.)

(1) the Overview, Connections, Channels and Admin pages say "Not found" (The object you clicked on was not found; it may have been deleted on the server.)

(2) "add new" sections for Exchanges and Queues show empty "Virtual host" field, which means I cannot select any valid value when creating a new exchange/queue. The Virtual host filed in the Add exchange/queue section should probably show the same value as the Virtual host field in the top right corner.

When I select "All" everything works well.

Is it a bug, or did I set something wrong?


Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/60c2f883/attachment.htm>

From simon at rabbitmq.com  Thu Feb  7 14:10:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Feb 2013 14:10:27 +0000
Subject: [rabbitmq-discuss] Virtual host switch in the 3.0.2 web
	management
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2A66B5CA@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2A66B5CA@FR44EX3005.global.ds.honeywell.com>
Message-ID: <5113B5D3.1060405@rabbitmq.com>

Hmm, I really can't replicate either of these using the 3.0.2 release 
and the same version of Firefox. At the same time I don't see how you 
could have configured anything wrong. Try clearing your cache?

Cheers, Simon

On 07/02/13 13:52, Gotthard, Petr wrote:
> Hello,
>
> The ?Virtual host? switch in the top right corner of the web management
> of RabbitMQ 3.0.2 (at Firefox 18.0.2) behaves strange when I select
> something else than ?All?, i.e. when I select a specific virtual host
> name. (I have two virtual hosts.)
>
> (1) the Overview, Connections, Channels and Admin pages say ?Not found?
> (The object you clicked on was not found; it may have been deleted on
> the server.)
>
> (2) ?add new? sections for Exchanges and Queues show empty ?Virtual
> host? field, which means I cannot select any valid value when creating a
> new exchange/queue. The Virtual host filed in the Add exchange/queue
> section should probably show the same value as the Virtual host field in
> the top right corner.
>
> When I select ?All? everything works well.
>
> Is it a bug, or did I set something wrong?
>
> Petr
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From Petr.Gotthard at Honeywell.com  Thu Feb  7 14:36:24 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 7 Feb 2013 14:36:24 +0000
Subject: [rabbitmq-discuss] Virtual host switch in the 3.0.2 web
 management
In-Reply-To: <5113B5D3.1060405@rabbitmq.com>
References: <F9E85480F62349458DF67CE8BA000D8D2A66B5CA@FR44EX3005.global.ds.honeywell.com>
	<5113B5D3.1060405@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2A66B67E@FR44EX3005.global.ds.honeywell.com>

Well, it seems that it's somehow caused by my custom management plug-in. Most likely I forgot something when migrating my plug-in to 3.x: I added the NAVIGATION[] array setting, but there's probably something more.

Petr

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 7. ?nora 2013 15:10
To: Discussions about RabbitMQ
Cc: Gotthard, Petr
Subject: Re: [rabbitmq-discuss] Virtual host switch in the 3.0.2 web management

Hmm, I really can't replicate either of these using the 3.0.2 release and the same version of Firefox. At the same time I don't see how you could have configured anything wrong. Try clearing your cache?

Cheers, Simon

On 07/02/13 13:52, Gotthard, Petr wrote:
> Hello,
>
> The "Virtual host" switch in the top right corner of the web 
> management of RabbitMQ 3.0.2 (at Firefox 18.0.2) behaves strange when 
> I select something else than "All", i.e. when I select a specific 
> virtual host name. (I have two virtual hosts.)
>
> (1) the Overview, Connections, Channels and Admin pages say "Not found"
> (The object you clicked on was not found; it may have been deleted on 
> the server.)
>
> (2) "add new" sections for Exchanges and Queues show empty "Virtual 
> host" field, which means I cannot select any valid value when creating 
> a new exchange/queue. The Virtual host filed in the Add exchange/queue 
> section should probably show the same value as the Virtual host field 
> in the top right corner.
>
> When I select "All" everything works well.
>
> Is it a bug, or did I set something wrong?
>
> Petr
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Feb  7 14:38:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Feb 2013 14:38:00 +0000
Subject: [rabbitmq-discuss] Virtual host switch in the 3.0.2 web
	management
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2A66B67E@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2A66B5CA@FR44EX3005.global.ds.honeywell.com>
	<5113B5D3.1060405@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2A66B67E@FR44EX3005.global.ds.honeywell.com>
Message-ID: <5113BC48.9010307@rabbitmq.com>

On 07/02/13 14:36, Gotthard, Petr wrote:
> Well, it seems that it's somehow caused by my custom management
> plug-in. Most likely I forgot something when migrating my plug-in to
> 3.x: I added the NAVIGATION[] array setting, but there's probably
> something more.

Is the source available anywhere? I could have a look at it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From marc at teichtahl.com  Thu Feb  7 11:23:02 2013
From: marc at teichtahl.com (Marc Teichtahl)
Date: Thu, 7 Feb 2013 16:53:02 +0530
Subject: [rabbitmq-discuss] Round robin Topic exchange s
In-Reply-To: <51138BAA.9040005@rabbitmq.com>
References: <ccbc0c2b-bf26-469b-a63a-342ea48af8f0@googlegroups.com>
	<51138BAA.9040005@rabbitmq.com>
Message-ID: <-7207996771937574196@unknownmsgid>

Simon

You are correct in your last statement

For each message to a topic exchange identify the matching queues and
then round robin between theses.

Sent from my iPhone

On 07/02/2013, at 16:40, Simon MacMullen <simon at rabbitmq.com> wrote:

Sorry, it's not very clear what 'I would like the exchange to round
robin messages to each consumer queue for the "same" topic' means.

Do you mean something like: for each message, evaluate the routing as
a topic exchange normally would, giving a list of queues. But then
rather than routing to all those queues, just route to one, in some
round robin fashion?

Or something else?

Cheers, Simon

On 07/02/13 10:50, Marc Teichtahl wrote:
> Im seeking some advise as to how best configure my rabbitMQ exchanges.
>
> Im trying to use a topic exchange in a round robin methodology. Each
> consumer has its own (uniquely) named queue attached to a topic
> exchange. I would like the exchange to round robin messages to each
> consumer queue for the "same" topic - lets say *.log for example.
>
> I have tried multiple combinations and only seem to be able to
> simultaneously deliver messages to the consumer queues which effectively
> means Im processing the message twice, once in each consumer.
>
> for clarity I also have a fanout exchange, which I use to "control" the
> consumers (start, stop etc).this should remain in place in any outcome.
>
> Any guidance on how best to achieve the stated outcome would be great.
>
>
> Marc
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Feb  7 15:06:35 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Feb 2013 15:06:35 +0000
Subject: [rabbitmq-discuss] Round robin Topic exchange s
In-Reply-To: <-7207996771937574196@unknownmsgid>
References: <ccbc0c2b-bf26-469b-a63a-342ea48af8f0@googlegroups.com>
	<51138BAA.9040005@rabbitmq.com> <-7207996771937574196@unknownmsgid>
Message-ID: <5113C2FB.4050809@rabbitmq.com>

OK, so the bad news is that I don't think this kind of routing is 
possible with off the shelf RabbitMQ.

It would be possible to write a custom exchange type quite easily to do 
this *if* the "round robin" part could be replaced by "pick one of the 
routes at random". Essentially you would have an exchange type that 
delegated to the topic exchange for everything, but intercepted the 
queues returned from route/2 and made a random choice.

If the number of routing keys is limited and topic wildcards are not 
needed then you could just have one queue per routing key and have 
consumers consume from all the queues they are interested in, and the 
built in round robin would work for you.

If neither of these constraints hold then I think implementing what you 
want would pose a bigger problem - presumably there would need to be one 
round robin "cursor" per routing key that has ever been published to the 
exchange? So I think you would have a potentially unbounded amount of 
space taken by these cursors, and no way to ever know you can safely GC 
them.

Cheers, Simon


On 07/02/13 11:23, Marc Teichtahl wrote:
> Simon
>
> You are correct in your last statement
>
> For each message to a topic exchange identify the matching queues and
> then round robin between theses.
>
> Sent from my iPhone
>
> On 07/02/2013, at 16:40, Simon MacMullen <simon at rabbitmq.com> wrote:
>
> Sorry, it's not very clear what 'I would like the exchange to round
> robin messages to each consumer queue for the "same" topic' means.
>
> Do you mean something like: for each message, evaluate the routing as
> a topic exchange normally would, giving a list of queues. But then
> rather than routing to all those queues, just route to one, in some
> round robin fashion?
>
> Or something else?
>
> Cheers, Simon
>
> On 07/02/13 10:50, Marc Teichtahl wrote:
>> Im seeking some advise as to how best configure my rabbitMQ exchanges.
>>
>> Im trying to use a topic exchange in a round robin methodology. Each
>> consumer has its own (uniquely) named queue attached to a topic
>> exchange. I would like the exchange to round robin messages to each
>> consumer queue for the "same" topic - lets say *.log for example.
>>
>> I have tried multiple combinations and only seem to be able to
>> simultaneously deliver messages to the consumer queues which effectively
>> means Im processing the message twice, once in each consumer.
>>
>> for clarity I also have a fanout exchange, which I use to "control" the
>> consumers (start, stop etc).this should remain in place in any outcome.
>>
>> Any guidance on how best to achieve the stated outcome would be great.
>>
>>
>> Marc
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Feb  7 15:17:07 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Feb 2013 15:17:07 +0000
Subject: [rabbitmq-discuss] flow control threshold
In-Reply-To: <1283396821.68900.1360240520749.JavaMail.root@ns22265.ovh.net>
References: <1283396821.68900.1360240520749.JavaMail.root@ns22265.ovh.net>
Message-ID: <5113C573.9020602@rabbitmq.com>

The flow control should only be restricting the rate at which you can 
publish into a queue to the rate at which the queue can accept messages 
- in other words it should only ever slow publishing down, and not by 
too much.

If you have seen it block publishing altogether that would be a serious 
bug. Can you post your script somewhere?

Cheers, Simon

On 07/02/13 12:35, Gilles Danycan wrote:
> Hi All,
>
> I have a serious problem to consume and requeue messages on a specific
> queue. i think the flow control is blocking connection...
> I'm using RabbitMQ 3.0.2, Erlang R15B03 on a debian server : 64go ram ,
> 8 cpu.
>
> i have a script (named consumer) consuming and requeue messages on a
> queue named "mainQueue" (actually 900 000 messages into this queue) and
> another one publishing messages on the same queue (arround 200mess/s).
> each message is arroung 15kbytes and deliverymode =2 and durable.
>
> usually the script consumer is able to get and requeue messages at
> 1000mess/s, sometimes the same script is in hold, it doesn't consumer
> messages.., i see in connections that the connection is in state : flow
>
> i found documentation about flow control but i would like more advices
> about how to determine the flow control specificaly with my
> configuration and how to change the threshold.
>
>
> i send you below more details about the rabbitmq server status..
>
>
> Connections: *328*
> Channels: *328*
> Exchanges: *120*
> Queues: *111*
> Consumers: *0
>
> *
> File descriptors (?) 	Socket descriptors (?) 	Erlang processes 	Memory
> Disk space 	Uptime 	Type
> 527
> _1048576 available
> 	
> 330
> _943626 available
> 	
> 2937
> _1048576 available
> 	
> 2.7GB
> _25.2GB high watermark
> 	
> 1.7TB
> _953.7MB low watermark
> 	2h 32m 	Disc Stats *
>
>
>
> Thanks for your help,
>
> Regards,
>
>      *Gilles*
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From mdolian at engineyard.com  Thu Feb  7 16:08:34 2013
From: mdolian at engineyard.com (mdolian at engineyard.com)
Date: Thu, 7 Feb 2013 08:08:34 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ crashing upon starting with a
	clustering setup on EC2
In-Reply-To: <a5c31386-79fe-4c1e-a2a7-f3bb81597eef@googlegroups.com>
References: <a5c31386-79fe-4c1e-a2a7-f3bb81597eef@googlegroups.com>
Message-ID: <81d22582-a09f-4c3c-a8c6-f9617f59d7d1@googlegroups.com>

Someone replied to me off list, I just had to remove .ec2.internal from the 
hostnames and pre-pend them with rabbit@

Thanks


On Wednesday, February 6, 2013 11:52:05 AM UTC-5, mdo... at engineyard.com 
wrote:
>
> I'm trying to cluster 2 nodes on EC2.  I have the erlang cookie in place 
> on both instances and I verified this.  Both instances have the same 
> rabbitmq.config file:
>
> [
>   {rabbit, [
>     {cluster_nodes, 
> ['ip-10-114-25-195.ec2.internal','ip-10-158-69-124.ec2.internal']},
>     {default_user, <<"guest">>},
>     {default_pass, <<"guest">>}
>   ]}
> ].
>
> When I try to start up a single node, I get the following crash report in 
> the log:  
>
> =CRASH REPORT==== 6-Feb-2013::11:38:00 ===
>   crasher:
>     initial call: application_master:init/4
>     pid: <0.112.0>
>     registered_name: []
>     exception exit: {bad_return,{{rabbit,start,[normal,[]]},
>                                  {'EXIT',{rabbit,failure_during_boot}}}}
>       in function  application_master:init/4
>     ancestors: [<0.111.0>]
>     messages: [{'EXIT',<0.114.0>,normal}]
>     links: [<0.111.0>,<0.7.0>]
>     dictionary: []
>     trap_exit: true
>     status: running
>     heap_size: 2584
>     stack_size: 24
>     reductions: 245
>   neighbours:
>
> Everything works fine when I pull out the cluster_nodes configuration. 
>  I'm not quite sure what I'm doing wrong.  I've also tried using rabbit1, 
> rabbit2 as hostnames with /etc/hosts mapped to their internal IP address 
> but ran into the same issue.  Any help would be greatly appreciated.
>
> Thanks!
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/9bbdb2c6/attachment.htm>

From mdolian at engineyard.com  Thu Feb  7 16:08:34 2013
From: mdolian at engineyard.com (mdolian at engineyard.com)
Date: Thu, 7 Feb 2013 08:08:34 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ crashing upon starting with a
	clustering setup on EC2
In-Reply-To: <a5c31386-79fe-4c1e-a2a7-f3bb81597eef@googlegroups.com>
References: <a5c31386-79fe-4c1e-a2a7-f3bb81597eef@googlegroups.com>
Message-ID: <81d22582-a09f-4c3c-a8c6-f9617f59d7d1@googlegroups.com>

Someone replied to me off list, I just had to remove .ec2.internal from the 
hostnames and pre-pend them with rabbit@

Thanks


On Wednesday, February 6, 2013 11:52:05 AM UTC-5, mdo... at engineyard.com 
wrote:
>
> I'm trying to cluster 2 nodes on EC2.  I have the erlang cookie in place 
> on both instances and I verified this.  Both instances have the same 
> rabbitmq.config file:
>
> [
>   {rabbit, [
>     {cluster_nodes, 
> ['ip-10-114-25-195.ec2.internal','ip-10-158-69-124.ec2.internal']},
>     {default_user, <<"guest">>},
>     {default_pass, <<"guest">>}
>   ]}
> ].
>
> When I try to start up a single node, I get the following crash report in 
> the log:  
>
> =CRASH REPORT==== 6-Feb-2013::11:38:00 ===
>   crasher:
>     initial call: application_master:init/4
>     pid: <0.112.0>
>     registered_name: []
>     exception exit: {bad_return,{{rabbit,start,[normal,[]]},
>                                  {'EXIT',{rabbit,failure_during_boot}}}}
>       in function  application_master:init/4
>     ancestors: [<0.111.0>]
>     messages: [{'EXIT',<0.114.0>,normal}]
>     links: [<0.111.0>,<0.7.0>]
>     dictionary: []
>     trap_exit: true
>     status: running
>     heap_size: 2584
>     stack_size: 24
>     reductions: 245
>   neighbours:
>
> Everything works fine when I pull out the cluster_nodes configuration. 
>  I'm not quite sure what I'm doing wrong.  I've also tried using rabbit1, 
> rabbit2 as hostnames with /etc/hosts mapped to their internal IP address 
> but ran into the same issue.  Any help would be greatly appreciated.
>
> Thanks!
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/9bbdb2c6/attachment-0001.htm>

From Petr.Gotthard at Honeywell.com  Thu Feb  7 16:19:51 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 7 Feb 2013 16:19:51 +0000
Subject: [rabbitmq-discuss] Virtual host switch in the 3.0.2 web
 management
In-Reply-To: <5113BC48.9010307@rabbitmq.com>
References: <F9E85480F62349458DF67CE8BA000D8D2A66B5CA@FR44EX3005.global.ds.honeywell.com>
	<5113B5D3.1060405@rabbitmq.com>
	<F9E85480F62349458DF67CE8BA000D8D2A66B67E@FR44EX3005.global.ds.honeywell.com>
	<5113BC48.9010307@rabbitmq.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2A66B7BC@FR44EX3005.global.ds.honeywell.com>

The code is not available, but I found the problem:

VHOST_QUERIES["/xyz"] = "";

needed to be replaced by

VHOST_QUERIES.push(new RegExp("/xyz"));



Petr

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 7. ?nora 2013 15:38
To: Gotthard, Petr
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Virtual host switch in the 3.0.2 web management

On 07/02/13 14:36, Gotthard, Petr wrote:
> Well, it seems that it's somehow caused by my custom management
> plug-in. Most likely I forgot something when migrating my plug-in to
> 3.x: I added the NAVIGATION[] array setting, but there's probably
> something more.

Is the source available anywhere? I could have a look at it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Petr.Gotthard at Honeywell.com  Thu Feb  7 17:11:39 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 7 Feb 2013 17:11:39 +0000
Subject: [rabbitmq-discuss] Any RabbitMQ users at World ATM Congress in
	Madrid?
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2A66B7F6@FR44EX3005.global.ds.honeywell.com>

Hello,

We are using RabbitMQ in a research prototype of a future aircraft-to-ground messaging system. It's a part of the System Wide Information Management (SWIM) infrastructure, which is developed both in Europe and in US. The European SWIM will have a public demonstration at the World ATM Congress in Madrid, so if you happen to be in Madrid next week, I'd be glad to meet the other RabbitMQ users from the aviation industry.
http://www.sesarju.eu/programme/workpackages/swim


Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/09a56e69/attachment.htm>

From matthias at rabbitmq.com  Thu Feb  7 17:20:30 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Feb 2013 17:20:30 +0000
Subject: [rabbitmq-discuss] Round robin Topic exchange s
In-Reply-To: <-7207996771937574196@unknownmsgid>
References: <ccbc0c2b-bf26-469b-a63a-342ea48af8f0@googlegroups.com>
	<51138BAA.9040005@rabbitmq.com> <-7207996771937574196@unknownmsgid>
Message-ID: <5113E25E.30507@rabbitmq.com>

Marc,

On 07/02/13 11:23, Marc Teichtahl wrote:
> For each message to a topic exchange identify the matching queues and
> then round robin between theses.

Could you not get away with all consumers consuming from a shared set of 
queues, with the routing topology configured s.t. each message ends up 
in just one of the queues?

Whether or not that is possible very much depends on the overall routing 
semantics you are trying to achieve.

Regards,

Matthias.

From marc at teichtahl.com  Thu Feb  7 15:28:02 2013
From: marc at teichtahl.com (Marc Teichtahl)
Date: Thu, 7 Feb 2013 20:58:02 +0530
Subject: [rabbitmq-discuss] Round robin Topic exchange s
In-Reply-To: <5113C2FB.4050809@rabbitmq.com>
References: <ccbc0c2b-bf26-469b-a63a-342ea48af8f0@googlegroups.com>
	<51138BAA.9040005@rabbitmq.com> <-7207996771937574196@unknownmsgid>
	<5113C2FB.4050809@rabbitmq.com>
Message-ID: <-7374270265055004400@unknownmsgid>

Simon

Thanks for the considered reply.

We could go with your assumption

"If the number of routing keys is limited and topic wildcards are not
needed then you could just have one queue per routing key and have
consumers consume from all the queues they are interested in, and the
built in round robin would work for you."

If we use a non-wildcard key then perhaps the topic exchange could
look more like a set of direct of direct exchanges. This way the
existing round robin mechanisms could be used. In fact, I may have
misunderstood but doesn't the current topic exchange work like that ?

Marc

Sent from my iPhone

On 07/02/2013, at 20:36, Simon MacMullen <simon at rabbitmq.com> wrote:

> If the number of routing keys is limited and topic wildcards are not needed then you could just have one queue per routing key and have consumers consume from all the queues they are interested in, and the built in round robin would work for you.

From eliao at seegrid.com  Thu Feb  7 18:00:37 2013
From: eliao at seegrid.com (Elizabeth Liao)
Date: Thu, 7 Feb 2013 18:00:37 +0000
Subject: [rabbitmq-discuss] Rabbit start up error
Message-ID: <E94F626F5C43D14F8B8479C5EBD79038EB35D16F@vmexchange02.seegrid.local>

Hi all,

We're currently running RabbitMQ 2.8.6 (hopefully upgrading to 3.0.x soon) and sometimes we have an issue where the rabbitmq-server doesn't start up properly.  An edited startup_log is attached. The only way that we've found to recover from this is to delete both the queues and the msg_store_persistent directory under MNESIA_BASE.  Any help would be appreciated!

Thanks.

Liz
Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: startup_log_errors
Type: application/octet-stream
Size: 5298 bytes
Desc: startup_log_errors
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/fe3a0a85/attachment.obj>

From mpietrek at skytap.com  Thu Feb  7 18:07:48 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 7 Feb 2013 10:07:48 -0800
Subject: [rabbitmq-discuss] Help getting 2.8.7 to run after removing
	3.0.2 (maybe_upgrade_mnesia???)
In-Reply-To: <51138ADA.3020201@rabbitmq.com>
References: <CACLE7iwN7RtffL-_BcSoN-BF=mQKyHjHFZB1j-Bh5K3fTDWWCQ@mail.gmail.com>
	<51138ADA.3020201@rabbitmq.com>
Message-ID: <CACLE7ixK9TesnnQG0UgeKK0s3tCEqtbFi7t_PsChzp6yTZMX2A@mail.gmail.com>

Just to clarify (more so for future seekers of information):

RabbitMQ 2.8.X doesn't support the 'disc' specifier in the nodes list,
correct?

I realize that it's not likely that you'd go back to 2.8.7 and 'fix'
things. However, the info in the stack trace ('maybe_upgrade_mnesia') can
lead folks down the wrong path.

Perhaps add common causes for this crash this to a FAQ or something... :-)


On Thu, Feb 7, 2013 at 3:07 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 06/02/13 19:49, Matt Pietrek wrote:
>
>> So, I was recently experimenting with 3.0.2 and needing to go back to
>> 2.8.7 for some additional experimentation.
>>
>
> I assume from your other message that you sorted this out - please let us
> know if that's not the case.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/f717d02a/attachment.htm>

From prasadbchaure at gmail.com  Thu Feb  7 18:11:33 2013
From: prasadbchaure at gmail.com (PRASAD CHAURE)
Date: Thu, 7 Feb 2013 23:41:33 +0530
Subject: [rabbitmq-discuss] Regarding about rabbitMQ server's queue...
Message-ID: <CAMhBYkJxOft71WQJ+aamNEwGMCSCxGeHOVvzG09z9uN3Xz4crA@mail.gmail.com>

Hi,

Gone through the documentation which is available on RabbitMQ website.

From matthias at rabbitmq.com  Thu Feb  7 18:16:26 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Feb 2013 18:16:26 +0000
Subject: [rabbitmq-discuss] Rabbit start up error
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038EB35D16F@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD79038EB35D16F@vmexchange02.seegrid.local>
Message-ID: <5113EF7A.3030600@rabbitmq.com>

Liz,

On 07/02/13 18:00, Elizabeth Liao wrote:
> We're currently running RabbitMQ 2.8.6 (hopefully upgrading to 3.0.x
> soon) and sometimes we have an issue where the rabbitmq-server
> doesn't start up properly.  An edited startup_log is attached. The
> only way that we've found to recover from this is to delete both the
> queues and the msg_store_persistent directory under MNESIA_BASE.  Any
> help would be appreciated!

We've seen the odd report of this issue but so far have been unable to 
track it down. If you can get us a copy of the MNESIA_BASE dir when you 
see the above error then that might help us isolate the problem.

Did the server by any chance suffer any catastrophic faults, e.g. power 
outages? Or is your MNESIA_BASE dir NFS-mounted?

Regards,

Matthias.

From tim at rabbitmq.com  Thu Feb  7 21:34:21 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 7 Feb 2013 21:34:21 +0000
Subject: [rabbitmq-discuss] Regarding about rabbitMQ server's queue...
In-Reply-To: <CAMhBYkJxOft71WQJ+aamNEwGMCSCxGeHOVvzG09z9uN3Xz4crA@mail.gmail.com>
References: <CAMhBYkJxOft71WQJ+aamNEwGMCSCxGeHOVvzG09z9uN3Xz4crA@mail.gmail.com>
Message-ID: <6D22A44D-E00C-4A60-8ED9-4D0E74B92C53@rabbitmq.com>

Hi

On 7 Feb 2013, at 18:11, PRASAD CHAURE wrote:
> 1. Scenario : RabbitMQ server is continuously running and listening the specific application. 
> And that application is sending the result data (message) in queue. And the required messages of queue are read by RabbitMQ client.
> 
> If Client gets shut down/off for 2hrs. after that time again clients come up (on/logg in) iand start accessing the message from RabbitMQ server.
> Then will these client can get the messages which are generated in betweent this shut down time?
> 

Once messages are in a queue, they stay there until they're consumed by someone, or the queue is purged/deleted or the broker/server is shut down. If the messages are persistent (marked as delivery-mode=2) then even when the broker is shut down, the messages are still there after it restarts.

To answer your specific question about clients getting shut down: if the client goes away and comes back two hours later, then any messages that arrived in the queue whilst the client was away, will be visible to the client upon its return. Unless of course, other clients came along in the meanwhile and 'took' the messages for themselves.

> 2. Is the RabbitMQ server maintain some specific timed history message
> like...2 week back information of application. Is that maintain in queue?
> 

Messages stay in the queue until they are consumed. Once a message has been consumed (i.e., delivered to a client who is consuming) then they are deleted/removed from the queue. A message can stay in the queue for a whole year if you like, but once any client comes along and reads the message then the message is gone. 

> 3. How cae we define the size of queue?
> 

You cannot put a bound on the size of a queue in the current version of RabbitMQ. There is an open ticket to add this feature some time in the future. Usually people want to put a limit on the size of a queue in order to impose some form of flow control, however RabbitMQ does this all by itself. I'd suggest a careful reading of http://www.rabbitmq.com/memory.html to see if what the broker does already meets your needs.

> 4. How can we stop the to accessing the server from clients? Is any command is exist?
> 

I'm terribly sorry but I'll have to ask you to rephrase this question, as it makes no grammatical sense whatsoever. I'm not trying to be snarky here - I totally understand that English is not everyone's first language and I'm very keen to help, but despite my best efforts to guess at their intended meaning, I simply cannot make any sense of those words.

Warm regards,
Tim


From matthias at rabbitmq.com  Thu Feb  7 21:50:56 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Feb 2013 21:50:56 +0000
Subject: [rabbitmq-discuss] Regarding about rabbitMQ server's queue...
In-Reply-To: <6D22A44D-E00C-4A60-8ED9-4D0E74B92C53@rabbitmq.com>
References: <CAMhBYkJxOft71WQJ+aamNEwGMCSCxGeHOVvzG09z9uN3Xz4crA@mail.gmail.com>
	<6D22A44D-E00C-4A60-8ED9-4D0E74B92C53@rabbitmq.com>
Message-ID: <511421C0.90406@rabbitmq.com>

On 07/02/13 21:34, Tim Watson wrote:
> You cannot put a bound on the size of a queue in the current version
> of RabbitMQ.

Though you *can* put a bound on the lifetime of messages in a queue. Or, 
indeed, the lifetime if queues.

So if the OP is worried about clients vanishing for a long time (or even 
forever), leaving behind queues that keep growing, then these features 
can prevent that.

Matthias.

From rashim_a at yahoo.com  Thu Feb  7 22:14:01 2013
From: rashim_a at yahoo.com (Don)
Date: Thu, 7 Feb 2013 14:14:01 -0800 (PST)
Subject: [rabbitmq-discuss] The mechanics of message exchange between the
	broker and consumer
Message-ID: <91f127f5-2811-4a99-a9a2-69b0ddf679a4@googlegroups.com>

I am curious as to the exact mechanics of message exchange between the 
broker and the consumer.

1. Consumer opens a TCP connection to the broker.
2. Consumers subscribes to receive some messages from the broker - by 
binding the topic binding keys to the channel on a named queue.
3. Now whenever the broker gets some messages (from some producers) posted 
to that queue with a routing key matching any of the topic binding keys 
above, it will send the message to the subscribed consumer.

What are the exact underlying mechanics of step 3? Does the broker just use 
the TCP connection opened in step 1 and Push messages whenever it gets them 
OR does the consumer client library do a tight polling ("Hey broker get me 
messages if you have any") with the broker under the covers even though to 
the ultimate consumer it appears to be an asynchronous callback based 
mechanism?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130207/e7cbf5c8/attachment.htm>

From peter.konar at nokia.com  Thu Feb  7 23:00:29 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Thu, 7 Feb 2013 17:00:29 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>


We have an issue with our RabbitMQ clients not publishing to our RabbitMQ server. We see that the client hangs approx. every 2 hours and never recovers.

Versions:
Client: amqp-client-2.8.7.jar  , spring-amqp-1.1.1.RELEASE.jar
server: noarch/rabbitmq-server-2.8.7-1.noarch.rpm

On the client side we see that our application stops working. When we query the port we see:
[pkonar at ajtrafp067 ~]$ netstat -an | grep 5672
tcp        0 194017 ::ffff:10.196.42.93:47657   ::ffff:10.196.42.43:5672    FIN_WAIT1
tcp        0   2722 ::ffff:10.196.42.93:46361   ::ffff:10.196.42.43:5672    ESTABLISHED

The FIN_WAIT1 is from the application restart and never recovers the port. Meaning never releases the port from FIN_WAIT1. After restarting the application we see a new connection created the works, but we would prefer not restarting the app every 2 hours.

Server side
 [pkonar at ajtrafp017 ~]$ sudo rabbitmqctl list_connections name last_blocked_age last_blocked_by Listing connections ...
10.196.42.90:35923 -> 10.196.42.43:5672 497412.591327   flow
10.196.42.93:46361 -> 10.196.42.43:5672 912.850887      flow
10.196.42.92:45603 -> 10.196.42.43:5672 912.554772      flow
10.196.42.94:46145 -> 10.196.42.43:5672 319388.635685   flow
10.196.42.93:47657 -> 10.196.42.43:5672 83830.533463    flow
10.196.42.94:44100 -> 10.196.42.43:5672 10568.909981    flow
10.196.42.94:33175 -> 10.196.42.43:5672 166511.852811   flow
10.196.42.91:56200 -> 10.196.42.43:5672 912.849807      flow
10.196.42.90:40466 -> 10.196.42.43:5672 126071.593769   flow
10.196.42.90:56644 -> 10.196.42.43:5672 912.628977      flow
...done.


Looking for any help possible.

Thanks
Peter Konar

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.

From peter.konar at nokia.com  Thu Feb  7 23:10:45 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Thu, 7 Feb 2013 17:10:45 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <2F045D57CA284C47B36D3DCF045E77214604C07F@hq-ex-mb03.ad.navteq.com>
References: <2F045D57CA284C47B36D3DCF045E77214604C07F@hq-ex-mb03.ad.navteq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB15013762796A@hq-ex-mb03.ad.navteq.com>


From matthias at rabbitmq.com  Thu Feb  7 23:40:46 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Feb 2013 23:40:46 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
Message-ID: <51143B7E.8030102@rabbitmq.com>

Peter,

On 07/02/13 23:00, Konar Peter (Nokia-LC/Chicago) wrote:
> We have an issue with our RabbitMQ clients not publishing to our
> RabbitMQ server. We see that the client hangs approx. every 2 hours
> and never recovers.
>
> Versions: Client: amqp-client-2.8.7.jar  ,
> spring-amqp-1.1.1.RELEASE.jar server:
> noarch/rabbitmq-server-2.8.7-1.noarch.rpm

Where exactly does the client hang? Does it get stuck in a rabbitmq 
client API call? If so, which one?

> On the client side we see that our application stops working. When we
> query the port we see: [pkonar at ajtrafp067 ~]$ netstat -an | grep
> 5672 tcp        0 194017 ::ffff:10.196.42.93:47657
> ::ffff:10.196.42.43:5672    FIN_WAIT1 tcp        0   2722
> ::ffff:10.196.42.93:46361   ::ffff:10.196.42.43:5672    ESTABLISHED
>
> The FIN_WAIT1 is from the application restart and never recovers the
> port. Meaning never releases the port from FIN_WAIT1.

IIRC this is normal tcp behaviour. I'm pretty sure the O/S will release 
the port eventually. Could take a while though, possibly hours.

> After restarting the application we see a new connection created the works,
> but we would prefer not restarting the app every 2 hours.

It is possible that the TCP connections have been disrupted.

Are AMQP heartbeats enabled on the connections? If not then please do 
that. Or upgrade the server 3.0.x which enables heartbeats automatically.

Heartbeats ensure that disrupted tcp connections get detected promptly. 
They also help keeping connections alive in the presence of firewalls 
which may close them when idle for a while (thus being one source of 
disrupted connections).

> Server side [pkonar at ajtrafp017 ~]$ sudo rabbitmqctl list_connections
> name last_blocked_age last_blocked_by Listing connections ...
> 10.196.42.90:35923 -> 10.196.42.43:5672 497412.591327   flow
> [etc]

That all looks perfectly normal.

Matthias.

From matthias at rabbitmq.com  Thu Feb  7 23:49:47 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Feb 2013 23:49:47 +0000
Subject: [rabbitmq-discuss] The mechanics of message exchange between
 the broker and consumer
In-Reply-To: <91f127f5-2811-4a99-a9a2-69b0ddf679a4@googlegroups.com>
References: <91f127f5-2811-4a99-a9a2-69b0ddf679a4@googlegroups.com>
Message-ID: <51143D9B.4030502@rabbitmq.com>

On 07/02/13 22:14, Don wrote:
> Does the broker [...] Push messages whenever it
> gets them OR does the consumer client library do a tight polling

The former. Across all protocols supported by the broker and official 
plug-ins, i.e. AMQP, STOMP, MQTT, Web-STOMP.

Matthias.


From matthias at rabbitmq.com  Thu Feb  7 23:54:17 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 07 Feb 2013 23:54:17 +0000
Subject: [rabbitmq-discuss] Help getting 2.8.7 to run after removing
 3.0.2 (maybe_upgrade_mnesia???)
In-Reply-To: <CACLE7ixK9TesnnQG0UgeKK0s3tCEqtbFi7t_PsChzp6yTZMX2A@mail.gmail.com>
References: <CACLE7iwN7RtffL-_BcSoN-BF=mQKyHjHFZB1j-Bh5K3fTDWWCQ@mail.gmail.com>
	<51138ADA.3020201@rabbitmq.com>
	<CACLE7ixK9TesnnQG0UgeKK0s3tCEqtbFi7t_PsChzp6yTZMX2A@mail.gmail.com>
Message-ID: <51143EA9.1050703@rabbitmq.com>

Matt,

On 07/02/13 18:07, Matt Pietrek wrote:
> Just to clarify (more so for future seekers of information):
>
> RabbitMQ 2.8.X doesn't support the 'disc' specifier in the nodes list,
> correct?

Correct.

> I realize that it's not likely that you'd go back to 2.8.7 and 'fix'
> things.

If you tell us how to go back in time then we will consider that request ;)

> However, the info in the stack trace ('maybe_upgrade_mnesia')
> can lead folks down the wrong path.
>
> Perhaps add common causes for this crash this to a FAQ or something... :-)

You did just that. By posting your query with easily-googleable terms to 
the mailing list. :)


Matthias.

From matthias at rabbitmq.com  Fri Feb  8 00:04:07 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Feb 2013 00:04:07 +0000
Subject: [rabbitmq-discuss] Is it error?
In-Reply-To: <CAEQ7gRNsqhef6LhoG4KchBHb+mfu3FcrfRsxrqKrGOwVKtq5PQ@mail.gmail.com>
References: <CAEQ7gRNMWhP942G8OJKXaMC7WMBJyzimexESdwaTMhZGJXQB8Q@mail.gmail.com>
	<6E85014A-B303-4D66-97AC-ECE2C1D77825@rabbitmq.com>
	<CAEQ7gRNHwpSXzDfuQXThTWkp4LTYPy7BCB==od_n3YtuYCh3Cg@mail.gmail.com>
	<CAMcAHLU7d8Z9a+_D+hTCXMOuoeBSvnDB5_b=G55zDdfckNmjRQ@mail.gmail.com>
	<CAEQ7gRNsqhef6LhoG4KchBHb+mfu3FcrfRsxrqKrGOwVKtq5PQ@mail.gmail.com>
Message-ID: <511440F7.1000109@rabbitmq.com>

On 06/02/13 20:12, ????? wrote:
> I have some manage CLI script which must show info about exchanges and
> queues and must declare it if need. How i can take info about this
> wihout web managment plugin?

As Alvaro said, if you simply want to ensure that certain 
exchanges/queues exist, then just declare them without first checking 
whether they exist.

If, OTOH, you really must obtain a list of exchanges/queues then the 
management plug-in, or running rabbitmqctl, or Erlang-hackery are the 
only means to do that. NB: It is rare for applications (other than 
monitoring apps) to need this information, and this is often an 
indication of a flaw in the design.

Matthias.

From matthias at rabbitmq.com  Fri Feb  8 00:17:05 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Feb 2013 00:17:05 +0000
Subject: [rabbitmq-discuss] problematic ACKs of messages
In-Reply-To: <F1A539826FC33E4CA602BB52E5C4502222B37495@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C4502222B36465@FR44EX3004.global.ds.honeywell.com>
	<CAE3HoVQJbDerijOQ+jstc1mFQMQas+10D4DYnYXh4j9SGS5Z0g@mail.gmail.com>
	<F1A539826FC33E4CA602BB52E5C4502222B37495@FR44EX3004.global.ds.honeywell.com>
Message-ID: <51144401.3040509@rabbitmq.com>

Marek,

On 06/02/13 14:01, Cermak, Marek wrote:
> I am subscribed to a single queue using only a single channel in the
> whole process.

I suggest you carry out some tracing (or add extra logging) at the 
Erlang level to find out where the 'basic.ack' for an unknown delivery 
tag is coming from. The server certainly isn't lying when it is 
complaining about that.

Regards,

Matthias.

From matthias at rabbitmq.com  Fri Feb  8 11:36:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Feb 2013 11:36:12 +0000
Subject: [rabbitmq-discuss] why a flowing Connection can make all
 Connection blocked
In-Reply-To: <1359787126555-24829.post@n5.nabble.com>
References: <1359683075316-24811.post@n5.nabble.com>
	<510B9BE6.8050001@rabbitmq.com>
	<1359787126555-24829.post@n5.nabble.com>
Message-ID: <5114E32C.2070703@rabbitmq.com>

On 02/02/13 06:38, andy lin wrote:
>       I have checked ,but I find   no  memory  or disk  alarm going off,and
> only one connection show flowing state ,others show running state,But all
> Connection can't receive or send.Maybe other reason?

What exactly are you seeing at the client end? i.e. how did you 
determine that the connections "can't receive or send"?

Matthias.


From simon at rabbitmq.com  Fri Feb  8 11:47:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Feb 2013 11:47:21 +0000
Subject: [rabbitmq-discuss] Performance Hit when using Federation
In-Reply-To: <510963F4.10505@cray.com>
References: <510957E3.6020500@cray.com> <51095F86.1030100@rabbitmq.com>
	<510963F4.10505@cray.com>
Message-ID: <5114E5C9.2040703@rabbitmq.com>

On 30/01/13 18:18, Eric Cozzi wrote:
> Wouldn't republishing more so affect latency, not throughput? I'd expect
> that the federated brokers should be able to republish the messages
> nearly as quickly as they received them. Sure there is going to be
> processing time to perform the network read, queue and re-send the
> message, but that shouldn't affect 'how many' messages a federated
> broker can send in a second?

That depends. If the broker were not anywhere near 100% CPU then yes 
(maybe - it depends what the slowest link in the chain is). If it were 
close to maxed out then the additional work done could push it over the 
edge.

> One of the use cases that we're look at is being able to make an RPC
> call where the client and server are potentially on disparate,
> non-routable networks. Essentially, there would only be a few gateway
> nodes that would span both networks. We're looking at installing
> RabbitMQ on these gateway nodes, and at other key points in our system.
> Thus, we need to be able to support RPC across several intermediate
> RabbitMQ brokers. Federation seemed a natural fit, but is there
> another/better option? The shovel plugin doesn't look to me like it
> would easily fill our need, if I'm not mistaken.

Shovel would definitely require that you take quite a static approach to 
routing for this stuff.

> As for having a mode where federation optimized speed over reliability,
> that might be interesting to us.

Cool. Well it turned out to be very easy to implement, so that will be 
available in RabbitMQ 3.1.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ask at rabbitmq.com  Fri Feb  8 12:46:56 2013
From: ask at rabbitmq.com (Ask Solem)
Date: Fri, 8 Feb 2013 12:46:56 +0000
Subject: [rabbitmq-discuss] RabbitMQ scaling with OpenStack
In-Reply-To: <1360086653814-24874.post@n5.nabble.com>
References: <CAJcv3CSQBm3nq_YBTpmnZ7h8J9SNt-dO=BHkUGw3XRPyaKR8zA@mail.gmail.com>
	<50AFC3AB-981C-42D8-AB02-31496E42D8B4@rabbitmq.com>
	<1360086653814-24874.post@n5.nabble.com>
Message-ID: <B9C05679-73E3-4E3E-9224-5AFB78FAABD7@rabbitmq.com>


On Feb 5, 2013, at 5:50 PM, Ray Pekowski <pekowski at gmail.com> wrote:

> Ask Solem-3 wrote
>>> On Jan 22, 2013, at 1:58 PM, Ask Solem 
>> <ask at rabbitmq.com>
>> wrote:
>> 
>> I've spent some time reviewing the code, but it's really hard to follow,
>> and it's
>> reinventing a lot of things that Kombu already supports.   Having two sets
>> of
>> implementations means that we both have to debug and maintain it, this
>> code could
>> definitely be reduced by a lot.
> 
> Thank you for taking the time to review the code.  Yes, it is confusing and
> perhaps impossible to fully understand without also reading amqp.py
> (https://github.com/openstack/nova/blob/master/nova/openstack/common/rpc/amqp.py),
> which is a common module between the kombu and Qpid implementations for
> OpenStack.

Yeah, but it seems that you are re-implementing things already in Kombu on top of it,
which maybe could have been moved into the qpid implementation.

E.g. the reconnecting at failover, there could be improvements added to kombu
that you would not be able to take advantage of.


> 
> 
> Ask Solem-3 wrote
>> One thing that I'm unable to understand is whether it's creating a channel
>> or not
>> (other than the Connection.default_channel), and if so if it creates a
>> channel for
>> every request.  This would be bad since creating channels is very
>> expensive (at least in amqplib/py-amqp).
> 
> It does not create a new channel on each request.  The channel object is
> held in a impl_kombu.Connection class instance and instances of
> impl_kombu.Connection are pooled.  You can find the pool implementation in
> amqp.py that I mentioned earlier.

Right, I saw the pool, but it was not obvious how channels are handled.
Kombu also comes with a connection pool, and you can pass a connection
to any method requiring a channel and it will use a 'default channel' that is closed
with the connection.
> 
> 
> Ask Solem-3 wrote
>> Also, it seems that the reply messages are persistent, do they have to be?
> 
> The reply messages are RPC replies are implemented in the DirectPublisher
> class which has {'durable': False} for its exchange and queue options.  The
> RPC call is done via the TopicPublisher class and it has the durable option
> that defaults to False, but can be overridden using a OpenStack nova.conf
> file configuration setting.

But durable is not the same as being persistent, which depends on the delivery_mode
property of the message.  Persistent messages are default in Kombu, but you can
change that by using .publish(delivery_mode=1)
> 
> BTW, one of the questions that has come up is whether it makes sense for the
> RPC reply queues to mirrored.  Is HA generally thought of as important for
> RPC replies?  I just am not sure.  Our current implementation has mirroring
> turned off for reply queues, but we are trying to figure out if that was
> just an oversight.
> 

If the RPC replies must be available from multiple processes (e.g. any process can
request the reply for a request by id) then I think you should consider storing the
replies in a database instead.

If not I recommend that you use one queue per client for RPC replies, this will
minimize the number of queues used for replies, and optimally they should
be non-persistent and not mirrored, but that depends on the application
(openstack could leave this configurable for those who need it)

From fred at dushin.net  Fri Feb  8 14:11:42 2013
From: fred at dushin.net (Fred Dushin)
Date: Fri, 8 Feb 2013 09:11:42 -0500
Subject: [rabbitmq-discuss] Config file syntax changes between 2.8.7 and
	3.0.X
In-Reply-To: <51138AAD.3020109@rabbitmq.com>
References: <CACLE7ixfjsFKd1-wT7OfqXSDUQw-K5vxnu4qKtOEhvdMY6zwpg@mail.gmail.com>
	<51138AAD.3020109@rabbitmq.com>
Message-ID: <E841394C-4B6C-4E18-A9EC-DA6BDF9630D6@dushin.net>

Good to know -- in my experience, the old style mochiweb config still works under 3.0.1, though of course I will be promptly fixing to use the new style config <blush>

-Fred

On Feb 7, 2013, at 6:06 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

>> *2) Configuring the Management API port*
>> 
>> In the http://previous.rabbitmq.com/management.html, the management port
>> looks to be configured like this:
>> 
>> {rabbitmq_mochiweb, [{listeners, [{mgmt, [{port, 55555}]}]}]},
>> 
>> 
>> whereas in 3.0.X, it looks like the port is configured like this:
>> 
>> {rabbitmq_management, [{listener, [{port, 12345}]}]},
>> 
>> 
>> Is the 2.8.7 syntax not allowed in 3.0.X?
> 
> No, that's just changed outright.
> 
> The good news is we are not planning to make breaking changes like this again any time soon...

From james.r.carr at gmail.com  Fri Feb  8 15:18:56 2013
From: james.r.carr at gmail.com (James Carr)
Date: Fri, 8 Feb 2013 09:18:56 -0600
Subject: [rabbitmq-discuss] 0-8 AMQP Clients and RabbitMQ 3.0.2?
Message-ID: <CAJreXKCGWdEem2sn=LiHtkB_cZTphdU_4z1SmoA4vvRFQVNLDg@mail.gmail.com>

Hey All,

While migrating our workers to a new cluster last night, some legacy
workers that use Celery 2.5.5 and the 0-8 AMQP python client got tons
of IO Broken Pipe errors. They successfully declared their queues and
exchanges but their normal message rates were about an 1/10 of what
their lower range normally is. We migrated the older workers back and
I'm spending my morning investigating the issue but I'm wondering if
there is any knowledge of this kind of issue.

Our setup is nothing fancy... just a four node cluster behind haproxy
with all queues designated as mirrored. Our 0-9-1 AMQP clients do not
seem to have the same issue. :)


Thanks,
James

From simon at rabbitmq.com  Fri Feb  8 15:22:04 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Feb 2013 15:22:04 +0000
Subject: [rabbitmq-discuss] 0-8 AMQP Clients and RabbitMQ 3.0.2?
In-Reply-To: <CAJreXKCGWdEem2sn=LiHtkB_cZTphdU_4z1SmoA4vvRFQVNLDg@mail.gmail.com>
References: <CAJreXKCGWdEem2sn=LiHtkB_cZTphdU_4z1SmoA4vvRFQVNLDg@mail.gmail.com>
Message-ID: <5115181C.1030000@rabbitmq.com>

There should not be any issue, 0-8 is supposed to still be supported. 
Did anything interesting show up in the server logs?

Cheers, Simon

On 08/02/13 15:18, James Carr wrote:
> Hey All,
>
> While migrating our workers to a new cluster last night, some legacy
> workers that use Celery 2.5.5 and the 0-8 AMQP python client got tons
> of IO Broken Pipe errors. They successfully declared their queues and
> exchanges but their normal message rates were about an 1/10 of what
> their lower range normally is. We migrated the older workers back and
> I'm spending my morning investigating the issue but I'm wondering if
> there is any knowledge of this kind of issue.
>
> Our setup is nothing fancy... just a four node cluster behind haproxy
> with all queues designated as mirrored. Our 0-9-1 AMQP clients do not
> seem to have the same issue. :)
>
>
> Thanks,
> James
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From peter.konar at nokia.com  Fri Feb  8 17:55:37 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Fri, 8 Feb 2013 11:55:37 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <51143B7E.8030102@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>

Matthias,
        Adding more people to the discussion.

- Where exactly does the client hang? Does it get stuck in a rabbitmq client API call? If so, which one?
I will get you a stack trace as soon as I can capture a failed case.

-It is possible that the TCP connections have been disrupted.
Could be we are living in the virtual world, so I am not sure what the connectivity does? (Jerry/Anthony - can you answer?)

Are AMQP heartbeats enabled on the connections? If not then please do that. Or upgrade the server 3.0.x which enables heartbeats automatically.
No, we are upgrading to 3.0.2 to hopefully get us this.

Thanks
Peter Konar

-----Original Message-----
From: ext Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Thursday, February 07, 2013 5:41 PM
To: Discussions about RabbitMQ
Cc: Konar Peter (Nokia-LC/Chicago)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 07/02/13 23:00, Konar Peter (Nokia-LC/Chicago) wrote:
> We have an issue with our RabbitMQ clients not publishing to our
> RabbitMQ server. We see that the client hangs approx. every 2 hours
> and never recovers.
>
> Versions: Client: amqp-client-2.8.7.jar  ,
> spring-amqp-1.1.1.RELEASE.jar server:
> noarch/rabbitmq-server-2.8.7-1.noarch.rpm

Where exactly does the client hang? Does it get stuck in a rabbitmq client API call? If so, which one?

> On the client side we see that our application stops working. When we
> query the port we see: [pkonar at ajtrafp067 ~]$ netstat -an | grep
> 5672 tcp        0 194017 ::ffff:10.196.42.93:47657
> ::ffff:10.196.42.43:5672    FIN_WAIT1 tcp        0   2722
> ::ffff:10.196.42.93:46361   ::ffff:10.196.42.43:5672    ESTABLISHED
>
> The FIN_WAIT1 is from the application restart and never recovers the
> port. Meaning never releases the port from FIN_WAIT1.

IIRC this is normal tcp behaviour. I'm pretty sure the O/S will release the port eventually. Could take a while though, possibly hours.

> After restarting the application we see a new connection created the
> works, but we would prefer not restarting the app every 2 hours.

It is possible that the TCP connections have been disrupted.

Are AMQP heartbeats enabled on the connections? If not then please do that. Or upgrade the server 3.0.x which enables heartbeats automatically.

Heartbeats ensure that disrupted tcp connections get detected promptly.
They also help keeping connections alive in the presence of firewalls which may close them when idle for a while (thus being one source of disrupted connections).

> Server side [pkonar at ajtrafp017 ~]$ sudo rabbitmqctl list_connections
> name last_blocked_age last_blocked_by Listing connections ...
> 10.196.42.90:35923 -> 10.196.42.43:5672 497412.591327   flow
> [etc]

That all looks perfectly normal.

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.

From matthias at rabbitmq.com  Fri Feb  8 18:13:44 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Feb 2013 18:13:44 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>
Message-ID: <51154058.9070507@rabbitmq.com>

On 08/02/13 17:59, Carroll James (Nokia-LC/Malvern) wrote:
> As far as where it's hanging on the client side: I don't have the
> exact rabbit call stack (I'll save off the jstack next time) but it's
> inside the amqp client code and inside of the native socketWrite
> call. Both the send buffer on the client side and the recv buffer on
> the server side are full. While the server is still maintaining the
> connection it's not reading from the socket. Since the client is
> written in terms of blocking java.io, the client hangs waiting for
> the server to read the data.

Hmmm, in which case please post the output of 'rabbitmqctl report' as well.

Peter posted some 'rabbitmqctl list_connections' output but 
unfortunately that did not include the 'state' field so it's impossible 
to tell whether the connections were being throttled at the time.

Matthias.

From james.carroll at nokia.com  Fri Feb  8 17:59:12 2013
From: james.carroll at nokia.com (Carroll James (Nokia-LC/Malvern))
Date: Fri, 8 Feb 2013 11:59:12 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
Message-ID: <D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>

As far as where it's hanging on the client side: I don't have the exact rabbit call stack (I'll save off the jstack next time) but it's inside the amqp client code and inside of the native socketWrite call. Both the send buffer on the client side and the recv buffer on the server side are full. While the server is still maintaining the connection it's not reading from the socket. Since the client is written in terms of blocking java.io, the client hangs waiting for the server to read the data.

-----Original Message-----
From: Konar Peter (Nokia-LC/Chicago)
Sent: Friday, February 08, 2013 12:56 PM
To: ext Matthias Radestock; Discussions about RabbitMQ; Carroll James (Nokia-LC/Malvern); Mccuiston Mitchell (Nokia-LC/Chicago); Lieber Dick (Nokia-LC/Chicago)
Cc: Johnson Anthony (Nokia-LC/Alpharetta); Yu Jerry.3 (Nokia-LC/Alpharetta)
Subject: RE: [rabbitmq-discuss] RabbitMQ blocking issue

Matthias,
        Adding more people to the discussion.

- Where exactly does the client hang? Does it get stuck in a rabbitmq client API call? If so, which one?
I will get you a stack trace as soon as I can capture a failed case.

-It is possible that the TCP connections have been disrupted.
Could be we are living in the virtual world, so I am not sure what the connectivity does? (Jerry/Anthony - can you answer?)

Are AMQP heartbeats enabled on the connections? If not then please do that. Or upgrade the server 3.0.x which enables heartbeats automatically.
No, we are upgrading to 3.0.2 to hopefully get us this.

Thanks
Peter Konar

-----Original Message-----
From: ext Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Thursday, February 07, 2013 5:41 PM
To: Discussions about RabbitMQ
Cc: Konar Peter (Nokia-LC/Chicago)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 07/02/13 23:00, Konar Peter (Nokia-LC/Chicago) wrote:
> We have an issue with our RabbitMQ clients not publishing to our
> RabbitMQ server. We see that the client hangs approx. every 2 hours
> and never recovers.
>
> Versions: Client: amqp-client-2.8.7.jar  ,
> spring-amqp-1.1.1.RELEASE.jar server:
> noarch/rabbitmq-server-2.8.7-1.noarch.rpm

Where exactly does the client hang? Does it get stuck in a rabbitmq client API call? If so, which one?

> On the client side we see that our application stops working. When we
> query the port we see: [pkonar at ajtrafp067 ~]$ netstat -an | grep
> 5672 tcp        0 194017 ::ffff:10.196.42.93:47657
> ::ffff:10.196.42.43:5672    FIN_WAIT1 tcp        0   2722
> ::ffff:10.196.42.93:46361   ::ffff:10.196.42.43:5672    ESTABLISHED
>
> The FIN_WAIT1 is from the application restart and never recovers the
> port. Meaning never releases the port from FIN_WAIT1.

IIRC this is normal tcp behaviour. I'm pretty sure the O/S will release the port eventually. Could take a while though, possibly hours.

> After restarting the application we see a new connection created the
> works, but we would prefer not restarting the app every 2 hours.

It is possible that the TCP connections have been disrupted.

Are AMQP heartbeats enabled on the connections? If not then please do that. Or upgrade the server 3.0.x which enables heartbeats automatically.

Heartbeats ensure that disrupted tcp connections get detected promptly.
They also help keeping connections alive in the presence of firewalls which may close them when idle for a while (thus being one source of disrupted connections).

> Server side [pkonar at ajtrafp017 ~]$ sudo rabbitmqctl list_connections
> name last_blocked_age last_blocked_by Listing connections ...
> 10.196.42.90:35923 -> 10.196.42.43:5672 497412.591327   flow
> [etc]

That all looks perfectly normal.

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.

From peter.konar at nokia.com  Fri Feb  8 20:05:47 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Fri, 8 Feb 2013 14:05:47 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <51154058.9070507@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>

Jstack trace of the connection that is hung.

"pool-5-thread-2" prio=10 tid=0x00007f90445c0000 nid=0x7a4 runnable [0x00007f8d9eef3000]
   java.lang.Thread.State: RUNNABLE
        at java.net.SocketOutputStream.$$YJP$$socketWrite0(Native Method)
        at java.net.SocketOutputStream.socketWrite0(SocketOutputStream.java)
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:109)
        at java.net.SocketOutputStream.write(SocketOutputStream.java:153)
        at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)
        at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)
        - locked <0x00000006c5e900d8> (a java.io.BufferedOutputStream)
        at java.io.DataOutputStream.flush(DataOutputStream.java:123)
        at com.rabbitmq.client.impl.SocketFrameHandler.flush(SocketFrameHandler.java:142)
        at com.rabbitmq.client.impl.AMQConnection.flush(AMQConnection.java:481)
        at com.rabbitmq.client.impl.AMQCommand.transmit(AMQCommand.java:125)
        at com.rabbitmq.client.impl.AMQChannel.quiescingTransmit(AMQChannel.java:316)
        - locked <0x00000006b14003f0> (a java.lang.Object)
        at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:292)
        - locked <0x00000006b14003f0> (a java.lang.Object)
        at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:601)
        at sun.reflect.GeneratedMethodAccessor79.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:601)
        at org.springframework.amqp.rabbit.connection.CachingConnectionFactory$CachedChannelInvocationHandler.invoke(CachingConnectionFactory.java:348)
        - locked <0x00000006b1400b10> (a java.lang.Object)
        at $Proxy59.basicPublish(Unknown Source)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.doSend(RabbitTemplate.java:648)
        at org.springframework.amqp.rabbit.core.RabbitTemplate$1.doInRabbit(RabbitTemplate.java:331)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:600)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:329)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:323)
        at com.nokia.traffic.flowdata.transport.rabbitmq.RabbitMQSender.send(RabbitMQSender.java:53)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.doSend_aroundBody4(TrafficStateAccumulatorMP.java:169)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP$AjcClosure5.run(TrafficStateAccumulatorMP.java:1)
        at org.aspectj.runtime.reflect.JoinPointImpl.proceed(JoinPointImpl.java:149)
        at com.nokia.traffic.ttbhm.audit.MessageGroupingAspect.dispatchOutput(MessageGroupingAspect.java:56)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.doSend(TrafficStateAccumulatorMP.java:168)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.trySendingALinear(TrafficStateAccumulatorMP.java:126)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.onSendLinear_aroundBody2(TrafficStateAccumulatorMP.java:99)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP$AjcClosure3.run(TrafficStateAccumulatorMP.java:1)
        at org.aspectj.runtime.reflect.JoinPointImpl.proceed(JoinPointImpl.java:149)
        at com.nokia.traffic.ttbhm.audit.MessageGroupingAspect.outputHandler(MessageGroupingAspect.java:214)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.onSendLinear(TrafficStateAccumulatorMP.java:97)
        at sun.reflect.GeneratedMethodAccessor74.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:601)
        at com.nokia.dempsy.container.internal.LifecycleHelper.invokeOutput(LifecycleHelper.java:178)
        at com.nokia.dempsy.container.MpContainer.invokeOperation(MpContainer.java:1160)
        at com.nokia.dempsy.container.MpContainer.access$600(MpContainer.java:70)
        at com.nokia.dempsy.container.MpContainer$6.run(MpContainer.java:924)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
        at java.lang.Thread.run(Thread.java:722)



[pkonar at ajtrafp063 ~]$ sudo rabbitmqctl report
Reporting server status on {{2013,2,8},{20,5,18}}

Status of node rabbit at ajtrafp064 ...
[{pid,8182},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","2.8.7"},
      {rabbitmq_management,"RabbitMQ Management Console","2.8.7"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.7"},
      {webmachine,"webmachine","1.9.1-rmq2.8.7-git52e62bc"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.7"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.7"},
      {rabbit,"RabbitMQ","2.8.7"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.7-gitd541e9a"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {xmerl,"XML parser","1.2.10"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,38201376},
      {processes,13480144},
      {processes_used,13433112},
      {system,24721232},
      {atom,1538337},
      {atom_used,1524400},
      {binary,2739608},
      {code,17157476},
      {ets,1293432}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,6689898496},
 {disk_free_limit,1000000000},
 {disk_free,62247305216},
 {file_descriptors,
     [{total_limit,924},{total_used,6},{sockets_limit,829},{sockets_used,4}]},
 {processes,[{limit,1048576},{used,205}]},
 {run_queue,0},
 {uptime,865082}]

Cluster status of node rabbit at ajtrafp064 ...
[{nodes,[{disc,[rabbit at ajtrafp063,rabbit at ajtrafp064]}]},
 {running_nodes,[rabbit at ajtrafp063,rabbit at ajtrafp064]}]

Application environment of node rabbit at ajtrafp064 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[rabbit at ajtrafp063,rabbit at ajtrafp064]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at ajtrafp064.log"}},
 {frame_max,131072},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at ajtrafp064-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Status of node rabbit at ajtrafp063 ...
[{pid,1495},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","2.8.7"},
      {rabbitmq_management,"RabbitMQ Management Console","2.8.7"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.7"},
      {webmachine,"webmachine","1.9.1-rmq2.8.7-git52e62bc"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.7"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.7"},
      {rabbit,"RabbitMQ","2.8.7"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.7-gitd541e9a"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {xmerl,"XML parser","1.2.10"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,113292568},
      {processes,61427424},
      {processes_used,61349488},
      {system,51865144},
      {atom,1538337},
      {atom_used,1523704},
      {binary,15952560},
      {code,17183056},
      {ets,15171968}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,6689898496},
 {disk_free_limit,1000000000},
 {disk_free,62213640192},
 {file_descriptors,
     [{total_limit,924},{total_used,11},{sockets_limit,829},{sockets_used,8}]},
 {processes,[{limit,1048576},{used,237}]},
 {run_queue,0},
 {uptime,74168}]

Cluster status of node rabbit at ajtrafp063 ...
[{nodes,[{disc,[rabbit at ajtrafp063,rabbit at ajtrafp064]}]},
 {running_nodes,[rabbit at ajtrafp064,rabbit at ajtrafp063]}]

Application environment of node rabbit at ajtrafp063 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[rabbit at ajtrafp063,rabbit at ajtrafp064]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at ajtrafp063.log"}},
 {frame_max,131072},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at ajtrafp063-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:
pid     name    address port    peer_address    peer_port       ssl     peer_cert_subject       peer_cert_issuer        peer_cert_validity      auth_mechanism  ssl_protocol    ssl_key_exchange        ssl_cipher      ssl_hash        protocol        user    vhost     timeout frame_max       client_properties       recv_oct        recv_cnt        send_oct        send_cnt        send_pend       state   last_blocked_by last_blocked_age        channels
<rabbit at ajtrafp064.3.17615.445> 10.196.42.119:37257 -> 10.196.42.22:5672        10.196.42.22    5672    10.196.42.119   37257   false                           PLAIN                                   {0,9,1} guest   /       0       131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.4"}] 211368165       9198234 483965816       10062679        0       running none    infinity        2
<rabbit at ajtrafp064.3.17602.445> 10.196.42.120:54628 -> 10.196.42.22:5672        10.196.42.22    5672    10.196.42.120   54628   false                           PLAIN                                   {0,9,1} guest   /       0       131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.4"}] 155539518       6925521 856651504       7405560 0       running none    infinity        2
<rabbit at ajtrafp064.3.17674.445> 10.196.42.182:34772 -> 10.196.42.22:5672        10.196.42.22    5672    10.196.42.182   34772   false                           PLAIN                                   {0,9,1} guest   /       0       131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.7"}] 8982892 10258   59980   4261    0       running none    infinity        1
<rabbit at ajtrafp063.1.17262.888> 10.196.42.181:44585 -> 10.196.42.21:5672        10.196.42.21    5672    10.196.42.181   44585   false                           PLAIN                                   {0,9,1} guest   /       0       131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.7"}] 3042287025      1833703 1623444 115937  0       running flow    2051.757231     1
<rabbit at ajtrafp063.1.7689.860>  10.196.42.182:52070 -> 10.196.42.21:5672        10.196.42.21    5672    10.196.42.182   52070   false                           PLAIN                                   {0,9,1} guest   /       0       131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.7"}] 3569900672      2105694 1887892 134826  0       running flow    2712.356091     2
<rabbit at ajtrafp063.1.412.0>     10.196.42.128:54376 -> 10.196.42.21:5672        10.196.42.21    5672    10.196.42.128   54376   false                           PLAIN                                   {0,9,1} guest   /       0       131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.7"}] 19086   33      480     11      0       running none    infinity        1
<rabbit at ajtrafp063.1.5685.336>  10.196.42.180:34088 -> 10.196.42.21:5672        10.196.42.21    5672    10.196.42.180   34088   false                           PLAIN                                   {0,9,1} guest   /       0       131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.7"}] 4074977814      6637192 50504276        3607425 0       running flow    3855.880187     1
<rabbit at ajtrafp063.1.23419.903> 10.196.129.114:47978 -> 10.196.42.21:5672       10.196.42.21    5672    10.196.129.114  47978   false                           PLAIN                                   {0,9,1} guest   /       0       131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.4"}] 262583397       2920737 939686596       7134486 0       running none    infinity        1
<rabbit at ajtrafp063.1.6391.783>  10.196.42.128:58015 -> 10.196.42.21:5672        10.196.42.21    5672    10.196.42.128   58015   false                           PLAIN                                   {0,9,1} guest   /       0       131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.7"}] 678123470       1736589 15442188        1102990 0       running flow    3795.312193     2
<rabbit at ajtrafp063.1.457.0>     10.196.42.180:42353 -> 10.196.42.21:5672        10.196.42.21    5672    10.196.42.180   42353   false                           PLAIN                                   {0,9,1} guest   /       0       131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.7"}] 25881171        35488   88596   6305    0       running none    infinity        1

Channels:
pid     name    connection      number  user    vhost   transactional   confirm consumer_count  messages_unacknowledged messages_unconfirmed    messages_uncommitted    acks_uncommitted        prefetch_count  client_flow_blocked
<rabbit at ajtrafp064.3.17606.445> 10.196.42.120:54628 -> 10.196.42.22:5672 (1)    <rabbit at ajtrafp064.3.17602.445> 1       guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp064.3.17611.445> 10.196.42.120:54628 -> 10.196.42.22:5672 (2)    <rabbit at ajtrafp064.3.17602.445> 2       guest   /       false   false   1       0       0       0       0       8000    false
<rabbit at ajtrafp064.3.17619.445> 10.196.42.119:37257 -> 10.196.42.22:5672 (1)    <rabbit at ajtrafp064.3.17615.445> 1       guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp064.3.17624.445> 10.196.42.119:37257 -> 10.196.42.22:5672 (2)    <rabbit at ajtrafp064.3.17615.445> 2       guest   /       false   false   1       0       0       0       0       8000    false
<rabbit at ajtrafp064.3.27234.445> 10.196.42.182:34772 -> 10.196.42.22:5672 (1710) <rabbit at ajtrafp064.3.17674.445> 1710    guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp063.1.423.0>     10.196.42.128:54376 -> 10.196.42.21:5672 (2)    <rabbit at ajtrafp063.1.412.0>     2       guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp063.1.13080.0>   10.196.42.180:42353 -> 10.196.42.21:5672 (798)  <rabbit at ajtrafp063.1.457.0>     798     guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp063.1.23423.903> 10.196.129.114:47978 -> 10.196.42.21:5672 (1)   <rabbit at ajtrafp063.1.23419.903> 1       guest   /       false   false   1       0       0       0       0       8000    false
<rabbit at ajtrafp063.1.7295.958>  10.196.42.128:58015 -> 10.196.42.21:5672 (55418)        <rabbit at ajtrafp063.1.6391.783>  55418   guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp063.1.7318.958>  10.196.42.128:58015 -> 10.196.42.21:5672 (55419)        <rabbit at ajtrafp063.1.6391.783>  55419   guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp063.1.14305.964> 10.196.42.182:52070 -> 10.196.42.21:5672 (26027)        <rabbit at ajtrafp063.1.7689.860>  26027   guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp063.1.14309.964> 10.196.42.182:52070 -> 10.196.42.21:5672 (26028)        <rabbit at ajtrafp063.1.7689.860>  26028   guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp063.1.25715.968> 10.196.42.181:44585 -> 10.196.42.21:5672 (22148)        <rabbit at ajtrafp063.1.17262.888> 22148   guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp063.1.18018.977> 10.196.42.180:34088 -> 10.196.42.21:5672 (41340)        <rabbit at ajtrafp063.1.5685.336>  41340   guest   /       false   false   0       0       0       0       0       0       false

Queues on /:
pid     name    durable auto_delete     arguments       owner_pid       slave_pids      synchronised_slave_pids exclusive_consumer_pid  exclusive_consumer_tag  messages_ready  messages_unacknowledged messages        consumers       memory  backing_queue_status
<rabbit at ajtrafp063.1.23424.903> b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  false   true    [{"x-message-ttl",45000}]       <rabbit at ajtrafp063.1.23419.903>                                 0       0       0       1       22976   [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,12503849}, {persistent_count,0}, {avg_ingress_rate,1249.1263854803442}, {avg_egress_rate,1249.1263854803442}, {avg_ack_ingress_rate,1249.1263854803442}, {avg_ack_egress_rate,1249.1263854803442}]
<rabbit at ajtrafp064.3.17607.445> b2bserverajtrafd016.si.atl01.locn.s.nokia.com   false   true    [{"x-message-ttl",45000}]       <rabbit at ajtrafp064.3.17602.445>                                 0       0       0       1       23520   [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,7406606}, {persistent_count,0}, {avg_ingress_rate,111.79187855499954}, {avg_egress_rate,111.79187855499954}, {avg_ack_ingress_rate,111.79187855499954}, {avg_ack_egress_rate,111.79187855499954}]
<rabbit at ajtrafp063.1.259.0>     Something       true    false   [{"x-message-ttl",30000}]                                               19262   0       19262   0       47743560        [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,19262}, {len,19262}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,19262}, {ram_ack_count,0}, {next_seq_id,953725980}, {persistent_count,19262}, {avg_ingress_rate,934.2094154568135}, {avg_egress_rate,0.0}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at ajtrafp064.3.17620.445> b2bserverajtrafd015.si.atl01.locn.s.nokia.com   false   true    [{"x-message-ttl",45000}]       <rabbit at ajtrafp064.3.17615.445>                                 0       0       0       1       22912   [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,10065113}, {persistent_count,0}, {avg_ingress_rate,154.37923364290802}, {avg_egress_rate,154.37923364290802}, {avg_ack_ingress_rate,154.37923364290802}, {avg_ack_egress_rate,154.37923364290802}]

Exchanges on /:
name    type    durable auto_delete     internal        arguments
amq.direct      direct  true    false   false   []
products        topic   true    false   false   []
amq.topic       topic   true    false   false   []
clusterStatus   topic   true    false   false   []
amq.rabbitmq.trace      topic   true    false   false   []
flowData        topic   true    false   false   []
amq.rabbitmq.log        topic   true    false   false   []
amq.fanout      fanout  true    false   false   []
amq.headers     headers true    false   false   []
        direct  true    false   false   []
amq.match       headers true    false   false   []

Bindings on /:
source_name     source_kind     destination_name        destination_kind        routing_key     arguments
        exchange        Something       queue   Something       []
        exchange        b2bserverajtrafd015.si.atl01.locn.s.nokia.com   queue   b2bserverajtrafd015.si.atl01.locn.s.nokia.com   []
        exchange        b2bserverajtrafd016.si.atl01.locn.s.nokia.com   queue   b2bserverajtrafd016.si.atl01.locn.s.nokia.com   []
        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  []
flowData        exchange        Something       queue   #       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.018.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.105.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.106.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.107.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.242.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.305.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.336.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.409.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.501.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.601.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.617.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.701.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.817.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.842.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.909.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.A01.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.C07.*       []
flowData        exchange        b2bserverajtrafd015.si.atl01.locn.s.nokia.com   queue   1_0.D01.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.D01.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.E17.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.E33.*       []
flowData        exchange        b2bserverajtrafd016.si.atl01.locn.s.nokia.com   queue   1_0.F32.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.F32.*       []
flowData        exchange        b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  queue   1_0.F49.*       []

Consumers on /:
queue_name      channel_pid     consumer_tag    ack_required
b2bserveratlvmtrafd008.dv.atl.locn.s.nokia.com  <rabbit at ajtrafp063.1.23423.903> amq.ctag-QAPE8DIK-g54ofPr2ioHtj true
b2bserverajtrafd016.si.atl01.locn.s.nokia.com   <rabbit at ajtrafp064.3.17611.445> amq.ctag-gQ8mSRj6kILAjSl9L6cLOE true
b2bserverajtrafd015.si.atl01.locn.s.nokia.com   <rabbit at ajtrafp064.3.17624.445> amq.ctag-AKCYDlYI6S0jhWNsHp9zu8 true

Permissions on /:
user    configure       write   read
guest   .*      .*      .*

End of server status report
...done.
[pkonar at ajtrafp063 ~]$


Thanks
Peter Konar
________________________________________
From: ext Matthias Radestock [matthias at rabbitmq.com]
Sent: Friday, February 08, 2013 12:13 PM
To: Carroll James (Nokia-LC/Malvern)
Cc: Konar Peter (Nokia-LC/Chicago); Discussions about RabbitMQ; Mccuiston Mitchell (Nokia-LC/Chicago); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Yu Jerry.3 (Nokia-LC/Alpharetta)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

On 08/02/13 17:59, Carroll James (Nokia-LC/Malvern) wrote:
> As far as where it's hanging on the client side: I don't have the
> exact rabbit call stack (I'll save off the jstack next time) but it's
> inside the amqp client code and inside of the native socketWrite
> call. Both the send buffer on the client side and the recv buffer on
> the server side are full. While the server is still maintaining the
> connection it's not reading from the socket. Since the client is
> written in terms of blocking java.io, the client hangs waiting for
> the server to read the data.

Hmmm, in which case please post the output of 'rabbitmqctl report' as well.

Peter posted some 'rabbitmqctl list_connections' output but
unfortunately that did not include the 'state' field so it's impossible
to tell whether the connections were being throttled at the time.

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.

From matthias at rabbitmq.com  Fri Feb  8 20:22:14 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 08 Feb 2013 20:22:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
Message-ID: <51155E76.5010307@rabbitmq.com>

Peter,

On 08/02/13 20:05, Konar Peter (Nokia-LC/Chicago) wrote:
> Jstack trace of the connection that is hung.
> [...]

I see. So it's indeed stuck in the socket write. For how long has it 
been like that?

> [pkonar at ajtrafp063 ~]$ sudo rabbitmqctl report
> Reporting server status on {{2013,2,8},{20,5,18}}
> [...]

That all looks fine.

Curiously all of the connections are in the 'running' state, which means 
they should be reading data from their sockets. Carroll said in his 
previous email that "the recv buffer on the server side [is] full.". 
What evidence do you have for that?

Regards,

Matthias.

From james.carroll at nokia.com  Fri Feb  8 21:31:16 2013
From: james.carroll at nokia.com (Carroll James (Nokia-LC/Malvern))
Date: Fri, 8 Feb 2013 15:31:16 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <51155E76.5010307@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
Message-ID: <D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>

You can see the amount of data in the buffers using netstat. Pete can you add a netstat for both the server and client side?

-----Original Message-----
From: ext Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Friday, February 08, 2013 3:22 PM
To: Konar Peter (Nokia-LC/Chicago)
Cc: Carroll James (Nokia-LC/Malvern); Discussions about RabbitMQ; Mccuiston Mitchell (Nokia-LC/Chicago); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Yu Jerry.3 (Nokia-LC/Alpharetta)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 08/02/13 20:05, Konar Peter (Nokia-LC/Chicago) wrote:
> Jstack trace of the connection that is hung.
> [...]

I see. So it's indeed stuck in the socket write. For how long has it been like that?

> [pkonar at ajtrafp063 ~]$ sudo rabbitmqctl report Reporting server status
> on {{2013,2,8},{20,5,18}} [...]

That all looks fine.

Curiously all of the connections are in the 'running' state, which means they should be reading data from their sockets. Carroll said in his previous email that "the recv buffer on the server side [is] full.".
What evidence do you have for that?

Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.

From jerryk at rbcon.com  Fri Feb  8 22:00:32 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 8 Feb 2013 14:00:32 -0800
Subject: [rabbitmq-discuss] Join_Cluster Question
In-Reply-To: <5113928E.7030109@comarch.pl>
References: <CAO=6ox_QwkgPdzVodocp-GtfGZy8iXXfqPx_aLMjJagiVsKPBg@mail.gmail.com>
	<5113928E.7030109@comarch.pl>
Message-ID: <CAE0Sz=znkb1bnHmyFsCGizCVA2uiR35HtPoESngVpE8b-sj6uQ@mail.gmail.com>

I've frequently been pantsed about node names when connecting from places
like public libraries where I get a surprise DHCP assigned hostname that
disagrees with the "real" one that Rabbit and Erlang compose into my
'rabbit at mylaptopsrealname' nodename.

Sticking mylaptopsrealname into /etc/hosts explicitly usually banishes the
problem for me.

On Thu, Feb 7, 2013 at 3:39 AM, Ernest Staszuk <ernest.staszuk at comarch.pl>wrote:

>  You could try to prepare special entries in your systems hosts file,
> that worked for me.
>
> I don't remember if these entries had to be actual hostname for remote
> machine or could be faked.
>
> Best regards,
> Ernest Staszuk
>
>
> On 02/07/2013 04:53 AM, Richard Raseley wrote:
>
> When creating a cluster using "rabbitmqctl join_cluster rabbit at hostname"
> can you use an IP address or FQDN instead of a hostname after the @?
>
> I am not sure if my issues is being caused by lack of name resolution or a
> malformed command and the documentation (found here:
> http://www.rabbitmq.com/man/rabbitmqctl.1.man.html) didn't seem to
> specify what a valid value was.
>
>  Thank you in advance.
>
>  Regards,
>
>  Richard
>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130208/d4ba654e/attachment.htm>

From gmr at meetme.com  Sat Feb  9 13:48:14 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Sat, 9 Feb 2013 08:48:14 -0500
Subject: [rabbitmq-discuss] [rabbitmql] pika throw exception following
	the Toturials
In-Reply-To: <CAPKora-fDXTx6OVj54krmDiypz44UntPDWeJvyxd3LsRd19Y0g@mail.gmail.com>
References: <CAPKora-fDXTx6OVj54krmDiypz44UntPDWeJvyxd3LsRd19Y0g@mail.gmail.com>
Message-ID: <CAKwdTWfL0ZrBgj7=j5oqHRN+fKZ9DJCRWa-1QDrYxTjTS3YGxA@mail.gmail.com>

Hi there. You are receiving an AMQPConnectionError when connecting to
RabbitMQ. This indicates that RabbitMQ is not running or one or more of the
following parameters are incorrect: host, port, virtual host, username or
password.

On Wednesday, February 6, 2013, Qinglong.Meng wrote:

>
> Hi,
>     When I following the Totuials 'Hello World!', and I use pika==0.9.8, I
> got  pika excetion:
>     pika.exceptions.AMQPConnectionError: (0, '')
> File "/root/workspace/rabbitmq/01sample/011publisher.py", line 19, in
> <module>
>   conn =
> pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py",
> line 61, in __init__
>   super(BaseConnection, self).__init__(parameters, on_open_callback)
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/connection.py",
> line 513, in __init__
>   self._connect()
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/connection.py",
> line 804, in _connect
>   self._adapter_connect()
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
> line 146, in _adapter_connect
>   self.process_data_events()
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
> line 88, in process_data_events
>   if self._handle_read():
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
> line 184, in _handle_read
>   super(BlockingConnection, self)._handle_read()
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py",
> line 300, in _handle_read
>   return self._handle_error(error)
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py",
> line 264, in _handle_error
>   self._handle_disconnect()
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
> line 181, in _handle_disconnect
>   self._on_connection_closed(None, True)
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
> line 235, in _on_connection_closed
>   raise exceptions.AMQPConnectionError(*self.closing)
>
> Can anybody help me..
>
> Tks very much
> Best Regards,
>
> --
>
> Lawrency Meng
> mail: mengql112233 at gmail.com <javascript:_e({}, 'cvml',
> 'mengql112233 at gmail.com');>
> _______________________________________________
> Mailing list: https://launchpad.net/~openstack
> Post to     : openstack at lists.launchpad.net <javascript:_e({}, 'cvml',
> 'openstack at lists.launchpad.net');>
> Unsubscribe : https://launchpad.net/~openstack
> More help   : https://help.launchpad.net/ListHelp
>


-- 

Gavin M. Roy
Chief Technology Officer

<http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130209/ac578301/attachment.htm>

From lars.ellebo at schneider-electric.com  Sat Feb  9 16:39:58 2013
From: lars.ellebo at schneider-electric.com (lars.ellebo at schneider-electric.com)
Date: Sat, 9 Feb 2013 17:39:58 +0100
Subject: [rabbitmq-discuss] Lars Ellebo is out of the office.
Message-ID: <OF973ED8F8.588A3E0C-ONC1257B0D.005B8CD8-C1257B0D.005B8CD8@schneider-electric.com>


I will be out of the office starting  09-02-2013 and will not return until
18-02-2013.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130209/8adfd2fb/attachment.htm>

From russa.nayak at tcs.com  Mon Feb 11 05:57:36 2013
From: russa.nayak at tcs.com (Russa Nayak/TVM/TCS)
Date: Mon, 11 Feb 2013 11:27:36 +0530 (IST)
Subject: [rabbitmq-discuss] [rabbitmql] pika throw exception
	following	the Toturials
In-Reply-To: <CAKwdTWfL0ZrBgj7=j5oqHRN+fKZ9DJCRWa-1QDrYxTjTS3YGxA@mail.gmail.com>
Message-ID: <f8b7e808-d0c8-425a-b642-dda03e8d0380@01HW125807>

Reply

Hello,

It seems you are facing a AMQP Connection Error while connectinfg to RabbitMQ. The parameters passes like end uri(hostname +port address), username and password may be incorrect. It also can be the case that the RabbitMQ server itself is not running or installed incorrect.

Thanks and Regards,
Russa Nayak
Systems Engineer
Tata Consultancy Services
Mailto: russa.nayak at tcs.com
Website: http://www.tcs.com

----- Original Message -----
On Wednesday, February 6, 2013, Qinglong.Meng wrote: 



Hi, 
When I following the Totuials 'Hello World!', and I use pika==0.9.8, I got pika excetion: 
pika.exceptions.AMQPConnectionError: (0, '') 
File "/root/workspace/rabbitmq/01sample/011publisher.py", line 19, in <module> 
conn = pika.BlockingConnection(pika.ConnectionParameters(host='localhost')) 
File "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py", line 61, in __init__ 
super(BaseConnection, self).__init__(parameters, on_open_callback) 
File "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/connection.py", line 513, in __init__ 
self._connect() 
File "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/connection.py", line 804, in _connect 
self._adapter_connect() 
File "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py", line 146, in _adapter_connect 
self.process_data_events() 
File "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py", line 88, in process_data_events 
if self._handle_read(): 
File "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py", line 184, in _handle_read 
super(BlockingConnection, self)._handle_read() 
File "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py", line 300, in _handle_read 
return self._handle_error(error) 
File "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py", line 264, in _handle_error 
self._handle_disconnect() 
File "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py", line 181, in _handle_disconnect 
self._on_connection_closed(None, True) 
File "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py", line 235, in _on_connection_closed 
raise exceptions.AMQPConnectionError(*self.closing) 


Can anybody help me.. 


Tks very much 
Best Regards, 

-- 




Lawrency Meng 
mail: mengql112233 at gmail.com _______________________________________________ 
Mailing list: https://launchpad.net/~openstack 
Post to : openstack at lists.launchpad.net 
Unsubscribe : https://launchpad.net/~openstack 
More help : https://help.launchpad.net/ListHelp 


-- 


Gavin M. Roy 
Chief Technology Officer 



100 Union Square Drive 
New Hope, PA 18938 
p. +1.215.862.1162 x263 
f. +1.215.862.0465 





The public market leader in social discovery. (NYSE MKT: MEET) 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you



From root at simply.name  Mon Feb 11 07:52:53 2013
From: root at simply.name (=?koi8-r?B?4s/Sz8TJziD3zMHEyc3J0g==?=)
Date: Mon, 11 Feb 2013 11:52:53 +0400
Subject: [rabbitmq-discuss] Node failure for a mirrored queue
Message-ID: <82BDD45F-5EF0-4F07-93F0-A3CA1D66B45E@simply.name>

Hi all.

I'm testing mirrored queues in v. 3.0.1. If I stop node with 'rabbitmqctl stop_app', clients and other nodes behave normally (clients reconnect to other nodes because of a tcp balancer and other nodes continue to serve the queue). But if I close one node from others with iptables or kill it with Alt+SysRq+b, the cluster stops working for a long period of time. Is there any kind of a timeout, after which the node is considered to be dead by others? It does not depend on which node I kill - the primary or one of the slaves. There are 3 nodes in a cluster, the queue is mirrored by a policy like that '/	HA	^(?!amq\\.).*	{"ha-mode":"all"}	0'.
If I should give extra info for understanding of a problem, tell me, please. Thanks.

--
Vladimir


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130211/88f939bb/attachment.htm>

From watson.timothy at gmail.com  Mon Feb 11 08:49:14 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 11 Feb 2013 08:49:14 +0000
Subject: [rabbitmq-discuss] Node failure for a mirrored queue
In-Reply-To: <82BDD45F-5EF0-4F07-93F0-A3CA1D66B45E@simply.name>
References: <82BDD45F-5EF0-4F07-93F0-A3CA1D66B45E@simply.name>
Message-ID: <0986C2B1-A4ED-4DAE-870A-8FAE124767F0@rabbitmq.com>

Hi Vladimir,

On 11 Feb 2013, at 07:52, ??????? ???????? wrote:

> Hi all.
> 
> I'm testing mirrored queues in v. 3.0.1. If I stop node with 'rabbitmqctl stop_app', clients and other nodes behave normally (clients reconnect to other nodes because of a tcp balancer and other nodes continue to serve the queue). But if I close one node from others with iptables or kill it with Alt+SysRq+b, the cluster stops working for a long period of time.

What exactly stops working? The whole cluster, all queues/exchanges are inaccessible? Or just this particular mirrored queue? 

> Is there any kind of a timeout, after which the node is considered to be dead by others?

No, although the os networking stack can take a while to notice peers are gone. Erlang does have a kind of heartbeat mechanism though, which should notice in a fairly timely fashion that another node has gone away. How long does the 'long period of time' last exactly?

> It does not depend on which node I kill - the primary or one of the slaves. There are 3 nodes in a cluster, the queue is mirrored by a policy like that '/	HA	^(?!amq\\.).*	{"ha-mode":"all"}	0'.
> If I should give extra info for understanding of a problem, tell me, please. Thanks.
> 
> --
> Vladimir
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From root at simply.name  Mon Feb 11 10:00:14 2013
From: root at simply.name (=?koi8-r?B?4s/Sz8TJziD3zMHEyc3J0g==?=)
Date: Mon, 11 Feb 2013 14:00:14 +0400
Subject: [rabbitmq-discuss] Node failure for a mirrored queue
In-Reply-To: <0986C2B1-A4ED-4DAE-870A-8FAE124767F0@rabbitmq.com>
References: <82BDD45F-5EF0-4F07-93F0-A3CA1D66B45E@simply.name>
	<0986C2B1-A4ED-4DAE-870A-8FAE124767F0@rabbitmq.com>
Message-ID: <8944BD4D-1C14-441B-80E6-019B9511F316@simply.name>


11.02.2013, ? 12:49, Tim Watson <watson.timothy at gmail.com> ???????(?):

> Hi Vladimir,
> 
> On 11 Feb 2013, at 07:52, ??????? ???????? wrote:
> 
>> Hi all.
>> 
>> I'm testing mirrored queues in v. 3.0.1. If I stop node with 'rabbitmqctl stop_app', clients and other nodes behave normally (clients reconnect to other nodes because of a tcp balancer and other nodes continue to serve the queue). But if I close one node from others with iptables or kill it with Alt+SysRq+b, the cluster stops working for a long period of time.
> 
> What exactly stops working? The whole cluster, all queues/exchanges are inaccessible? Or just this particular mirrored queue? 

Producers can't put messages in queue, consumers can't take them from queue. I can not even see the result of running 'rabbitmqctl list_queues' or 'rabbitmqctl cluster_status'.

> 
>> Is there any kind of a timeout, after which the node is considered to be dead by others?
> 
> No, although the os networking stack can take a while to notice peers are gone. Erlang does have a kind of heartbeat mechanism though, which should notice in a fairly timely fashion that another node has gone away. How long does the 'long period of time' last exactly?

Long period means about a minute for seeing the death of a node. I don't think this is normal for heartbeat messages. I'm using RHEL6 with default sysctl timeouts. I can show appropriate kernel parameters if it can help.

In the master log I can see that in period of a bit more than a minute (~ 70 sec) master saw death of a mirror:
=ERROR REPORT==== 11-Feb-2013::13:07:11 ===
** Node rabbit at loadtest04g not responding **
** Removing (timedout) connection **

=INFO REPORT==== 11-Feb-2013::13:07:11 ===
rabbit on node rabbit at loadtest04g down

=INFO REPORT==== 11-Feb-2013::13:07:19 ===
Mirrored-queue (queue 'loadtest01g.domain.com.celery.pidbox' in vhost '/'): Master <rabbit at loadtest03g.1.10550.4> saw deaths of mirrors <rabbit at loadtest04g.2.28501.0>


And in the live slave log I see:
=INFO REPORT==== 11-Feb-2013::13:07:03 ===
rabbit on node rabbit at loadtest04g down

=INFO REPORT==== 11-Feb-2013::13:07:19 ===
Mirrored-queue (queue 'celery' in vhost '/'): Slave <rabbit at loadtest05g.1.18027.0> saw deaths of mirrors <rabbit at loadtest04g.2.28499.0>

The clients are actually using queue with name 'celery'.

So I suppose there are two problems:
1. the timeout tuned by the kernel parameters of erlang (this is better) or OS (this is a bit worse because it can affect other applications). Is there a way to make it smaller in erlang?
2. if the live nodes saw the death of killed node, why commands like 'rabbitmqctl cluster_status' don't work? I can understand if the queue does not work due to wrong policy for a queue, but it should not affect the whole cluster, should it?


> 
>> It does not depend on which node I kill - the primary or one of the slaves. There are 3 nodes in a cluster, the queue is mirrored by a policy like that '/	HA	^(?!amq\\.).*	{"ha-mode":"all"}	0'.
>> If I should give extra info for understanding of a problem, tell me, please. Thanks.
>> 
>> --
>> Vladimir
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--
Vladimir




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130211/aa42ee6d/attachment.htm>

From simon at rabbitmq.com  Mon Feb 11 10:22:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Feb 2013 10:22:13 +0000
Subject: [rabbitmq-discuss] Node failure for a mirrored queue
In-Reply-To: <8944BD4D-1C14-441B-80E6-019B9511F316@simply.name>
References: <82BDD45F-5EF0-4F07-93F0-A3CA1D66B45E@simply.name>
	<0986C2B1-A4ED-4DAE-870A-8FAE124767F0@rabbitmq.com>
	<8944BD4D-1C14-441B-80E6-019B9511F316@simply.name>
Message-ID: <5118C655.70706@rabbitmq.com>

On 11/02/13 10:00, ??????? ???????? wrote:
> So I suppose there are two problems:
> 1. the timeout tuned by the kernel parameters of erlang (this is better)
> or OS (this is a bit worse because it can affect other applications). Is
> there a way to make it smaller in erlang?

Yes, see http://www.rabbitmq.com/partitions.html

> 2. if the live nodes saw the death of killed node, why commands like
> 'rabbitmqctl cluster_status' don't work? I can understand if the queue
> does not work due to wrong policy for a queue, but it should not affect
> the whole cluster, should it?

They should work *after* the dead node has been detected. Until that 
point the cluster doesn't know it's dead and so just waits for it to 
report its status.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Feb 11 11:32:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 11 Feb 2013 11:32:30 +0000
Subject: [rabbitmq-discuss] Patches for the RabbitMQ Erlang client
In-Reply-To: <51110B7A.6020004@rabbitmq.com>
References: <CAGrdgiX6EB-zV-0BUs0tfwh_8YWwCura4HEu6OLxgDQz_0dYTg@mail.gmail.com>
	<51110B7A.6020004@rabbitmq.com>
Message-ID: <5118D6CE.8070705@rabbitmq.com>

On 05/02/13 13:39, Emile Joubert wrote:
> Thanks for your contribution.
> 
> On 02/02/13 18:28, Jesper Louis Andersen wrote:
>> They fix some irritating complaints from the code
> 
> Can you provide any more information about what these complaints look
> like and explain how to provoke them?
> 
>> If you apply them, please give credit to their author, Vladimir Baranov,
>> who found them originally.
> 
> Would you or Vladimir be prepared to sign a contributor agreement in the
> event that your patches are accepted? Who should I send it to?


To conclude this thread: agreement was reached after further off-list
discussion, that the patches are not required. Some related improvements
were also suggested which we will look at, but there is no need for a
contributor agreement.



-Emile






From steve at rabbitmq.com  Mon Feb 11 11:33:40 2013
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 11 Feb 2013 11:33:40 +0000
Subject: [rabbitmq-discuss] Consumer Clients as Tomcat Web Applications
	and Work Queue Configuration
In-Reply-To: <CAC_yGURXNFrgJ6SM7vb5QjZn2m5GKBXgucUFvuQ4QodNzrz3yA@mail.gmail.com>
References: <CAC_yGURXNFrgJ6SM7vb5QjZn2m5GKBXgucUFvuQ4QodNzrz3yA@mail.gmail.com>
Message-ID: <AA959E8B-19A8-4628-A700-B98C15580135@rabbitmq.com>

Hi Kevin,

Sorry for the delayed response.

First, an observation about your original set-up:

> while (true) {
> 	QueueingConsumer.Delivery delivery = consumer.nextDelivery();
> 	String message = new String(delivery.getBody());
> 	System.out.println(" [x] Received '" + message + "'");
> }


I assume that there are no Qos (prefetch) limits imposed on the channels
these consumers use, and also I note that you are using the
QueueingConsumer. I think this means that all of the consumers are able
to receive the messages all the time, and so all messages will get
distributed in round-robin fashion, until there are no messages left to
deliver.

In your 'workaround' solution, you are indeed pulling, not being pushed,
and here all of the consumers will get a look-in: there is likely to be
balancing, but not round-robin. This is based instead upon consumer
request, so if one of them gets bogged down in work (initiated by the
previous message, for example) then the other consumers can poll and
take the next message, and, crucially, other messages won't be taken by
this consumer while it is busy. Although this isn't 'round-robin'
servicing, it is arguably better: the messages are not 'blindly' sent to
consumers that are busy.

The drawbacks are, as you note, an overhead of polling in the consumers,
and a larger latency on the network -- each get involves a round-trip to
the server, even when there is nothing to get.

Now to your questions:

>  ? Is it a bad idea to deploy consumers as Tomcat web applications? Are
> there any advantages or disadvantages as compared to the alternative of
> running system level Java clients?

I see no reason why, apart from the overhead implied by running a full
web application, there should be any particular disadvantages of running
a Tomcat web application that does messaging as its main work. In fact,
I suspect it is easier to control (start/stop) than using a
free-standing Java client: you can potentially build a sophisticated
web-based control mechanism. However, I'm not best placed to answer
this.

>  ? In the case of work queues, am I better off retrieving messages that
> are pushed down to my clients, and setting a prefetchCount
> (channel.basicQos(1)) to ensure that I only receive one message at a
> time?

This is the crux of the matter, as I see it. If you impose a prefetch
limit of 1 for each client you run, then the rabbit server will dispatch
messages to clients that have no unacknowledged messages (by the way,
you should explicitly acknowledge messages when using non-zero
basicQos()). Under these circumstances, you can achieve similar
balancing as in the polling case, but without the polling. It will *not*
be strictly round-robin after the first 'round' because the first
consumer need not have acknowledged the previous message yet, and
messages will be delivered to whatever consumers are ready for them --
albeit in round-robin priority.

The tutorial pages describe this pretty well (see [1]).

There are two points to note:

If you are using QueueingConsumer, then each message will be placed in a
client Java queue, and nextDelivery() then unblocks with the message
when it arrives. With explicit acknowledgements this means that one
message at a time is transferred to the Java queue. You could increase
the prefetchCount to 2, say, and then up to two messages would be placed
in the queue but you would still process them serially through the
nextDelivery() call. When one consumer gets two messages, then no other
consumer will get these -- so if a message can take a long time before
it is acknowledged, the message behind it can get delayed, even though
there may be other consumers which are idle. Other messages can
'overtake' and get processed before it.

If you want to avoid the QueueingConsumer internal Java queue, you could
write your own Consumer implementation (base it on DefaultConsumer) but
you should be aware that the handleDelivery() methods are driven
asynchronously, but serially. You shouldn't perform long pieces of work
on these threads. It would be wise to pass the message to some
serialised worker thread, especially if you have a prefetchCount larger
than one. This will probably then require a queue of your own anyway, so
the advantages to you are slim.

I hope this helps. Please let us know how you get on.

Steve Powell

[1] http://www.rabbitmq.com/tutorials/tutorial-two-java.html

[M: +44-7815-838-558; H:+44-1962-775-598]
SpringSource (a division of VMware), Virgo, RabbitMQ.
-----------------------------------------------------------------------
Good design:
   is innovative, useful, aesthetic;
   is understandable, unobtrusive, honest;
   is long-lasting, thorough, environmentally friendly;
   and is as little design as possible.
Copyright Dieter Rams, amended March 2003; October 2009; and August 2012

On 31 Jan 2013, at 01:33, Kevin Behr <behrk2 at gmail.com> wrote:
> Hello everyone,
> 
> I have five RabbitMQ consumer clients that are written and deployed as Tomcat web applications.  My original intention was to consume messages in the typical fashion:
?(elided)
> I would appreciate any advice or suggestions.
> 
> Thanks!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Mon Feb 11 18:52:41 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 11 Feb 2013 10:52:41 -0800
Subject: [rabbitmq-discuss] Can 3.0.2 management port listen on port 55672?
Message-ID: <CACLE7iwGW5ttfUSUejFogXTyoPdigYg5k+db2oV-2fwSg+r3Uw@mail.gmail.com>

First off, let me state that I know that in RabbitMQ 3, the management port
# changes (by default) to 15672. In addition, I realize why this is a good
thing.

That said... Should it be possible to configure the management port in
3.0.2 to use port 55672? I ask because someone on our team didn't update
his configuration and tried to run 3.0.2, where his rabbitmq.config file
explicitly said to use 55672. The broker was unable to start and we saw
this in the log:

   {could_not_start,rabbitmq_management,
       {incompatible_listeners,
           {"RabbitMQ Management",[{port,55672}]},
           {"Redirect to port 55672",[{port,55672},{ignore_in_use,true}]}}}


I assume that this message indicates it doesn't want two things running on
55672 (the management port, and the redirect from 55672 to 15672). The
question is, is it intended that Rabbit work with 55672 if you explicitly
specify it?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130211/d325bda5/attachment.htm>

From alex.dev.r at gmail.com  Mon Feb 11 11:41:52 2013
From: alex.dev.r at gmail.com (Alex)
Date: Mon, 11 Feb 2013 03:41:52 -0800 (PST)
Subject: [rabbitmq-discuss] newbie question: message with delay
Message-ID: <cf8df2a1-4511-4138-a4c8-ed9fd5a0eb4c@googlegroups.com>

Hi!

I'm just getting into all this messaging systems. I'm wondering if it's 
possible to send message which will be processed after 24 hours from the 
current moment. Is there way to delay message processing? 
I didn't found RabbitMQ documentation or mailing topic regarding this.

Alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130211/b151d82a/attachment.htm>

From michael.s.klishin at gmail.com  Mon Feb 11 19:12:02 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 11 Feb 2013 23:12:02 +0400
Subject: [rabbitmq-discuss] Can 3.0.2 management port listen on port
	55672?
In-Reply-To: <CACLE7iwGW5ttfUSUejFogXTyoPdigYg5k+db2oV-2fwSg+r3Uw@mail.gmail.com>
References: <CACLE7iwGW5ttfUSUejFogXTyoPdigYg5k+db2oV-2fwSg+r3Uw@mail.gmail.com>
Message-ID: <CAE3HoVRpugWsw81JjWv1NSZNZPQox2ebjTH06GWZGG715py3LA@mail.gmail.com>

2013/2/11 Matt Pietrek <mpietrek at skytap.com>

> I assume that this message indicates it doesn't want two things running on
> 55672 (the management port, and the redirect from 55672 to 15672). The
> question is, is it intended that Rabbit work with 55672 if you explicitly
> specify it?


I believe RabbitMQ 3.0 redirects requests to port 55672 to 15672. Maybe
that's the issue, the port is already taken?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130211/eaa3b59c/attachment.htm>

From simon at rabbitmq.com  Mon Feb 11 20:00:50 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Feb 2013 20:00:50 +0000
Subject: [rabbitmq-discuss] Can 3.0.2 management port listen on port
	55672?
In-Reply-To: <CACLE7iwGW5ttfUSUejFogXTyoPdigYg5k+db2oV-2fwSg+r3Uw@mail.gmail.com>
References: <CACLE7iwGW5ttfUSUejFogXTyoPdigYg5k+db2oV-2fwSg+r3Uw@mail.gmail.com>
Message-ID: <51194DF2.1010705@rabbitmq.com>

On 11/02/2013 6:52PM, Matt Pietrek wrote:
> I assume that this message indicates it doesn't want two things running
> on 55672 (the management port, and the redirect from 55672 to 15672).
> The question is, is it intended that Rabbit work with 55672 if you
> explicitly specify it?

Yes, but a tweak is needed:

{rabbitmq_management, [{listener,          [{port, 55672}]},
                        {redirect_old_port, false}]}

Cheers, Simon

From tobias at wissmueller.net  Mon Feb 11 19:19:21 2013
From: tobias at wissmueller.net (Tobias Wissmueller)
Date: Mon, 11 Feb 2013 20:19:21 +0100
Subject: [rabbitmq-discuss] Problem installing RabbitMQ with Puppet on
 CentOS 6.2
In-Reply-To: <510B9981.3030803@rabbitmq.com>
References: <5a61a2fa-495c-49dd-8345-d6a591ea2832@googlegroups.com>
	<506EAC55.7040003@rabbitmq.com>
	<CAJreXKCEDVDY+6-U3uJHSq8HA02TJewGEvP4pJyz3gwHqBnrCA@mail.gmail.com>
	<510B9981.3030803@rabbitmq.com>
Message-ID: <CALUyBD2Ny2oeDj_UUYaGzRw__6X4Qr77ZniTzDQwCqH55Tm5tQ@mail.gmail.com>

Hi Simon and James,

first, my apologies for not responding for so long.

That is correct, the answer can be found on the link on serverfault.com you
mentioned. That actually did the trick.

I have also written about everything in a blog post, you can find it here:
http://bit.ly/Mb0D0v

Cheers and all the best,
Tobi


On Fri, Feb 1, 2013 at 11:31 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Ah, thanks for the pointer.
>
> Hmm, maybe we should explicitly set HOME in these scripts...
>
> Cheers, Simon
>
>
> On 01/02/13 07:24, James Carr wrote:
>
>> I thought I'd point out the original author solved his problems:
>> http://serverfault.com/**questions/434942/veewee-**
>> vagrant-puppet-erlang-and-**rabbitmq<http://serverfault.com/questions/434942/veewee-vagrant-puppet-erlang-and-rabbitmq>
>>
>> Only posting this on the list to help others who come across it as I
>> had the exact same problem this evening. :)
>>
>>
>> Thanks,
>> James
>>
>>
>> On Fri, Oct 5, 2012 at 4:45 AM, Simon MacMullen <simon at rabbitmq.com>
>> wrote:
>>
>>> Hmm. There's nothing very obvious that I can think of. I've looked in the
>>> OTP source and that message really only appears if HOME is not set.
>>>
>>> Things you might try:
>>>
>>> * Run /usr/lib/rabbitmq/bin/**rabbitmq-plugins instead, to remove a
>>> wrapper
>>> script
>>>
>>> * Edit /usr/lib/rabbitmq/bin/**rabbitmq-plugins to insert "echo $HOME"
>>> just
>>> before "exec erl", see if it's really set at that point.
>>>
>>> * If all else fails, edit the enabled plugins file directly rather than
>>> invoking rabbitmq-plugins. Set the contents of
>>> /etc/rabbitmq/enabled_plugins
>>> to exactly the string:
>>>
>>> [rabbitmq_management].
>>>
>>> including the full stop.
>>>
>>> Cheers, Simon
>>>
>>>
>>> On 05/10/12 07:05, Tobias Wissm?ller wrote:
>>>
>>>>
>>>> Hi Everyone,
>>>>
>>>> I encounter a strange problem when applying my puppet module I have
>>>> created for installing RabbitMQ. To be more precise, I encounter the
>>>> problem when enabling the plugins.
>>>>
>>>> The relevant resources look as follows:
>>>>
>>>> |$version = "2.8.7"
>>>> $url     =
>>>> "http://www.rabbitmq.com/**releases/rabbitmq-server/v${**
>>>> version}/rabbitmq-server-${**version}-1.noarch.rpm<http://www.rabbitmq.com/releases/rabbitmq-server/v$%7Bversion%7D/rabbitmq-server-$%7Bversion%7D-1.noarch.rpm>
>>>> "
>>>>
>>>> package{"erlang":
>>>>       ensure => "present",
>>>> }
>>>>
>>>> package{"rabbitmq-server":
>>>>       provider => "rpm",
>>>>       source   => $url,
>>>>       require  => Package["erlang"]
>>>> }
>>>>
>>>> exec{"rabbitmq-plugins":
>>>>       path    => "/usr/bin:/usr/sbin:/bin",
>>>>       command => "rabbitmq-plugins enable rabbitmq_management",
>>>>       require => Package["rabbitmq-server"]
>>>> }|
>>>>
>>>>
>>>> The error I get:
>>>>
>>>> |/Stage[main]/Rabbitmq/Exec[**rabbitmq-plugins]/returns: erlexec: HOME
>>>> must
>>>> be set|
>>>>
>>>> |/Stage[main]/Rabbitmq/**Service[rabbitmq-server]: Dependency
>>>> Exec[rabbitmq-plugins] has failures: true
>>>> |
>>>>
>>>> The thing is, that HOME is set. Have checked that during a puppet run by
>>>> creating an exec resource to echo HOME.
>>>>
>>>> When I log into the box that I create with veewee and vagrant, I can
>>>> execute "rabbitmq-plugins enable rabbitmq_management" without any
>>>> problems. But I always get the error from within puppet.
>>>>
>>>> Starting rabbitmq-server leaves me with the following:
>>>>
>>>> |[{pid,2834},
>>>> {running_applications,[{**rabbit,"RabbitMQ","2.8.7"},
>>>>                       {ssl,"Erlang/OTP SSL application","4.1.6"},
>>>>                       {public_key,"Public key infrastructure","0.13"},
>>>>                       {crypto,"CRYPTO version 2","2.0.4"},
>>>>                       {mnesia,"MNESIA  CXC 138 12","4.5"},
>>>>                       {os_mon,"CPO  CXC 138 46","2.2.7"},
>>>>                       {sasl,"SASL  CXC 138 11","2.1.10"},
>>>>                       {stdlib,"ERTS  CXC 138 10","1.17.5"},
>>>>                       {kernel,"ERTS  CXC 138 10","2.14.5"}]},
>>>> {os,{unix,linux}},
>>>> {erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1]
>>>> [async-threads:30] [kernel-poll:true]\n"},
>>>> {memory,[{total,24993120},
>>>>         {processes,10328496},
>>>>         {processes_used,10321296},
>>>>         {system,14664624},
>>>>         {atom,1175905},
>>>>         {atom_used,1143841},
>>>>         {binary,17192},
>>>>         {code,11416020},
>>>>         {ets,766168}]},
>>>> {vm_memory_high_watermark,0.4}**,
>>>> {vm_memory_limit,205851852},
>>>> {disk_free_limit,1000000000},
>>>> {disk_free,7089795072},
>>>> {file_descriptors,[{total_**limit,924},
>>>>                   {total_used,4},
>>>>                   {sockets_limit,829},
>>>>                   {sockets_used,2}]},
>>>> {processes,[{limit,1048576},{**used,131}]},
>>>> {run_queue,0},
>>>> {uptime,6}]|
>>>>
>>>>
>>>> The whole puppet manifest can be found under
>>>>
>>>> https://github.com/tobias-**wissmueller/dev_ops_central/**
>>>> blob/master/modules/rabbitmq/**manifests/init.pp<https://github.com/tobias-wissmueller/dev_ops_central/blob/master/modules/rabbitmq/manifests/init.pp>
>>>>
>>>> Also have posted this problem over at Serverfault
>>>>
>>>> <http://serverfault.com/**questions/434942/veewee-**
>>>> vagrant-puppet-erlang-and-**rabbitmq<http://serverfault.com/questions/434942/veewee-vagrant-puppet-erlang-and-rabbitmq>
>>>> >.
>>>>
>>>>
>>>> Any help is highly appreciated since I am totally stuck here.
>>>>
>>>> Thanks a lot!
>>>>
>>>> Cheers,
>>>> Tobi
>>>>
>>>>
>>>> ______________________________**_________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>>>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>>
>>>>
>>>
>>> --
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>> ______________________________**_________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130211/abf2f852/attachment.htm>

From peter.konar at nokia.com  Mon Feb 11 21:44:56 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Mon, 11 Feb 2013 15:44:56 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>

I have upgraded client and server to 3.0.2 to get heartbeats. I will get you a "netstat -an" output as soon as we can get this to fail.

Peter Konar

-----Original Message-----
From: Carroll James (Nokia-LC/Malvern)
Sent: Friday, February 08, 2013 3:31 PM
To: ext Matthias Radestock; Konar Peter (Nokia-LC/Chicago)
Cc: Discussions about RabbitMQ; Mccuiston Mitchell (Nokia-LC/Chicago); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Yu Jerry.3 (Nokia-LC/Alpharetta)
Subject: RE: [rabbitmq-discuss] RabbitMQ blocking issue

You can see the amount of data in the buffers using netstat. Pete can you add a netstat for both the server and client side?

-----Original Message-----
From: ext Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Friday, February 08, 2013 3:22 PM
To: Konar Peter (Nokia-LC/Chicago)
Cc: Carroll James (Nokia-LC/Malvern); Discussions about RabbitMQ; Mccuiston Mitchell (Nokia-LC/Chicago); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Yu Jerry.3 (Nokia-LC/Alpharetta)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 08/02/13 20:05, Konar Peter (Nokia-LC/Chicago) wrote:
> Jstack trace of the connection that is hung.
> [...]

I see. So it's indeed stuck in the socket write. For how long has it been like that?

> [pkonar at ajtrafp063 ~]$ sudo rabbitmqctl report Reporting server status
> on {{2013,2,8},{20,5,18}} [...]

That all looks fine.

Curiously all of the connections are in the 'running' state, which means they should be reading data from their sockets. Carroll said in his previous email that "the recv buffer on the server side [is] full.".
What evidence do you have for that?

Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.

From matthias at rabbitmq.com  Mon Feb 11 21:58:48 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 11 Feb 2013 21:58:48 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>
Message-ID: <51196998.8080103@rabbitmq.com>

Peter,

On 11/02/13 21:44, Konar Peter (Nokia-LC/Chicago) wrote:
> I have upgraded client and server to 3.0.2 to get heartbeats.

Great, that will make it easier to track down any problem you may see. 
More generally though note that heartbeats can be enabled in older 
clients; all that changed in 3.0.x is that the server now by default 
suggests that heartbeats should be enabled.

> I will get you a "netstat -an" output as soon as we can get this to
> fail.

A snapshot of
- client stacktrace
- server 'rabbitmqctl report' output
- client and server 'netstat -an' output
would be ideal.

Regards,

Matthias.

From tim at rabbitmq.com  Mon Feb 11 23:06:29 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 11 Feb 2013 23:06:29 +0000
Subject: [rabbitmq-discuss] newbie question: message with delay
In-Reply-To: <cf8df2a1-4511-4138-a4c8-ed9fd5a0eb4c@googlegroups.com>
References: <cf8df2a1-4511-4138-a4c8-ed9fd5a0eb4c@googlegroups.com>
Message-ID: <8354EE20-DEA6-4380-B4A5-03A796FC7723@rabbitmq.com>

Hi Alex,

On 11 Feb 2013, at 11:41, Alex wrote:
> Hi!
> 
> I'm just getting into all this messaging systems. I'm wondering if it's possible to send message which will be processed after 24 hours from the current moment. Is there way to delay message processing? 
> I didn't found RabbitMQ documentation or mailing topic regarding this.
> 

Well you could put it in the queue and schedule the consumer to come online and dequeue it every 24 hours. If you really want to make the broker do this for you, then set up a queue with a per-message TTL of 24 hours. Put your messages into this queue and 24 hours after they were enqueued they will be removed. If you also set up a dead letter exchange then the 'expired' message will be dead lettered instead of deleted. You can bind another queue to the dead letter exchange and use this to consume messages that are 'ready' to be processed.

See http://www.rabbitmq.com/ttl.html and http://www.rabbitmq.com/dlx.html.

You should note, however, that the 24 hour thing will apply to *each message* and as I said the time will start from the moment the message is enqueued. So if you want to put 3 jobs in the queue and process them after 24, 48, 72 hrs, then this mechanism won't work for you. Personally I'd be more inclined to mark the messages as persistent and put them into a queue, then trigger the consumer to come online periodically using cron or if the consumer is long lived, using some programatic library.

Cheers,
Tim


From puzza007 at gmail.com  Mon Feb 11 23:22:36 2013
From: puzza007 at gmail.com (Paul Oliver)
Date: Mon, 11 Feb 2013 15:22:36 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq erlang client error:
	inet_address_preference
In-Reply-To: <9793a9f4-a98a-4fce-93c6-be5cc3005ac9@googlegroups.com>
References: <9793a9f4-a98a-4fce-93c6-be5cc3005ac9@googlegroups.com>
Message-ID: <3e9535ee-68c7-41a3-84f1-3bacf26d3cc4@googlegroups.com>

Hi Mike,

I just ran into the same thing when using the rebar friendly fork of the 
erlang client.  I opened a pull request with a fix 
here https://github.com/jbrisbin/amqp_client/pull/9.

Cheers,
Paul.

On Sunday, January 20, 2013 6:19:22 PM UTC-5, Mike Bridge wrote:
>
> I'm new to rabbitmq and fairly new to erlang....  I'm trying 
> unsuccessfully to get the erlang client (3.0.1) working.  Any idea what 
> this error means?
>
> 2>  amqp_connection:start(#amqp_params_network{host="localhost", 
> username="mike", password="*****"}).
>
>
> =ERROR REPORT==== 20-Jan-2013::16:04:55 ===
> ** Generic server <0.132.0> terminating 
> ** Last message in was connect
> ** When Server state == {state,amqp_network_connection,
>                             {state,undefined,undefined,undefined,undefined,
>                                 undefined,false},
>                             <0.131.0>,undefined,
>                             {amqp_params_network,"mike","*****",<<"/">>,
>                                 "localhost",5672,0,0,0,infinity,none,
>                                 [#Fun<amqp_auth_mechanisms.plain.3>,
>                                  #Fun<amqp_auth_mechanisms.amqplain.3>],
>                                 [],[]},
>                             undefined,undefined,
>                             #Fun<amqp_connection_sup.0.55585968>,
>                             #Fun<amqp_connection_sup.2.55585968>,false}
> ** Reason for termination == 
> ** {{case_clause,undefined},
>     [{amqp_network_connection,inet_address_preference,0,
>                               [{file,"src/amqp_network_connection.erl"},
>                                {line,154}]},
>      {amqp_network_connection,gethostaddr,1,
>                               [{file,"src/amqp_network_connection.erl"},
>                                {line,161}]},
>      {amqp_network_connection,connect,4,
>                               [{file,"src/amqp_network_connection.erl"},
>                                {line,110}]},
>      {amqp_gen_connection,handle_call,3,
>                           
> [{file,"src/amqp_gen_connection.erl"},{line,177}]},
>      {gen_server,handle_msg,5,[{file,"gen_server.erl"},{line,588}]},
>      {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
> ** exception exit: {{{case_clause,undefined},
>                      [{amqp_network_connection,inet_address_preference,0,
>                           [{file,"src/amqp_network_connection.erl"},
>                            {line,154}]},
>                       {amqp_network_connection,gethostaddr,1,
>                           [{file,"src/amqp_network_connection.erl"},
>                            {line,161}]},
>                       {amqp_network_connection,connect,4,
>                           [{file,"src/amqp_network_connection.erl"},
>                            {line,110}]},
>                       {amqp_gen_connection,handle_call,3,
>                           
> [{file,"src/amqp_gen_connection.erl"},{line,177}]},
>                       {gen_server,handle_msg,5,
>                           [{file,"gen_server.erl"},{line,588}]},
>                       {proc_lib,init_p_do_apply,3,
>                           [{file,"proc_lib.erl"},{line,227}]}]},
>                     {gen_server,call,[<0.132.0>,connect,infinity]}}
>      in function  gen_server:call/3 (gen_server.erl, line 188)
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130211/f4f0f921/attachment.htm>

From mpietrek at skytap.com  Tue Feb 12 02:13:04 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 11 Feb 2013 18:13:04 -0800
Subject: [rabbitmq-discuss] Setting the local-nodename parameter value via
	HTTP?
Message-ID: <CACLE7iy1=tnJv-N8eDFNGFpHvHvKAKePSpwHYjNzi1vB52m1-w@mail.gmail.com>

I'm looking for an example of exactly what needs to be passed to the
RabbitMQ 3.0.2 HTTP API to set the local-nodename value.

I can properly set federation-upstreams, so I feel like I'm close. I'm just
not sure (and can't seem to find any exact documentation) on what the body
and URL strings are supposed to be.

I've tried all sorts of permutations. Here's what I think should work:

Method: PUT
URL: /api/parameters/federation/%2f/local-nodename
Body: {"name": "local-nodename", "value": "mq_mpietrek"}

No matter what I try, I get back a 404.

Thanks much,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130211/9b552ebd/attachment.htm>

From iconara at gmail.com  Tue Feb 12 07:22:43 2013
From: iconara at gmail.com (Theo)
Date: Mon, 11 Feb 2013 23:22:43 -0800 (PST)
Subject: [rabbitmq-discuss] How to start a local cluster
Message-ID: <041d954d-5f97-4357-a07d-dfbf323e5f60@googlegroups.com>

Hi,

I have a bash script that starts a local RabbitMQ cluster, but it was 
written for 2.6 (or maybe even 2.5) and now it doesn't work anymore. Could 
you help me fix it to be compatible with 2.8 and 3.0? The only issue, as 
far as I can tell is that the second node can't start because the 
management plugin tries to start its web server on the same port as the 
first node. In my script this was solved by passing -rabbitmq_mochiweb 
listeners [{mgmt,[{port,$mgmt_port}]}] with a different value for $mgmt_portfor each node, but in newer versions it looks like this isn't the way to do 
it. Also, in 3.0 the management UI is actually starting two web servers 
(the port number changed and the server on the old port just redirects), 
and I assume both of those will need to be set.

The script for 2.6 is here:

https://gist.github.com/iconara/4760720

If possible, I would like to use the same script for 2.8 and 3.0 (we're 
using 2.8 in production, but 3.0 will replace it eventually, so it's good 
to be able to start test clusters of both versions).

thanks for your help,
T#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130211/e263df70/attachment.htm>

From emile at rabbitmq.com  Tue Feb 12 10:19:16 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 12 Feb 2013 10:19:16 +0000
Subject: [rabbitmq-discuss] Setting the local-nodename parameter value
 via HTTP?
In-Reply-To: <CACLE7iy1=tnJv-N8eDFNGFpHvHvKAKePSpwHYjNzi1vB52m1-w@mail.gmail.com>
References: <CACLE7iy1=tnJv-N8eDFNGFpHvHvKAKePSpwHYjNzi1vB52m1-w@mail.gmail.com>
Message-ID: <511A1724.4010900@rabbitmq.com>


Hi Matt,

On 12/02/13 02:13, Matt Pietrek wrote:
> Method: PUT
> URL: /api/parameters/federation/%2f/local-nodename
> Body: {"name": "local-nodename", "value": "mq_mpietrek"}
> 
> No matter what I try, I get back a 404.

This works fine for me (without the "name" entry):

curl -i -u guest:guest -H "content-type:application/json" -XPUT
-d'{"value":"nodename"}'
http://host:15672/api/parameters/federation/%2f/local-nodename

Does GET /api/parameters/federation work? Do you get the same error with
a commandline HTTP request?



-Emile




From simon at rabbitmq.com  Tue Feb 12 10:30:51 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Feb 2013 10:30:51 +0000
Subject: [rabbitmq-discuss] How to start a local cluster
In-Reply-To: <041d954d-5f97-4357-a07d-dfbf323e5f60@googlegroups.com>
References: <041d954d-5f97-4357-a07d-dfbf323e5f60@googlegroups.com>
Message-ID: <511A19DB.7010907@rabbitmq.com>

On 12/02/13 07:22, Theo wrote:
> I have a bash script that starts a local RabbitMQ cluster, but it was
> written for 2.6 (or maybe even 2.5) and now it doesn't work anymore.
> Could you help me fix it to be compatible with 2.8 and 3.0? The only
> issue, as far as I can tell is that the second node can't start because
> the management plugin tries to start its web server on the same port as
> the first node. In my script this was solved by passing
> -rabbitmq_mochiweb listeners [{mgmt,[{port,$mgmt_port}]}] with a
> different value for $mgmt_portfor each node, but in newer versions it
> looks like this isn't the way to do it.

In 3.x you would need to use:

-rabbitmq_management listener [{port,$mgmt_port}]

> Also, in 3.0 the management UI
> is actually starting two web servers (the port number changed and the
> server on the old port just redirects), and I assume both of those will
> need to be set.

The redirect port will not break startup if it is already in use so you 
don't need to do anything; one of your instances will grab that port and 
the others will not.

> The script for 2.6 is here:
>
> https://gist.github.com/iconara/4760720
>
> If possible, I would like to use the same script for 2.8 and 3.0 (we're
> using 2.8 in production, but 3.0 will replace it eventually, so it's
> good to be able to start test clusters of both versions).

2.8 should be the same as 2.6.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ejoubert at rbcon.com  Tue Feb 12 12:03:06 2013
From: ejoubert at rbcon.com (ejoubert at rbcon.com)
Date: Tue, 12 Feb 2013 04:03:06 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq erlang client error:
	inet_address_preference
In-Reply-To: <9793a9f4-a98a-4fce-93c6-be5cc3005ac9@googlegroups.com>
References: <9793a9f4-a98a-4fce-93c6-be5cc3005ac9@googlegroups.com>
Message-ID: <ae791d7f-2a4c-4a1a-b904-911e313c036a@googlegroups.com>

Hi,

On Sunday, 20 January 2013 23:19:22 UTC, Mike Bridge wrote:
>
> I'm new to rabbitmq and fairly new to erlang....  I'm trying 
> unsuccessfully to get the erlang client (3.0.1) working.  Any idea what 
> this error means?
>
> ** {{case_clause,undefined},
>     [{amqp_network_connection,inet_address_preference,0,
>                               [{file,"src/amqp_network_connection.erl"},
>                                {line,154}]},
>

A possible cause is that the Erlang client and the broker versions are 
mismatched. That error should not occur if you use matching versions 
together.

-Emile


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130212/5bc4c422/attachment.htm>

From bison_art at o2.pl  Tue Feb 12 10:44:32 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 12 Feb 2013 02:44:32 -0800 (PST)
Subject: [rabbitmq-discuss] Logging with UTC timezone
Message-ID: <1360665872081-24976.post@n5.nabble.com>

Hi, I want to switch rabbitmq trace.log to logiging using UTC timezone. Whre
Can I switch it ? (rabbitmq-tracing)



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Logging-with-UTC-timezone-tp24976.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From hj at hjvanranden.nl  Tue Feb 12 10:53:17 2013
From: hj at hjvanranden.nl (hjvanranden)
Date: Tue, 12 Feb 2013 02:53:17 -0800 (PST)
Subject: [rabbitmq-discuss] Help getting 2.8.7 to run after removing
 3.0.2 (maybe_upgrade_mnesia???)
In-Reply-To: <51143EA9.1050703@rabbitmq.com>
References: <CACLE7iwN7RtffL-_BcSoN-BF=mQKyHjHFZB1j-Bh5K3fTDWWCQ@mail.gmail.com>
	<51138ADA.3020201@rabbitmq.com>
	<CACLE7ixK9TesnnQG0UgeKK0s3tCEqtbFi7t_PsChzp6yTZMX2A@mail.gmail.com>
	<51143EA9.1050703@rabbitmq.com>
Message-ID: <1360666397460-24977.post@n5.nabble.com>

I had exactly the same problem (after uninstalling RabbitMQ 3.0, running on
Windows 7), but I had no rabbitmq.config file with a disc specifier.

I resolved the problem by deleting the mnesia directory (which contained
RabbitMQ 3.0 stuff) from C:\Users\<my username>\AppData\Roaming\RabbitMQ\db.

Hendrik Jan van Randen



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Help-getting-2-8-7-to-run-after-removing-3-0-2-maybe-upgrade-mnesia-tp24901p24977.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bison_art at o2.pl  Tue Feb 12 11:58:37 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 12 Feb 2013 03:58:37 -0800 (PST)
Subject: [rabbitmq-discuss] ReplyTo format
Message-ID: <1360670317804-24978.post@n5.nabble.com>

What is correct format of ReplyTo in the message ?

Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/ReplyTo-format-tp24978.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Tue Feb 12 12:13:39 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 12 Feb 2013 12:13:39 +0000
Subject: [rabbitmq-discuss] ReplyTo format
In-Reply-To: <1360670317804-24978.post@n5.nabble.com>
References: <1360670317804-24978.post@n5.nabble.com>
Message-ID: <B3F78EE4-8923-463F-9DBF-6D57E9DC5231@rabbitmq.com>

On 12 Feb 2013, at 11:58, rabbit15 wrote:
> What is correct format of ReplyTo in the message ?
> 

That depends on how you're using reply-to in your consumer. Are you intending to pass them the name of a reply queue, or an exchange to which replies should be sent? If it's the former, then you can send your reply to the default exchange using the queue name as the routing key of the reply message. In either case, the content should be the name of the object you wish to the client to utilise in sending a reply.

Cheers,
Tim


From tim at rabbitmq.com  Tue Feb 12 12:16:11 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 12 Feb 2013 12:16:11 +0000
Subject: [rabbitmq-discuss] Logging with UTC timezone
In-Reply-To: <1360665872081-24976.post@n5.nabble.com>
References: <1360665872081-24976.post@n5.nabble.com>
Message-ID: <682A2FC8-6AAD-4658-A7EF-D32D4C062B25@rabbitmq.com>

Hi

On 12 Feb 2013, at 10:44, rabbit15 wrote:
> Hi, I want to switch rabbitmq trace.log to logiging using UTC timezone. Whre
> Can I switch it ? (rabbitmq-tracing)
> 

There's no support for changing the timestamp format at the moment. If that's something lots of users want we could consider adding it I suppose - are there are other out there who would like to clamour for this feature?

From tim at rabbitmq.com  Tue Feb 12 12:28:16 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 12 Feb 2013 12:28:16 +0000
Subject: [rabbitmq-discuss] Logging with UTC timezone
In-Reply-To: <682A2FC8-6AAD-4658-A7EF-D32D4C062B25@rabbitmq.com>
References: <1360665872081-24976.post@n5.nabble.com>
	<682A2FC8-6AAD-4658-A7EF-D32D4C062B25@rabbitmq.com>
Message-ID: <D5B964FD-62FA-42F5-9B6B-A2F30A04A14D@rabbitmq.com>

On 12 Feb 2013, at 12:16, Tim Watson wrote:
> There's no support for changing the timestamp format at the moment. If that's something lots of users want we could consider adding it I suppose - are there are other out there who would like to clamour for this feature?

Further to this, it's worth baring in mind that currently, the timestamp is added by the tracer client, so it could vary considerably from the point at which the broker handled the message (if e.g., the queue is backed up).

I've filed a bug to look at adding a timestamp when the broker handles the trace messages and possibly to look at making the log format configurable. This is quite low priority compared to a lot of other tickets though, so if there are lots of you who care about this feature then now would be the time to speak up!

Cheers,
Tim

From matthias at rabbitmq.com  Tue Feb 12 13:00:10 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 12 Feb 2013 13:00:10 +0000
Subject: [rabbitmq-discuss] rabbitmq erlang client error:
	inet_address_preference
In-Reply-To: <ae791d7f-2a4c-4a1a-b904-911e313c036a@googlegroups.com>
References: <9793a9f4-a98a-4fce-93c6-be5cc3005ac9@googlegroups.com>
	<ae791d7f-2a4c-4a1a-b904-911e313c036a@googlegroups.com>
Message-ID: <511A3CDA.2050702@rabbitmq.com>

On 12/02/13 12:03, ejoubert at rbcon.com wrote:
> On Sunday, 20 January 2013 23:19:22 UTC, Mike Bridge wrote:
>
>     I'm new to rabbitmq and fairly new to erlang....  I'm trying
>     unsuccessfully to get the erlang client (3.0.1) working.  Any idea
>     what this error means?
>
>     ** {{case_clause,undefined},
>          [{amqp_network_connection,inet_address_preference,0,
>
>     [{file,"src/amqp_network_connection.erl"},
>                                     {line,154}]},
>
>
> A possible cause is that the Erlang client and the broker versions are
> mismatched. That error should not occur if you use matching versions
> together.

It's actually not a version mismatch thing but, as Paul noted, a bug in 
the rebar friendly fork of the erlang client, which neglected to include 
an application env setting that is new in the 3.0.x version of the client.

Matthias.

From tim at rabbitmq.com  Tue Feb 12 13:00:45 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 12 Feb 2013 13:00:45 +0000
Subject: [rabbitmq-discuss] Logging with UTC timezone
In-Reply-To: <D5B964FD-62FA-42F5-9B6B-A2F30A04A14D@rabbitmq.com>
References: <1360665872081-24976.post@n5.nabble.com>
	<682A2FC8-6AAD-4658-A7EF-D32D4C062B25@rabbitmq.com>
	<D5B964FD-62FA-42F5-9B6B-A2F30A04A14D@rabbitmq.com>
Message-ID: <2A3BA85B-3714-47EA-A69E-067756950A9C@rabbitmq.com>

On 12 Feb 2013, at 12:28, Tim Watson wrote:
> Further to this, it's worth baring in mind that currently, the timestamp is added by the tracer client, so it could vary considerably from the point at 

s/baring/bearing


From bison_art at o2.pl  Tue Feb 12 13:22:34 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 12 Feb 2013 05:22:34 -0800 (PST)
Subject: [rabbitmq-discuss] Logging with UTC timezone
In-Reply-To: <2A3BA85B-3714-47EA-A69E-067756950A9C@rabbitmq.com>
References: <1360665872081-24976.post@n5.nabble.com>
	<682A2FC8-6AAD-4658-A7EF-D32D4C062B25@rabbitmq.com>
	<D5B964FD-62FA-42F5-9B6B-A2F30A04A14D@rabbitmq.com>
	<2A3BA85B-3714-47EA-A69E-067756950A9C@rabbitmq.com>
Message-ID: <1360675354532-24985.post@n5.nabble.com>

Thanks for the answer. For me this is very important. I hope there would be
more people needs it.
Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Logging-with-UTC-timezone-tp24976p24985.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bison_art at o2.pl  Tue Feb 12 13:26:15 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 12 Feb 2013 05:26:15 -0800 (PST)
Subject: [rabbitmq-discuss] ReplyTo format
In-Reply-To: <B3F78EE4-8923-463F-9DBF-6D57E9DC5231@rabbitmq.com>
References: <1360670317804-24978.post@n5.nabble.com>
	<B3F78EE4-8923-463F-9DBF-6D57E9DC5231@rabbitmq.com>
Message-ID: <1360675575658-24986.post@n5.nabble.com>

Thanks for the quick response. I'm asking about format, which may be defined
by protocol. I'm asking about something like 
/queue_name/routing_key     and      /exchange_name/routing_key     
or 
queue_name:routing_key     and      exchange_name:routing_key.
Is there any specifiaction with that ?
Best Regards,
Artur




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/ReplyTo-format-tp24978p24986.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From peter.konar at nokia.com  Tue Feb 12 13:27:19 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Tue, 12 Feb 2013 07:27:19 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <51196998.8080103@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>,
	<51196998.8080103@rabbitmq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>

'rabbitmqctl report
[pkonar at ajtrafp063 ~]$ sudo rabbitmqctl report
Reporting server status on {{2013,2,12},{13,12,55}}

 ...
Status of node rabbit at ajtrafp064 ...
[{pid,3884},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.0.2"},
      {rabbitmq_management,"RabbitMQ Management Console","3.0.2"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.2"},
      {rabbit,"RabbitMQ","3.0.2"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.2"},
      {webmachine,"webmachine","1.9.1-rmq3.0.2-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.2-gitd541e9a"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.0.2"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,35280904},
      {connection_procs,395120},
      {queue_procs,5408},
      {plugins,306296},
      {other_proc,9714296},
      {mnesia,78592},
      {mgmt_db,153144},
      {msg_index,22696},
      {other_ets,1142280},
      {binary,2462008},
      {code,17446642},
      {atom,1553689},
      {other_system,2000733}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,6689898496},
 {disk_free_limit,1000000000},
 {disk_free,62383673344},
 {file_descriptors,
     [{total_limit,924},{total_used,7},{sockets_limit,829},{sockets_used,5}]},
 {processes,[{limit,1048576},{used,236}]},
 {run_queue,0},
 {uptime,69961}]

Cluster status of node rabbit at ajtrafp064 ...
[{nodes,[{disc,[rabbit at ajtrafp063,rabbit at ajtrafp064]}]},
 {running_nodes,[rabbit at ajtrafp063,rabbit at ajtrafp064]},
 {partitions,[]}]

Application environment of node rabbit at ajtrafp064 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[rabbit at ajtrafp063,rabbit at ajtrafp064]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at ajtrafp064.log"}},
 {frame_max,131072},
 {heartbeat,600},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../plugins"},
 {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at ajtrafp064-plugins-expand"},
 {queue_index_max_journal_entries,262144},
 {reverse_dns_lookups,false},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at ajtrafp064-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Status of node rabbit at ajtrafp063 ...
[{pid,3873},
 {running_applications,
     [{rabbitmq_management_visualiser,"RabbitMQ Visualiser","3.0.2"},
      {rabbitmq_management,"RabbitMQ Management Console","3.0.2"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.2"},
      {rabbit,"RabbitMQ","3.0.2"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.2"},
      {webmachine,"webmachine","1.9.1-rmq3.0.2-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.2-gitd541e9a"},
      {xmerl,"XML parser","1.2.10"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {amqp_client,"RabbitMQ AMQP Client","3.0.2"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,57276528},
      {connection_procs,134480},
      {queue_procs,21076560},
      {plugins,81960},
      {other_proc,9372096},
      {mnesia,79040},
      {mgmt_db,9904},
      {msg_index,249152},
      {other_ets,2159288},
      {binary,3100872},
      {code,17446642},
      {atom,1553689},
      {other_system,2012845}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,6689898496},
 {disk_free_limit,1000000000},
 {disk_free,62375903232},
 {file_descriptors,
     [{total_limit,924},{total_used,7},{sockets_limit,829},{sockets_used,4}]},
 {processes,[{limit,1048576},{used,226}]},
 {run_queue,0},
 {uptime,56951}]

Cluster status of node rabbit at ajtrafp063 ...
[{nodes,[{disc,[rabbit at ajtrafp063,rabbit at ajtrafp064]}]},
 {running_nodes,[rabbit at ajtrafp064,rabbit at ajtrafp063]},
 {partitions,[]}]

Application environment of node rabbit at ajtrafp063 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[rabbit at ajtrafp063,rabbit at ajtrafp064]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {enabled_plugins_file,"/etc/rabbitmq/enabled_plugins"},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at ajtrafp063.log"}},
 {frame_max,131072},
 {heartbeat,600},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {plugins_dir,"/usr/lib/rabbitmq/lib/rabbitmq_server-3.0.2/sbin/../plugins"},
 {plugins_expand_dir,"/var/lib/rabbitmq/mnesia/rabbit at ajtrafp063-plugins-expand"},
 {queue_index_max_journal_entries,262144},
 {reverse_dns_lookups,false},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at ajtrafp063-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:
pid     name    port    peer_port       host    peer_host       ssl     peer_cert_subject       peer_cert_issuer        peer_cert_validity      auth_mechanism  ssl_protocol    ssl_key_exchange        ssl_cipher      ssl_hash        protocol        user    vhost     timeout frame_max       client_properties       recv_oct        recv_cnt        send_oct        send_cnt        send_pend       state   last_blocked_by last_blocked_age        channels
<rabbit at ajtrafp063.3.3992.0>    10.196.42.119:48485 -> 10.196.42.21:5672        5672    48485   10.196.42.21    10.196.42.119   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.4"}] 149398118       6460971 2122464675      7082940 0       running none    infinity        1
<rabbit at ajtrafp063.3.4254.0>    10.196.42.120:59485 -> 10.196.42.21:5672        5672    59485   10.196.42.21    10.196.42.120   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.4"}] 109362206       4866571 3624114636      5187935 0       running none    infinity        1
<rabbit at ajtrafp063.3.20125.0>   147.243.130.14:34613 -> 10.196.42.21:5672       5672    34613   10.196.42.21    147.243.130.14  false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.4"}] 2254516 41540   96969022        93165   0       running none    infinity        1
<rabbit at ajtrafp064.1.14970.129> 10.196.42.182:50012 -> 10.196.42.22:5672        5672    50012   10.196.42.22    10.196.42.182   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2013 VMware, Inc."},{"version","3.0.2"}] 892971313       13406695        65127580        4651947 0       running flow    708.153401      2
<rabbit at ajtrafp064.1.13886.130> 10.196.42.180:57261 -> 10.196.42.22:5672        5672    57261   10.196.42.22    10.196.42.180   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2013 VMware, Inc."},{"version","3.0.2"}] 991521388       13254940        64474148        4605273 0       running flow    1012.465014     1
<rabbit at ajtrafp064.1.5604.131>  10.196.42.128:38983 -> 10.196.42.22:5672        5672    38983   10.196.42.22    10.196.42.128   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2013 VMware, Inc."},{"version","3.0.2"}] 1260443690      13146545        63815924        4558257 0       running flow    713.080137      1
<rabbit at ajtrafp064.1.31824.131> 10.196.42.179:41165 -> 10.196.42.22:5672        5672    41165   10.196.42.22    10.196.42.179   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2013 VMware, Inc."},{"version","3.0.2"}] 1207139221      13617335        66191024        4727907 0       running flow    1314.712837     1

Channels:
pid     name    connection      number  user    vhost   transactional   confirm consumer_count  messages_unacknowledged messages_unconfirmed    messages_uncommitted    acks_uncommitted        prefetch_count  client_flow_blocked
<rabbit at ajtrafp063.3.3999.0>    10.196.42.119:48485 -> 10.196.42.21:5672 (1)    <rabbit at ajtrafp063.3.3992.0>    1       guest   /       false   false   1       0       0       0       0       8000    false
<rabbit at ajtrafp063.3.4260.0>    10.196.42.120:59485 -> 10.196.42.21:5672 (1)    <rabbit at ajtrafp063.3.4254.0>    1       guest   /       false   false   1       0       0       0       0       8000    false
<rabbit at ajtrafp063.3.20131.0>   147.243.130.14:34613 -> 10.196.42.21:5672 (1)   <rabbit at ajtrafp063.3.20125.0>   1       guest   /       false   false   1       0       0       0       0       8000    false
<rabbit at ajtrafp064.1.8630.1251> 10.196.42.182:50012 -> 10.196.42.22:5672 (44154)        <rabbit at ajtrafp064.1.14970.129> 44154   guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp064.1.8634.1251> 10.196.42.182:50012 -> 10.196.42.22:5672 (44155)        <rabbit at ajtrafp064.1.14970.129> 44155   guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp064.1.2184.1262> 10.196.42.128:38983 -> 10.196.42.22:5672 (62655)        <rabbit at ajtrafp064.1.5604.131>  62655   guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp064.1.2484.1262> 10.196.42.180:57261 -> 10.196.42.22:5672 (27264)        <rabbit at ajtrafp064.1.13886.130> 27264   guest   /       false   false   0       0       0       0       0       0       false
<rabbit at ajtrafp064.1.2981.1262> 10.196.42.179:41165 -> 10.196.42.22:5672 (7621) <rabbit at ajtrafp064.1.31824.131> 7621    guest   /       false   false   0       0       0       0       0       0       false

Queues on /:
pid     name    durable auto_delete     arguments       owner_pid       policy  exclusive_consumer_pid  exclusive_consumer_tag  messages_ready  messages_unacknowledged messages        consumers       active_consumers        memory  slave_pids      synchronised_slave_pids   backing_queue_status
<rabbit at ajtrafp063.3.626.0>     Something       true    false   [{"x-message-ttl",30000}]                                       0       0       0       0       0       21037632                        [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,72530278}, {persistent_count,0}, {avg_ingress_rate,0.0}, {avg_egress_rate,1946.202937736505}, {avg_ack_ingress_rate,0.0}, {avg_ack_egress_rate,0.0}]
<rabbit at ajtrafp063.3.4000.0>    b2bserverajtrafd015.si.atl01.locn.s.nokia.com   false   true    [{"x-message-ttl",45000}]       <rabbit at ajtrafp063.3.3992.0>                            0       0       0       1       1       23136                   [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,7114159}, {persistent_count,0}, {avg_ingress_rate,429.0251091151943}, {avg_egress_rate,429.0251091151943}, {avg_ack_ingress_rate,429.0251091151943}, {avg_ack_egress_rate,429.16893248398924}]
<rabbit at ajtrafp063.3.4261.0>    b2bserverajtrafd016.si.atl01.locn.s.nokia.com   false   true    [{"x-message-ttl",45000}]       <rabbit at ajtrafp063.3.4254.0>                            0       0       0       1       1       27568                   [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,5207687}, {persistent_count,0}, {avg_ingress_rate,349.00662555488776}, {avg_egress_rate,349.00662555488776}, {avg_ack_ingress_rate,349.00662555488776}, {avg_ack_egress_rate,349.1704784307351}]
<rabbit at ajtrafp063.3.20132.0>   b2bserver-dicksMBPlocal.local   false   true    [{"x-message-ttl",45000}]       <rabbit at ajtrafp063.3.20125.0>                           0       0       0       1       1       23136                   [{q1,0}, {q2,0}, {delta,{delta,undefined,0,undefined}}, {q3,0}, {q4,0}, {len,0}, {pending_acks,0}, {target_ram_count,infinity}, {ram_msg_count,0}, {ram_ack_count,0}, {next_seq_id,107319}, {persistent_count,0}, {avg_ingress_rate,453.20681423716616}, {avg_egress_rate,453.20681423716616}, {avg_ack_ingress_rate,453.20681423716616}, {avg_ack_egress_rate,461.1071676868251}]

Exchanges on /:
name    type    durable auto_delete     internal        arguments       policy
        direct  true    false   false   []
amq.direct      direct  true    false   false   []
amq.fanout      fanout  true    false   false   []
amq.headers     headers true    false   false   []
amq.match       headers true    false   false   []
amq.rabbitmq.log        topic   true    false   false   []
amq.rabbitmq.trace      topic   true    false   false   []
amq.topic       topic   true    false   false   []
clusterStatus   topic   true    false   false   []
flowData        topic   true    false   false   []
products        topic   true    false   false   []

Bindings on /:
source_name     source_kind     destination_name        destination_kind        routing_key     arguments
        exchange        Something       queue   Something       []
        exchange        b2bserver-dicksMBPlocal.local   queue   b2bserver-dicksMBPlocal.local   []
        exchange        b2bserverajtrafd015.si.atl01.locn.s.nokia.com   queue   b2bserverajtrafd015.si.atl01.locn.s.nokia.com   []
        exchange        b2bserverajtrafd016.si.atl01.locn.s.nokia.com   queue   b2bserverajtrafd016.si.atl01.locn.s.nokia.com   []
flowData        exchange        Something       queue   #       []
flowData        exchange        b2bserver-dicksMBPlocal.local   queue   1_0.107.*       []
flowData        exchange        b2bserver-dicksMBPlocal.local   queue   1_0.D01.*       []
flowData        exchange        b2bserverajtrafd015.si.atl01.locn.s.nokia.com   queue   1_0.D01.*       []
flowData        exchange        b2bserverajtrafd016.si.atl01.locn.s.nokia.com   queue   1_0.F32.*       []

Consumers on /:
queue_name      channel_pid     consumer_tag    ack_required
b2bserver-dicksMBPlocal.local   <rabbit at ajtrafp063.3.20131.0>   amq.ctag-7wgn3n8B8BpDFuw15dCNUQ true
b2bserverajtrafd015.si.atl01.locn.s.nokia.com   <rabbit at ajtrafp063.3.3999.0>    amq.ctag-cGLyM0l72ST1c05mwdn9eQ true
b2bserverajtrafd016.si.atl01.locn.s.nokia.com   <rabbit at ajtrafp063.3.4260.0>    amq.ctag-KBO1GEzW_LGGUBEXFu4Xag true

Permissions on /:
user    configure       write   read
guest   .*      .*      .*

Policies on /:

Parameters on /:

...done.

RabbitMQ Netstat
Proto Recv-Q Send-Q Local Address               Foreign Address             State
tcp        0      0 :::5672                     :::*                        LISTEN
tcp        0      0 ::ffff:10.196.42.21:5672    ::ffff:10.196.42.119:48485  ESTABLISHED
tcp        0      0 ::ffff:10.196.42.21:5672    ::ffff:10.196.42.120:59485  ESTABLISHED
tcp        0      0 ::ffff:10.196.42.21:5672    ::ffff:147.243.130.14:34613 ESTABLISHED

TSA Client Netstat
Proto Recv-Q Send-Q Local Address               Foreign Address             State
tcp        0 246112 ::ffff:10.196.42.182:50012  ::ffff:10.196.42.22:5672    ESTABLISHED


Jstack:
"pool-6-thread-3" prio=10 tid=0x00007fc76050b800 nid=0x28b2 runnable [0x00007fc4aadeb000]
   java.lang.Thread.State: RUNNABLE
        at java.net.SocketOutputStream.$$YJP$$socketWrite0(Native Method)
        at java.net.SocketOutputStream.socketWrite0(SocketOutputStream.java)
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:109)
        at java.net.SocketOutputStream.write(SocketOutputStream.java:153)
        at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)
        at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)
        - locked <0x000000063abd4638> (a java.io.BufferedOutputStream)
        at java.io.DataOutputStream.flush(DataOutputStream.java:123)
        at com.rabbitmq.client.impl.SocketFrameHandler.flush(SocketFrameHandler.java:142)
        at com.rabbitmq.client.impl.AMQConnection.flush(AMQConnection.java:488)
        at com.rabbitmq.client.impl.AMQCommand.transmit(AMQCommand.java:125)
        at com.rabbitmq.client.impl.AMQChannel.quiescingTransmit(AMQChannel.java:316)
        - locked <0x000000060f49ed88> (a java.lang.Object)
        at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:292)
        - locked <0x000000060f49ed88> (a java.lang.Object)
        at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:634)
        at sun.reflect.GeneratedMethodAccessor77.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:601)
        at org.springframework.amqp.rabbit.connection.CachingConnectionFactory$CachedChannelInvocationHandler.invoke(CachingConnectionFactory.java:348)
        - locked <0x000000060f49f2f8> (a java.lang.Object)
        at $Proxy59.basicPublish(Unknown Source)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.doSend(RabbitTemplate.java:648)
        at org.springframework.amqp.rabbit.core.RabbitTemplate$1.doInRabbit(RabbitTemplate.java:331)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:600)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:329)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:323)
        at com.nokia.traffic.flowdata.transport.rabbitmq.RabbitMQSender.send(RabbitMQSender.java:53)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.doSend_aroundBody4(TrafficStateAccumulatorMP.java:183)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP$AjcClosure5.run(TrafficStateAccumulatorMP.java:1)
        at org.aspectj.runtime.reflect.JoinPointImpl.proceed(JoinPointImpl.java:149)
        at com.nokia.traffic.ttbhm.audit.MessageGroupingAspect.dispatchOutput(MessageGroupingAspect.java:70)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.doSend(TrafficStateAccumulatorMP.java:182)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.trySendingALinear(TrafficStateAccumulatorMP.java:140)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.onSendLinear_aroundBody2(TrafficStateAccumulatorMP.java:115)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP$AjcClosure3.run(TrafficStateAccumulatorMP.java:1)
        at org.aspectj.runtime.reflect.JoinPointImpl.proceed(JoinPointImpl.java:149)
        at com.nokia.traffic.ttbhm.audit.MessageGroupingAspect.outputHandler(MessageGroupingAspect.java:231)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.onSendLinear(TrafficStateAccumulatorMP.java:113)
        at sun.reflect.GeneratedMethodAccessor70.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:601)
        at com.nokia.dempsy.container.internal.LifecycleHelper.invokeOutput(LifecycleHelper.java:178)
        at com.nokia.dempsy.container.MpContainer.invokeOperation(MpContainer.java:1160)
        at com.nokia.dempsy.container.MpContainer.access$600(MpContainer.java:70)
        at com.nokia.dempsy.container.MpContainer$6.run(MpContainer.java:924)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
        at java.lang.Thread.run(Thread.java:722)


Thanks
Peter Konar
________________________________________
From: ext Matthias Radestock [matthias at rabbitmq.com]
Sent: Monday, February 11, 2013 3:58 PM
To: Konar Peter (Nokia-LC/Chicago)
Cc: Carroll James (Nokia-LC/Malvern); Discussions about RabbitMQ; Mccuiston Mitchell (Nokia-LC/Chicago); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Yu Jerry.3 (Nokia-LC/Alpharetta)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 11/02/13 21:44, Konar Peter (Nokia-LC/Chicago) wrote:
> I have upgraded client and server to 3.0.2 to get heartbeats.

Great, that will make it easier to track down any problem you may see.
More generally though note that heartbeats can be enabled in older
clients; all that changed in 3.0.x is that the server now by default
suggests that heartbeats should be enabled.

> I will get you a "netstat -an" output as soon as we can get this to
> fail.

A snapshot of
- client stacktrace
- server 'rabbitmqctl report' output
- client and server 'netstat -an' output
would be ideal.

Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: jstack.13:13:52
Type: application/octet-stream
Size: 146933 bytes
Desc: jstack.13:13:52
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130212/d783c71e/attachment.obj>

From theo at iconara.net  Tue Feb 12 14:00:29 2013
From: theo at iconara.net (Theo Hultberg)
Date: Tue, 12 Feb 2013 15:00:29 +0100
Subject: [rabbitmq-discuss] How to start a local cluster
In-Reply-To: <511A19DB.7010907@rabbitmq.com>
References: <041d954d-5f97-4357-a07d-dfbf323e5f60@googlegroups.com>
	<511A19DB.7010907@rabbitmq.com>
Message-ID: <CAMR1f-c0U__TEbJU7ANKCphtqF3drVBS3+1ARSFdCYv=ut7+_A@mail.gmail.com>

Thanks!

There's something with the script that makes it not work in 2.8, but maybe
it's unrelated. Thanks for the help.

T#


On Tue, Feb 12, 2013 at 11:30 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 12/02/13 07:22, Theo wrote:
>
>> I have a bash script that starts a local RabbitMQ cluster, but it was
>> written for 2.6 (or maybe even 2.5) and now it doesn't work anymore.
>> Could you help me fix it to be compatible with 2.8 and 3.0? The only
>> issue, as far as I can tell is that the second node can't start because
>> the management plugin tries to start its web server on the same port as
>> the first node. In my script this was solved by passing
>> -rabbitmq_mochiweb listeners [{mgmt,[{port,$mgmt_port}]}] with a
>> different value for $mgmt_portfor each node, but in newer versions it
>> looks like this isn't the way to do it.
>>
>
> In 3.x you would need to use:
>
> -rabbitmq_management listener [{port,$mgmt_port}]
>
>  Also, in 3.0 the management UI
>> is actually starting two web servers (the port number changed and the
>> server on the old port just redirects), and I assume both of those will
>> need to be set.
>>
>
> The redirect port will not break startup if it is already in use so you
> don't need to do anything; one of your instances will grab that port and
> the others will not.
>
>  The script for 2.6 is here:
>>
>> https://gist.github.com/**iconara/4760720<https://gist.github.com/iconara/4760720>
>>
>> If possible, I would like to use the same script for 2.8 and 3.0 (we're
>> using 2.8 in production, but 3.0 will replace it eventually, so it's
>> good to be able to start test clusters of both versions).
>>
>
> 2.8 should be the same as 2.6.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130212/657b8679/attachment.htm>

From michael.s.klishin at gmail.com  Tue Feb 12 15:57:13 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 12 Feb 2013 19:57:13 +0400
Subject: [rabbitmq-discuss] ANN Bunny 0.9.0.pre7 is released
Message-ID: <CAE3HoVR9C1GktkQMET8Yg0jRMrpjKY1VJ6h4wvcLjV-bHSmvhg@mail.gmail.com>

Bunny 0.9.0.pre7 is released to rubygems.org [1].

See [2] for release notes.

1. https://rubygems.org/gems/bunny/versions/0.9.0.pre7
2.
http://blog.rubyrabbitmq.info/blog/2013/02/12/bunny-0-dot-9-0-dot-pre7-is-released/
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130212/d07aff9b/attachment.htm>

From mpietrek at skytap.com  Tue Feb 12 18:48:03 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 12 Feb 2013 10:48:03 -0800
Subject: [rabbitmq-discuss] Internal Server Error message on RabbitMQ 3.0.2
Message-ID: <CACLE7iw_RMZ7SemkwQCfTQxQ2X6LBsTZWBwKrY6fZWC8T=bJPw@mail.gmail.com>

I'm getting error messages like this from the server. Nothing works till I
restart the broker:


Got response code 500 with body
Internal Server ErrorThe server encountered an error while processing this
request:

{error,badarg,
       [{ets,lookup,[rabbit_user,<<"guest">>],[]},
        {rabbit_misc,dirty_read,1,[]},
        {rabbit_auth_backend_internal,internal_check_user_login,2,[]},
        {rabbit_access_control,'-check_user_login/2-fun-0-',4,[]},
        {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
        {rabbit_mgmt_util,is_authorized,4,[]},
        {webmachine_resource,resource_call,3,[]},
        {webmachine_resource,do,3,[]}]}



The rabbit@<host>.log file from around the time shows:

=ERROR REPORT==== 12-Feb-2013::10:30:08 ===
Mnesia(rabbit at mq1): ** ERROR ** (core dumped to file:
"/home/mpietrek/MnesiaCore.rabbit at mq1_1360_693808_817246")
 ** FATAL ** {error,{"Cannot rename disk_log file",latest_log,
                     "/home/mpietrek/work/var/lib/rabbit at mq1/PREVIOUS.LOG",
                     {log_header,trans_log,"4.3","4.7",rabbit at mq1,
                                 {1360,693808,799354}},

{file_error,"/home/mpietrek/work/var/lib/rabbit at mq1/PREVIOUS.LOG",
                                 enoent}}}

=ERROR REPORT==== 12-Feb-2013::10:30:18 ===
** Generic server mnesia_subscr terminating
** Last message in was {'EXIT',<0.129.0>,killed}
** When Server state == {state,<0.129.0>,131092}
** Reason for termination ==
** killed

=ERROR REPORT==== 12-Feb-2013::10:30:18 ===
** gen_event handler mnesia_event crashed.
** Was installed in mnesia_event
** Last event was: {mnesia_system_event,
                       {mnesia_info,"~p terminated: ~p~n",
                           [mnesia_recover,killed]}}
** When handler state == {state,[],false,[]}
** Reason == {terminated,
                 [{io,format,
                      [<0.125.0>,"Mnesia(~p): ~p terminated: ~p~n",
                       [rabbit at mq1,mnesia_recover,killed]],
                      []},
                  {mnesia_event,handle_system_event,2,
                      [{file,"mnesia_event.erl"},{line,160}]},
                  {mnesia_event,handle_call,2,
                      [{file,"mnesia_event.erl"},{line,77}]},
                  {gen_event,server_call_update,3,
                      [{file,"gen_event.erl"},{line,617}]},
                  {gen_event,server_call,4,
                      [{file,"gen_event.erl"},{line,566}]},
                  {gen_event,handle_msg,5,[{file,"gen_event.erl"},{line,258}]},
                  {proc_lib,init_p_do_apply,3,
                      [{file,"proc_lib.erl"},{line,227}]}]}

=ERROR REPORT==== 12-Feb-2013::10:30:18 ===
** gen_event handler rabbit_error_logger crashed.
** Was installed in error_logger
** Last event was: {error,<0.125.0>,
                       {<0.12681.17>,
                        "** gen_event handler ~p crashed.~n** Was
installed in ~p~n** Last event was: ~p~n** When handler state ==
~p~n** Reason == ~p~n",
                        [mnesia_event,mnesia_event,
                         {mnesia_system_event,
                             {mnesia_info,"~p terminated: ~p~n",
                                 [mnesia_recover,killed]}},
                         {state,[],false,[]},
                         {terminated,
                             [{io,format,
                                  [<0.125.0>,
                                   "Mnesia(~p): ~p terminated: ~p~n",
                                   [rabbit at mq1,mnesia_recover,killed]],
                                  []},
                              {mnesia_event,handle_system_event,2,
                                  [{file,"mnesia_event.erl"},{line,160}]},
                              {mnesia_event,handle_call,2,
                                  [{file,"mnesia_event.erl"},{line,77}]},
                              {gen_event,server_call_update,3,
                                  [{file,"gen_event.erl"},{line,617}]},
                              {gen_event,server_call,4,
                                  [{file,"gen_event.erl"},{line,566}]},
                              {gen_event,handle_msg,5,
                                  [{file,"gen_event.erl"},{line,258}]},
                              {proc_lib,init_p_do_apply,3,
                                  [{file,"proc_lib.erl"},{line,227}]}]}]}}
** When handler state == {resource,<<"/">>,exchange,<<"amq.rabbitmq.log">>}
** Reason == {badarg,[{ets,lookup,
                           [rabbit_exchange,
                            {resource,<<"/">>,exchange,
                                      <<"amq.rabbitmq.log">>}],
                           []},
                      {rabbit_misc,dirty_read,1,[]},
                      {rabbit_basic,publish,1,[]},
                      {rabbit_error_logger,publish1,4,[]},
                      {rabbit_error_logger,handle_event,2,[]},
                      {gen_event,server_update,4,
                                 [{file,"gen_event.erl"},{line,504}]},
                      {gen_event,server_notify,4,
                                 [{file,"gen_event.erl"},{line,486}]},
                      {gen_event,handle_msg,5,
                                 [{file,"gen_event.erl"},{line,248}]}]}

=INFO REPORT==== 12-Feb-2013::10:30:18 ===
    application: mnesia
    exited: shutdown
    type: temporary


=ERROR REPORT==== 12-Feb-2013::10:30:18 ===
** Generic server <0.12822.13> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'basic.get',0,<<"charon">>,false},
                               none,noflow}}
** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,1,<0.12816.13>,
                            <0.12820.13>,<0.12816.13>,
                            <<"192.168.78.21:38843 -> 192.168.78.16:5672">>,
                            {token,<0.12821.13>,false},
                            in_progress,1,
                            {[],[]},
                            {[],[]},
                            [],[],
                            {user,<<"guest">>,
                                [administrator],
                                rabbit_auth_backend_internal,
                                {internal_user,<<"guest">>,
                                    <<93,38,120,113,16,14,172,225,248,216,74,
                                      218,230,161,150,138,14,49,216,172>>,
                                    [administrator]}},
                            <<"/">>,<<>>,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            <0.12814.13>,
                            {state,fine,5000,#Ref<0.0.46.55948>},
                            false,1,
                            {{0,nil},{0,nil}},
                            [],
                            [{<<"consumer_cancel_notify">>,bool,true},
                             {<<"publisher_confirms">>,bool,true},
                             {<<"basic.nack">>,bool,true}],
                            none}
** Reason for termination ==
** {badarg,[{ets,lookup,
                 [rabbit_queue,{resource,<<"/">>,queue,<<"charon">>}],
                 []},
            {rabbit_misc,dirty_read,1,[]},
            {rabbit_amqqueue,with,3,[]},
            {rabbit_channel,handle_method,3,[]},
            {rabbit_channel,handle_cast,2,[]},
            {gen_server2,handle_msg,2,[]},
            {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130212/564742e4/attachment.htm>

From matthias at rabbitmq.com  Tue Feb 12 19:01:48 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 12 Feb 2013 19:01:48 +0000
Subject: [rabbitmq-discuss] Internal Server Error message on RabbitMQ
 3.0.2
In-Reply-To: <CACLE7iw_RMZ7SemkwQCfTQxQ2X6LBsTZWBwKrY6fZWC8T=bJPw@mail.gmail.com>
References: <CACLE7iw_RMZ7SemkwQCfTQxQ2X6LBsTZWBwKrY6fZWC8T=bJPw@mail.gmail.com>
Message-ID: <511A919C.2030801@rabbitmq.com>

Matt,

On 12/02/13 18:48, Matt Pietrek wrote:
> I'm getting error messages like this from the server. [...]

The crucial error here is:

> Mnesia(rabbit at mq1): ** ERROR ** (core dumped to file: "/home/mpietrek/MnesiaCore.rabbit at mq1_1360_693808_817246")
>   ** FATAL ** {error,{"Cannot rename disk_log file",latest_log,
>                       "/home/mpietrek/work/var/lib/rabbit at mq1/PREVIOUS.LOG",
>
>                       {log_header,trans_log,"4.3","4.7",rabbit at mq1,
>                                   {1360,693808,799354}},
>                       {file_error,"/home/mpietrek/work/var/lib/rabbit at mq1/PREVIOUS.LOG",
>
>                                   enoent}}}

which has all the hallmarks of the mnesia dir being deleted while rabbit 
is running.

Does that ring any bells?


Regards,

Matthias.

From behrk2 at gmail.com  Tue Feb 12 19:28:51 2013
From: behrk2 at gmail.com (Kevin Behr)
Date: Tue, 12 Feb 2013 14:28:51 -0500
Subject: [rabbitmq-discuss] Consumer Clients as Tomcat Web Applications
 and Work Queue Configuration
In-Reply-To: <AA959E8B-19A8-4628-A700-B98C15580135@rabbitmq.com>
References: <CAC_yGURXNFrgJ6SM7vb5QjZn2m5GKBXgucUFvuQ4QodNzrz3yA@mail.gmail.com>
	<AA959E8B-19A8-4628-A700-B98C15580135@rabbitmq.com>
Message-ID: <CAC_yGUSCG6Nmj3xJ2Ae2HO5objLqv-fRt=rHne=XmGecZO+MqQ@mail.gmail.com>

Steve,

Thanks very much for your response.  I was able to re-implement the while
loop without having Tomcat bug-out upon server stop.  I achieved this by
catching the the InterruptedException in a Thread:

while (!Thread.currentThread().isInterrupted()) {

            ...

            channel.basicQos(1);

            QueueingConsumer consumer = new QueueingConsumer(channel);
            channel.basicConsume(ReferenceData.CONSUME_QUEUE_NAME, false,
consumer)

                try {

                    QueueingConsumer.Delivery delivery =
consumer.nextDelivery();
                    ...

channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);

                } catch (InterruptedException ex) {
                    Thread.currentThread().interrupt();
                    break;
                }

}

I find your comments about the polling interesting.  For now, though, my
requirements would seem to favor as little network latency as possible, so
I'm going to go with the original push/round robin model.

I am more confident in deploying the consumers and producers as web
applications, and your answer has helped to confirm that.  I am finding
benefit in manageability and portability and my ultimate goal, like you
said, is a sophisticated web-based control mechanism.  I want to have
real-time control of my clients, and I want it to be user friendly.  I've
started looking into JMX and MBeans to achieve such a solution.

*If you impose a prefetch
limit of 1 for each client you run, then the rabbit server will dispatch
messages to clients that have no unacknowledged messages (by the way,
you should explicitly acknowledge messages when using non-zero
basicQos()).*
*
*
Regarding your statement above, I had not taken that into consideration.
 I've coded my clients to  only acknowledge upon successful processing of
the delivered message.  If one of our many web services or datastore
connections goes down, then unacknowledged messages will start piling up
quickly, and the messaging and queuing pipeline will essentially come to a
halt. I would expect this to be the correct behavior, however, as I don't
want to throw out messages until someone discovers that a service is down.

As I will be using QueuingConsumer, I'm now wondering *how *I should
determine *what *to set my prefetch counts to.  Do you have any further
advice on this?  I'm still a little confused there.

Thanks again,

Kevin Behr


On Mon, Feb 11, 2013 at 6:33 AM, Steve Powell <steve at rabbitmq.com> wrote:

> Hi Kevin,
>
> Sorry for the delayed response.
>
> First, an observation about your original set-up:
>
> > while (true) {
> >       QueueingConsumer.Delivery delivery = consumer.nextDelivery();
> >       String message = new String(delivery.getBody());
> >       System.out.println(" [x] Received '" + message + "'");
> > }
>
>
> I assume that there are no Qos (prefetch) limits imposed on the channels
> these consumers use, and also I note that you are using the
> QueueingConsumer. I think this means that all of the consumers are able
> to receive the messages all the time, and so all messages will get
> distributed in round-robin fashion, until there are no messages left to
> deliver.
>
> In your 'workaround' solution, you are indeed pulling, not being pushed,
> and here all of the consumers will get a look-in: there is likely to be
> balancing, but not round-robin. This is based instead upon consumer
> request, so if one of them gets bogged down in work (initiated by the
> previous message, for example) then the other consumers can poll and
> take the next message, and, crucially, other messages won't be taken by
> this consumer while it is busy. Although this isn't 'round-robin'
> servicing, it is arguably better: the messages are not 'blindly' sent to
> consumers that are busy.
>
> The drawbacks are, as you note, an overhead of polling in the consumers,
> and a larger latency on the network -- each get involves a round-trip to
> the server, even when there is nothing to get.
>
> Now to your questions:
>
> >  ? Is it a bad idea to deploy consumers as Tomcat web applications? Are
> > there any advantages or disadvantages as compared to the alternative of
> > running system level Java clients?
>
> I see no reason why, apart from the overhead implied by running a full
> web application, there should be any particular disadvantages of running
> a Tomcat web application that does messaging as its main work. In fact,
> I suspect it is easier to control (start/stop) than using a
> free-standing Java client: you can potentially build a sophisticated
> web-based control mechanism. However, I'm not best placed to answer
> this.
>
> >  ? In the case of work queues, am I better off retrieving messages that
> > are pushed down to my clients, and setting a prefetchCount
> > (channel.basicQos(1)) to ensure that I only receive one message at a
> > time?
>
> This is the crux of the matter, as I see it. If you impose a prefetch
> limit of 1 for each client you run, then the rabbit server will dispatch
> messages to clients that have no unacknowledged messages (by the way,
> you should explicitly acknowledge messages when using non-zero
> basicQos()). Under these circumstances, you can achieve similar
> balancing as in the polling case, but without the polling. It will *not*
> be strictly round-robin after the first 'round' because the first
> consumer need not have acknowledged the previous message yet, and
> messages will be delivered to whatever consumers are ready for them --
> albeit in round-robin priority.
>
> The tutorial pages describe this pretty well (see [1]).
>
> There are two points to note:
>
> If you are using QueueingConsumer, then each message will be placed in a
> client Java queue, and nextDelivery() then unblocks with the message
> when it arrives. With explicit acknowledgements this means that one
> message at a time is transferred to the Java queue. You could increase
> the prefetchCount to 2, say, and then up to two messages would be placed
> in the queue but you would still process them serially through the
> nextDelivery() call. When one consumer gets two messages, then no other
> consumer will get these -- so if a message can take a long time before
> it is acknowledged, the message behind it can get delayed, even though
> there may be other consumers which are idle. Other messages can
> 'overtake' and get processed before it.
>
> If you want to avoid the QueueingConsumer internal Java queue, you could
> write your own Consumer implementation (base it on DefaultConsumer) but
> you should be aware that the handleDelivery() methods are driven
> asynchronously, but serially. You shouldn't perform long pieces of work
> on these threads. It would be wise to pass the message to some
> serialised worker thread, especially if you have a prefetchCount larger
> than one. This will probably then require a queue of your own anyway, so
> the advantages to you are slim.
>
> I hope this helps. Please let us know how you get on.
>
> Steve Powell
>
> [1] http://www.rabbitmq.com/tutorials/tutorial-two-java.html
>
> [M: +44-7815-838-558; H:+44-1962-775-598]
> SpringSource (a division of VMware), Virgo, RabbitMQ.
> -----------------------------------------------------------------------
> Good design:
>    is innovative, useful, aesthetic;
>    is understandable, unobtrusive, honest;
>    is long-lasting, thorough, environmentally friendly;
>    and is as little design as possible.
> Copyright Dieter Rams, amended March 2003; October 2009; and August 2012
>
> On 31 Jan 2013, at 01:33, Kevin Behr <behrk2 at gmail.com> wrote:
> > Hello everyone,
> >
> > I have five RabbitMQ consumer clients that are written and deployed as
> Tomcat web applications.  My original intention was to consume messages in
> the typical fashion:
> ?(elided)
> > I would appreciate any advice or suggestions.
> >
> > Thanks!
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130212/ba95f3d3/attachment.htm>

From matthias at rabbitmq.com  Tue Feb 12 19:58:50 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 12 Feb 2013 19:58:50 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>,
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
Message-ID: <511A9EFA.9010909@rabbitmq.com>

Peter,

On 12/02/13 13:27, Konar Peter (Nokia-LC/Chicago) wrote:
> Connections:
> pid     name    port    peer_port       host    peer_host       ssl     peer_cert_subject       peer_cert_issuer        peer_cert_validity      auth_mechanism  ssl_protocol    ssl_key_exchange        ssl_cipher      ssl_hash        protocol        user    vhost     timeout frame_max       client_properties       recv_oct        recv_cnt        send_oct        send_cnt        send_pend       state   last_blocked_by last_blocked_age        channels
> <rabbit at ajtrafp063.3.3992.0>    10.196.42.119:48485 -> 10.196.42.21:5672        5672    48485   10.196.42.21    10.196.42.119   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.4"}] 149398118       6460971 2122464675      7082940 0       running none    infinity        1
> <rabbit at ajtrafp063.3.4254.0>    10.196.42.120:59485 -> 10.196.42.21:5672        5672    59485   10.196.42.21    10.196.42.120   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.4"}] 109362206       4866571 3624114636      5187935 0       running none    infinity        1
> <rabbit at ajtrafp063.3.20125.0>   147.243.130.14:34613 -> 10.196.42.21:5672       5672    34613   10.196.42.21    147.243.130.14  false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2012 VMware, Inc."},{"version","2.8.4"}] 2254516 41540   96969022        93165   0       running none    infinity        1
> <rabbit at ajtrafp064.1.14970.129> 10.196.42.182:50012 -> 10.196.42.22:5672        5672    50012   10.196.42.22    10.196.42.182   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2013 VMware, Inc."},{"version","3.0.2"}] 892971313       13406695        65127580        4651947 0       running flow    708.153401      2
> <rabbit at ajtrafp064.1.13886.130> 10.196.42.180:57261 -> 10.196.42.22:5672        5672    57261   10.196.42.22    10.196.42.180   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2013 VMware, Inc."},{"version","3.0.2"}] 991521388       13254940        64474148        4605273 0       running flow    1012.465014     1
> <rabbit at ajtrafp064.1.5604.131>  10.196.42.128:38983 -> 10.196.42.22:5672        5672    38983   10.196.42.22    10.196.42.128   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2013 VMware, Inc."},{"version","3.0.2"}] 1260443690      13146545        63815924        4558257 0       running flow    713.080137      1
> <rabbit at ajtrafp064.1.31824.131> 10.196.42.179:41165 -> 10.196.42.22:5672        5672    41165   10.196.42.22    10.196.42.179   false                           PLAIN                                   {0,9,1} guest   /       600     131072  [{"product","RabbitMQ"},{"information","Licensed under the MPL. See http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright (C) 2007-2013 VMware, Inc."},{"version","3.0.2"}] 1207139221      13617335        66191024        4727907 0       running flow    1314.712837     1

So there are 7 connections here, all of them in the 'running' state, 
which means they should be reading data...

> RabbitMQ Netstat
> Proto Recv-Q Send-Q Local Address               Foreign Address             State
> tcp        0      0 :::5672                     :::*                        LISTEN
> tcp        0      0 ::ffff:10.196.42.21:5672    ::ffff:10.196.42.119:48485  ESTABLISHED
> tcp        0      0 ::ffff:10.196.42.21:5672    ::ffff:10.196.42.120:59485  ESTABLISHED
> tcp        0      0 ::ffff:10.196.42.21:5672    ::ffff:147.243.130.14:34613 ESTABLISHED

But why does this only show three connections? Is that really the 
complete list?

Note that all the above connections show a Recv-Q of 0, indicating that 
rabbit has read all the data from the socket. Contrary to what James 
suggested. Though...

> TSA Client Netstat
> Proto Recv-Q Send-Q Local Address               Foreign Address             State
> tcp        0 246112 ::ffff:10.196.42.182:50012  ::ffff:10.196.42.22:5672    ESTABLISHED

...this client-side blocked connection (as evidenced by the non-zero 
Send-Q) doesn't show up in the server netstat report. Which can't be 
right since that connection *does* show up in the rabbit report (4th row).

So I think something went wrong with the server-side netstat report.

Matthias

From matthias at rabbitmq.com  Tue Feb 12 20:05:55 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 12 Feb 2013 20:05:55 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <511A9EFA.9010909@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>,
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>
Message-ID: <511AA0A3.4090103@rabbitmq.com>

Peter,

On 12/02/13 19:58, Matthias Radestock wrote:
> [rabbitmqctl report] So there are 7 connections here
>
>> RabbitMQ Netstat [...]
> But why does this only show three connections?
> [...]
> So I think something went wrong with the server-side netstat report.

I figured out what happened...

Your broker is clustered. The 'rabbitmqctl report' shows connections 
across the cluster - if you look carefully you'll see that the 'host' 
column has entries for two different IP addresses.

But the 'netstat' command was only run on one of the nodes. 
Unfortunately the blocked connection we are interested in went to the 
other node.

So next time, please run the netstat report on both server nodes.


Regards,

Matthias.

From aggarwalsandeep at optonline.net  Tue Feb 12 22:41:42 2013
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Tue, 12 Feb 2013 14:41:42 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ as messaging hub between .Net and
	JMS based services
In-Reply-To: <c49d8f4f-d8be-4ae8-aa46-3a99d2669389@googlegroups.com>
References: <c49d8f4f-d8be-4ae8-aa46-3a99d2669389@googlegroups.com>
Message-ID: <d57e8aa6-2935-46c7-b902-1d1e7b1199c9@googlegroups.com>

RabbitMQ team-

Could you please share some insight on when are we expecting Rabbit to 
become JMS compatible? We have now implemented RabbitMQ in a clustered mode 
(along with HAProxy in the front) and all initial tests seem to be very 
satisfactory. In the next few weeks and months, I need to be able to use 
this setup as my full blown middleware - including JMS compatibility. I 
understand this feature is in works - please let me know when can I start 
testing it and when would it be production ready. 

Thanks,
Sandy

On Sunday, October 14, 2012 2:39:30 AM UTC-4, Sandeep Aggarwal wrote:
>
> Hi - 
>
> I'm trying to implement RabbitMQ as the core messaging hub to be used in 
> my company in the following configuration. Has someone used Rabbit this way 
> (or something similar)? Please share your experiences. 
>
> 1. Install RabbitMQ broker in the intranet zone for all internal apps. All 
> internal apps use Windows, IIS, .Net stack. We can use the .Net client for 
> RabbitMQ and have done some proof-of-concept testing and seems to be 
> working fine. 
> 2. Install RabbitMQ in the DMZ zone for the external apps such as customer 
> facing web portal (WebLogic, JSF, Oracle) and another vendor app (JBoss, 
> Linux and Oracle). 
> 3. Both of these brokers need to be working in high-availability (HA in 
> active/active) mode.
>
> The problem is that the new vendor app that we are trying to plug in here 
> (under external apps) provides MQ features using JMS. But since this is a 
> vendor app, we don't have access to the source code and we cannot make 
> changes to start using rabbitMQ's Java client for this app. I need to use 
> some JMS compliant messaging provider for this app. For instance, I can use 
> JBoss MQ or otherwise buy IBM MQ (which could always be done technically 
> but it's cost prohibitive for us for now).
>
> I'm trying to figure out if I can use RabbitMQ as a JMS provider? If I can 
> do so in a production environment, then we can keep RabbitMQ as the core 
> messaging backbone for the firm without having to use a different JMS 
> provider. Please share if someone has run into something similar.  
>
> Thx in advance...
>
> Sandy
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130212/40cd7902/attachment.htm>

From iconara at gmail.com  Wed Feb 13 06:39:51 2013
From: iconara at gmail.com (Theo)
Date: Tue, 12 Feb 2013 22:39:51 -0800 (PST)
Subject: [rabbitmq-discuss] How to start a local cluster
In-Reply-To: <041d954d-5f97-4357-a07d-dfbf323e5f60@googlegroups.com>
References: <041d954d-5f97-4357-a07d-dfbf323e5f60@googlegroups.com>
Message-ID: <bd1fd1c0-0951-4698-9f94-dc6eeefc903e@googlegroups.com>

I got some help, so now the script works with all versions from at least 
2.6 and above:

https://gist.github.com/iconara/4760720

T#

On Tuesday, February 12, 2013 8:22:43 AM UTC+1, Theo wrote:
>
> Hi,
>
> I have a bash script that starts a local RabbitMQ cluster, but it was 
> written for 2.6 (or maybe even 2.5) and now it doesn't work anymore. Could 
> you help me fix it to be compatible with 2.8 and 3.0? The only issue, as 
> far as I can tell is that the second node can't start because the 
> management plugin tries to start its web server on the same port as the 
> first node. In my script this was solved by passing -rabbitmq_mochiweb 
> listeners [{mgmt,[{port,$mgmt_port}]}] with a different value for 
> $mgmt_port for each node, but in newer versions it looks like this isn't 
> the way to do it. Also, in 3.0 the management UI is actually starting two 
> web servers (the port number changed and the server on the old port just 
> redirects), and I assume both of those will need to be set.
>
> The script for 2.6 is here:
>
> https://gist.github.com/iconara/4760720
>
> If possible, I would like to use the same script for 2.8 and 3.0 (we're 
> using 2.8 in production, but 3.0 will replace it eventually, so it's good 
> to be able to start test clusters of both versions).
>
> thanks for your help,
> T#
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130212/35d99147/attachment.htm>

From badri at nepallink.net  Wed Feb 13 07:40:41 2013
From: badri at nepallink.net (Badri Nayak)
Date: Tue, 12 Feb 2013 23:40:41 -0800 (PST)
Subject: [rabbitmq-discuss] How i browse web UI by HTTPS
Message-ID: <cb4d6639-1bea-47f7-88bd-fd82adb4f2c2@googlegroups.com>

Greetings, 

I have enabled plugins rabbitmq_management and rabbitmq_management_agent. I 
got web UI without ssl like: http://mydomain.com:15672 but i want with ssl 
like: https://......... What i need to do? 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130212/b46bb450/attachment.htm>

From simlu at su.se  Wed Feb 13 07:40:55 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Wed, 13 Feb 2013 08:40:55 +0100
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
References: <C6E90E05-4AE0-490E-9E45-EC9DE96F03BA@rabbitmq.com>
	<20121211193803.GG754@kaka.it.su.se>
	<4D859580-D762-4BFA-A759-43F94B500FC7@rabbitmq.com>
	<20121212093115.GH754@kaka.it.su.se>
	<8D205910-A3E3-472D-A7AA-8D5737812DC4@rabbitmq.com>
	<20121221093949.GA14329@kaka.it.su.se>
	<53443B9F-8877-4993-9732-35F417AE04F0@rabbitmq.com>
	<05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
	<20130130123105.GO407@kaka.it.su.se>
	<B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
Message-ID: <20130213074055.GC616@kaka.it.su.se>

Sorry for the delay, I've been busy on other things...

I'm glad to report that the NIF branch of my plugin works on 3.x now
with the "true" code.

On Wed, 2013-01-30 at 13:42:03 +0000, Tim Watson wrote:
> >> Here's what I did. Firstly, I tweaked the package.mk so that the plugin got included in the release bundle,
> > 
> > Please elaborate on this. Why should I do this? I use `make dist` when I
> > build the plugin (see below also).
> > 
> 
> Sure, but if you don't put `RELEASABLE:=true` in the package.mk then the plugin doesn't make it into the right directory.

Ah, I see! I've always just copied/symlinked the .ez.

> >> Then I made sure that the hard coded path which the on_load function uses to locate the image was exactly where $RABBITMQ_PLUGINS_EXPAND_DIR points to, plus the app+vsn/priv/.... etc.
> > 
> > Hm, how did you change the path for on_load?
> > 
> 
> Like I said below, I changed it to look in the *right* place:
> 
> Kinit = "/tmp/rabbitmq-rabbit-plugins-scratch/rabbitmq_auth_backend_kerberos-0.0.0/priv/kinit",
> erlang:load_nif(Kinit, 0).

Oh yeah, right. That path was hardcoded. That is the path that I use...
Sorry about that!

> >> I suspect your problem is that you're not calculating the location of the directory into which the plugins are exploded properly. Take a look at rabbit_plugins:setup/0 to see how all these things are calculated, then try and mimic this behaviour to locate your target directory dynamically (and correctly!) at runtime.

Thanks for that, I'll check it out!

Thanks alot yet again!
- Simon

From matthias at rabbitmq.com  Wed Feb 13 08:20:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 13 Feb 2013 08:20:12 +0000
Subject: [rabbitmq-discuss] RabbitMQ as messaging hub between .Net and
 JMS based services
In-Reply-To: <d57e8aa6-2935-46c7-b902-1d1e7b1199c9@googlegroups.com>
References: <c49d8f4f-d8be-4ae8-aa46-3a99d2669389@googlegroups.com>
	<d57e8aa6-2935-46c7-b902-1d1e7b1199c9@googlegroups.com>
Message-ID: <511B4CBC.7090007@rabbitmq.com>

Sandy,

On 12/02/13 22:41, Sandeep Aggarwal wrote:
> Could you please share some insight on when are we expecting Rabbit to
> become JMS compatible?

Development of a JMS client for RabbitMQ, and associated server-side 
support, is ongoing. We should have something ready for testing soon, 
but no decision has been made yet on how this will be distributed. 
Please email support at rabbitmq.com to discuss the options.

Regards,

Matthias.

From simon at rabbitmq.com  Wed Feb 13 08:31:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Feb 2013 08:31:58 +0000
Subject: [rabbitmq-discuss] How i browse web UI by HTTPS
In-Reply-To: <cb4d6639-1bea-47f7-88bd-fd82adb4f2c2@googlegroups.com>
References: <cb4d6639-1bea-47f7-88bd-fd82adb4f2c2@googlegroups.com>
Message-ID: <511B4F7E.6010804@rabbitmq.com>

See http://www.rabbitmq.com/mochiweb.html

Cheers, Simon

On 13/02/2013 7:40AM, Badri Nayak wrote:
> Greetings,
>
> I have enabled plugins rabbitmq_management and
> rabbitmq_management_agent. I got web UI without ssl like:
> http://mydomain.com:15672 but i want with ssl like: https://.........
> What i need to do?
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From badri at nepallink.net  Wed Feb 13 09:08:17 2013
From: badri at nepallink.net (Badri Nayak)
Date: Wed, 13 Feb 2013 14:53:17 +0545
Subject: [rabbitmq-discuss] How i browse web UI by HTTPS
In-Reply-To: <511B4F7E.6010804@rabbitmq.com>
References: <cb4d6639-1bea-47f7-88bd-fd82adb4f2c2@googlegroups.com>
	<511B4F7E.6010804@rabbitmq.com>
Message-ID: <CAK5jQ=bte56=kJMfdVzB5mjjwjAih9+SH_31DDkqgXf8DLOPeA@mail.gmail.com>

I had followed this and edited rabbitmq.conf file as:

[
  {rabbit, [
     {ssl_listeners, [5671]},
     {ssl_options, [{cacertfile,"/path of cert/cacert.pem"},
                    {certfile,"/path of cert/cert.pem"},
                    {keyfile,"/path of key file/key.pem"},
                    {verify,verify_none},
                    {fail_if_no_peer_cert,false}]}
]},
{rabbitmq_management,
  [{listener, [{port,     15672},
               {ssl,      true},
               ]
   }
  ]
}
].

It breaks my service. Can you suggest on it?


On Wed, Feb 13, 2013 at 2:16 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> See http://www.rabbitmq.com/**mochiweb.html<http://www.rabbitmq.com/mochiweb.html>
>
> Cheers, Simon
>
> On 13/02/2013 7:40AM, Badri Nayak wrote:
>
>> Greetings,
>>
>> I have enabled plugins rabbitmq_management and
>> rabbitmq_management_agent. I got web UI without ssl like:
>> http://mydomain.com:15672 but i want with ssl like: https://.........
>> What i need to do?
>>
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>


-- 
Warm Regards
Badri Nayak
NepalLink Network, Kathmandu
www.nepallink.net

The information contained in this e-mail and any accompanying documents may
contain information that is confidential or otherwise protected from
disclosure. If you are not the intended recipient of this message, please
immediately alert the sender by reply e-mail and then delete this message.
Any dissemination, distribution or other use of the contents of this
message by anyone other than the intended recipient is strictly prohibited.
Nepallink Network has taken every reasonable precaution to minimize the
risk, but is not liable for any damage you may sustain as a result of any
virus in this e-mail. You should carry out your own virus checks before
opening the e-mail or attachment.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/f936e303/attachment.htm>

From emile at rabbitmq.com  Wed Feb 13 09:55:19 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 13 Feb 2013 09:55:19 +0000
Subject: [rabbitmq-discuss] How i browse web UI by HTTPS
In-Reply-To: <CAK5jQ=bte56=kJMfdVzB5mjjwjAih9+SH_31DDkqgXf8DLOPeA@mail.gmail.com>
References: <cb4d6639-1bea-47f7-88bd-fd82adb4f2c2@googlegroups.com>
	<511B4F7E.6010804@rabbitmq.com>
	<CAK5jQ=bte56=kJMfdVzB5mjjwjAih9+SH_31DDkqgXf8DLOPeA@mail.gmail.com>
Message-ID: <511B6307.4030202@rabbitmq.com>

Hi,

On 13/02/13 09:08, Badri Nayak wrote:
>      {ssl_options, [{cacertfile,"/path of cert/cacert.pem"},
>                     {certfile,"/path of cert/cert.pem"},
>                     {keyfile,"/path of key file/key.pem"},

This is an example config. Unless you happen to have valid certificate
and key files stored in folders named "/path of cert/" and "/path of key
file/" it won't work.

> It breaks my service. Can you suggest on it?

If you still have problems after setting up SSL as described here:
 http://www.rabbitmq.com/ssl.html
then please see the SSL troubleshooting guide:
 http://www.rabbitmq.com/troubleshooting-ssl.html

If you still have problems then get back to us with information from the
logfile or console, version or Erlang and any other relevant information
that will help diagnosis.




-Emile






From badri at nepallink.net  Wed Feb 13 10:29:02 2013
From: badri at nepallink.net (Badri Nayak)
Date: Wed, 13 Feb 2013 16:14:02 +0545
Subject: [rabbitmq-discuss] How i browse web UI by HTTPS
In-Reply-To: <511B6307.4030202@rabbitmq.com>
References: <cb4d6639-1bea-47f7-88bd-fd82adb4f2c2@googlegroups.com>
	<511B4F7E.6010804@rabbitmq.com>
	<CAK5jQ=bte56=kJMfdVzB5mjjwjAih9+SH_31DDkqgXf8DLOPeA@mail.gmail.com>
	<511B6307.4030202@rabbitmq.com>
Message-ID: <CAK5jQ=Yr40zm6t_kEb7R06MxmTGF_A1jmWBuXU80f3Ksq7LZFA@mail.gmail.com>

Hi,

This is valid. I want to know that the contents are OK with rabbitmq.conf
file or else need to change the contents?  I want SSL and non-ssl to be
browsed via Web UI. Please suggest me on it. I am stocking on it.


On Wed, Feb 13, 2013 at 3:40 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 13/02/13 09:08, Badri Nayak wrote:
> >      {ssl_options, [{cacertfile,"/path of cert/cacert.pem"},
> >                     {certfile,"/path of cert/cert.pem"},
> >                     {keyfile,"/path of key file/key.pem"},
>
> This is an example config. Unless you happen to have valid certificate
> and key files stored in folders named "/path of cert/" and "/path of key
> file/" it won't work.
>
> > It breaks my service. Can you suggest on it?
>
> If you still have problems after setting up SSL as described here:
>  http://www.rabbitmq.com/ssl.html
> then please see the SSL troubleshooting guide:
>  http://www.rabbitmq.com/troubleshooting-ssl.html
>
> If you still have problems then get back to us with information from the
> logfile or console, version or Erlang and any other relevant information
> that will help diagnosis.
>
>
>
>
> -Emile
>
>
>
>
>
>


-- 
Warm Regards
Badri Nayak
NepalLink Network, Kathmandu
www.nepallink.net

The information contained in this e-mail and any accompanying documents may
contain information that is confidential or otherwise protected from
disclosure. If you are not the intended recipient of this message, please
immediately alert the sender by reply e-mail and then delete this message.
Any dissemination, distribution or other use of the contents of this
message by anyone other than the intended recipient is strictly prohibited.
Nepallink Network has taken every reasonable precaution to minimize the
risk, but is not liable for any damage you may sustain as a result of any
virus in this e-mail. You should carry out your own virus checks before
opening the e-mail or attachment.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/c15e1877/attachment.htm>

From emile at rabbitmq.com  Wed Feb 13 10:47:11 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 13 Feb 2013 10:47:11 +0000
Subject: [rabbitmq-discuss] How i browse web UI by HTTPS
In-Reply-To: <CAK5jQ=Yr40zm6t_kEb7R06MxmTGF_A1jmWBuXU80f3Ksq7LZFA@mail.gmail.com>
References: <cb4d6639-1bea-47f7-88bd-fd82adb4f2c2@googlegroups.com>
	<511B4F7E.6010804@rabbitmq.com>
	<CAK5jQ=bte56=kJMfdVzB5mjjwjAih9+SH_31DDkqgXf8DLOPeA@mail.gmail.com>
	<511B6307.4030202@rabbitmq.com>
	<CAK5jQ=Yr40zm6t_kEb7R06MxmTGF_A1jmWBuXU80f3Ksq7LZFA@mail.gmail.com>
Message-ID: <511B6F2F.3030809@rabbitmq.com>

Hi,

On 13/02/13 10:29, Badri Nayak wrote:
> This is valid.

If it is valid then these commands should return something sensible:
 openssl x509 -text -in "/path of cert/cacert.pem"
 openssl x509 -text -in "/path of cert/cert.pem"
 openssl rsa  -text -in "/path of key file/key.pem"

> I want to know that the contents are OK with rabbitmq.conf file

The config should be in a file named rabbitmq.config instead of
rabbitmq.conf . You can confirm what configuration is in effect by
inspecting the output of "rabbitmqctl environment".

If you have trouble setting up SSL after following
  http://www.rabbitmq.com/ssl.html
then check whether this helps:
  http://www.rabbitmq.com/troubleshooting-ssl.html
Otherwise please let us know the details of the problem.



-Emile








From rob at bsdsoftware.co.il  Wed Feb 13 13:18:37 2013
From: rob at bsdsoftware.co.il (Rob Woolfson)
Date: Wed, 13 Feb 2013 15:18:37 +0200
Subject: [rabbitmq-discuss] creating connections to RMQ
Message-ID: <CAEuJcXOWoXnSgwRcgAo8c2F+UuV3zmA65QG2RO694cgXxcgSnQ@mail.gmail.com>

On Server 1 (S1) we have a producer (P1) and a consumer (C1), P1 sends
messages to a consumer (C2) on a Server (S2), which replies to S1 by
sending messages from producer (P2) to the consumer on S1, C1.

The system creates a queue for C1 to receive a reply before P1 publishes a
message to the exchange.  This way there is no possibility that P2 can
publish a message to the exchange that C1 will miss.

We may have been using bad practice up until now as we have been creating
doing the following:
create new connection to RMQ
create new channel on connection
declare exchange (it is durable so it always exists)
declare queue (this is a new queue everytime)
bind queue to exchange
P1 sends message to exchange
C1 starts queueDevliery loop to wait for replies.

The problem here is that the messages that P1 sends are time sensitive and
C1 cannot miss any of the replies.  The startup time for a new connection
seems to be the biggest delay channel is the next slowest and the others
are non trivial.

What is the suggested best practice for speeding up my process?

Thanks

-- 
Rob Woolfson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/903b2466/attachment.htm>

From ratner2 at gmail.com  Wed Feb 13 14:33:55 2013
From: ratner2 at gmail.com (bratner bratner)
Date: Wed, 13 Feb 2013 16:33:55 +0200
Subject: [rabbitmq-discuss] Very slow get (dequeue) on node B if shovel on
 node A is configured with {ack_mode, on_confirm}
Message-ID: <CAHA3fyVQjorpxtqyMY-kNow83hCYHKkuGstRmq5d8Rg7FJATXw@mail.gmail.com>

Hi!

My setup includes a rabbitmq-c application that publishes messages on node
A.
The publishing rate is about 200mps, each message can be up to 10Kb.

Shovel (node A) is configured to move them to node B.
On node B i'm dequeuing the messages with a PHP test script with
$queue->get(AMQP_AUTOACK).
If i keep the publishing rate at 200mps then i can see that the queue on
node A is empty and the Q on node B is
filling up. The read-rate of my test script is really low.

If i stop the publishing, 3-5 seconds later, my test script starts reading
like crazy until the queue on node B is empty.

Even If I slow down the publishing rate to 5mps , same is happening ,
messages are piling up on node B until i dial down the pressure.

This problem disappears if I set ack_mode to on_publish or no_ack. In this
case the reader script reads with the publishing speed.

My configuration :



[
{rabbit, [
{log_levels, [{connection, error}]}
]},
{rabbitmq_shovel,
[ {shovels, [ {messagemover, [
{sources, [
{broker, "amqp://usera:pass at localhost/vhosta<amqp://cdrposter:4VkI6MKH at localhost/sipout>
"},
{declarations, [
{'exchange.declare',[{exchange, <<"my-fanout">>},{type,
<<"fanout">>},durable]},
{'queue.declare',[{queue,<<"messages">>},durable]},
{'queue.bind',[{exchange, <<"my-fanout">>},{queue, <<"messages">>}]}
]}
]},
{destinations, [
{brokers, [ "amqp://userb:pass at nodeB/vhostb<amqp://cdr_manager:Ci2XOb3b at 10.200.10.218/cdrs>"
]},
{declarations, [
{'exchange.declare',[{exchange, <<"my-fanout">>},{type,
<<"fanout">>},durable]},
{'queue.declare',[{queue,<<"messages">>},durable]},
{'queue.bind',[{exchange, <<"my-fanout">>},{queue, <<"messages">>}]}
]}
]},
{queue, <<"messages">>},
{prefetch_count, 200},
{ack_mode, on_confirm},
{publish_properties, [{delivery_mode, 2}]},
{reconnect_delay, 5}
]}
]}
]}
].


Thank you,
Boris.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/d4467be0/attachment.htm>

From ckrvijaykrishna53 at gmail.com  Wed Feb 13 12:32:38 2013
From: ckrvijaykrishna53 at gmail.com (C.K.R.VIJAY Krishna)
Date: Wed, 13 Feb 2013 04:32:38 -0800 (PST)
Subject: [rabbitmq-discuss] Queue binding option in rabbit.js
Message-ID: <1bc62e0f-0ffc-4f92-affd-77733340cd44@googlegroups.com>

Hi,
      Please provide rabbit.js sample code  which is used to create a 
queue,bind the queue to an exchange that is already present in rabbitmq 
server,able to provide routing key to an excahnge. I have done this using 
node-amqp but i am facing issues while doing the same with rabbit.js

please find below code that is implemented by using node-ampq .I want this 
code to be translated to rabbit.js

sample code:

 connection.queue('queue_name', {exclusive: true},
                         function(queue){
            queue.bind('exchange_name','vijay.cr.*');

            queue.subscribe(function(msg){
                console.log(" [x] %s", JSON.stringify(msg, null, 2));
            });

Thanks & Regards,
Vijay.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/fd3a69c7/attachment.htm>

From simon at rabbitmq.com  Wed Feb 13 15:51:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Feb 2013 15:51:05 +0000
Subject: [rabbitmq-discuss] creating connections to RMQ
In-Reply-To: <CAEuJcXOWoXnSgwRcgAo8c2F+UuV3zmA65QG2RO694cgXxcgSnQ@mail.gmail.com>
References: <CAEuJcXOWoXnSgwRcgAo8c2F+UuV3zmA65QG2RO694cgXxcgSnQ@mail.gmail.com>
Message-ID: <511BB669.2030309@rabbitmq.com>

On 13/02/13 13:18, Rob Woolfson wrote:
> What is the suggested best practice for speeding up my process?

There are several things you can do:

Creating a new connection / channel takes several network round trips - 
can you get P1 to keep a connection / channel open?

Creating a new queue is quite expensive (especially if it's durable) - 
can C1 reuse its reply queue?

Declaring / binding the queue and exchange, and consuming from the queue 
also takes some network round trips by default, since each AMQP method 
will cause a corresponding -ok method to be sent back. To eliminate the 
round trips you can use the nowait parameter to declare / bind / consume 
- this prevents an -ok method from coming back, so all the requests can 
be pipelined. Alternatively if your reply queue is reused you can skip 
redeclaring it each time, just declare it and consume from it once.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb 13 15:52:51 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Feb 2013 15:52:51 +0000
Subject: [rabbitmq-discuss] Very slow get (dequeue) on node B if shovel
 on node A is configured with {ack_mode, on_confirm}
In-Reply-To: <CAHA3fyVQjorpxtqyMY-kNow83hCYHKkuGstRmq5d8Rg7FJATXw@mail.gmail.com>
References: <CAHA3fyVQjorpxtqyMY-kNow83hCYHKkuGstRmq5d8Rg7FJATXw@mail.gmail.com>
Message-ID: <511BB6D3.9080205@rabbitmq.com>

That sounds very wrong.

Which version of RabbitMQ are you using? Can you post (a cut down 
version of) your PHP script somewhere? (I have no familiarity with the 
PHP client but I'd like to see what it's doing...)

Cheers, Simon

On 13/02/13 14:33, bratner bratner wrote:
> Hi!
>
> My setup includes a rabbitmq-c application that publishes messages on
> node A.
> The publishing rate is about 200mps, each message can be up to 10Kb.
>
> Shovel (node A) is configured to move them to node B.
> On node B i'm dequeuing the messages with a PHP test script with
> $queue->get(AMQP_AUTOACK).
> If i keep the publishing rate at 200mps then i can see that the queue on
> node A is empty and the Q on node B is
> filling up. The read-rate of my test script is really low.
>
> If i stop the publishing, 3-5 seconds later, my test script starts
> reading like crazy until the queue on node B is empty.
>
> Even If I slow down the publishing rate to 5mps , same is happening ,
> messages are piling up on node B until i dial down the pressure.
>
> This problem disappears if I set ack_mode to on_publish or no_ack. In
> this case the reader script reads with the publishing speed.
>
> My configuration :
>
>
>
> [
> {rabbit, [
> {log_levels, [{connection, error}]}
> ]},
> {rabbitmq_shovel,
> [ {shovels, [ {messagemover, [
> {sources, [
> {broker, "amqp://usera:pass at localhost/vhosta
> <amqp://cdrposter:4VkI6MKH at localhost/sipout>"},
> {declarations, [
> {'exchange.declare',[{exchange, <<"my-fanout">>},{type,
> <<"fanout">>},durable]},
> {'queue.declare',[{queue,<<"messages">>},durable]},
> {'queue.bind',[{exchange, <<"my-fanout">>},{queue, <<"messages">>}]}
> ]}
> ]},
> {destinations, [
> {brokers, [ "amqp://userb:pass at nodeB/vhostb
> <amqp://cdr_manager:Ci2XOb3b at 10.200.10.218/cdrs>" ]},
> {declarations, [
> {'exchange.declare',[{exchange, <<"my-fanout">>},{type,
> <<"fanout">>},durable]},
> {'queue.declare',[{queue,<<"messages">>},durable]},
> {'queue.bind',[{exchange, <<"my-fanout">>},{queue, <<"messages">>}]}
> ]}
> ]},
> {queue, <<"messages">>},
> {prefetch_count, 200},
> {ack_mode, on_confirm},
> {publish_properties, [{delivery_mode, 2}]},
> {reconnect_delay, 5}
> ]}
> ]}
> ]}
> ].
>
>
> Thank you,
> Boris.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From rob at bsdsoftware.co.il  Wed Feb 13 16:26:33 2013
From: rob at bsdsoftware.co.il (Rob Woolfson)
Date: Wed, 13 Feb 2013 18:26:33 +0200
Subject: [rabbitmq-discuss] creating connections to RMQ
In-Reply-To: <511BB669.2030309@rabbitmq.com>
References: <CAEuJcXOWoXnSgwRcgAo8c2F+UuV3zmA65QG2RO694cgXxcgSnQ@mail.gmail.com>
	<511BB669.2030309@rabbitmq.com>
Message-ID: <CAEuJcXNXC6ai3K1NNHBUegJgvh_X97bi5dAWYHxKXwq8q38rCQ@mail.gmail.com>

We are looking at the best way to use only one connection and have only the
channel created each time.  Bear in mind that its all happening on the same
physical server and the servers that I refer to are actually software
services as opposed to different physical machines.  So network latency
shouldnt be a big problem here.

It is possible I need to rethink my strategy a little.

The application is for trading.

S1 receives a signal to open a trade and sends the order to S2 which is
responsible for sending the trade to the brokers.  When S1 receives a
signal to open the trade it creates an object to manage all the
communication back and forth between the broker.  So it creates a queue
that will route all incoming messages to do with that specific trade back
to the object.  For this reason the object (which is a new object for each
trade) will create a new channel, queue and binding, specifically for the
life of the trade.

Thanks for the suggestions, I may need to think about this process and
decide which is the best way to use RMQ.




On Wed, Feb 13, 2013 at 5:51 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 13/02/13 13:18, Rob Woolfson wrote:
>
>> What is the suggested best practice for speeding up my process?
>>
>
> There are several things you can do:
>
> Creating a new connection / channel takes several network round trips -
> can you get P1 to keep a connection / channel open?
>
> Creating a new queue is quite expensive (especially if it's durable) - can
> C1 reuse its reply queue?
>
> Declaring / binding the queue and exchange, and consuming from the queue
> also takes some network round trips by default, since each AMQP method will
> cause a corresponding -ok method to be sent back. To eliminate the round
> trips you can use the nowait parameter to declare / bind / consume - this
> prevents an -ok method from coming back, so all the requests can be
> pipelined. Alternatively if your reply queue is reused you can skip
> redeclaring it each time, just declare it and consume from it once.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Rob Woolfson - CTO
mobile:+972-544904157
office:+972-3-5353751
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/8867244b/attachment.htm>

From stuff at moesel.net  Wed Feb 13 21:17:14 2013
From: stuff at moesel.net (Chris)
Date: Wed, 13 Feb 2013 16:17:14 -0500
Subject: [rabbitmq-discuss] Performance of One vs. Many Topic Exchanges
Message-ID: <CAHEpgBBqieqdoF=cr=Qr33hQ=9CsBgB--wzn_Y7s330tsukKjw@mail.gmail.com>

I am implementing an abstraction over dynamic pub/sub.  The idea is that
you have named "themes", and within those themes you have "subjects" that
can be used as a filter.  Themes may or may not be transient.

I think have two choices:

1) Each named "theme" is a separate topic exchange and "subjects" map
directly to routing keys *(i.e., "stocks" topic exchange, with messages
having routing keys like "nasdaq.apple.price")*.

2) There is a single topic exchange and the routing key is a composite of
theme and subject *(i.e., "themes" topic exchange, with messages having
routing keys like "theme.stocks.subject.nasdaq.apple.price")*.

Although #1 has a better one-to-one mapping to my problem, I am inclined to
go with #2 because it is much easier to manage (a single exchange that
never gets deleted, vs many exchanges that I must manage the lifecycle of).

The only thing I am unsure of is if there is any difference in performance?
 Multiple exchanges are more expensive in memory, but will a single
exchange need more CPU to route messages because it is dealing with so many
more disparate bindings?

Thanks for any guidance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/3ba7ba06/attachment.htm>

From peter.konar at nokia.com  Wed Feb 13 21:27:17 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Wed, 13 Feb 2013 15:27:17 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <511AA0A3.4090103@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>, 
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>

Happened again

Netstat client

[pkonar at ajtrafp057 ~]$ netstat -an | grep 5672
tcp        0 189824 ::ffff:10.196.42.182:49191  ::ffff:10.196.42.21:5672    ESTABLISHED

netstat server
[pkonar at ajtrafp063 ~]$ netstat -an | grep 182
tcp   574331      0 ::ffff:10.196.42.21:5672    ::ffff:10.196.42.182:49191  ESTABLISHED





"pool-6-thread-3" prio=10 tid=0x00000000018c2000 nid=0x4ed runnable [0x00007f19d34f3000]
   java.lang.Thread.State: RUNNABLE
        at java.net.SocketOutputStream.$$YJP$$socketWrite0(Native Method)
        at java.net.SocketOutputStream.socketWrite0(SocketOutputStream.java)
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:109)
        at java.net.SocketOutputStream.write(SocketOutputStream.java:153)
        at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)
        at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)
        - locked <0x00000007018815c0> (a java.io.BufferedOutputStream)
        at java.io.DataOutputStream.flush(DataOutputStream.java:123)
        at com.rabbitmq.client.impl.SocketFrameHandler.flush(SocketFrameHandler.java:142)
        at com.rabbitmq.client.impl.AMQConnection.flush(AMQConnection.java:488)
        at com.rabbitmq.client.impl.AMQCommand.transmit(AMQCommand.java:125)
        at com.rabbitmq.client.impl.AMQChannel.quiescingTransmit(AMQChannel.java:316)
        - locked <0x00000007512100b8> (a java.lang.Object)
        at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:292)
        - locked <0x00000007512100b8> (a java.lang.Object)
        at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:634)
        at sun.reflect.GeneratedMethodAccessor76.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:601)
        at org.springframework.amqp.rabbit.connection.CachingConnectionFactory$CachedChannelInvocationHandler.invoke(CachingConnectionFactory.java:348)
        - locked <0x00000007512102f8> (a java.lang.Object)
        at $Proxy59.basicPublish(Unknown Source)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.doSend(RabbitTemplate.java:648)
        at org.springframework.amqp.rabbit.core.RabbitTemplate$1.doInRabbit(RabbitTemplate.java:331)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.execute(RabbitTemplate.java:600)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:329)
        at org.springframework.amqp.rabbit.core.RabbitTemplate.send(RabbitTemplate.java:323)
        at com.nokia.traffic.flowdata.transport.rabbitmq.RabbitMQSender.send(RabbitMQSender.java:53)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.doSend_aroundBody4(TrafficStateAccumulatorMP.java:183)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP$AjcClosure5.run(TrafficStateAccumulatorMP.java:1)
        at org.aspectj.runtime.reflect.JoinPointImpl.proceed(JoinPointImpl.java:149)
        at com.nokia.traffic.ttbhm.audit.MessageGroupingAspect.dispatchOutput(MessageGroupingAspect.java:70)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.doSend(TrafficStateAccumulatorMP.java:182)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.trySendingALinear(TrafficStateAccumulatorMP.java:140)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.onSendLinear_aroundBody2(TrafficStateAccumulatorMP.java:115)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP$AjcClosure3.run(TrafficStateAccumulatorMP.java:1)
        at org.aspectj.runtime.reflect.JoinPointImpl.proceed(JoinPointImpl.java:149)
        at com.nokia.traffic.ttbhm.audit.MessageGroupingAspect.outputHandler(MessageGroupingAspect.java:231)
        at com.nokia.traffic.ttbhm.mp.linearstate.TrafficStateAccumulatorMP.onSendLinear(TrafficStateAccumulatorMP.java:113)
        at sun.reflect.GeneratedMethodAccessor72.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:601)
        at com.nokia.dempsy.container.internal.LifecycleHelper.invokeOutput(LifecycleHelper.java:178)
        at com.nokia.dempsy.container.MpContainer.invokeOperation(MpContainer.java:1160)
        at com.nokia.dempsy.container.MpContainer.access$600(MpContainer.java:70)
        at com.nokia.dempsy.container.MpContainer$6.run(MpContainer.java:924)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
        at java.lang.Thread.run(Thread.java:722)




________________________________________
From: ext Matthias Radestock [matthias at rabbitmq.com]
Sent: Tuesday, February 12, 2013 2:05 PM
To: Discussions about RabbitMQ
Cc: Konar Peter (Nokia-LC/Chicago); Yu Jerry.3 (Nokia-LC/Alpharetta); Carroll James (Nokia-LC/Malvern); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 12/02/13 19:58, Matthias Radestock wrote:
> [rabbitmqctl report] So there are 7 connections here
>
>> RabbitMQ Netstat [...]
> But why does this only show three connections?
> [...]
> So I think something went wrong with the server-side netstat report.

I figured out what happened...

Your broker is clustered. The 'rabbitmqctl report' shows connections
across the cluster - if you look carefully you'll see that the 'host'
column has entries for two different IP addresses.

But the 'netstat' command was only run on one of the nodes.
Unfortunately the blocked connection we are interested in went to the
other node.

So next time, please run the netstat report on both server nodes.


Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_report
Type: application/octet-stream
Size: 14875 bytes
Desc: rabbit_report
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/399a9288/attachment.obj>

From matthias at rabbitmq.com  Wed Feb 13 21:41:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 13 Feb 2013 21:41:34 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>,
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>, <511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
Message-ID: <511C088E.7070908@rabbitmq.com>

Peter,

On 13/02/13 21:27, Konar Peter (Nokia-LC/Chicago) wrote:
> Happened again
>
> Netstat client
>
> [pkonar at ajtrafp057 ~]$ netstat -an | grep 5672
> tcp        0 189824 ::ffff:10.196.42.182:49191  ::ffff:10.196.42.21:5672    ESTABLISHED
>
> netstat server
> [pkonar at ajtrafp063 ~]$ netstat -an | grep 182
> tcp   574331      0 ::ffff:10.196.42.21:5672    ::ffff:10.196.42.182:49191  ESTABLISHED

That connection does indeed have a non-empty Send-Q at the server end 
and is evidently not being read from.

Curiously, the 'rabbitmqctl report' shows no entry for that connection. 
There is one for a source ip/port of 10.196.42.182:55741 (which, 
conversely, does not show up in netstat), but not :49191.

In which order did you run the netstat and 'rabbitmqctl report' 
commands, and what time gap was there between them?

Also, please check the rabbit.log for entries relating to the connection 
from port 10.196.42.182:49191 and post them here.

Regards,

Matthias.

From peter.konar at nokia.com  Wed Feb 13 22:30:07 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Wed, 13 Feb 2013 16:30:07 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <511C088E.7070908@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>, 
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>

There was maybe 2mins between command, sending new output scripted to run sequentially. Order of the operations was
Client netstat
Server netstat
Server report

Thanks
Peter Konar


-----Original Message-----
From: ext Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Wednesday, February 13, 2013 3:42 PM
To: Konar Peter (Nokia-LC/Chicago)
Cc: Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Carroll James (Nokia-LC/Malvern); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 13/02/13 21:27, Konar Peter (Nokia-LC/Chicago) wrote:
> Happened again
>
> Netstat client
>
> [pkonar at ajtrafp057 ~]$ netstat -an | grep 5672
> tcp        0 189824 ::ffff:10.196.42.182:49191  ::ffff:10.196.42.21:5672    ESTABLISHED
>
> netstat server
> [pkonar at ajtrafp063 ~]$ netstat -an | grep 182
> tcp   574331      0 ::ffff:10.196.42.21:5672    ::ffff:10.196.42.182:49191  ESTABLISHED

That connection does indeed have a non-empty Send-Q at the server end and is evidently not being read from.

Curiously, the 'rabbitmqctl report' shows no entry for that connection.
There is one for a source ip/port of 10.196.42.182:55741 (which, conversely, does not show up in netstat), but not :49191.

In which order did you run the netstat and 'rabbitmqctl report'
commands, and what time gap was there between them?

Also, please check the rabbit.log for entries relating to the connection from port 10.196.42.182:49191 and post them here.

Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: netstat.10.196.42.21.out
Type: application/octet-stream
Size: 9638 bytes
Desc: netstat.10.196.42.21.out
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/213c8400/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: netstat.10.196.42.182.out
Type: application/octet-stream
Size: 13339 bytes
Desc: netstat.10.196.42.182.out
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/213c8400/attachment-0001.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit-report.10.196.42.21.out
Type: application/octet-stream
Size: 14676 bytes
Desc: rabbit-report.10.196.42.21.out
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/213c8400/attachment-0002.obj>

From matthias at rabbitmq.com  Wed Feb 13 22:47:32 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 13 Feb 2013 22:47:32 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>,
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>, <511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
Message-ID: <511C1804.9090105@rabbitmq.com>

Peter,

On 13/02/13 22:30, Konar Peter (Nokia-LC/Chicago) wrote:
> There was maybe 2mins between command, sending new output scripted to
> run sequentially. Order of the operations was
> Client netstat
> Server netstat
> Server report

This isn't showing anything going wrong. There are no Send-Q's on the 
client netstat, and no Recv-Q's on the server netstat. The 
10.196.42.182:49191 connection, which exhibited both of these, is 
nowhere to be seen.

Did you check the rabbit.log for what happened to 10.196.42.182:49191?

Regards,

Matthias.

From james.carroll at nokia.com  Wed Feb 13 23:01:25 2013
From: james.carroll at nokia.com (Carroll James (Nokia-LC/Malvern))
Date: Wed, 13 Feb 2013 17:01:25 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>, 
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
Message-ID: <D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>

Matthias.

Sorry about this. I did this with Pete. We grabbed the data in the original email and THEN I decided to save off full netstats, jstacks and rebbitmqctrl reports (which we didn't reexamine, assuming they hadn't changed over the 3 minutes where we were looking at it). These later files are what he sent you in the followup. It looks like something changed in between, and perhaps in between the netstat and the rabbitctrl report.

We will make another attempt to capture all of the data.

Sorry again
Jim

-----Original Message-----
From: Konar Peter (Nokia-LC/Chicago)
Sent: Wednesday, February 13, 2013 5:30 PM
To: ext Matthias Radestock
Cc: Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Carroll James (Nokia-LC/Malvern); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: RE: [rabbitmq-discuss] RabbitMQ blocking issue

There was maybe 2mins between command, sending new output scripted to run sequentially. Order of the operations was Client netstat Server netstat Server report

Thanks
Peter Konar


-----Original Message-----
From: ext Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: Wednesday, February 13, 2013 3:42 PM
To: Konar Peter (Nokia-LC/Chicago)
Cc: Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Carroll James (Nokia-LC/Malvern); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 13/02/13 21:27, Konar Peter (Nokia-LC/Chicago) wrote:
> Happened again
>
> Netstat client
>
> [pkonar at ajtrafp057 ~]$ netstat -an | grep 5672
> tcp        0 189824 ::ffff:10.196.42.182:49191  ::ffff:10.196.42.21:5672    ESTABLISHED
>
> netstat server
> [pkonar at ajtrafp063 ~]$ netstat -an | grep 182
> tcp   574331      0 ::ffff:10.196.42.21:5672    ::ffff:10.196.42.182:49191  ESTABLISHED

That connection does indeed have a non-empty Send-Q at the server end and is evidently not being read from.

Curiously, the 'rabbitmqctl report' shows no entry for that connection.
There is one for a source ip/port of 10.196.42.182:55741 (which, conversely, does not show up in netstat), but not :49191.

In which order did you run the netstat and 'rabbitmqctl report'
commands, and what time gap was there between them?

Also, please check the rabbit.log for entries relating to the connection from port 10.196.42.182:49191 and post them here.

Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.

From matthias at rabbitmq.com  Wed Feb 13 23:15:18 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 13 Feb 2013 23:15:18 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>,
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>, <511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>
Message-ID: <511C1E86.3050004@rabbitmq.com>

James,

On 13/02/13 23:01, Carroll James (Nokia-LC/Malvern) wrote:
> It looks like something changed in between, and perhaps in between
> the netstat and the rabbitctrl report.

The latter is the most obvious explanation, yes.

> We will make another attempt to capture all of the data.

If you haven't nuked the server logs, the lifecycle of the 
10.196.42.182:49191 connection should still be visible in rabbit.log; 
just search the log for that ip & port. Would be good to get hold of the 
log entries pertaining to that connection since I am curious what 
(rabbit thought) happened to it.

Matthias.

From james.carroll at nokia.com  Wed Feb 13 23:40:45 2013
From: james.carroll at nokia.com (Carroll James (Nokia-LC/Malvern))
Date: Wed, 13 Feb 2013 17:40:45 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <511C1E86.3050004@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>, 
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
Message-ID: <D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>


Yup. The times are about right. See the connections from 182. The first email show port 49191 which was opened at 15:17 GMT. It was hung for quite a while before we got to it but the server closed it at 21:22 and opened a new one. That's around the time we were in there.

If it matters the log is attached.
________________________________________
From: ext Matthias Radestock [matthias at rabbitmq.com]
Sent: Wednesday, February 13, 2013 6:15 PM
To: Carroll James (Nokia-LC/Malvern)
Cc: Konar Peter (Nokia-LC/Chicago); Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

James,

On 13/02/13 23:01, Carroll James (Nokia-LC/Malvern) wrote:
> It looks like something changed in between, and perhaps in between
> the netstat and the rabbitctrl report.

The latter is the most obvious explanation, yes.

> We will make another attempt to capture all of the data.

If you haven't nuked the server logs, the lifecycle of the
10.196.42.182:49191 connection should still be visible in rabbit.log;
just search the log for that ip & port. Would be good to get hold of the
log entries pertaining to that connection since I am curious what
(rabbit thought) happened to it.

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.10.196.42.22.log
Type: text/x-log
Size: 8220 bytes
Desc: rabbit.10.196.42.22.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/250d1200/attachment.bin>

From gmr at meetme.com  Thu Feb 14 01:35:10 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 13 Feb 2013 20:35:10 -0500
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-ldap patch adding caching
 and subtree searches
Message-ID: <41D6077904114EDB84E046045D297E66@meetme.com>

Hi all, 

Attached to this email is a patch that refactors rabbitmq-auth-backend-ldap a bit to allow it to use subtree searches and it caches the connection to the LDAP server. Would anyone on the RabbitMQ team be so kind as to code-review it and offer suggestions on how it can be improved for possible inclusion in Rabbit?

My fork is on Github as well https://github.com/gmr/rabbitmq-auth-backend-ldap if anyone wants to offer feedback or try it out.

I ran the tests against the current tip version and my version and they pass and fail at the same spots, which I'm assuming is a good thing.

Regards,

Gavin 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/0c37e6c2/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq-auth-backend-ldap-patch_commit_af1da79fbab6.patch
Type: application/octet-stream
Size: 20119 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/0c37e6c2/attachment.obj>

From matthias at rabbitmq.com  Thu Feb 14 08:21:18 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 14 Feb 2013 08:21:18 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>,
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>, <511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>
Message-ID: <511C9E7E.1@rabbitmq.com>

James,

On 13/02/13 23:40, Carroll James (Nokia-LC/Malvern) wrote:
> Yup. The times are about right. See the connections from 182. The
> first email show port 49191 which was opened at 15:17 GMT. It was
> hung for quite a while before we got to it but the server closed it
> at 21:22 and opened a new one. That's around the time we were in
> there.
>
> If it matters the log is attached.

Here's the relevant portion:

<quote>
=INFO REPORT==== 13-Feb-2013::15:17:00 ===
accepting AMQP connection <0.2252.1282> (10.196.42.182:49191 -> 
10.196.42.21:5672)

=ERROR REPORT==== 13-Feb-2013::21:22:01 ===
closing AMQP connection <0.2252.1282> (10.196.42.182:49191 -> 
10.196.42.21:5672):
{heartbeat_timeout,running}
</quote>

So the connection was open for quite a while and then got closed due to 
a missed heartbeat.

The default heartbeat interval is 10 minutes, but the server will only 
time out between two and three intervals after the last data has been 
received, so it could take up to half an hour for the server to kill a 
connection that has gone bad.

The question is why the server isn't seeing any data. There are two 
obvious explanations:
a) there is a network disruption, and
b) the server has stopped reading from the socket

The presence of a non-empty Recv-Q on the server-side connection points 
to the latter. We need to get hold of a 'rabbitmqctl report' showing 
that connection while the Recv-Q is non-empty, so we know what state the 
server thought the connection was in at the time.

Regards,

Matthias.

From anthony.johnson at nokia.com  Wed Feb 13 23:00:29 2013
From: anthony.johnson at nokia.com (anthony.johnson at nokia.com)
Date: Wed, 13 Feb 2013 23:00:29 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <511C1804.9090105@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51143B7E.8030102@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013774F7DA@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>, 
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>,
	<511C1804.9090105@rabbitmq.com>
Message-ID: <DB6D830CCC65874A8FF762D587ADC9C513ABF509@008-AM1MPN1-026.mgdnok.nokia.com>

I'm confused.  I see 189724 and 574331 in the queues.  Headers stripped so I don't know which is which.  Are we talking about different output?

tcp        0 189824 ::ffff:10.196.42.182:49191  ::ffff:10.196.42.21:5672    ESTABLISHED
>
> netstat server
> [pkonar at ajtrafp063 ~]$ netstat -an | grep 182
> tcp   574331      0 ::ffff:10.196.42.21:5672    ::ffff:10.196.42.182:49191  ESTABLISHED

Sent from my Windows Phone
________________________________
From: ext Matthias Radestock<mailto:matthias at rabbitmq.com>
Sent: ?2/?13/?2013 5:47 PM
To: Konar Peter (Nokia-LC/Chicago)<mailto:peter.konar at nokia.com>
Cc: Discussions about RabbitMQ<mailto:rabbitmq-discuss at lists.rabbitmq.com>; Yu Jerry.3 (Nokia-LC/Alpharetta)<mailto:jerry.3.yu at nokia.com>; Carroll James (Nokia-LC/Malvern)<mailto:james.carroll at nokia.com>; Lieber Dick (Nokia-LC/Chicago)<mailto:dick.lieber at nokia.com>; Johnson Anthony (Nokia-LC/Alpharetta)<mailto:anthony.johnson at nokia.com>; Mccuiston Mitchell (Nokia-LC/Chicago)<mailto:mitchell.mccuiston at nokia.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 13/02/13 22:30, Konar Peter (Nokia-LC/Chicago) wrote:
> There was maybe 2mins between command, sending new output scripted to
> run sequentially. Order of the operations was
> Client netstat
> Server netstat
> Server report

This isn't showing anything going wrong. There are no Send-Q's on the
client netstat, and no Recv-Q's on the server netstat. The
10.196.42.182:49191 connection, which exhibited both of these, is
nowhere to be seen.

Did you check the rabbit.log for what happened to 10.196.42.182:49191?

Regards,

Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130213/45c93df3/attachment.htm>

From manuchandraprasadr at gmail.com  Thu Feb 14 09:25:13 2013
From: manuchandraprasadr at gmail.com (Manuchandraprasad R)
Date: Thu, 14 Feb 2013 14:55:13 +0530
Subject: [rabbitmq-discuss] Python worker consuming 100% cpu
Message-ID: <CAPmeV-OaLZPYfUp45yqLZXe9ovq2K0ovSREj7SBbxfaT1RyOfQ@mail.gmail.com>

I worte this python script which acts as an RPC server by modifying the
default RPC example in RabbitMQ tutorial found
here<http://www.rabbitmq.com/tutorials/tutorial-six-python.html>.
It runs fine in my laptop. But when i run it in an amazon ec2 High CPU
Medium Instance with these specs :

1.7 GiB of memory

5 EC2 Compute Units (2 virtual cores with 2.5 EC2 Compute Units each)

350 GB of instance storage

It takes up 100% CPU. Although my laptop with almost the same config runs
this with less than 4% CPU use.I run this in Ubuntu-12.04 in both my laptop
and amazon.

Here is my code

    #!/usr/bin/env python
    import pika
    import commands
    import socket
    import base64

    connection = pika.BlockingConnection(pika.ConnectionParameters(
             host='localhost'))
    channel = connection.channel()
    channel.queue_declare(queue='rpc_queue')
    def on_request(ch, method, props, body):
        #print body
        body = base64.b64decode(body)
        print body
        run = commands.getoutput(body)
        response = socket.gethostname()
        print response
        ch.basic_publish(exchange='',
                        routing_key=props.reply_to,
                        properties=pika.BasicProperties(correlation_id = \
                                                      props.correlation_id),
                        body=str(response))
        ch.basic_ack(delivery_tag = method.delivery_tag)
    channel.basic_qos(prefetch_count=1)
    channel.basic_consume(on_request, queue='rpc_queue')
    print " [x] Awaiting RPC requests"
    channel.start_consuming()

How can i fix this ?

Manu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130214/de50e8b9/attachment.htm>

From tim at rabbitmq.com  Thu Feb 14 10:36:09 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 14 Feb 2013 10:36:09 +0000
Subject: [rabbitmq-discuss] ReplyTo format
In-Reply-To: <1360675575658-24986.post@n5.nabble.com>
References: <1360670317804-24978.post@n5.nabble.com>
	<B3F78EE4-8923-463F-9DBF-6D57E9DC5231@rabbitmq.com>
	<1360675575658-24986.post@n5.nabble.com>
Message-ID: <F3A2A596-36CA-4F80-A7BD-959AE3F670F0@rabbitmq.com>

Hi Artur,

Sorry for the delayed response!

On 12 Feb 2013, at 13:26, rabbit15 wrote:
> Thanks for the quick response. I'm asking about format, which may be defined
> by protocol. I'm asking about something like 
> /queue_name/routing_key     and      /exchange_name/routing_key     
> or 
> queue_name:routing_key     and      exchange_name:routing_key.
> Is there any specifiaction with that ?

No the reply-to field is just a string - *you* decide how to process that string in the consumer. There is nothing that will make the reply-to mechanism magically work - the client that receives the message at the other end needs to know what to do with the reply-to, so in theory you can put any shortstr in there and make the reply using whatever mechanism makes sense for your application. Hope that makes sense.

Cheers,
Tim


> Best Regards,
> Artur
> 
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/ReplyTo-format-tp24978p24986.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Thu Feb 14 12:00:29 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 14 Feb 2013 12:00:29 +0000
Subject: [rabbitmq-discuss] creating connections to RMQ
In-Reply-To: <CAEuJcXNXC6ai3K1NNHBUegJgvh_X97bi5dAWYHxKXwq8q38rCQ@mail.gmail.com>
References: <CAEuJcXOWoXnSgwRcgAo8c2F+UuV3zmA65QG2RO694cgXxcgSnQ@mail.gmail.com>
	<511BB669.2030309@rabbitmq.com>
	<CAEuJcXNXC6ai3K1NNHBUegJgvh_X97bi5dAWYHxKXwq8q38rCQ@mail.gmail.com>
Message-ID: <511CD1DD.9020805@rabbitmq.com>

Rob,

On 13/02/13 16:26, Rob Woolfson wrote:
> We are looking at the best way to use only one connection and have only
> the channel created each time.  Bear in mind that its all happening on
> the same physical server and the servers that I refer to are actually
> software services as opposed to different physical machines.  So network
> latency shouldnt be a big problem here.

Connections, and, to a (much) lesser degree channels, are comparatively 
expensive, to create. And latency matters, even for local connections.

Anyway, I suggest you start by figuring out how to re-use the 
connection. As you say. That should make a massive difference and might 
be all you need to do in order to get sufficient performance for your 
use case.

> The application is for trading.
>
> S1 receives a signal to open a trade and sends the order to S2 which is
> responsible for sending the trade to the brokers.  When S1 receives a
> signal to open the trade it creates an object to manage all the
> communication back and forth between the broker.  So it creates a queue
> that will route all incoming messages to do with that specific trade
> back to the object.  For this reason the object (which is a new object
> for each trade) will create a new channel, queue and binding,
> specifically for the life of the trade.

That is actually quite reasonable. It's not the most efficient - as 
Simon says, queue creation is expensive - but fits your business domain 
well, so I'd stick with that design until other avenues for increasing 
performance have been exhausted.

Regards,

Matthias.

From emile at rabbitmq.com  Thu Feb 14 12:42:40 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 14 Feb 2013 12:42:40 +0000
Subject: [rabbitmq-discuss] Performance of One vs. Many Topic Exchanges
In-Reply-To: <CAHEpgBBqieqdoF=cr=Qr33hQ=9CsBgB--wzn_Y7s330tsukKjw@mail.gmail.com>
References: <CAHEpgBBqieqdoF=cr=Qr33hQ=9CsBgB--wzn_Y7s330tsukKjw@mail.gmail.com>
Message-ID: <511CDBC0.7030904@rabbitmq.com>


Hi Chris,

On 13/02/13 21:17, Chris wrote:
> The only thing I am unsure of is if there is any difference in
> performance?  Multiple exchanges are more expensive in memory, but will
> a single exchange need more CPU to route messages because it is dealing
> with so many more disparate bindings?

My guess would be that performance and memory use of these options won't
differ hugely, but don't take my word for it - perform a test on a
representative dataset.

You should decide whether you value a good fit to your problem over
operational considerations and choose accordingly. You might consider
exchange-to-exchange bindings to group exchanges:

 http://www.rabbitmq.com/e2e.html



-Emile









From matthias at rabbitmq.com  Thu Feb 14 12:49:19 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 14 Feb 2013 12:49:19 +0000
Subject: [rabbitmq-discuss] Queue binding option in rabbit.js
In-Reply-To: <1bc62e0f-0ffc-4f92-affd-77733340cd44@googlegroups.com>
References: <1bc62e0f-0ffc-4f92-affd-77733340cd44@googlegroups.com>
Message-ID: <511CDD4F.5070103@rabbitmq.com>

Vijay,

On 13/02/13 12:32, C.K.R.VIJAY Krishna wrote:
>        Please provide rabbit.js sample code  which is used to create a
> queue,bind the queue to an exchange that is already present in rabbitmq
> server,able to provide routing key to an excahnge. I have done this
> using node-amqp but i am facing issues while doing the same with rabbit.js

rabbit.js is a higher-level abstraction of messaging; by design it does 
not expose all of AMQP's functionality. The interaction points with AMQP 
are explained at 
https://github.com/squaremo/rabbit.js#relation-to-amqp-and-stomp, and it 
doesn't look like what you are trying to do matches up with that.

So either change your design to use the rabbit.js messaging 
abstractions, and AMQP interaction points as defined, or stick to node-amqp.

Regards,

Matthias.

From gmr at meetme.com  Thu Feb 14 13:50:00 2013
From: gmr at meetme.com (Gavin M. Roy)
Date: Thu, 14 Feb 2013 08:50:00 -0500
Subject: [rabbitmq-discuss] Python worker consuming 100% cpu
In-Reply-To: <CAPmeV-OaLZPYfUp45yqLZXe9ovq2K0ovSREj7SBbxfaT1RyOfQ@mail.gmail.com>
References: <CAPmeV-OaLZPYfUp45yqLZXe9ovq2K0ovSREj7SBbxfaT1RyOfQ@mail.gmail.com>
Message-ID: <CAKwdTWeE67WCrdBaBa4XAgwzvo0D2mpX5CjvpHQRsw4PbZ8coQ@mail.gmail.com>

It's an issue that is fixed in pika's master branch and will be pushed to
pypi soon. You can test by installing pika with pip from git.

On Thursday, February 14, 2013, Manuchandraprasad R wrote:

> I worte this python script which acts as an RPC server by modifying the
> default RPC example in RabbitMQ tutorial found here<http://www.rabbitmq.com/tutorials/tutorial-six-python.html>.
> It runs fine in my laptop. But when i run it in an amazon ec2 High CPU
> Medium Instance with these specs :
>
> 1.7 GiB of memory
>
> 5 EC2 Compute Units (2 virtual cores with 2.5 EC2 Compute Units each)
>
> 350 GB of instance storage
>
> It takes up 100% CPU. Although my laptop with almost the same config runs
> this with less than 4% CPU use.I run this in Ubuntu-12.04 in both my laptop
> and amazon.
>
> Here is my code
>
>     #!/usr/bin/env python
>     import pika
>     import commands
>     import socket
>     import base64
>
>     connection = pika.BlockingConnection(pika.ConnectionParameters(
>              host='localhost'))
>     channel = connection.channel()
>     channel.queue_declare(queue='rpc_queue')
>     def on_request(ch, method, props, body):
>         #print body
>         body = base64.b64decode(body)
>         print body
>         run = commands.getoutput(body)
>         response = socket.gethostname()
>         print response
>         ch.basic_publish(exchange='',
>                         routing_key=props.reply_to,
>                         properties=pika.BasicProperties(correlation_id = \
>                                                       props.correlation_id),
>                         body=str(response))
>         ch.basic_ack(delivery_tag = method.delivery_tag)
>     channel.basic_qos(prefetch_count=1)
>     channel.basic_consume(on_request, queue='rpc_queue')
>     print " [x] Awaiting RPC requests"
>     channel.start_consuming()
>
>  How can i fix this ?
>
> Manu



-- 

Gavin M. Roy
Chief Technology Officer

<http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130214/5170b101/attachment.htm>

From simon at rabbitmq.com  Thu Feb 14 13:56:54 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 14 Feb 2013 13:56:54 +0000
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-ldap patch adding
 caching and subtree searches
In-Reply-To: <41D6077904114EDB84E046045D297E66@meetme.com>
References: <41D6077904114EDB84E046045D297E66@meetme.com>
Message-ID: <511CED26.9060801@rabbitmq.com>

On 14/02/13 01:35, Gavin M. Roy wrote:
> Hi all,

Hi! Thanks for showing some interest in the LDAP plugin :-)

> Attached to this email is a patch that refactors
> rabbitmq-auth-backend-ldap a bit to allow it to use subtree searches and
> it caches the connection to the LDAP server. Would anyone on the
> RabbitMQ team be so kind as to code-review it and offer suggestions on
> how it can be improved for possible inclusion in Rabbit?

OK. This definitely goes in an interesting direction, but I'm afraid it 
will take a fair bit of work to get it merged:

* First of all, receiving multiple not-very-related changes in a single 
huge patch makes it really hard to review. The scope changes and the 
shared-connection changes don't have much to do with each other - I 
would much rather review one at a time.

* There also seem to be a few small refactorings like cases where 
functions are just moved around within the file. Again these should be 
separated so they can live or die on their own merits, and not confuse 
the issue of anything else.

* I had envisaged LDAP connection sharing happening per user or per 
connection, I hadn't thought of having a single global connection (umm, 
I didn't realise you could re-bind). So that makes connection sharing 
easier to do, but with the cost of rebinding every time. Have you 
measured to see if this is substantially beneficial vs creating a new 
connection every time?

* ... since sharing the LDAP connection presumably adds the possibility 
that some query will break it, and then we need to recover. I expect 
just getting the gen_server to die and be restarted by its supervisor 
would be the right thing to do, but I don't see evidence of that happening?

* I'm not sure the scope option... has the right scope. I would assume 
if you wanted to specify the query scope you would want to be able to do 
that per query. ATM it seems like you can only do it globally, which 
feels a bit odd.

There are a bunch of smaller issues I'd want to go through as well, but 
those are the high level ones.

> My fork is on Github as well
> https://github.com/gmr/rabbitmq-auth-backend-ldap if anyone wants to
> offer feedback or try it out.
>
> I ran the tests against the current tip version and my version and they
> pass and fail at the same spots, which I'm assuming is a good thing.

Umm, all the tests should pass! They do for me (both on default and with 
your patch). You did install OpenLDAP and run ./example/setup.sh?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Gnana.Prakash at RelayHealth.com  Thu Feb 14 21:02:02 2013
From: Gnana.Prakash at RelayHealth.com (Prakash, Gnana)
Date: Thu, 14 Feb 2013 21:02:02 +0000
Subject: [rabbitmq-discuss] RabbitMQ LDAP Configuration
Message-ID: <93A5705559C3B84E9745066CF0E6C3BE4D6152E3@DDCEP50016.na.corp.mckesson.com>

Hi,

I have a RabbitMQ server with Management and LDAP plugin enabled. The LDAP configuration is below.
The below mentioned user is a member of Administrator group. To login to the management console (http://localhost:15672/), I need to use full name and password. Username does not work.
Is there a way to login using username instead of full name ??

Thanks
Gnana


Name - Test User
Username - testusername
DN  - "CN=Test User,OU=Users,DC=Testing,DC=Domain"


[
  {rabbit, [{auth_backends, [rabbit_auth_backend_ldap]}]},
  {rabbitmq_auth_backend_ldap,
      [{servers,                ["Testing.Domian"]},
      {user_dn_pattern,         "CN={username},OU=Users,DC=Testing,DC=Domain"},
       {use_ssl,                false},
        {port,                  389},
        {log,                   network},
        {vhost_access_query,    {in_group, "CN=Vhost,OU=Groups,DC=Testing,DC=Domain"}},
        {resource_access_query,
        {for, [{permission, configure, {in_group, " CN=Configure,OU=Groups,DC=Testing,DC=Domain"}},
              {permission, write,
              {for, [{resource, queue,    {in_group, "CN=Write,OU=Groups,DC=Testing,DC=Domain"}},
                     {resource, exchange, {in_group, "CN=Write,OU=Groups,DC=Testing,DC=Domain"}}]}},
              {permission, read,
              {for, [{resource, exchange, {in_group, "CN=Read,OU=Groups,DC=Testing,DC=Domain"}},
                     {resource, queue,    {in_group, "CN=Read,OU=Groups,DC=Testing,DC=Domain"}}]}}
            ]
      }},
       {tag_queries,           [{administrator, {in_group, "CN=Administrator,OU=Groups,DC=Testing,DC=Domain"}},
                                {management,    {in_group, "CN=Management,OU=Groups,DC=Testing,DC=Domain"}}]}
   ]
  }
].
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130214/1f1bdaad/attachment.htm>

From simon at rabbitmq.com  Thu Feb 14 21:37:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 14 Feb 2013 21:37:39 +0000
Subject: [rabbitmq-discuss] RabbitMQ LDAP Configuration
In-Reply-To: <93A5705559C3B84E9745066CF0E6C3BE4D6152E3@DDCEP50016.na.corp.mckesson.com>
References: <93A5705559C3B84E9745066CF0E6C3BE4D6152E3@DDCEP50016.na.corp.mckesson.com>
Message-ID: <511D5923.5070600@rabbitmq.com>

Yes, look into using dn_lookup_attribute and dn_lookup_base as an 
alternative to user_dn_pattern. See http://www.rabbitmq.com/ldap.html

Cheers, Simon

On 14/02/2013 9:02PM, Prakash, Gnana wrote:
> Hi,
>
> I have a RabbitMQ server with Management and LDAP plugin enabled. The
> LDAP configuration is below.
>
> The below mentioned user is a member of Administrator group. To login to
> the management console (http://localhost:15672/), I need to use full
> name and password. Username does not work.
>
> Is there a way to login using username instead of full name ??
>
> Thanks
>
> Gnana
>
> Name ? Test User
>
> Username ? testusername
>
> DN  ? ?CN=Test User,OU=Users,DC=Testing,DC=Domain?
>
> [
>
>    {rabbit, [{auth_backends, [rabbit_auth_backend_ldap]}]},
>
>    {rabbitmq_auth_backend_ldap,
>
>        [{servers,                ["Testing.Domian"]},
>
>        {user_dn_pattern,
>    "CN={username},OU=Users,DC=Testing,DC=Domain"},
>
>         {use_ssl,                false},
>
>          {port,                  389},
>
>          {log,                   network},
>
>          {vhost_access_query,    {in_group,
> "CN=Vhost,OU=Groups,DC=Testing,DC=Domain"}},
>
>          {resource_access_query,
>
>          {for, [{permission, configure, {in_group, "
> CN=Configure,OU=Groups,DC=Testing,DC=Domain"}},
>
>                {permission, write,
>
>                {for, [{resource, queue,    {in_group,
> "CN=Write,OU=Groups,DC=Testing,DC=Domain"}},
>
>                       {resource, exchange, {in_group,
> "CN=Write,OU=Groups,DC=Testing,DC=Domain"}}]}},
>
>                {permission, read,
>
>                {for, [{resource, exchange, {in_group,
> "CN=Read,OU=Groups,DC=Testing,DC=Domain"}},
>
>                       {resource, queue,    {in_group,
> "CN=Read,OU=Groups,DC=Testing,DC=Domain"}}]}}
>
>              ]
>
>        }},
>
>         {tag_queries,           [{administrator, {in_group,
> "CN=Administrator,OU=Groups,DC=Testing,DC=Domain"}},
>
>                                  {management,    {in_group,
> "CN=Management,OU=Groups,DC=Testing,DC=Domain"}}]}
>
>     ]
>
>    }
>
> ].
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jhalterman at gmail.com  Fri Feb 15 00:29:54 2013
From: jhalterman at gmail.com (Jonathan)
Date: Thu, 14 Feb 2013 16:29:54 -0800 (PST)
Subject: [rabbitmq-discuss] Threadpools and rejected messages (java client)
Message-ID: <dd588585-37c3-473b-8748-8d135c6143d4@googlegroups.com>

Using the Java client, when a consumer threadpool is maxed out and an 
attempt to submit work to the threadpool is rejected, what happens to the 
message? Is it returned to the queue on the server? Is it dropped 
altogether? Dropping messages is not acceptable for me, so I need to know 
if I can put a cap on my threadpool size or not since I may get occasional 
spikes in messages.

Thanks,
Jonathan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130214/f5743f32/attachment.htm>

From a.rubalcaba at gmail.com  Fri Feb 15 03:41:54 2013
From: a.rubalcaba at gmail.com (Andrew Rubalcaba)
Date: Thu, 14 Feb 2013 21:41:54 -0600
Subject: [rabbitmq-discuss] Python to Java
Message-ID: <CAFV+rm1gHS7xsa8Eam5vex6CT0Vkn0-n2KLOm_3c-bgEU3n_Ag@mail.gmail.com>

Hi,

I'm currently working through some simple examples. I have the Java to
Python working ok. Its the Python to Java that is not working correctly.

I'm using Spring AMQP project with AMQP Template on the Java Side. On the
Python side I'm using pika 0.9.9.  Sending over a string from Python to
Java I get something like [B at 3909ea96 instead of the actual string.  Any
ideas what I'm missing or doing wrong. If you guys like I can attach the
Python files on here along with the Java project.

-Andrew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130214/e89a8487/attachment.htm>

From matthias at rabbitmq.com  Fri Feb 15 05:54:13 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 15 Feb 2013 05:54:13 +0000
Subject: [rabbitmq-discuss] Threadpools and rejected messages (java
	client)
In-Reply-To: <dd588585-37c3-473b-8748-8d135c6143d4@googlegroups.com>
References: <dd588585-37c3-473b-8748-8d135c6143d4@googlegroups.com>
Message-ID: <511DCD85.3010208@rabbitmq.com>

Jonathan,

On 15/02/13 00:29, Jonathan wrote:
> Using the Java client, when a consumer threadpool is maxed out and an
> attempt to submit work to the threadpool is rejected, what happens to
> the message? Is it returned to the queue on the server? Is it dropped
> altogether?

The message gets enqueued at the client side until a thread becomes free.

Matthias.


From jhalterman at gmail.com  Fri Feb 15 06:01:01 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Thu, 14 Feb 2013 22:01:01 -0800
Subject: [rabbitmq-discuss] Threadpools and rejected messages (java
	client)
In-Reply-To: <511DCD85.3010208@rabbitmq.com>
References: <dd588585-37c3-473b-8748-8d135c6143d4@googlegroups.com>
	<511DCD85.3010208@rabbitmq.com>
Message-ID: <CA+es_-wR3dY0CsKqy13A1B5VBASr573kwO+zjhy7ZU9AGdtJzA@mail.gmail.com>

Could messages potentially stack up on the client or will it stop receiving
messages until it has the capacity to process them? My concern is
oversaturating the client/threadpool with messages. Is that possible?

- Jonathan

On Thu, Feb 14, 2013 at 9:54 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Jonathan,
>
> On 15/02/13 00:29, Jonathan wrote:
>
>> Using the Java client, when a consumer threadpool is maxed out and an
>> attempt to submit work to the threadpool is rejected, what happens to
>> the message? Is it returned to the queue on the server? Is it dropped
>> altogether?
>>
>
> The message gets enqueued at the client side until a thread becomes free.
>
> Matthias.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130214/9b18f6f1/attachment.htm>

From matthias at rabbitmq.com  Fri Feb 15 06:07:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 15 Feb 2013 06:07:23 +0000
Subject: [rabbitmq-discuss] Threadpools and rejected messages (java
	client)
In-Reply-To: <CA+es_-wR3dY0CsKqy13A1B5VBASr573kwO+zjhy7ZU9AGdtJzA@mail.gmail.com>
References: <dd588585-37c3-473b-8748-8d135c6143d4@googlegroups.com>
	<511DCD85.3010208@rabbitmq.com>
	<CA+es_-wR3dY0CsKqy13A1B5VBASr573kwO+zjhy7ZU9AGdtJzA@mail.gmail.com>
Message-ID: <511DD09B.7030503@rabbitmq.com>

Jonathan,

On 15/02/13 06:01, Jonathan Halterman wrote:
> Could messages potentially stack up on the client or will it stop
> receiving messages until it has the capacity to process them? My concern
> is oversaturating the client/threadpool with messages. Is that possible?

You can control the flow of messages to the client by consuming in ack 
mode and setting a prefetch count with 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.0.2/rabbitmq-java-client-javadoc-3.0.2/com/rabbitmq/client/Channel.html#basicQos(int), 
which determines how many messages the server will send to the client 
before needing to get an acknowledgement.

Matthias.

From emile at rabbitmq.com  Fri Feb 15 09:37:51 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 15 Feb 2013 09:37:51 +0000
Subject: [rabbitmq-discuss] Python to Java
In-Reply-To: <CAFV+rm1gHS7xsa8Eam5vex6CT0Vkn0-n2KLOm_3c-bgEU3n_Ag@mail.gmail.com>
References: <CAFV+rm1gHS7xsa8Eam5vex6CT0Vkn0-n2KLOm_3c-bgEU3n_Ag@mail.gmail.com>
Message-ID: <511E01EF.2090301@rabbitmq.com>

Hi,


On 15/02/13 03:41, Andrew Rubalcaba wrote:
> I get something like [B at 3909ea96 

You are probably calling toString() on a byte array instead of
converting it to a string. You should perform the conversion using the
same encoding that the publisher used. The publisher can store this in
the content-encoding message property.


-Emile

From holger.hoffstaette at googlemail.com  Fri Feb 15 09:47:33 2013
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Fri, 15 Feb 2013 10:47:33 +0100
Subject: [rabbitmq-discuss] Python to Java
References: <CAFV+rm1gHS7xsa8Eam5vex6CT0Vkn0-n2KLOm_3c-bgEU3n_Ag@mail.gmail.com>
Message-ID: <pan.2013.02.15.09.47.33.773889@googlemail.com>

On Thu, 14 Feb 2013 21:41:54 -0600, Andrew Rubalcaba wrote:

> I'm using Spring AMQP project with AMQP Template on the Java Side. On the
> Python side I'm using pika 0.9.9.  Sending over a string from Python to
> Java I get something like [B at 3909ea96 instead of the actual string.  Any

You are looking at a byte array and its default #toString()
representation, which will give you Java's array identifier [ for bytes B
at "@" the object's "address". :)

So in other words you will need to turn that byte array into a client-side
Java String, hopefully using the proper character encoding.

hth :)
-h



From ben.corlett at gmail.com  Fri Feb 15 12:08:08 2013
From: ben.corlett at gmail.com (Ben Corlett)
Date: Fri, 15 Feb 2013 04:08:08 -0800 (PST)
Subject: [rabbitmq-discuss] Unable to delete vhost
Message-ID: <8e0160d2-c8fa-4289-a7da-3767ca00de40@googlegroups.com>

I am having some issues when trying to delete a vhost. 

I'm using the latest version of rabbitmq 3.0.2 and my set up has two 
clusters (2 machines in each) with a federation for pub/sub messages. 

When trying to remove the vhost via the web interface I get the error :

Internal Server Error

The server encountered an error while processing this request:
{throw,
    {error,
        {{badmatch,
             {error_string,
                 "Validation failed\n\nname not recognised: undefined\n"}},
         [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
          {rabbit_vhost,internal_delete,1},
          {rabbit_vhost,'-delete/1-fun-0-',1},
          {mnesia_tm,apply_fun,3},
          {mnesia_tm,execute_transaction,5},
          {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
          {worker_pool_worker,handle_call,3},
          {gen_server2,handle_msg,2}]}},
    [{rabbit_misc,execute_mnesia_transaction,1},
     {rabbit_mgmt_wm_vhost,delete_resource,2},
     {webmachine_resource,resource_call,3},
     {webmachine_resource,do,3},
     {webmachine_decision_core,resource_call,1},
     {webmachine_decision_core,decision,1},
     {webmachine_decision_core,handle_request,2},
     {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}

When trying to remove the vhost from the command line I get something 
similar :

[rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqctl delete_vhost 
v4e73843117c745bb8c1796c2a423b177
Deleting vhost "v4e73843117c745bb8c1796c2a423b177" ...
Error: {{badmatch,{error_string,"Validation failed\n\nname not recognised: 
undefined\n"}},
        [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
         {rabbit_vhost,internal_delete,1},
         {rabbit_vhost,'-delete/1-fun-0-',1},
         {mnesia_tm,apply_fun,3},
         {mnesia_tm,execute_transaction,5},
         {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
         {worker_pool_worker,handle_call,3},
         {gen_server2,handle_msg,2}]}


Here are the commands to initially set up the vhost via a script (the hosts 
used here are vips which are load balanced across both nodes in the 
cluster) :

Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare vhost 
name=v46997afd74174f1ea120fbeae38877b9 2>&1
vhost declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare vhost 
name=v46997afd74174f1ea120fbeae38877b9 2>&1
vhost declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare user 
name=aumh4l0SBFJBe3 password=***** tags= 2>&1
user declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare user 
name=aumh4l0SBFJBe3 password=***** tags= 2>&1
user declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.* 
read=.* write=.* 2>&1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.* 
read=.* write=.* 2>&1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.* 
write=.* 2>&1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.* 
write=.* 2>&1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=federate-me 
pattern="^ps." 'definition={"federation-upstream-set":"all"}' 2>&1
policy declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=federate-me 
pattern="^ps." 'definition={"federation-upstream-set":"all"}' 2>&1
policy declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all 
pattern="^ha." 'definition={"ha-mode":"all"}' 2>&1
policy declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all 
pattern="^ha." 'definition={"ha-mode":"all"}' 2>&1
policy declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter 
component=federation-upstream name=my-upstream 
value='{"uri":"amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.onx-sc.cg.company.com","expires":3600000}'
parameter declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter 
component=federation name=local-username value='"aumh4l0SBFJBe3"'
parameter declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter 
component=federation-upstream name=my-upstream 
value='{"uri":"amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.chi-sc.cg.company.com","expires":3600000}'
parameter declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter 
component=federation name=local-username value='"aumh4l0SBFJBe3"'
parameter declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare user name=urFZ5xudDA1Sk 
password=***** tags= 2>&1
user declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare user name=urFZ5xudDA1Sk 
password=***** tags= 2>&1
user declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.* 
read=.* write=.* 2>&1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.* 
read=.* write=.* 2>&1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.* 
write=.* 2>&1
permission declared
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** declare permission 
vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.* 
write=.* 2>&1
permission declared

Here are the commands used to clean away this vhost :

Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** delete user name=urFZ5xudDA1Sk 
2>&1
user deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** delete user name=urFZ5xudDA1Sk 
2>&1
user deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter 
component=federation-upstream name=my-upstream 2>&1
parameter deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter 
component=federation-upstream name=my-upstream 2>&1
parameter deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter 
component=federation name=local-username 2>&1
parameter deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter 
component=federation name=local-username 2>&1
parameter deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me 
2>&1
policy deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me 
2>&1
policy deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2>&1
policy deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** 
--vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2>&1
policy deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** delete vhost 
name=v46997afd74174f1ea120fbeae38877b9 2>&1
Traceback (most recent call last):\n  File 
"/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 889, in 
<module>\n    main()\n  File 
"/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 354, in main\n 
   method()\n  File "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", 
line 534, in invoke_delete\n    self.delete(uri)\n  File 
"/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 386, in 
delete\n    return self.http("DELETE", "/api%s" % path, "")\n  File 
"/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 421, in http\n 
   % (resp.status, resp.reason, path, resp.read()))\nException: Received 
500 Internal Server Error for path 
/api/vhosts/v46997afd74174f1ea120fbeae38877b9\n<html><head><title>500 
Internal Server Error</title></head><body><h1>Internal Server Error</h1>The 
server encountered an error while processing this 
request:<br><pre>{throw,\n    {error,\n        {{badmatch,\n             
{error_string,\n                 "Validation failed\n\nname not recognised: 
undefined\n"}},\n         
[{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},\n         
 {rabbit_vhost,internal_delete,1},\n         
 {rabbit_vhost,'-delete/1-fun-0-',1},\n          {mnesia_tm,apply_fun,3},\n 
         {mnesia_tm,execute_transaction,5},\n         
 {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},\n         
 {worker_pool_worker,handle_call,3},\n         
 {gen_server2,handle_msg,2}]}},\n   
 [{rabbit_misc,execute_mnesia_transaction,1},\n     
{rabbit_mgmt_wm_vhost,delete_resource,2},\n     
{webmachine_resource,resource_call,3},\n     {webmachine_resource,do,3},\n 
    {webmachine_decision_core,resource_call,1},\n     
{webmachine_decision_core,decision,1},\n     
{webmachine_decision_core,handle_request,2},\n     
{rabbit_webmachine,'-makeloop/1-fun-0-',2}]}</pre><P><HR><ADDRESS>mochiweb+webmachine 
web server</ADDRESS></body></html>\n
Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com 
--port=80 --username=admin --password=***** delete user name=aumh4l0SBFJBe3 
2>&1
user deleted\n
Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com 
--port=80 --username=admin --password=***** delete user name=aumh4l0SBFJBe3 
2>&1
user deleted\n

Anyone got any ideas?

Thanks,

Ben.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/dacdad8b/attachment.htm>

From simon at rabbitmq.com  Fri Feb 15 13:35:19 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Feb 2013 13:35:19 +0000
Subject: [rabbitmq-discuss] RabbitMQ Management console not working
In-Reply-To: <CAOHdx6Zupz1ZFypEJZXoVnW-90Hr33N=t_Zj6EyHF1A0RGziHg@mail.gmail.com>
References: <4cd9b4f4-48c4-417b-87d8-830aade33b69@googlegroups.com>
	<5110DF98.6020503@rabbitmq.com>
	<CAOHdx6Zupz1ZFypEJZXoVnW-90Hr33N=t_Zj6EyHF1A0RGziHg@mail.gmail.com>
Message-ID: <511E3997.9000504@rabbitmq.com>

Ah, I think I see the problem. Setting RABBITMQ_SERVICENAME for your 
services sets RABBITMQ_BASE, which then controls the location of where 
the RabbitMQ service(s) will look for the enabled_plugins file.

But you are not setting this when invoking rabbitmq-plugins.bat, so it's 
writing the file to a different location. And sadly there's a bug in the 
rabbitmq-plugins.bat script which prevents it from looking at 
RABBITMQ_SERVICENAME.

I'll file a bug to get that fixed. But in the mean time you should be 
able to get the management plugin started by copying the enabled_plugins 
file from %APPDATA%\RabbitMQ\enabled_plugins to 
%APPDATA%\TermaniaDevRabbitMQ\enabled_plugins and 
%APPDATA%\TermaniaProdRabbitMQ\enabled_plugins.

Since you're using RabbitMQ 3.x you do not need to reinstall the 
service, just restart it.

Cheers, Simon

On 14/02/13 17:48, Rok Rejc wrote:
> Hi,
>
> sorry for late reply. I am running 3.0.1 on Windows. I have tried and
> reinstalled service, but its still not working. If I run
> rabbitmq-plugins list -e I get:
>
> c:\RabbitMq\sbin>rabbitmq-plugins list -e
> [e] amqp_client               3.0.1
> [e] mochiweb                  2.3.1-rmq3.0.1-gitd541e9a
> [E] rabbitmq_management       3.0.1
> [e] rabbitmq_management_agent 3.0.1
> [e] rabbitmq_mochiweb         3.0.1
> [e] webmachine                1.9.1-rmq3.0.1-git52e62bc
>
> If I understand this correctly, the management plugin
>   should work, but nothing.
>
> If I check the log I dont see anything about management plugin:
> INFO REPORT==== 13-Feb-2013::13:33:12 ===
> Starting RabbitMQ 3.0.1 on Erlang R15B03
>
> =INFO REPORT==== 13-Feb-2013::13:33:12 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =INFO REPORT==== 13-Feb-2013::13:33:12 ===
> Memory limit set to 9829MB of 24574MB total.
>
> =INFO REPORT==== 13-Feb-2013::13:33:12 ===
> Disk free limit set to 1000MB
>
> =INFO REPORT==== 13-Feb-2013::13:33:12 ===
> msg_store_transient: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 13-Feb-2013::13:33:12 ===
> msg_store_persistent: using rabbit_msg_store_ets_index to provide index
>
> =INFO REPORT==== 13-Feb-2013::13:33:12 ===
> started TCP Listener on [::]:6000
>
> =INFO REPORT==== 13-Feb-2013::13:33:12 ===
> started TCP Listener on 0.0.0.0:6000 <http://0.0.0.0:6000>
>
>
>
> To install services I have two batch files:
> SET ERLANG_HOME=C:\Program Files\erl5.9.3.1
> SET RABBITMQ_NODE_PORT=6000
> SET RABBITMQ_NODENAME=termania_dev
> SET RABBITMQ_SERVICENAME=TermaniaDevRabbitMQ
> C:\RabbitMq\sbin\rabbitmq-service install
>
> and
>
> SET ERLANG_HOME=C:\Program Files\erl5.9.3.1
> SET RABBITMQ_NODE_PORT=7000
> SET RABBITMQ_NODENAME=termania_prod
> SET RABBITMQ_SERVICENAME=TermaniaProdRabbitMQ
> C:\RabbitMq\sbin\rabbitmq-service install
>
>
> Any clue what should be wrong?
>
> Many thanks in advance,
> Rok
>
>
> On Tue, Feb 5, 2013 at 11:31 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Which version of RabbitMQ have you installed? Before 3.0.0 you had
>     to reinstall the service as well as restarting it.
>
>     Checking the logs in %APPDATA%\RabbitMQ\log might give you a clue
>     too - there should be lines like:
>
>     =INFO REPORT==== 1-Feb-2013::12:46:17 ===
>     Management agent started.
>
>     =INFO REPORT==== 1-Feb-2013::12:46:17 ===
>     Management plugin started. Port: 15672
>
>     =INFO REPORT==== 1-Feb-2013::12:46:17 ===
>     Statistics database started.
>
>     Cheers, Simon
>
>     On 04/02/13 13:38, Rok Rejc wrote:
>
>         I have started with RabbitMQ. I have a (windows) machine on which I
>         installed two RabbitMQ nodes as a service - I have choose the
>         nodename,
>         port and service name for each of them. The services are running
>         normally (i see that they are listening in a netstat-a).
>
>         I have also installed management plugin with "rabbitmq-plugins
>         enable
>         rabbitmq_management" and restarted both services. But the plugin
>         isn't
>         running - I dont see it listening in a netstat and I can't
>         connect to
>         the management console via browser.
>
>         Any idea what could be wrong? Is there any log to see what is
>         going on?
>
>
>         Many thanks
>
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simlu at su.se  Fri Feb 15 14:13:05 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Fri, 15 Feb 2013 15:13:05 +0100
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <20130213074055.GC616@kaka.it.su.se>
References: <20121211193803.GG754@kaka.it.su.se>
	<4D859580-D762-4BFA-A759-43F94B500FC7@rabbitmq.com>
	<20121212093115.GH754@kaka.it.su.se>
	<8D205910-A3E3-472D-A7AA-8D5737812DC4@rabbitmq.com>
	<20121221093949.GA14329@kaka.it.su.se>
	<53443B9F-8877-4993-9732-35F417AE04F0@rabbitmq.com>
	<05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
	<20130130123105.GO407@kaka.it.su.se>
	<B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
	<20130213074055.GC616@kaka.it.su.se>
Message-ID: <20130215141243.GB2924@kaka.it.su.se>

Hm, I have a weird issue now that I can't debug since there is no log at
all.

I have configured my plugin to be used before the internal one:
{auth_backends, [rabbit_auth_backend_kerberos, rabbit_auth_backend_internal]},

And if I allow all login attempts in my plugin, noone (not "internal_admin"
specified in the internal database nor "virtual-user" which is supposed to be
able to access the system) can access the API (so it disables the CLI and
management GUI too).

However, if I deny all login attempts in my plugin internal_admin can login but
obviously not my virtual-user.

# rabbitmqadmin list users
+-------------------+--------------------------+---------------+
|       name        |        password_hash     |     tags      |
+-------------------+--------------------------+---------------+
| internal_admin    | the_password_hash_really | administrator |
| virtual-user      |                          | administrator |
+-------------------+--------------------------+---------------+
# rabbitmqadmin list permissions
+-------+-----------+------+-------------------+-------+
| vhost | configure | read |       user        | write |
+-------+-----------+------+-------------------+-------+
| /     | .*        | .*   | internal_admin    | .*    |
| /     | .*        | .*   | virtual-user      | .*    |
+-------+-----------+------+-------------------+-------+

As I said, there are no logs so I really have nothing to go on here = /

Oh, and here's the code
<https://github.com/simmel/rabbitmq-auth-backend-kerberos/tree/5eaccf2>

Thanks and have a great weekend!
- Simon

From simon at rabbitmq.com  Fri Feb 15 14:20:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Feb 2013 14:20:32 +0000
Subject: [rabbitmq-discuss] Unable to delete vhost
In-Reply-To: <8e0160d2-c8fa-4289-a7da-3767ca00de40@googlegroups.com>
References: <8e0160d2-c8fa-4289-a7da-3767ca00de40@googlegroups.com>
Message-ID: <511E4430.9040303@rabbitmq.com>

Hi Ben. I think you have found a bug. In theory it should not be 
necessary to delete parameters / policies that are associated with a 
vhost before deleting the vhost - but it looks like in 3.0.2 it is. I 
would invoke "rabbitmqadmin --vhost=... list parameters" and see what 
you have got left - possibly an instance of "local-nodename".

This should get fixed in the next release.

Cheers, Simon

On 15/02/13 12:08, Ben Corlett wrote:
> I am having some issues when trying to delete a vhost.
>
> I'm using the latest version of rabbitmq 3.0.2 and my set up has two
> clusters (2 machines in each) with a federation for pub/sub messages.
>
> When trying to remove the vhost via the web interface I get the error :
>
> Internal Server Error
>
> The server encountered an error while processing this request:
> {throw,
>      {error,
>          {{badmatch,
>               {error_string,
>                   "Validation failed\n\nname not recognised: undefined\n"}},
>           [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>            {rabbit_vhost,internal_delete,1},
>            {rabbit_vhost,'-delete/1-fun-0-',1},
>            {mnesia_tm,apply_fun,3},
>            {mnesia_tm,execute_transaction,5},
>            {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>            {worker_pool_worker,handle_call,3},
>            {gen_server2,handle_msg,2}]}},
>      [{rabbit_misc,execute_mnesia_transaction,1},
>       {rabbit_mgmt_wm_vhost,delete_resource,2},
>       {webmachine_resource,resource_call,3},
>       {webmachine_resource,do,3},
>       {webmachine_decision_core,resource_call,1},
>       {webmachine_decision_core,decision,1},
>       {webmachine_decision_core,handle_request,2},
>       {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}
>
> When trying to remove the vhost from the command line I get something
> similar :
>
> [rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqctl delete_vhost
> v4e73843117c745bb8c1796c2a423b177
> Deleting vhost "v4e73843117c745bb8c1796c2a423b177" ...
> Error: {{badmatch,{error_string,"Validation failed\n\nname not
> recognised: undefined\n"}},
>          [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>           {rabbit_vhost,internal_delete,1},
>           {rabbit_vhost,'-delete/1-fun-0-',1},
>           {mnesia_tm,apply_fun,3},
>           {mnesia_tm,execute_transaction,5},
>           {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>           {worker_pool_worker,handle_call,3},
>           {gen_server2,handle_msg,2}]}
>
>
> Here are the commands to initially set up the vhost via a script (the
> hosts used here are vips which are load balanced across both nodes in
> the cluster) :
>
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=***** declare vhost
> name=v46997afd74174f1ea120fbeae38877b9 2>&1
> vhost declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=***** declare vhost
> name=v46997afd74174f1ea120fbeae38877b9 2>&1
> vhost declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=***** declare user
> name=aumh4l0SBFJBe3 password=***** tags= 2>&1
> user declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=***** declare user
> name=aumh4l0SBFJBe3 password=***** tags= 2>&1
> user declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=***** declare permission
> vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.*
> read=.* write=.* 2>&1
> permission declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=***** declare permission
> vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.*
> read=.* write=.* 2>&1
> permission declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=***** declare permission
> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
> write=.* 2>&1
> permission declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=***** declare permission
> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
> write=.* 2>&1
> permission declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy
> name=federate-me pattern="^ps."
> 'definition={"federation-upstream-set":"all"}' 2>&1
> policy declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy
> name=federate-me pattern="^ps."
> 'definition={"federation-upstream-set":"all"}' 2>&1
> policy declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all
> pattern="^ha." 'definition={"ha-mode":"all"}' 2>&1
> policy declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all
> pattern="^ha." 'definition={"ha-mode":"all"}' 2>&1
> policy declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
> component=federation-upstream name=my-upstream
> value='{"uri":"amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.onx-sc.cg.company.com","expires":3600000}'
> parameter declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
> component=federation name=local-username value='"aumh4l0SBFJBe3"'
> parameter declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
> component=federation-upstream name=my-upstream
> value='{"uri":"amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.chi-sc.cg.company.com","expires":3600000}'
> parameter declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
> component=federation name=local-username value='"aumh4l0SBFJBe3"'
> parameter declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=***** declare user
> name=urFZ5xudDA1Sk password=***** tags= 2>&1
> user declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=***** declare user
> name=urFZ5xudDA1Sk password=***** tags= 2>&1
> user declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=***** declare permission
> vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.*
> read=.* write=.* 2>&1
> permission declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=***** declare permission
> vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.*
> read=.* write=.* 2>&1
> permission declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=***** declare permission
> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
> write=.* 2>&1
> permission declared
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=***** declare permission
> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
> write=.* 2>&1
> permission declared
>
> Here are the commands used to clean away this vhost :
>
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=***** delete user
> name=urFZ5xudDA1Sk 2>&1
> user deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=***** delete user
> name=urFZ5xudDA1Sk 2>&1
> user deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
> component=federation-upstream name=my-upstream 2>&1
> parameter deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
> component=federation-upstream name=my-upstream 2>&1
> parameter deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
> component=federation name=local-username 2>&1
> parameter deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
> component=federation name=local-username 2>&1
> parameter deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me
> 2>&1
> policy deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me
> 2>&1
> policy deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2>&1
> policy deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2>&1
> policy deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=***** delete vhost
> name=v46997afd74174f1ea120fbeae38877b9 2>&1
> Traceback (most recent call last):\n  File
> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 889, in
> <module>\n    main()\n  File
> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 354, in
> main\n    method()\n  File
> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 534, in
> invoke_delete\n    self.delete(uri)\n  File
> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 386, in
> delete\n    return self.http("DELETE", "/api%s" % path, "")\n  File
> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 421, in
> http\n    % (resp.status, resp.reason, path, resp.read()))\nException:
> Received 500 Internal Server Error for path
> /api/vhosts/v46997afd74174f1ea120fbeae38877b9\n<html><head><title>500
> Internal Server Error</title></head><body><h1>Internal Server
> Error</h1>The server encountered an error while processing this
> request:<br><pre>{throw,\n    {error,\n        {{badmatch,\n
> {error_string,\n                 "Validation failed\n\nname not
> recognised: undefined\n"}},\n
> [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},\n
>   {rabbit_vhost,internal_delete,1},\n
>   {rabbit_vhost,'-delete/1-fun-0-',1},\n
>   {mnesia_tm,apply_fun,3},\n
>   {mnesia_tm,execute_transaction,5},\n
>   {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},\n
>   {worker_pool_worker,handle_call,3},\n
>   {gen_server2,handle_msg,2}]}},\n
>   [{rabbit_misc,execute_mnesia_transaction,1},\n
> {rabbit_mgmt_wm_vhost,delete_resource,2},\n
> {webmachine_resource,resource_call,3},\n
> {webmachine_resource,do,3},\n
> {webmachine_decision_core,resource_call,1},\n
> {webmachine_decision_core,decision,1},\n
> {webmachine_decision_core,handle_request,2},\n
> {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}</pre><P><HR><ADDRESS>mochiweb+webmachine
> web server</ADDRESS></body></html>\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
> --port=80 --username=admin --password=***** delete user
> name=aumh4l0SBFJBe3 2>&1
> user deleted\n
> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
> --port=80 --username=admin --password=***** delete user
> name=aumh4l0SBFJBe3 2>&1
> user deleted\n
>
> Anyone got any ideas?
>
> Thanks,
>
> Ben.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From ben.corlett at gmail.com  Fri Feb 15 14:53:01 2013
From: ben.corlett at gmail.com (Ben Corlett)
Date: Fri, 15 Feb 2013 14:53:01 +0000
Subject: [rabbitmq-discuss] Unable to delete vhost
In-Reply-To: <511E4430.9040303@rabbitmq.com>
References: <8e0160d2-c8fa-4289-a7da-3767ca00de40@googlegroups.com>
	<511E4430.9040303@rabbitmq.com>
Message-ID: <CE45E464-D6C0-4C30-8285-37848EA3D67E@gmail.com>

Hey Simon,

Thanks for the quick response.

I did a :

rabbitmqadmin --username=admin --password=***** --vhost=v46997afd74174f1ea120fbeae38877b9 list parameters

and could see :

+-----------------------------------+----------------+---------------------+---------------------------------------------------------------------------------------------------------+
|               vhost               |      name      |      component      |                                                 value                                                   |
+-----------------------------------+----------------+---------------------+---------------------------------------------------------------------------------------------------------+
| v46997afd74174f1ea120fbeae38877b9 | local-nodename | federation          | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com                                                        |
| v4e73843117c745bb8c1796c2a423b177 | local-nodename | federation          | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com                                                        |
| v6619a14c89694ca99530ee96d97fd40b | local-nodename | federation          | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com                                                        |
| v6619a14c89694ca99530ee96d97fd40b | local-username | federation          | auXTfXm39IuzJX                                                                                          |
| v6619a14c89694ca99530ee96d97fd40b | my-upstream    | federation-upstream | {"expires": 3600000, "uri": "amqp://auXTfXm39IuzJX:*****@stage-rabbitmq.onx-sc.cg.company.com"}         |
+-----------------------------------+----------------+---------------------+---------------------------------------------------------------------------------------------------------+

I removed the local-nodename for v46997afd74174f1ea120fbeae38877b9 with a :

rabbitmqadmin --username=admin --password=***** --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter name=local-nodename component=federation
parameter deleted

I tried the delete again:

[rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqctl delete_vhost v4e73843117c745bb8c1796c2a423b177
Deleting vhost "v4e73843117c745bb8c1796c2a423b177" ...
Error: {{badmatch,{error_string,"Validation failed\n\nname not recognised: undefined\n"}},
        [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
         {rabbit_vhost,internal_delete,1},
         {rabbit_vhost,'-delete/1-fun-0-',1},
         {mnesia_tm,apply_fun,3},
         {mnesia_tm,execute_transaction,5},
         {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
         {worker_pool_worker,handle_call,3},
         {gen_server2,handle_msg,2}]}

I verified it had been removed :

[rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqadmin --username=admin --password=***** --vhost=v46997afd74174f1ea120fbeae38877b9 list parameters
+-----------------------------------+----------------+---------------------+--------------------------------------------------------------------------------------------------------+
|               vhost               |      name      |      component      |                                                 value                                                  |
+-----------------------------------+----------------+---------------------+--------------------------------------------------------------------------------------------------------+
| v4e73843117c745bb8c1796c2a423b177 | local-nodename | federation          | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com                                                         |
| v6619a14c89694ca99530ee96d97fd40b | local-nodename | federation          | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com                                                         |
| v6619a14c89694ca99530ee96d97fd40b | local-username | federation          | auXTfXm39IuzJX                                                                                         |
| v6619a14c89694ca99530ee96d97fd40b | my-upstream    | federation-upstream | {"expires": 3600000, "uri": "amqp://auXTfXm39IuzJX:*****@stage-rabbitmq.onx-sc.cg.company.com"}        |
+-----------------------------------+----------------+---------------------+--------------------------------------------------------------------------------------------------------+

I tried listing the polices to see if anything was remaining :

[rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqadmin --username=admin --password=***** --vhost=v46997afd74174f1ea120fbeae38877b9 list policies

+-----------------------------------+-------------+------------------------------------+---------+----------+
|               vhost               |    name     |             definition             | pattern | priority |
+-----------------------------------+-------------+------------------------------------+---------+----------+
| v6619a14c89694ca99530ee96d97fd40b | federate-me | {"federation-upstream-set": "all"} | ^ps.    | 0        |
| v6619a14c89694ca99530ee96d97fd40b | ha-all      | {"ha-mode": "all"}                 | ^ha.    | 0        |
+-----------------------------------+-------------+------------------------------------+---------+----------+

No such luck. Anything else likely to be lingering?

Ben.


On 15 Feb 2013, at 14:20, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi Ben. I think you have found a bug. In theory it should not be necessary to delete parameters / policies that are associated with a vhost before deleting the vhost - but it looks like in 3.0.2 it is. I would invoke "rabbitmqadmin --vhost=... list parameters" and see what you have got left - possibly an instance of "local-nodename".
> 
> This should get fixed in the next release.
> 
> Cheers, Simon
> 
> On 15/02/13 12:08, Ben Corlett wrote:
>> I am having some issues when trying to delete a vhost.
>> 
>> I'm using the latest version of rabbitmq 3.0.2 and my set up has two
>> clusters (2 machines in each) with a federation for pub/sub messages.
>> 
>> When trying to remove the vhost via the web interface I get the error :
>> 
>> Internal Server Error
>> 
>> The server encountered an error while processing this request:
>> {throw,
>>     {error,
>>         {{badmatch,
>>              {error_string,
>>                  "Validation failed\n\nname not recognised: undefined\n"}},
>>          [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>>           {rabbit_vhost,internal_delete,1},
>>           {rabbit_vhost,'-delete/1-fun-0-',1},
>>           {mnesia_tm,apply_fun,3},
>>           {mnesia_tm,execute_transaction,5},
>>           {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>>           {worker_pool_worker,handle_call,3},
>>           {gen_server2,handle_msg,2}]}},
>>     [{rabbit_misc,execute_mnesia_transaction,1},
>>      {rabbit_mgmt_wm_vhost,delete_resource,2},
>>      {webmachine_resource,resource_call,3},
>>      {webmachine_resource,do,3},
>>      {webmachine_decision_core,resource_call,1},
>>      {webmachine_decision_core,decision,1},
>>      {webmachine_decision_core,handle_request,2},
>>      {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}
>> 
>> When trying to remove the vhost from the command line I get something
>> similar :
>> 
>> [rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqctl delete_vhost
>> v4e73843117c745bb8c1796c2a423b177
>> Deleting vhost "v4e73843117c745bb8c1796c2a423b177" ...
>> Error: {{badmatch,{error_string,"Validation failed\n\nname not
>> recognised: undefined\n"}},
>>         [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>>          {rabbit_vhost,internal_delete,1},
>>          {rabbit_vhost,'-delete/1-fun-0-',1},
>>          {mnesia_tm,apply_fun,3},
>>          {mnesia_tm,execute_transaction,5},
>>          {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>>          {worker_pool_worker,handle_call,3},
>>          {gen_server2,handle_msg,2}]}
>> 
>> 
>> Here are the commands to initially set up the vhost via a script (the
>> hosts used here are vips which are load balanced across both nodes in
>> the cluster) :
>> 
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare vhost
>> name=v46997afd74174f1ea120fbeae38877b9 2>&1
>> vhost declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare vhost
>> name=v46997afd74174f1ea120fbeae38877b9 2>&1
>> vhost declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare user
>> name=aumh4l0SBFJBe3 password=***** tags= 2>&1
>> user declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare user
>> name=aumh4l0SBFJBe3 password=***** tags= 2>&1
>> user declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare permission
>> vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.*
>> read=.* write=.* 2>&1
>> permission declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare permission
>> vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.*
>> read=.* write=.* 2>&1
>> permission declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare permission
>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>> write=.* 2>&1
>> permission declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare permission
>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>> write=.* 2>&1
>> permission declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy
>> name=federate-me pattern="^ps."
>> 'definition={"federation-upstream-set":"all"}' 2>&1
>> policy declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy
>> name=federate-me pattern="^ps."
>> 'definition={"federation-upstream-set":"all"}' 2>&1
>> policy declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all
>> pattern="^ha." 'definition={"ha-mode":"all"}' 2>&1
>> policy declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all
>> pattern="^ha." 'definition={"ha-mode":"all"}' 2>&1
>> policy declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>> component=federation-upstream name=my-upstream
>> value='{"uri":"amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.onx-sc.cg.company.com","expires":3600000}'
>> parameter declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>> component=federation name=local-username value='"aumh4l0SBFJBe3"'
>> parameter declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>> component=federation-upstream name=my-upstream
>> value='{"uri":"amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.chi-sc.cg.company.com","expires":3600000}'
>> parameter declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>> component=federation name=local-username value='"aumh4l0SBFJBe3"'
>> parameter declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare user
>> name=urFZ5xudDA1Sk password=***** tags= 2>&1
>> user declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare user
>> name=urFZ5xudDA1Sk password=***** tags= 2>&1
>> user declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare permission
>> vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.*
>> read=.* write=.* 2>&1
>> permission declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare permission
>> vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.*
>> read=.* write=.* 2>&1
>> permission declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare permission
>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>> write=.* 2>&1
>> permission declared
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=***** declare permission
>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>> write=.* 2>&1
>> permission declared
>> 
>> Here are the commands used to clean away this vhost :
>> 
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=***** delete user
>> name=urFZ5xudDA1Sk 2>&1
>> user deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=***** delete user
>> name=urFZ5xudDA1Sk 2>&1
>> user deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>> component=federation-upstream name=my-upstream 2>&1
>> parameter deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>> component=federation-upstream name=my-upstream 2>&1
>> parameter deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>> component=federation name=local-username 2>&1
>> parameter deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>> component=federation name=local-username 2>&1
>> parameter deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me
>> 2>&1
>> policy deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me
>> 2>&1
>> policy deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2>&1
>> policy deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2>&1
>> policy deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=***** delete vhost
>> name=v46997afd74174f1ea120fbeae38877b9 2>&1
>> Traceback (most recent call last):\n  File
>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 889, in
>> <module>\n    main()\n  File
>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 354, in
>> main\n    method()\n  File
>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 534, in
>> invoke_delete\n    self.delete(uri)\n  File
>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 386, in
>> delete\n    return self.http("DELETE", "/api%s" % path, "")\n  File
>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 421, in
>> http\n    % (resp.status, resp.reason, path, resp.read()))\nException:
>> Received 500 Internal Server Error for path
>> /api/vhosts/v46997afd74174f1ea120fbeae38877b9\n<html><head><title>500
>> Internal Server Error</title></head><body><h1>Internal Server
>> Error</h1>The server encountered an error while processing this
>> request:<br><pre>{throw,\n    {error,\n        {{badmatch,\n
>> {error_string,\n                 "Validation failed\n\nname not
>> recognised: undefined\n"}},\n
>> [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},\n
>>  {rabbit_vhost,internal_delete,1},\n
>>  {rabbit_vhost,'-delete/1-fun-0-',1},\n
>>  {mnesia_tm,apply_fun,3},\n
>>  {mnesia_tm,execute_transaction,5},\n
>>  {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},\n
>>  {worker_pool_worker,handle_call,3},\n
>>  {gen_server2,handle_msg,2}]}},\n
>>  [{rabbit_misc,execute_mnesia_transaction,1},\n
>> {rabbit_mgmt_wm_vhost,delete_resource,2},\n
>> {webmachine_resource,resource_call,3},\n
>> {webmachine_resource,do,3},\n
>> {webmachine_decision_core,resource_call,1},\n
>> {webmachine_decision_core,decision,1},\n
>> {webmachine_decision_core,handle_request,2},\n
>> {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}</pre><P><HR><ADDRESS>mochiweb+webmachine
>> web server</ADDRESS></body></html>\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>> --port=80 --username=admin --password=***** delete user
>> name=aumh4l0SBFJBe3 2>&1
>> user deleted\n
>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>> --port=80 --username=admin --password=***** delete user
>> name=aumh4l0SBFJBe3 2>&1
>> user deleted\n
>> 
>> Anyone got any ideas?
>> 
>> Thanks,
>> 
>> Ben.
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/94b8da5a/attachment.htm>

From simon at rabbitmq.com  Fri Feb 15 14:58:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Feb 2013 14:58:58 +0000
Subject: [rabbitmq-discuss] Unable to delete vhost
In-Reply-To: <CE45E464-D6C0-4C30-8285-37848EA3D67E@gmail.com>
References: <8e0160d2-c8fa-4289-a7da-3767ca00de40@googlegroups.com>
	<511E4430.9040303@rabbitmq.com>
	<CE45E464-D6C0-4C30-8285-37848EA3D67E@gmail.com>
Message-ID: <511E4D32.3040004@rabbitmq.com>

Hi Ben. So you removed the local-nodename for 
v46997afd74174f1ea120fbeae38877b9, but then tried to delete 
v4e73843117c745bb8c1796c2a423b177? I think that might be your problem.

Cheers, Simon

On 15/02/13 14:53, Ben Corlett wrote:
> Hey Simon,
>
> Thanks for the quick response.
>
> I did a :
>
> rabbitmqadmin --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 list parameters
>
> and could see :
>
> +-----------------------------------+----------------+---------------------+---------------------------------------------------------------------------------------------------------+
> |               vhost               |      name      |      component
>     |                                                 value
>                                        |
> +-----------------------------------+----------------+---------------------+---------------------------------------------------------------------------------------------------------+
> | v46997afd74174f1ea120fbeae38877b9 | local-nodename | federation
>     | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com
> <mailto:rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com>
>                                           |
> | v4e73843117c745bb8c1796c2a423b177 | local-nodename | federation
>     | rabbit at chi-sc-cget-m-rabbitmq-001.cg
> <mailto:rabbit at chi-sc-cget-m-rabbitmq-001.cg>.company.com
>                                           |
> | v6619a14c89694ca99530ee96d97fd40b | local-nodename | federation
>     | rabbit at chi-sc-cget-m-rabbitmq-001.cg
> <mailto:rabbit at chi-sc-cget-m-rabbitmq-001.cg>.company.com
>                                           |
> | v6619a14c89694ca99530ee96d97fd40b | local-username | federation
>     | auXTfXm39IuzJX
>                                       |
> | v6619a14c89694ca99530ee96d97fd40b | my-upstream    |
> federation-upstream | {"expires": 3600000, "uri":
> "amqp://auXTfXm39IuzJX:*****@stage-rabbitmq.onx-sc.cg.company.com"}
>      |
> +-----------------------------------+----------------+---------------------+---------------------------------------------------------------------------------------------------------+
>
> I removed the local-nodename for v46997afd74174f1ea120fbeae38877b9 with a :
>
> rabbitmqadmin --username=admin --password=*****
> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
> name=local-nodename component=federation
> parameter deleted
>
> I tried the delete again:
>
> [rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqctl delete_vhost
> v4e73843117c745bb8c1796c2a423b177
> Deleting vhost "v4e73843117c745bb8c1796c2a423b177" ...
> Error: {{badmatch,{error_string,"Validation failed\n\nname not
> recognised: undefined\n"}},
>          [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>           {rabbit_vhost,internal_delete,1},
>           {rabbit_vhost,'-delete/1-fun-0-',1},
>           {mnesia_tm,apply_fun,3},
>           {mnesia_tm,execute_transaction,5},
>           {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>           {worker_pool_worker,handle_call,3},
>           {gen_server2,handle_msg,2}]}
>
> I verified it had been removed :
>
> [rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqadmin --username=admin
> --password=***** --vhost=v46997afd74174f1ea120fbeae38877b9 list parameters
> +-----------------------------------+----------------+---------------------+--------------------------------------------------------------------------------------------------------+
> |               vhost               |      name      |      component
>     |                                                 value
>                                       |
> +-----------------------------------+----------------+---------------------+--------------------------------------------------------------------------------------------------------+
> | v4e73843117c745bb8c1796c2a423b177 | local-nodename | federation
>     | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com
> <mailto:rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com>
>                                            |
> | v6619a14c89694ca99530ee96d97fd40b | local-nodename | federation
>     | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com
> <mailto:rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com>
>                                            |
> | v6619a14c89694ca99530ee96d97fd40b | local-username | federation
>     | auXTfXm39IuzJX
>                                      |
> | v6619a14c89694ca99530ee96d97fd40b | my-upstream    |
> federation-upstream | {"expires": 3600000, "uri":
> "amqp://auXTfXm39IuzJX:*****@stage-rabbitmq.onx-sc.cg.company.com"}        |
> +-----------------------------------+----------------+---------------------+--------------------------------------------------------------------------------------------------------+
>
> I tried listing the polices to see if anything was remaining :
>
> [rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqadmin --username=admin
> --password=***** --vhost=v46997afd74174f1ea120fbeae38877b9 list policies
>
> +-----------------------------------+-------------+------------------------------------+---------+----------+
> |               vhost               |    name     |
> definition             | pattern | priority |
> +-----------------------------------+-------------+------------------------------------+---------+----------+
> | v6619a14c89694ca99530ee96d97fd40b | federate-me |
> {"federation-upstream-set": "all"} | ^ps.    | 0        |
> | v6619a14c89694ca99530ee96d97fd40b | ha-all      | {"ha-mode": "all"}
>                | ^ha.    | 0        |
> +-----------------------------------+-------------+------------------------------------+---------+----------+
>
> No such luck. Anything else likely to be lingering?
>
> Ben.
>
>
> On 15 Feb 2013, at 14:20, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>> Hi Ben. I think you have found a bug. In theory it should not be
>> necessary to delete parameters / policies that are associated with a
>> vhost before deleting the vhost - but it looks like in 3.0.2 it is. I
>> would invoke "rabbitmqadmin --vhost=... list parameters" and see what
>> you have got left - possibly an instance of "local-nodename".
>>
>> This should get fixed in the next release.
>>
>> Cheers, Simon
>>
>> On 15/02/13 12:08, Ben Corlett wrote:
>>> I am having some issues when trying to delete a vhost.
>>>
>>> I'm using the latest version of rabbitmq 3.0.2 and my set up has two
>>> clusters (2 machines in each) with a federation for pub/sub messages.
>>>
>>> When trying to remove the vhost via the web interface I get the error :
>>>
>>> Internal Server Error
>>>
>>> The server encountered an error while processing this request:
>>> {throw,
>>>     {error,
>>>         {{badmatch,
>>>              {error_string,
>>>                  "Validation failed\n\nname not recognised:
>>> undefined\n"}},
>>>          [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>>>           {rabbit_vhost,internal_delete,1},
>>>           {rabbit_vhost,'-delete/1-fun-0-',1},
>>>           {mnesia_tm,apply_fun,3},
>>>           {mnesia_tm,execute_transaction,5},
>>>           {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>>>           {worker_pool_worker,handle_call,3},
>>>           {gen_server2,handle_msg,2}]}},
>>>     [{rabbit_misc,execute_mnesia_transaction,1},
>>>      {rabbit_mgmt_wm_vhost,delete_resource,2},
>>>      {webmachine_resource,resource_call,3},
>>>      {webmachine_resource,do,3},
>>>      {webmachine_decision_core,resource_call,1},
>>>      {webmachine_decision_core,decision,1},
>>>      {webmachine_decision_core,handle_request,2},
>>>      {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}
>>>
>>> When trying to remove the vhost from the command line I get something
>>> similar :
>>>
>>> [rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqctl delete_vhost
>>> v4e73843117c745bb8c1796c2a423b177
>>> Deleting vhost "v4e73843117c745bb8c1796c2a423b177" ...
>>> Error: {{badmatch,{error_string,"Validation failed\n\nname not
>>> recognised: undefined\n"}},
>>>         [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>>>          {rabbit_vhost,internal_delete,1},
>>>          {rabbit_vhost,'-delete/1-fun-0-',1},
>>>          {mnesia_tm,apply_fun,3},
>>>          {mnesia_tm,execute_transaction,5},
>>>          {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>>>          {worker_pool_worker,handle_call,3},
>>>          {gen_server2,handle_msg,2}]}
>>>
>>>
>>> Here are the commands to initially set up the vhost via a script (the
>>> hosts used here are vips which are load balanced across both nodes in
>>> the cluster) :
>>>
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare vhost
>>> name=v46997afd74174f1ea120fbeae38877b9 2>&1
>>> vhost declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare vhost
>>> name=v46997afd74174f1ea120fbeae38877b9 2>&1
>>> vhost declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare user
>>> name=aumh4l0SBFJBe3 password=***** tags= 2>&1
>>> user declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare user
>>> name=aumh4l0SBFJBe3 password=***** tags= 2>&1
>>> user declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare permission
>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.*
>>> read=.* write=.* 2>&1
>>> permission declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare permission
>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.*
>>> read=.* write=.* 2>&1
>>> permission declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare permission
>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>>> write=.* 2>&1
>>> permission declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare permission
>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>>> write=.* 2>&1
>>> permission declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy
>>> name=federate-me pattern="^ps."
>>> 'definition={"federation-upstream-set":"all"}' 2>&1
>>> policy declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy
>>> name=federate-me pattern="^ps."
>>> 'definition={"federation-upstream-set":"all"}' 2>&1
>>> policy declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all
>>> pattern="^ha." 'definition={"ha-mode":"all"}' 2>&1
>>> policy declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all
>>> pattern="^ha." 'definition={"ha-mode":"all"}' 2>&1
>>> policy declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>>> component=federation-upstream name=my-upstream
>>> value='{"uri":"amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.onx-sc.cg.company.com","expires":3600000}'
>>> parameter declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>>> component=federation name=local-username value='"aumh4l0SBFJBe3"'
>>> parameter declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>>> component=federation-upstream name=my-upstream
>>> value='{"uri":"amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.chi-sc.cg.company.com","expires":3600000}'
>>> parameter declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>>> component=federation name=local-username value='"aumh4l0SBFJBe3"'
>>> parameter declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare user
>>> name=urFZ5xudDA1Sk password=***** tags= 2>&1
>>> user declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare user
>>> name=urFZ5xudDA1Sk password=***** tags= 2>&1
>>> user declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare permission
>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.*
>>> read=.* write=.* 2>&1
>>> permission declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare permission
>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.*
>>> read=.* write=.* 2>&1
>>> permission declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare permission
>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>>> write=.* 2>&1
>>> permission declared
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** declare permission
>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>>> write=.* 2>&1
>>> permission declared
>>>
>>> Here are the commands used to clean away this vhost :
>>>
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** delete user
>>> name=urFZ5xudDA1Sk 2>&1
>>> user deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** delete user
>>> name=urFZ5xudDA1Sk 2>&1
>>> user deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>>> component=federation-upstream name=my-upstream 2>&1
>>> parameter deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>>> component=federation-upstream name=my-upstream 2>&1
>>> parameter deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>>> component=federation name=local-username 2>&1
>>> parameter deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>>> component=federation name=local-username 2>&1
>>> parameter deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me
>>> 2>&1
>>> policy deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me
>>> 2>&1
>>> policy deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2>&1
>>> policy deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=*****
>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2>&1
>>> policy deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** delete vhost
>>> name=v46997afd74174f1ea120fbeae38877b9 2>&1
>>> Traceback (most recent call last):\n  File
>>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 889, in
>>> <module>\n    main()\n  File
>>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 354, in
>>> main\n    method()\n  File
>>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 534, in
>>> invoke_delete\n    self.delete(uri)\n  File
>>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 386, in
>>> delete\n    return self.http("DELETE", "/api%s" % path, "")\n  File
>>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 421, in
>>> http\n    % (resp.status, resp.reason, path, resp.read()))\nException:
>>> Received 500 Internal Server Error for path
>>> /api/vhosts/v46997afd74174f1ea120fbeae38877b9\n<html><head><title>500
>>> Internal Server Error</title></head><body><h1>Internal Server
>>> Error</h1>The server encountered an error while processing this
>>> request:<br><pre>{throw,\n    {error,\n        {{badmatch,\n
>>> {error_string,\n                 "Validation failed\n\nname not
>>> recognised: undefined\n"}},\n
>>> [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},\n
>>>  {rabbit_vhost,internal_delete,1},\n
>>>  {rabbit_vhost,'-delete/1-fun-0-',1},\n
>>>  {mnesia_tm,apply_fun,3},\n
>>>  {mnesia_tm,execute_transaction,5},\n
>>>  {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},\n
>>>  {worker_pool_worker,handle_call,3},\n
>>>  {gen_server2,handle_msg,2}]}},\n
>>>  [{rabbit_misc,execute_mnesia_transaction,1},\n
>>> {rabbit_mgmt_wm_vhost,delete_resource,2},\n
>>> {webmachine_resource,resource_call,3},\n
>>> {webmachine_resource,do,3},\n
>>> {webmachine_decision_core,resource_call,1},\n
>>> {webmachine_decision_core,decision,1},\n
>>> {webmachine_decision_core,handle_request,2},\n
>>> {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}</pre><P><HR><ADDRESS>mochiweb+webmachine
>>> web server</ADDRESS></body></html>\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** delete user
>>> name=aumh4l0SBFJBe3 2>&1
>>> user deleted\n
>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>> <http://sc.cg.company.com>
>>> --port=80 --username=admin --password=***** delete user
>>> name=aumh4l0SBFJBe3 2>&1
>>> user deleted\n
>>>
>>> Anyone got any ideas?
>>>
>>> Thanks,
>>>
>>> Ben.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>


-- 
Simon MacMullen
RabbitMQ, VMware

From ben.corlett at gmail.com  Fri Feb 15 15:19:11 2013
From: ben.corlett at gmail.com (Ben Corlett)
Date: Fri, 15 Feb 2013 15:19:11 +0000
Subject: [rabbitmq-discuss] Unable to delete vhost
In-Reply-To: <511E4D32.3040004@rabbitmq.com>
References: <8e0160d2-c8fa-4289-a7da-3767ca00de40@googlegroups.com>
	<511E4430.9040303@rabbitmq.com>
	<CE45E464-D6C0-4C30-8285-37848EA3D67E@gmail.com>
	<511E4D32.3040004@rabbitmq.com>
Message-ID: <3E8BCE99-2D94-4D28-88A2-22F83F914104@gmail.com>

Yup, thats right I'm a damn fool

[rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqctl delete_vhost v46997afd74174f1ea120fbeae38877b9
Deleting vhost "v46997afd74174f1ea120fbeae38877b9" ...
...done.

Works now.

Thanks a lot Simon,

Ben.

On 15 Feb 2013, at 14:58, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi Ben. So you removed the local-nodename for v46997afd74174f1ea120fbeae38877b9, but then tried to delete v4e73843117c745bb8c1796c2a423b177? I think that might be your problem.
> 
> Cheers, Simon
> 
> On 15/02/13 14:53, Ben Corlett wrote:
>> Hey Simon,
>> 
>> Thanks for the quick response.
>> 
>> I did a :
>> 
>> rabbitmqadmin --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 list parameters
>> 
>> and could see :
>> 
>> +-----------------------------------+----------------+---------------------+---------------------------------------------------------------------------------------------------------+
>> |               vhost               |      name      |      component
>>    |                                                 value
>>                                       |
>> +-----------------------------------+----------------+---------------------+---------------------------------------------------------------------------------------------------------+
>> | v46997afd74174f1ea120fbeae38877b9 | local-nodename | federation
>>    | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com
>> <mailto:rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com>
>>                                          |
>> | v4e73843117c745bb8c1796c2a423b177 | local-nodename | federation
>>    | rabbit at chi-sc-cget-m-rabbitmq-001.cg
>> <mailto:rabbit at chi-sc-cget-m-rabbitmq-001.cg>.company.com
>>                                          |
>> | v6619a14c89694ca99530ee96d97fd40b | local-nodename | federation
>>    | rabbit at chi-sc-cget-m-rabbitmq-001.cg
>> <mailto:rabbit at chi-sc-cget-m-rabbitmq-001.cg>.company.com
>>                                          |
>> | v6619a14c89694ca99530ee96d97fd40b | local-username | federation
>>    | auXTfXm39IuzJX
>>                                      |
>> | v6619a14c89694ca99530ee96d97fd40b | my-upstream    |
>> federation-upstream | {"expires": 3600000, "uri":
>> "amqp://auXTfXm39IuzJX:*****@stage-rabbitmq.onx-sc.cg.company.com"}
>>     |
>> +-----------------------------------+----------------+---------------------+---------------------------------------------------------------------------------------------------------+
>> 
>> I removed the local-nodename for v46997afd74174f1ea120fbeae38877b9 with a :
>> 
>> rabbitmqadmin --username=admin --password=*****
>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>> name=local-nodename component=federation
>> parameter deleted
>> 
>> I tried the delete again:
>> 
>> [rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqctl delete_vhost
>> v4e73843117c745bb8c1796c2a423b177
>> Deleting vhost "v4e73843117c745bb8c1796c2a423b177" ...
>> Error: {{badmatch,{error_string,"Validation failed\n\nname not
>> recognised: undefined\n"}},
>>         [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>>          {rabbit_vhost,internal_delete,1},
>>          {rabbit_vhost,'-delete/1-fun-0-',1},
>>          {mnesia_tm,apply_fun,3},
>>          {mnesia_tm,execute_transaction,5},
>>          {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>>          {worker_pool_worker,handle_call,3},
>>          {gen_server2,handle_msg,2}]}
>> 
>> I verified it had been removed :
>> 
>> [rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqadmin --username=admin
>> --password=***** --vhost=v46997afd74174f1ea120fbeae38877b9 list parameters
>> +-----------------------------------+----------------+---------------------+--------------------------------------------------------------------------------------------------------+
>> |               vhost               |      name      |      component
>>    |                                                 value
>>                                      |
>> +-----------------------------------+----------------+---------------------+--------------------------------------------------------------------------------------------------------+
>> | v4e73843117c745bb8c1796c2a423b177 | local-nodename | federation
>>    | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com
>> <mailto:rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com>
>>                                           |
>> | v6619a14c89694ca99530ee96d97fd40b | local-nodename | federation
>>    | rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com
>> <mailto:rabbit at chi-sc-cget-m-rabbitmq-001.cg.company.com>
>>                                           |
>> | v6619a14c89694ca99530ee96d97fd40b | local-username | federation
>>    | auXTfXm39IuzJX
>>                                     |
>> | v6619a14c89694ca99530ee96d97fd40b | my-upstream    |
>> federation-upstream | {"expires": 3600000, "uri":
>> "amqp://auXTfXm39IuzJX:*****@stage-rabbitmq.onx-sc.cg.company.com"}        |
>> +-----------------------------------+----------------+---------------------+--------------------------------------------------------------------------------------------------------+
>> 
>> I tried listing the polices to see if anything was remaining :
>> 
>> [rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqadmin --username=admin
>> --password=***** --vhost=v46997afd74174f1ea120fbeae38877b9 list policies
>> 
>> +-----------------------------------+-------------+------------------------------------+---------+----------+
>> |               vhost               |    name     |
>> definition             | pattern | priority |
>> +-----------------------------------+-------------+------------------------------------+---------+----------+
>> | v6619a14c89694ca99530ee96d97fd40b | federate-me |
>> {"federation-upstream-set": "all"} | ^ps.    | 0        |
>> | v6619a14c89694ca99530ee96d97fd40b | ha-all      | {"ha-mode": "all"}
>>               | ^ha.    | 0        |
>> +-----------------------------------+-------------+------------------------------------+---------+----------+
>> 
>> No such luck. Anything else likely to be lingering?
>> 
>> Ben.
>> 
>> 
>> On 15 Feb 2013, at 14:20, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>> 
>>> Hi Ben. I think you have found a bug. In theory it should not be
>>> necessary to delete parameters / policies that are associated with a
>>> vhost before deleting the vhost - but it looks like in 3.0.2 it is. I
>>> would invoke "rabbitmqadmin --vhost=... list parameters" and see what
>>> you have got left - possibly an instance of "local-nodename".
>>> 
>>> This should get fixed in the next release.
>>> 
>>> Cheers, Simon
>>> 
>>> On 15/02/13 12:08, Ben Corlett wrote:
>>>> I am having some issues when trying to delete a vhost.
>>>> 
>>>> I'm using the latest version of rabbitmq 3.0.2 and my set up has two
>>>> clusters (2 machines in each) with a federation for pub/sub messages.
>>>> 
>>>> When trying to remove the vhost via the web interface I get the error :
>>>> 
>>>> Internal Server Error
>>>> 
>>>> The server encountered an error while processing this request:
>>>> {throw,
>>>>    {error,
>>>>        {{badmatch,
>>>>             {error_string,
>>>>                 "Validation failed\n\nname not recognised:
>>>> undefined\n"}},
>>>>         [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>>>>          {rabbit_vhost,internal_delete,1},
>>>>          {rabbit_vhost,'-delete/1-fun-0-',1},
>>>>          {mnesia_tm,apply_fun,3},
>>>>          {mnesia_tm,execute_transaction,5},
>>>>          {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>>>>          {worker_pool_worker,handle_call,3},
>>>>          {gen_server2,handle_msg,2}]}},
>>>>    [{rabbit_misc,execute_mnesia_transaction,1},
>>>>     {rabbit_mgmt_wm_vhost,delete_resource,2},
>>>>     {webmachine_resource,resource_call,3},
>>>>     {webmachine_resource,do,3},
>>>>     {webmachine_decision_core,resource_call,1},
>>>>     {webmachine_decision_core,decision,1},
>>>>     {webmachine_decision_core,handle_request,2},
>>>>     {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}
>>>> 
>>>> When trying to remove the vhost from the command line I get something
>>>> similar :
>>>> 
>>>> [rabbitmq at chi-sc-cget-m-rabbitmq-001 ~]$ rabbitmqctl delete_vhost
>>>> v4e73843117c745bb8c1796c2a423b177
>>>> Deleting vhost "v4e73843117c745bb8c1796c2a423b177" ...
>>>> Error: {{badmatch,{error_string,"Validation failed\n\nname not
>>>> recognised: undefined\n"}},
>>>>        [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},
>>>>         {rabbit_vhost,internal_delete,1},
>>>>         {rabbit_vhost,'-delete/1-fun-0-',1},
>>>>         {mnesia_tm,apply_fun,3},
>>>>         {mnesia_tm,execute_transaction,5},
>>>>         {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},
>>>>         {worker_pool_worker,handle_call,3},
>>>>         {gen_server2,handle_msg,2}]}
>>>> 
>>>> 
>>>> Here are the commands to initially set up the vhost via a script (the
>>>> hosts used here are vips which are load balanced across both nodes in
>>>> the cluster) :
>>>> 
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare vhost
>>>> name=v46997afd74174f1ea120fbeae38877b9 2>&1
>>>> vhost declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare vhost
>>>> name=v46997afd74174f1ea120fbeae38877b9 2>&1
>>>> vhost declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare user
>>>> name=aumh4l0SBFJBe3 password=***** tags= 2>&1
>>>> user declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare user
>>>> name=aumh4l0SBFJBe3 password=***** tags= 2>&1
>>>> user declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare permission
>>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.*
>>>> read=.* write=.* 2>&1
>>>> permission declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare permission
>>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=aumh4l0SBFJBe3 configure=.*
>>>> read=.* write=.* 2>&1
>>>> permission declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare permission
>>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>>>> write=.* 2>&1
>>>> permission declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare permission
>>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>>>> write=.* 2>&1
>>>> permission declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy
>>>> name=federate-me pattern="^ps."
>>>> 'definition={"federation-upstream-set":"all"}' 2>&1
>>>> policy declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy
>>>> name=federate-me pattern="^ps."
>>>> 'definition={"federation-upstream-set":"all"}' 2>&1
>>>> policy declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all
>>>> pattern="^ha." 'definition={"ha-mode":"all"}' 2>&1
>>>> policy declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare policy name=ha-all
>>>> pattern="^ha." 'definition={"ha-mode":"all"}' 2>&1
>>>> policy declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>>>> component=federation-upstream name=my-upstream
>>>> value='{"uri":"amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.onx-sc.cg.company.com","expires":3600000}'
>>>> parameter declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>>>> component=federation name=local-username value='"aumh4l0SBFJBe3"'
>>>> parameter declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>>>> component=federation-upstream name=my-upstream
>>>> value='{"uri":"amqp://aumh4l0SBFJBe3:*****@stage-rabbitmq.chi-sc.cg.company.com","expires":3600000}'
>>>> parameter declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 declare parameter
>>>> component=federation name=local-username value='"aumh4l0SBFJBe3"'
>>>> parameter declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare user
>>>> name=urFZ5xudDA1Sk password=***** tags= 2>&1
>>>> user declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare user
>>>> name=urFZ5xudDA1Sk password=***** tags= 2>&1
>>>> user declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare permission
>>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.*
>>>> read=.* write=.* 2>&1
>>>> permission declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare permission
>>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=urFZ5xudDA1Sk configure=.*
>>>> read=.* write=.* 2>&1
>>>> permission declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare permission
>>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>>>> write=.* 2>&1
>>>> permission declared
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** declare permission
>>>> vhost=v46997afd74174f1ea120fbeae38877b9 user=admin configure=.* read=.*
>>>> write=.* 2>&1
>>>> permission declared
>>>> 
>>>> Here are the commands used to clean away this vhost :
>>>> 
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** delete user
>>>> name=urFZ5xudDA1Sk 2>&1
>>>> user deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** delete user
>>>> name=urFZ5xudDA1Sk 2>&1
>>>> user deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>>>> component=federation-upstream name=my-upstream 2>&1
>>>> parameter deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>>>> component=federation-upstream name=my-upstream 2>&1
>>>> parameter deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>>>> component=federation name=local-username 2>&1
>>>> parameter deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete parameter
>>>> component=federation name=local-username 2>&1
>>>> parameter deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me
>>>> 2>&1
>>>> policy deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=federate-me
>>>> 2>&1
>>>> policy deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2>&1
>>>> policy deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=*****
>>>> --vhost=v46997afd74174f1ea120fbeae38877b9 delete policy name=ha-all 2>&1
>>>> policy deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** delete vhost
>>>> name=v46997afd74174f1ea120fbeae38877b9 2>&1
>>>> Traceback (most recent call last):\n  File
>>>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 889, in
>>>> <module>\n    main()\n  File
>>>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 354, in
>>>> main\n    method()\n  File
>>>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 534, in
>>>> invoke_delete\n    self.delete(uri)\n  File
>>>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 386, in
>>>> delete\n    return self.http("DELETE", "/api%s" % path, "")\n  File
>>>> "/apps/nimbus/built/rabbitmq/3.0.0/sbin/rabbitmqadmin", line 421, in
>>>> http\n    % (resp.status, resp.reason, path, resp.read()))\nException:
>>>> Received 500 Internal Server Error for path
>>>> /api/vhosts/v46997afd74174f1ea120fbeae38877b9\n<html><head><title>500
>>>> Internal Server Error</title></head><body><h1>Internal Server
>>>> Error</h1>The server encountered an error while processing this
>>>> request:<br><pre>{throw,\n    {error,\n        {{badmatch,\n
>>>> {error_string,\n                 "Validation failed\n\nname not
>>>> recognised: undefined\n"}},\n
>>>> [{rabbit_vhost,'-internal_delete/1-lc$^1/1-1-',2},\n
>>>> {rabbit_vhost,internal_delete,1},\n
>>>> {rabbit_vhost,'-delete/1-fun-0-',1},\n
>>>> {mnesia_tm,apply_fun,3},\n
>>>> {mnesia_tm,execute_transaction,5},\n
>>>> {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1},\n
>>>> {worker_pool_worker,handle_call,3},\n
>>>> {gen_server2,handle_msg,2}]}},\n
>>>> [{rabbit_misc,execute_mnesia_transaction,1},\n
>>>> {rabbit_mgmt_wm_vhost,delete_resource,2},\n
>>>> {webmachine_resource,resource_call,3},\n
>>>> {webmachine_resource,do,3},\n
>>>> {webmachine_decision_core,resource_call,1},\n
>>>> {webmachine_decision_core,decision,1},\n
>>>> {webmachine_decision_core,handle_request,2},\n
>>>> {rabbit_webmachine,'-makeloop/1-fun-0-',2}]}</pre><P><HR><ADDRESS>mochiweb+webmachine
>>>> web server</ADDRESS></body></html>\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.chi-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** delete user
>>>> name=aumh4l0SBFJBe3 2>&1
>>>> user deleted\n
>>>> Running ... rabbitmqadmin --host=stage-rabbitmq.onx-sc.cg.company.com
>>>> <http://sc.cg.company.com>
>>>> --port=80 --username=admin --password=***** delete user
>>>> name=aumh4l0SBFJBe3 2>&1
>>>> user deleted\n
>>>> 
>>>> Anyone got any ideas?
>>>> 
>>>> Thanks,
>>>> 
>>>> Ben.
>>>> 
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>> 
>>> 
>>> --
>>> Simon MacMullen
>>> RabbitMQ, VMware
>> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware


From jhalterman at gmail.com  Fri Feb 15 20:34:28 2013
From: jhalterman at gmail.com (Jonathan)
Date: Fri, 15 Feb 2013 12:34:28 -0800 (PST)
Subject: [rabbitmq-discuss] Thread per channel and partitioning by channel
	(java client)
Message-ID: <e8c7529d-d32b-476e-b33f-84e7754ae1a2@googlegroups.com>

I read that each channel in the Java client gets its own thread. What is 
this thread used for? The reason I ask is if connections have their own 
thread and consumers are allocated from a thread pool, what could the 
channel's thread be used for aside from publishing?

Also, what are some strategies for determining how to partition messages by 
channel? For example, if I'm routing messages for a set of users in my 
application, it's simple to create one channel per user. But if I have 
hundreds of users being handled by my client, and each channel has its own 
thread, I obviously don't want hundreds of threads. Any strategies for this?

Thanks,
Jonathan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/7d7768cb/attachment.htm>

From matthias at rabbitmq.com  Fri Feb 15 20:48:45 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 15 Feb 2013 20:48:45 +0000
Subject: [rabbitmq-discuss] Thread per channel and partitioning by
 channel (java client)
In-Reply-To: <e8c7529d-d32b-476e-b33f-84e7754ae1a2@googlegroups.com>
References: <e8c7529d-d32b-476e-b33f-84e7754ae1a2@googlegroups.com>
Message-ID: <511E9F2D.1030609@rabbitmq.com>

Jonathan,

On 15/02/13 20:34, Jonathan wrote:
> I read that each channel in the Java client gets its own thread.

Where did you read that? It's not true.

> Also, what are some strategies for determining how to partition messages
> by channel? For example, if I'm routing messages for a set of users in
> my application, it's simple to create one channel per user.

Nothing wrong with that.


Matthias.

From jhalterman at gmail.com  Fri Feb 15 20:53:23 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Fri, 15 Feb 2013 12:53:23 -0800
Subject: [rabbitmq-discuss] Thread per channel and partitioning by
 channel (java client)
In-Reply-To: <511E9F2D.1030609@rabbitmq.com>
References: <e8c7529d-d32b-476e-b33f-84e7754ae1a2@googlegroups.com>
	<511E9F2D.1030609@rabbitmq.com>
Message-ID: <CA+es_-whoyTRLBPNGxWqrinoKK+WpGNP-armDO1AeUWe9Qa18g@mail.gmail.com>

Hi Matthias,

On Fri, Feb 15, 2013 at 12:48 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Jonathan,
>
> On 15/02/13 20:34, Jonathan wrote:
>
>> I read that each channel in the Java client gets its own thread.
>>
>
> Where did you read that? It's not true.
>

What I was reading was from here:

http://www.rabbitmq.com/api-guide.html#consuming

"Each Channel has its own dispatch thread"

Maybe you could clarify what that means.


>
>  Also, what are some strategies for determining how to partition messages
>> by channel? For example, if I'm routing messages for a set of users in
>> my application, it's simple to create one channel per user.
>>
>
> Nothing wrong with that.


Good to know.


>
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/eddd7521/attachment.htm>

From jhalterman at gmail.com  Fri Feb 15 20:56:42 2013
From: jhalterman at gmail.com (Jonathan)
Date: Fri, 15 Feb 2013 12:56:42 -0800 (PST)
Subject: [rabbitmq-discuss] Performance of many binding keys on a single
	queue
Message-ID: <f636568f-d4c9-4e55-bdcf-ab5c03e177e0@googlegroups.com>

I'm curious about the impact of having many (hundreds or thousands) of 
binding keys on a single queue. Can I expect messages to still be routed to 
the queue in more or less constant time? Does it depend on the exchange 
type (topic versus direct)? I was thinking that routing in a direct 
exchange at least might be constant time since no wildcard matching is 
needed and might involve a simple hash lookup.

Thanks,
Jonathan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/c963a932/attachment.htm>

From jerryk at rbcon.com  Fri Feb 15 21:15:57 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 15 Feb 2013 13:15:57 -0800
Subject: [rabbitmq-discuss] Performance of many binding keys on a single
	queue
In-Reply-To: <f636568f-d4c9-4e55-bdcf-ab5c03e177e0@googlegroups.com>
References: <f636568f-d4c9-4e55-bdcf-ab5c03e177e0@googlegroups.com>
Message-ID: <CAE0Sz=w5=1mYjZcdNr5go=pgi3i6LKqCr-a-wJYmKSq0nZ7rTw@mail.gmail.com>

Hi, Jonathan:

The routing work for an exchange is actually performed by the Erlang
process associated with the channel you're publishing on, rather than being
an independent entity as the processes that back queues are.

On a per message basis, the amount of routing work will depend on the
exchange type and whatever matching behavior is implemented for it.
 Documentation to set your expectations for the different exchange types
can be found around the RabbitMQ website, e.g. here, where the performance
improvements to topic exchanges were first written up:

http://www.rabbitmq.com/blog/tag/trie/

...as well as in the Manning book "RabbitMQ in Action" IIRC.

Best regards,
Jerry

On Fri, Feb 15, 2013 at 12:56 PM, Jonathan <jhalterman at gmail.com> wrote:

> I'm curious about the impact of having many (hundreds or thousands) of
> binding keys on a single queue. Can I expect messages to still be routed to
> the queue in more or less constant time? Does it depend on the exchange
> type (topic versus direct)? I was thinking that routing in a direct
> exchange at least might be constant time since no wildcard matching is
> needed and might involve a simple hash lookup.
>
> Thanks,
> Jonathan
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/a44f7114/attachment.htm>

From matthias at rabbitmq.com  Fri Feb 15 21:19:51 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 15 Feb 2013 21:19:51 +0000
Subject: [rabbitmq-discuss] Thread per channel and partitioning by
 channel (java client)
In-Reply-To: <CA+es_-whoyTRLBPNGxWqrinoKK+WpGNP-armDO1AeUWe9Qa18g@mail.gmail.com>
References: <e8c7529d-d32b-476e-b33f-84e7754ae1a2@googlegroups.com>
	<511E9F2D.1030609@rabbitmq.com>
	<CA+es_-whoyTRLBPNGxWqrinoKK+WpGNP-armDO1AeUWe9Qa18g@mail.gmail.com>
Message-ID: <511EA677.2040309@rabbitmq.com>

Jonathan,

On 15/02/13 20:53, Jonathan Halterman wrote:
> What I was reading was from here:
>
> http://www.rabbitmq.com/api-guide.html#consuming
>
> "Each Channel has its own dispatch thread"

That isn't meant to imply that there is one thread per channel, though I 
can see how it could be read that way.

Consumer processing happens on the threads in the Consumer thread pool 
See www.rabbitmq.com/api-guide.html#consumer-thread-pool. But processing 
is constrained s.t. all messages arriving on a channel are processed 
serially, i.e. at any point in time at most one thread in the pool is 
processing consumer work for a given channel.

I am cc'ing my colleague Steve, who may be able to shed more light on 
this and what he meant by "dispatch thread" above.

Matthias.

From jhalterman at gmail.com  Fri Feb 15 21:57:30 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Fri, 15 Feb 2013 13:57:30 -0800
Subject: [rabbitmq-discuss] Thread per channel and partitioning by
 channel (java client)
In-Reply-To: <511EA677.2040309@rabbitmq.com>
References: <e8c7529d-d32b-476e-b33f-84e7754ae1a2@googlegroups.com>
	<511E9F2D.1030609@rabbitmq.com>
	<CA+es_-whoyTRLBPNGxWqrinoKK+WpGNP-armDO1AeUWe9Qa18g@mail.gmail.com>
	<511EA677.2040309@rabbitmq.com>
Message-ID: <CA+es_-ze67ARLLpiUE_envm9g-Esr7zasSEXiTLTxXcKX-mJXw@mail.gmail.com>

On Fri, Feb 15, 2013 at 1:19 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Jonathan,
>
>
> On 15/02/13 20:53, Jonathan Halterman wrote:
>
>> What I was reading was from here:
>>
>> http://www.rabbitmq.com/api-**guide.html#consuming<http://www.rabbitmq.com/api-guide.html#consuming>
>>
>> "Each Channel has its own dispatch thread"
>>
>
> That isn't meant to imply that there is one thread per channel, though I
> can see how it could be read that way.
>
> Consumer processing happens on the threads in the Consumer thread pool See
> www.rabbitmq.com/api-guide.**html#consumer-thread-pool<http://www.rabbitmq.com/api-guide.html#consumer-thread-pool>.
> But processing is constrained s.t. all messages arriving on a channel are
> processed serially, i.e. at any point in time at most one thread in the
> pool is processing consumer work for a given channel.
>
> I am cc'ing my colleague Steve, who may be able to shed more light on this
> and what he meant by "dispatch thread" above.


I understand, thanks for the clarification. It was just the wording of the
docs led me to believe there was a separate thread per channel in addition
to the consumer threadpool. Glad to know there is not!


>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/36c97403/attachment.htm>

From mary.nagle at warbyparker.com  Fri Feb 15 22:48:54 2013
From: mary.nagle at warbyparker.com (Mary Nagle)
Date: Fri, 15 Feb 2013 17:48:54 -0500
Subject: [rabbitmq-discuss] Consultant Needed: Rabbit MQ Expert
Message-ID: <CAOMV0bzweCZ697ThwW3hhm9UxoDyU1-PQhnxA-LCweayAQodZQ@mail.gmail.com>

Hello, RabbitMQ!

I've been asked to find a Rabbit MQ expert to do consultant work at my
company, and hopefully I've come to the right place for help!

Warby Parker <http://www.warbyparker.com/> wishes to hire a consultant for
a 1-2 month engagement on site at our headquarters in New York, NY. We need
someone who is an expert in Rabbit MQ and optimally has general message
queue experience to help guide architecture and consult on implementation
details and answer questions. We hope to find someone who can start
immediately. If interested, please reply with either your resume or a cover
letter outlining your work, and perhaps a reference or two. We look forward
to hearing from you!

Best,
Mary

-- 

Mary N.

WARBY PARKER EYEWEAR<http://www.google.com/url?q=http%3A%2F%2Fwww.warbyparker.com%2F&sa=D&sntz=1&usg=AFrqEzfkTF4rhdwjlARqomkRV4TIc34NxA>
P: 646.738.3831
Friend us: Facebook<http://www.google.com/url?q=http%3A%2F%2Fwww.facebook.com%2Fwarbyparker&sa=D&sntz=1&usg=AFrqEzfUEaV6C9BaTQ8cI-VKdanu2UUQbw>
|  Follow us: Twitter<http://www.google.com/url?q=http%3A%2F%2Ftwitter.com%2Fwarbyparker&sa=D&sntz=1&usg=AFrqEzczMD6HXAtHLBzviQV_EtD3ckoJVQ>

Watch our very first TV commercial > <http://www.warbyparker.com/tv>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/90a72a10/attachment.htm>

From jerryk at rbcon.com  Sat Feb 16 02:27:30 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 15 Feb 2013 18:27:30 -0800
Subject: [rabbitmq-discuss] Consultant Needed: Rabbit MQ Expert
In-Reply-To: <CAOMV0bzweCZ697ThwW3hhm9UxoDyU1-PQhnxA-LCweayAQodZQ@mail.gmail.com>
References: <CAOMV0bzweCZ697ThwW3hhm9UxoDyU1-PQhnxA-LCweayAQodZQ@mail.gmail.com>
Message-ID: <CAE0Sz=wsAdysxMPJ7fi=LoWDLkL087KWCTYxXzGxKtDf4jQQ0Q@mail.gmail.com>

Not to shill, but VMware itself sells RabbitMQ support and PSO services for
RabbitMQ...  Will forward your mail to some folks who may be able to help.

On Fri, Feb 15, 2013 at 2:48 PM, Mary Nagle <mary.nagle at warbyparker.com>wrote:

> Hello, RabbitMQ!
>
> I've been asked to find a Rabbit MQ expert to do consultant work at my
> company, and hopefully I've come to the right place for help!
>
> Warby Parker <http://www.warbyparker.com/> wishes to hire a consultant
> for a 1-2 month engagement on site at our headquarters in New York, NY. We
> need someone who is an expert in Rabbit MQ and optimally has general
> message queue experience to help guide architecture and consult on
> implementation details and answer questions. We hope to find someone who
> can start immediately. If interested, please reply with either your resume
> or a cover letter outlining your work, and perhaps a reference or two. We
> look forward to hearing from you!
>
> Best,
> Mary
>
> --
>
> Mary N.
>
> WARBY PARKER EYEWEAR<http://www.google.com/url?q=http%3A%2F%2Fwww.warbyparker.com%2F&sa=D&sntz=1&usg=AFrqEzfkTF4rhdwjlARqomkRV4TIc34NxA>
> P: 646.738.3831
> Friend us: Facebook<http://www.google.com/url?q=http%3A%2F%2Fwww.facebook.com%2Fwarbyparker&sa=D&sntz=1&usg=AFrqEzfUEaV6C9BaTQ8cI-VKdanu2UUQbw>
> |  Follow us: Twitter<http://www.google.com/url?q=http%3A%2F%2Ftwitter.com%2Fwarbyparker&sa=D&sntz=1&usg=AFrqEzczMD6HXAtHLBzviQV_EtD3ckoJVQ>
>
> Watch our very first TV commercial > <http://www.warbyparker.com/tv>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/85c9dcf8/attachment.htm>

From francois at teksol.info  Sat Feb 16 02:31:09 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Fri, 15 Feb 2013 21:31:09 -0500
Subject: [rabbitmq-discuss] Consistent Exchange Only if Consumers?
Message-ID: <DF3FAB26-BEB1-41AD-BB44-B041B1C85D08@teksol.info>

Hi all!

Is there a knob somewhere to make x-consistent-hash exchanges deliver only to queues that have an active consumer?

My use case is dedupping before processing: I receive interactions from social networks, and the same interaction may be harvested multiple times. I have distributed caches that dedup the interactions, and am successfully using an x-consistent-hash exchange to do the deduping. I chose to use exclusive queues for the consumers, so if the consumer crashes, messages will be rerouted. Problem is, if the consumer crashes, the messages are lost.

If the x-consistent-hash exchange routed messages only if there was an active consumer, then I could use durable queues. Alternatively, on consumer crash, if the queue could redeliver the messages to the origin exchange, then I would be all right as well.

My problem is really with the messages that are in the queue when a consumer crashes. Not with mandatory, because I have dozens of queues in which to deliver the messages, so the message will be routed, and the mandatory flag will not help in this instance.

Any thoughts or ideas on this?

Thanks!
Fran?ois
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130215/2e617b69/attachment.bin>

From oldhomelh at gmail.com  Sat Feb 16 02:44:46 2013
From: oldhomelh at gmail.com (andy lin)
Date: Fri, 15 Feb 2013 18:44:46 -0800 (PST)
Subject: [rabbitmq-discuss] why a flowing Connection can make all
	Connection blocked
In-Reply-To: <5114E32C.2070703@rabbitmq.com>
References: <1359683075316-24811.post@n5.nabble.com>
	<510B9BE6.8050001@rabbitmq.com>
	<1359787126555-24829.post@n5.nabble.com>
	<5114E32C.2070703@rabbitmq.com>
Message-ID: <1360982686085-25055.post@n5.nabble.com>

Matthias Radestock-3 wrote
> On 02/02/13 06:38, andy lin wrote:
>>       I have checked ,but I find   no  memory  or disk  alarm going
>> off,and
>> only one connection show flowing state ,others show running state,But all
>> Connection can't receive or send.Maybe other reason?
> 
> What exactly are you seeing at the client end? i.e. how did you 
> determine that the connections "can't receive or send"?
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list

> rabbitmq-discuss at .rabbitmq

> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 because when the flowing controll  mechanism take effect , my  all consumer
can't receive any messages ,in the web manager ,I find that there are many
unack messages , and the message rates are zero?





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/why-a-flowing-Connection-can-make-all-Connection-blocked-tp24811p25055.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Sat Feb 16 08:45:10 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 16 Feb 2013 08:45:10 +0000
Subject: [rabbitmq-discuss] why a flowing Connection can make all
 Connection blocked
In-Reply-To: <1360982686085-25055.post@n5.nabble.com>
References: <1359683075316-24811.post@n5.nabble.com>
	<510B9BE6.8050001@rabbitmq.com>
	<1359787126555-24829.post@n5.nabble.com>
	<5114E32C.2070703@rabbitmq.com>
	<1360982686085-25055.post@n5.nabble.com>
Message-ID: <511F4716.4070106@rabbitmq.com>

On 16/02/13 02:44, andy lin wrote:
> Matthias Radestock-3 wrote
>> What exactly are you seeing at the client end? i.e. how did you
>> determine that the connections "can't receive or send"?
>
>   because when the flowing controll  mechanism take effect , my  all consumer
> can't receive any messages ,in the web manager ,I find that there are many
> unack messages , and the message rates are zero?

'Unacked' counts messages that have been sent to the consumer but not 
acknowledged. Are there any *ready* messages in queues that have 
consumers attached to them?

Next time you see a problem, please capture the output of 'rabbitmqctl 
report' and post it here. Also, if you are not already running on 
RabbitMQ 3.0.2, please upgrade.

Regards,

Matthias.

From matthias at rabbitmq.com  Sat Feb 16 09:03:31 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 16 Feb 2013 09:03:31 +0000
Subject: [rabbitmq-discuss] Round robin Topic exchange s
In-Reply-To: <-7374270265055004400@unknownmsgid>
References: <ccbc0c2b-bf26-469b-a63a-342ea48af8f0@googlegroups.com>
	<51138BAA.9040005@rabbitmq.com> <-7207996771937574196@unknownmsgid>
	<5113C2FB.4050809@rabbitmq.com> <-7374270265055004400@unknownmsgid>
Message-ID: <511F4B63.8090606@rabbitmq.com>

Marc,

On 07/02/13 15:28, Marc Teichtahl wrote:
> Simon
>
> Thanks for the considered reply.
>
> We could go with your assumption
>
> "If the number of routing keys is limited and topic wildcards are not
> needed then you could just have one queue per routing key and have
> consumers consume from all the queues they are interested in, and the
> built in round robin would work for you."
>
> If we use a non-wildcard key then perhaps the topic exchange could
> look more like a set of direct of direct exchanges. This way the
> existing round robin mechanisms could be used. In fact, I may have
> misunderstood but doesn't the current topic exchange work like that ?

Exchanges route messages to all queues (or other exchanges) that have 
bindings which match the message. There is no round-robin routing taking 
place at this stage. The round-robin mechanism Simon is referring to 
operates between individual queues and their consumers.

Matthias.

From mtlotfizad at gmail.com  Sun Feb 17 08:49:41 2013
From: mtlotfizad at gmail.com (Mohsen Lotfizad)
Date: Sun, 17 Feb 2013 12:19:41 +0330
Subject: [rabbitmq-discuss] stable client on unstable network
Message-ID: <CAJzgYrAAu3ZjqDH+-KmBLaOH7E+9KiM6xRsPPedKDCi6cpSxvA@mail.gmail.com>

Hi
Is there any written java code for handling unstable network?
I know I should work with *setRequestedHeartbeat* and *ShutdownListener*,
but is there any code that contains all these features together?

for example in rabbitmq tutorials there is a part about rpc, and there is a
class (RpcClient) that do most duties of that tutorial.


-- 

Sincerely
ML
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130217/72930284/attachment.htm>

From nikipore at gmail.com  Sun Feb 17 10:13:13 2013
From: nikipore at gmail.com (nikipore)
Date: Sun, 17 Feb 2013 02:13:13 -0800 (PST)
Subject: [rabbitmq-discuss] new Python client for STOMP 1.2: stompest 2.0a3
Message-ID: <0075a7fd-aff4-4cd9-8589-1c171e38b3a1@googlegroups.com>

Hello everybody, 

I'd like to announce that a new version of the stompest client is out. 
stompest is a feature-complete implementation of the STOMP protocol 
versions 1.0, 1.1, and 1.2. 

New features 2.0a3: 

* STOMP 1.2 support 
* improved handling of headers encoding: STOMP protocol compliant UTF-8 
encoding and escaping 
* improved unit and integration tests 
* integration tests pass against the latest releases of the STOMP 1.2 
capable broker ActiveMQ 5.8, Apollo 1.5, and RabbitMQ 3.0.2 

New features 2.0a2: 

* heartbeating 

Cheers, 
Jan 

PyPI: http://pypi.python.org/pypi/stompest/
source code: https://github.com/nikipore/stompest
documentation: http://nikipore.github.com/stompest/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130217/7dd2c6d6/attachment.htm>

From michael.s.klishin at gmail.com  Sun Feb 17 10:28:25 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 17 Feb 2013 14:28:25 +0400
Subject: [rabbitmq-discuss] ANN Langohr 1.0.0-beta11
Message-ID: <CAE3HoVSHiSqvbkQs82j3UGr=MyzoCdNnPcRvScX-dxZsW=ni_Q@mail.gmail.com>

Langohr [1] is a Clojure RabbitMQ client that embraces AMQP 0.9.1 Model [2].

Release notes for beta11:
http://blog.clojurewerkz.org/blog/2013/02/17/langohr-1-dot-0-0-beta11-is-released/

1. http://clojurerabbitmq.info
2. http://www.rabbitmq.com/tutorials/amqp-concepts.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130217/67b415e5/attachment.htm>

From a.rubalcaba at gmail.com  Mon Feb 18 00:57:13 2013
From: a.rubalcaba at gmail.com (Andrew Rubalcaba)
Date: Sun, 17 Feb 2013 18:57:13 -0600
Subject: [rabbitmq-discuss] Python to Java
In-Reply-To: <511E01EF.2090301@rabbitmq.com>
References: <CAFV+rm1gHS7xsa8Eam5vex6CT0Vkn0-n2KLOm_3c-bgEU3n_Ag@mail.gmail.com>
	<511E01EF.2090301@rabbitmq.com>
Message-ID: <CAFV+rm2-_Yhd2bEoDcdNMmjc1rOMNg9vN-fdzNDg3N8sNRO=Pw@mail.gmail.com>

Thank you Emile That worked!


On Fri, Feb 15, 2013 at 3:37 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
>
> On 15/02/13 03:41, Andrew Rubalcaba wrote:
> > I get something like [B at 3909ea96
>
> You are probably calling toString() on a byte array instead of
> converting it to a string. You should perform the conversion using the
> same encoding that the publisher used. The publisher can store this in
> the content-encoding message property.
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130217/1cff2e26/attachment.htm>

From peter at greenbutton.com  Mon Feb 18 03:53:31 2013
From: peter at greenbutton.com (Peter Soukalopoulos)
Date: Mon, 18 Feb 2013 16:53:31 +1300
Subject: [rabbitmq-discuss] RabbitMQ not persisting messages after a restart
Message-ID: <029c01ce0d8b$8758c4c0$960a4e40$@greenbutton.com>

Good afternoon list,

 

I'm running RabbitMQ v2.8.7 on Windows Server 2008 R2 and am using durable
messages. 

 

Whenever I restart the RabbitMQ windows service, all messages are purged,
queue names remain intact. See attached screenshot.

 

Is this expected behavior with the default installation, or is there some
configuration I need to perform so this does not occur?

 

Much appreciated.

 

Regards,

Peter

 

Peter Soukalopoulos 
Development Team Leader | GreenButton Limited |
<http://www.greenbutton.com/> www.greenbutton.com
Level 13, Simpl House, 40 Mercer Street, Wellington, New Zealand 
Mobile: +64 22 632 5023|  <mailto:peter.soukalopoulos at greenbutton.com>
peter.soukalopoulos at greenbutton.com | Skype: psoukal | HQ: +644 499 0424

Description: GreenButton_words_small
cid:image003.jpg at 01CC4E01.BA075BC0



For best support, please respond to  <mailto:help at greenbutton.com>
help at greenbutton.com and retain the ticket number in the subject line.

 

This message contains confidential information, intended only for the
person(s) named above, which may also be privileged. Any use, distribution,
copying or disclosure by any other person is strictly prohibited. In such
case, you should delete this message and kindly notify the sender via reply
e-mail. Please advise immediately if you or your employer does not consent
to Internet e-mail for messages of this kind.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/3ebb6fc8/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 7433 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/3ebb6fc8/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 3761 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/3ebb6fc8/attachment.jpeg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq queues cleared.jpg
Type: image/jpeg
Size: 106600 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/3ebb6fc8/attachment.jpg>

From brett.r.cameron at gmail.com  Mon Feb 18 04:16:53 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Mon, 18 Feb 2013 17:16:53 +1300
Subject: [rabbitmq-discuss] RabbitMQ not persisting messages after a
	restart
In-Reply-To: <029c01ce0d8b$8758c4c0$960a4e40$@greenbutton.com>
References: <029c01ce0d8b$8758c4c0$960a4e40$@greenbutton.com>
Message-ID: <CALPqkioig1zNpbC2=jygaNuHyF6yJEA_cuHAgWxMy9GX9uzoKg@mail.gmail.com>

Peter,

Are you publishing your messages with delivery mode = 2 (persistent)?

Regards,
Brett

On Mon, Feb 18, 2013 at 4:53 PM, Peter Soukalopoulos
<peter at greenbutton.com>wrote:

> Good afternoon list,****
>
> ** **
>
> I?m running RabbitMQ v2.8.7 on Windows Server 2008 R2 and am using durable
> messages. ****
>
> ** **
>
> Whenever I restart the RabbitMQ windows service, all messages are purged,
> queue names remain intact. See attached screenshot.****
>
> ** **
>
> Is this expected behavior with the default installation, or is there some
> configuration I need to perform so this does not occur?****
>
> ** **
>
> Much appreciated.****
>
> ** **
>
> *Regards,*
>
> *Peter*
>
> ** **
>
> *Peter** **Soukalopoulos*
> *Development Team Leader | **GreenButton Limited *| www.greenbutton.com
> Level 13, Simpl House, 40 Mercer Street, Wellington, New Zealand
> Mobile: +64 22 632 5023| peter.soukalopoulos at greenbutton.com | Skype:
> psoukal | HQ: +644 499 0424****
>
> [image: Description: GreenButton_words_small]               [image:
> cid:image003.jpg at 01CC4E01.BA075BC0]
>
> ****
>
> For best support, please respond to help at greenbutton.com and retain the
> ticket number in the subject line.****
>
> ** **
>
> This message contains confidential information, intended only for
> the person(s) named above, which may also be privileged. Any use,
> distribution, copying or disclosure by any other person is strictly
> prohibited. In such case, you should delete this message and kindly notify
> the sender via reply e-mail. Please advise immediately if you or your
> employer does not consent to Internet e-mail for messages of this kind.***
> *
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/37787c97/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 7433 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/37787c97/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 3761 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/37787c97/attachment.jpeg>

From peter at greenbutton.com  Mon Feb 18 04:23:16 2013
From: peter at greenbutton.com (Peter Soukalopoulos)
Date: Mon, 18 Feb 2013 17:23:16 +1300
Subject: [rabbitmq-discuss] RabbitMQ not persisting messages after a
	restart
In-Reply-To: <CALPqkioig1zNpbC2=jygaNuHyF6yJEA_cuHAgWxMy9GX9uzoKg@mail.gmail.com>
References: <029c01ce0d8b$8758c4c0$960a4e40$@greenbutton.com>
	<CALPqkioig1zNpbC2=jygaNuHyF6yJEA_cuHAgWxMy9GX9uzoKg@mail.gmail.com>
Message-ID: <02cb01ce0d8f$af51a150$0df4e3f0$@greenbutton.com>

Hi Brett,

 

Turns out not! The model is created as durable but delivery mode was being
set to 1 (docs say non-persistent (1) or persistent (2))

 

Thanks for the quick response!

 

Cheers,

Peter

From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Brett
Cameron
Sent: Monday, 18 February 2013 5:17 p.m.
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ not persisting messages after a
restart

 

Peter,

Are you publishing your messages with delivery mode = 2 (persistent)?

Regards,
Brett

On Mon, Feb 18, 2013 at 4:53 PM, Peter Soukalopoulos <peter at greenbutton.com>
wrote:

Good afternoon list,

 

I'm running RabbitMQ v2.8.7 on Windows Server 2008 R2 and am using durable
messages. 

 

Whenever I restart the RabbitMQ windows service, all messages are purged,
queue names remain intact. See attached screenshot.

 

Is this expected behavior with the default installation, or is there some
configuration I need to perform so this does not occur?

 

Much appreciated.

 

Regards,

Peter

 

Peter Soukalopoulos 
Development Team Leader | GreenButton Limited | www.greenbutton.com
<http://www.greenbutton.com/> 
Level 13, Simpl House, 40 Mercer Street, Wellington, New Zealand 
Mobile: +64 22 632 5023 <tel:%2B64%2022%20632%205023> |
peter.soukalopoulos at greenbutton.com | Skype: psoukal | HQ: +644 499 0424
<tel:%2B644%20499%200424> 

Description: GreenButton_words_small
cid:image003.jpg at 01CC4E01.BA075BC0

For best support, please respond to help at greenbutton.com and retain the
ticket number in the subject line.

 

This message contains confidential information, intended only for the
person(s) named above, which may also be privileged. Any use, distribution,
copying or disclosure by any other person is strictly prohibited. In such
case, you should delete this message and kindly notify the sender via reply
e-mail. Please advise immediately if you or your employer does not consent
to Internet e-mail for messages of this kind.

 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/9d95b0bc/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 7433 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/9d95b0bc/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 3761 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/9d95b0bc/attachment.jpeg>

From xliao at corp.netease.com  Mon Feb 18 05:57:16 2013
From: xliao at corp.netease.com (=?GB2312?B?wc7Q8Q==?=)
Date: Mon, 18 Feb 2013 13:57:16 +0800
Subject: [rabbitmq-discuss] the cluster broke and can not auto recover
Message-ID: <7DC5E008-062C-4629-9E6A-6E21DA1EA07F@corp.netease.com>

I was confused by the problem when the rabbitmq cluster(3 nodes 167/188/218, mirrored quque) was running, suddenly maybe an network io error happened, then the cluster broker into two(167-188 and 218), each of them was confirmed running and able to serve but also consider the reason of cluster breaking was not their own fault and always waited for the other node to join back again.

Any clue?


218 consider 167and188 down, and it's master now.




167 and 188 both consider 218 down

And the cluster_status command returns


-----------------------------------
xliao at corp.netease.com




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/398ef7ee/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ???? 2013-02-17 ??6.39.11.png
Type: image/png
Size: 65374 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/398ef7ee/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ???? 2013-02-17 ??6.39.44.png
Type: image/png
Size: 69048 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/398ef7ee/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ???? 2013-02-17 ??6.39.23.png
Type: image/png
Size: 63077 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/398ef7ee/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ???? 2013-02-17 ??10.42.33.png
Type: image/png
Size: 32864 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/398ef7ee/attachment-0003.png>

From liaoxu at gmail.com  Mon Feb 18 06:18:29 2013
From: liaoxu at gmail.com (Kevin Liao)
Date: Sun, 17 Feb 2013 22:18:29 -0800 (PST)
Subject: [rabbitmq-discuss] the cluster broke and can not auto recover
Message-ID: <03b98601-2c6f-4f88-9874-91d42f452afd@googlegroups.com>

 

I was confused by the problem when the rabbitmq cluster(3 nodes 
167/188/218, mirrored quque) was running, suddenly maybe an network io 
error happened, then the cluster broker into two(167-188 and 218), each of 
them was confirmed running and able to serve but also consider the reason 
of cluster breaking was not their own fault and always waited for the other 
node to join back again.


Any clue?

<https://lh4.googleusercontent.com/-d-tKvmnFwDI/USHHKY29EmI/AAAAAAAAAF4/yWudeT64Ats/s1600/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7+2013-02-17+%E4%B8%8B%E5%8D%886.39.44.png>



218 consider 167and188 down, and it's master now.


<https://lh5.googleusercontent.com/-53xWkDetMEg/USHHZpnFYoI/AAAAAAAAAGA/iysXsLTEzlU/s1600/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7+2013-02-17+%E4%B8%8B%E5%8D%886.39.23.png>




167 and 188 both consider 218 down


And the cluster_status command returns

<https://lh4.googleusercontent.com/-lmk5YAZrNJM/USHHjmq8voI/AAAAAAAAAGI/HtJf3HWTAJU/s1600/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7+2013-02-17+%E4%B8%8B%E5%8D%8810.42.33.png>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130217/d4480562/attachment.htm>

From emile at rabbitmq.com  Mon Feb 18 10:05:48 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 18 Feb 2013 10:05:48 +0000
Subject: [rabbitmq-discuss] the cluster broke and can not auto recover
In-Reply-To: <7DC5E008-062C-4629-9E6A-6E21DA1EA07F@corp.netease.com>
References: <7DC5E008-062C-4629-9E6A-6E21DA1EA07F@corp.netease.com>
Message-ID: <5121FCFC.7090604@rabbitmq.com>

Hi,

On 18/02/13 05:57, ?? wrote:
> consider the reason of cluster breaking was not their own fault 

A network interruption would explain what you are seeing. The short
answer is that clusters do not tolerate network partitions well. Take a
look at the advice on this page:

http://www.rabbitmq.com/partitions.html

You should consider using federation or the shovel instead of clustering
if the network is not reliable.



-Emile








From tim at rabbitmq.com  Mon Feb 18 10:34:46 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 18 Feb 2013 10:34:46 +0000
Subject: [rabbitmq-discuss] stable client on unstable network
In-Reply-To: <CAJzgYrAAu3ZjqDH+-KmBLaOH7E+9KiM6xRsPPedKDCi6cpSxvA@mail.gmail.com>
References: <CAJzgYrAAu3ZjqDH+-KmBLaOH7E+9KiM6xRsPPedKDCi6cpSxvA@mail.gmail.com>
Message-ID: <512203C6.8040005@rabbitmq.com>

Hi

On 02/17/2013 08:49 AM, Mohsen Lotfizad wrote:
> Is there any written java code for handling unstable network?

You might like to look at 
https://github.com/joshdevins/rabbitmq-ha-client - I don't know how 
feature complete, stable or usable it is, but it aims to simplify client 
code when working with an HA setup.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/fd71eab2/attachment.htm>

From max06.net at googlemail.com  Mon Feb 18 10:53:07 2013
From: max06.net at googlemail.com (=?UTF-8?Q?Florian_M=C3=BCller?=)
Date: Mon, 18 Feb 2013 02:53:07 -0800 (PST)
Subject: [rabbitmq-discuss] High Performance Setup Strategy
Message-ID: <215159b2-83a2-4b20-845c-0f01285717c3@googlegroups.com>

Good morning,

I'm a little bit curious about the setup strategy of a project. Maybe 
someone of you can make it clear.

Situation: 
Community Website, running on several php-nodes.

Destination:
Implementation of Websockets with nodejs.

Attempts:
One big Server (24 Cores) running Rabbitmq, every websocket-worker connects 
to this one.
Every php-node is running an own Rabbitmq, php connects to localhost using 
Amqp. Every kind of notifications is being sent to it, but only if the 
target user is actually connected to one socket (Solved per memcache-entry)
3 Websocket-Hosts, each running 16 Node-Worker. (16 Cores/Server)

Every websocket-worker creates an own queue.
There are 100 exchanges, the users are being sorted in there by their 
UserID. Exchange-Type: direct.
(Using only one exchange crashes when reaching 64k bindings)

Problem:
Queues are starting to fill up when reaching 120k Bindings (130-140k unique 
Websocket-Connections). 4-6k delivered Msg/s.
Load: 
Big one (18-20 / 24)
php-nodes (6 / 16)
Nodejs-Hosts (5 / 16)

I want to know your opinion about this setup, or tips to build a better one.

We want to serve 300-500k Connections at any time with at least hardware as 
possible.

Greetings,
Florian


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/f8a97056/attachment.htm>

From emile at rabbitmq.com  Mon Feb 18 13:18:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 18 Feb 2013 13:18:57 +0000
Subject: [rabbitmq-discuss] High Performance Setup Strategy
In-Reply-To: <215159b2-83a2-4b20-845c-0f01285717c3@googlegroups.com>
References: <215159b2-83a2-4b20-845c-0f01285717c3@googlegroups.com>
Message-ID: <51222A41.8090109@rabbitmq.com>


Hi,

On 18/02/13 10:53, Florian M?ller wrote:
> (Using only one exchange crashes when reaching 64k bindings)

Do you have a crash report or a logfile entry from this crash? If you
can explain the precise nature of the difficulty encountered at this
point then it might apply in the 120k case as well.

> Problem:
> Queues are starting to fill up when reaching 120k Bindings (130-140k
> unique Websocket-Connections). 4-6k delivered Msg/s.

Queues getting longer is not normally a cause for concern, unless your
hardware spec is not sufficient to deal with so many queues when they
get longer. Queues will consume more broker resources when they get
longer. Consider setting a TTL limit to make sure queues don't grow very
long: http://www.rabbitmq.com/ttl.html

Queues getting longer could be a sign that consumers are not able to
keep up, or some other bottleneck between the broker and consumers. Make
sure the network is not saturated.

Do changes to the consumption patterns make any difference to limit for
maximum number of bindings? E.g. What happens when you change the
prefetch count, or switch between server-side and client-side
acknowledgements?



-Emile








From max06.net at googlemail.com  Mon Feb 18 13:45:36 2013
From: max06.net at googlemail.com (=?ISO-8859-1?Q?Florian_M=FCller?=)
Date: Mon, 18 Feb 2013 14:45:36 +0100
Subject: [rabbitmq-discuss] High Performance Setup Strategy
In-Reply-To: <51222A41.8090109@rabbitmq.com>
References: <215159b2-83a2-4b20-845c-0f01285717c3@googlegroups.com>
	<51222A41.8090109@rabbitmq.com>
Message-ID: <CAJXWVj6+Nr6QmkYicyoYOBoEUntFd2TeSFZ9BdGYJ16AMRP7OQ@mail.gmail.com>

Hi,

2013/2/18 Emile Joubert <emile at rabbitmq.com>

>
> Hi,
>
> On 18/02/13 10:53, Florian M?ller wrote:
> > (Using only one exchange crashes when reaching 64k bindings)
>
> Do you have a crash report or a logfile entry from this crash? If you
> can explain the precise nature of the difficulty encountered at this
> point then it might apply in the 120k case as well.
>

Sadly no system log. Just an own snippet:

17:57:12316599977 #13371 17:56:49: bind_65534
#13371 17:56:49: =============> EXCEPTION: Error: NOT_FOUND - no exchange
'getNotificaions' in vhost '/websocket'
(The exchange disappeared completely - It happened on Dec. 3rd 2012, it
might be already fixed in newer version, we didn't test it)

When we started this project, we used only one exchange (direct) for all
messages. At exactly the 64k th (+1?) Binding on this one exchange, the
whole thing crashed. So we decided to split the exchange up to 100, and
distribute the users to specific ones (for example User ID xxxxxxxx817 ->
exchange17). That balances the bindings well.


> > Problem:
> > Queues are starting to fill up when reaching 120k Bindings (130-140k
> > unique Websocket-Connections). 4-6k delivered Msg/s.
>
> Queues getting longer is not normally a cause for concern, unless your
> hardware spec is not sufficient to deal with so many queues when they
> get longer. Queues will consume more broker resources when they get
> longer. Consider setting a TTL limit to make sure queues don't grow very
> long: http://www.rabbitmq.com/ttl.html
>

Hardware-Specs of the "big" one should be more than enough... 2* Xeon E5645
2.40 GHz, 24GB ram, 50G SSD (not in use), GBit Ethernet. Ram usage stays
below 40% all the time.

We're already using TTL, every Messageis being redirected after 5 seconds
to a separate Queue (for debugging).


> Queues getting longer could be a sign that consumers are not able to
> keep up, or some other bottleneck between the broker and consumers. Make
> sure the network is not saturated.
>

Every consumer (Nodejs-Sockets, 16 per Host, 3 Hosts) is fine at crashing
time. Load is below 30%. Ram is far away from limit.
(Network bandwidth needs to be checked, but reproduction is not a good
idea, because we can only reach this load in production environment)


>
> Do changes to the consumption patterns make any difference to limit for
> maximum number of bindings? E.g. What happens when you change the
> prefetch count, or switch between server-side and client-side
> acknowledgements?
>

Forwarding this to dev...

>
>
>
> -Emile
>
>
> Florian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/75f6f4ea/attachment.htm>

From steve at rabbitmq.com  Mon Feb 18 16:25:11 2013
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 18 Feb 2013 16:25:11 +0000
Subject: [rabbitmq-discuss] Consumer Clients as Tomcat Web Applications
	and Work Queue Configuration
In-Reply-To: <CAC_yGUSCG6Nmj3xJ2Ae2HO5objLqv-fRt=rHne=XmGecZO+MqQ@mail.gmail.com>
References: <CAC_yGURXNFrgJ6SM7vb5QjZn2m5GKBXgucUFvuQ4QodNzrz3yA@mail.gmail.com>
	<AA959E8B-19A8-4628-A700-B98C15580135@rabbitmq.com>
	<CAC_yGUSCG6Nmj3xJ2Ae2HO5objLqv-fRt=rHne=XmGecZO+MqQ@mail.gmail.com>
Message-ID: <5C95A290-0FA4-4E18-BEAE-11727B8E5701@rabbitmq.com>

Kevin,
I'm glad you managed to 'solve' your problem.

The acknowledgement (ACK) is to tell the RabbitMQ Server that the client is
willing to take responsibility for the message: RabbitMQ will not deliver this
message to anyone again.  If the channel closes/stops/dissappears and a
message sent to it hasn't been acknowledged, or if a message is rejected (with
requeue)  (NACKed with requeue), then RabbitMQ will attempt to deliver the
message again.  That may or may not be to the same consumer, channel or
client.  The prefetch count is a way of limiting the number of messages
RabbitMQ Server will allow unACKed (and unNACKed) on a channel.

Let's say you have one consumer on one channel on each client, and you have
two clients, A and B. Let's also say that A and B have prefetch count set to 2. 
We'll assume that A and B are served in that order by the RabbitMQ server.

If 5 messages arrive on the queue (m1..5) then the messages will arrive on the
QueueingConsumer client queues on A and B as follows:

A:  [m1, m3]
B:  [m2, m4]
and message m5 will stay in the server.

I presume both A and B will see a message and remove it from the
QueueingConsumer queue:

A:  [m3]  (processing m1)
B:  [m4]  (processing m2)

When the first message is processed successfully (either m1 on A, or m2 on B)
and the client sends ACK back to the server, then message m5 can be sent to
the client who ACKed first, let's say it is B:

A:  [m3]  (processing m1)
B:  [m4, m5]   (not processing a message)

But note that B might have already started processing m4 by this time (it
more probably would have, since the message m4 is already in the client),
so it would soon (or already) look like this:

A:  [m3]  (processing m1)
B:  [m5]  (processing m4)

As messages arrive on the queue in the server, they are sent to either A or B
as they successfully (or otherwise) finish processing the previous messages.

Let's say that B finishes first again (ACKnowledging m4), but that  no more
messages arrive on the queue before then.  We then get into this situation:

A:  [m3]  (processing m1)
B:  []  (processing m5)

B has an empty queue.

If B again finishes first (a fast and efficient machine, or a lightweight
message m5?) we could see this situation:

A:  [m3]  (processing m1)
B:  []  (idle, waiting on internal queue)

A might take a very long time to process message m1, and m3 has to wait until
A has finished (or aborts) before it will be processed, even though B is
unoccupied and available.

The effects of the prefetch count >1 are therefore three-fold:

1) The internal client queues never hold more than prefetch-count messages,
   all excess messages 'back-up' in the server.

2) Some messages can get 'caught' behind a message that takes a long time to
   process: waiting indefinitely, even though there may be servers ready and
   waiting to process them.

3) Messages can be sent to a client while it is processing the previous
   message, so the network transfer time can overlap processing time, reducing
   the time spent idle in the client when there are messages to process.

Notice that there is a (potential) price to pay for the benefit in item 3.  If
you reduce the time spent waiting for network transfer time while idle, you
run the risk of processing some messages very late indeed.

As soon as you have multiple clients listening to the same queue you cannot
guarantee the order of processing of messages, whatever you set the prefetch
counts to.

You should be able to see what happens (can happen) with more clients, or with
a larger (or unlimited) prefetch count.

Whether you wish to use a setting like this very much depends upon how large
the network latency is, what the risk of message failures are, and what the
rate of message arrival might be (it will doubtless vary in any case).

A prefetch count of 2 and a variable number of clients works reasonably well:

- when order of message processing is not critical;
- when message processing is relatively reliable, and not too variable; and
- when the network transfer time is not too large per message (e.g. messages are
  reasonably small).

Outside of these parameters I recommend you run some careful tests.

In fact, let me recommend you run some careful performance and stress tests in
any case.  It is notoriously difficult to predict where the bottlenecks will
be in any particular configuration.  These bottlenecks will move depending
upon load, and sometimes when the load changes (up or down).

It may be, with low to medium message rates, that all this fuss makes no
difference over a prefetch count of 1.  You should check this before investing
in complex (and potentially buggy) code. You should also ensure that you
really need many processing clients and that you fully understand the
interactions between the processing that these clients undertake -- it
is possible that there are mutual blocks or other serialisation effects
that will have an impact upon the service rates (or even success) 
of your clients.

I hope I have begun to answer your question.  Good luck.
Steve Powell
[M: +44-7815-838-558; H:+44-1962-775-598]
Links: SpringSource (a division of VMware), Virgo, RabbitMQ.
-----------------------------------------------------------------------
Good design:
   is innovative, useful, aesthetic;
   is understandable, unobtrusive, honest;
   is long-lasting, thorough, environmentally friendly;
   and is as little design as possible.
Copyright Dieter Rams, amended March 2003; October 2009; and August 2012

On 12 Feb 2013, at 19:28, Kevin Behr <behrk2 at gmail.com> wrote:

> Regarding your statement above, I had not taken that into consideration.  I've coded my clients to  only acknowledge upon successful processing of the delivered message.  If one of our many web services or datastore connections goes down, then unacknowledged messages will start piling up quickly, and the messaging and queuing pipeline will essentially come to a halt. I would expect this to be the correct behavior, however, as I don't want to throw out messages until someone discovers that a service is down.
> 
> As I will be using QueuingConsumer, I'm now wondering how I should determine what to set my prefetch counts to.  Do you have any further advice on this?  I'm still a little confused there.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/64f14cfc/attachment.htm>

From mary.nagle at warbyparker.com  Mon Feb 18 18:04:40 2013
From: mary.nagle at warbyparker.com (Mary Nagle)
Date: Mon, 18 Feb 2013 13:04:40 -0500
Subject: [rabbitmq-discuss] Consultant Needed: Rabbit MQ Expert
In-Reply-To: <CAE0Sz=wsAdysxMPJ7fi=LoWDLkL087KWCTYxXzGxKtDf4jQQ0Q@mail.gmail.com>
References: <CAOMV0bzweCZ697ThwW3hhm9UxoDyU1-PQhnxA-LCweayAQodZQ@mail.gmail.com>
	<CAE0Sz=wsAdysxMPJ7fi=LoWDLkL087KWCTYxXzGxKtDf4jQQ0Q@mail.gmail.com>
Message-ID: <CAOMV0bxNr+UW66d=Jn1sSkWYfKr1oRvGX5VQ6tzc0zKrKvgOvw@mail.gmail.com>

Thank you so much Jerry! That's very kind of you. Look forward to seeing
interested candidates!

Best,
Mary


On Fri, Feb 15, 2013 at 9:27 PM, Jerry Kuch <jerryk at rbcon.com> wrote:

> Not to shill, but VMware itself sells RabbitMQ support and PSO services
> for RabbitMQ...  Will forward your mail to some folks who may be able to
> help.
>
> On Fri, Feb 15, 2013 at 2:48 PM, Mary Nagle <mary.nagle at warbyparker.com>wrote:
>
>> Hello, RabbitMQ!
>>
>> I've been asked to find a Rabbit MQ expert to do consultant work at my
>> company, and hopefully I've come to the right place for help!
>>
>> Warby Parker <http://www.warbyparker.com/> wishes to hire a consultant
>> for a 1-2 month engagement on site at our headquarters in New York, NY. We
>> need someone who is an expert in Rabbit MQ and optimally has general
>> message queue experience to help guide architecture and consult on
>> implementation details and answer questions. We hope to find someone who
>> can start immediately. If interested, please reply with either your resume
>> or a cover letter outlining your work, and perhaps a reference or two. We
>> look forward to hearing from you!
>>
>> Best,
>> Mary
>>
>> --
>>
>> Mary N.
>>
>> WARBY PARKER EYEWEAR<http://www.google.com/url?q=http%3A%2F%2Fwww.warbyparker.com%2F&sa=D&sntz=1&usg=AFrqEzfkTF4rhdwjlARqomkRV4TIc34NxA>
>> P: 646.738.3831
>> Friend us: Facebook<http://www.google.com/url?q=http%3A%2F%2Fwww.facebook.com%2Fwarbyparker&sa=D&sntz=1&usg=AFrqEzfUEaV6C9BaTQ8cI-VKdanu2UUQbw>
>> |  Follow us: Twitter<http://www.google.com/url?q=http%3A%2F%2Ftwitter.com%2Fwarbyparker&sa=D&sntz=1&usg=AFrqEzczMD6HXAtHLBzviQV_EtD3ckoJVQ>
>>
>> Watch our very first TV commercial > <http://www.warbyparker.com/tv>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 

Mary Nagle

WARBY PARKER EYEWEAR<http://www.google.com/url?q=http%3A%2F%2Fwww.warbyparker.com%2F&sa=D&sntz=1&usg=AFrqEzfkTF4rhdwjlARqomkRV4TIc34NxA>
P: 646.738.3831  |  C: 484.557.2872
Friend us: Facebook<http://www.google.com/url?q=http%3A%2F%2Fwww.facebook.com%2Fwarbyparker&sa=D&sntz=1&usg=AFrqEzfUEaV6C9BaTQ8cI-VKdanu2UUQbw>
|  Follow us: Twitter<http://www.google.com/url?q=http%3A%2F%2Ftwitter.com%2Fwarbyparker&sa=D&sntz=1&usg=AFrqEzczMD6HXAtHLBzviQV_EtD3ckoJVQ>

Watch our very first TV commercial > <http://www.warbyparker.com/tv>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/b438b1ae/attachment.htm>

From jerryk at rbcon.com  Mon Feb 18 19:32:27 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Mon, 18 Feb 2013 11:32:27 -0800
Subject: [rabbitmq-discuss] High Performance Setup Strategy
In-Reply-To: <CAJXWVj6+Nr6QmkYicyoYOBoEUntFd2TeSFZ9BdGYJ16AMRP7OQ@mail.gmail.com>
References: <215159b2-83a2-4b20-845c-0f01285717c3@googlegroups.com>
	<51222A41.8090109@rabbitmq.com>
	<CAJXWVj6+Nr6QmkYicyoYOBoEUntFd2TeSFZ9BdGYJ16AMRP7OQ@mail.gmail.com>
Message-ID: <CAE0Sz=xMUtxBXg3LDfLwxFCQVGPbgXX6sPvDqf0HcDaBN22_1w@mail.gmail.com>

Was there really expected to be an exchange with the misspelled name
"getNotificaions"
or did a typo in something seeking it yield a surprise?

On Mon, Feb 18, 2013 at 5:45 AM, Florian M?ller <max06.net at googlemail.com>wrote:

> Hi,
>
> 2013/2/18 Emile Joubert <emile at rabbitmq.com>
>
>>
>> Hi,
>>
>> On 18/02/13 10:53, Florian M?ller wrote:
>> > (Using only one exchange crashes when reaching 64k bindings)
>>
>> Do you have a crash report or a logfile entry from this crash? If you
>> can explain the precise nature of the difficulty encountered at this
>> point then it might apply in the 120k case as well.
>>
>
> Sadly no system log. Just an own snippet:
>
> 17:57:12316599977 #13371 17:56:49: bind_65534
> #13371 17:56:49: =============> EXCEPTION: Error: NOT_FOUND - no exchange
> 'getNotificaions' in vhost '/websocket'
> (The exchange disappeared completely - It happened on Dec. 3rd 2012, it
> might be already fixed in newer version, we didn't test it)
>
> When we started this project, we used only one exchange (direct) for all
> messages. At exactly the 64k th (+1?) Binding on this one exchange, the
> whole thing crashed. So we decided to split the exchange up to 100, and
> distribute the users to specific ones (for example User ID xxxxxxxx817 ->
> exchange17). That balances the bindings well.
>
>
>> > Problem:
>> > Queues are starting to fill up when reaching 120k Bindings (130-140k
>> > unique Websocket-Connections). 4-6k delivered Msg/s.
>>
>> Queues getting longer is not normally a cause for concern, unless your
>> hardware spec is not sufficient to deal with so many queues when they
>> get longer. Queues will consume more broker resources when they get
>> longer. Consider setting a TTL limit to make sure queues don't grow very
>> long: http://www.rabbitmq.com/ttl.html
>>
>
> Hardware-Specs of the "big" one should be more than enough... 2* Xeon
> E5645 2.40 GHz, 24GB ram, 50G SSD (not in use), GBit Ethernet. Ram usage
> stays below 40% all the time.
>
> We're already using TTL, every Messageis being redirected after 5 seconds
> to a separate Queue (for debugging).
>
>
>> Queues getting longer could be a sign that consumers are not able to
>> keep up, or some other bottleneck between the broker and consumers. Make
>> sure the network is not saturated.
>>
>
> Every consumer (Nodejs-Sockets, 16 per Host, 3 Hosts) is fine at crashing
> time. Load is below 30%. Ram is far away from limit.
> (Network bandwidth needs to be checked, but reproduction is not a good
> idea, because we can only reach this load in production environment)
>
>
>>
>> Do changes to the consumption patterns make any difference to limit for
>> maximum number of bindings? E.g. What happens when you change the
>> prefetch count, or switch between server-side and client-side
>> acknowledgements?
>>
>
> Forwarding this to dev...
>
>>
>>
>>
>> -Emile
>>
>>
>> Florian
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/148d4059/attachment.htm>

From videlalvaro at gmail.com  Mon Feb 18 20:10:19 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 18 Feb 2013 21:10:19 +0100
Subject: [rabbitmq-discuss] High Performance Setup Strategy
In-Reply-To: <CAE0Sz=xMUtxBXg3LDfLwxFCQVGPbgXX6sPvDqf0HcDaBN22_1w@mail.gmail.com>
References: <215159b2-83a2-4b20-845c-0f01285717c3@googlegroups.com>
	<51222A41.8090109@rabbitmq.com>
	<CAJXWVj6+Nr6QmkYicyoYOBoEUntFd2TeSFZ9BdGYJ16AMRP7OQ@mail.gmail.com>
	<CAE0Sz=xMUtxBXg3LDfLwxFCQVGPbgXX6sPvDqf0HcDaBN22_1w@mail.gmail.com>
Message-ID: <CAMcAHLXbShPOfE3a-Y0ZmCroa3i=1QGvr=DkL3m+pPCHnECbxQ@mail.gmail.com>

I just published a message to an exchange with 2^16 bindings. My Macbook
fan is humming :) Beam is still using over 220% CPU.


On Mon, Feb 18, 2013 at 8:32 PM, Jerry Kuch <jerryk at rbcon.com> wrote:

> Was there really expected to be an exchange with the misspelled name "getNotificaions"
> or did a typo in something seeking it yield a surprise?
>
> On Mon, Feb 18, 2013 at 5:45 AM, Florian M?ller <max06.net at googlemail.com>wrote:
>
>> Hi,
>>
>> 2013/2/18 Emile Joubert <emile at rabbitmq.com>
>>
>>>
>>> Hi,
>>>
>>> On 18/02/13 10:53, Florian M?ller wrote:
>>> > (Using only one exchange crashes when reaching 64k bindings)
>>>
>>> Do you have a crash report or a logfile entry from this crash? If you
>>> can explain the precise nature of the difficulty encountered at this
>>> point then it might apply in the 120k case as well.
>>>
>>
>> Sadly no system log. Just an own snippet:
>>
>> 17:57:12316599977 #13371 17:56:49: bind_65534
>> #13371 17:56:49: =============> EXCEPTION: Error: NOT_FOUND - no exchange
>> 'getNotificaions' in vhost '/websocket'
>> (The exchange disappeared completely - It happened on Dec. 3rd 2012, it
>> might be already fixed in newer version, we didn't test it)
>>
>> When we started this project, we used only one exchange (direct) for all
>> messages. At exactly the 64k th (+1?) Binding on this one exchange, the
>> whole thing crashed. So we decided to split the exchange up to 100, and
>> distribute the users to specific ones (for example User ID xxxxxxxx817 ->
>> exchange17). That balances the bindings well.
>>
>>
>>> > Problem:
>>> > Queues are starting to fill up when reaching 120k Bindings (130-140k
>>> > unique Websocket-Connections). 4-6k delivered Msg/s.
>>>
>>> Queues getting longer is not normally a cause for concern, unless your
>>> hardware spec is not sufficient to deal with so many queues when they
>>> get longer. Queues will consume more broker resources when they get
>>> longer. Consider setting a TTL limit to make sure queues don't grow very
>>> long: http://www.rabbitmq.com/ttl.html
>>>
>>
>> Hardware-Specs of the "big" one should be more than enough... 2* Xeon
>> E5645 2.40 GHz, 24GB ram, 50G SSD (not in use), GBit Ethernet. Ram usage
>> stays below 40% all the time.
>>
>> We're already using TTL, every Messageis being redirected after 5 seconds
>> to a separate Queue (for debugging).
>>
>>
>>> Queues getting longer could be a sign that consumers are not able to
>>> keep up, or some other bottleneck between the broker and consumers. Make
>>> sure the network is not saturated.
>>>
>>
>> Every consumer (Nodejs-Sockets, 16 per Host, 3 Hosts) is fine at crashing
>> time. Load is below 30%. Ram is far away from limit.
>> (Network bandwidth needs to be checked, but reproduction is not a good
>> idea, because we can only reach this load in production environment)
>>
>>
>>>
>>> Do changes to the consumption patterns make any difference to limit for
>>> maximum number of bindings? E.g. What happens when you change the
>>> prefetch count, or switch between server-side and client-side
>>> acknowledgements?
>>>
>>
>> Forwarding this to dev...
>>
>>>
>>>
>>>
>>> -Emile
>>>
>>>
>>> Florian
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130218/47b0552d/attachment.htm>

From normand.bedard at gmail.com  Mon Feb 18 20:24:10 2013
From: normand.bedard at gmail.com (khloroform187)
Date: Mon, 18 Feb 2013 12:24:10 -0800 (PST)
Subject: [rabbitmq-discuss] SSL using ssl offloading load balancer
Message-ID: <1361219050033-25076.post@n5.nabble.com>

I am trying to secure my communications between my rabbitmq clients and my
rabbitMQ broker. I am trying to do this using a load balancer.

The load balancer accepts connection on port 5671, and forward the requests
on the rabbitmq server on port 5672. This way, the rabbitmq server is not
aware of ssl configurations.

But on the client side, I was wondering how to configure the connection. I
am using the c# library, so this is no factory.useSslProtocol();
(http://www.rabbitmq.com/ssl.html).

I see a connectionFactory.Ssl property. I tried to set the
factory.ssl.enabled to true, without success. There is no documentation on
how configure the ssl connection. I always get a "AMQP server protocol
negotiation failure: server version unknown-unknown, client version 0-9"
error.

Any ideas?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/SSL-using-ssl-offloading-load-balancer-tp25076.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Mon Feb 18 22:02:47 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 18 Feb 2013 22:02:47 +0000
Subject: [rabbitmq-discuss] SSL using ssl offloading load balancer
In-Reply-To: <1361219050033-25076.post@n5.nabble.com>
References: <1361219050033-25076.post@n5.nabble.com>
Message-ID: <5122A507.7080708@rabbitmq.com>

On 18/02/13 20:24, khloroform187 wrote:
> I am using the c# library, so this is no factory.useSslProtocol();
> (http://www.rabbitmq.com/ssl.html).
>
> I see a connectionFactory.Ssl property. I tried to set the
> factory.ssl.enabled to true, without success. There is no documentation on
> how configure the ssl connection. I always get a "AMQP server protocol
> negotiation failure: server version unknown-unknown, client version 0-9"
> error.
>
> Any ideas?

Did you read http://www.rabbitmq.com/ssl.html#configuring-dotnet?

Matthias.

From psl88506 at gmail.com  Tue Feb 19 10:07:10 2013
From: psl88506 at gmail.com (PSL 88506)
Date: Tue, 19 Feb 2013 15:37:10 +0530
Subject: [rabbitmq-discuss] Cluster breakage
Message-ID: <CANPBPZ=i-GP_tvv8eKP7KhOvs6_Z8Sfo1sooEZ8TLWs3d86kEw@mail.gmail.com>

Hi,


We have 3 RabbitMQ machines which are clustered across.

We observed after some period of time clusters are breaking.

This we observed in env1, env2, env3.


The problem is that after some period of time, clusters are breaking.

When we opened administrative console,


machine-1 shows machine - 1 and machine - 3 are running and machine-2 is
Node not running.

machine-2 shows machine - 2 is running and machine-1 and  machine-3 are
Node not running.

machine-3 shows machine - 1 and machine - 3 are running and machine-2 is
Node not running.


We checked with network team, if there are any network fluctuations during
that period.

The network team came back with statistics and proved that there was no
such issue.


Since this happened in all environments, we are sure that there was some
issue while we configuring rabbitmq cluster.We are not masters of rabbitmq,
We just followed the same steps mentioned in RabbitMQ tutorials. Clustering
was successful and went fine for some time, but only after some period of
time this is happening.


Please help,


Please let me know if you need any information.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130219/46f53e10/attachment.htm>

From emile at rabbitmq.com  Tue Feb 19 10:28:02 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 19 Feb 2013 10:28:02 +0000
Subject: [rabbitmq-discuss] Consistent Exchange Only if Consumers?
In-Reply-To: <DF3FAB26-BEB1-41AD-BB44-B041B1C85D08@teksol.info>
References: <DF3FAB26-BEB1-41AD-BB44-B041B1C85D08@teksol.info>
Message-ID: <512353B2.7020104@rabbitmq.com>

Hi Fran?ois,

On 16/02/13 02:31, Fran?ois Beausoleil wrote:
> Is there a knob somewhere to make x-consistent-hash exchanges deliver
> only to queues that have an active consumer?

No. You might find references to the basic.publish "immediate" flag,
which has been removed in recent versions of RabbitMQ, so don't use that.

http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish.immediate

> I chose to use exclusive queues for the consumers, so if the consumer
> crashes, messages will be rerouted. Problem is, if the consumer
> crashes, the messages are lost.

If messages were sent to a queue that still exist then they are not
really lost.

> on consumer crash, if the queue could redeliver the messages to the
> origin exchange, then I would be all right as well.

You could consider using auto-delete queues together with dead-letter
exchanges to make sure that messages are no longer routed to queues that
belonged to consumers that crashed, and that any messages left in such
queues are available for processing.

http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.auto-delete
http://www.rabbitmq.com/dlx.html

> My problem is really with the messages that are in the queue when a
> consumer crashes.

Either make sure that the queues no longer exist when consumers crash,
or make sure that consumers reconnect to the same queues when they recover.





-Emile




From emile at rabbitmq.com  Tue Feb 19 10:39:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 19 Feb 2013 10:39:30 +0000
Subject: [rabbitmq-discuss] Cluster breakage
In-Reply-To: <CANPBPZ=i-GP_tvv8eKP7KhOvs6_Z8Sfo1sooEZ8TLWs3d86kEw@mail.gmail.com>
References: <CANPBPZ=i-GP_tvv8eKP7KhOvs6_Z8Sfo1sooEZ8TLWs3d86kEw@mail.gmail.com>
Message-ID: <51235662.9040805@rabbitmq.com>


Hi,

On 19/02/13 10:07, PSL 88506 wrote:
> machine-1 shows machine - 1 and machine - 3 are running and machine-2 is
> Node not running.
> 
> machine-2 shows machine - 2 is running and machine-1 and  machine-3 are
> Node not running.
> 
> machine-3 shows machine - 1 and machine - 3 are running and machine-2 is
> Node not running.

This is entirely consistent with a network interruption.

> We checked with network team, if there are any network fluctuations
> during that period.

The most likely explanation for what you saw is a network interruption.
If clustered nodes are not able to communicate for some period (about a
minute by default) then the cluster will break. Rabbit clusters do not
cope well in such environments. You should use federation or the shovel
instead if you have poor network reliability:

http://www.rabbitmq.com/partitions.html




-Emile





From ernest.staszuk at comarch.pl  Tue Feb 19 10:47:32 2013
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Tue, 19 Feb 2013 11:47:32 +0100
Subject: [rabbitmq-discuss] Consistent Exchange Only if Consumers?
In-Reply-To: <512353B2.7020104@rabbitmq.com>
References: <DF3FAB26-BEB1-41AD-BB44-B041B1C85D08@teksol.info>
	<512353B2.7020104@rabbitmq.com>
Message-ID: <51235844.2020001@comarch.pl>

On 02/19/2013 11:28 AM, Emile Joubert wrote:
> You could consider using auto-delete queues together with dead-letter
> exchanges to make sure that messages are no longer routed to queues that
> belonged to consumers that crashed, and that any messages left in such
> queues are available for processing.
I am afraid that will not work. I remember that when I tried a config 
that you suggest messages
hadn't been dead-lettered at queue deletion. According to documentation 
dead-lettering is
triggered by eihter:

  * The message is rejected (basic.reject or basic.nack) with
    requeue=false; or
  * The TTL for the message expires.

There is workaround if someone insist to choose dead lettering - use 
right combination of message ttl and x-lease time.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130219/1666faf8/attachment.htm>

From emile at rabbitmq.com  Tue Feb 19 11:13:10 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 19 Feb 2013 11:13:10 +0000
Subject: [rabbitmq-discuss] Consistent Exchange Only if Consumers?
In-Reply-To: <51235844.2020001@comarch.pl>
References: <DF3FAB26-BEB1-41AD-BB44-B041B1C85D08@teksol.info>
	<512353B2.7020104@rabbitmq.com> <51235844.2020001@comarch.pl>
Message-ID: <51235E46.2000800@rabbitmq.com>

Hi,

On 19/02/13 10:47, Ernest Staszuk wrote:
> There is workaround if someone insist to choose dead lettering - use
> right combination of message ttl and x-lease time.

Thanks for correcting me. You are entirely correct that DLX will not
have any effect on the contents of a queue being deleted.

And yes, the best workaround that I could come up with also is a
combination of message and queue TTL where the messages expire before
the queue does. In addition to DLX this will empty the queue, delete the
queue and send the contents to the dead-letter-exchange.



-Emile








From psl88506 at gmail.com  Tue Feb 19 11:23:25 2013
From: psl88506 at gmail.com (PSL 88506)
Date: Tue, 19 Feb 2013 16:53:25 +0530
Subject: [rabbitmq-discuss] Cluster breakage
In-Reply-To: <51235662.9040805@rabbitmq.com>
References: <CANPBPZ=i-GP_tvv8eKP7KhOvs6_Z8Sfo1sooEZ8TLWs3d86kEw@mail.gmail.com>
	<51235662.9040805@rabbitmq.com>
Message-ID: <CANPBPZnkH2XDc9E4f-J9ZviLxTvxc4x0QxTseHt_C6tEGXx-3w@mail.gmail.com>

Thanks a ton.

So you mean to say that there could be some network interruptions for some
seconds of time which made RabbitMQ cluster to break. Please confirm

Hence you suggested to set the net_ticktime parameter to the kernel
application. Please confirm

One more question - could you please let us know the file and filepath
where net_ticktime can be adjusted.

Thanks in advance.


On Tue, Feb 19, 2013 at 4:09 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 19/02/13 10:07, PSL 88506 wrote:
> > machine-1 shows machine - 1 and machine - 3 are running and machine-2 is
> > Node not running.
> >
> > machine-2 shows machine - 2 is running and machine-1 and  machine-3 are
> > Node not running.
> >
> > machine-3 shows machine - 1 and machine - 3 are running and machine-2 is
> > Node not running.
>
> This is entirely consistent with a network interruption.
>
> > We checked with network team, if there are any network fluctuations
> > during that period.
>
> The most likely explanation for what you saw is a network interruption.
> If clustered nodes are not able to communicate for some period (about a
> minute by default) then the cluster will break. Rabbit clusters do not
> cope well in such environments. You should use federation or the shovel
> instead if you have poor network reliability:
>
> http://www.rabbitmq.com/partitions.html
>
>
>
>
> -Emile
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130219/2e6df50f/attachment.htm>

From s.sciarrati at gmail.com  Tue Feb 19 12:02:52 2013
From: s.sciarrati at gmail.com (Simone)
Date: Tue, 19 Feb 2013 04:02:52 -0800 (PST)
Subject: [rabbitmq-discuss] Understanding a crash report
Message-ID: <0055dd45-cad6-432a-844d-2ecf46fa459f@googlegroups.com>

Hi,

I am relatively new to Rabbitmq and would appreciate help in 
troubleshooting a recurring issue on a cluster, apologies for the long 
email.

I run a 3 instances cluster in ec2, 2 disk nodes (A and B) 1 ram node (C), 
exchanges and queues are static and limited in number (less than 50), the 
volume of messages can reach a few thousands per second and the queues can 
occasionally grow up to a few hundred thousands until the processes manage 
to catch up, but this is well within our memory/disk high watermark. 
Rabbitmq is v. 2.8.4 on ubuntu 12.

The processes that produce and consume messages are java/scala and use the 
akka-amqp library driver (akka-amqp-1.3.1).

In normal operations our nodes run on ~ 500MB memory, the limit is set to 
2.7GB, but in a couple occasions one of the nodes managed to very rapidly 
(< 1 min) eat > 1GB memory and triggered the high memory watermark (node B, 
one of the disk nodes last time).

At the moment of the issue most of the memory was held in 'processes', no 
queue was overgrown (messages or memory), I managed to run a rabbitmqctl 
report, I found a crash report in the logs (more on this later) and tried 
to see which process/es was responsible for the memory usage from the 
erlang shell but I wasn't able to pin a specific one (my erlang is limited 
and I didn't dump the processes to file to look at it later unfortunately). 

For every issue we have had (3 in 2 months), the logs show a crash report 
relative to a specific java process (say process D) sending a message to a 
specific queue (queue D - this is a queue with no consumers atm, if the app 
fails to process a message it will end up here). Note that there are 
multiple workers D running on separate instances in ec2 and that queue D is 
very low traffic so it is unlikely to be a coincidence.

At this point I was pressured to restart rmq on the affected node B, this 
was a stop_app, then stop the erlang VM and then restart. All looked good, 
the node was in a nice place and all looked green in the management 
console. 

Our java processes would connect, they'd do some work, but after a while 
they'd throw a connection error (sorry this is all the details the logs 
would show). Specifically a process E was connected to node A and would 
show this random behaviour (different process and different rmq node from 
the two involved in the issue). 
After a while I was forced to restart the whole cluster, this was done 
stopping app on the ram node C, then on the disk node B, then the other 
node A. Unfortunately A seemed to hang and failed to stop within a 
reasonable time (minutes), and I had to kill it (kill -15). I didn't see 
any indication in the logs on why it was hanging.

When I attempted to start A it would fail as the port was already in use 
and I found that a process still had an open connection to port 5672:

tcp6       0 164945 10.xx.xx.xx:5672        10.xx.xx.xx:53712      FIN_WAIT1

Note: This is a worker D but running on a different box from the one showed 
in the crash log.

Once this connection was cleared everything came up nice and happy.

In Summary:

Process D was producing on queue D on node B, something happened and node B 
managed to consume > 1GB memory in less than a minute. Note that this queue 
is really low traffic but in every issue I have looked into I can see a 
similar crash report as below.

After a restart of node B other processes connected to node A started 
exhibiting connection issues, work a bit then break the connection until 
the whole cluster is restarted.

I would like to better understand the crash report and perhaps have some 
ideas on what went wrong and how to more effectively troubleshoot issues 
(what more info should I collect before restarting the nodes, erlang 
processes list, mnesia tables, ets tables etc).


=CRASH REPORT==== 14-Feb-2013::10:36:54 ===
  crasher:
    initial call: rabbit_reader:init/4
    pid: <*0.29283.387*>
    registered_name: []
    exception error: bad argument
      in function  port_close/1
         called as port_close(#Port<0.746540>)
      in call from rabbit_net:maybe_fast_close/1
      in call from rabbit_reader:start_connection/7
    ancestors: [<0.29280.387>,rabbit_tcp_client_sup,rabbit_sup,<0.161.0>]
    messages: []
    links: [<0.29280.387>]
    dictionary: [{{channel,10},
                   {<0.29364.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{ch_pid,<0.29338.387>},{7,#Ref<0.0.2158.60093>}},
                  {{ch_pid,<0.29333.387>},{6,#Ref<0.0.2158.60085>}},
                  {{ch_pid,<0.29325.387>},{5,#Ref<0.0.2158.60053>}},
                  {{channel,3},
                   {<0.29313.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{ch_pid,<0.29305.387>},{2,#Ref<0.0.2158.60002>}},
                  {{channel,4},
                   {<0.29321.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{channel,11},
                   {<0.29370.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{ch_pid,<0.29313.387>},{3,#Ref<0.0.2158.60017>}},
                  {{ch_pid,<0.29299.387>},{1,#Ref<0.0.2158.59976>}},
                  {{ch_pid,<0.29346.387>},{8,#Ref<0.0.2158.60112>}},
                  {{ch_pid,<0.29370.387>},{11,#Ref<0.0.2158.60189>}},
                  {{channel,7},
                   {<0.29338.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{channel,9},
                   {<0.29356.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{ch_pid,<0.29321.387>},{4,#Ref<0.0.2158.60034>}},
                  {{ch_pid,<0.29364.387>},{10,#Ref<0.0.2158.60166>}},
                  {{ch_pid,<0.29356.387>},{9,#Ref<0.0.2158.60140>}},
                  {{channel,8},
                   {<0.29346.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{channel,5},
                   {<0.29325.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{channel,1},
                   {<0.29299.387>,
                    {content_body,
                        {'basic.publish',0,<<"some_exchange">>,<<>>,false,
                            false},
                        1048189,
                        {content,60,none,
                            <<BYTES IN HERE>>,   --> this showed which 
process was sending the message
                            rabbit_framing_amqp_0_9_1,
                            [<<MORE BYTES IN HERE>>]  --> This I haven't 
been able to decode, it is fairly big, is it truncated?


And in the logs we can find the pid *0.29283.387 *right before the crash:

=INFO REPORT==== 14-Feb-2013::10:31:46 ===
accepting AMQP connection <*0.29283.387*> (10.xx.xx.xx:58622 -> 10.xx.xx.xx
:5672)

=INFO REPORT==== 14-Feb-2013::10:31:46 ===
accepting AMQP connection <0.29287.387> (10.xx.xx.xx:58623 -> 10.xx.xx.xx
:5672)

=WARNING REPORT==== 14-Feb-2013::10:32:27 ===
closing AMQP connection <0.27107.387> (10.xx.xx.xx:50882 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=WARNING REPORT==== 14-Feb-2013::10:32:27 ===
closing AMQP connection <0.27111.387> (10.xx.xx.xx:50883 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=INFO REPORT==== 14-Feb-2013::10:33:35 ===
accepting AMQP connection <0.30447.387> (10.xx.xx.xx:50187 -> 10.xx.xx.xx
:5672)

=INFO REPORT==== 14-Feb-2013::10:33:35 ===
accepting AMQP connection <0.30451.387> (10.xx.xx.xx:50188 -> 10.xx.xx.xx
:5672)

=WARNING REPORT==== 14-Feb-2013::10:37:34 ===
closing AMQP connection <*0.29283.387*> (10.xx.xx.xx:58622 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=WARNING REPORT==== 14-Feb-2013::10:37:34 ===
closing AMQP connection <0.29287.387> (10.xx.xx.xx:58623 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=WARNING REPORT==== 14-Feb-2013::10:37:34 ===
closing AMQP connection <0.30451.387> (10.xx.xx.xx:50188 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=WARNING REPORT==== 14-Feb-2013::10:37:34 ===
closing AMQP connection <0.30447.387> (10.xx.xx.xx:50187 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=INFO REPORT==== 14-Feb-2013::10:37:34 ===
vm_memory_high_watermark set. Memory used:3384669192 allowed:2914218803

Looking at the rabbitmqctl report I have not been able to map the memory 
consumption to something specific yet.

Any help appreciated,

S

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130219/fea3fdeb/attachment.htm>

From normand.bedard at gmail.com  Tue Feb 19 12:15:44 2013
From: normand.bedard at gmail.com (khloroform187)
Date: Tue, 19 Feb 2013 04:15:44 -0800 (PST)
Subject: [rabbitmq-discuss] SSL using ssl offloading load balancer
In-Reply-To: <5122A507.7080708@rabbitmq.com>
References: <1361219050033-25076.post@n5.nabble.com>
	<5122A507.7080708@rabbitmq.com>
Message-ID: <1361276144473-25085.post@n5.nabble.com>

Okay I found the problem.

Setting the ssl server name (connectionFactory.Ssl.ServerName = "blop")
overwrite the connectionFactory.Ssl.Enabled value to false, even if it was
previously set to true.

So I MUST execute the configuration in the correct order... (pretty
frustrating). First the server name, and AFTER the ssl.Enabled setting.





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/SSL-using-ssl-offloading-load-balancer-tp25076p25085.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From psl88506 at gmail.com  Tue Feb 19 12:16:34 2013
From: psl88506 at gmail.com (PSL 88506)
Date: Tue, 19 Feb 2013 17:46:34 +0530
Subject: [rabbitmq-discuss] Cluster breakage
In-Reply-To: <CANPBPZnkH2XDc9E4f-J9ZviLxTvxc4x0QxTseHt_C6tEGXx-3w@mail.gmail.com>
References: <CANPBPZ=i-GP_tvv8eKP7KhOvs6_Z8Sfo1sooEZ8TLWs3d86kEw@mail.gmail.com>
	<51235662.9040805@rabbitmq.com>
	<CANPBPZnkH2XDc9E4f-J9ZviLxTvxc4x0QxTseHt_C6tEGXx-3w@mail.gmail.com>
Message-ID: <CANPBPZnQZSzWoBThR7vYMTxO_OwdgA0vf3o0NJpHz4Vvu9bPaA@mail.gmail.com>

Hi,


We observed following Error Log in RabbitMQ logs
(var/log/rabbit/logfile.log)


=ERROR REPORT==== 14-Feb-2013::07:57:12 ===

** Node 'rabbit at XXXXXX02' not responding **

** Removing (timedout) connection **


=INFO REPORT==== 14-Feb-2013::07:57:12 ===

rabbit on node 'rabbit at XXXXX02' down


Does that imply that there is some problem with network ?

Could you please conclude the problem.


Thanks in advance.

Please respond.



On Tue, Feb 19, 2013 at 4:53 PM, PSL 88506 <psl88506 at gmail.com> wrote:

> Thanks a ton.
>
> So you mean to say that there could be some network interruptions for some
> seconds of time which made RabbitMQ cluster to break. Please confirm
>
> Hence you suggested to set the net_ticktime parameter to the kernel
> application. Please confirm
>
> One more question - could you please let us know the file and filepath
> where net_ticktime can be adjusted.
>
> Thanks in advance.
>
>
> On Tue, Feb 19, 2013 at 4:09 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>>
>> Hi,
>>
>> On 19/02/13 10:07, PSL 88506 wrote:
>> > machine-1 shows machine - 1 and machine - 3 are running and machine-2 is
>> > Node not running.
>> >
>> > machine-2 shows machine - 2 is running and machine-1 and  machine-3 are
>> > Node not running.
>> >
>> > machine-3 shows machine - 1 and machine - 3 are running and machine-2 is
>> > Node not running.
>>
>> This is entirely consistent with a network interruption.
>>
>> > We checked with network team, if there are any network fluctuations
>> > during that period.
>>
>> The most likely explanation for what you saw is a network interruption.
>> If clustered nodes are not able to communicate for some period (about a
>> minute by default) then the cluster will break. Rabbit clusters do not
>> cope well in such environments. You should use federation or the shovel
>> instead if you have poor network reliability:
>>
>> http://www.rabbitmq.com/partitions.html
>>
>>
>>
>>
>> -Emile
>>
>>
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130219/a2708640/attachment.htm>

From emile at rabbitmq.com  Tue Feb 19 12:23:47 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 19 Feb 2013 12:23:47 +0000
Subject: [rabbitmq-discuss] Cluster breakage
In-Reply-To: <CANPBPZnkH2XDc9E4f-J9ZviLxTvxc4x0QxTseHt_C6tEGXx-3w@mail.gmail.com>
References: <CANPBPZ=i-GP_tvv8eKP7KhOvs6_Z8Sfo1sooEZ8TLWs3d86kEw@mail.gmail.com>
	<51235662.9040805@rabbitmq.com>
	<CANPBPZnkH2XDc9E4f-J9ZviLxTvxc4x0QxTseHt_C6tEGXx-3w@mail.gmail.com>
Message-ID: <51236ED3.9030200@rabbitmq.com>

Hi,

On 19/02/13 11:23, PSL 88506 wrote:
> So you mean to say that there could be some network interruptions for
> some seconds of time which made RabbitMQ cluster to break. Please confirm

Yes, about 60 seconds of being disconnected would cause the errors you saw.

> Hence you suggested to set the net_ticktime parameter to the kernel
> application. Please confirm

I suggested using federation or the shovel between brokers if you are
expecting network interruptions.

> One more question - could you please let us know the file and filepath
> where net_ticktime can be adjusted.

This can be set in the standard configuration file:
http://www.rabbitmq.com/configure.html#configuration-file

Consider using federation or the shovel instead.





-Emile








From emile at rabbitmq.com  Tue Feb 19 12:29:40 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 19 Feb 2013 12:29:40 +0000
Subject: [rabbitmq-discuss] Cluster breakage
In-Reply-To: <CANPBPZnQZSzWoBThR7vYMTxO_OwdgA0vf3o0NJpHz4Vvu9bPaA@mail.gmail.com>
References: <CANPBPZ=i-GP_tvv8eKP7KhOvs6_Z8Sfo1sooEZ8TLWs3d86kEw@mail.gmail.com>
	<51235662.9040805@rabbitmq.com>
	<CANPBPZnkH2XDc9E4f-J9ZviLxTvxc4x0QxTseHt_C6tEGXx-3w@mail.gmail.com>
	<CANPBPZnQZSzWoBThR7vYMTxO_OwdgA0vf3o0NJpHz4Vvu9bPaA@mail.gmail.com>
Message-ID: <51237034.7030900@rabbitmq.com>


Hi,

On 19/02/13 12:16, PSL 88506 wrote:
> We observed following Error Log in RabbitMQ logs
> (var/log/rabbit/logfile.log)
> 
> =ERROR REPORT==== 14-Feb-2013::07:57:12 ===
> ** Node 'rabbit at XXXXXX02' not responding **
> ** Removing (timedout) connection **
> 
> =INFO REPORT==== 14-Feb-2013::07:57:12 ===
> rabbit on node 'rabbit at XXXXX02' down
> 
> Does that imply that there is some problem with network ?
It is not always possible to distinguish between a remote host crashing
and a disconnected network. In this case I think either is possible.



-Emile






From simon at rabbitmq.com  Tue Feb 19 12:34:50 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Feb 2013 12:34:50 +0000
Subject: [rabbitmq-discuss] Cluster breakage
In-Reply-To: <51237034.7030900@rabbitmq.com>
References: <CANPBPZ=i-GP_tvv8eKP7KhOvs6_Z8Sfo1sooEZ8TLWs3d86kEw@mail.gmail.com>
	<51235662.9040805@rabbitmq.com>
	<CANPBPZnkH2XDc9E4f-J9ZviLxTvxc4x0QxTseHt_C6tEGXx-3w@mail.gmail.com>
	<CANPBPZnQZSzWoBThR7vYMTxO_OwdgA0vf3o0NJpHz4Vvu9bPaA@mail.gmail.com>
	<51237034.7030900@rabbitmq.com>
Message-ID: <5123716A.8010507@rabbitmq.com>

On 19/02/13 12:29, Emile Joubert wrote:
> It is not always possible to distinguish between a remote host crashing
> and a disconnected network. In this case I think either is possible.

However, if as the OP says, the different cluster machines all are 
running, but think other nodes are not running, that rather points 
towards the network being the problem.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From bison_art at o2.pl  Tue Feb 19 15:21:50 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 19 Feb 2013 07:21:50 -0800 (PST)
Subject: [rabbitmq-discuss] Pattern - exclude
Message-ID: <1361287309970-25090.post@n5.nabble.com>

Hi. how to exclude something from pattern, f.e.
I want to all publish starts with A but not ends with B

publish.A#..... ?

Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Pattern-exclude-tp25090.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bison_art at o2.pl  Tue Feb 19 15:29:11 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 19 Feb 2013 07:29:11 -0800 (PST)
Subject: [rabbitmq-discuss] ReplyTo format
In-Reply-To: <F3A2A596-36CA-4F80-A7BD-959AE3F670F0@rabbitmq.com>
References: <1360670317804-24978.post@n5.nabble.com>
	<B3F78EE4-8923-463F-9DBF-6D57E9DC5231@rabbitmq.com>
	<1360675575658-24986.post@n5.nabble.com>
	<F3A2A596-36CA-4F80-A7BD-959AE3F670F0@rabbitmq.com>
Message-ID: <1361287751406-25091.post@n5.nabble.com>

Thank you!
Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/ReplyTo-format-tp24978p25091.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From francois at teksol.info  Tue Feb 19 15:31:30 2013
From: francois at teksol.info (=?iso-8859-1?Q?Fran=E7ois_Beausoleil?=)
Date: Tue, 19 Feb 2013 10:31:30 -0500
Subject: [rabbitmq-discuss] Consistent Exchange Only if Consumers?
In-Reply-To: <51235E46.2000800@rabbitmq.com>
References: <DF3FAB26-BEB1-41AD-BB44-B041B1C85D08@teksol.info>
	<512353B2.7020104@rabbitmq.com> <51235844.2020001@comarch.pl>
	<51235E46.2000800@rabbitmq.com>
Message-ID: <72857075-42A0-48FA-B466-E599D44F3044@teksol.info>


Le 2013-02-19 ? 06:13, Emile Joubert a ?crit :

> On 19/02/13 10:47, Ernest Staszuk wrote:
>> There is workaround if someone insist to choose dead lettering - use
>> right combination of message ttl and x-lease time.
> 
> Thanks for correcting me. You are entirely correct that DLX will not
> have any effect on the contents of a queue being deleted.
> 
> And yes, the best workaround that I could come up with also is a
> combination of message and queue TTL where the messages expire before
> the queue does. In addition to DLX this will empty the queue, delete the
> queue and send the contents to the dead-letter-exchange.

Thank you both for your answers.

I switched my design to use durable queues and made my consumers attach to the same queue based on hostname % total number of queues. I have to carry around the total number of queues, but it's not too much of a problem since I use Puppet to setup all that configuration.

Have a great day!
Fran?ois
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130219/6a0df0af/attachment.bin>

From joshua.crean at gmail.com  Tue Feb 19 18:21:43 2013
From: joshua.crean at gmail.com (Joshua Crean)
Date: Tue, 19 Feb 2013 10:21:43 -0800 (PST)
Subject: [rabbitmq-discuss] Java client notifications when basicPublish is
 throttled due to disk_free_limit
Message-ID: <88f37358-df2a-4c31-ace4-9592165b8548@googlegroups.com>

Hi there,

We have a question about using the Java client library to publish messages. 
Basically, we are having trouble finding out when a basicPublish fails due 
to throttling on the disk_free_limit. Publishing is obviously asynchronous, 
but we haven't been able to find a way to register a callback on the 
publish. We've tried e.g. ReturnListener/ConfirmListener to no avail.

Is there any way for the rabbit java client code to provide some type of 
notification when basicPublish is being throttled due to the 
disk_free_limit? Also, where do these un-published messages end up? We've 
tried to use rabbitmqctl to inspect the state of the 
queues/exchanges/channels, but the messages don't appear in any of these. 

We are concerned about the potential to lose messages that the java code 
thinks it published successfully.

Thank you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130219/d00090ed/attachment.htm>

From michael.s.klishin at gmail.com  Tue Feb 19 20:15:01 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 20 Feb 2013 00:15:01 +0400
Subject: [rabbitmq-discuss] Java client notifications when basicPublish
 is throttled due to disk_free_limit
In-Reply-To: <88f37358-df2a-4c31-ace4-9592165b8548@googlegroups.com>
References: <88f37358-df2a-4c31-ace4-9592165b8548@googlegroups.com>
Message-ID: <CAE3HoVSD9+T_ViYsYAuPLSDECA0aCt1C4Kw92SwGPo+bix5uxA@mail.gmail.com>

2013/2/19 Joshua Crean <joshua.crean at gmail.com>

> Is there any way for the rabbit java client code to provide some type of
> notification when basicPublish is being throttled due to the
> disk_free_limit?


Not at the moment. There is a protocol extension that will allow for such
notifications on a branch, so presumably
it will be part of a future release (but I don't know when and if it is
still the plan to include it).
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130220/f8263715/attachment.htm>

From matthias at rabbitmq.com  Tue Feb 19 21:20:49 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 19 Feb 2013 21:20:49 +0000
Subject: [rabbitmq-discuss] Java client notifications when basicPublish
 is throttled due to disk_free_limit
In-Reply-To: <88f37358-df2a-4c31-ace4-9592165b8548@googlegroups.com>
References: <88f37358-df2a-4c31-ace4-9592165b8548@googlegroups.com>
Message-ID: <5123ECB1.2090805@rabbitmq.com>

On 19/02/13 18:21, Joshua Crean wrote:
> Is there any way for the rabbit java client code to provide some type of
> notification when basicPublish is being throttled due to the
> disk_free_limit? Also, where do these un-published messages end up?
> We've tried to use rabbitmqctl to inspect the state of the
> queues/exchanges/channels, but the messages don't appear in any of these.

Throttling is behaviourally equivalent to network congestion. The 
messages are buffered in the network, until those buffers fill up, at 
which point the sender will block.

If, for example, connections were blocked due to lack of disk space and 
the server suddenly regained some disk space then all the messages 
published by clienta while connections were blocked will flow into the 
server and be processed.

> We are concerned about the potential to lose messages that the java code
> thinks it published successfully.

So presumably you are not *just* concerned about connection blocking due 
to disk space.

The general mechanism for dealing with potential message loss on 
publishing is 'confirms'. Now, while connections are blocked, no 
confirms for messages buffered in the network will be sent to clients. 
But, as noted above, the messages aren't actually lost. Potential loss 
will only occur when the connection gets terminated. At which point the 
safe assumption on the publisher side is that any messages which hasn't 
been confirmed may have been lost.


Matthias.

From emile at rabbitmq.com  Wed Feb 20 10:49:17 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 20 Feb 2013 10:49:17 +0000
Subject: [rabbitmq-discuss] Pattern - exclude
In-Reply-To: <1361287309970-25090.post@n5.nabble.com>
References: <1361287309970-25090.post@n5.nabble.com>
Message-ID: <5124AA2D.5000905@rabbitmq.com>


Hi,

On 19/02/13 15:21, rabbit15 wrote:
> Hi. how to exclude something from pattern, f.e.
> I want to all publish starts with A but not ends with B
> 
> publish.A#..... ?

The wildcard characters * and # only match on whole words, so a pattern
like publish.A# is not valid. You can get around this restriction by
structuring routing keys to contain the first and last letters as
separate words, e.g.

publish.A.B.absorb
publish.C.D.candid

and to create bindings for all the patterns that start with A but don't
end with B:

publish.A.A.#
publish.A.C.#
publish.A.D.#
...
publish.A.Z.#
publish.A.0.#
...
publish.A.9.#

For more information see section 3.1.3.3 in the AMQP 0-9-1 specification:

http://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf




-Emile









From emile at rabbitmq.com  Wed Feb 20 11:44:01 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 20 Feb 2013 11:44:01 +0000
Subject: [rabbitmq-discuss] Pattern - exclude
In-Reply-To: <5124AA2D.5000905@rabbitmq.com>
References: <1361287309970-25090.post@n5.nabble.com>
	<5124AA2D.5000905@rabbitmq.com>
Message-ID: <5124B701.1050308@rabbitmq.com>

Hi,

On 20/02/13 10:49, Emile Joubert wrote:
> The wildcard characters * and # only match on whole words, so a pattern
> like publish.A# is not valid. You can get around this restriction
Matthias has just pointed out that the problem can also be solved using
alternative exchanges and exchange-to-exchange bindings. If you chain
together three topic exchanges amq.topic, X and Y, and you set up an
alternate exchange on X in the way described here:

exchange amq.topic
 |
(bind A.#)
 |
exchange X  - (alternate exchange) Z - queue Q
 |
(bind #.B)
 |
exchange Y

then messages matching your criteria (matches A.# but not #.B) published
to amq.topic will end up in queue Q.





-Emile







From emile at rabbitmq.com  Wed Feb 20 12:48:17 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 20 Feb 2013 12:48:17 +0000
Subject: [rabbitmq-discuss] SSL using ssl offloading load balancer
In-Reply-To: <1361276144473-25085.post@n5.nabble.com>
References: <1361219050033-25076.post@n5.nabble.com>
	<5122A507.7080708@rabbitmq.com>
	<1361276144473-25085.post@n5.nabble.com>
Message-ID: <5124C611.8040809@rabbitmq.com>


Hi,

On 19/02/13 12:15, khloroform187 wrote:
> So I MUST execute the configuration in the correct order... (pretty
> frustrating). First the server name, and AFTER the ssl.Enabled setting.

My reading of the source sasys that this should not be possible. It is
possible to overwrite the Ssl.Enabled setting by setting the URI though,
so make sure you are not doing that.

You might also find this link useful in diagnosing SSL problems:
http://www.rabbitmq.com/troubleshooting-ssl.html



-Emile











From matthias at rabbitmq.com  Wed Feb 20 15:56:20 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Feb 2013 15:56:20 +0000
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <20130215141243.GB2924@kaka.it.su.se>
References: <20121211193803.GG754@kaka.it.su.se>
	<4D859580-D762-4BFA-A759-43F94B500FC7@rabbitmq.com>
	<20121212093115.GH754@kaka.it.su.se>
	<8D205910-A3E3-472D-A7AA-8D5737812DC4@rabbitmq.com>
	<20121221093949.GA14329@kaka.it.su.se>
	<53443B9F-8877-4993-9732-35F417AE04F0@rabbitmq.com>
	<05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
	<20130130123105.GO407@kaka.it.su.se>
	<B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
	<20130213074055.GC616@kaka.it.su.se>
	<20130215141243.GB2924@kaka.it.su.se>
Message-ID: <5124F224.1090903@rabbitmq.com>

Simon,

On 15/02/13 14:13, Simon Lundstr?m wrote:
> I have configured my plugin to be used before the internal one:
> {auth_backends, [rabbit_auth_backend_kerberos, rabbit_auth_backend_internal]},
>
> And if I allow all login attempts in my plugin, noone (not "internal_admin"
> specified in the internal database nor "virtual-user" which is supposed to be
> able to access the system) can access the API (so it disables the CLI and
> management GUI too).

That's because you are setting tags = [] in 
https://github.com/simmel/rabbitmq-auth-backend-kerberos/blob/5eaccf20f13032f35b4d81c74ec2af24f9a4c974/src/rabbit_auth_backend_kerberos.erl#L28

You'll probably want to invoke 
rabbit_auth_backend_internal:lookup_user(Username) and extract the tags 
from the result.

Regards,

Matthias.

From moshima at advent.com  Wed Feb 20 20:50:09 2013
From: moshima at advent.com (michi.oshima)
Date: Wed, 20 Feb 2013 12:50:09 -0800 (PST)
Subject: [rabbitmq-discuss] Asynchronous methods in WCF Binding
Message-ID: <1361393409406-25100.post@n5.nabble.com>

Hi,

I should really share my code but I cannot at this time.  Sorry.

In RabbitMQChannelFactory and RabbitMQChannelListener, there are
"asynchronous" methods like .BeginOpen() and .EndOpen().  Are they...

1. Known to work?
2. Tested?

I am getting at least one exception that might be caused by a defect in
RabbitMQ WCF Binding.  I think this happens somewhere between
RabbitMQChannelFactory.BeginOpen() and .EndOpen():

Exception:

System.InvalidOperationException

Message:

The communication object,
RabbitMQ.ServiceModel.RabbitMQChannelFactory`1[System.ServiceModel.Channels.IOutputChannel],
cannot be modified while it is in the Opening state.

Stack trace:

 at
System.ServiceModel.Channels.CommunicationObject.ThrowIfDisposedOrImmutable()
   at System.ServiceModel.Channels.CommunicationObject.Open(TimeSpan
timeout)
   at
System.Runtime.Remoting.Messaging.StackBuilderSink._PrivateProcessMessage(IntPtr
md, Object[] args, Object server, Object[]& outArgs)
   at
System.Runtime.Remoting.Messaging.StackBuilderSink.AsyncProcessMessage(IMessage
msg, IMessageSink replySink)

I *think* this happens ultimately because of the following line of code (in
RabbitMQChannelFactory.cs):

   m_openMethod = new CommunicationOperation(Open);

I'm not very knowledgeable about WCF, so I apologize if I'm missing
something obvious.  If there is some code samples where these asynchronous
methods are used successfully on RabbitMQChannelFactory and
RabbitMQChannelListener, that would be ideal.

Thanks,

Michi Oshima



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Asynchronous-methods-in-WCF-Binding-tp25100.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Scott.Chapman at servicenow.com  Wed Feb 20 20:50:16 2013
From: Scott.Chapman at servicenow.com (Scott Chapman)
Date: Wed, 20 Feb 2013 20:50:16 +0000
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika? I
 want 1 message at a time and stop receiving until I'm ready again.
Message-ID: <CC28B25FDAC5D943B606F46369686C2A2435B90C@SJC4EXDAG01-02.corp.service-now.com>

What's the best practice to make it so I receive a message in a single-threaded app, process it and don't get any more messages until I'm ready again?

Something like:

Receive Message
Turn off Channel ? how best to do this?
Ack Message
Process Message
Turn on Channel
?. Back to the top.

Thanks,
Scott

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130220/d0113b37/attachment.htm>

From michael.s.klishin at gmail.com  Wed Feb 20 20:55:56 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Feb 2013 00:55:56 +0400
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika?
 I want 1 message at a time and stop receiving until I'm ready again.
In-Reply-To: <CC28B25FDAC5D943B606F46369686C2A2435B90C@SJC4EXDAG01-02.corp.service-now.com>
References: <CC28B25FDAC5D943B606F46369686C2A2435B90C@SJC4EXDAG01-02.corp.service-now.com>
Message-ID: <CAE3HoVSnQPeOX7j-8vczSHSMoydFvJrh-0WBFdRvwV8r7TLNhA@mail.gmail.com>

2013/2/21 Scott Chapman <Scott.Chapman at servicenow.com>

> What's the best practice to make it so I receive a message in a
> single-threaded app, process it and don't get any more messages until I'm
> ready again?


One way would be to cancel your consumer.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/871f5855/attachment.htm>

From peter.konar at nokia.com  Wed Feb 20 21:54:17 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Wed, 20 Feb 2013 15:54:17 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>, 
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navteq.com>

++Justin and Craig

-----Original Message-----
From: Konar Peter (Nokia-LC/Chicago)
Sent: Wednesday, February 20, 2013 2:00 PM
To: ext Matthias Radestock; Carroll James (Nokia-LC/Malvern)
Cc: Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: RE: [rabbitmq-discuss] RabbitMQ blocking issue

Matthias,
   We have automated the recovery of logs for this issue to speed analysis. I have attached two logs that show issues with in the first 5 minutes of it happening.
In "report.pt.13:35" we show that 10.196.42.180 in not outputting as scheduled. These logs include jstacks of the processes on the 5 machines outputting as well as rabbit reports and netstats.


report.pt.13:40? (516 KB?) shows that there are two machines

Thanks
Peter Konar



______________________________________
From: ext Matthias Radestock [matthias at rabbitmq.com]
Sent: Thursday, February 14, 2013 2:21 AM
To: Carroll James (Nokia-LC/Malvern)
Cc: Konar Peter (Nokia-LC/Chicago); Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

James,

On 13/02/13 23:40, Carroll James (Nokia-LC/Malvern) wrote:
> Yup. The times are about right. See the connections from 182. The
> first email show port 49191 which was opened at 15:17 GMT. It was
> hung for quite a while before we got to it but the server closed it
> at 21:22 and opened a new one. That's around the time we were in
> there.
>
> If it matters the log is attached.

Here's the relevant portion:

<quote>
=INFO REPORT==== 13-Feb-2013::15:17:00 ===
accepting AMQP connection <0.2252.1282> (10.196.42.182:49191 ->
10.196.42.21:5672)

=ERROR REPORT==== 13-Feb-2013::21:22:01 ===
closing AMQP connection <0.2252.1282> (10.196.42.182:49191 ->
10.196.42.21:5672):
{heartbeat_timeout,running}
</quote>

So the connection was open for quite a while and then got closed due to
a missed heartbeat.

The default heartbeat interval is 10 minutes, but the server will only
time out between two and three intervals after the last data has been
received, so it could take up to half an hour for the server to kill a
connection that has gone bad.

The question is why the server isn't seeing any data. There are two
obvious explanations:
a) there is a network disruption, and
b) the server has stopped reading from the socket

The presence of a non-empty Recv-Q on the server-side connection points
to the latter. We need to get hold of a 'rabbitmqctl report' showing
that connection while the Recv-Q is non-empty, so we know what state the
server thought the connection was in at the time.

Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.

From matthias at rabbitmq.com  Wed Feb 20 23:09:15 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Feb 2013 23:09:15 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>,
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>, <511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navte
	q.com>
Message-ID: <5125579B.7060707@rabbitmq.com>

Peter,

On 20/02/13 21:54, Konar Peter (Nokia-LC/Chicago) wrote:
> I have attached two logs that show issues with in the first 5 minutes
> of it happening.

These reports show two connections with a non-empty Recv-Q at the server 
side, a non-empty Send-Q at the client side, and a connection state of 
'running' in rabbit. And it looks like there was no change in that 
situation over at least five minutes. The connections were terminated by 
rabbit ~30 minutes later due to missing heartbeats.

This all points towards rabbit having stopped reading from the socket 
even though it thinks it is.

Needless to say that is rather worrying, and not something we have ever 
encountered before.

In order to investigate this further...

- Please upgrade Erlang to R15B03. It is conceivable that the issue is 
caused by bugs in the Erlang VM that have since has been fixed.

- Next time the issue occurs, please run
   rabbitmqctl set_vm_memory_high_watermark 0.0001
followed by
   rabbitmqctl set_vm_memory_high_watermark 0.4
and check whether that causes the stalled connections to resume working.


Regards,

Matthias.

From Scott.Chapman at servicenow.com  Wed Feb 20 23:27:11 2013
From: Scott.Chapman at servicenow.com (Scott Chapman)
Date: Wed, 20 Feb 2013 23:27:11 +0000
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika?
 I want 1 message at a time and stop receiving until I'm ready again.
In-Reply-To: <CC28B25FDAC5D943B606F46369686C2A2435B90C@SJC4EXDAG01-02.corp.service-now.com>
Message-ID: <CC28B25FDAC5D943B606F46369686C2A2435BDC7@SJC4EXDAG01-02.corp.service-now.com>

After further exploring it appears that you do this:
Using the BlockingConnection:
Receive Message
Run Handler to process message which can immediately ACK the message.
When Handler returns, next message is received from RabbitMQ.

Simpler!



From: Scott Chapman <Scott.Chapman at servicenow.com<mailto:Scott.Chapman at servicenow.com>>
Reply-To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Date: Wednesday, February 20, 2013 12:50 PM
To: "rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>" <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika? I want 1 message at a time and stop receiving until I'm ready again.

What's the best practice to make it so I receive a message in a single-threaded app, process it and don't get any more messages until I'm ready again?

Something like:

Receive Message
Turn off Channel ? how best to do this?
Ack Message
Process Message
Turn on Channel
?. Back to the top.

Thanks,
Scott

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130220/ff797199/attachment.htm>

From tim at rabbitmq.com  Wed Feb 20 23:32:50 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 20 Feb 2013 23:32:50 +0000
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika?
	I want 1 message at a time and stop receiving until I'm ready again.
In-Reply-To: <CC28B25FDAC5D943B606F46369686C2A2435B90C@SJC4EXDAG01-02.corp.service-now.com>
References: <CC28B25FDAC5D943B606F46369686C2A2435B90C@SJC4EXDAG01-02.corp.service-now.com>
Message-ID: <FE1F9278-A23F-4BD7-BDF0-A1C13F32D5AB@rabbitmq.com>

On 20 Feb 2013, at 20:50, Scott Chapman wrote:
> What's the best practice to make it so I receive a message in a single-threaded app, process it and don't get any more messages until I'm ready again?
> 

I would consider using basic.get with noAck=false for this. The basic.get method offers a pull-API, where the client asks the broker for a message and the broker replies with either a message (in a basic.get-ok) or a basic.empty indicating the queue contains no messages.

https://pika.readthedocs.org/en/latest/examples/blocking_basic_get.html

> Something like:
> 
> Receive Message
> Turn off Channel ? how best to do this?
> Ack Message
> Process Message
> Turn on Channel

This seems like a lot of work to replicate what basic.get offers ootb. Is there a compelling reason not to use basic.get for your purposes?

Cheers,
Tim

From tim at rabbitmq.com  Wed Feb 20 23:34:17 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 20 Feb 2013 23:34:17 +0000
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika?
	I want 1 message at a time and stop receiving until I'm ready again.
In-Reply-To: <CC28B25FDAC5D943B606F46369686C2A2435BDC7@SJC4EXDAG01-02.corp.service-now.com>
References: <CC28B25FDAC5D943B606F46369686C2A2435BDC7@SJC4EXDAG01-02.corp.service-now.com>
Message-ID: <4A75A302-9664-4BC0-83F0-4541E3EDAFCF@rabbitmq.com>

On 20 Feb 2013, at 23:27, Scott Chapman wrote:
> After further exploring it appears that you do this:
> Using the BlockingConnection:

Yes!

> Simpler!
> 

If I'd seen this 10 seconds ago, I wouldn't have replied! :)

Cheers,
Tim


From frank.ritchie at dealer.com  Thu Feb 21 00:02:13 2013
From: frank.ritchie at dealer.com (Frank)
Date: Wed, 20 Feb 2013 16:02:13 -0800 (PST)
Subject: [rabbitmq-discuss] odd rabbitmq / heartbeat /drbd duplicate mount
Message-ID: <338d5bfe-2f49-4d38-a22d-bfeb219db601@googlegroups.com>

Hi all,

I am troubleshooting a rabbitmq 2.6.1 / drbd-heartbeat issue. 

- /proc/drbd correctly reports the primary on both nodes

- 'crm status' correctly reports all cluster resources (filesystem/rabbitmq 
service/ip address) as running on the node that is the drbd primary

what has me stumped is that while the ip address is only on the primary 
heartbeat node (like it should be), /var/lib/rabbitmq is accessible as both.

'mount' and mtab both reports that /var/lib/rabbitmq is not mounted on the 
backup heartbeat node but I can see the same .erlang.cookie on both
nodes. The output of rabbitmqctl is the same for both nodes.

Has anyone else seen this?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130220/00bef5f2/attachment.htm>

From matthias at rabbitmq.com  Thu Feb 21 00:12:08 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 21 Feb 2013 00:12:08 +0000
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika?
 I want 1 message at a time and stop receiving until I'm ready again.
In-Reply-To: <CC28B25FDAC5D943B606F46369686C2A2435BDC7@SJC4EXDAG01-02.corp.service-now.com>
References: <CC28B25FDAC5D943B606F46369686C2A2435BDC7@SJC4EXDAG01-02.corp.service-now.com>
Message-ID: <51256658.6000309@rabbitmq.com>

Scott,

On 20/02/13 23:27, Scott Chapman wrote:
> After further exploring it appears that you do this:
> Using the BlockingConnection:
> Receive Message
> Run Handler to process message which can immediately ACK the message.
> When Handler returns, next message is received from RabbitMQ.
>
> Simpler!

The above won't stop rabbit from sending one or more messages to the 
client (depending on the basic.qos prefetch setting). While the app 
won't get to the see these messages until the Handler returns, the 
messages will still take up buffer space at the client or in the 
network, and they will be unavailable to other consumers on the same queue.

If that is not what you want then follow Michael's suggestion of 
cancelling the subscription. Or simply delay the ack until the app is 
ready to process the next message.

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Feb 21 00:12:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 21 Feb 2013 00:12:12 +0000
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika?
 I want 1 message at a time and stop receiving until I'm ready again.
In-Reply-To: <FE1F9278-A23F-4BD7-BDF0-A1C13F32D5AB@rabbitmq.com>
References: <CC28B25FDAC5D943B606F46369686C2A2435B90C@SJC4EXDAG01-02.corp.service-now.com>
	<FE1F9278-A23F-4BD7-BDF0-A1C13F32D5AB@rabbitmq.com>
Message-ID: <5125665C.3000400@rabbitmq.com>

On 20/02/13 23:32, Tim Watson wrote:
> On 20 Feb 2013, at 20:50, Scott Chapman wrote:
>> What's the best practice to make it so I receive a message in a
>> single-threaded app, process it and don't get any more messages
>> until I'm ready again?
>>
>
> I would consider using basic.get with noAck=false for this.

That would require polling, i.e. repeated basic.get's when the queue is 
empty, which is undesirable. Michael's suggestion of cancelling the 
consumer works better in that regard.

Matthias.

From peter.konar at nokia.com  Wed Feb 20 20:02:29 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Wed, 20 Feb 2013 14:02:29 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>, 
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>,
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB1501388A7FBC@hq-ex-mb03.ad.navteq.com>

Adding Rabbit logs
pk
________________________________________
From: Konar Peter (Nokia-LC/Chicago)
Sent: Wednesday, February 20, 2013 2:00 PM
To: ext Matthias Radestock; Carroll James (Nokia-LC/Malvern)
Cc: Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: RE: [rabbitmq-discuss] RabbitMQ blocking issue

Matthias,
   We have automated the recovery of logs for this issue to speed analysis. I have attached two logs that show issues with in the first 5 minutes of it happening.
In "report.pt.13:35" we show that 10.196.42.180 in not outputting as scheduled. These logs include jstacks of the processes on the 5 machines outputting as well as rabbit reports and netstats.


report.pt.13:40? (516 KB?) shows that there are two machines

Thanks
Peter Konar



______________________________________
From: ext Matthias Radestock [matthias at rabbitmq.com]
Sent: Thursday, February 14, 2013 2:21 AM
To: Carroll James (Nokia-LC/Malvern)
Cc: Konar Peter (Nokia-LC/Chicago); Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

James,

On 13/02/13 23:40, Carroll James (Nokia-LC/Malvern) wrote:
> Yup. The times are about right. See the connections from 182. The
> first email show port 49191 which was opened at 15:17 GMT. It was
> hung for quite a while before we got to it but the server closed it
> at 21:22 and opened a new one. That's around the time we were in
> there.
>
> If it matters the log is attached.

Here's the relevant portion:

<quote>
=INFO REPORT==== 13-Feb-2013::15:17:00 ===
accepting AMQP connection <0.2252.1282> (10.196.42.182:49191 ->
10.196.42.21:5672)

=ERROR REPORT==== 13-Feb-2013::21:22:01 ===
closing AMQP connection <0.2252.1282> (10.196.42.182:49191 ->
10.196.42.21:5672):
{heartbeat_timeout,running}
</quote>

So the connection was open for quite a while and then got closed due to
a missed heartbeat.

The default heartbeat interval is 10 minutes, but the server will only
time out between two and three intervals after the last data has been
received, so it could take up to half an hour for the server to kill a
connection that has gone bad.

The question is why the server isn't seeing any data. There are two
obvious explanations:
a) there is a network disruption, and
b) the server has stopped reading from the socket

The presence of a non-empty Recv-Q on the server-side connection points
to the latter. We need to get hold of a 'rabbitmqctl report' showing
that connection while the Recv-Q is non-empty, so we know what state the
server thought the connection was in at the time.

Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at ajtrafp063.log
Type: text/x-log
Size: 12012 bytes
Desc: rabbit at ajtrafp063.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130220/be1d4c6f/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at ajtrafp064.log
Type: text/x-log
Size: 254 bytes
Desc: rabbit at ajtrafp064.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130220/be1d4c6f/attachment-0001.bin>

From peter.konar at nokia.com  Wed Feb 20 21:54:42 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Wed, 20 Feb 2013 15:54:42 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB1501388A7FBC@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B487F@f-exch-mb2.ad.navteq.com>,
	<51154058.9070507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013762796E@hq-ex-mb03.ad.navteq.com>
	<51155E76.5010307@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E6595B48A2@f-exch-mb2.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>, 
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>,
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBC@hq-ex-mb03.ad.navteq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB15013889FF29@hq-ex-mb03.ad.navteq.com>

++Justin and Craig

-----Original Message-----
From: Konar Peter (Nokia-LC/Chicago)
Sent: Wednesday, February 20, 2013 2:02 PM
To: Konar Peter (Nokia-LC/Chicago); ext Matthias Radestock; Carroll James (Nokia-LC/Malvern); dbuchko at vmware.com
Cc: Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: RE: [rabbitmq-discuss] RabbitMQ blocking issue

Adding Rabbit logs
pk
________________________________________
From: Konar Peter (Nokia-LC/Chicago)
Sent: Wednesday, February 20, 2013 2:00 PM
To: ext Matthias Radestock; Carroll James (Nokia-LC/Malvern)
Cc: Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: RE: [rabbitmq-discuss] RabbitMQ blocking issue

Matthias,
   We have automated the recovery of logs for this issue to speed analysis. I have attached two logs that show issues with in the first 5 minutes of it happening.
In "report.pt.13:35" we show that 10.196.42.180 in not outputting as scheduled. These logs include jstacks of the processes on the 5 machines outputting as well as rabbit reports and netstats.


report.pt.13:40? (516 KB?) shows that there are two machines

Thanks
Peter Konar



______________________________________
From: ext Matthias Radestock [matthias at rabbitmq.com]
Sent: Thursday, February 14, 2013 2:21 AM
To: Carroll James (Nokia-LC/Malvern)
Cc: Konar Peter (Nokia-LC/Chicago); Discussions about RabbitMQ; Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago)
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

James,

On 13/02/13 23:40, Carroll James (Nokia-LC/Malvern) wrote:
> Yup. The times are about right. See the connections from 182. The
> first email show port 49191 which was opened at 15:17 GMT. It was hung
> for quite a while before we got to it but the server closed it at
> 21:22 and opened a new one. That's around the time we were in there.
>
> If it matters the log is attached.

Here's the relevant portion:

<quote>
=INFO REPORT==== 13-Feb-2013::15:17:00 === accepting AMQP connection <0.2252.1282> (10.196.42.182:49191 ->
10.196.42.21:5672)

=ERROR REPORT==== 13-Feb-2013::21:22:01 === closing AMQP connection <0.2252.1282> (10.196.42.182:49191 ->
10.196.42.21:5672):
{heartbeat_timeout,running}
</quote>

So the connection was open for quite a while and then got closed due to a missed heartbeat.

The default heartbeat interval is 10 minutes, but the server will only time out between two and three intervals after the last data has been received, so it could take up to half an hour for the server to kill a connection that has gone bad.

The question is why the server isn't seeing any data. There are two obvious explanations:
a) there is a network disruption, and
b) the server has stopped reading from the socket

The presence of a non-empty Recv-Q on the server-side connection points to the latter. We need to get hold of a 'rabbitmqctl report' showing that connection while the Recv-Q is non-empty, so we know what state the server thought the connection was in at the time.

Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.

From mengql112233 at gmail.com  Thu Feb 21 03:11:21 2013
From: mengql112233 at gmail.com (Qinglong.Meng)
Date: Thu, 21 Feb 2013 11:11:21 +0800
Subject: [rabbitmq-discuss] [rabbitmql] pika throw exception following
	the Toturials
In-Reply-To: <f8b7e808-d0c8-425a-b642-dda03e8d0380@01HW125807>
References: <CAKwdTWfL0ZrBgj7=j5oqHRN+fKZ9DJCRWa-1QDrYxTjTS3YGxA@mail.gmail.com>
	<f8b7e808-d0c8-425a-b642-dda03e8d0380@01HW125807>
Message-ID: <CAPKora-xZ82ZSUPYWpwCpB+7L40r8p7gobp5D_tHm9uZwrf4Hg@mail.gmail.com>

Tks, everybody, I have got the answer..

Tks again.


2013/2/11 Russa Nayak/TVM/TCS <russa.nayak at tcs.com>

> Reply
>
> Hello,
>
> It seems you are facing a AMQP Connection Error while connectinfg to
> RabbitMQ. The parameters passes like end uri(hostname +port address),
> username and password may be incorrect. It also can be the case that the
> RabbitMQ server itself is not running or installed incorrect.
>
> Thanks and Regards,
> Russa Nayak
> Systems Engineer
> Tata Consultancy Services
> Mailto: russa.nayak at tcs.com
> Website: http://www.tcs.com
>
> ----- Original Message -----
> On Wednesday, February 6, 2013, Qinglong.Meng wrote:
>
>
>
> Hi,
> When I following the Totuials 'Hello World!', and I use pika==0.9.8, I got
> pika excetion:
> pika.exceptions.AMQPConnectionError: (0, '')
> File "/root/workspace/rabbitmq/01sample/011publisher.py", line 19, in
> <module>
> conn = pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py",
> line 61, in __init__
> super(BaseConnection, self).__init__(parameters, on_open_callback)
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/connection.py",
> line 513, in __init__
> self._connect()
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/connection.py",
> line 804, in _connect
> self._adapter_connect()
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
> line 146, in _adapter_connect
> self.process_data_events()
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
> line 88, in process_data_events
> if self._handle_read():
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
> line 184, in _handle_read
> super(BlockingConnection, self)._handle_read()
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py",
> line 300, in _handle_read
> return self._handle_error(error)
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/base_connection.py",
> line 264, in _handle_error
> self._handle_disconnect()
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
> line 181, in _handle_disconnect
> self._on_connection_closed(None, True)
> File
> "/usr/local/lib/python2.7/dist-packages/pika-0.9.8-py2.7.egg/pika/adapters/blocking_connection.py",
> line 235, in _on_connection_closed
> raise exceptions.AMQPConnectionError(*self.closing)
>
>
> Can anybody help me..
>
>
> Tks very much
> Best Regards,
>
> --
>
>
>
>
> Lawrency Meng
> mail: mengql112233 at gmail.com_______________________________________________
> Mailing list: https://launchpad.net/~openstack
> Post to : openstack at lists.launchpad.net
> Unsubscribe : https://launchpad.net/~openstack
> More help : https://help.launchpad.net/ListHelp
>
>
> --
>
>
> Gavin M. Roy
> Chief Technology Officer
>
>
>
> 100 Union Square Drive
> New Hope, PA 18938
> p. +1.215.862.1162 x263
> f. +1.215.862.0465
>
>
>
>
>
> The public market leader in social discovery. (NYSE MKT: MEET)
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> =====-----=====-----=====
> Notice: The information contained in this e-mail
> message and/or attachments to it may contain
> confidential or privileged information. If you are
> not the intended recipient, any dissemination, use,
> review, distribution, printing or copying of the
> information contained in this e-mail message
> and/or attachments to it are strictly prohibited. If
> you have received this communication in error,
> please notify us by reply e-mail or telephone and
> immediately and permanently delete the message
> and any attachments. Thank you
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 

Lawrency Meng
mail: mengql112233 at gmail.com
_______________________________________________
Mailing list: https://launchpad.net/~openstack
Post to     : openstack at lists.launchpad.net
Unsubscribe : https://launchpad.net/~openstack
More help   : https://help.launchpad.net/ListHelp
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/e9af2a47/attachment.htm>

From 534411790 at 163.com  Thu Feb 21 07:37:05 2013
From: 534411790 at 163.com (534411790 at 163.com)
Date: Wed, 20 Feb 2013 23:37:05 -0800 (PST)
Subject: [rabbitmq-discuss] I can't visit http://localhost:15672
Message-ID: <7d3d62f0-5bd7-4c11-b6c8-816367b52e64@googlegroups.com>

The rabbitm-server had been started .but when I Enter 
the http://localhost:15672 .tips: error to connect the web. however i retry 
,it can't work.I need help. 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130220/c506fec0/attachment.htm>

From t.otoda.freemail at gmail.com  Thu Feb 21 07:58:02 2013
From: t.otoda.freemail at gmail.com (t.otoda.freemail at gmail.com)
Date: Wed, 20 Feb 2013 23:58:02 -0800 (PST)
Subject: [rabbitmq-discuss] about "exactly" policy on RabbitMQ 3.0.1
Message-ID: <6ca419c9-3bc6-433b-8e87-478e4e73c644@googlegroups.com>




Hello,

I have 2 questions about "exactly" policy on RabbitMQ 3.0.1 .

Can anyone tell me  answers of my questions ?

 

1. How does RabbitMQ select nodes that queue is mirrored to in the cluster ?

   I want to know
   whether all mirrored Queue is mirrored to same 3 nodes,
   when there are more than 3 nodes in the cluster.


2. With the following cases, 
   what does RabbitMQ set "exactly" policy do ?

# As a premise,
# I suppose ha-params to be 3.

  1) 1 node ( named A) to which Queue is mirrored goes down
  
     I want to know
     whether RabbitMQ continue to publish messages to other 2 nodes (named 
B and C)
     without data lost.

  2) after 1), A is recovered

     I want to know
     whether Queue is mirrored to it again.

  3) instead of 2), another node ( named D ) is added in the cluster
  
     What should I do to allow Queue to be mirrored to D
     instead of A ?


Thank you


 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130220/3a785182/attachment.htm>

From michael.s.klishin at gmail.com  Thu Feb 21 09:30:06 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Feb 2013 13:30:06 +0400
Subject: [rabbitmq-discuss] I can't visit http://localhost:15672
In-Reply-To: <7d3d62f0-5bd7-4c11-b6c8-816367b52e64@googlegroups.com>
References: <7d3d62f0-5bd7-4c11-b6c8-816367b52e64@googlegroups.com>
Message-ID: <CAE3HoVT_0z6Qh7=cGqkxc3pZNAYHyGOk+9yvdMdYCzKRw7UbxQ@mail.gmail.com>

2013/2/21 <534411790 at 163.com>

> The rabbitm-server had been started .but when I Enter the
> http://localhost:15672 .tips: error to connect the web. however i retry
> ,it can't work.I need help.
>

Did you enable the management plugin (that Web UI is part of)?

Run this on the command line: rabbitmq-plugins enable rabbitmq_management,
restart RabbitMQ and try again.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/6d9f629f/attachment.htm>

From benjamin.lovell at gmail.com  Thu Feb 21 09:57:41 2013
From: benjamin.lovell at gmail.com (Ben Lovell)
Date: Thu, 21 Feb 2013 09:57:41 +0000
Subject: [rabbitmq-discuss] I can't visit http://localhost:15672
In-Reply-To: <CAE3HoVT_0z6Qh7=cGqkxc3pZNAYHyGOk+9yvdMdYCzKRw7UbxQ@mail.gmail.com>
References: <7d3d62f0-5bd7-4c11-b6c8-816367b52e64@googlegroups.com>
	<CAE3HoVT_0z6Qh7=cGqkxc3pZNAYHyGOk+9yvdMdYCzKRw7UbxQ@mail.gmail.com>
Message-ID: <CAFYMY5L6jaR7njg42V7uGutSbfGoGfKyOMj9CLw+9EssJDU=wA@mail.gmail.com>

On 21 February 2013 09:30, Michael Klishin <michael.s.klishin at gmail.com>wrote:

>
> 2013/2/21 <534411790 at 163.com>
>
> The rabbitm-server had been started .but when I Enter the
>> http://localhost:15672 .tips: error to connect the web. however i retry
>> ,it can't work.I need help.
>>
>
> Did you enable the management plugin (that Web UI is part of)?
>
> Run this on the command line: rabbitmq-plugins enable rabbitmq_management,
> restart RabbitMQ and try again.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
I've come across this several times recently when our developers are
installing rabbit and getting started. For some reason the management
plugin, although definitely enabled does not start on that port. You can
access it on 55672, however. There was never a clash or anything else
listening on the regular management port so I just put it down to
experience.

Cheers,
Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/40a604a7/attachment.htm>

From matthias at rabbitmq.com  Thu Feb 21 10:01:45 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 21 Feb 2013 10:01:45 +0000
Subject: [rabbitmq-discuss] I can't visit http://localhost:15672
In-Reply-To: <CAFYMY5L6jaR7njg42V7uGutSbfGoGfKyOMj9CLw+9EssJDU=wA@mail.gmail.com>
References: <7d3d62f0-5bd7-4c11-b6c8-816367b52e64@googlegroups.com>
	<CAE3HoVT_0z6Qh7=cGqkxc3pZNAYHyGOk+9yvdMdYCzKRw7UbxQ@mail.gmail.com>
	<CAFYMY5L6jaR7njg42V7uGutSbfGoGfKyOMj9CLw+9EssJDU=wA@mail.gmail.com>
Message-ID: <5125F089.9050400@rabbitmq.com>

On 21/02/13 09:57, Ben Lovell wrote:
> I've come across this several times recently when our developers are
> installing rabbit and getting started. For some reason the management
> plugin, although definitely enabled does not start on that port. You can
> access it on 55672, however.

Perhaps folks are running older versions of rabbit? The switch to 15672 
happened in 3.0.0. Older version were listening on 55672 only.

Matthias.

From simon at rabbitmq.com  Thu Feb 21 10:34:09 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 21 Feb 2013 10:34:09 +0000
Subject: [rabbitmq-discuss] about "exactly" policy on RabbitMQ 3.0.1
In-Reply-To: <6ca419c9-3bc6-433b-8e87-478e4e73c644@googlegroups.com>
References: <6ca419c9-3bc6-433b-8e87-478e4e73c644@googlegroups.com>
Message-ID: <5125F821.40409@rabbitmq.com>

On 21/02/13 07:58, t.otoda.freemail at gmail.com wrote:
> 1. How does RabbitMQ select nodes that queue is mirrored to in the cluster ?
>
>     I want to know
>     whether all mirrored Queue is mirrored to same 3 nodes,
>     when there are more than 3 nodes in the cluster.

When the queue is first created, the nodes are selected randomly.

However, if you then take all the nodes in the cluster down and bring 
them back up again, all queues will end up on the same three nodes - 
because the queue will have come up on the first three nodes to be 
available rather than waiting for the nodes it was originally on - since 
there's no guarantee those nodes will ever come back up. I think this is 
the best we can do without becoming a lot more complicated, having 
queues migrate around the cluster for load balancing.

> 2. With the following cases,
>     what does RabbitMQ set "exactly" policy do ?
>
> # As a premise,
> # I suppose ha-params to be 3.
>
>    1) 1 node ( named A) to which Queue is mirrored goes down
>
>       I want to know
>       whether RabbitMQ continue to publish messages to other 2 nodes
> (named B and C)
>       without data lost.

Yes.

>
>    2) after 1), A is recovered
>
>       I want to know
>       whether Queue is mirrored to it again.

Yes.

>    3) instead of 2), another node ( named D ) is added in the cluster
>
>       What should I do to allow Queue to be mirrored to D
>       instead of A ?

It should be mirrored to D, you shouldn't need to do anything - assuming 
there is an {exactly, 3} queue, and two nodes in the cluster, and a 
third comes up, it should mirror to the new node regardless of whether 
that node was in the cluster before.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Feb 21 11:27:24 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 21 Feb 2013 11:27:24 +0000
Subject: [rabbitmq-discuss] Asynchronous methods in WCF Binding
In-Reply-To: <1361393409406-25100.post@n5.nabble.com>
References: <1361393409406-25100.post@n5.nabble.com>
Message-ID: <5126049C.2090809@rabbitmq.com>


Hi,

On 20/02/13 20:50, michi.oshima wrote:
> In RabbitMQChannelFactory and RabbitMQChannelListener, there are
> "asynchronous" methods like .BeginOpen() and .EndOpen().  Are they...
> 
> 1. Known to work?
> 2. Tested?

These methods are required when implementing the relevant WCF
interfaces. You are correct that the included tests do not currently
exercise asynchronous modes of operation.

>    m_openMethod = new CommunicationOperation(Open);

You may well have found a bug in the implementation and the line above
may be implicated. Would you be able to contribute a minimal code sample
that recreates the stack trace you posted?



-Emile






From oxxyyd at hotmail.com  Thu Feb 21 12:18:05 2013
From: oxxyyd at hotmail.com (oxxyyd at hotmail.com)
Date: Thu, 21 Feb 2013 04:18:05 -0800 (PST)
Subject: [rabbitmq-discuss] High Performance Setup Strategy
In-Reply-To: <215159b2-83a2-4b20-845c-0f01285717c3@googlegroups.com>
References: <215159b2-83a2-4b20-845c-0f01285717c3@googlegroups.com>
Message-ID: <92fa6230-7671-4b4a-a1a7-f325f1801ba3@googlegroups.com>

Hello Florian,

Another way to achieve stable and high performance would be to install 
Solace Appliances. With them you can reach 200k concurrent connections per 
box and also get more than 230k messages/second fully guaranteed. You would 
have to replace AMQP with JMS though....

2 Solace 3260 (needed for 200K connections with HA) would replace :

1 server 24 cores

3 servers 16 cores

=120K connections

 

for 480K connections:

need at least 16 servers (4 24 cores and 12 16 cores).

vs :
6 solace appliances 

Cheers
Daniel


Am Montag, 18. Februar 2013 11:53:07 UTC+1 schrieb Florian M?ller:
>
> Good morning,
>
> I'm a little bit curious about the setup strategy of a project. Maybe 
> someone of you can make it clear.
>
> Situation: 
> Community Website, running on several php-nodes.
>
> Destination:
> Implementation of Websockets with nodejs.
>
> Attempts:
> One big Server (24 Cores) running Rabbitmq, every websocket-worker 
> connects to this one.
> Every php-node is running an own Rabbitmq, php connects to localhost using 
> Amqp. Every kind of notifications is being sent to it, but only if the 
> target user is actually connected to one socket (Solved per memcache-entry)
> 3 Websocket-Hosts, each running 16 Node-Worker. (16 Cores/Server)
>
> Every websocket-worker creates an own queue.
> There are 100 exchanges, the users are being sorted in there by their 
> UserID. Exchange-Type: direct.
> (Using only one exchange crashes when reaching 64k bindings)
>
> Problem:
> Queues are starting to fill up when reaching 120k Bindings (130-140k 
> unique Websocket-Connections). 4-6k delivered Msg/s.
> Load: 
> Big one (18-20 / 24)
> php-nodes (6 / 16)
> Nodejs-Hosts (5 / 16)
>
> I want to know your opinion about this setup, or tips to build a better 
> one.
>
> We want to serve 300-500k Connections at any time with at least hardware 
> as possible.
>
> Greetings,
> Florian
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/530a3ee7/attachment.htm>

From oxxyyd at hotmail.com  Thu Feb 21 12:28:08 2013
From: oxxyyd at hotmail.com (oxxyyd at hotmail.com)
Date: Thu, 21 Feb 2013 04:28:08 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
	of connections
In-Reply-To: <59b8eb8a-8b8f-48d2-ac22-acb7399b1ead@googlegroups.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
	<59b8eb8a-8b8f-48d2-ac22-acb7399b1ead@googlegroups.com>
Message-ID: <b087b92a-22a1-48e4-a850-3c746b921833@googlegroups.com>

Hi there,

If you need performance and scale: One single solace appliance can handle 
200k concurrent connections for web streaming /box and do 230k fully 
guaranteed messages s or 11m reliable messages/s.  Any slow consumer issues 
will not come up as it does not access disc for persistence  You can 
monitor the FPG card without impacting the performance. 
Not sure if it will fit into your architecture thought...

Cheers,
D

Am Dienstag, 29. Januar 2013 21:12:38 UTC+1 schrieb Sandy:
>
> To RabbitMQ gurus - Could you please post the replies here instead of just 
> replying to the original person (Roman in this case). This is something of 
> interest to me as well and I would like to follow this thread. Thx!
>
> On Saturday, January 26, 2013 6:58:36 AM UTC-5, Romanas S. wrote:
>>
>> Hi guys,
>>  I'm trying to come up with an architecture for a RabbitMQ cluster that 
>> could potentially handle millions of (persistent) connections. I've set up 
>> a cluster of Rabbits with 3 nodes (16GB RAM, 4x cpu cores each) and a Load 
>> Balancer in front of them, increased all of the system limits on sockets 
>> and file descriptors, but can't seem to scale to more then 30k connections 
>> on the entire cluster. 
>>
>> Each connections has it's own exchange and a temporary direct queue, RAM 
>> usage is about 2-3GB on each node and CPU usage peaks at about 200% (which 
>> on 4 cores isn't all that bad). At first all is quite well and the cluster 
>> manages upwards of 1k msgs/second (I haven't tried more, pretty sure it 
>> would handle it). However, after scaling to that many connections, the 
>> cluster seems to grind to a halt and eventually nodes become unresponsive. 
>> The management API takes upwards of 5 (FIVE!) minutes to retrieve a server 
>> summary report. Am I missing something here? Or is this just a bad idea 
>> altogether? I was expecting that if each node was able to handle 30k+ 
>> connections, I could have a cluster of 50 or so (with multiple balancers, 
>> of course!) and live a happy life  ;-)
>>
>> Thanks,
>> Roman
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/898d7808/attachment.htm>

From simlu at su.se  Thu Feb 21 13:40:43 2013
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Thu, 21 Feb 2013 14:40:43 +0100
Subject: [rabbitmq-discuss] Creating an auth plugin (Kerberos)
In-Reply-To: <5124F224.1090903@rabbitmq.com>
References: <20121212093115.GH754@kaka.it.su.se>
	<8D205910-A3E3-472D-A7AA-8D5737812DC4@rabbitmq.com>
	<20121221093949.GA14329@kaka.it.su.se>
	<53443B9F-8877-4993-9732-35F417AE04F0@rabbitmq.com>
	<05223E0E-9BBE-4842-AC20-DBEB330791BD@rabbitmq.com>
	<20130130123105.GO407@kaka.it.su.se>
	<B5A8398F-1ADD-407D-B3CD-38E60313BC4C@rabbitmq.com>
	<20130213074055.GC616@kaka.it.su.se>
	<20130215141243.GB2924@kaka.it.su.se>
	<5124F224.1090903@rabbitmq.com>
Message-ID: <20130221134043.GK2924@kaka.it.su.se>

On Wed, 2013-02-20 at 15:56:20 +0000, Matthias Radestock wrote:
> That's because you are setting tags = [] in https://github.com/simmel/rabbitmq-auth-backend-kerberos/blob/5eaccf20f13032f35b4d81c74ec2af24f9a4c974/src/rabbit_auth_backend_kerberos.erl#L28
> 
> You'll probably want to invoke
> rabbit_auth_backend_internal:lookup_user(Username) and extract the
> tags from the result.

Of course! I have a vague memory of Tim, Simon or you suggesting that
earlier but I can't find that mail.

Now I'm just going to iron out a few other things but then it's time to
release the plugin.

Thank you so much!
- Simon

From alexis at rabbitmq.com  Thu Feb 21 14:01:43 2013
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 21 Feb 2013 14:01:43 +0000
Subject: [rabbitmq-discuss] RabbitMQ cluster with potentially millions
	of connections
In-Reply-To: <b087b92a-22a1-48e4-a850-3c746b921833@googlegroups.com>
References: <f75213a1-1571-415b-a5ba-e84c0d6bd0c9@googlegroups.com>
	<59b8eb8a-8b8f-48d2-ac22-acb7399b1ead@googlegroups.com>
	<b087b92a-22a1-48e4-a850-3c746b921833@googlegroups.com>
Message-ID: <CACOPnvdy+K5df7FPF1cahyiXM4pWuknv5QX+AuFKOffnFhRGpw@mail.gmail.com>

"Any slow consumer issues will not come up as it does not access disc
for persistence"

How on earth does that make sense?  Slow consumer issues arise when
production rates exceed consumption rates.  Not accessing a disk means
that you are memory limited, which is the primary cause of slow
consumer failures.

If you are going to post advertisements for commercial products,
please be accurate, and please quote all prices for hardware or
software.

Thanks

alexis


On Thu, Feb 21, 2013 at 12:28 PM,  <oxxyyd at hotmail.com> wrote:
> Hi there,
>
> If you need performance and scale: One single solace appliance can handle
> 200k concurrent connections for web streaming /box and do 230k fully
> guaranteed messages s or 11m reliable messages/s.  Any slow consumer issues
> will not come up as it does not access disc for persistence  You can monitor
> the FPG card without impacting the performance.
> Not sure if it will fit into your architecture thought...
>
> Cheers,
> D
>
> Am Dienstag, 29. Januar 2013 21:12:38 UTC+1 schrieb Sandy:
>>
>> To RabbitMQ gurus - Could you please post the replies here instead of just
>> replying to the original person (Roman in this case). This is something of
>> interest to me as well and I would like to follow this thread. Thx!
>>
>> On Saturday, January 26, 2013 6:58:36 AM UTC-5, Romanas S. wrote:
>>>
>>> Hi guys,
>>>  I'm trying to come up with an architecture for a RabbitMQ cluster that
>>> could potentially handle millions of (persistent) connections. I've set up a
>>> cluster of Rabbits with 3 nodes (16GB RAM, 4x cpu cores each) and a Load
>>> Balancer in front of them, increased all of the system limits on sockets and
>>> file descriptors, but can't seem to scale to more then 30k connections on
>>> the entire cluster.
>>>
>>> Each connections has it's own exchange and a temporary direct queue, RAM
>>> usage is about 2-3GB on each node and CPU usage peaks at about 200% (which
>>> on 4 cores isn't all that bad). At first all is quite well and the cluster
>>> manages upwards of 1k msgs/second (I haven't tried more, pretty sure it
>>> would handle it). However, after scaling to that many connections, the
>>> cluster seems to grind to a halt and eventually nodes become unresponsive.
>>> The management API takes upwards of 5 (FIVE!) minutes to retrieve a server
>>> summary report. Am I missing something here? Or is this just a bad idea
>>> altogether? I was expecting that if each node was able to handle 30k+
>>> connections, I could have a cluster of 50 or so (with multiple balancers, of
>>> course!) and live a happy life  ;-)
>>>
>>> Thanks,
>>> Roman
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Thu Feb 21 14:41:39 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 21 Feb 2013 14:41:39 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB15013E06A517@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C4FEB@hq-ex-mb03.ad.navteq.com>,
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>, <511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navt!
	eq.com>, <5125579B.7060707@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A517@hq-ex-mb03.ad.navteq.com>
Message-ID: <51263223.6090002@rabbitmq.com>

Peter,

On 21/02/13 14:27, Konar Peter (Nokia-LC/Chicago) wrote:
> Matthias, We upgraded erlang on the rabbits and had another
> occurrence. 08:00 shows the frozen state and 08:05 shows the state
> after :
>
> - Next time the issue occurs, please run rabbitmqctl
> set_vm_memory_high_watermark 0.0001 followed by rabbitmqctl
> set_vm_memory_high_watermark 0.4
>
>
> Connections look like they are working fine after the commands.

That is inconclusive, unfortunately, since the connection that was 
blocked at 08:00 - 10.196.42.128:59179 - doesn't show up in the second 
report. Please check the logs to see when that connection was closed and 
why.

Btw, you can drop the Java stack traces from the reports; I've seen 
quite enough of them now ;)

Matthias.

From ratner2 at gmail.com  Thu Feb 21 15:10:17 2013
From: ratner2 at gmail.com (bratner bratner)
Date: Thu, 21 Feb 2013 17:10:17 +0200
Subject: [rabbitmq-discuss] Very slow get (dequeue) on node B if shovel
 on node A is configured with {ack_mode, on_confirm}
In-Reply-To: <511BB6D3.9080205@rabbitmq.com>
References: <CAHA3fyVQjorpxtqyMY-kNow83hCYHKkuGstRmq5d8Rg7FJATXw@mail.gmail.com>
	<511BB6D3.9080205@rabbitmq.com>
Message-ID: <CAHA3fyWVD_hRUmMbQCORi8+ru1_dg2WWYC5S-LyqaCP0O_oUDw@mail.gmail.com>

Hi!

Sorry for the long delay. I did some more tests and found a way to speed
things up.
After changing {ack_mode, on_confirm} to {ack_mode, on_publish} things
started to work well.
Which means that the speed of reading the messages from the queue NodeB was
the speed they
were published to the queue on NodeA.

Before this change (when 'on_confirm' was set) messages where piling up in
the queue on NodeB.
So if i published 100 messages per sec into a queue on nodeA, the queue on
nodeB would receive all of those and the queue on nodeA would be empty (as
it should). But the PHP script on nodeB (below) would read something like
3-8 messages per sec and the rest (92-97 messages per sec) would keep
piling up in the queue on nodeB.
That is until i completely stopped writing new messages to the queue on
nodeA. Then this script will read messages like crazy until the queue on
nodeB was completely empty.

So I left with a couple of questions. What is causing the write and the
read to be so uneven with 'on_confirm' given that there no real resources
problem? Is this a bug or a feature?
How much reliability do I lose if i use 'on_publish' ? Is there a chance
messages can just disappear with 'on_publish' ?

Here is the outline of my php test reader, very simple:

<?php
$connection = new AMQPConnection();
$connection->setLogin("<login_nodeb>");
$connection->setPassword("<password_nodeb");
$connection->setVhost("vhostB");
$connection->connect();

if (!$connection->isConnected()) {
    die('Not connected :('. PHP_EOL);
}
$channel    = new AMQPChannel($connection);
$queue      = new AMQPQueue($channel);
$queue->setName('queueB');

while(true) {
        while($queue->get(AMQP_AUTOACK)) {
           /* do stuff here, count messages, run mps stats etc... */
        }
        /* sleep some not to eat the whole cpu */
        sleep(1);
}


Thanks,
Boris

On Wed, Feb 13, 2013 at 5:52 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> That sounds very wrong.
>
> Which version of RabbitMQ are you using? Can you post (a cut down version
> of) your PHP script somewhere? (I have no familiarity with the PHP client
> but I'd like to see what it's doing...)
>
> Cheers, Simon
>
>
> On 13/02/13 14:33, bratner bratner wrote:
>
>> Hi!
>>
>> My setup includes a rabbitmq-c application that publishes messages on
>> node A.
>> The publishing rate is about 200mps, each message can be up to 10Kb.
>>
>> Shovel (node A) is configured to move them to node B.
>> On node B i'm dequeuing the messages with a PHP test script with
>> $queue->get(AMQP_AUTOACK).
>> If i keep the publishing rate at 200mps then i can see that the queue on
>> node A is empty and the Q on node B is
>> filling up. The read-rate of my test script is really low.
>>
>> If i stop the publishing, 3-5 seconds later, my test script starts
>> reading like crazy until the queue on node B is empty.
>>
>> Even If I slow down the publishing rate to 5mps , same is happening ,
>> messages are piling up on node B until i dial down the pressure.
>>
>> This problem disappears if I set ack_mode to on_publish or no_ack. In
>> this case the reader script reads with the publishing speed.
>>
>> My configuration :
>>
>>
>>
>> [
>> {rabbit, [
>> {log_levels, [{connection, error}]}
>> ]},
>> {rabbitmq_shovel,
>> [ {shovels, [ {messagemover, [
>> {sources, [
>> {broker, "amqp://usera:pass at localhost/**vhosta
>> <amqp://cdrposter:4VkI6MKH@**localhost/sipout>"},
>>
>> {declarations, [
>> {'exchange.declare',[{**exchange, <<"my-fanout">>},{type,
>> <<"fanout">>},durable]},
>> {'queue.declare',[{queue,<<"**messages">>},durable]},
>> {'queue.bind',[{exchange, <<"my-fanout">>},{queue, <<"messages">>}]}
>> ]}
>> ]},
>> {destinations, [
>> {brokers, [ "amqp://userb:pass at nodeB/**vhostb
>> <amqp://cdr_manager:Ci2XOb3b@**10.200.10.218/cdrs<http://cdr_manager:Ci2XOb3b at 10.200.10.218/cdrs>>"
>> ]},
>>
>> {declarations, [
>> {'exchange.declare',[{**exchange, <<"my-fanout">>},{type,
>> <<"fanout">>},durable]},
>> {'queue.declare',[{queue,<<"**messages">>},durable]},
>> {'queue.bind',[{exchange, <<"my-fanout">>},{queue, <<"messages">>}]}
>> ]}
>> ]},
>> {queue, <<"messages">>},
>> {prefetch_count, 200},
>> {ack_mode, on_confirm},
>> {publish_properties, [{delivery_mode, 2}]},
>> {reconnect_delay, 5}
>> ]}
>> ]}
>> ]}
>> ].
>>
>>
>> Thank you,
>> Boris.
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/953bac01/attachment.htm>

From matthias at rabbitmq.com  Thu Feb 21 15:21:58 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 21 Feb 2013 15:21:58 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB15013E06A518@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>, <511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navt!
	eq.com>, <5125579B.7060707@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A517@hq-ex-mb03.ad.navteq.com>,
	<51263223.6090002@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A518@hq-ex-mb03.ad.navteq.com>
Message-ID: <51263B96.8050507@rabbitmq.com>

(re-sending since the m/l had dropped off the 'cc')

Peter,

On 21/02/13 14:55, Konar Peter (Nokia-LC/Chicago) wrote:
> from the log:
>
> =ERROR REPORT==== 21-Feb-2013::14:01:02 ===
> closing AMQP connection <0.23035.17> (10.196.42.128:59179 -> 10.196.42.21:5672):
> {heartbeat_timeout,running}
>
> =INFO REPORT==== 21-Feb-2013::14:01:02 ===
> accepting AMQP connection <0.23611.34> (10.196.42.128:41413 -> 10.196.42.21:5672)
>
> =INFO REPORT==== 21-Feb-2013::14:06:28 ===
> Memory limit set to 1MB of 15949MB total.
>
> =INFO REPORT==== 21-Feb-2013::14:06:28 ===
> vm_memory_high_watermark set. Memory used:141211416 allowed:1672474
>
> =WARNING REPORT==== 21-Feb-2013::14:06:28 ===
> memory resource limit alarm set on node rabbit at ajtrafp063
>
> =INFO REPORT==== 21-Feb-2013::14:06:38 ===
> Memory limit set to 6379MB of 15949MB total.
>
> =INFO REPORT==== 21-Feb-2013::14:06:38 ===
> vm_memory_high_watermark clear. Memory used:129010184 allowed:6689898496
>
> =WARNING REPORT==== 21-Feb-2013::14:06:38 ===
> memory resource limit alarm cleared on node rabbit at ajtrafp063

Looks like you got there too late - the connection timed out before the 
'rabbitmqctl set_vm_memory_high_watermark ...' commands.

Hopefully you'll catch it early enough next time.

Also, before you run the pair of 'rabbitmqctl 
set_vm_memory_high_watermark ...' commands, do the following:

1) determine the pid of the connection that is blocked by running
   rabbitmqctl -q list_connections pid peer_port | grep <port>
where <port> is the peer port shown in the netstat output, e.g. 59179 in 
the case we've just looked at.

2) plug the pid, which looks something like <rabbit at host.1.289.0>, into
   rabbitmqctl eval '{backtrace, B} = 
process_info(rabbit_misc:string_to_pid("<rabbit at host.1.289.0>"), 
backtrace), io:format("~s", [binary_to_list(B)]).'
(all on one line) and post the output. NB: If you are in a cluster, you 
need to run this on the rabbit server identified by the host portion of 
the pid.


Regards,

Matthias.

From simon at rabbitmq.com  Thu Feb 21 15:57:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 21 Feb 2013 15:57:25 +0000
Subject: [rabbitmq-discuss] Very slow get (dequeue) on node B if shovel
 on node A is configured with {ack_mode, on_confirm}
In-Reply-To: <CAHA3fyWVD_hRUmMbQCORi8+ru1_dg2WWYC5S-LyqaCP0O_oUDw@mail.gmail.com>
References: <CAHA3fyVQjorpxtqyMY-kNow83hCYHKkuGstRmq5d8Rg7FJATXw@mail.gmail.com>
	<511BB6D3.9080205@rabbitmq.com>
	<CAHA3fyWVD_hRUmMbQCORi8+ru1_dg2WWYC5S-LyqaCP0O_oUDw@mail.gmail.com>
Message-ID: <512643E5.8050809@rabbitmq.com>

Hi. If the shovel is on node A then {ack_mode, on_publish} is not 
particularly safe - if the network connection goes down then you will 
lose messages that were on the wire.

If the shovel were to be running on node B then {ack_mode, on_publish} 
would be safer, as it would tolerate network failures (but not a crash 
at node B).

on_confirm would still be better. Of course, since you're consuming in 
autoack mode in the php script you can lose messages there anyway...

You didn't say which version of RabbitMQ you were running. The script 
seems perfectly reasonable (I assume that you are not doing anything 
AMQPish in the part elided by "/* do stuff here, count messages, run mps 
stats etc... */").

So it's a bit of a puzzle. If confirms + persistence are so much slower 
than persistence alone, then I wonder if somehow you have a machine that 
fsyncs very slowly, since that's the primary difference in what node B 
will be doing.

Cheers, Simon


On 21/02/13 15:10, bratner bratner wrote:
> Hi!
>
> Sorry for the long delay. I did some more tests and found a way to speed
> things up.
> After changing {ack_mode, on_confirm} to {ack_mode, on_publish} things
> started to work well.
> Which means that the speed of reading the messages from the queue NodeB
> was the speed they
> were published to the queue on NodeA.
>
> Before this change (when 'on_confirm' was set) messages where piling up
> in the queue on NodeB.
> So if i published 100 messages per sec into a queue on nodeA, the queue
> on nodeB would receive all of those and the queue on nodeA would be
> empty (as it should). But the PHP script on nodeB (below) would read
> something like 3-8 messages per sec and the rest (92-97 messages per
> sec) would keep piling up in the queue on nodeB.
> That is until i completely stopped writing new messages to the queue on
> nodeA. Then this script will read messages like crazy until the queue on
> nodeB was completely empty.
>
> So I left with a couple of questions. What is causing the write and the
> read to be so uneven with 'on_confirm' given that there no real
> resources problem? Is this a bug or a feature?
> How much reliability do I lose if i use 'on_publish' ? Is there a chance
> messages can just disappear with 'on_publish' ?
>
> Here is the outline of my php test reader, very simple:
>
> <?php
> $connection = new AMQPConnection();
> $connection->setLogin("<login_nodeb>");
> $connection->setPassword("<password_nodeb");
> $connection->setVhost("vhostB");
> $connection->connect();
>
> if (!$connection->isConnected()) {
>      die('Not connected :('. PHP_EOL);
> }
> $channel    = new AMQPChannel($connection);
> $queue      = new AMQPQueue($channel);
> $queue->setName('queueB');
>
> while(true) {
>          while($queue->get(AMQP_AUTOACK)) {
>             /* do stuff here, count messages, run mps stats etc... */
>          }
>          /* sleep some not to eat the whole cpu */
>          sleep(1);
> }
>
>
> Thanks,
> Boris
>
> On Wed, Feb 13, 2013 at 5:52 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     That sounds very wrong.
>
>     Which version of RabbitMQ are you using? Can you post (a cut down
>     version of) your PHP script somewhere? (I have no familiarity with
>     the PHP client but I'd like to see what it's doing...)
>
>     Cheers, Simon
>
>
>     On 13/02/13 14:33, bratner bratner wrote:
>
>         Hi!
>
>         My setup includes a rabbitmq-c application that publishes
>         messages on
>         node A.
>         The publishing rate is about 200mps, each message can be up to 10Kb.
>
>         Shovel (node A) is configured to move them to node B.
>         On node B i'm dequeuing the messages with a PHP test script with
>         $queue->get(AMQP_AUTOACK).
>         If i keep the publishing rate at 200mps then i can see that the
>         queue on
>         node A is empty and the Q on node B is
>         filling up. The read-rate of my test script is really low.
>
>         If i stop the publishing, 3-5 seconds later, my test script starts
>         reading like crazy until the queue on node B is empty.
>
>         Even If I slow down the publishing rate to 5mps , same is
>         happening ,
>         messages are piling up on node B until i dial down the pressure.
>
>         This problem disappears if I set ack_mode to on_publish or
>         no_ack. In
>         this case the reader script reads with the publishing speed.
>
>         My configuration :
>
>
>
>         [
>         {rabbit, [
>         {log_levels, [{connection, error}]}
>         ]},
>         {rabbitmq_shovel,
>         [ {shovels, [ {messagemover, [
>         {sources, [
>         {broker, "amqp://usera:pass at localhost/__vhosta
>         <amqp://cdrposter:4VkI6MKH at __localhost/sipout>"},
>
>         {declarations, [
>         {'exchange.declare',[{__exchange, <<"my-fanout">>},{type,
>         <<"fanout">>},durable]},
>         {'queue.declare',[{queue,<<"__messages">>},durable]},
>         {'queue.bind',[{exchange, <<"my-fanout">>},{queue, <<"messages">>}]}
>         ]}
>         ]},
>         {destinations, [
>         {brokers, [ "amqp://userb:pass at nodeB/__vhostb
>         <amqp://cdr_manager:Ci2XOb3b at __10.200.10.218/cdrs
>         <http://cdr_manager:Ci2XOb3b at 10.200.10.218/cdrs>>" ]},
>
>         {declarations, [
>         {'exchange.declare',[{__exchange, <<"my-fanout">>},{type,
>         <<"fanout">>},durable]},
>         {'queue.declare',[{queue,<<"__messages">>},durable]},
>         {'queue.bind',[{exchange, <<"my-fanout">>},{queue, <<"messages">>}]}
>         ]}
>         ]},
>         {queue, <<"messages">>},
>         {prefetch_count, 200},
>         {ack_mode, on_confirm},
>         {publish_properties, [{delivery_mode, 2}]},
>         {reconnect_delay, 5}
>         ]}
>         ]}
>         ]}
>         ].
>
>
>         Thank you,
>         Boris.
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Thu Feb 21 16:35:18 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 21 Feb 2013 20:35:18 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 0.9.9 is released
Message-ID: <CAE3HoVSytEyJgH=bogwUdXkRECR8TXotU7RcfrW4qFpqNYqayA@mail.gmail.com>

amqp gem 0.9.9 is released to rubygems.org [1].
This is a 100% backwards-compatible bug fix release:

 * Large [> 128K] messages with non-ASCII characters are now framed
 correctly (as of amq-protocol 1.2.0).

 * Minor efficiency improvements in basic.publish serialization code.

 * Heartbeats delivery is now paused when a network failure is detected.


1. https://rubygems.org/gems/amqp/versions/0.9.9
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/61f5be8e/attachment.htm>

From peter.konar at nokia.com  Thu Feb 21 16:25:43 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Thu, 21 Feb 2013 10:25:43 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <51263B96.8050507@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navt!
	eq.com>,<5125579B.7060707@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A517@hq-ex-mb03.ad.navteq.com>,
	<51263223.6090002@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A518@hq-ex-mb03.ad.navteq.com>,
	<51263B96.8050507@rabbitmq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB15013E06A51B@hq-ex-mb03.ad.navteq.com>

Matthias,
  Latest attempts:


[pkonar at ajtrafp063 rabbitmq]$ sudo rabbitmqctl -q list_connections pid peer_port | grep 55413
<rabbit at ajtrafp063.1.426.0>     55413
[pkonar at ajtrafp063 rabbitmq]$ sudo rabbitmqctl eval '{backtrace, B} = process_info(rabbit_misc:string_to_pid("<rabbit at ajtrafp063.1.426.0>"),backtrace), io:format("~s", [binary_to_list(B)]).'
Program counter: 0x00007f92ba5036d8 (rabbit_net:recv/2 + 136)
CP: 0x0000000000000000 (invalid)
arity = 0

0x00007f92bb36dd00 Return addr 0x00007f92ba37e6d0 (rabbit_reader:mainloop/2 + 248)
y(0)     #Port<0.15076>
y(1)     tcp_error
y(2)     tcp_closed
y(3)     tcp

0x00007f92bb36dd28 Return addr 0x00007f92ba37dca8 (rabbit_reader:start_connection/7 + 1216)
y(0)     {v1,<0.423.0>,#Port<0.15076>,<<40 bytes>>,{connection,rabbit_framing_amqp_0_9_1,{user,<<5 bytes>>,[administrator],rabbit_auth_backend_internal,{internal_user,<<5 bytes>>,<<20 bytes>>,[administrator]}},600,131072,<<1 byte>>,[{<<7 bytes>>,longstr,<<8 bytes>>},{<<11 bytes>>,longstr,<<52 bytes>>},{<<8 bytes>>,longstr,<<4 bytes>>},{<<12 bytes>>,table,[{<<26 bytes>>,bool,true},{<<22 bytes>>,bool,true},{<<10 bytes>>,bool,true},{<<18 bytes>>,bool,true}]},{<<9 bytes>>,longstr,<<36 bytes>>},{<<7 bytes>>,longstr,<<5 bytes>>}],[{<<26 bytes>>,bool,true},{<<22 bytes>>,bool,true},{<<10 bytes>>,bool,true},{<<18 bytes>>,bool,true}]},frame_header,7,false,running,<0.424.0>,{<0.435.0>,<0.436.0>},{state,fine,5000,undefined},<0.425.0>,#Fun<rabbit_heartbeat.2.69784259>,[<<12721 bytes>>],12721,rabbit_auth_mechanism_plain,[],false,flow,{1361,463360,568639},{0,0,0,0,0,65535,2756,10773},{0,0,0,0,0,65535,2756,10932},5672,55413}
y(1)     []
y(2)     12721
y(3)     [<<12721 bytes>>]

0x00007f92bb36dd50 Return addr 0x00007f92c0a7da80 (proc_lib:init_p_do_apply/3 + 56)
y(0)     []
y(1)     []
y(2)     []
y(3)     "10.196.42.180:55413 -> 10.196.42.21:5672"
y(4)     #Port<0.15076>
y(5)     []
y(6)     []
y(7)     []
y(8)     []
y(9)     Catch 0x00007f92ba37dd28 (rabbit_reader:start_connection/7 + 1344)
y(10)    Catch 0x00007f92ba37df10 (rabbit_reader:start_connection/7 + 1832)

0x00007f92bb36ddb0 Return addr 0x00000000008827d8 (<terminate process normally>)
y(0)     Catch 0x00007f92c0a7daa0 (proc_lib:init_p_do_apply/3 + 88)
ok
...done.

Rabbit log:

=INFO REPORT==== 21-Feb-2013::16:04:48 ===
rabbit on node rabbit at ajtrafp064 up

=INFO REPORT==== 21-Feb-2013::16:05:00 ===
accepting AMQP connection <0.418.0> (10.196.42.128:43956 -> 10.196.42.21:5672)

=INFO REPORT==== 21-Feb-2013::16:05:00 ===
accepting AMQP connection <0.422.0> (10.196.42.182:52126 -> 10.196.42.21:5672)

=INFO REPORT==== 21-Feb-2013::16:05:00 ===
accepting AMQP connection <0.426.0> (10.196.42.180:55413 -> 10.196.42.21:5672)

=INFO REPORT==== 21-Feb-2013::16:05:00 ===
accepting AMQP connection <0.430.0> (10.196.42.179:43090 -> 10.196.42.21:5672)

=INFO REPORT==== 21-Feb-2013::16:28:12 ===
Memory limit set to 1MB of 15949MB total.

=INFO REPORT==== 21-Feb-2013::16:28:12 ===
vm_memory_high_watermark set. Memory used:110411552 allowed:1672474

=WARNING REPORT==== 21-Feb-2013::16:28:12 ===
memory resource limit alarm set on node rabbit at ajtrafp063

=INFO REPORT==== 21-Feb-2013::16:28:12 ===
Memory limit set to 6379MB of 15949MB total.

=INFO REPORT==== 21-Feb-2013::16:28:12 ===
vm_memory_high_watermark clear. Memory used:106433744 allowed:6689898496

=WARNING REPORT==== 21-Feb-2013::16:28:12 ===
memory resource limit alarm cleared on node rabbit at ajtrafp063


Thanks
Peter Konar
________________________________________
From: ext Matthias Radestock [matthias at rabbitmq.com]
Sent: Thursday, February 21, 2013 9:21 AM
To: Konar Peter (Nokia-LC/Chicago)
Cc: Carroll James (Nokia-LC/Malvern); Hancock Craig (Nokia-LC/Chicago); Venus Justin (Nokia-LC/Chicago); Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago); rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

(re-sending since the m/l had dropped off the 'cc')

Peter,

On 21/02/13 14:55, Konar Peter (Nokia-LC/Chicago) wrote:
> from the log:
>
> =ERROR REPORT==== 21-Feb-2013::14:01:02 ===
> closing AMQP connection <0.23035.17> (10.196.42.128:59179 -> 10.196.42.21:5672):
> {heartbeat_timeout,running}
>
> =INFO REPORT==== 21-Feb-2013::14:01:02 ===
> accepting AMQP connection <0.23611.34> (10.196.42.128:41413 -> 10.196.42.21:5672)
>
> =INFO REPORT==== 21-Feb-2013::14:06:28 ===
> Memory limit set to 1MB of 15949MB total.
>
> =INFO REPORT==== 21-Feb-2013::14:06:28 ===
> vm_memory_high_watermark set. Memory used:141211416 allowed:1672474
>
> =WARNING REPORT==== 21-Feb-2013::14:06:28 ===
> memory resource limit alarm set on node rabbit at ajtrafp063
>
> =INFO REPORT==== 21-Feb-2013::14:06:38 ===
> Memory limit set to 6379MB of 15949MB total.
>
> =INFO REPORT==== 21-Feb-2013::14:06:38 ===
> vm_memory_high_watermark clear. Memory used:129010184 allowed:6689898496
>
> =WARNING REPORT==== 21-Feb-2013::14:06:38 ===
> memory resource limit alarm cleared on node rabbit at ajtrafp063

Looks like you got there too late - the connection timed out before the
'rabbitmqctl set_vm_memory_high_watermark ...' commands.

Hopefully you'll catch it early enough next time.

Also, before you run the pair of 'rabbitmqctl
set_vm_memory_high_watermark ...' commands, do the following:

1) determine the pid of the connection that is blocked by running
   rabbitmqctl -q list_connections pid peer_port | grep <port>
where <port> is the peer port shown in the netstat output, e.g. 59179 in
the case we've just looked at.

2) plug the pid, which looks something like <rabbit at host.1.289.0>, into
   rabbitmqctl eval '{backtrace, B} =
process_info(rabbit_misc:string_to_pid("<rabbit at host.1.289.0>"),
backtrace), io:format("~s", [binary_to_list(B)]).'
(all on one line) and post the output. NB: If you are in a cluster, you
need to run this on the rabbit server identified by the host portion of
the pid.


Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: report.pt.10:20
Type: application/octet-stream
Size: 42050 bytes
Desc: report.pt.10:20
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/bee3414b/attachment.obj>

From peter.konar at nokia.com  Thu Feb 21 17:24:03 2013
From: peter.konar at nokia.com (Konar Peter (Nokia-LC/Chicago))
Date: Thu, 21 Feb 2013 11:24:03 -0600
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <51263B96.8050507@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<51196998.8080103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627970@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navt!
	eq.com>,<5125579B.7060707@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A517@hq-ex-mb03.ad.navteq.com>,
	<51263223.6090002@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A518@hq-ex-mb03.ad.navteq.com>,
	<51263B96.8050507@rabbitmq.com>
Message-ID: <0C5C3C8F51B90E4596BB1263843DEB15013E06A51C@hq-ex-mb03.ad.navteq.com>

In talking with Daniel, he wants to inform you that the nature of the traffic is burst of 78K messages across 4 nodes on the minute mark to a single rabbit.

One more trace:
[pkonar at ajtrafp063 rabbitmq]$ sudo rabbitmqctl -q list_connections pid peer_port | grep 52126
<rabbit at ajtrafp063.1.422.0>     52126
[pkonar at ajtrafp063 rabbitmq]$ sudo rabbitmqctl eval '{backtrace, B} =process_info(rabbit_misc:string_to_pid("<rabbit at ajtrafp063.1.422.0>"),backtrace), io:format("~s", [binary_to_list(B)]).'
Program counter: 0x00007f92ba5036d8 (rabbit_net:recv/2 + 136)
CP: 0x0000000000000000 (invalid)
arity = 0

0x00007f92c2040608 Return addr 0x00007f92ba37e6d0 (rabbit_reader:mainloop/2 + 248)
y(0)     #Port<0.15075>
y(1)     tcp_error
y(2)     tcp_closed
y(3)     tcp

0x00007f92c2040630 Return addr 0x00007f92ba37dca8 (rabbit_reader:start_connection/7 + 1216)
y(0)     {v1,<0.419.0>,#Port<0.15075>,<<40 bytes>>,{connection,rabbit_framing_amqp_0_9_1,{user,<<5 bytes>>,[administrator],rabbit_auth_backend_internal,{internal_user,<<5 bytes>>,<<20 bytes>>,[administrator]}},600,131072,<<1 byte>>,[{<<7 bytes>>,longstr,<<8 bytes>>},{<<11 bytes>>,longstr,<<52 bytes>>},{<<8 bytes>>,longstr,<<4 bytes>>},{<<12 bytes>>,table,[{<<26 bytes>>,bool,true},{<<22 bytes>>,bool,true},{<<10 bytes>>,bool,true},{<<18 bytes>>,bool,true}]},{<<9 bytes>>,longstr,<<36 bytes>>},{<<7 bytes>>,longstr,<<5 bytes>>}],[{<<26 bytes>>,bool,true},{<<22 bytes>>,bool,true},{<<10 bytes>>,bool,true},{<<18 bytes>>,bool,true}]},frame_header,7,false,running,<0.420.0>,{<0.433.0>,<0.434.0>},{state,fine,5000,undefined},<0.421.0>,#Fun<rabbit_heartbeat.2.69784259>,[<<4458 bytes>>],4458,rabbit_auth_mechanism_plain,[],false,flow,{1361,466181,586431},{0,0,0,0,0,65535,2756,10773},{0,0,0,0,0,65535,2756,10934},5672,52126}
y(1)     []
y(2)     4458
y(3)     [<<4458 bytes>>]

0x00007f92c2040658 Return addr 0x00007f92c0a7da80 (proc_lib:init_p_do_apply/3 + 56)
y(0)     []
y(1)     []
y(2)     []
y(3)     "10.196.42.182:52126 -> 10.196.42.21:5672"
y(4)     #Port<0.15075>
y(5)     []
y(6)     []
y(7)     []
y(8)     []
y(9)     Catch 0x00007f92ba37dd28 (rabbit_reader:start_connection/7 + 1344)
y(10)    Catch 0x00007f92ba37df10 (rabbit_reader:start_connection/7 + 1832)

0x00007f92c20406b8 Return addr 0x00000000008827d8 (<terminate process normally>)
y(0)     Catch 0x00007f92c0a7daa0 (proc_lib:init_p_do_apply/3 + 88)
ok
...done.


Thanks
Peter Konar

________________________________________
From: ext Matthias Radestock [matthias at rabbitmq.com]
Sent: Thursday, February 21, 2013 9:21 AM
To: Konar Peter (Nokia-LC/Chicago)
Cc: Carroll James (Nokia-LC/Malvern); Hancock Craig (Nokia-LC/Chicago); Venus Justin (Nokia-LC/Chicago); Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago); rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

(re-sending since the m/l had dropped off the 'cc')

Peter,

On 21/02/13 14:55, Konar Peter (Nokia-LC/Chicago) wrote:
> from the log:
>
> =ERROR REPORT==== 21-Feb-2013::14:01:02 ===
> closing AMQP connection <0.23035.17> (10.196.42.128:59179 -> 10.196.42.21:5672):
> {heartbeat_timeout,running}
>
> =INFO REPORT==== 21-Feb-2013::14:01:02 ===
> accepting AMQP connection <0.23611.34> (10.196.42.128:41413 -> 10.196.42.21:5672)
>
> =INFO REPORT==== 21-Feb-2013::14:06:28 ===
> Memory limit set to 1MB of 15949MB total.
>
> =INFO REPORT==== 21-Feb-2013::14:06:28 ===
> vm_memory_high_watermark set. Memory used:141211416 allowed:1672474
>
> =WARNING REPORT==== 21-Feb-2013::14:06:28 ===
> memory resource limit alarm set on node rabbit at ajtrafp063
>
> =INFO REPORT==== 21-Feb-2013::14:06:38 ===
> Memory limit set to 6379MB of 15949MB total.
>
> =INFO REPORT==== 21-Feb-2013::14:06:38 ===
> vm_memory_high_watermark clear. Memory used:129010184 allowed:6689898496
>
> =WARNING REPORT==== 21-Feb-2013::14:06:38 ===
> memory resource limit alarm cleared on node rabbit at ajtrafp063

Looks like you got there too late - the connection timed out before the
'rabbitmqctl set_vm_memory_high_watermark ...' commands.

Hopefully you'll catch it early enough next time.

Also, before you run the pair of 'rabbitmqctl
set_vm_memory_high_watermark ...' commands, do the following:

1) determine the pid of the connection that is blocked by running
   rabbitmqctl -q list_connections pid peer_port | grep <port>
where <port> is the peer port shown in the netstat output, e.g. 59179 in
the case we've just looked at.

2) plug the pid, which looks something like <rabbit at host.1.289.0>, into
   rabbitmqctl eval '{backtrace, B} =
process_info(rabbit_misc:string_to_pid("<rabbit at host.1.289.0>"),
backtrace), io:format("~s", [binary_to_list(B)]).'
(all on one line) and post the output. NB: If you are in a cluster, you
need to run this on the rabbit server identified by the host portion of
the pid.


Regards,

Matthias.

The information contained in this communication may be CONFIDENTIAL and is intended only for the use of the recipient(s) named above.  If you are not the intended recipient, you are hereby notified that any dissemination, distribution, or copying of this communication, or any of its contents, is strictly prohibited.  If you have received this communication in error, please notify the sender and delete/destroy the original message and any copy of it from your computer or paper files.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: report.pt.11:10
Type: application/octet-stream
Size: 42955 bytes
Desc: report.pt.11:10
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/1ab9a2e1/attachment.obj>

From matthias at rabbitmq.com  Thu Feb 21 17:26:29 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 21 Feb 2013 17:26:29 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <0C5C3C8F51B90E4596BB1263843DEB15013E06A51B@hq-ex-mb03.ad.navteq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>, <511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navt!
	eq.com>, <5125579B.7060707@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A517@hq-ex-mb03.ad.navteq.com>,
	<51263223.6090002@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A518@hq-ex-mb03.ad.navteq.com>,
	<51263B96.8050507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A51B@hq-ex-mb03.ad.navteq.com>
Message-ID: <512658C5.3060206@rabbitmq.com>

Peter,

On 21/02/13 16:25, Konar Peter (Nokia-LC/Chicago) wrote:
>    Latest attempts:

Excellent. Exactly what I wanted to see. Or rather not. It does look 
like rabbit has forgotten to read from the connection :(

Did the connection resume work after the vm_memory_high_watermark toggling?

After staring at the code for a couple of days I have identified and 
fixed one scenarios in which a connection could end up in the state you 
are seeing. It happens only after an illegal sequence of channel.close 
followed by basic.publish on the same channel, and only during a very 
narrow window in conjunction with flow control. So I doubt this is the 
cause, but it would still be worth giving that fix a try, just to rule 
out that scenario. I will send you a patch by private email.

Regards,

Matthias.

From dbuchko at vmware.com  Thu Feb 21 17:36:17 2013
From: dbuchko at vmware.com (Daniel Buchko)
Date: Thu, 21 Feb 2013 09:36:17 -0800
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <512658C5.3060206@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navt!
	eq.com>,<5125579B.7060707@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A517@hq-ex-mb03.ad.navteq.com>,
	<51263223.6090002@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A518@hq-ex-mb03.ad.navteq.com>,
	<51263B96.8050507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A51B@hq-ex-mb03.ad.navteq.com>
	<512658C5.3060206@rabbitmq.com>
Message-ID: <201563F6B444B14C89BEA66003DD4014143915CB42@exch-mbx-113.vmware.com>

Hi Matthias,

Yes, the connection did resume after toggling the vm_memory_high_watermark.

Since the messages are sent in a burst and I can see the connection going into flow-control, I think it might be possible we are hitting the edge case you described.  We are using Spring-AMQP to perform the publishing.

Dan


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Thursday, February 21, 2013 12:26 PM
To: Konar Peter (Nokia-LC/Chicago)
Cc: Daniel Buchko; Carroll James (Nokia-LC/Malvern); Hancock Craig (Nokia-LC/Chicago); Venus Justin (Nokia-LC/Chicago); Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago); rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 21/02/13 16:25, Konar Peter (Nokia-LC/Chicago) wrote:
>    Latest attempts:

Excellent. Exactly what I wanted to see. Or rather not. It does look like rabbit has forgotten to read from the connection :(

Did the connection resume work after the vm_memory_high_watermark toggling?

After staring at the code for a couple of days I have identified and fixed one scenarios in which a connection could end up in the state you are seeing. It happens only after an illegal sequence of channel.close followed by basic.publish on the same channel, and only during a very narrow window in conjunction with flow control. So I doubt this is the cause, but it would still be worth giving that fix a try, just to rule out that scenario. I will send you a patch by private email.

Regards,

Matthias.

From ratner2 at gmail.com  Thu Feb 21 17:40:33 2013
From: ratner2 at gmail.com (bratner bratner)
Date: Thu, 21 Feb 2013 19:40:33 +0200
Subject: [rabbitmq-discuss] [SOLVED] Very slow get (dequeue) on node B
 if shovel on node A is configured with {ack_mode, on_confirm}
In-Reply-To: <512643E5.8050809@rabbitmq.com>
References: <CAHA3fyVQjorpxtqyMY-kNow83hCYHKkuGstRmq5d8Rg7FJATXw@mail.gmail.com>
	<511BB6D3.9080205@rabbitmq.com>
	<CAHA3fyWVD_hRUmMbQCORi8+ru1_dg2WWYC5S-LyqaCP0O_oUDw@mail.gmail.com>
	<512643E5.8050809@rabbitmq.com>
Message-ID: <CAHA3fyUZ4TPjD9Lah2673wfmVK-Kf4inKCFVzC_qtrk0eoYeew@mail.gmail.com>

Hi,

Simon, as soon as you said 'fsync' i knew what the problem is. I'm testing
on KVMs with virtual disks - thus very slow fsync. Moving /var/lib/rabbitmq
to tempfs (in memory) on nodeB showed that there is no problem to speak of.
My production machines will have either real disks or LVM LVs exported to
XEN. Which means there should be
no problem.

My target design is a "star", local collectors publish to central node. The
idea is not to reconfigure the central node (NodeB in my test) every time a
new local collector is create or destroyed.

Simon, many thanks!

Boris.

On Thu, Feb 21, 2013 at 5:57 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. If the shovel is on node A then {ack_mode, on_publish} is not
> particularly safe - if the network connection goes down then you will lose
> messages that were on the wire.
>
> If the shovel were to be running on node B then {ack_mode, on_publish}
> would be safer, as it would tolerate network failures (but not a crash at
> node B).
>
> on_confirm would still be better. Of course, since you're consuming in
> autoack mode in the php script you can lose messages there anyway...
>
> You didn't say which version of RabbitMQ you were running. The script
> seems perfectly reasonable (I assume that you are not doing anything
> AMQPish in the part elided by "/* do stuff here, count messages, run mps
> stats etc... */").
>
> So it's a bit of a puzzle. If confirms + persistence are so much slower
> than persistence alone, then I wonder if somehow you have a machine that
> fsyncs very slowly, since that's the primary difference in what node B will
> be doing.
>
> Cheers, Simon
>
>
>
> On 21/02/13 15:10, bratner bratner wrote:
>
>> Hi!
>>
>> Sorry for the long delay. I did some more tests and found a way to speed
>> things up.
>> After changing {ack_mode, on_confirm} to {ack_mode, on_publish} things
>> started to work well.
>> Which means that the speed of reading the messages from the queue NodeB
>> was the speed they
>> were published to the queue on NodeA.
>>
>> Before this change (when 'on_confirm' was set) messages where piling up
>> in the queue on NodeB.
>> So if i published 100 messages per sec into a queue on nodeA, the queue
>> on nodeB would receive all of those and the queue on nodeA would be
>> empty (as it should). But the PHP script on nodeB (below) would read
>> something like 3-8 messages per sec and the rest (92-97 messages per
>> sec) would keep piling up in the queue on nodeB.
>> That is until i completely stopped writing new messages to the queue on
>> nodeA. Then this script will read messages like crazy until the queue on
>> nodeB was completely empty.
>>
>> So I left with a couple of questions. What is causing the write and the
>> read to be so uneven with 'on_confirm' given that there no real
>> resources problem? Is this a bug or a feature?
>> How much reliability do I lose if i use 'on_publish' ? Is there a chance
>> messages can just disappear with 'on_publish' ?
>>
>> Here is the outline of my php test reader, very simple:
>>
>> <?php
>> $connection = new AMQPConnection();
>> $connection->setLogin("<login_**nodeb>");
>> $connection->setPassword("<**password_nodeb");
>> $connection->setVhost("vhostB"**);
>> $connection->connect();
>>
>> if (!$connection->isConnected()) {
>>      die('Not connected :('. PHP_EOL);
>> }
>> $channel    = new AMQPChannel($connection);
>> $queue      = new AMQPQueue($channel);
>> $queue->setName('queueB');
>>
>> while(true) {
>>          while($queue->get(AMQP_**AUTOACK)) {
>>             /* do stuff here, count messages, run mps stats etc... */
>>          }
>>          /* sleep some not to eat the whole cpu */
>>          sleep(1);
>> }
>>
>>
>> Thanks,
>> Boris
>>
>> On Wed, Feb 13, 2013 at 5:52 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     That sounds very wrong.
>>
>>     Which version of RabbitMQ are you using? Can you post (a cut down
>>     version of) your PHP script somewhere? (I have no familiarity with
>>     the PHP client but I'd like to see what it's doing...)
>>
>>     Cheers, Simon
>>
>>
>>     On 13/02/13 14:33, bratner bratner wrote:
>>
>>         Hi!
>>
>>         My setup includes a rabbitmq-c application that publishes
>>         messages on
>>         node A.
>>         The publishing rate is about 200mps, each message can be up to
>> 10Kb.
>>
>>         Shovel (node A) is configured to move them to node B.
>>         On node B i'm dequeuing the messages with a PHP test script with
>>         $queue->get(AMQP_AUTOACK).
>>         If i keep the publishing rate at 200mps then i can see that the
>>         queue on
>>         node A is empty and the Q on node B is
>>         filling up. The read-rate of my test script is really low.
>>
>>         If i stop the publishing, 3-5 seconds later, my test script starts
>>         reading like crazy until the queue on node B is empty.
>>
>>         Even If I slow down the publishing rate to 5mps , same is
>>         happening ,
>>         messages are piling up on node B until i dial down the pressure.
>>
>>         This problem disappears if I set ack_mode to on_publish or
>>         no_ack. In
>>         this case the reader script reads with the publishing speed.
>>
>>         My configuration :
>>
>>
>>
>>         [
>>         {rabbit, [
>>         {log_levels, [{connection, error}]}
>>         ]},
>>         {rabbitmq_shovel,
>>         [ {shovels, [ {messagemover, [
>>         {sources, [
>>         {broker, "amqp://usera:pass at localhost/_**_vhosta
>>         <amqp://cdrposter:4VkI6MKH at __**localhost/sipout>"},
>>
>>         {declarations, [
>>         {'exchange.declare',[{__**exchange, <<"my-fanout">>},{type,
>>         <<"fanout">>},durable]},
>>         {'queue.declare',[{queue,<<"__**messages">>},durable]},
>>
>>         {'queue.bind',[{exchange, <<"my-fanout">>},{queue,
>> <<"messages">>}]}
>>         ]}
>>         ]},
>>         {destinations, [
>>         {brokers, [ "amqp://userb:pass at nodeB/__**vhostb
>>         <amqp://cdr_manager:Ci2XOb3b at _**_10.200.10.218/cdrs
>>         <http://cdr_manager:Ci2XOb3b@**10.200.10.218/cdrs<http://cdr_manager:Ci2XOb3b at 10.200.10.218/cdrs>>>"
>> ]},
>>
>>         {declarations, [
>>         {'exchange.declare',[{__**exchange, <<"my-fanout">>},{type,
>>         <<"fanout">>},durable]},
>>         {'queue.declare',[{queue,<<"__**messages">>},durable]},
>>
>>         {'queue.bind',[{exchange, <<"my-fanout">>},{queue,
>> <<"messages">>}]}
>>         ]}
>>         ]},
>>         {queue, <<"messages">>},
>>         {prefetch_count, 200},
>>         {ack_mode, on_confirm},
>>         {publish_properties, [{delivery_mode, 2}]},
>>         {reconnect_delay, 5}
>>         ]}
>>         ]}
>>         ]}
>>         ].
>>
>>
>>         Thank you,
>>         Boris.
>>
>>
>>         ______________________________**___________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>         https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/a226789b/attachment.htm>

From Scott.Chapman at servicenow.com  Thu Feb 21 18:11:15 2013
From: Scott.Chapman at servicenow.com (Scott Chapman)
Date: Thu, 21 Feb 2013 18:11:15 +0000
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika?
 I want 1 message at a time and stop receiving until I'm ready again.
In-Reply-To: <51256658.6000309@rabbitmq.com>
Message-ID: <CC28B25FDAC5D943B606F46369686C2A2435C2A0@SJC4EXDAG01-02.corp.service-now.com>

On 2/20/13 4:12 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Scott,
>
>On 20/02/13 23:27, Scott Chapman wrote:
>> After further exploring it appears that you do this:
>> Using the BlockingConnection:
>> Receive Message
>> Run Handler to process message which can immediately ACK the message.
>> When Handler returns, next message is received from RabbitMQ.
>>
>> Simpler!
>
>The above won't stop rabbit from sending one or more messages to the
>client (depending on the basic.qos prefetch setting). While the app
>won't get to the see these messages until the Handler returns, the
>messages will still take up buffer space at the client or in the
>network, and they will be unavailable to other consumers on the same
>queue.
>
>If that is not what you want then follow Michael's suggestion of
>cancelling the subscription. Or simply delay the ack until the app is
>ready to process the next message.

Mathias

I'd like to clarify some points here.

If 1st message arrives, I ack it, and I am processing it then 2nd message
arrives, it will be held _in_the_client_?
So if the client gets rebooted, the message will be lost?
It appears that I can set the basic.qos prefetch-count to zero to solve
this problem?

If I decide to cancel the consumer,  I assume the proper order of events
would be:

Enable Consumer
Receive message 1
Cancel Consumer
Ack Message
Process Message
-> back to Enable Consumer.

I think one would not want to ACK the message before canceling the
consumer because it might immediately dump another message into the
consumer?

Thanks for the tips,

Scott


From matthias at rabbitmq.com  Thu Feb 21 19:04:33 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 21 Feb 2013 19:04:33 +0000
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika?
 I want 1 message at a time and stop receiving until I'm ready again.
In-Reply-To: <CC28B25FDAC5D943B606F46369686C2A2435C2A0@SJC4EXDAG01-02.corp.service-now.com>
References: <CC28B25FDAC5D943B606F46369686C2A2435C2A0@SJC4EXDAG01-02.corp.service-now.com>
Message-ID: <51266FC1.7090508@rabbitmq.com>

Scott,

On 21/02/13 18:11, Scott Chapman wrote:
> If 1st message arrives, I ack it, and I am processing it then 2nd message
> arrives, it will be held _in_the_client_?

Yes.

> So if the client gets rebooted, the message will be lost?

No. The server holds on to messages until they have been acknowledged.

You may want to read 
http://www.rabbitmq.com/tutorials/tutorial-two-python.html, if you 
haven't done so already.

> It appears that I can set the basic.qos prefetch-count to zero to solve
> this problem?

No. Zero means "unlimited". But there is no problem to start with.

> If I decide to cancel the consumer,  I assume the proper order of events
> would be:
>
> Enable Consumer
> Receive message 1
> Cancel Consumer
> Ack Message
> Process Message
> -> back to Enable Consumer.

What do you want to happen when the client crashes during Process Message?

The typical consumer sequence, in AMQP commands, is

- basic.qos{prefetch=n}
- basic.consume
- on basic.deliver (i.e. receiving of a message)
   - process message
   - basic.ack

If the prefetch is set to 1 (though see note below), we can guarantee 
that the client only ever has at most one message sent to it until it 
issues an ack. And sending the ack after processing ensures that if 
anything goes wrong during processing, e.g. the client crashes, then the 
server will requeue the message, so other clients (or the same client 
when it reconnects) can process it.

In some circumstances you may want to do the following instead:

- basic.qos{prefetch=n}
- basic.consume
- on basic.deliver
   - basic.cancel
   - process message until a safe point from which the client can recover
   - basic.ack
   - do more, possibly expensive, processing of the message
   - basic.consume

which is closer to what you envisaged. But that's a lot more complex and 
expensive, so only warranted if the workload fits that special pattern 
of message processing being very expensive and splittable into two phases.

> I think one would not want to ACK the message before canceling the
> consumer because it might immediately dump another message into the
> consumer?

Correct.

Now back to setting the prefetch. For maximum performance you'd want to 
tune that s.t. whenever the client has finished processing a message 
then the next message has just arrived from the server moments earlier. 
That way the client never sits there idle waiting for a message or, 
conversely, buffers a whole bunch of messages that could be processed by 
other consumers. The right figure here is highly dependent on workload 
and network latency.


Regards,

Matthias.

From Scott.Chapman at servicenow.com  Thu Feb 21 19:12:59 2013
From: Scott.Chapman at servicenow.com (Scott Chapman)
Date: Thu, 21 Feb 2013 19:12:59 +0000
Subject: [rabbitmq-discuss] How to do blocking asynchronously with Pika?
 I want 1 message at a time and stop receiving until I'm ready again.
In-Reply-To: <51266FC1.7090508@rabbitmq.com>
Message-ID: <CC28B25FDAC5D943B606F46369686C2A2435C924@SJC4EXDAG01-02.corp.service-now.com>

Mathias,
Thanks for the good info below.
What I want to do is to get a message and Ack it immediately and not get
another one until I'm done processing the first one.
If the client crashes during processing, a human will be notified and come
along later and clean it up.

So I would want to do:
Receive one message at a time.
Ack it.
Process it.
-> Receive one message at a time.

It sounds like the easy way to do this is to set the prefetch_count to 1
and follow the simple flow above.  No need to cancel subscription.

Scott


On 2/21/13 11:04 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Scott,
>
>On 21/02/13 18:11, Scott Chapman wrote:
>> If 1st message arrives, I ack it, and I am processing it then 2nd
>>message
>> arrives, it will be held _in_the_client_?
>
>Yes.
>
>> So if the client gets rebooted, the message will be lost?
>
>No. The server holds on to messages until they have been acknowledged.
>
>You may want to read
>http://www.rabbitmq.com/tutorials/tutorial-two-python.html, if you
>haven't done so already.
>
>> It appears that I can set the basic.qos prefetch-count to zero to solve
>> this problem?
>
>No. Zero means "unlimited". But there is no problem to start with.
>
>> If I decide to cancel the consumer,  I assume the proper order of events
>> would be:
>>
>> Enable Consumer
>> Receive message 1
>> Cancel Consumer
>> Ack Message
>> Process Message
>> -> back to Enable Consumer.
>
>What do you want to happen when the client crashes during Process Message?
>
>The typical consumer sequence, in AMQP commands, is
>
>- basic.qos{prefetch=n}
>- basic.consume
>- on basic.deliver (i.e. receiving of a message)
>   - process message
>   - basic.ack
>
>If the prefetch is set to 1 (though see note below), we can guarantee
>that the client only ever has at most one message sent to it until it
>issues an ack. And sending the ack after processing ensures that if
>anything goes wrong during processing, e.g. the client crashes, then the
>server will requeue the message, so other clients (or the same client
>when it reconnects) can process it.
>
>In some circumstances you may want to do the following instead:
>
>- basic.qos{prefetch=n}
>- basic.consume
>- on basic.deliver
>   - basic.cancel
>   - process message until a safe point from which the client can recover
>   - basic.ack
>   - do more, possibly expensive, processing of the message
>   - basic.consume
>
>which is closer to what you envisaged. But that's a lot more complex and
>expensive, so only warranted if the workload fits that special pattern
>of message processing being very expensive and splittable into two phases.
>
>> I think one would not want to ACK the message before canceling the
>> consumer because it might immediately dump another message into the
>> consumer?
>
>Correct.
>
>Now back to setting the prefetch. For maximum performance you'd want to
>tune that s.t. whenever the client has finished processing a message
>then the next message has just arrived from the server moments earlier.
>That way the client never sits there idle waiting for a message or,
>conversely, buffers a whole bunch of messages that could be processed by
>other consumers. The right figure here is highly dependent on workload
>and network latency.
>
>
>Regards,
>
>Matthias.


From s.sciarrati at gmail.com  Thu Feb 21 20:41:41 2013
From: s.sciarrati at gmail.com (Simone Sciarrati)
Date: Thu, 21 Feb 2013 21:41:41 +0100
Subject: [rabbitmq-discuss] Help understanding a crash report
Message-ID: <CAOQTPw72eph4Y41veC25QCUPMEJiEmFZsLLo+_uCWuURbT9Zsw@mail.gmail.com>

Hi,

I am relatively new to Rabbitmq and would appreciate help in
troubleshooting a recurring issue on a cluster, apologies for the long
email.

I run a 3 instances cluster in ec2, 2 disk nodes (A and B) 1 ram node (C),
exchanges and queues are static and limited in number (less than 50), the
volume of messages can reach a few thousands per second and the queues can
occasionally grow up to a few hundred thousands until the processes manage
to catch up, but this is well within our memory/disk high watermark.
Rabbitmq is v. 2.8.4 on ubuntu 12.

The processes that produce and consume messages are java/scala and use the
akka-amqp library driver (akka-amqp-1.3.1).

In normal operations our nodes run on ~ 500MB memory, the limit is set to
2.7GB, but in a couple occasions one of the nodes managed to very rapidly
(< 1 min) eat > 1GB memory and triggered the high memory watermark (node B,
one of the disk nodes last time).

At the moment of the issue most of the memory was held in 'processes', no
queue was overgrown (messages or memory), I managed to run a rabbitmqctl
report, I found a crash report in the logs (more on this later) and tried
to see which process/es was responsible for the memory usage from the
erlang shell but I wasn't able to pin a specific one (my erlang is limited
and I didn't dump the processes to file to look at it later unfortunately).

For every issue we have had (3 in 2 months), the logs show a crash report
relative to a specific java process (say process D) sending a message to a
specific queue (queue D - this is a queue with no consumers atm, if the app
fails to process a message it will end up here). Note that there are
multiple workers D running on separate instances in ec2 and that queue D is
very low traffic so it is unlikely to be a coincidence.

At this point I was pressured to restart rmq on the affected node B, this
was a stop_app, then stop the erlang VM and then restart. All looked good,
the node was in a nice place and all looked green in the management
console.

Our java processes would connect, they'd do some work, but after a while
they'd throw a connection error (sorry this is all the details the logs
would show). Specifically a process E was connected to node A and would
show this random behaviour (different process and different rmq node from
the two involved in the issue).
After a while I was forced to restart the whole cluster, this was done
stopping app on the ram node C, then on the disk node B, then the other
node A. Unfortunately A seemed to hang and failed to stop within a
reasonable time (minutes), and I had to kill it (kill -15). I didn't see
any indication in the logs on why it was hanging.

When I attempted to start A it would fail as the port was already in use
and I found that a process still had an open connection to port 5672:

tcp6       0 164945 10.xx.xx.xx:5672        10.xx.xx.xx:53712      FIN_WAIT1

Note: This is a worker D but running on a different box from the one showed
in the crash log.

Once this connection was cleared everything came up nice and happy.

In Summary:

Process D was producing on queue D on node B, something happened and node B
managed to consume > 1GB memory in less than a minute. Note that this queue
is really low traffic but in every issue I have looked into I can see a
similar crash report as below.

After a restart of node B other processes connected to node A started
exhibiting connection issues, work a bit then break the connection until
the whole cluster is restarted.

I would like to better understand the crash report and perhaps have some
ideas on what went wrong and how to more effectively troubleshoot issues
(what more info should I collect before restarting the nodes, erlang
processes list, mnesia tables, ets tables etc).


=CRASH REPORT==== 14-Feb-2013::10:36:54 ===
  crasher:
    initial call: rabbit_reader:init/4
    pid: <*0.29283.387*>
    registered_name: []
    exception error: bad argument
      in function  port_close/1
         called as port_close(#Port<0.746540>)
      in call from rabbit_net:maybe_fast_close/1
      in call from rabbit_reader:start_connection/7
    ancestors: [<0.29280.387>,rabbit_tcp_client_sup,rabbit_sup,<0.161.0>]
    messages: []
    links: [<0.29280.387>]
    dictionary: [{{channel,10},
                   {<0.29364.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{ch_pid,<0.29338.387>},{7,#Ref<0.0.2158.60093>}},
                  {{ch_pid,<0.29333.387>},{6,#Ref<0.0.2158.60085>}},
                  {{ch_pid,<0.29325.387>},{5,#Ref<0.0.2158.60053>}},
                  {{channel,3},
                   {<0.29313.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{ch_pid,<0.29305.387>},{2,#Ref<0.0.2158.60002>}},
                  {{channel,4},
                   {<0.29321.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{channel,11},
                   {<0.29370.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{ch_pid,<0.29313.387>},{3,#Ref<0.0.2158.60017>}},
                  {{ch_pid,<0.29299.387>},{1,#Ref<0.0.2158.59976>}},
                  {{ch_pid,<0.29346.387>},{8,#Ref<0.0.2158.60112>}},
                  {{ch_pid,<0.29370.387>},{11,#Ref<0.0.2158.60189>}},
                  {{channel,7},
                   {<0.29338.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{channel,9},
                   {<0.29356.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{ch_pid,<0.29321.387>},{4,#Ref<0.0.2158.60034>}},
                  {{ch_pid,<0.29364.387>},{10,#Ref<0.0.2158.60166>}},
                  {{ch_pid,<0.29356.387>},{9,#Ref<0.0.2158.60140>}},
                  {{channel,8},
                   {<0.29346.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{channel,5},
                   {<0.29325.387>,{method,rabbit_framing_amqp_0_9_1}}},
                  {{channel,1},
                   {<0.29299.387>,
                    {content_body,
                        {'basic.publish',0,<<"some_exchange">>,<<>>,false,
                            false},
                        1048189,
                        {content,60,none,
                            <<BYTES IN HERE>>,   --> this showed which
process was sending the message
                            rabbit_framing_amqp_0_9_1,
                            [<<MORE BYTES IN HERE>>]  --> This I haven't
been able to decode, it is fairly big, is it truncated?


And in the logs we can find the pid *0.29283.387 *right before the crash:

=INFO REPORT==== 14-Feb-2013::10:31:46 ===
accepting AMQP connection <*0.29283.387*> (10.xx.xx.xx:58622 -> 10.xx.xx.xx
:5672)

=INFO REPORT==== 14-Feb-2013::10:31:46 ===
accepting AMQP connection <0.29287.387> (10.xx.xx.xx:58623 -> 10.xx.xx.xx
:5672)

=WARNING REPORT==== 14-Feb-2013::10:32:27 ===
closing AMQP connection <0.27107.387> (10.xx.xx.xx:50882 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=WARNING REPORT==== 14-Feb-2013::10:32:27 ===
closing AMQP connection <0.27111.387> (10.xx.xx.xx:50883 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=INFO REPORT==== 14-Feb-2013::10:33:35 ===
accepting AMQP connection <0.30447.387> (10.xx.xx.xx:50187 -> 10.xx.xx.xx
:5672)

=INFO REPORT==== 14-Feb-2013::10:33:35 ===
accepting AMQP connection <0.30451.387> (10.xx.xx.xx:50188 -> 10.xx.xx.xx
:5672)

=WARNING REPORT==== 14-Feb-2013::10:37:34 ===
closing AMQP connection <*0.29283.387*> (10.xx.xx.xx:58622 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=WARNING REPORT==== 14-Feb-2013::10:37:34 ===
closing AMQP connection <0.29287.387> (10.xx.xx.xx:58623 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=WARNING REPORT==== 14-Feb-2013::10:37:34 ===
closing AMQP connection <0.30451.387> (10.xx.xx.xx:50188 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=WARNING REPORT==== 14-Feb-2013::10:37:34 ===
closing AMQP connection <0.30447.387> (10.xx.xx.xx:50187 -> 10.xx.xx.xx
:5672):
connection_closed_abruptly

=INFO REPORT==== 14-Feb-2013::10:37:34 ===
vm_memory_high_watermark set. Memory used:3384669192 allowed:2914218803

Looking at the rabbitmqctl report I have not been able to map the memory
consumption to something specific yet.

Any help appreciated,

S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130221/e64d4bf7/attachment.htm>

From dbuchko at vmware.com  Thu Feb 21 21:21:40 2013
From: dbuchko at vmware.com (Daniel Buchko)
Date: Thu, 21 Feb 2013 13:21:40 -0800
Subject: [rabbitmq-discuss] Contact info
Message-ID: <201563F6B444B14C89BEA66003DD4014143915CDF9@exch-mbx-113.vmware.com>

FYI, my skype id is dan.buchko

Daniel L. Buchko
Senior Consultant, PSO
vFabric, Cloud Application Platform
VMWare, Inc.

PH: 905.308.1676


From marco.pasopas at gmail.com  Fri Feb 22 14:02:54 2013
From: marco.pasopas at gmail.com (Marco Pas)
Date: Fri, 22 Feb 2013 15:02:54 +0100
Subject: [rabbitmq-discuss] Problems when sending a message while receiving
Message-ID: <CABq8o5JHeYnR3KGzo_EZHZ2s4s7CE_cGw87OGtZryxWU64BTQg@mail.gmail.com>

HI there i am trying to send a message in the handleMessage method,
this seems to fail somehow. Is there a reason why i cannot send a
message to rabbitMQ when processing a message?

// receives a message and replies to the reply queue
void handleMessage(Message message) {

    // send a message to the exchange and waits for the reply..
    String result =
rabbitTemplate.convertSendAndReceive("myCustomExch", "myRoutingKey",
"test content")

    // determine the reply queue
    def destQueue = message.messageProperties.replyTo

    // code omitted that processes the message and uses the previously result
    ....

    // send the content back to the reply queue
    rabbitSend destQueue, responseJson
}

When i put the rabbitTemplate.convertSendAndReceive("myCustomExch",
"myRoutingKey", "test content") method in a non handleMessage method
it works without problems. Am i not allowed to send and receive inside
a handleMessage method that is also handling stuf?

/Marco

From marco.pasopas at gmail.com  Fri Feb 22 14:06:52 2013
From: marco.pasopas at gmail.com (Marco Pas)
Date: Fri, 22 Feb 2013 06:06:52 -0800 (PST)
Subject: [rabbitmq-discuss] Problems when sending a message while receiving
Message-ID: <7f5d2016-dae8-4d07-bef5-c488540cd473@googlegroups.com>

HI there i am trying to send a message in the handleMessage method,
this seems to fail somehow. Is there a reason why i cannot send a
message to rabbitMQ when processing a message?

// receives a message and replies to the reply queue
void handleMessage(Message message) {

    // send a message to the exchange and waits for the reply..
    String result =
rabbitTemplate.convertSendAndReceive("myCustomExch", "myRoutingKey",
"test content")

    // determine the reply queue
    def destQueue = message.messageProperties.replyTo

    // code omitted that processes the message and uses the previously 
result
    ....

    // send the content back to the reply queue
    rabbitSend destQueue, responseJson
}

When i put the rabbitTemplate.convertSendAndReceive("myCustomExch",
"myRoutingKey", "test content") method in a non handleMessage method
it works without problems. Am i not allowed to send and receive inside
a handleMessage method that is also handling stuf?

/Marco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/1882399f/attachment.htm>

From grussell at vmware.com  Fri Feb 22 15:40:09 2013
From: grussell at vmware.com (Gary Russell)
Date: Fri, 22 Feb 2013 07:40:09 -0800 (PST)
Subject: [rabbitmq-discuss] Problems when sending a message while
 receiving
In-Reply-To: <7f5d2016-dae8-4d07-bef5-c488540cd473@googlegroups.com>
Message-ID: <738712274.7943417.1361547609755.JavaMail.root@vmware.com>

As I mentioned on the Spring forum - the rabbit template will use the same channel as the listener (by default). If the listener is transactional, the send won't complete until the transaction commits (handler exits). 


http://forum.springsource.org/showthread.php?135102-Problems-when-sending-a-message-while-receiving-using-RabbitMQ-RabbitTemplate&p=439178&posted=1#post439178 

----- Original Message -----

From: "Marco Pas" <marco.pasopas at gmail.com> 
To: rabbitmq-discuss at googlegroups.com 
Sent: Friday, February 22, 2013 9:06:52 AM 
Subject: [rabbitmq-discuss] Problems when sending a message while receiving 

HI there i am trying to send a message in the handleMessage method, 
this seems to fail somehow. Is there a reason why i cannot send a 
message to rabbitMQ when processing a message? 

// receives a message and replies to the reply queue 
void handleMessage(Message message) { 

// send a message to the exchange and waits for the reply.. 
String result = 
rabbitTemplate. convertSendAndReceive(" myCustomExch", "myRoutingKey", 
"test content") 

// determine the reply queue 
def destQueue = message.messageProperties. replyTo 

// code omitted that processes the message and uses the previously result 
.... 

// send the content back to the reply queue 
rabbitSend destQueue, responseJson 
} 

When i put the rabbitTemplate. convertSendAndReceive(" myCustomExch", 
"myRoutingKey", "test content") method in a non handleMessage method 
it works without problems. Am i not allowed to send and receive inside 
a handleMessage method that is also handling stuf? 



/Marco 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/fa0de835/attachment.htm>

From prabodh.upreti at vce.com  Fri Feb 22 15:44:19 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Fri, 22 Feb 2013 07:44:19 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq and invalid hostname
Message-ID: <1361547859460-25146.post@n5.nabble.com>

Hello

I can install/run rabbitmq perfectly fine in my normal setup.  The problem
is when I have to install it in a box where hostname can't be validated at
time of rpm install.   For instance, let's say host name is set as
xyz.abc.com.

I see that in my working environment(where hostname is resolvable), database
and log files are created as rabbit at xyz.log etc.

what happens in the above senarios where the hostname is not resolvable. Is
the install going to work fine?  Just to validate this I went ahead and
changed the hostname to testhostname.abc.com in my rabbitmq working
environment.  I went ahead and modified rabbitmq-evn.conf NODENAME to
rabbit at testhostname. Getting a lot of errors.

The reason, I have to do all this is because I need to package everything
before shipping to customer environment.  The hostname/FQDN specified can't
be validated in my environment but I still need to make sure everything is
setup correctly.  The customer is just going to put it in their environment
and everything should work fine.  I would appreciate some guidance from you.
Thank you.

Regards





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-and-invalid-hostname-tp25146.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Cyril.LECLERC at pragmaconsult.lu  Fri Feb 22 15:54:53 2013
From: Cyril.LECLERC at pragmaconsult.lu (Cyril LECLERC)
Date: Fri, 22 Feb 2013 15:54:53 +0000
Subject: [rabbitmq-discuss] test of a existing queue
Message-ID: <6E837D1EC02AE749B0DCC0A627EFF8C316DBFA@SVR-EXC-01.PRAGMA.INT>

Hello,

How we can test if a queue exits in application? Without the queueDeclare because it is not what i want, indeed, if i use amqpTemplate.convertAndSend(), and the queue does'nt existing, nothing will happen, but i have to know if the queue configured is existing, but not create it...because we use spring amqp.

Moreover how we can configure the name of the queue in this method (amqpTemplate.convertAndSend()) because it takes one string argument but when it is configured in spring i don't have to configure in the code i want to use spring configuration ...

thanks....

Cyril

From prabodh.upreti at vce.com  Fri Feb 22 16:12:27 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Fri, 22 Feb 2013 08:12:27 -0800 (PST)
Subject: [rabbitmq-discuss] hostname change
In-Reply-To: <510B9C9F.6000401@rabbitmq.com>
References: <1359383662020-24717.post@n5.nabble.com>
	<2E74050D-BD49-4800-BE80-F40ABB31F78E@dushin.net>
	<510B9C9F.6000401@rabbitmq.com>
Message-ID: <1361549547676-25148.post@n5.nabble.com>

Matthais

>>And a quick experiment confirms that is working as expected. 

>>Note though that $HOSTNAME must be resolvable, or you'll see something
like 

>>ERROR: epmd error for host "oldhost": nxdomain (non-existing domain) 

>>on startup. 

I created another thread for this but just realized this maybe the best
place to continue.  Is there anyway I can install rabbitmq in a box where
hostname is not resolvable. It will be resolvable in the future when it gets
to the client site but I need to install everything beforehand.  Also, when
the hostname is changed, I was going to enter in rabbitmq-env.conf

NODENAME=rabbit at newhostname
CONFIG_FILE=/etc/rabbitmq/rabbitmq

Is this all I need to do?  The first time I install rabbitmq, I remove the
guest user because I have separate authentication plugin to validate users. 
I see that when the new node name is assigned, system is trying to create
the guest user again.    Thank you.





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/hostname-change-tp24717p25148.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From grussell at vmware.com  Fri Feb 22 16:22:54 2013
From: grussell at vmware.com (Gary Russell)
Date: Fri, 22 Feb 2013 08:22:54 -0800 (PST)
Subject: [rabbitmq-discuss] test of a existing queue
In-Reply-To: <6E837D1EC02AE749B0DCC0A627EFF8C316DBFA@SVR-EXC-01.PRAGMA.INT>
Message-ID: <1218652985.8049334.1361550174533.JavaMail.root@vmware.com>

channel.queueDeclarePassive(queueName) will throw an exception if the queue doesn't exist.

You can get a channel by 

Channel channel = factory.createConnection().createChannel(false);

where factory is a reference to the CachingConnectionFactory.

No, you can't specify the queue name in the send methods - you don't send to a queue, you send to an exchange, and it routes it to the queue.

----- Original Message -----
From: "Cyril LECLERC" <Cyril.LECLERC at pragmaconsult.lu>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Friday, February 22, 2013 10:54:53 AM
Subject: [rabbitmq-discuss] test of a existing queue

Hello,

How we can test if a queue exits in application? Without the queueDeclare because it is not what i want, indeed, if i use amqpTemplate.convertAndSend(), and the queue does'nt existing, nothing will happen, but i have to know if the queue configured is existing, but not create it...because we use spring amqp.

Moreover how we can configure the name of the queue in this method (amqpTemplate.convertAndSend()) because it takes one string argument but when it is configured in spring i don't have to configure in the code i want to use spring configuration ...

thanks....

Cyril
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Cyril.LECLERC at pragmaconsult.lu  Fri Feb 22 17:00:09 2013
From: Cyril.LECLERC at pragmaconsult.lu (Cyril LECLERC)
Date: Fri, 22 Feb 2013 17:00:09 +0000
Subject: [rabbitmq-discuss] RE :  test of a existing queue
In-Reply-To: <1218652985.8049334.1361550174533.JavaMail.root@vmware.com>
References: <6E837D1EC02AE749B0DCC0A627EFF8C316DBFA@SVR-EXC-01.PRAGMA.INT>,
	<1218652985.8049334.1361550174533.JavaMail.root@vmware.com>
Message-ID: <6E837D1EC02AE749B0DCC0A627EFF8C316DC1A@SVR-EXC-01.PRAGMA.INT>

thank you for your reactivity

channel.queueDeclarePassive(queueName) will throw an exception if the queue doesn't exist.

Yes but the solution needs to use a Channel object, use @Inject of the factory, and it is not a boolean method so utilisation of spring amqp has no avantage and more it closes the channel connection!!!!we have to declare az new channel because spring create one by default plus all my consumers...for the moment my code is like this (in a wicket appplication) :

    @Inject
    AmqpTemplate amqpTemplate;
    amqpTemplate.convertAndSend("queue", messageField.getValue().toString());

my spring configuration :

<!-- now we can use -->
    <context:property-placeholder location="${ext.properties.dir}" />

    <rabbit:connection-factory id="rabbitConnectionFactory"
        host="${config.amqp.server}" username="${config.amqp.username}" password="${config.amqp.password}" />

    <!-- Creates a org.springframework.amqp.rabbit.core.RabbitTemplate for access
        to the broker -->
    <rabbit:template id="amqpTemplate" connection-factory="rabbitConnectionFactory" />

    <!-- Creates a queue for consumers to retrieve messages -->
    <rabbit:queue id="queue" name="${config.amqp.queuename}" />

    <bean id="messageListener" class="lu.pragmaconsult.geocamp.receiver.MessageHandler" />

    <rabbit:listener-container
        connection-factory="rabbitConnectionFactory" concurrency="${config.amqp.nbconsumer}"
        auto-startup="true">
        <rabbit:listener queues="queue" ref="messageListener" />
    </rabbit:listener-container>


If i use your advice :

    @Inject
    AmqpTemplate amqpTemplate;

    Channel channel;
    @Inject
    ConnectionFactory rabbitConnectionFactory;

    amqpTemplate.convertAndSend("queue", messageField.getValue().toString());


channel =(Channel) rabbitConnectionFactory.createConnection().createChannel(true);

                try {
                    channel.queueDeclarePassive("queue/GeoCampQueue3");
                } catch (IOException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                }

                //maybe add the code for verify the queue
                amqpTemplate.convertAndSend("queue/GeoCampQueue3", messageField.getValue().toString());


it is not what i want moreover i want the name of queue come from spring and not in code.


No, you can't specify the queue name in the send methods - you don't send to a queue, you send to an exchange, and it routes it to the queue.

if the queue is binding to the exchange by default, it is in direct so the queue name is my "routing key", if i put the name of the exchange ("") nothing happening

i try this :

    <rabbit:template id="amqpTemplate" connection-factory="rabbitConnectionFactory" queue="queue" exchange="" routing-key=""/>

but the exchange and routing key is like this by default, so my template don't send automatiqueliy to my queue directly by spring configuration.....

have you got any id?as????

________________________________________
De : rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] de la part de Gary Russell [grussell at vmware.com]
Date d'envoi : vendredi 22 f?vrier 2013 17:22
? : Discussions about RabbitMQ
Objet : Re: [rabbitmq-discuss] test of a existing queue

channel.queueDeclarePassive(queueName) will throw an exception if the queue doesn't exist.

You can get a channel by

Channel channel = factory.createConnection().createChannel(false);

where factory is a reference to the CachingConnectionFactory.

No, you can't specify the queue name in the send methods - you don't send to a queue, you send to an exchange, and it routes it to the queue.

----- Original Message -----
From: "Cyril LECLERC" <Cyril.LECLERC at pragmaconsult.lu>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Friday, February 22, 2013 10:54:53 AM
Subject: [rabbitmq-discuss] test of a existing queue

Hello,

How we can test if a queue exits in application? Without the queueDeclare because it is not what i want, indeed, if i use amqpTemplate.convertAndSend(), and the queue does'nt existing, nothing will happen, but i have to know if the queue configured is existing, but not create it...because we use spring amqp.

Moreover how we can configure the name of the queue in this method (amqpTemplate.convertAndSend()) because it takes one string argument but when it is configured in spring i don't have to configure in the code i want to use spring configuration ...

thanks....

Cyril
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
This email was Virus checked by Pragma Consult Security Gateway.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/375dc992/attachment.htm>

From matthias at rabbitmq.com  Fri Feb 22 17:19:34 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 22 Feb 2013 17:19:34 +0000
Subject: [rabbitmq-discuss] RE :  test of a existing queue
In-Reply-To: <6E837D1EC02AE749B0DCC0A627EFF8C316DC1A@SVR-EXC-01.PRAGMA.INT>
References: <6E837D1EC02AE749B0DCC0A627EFF8C316DBFA@SVR-EXC-01.PRAGMA.INT>,
	<1218652985.8049334.1361550174533.JavaMail.root@vmware.com>
	<6E837D1EC02AE749B0DCC0A627EFF8C316DC1A@SVR-EXC-01.PRAGMA.INT>
Message-ID: <5127A8A6.5030002@rabbitmq.com>

Cyril,

On 22/02/13 17:00, Cyril LECLERC wrote:
> thank you for your reactivity

The Spring-AMQP forum - 
http://forum.springsource.org/forumdisplay.php?74-AMQP - is a better 
place to ask these questions.

Regards,

Matthias.

From grussell at vmware.com  Fri Feb 22 17:58:18 2013
From: grussell at vmware.com (Gary Russell)
Date: Fri, 22 Feb 2013 09:58:18 -0800 (PST)
Subject: [rabbitmq-discuss] RE :  test of a existing queue
In-Reply-To: <6E837D1EC02AE749B0DCC0A627EFF8C316DC1A@SVR-EXC-01.PRAGMA.INT>
Message-ID: <551480351.8094091.1361555898061.JavaMail.root@vmware.com>

We could, perhaps add a convenience method to RabbitAdmin (boolean queueExists(String queueName)). 


Feel free to open a New Feature issue: https://jira.springsource.org/browse/AMQP 


The queue specified on the <rabbit:template/> is ONLY used for the receive() methods - it is the default queue used if no queue is specified via the receive API. 


Like I said, you don't SEND to a queue, you send to an exchange. 

----- Original Message -----

From: "Cyril LECLERC" <Cyril.LECLERC at pragmaconsult.lu> 
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Friday, February 22, 2013 12:00:09 PM 
Subject: [rabbitmq-discuss] RE : test of a existing queue 


thank you for your reactivity 

channel.queueDeclarePassive(queueName) will throw an exception if the queue doesn't exist. 

Yes but the solution needs to use a Channel object, use @Inject of the factory, and it is not a boolean method so utilisation of spring amqp has no avantage and more it closes the channel connection!!!!we have to declare az new channel because spring create one by default plus all my consumers...for the moment my code is like this (in a wicket appplication) : 

@Inject 
AmqpTemplate amqpTemplate; 
amqpTemplate.convertAndSend("queue", messageField.getValue().toString()); 

my spring configuration : 

<!-- now we can use --> 
<context:property-placeholder location="${ext.properties.dir}" /> 

<rabbit:connection-factory id="rabbitConnectionFactory" 
host="${config.amqp.server}" username="${config.amqp.username}" password="${config.amqp.password}" /> 

<!-- Creates a org.springframework.amqp.rabbit.core.RabbitTemplate for access 
to the broker --> 
<rabbit:template id="amqpTemplate" connection-factory="rabbitConnectionFactory" /> 

<!-- Creates a queue for consumers to retrieve messages --> 
<rabbit:queue id="queue" name="${config.amqp.queuename}" /> 

<bean id="messageListener" class="lu.pragmaconsult.geocamp.receiver.MessageHandler" /> 

<rabbit:listener-container 
connection-factory="rabbitConnectionFactory" concurrency="${config.amqp.nbconsumer}" 
auto-startup="true"> 
<rabbit:listener queues="queue" ref="messageListener" /> 
</rabbit:listener-container> 


If i use your advice : 

@Inject 
AmqpTemplate amqpTemplate; 

Channel channel; 
@Inject 
ConnectionFactory rabbitConnectionFactory; 

amqpTemplate.convertAndSend("queue", messageField.getValue().toString()); 


channel =(Channel) rabbitConnectionFactory.createConnection().createChannel(true); 

try { 
channel.queueDeclarePassive("queue/GeoCampQueue3"); 
} catch (IOException e) { 
// TODO Auto-generated catch block 
e.printStackTrace(); 
} 

//maybe add the code for verify the queue 
amqpTemplate.convertAndSend("queue/GeoCampQueue3", messageField.getValue().toString()); 


it is not what i want moreover i want the name of queue come from spring and not in code. 


No, you can't specify the queue name in the send methods - you don't send to a queue, you send to an exchange, and it routes it to the queue. 

if the queue is binding to the exchange by default, it is in direct so the queue name is my "routing key", if i put the name of the exchange ("") nothing happening 

i try this : 

<rabbit:template id="amqpTemplate" connection-factory="rabbitConnectionFactory" queue="queue" exchange="" routing-key=""/> 

but the exchange and routing key is like this by default, so my template don't send automatiqueliy to my queue directly by spring configuration..... 

have you got any id?as???? 

________________________________________ 
De : rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] de la part de Gary Russell [grussell at vmware.com] 
Date d'envoi : vendredi 22 f?vrier 2013 17:22 
? : Discussions about RabbitMQ 
Objet : Re: [rabbitmq-discuss] test of a existing queue 

channel.queueDeclarePassive(queueName) will throw an exception if the queue doesn't exist. 

You can get a channel by 

Channel channel = factory.createConnection().createChannel(false); 

where factory is a reference to the CachingConnectionFactory. 

No, you can't specify the queue name in the send methods - you don't send to a queue, you send to an exchange, and it routes it to the queue. 

----- Original Message ----- 
From: "Cyril LECLERC" <Cyril.LECLERC at pragmaconsult.lu> 
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Friday, February 22, 2013 10:54:53 AM 
Subject: [rabbitmq-discuss] test of a existing queue 

Hello, 

How we can test if a queue exits in application? Without the queueDeclare because it is not what i want, indeed, if i use amqpTemplate.convertAndSend(), and the queue does'nt existing, nothing will happen, but i have to know if the queue configured is existing, but not create it...because we use spring amqp. 

Moreover how we can configure the name of the queue in this method (amqpTemplate.convertAndSend()) because it takes one string argument but when it is configured in spring i don't have to configure in the code i want to use spring configuration ... 

thanks.... 

Cyril 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-- 
This email was Virus checked by Pragma Consult Security Gateway. 

_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/f453c0dc/attachment.htm>

From aggarwalsandeep at optonline.net  Fri Feb 22 19:05:50 2013
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Fri, 22 Feb 2013 11:05:50 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ and log settings
In-Reply-To: <4E0AC397.5000204@rabbitmq.com>
References: <BANLkTikxaAnN8-cjrK7v4W1GR9DVAJa+vA@mail.gmail.com>	<BANLkTi=rAHPhk=CoUQgQHWnDz3c6D3zniA@mail.gmail.com>
	<BANLkTikjCh=tqZq+C4o0aCQgm4TAxbFD+A@mail.gmail.com>
	<4E0AC397.5000204@rabbitmq.com>
Message-ID: <a4edcc1b-18d8-4201-b176-8ad06cdc4c02@googlegroups.com>

Hi Mathias -

Although I can use rotate_logs from the command prompt or even in a batch 
file, do we have something from RabbitMQ configuration where I can set 
things like the rotation cycle, size etc. 

Thanks,
Sandy

On Wednesday, June 29, 2011 2:17:59 AM UTC-4, Matthias Radestock wrote:
>
> On 29/06/11 01:20, Simone Busoli wrote:
> > What about poor Windows guys? ;-)
>
> rabbitmqctl rotate_logs {suffix}
>
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq... at lists.rabbitmq.com <javascript:>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/99753e6a/attachment.htm>

From Cyril.LECLERC at pragmaconsult.lu  Fri Feb 22 19:20:42 2013
From: Cyril.LECLERC at pragmaconsult.lu (Cyril LECLERC)
Date: Fri, 22 Feb 2013 19:20:42 +0000
Subject: [rabbitmq-discuss] RE :  RE :  test of a existing queue
In-Reply-To: <551480351.8094091.1361555898061.JavaMail.root@vmware.com>
References: <6E837D1EC02AE749B0DCC0A627EFF8C316DC1A@SVR-EXC-01.PRAGMA.INT>,
	<551480351.8094091.1361555898061.JavaMail.root@vmware.com>
Message-ID: <6E837D1EC02AE749B0DCC0A627EFF8C316DC41@SVR-EXC-01.PRAGMA.INT>

We could, perhaps add a convenience method to RabbitAdmin (boolean queueExists(String queueName)).

it is an great idea  but for a better configuration maybe not in rabbitAdmin, why? for example i don't want my application have a admin right on rabbitmq, moreoever i don't use the rabbit:admin tag because i don't need it, on AmpqTemplate object it is more usefull but it is a good idea!!!!

1? The queue specified on the <rabbit:template/> is ONLY used for the receive() methods - it is the default queue used if no queue is specified via the receive API.

ahhhhhh ok  bugt why it is a shame!!!!



2 ? Like I said, you don't SEND to a queue, you send to an exchange.


yes but not exactly....(exchange or routing key if you are in case queue connected to exchange by default).So how i can declare a exchange using spring in the code? because correct me if i do a mistake but it is an exchange or a "routing key" otherwise why it is working if y put my queue name? (direct exhange...)

I don't want at all any configuration in the code beacause all my variables in spring are externalized in a conf file!!!!

do you know how many device i can connect on rabbit mq maximum (consumers, iphone, android, jar....) with a good server ??? i'm sorry i've search lot of solutions befor contact you.. i wonder about the rapidity of yours responses....

Thank you very much


________________________________
De : rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] de la part de Gary Russell [grussell at vmware.com]
Date d'envoi : vendredi 22 f?vrier 2013 18:58
? : Discussions about RabbitMQ
Objet : Re: [rabbitmq-discuss] RE : test of a existing queue

We could, perhaps add a convenience method to RabbitAdmin (boolean queueExists(String queueName)).

Feel free to open a New Feature issue: https://jira.springsource.org/browse/AMQP

The queue specified on the <rabbit:template/> is ONLY used for the receive() methods - it is the default queue used if no queue is specified via the receive API.

Like I said, you don't SEND to a queue, you send to an exchange.

________________________________
From: "Cyril LECLERC" <Cyril.LECLERC at pragmaconsult.lu>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Friday, February 22, 2013 12:00:09 PM
Subject: [rabbitmq-discuss] RE :  test of a existing queue

thank you for your reactivity

channel.queueDeclarePassive(queueName) will throw an exception if the queue doesn't exist.

Yes but the solution needs to use a Channel object, use @Inject of the factory, and it is not a boolean method so utilisation of spring amqp has no avantage and more it closes the channel connection!!!!we have to declare az new channel because spring create one by default plus all my consumers...for the moment my code is like this (in a wicket appplication) :

    @Inject
    AmqpTemplate amqpTemplate;
    amqpTemplate.convertAndSend("queue", messageField.getValue().toString());

my spring configuration :

<!-- now we can use -->
    <context:property-placeholder location="${ext.properties.dir}" />

    <rabbit:connection-factory id="rabbitConnectionFactory"
        host="${config.amqp.server}" username="${config.amqp.username}" password="${config.amqp.password}" />

    <!-- Creates a org.springframework.amqp.rabbit.core.RabbitTemplate for access
        to the broker -->
    <rabbit:template id="amqpTemplate" connection-factory="rabbitConnectionFactory" />

    <!-- Creates a queue for consumers to retrieve messages -->
    <rabbit:queue id="queue" name="${config.amqp.queuename}" />

    <bean id="messageListener" class="lu.pragmaconsult.geocamp.receiver.MessageHandler" />

    <rabbit:listener-container
        connection-factory="rabbitConnectionFactory" concurrency="${config.amqp.nbconsumer}"
        auto-startup="true">
        <rabbit:listener queues="queue" ref="messageListener" />
    </rabbit:listener-container>


If i use your advice :

    @Inject
    AmqpTemplate amqpTemplate;

    Channel channel;
    @Inject
    ConnectionFactory rabbitConnectionFactory;

    amqpTemplate.convertAndSend("queue", messageField.getValue().toString());


channel =(Channel) rabbitConnectionFactory.createConnection().createChannel(true);

                try {
                    channel.queueDeclarePassive("queue/GeoCampQueue3");
                } catch (IOException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                }

                //maybe add the code for verify the queue
                amqpTemplate.convertAndSend("queue/GeoCampQueue3", messageField.getValue().toString());


it is not what i want moreover i want the name of queue come from spring and not in code.


No, you can't specify the queue name in the send methods - you don't send to a queue, you send to an exchange, and it routes it to the queue.

if the queue is binding to the exchange by default, it is in direct so the queue name is my "routing key", if i put the name of the exchange ("") nothing happening

i try this :

    <rabbit:template id="amqpTemplate" connection-factory="rabbitConnectionFactory" queue="queue" exchange="" routing-key=""/>

but the exchange and routing key is like this by default, so my template don't send automatiqueliy to my queue directly by spring configuration.....

have you got any id?as????

________________________________________
De : rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] de la part de Gary Russell [grussell at vmware.com]
Date d'envoi : vendredi 22 f?vrier 2013 17:22
? : Discussions about RabbitMQ
Objet : Re: [rabbitmq-discuss] test of a existing queue

channel.queueDeclarePassive(queueName) will throw an exception if the queue doesn't exist.

You can get a channel by

Channel channel = factory.createConnection().createChannel(false);

where factory is a reference to the CachingConnectionFactory.

No, you can't specify the queue name in the send methods - you don't send to a queue, you send to an exchange, and it routes it to the queue.

----- Original Message -----
From: "Cyril LECLERC" <Cyril.LECLERC at pragmaconsult.lu>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Friday, February 22, 2013 10:54:53 AM
Subject: [rabbitmq-discuss] test of a existing queue

Hello,

How we can test if a queue exits in application? Without the queueDeclare because it is not what i want, indeed, if i use amqpTemplate.convertAndSend(), and the queue does'nt existing, nothing will happen, but i have to know if the queue configured is existing, but not create it...because we use spring amqp.

Moreover how we can configure the name of the queue in this method (amqpTemplate.convertAndSend()) because it takes one string argument but when it is configured in spring i don't have to configure in the code i want to use spring configuration ...

thanks....

Cyril
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
This email was Virus checked by Pragma Consult Security Gateway.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--
This email was Virus checked by Pragma Consult Security Gateway.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/0266851e/attachment.htm>

From Cyril.LECLERC at pragmaconsult.lu  Fri Feb 22 19:23:59 2013
From: Cyril.LECLERC at pragmaconsult.lu (Cyril LECLERC)
Date: Fri, 22 Feb 2013 19:23:59 +0000
Subject: [rabbitmq-discuss] RE :  RE :  test of a existing queue
In-Reply-To: <5127A8A6.5030002@rabbitmq.com>
References: <6E837D1EC02AE749B0DCC0A627EFF8C316DBFA@SVR-EXC-01.PRAGMA.INT>,
	<1218652985.8049334.1361550174533.JavaMail.root@vmware.com>
	<6E837D1EC02AE749B0DCC0A627EFF8C316DC1A@SVR-EXC-01.PRAGMA.INT>,
	<5127A8A6.5030002@rabbitmq.com>
Message-ID: <6E837D1EC02AE749B0DCC0A627EFF8C316DC59@SVR-EXC-01.PRAGMA.INT>

thank you very much...
________________________________________
De : rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] de la part de Matthias Radestock [matthias at rabbitmq.com]
Date d'envoi : vendredi 22 f?vrier 2013 18:19
? : Discussions about RabbitMQ
Cc: Cyril LECLERC
Objet : Re: [rabbitmq-discuss] RE :  test of a existing queue

Cyril,

On 22/02/13 17:00, Cyril LECLERC wrote:
> thank you for your reactivity

The Spring-AMQP forum -
http://forum.springsource.org/forumdisplay.php?74-AMQP - is a better
place to ask these questions.

Regards,

Matthias.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Fri Feb 22 19:57:09 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 22 Feb 2013 19:57:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ and log settings
In-Reply-To: <a4edcc1b-18d8-4201-b176-8ad06cdc4c02@googlegroups.com>
References: <BANLkTikxaAnN8-cjrK7v4W1GR9DVAJa+vA@mail.gmail.com>	<BANLkTi=rAHPhk=CoUQgQHWnDz3c6D3zniA@mail.gmail.com>
	<BANLkTikjCh=tqZq+C4o0aCQgm4TAxbFD+A@mail.gmail.com>
	<4E0AC397.5000204@rabbitmq.com>
	<a4edcc1b-18d8-4201-b176-8ad06cdc4c02@googlegroups.com>
Message-ID: <5127CD95.8010902@rabbitmq.com>

On 22/02/13 19:05, Sandeep Aggarwal wrote:
> Although I can use rotate_logs from the command prompt or even in a
> batch file, do we have something from RabbitMQ configuration where I can
> set things like the rotation cycle, size etc.

Nope. I don't use Windows much, but I'd hope that it provides you with 
some tools/services to, say, invoke scripts on a given schedule.

Matthias.

From jerryk at rbcon.com  Fri Feb 22 20:48:04 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 22 Feb 2013 12:48:04 -0800
Subject: [rabbitmq-discuss] Help understanding a crash report
In-Reply-To: <CAOQTPw72eph4Y41veC25QCUPMEJiEmFZsLLo+_uCWuURbT9Zsw@mail.gmail.com>
References: <CAOQTPw72eph4Y41veC25QCUPMEJiEmFZsLLo+_uCWuURbT9Zsw@mail.gmail.com>
Message-ID: <CAE0Sz=zmvh6Ph58n2SS8rJbywvdEK9PjFBUUnXOCsNKuAAub8Q@mail.gmail.com>

Hi, Simone...

I am relatively new to Rabbitmq and would appreciate help in
> troubleshooting a recurring issue on a cluster, apologies for the long
> email.
>

No problem!  Details are usually helpful...


> I run a 3 instances cluster in ec2, 2 disk nodes (A and B) 1 ram node (C),
> exchanges and queues are static and limited in number (less than 50), the
> volume of messages can reach a few thousands per second and the queues can
> occasionally grow up to a few hundred thousands until the processes manage
> to catch up, but this is well within our memory/disk high watermark.
> Rabbitmq is v. 2.8.4 on ubuntu 12.
>

2.8.4 is now getting a bit old, and was from the middle of a sequence of
bug fix releases, during which many things improved...  you might want to
consider upgrading.  Before you do, see remarks below.


> I would like to better understand the crash report and perhaps have some
> ideas on what went wrong and how to more effectively troubleshoot issues
> (what more info should I collect before restarting the nodes, erlang
> processes list, mnesia tables, ets tables etc).
>
> =CRASH REPORT==== 14-Feb-2013::10:36:54 ===
>   crasher:
>     initial call: rabbit_reader:init/4
>     pid: <*0.29283.387*>
>     registered_name: []
>     exception error: bad argument
>       in function  port_close/1
>          called as port_close(#Port<0.746540>)
>       in call from rabbit_net:maybe_fast_close/1
>       in call from rabbit_reader:start_connection/7
>     ancestors: [<0.29280.387>,rabbit_tcp_client_sup,rabbit_sup,<0.161.0>]
>     messages: []
>     links: [<0.29280.387>]
>     dictionary: [{{channel,10},
>                    {<0.29364.387>,{method,rabbit_framing_amqp_0_9_1}}},
>                   {{ch_pid,<0.29338.387>},{7,#Ref<0.0.2158.60093>}},
>                   {{ch_pid,<0.29333.387>},{6,#Ref<0.0.2158.60085>}},
>                   {{ch_pid,<0.29325.387>},{5,#Ref<0.0.2158.60053>}},
>                   {{channel,3},
>                    {<0.29313.387>,{method,rabbit_framing_amqp_0_9_1}}},
>                   {{ch_pid,<0.29305.387>},{2,#Ref<0.0.2158.60002>}},
>                   {{channel,4},
>                    {<0.29321.387>,{method,rabbit_framing_amqp_0_9_1}}},
>                   {{channel,11},
>                    {<0.29370.387>,{method,rabbit_framing_amqp_0_9_1}}},
>                   {{ch_pid,<0.29313.387>},{3,#Ref<0.0.2158.60017>}},
>                   {{ch_pid,<0.29299.387>},{1,#Ref<0.0.2158.59976>}},
>                   {{ch_pid,<0.29346.387>},{8,#Ref<0.0.2158.60112>}},
>                   {{ch_pid,<0.29370.387>},{11,#Ref<0.0.2158.60189>}},
>                   {{channel,7},
>                    {<0.29338.387>,{method,rabbit_framing_amqp_0_9_1}}},
>                   {{channel,9},
>                    {<0.29356.387>,{method,rabbit_framing_amqp_0_9_1}}},
>                   {{ch_pid,<0.29321.387>},{4,#Ref<0.0.2158.60034>}},
>                   {{ch_pid,<0.29364.387>},{10,#Ref<0.0.2158.60166>}},
>                   {{ch_pid,<0.29356.387>},{9,#Ref<0.0.2158.60140>}},
>                   {{channel,8},
>                    {<0.29346.387>,{method,rabbit_framing_amqp_0_9_1}}},
>                   {{channel,5},
>                    {<0.29325.387>,{method,rabbit_framing_amqp_0_9_1}}},
>                   {{channel,1},
>                    {<0.29299.387>,
>                     {content_body,
>                         {'basic.publish',0,<<"some_exchange">>,<<>>,false,
>                             false},
>                         1048189,
>                         {content,60,none,
>                             <<BYTES IN HERE>>,   --> this showed which
> process was sending the message
>                             rabbit_framing_amqp_0_9_1,
>                             [<<MORE BYTES IN HERE>>]  --> This I haven't
> been able to decode, it is fairly big, is it truncated?
>

Unfortunately, nothing springs to mind immediately to pursue from this...


> And in the logs we can find the pid *0.29283.387 *right before the crash:
>
> =INFO REPORT==== 14-Feb-2013::10:31:46 ===
> accepting AMQP connection <*0.29283.387*> (10.xx.xx.xx:58622 -> 10.
> xx.xx.xx:5672)
>
> =INFO REPORT==== 14-Feb-2013::10:31:46 ===
> accepting AMQP connection <0.29287.387> (10.xx.xx.xx:58623 -> 10.xx.xx.xx
> :5672)
>
> =WARNING REPORT==== 14-Feb-2013::10:32:27 ===
> closing AMQP connection <0.27107.387> (10.xx.xx.xx:50882 -> 10.xx.xx.xx
> :5672):
> connection_closed_abruptly
>

This could be pretty much anything, from client misbehavior to connection
disruption...

Looking at the rabbitmqctl report I have not been able to map the memory
> consumption to something specific yet.
>

I'd proceed with an upgrade to a more recent Rabbit...  check here first:

http://www.rabbitmq.com/blog/2012/11/19/breaking-things-with-rabbitmq-3-0/

And if none of the changes in 3.0.x are going to provide you short term
inconvenience, then try going straight to the latest 3.0.2; if there are
3.0 changes that you think will bother you or require changes to your apps
or infrastructure, then jump to 2.8.6 for now... it was the seventh and
last of the 2.8.x series and contains a pile of incremental fixes that may
help with this (otherwise tricky to diagnose from what we have available
right now) problem.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/7e6e08aa/attachment.htm>

From matthias at rabbitmq.com  Fri Feb 22 21:20:23 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 22 Feb 2013 21:20:23 +0000
Subject: [rabbitmq-discuss] Help understanding a crash report
In-Reply-To: <CAE0Sz=zmvh6Ph58n2SS8rJbywvdEK9PjFBUUnXOCsNKuAAub8Q@mail.gmail.com>
References: <CAOQTPw72eph4Y41veC25QCUPMEJiEmFZsLLo+_uCWuURbT9Zsw@mail.gmail.com>
	<CAE0Sz=zmvh6Ph58n2SS8rJbywvdEK9PjFBUUnXOCsNKuAAub8Q@mail.gmail.com>
Message-ID: <5127E117.9070307@rabbitmq.com>

On 22/02/13 20:48, Jerry Kuch wrote:
>     =CRASH REPORT==== 14-Feb-2013::10:36:54 ===
>
> This could be pretty much anything, from client misbehavior to
> connection disruption...

Indeed. And the resulting error report is spurious; it's essentially 
complaining that it can't close a connection because that connection is 
already dead. This was fixed in 2.8.7.

Which neatly brings me to the next point...

> And if none of the changes in 3.0.x are going to provide you short term
> inconvenience, then try going straight to the latest 3.0.2; if there are
> 3.0 changes that you think will bother you or require changes to your
> apps or infrastructure, then jump to 2.8.6 for now... it was the seventh
> and last of the 2.8.x series

Erhm. 2.8.7 was the eighth and last. So go with that if 3.0.2 is not an 
option.

Matthias.

From jerryk at rbcon.com  Fri Feb 22 22:14:46 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 22 Feb 2013 14:14:46 -0800
Subject: [rabbitmq-discuss] Help understanding a crash report
In-Reply-To: <5127E117.9070307@rabbitmq.com>
References: <CAOQTPw72eph4Y41veC25QCUPMEJiEmFZsLLo+_uCWuURbT9Zsw@mail.gmail.com>
	<CAE0Sz=zmvh6Ph58n2SS8rJbywvdEK9PjFBUUnXOCsNKuAAub8Q@mail.gmail.com>
	<5127E117.9070307@rabbitmq.com>
Message-ID: <CAE0Sz=z5=dAOTFX=iH5TL_e15c9eVF-Ddv9+_BQu7=0jvicCDw@mail.gmail.com>

On Fri, Feb 22, 2013 at 1:20 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Which neatly brings me to the next point...
>
>  And if none of the changes in 3.0.x are going to provide you short term
>> inconvenience, then try going straight to the latest 3.0.2; if there are
>> 3.0 changes that you think will bother you or require changes to your
>> apps or infrastructure, then jump to 2.8.6 for now... it was the seventh
>> and last of the 2.8.x series
>>
>
> Erhm. 2.8.7 was the eighth and last. So go with that if 3.0.2 is not an
> option.
>

Ooops, yes, I stand corrected.  2.8.6 had lodged in my mind cracks because
it was the base version used for the then contemporary vFabric commercial
Rabbit release.

Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/f74a8a56/attachment.htm>

From christian.perone at gmail.com  Sat Feb 23 00:49:47 2013
From: christian.perone at gmail.com (Christian S. Perone)
Date: Fri, 22 Feb 2013 21:49:47 -0300
Subject: [rabbitmq-discuss] RabbitMQ dying
Message-ID: <CAMxMOAsD=EdjqkbTS-W0WUPPWitX3sdd6WccvukL1TE8wHuAyA@mail.gmail.com>

Hello, I'm facing some problems with different versions of RabbitMQ (2.7.1
and 3.0.2), and I couldn't
find any trace of problem in the logs (perhaps I'm looking the wrong log
file), anyway, the rabbitmq is dying after running well for some time, I'm
using only two queues and the messages are working on a rate of 132
msgs/sec, but after 2 or 3 hours the rabbitmq simple dies and the only log
I can see is from the kernel log (dmesg), with RabbitMQ 3.0.2:

[38178.105567] beam.smp[1514] general protection ip:4d8b48 sp:7f979f41e7a0
error:0 in beam.smp[400000+1af000]

... which looks pretty bad. The same message appeared with version 2.7.1
and all logs in /var/log/rabbitmq didn't showed anything that could be an
error, just info about connections, etc. Also, after I updated it to the
version 3.0.2, the only log that RabbitMQ touched was
/var/log/rabbitmq/startup_err, which contained the messages:

ls: cannot access /etc/rabbitmq/rabbitmq.conf.d: No such file or directory
Segmentation fault (core dumped)

Besides the conf error message the server worked for nearly 2 hours and
then died, but now it is showing the segfault message that wasn't show on
the 2.7.1 version.

I'm using Ubuntu server 12.04.2 (LTS) with kernel 3.2.0 (x86_64) and Erlang
v.5.8.5.

Does anyone already faced this problem or have any clue about what could be
causing this ?

Thanks !


-- 
Blog <http://pyevolve.sourceforge.net/wordpress/> |
Github<https://github.com/perone>
| Twitter <https://twitter.com/tarantulae>
"Forgive, O Lord, my little jokes on Thee, and I'll forgive Thy great big
joke on me."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/1e4645e2/attachment.htm>

From jerryk at rbcon.com  Sat Feb 23 00:55:23 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 22 Feb 2013 16:55:23 -0800
Subject: [rabbitmq-discuss] RabbitMQ dying
In-Reply-To: <CAMxMOAsD=EdjqkbTS-W0WUPPWitX3sdd6WccvukL1TE8wHuAyA@mail.gmail.com>
References: <CAMxMOAsD=EdjqkbTS-W0WUPPWitX3sdd6WccvukL1TE8wHuAyA@mail.gmail.com>
Message-ID: <CAE0Sz=xEPNZJRB4ucwdGj7-ACxbgwc=vVZ7rHdOPv+ZYpae+tQ@mail.gmail.com>

Hi, Christian:

Hello, I'm facing some problems with different versions of RabbitMQ (2.7.1
> and 3.0.2), and I couldn't
> find any trace of problem in the logs (perhaps I'm looking the wrong log
> file), anyway, the rabbitmq is dying after running well for some time, I'm
> using only two queues and the messages are working on a rate of 132
> msgs/sec, but after 2 or 3 hours the rabbitmq simple dies and the only log
> I can see is from the kernel log (dmesg), with RabbitMQ 3.0.2:
>

That's pretty tiny load... one wouldn't expect a Rabbit to stress much
under that.


> [38178.105567] beam.smp[1514] general protection ip:4d8b48 sp:7f979f41e7a0
> error:0 in beam.smp[400000+1af000]
>
> ... which looks pretty bad. The same message appeared with version 2.7.1
> and all logs in /var/log/rabbitmq didn't showed anything that could be an
> error, just info about connections, etc. Also, after I updated it to the
> version 3.0.2, the only log that RabbitMQ touched was
> /var/log/rabbitmq/startup_err, which contained the messages:
>

Egads...  that's your Erlang VM crashing hard.  Erlang R14B04 is a little
bit old, but was a pretty solid release.  You might try upgrading your
Erlang release to one of the newer R15s, although bits of this make me
wonder if something worse is afoot on this machine.


> ls: cannot access /etc/rabbitmq/rabbitmq.conf.d: No such file or directory
> Segmentation fault (core dumped)
>

Does the rabbitmq.conf.d directory and any of its contents exist?  What's
the story on permissions?


> Besides the conf error message the server worked for nearly 2 hours and
> then died, but now it is showing the segfault message that wasn't show on
> the 2.7.1 version.
>
> I'm using Ubuntu server 12.04.2 (LTS) with kernel 3.2.0 (x86_64) and
> Erlang v.5.8.5.
>
> Does anyone already faced this problem or have any clue about what could
> be causing this ?
>

I'd:

1. Upgrade Erlang
2. Possibly reinstall Rabbit

Segmentation faults of the Erlang VM are relatively rare, and it's not easy
to cause one from Rabbit's own code...  Usually if one sees one something
more wretched is afoot on the system....

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/31e22554/attachment.htm>

From christian.perone at gmail.com  Sat Feb 23 01:00:34 2013
From: christian.perone at gmail.com (Christian S. Perone)
Date: Fri, 22 Feb 2013 22:00:34 -0300
Subject: [rabbitmq-discuss] RabbitMQ dying
In-Reply-To: <CAE0Sz=xEPNZJRB4ucwdGj7-ACxbgwc=vVZ7rHdOPv+ZYpae+tQ@mail.gmail.com>
References: <CAMxMOAsD=EdjqkbTS-W0WUPPWitX3sdd6WccvukL1TE8wHuAyA@mail.gmail.com>
	<CAE0Sz=xEPNZJRB4ucwdGj7-ACxbgwc=vVZ7rHdOPv+ZYpae+tQ@mail.gmail.com>
Message-ID: <CAMxMOAuTB75Q+3KUEhCt8z8uGNg=k9VspvS2mbo+QrLteUmFFg@mail.gmail.com>

Hello Jerry, great thanks for the quick reply. I'll try to update the
Erlang VM to a newer one, the directory '/etc/rabbitmq/rabbitmq.conf.d'
didn't exist (I think it was removed on the upgrade process to the 3.0.2
version), but this message is only showing on the version 3.0.2, when I was
using the 2.7.1 the conf.d was present and the same thing happened, so I
think that this couldn't be the cause. I'll upgrade the Erlang and stress
it again to check how it works.


On Fri, Feb 22, 2013 at 9:55 PM, Jerry Kuch <jerryk at rbcon.com> wrote:

> Hi, Christian:
>
> Hello, I'm facing some problems with different versions of RabbitMQ (2.7.1
>> and 3.0.2), and I couldn't
>> find any trace of problem in the logs (perhaps I'm looking the wrong log
>> file), anyway, the rabbitmq is dying after running well for some time, I'm
>> using only two queues and the messages are working on a rate of 132
>> msgs/sec, but after 2 or 3 hours the rabbitmq simple dies and the only log
>> I can see is from the kernel log (dmesg), with RabbitMQ 3.0.2:
>>
>
> That's pretty tiny load... one wouldn't expect a Rabbit to stress much
> under that.
>
>
>> [38178.105567] beam.smp[1514] general protection ip:4d8b48
>> sp:7f979f41e7a0 error:0 in beam.smp[400000+1af000]
>>
>> ... which looks pretty bad. The same message appeared with version 2.7.1
>> and all logs in /var/log/rabbitmq didn't showed anything that could be an
>> error, just info about connections, etc. Also, after I updated it to the
>> version 3.0.2, the only log that RabbitMQ touched was
>> /var/log/rabbitmq/startup_err, which contained the messages:
>>
>
> Egads...  that's your Erlang VM crashing hard.  Erlang R14B04 is a little
> bit old, but was a pretty solid release.  You might try upgrading your
> Erlang release to one of the newer R15s, although bits of this make me
> wonder if something worse is afoot on this machine.
>
>
>> ls: cannot access /etc/rabbitmq/rabbitmq.conf.d: No such file or directory
>> Segmentation fault (core dumped)
>>
>
> Does the rabbitmq.conf.d directory and any of its contents exist?  What's
> the story on permissions?
>
>
>> Besides the conf error message the server worked for nearly 2 hours and
>> then died, but now it is showing the segfault message that wasn't show on
>> the 2.7.1 version.
>>
>> I'm using Ubuntu server 12.04.2 (LTS) with kernel 3.2.0 (x86_64) and
>> Erlang v.5.8.5.
>>
>> Does anyone already faced this problem or have any clue about what could
>> be causing this ?
>>
>
> I'd:
>
> 1. Upgrade Erlang
> 2. Possibly reinstall Rabbit
>
> Segmentation faults of the Erlang VM are relatively rare, and it's not
> easy to cause one from Rabbit's own code...  Usually if one sees one
> something more wretched is afoot on the system....
>
> Best regards,
> Jerry
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Blog <http://pyevolve.sourceforge.net/wordpress/> |
Github<https://github.com/perone>
| Twitter <https://twitter.com/tarantulae>
"Forgive, O Lord, my little jokes on Thee, and I'll forgive Thy great big
joke on me."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/aa6d2cd1/attachment.htm>

From jerryk at rbcon.com  Sat Feb 23 01:04:35 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Fri, 22 Feb 2013 17:04:35 -0800
Subject: [rabbitmq-discuss] RabbitMQ dying
In-Reply-To: <CAMxMOAuTB75Q+3KUEhCt8z8uGNg=k9VspvS2mbo+QrLteUmFFg@mail.gmail.com>
References: <CAMxMOAsD=EdjqkbTS-W0WUPPWitX3sdd6WccvukL1TE8wHuAyA@mail.gmail.com>
	<CAE0Sz=xEPNZJRB4ucwdGj7-ACxbgwc=vVZ7rHdOPv+ZYpae+tQ@mail.gmail.com>
	<CAMxMOAuTB75Q+3KUEhCt8z8uGNg=k9VspvS2mbo+QrLteUmFFg@mail.gmail.com>
Message-ID: <CAE0Sz=ztD7Bv2FOX1ST5HSH3ZwS4r-VhDyzXb-ZHqzrOAeqotA@mail.gmail.com>

On Fri, Feb 22, 2013 at 5:00 PM, Christian S. Perone <
christian.perone at gmail.com> wrote:

> Hello Jerry, great thanks for the quick reply. I'll try to update the
> Erlang VM to a newer one, the directory '/etc/rabbitmq/rabbitmq.conf.d'
> didn't exist (I think it was removed on the upgrade process to the 3.0.2
> version), but this message is only showing on the version 3.0.2, when I was
> using the 2.7.1 the conf.d was present and the same thing happened, so I
> think that this couldn't be the cause. I'll upgrade the Erlang and stress
> it again to check how it works.
>

Let us know how you make out.  It sounds like you're in a position where
it's safe to scrub your Ubuntu boxes of both Erlang and Rabbit, and build
up from fresh...

Also, be mindful that there are config file differences between such
disparate versions, so leftovers from an old Rabbit may antagonize a new
one.  Still, one would expect something less horrendous than a mute
segmentation fault....

Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130222/b14468a9/attachment.htm>

From Cyril.LECLERC at pragmaconsult.lu  Sat Feb 23 08:28:58 2013
From: Cyril.LECLERC at pragmaconsult.lu (Cyril LECLERC)
Date: Sat, 23 Feb 2013 08:28:58 +0000
Subject: [rabbitmq-discuss] RE :  RE :  test of a existing queue
In-Reply-To: <6E837D1EC02AE749B0DCC0A627EFF8C316DC41@SVR-EXC-01.PRAGMA.INT>
References: <6E837D1EC02AE749B0DCC0A627EFF8C316DC1A@SVR-EXC-01.PRAGMA.INT>,
	<551480351.8094091.1361555898061.JavaMail.root@vmware.com>,
	<6E837D1EC02AE749B0DCC0A627EFF8C316DC41@SVR-EXC-01.PRAGMA.INT>
Message-ID: <6E837D1EC02AE749B0DCC0A627EFF8C316DCC8@SVR-EXC-01.PRAGMA.INT>

excuse me i'm french i don't want to say it is a shame i want say it is not coooooollllll !!!my traduction is not very good sometimes... ;)
________________________________
De : Cyril LECLERC
Date d'envoi : vendredi 22 f?vrier 2013 20:20
? : Discussions about RabbitMQ
Objet : RE : [rabbitmq-discuss] RE : test of a existing queue

We could, perhaps add a convenience method to RabbitAdmin (boolean queueExists(String queueName)).

it is an great idea  but for a better configuration maybe not in rabbitAdmin, why? for example i don't want my application have a admin right on rabbitmq, moreoever i don't use the rabbit:admin tag because i don't need it, on AmpqTemplate object it is more usefull but it is a good idea!!!!

1? The queue specified on the <rabbit:template/> is ONLY used for the receive() methods - it is the default queue used if no queue is specified via the receive API.

ahhhhhh ok  bugt why it is a shame!!!!



2 ? Like I said, you don't SEND to a queue, you send to an exchange.


yes but not exactly....(exchange or routing key if you are in case queue connected to exchange by default).So how i can declare a exchange using spring in the code? because correct me if i do a mistake but it is an exchange or a "routing key" otherwise why it is working if y put my queue name? (direct exhange...)

I don't want at all any configuration in the code beacause all my variables in spring are externalized in a conf file!!!!

do you know how many device i can connect on rabbit mq maximum (consumers, iphone, android, jar....) with a good server ??? i'm sorry i've search lot of solutions befor contact you.. i wonder about the rapidity of yours responses....

Thank you very much


________________________________
De : rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] de la part de Gary Russell [grussell at vmware.com]
Date d'envoi : vendredi 22 f?vrier 2013 18:58
? : Discussions about RabbitMQ
Objet : Re: [rabbitmq-discuss] RE : test of a existing queue

We could, perhaps add a convenience method to RabbitAdmin (boolean queueExists(String queueName)).

Feel free to open a New Feature issue: https://jira.springsource.org/browse/AMQP

The queue specified on the <rabbit:template/> is ONLY used for the receive() methods - it is the default queue used if no queue is specified via the receive API.

Like I said, you don't SEND to a queue, you send to an exchange.

________________________________
From: "Cyril LECLERC" <Cyril.LECLERC at pragmaconsult.lu>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Friday, February 22, 2013 12:00:09 PM
Subject: [rabbitmq-discuss] RE :  test of a existing queue

thank you for your reactivity

channel.queueDeclarePassive(queueName) will throw an exception if the queue doesn't exist.

Yes but the solution needs to use a Channel object, use @Inject of the factory, and it is not a boolean method so utilisation of spring amqp has no avantage and more it closes the channel connection!!!!we have to declare az new channel because spring create one by default plus all my consumers...for the moment my code is like this (in a wicket appplication) :

    @Inject
    AmqpTemplate amqpTemplate;
    amqpTemplate.convertAndSend("queue", messageField.getValue().toString());

my spring configuration :

<!-- now we can use -->
    <context:property-placeholder location="${ext.properties.dir}" />

    <rabbit:connection-factory id="rabbitConnectionFactory"
        host="${config.amqp.server}" username="${config.amqp.username}" password="${config.amqp.password}" />

    <!-- Creates a org.springframework.amqp.rabbit.core.RabbitTemplate for access
        to the broker -->
    <rabbit:template id="amqpTemplate" connection-factory="rabbitConnectionFactory" />

    <!-- Creates a queue for consumers to retrieve messages -->
    <rabbit:queue id="queue" name="${config.amqp.queuename}" />

    <bean id="messageListener" class="lu.pragmaconsult.geocamp.receiver.MessageHandler" />

    <rabbit:listener-container
        connection-factory="rabbitConnectionFactory" concurrency="${config.amqp.nbconsumer}"
        auto-startup="true">
        <rabbit:listener queues="queue" ref="messageListener" />
    </rabbit:listener-container>


If i use your advice :

    @Inject
    AmqpTemplate amqpTemplate;

    Channel channel;
    @Inject
    ConnectionFactory rabbitConnectionFactory;

    amqpTemplate.convertAndSend("queue", messageField.getValue().toString());


channel =(Channel) rabbitConnectionFactory.createConnection().createChannel(true);

                try {
                    channel.queueDeclarePassive("queue/GeoCampQueue3");
                } catch (IOException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                }

                //maybe add the code for verify the queue
                amqpTemplate.convertAndSend("queue/GeoCampQueue3", messageField.getValue().toString());


it is not what i want moreover i want the name of queue come from spring and not in code.


No, you can't specify the queue name in the send methods - you don't send to a queue, you send to an exchange, and it routes it to the queue.

if the queue is binding to the exchange by default, it is in direct so the queue name is my "routing key", if i put the name of the exchange ("") nothing happening

i try this :

    <rabbit:template id="amqpTemplate" connection-factory="rabbitConnectionFactory" queue="queue" exchange="" routing-key=""/>

but the exchange and routing key is like this by default, so my template don't send automatiqueliy to my queue directly by spring configuration.....

have you got any id?as????

________________________________________
De : rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] de la part de Gary Russell [grussell at vmware.com]
Date d'envoi : vendredi 22 f?vrier 2013 17:22
? : Discussions about RabbitMQ
Objet : Re: [rabbitmq-discuss] test of a existing queue

channel.queueDeclarePassive(queueName) will throw an exception if the queue doesn't exist.

You can get a channel by

Channel channel = factory.createConnection().createChannel(false);

where factory is a reference to the CachingConnectionFactory.

No, you can't specify the queue name in the send methods - you don't send to a queue, you send to an exchange, and it routes it to the queue.

----- Original Message -----
From: "Cyril LECLERC" <Cyril.LECLERC at pragmaconsult.lu>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Friday, February 22, 2013 10:54:53 AM
Subject: [rabbitmq-discuss] test of a existing queue

Hello,

How we can test if a queue exits in application? Without the queueDeclare because it is not what i want, indeed, if i use amqpTemplate.convertAndSend(), and the queue does'nt existing, nothing will happen, but i have to know if the queue configured is existing, but not create it...because we use spring amqp.

Moreover how we can configure the name of the queue in this method (amqpTemplate.convertAndSend()) because it takes one string argument but when it is configured in spring i don't have to configure in the code i want to use spring configuration ...

thanks....

Cyril
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
This email was Virus checked by Pragma Consult Security Gateway.

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


--
This email was Virus checked by Pragma Consult Security Gateway.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130223/7751ba2a/attachment.htm>

From matthias at rabbitmq.com  Sat Feb 23 13:28:43 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 23 Feb 2013 13:28:43 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <512658C5.3060206@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>, <511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navt!
	eq.com>, <5125579B.7060707@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A517@hq-ex-mb03.ad.navteq.com>,
	<51263223.6090002@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A518@hq-ex-mb03.ad.navteq.com>,
	<51263B96.8050507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A51B@hq-ex-mb03.ad.navteq.com>
	<512658C5.3060206@rabbitmq .com>
Message-ID: <5128C40B.4080400@rabbitmq.com>

Peter,

On 21/02/13 17:26, Matthias Radestock wrote:
> After staring at the code for a couple of days I have identified and
> fixed one scenarios in which a connection could end up in the state you
> are seeing. It happens only after an illegal sequence of channel.close
> followed by basic.publish on the same channel, and only during a very
> narrow window in conjunction with flow control. So I doubt this is the
> cause, but it would still be worth giving that fix a try, just to rule
> out that scenario. I will send you a patch by private email.

After staring at the code some more, it turns out that there is a 
*legal* sequence of AMQP commands that triggers the bug: a bunch of 
basic.publish commands followed by a channel.close, followed by a 
basic.publish on *another* channel.

The precise conditions are very intricate and highly timing sensitive, 
which explains why we have not seen any prior reports of this even 
though the bug was introduced nearly a year ago, in 2.8.0.

The patch I sent you fixes the problem and will appear in the next 
RabbitMQ bugfix release.

Thank you very much for the detailed reports and all the effort you 
invested in helping us track this down.

Regards,

Matthias.

From grussell at vmware.com  Sat Feb 23 15:43:14 2013
From: grussell at vmware.com (Gary Russell)
Date: Sat, 23 Feb 2013 07:43:14 -0800 (PST)
Subject: [rabbitmq-discuss] RE :  RE :  test of a existing queue
In-Reply-To: <6E837D1EC02AE749B0DCC0A627EFF8C316DCC8@SVR-EXC-01.PRAGMA.INT>
Message-ID: <1970953255.8379374.1361634194239.JavaMail.root@vmware.com>

You make a valid point about not putting this on RabbitAdmin, but I don't think it belongs on RabbitTemplate either; maybe a new utility class would be better. But I agree with the general concept of making this easier (that's what Spring's all about, after all). 


The fact that the queue on the template is only used for receive() is consistent with the AMQP model. We don't send messages to queues, we send them to exchanges, the fact that the default exchange happens to route with a key that is the queue name is not relevant. 


As Matthias said, we should move this discussion to the Spring-AMQP forum. 




Regarding your sizing question, you should ask that in another thread, because it is not in my bailiwick. 

----- Original Message -----

From: "Cyril LECLERC" <Cyril.LECLERC at pragmaconsult.lu> 
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com> 
Sent: Saturday, February 23, 2013 3:28:58 AM 
Subject: [rabbitmq-discuss] RE : RE : test of a existing queue 


excuse me i'm french i don't want to say it is a shame i want say it is not coooooollllll !!!my traduction is not very good sometimes... ;) 



De : Cyril LECLERC 
Date d'envoi : vendredi 22 f?vrier 2013 20:20 
? : Discussions about RabbitMQ 
Objet : RE : [rabbitmq-discuss] RE : test of a existing queue 




We could, perhaps add a convenience method to RabbitAdmin (boolean queueExists(String queueName)). 

it is an great idea but for a better configuration maybe not in rabbitAdmin, why? for example i don't want my application have a admin right on rabbitmq, moreoever i don't use the rabbit:admin tag because i don't need it, on AmpqTemplate object it is more usefull but it is a good idea!!!! 


1? The queue specified on the <rabbit:template/> is ONLY used for the receive() methods - it is the default queue used if no queue is specified via the receive API. 

ahhhhhh ok bugt why it is a shame!!!! 



2 ? Like I said, you don't SEND to a queue, you send to an exchange. 


yes but not exactly....(exchange or routing key if you are in case queue connected to exchange by default).So how i can declare a exchange using spring in the code? because correct me if i do a mistake but it is an exchange or a "routing key" otherwise why it is working if y put my queue name? (direct exhange...) 

I don't want at all any configuration in the code beacause all my variables in spring are externalized in a conf file!!!! 

do you know how many device i can connect on rabbit mq maximum (consumers, iphone, android, jar....) with a good server ??? i'm sorry i've search lot of solutions befor contact you.. i wonder about the rapidity of yours responses.... 

Thank you very much 


<<snip>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130223/80c00c2c/attachment.htm>

From christian.perone at gmail.com  Sat Feb 23 20:08:45 2013
From: christian.perone at gmail.com (Christian S. Perone)
Date: Sat, 23 Feb 2013 17:08:45 -0300
Subject: [rabbitmq-discuss] RabbitMQ dying
In-Reply-To: <CAE0Sz=ztD7Bv2FOX1ST5HSH3ZwS4r-VhDyzXb-ZHqzrOAeqotA@mail.gmail.com>
References: <CAMxMOAsD=EdjqkbTS-W0WUPPWitX3sdd6WccvukL1TE8wHuAyA@mail.gmail.com>
	<CAE0Sz=xEPNZJRB4ucwdGj7-ACxbgwc=vVZ7rHdOPv+ZYpae+tQ@mail.gmail.com>
	<CAMxMOAuTB75Q+3KUEhCt8z8uGNg=k9VspvS2mbo+QrLteUmFFg@mail.gmail.com>
	<CAE0Sz=ztD7Bv2FOX1ST5HSH3ZwS4r-VhDyzXb-ZHqzrOAeqotA@mail.gmail.com>
Message-ID: <CAMxMOAsjHy5T4Neh2jJgHd-9Z3tO+JEDFeYkB-cJCUvE_=WjFA@mail.gmail.com>

I tried to upgrade Erlang but without success, the same segfault appeared
on the syslog, so I purged everything (config files, log files, etc.)
related to erlang and Rabbitmq and installed again the 2.7.1 version as
well the default erlang ubuntu version and the message is still appearing
after some time of work:

[19955.696882] beam.smp[4356]: segfault at 8 ip 00000000004d8c50 sp
00007ff57f8e67a0 error 4 in beam.smp[400000+1af000]

Is there any way to debug this ?

Thanks !


On Fri, Feb 22, 2013 at 10:04 PM, Jerry Kuch <jerryk at rbcon.com> wrote:

> On Fri, Feb 22, 2013 at 5:00 PM, Christian S. Perone <
> christian.perone at gmail.com> wrote:
>
>> Hello Jerry, great thanks for the quick reply. I'll try to update the
>> Erlang VM to a newer one, the directory '/etc/rabbitmq/rabbitmq.conf.d'
>> didn't exist (I think it was removed on the upgrade process to the 3.0.2
>> version), but this message is only showing on the version 3.0.2, when I was
>> using the 2.7.1 the conf.d was present and the same thing happened, so I
>> think that this couldn't be the cause. I'll upgrade the Erlang and stress
>> it again to check how it works.
>>
>
> Let us know how you make out.  It sounds like you're in a position where
> it's safe to scrub your Ubuntu boxes of both Erlang and Rabbit, and build
> up from fresh...
>
> Also, be mindful that there are config file differences between such
> disparate versions, so leftovers from an old Rabbit may antagonize a new
> one.  Still, one would expect something less horrendous than a mute
> segmentation fault....
>
> Jerry
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Blog <http://pyevolve.sourceforge.net/wordpress/> |
Github<https://github.com/perone>
| Twitter <https://twitter.com/tarantulae>
"Forgive, O Lord, my little jokes on Thee, and I'll forgive Thy great big
joke on me."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130223/13a821e8/attachment.htm>

From jerryk at rbcon.com  Sat Feb 23 20:33:59 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Sat, 23 Feb 2013 12:33:59 -0800
Subject: [rabbitmq-discuss] RabbitMQ dying
In-Reply-To: <CAMxMOAsjHy5T4Neh2jJgHd-9Z3tO+JEDFeYkB-cJCUvE_=WjFA@mail.gmail.com>
References: <CAMxMOAsD=EdjqkbTS-W0WUPPWitX3sdd6WccvukL1TE8wHuAyA@mail.gmail.com>
	<CAE0Sz=xEPNZJRB4ucwdGj7-ACxbgwc=vVZ7rHdOPv+ZYpae+tQ@mail.gmail.com>
	<CAMxMOAuTB75Q+3KUEhCt8z8uGNg=k9VspvS2mbo+QrLteUmFFg@mail.gmail.com>
	<CAE0Sz=ztD7Bv2FOX1ST5HSH3ZwS4r-VhDyzXb-ZHqzrOAeqotA@mail.gmail.com>
	<CAMxMOAsjHy5T4Neh2jJgHd-9Z3tO+JEDFeYkB-cJCUvE_=WjFA@mail.gmail.com>
Message-ID: <CAE0Sz=wofdkohFzZttvJf+0GbypsaqGXkfE1soFrZuFAEphrUQ@mail.gmail.com>

I realize this might be more of a PITA than you have the stomach for, but
can you scare up debug symbols for that version of Erlang as well as
apt-get the source?  That might let you look at the core file that's
generated during the segfault (assuming you're getting one, are you?) and
see where specifically it's croaking...

It might also be worth running this problem and its history and particulars
by the erlang-bugs mailing list and see if any of the VM maintainers
recognize it...

http://erlang.org/mailman/listinfo/erlang-bugs

Best regards,
Jerry

On Sat, Feb 23, 2013 at 12:08 PM, Christian S. Perone <
christian.perone at gmail.com> wrote:

> I tried to upgrade Erlang but without success, the same segfault appeared
> on the syslog, so I purged everything (config files, log files, etc.)
> related to erlang and Rabbitmq and installed again the 2.7.1 version as
> well the default erlang ubuntu version and the message is still appearing
> after some time of work:
>
> [19955.696882] beam.smp[4356]: segfault at 8 ip 00000000004d8c50 sp
> 00007ff57f8e67a0 error 4 in beam.smp[400000+1af000]
>
> Is there any way to debug this ?
>
> Thanks !
>
>
> On Fri, Feb 22, 2013 at 10:04 PM, Jerry Kuch <jerryk at rbcon.com> wrote:
>
>> On Fri, Feb 22, 2013 at 5:00 PM, Christian S. Perone <
>> christian.perone at gmail.com> wrote:
>>
>>> Hello Jerry, great thanks for the quick reply. I'll try to update the
>>> Erlang VM to a newer one, the directory '/etc/rabbitmq/rabbitmq.conf.d'
>>> didn't exist (I think it was removed on the upgrade process to the 3.0.2
>>> version), but this message is only showing on the version 3.0.2, when I was
>>> using the 2.7.1 the conf.d was present and the same thing happened, so I
>>> think that this couldn't be the cause. I'll upgrade the Erlang and stress
>>> it again to check how it works.
>>>
>>
>> Let us know how you make out.  It sounds like you're in a position where
>> it's safe to scrub your Ubuntu boxes of both Erlang and Rabbit, and build
>> up from fresh...
>>
>> Also, be mindful that there are config file differences between such
>> disparate versions, so leftovers from an old Rabbit may antagonize a new
>> one.  Still, one would expect something less horrendous than a mute
>> segmentation fault....
>>
>> Jerry
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Blog <http://pyevolve.sourceforge.net/wordpress/> | Github<https://github.com/perone>
> | Twitter <https://twitter.com/tarantulae>
> "Forgive, O Lord, my little jokes on Thee, and I'll forgive Thy great big
> joke on me."
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130223/7f38b958/attachment.htm>

From mmistroni at gmail.com  Sat Feb 23 22:07:59 2013
From: mmistroni at gmail.com (Marco Mistroni)
Date: Sat, 23 Feb 2013 22:07:59 +0000
Subject: [rabbitmq-discuss] Connecting to a remote rabbitmq server
Message-ID: <CAF=CqfsWHb0e6C6RnMUg_iuvhE8V7+bNiaLM7poPyK=kVw2n0g@mail.gmail.com>

HI all
 i followed the sender/receiver tutorial for connecting to a rabbitmq
server running on localhost

i have then installed rabbitmq on my VPS (Ubuntu server) and tried to run
sender.py but got hte following error

=INFO REPORT==== 23-Feb-2013::22:05:28 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:44821

=INFO REPORT==== 23-Feb-2013::22:05:28 ===
starting TCP connection <0.797.8> from 127.0.0.1:44821

=ERROR REPORT==== 23-Feb-2013::22:05:28 ===
exception on TCP connection <0.797.8> from 127.0.0.1:44821
{bad_header,<<65,77,81,80,0,0,9,1>>}


that sounds bizzarre because the rabbitmq server is running, as i can see
from the output of the command rabbitmqctl status

Status of node rabbit at worldcorpservices ...
[{running_applications,[{rabbit,"RabbitMQ","1.6.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.10"},
                        {os_mon,"CPO  CXC 138 46","2.2.2"},
                        {sasl,"SASL  CXC 138 11","2.1.6"},
                        {stdlib,"ERTS  CXC 138 10","1.16.2"},
                        {kernel,"ERTS  CXC 138 10","2.13.2"}]},
 {nodes,[rabbit at worldcorpservices]},
 {running_nodes,[rabbit at worldcorpservices]}]
...done.


what am i doing wrong?  i am just using exactly the same sender.py as in
the tutorials

w/kindest regards
 marco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130223/48aa634f/attachment.htm>

From mmistroni at gmail.com  Sat Feb 23 22:09:02 2013
From: mmistroni at gmail.com (Marco Mistroni)
Date: Sat, 23 Feb 2013 22:09:02 +0000
Subject: [rabbitmq-discuss] RabbitMq on Ubuntu Server
Message-ID: <CAF=Cqfu2Yjv1n4fgOV0HSLhCnn-JSU5Jk4Rns8w0YXOCd=tBKQ@mail.gmail.com>

Hi all
 sorry i realized i have sent this message with an incorrect subject i
followed the sender/receiver tutorial for connecting to a rabbitmq server
running on localhost


> i have then installed rabbitmq on my VPS (Ubuntu server) and tried to run
> sender.py but got hte following error
>
> =INFO REPORT==== 23-Feb-2013::22:05:28 ===
> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:44821
>
> =INFO REPORT==== 23-Feb-2013::22:05:28 ===
> starting TCP connection <0.797.8> from 127.0.0.1:44821
>
> =ERROR REPORT==== 23-Feb-2013::22:05:28 ===
> exception on TCP connection <0.797.8> from 127.0.0.1:44821
> {bad_header,<<65,77,81,80,0,0,9,1>>}
>
>
> that sounds bizzarre because the rabbitmq server is running, as i can see
> from the output of the command rabbitmqctl status
>
> Status of node rabbit at worldcorpservices ...
> [{running_applications,[{rabbit,"RabbitMQ","1.6.0"},
>                         {mnesia,"MNESIA  CXC 138 12","4.4.10"},
>                         {os_mon,"CPO  CXC 138 46","2.2.2"},
>                         {sasl,"SASL  CXC 138 11","2.1.6"},
>                         {stdlib,"ERTS  CXC 138 10","1.16.2"},
>                         {kernel,"ERTS  CXC 138 10","2.13.2"}]},
>  {nodes,[rabbit at worldcorpservices]},
>  {running_nodes,[rabbit at worldcorpservices]}]
> ...done.
>
>
> what am i doing wrong?  i am just using exactly the same sender.py as in
> the tutorials
>
> w/kindest regards
>  marco
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130223/b1f383d4/attachment.htm>

From matthias at rabbitmq.com  Sun Feb 24 00:10:10 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 24 Feb 2013 00:10:10 +0000
Subject: [rabbitmq-discuss] RabbitMq on Ubuntu Server
In-Reply-To: <CAF=Cqfu2Yjv1n4fgOV0HSLhCnn-JSU5Jk4Rns8w0YXOCd=tBKQ@mail.gmail.com>
References: <CAF=Cqfu2Yjv1n4fgOV0HSLhCnn-JSU5Jk4Rns8w0YXOCd=tBKQ@mail.gmail.com>
Message-ID: <51295A62.9000606@rabbitmq.com>

Marco,

On 23/02/13 22:09, Marco Mistroni wrote:
>     =ERROR REPORT==== 23-Feb-2013::22:05:28 ===
>     exception on TCP connection <0.797.8> from 127.0.0.1:44821
>     {bad_header,<<65,77,81,80,0,0,9,1>>}

That means the client tried to talk to the server using a protocol the 
server doesn't understand. In particular, the above indicates AMQP 
0-9-1, whereas...

>     [{running_applications,[{rabbit,"RabbitMQ","1.6.0"},

that is RabbitMQ 1.6.0, which only speaks AMQP 0-8.

You should upgrade to a more recent rabbit.

I am curious though, how did you end up with such an ancient version of 
RabbitMQ? 1.6.0 was released nearly four years ago; there have been more 
than thirty RabbitMQ releases since then!

Regards,

Matthias.

From jerryk at rbcon.com  Sun Feb 24 01:48:15 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Sat, 23 Feb 2013 17:48:15 -0800
Subject: [rabbitmq-discuss] Connecting to a remote rabbitmq server
In-Reply-To: <CAF=CqfsWHb0e6C6RnMUg_iuvhE8V7+bNiaLM7poPyK=kVw2n0g@mail.gmail.com>
References: <CAF=CqfsWHb0e6C6RnMUg_iuvhE8V7+bNiaLM7poPyK=kVw2n0g@mail.gmail.com>
Message-ID: <CAE0Sz=wKVhB8+BWWS+qt2ceJye9X_0wng5JY8327Z5kQZ9U9AQ@mail.gmail.com>

On Sat, Feb 23, 2013 at 2:07 PM, Marco Mistroni <mmistroni at gmail.com> wrote:

>  i followed the sender/receiver tutorial for connecting to a rabbitmq
> server running on localhost
>
> i have then installed rabbitmq on my VPS (Ubuntu server) and tried to run
> sender.py but got hte following error
>
> =INFO REPORT==== 23-Feb-2013::22:05:28 ===
> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:44821
>
> =INFO REPORT==== 23-Feb-2013::22:05:28 ===
> starting TCP connection <0.797.8> from 127.0.0.1:44821
>
> =ERROR REPORT==== 23-Feb-2013::22:05:28 ===
> exception on TCP connection <0.797.8> from 127.0.0.1:44821
> {bad_header,<<65,77,81,80,0,0,9,1>>}
>
>
> that sounds bizzarre because the rabbitmq server is running, as i can see
> from the output of the command rabbitmqctl status
>
> Status of node rabbit at worldcorpservices ...
> [{running_applications,[{rabbit,"RabbitMQ","1.6.0"},
>                         {mnesia,"MNESIA  CXC 138 12","4.4.10"},
>                         {os_mon,"CPO  CXC 138 46","2.2.2"},
>                         {sasl,"SASL  CXC 138 11","2.1.6"},
>                         {stdlib,"ERTS  CXC 138 10","1.16.2"},
>                         {kernel,"ERTS  CXC 138 10","2.13.2"}]},
>  {nodes,[rabbit at worldcorpservices]},
>  {running_nodes,[rabbit at worldcorpservices]}]
> ...done.
>

That RabbitMQ version of 1.6.0 is really quite ancient... several years...
Current is 3.0.2.

The error is because the AMQP version your client is trying to negotiate
doesn't agree with that old Rabbit.  You're best off updating for a whole
host of reasons...

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130223/70d03593/attachment.htm>

From mmistroni at gmail.com  Sun Feb 24 15:45:21 2013
From: mmistroni at gmail.com (Marco Mistroni)
Date: Sun, 24 Feb 2013 15:45:21 +0000
Subject: [rabbitmq-discuss] RabbitMq on Ubuntu Server
In-Reply-To: <51295A62.9000606@rabbitmq.com>
References: <CAF=Cqfu2Yjv1n4fgOV0HSLhCnn-JSU5Jk4Rns8w0YXOCd=tBKQ@mail.gmail.com>
	<51295A62.9000606@rabbitmq.com>
Message-ID: <CAF=Cqfs1roxTtb5nC8A6Q5LN4qpvdsyM06HheEhesQMRppxdEw@mail.gmail.com>

HI
 thanks all for sorting me out....
i just downloaded the package via apt-get on my ubuntu server, forgetting
that i am running 9.04 server (quite old)

i m going to install rabbitmq 'manually'

w/kindest regarfds
 marco

On Sun, Feb 24, 2013 at 12:10 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Marco,
>
>
> On 23/02/13 22:09, Marco Mistroni wrote:
>
>>     =ERROR REPORT==== 23-Feb-2013::22:05:28 ===
>>     exception on TCP connection <0.797.8> from 127.0.0.1:44821
>>     {bad_header,<<65,77,81,80,0,0,**9,1>>}
>>
>
> That means the client tried to talk to the server using a protocol the
> server doesn't understand. In particular, the above indicates AMQP 0-9-1,
> whereas...
>
>
>      [{running_applications,[{**rabbit,"RabbitMQ","1.6.0"},
>>
>
> that is RabbitMQ 1.6.0, which only speaks AMQP 0-8.
>
> You should upgrade to a more recent rabbit.
>
> I am curious though, how did you end up with such an ancient version of
> RabbitMQ? 1.6.0 was released nearly four years ago; there have been more
> than thirty RabbitMQ releases since then!
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130224/a6e0d272/attachment.htm>

From steve.flitcroft at gmail.com  Mon Feb 25 00:44:30 2013
From: steve.flitcroft at gmail.com (steve flitcroft)
Date: Sun, 24 Feb 2013 16:44:30 -0800 (PST)
Subject: [rabbitmq-discuss] 3.02 numerous log error reports
Message-ID: <164492e1-b6ab-4df9-bb52-c3a24e9fc80a@googlegroups.com>

Hi,

I am running a single rmp node on version 3.02, with webstomp utilizing 
stomp.js, this is hosted on Joyent SmartOS.

The error logs are filled with the following

=ERROR REPORT==== 25-Feb-2013::00:22:00 ===
** Generic server <0.26372.31> terminating
** Last message in was {inet_async,#Port<0.17264>,6622,{error,econnaborted}}
** When Server state == {state,{rabbit_networking,start_client,[]},
#Port<0.17264>,6622}
** Reason for termination ==
** {accept_failed,econnaborted}
=ERROR REPORT==== 25-Feb-2013::00:22:05 ===
error on AMQP connection <0.26419.31>: enotconn
=ERROR REPORT==== 25-Feb-2013::00:22:10 ===
error on AMQP connection <0.26428.31>: enotconn
=ERROR REPORT==== 25-Feb-2013::00:22:15 ===
** Generic server <0.26409.31> terminating
** Last message in was {inet_async,#Port<0.17264>,7561,{error,econnaborted}}
** When Server state == {state,{rabbit_networking,start_client,[]},
#Port<0.17264>,7561}
** Reason for termination ==
** {accept_failed,econnaborted}
=ERROR REPORT==== 25-Feb-2013::00:22:20 ===
error on AMQP connection <0.26442.31>: enotconn
=ERROR REPORT==== 25-Feb-2013::00:22:25 ===
error on AMQP connection <0.26454.31>: enotconn
=ERROR REPORT==== 25-Feb-2013::00:22:30 ===
error on AMQP connection <0.26460.31>: enotconn
=ERROR REPORT==== 25-Feb-2013::00:22:35 ===
** Generic server <0.26434.31> terminating
** Last message in was {inet_async,#Port<0.17264>,8894,{error,econnaborted}}
** When Server state == {state,{rabbit_networking,start_client,[]},
#Port<0.17264>,8894}

Everything is functioning correctly but the amount of the error reports 
does concern.

Should I be worried?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130224/94880236/attachment.htm>

From steve.flitcroft at gmail.com  Mon Feb 25 00:45:50 2013
From: steve.flitcroft at gmail.com (steve flitcroft)
Date: Sun, 24 Feb 2013 16:45:50 -0800 (PST)
Subject: [rabbitmq-discuss] 3.02 numerous log error reports
In-Reply-To: <164492e1-b6ab-4df9-bb52-c3a24e9fc80a@googlegroups.com>
References: <164492e1-b6ab-4df9-bb52-c3a24e9fc80a@googlegroups.com>
Message-ID: <f7c20a3c-3ee5-48b4-9863-b7f4ad5141af@googlegroups.com>

Forgot to also mention that I am running haproxy in front of the rmq node.

On Monday, 25 February 2013 00:44:30 UTC, steve flitcroft wrote:
>
> Hi,
>
> I am running a single rmp node on version 3.02, with webstomp utilizing 
> stomp.js, this is hosted on Joyent SmartOS.
>
> The error logs are filled with the following
>
> =ERROR REPORT==== 25-Feb-2013::00:22:00 ===
> ** Generic server <0.26372.31> terminating
> ** Last message in was 
> {inet_async,#Port<0.17264>,6622,{error,econnaborted}}
> ** When Server state == {state,{rabbit_networking,start_client,[]},
> #Port<0.17264>,6622}
> ** Reason for termination ==
> ** {accept_failed,econnaborted}
> =ERROR REPORT==== 25-Feb-2013::00:22:05 ===
> error on AMQP connection <0.26419.31>: enotconn
> =ERROR REPORT==== 25-Feb-2013::00:22:10 ===
> error on AMQP connection <0.26428.31>: enotconn
> =ERROR REPORT==== 25-Feb-2013::00:22:15 ===
> ** Generic server <0.26409.31> terminating
> ** Last message in was 
> {inet_async,#Port<0.17264>,7561,{error,econnaborted}}
> ** When Server state == {state,{rabbit_networking,start_client,[]},
> #Port<0.17264>,7561}
> ** Reason for termination ==
> ** {accept_failed,econnaborted}
> =ERROR REPORT==== 25-Feb-2013::00:22:20 ===
> error on AMQP connection <0.26442.31>: enotconn
> =ERROR REPORT==== 25-Feb-2013::00:22:25 ===
> error on AMQP connection <0.26454.31>: enotconn
> =ERROR REPORT==== 25-Feb-2013::00:22:30 ===
> error on AMQP connection <0.26460.31>: enotconn
> =ERROR REPORT==== 25-Feb-2013::00:22:35 ===
> ** Generic server <0.26434.31> terminating
> ** Last message in was 
> {inet_async,#Port<0.17264>,8894,{error,econnaborted}}
> ** When Server state == {state,{rabbit_networking,start_client,[]},
> #Port<0.17264>,8894}
>
> Everything is functioning correctly but the amount of the error reports 
> does concern.
>
> Should I be worried?
>
> Thanks
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130224/7d3d6003/attachment.htm>

From matthias at rabbitmq.com  Mon Feb 25 01:29:51 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 25 Feb 2013 01:29:51 +0000
Subject: [rabbitmq-discuss] 3.02 numerous log error reports
In-Reply-To: <f7c20a3c-3ee5-48b4-9863-b7f4ad5141af@googlegroups.com>
References: <164492e1-b6ab-4df9-bb52-c3a24e9fc80a@googlegroups.com>
	<f7c20a3c-3ee5-48b4-9863-b7f4ad5141af@googlegroups.com>
Message-ID: <512ABE8F.3080709@rabbitmq.com>

Steve,

On 25/02/13 00:45, steve flitcroft wrote:
> Forgot to also mention that I am running haproxy in front of the rmq
> node.

haproxy is probably causing the errors...

> =ERROR REPORT==== 25-Feb-2013::00:22:00 === ** Generic server
> <0.26372.31> terminating ** Last message in was
> {inet_async,#Port<0.17264>,6622,{error,econnaborted}} ** When Server
> state == {state,{rabbit_networking,start_client,[]},
> #Port<0.17264>,6622} ** Reason for termination == **
> {accept_failed,econnaborted}

That error indicates that an inbound connection got closed before rabbit
got a chance to handle it.

> =ERROR REPORT==== 25-Feb-2013::00:22:05 === error on AMQP connection
> <0.26419.31>: enotconn

That error indicates that an inbound connection got closed just after
rabbit accepted it.

Both errors are harmless and rabbit should probably just ignore them, or 
log something less frightening.


The reason you are seeing this error is probably due to haproxy trying 
to determine whether a node is alive by attempting to connect to
the AMQP port and closing the connection immediately.

It's curious though that no user has reported this before.

Regards,

Matthias.

From seshu at merchii.com  Mon Feb 25 09:54:30 2013
From: seshu at merchii.com (Mattamadugu L N Seshendra)
Date: Mon, 25 Feb 2013 10:54:30 +0100
Subject: [rabbitmq-discuss] Regarding the blocking state
Message-ID: <CABfoULqCNF3DhUquEtzKhKDgCWqgiky=Sgk-LVcBT7P9D1acbw@mail.gmail.com>

Hi,
I am seshendra, As I was testing the rabbitMQ I have found a problem that
when my memory (RAM)  reaches its limit, Then I will receive
a notification and I have noticed that it is blocking the connections. So I
thing is that what happens to the messages in the blocking state whether
the messages will be dropped or when rabbitmq comes back to normal state
then It receives the messages from the point there it is blocking.

for example
 Production I was send around 1500messages per second after a particular
time Rabbit mq comes to blocking state. so production will be sending the
messages (ex a,b,c,d...) so what happens to these messages in the blocking
state.

So please explain me and clarify my doubt.

Thanking you in advance


With Regards
Seshendra.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130225/72d0ad02/attachment.htm>

From simon at rabbitmq.com  Mon Feb 25 11:14:39 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 25 Feb 2013 11:14:39 +0000
Subject: [rabbitmq-discuss] Regarding the blocking state
In-Reply-To: <CABfoULqCNF3DhUquEtzKhKDgCWqgiky=Sgk-LVcBT7P9D1acbw@mail.gmail.com>
References: <CABfoULqCNF3DhUquEtzKhKDgCWqgiky=Sgk-LVcBT7P9D1acbw@mail.gmail.com>
Message-ID: <512B479F.8040105@rabbitmq.com>

On 25/02/2013 9:54AM, Mattamadugu L N Seshendra wrote:
> Hi,
> I am seshendra, As I was testing the rabbitMQ I have found a problem
> that when my memory (RAM)  reaches its limit, Then I will receive
> a notification and I have noticed that it is blocking the connections.
> So I thing is that what happens to the messages in the blocking state
> whether the messages will be dropped or when rabbitmq comes back to
> normal state then It receives the messages from the point there it is
> blocking.

The producers will (in general, depending on the client library) block - 
i.e. hang - while publishing a message.

So the message hasn't been lost, but neither has RabbitMQ accepted 
responsibility for it.

Once the memory alarm clears then the broker will start accepting 
messages again and the producer should finish publishing - although it's 
not inconceivable that the client could time out (again, depending on 
the client).

So it's not great to be hitting the memory alarm - you should consider 
provisioning more memory (and also upgrading, especially if you are 
running < 2.8 which hit the memory alarm far more often).

Cheers, Simon

> for example
>   Production I was send around 1500messages per second after a
> particular time Rabbit mq comes to blocking state. so production will be
> sending the messages (ex a,b,c,d...) so what happens to these messages
> in the blocking state.
>
> So please explain me and clarify my doubt.
>
> Thanking you in advance
>
>
> With Regards
> Seshendra.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mabrek at gmail.com  Mon Feb 25 11:46:19 2013
From: mabrek at gmail.com (Anton Lebedevich)
Date: Mon, 25 Feb 2013 15:46:19 +0400
Subject: [rabbitmq-discuss] 3.02 numerous log error reports
In-Reply-To: <512ABE8F.3080709@rabbitmq.com>
References: <164492e1-b6ab-4df9-bb52-c3a24e9fc80a@googlegroups.com>
	<f7c20a3c-3ee5-48b4-9863-b7f4ad5141af@googlegroups.com>
	<512ABE8F.3080709@rabbitmq.com>
Message-ID: <512B4F0B.8070701@gmail.com>

On 02/25/2013 05:29 AM, Matthias Radestock wrote:
> Steve,
> 
> On 25/02/13 00:45, steve flitcroft wrote:
>> Forgot to also mention that I am running haproxy in front of the rmq
>> node.
> 
> haproxy is probably causing the errors...
> 
>> =ERROR REPORT==== 25-Feb-2013::00:22:00 === ** Generic server
>> <0.26372.31> terminating ** Last message in was
>> {inet_async,#Port<0.17264>,6622,{error,econnaborted}} ** When Server
>> state == {state,{rabbit_networking,start_client,[]},
>> #Port<0.17264>,6622} ** Reason for termination == **
>> {accept_failed,econnaborted}
> 
> That error indicates that an inbound connection got closed before rabbit
> got a chance to handle it.
> 
>> =ERROR REPORT==== 25-Feb-2013::00:22:05 === error on AMQP connection
>> <0.26419.31>: enotconn
> 
> That error indicates that an inbound connection got closed just after
> rabbit accepted it.
> 
> Both errors are harmless and rabbit should probably just ignore them, or
> log something less frightening.
> 
> 
> The reason you are seeing this error is probably due to haproxy trying
> to determine whether a node is alive by attempting to connect to
> the AMQP port and closing the connection immediately.
> 
> It's curious though that no user has reported this before.

Is it possible to check rabbitmq aliveness from haproxy without spamming
logs with these error reports?

Haproxy can do http checks, but it can't supply user/password needed for
api/aliveness-test.

Regards,
Anton Lebedevich.

From simon at rabbitmq.com  Mon Feb 25 11:53:20 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 25 Feb 2013 11:53:20 +0000
Subject: [rabbitmq-discuss] 3.02 numerous log error reports
In-Reply-To: <512B4F0B.8070701@gmail.com>
References: <164492e1-b6ab-4df9-bb52-c3a24e9fc80a@googlegroups.com>
	<f7c20a3c-3ee5-48b4-9863-b7f4ad5141af@googlegroups.com>
	<512ABE8F.3080709@rabbitmq.com> <512B4F0B.8070701@gmail.com>
Message-ID: <512B50B0.5000606@rabbitmq.com>

On 25/02/2013 11:46AM, Anton Lebedevich wrote:
> Is it possible to check rabbitmq aliveness from haproxy without spamming
> logs with these error reports?
>
> Haproxy can do http checks, but it can't supply user/password needed for
> api/aliveness-test.

Of course /api/aliveness-test is not the only HTTP thing you can do to 
check for aliveness. It tries to be reasonably comprehensive in making 
sure the broker can really process some AMQP commands - but if we're 
comparing to HAProxy just opening a port and then closing it again, it 
would be reasonable just to make a "dumb" HTTP request, like requesting 
the web UI's index.html page - which is not password protected in 3.x.

Cheers, Simon

From bison_art at o2.pl  Mon Feb 25 12:47:51 2013
From: bison_art at o2.pl (rabbit15)
Date: Mon, 25 Feb 2013 04:47:51 -0800 (PST)
Subject: [rabbitmq-discuss] EndOfStreamException after system time change.
Message-ID: <1361796471934-25181.post@n5.nabble.com>

Hi, could you tell me why after I had changed time in the operating system
I've got EndOfStreamException ?
Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/EndOfStreamException-after-system-time-change-tp25181.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From bison_art at o2.pl  Mon Feb 25 13:44:16 2013
From: bison_art at o2.pl (rabbit15)
Date: Mon, 25 Feb 2013 05:44:16 -0800 (PST)
Subject: [rabbitmq-discuss] Pattern - exclude
In-Reply-To: <5124B701.1050308@rabbitmq.com>
References: <1361287309970-25090.post@n5.nabble.com>
	<5124AA2D.5000905@rabbitmq.com> <5124B701.1050308@rabbitmq.com>
Message-ID: <1361799856814-25182.post@n5.nabble.com>

Thanks a lot!
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Pattern-exclude-tp25090p25182.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From tim at rabbitmq.com  Mon Feb 25 15:27:08 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 25 Feb 2013 15:27:08 +0000
Subject: [rabbitmq-discuss] rabbitmq and invalid hostname
In-Reply-To: <1361547859460-25146.post@n5.nabble.com>
References: <1361547859460-25146.post@n5.nabble.com>
Message-ID: <38455343-44B9-45DD-BD3A-AD8604702B8E@rabbitmq.com>

Hi Prabodh,

On 22 Feb 2013, at 15:44, Prabodh Upreti wrote:

> Hello
> 
> I can install/run rabbitmq perfectly fine in my normal setup.  The problem
> is when I have to install it in a box where hostname can't be validated at
> time of rpm install.   For instance, let's say host name is set as
> xyz.abc.com.
> 
> I see that in my working environment(where hostname is resolvable), database
> and log files are created as rabbit at xyz.log etc.
> 
> what happens in the above senarios where the hostname is not resolvable. Is
> the install going to work fine?  

No, I wouldn't expect it to work at all.

> Just to validate this I went ahead and
> changed the hostname to testhostname.abc.com in my rabbitmq working
> environment.  I went ahead and modified rabbitmq-evn.conf NODENAME to
> rabbit at testhostname. Getting a lot of errors.
> 

Indeed. The hostname can be changed, but it has to be resolved for the broker to run.

> The reason, I have to do all this is because I need to package everything
> before shipping to customer environment.  The hostname/FQDN specified can't
> be validated in my environment but I still need to make sure everything is
> setup correctly.

This all depends on what you mean by 'setup' - are you wanting to configure queues,
exchanges and bindings on you machine and make these available at the install-site
later on? If so, you could export these definitions from your machine and make
them available at startup (or just once using the admin cli) using the RabbitMQ
management plugin: see http://www.rabbitmq.com/management.html for details.

>  The customer is just going to put it in their environment
> and everything should work fine.  I would appreciate some guidance from you.
> Thank you.
> 

Why can't you package the .rpm along with the pre-requisites and deal with
this by having a sequence of actions that run at the install site:

1. unpack the rpm and install it directly
2. unpack the configuration settings/changes and apply them

Or something like that?

Of course, you can override the various locations of things using the advice
specified in http://rabbitmq.com/relocate.html. You're not going to get far with
an unresolved hostname.


From emile at rabbitmq.com  Mon Feb 25 15:35:50 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 25 Feb 2013 15:35:50 +0000
Subject: [rabbitmq-discuss] EndOfStreamException after system time
	change.
In-Reply-To: <1361796471934-25181.post@n5.nabble.com>
References: <1361796471934-25181.post@n5.nabble.com>
Message-ID: <512B84D6.90605@rabbitmq.com>

Hi,

On 25/02/13 12:47, rabbit15 wrote:
> Hi, could you tell me why after I had changed time in the operating system
> I've got EndOfStreamException ?

Perhaps the clock discontinuity caused a timeout which closed a socket,
producing an end-of-stream condition. Operating systems often use an
internal monotonic clock and adjust the time incrementally over a period
to prevent such problems. You should consult your OS documentation.



-Emile




From seshu at merchii.com  Mon Feb 25 15:40:29 2013
From: seshu at merchii.com (Mattamadugu L N Seshendra)
Date: Mon, 25 Feb 2013 16:40:29 +0100
Subject: [rabbitmq-discuss] Regarding the default user and password
Message-ID: <CABfoULr+i279ZOTNjkDHz9Grz1jAKbiY=TmFW7qpvppMKy2yuQ@mail.gmail.com>

Hi
Can anyone help me how change the default user : guest and default pass:
guest to my own password. Actually I was using chef-solo to install rabbit
mq so I dont again add user manually just I want to change the username and
password to my required default.

So please anyone help me in solving this.


Thanking you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130225/1c6f0e8c/attachment.htm>

From matthias at rabbitmq.com  Mon Feb 25 15:49:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 25 Feb 2013 15:49:12 +0000
Subject: [rabbitmq-discuss] rabbitmq and invalid hostname
In-Reply-To: <38455343-44B9-45DD-BD3A-AD8604702B8E@rabbitmq.com>
References: <1361547859460-25146.post@n5.nabble.com>
	<38455343-44B9-45DD-BD3A-AD8604702B8E@rabbitmq.com>
Message-ID: <512B87F8.9030001@rabbitmq.com>

On 25/02/13 15:27, Tim Watson wrote:
> Why can't you package the .rpm along with the pre-requisites and deal with
> this by having a sequence of actions that run at the install site:
>
> 1. unpack the rpm and install it directly
> 2. unpack the configuration settings/changes and apply them
>
> Or something like that?
>
> Of course, you can override the various locations of things using the advice
> specified in http://rabbitmq.com/relocate.html. You're not going to get far with
> an unresolved hostname.

One way around that would be to set the nodename to contain a hostname 
which resolves everywhere, e.g. 'localhost'. Such a setup won't allow 
clustering of rabbits, but that's impossible anyway without the 
knowledge of hostnames.

Matthias.

From garry at robustsoftware.co.uk  Mon Feb 25 17:37:50 2013
From: garry at robustsoftware.co.uk (Garry Shutler)
Date: Mon, 25 Feb 2013 17:37:50 +0000
Subject: [rabbitmq-discuss] Describing message type
Message-ID: <CAKQzhmgR2m=EKmGsTp+DuTMGOrL2ii1+uM78tiigOR_Ju0kPLQ@mail.gmail.com>

Hi,

I'm looking for some guidance as to how to determine the contents of a
message more accurately before deserializing it.

A bit of background: I need to have a prioritized queuing system, but would
like to be able to push multiple types of task into that system that a
worker/workers can consume.

I've emulated the prioritization (as from what I could find RabbitMQ does
not support this out of the box) by having two queues: "high" and "normal".
However, each queue could contain several types of message and therefore
the consumer(s) need to know what code they should invoke for the message.

At the moment I am leaning towards using the content type of the message
with something like:

application/json ; type=<message-type> version=<version>
>

This complies with what I prefer to do in HTTP and is also fairly
standardized. From the combination of type and version the consumer will
know the shape of the data (perhaps the class to deserialize to in static
languages) and also which code to invoke.

Is there a preferred/standard way of achieving what I'm trying? I realize I
could be on entirely the wrong track.

Thanks in advance,

*Garry Shutler*

@gshutler <http://twitter.com/gshutler>
gshutler.com
evenitron.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130225/b4a1f98c/attachment.htm>

From michael.s.klishin at gmail.com  Mon Feb 25 18:00:47 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 25 Feb 2013 22:00:47 +0400
Subject: [rabbitmq-discuss] Describing message type
In-Reply-To: <CAKQzhmgR2m=EKmGsTp+DuTMGOrL2ii1+uM78tiigOR_Ju0kPLQ@mail.gmail.com>
References: <CAKQzhmgR2m=EKmGsTp+DuTMGOrL2ii1+uM78tiigOR_Ju0kPLQ@mail.gmail.com>
Message-ID: <CAE3HoVQG-tyad0BBZ578E53Ne4GWCeQ3+d7OJ_n3b1WoAuMbqA@mail.gmail.com>

2013/2/25 Garry Shutler <garry at robustsoftware.co.uk>

> Is there a preferred/standard way of achieving what I'm trying?


Garry,

Messages have a type property (which can be any string). Maybe a
combination of type and content type
would be sufficient?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130225/17432f58/attachment.htm>

From garry at robustsoftware.co.uk  Mon Feb 25 19:47:51 2013
From: garry at robustsoftware.co.uk (Garry Shutler)
Date: Mon, 25 Feb 2013 19:47:51 +0000
Subject: [rabbitmq-discuss] Describing message type
In-Reply-To: <CAE3HoVQG-tyad0BBZ578E53Ne4GWCeQ3+d7OJ_n3b1WoAuMbqA@mail.gmail.com>
References: <CAKQzhmgR2m=EKmGsTp+DuTMGOrL2ii1+uM78tiigOR_Ju0kPLQ@mail.gmail.com>
	<CAE3HoVQG-tyad0BBZ578E53Ne4GWCeQ3+d7OJ_n3b1WoAuMbqA@mail.gmail.com>
Message-ID: <8A4AB409-A732-44F3-8BDC-6FA292CC50C6@robustsoftware.co.uk>

I did look at that but I couldn't find any conventions documented whereas Content-Type from HTTP has some understood standards.

If there are RabbitMQ conventions around using Type I'd be happy to use that, I just couldn't find any documentation of them so wasn't confident of establishing them in my code. 

Garry Shutler

@gshutler
evenitron.com
gshutler.com

On 25 Feb 2013, at 18:00, Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 
> 2013/2/25 Garry Shutler <garry at robustsoftware.co.uk>
>> Is there a preferred/standard way of achieving what I'm trying?
> 
> Garry,
> 
> Messages have a type property (which can be any string). Maybe a combination of type and content type
> would be sufficient?
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130225/9bac644f/attachment.htm>

From carl.hoerberg at gmail.com  Tue Feb 26 04:26:21 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 25 Feb 2013 20:26:21 -0800 (PST)
Subject: [rabbitmq-discuss] Deploying new SSL certificates
Message-ID: <1361852781317-25190.post@n5.nabble.com>

Noticed that if you replace the certificate on a running RabbitMQ server it
picks it up immediately without a restart, but not the cacertfile, ie. not
the intermediate certificate. I guess this is a erlang bug/feature, but
maybe worth a note in the SSL documentation. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Deploying-new-SSL-certificates-tp25190.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Petr.Gotthard at Honeywell.com  Tue Feb 26 10:23:14 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Tue, 26 Feb 2013 10:23:14 +0000
Subject: [rabbitmq-discuss] How to configure HTTP redirection (port 55672)?
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2A679598@FR44EX3005.global.ds.honeywell.com>

Hello,

I'm trying to run two instances of RabbitMQ on one machine and have some troubles changing the port numbers for the rabbitmq_management.

The documentation for 3.0.2 says that to change the HTTP port for rabbitmq_management I need to do something like this:

[{rabbitmq_management,
  [{listener, [{port, 15672},
               {ip, "127.0.0.1"}
              ]}
  ]}
].

That's fine, but the standard 3.0.2 installation listens also on 55672 and redirects this to 15672. This means that when running two 3.0.2's there are two servers that want to listen on 55672 and redirect it to somewhere else.

The question is: how can I disable in rabbitmq.config the HTTP port redirection, or how can I change the port that is being redirected (by default 55672)?


Thanks,
Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130226/bbc0426d/attachment.htm>

From emile at rabbitmq.com  Tue Feb 26 10:30:48 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 26 Feb 2013 10:30:48 +0000
Subject: [rabbitmq-discuss] How to configure HTTP redirection (port
	55672)?
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2A679598@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2A679598@FR44EX3005.global.ds.honeywell.com>
Message-ID: <512C8ED8.5000203@rabbitmq.com>

Hi Petr,





On 26/02/13 10:23, Gotthard, Petr wrote:
> [{rabbitmq_management,
>   [{listener, [{port, 15672},
>                {ip, "127.0.0.1"}
>               ]}

 %% Try adding this:

 ,  {redirect_old_port, false}


>   ]}
> ].


-Emile















From simon at rabbitmq.com  Tue Feb 26 10:35:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Feb 2013 10:35:14 +0000
Subject: [rabbitmq-discuss] How to configure HTTP redirection (port
	55672)?
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2A679598@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2A679598@FR44EX3005.global.ds.honeywell.com>
Message-ID: <512C8FE2.8070309@rabbitmq.com>

On 26/02/13 10:23, Gotthard, Petr wrote:
> The question is: how can I disable in rabbitmq.config the HTTP port
> redirection, or how can I change the port that is being redirected (by
> default 55672)?

As Emile said, you can use 'redirect_old_port'. But the redirection port 
(unlike the real management port) will not stop the server from starting 
if it can't be opened - so you shouldn't need to reconfigure it at all.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From bison_art at o2.pl  Tue Feb 26 10:50:26 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 26 Feb 2013 02:50:26 -0800 (PST)
Subject: [rabbitmq-discuss] EndOfStreamException after system time
	change.
In-Reply-To: <512B84D6.90605@rabbitmq.com>
References: <1361796471934-25181.post@n5.nabble.com>
	<512B84D6.90605@rabbitmq.com>
Message-ID: <1361875826120-25194.post@n5.nabble.com>

Hi, thanks a lot for the fast answer!
I have tested that problem on RabbitMQ clients in Java and C#. Java client
works fine even if I had changed time, but C# didn't. I saw that if I
changed time less than 30 minutes than it works even in the C#.
Best Regards,
Artur




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/EndOfStreamException-after-system-time-change-tp25181p25194.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Tue Feb 26 11:23:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 26 Feb 2013 11:23:25 +0000
Subject: [rabbitmq-discuss] EndOfStreamException after system time
	change.
In-Reply-To: <1361875826120-25194.post@n5.nabble.com>
References: <1361796471934-25181.post@n5.nabble.com>
	<512B84D6.90605@rabbitmq.com>
	<1361875826120-25194.post@n5.nabble.com>
Message-ID: <512C9B2D.10402@rabbitmq.com>


Hi,

On 26/02/13 10:50, rabbit15 wrote:
> I have tested that problem on RabbitMQ clients in Java and C#. Java client
> works fine even if I had changed time, but C# didn't. I saw that if I
> changed time less than 30 minutes than it works even in the C#.


I can confirm this behaviour when using the Microsoft .net library. The
broker reports "connection_closed_abruptly" due to the client closing
the socket if you change the time by a sufficient interval. If you
consider this a bug then please report it to the vendor of your .net
implementation.



-Emile






From bison_art at o2.pl  Tue Feb 26 12:36:26 2013
From: bison_art at o2.pl (rabbit15)
Date: Tue, 26 Feb 2013 04:36:26 -0800 (PST)
Subject: [rabbitmq-discuss] EndOfStreamException after system time
	change.
In-Reply-To: <512C9B2D.10402@rabbitmq.com>
References: <1361796471934-25181.post@n5.nabble.com>
	<512B84D6.90605@rabbitmq.com>
	<1361875826120-25194.post@n5.nabble.com>
	<512C9B2D.10402@rabbitmq.com>
Message-ID: <1361882186223-25196.post@n5.nabble.com>

Thank you!
Best Regards,
Artur



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/EndOfStreamException-after-system-time-change-tp25181p25196.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Tue Feb 26 16:01:47 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Feb 2013 16:01:47 +0000
Subject: [rabbitmq-discuss] odd rabbitmq / heartbeat /drbd duplicate
	mount
In-Reply-To: <338d5bfe-2f49-4d38-a22d-bfeb219db601@googlegroups.com>
References: <338d5bfe-2f49-4d38-a22d-bfeb219db601@googlegroups.com>
Message-ID: <512CDC6B.3040801@rabbitmq.com>

Frank,

On 21/02/13 00:02, Frank wrote:
> what has me stumped is that while the ip address is only on the primary
> heartbeat node (like it should be), /var/lib/rabbitmq is accessible as both.

Just because the fs isn't mounted doesn't mean you can't access that 
dir, i.e. the dir might actually exist independently of the fs mount.

> 'mount' and mtab both reports that /var/lib/rabbitmq is not mounted on
> the backup heartbeat node but I can see the same .erlang.cookie on both
> nodes.

As above.

> The output of rabbitmqctl is the same for both nodes.

As above; if there is an underlying dir, then it might well contain an 
erlang cookie. rabbitmqctl would probably end up connecting to the other 
node, due to the hostname resolving to that IP rather than the local IP.

So, in summary, none of this is surprising. If the behaviour bothers 
you, simply rm the /var/lib/rabbitmq dir on the secondary.

Matthias.

From matthias at rabbitmq.com  Tue Feb 26 16:06:28 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Feb 2013 16:06:28 +0000
Subject: [rabbitmq-discuss] Describing message type
In-Reply-To: <8A4AB409-A732-44F3-8BDC-6FA292CC50C6@robustsoftware.co.uk>
References: <CAKQzhmgR2m=EKmGsTp+DuTMGOrL2ii1+uM78tiigOR_Ju0kPLQ@mail.gmail.com>
	<CAE3HoVQG-tyad0BBZ578E53Ne4GWCeQ3+d7OJ_n3b1WoAuMbqA@mail.gmail.com>
	<8A4AB409-A732-44F3-8BDC-6FA292CC50C6@robustsoftware.co.uk>
Message-ID: <512CDD84.80500@rabbitmq.com>

Gary,

On 25/02/13 19:47, Garry Shutler wrote:
> I did look at that but I couldn't find any conventions documented
> whereas Content-Type from HTTP has some understood standards.
>
> If there are RabbitMQ conventions around using Type I'd be happy to use
> that, I just couldn't find any documentation of them so wasn't confident
> of establishing them in my code.

RabbitMQ has no conventions for the usage of the 'Type' field.

Matthias.

From behrk2 at gmail.com  Tue Feb 26 19:05:58 2013
From: behrk2 at gmail.com (Kevin Behr)
Date: Tue, 26 Feb 2013 14:05:58 -0500
Subject: [rabbitmq-discuss] Consumer Clients as Tomcat Web Applications
 and Work Queue Configuration
In-Reply-To: <5C95A290-0FA4-4E18-BEAE-11727B8E5701@rabbitmq.com>
References: <CAC_yGURXNFrgJ6SM7vb5QjZn2m5GKBXgucUFvuQ4QodNzrz3yA@mail.gmail.com>
	<AA959E8B-19A8-4628-A700-B98C15580135@rabbitmq.com>
	<CAC_yGUSCG6Nmj3xJ2Ae2HO5objLqv-fRt=rHne=XmGecZO+MqQ@mail.gmail.com>
	<5C95A290-0FA4-4E18-BEAE-11727B8E5701@rabbitmq.com>
Message-ID: <CAC_yGUTp4DWn8sBEBxKPo+fDTyoOWrDrUy99GpqSkZDSVgn1Eg@mail.gmail.com>

Steve,

Thanks for your continued help in the matter, you've done a great job at
answering my questions.  I'm going to take your advice and run both
performance and stress tests, starting with a prefetch count of 1, and then
increasing to 2, and so on.  I think that the tests will help to highlight
the integrity of my pipeline (i.e. bottlenecks, network latency, etc).

Thanks again!

Kevin


On Mon, Feb 18, 2013 at 11:25 AM, Steve Powell <steve at rabbitmq.com> wrote:

> Kevin,
> I'm glad you managed to 'solve' your problem.
>
> The acknowledgement (ACK) is to tell the RabbitMQ Server that the client is
> willing to take responsibility for the message: RabbitMQ will not deliver
> this
> message to anyone again.  If the channel closes/stops/dissappears and a
> message sent to it hasn't been acknowledged, or if a message is rejected
> (with
> requeue)  (NACKed with requeue), then RabbitMQ will attempt to deliver the
> message again.  That may or may not be to the same consumer, channel or
> client.  The prefetch count is a way of limiting the number of messages
> RabbitMQ Server will allow unACKed (and unNACKed) on a channel.
>
> Let's say you have one consumer on one channel on each client, and you have
> two clients, A and B. Let's also say that A and B have prefetch count set
> to 2.
> We'll assume that A and B are served in that order by the RabbitMQ server.
>
> If 5 messages arrive on the queue (m1..5) then the messages will arrive on
> the
> QueueingConsumer client queues on A and B as follows:
>
> A:  [m1, m3]
> B:  [m2, m4]
> and message m5 will stay in the server.
>
> I presume both A and B will see a message and remove it from the
> QueueingConsumer queue:
>
> A:  [m3]  (processing m1)
> B:  [m4]  (processing m2)
>
> When the first message is processed successfully (either m1 on A, or m2 on
> B)
> and the client sends ACK back to the server, then message m5 can be sent to
> the client who ACKed first, let's say it is B:
>
> A:  [m3]  (processing m1)
> B:  [m4, m5]   (not processing a message)
>
> But note that B might have already started processing m4 by this time (it
> more probably would have, since the message m4 is already in the client),
> so it would soon (or already) look like this:
>
> A:  [m3]  (processing m1)
> B:  [m5]  (processing m4)
>
> As messages arrive on the queue in the server, they are sent to either A
> or B
> as they successfully (or otherwise) finish processing the previous
> messages.
>
> Let's say that B finishes first again (ACKnowledging m4), but that  no more
> messages arrive on the queue before then.  We then get into this situation:
>
> A:  [m3]  (processing m1)
> B:  []  (processing m5)
>
> B has an empty queue.
>
> If B again finishes first (a fast and efficient machine, or a lightweight
> message m5?) we could see this situation:
>
> A:  [m3]  (processing m1)
> B:  []  (idle, waiting on internal queue)
>
> A might take a very long time to process message m1, and m3 has to wait
> until
> A has finished (or aborts) before it will be processed, even though B is
> unoccupied and available.
>
> The effects of the prefetch count >1 are therefore three-fold:
>
> 1) The internal client queues never hold more than prefetch-count messages,
>    all excess messages 'back-up' in the server.
>
> 2) Some messages can get 'caught' behind a message that takes a long time
> to
>    process: waiting indefinitely, even though there may be servers ready
> and
>    waiting to process them.
>
> 3) Messages can be sent to a client while it is processing the previous
>    message, so the network transfer time can overlap processing time,
> reducing
>    the time spent idle in the client when there are messages to process.
>
> Notice that there is a (potential) price to pay for the benefit in item 3.
>  If
> you reduce the time spent waiting for network transfer time while idle, you
> run the risk of processing some messages very late indeed.
>
> As soon as you have multiple clients listening to the same queue you cannot
> guarantee the order of processing of messages, whatever you set the
> prefetch
> counts to.
>
> You should be able to see what happens (can happen) with more clients, or
> with
> a larger (or unlimited) prefetch count.
>
> Whether you wish to use a setting like this very much depends upon how
> large
> the network latency is, what the risk of message failures are, and what the
> rate of message arrival might be (it will doubtless vary in any case).
>
> A prefetch count of 2 and a variable number of clients works reasonably
> well:
>
> - when order of message processing is not critical;
> - when message processing is relatively reliable, and not too variable; and
> - when the network transfer time is not too large per message (e.g.
> messages are
>   reasonably small).
>
> Outside of these parameters I recommend you run some careful tests.
>
> In fact, let me recommend you run some careful performance and stress
> tests in
> any case.  It is notoriously difficult to predict where the bottlenecks
> will
> be in any particular configuration.  These bottlenecks will move depending
> upon load, and sometimes when the load changes (up or down).
>
> It may be, with low to medium message rates, that all this fuss makes no
> difference over a prefetch count of 1.  You should check this before
> investing
> in complex (and potentially buggy) code. You should also ensure that you
> really need many processing clients and that you fully understand the
> interactions between the processing that these clients undertake -- it
> is possible that there are mutual blocks or other serialisation effects
> that will have an impact upon the service rates (or even success)
> of your clients.
>
> I hope I have begun to answer your question.  Good luck.
>   Steve Powell
> [*M*: +44-7815-838-558; *H*:+44-1962-775-598]
> *Links: SpringSource <http://www.springsource.org/>** **(**a division of *
> *VMware* <http://www.vmware.com/>*),*
>
> * **Virgo* <http://www.eclipse.org/virgo>*, *
> *RabbitMQ <http://www.rabbitmq.com>.*
> *-----------------------------------------------------------------------*
>   Good design:
>    is innovative, useful, aesthetic;
>    is understandable, unobtrusive, honest;
>    is long-lasting, thorough, environmentally friendly;
>     and *is as little design as possible.*
> *Copyright Dieter Rams, amended March 2003; October 2009; and August 2012*
>
> On 12 Feb 2013, at 19:28, Kevin Behr <behrk2 at gmail.com> wrote:
>
> Regarding your statement above, I had not taken that into consideration.
>  I've coded my clients to  only acknowledge upon successful processing of
> the delivered message.  If one of our many web services or datastore
> connections goes down, then unacknowledged messages will start piling up
> quickly, and the messaging and queuing pipeline will essentially come to a
> halt. I would expect this to be the correct behavior, however, as I don't
> want to throw out messages until someone discovers that a service is down.
>
> As I will be using QueuingConsumer, I'm now wondering *how *I should
> determine *what *to set my prefetch counts to.  Do you have any further
> advice on this?  I'm still a little confused there.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130226/a733857b/attachment.htm>

From dbuchko at vmware.com  Tue Feb 26 19:12:35 2013
From: dbuchko at vmware.com (Daniel Buchko)
Date: Tue, 26 Feb 2013 11:12:35 -0800
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <5128C40B.4080400@rabbitmq.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<511A9EFA.9010909@rabbitmq.com>,<511AA0A3.4090103@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB150137627974@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navt!
	eq.com>,<5125579B.7060707@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A517@hq-ex-mb03.ad.navteq.com>,
	<51263223.6090002@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A518@hq-ex-mb03.ad.navteq.com>,
	<51263B96.8050507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A51B@hq-ex-mb03.ad.navteq.com>
	<512658C5.3060206@rabbitmq .com> <5128C40B.4080400@rabbitmq.com>
Message-ID: <201563F6B444B14C89BEA66003DD401414392B81AD@exch-mbx-113.vmware.com>

Matthias, could you please send Nokia a bug tracking number for reference purposes?

Thanks,
Dan


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: Saturday, February 23, 2013 8:29 AM
To: Konar Peter (Nokia-LC/Chicago)
Cc: Daniel Buchko; Carroll James (Nokia-LC/Malvern); Hancock Craig (Nokia-LC/Chicago); Venus Justin (Nokia-LC/Chicago); Yu Jerry.3 (Nokia-LC/Alpharetta); Lieber Dick (Nokia-LC/Chicago); Johnson Anthony (Nokia-LC/Alpharetta); Mccuiston Mitchell (Nokia-LC/Chicago); rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ blocking issue

Peter,

On 21/02/13 17:26, Matthias Radestock wrote:
> After staring at the code for a couple of days I have identified and 
> fixed one scenarios in which a connection could end up in the state 
> you are seeing. It happens only after an illegal sequence of 
> channel.close followed by basic.publish on the same channel, and only 
> during a very narrow window in conjunction with flow control. So I 
> doubt this is the cause, but it would still be worth giving that fix a 
> try, just to rule out that scenario. I will send you a patch by private email.

After staring at the code some more, it turns out that there is a
*legal* sequence of AMQP commands that triggers the bug: a bunch of basic.publish commands followed by a channel.close, followed by a basic.publish on *another* channel.

The precise conditions are very intricate and highly timing sensitive, which explains why we have not seen any prior reports of this even though the bug was introduced nearly a year ago, in 2.8.0.

The patch I sent you fixes the problem and will appear in the next RabbitMQ bugfix release.

Thank you very much for the detailed reports and all the effort you invested in helping us track this down.

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Feb 26 19:14:57 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 26 Feb 2013 19:14:57 +0000
Subject: [rabbitmq-discuss] RabbitMQ blocking issue
In-Reply-To: <201563F6B444B14C89BEA66003DD401414392B81AD@exch-mbx-113.vmware.com>
References: <0C5C3C8F51B90E4596BB1263843DEB15013774F678@hq-ex-mb03.ad.navteq.com>
	<511C088E.7070908@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501378C554C@hq-ex-mb03.ad.navteq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E66D9749@f-exch-mb2.ad.navteq.com>,
	<511C1E86.3050004@rabbitmq.com>
	<D866D8338CBD0741B3C055B2AA74E65937E672C821@f-exch-mb2.ad.navteq.com>,
	<511C9E7E.1@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB1501388A7FBB@hq-ex-mb03.ad.navteq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013889FF28@hq-ex-mb03.ad.navt!
	eq.com>, <5125579B.7060707@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A517@hq-ex-mb03.ad.navteq.com>,
	<51263223.6090002@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A518@hq-ex-mb03.ad.navteq.com>,
	<51263B96.8050507@rabbitmq.com>
	<0C5C3C8F51B90E4596BB1263843DEB15013E06A51B@hq-ex-mb03.ad.navteq.com>
	<512658C5.3060206@rabbitmq .com> <5128C40B.4080400@rabbitmq.com>
	<201563F6B444B14C89BEA66003DD401414392B81AD@exch-mbx-113.vmware.com>
Message-ID: <512D09B1.3080900@rabbitmq.com>

On 26/02/13 19:12, Daniel Buchko wrote:
> Matthias, could you please send Nokia a bug tracking number for
> reference purposes?

25457.

From 2chrischambers at gmail.com  Tue Feb 26 20:06:02 2013
From: 2chrischambers at gmail.com (Chris Chambers)
Date: Tue, 26 Feb 2013 12:06:02 -0800 (PST)
Subject: [rabbitmq-discuss] Error: unable to connect to node rabbit@host:
	nodedown
Message-ID: <26422afb-7e1a-4afd-b09e-538594b2d387@googlegroups.com>

Greetings. I have searched, found and read many posts on this same similar 
subject but am not able to get going.
Background - installing the rabbitmq as a requirement for standalone chef 
server.
All other components/requirements seem to have installed ok.
When using any argument to the rabbitmqctl command, I get the same message:
Status of node rabbit at s2cchef ...
Error: unable to connect to node rabbit at s2cchef: nodedown
diagnostics:
- nodes and their ports on s2cchef: [{rabbitmqctl22520,12034}]
- current node: rabbitmqctl22520 at s2cchef
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: 7HQZbBfzsJc7oLvzbEsqwA==

Read up on the rabbitmq and tried reset as well as force_reset to ensure at 
defaults. Still not able to get running.
Adding the s2cchef in /etc/hosts on the 127.0.0.1 also does not work.
Validate that erlang is running as well.

Can someone please provide some assistance?
Thanks in advance.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130226/890f23e2/attachment.htm>

From richard at raseley.com  Tue Feb 26 23:41:22 2013
From: richard at raseley.com (Richard Raseley)
Date: Tue, 26 Feb 2013 15:41:22 -0800
Subject: [rabbitmq-discuss] Federated Topic Exchanges
Message-ID: <CAO=6ox8F0VabeYwQdsWOy2+ufqBGBoOaPNLYn-unfXTi6y2TgA@mail.gmail.com>

I am contemplating the use of topic exchanges along with the federation
plugin to route messages between geographically separated brokers.

1) Will someone confirm my understanding of the configuration is valid?

In this situation there would be topic exchange named "B1.TE" "B2.TE" that
would be configured within brokers "B1" and "B2" respectively. B1.TE would
have B2.TE configured as an upstream exchange and B2.TE would have B1.TE
configured as an upstream exchange.

Broker B1 would have queues "B1.Q1" and "B1.Q2" configured and bound to
exchange B1.TE with routing keys "B1.Q1" and "*.Q2" respectively.

Broker B2 would have queues "B2.Q1" and "B2.Q2" configured and bound to
exchange B2.TE with routing keys "B2.Q1" and "*.Q2" respectively.

2) Assuming the answer to question #1 above is "yes, it is valid", would
someone confirm my understanding of how the following messages would be
routed?

A message sent to exchange B1.TE with routing key "B2.Q1" would be
received, forwarded to exchange B2.TE, placed in queue B2.Q1, and then
acknowledgement would be sent back to the client.

A message sent to exchange B1.TE with routing key "B1.Q2" would be
received, a copy placed in queue B1.Q2, a copy forwarded to exchange B2.TE,
placed in queue B2.Q2, and then acknowledgement would be sent back to the
client.

A message sent to exchange B2.TE with routing key "B2.Q2" would be
received, a copy placed in queue B2.Q2, a copy forwarded to exchange B1.TE,
placed in queue B1.Q2, and then acknowledgement would be sent back to the
client.

3) My understanding is that an exchange has knowledge of the routing
topology of any upstream queues and therefore won't send a message upstream
that wouldn't end up in a queue. Firstly, is that understanding correct?
Secondly (if yes to the previous question), what type of overhead are we
talking about when using this configuration with a topic exchange?

My worry is that the processing power required to deliver each message will
increase exponentially as I add additional brokers in a "mesh" style
federated topology as it seems that the routing table on each upstream
exchange has to be examined for each message delivery.

Thank you in advance for your response and reading my long-winded email. =]

Regards,

Richard
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130226/caf4ef07/attachment.htm>

From dev440 at gmail.com  Wed Feb 27 05:38:53 2013
From: dev440 at gmail.com (chetan dev)
Date: Wed, 27 Feb 2013 11:08:53 +0530
Subject: [rabbitmq-discuss] Unack Messages
Message-ID: <CAB0ZxM5R=qftS=1+DF6gQksMw=wougiUhnUo+NTEg-mEDiRiTA@mail.gmail.com>

Hi,
currently if there are messages unacknowledged they remain
in unacknowledged state .
So How do i get Messages in Unacknowledged state to ready state
automatically ?

Thanks

-- 
Cheten  Dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130227/b2ab3544/attachment.htm>

From steve at dnsbed.com  Wed Feb 27 07:27:17 2013
From: steve at dnsbed.com (Steve)
Date: Wed, 27 Feb 2013 15:27:17 +0800
Subject: [rabbitmq-discuss] upgrade rabbitmq cluster
Message-ID: <512DB555.8070605@dnsbed.com>

Hello,

I have two rabbitmq nodes running within a cluster, both work as disk node.

Now I want to upgrade the rabbitmq version. Is  there any guide for this?

Thanks.

From steve at dnsbed.com  Wed Feb 27 08:02:19 2013
From: steve at dnsbed.com (Steve)
Date: Wed, 27 Feb 2013 16:02:19 +0800
Subject: [rabbitmq-discuss] about durable queues in a cluster
Message-ID: <512DBD8B.8010001@dnsbed.com>

Hello,

In a cluster, say there are one disk node and two memory nodes.
When createing a queue we mark the queue as durable, and deliver 
messages to the queue with persistent mode. Since there is only one disk 
node in the cluster, does it mean all messages are written to this disk 
node only?

Thanks.

From hadas100.b at gmail.com  Wed Feb 27 09:16:13 2013
From: hadas100.b at gmail.com (Hadas)
Date: Wed, 27 Feb 2013 01:16:13 -0800 (PST)
Subject: [rabbitmq-discuss] poison queue - rabbitmq
Message-ID: <a8f06d9b-9d97-4dba-a240-0733d058808c@googlegroups.com>

Hi,

I use rabbitmq with WCF. Some messages cause to wcf to crash.
So I use 'transactional' in order to try to run the code again.
But I want that after several times the message go to poison queue.

Is such a possibility exists in rabbitmq?
Thanks in advance
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130227/4df71138/attachment.htm>

From watson.timothy at gmail.com  Wed Feb 27 09:21:01 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 27 Feb 2013 09:21:01 +0000
Subject: [rabbitmq-discuss] about durable queues in a cluster
In-Reply-To: <512DBD8B.8010001@dnsbed.com>
References: <512DBD8B.8010001@dnsbed.com>
Message-ID: <15A6A437-685C-49AB-BBB5-8A20C3A92DC1@rabbitmq.com>

Hi,

The disk/ram node distinction refers to where definitions (queue, exchange, etc) are stored. Messages are handled separately and are always stored on disk if they're marked persistent (and sometimes even if they're not, e.g., if memory is running out). You should note however, that just because you have a cluster doesn't mean that messages will be present on all nodes! If the nodes are clustered then the definition will exist on all nodes but the messages will only end up on the node where the queue was declared and is running. If you want messages to be mirrored across nodes then you'll need to make it a mirrored queue by setting the ha policy to ensure messages are replicated across nodes in the cluster. HTH.

Cheers
Tim

On 27 Feb 2013, at 08:02, Steve <steve at dnsbed.com> wrote:

> Hello,
> 
> In a cluster, say there are one disk node and two memory nodes.
> When createing a queue we mark the queue as durable, and deliver messages to the queue with persistent mode. Since there is only one disk node in the cluster, does it mean all messages are written to this disk node only?
> 
> Thanks.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Wed Feb 27 09:27:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 27 Feb 2013 09:27:25 +0000
Subject: [rabbitmq-discuss] upgrade rabbitmq cluster
In-Reply-To: <512DB555.8070605@dnsbed.com>
References: <512DB555.8070605@dnsbed.com>
Message-ID: <512DD17D.2060404@rabbitmq.com>

Hi Steve;

On 27/02/13 07:27, Steve wrote:
> I have two rabbitmq nodes running within a cluster, both work as disk node.
> 
> Now I want to upgrade the rabbitmq version. Is  there any guide for this?

Yes, see the "Upgrading clusters" section of the "Clustering" guide:

http://www.rabbitmq.com/clustering.html#upgrading






-Emile






From emile at rabbitmq.com  Wed Feb 27 09:39:24 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 27 Feb 2013 09:39:24 +0000
Subject: [rabbitmq-discuss] Unack Messages
In-Reply-To: <CAB0ZxM5R=qftS=1+DF6gQksMw=wougiUhnUo+NTEg-mEDiRiTA@mail.gmail.com>
References: <CAB0ZxM5R=qftS=1+DF6gQksMw=wougiUhnUo+NTEg-mEDiRiTA@mail.gmail.com>
Message-ID: <512DD44C.9010501@rabbitmq.com>

Hi,

On 27/02/13 05:38, chetan dev wrote:
> currently if there are messages unacknowledged they remain
> in unacknowledged state .
> So How do i get Messages in Unacknowledged state to ready state
> automatically ?

The client that consumed those messages could issue the basic.recover
method to return all unacknowledged messages to the queue, taking care
to do so on the same channel that the messages were consumed on:

http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.recover

Or The client could use basic.reject to return individual messages back
to the queue:

http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.reject

The client could also use basic.nack to send a range of messages or
individual back to the queue:

http://www.rabbitmq.com/nack.html
http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.nack

Another way of returning all unacknowledged messages to the queue is to
close the channel.




-Emile









From emile at rabbitmq.com  Wed Feb 27 09:43:05 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 27 Feb 2013 09:43:05 +0000
Subject: [rabbitmq-discuss] poison queue - rabbitmq
In-Reply-To: <a8f06d9b-9d97-4dba-a240-0733d058808c@googlegroups.com>
References: <a8f06d9b-9d97-4dba-a240-0733d058808c@googlegroups.com>
Message-ID: <512DD529.3060905@rabbitmq.com>


Hi,

On 27/02/13 09:16, Hadas wrote:
> I use rabbitmq with WCF. Some messages cause to wcf to crash.
> So I use 'transactional' in order to try to run the code again.
> But I want that after several times the message go to poison queue.
> 
> Is such a possibility exists in rabbitmq?

Unfortunately not yet, but if you use the regular RabbitMQ .net library
without WCF then you get visibility of the "redelivered" message flag
that tells you whether a message has been delivered to another consumer
in the past.



-Emile









From steve at dnsbed.com  Wed Feb 27 09:52:40 2013
From: steve at dnsbed.com (Steve)
Date: Wed, 27 Feb 2013 17:52:40 +0800
Subject: [rabbitmq-discuss] about durable queues in a cluster
In-Reply-To: <15A6A437-685C-49AB-BBB5-8A20C3A92DC1@rabbitmq.com>
References: <512DBD8B.8010001@dnsbed.com>
	<15A6A437-685C-49AB-BBB5-8A20C3A92DC1@rabbitmq.com>
Message-ID: <512DD768.9090003@dnsbed.com>

? 2013-2-27 17:21, Tim Watson ??:
> The disk/ram node distinction refers to where definitions (queue, exchange, etc) are stored. Messages are handled separately and are always stored on disk if they're marked persistent (and sometimes even if they're not, e.g., if memory is running out). You should note however, that just because you have a cluster doesn't mean that messages will be present on all nodes! If the nodes are clustered then the definition will exist on all nodes but the messages will only end up on the node where the queue was declared and is running. If you want messages to be mirrored across nodes then you'll need to make it a mirrored queue by setting the ha policy to ensure messages are replicated across nodes in the cluster. HTH.


Thanks. That make things clear.

From Matthew.Collinge at bglgroup.co.uk  Wed Feb 27 12:00:18 2013
From: Matthew.Collinge at bglgroup.co.uk (Matthew Collinge)
Date: Wed, 27 Feb 2013 12:00:18 +0000
Subject: [rabbitmq-discuss] Consistent Hash Exchange
In-Reply-To: <50ED6442.5070707@rabbitmq.com>
References: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>
	<50E70E03.4000306@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D7CCC@bre-exch02.insurance.financial.local>
	<50EC52E7.7080507@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D9D6B@bre-exch02.insurance.financial.local>
	<50ED6442.5070707@rabbitmq.com>
Message-ID: <CE7FFC70C4C3864CA0CCEA77E53801C610FA88@bre-exch02.insurance.financial.local>

Just wanted to feedback that this is working perfectly for us, thank you.

Any idea when the Consistent Hash Exchange will cease to be marked as experimental?

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: 09 January 2013 12:36
To: Matthew Collinge
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Consistent Hash Exchange

On 08/01/13 18:26, Matthew Collinge wrote:
> Thanks would be much appreciated.

You might want to try this:

http://www.rabbitmq.com/releases/plugins/v3.0.1-hash-headers/

(Drop it in your plugins directory, move the original consistent hash plugin out of the way, and restart.)

Declare a consistent hash exchange with a string argument called "hash-header", naming the header you want to use instead of the routing key.

This functionality should make its way into future releases.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

________________________________

This message is intended for the stated addressee(s) only and may be confidential. Access to this email by anyone else is unauthorised. Any opinions expressed in this email do not necessarily reflect the opinions of BGL Group Limited and its subsidiaries . Any unauthorised disclosure, use or dissemination, either whole or in part is prohibited. If you are not the intended recipient of this message, please notify the sender immediately.

Please scan all attachments for viruses.

From simon at rabbitmq.com  Wed Feb 27 12:01:38 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 27 Feb 2013 12:01:38 +0000
Subject: [rabbitmq-discuss] Consistent Hash Exchange
In-Reply-To: <CE7FFC70C4C3864CA0CCEA77E53801C610FA88@bre-exch02.insurance.financial.local>
References: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>
	<50E70E03.4000306@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D7CCC@bre-exch02.insurance.financial.local>
	<50EC52E7.7080507@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D9D6B@bre-exch02.insurance.financial.local>
	<50ED6442.5070707@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C610FA88@bre-exch02.insurance.financial.local>
Message-ID: <512DF5A2.607@rabbitmq.com>

On 27/02/13 12:00, Matthew Collinge wrote:
> Any idea when the Consistent Hash Exchange will cease to be marked as experimental?

A couple of weeks ago, as I recall:

http://www.rabbitmq.com/plugins.html

:-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Matthew.Collinge at bglgroup.co.uk  Wed Feb 27 12:17:46 2013
From: Matthew.Collinge at bglgroup.co.uk (Matthew Collinge)
Date: Wed, 27 Feb 2013 12:17:46 +0000
Subject: [rabbitmq-discuss] Consistent Hash Exchange
In-Reply-To: <512DF5A2.607@rabbitmq.com>
References: <7d19f083-9002-4a75-8a6d-53cbe1caaf0d@googlegroups.com>
	<50E70E03.4000306@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D7CCC@bre-exch02.insurance.financial.local>
	<50EC52E7.7080507@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C60D9D6B@bre-exch02.insurance.financial.local>
	<50ED6442.5070707@rabbitmq.com>
	<CE7FFC70C4C3864CA0CCEA77E53801C610FA88@bre-exch02.insurance.financial.local>
	<512DF5A2.607@rabbitmq.com>
Message-ID: <CE7FFC70C4C3864CA0CCEA77E53801C610FAB5@bre-exch02.insurance.financial.local>

Ha, ha. RTFM! :)

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com]
Sent: 27 February 2013 12:02
To: Matthew Collinge
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Consistent Hash Exchange

On 27/02/13 12:00, Matthew Collinge wrote:
> Any idea when the Consistent Hash Exchange will cease to be marked as experimental?

A couple of weeks ago, as I recall:

http://www.rabbitmq.com/plugins.html

:-)

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware

________________________________

This message is intended for the stated addressee(s) only and may be confidential. Access to this email by anyone else is unauthorised. Any opinions expressed in this email do not necessarily reflect the opinions of BGL Group Limited and its subsidiaries . Any unauthorised disclosure, use or dissemination, either whole or in part is prohibited. If you are not the intended recipient of this message, please notify the sender immediately.

Please scan all attachments for viruses.

From hadas100.b at gmail.com  Wed Feb 27 13:25:55 2013
From: hadas100.b at gmail.com (Hadas)
Date: Wed, 27 Feb 2013 05:25:55 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMq with WCF Transaction
Message-ID: <5721bff8-0f60-49fe-919d-50220a1efbb8@googlegroups.com>

Hi,

I try to use transaction in wcf by adding 
"[OperationBehavior(TransactionScopeRequired = true)]" to functions in my 
interface.
What I can see is that when an error happens the message return to the 
queue, but only once. That means if an error occurs second time the message 
is lost.

Do I miss something or what I need to change in order to retry till no 
error occurs?

Thanks in advance!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130227/7ccb2a35/attachment.htm>

From michael.s.klishin at gmail.com  Wed Feb 27 13:39:33 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 27 Feb 2013 17:39:33 +0400
Subject: [rabbitmq-discuss] ANN Langohr 1.0.0-beta12 is released
Message-ID: <CAE3HoVTPsXj+=PaUMuNDOTGQrr=b4Qab5=dwZ_=1wS7snZXBEA@mail.gmail.com>

Langohr [1] is a Clojure RabbitMQ client that embraces the AMQP 0.9.1 Model
[2].

Release notes for beta12:
http://blog.clojurewerkz.org/blog/2013/02/27/langohr-1-dot-0-0-beta12-is-released/

1. http://clojurerabbitmq.info
2. http://www.rabbitmq.com/tutorials/amqp-concepts.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130227/6980cd99/attachment.htm>

From emile at rabbitmq.com  Wed Feb 27 15:19:33 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 27 Feb 2013 15:19:33 +0000
Subject: [rabbitmq-discuss] RabbitMq with WCF Transaction
In-Reply-To: <5721bff8-0f60-49fe-919d-50220a1efbb8@googlegroups.com>
References: <5721bff8-0f60-49fe-919d-50220a1efbb8@googlegroups.com>
Message-ID: <512E2405.8070102@rabbitmq.com>


Hi,

On 27/02/13 13:25, Hadas wrote:
> I try to use transaction in wcf by adding
> "[OperationBehavior(TransactionScopeRequired = true)]" to functions in
> my interface.
> What I can see is that when an error happens the message return to the
> queue, but only once. That means if an error occurs second time the
> message is lost.
> 
> Do I miss something or what I need to change in order to retry till no
> error occurs?


I confess ignorance about how transactions work in WCF, so I'm not
entirely sure whether they are designed to prevent message-loss in the
way that you expect. My reading of RabbitMQInputChannel.Receive() in the
RabbitMQ WCF binding is that messages are acknowledged immediately after
being decoded and will therefore not be available from the broker after
that point if the transaction needs to roll back.

It is possible to deliver messages to clients with "at-least-once"
guarantees by using the .net client library and making use of
acknowledgements and durability. The 2nd tutorial contains a relevant
discussion.




-Emile









From bushong1 at gmail.com  Wed Feb 27 15:26:30 2013
From: bushong1 at gmail.com (cbush)
Date: Wed, 27 Feb 2013 07:26:30 -0800 (PST)
Subject: [rabbitmq-discuss] esl-erlang support from rpms
In-Reply-To: <CAD6m6fEMSsn+5FCXpr+ZPngbTApcYGOhi55etkaqFhKLz05BSg@mail.gmail.com>
References: <CAD6m6fEMSsn+5FCXpr+ZPngbTApcYGOhi55etkaqFhKLz05BSg@mail.gmail.com>
Message-ID: <1361978790756-25221.post@n5.nabble.com>

Have you tried installing the RPM with the flag "--nodeps"?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/esl-erlang-support-from-rpms-tp24852p25221.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Wed Feb 27 15:37:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 27 Feb 2013 15:37:05 +0000
Subject: [rabbitmq-discuss] esl-erlang support from rpms
In-Reply-To: <1361978790756-25221.post@n5.nabble.com>
References: <CAD6m6fEMSsn+5FCXpr+ZPngbTApcYGOhi55etkaqFhKLz05BSg@mail.gmail.com>
	<1361978790756-25221.post@n5.nabble.com>
Message-ID: <512E2821.6040200@rabbitmq.com>

On 27/02/13 15:26, cbush wrote:
> Have you tried installing the RPM with the flag "--nodeps"?

Well, yes, that would work in the short term. But I like this quote from 
the yum wiki:

"As a general rule if you find you cannot put the screw in the hole with 
a screw driver you should not go get a hammer."
   - http://yum.baseurl.org/wiki/NoDeps

In the end Jason wrote an adapter RPM which required "esl-erlang" and 
provided "erlang" - Jason, did you get the chance to post that anywhere?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Feb 27 16:19:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 27 Feb 2013 16:19:12 +0000
Subject: [rabbitmq-discuss] Federated Topic Exchanges
In-Reply-To: <CAO=6ox8F0VabeYwQdsWOy2+ufqBGBoOaPNLYn-unfXTi6y2TgA@mail.gmail.com>
References: <CAO=6ox8F0VabeYwQdsWOy2+ufqBGBoOaPNLYn-unfXTi6y2TgA@mail.gmail.com>
Message-ID: <512E3200.5050703@rabbitmq.com>

On 26/02/13 23:41, Richard Raseley wrote:
> I am contemplating the use of topic exchanges along with the federation
> plugin to route messages between geographically separated brokers.
>
> 1) Will someone confirm my understanding of the configuration is valid?
>
> In this situation there would be topic exchange named "B1.TE" "B2.TE"
> that would be configured within brokers "B1" and "B2" respectively.
> B1.TE would have B2.TE configured as an upstream exchange and B2.TE
> would have B1.TE configured as an upstream exchange.
>
> Broker B1 would have queues "B1.Q1" and "B1.Q2" configured and bound to
> exchange B1.TE with routing keys "B1.Q1" and "*.Q2" respectively.
>
> Broker B2 would have queues "B2.Q1" and "B2.Q2" configured and bound to
> exchange B2.TE with routing keys "B2.Q1" and "*.Q2" respectively.

It is valid, certainly. Note that the exchanges and queues in B1 and B2 
do not need to have distinct names (but maybe you were just doing that 
to be clearer?)

> 2) Assuming the answer to question #1 above is "yes, it is valid", would
> someone confirm my understanding of how the following messages would be
> routed?
>
> A message sent to exchange B1.TE with routing key "B2.Q1" would be
> received, forwarded to exchange B2.TE, placed in queue B2.Q1,

Yes.

> and then acknowledgement would be sent back to the client.

No.

Assuming the client is publishing in confirm mode, the confirm will be 
sent back as soon as B1 has taken responsibility for the message. 
Confirms mean "the broker you published to took responsibility for the 
message". Otherwise as your federation grows larger and less-reliable 
network links come into play, you could be waiting a long time for those 
confirms!

> A message sent to exchange B1.TE with routing key "B1.Q2" would be
> received, a copy placed in queue B1.Q2, a copy forwarded to exchange
> B2.TE, placed in queue B2.Q2, and then acknowledgement would be sent
> back to the client.
>
> A message sent to exchange B2.TE with routing key "B2.Q2" would be
> received, a copy placed in queue B2.Q2, a copy forwarded to exchange
> B1.TE, placed in queue B1.Q2, and then acknowledgement would be sent
> back to the client.

Again, yes to the routing, no to when confirmation happens.

> 3) My understanding is that an exchange has knowledge of the routing
> topology of any upstream queues and therefore won't send a message
> upstream that wouldn't end up in a queue. Firstly, is that understanding
> correct?

I think you mean "downstream" in both cases, but yes.

> Secondly (if yes to the previous question), what type of
> overhead are we talking about when using this configuration with a topic
> exchange?

Effectively the bindings propagate upstream, so each federated exchange 
will end up with all the bindings for all of its downstreams.

> My worry is that the processing power required to deliver each message
> will increase exponentially as I add additional brokers in a "mesh"
> style federated topology as it seems that the routing table on each
> upstream exchange has to be examined for each message delivery.

Well, it won't be exponential. But the routing table will get larger. 
Topic routing is approximately O(log n) in the number of bindings.

The federation mechanism doesn't try to trade routing complexity for 
unnecessarily-routed messages by amalgamating topic keys since

  (a) it would have to know about topics for that, it's supposed to be a
      generic mechanism

  (b) it can't know what the distribution of messages across your
      routing key space is

However, *you* know that distribution. So you could federate topic 
exchanges and then use e2e bindings from them to local topic exchanges, 
with relatively "large" routing keys that will cover a decent sized 
range. Then apps bind queues to the local topics. That does require a 
bit more up-front setup though - but it kind of has to since it requires 
knowledge of how your routing keys are distributed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From MJohnston at lifetouch.com  Wed Feb 27 18:05:39 2013
From: MJohnston at lifetouch.com (Mark Johnston)
Date: Wed, 27 Feb 2013 18:05:39 +0000
Subject: [rabbitmq-discuss] Changing arguments on an existing queue
Message-ID: <F25EF8274BB9244DB680C80FE37CF88817E9136F@LTIVW-P-MBX01.LIFETOUCH.NET>

I'm working on a Puppet module that uses the RabbitMQ HTTP management API to manage it in a more comprehensive way than rabbitmqctl allows - permissions, vhosts, queues, etc.  I'd like to support the case where an argument is added or changed on a queue, but when I send an HTTP PUT to change a queue, I get an "inequivalent arg" error:

406 PRECONDITION_FAILED - inequivalent arg 'x-message-ttl'for queue 'some.queue.name' in vhost '/': received the value '2000' of type 'long' but current is the value '1000' of type 'long'

If I manually delete the queue beforehand and then send the same PUT, it goes through okay.  I don't think I can do this from my Puppet module, though, since the queue's messages and consumers would be lost as a result.  Is it possible to change arguments on an existing queue without deleting and recreating it?

Thanks,
Mark

______________________________________________________________________
This email has been scanned by the Symantec Email Security.cloud service.
For more information please visit http://www.symanteccloud.com
_____________________________________________________________________

From richard at raseley.com  Wed Feb 27 18:05:53 2013
From: richard at raseley.com (Richard Raseley)
Date: Wed, 27 Feb 2013 10:05:53 -0800
Subject: [rabbitmq-discuss] Federated Topic Exchanges
In-Reply-To: <512E3200.5050703@rabbitmq.com>
References: <CAO=6ox8F0VabeYwQdsWOy2+ufqBGBoOaPNLYn-unfXTi6y2TgA@mail.gmail.com>
	<512E3200.5050703@rabbitmq.com>
Message-ID: <CAO=6ox8KAqH34w7kwTuLPVU21seccO4hYwDJF4==WJsUq=jBSQ@mail.gmail.com>

Simon,

Thank you so much for your detailed response - it was very helpful to me
and answered all of my questions.

Regards,

Richard


On Wed, Feb 27, 2013 at 8:19 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 26/02/13 23:41, Richard Raseley wrote:
>
>> I am contemplating the use of topic exchanges along with the federation
>> plugin to route messages between geographically separated brokers.
>>
>> 1) Will someone confirm my understanding of the configuration is valid?
>>
>> In this situation there would be topic exchange named "B1.TE" "B2.TE"
>> that would be configured within brokers "B1" and "B2" respectively.
>> B1.TE would have B2.TE configured as an upstream exchange and B2.TE
>> would have B1.TE configured as an upstream exchange.
>>
>> Broker B1 would have queues "B1.Q1" and "B1.Q2" configured and bound to
>> exchange B1.TE with routing keys "B1.Q1" and "*.Q2" respectively.
>>
>> Broker B2 would have queues "B2.Q1" and "B2.Q2" configured and bound to
>> exchange B2.TE with routing keys "B2.Q1" and "*.Q2" respectively.
>>
>
> It is valid, certainly. Note that the exchanges and queues in B1 and B2 do
> not need to have distinct names (but maybe you were just doing that to be
> clearer?)
>
>
>  2) Assuming the answer to question #1 above is "yes, it is valid", would
>> someone confirm my understanding of how the following messages would be
>> routed?
>>
>> A message sent to exchange B1.TE with routing key "B2.Q1" would be
>> received, forwarded to exchange B2.TE, placed in queue B2.Q1,
>>
>
> Yes.
>
>
>  and then acknowledgement would be sent back to the client.
>>
>
> No.
>
> Assuming the client is publishing in confirm mode, the confirm will be
> sent back as soon as B1 has taken responsibility for the message. Confirms
> mean "the broker you published to took responsibility for the message".
> Otherwise as your federation grows larger and less-reliable network links
> come into play, you could be waiting a long time for those confirms!
>
>
>  A message sent to exchange B1.TE with routing key "B1.Q2" would be
>> received, a copy placed in queue B1.Q2, a copy forwarded to exchange
>> B2.TE, placed in queue B2.Q2, and then acknowledgement would be sent
>> back to the client.
>>
>> A message sent to exchange B2.TE with routing key "B2.Q2" would be
>> received, a copy placed in queue B2.Q2, a copy forwarded to exchange
>> B1.TE, placed in queue B1.Q2, and then acknowledgement would be sent
>> back to the client.
>>
>
> Again, yes to the routing, no to when confirmation happens.
>
>
>  3) My understanding is that an exchange has knowledge of the routing
>> topology of any upstream queues and therefore won't send a message
>> upstream that wouldn't end up in a queue. Firstly, is that understanding
>> correct?
>>
>
> I think you mean "downstream" in both cases, but yes.
>
>
>  Secondly (if yes to the previous question), what type of
>> overhead are we talking about when using this configuration with a topic
>> exchange?
>>
>
> Effectively the bindings propagate upstream, so each federated exchange
> will end up with all the bindings for all of its downstreams.
>
>
>  My worry is that the processing power required to deliver each message
>> will increase exponentially as I add additional brokers in a "mesh"
>> style federated topology as it seems that the routing table on each
>> upstream exchange has to be examined for each message delivery.
>>
>
> Well, it won't be exponential. But the routing table will get larger.
> Topic routing is approximately O(log n) in the number of bindings.
>
> The federation mechanism doesn't try to trade routing complexity for
> unnecessarily-routed messages by amalgamating topic keys since
>
>  (a) it would have to know about topics for that, it's supposed to be a
>      generic mechanism
>
>  (b) it can't know what the distribution of messages across your
>      routing key space is
>
> However, *you* know that distribution. So you could federate topic
> exchanges and then use e2e bindings from them to local topic exchanges,
> with relatively "large" routing keys that will cover a decent sized range.
> Then apps bind queues to the local topics. That does require a bit more
> up-front setup though - but it kind of has to since it requires knowledge
> of how your routing keys are distributed.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130227/fe3ba383/attachment.htm>

From michael.s.klishin at gmail.com  Wed Feb 27 18:32:20 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 27 Feb 2013 22:32:20 +0400
Subject: [rabbitmq-discuss] Changing arguments on an existing queue
In-Reply-To: <F25EF8274BB9244DB680C80FE37CF88817E9136F@LTIVW-P-MBX01.LIFETOUCH.NET>
References: <F25EF8274BB9244DB680C80FE37CF88817E9136F@LTIVW-P-MBX01.LIFETOUCH.NET>
Message-ID: <CAE3HoVSdsvC8nPbwhStxT_ymLSsU6jSJWp2WdQjRaiEtzw997Q@mail.gmail.com>

2013/2/27 Mark Johnston <MJohnston at lifetouch.com>

> Is it possible to change arguments on an existing queue without deleting
> and recreating it?


No.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130227/995c2f12/attachment.htm>

From 0x6e6562 at gmail.com  Wed Feb 27 18:38:14 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 27 Feb 2013 18:38:14 +0000
Subject: [rabbitmq-discuss] Producer confirms as a heuristic for rate
	limiting
Message-ID: <E6BBEBD2EDC74640AE895FCD8450FEDF@gmail.com>

Hi, 

I'm trying to write a benchmark suite for latency and was wondering whether using outstanding producer confirms can be used a heuristic for back pressure (where the application defines it own window size).

What I am trying to achieve is to improve the accuracy of my latency figures.

Originally I began to throttle the sending based on time - in this scenario the application has to schedule itself in and out, which means writing and maintaining timing code.

So I was wondering whether I could use the confirms to exert back pressure onto the sending app, or is this idea completely bogus?

Cheers,

Ben



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130227/6d76b48a/attachment.htm>

From matthias at rabbitmq.com  Wed Feb 27 18:52:01 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 27 Feb 2013 18:52:01 +0000
Subject: [rabbitmq-discuss] Producer confirms as a heuristic for rate
 limiting
In-Reply-To: <E6BBEBD2EDC74640AE895FCD8450FEDF@gmail.com>
References: <E6BBEBD2EDC74640AE895FCD8450FEDF@gmail.com>
Message-ID: <512E55D1.8080703@rabbitmq.com>

Ben,

On 27/02/13 18:38, Ben Hood wrote:
> I'm trying to write a benchmark suite for latency and was wondering
> whether using outstanding producer confirms can be used a heuristic for
> back pressure (where the application defines it own window size).
>
> What I am trying to achieve is to improve the accuracy of my latency
> figures.
>
> So I was wondering whether I could use the confirms to exert back
> pressure onto the sending app, or is this idea completely bogus?

Using confirms to exert back pressure on a producing application is 
fine. But I wouldn't expect that to result in particularly stable 
latencies. For a few reasons:

1) one way that the internal confirm logic gets triggered is by "absence 
of other stuff happening", so when throttling producers, confirms may 
well happen a lot quicker.

2) more generally, much of the internal confirm logic will try to batch 
things if it can, which reduces the overall cost but makes the timing of 
confirms more variable.

3) confirms do come at a noticeable penalty on throughput and latency. 
So a benchmark employing confirms would not be a very good proxy for a 
real system running w/o confirms.


Having said all that, go and try it :)


Matthias.

From prabodh.upreti at vce.com  Wed Feb 27 21:44:15 2013
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Wed, 27 Feb 2013 13:44:15 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbitmq custom plugin authorization
Message-ID: <1362001455552-25229.post@n5.nabble.com>

Hello

I currently have a custom plugin that authenticates user from an external
http server.  The plugin is currently very simple.  

For my next phase, I need to integrate with the external system and control
authorization.  First thing I need to do is control users from creating
temporary queue with only certain filter criteria.  i.e. allow logged in
user to create a queue based on filter key *.warning.  This user will not
have permission to create a queue with *.error tag.  How can I control that?

Also how can I also control a user from create any queue. i.e. I only want
certain users to have rights to create a temporary or NAMED queue.

Thank you in advance. 

regards



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbitmq-custom-plugin-authorization-tp25229.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From jerryk at rbcon.com  Wed Feb 27 23:32:48 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 27 Feb 2013 15:32:48 -0800
Subject: [rabbitmq-discuss] Rabbitmq custom plugin authorization
In-Reply-To: <1362001455552-25229.post@n5.nabble.com>
References: <1362001455552-25229.post@n5.nabble.com>
Message-ID: <CAE0Sz=yvu1Q=JMSu2x5i0dts2VTuKET1=HmwqxTgDwbPtWcNpA@mail.gmail.com>

Hi, Prabodh:

For my next phase, I need to integrate with the external system and control
> authorization.  First thing I need to do is control users from creating
> temporary queue with only certain filter criteria.  i.e. allow logged in
> user to create a queue based on filter key *.warning.  This user will not
> have permission to create a queue with *.error tag.  How can I control
> that?
>

To handle such checks you'll have to implement an "authorization backend"
by implementing the 'rabbit_auth_backend' Erlang behaviour.

The behaviour in question is pretty simple, exposing only
check_user_login/2, check_vhost_access/2 and check_resource_access/2.  The
last of these three is where you will want to implement your logic for
enforcing what operations a user can perform on which resources.

If you want some example code to look at, check out the source for the
RabbitMQ broker itself, which implements the above behaviour, with checks
against an Mnesia-based database of users and permissions, in the file
rabbit_auth_backend_internal.erl; the Mnesia/database stuff there is likely
not directly relevant to your application but you can get a sense for the
sorts of work you'll need to do to get what you want working.

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130227/645aca2b/attachment.htm>

From jerryk at rbcon.com  Thu Feb 28 00:01:28 2013
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 27 Feb 2013 16:01:28 -0800 (PST)
Subject: [rabbitmq-discuss] Regarding the default user and password
In-Reply-To: <CABfoULr+i279ZOTNjkDHz9Grz1jAKbiY=TmFW7qpvppMKy2yuQ@mail.gmail.com>
References: <CABfoULr+i279ZOTNjkDHz9Grz1jAKbiY=TmFW7qpvppMKy2yuQ@mail.gmail.com>
Message-ID: <1362009688699-25231.post@n5.nabble.com>

I'm assuming you're wanting to do this from a script that runs while Chef is
configuring your Rabbit?

If so, please see:

http://www.rabbitmq.com/man/rabbitmqctl.1.man.html

under "change_password."  The rabbitmqctl command, when scripted, will do
what you need.

Best regards,
Jerry




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Regarding-the-default-user-and-password-tp25185p25231.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mcintoshj at gmail.com  Thu Feb 28 02:04:33 2013
From: mcintoshj at gmail.com (McIntosh Jason)
Date: Wed, 27 Feb 2013 20:04:33 -0600
Subject: [rabbitmq-discuss] esl-erlang support from rpms
In-Reply-To: <512E2821.6040200@rabbitmq.com>
References: <CAD6m6fEMSsn+5FCXpr+ZPngbTApcYGOhi55etkaqFhKLz05BSg@mail.gmail.com>
	<1361978790756-25221.post@n5.nabble.com>
	<512E2821.6040200@rabbitmq.com>
Message-ID: <268FE869-38A3-4E93-934E-398A58D6646F@gmail.com>

Sorry for the delayed response - been working to get my company to show some interest in the open source world as more than a "we can use these for free" and instead "we can join the community" ;)  

Anyways, I've posted source code and some RPM's here:
https://github.com/jasonmcintosh/esl-erlang-compat

Simon, I put you as a contributor on the project as well.  This is a pretty simple release - just creates a version file:
/etc/esl-erlang-compat/version.txt

That contains the supported version, and updates the RPM database to say we provide support.  I require esl-erlang R14B or newer, and provide erlang R14B as a result :)  I've got the source for everything and RPM's built.  Note, this is my first time trying to really do much with github, so I'm still learning how to setup stuff there but hopefully this is functional for people now.

Jason


On Feb 27, 2013, at 9:37 AM, Simon MacMullen wrote:

> On 27/02/13 15:26, cbush wrote:
>> Have you tried installing the RPM with the flag "--nodeps"?
> 
> Well, yes, that would work in the short term. But I like this quote from the yum wiki:
> 
> "As a general rule if you find you cannot put the screw in the hole with a screw driver you should not go get a hammer."
>  - http://yum.baseurl.org/wiki/NoDeps
> 
> In the end Jason wrote an adapter RPM which required "esl-erlang" and provided "erlang" - Jason, did you get the chance to post that anywhere?
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware


From 0x6e6562 at gmail.com  Thu Feb 28 08:49:28 2013
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 28 Feb 2013 08:49:28 +0000
Subject: [rabbitmq-discuss] Producer confirms as a heuristic for rate
 limiting
In-Reply-To: <512E55D1.8080703@rabbitmq.com>
References: <E6BBEBD2EDC74640AE895FCD8450FEDF@gmail.com>
	<512E55D1.8080703@rabbitmq.com>
Message-ID: <7509F24FF37749B7AB16B2C3B72775DE@gmail.com>

Matthias, 


On Wednesday, 27 February 2013 at 18:52, Matthias Radestock wrote:

> Using confirms to exert back pressure on a producing application is
> fine. But I wouldn't expect that to result in particularly stable 
> latencies. For a few reasons:
> 
> 1) one way that the internal confirm logic gets triggered is by "absence 
> of other stuff happening", so when throttling producers, confirms may 
> well happen a lot quicker.
> 

If I understand you correctly, then this is precisely the feedback loop that I'm trying to achieve - when the sender is throttled, this gives the internals of Rabbit more head room to do whatever it is a Rabbit does. In Rabbit becoming more free, the rate of confirms increases, and hence the more credit the sender will receive. When the sender ramps up again, the reverse should happen, and so the feedback cycle continues.
 
> 
> 2) more generally, much of the internal confirm logic will try to batch 
> things if it can, which reduces the overall cost but makes the timing of 
> confirms more variable.


That's understandable - fine grained ingress credits would come at a premium in any case.

In my scenario I'm setting a timestamp into the message header and the receiver is decoding this in order to compare it with its current timestamp. With the measurement being end to end, would the asynchronous nature of the confirms not be obviated by the fact that you are measuring the speed of the uplink plus the routing overhead plus the speed of a separate delivery (he says had waving)?
 
> 3) confirms do come at a noticeable penalty on throughput and latency. 
> So a benchmark employing confirms would not be a very good proxy for a 
> real system running w/o confirms.


What constitutes the performance penalty in this case? Do confirms increase the latency because they add to the measurable round trip as seen by the sender, or does the fact that they are turned on add extra processing effort which is CPU time that has to be spread over each message and hence on average adding latency to each message? If the answer is the latter, does the same apply to throughput - since confirms have a non-zero accounting cost, having them turned on diminishes the ability to process as many items in the same amount of time? 
 
> 
> 
> Having said all that, go and try it :)

I'm very tempted, but the reason why I'm asking first is to avoid going down any rabbit holes that a more experienced person could potentially advise me to avoid :-)

Cheers,

Ben 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130228/c8177618/attachment.htm>

From steve at dnsbed.com  Thu Feb 28 09:02:02 2013
From: steve at dnsbed.com (Steve)
Date: Thu, 28 Feb 2013 17:02:02 +0800
Subject: [rabbitmq-discuss] Can't create queues
Message-ID: <512F1D0A.60900@dnsbed.com>

Hello,

I run this ruby script to connect to rabbitmq on localhost with default 
vhost:

require "rubygems"
require "amqp"

while true
   begin
     AMQP.start(:host => "localhost") do |connection|
       channel  = AMQP::Channel.new(connection)
       exchange = channel.fanout("logs", :durable => true)
       queue    = channel.queue("test_logs", :durable => true)
       queue.bind(exchange)

       puts " [*] Waiting for logs."

       queue.subscribe do |body|
         puts " [x] #{body}"
       end
     end

   rescue Exception => e
     puts e.message
   end
end

The script run without error.
  I then run rabbitmqctl to see the queues but get nothing:

# rabbitmqctl list_queues -p /
Listing queues ...
...done.

So what's wrong with my setup?

Thanks.

From hadas100.b at gmail.com  Thu Feb 28 09:06:32 2013
From: hadas100.b at gmail.com (Hadas)
Date: Thu, 28 Feb 2013 11:06:32 +0200
Subject: [rabbitmq-discuss] RabbitMq with WCF Transaction
In-Reply-To: <512E2405.8070102@rabbitmq.com>
References: <5721bff8-0f60-49fe-919d-50220a1efbb8@googlegroups.com>
	<512E2405.8070102@rabbitmq.com>
Message-ID: <CAC_NAZntGO3Hq8ETDJqOUvPxPtsY69QtV73m3BN76QJ4n9FRjA@mail.gmail.com>

Thanks on the reply.

Can you please give me link to example of rabbitmq transaction?

2013/2/27 Emile Joubert <emile at rabbitmq.com>

>
> Hi,
>
> On 27/02/13 13:25, Hadas wrote:
> > I try to use transaction in wcf by adding
> > "[OperationBehavior(TransactionScopeRequired = true)]" to functions in
> > my interface.
> > What I can see is that when an error happens the message return to the
> > queue, but only once. That means if an error occurs second time the
> > message is lost.
> >
> > Do I miss something or what I need to change in order to retry till no
> > error occurs?
>
>
> I confess ignorance about how transactions work in WCF, so I'm not
> entirely sure whether they are designed to prevent message-loss in the
> way that you expect. My reading of RabbitMQInputChannel.Receive() in the
> RabbitMQ WCF binding is that messages are acknowledged immediately after
> being decoded and will therefore not be available from the broker after
> that point if the transaction needs to roll back.
>
> It is possible to deliver messages to clients with "at-least-once"
> guarantees by using the .net client library and making use of
> acknowledgements and durability. The 2nd tutorial contains a relevant
> discussion.
>
>
>
>
> -Emile
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130228/14335e2d/attachment.htm>

From matthias at rabbitmq.com  Thu Feb 28 09:30:30 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 28 Feb 2013 09:30:30 +0000
Subject: [rabbitmq-discuss] Producer confirms as a heuristic for rate
 limiting
In-Reply-To: <7509F24FF37749B7AB16B2C3B72775DE@gmail.com>
References: <E6BBEBD2EDC74640AE895FCD8450FEDF@gmail.com>
	<512E55D1.8080703@rabbitmq.com>
	<7509F24FF37749B7AB16B2C3B72775DE@gmail.com>
Message-ID: <512F23B6.306@rabbitmq.com>

Ben,

On 28/02/13 08:49, Ben Hood wrote:
> On Wednesday, 27 February 2013 at 18:52, Matthias Radestock wrote:
>
>> Using confirms to exert back pressure on a producing application is
>> fine. But I wouldn't expect that to result in particularly stable
>> latencies. For a few reasons:
>>
>> 1) one way that the internal confirm logic gets triggered is by "absence
>> of other stuff happening", so when throttling producers, confirms may
>> well happen a lot quicker.
>>
>
> If I understand you correctly, then this is precisely the feedback loop
> that I'm trying to achieve - when the sender is throttled, this gives
> the internals of Rabbit more head room to do whatever it is a Rabbit
> does. In Rabbit becoming more free, the rate of confirms increases, and
> hence the more credit the sender will receive. When the sender ramps up
> again, the reverse should happen, and so the feedback cycle continues.

My point is that the feedback signal is highly unstable, and the 
correlation between message send rate and confirm roundtrip time is 
highly non-linear. So you'd probably have to do a fair amount of 
processing on the signal in order to make the feedback smooth.

>> 2) more generally, much of the internal confirm logic will try to batch
>> things if it can, which reduces the overall cost but makes the timing of
>> confirms more variable.
>
> That's understandable - fine grained ingress credits would come at a
> premium in any case.
>
> In my scenario I'm setting a timestamp into the message header and the
> receiver is decoding this in order to compare it with its current
> timestamp. With the measurement being end to end, would the asynchronous
> nature of the confirms not be obviated by the fact that you are
> measuring the speed of the uplink plus the routing overhead plus the
> speed of a separate delivery (he says had waving)?

My point here is the same as the previous one, i.e. the flow of confirms 
is anything but smooth, which makes it tricky to construct feedback 
loops based on that which result in stable end-to-end latencies.

>> 3) confirms do come at a noticeable penalty on throughput and latency.
>> So a benchmark employing confirms would not be a very good proxy for a
>> real system running w/o confirms.
>
> What constitutes the performance penalty in this case? Do confirms
> increase the latency because they add to the measurable round trip as
> seen by the sender, or does the fact that they are turned on add extra
> processing effort which is CPU time that has to be spread over each
> message and hence on average adding latency to each message? If the
> answer is the latter, does the same apply to throughput - since confirms
> have a non-zero accounting cost, having them turned on diminishes the
> ability to process as many items in the same amount of time?

All the latter. i.e. confirms take some CPU time. which due to the 
batching and various other optimisations is not spread evenly across 
messages.

>> Having said all that, go and try it :)
>
> I'm very tempted, but the reason why I'm asking first is to avoid going
> down any rabbit holes that a more experienced person could potentially
> advise me to avoid :-)

Well, MulticastMain can already throttle producers based on a "max 
number of outstanding confirms". So playing with that would be a 
starting point.

Matthias.

From emile at rabbitmq.com  Thu Feb 28 09:32:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 28 Feb 2013 09:32:30 +0000
Subject: [rabbitmq-discuss] RabbitMq with WCF Transaction
In-Reply-To: <CAC_NAZntGO3Hq8ETDJqOUvPxPtsY69QtV73m3BN76QJ4n9FRjA@mail.gmail.com>
References: <5721bff8-0f60-49fe-919d-50220a1efbb8@googlegroups.com>
	<512E2405.8070102@rabbitmq.com>
	<CAC_NAZntGO3Hq8ETDJqOUvPxPtsY69QtV73m3BN76QJ4n9FRjA@mail.gmail.com>
Message-ID: <512F242E.7010406@rabbitmq.com>

Hi,

On 28/02/13 09:06, Hadas wrote:

> Can you please give me link to example of rabbitmq transaction?

See the 2nd tutorial for a discussion about guarantees when a message is
being delivered from the broker to a consumer:

http://www.rabbitmq.com/tutorials/tutorial-two-python.html
https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/dotnet

You should use confirms instead of transactions to guarantee that
messages from the producer to the broker don't get lost:

http://www.rabbitmq.com/confirms.html

See RabbitMQ.Client.Unit.TestExtensions.TestConfirmBarrier() for the API
usage in C?.



-Emile









From Petr.Gotthard at Honeywell.com  Thu Feb 28 09:56:17 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 28 Feb 2013 09:56:17 +0000
Subject: [rabbitmq-discuss] rabbitmq-public-umbrella issue with RabbitMQ
	3.0.2
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2C35DB1C@FR44EX3005.global.ds.honeywell.com>

Hello,

There might be an issue with the RabbitMQ 3.0.2 tags for rabbitmq-public-umbrella and rabbitmq-mochiweb.

The procedure described at http://www.rabbitmq.com/plugin-development.html is

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella

cd rabbitmq-public-umbrella

make co
make BRANCH=rabbitmq_v3_0_2 up_c

However, the last command fails because it cannot find rabbitmq-mochiweb that was removed. I tried twice with a fresh copy.

What helps is to re-do the last command by running

hg update
make BRANCH=rabbitmq_v3_0_2 up_c



Regards,
Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130228/effe3c7e/attachment.htm>

From michael.s.klishin at gmail.com  Thu Feb 28 10:07:18 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 28 Feb 2013 14:07:18 +0400
Subject: [rabbitmq-discuss] Can't create queues
In-Reply-To: <512F1D0A.60900@dnsbed.com>
References: <512F1D0A.60900@dnsbed.com>
Message-ID: <CAE3HoVSWMwX8bztsTuJoGJFPRpRBXD_wnknN-SKaNujCLVqCNw@mail.gmail.com>

2013/2/28 Steve <steve at dnsbed.com>

> So what's wrong with my setup?


See RabbitMQ log. Are there any accepted connections at all?

Also, I don't think you need that while true.

http://rubyamqp.info has plenty of code examples.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130228/d176fbd7/attachment.htm>

From emile at rabbitmq.com  Thu Feb 28 10:10:06 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 28 Feb 2013 10:10:06 +0000
Subject: [rabbitmq-discuss] Can't create queues
In-Reply-To: <512F1D0A.60900@dnsbed.com>
References: <512F1D0A.60900@dnsbed.com>
Message-ID: <512F2CFE.7020303@rabbitmq.com>

Hi Steve,

On 28/02/13 09:02, Steve wrote:
> # rabbitmqctl list_queues -p /
> Listing queues ...
> ...done.

I just tried the same and got back:

Listing queues ...
test_logs	0
...done.

> So what's wrong with my setup?

Have you checked the logfile? I assume you copied the code from the
tutorials. Do the original versions run correctly, and can you see the
queues while they run?




-Emile








From Petr.Gotthard at Honeywell.com  Thu Feb 28 10:36:04 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 28 Feb 2013 10:36:04 +0000
Subject: [rabbitmq-discuss] rabbitmq-public-umbrella issue with
	RabbitMQ	3.0.2
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2C35DB1C@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2C35DB1C@FR44EX3005.global.ds.honeywell.com>
Message-ID: <F9E85480F62349458DF67CE8BA000D8D2C35DC36@FR44EX3005.global.ds.honeywell.com>

Aghrr, this doesn't work because the public-umbrella then downloads the rabbitmq-web-dispatch, while the web-management expects rabbitmq-mochiweb, which has been deleted from http://hg.rabbitmq.com, so we cannot download it.

Could you please put the rabbitmq-mochiweb repository back?


Petr

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gotthard, Petr
Sent: 28. ?nora 2013 10:56
To: Discussions about RabbitMQ
Subject: [rabbitmq-discuss] rabbitmq-public-umbrella issue with RabbitMQ 3.0.2

Hello,

There might be an issue with the RabbitMQ 3.0.2 tags for rabbitmq-public-umbrella and rabbitmq-mochiweb.

The procedure described at http://www.rabbitmq.com/plugin-development.html is

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella

cd rabbitmq-public-umbrella

make co
make BRANCH=rabbitmq_v3_0_2 up_c

However, the last command fails because it cannot find rabbitmq-mochiweb that was removed. I tried twice with a fresh copy.

What helps is to re-do the last command by running

hg update
make BRANCH=rabbitmq_v3_0_2 up_c



Regards,
Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130228/d6962abe/attachment.htm>

From simon at rabbitmq.com  Thu Feb 28 10:41:51 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 28 Feb 2013 10:41:51 +0000
Subject: [rabbitmq-discuss] rabbitmq-public-umbrella issue with RabbitMQ
 3.0.2
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D2C35DC36@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D2C35DB1C@FR44EX3005.global.ds.honeywell.com>
	<F9E85480F62349458DF67CE8BA000D8D2C35DC36@FR44EX3005.global.ds.honeywell.com>
Message-ID: <512F346F.4090103@rabbitmq.com>

On 28/02/13 10:36, Gotthard, Petr wrote:
> Aghrr, this doesn?t work because the public-umbrella then downloads the
> rabbitmq-web-dispatch, while the web-management expects
> rabbitmq-mochiweb, which has been deleted from http://hg.rabbitmq.com,
> so we cannot download it.
>
> Could you please put the rabbitmq-mochiweb repository back?

OK, let's consider that a lesson in how not to rename a repository.

I've copied it back, hopefully you should be able to build again...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From bison_art at o2.pl  Thu Feb 28 12:44:13 2013
From: bison_art at o2.pl (rabbit15)
Date: Thu, 28 Feb 2013 04:44:13 -0800 (PST)
Subject: [rabbitmq-discuss] Plugin rabbitmq_tracing FAILED on tracing
Message-ID: <1362055453796-25243.post@n5.nabble.com>

Hi, I had some error with logging using rabbitmq_tracing. On the rate field
was FAILED. What does it mean and how could it happend ?
Best Regards,
Artur 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Plugin-rabbitmq-tracing-FAILED-on-tracing-tp25243.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From steve at dnsbed.com  Thu Feb 28 13:35:24 2013
From: steve at dnsbed.com (Steve)
Date: Thu, 28 Feb 2013 21:35:24 +0800
Subject: [rabbitmq-discuss] Can't create queues
In-Reply-To: <CAE3HoVSWMwX8bztsTuJoGJFPRpRBXD_wnknN-SKaNujCLVqCNw@mail.gmail.com>
References: <512F1D0A.60900@dnsbed.com>
	<CAE3HoVSWMwX8bztsTuJoGJFPRpRBXD_wnknN-SKaNujCLVqCNw@mail.gmail.com>
Message-ID: <CAFBt47CGG+wNm3Fh9pc8MSM1B112GZMMUhkG0ewWT=iejE+16Q@mail.gmail.com>

Hello,

Where is the code sample for exception capturing and channel reconnection?

Thanks.


2013/2/28 Michael Klishin <michael.s.klishin at gmail.com>

>
> 2013/2/28 Steve <steve at dnsbed.com>
>
>> So what's wrong with my setup?
>
>
> See RabbitMQ log. Are there any accepted connections at all?
>
> Also, I don't think you need that while true.
>
> http://rubyamqp.info has plenty of code examples.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130228/ca80e038/attachment.htm>

From michael.s.klishin at gmail.com  Thu Feb 28 14:03:14 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 28 Feb 2013 18:03:14 +0400
Subject: [rabbitmq-discuss] Can't create queues
In-Reply-To: <CAFBt47CGG+wNm3Fh9pc8MSM1B112GZMMUhkG0ewWT=iejE+16Q@mail.gmail.com>
References: <512F1D0A.60900@dnsbed.com>
	<CAE3HoVSWMwX8bztsTuJoGJFPRpRBXD_wnknN-SKaNujCLVqCNw@mail.gmail.com>
	<CAFBt47CGG+wNm3Fh9pc8MSM1B112GZMMUhkG0ewWT=iejE+16Q@mail.gmail.com>
Message-ID: <CAE3HoVTKQfLfmHShszh1y9EDEf_MXY_Af8BHDLt3iGrwijNRFQ@mail.gmail.com>

2013/2/28 Steve <steve at dnsbed.com>

> Where is the code sample for exception capturing and channel reconnection?


http://rubyamqp.info/articles/error_handling/
https://github.com/ruby-amqp/amqp/tree/master/examples/error_handling

Exceptions are pretty much only used for initial connection failures in the
API.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130228/a364005c/attachment.htm>

From simon at rabbitmq.com  Thu Feb 28 15:16:35 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 28 Feb 2013 15:16:35 +0000
Subject: [rabbitmq-discuss] Plugin rabbitmq_tracing FAILED on tracing
In-Reply-To: <1362055453796-25243.post@n5.nabble.com>
References: <1362055453796-25243.post@n5.nabble.com>
Message-ID: <512F74D3.1020902@rabbitmq.com>

On 28/02/13 12:44, rabbit15 wrote:
> Hi, I had some error with logging using rabbitmq_tracing. On the rate field
> was FAILED. What does it mean and how could it happend ?

That means the tracing consumer did not start up correctly. There should 
be something about that in the server logs.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Feb 28 15:19:51 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 28 Feb 2013 15:19:51 +0000
Subject: [rabbitmq-discuss] Plugin rabbitmq_tracing FAILED on tracing
In-Reply-To: <512F74D3.1020902@rabbitmq.com>
References: <1362055453796-25243.post@n5.nabble.com>
	<512F74D3.1020902@rabbitmq.com>
Message-ID: <512F7597.3000501@rabbitmq.com>

On 28/02/13 15:16, Simon MacMullen wrote:
> On 28/02/13 12:44, rabbit15 wrote:
>> Hi, I had some error with logging using rabbitmq_tracing. On the rate
>> field
>> was FAILED. What does it mean and how could it happend ?
>
> That means the tracing consumer did not start up correctly. There should
> be something about that in the server logs.

Oh, and 9/10 times this means there is a permissions problem with the 
directory the plugin is trying to use for traces or the username it is 
using to create queues - check the README.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From shankaralingegowda.c at gmail.com  Thu Feb 28 15:40:56 2013
From: shankaralingegowda.c at gmail.com (shankaralingegowda Singonahalli Chikkarevanna)
Date: Thu, 28 Feb 2013 07:40:56 -0800 (PST)
Subject: [rabbitmq-discuss] Cluster not running - getting Error:
 {cannot_discover_cluster,
 "The nodes provided are either offline or not running" error
Message-ID: <589c03be-aa02-4086-81c8-350afb250106@googlegroups.com>

Hi,
I am running Cluster setup of rabbitmq. 
the single node at both the machines are running fine in the same network

and I have enabled ssh entry for both master and slave
slave can access master using ssh master

after that I stopped rabbitmq slave machine
and run join cluster command like join_cluster rabbitmq at master    ---{here 
rabbitmq is master setup user name and I{p)

but getting
Error: {cannot_discover_cluster,"The nodes provided are either offline or 
not running"
error
please help me to resolve the issue

Thanks in advance

shankarlaingegowda
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130228/99b7163c/attachment.htm>

From matthias at rabbitmq.com  Thu Feb 28 17:28:24 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 28 Feb 2013 17:28:24 +0000
Subject: [rabbitmq-discuss] reliability guide
Message-ID: <512F93B8.7060308@rabbitmq.com>

The RabbitMQ web site now has guide on reliable delivery: 
http://www.rabbitmq.com/reliability.html. Feedback welcome.

Regards,

Matthias.

