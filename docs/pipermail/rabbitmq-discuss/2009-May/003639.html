<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] dropped messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20dropped%20messages&In-Reply-To=4A1B089B.7020204%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003629.html">
   <LINK REL="Next"  HREF="003640.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] dropped messages</H1>
    <B>Mark Smith</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20dropped%20messages&In-Reply-To=4A1B089B.7020204%40lshift.net"
       TITLE="[rabbitmq-discuss] dropped messages">msmith1638 at gmail.com
       </A><BR>
    <I>Wed May 27 22:40:39 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003629.html">[rabbitmq-discuss] dropped messages
</A></li>
        <LI>Next message: <A HREF="003640.html">[rabbitmq-discuss] dropped messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3639">[ date ]</a>
              <a href="thread.html#3639">[ thread ]</a>
              <a href="subject.html#3639">[ subject ]</a>
              <a href="author.html#3639">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias,Attached is a zipped Visual Studio 2008 solution. This exhibits the
problems I am seeing. The code contains a producer.exe and consumer.exe,
both projects share a sharedTypes.dll. This all builds from one solution
once you update the reference to a RabbitMQ .NET Client. The code assumes
that the broker is installed locally. Comments are in program.cs of the
producer.exe project.

Thanks for taking a look.

Mark

On Mon, May 25, 2009 at 4:07 PM, Matthias Radestock &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt;wrote:

&gt;<i> Mark,
</I>&gt;<i>
</I>&gt;<i> smittycb10 wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> however I still have the same problem 100,000's messages in and only
</I>&gt;&gt;<i> 1,000's of messages out. Am I publishing and subscribing in the most
</I>&gt;&gt;<i> efficent manner?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Can you send through the *complete* code? It's impossible to tell
</I>&gt;<i> otherwise why exactly you are getting the results you are seeing.
</I>&gt;<i>
</I>&gt;<i> How are you measuring the rates? If on the sending side you are just
</I>&gt;<i> timing a loop of publishes then all you are measuring is the time it
</I>&gt;<i> takes to hand over the messages to the kernel. They can get buffered
</I>&gt;<i> there, in the network layer, in multiple layers at the broker, etc, etc.
</I>&gt;<i>
</I>&gt;<i> Also, since AMQP's basic.publish is asynchronous, if the publishing
</I>&gt;<i> connection is not terminated cleanly then some messages will inevitably get
</I>&gt;<i> lost.
</I>&gt;<i>
</I>&gt;<i> It's also worth remembering that RabbitMQ is a message *queuing* system, so
</I>&gt;<i> one shouldn't be surprised if occasionally it queues some messages ;) What's
</I>&gt;<i> more, because RabbitMQ's queuing is quite efficient, when you push the
</I>&gt;<i> system hard, i.e. by feeding it messages as fast as you can, it will handle
</I>&gt;<i> the incoming messages at a faster rate than it sends them to consumers.
</I>&gt;<i>
</I>&gt;<i> For meaningful benchmark results it is therefore important to throttle
</I>&gt;<i> the producer, e.g. send messages at a fixed rate, monitor the rate at
</I>&gt;<i> which they are received by consumers, and slowly increase the producing
</I>&gt;<i> rate until the consumption rate starts falling behind.
</I>&gt;<i>
</I>&gt;<i>  Do I need to anything to broker?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> Unlikely.
</I>&gt;<i>
</I>&gt;<i>  Is a message rate of 100,000 per second unreasonable?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> For a single producer-&gt;broker-&gt;consumer chain that would be quite a high
</I>&gt;<i> rate - 10s of thousands of msgs/s is more realistic on stock hardware.
</I>&gt;<i>
</I>&gt;<i> If you have several independent message streams then higher total
</I>&gt;<i> throughputs can be achieved when running on lots of cores.
</I>&gt;<i>
</I>&gt;<i>  is there a max number of messages any one channel can have queued in
</I>&gt;&gt;<i> it at one time?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> No.
</I>&gt;<i>
</I>&gt;<i>  I am currently trying to squeeze all the messages into one channel,
</I>&gt;&gt;<i> should I be splitting work across channels and threads on the
</I>&gt;&gt;<i> receiving side??
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Having multiple channels and, even better, multiple connections, provides
</I>&gt;<i> more opportunities for parellelism at the server. Whether or not that
</I>&gt;<i> actually makes a positive difference depends on lots of factors.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>&gt;<i>
</I>


-- 
Mark Smith

please send all correspondences to this
new email address
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090527/fb755cf7/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090527/fb755cf7/attachment.htm</A> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitMQ_Producer.zip
Type: application/zip
Size: 21116 bytes
Desc: not available
Url : <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090527/fb755cf7/attachment.zip">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090527/fb755cf7/attachment.zip</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003629.html">[rabbitmq-discuss] dropped messages
</A></li>
	<LI>Next message: <A HREF="003640.html">[rabbitmq-discuss] dropped messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3639">[ date ]</a>
              <a href="thread.html#3639">[ thread ]</a>
              <a href="subject.html#3639">[ subject ]</a>
              <a href="author.html#3639">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
