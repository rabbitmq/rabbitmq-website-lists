<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] exchanges and message processing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20exchanges%20and%20message%20processing&In-Reply-To=4A00CADB.90900%40joetify.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003529.html">
   <LINK REL="Next"  HREF="003534.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] exchanges and message processing</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20exchanges%20and%20message%20processing&In-Reply-To=4A00CADB.90900%40joetify.com"
       TITLE="[rabbitmq-discuss] exchanges and message processing">matthias at lshift.net
       </A><BR>
    <I>Wed May  6 07:53:35 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003529.html">[rabbitmq-discuss] exchanges and message processing
</A></li>
        <LI>Next message: <A HREF="003534.html">[rabbitmq-discuss] exchanges and message processing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3530">[ date ]</a>
              <a href="thread.html#3530">[ thread ]</a>
              <a href="subject.html#3530">[ subject ]</a>
              <a href="author.html#3530">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Joe,

Joe Williams wrote:
&gt;<i> This is in relation to a thread I started on the ruby-amqp list:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://groups.google.com/group/ruby-amqp/browse_thread/thread/6296567fa545ca8d?hl=en">http://groups.google.com/group/ruby-amqp/browse_thread/thread/6296567fa545ca8d?hl=en</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> My question is regarding exchanges, queues and dealing with messages 
</I>&gt;<i> that I would like to get processed only once. I am sending messages 
</I>&gt;<i> containing json and would like to use a field from the json as the 
</I>&gt;<i> routing key to alleviate needing to do numerous case statements in my 
</I>&gt;<i> code. It seems that fanout and direct exchanges would not work since 
</I>&gt;<i> they have possibility of having messages getting processed more than 
</I>&gt;<i> once by different consumers. The responder on the ruby-amqp list 
</I>&gt;<i> mentioned a shared queue that is in the 091 spec. But this seems to put 
</I>&gt;<i> me back at using a long case statement.
</I>&gt;<i> 
</I>&gt;<i> In an ideal situation I would have multiple consumers (written without 
</I>&gt;<i> epic case statements) and messages that get consumed once and only once.
</I>&gt;<i> 
</I>&gt;<i> Any suggestions on how to go about doing something like this?
</I>
The role of exchanges is to route messages to queues. They *all* have 
the possibility of resulting in messages getting routed to multiple 
queues and hence processed by multiple consumers - that's what they are 
there for. Whether that actually happens depends on the bindings that 
have been configured.

For your use case, the following setup should work:
- one direct exchange
- one queue for each of the case branches
- one binding per queue to the direct exchange, with the binding key set 
to the case branch discriminator
- one consumer per queue, handling the messages for one particular 
branch discriminator

In this setup messages will get routed to exactly one consumer, based on 
their routing key. You'd only get duplication if you set up additional 
queues and consumers that bound to the direct exchange with the same 
binding keys.

One possible downside of this setup compared to a single queue is that 
message order is not preserved across queues.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003529.html">[rabbitmq-discuss] exchanges and message processing
</A></li>
	<LI>Next message: <A HREF="003534.html">[rabbitmq-discuss] exchanges and message processing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3530">[ date ]</a>
              <a href="thread.html#3530">[ thread ]</a>
              <a href="subject.html#3530">[ subject ]</a>
              <a href="author.html#3530">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
