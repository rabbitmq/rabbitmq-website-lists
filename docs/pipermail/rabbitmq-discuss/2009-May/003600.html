<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] best practice for EC2 deployment?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20best%20practice%20for%20EC2%20deployment%3F&In-Reply-To=E92924F1-63B6-4740-BF51-56ACDDB13DD7%40pobox.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003599.html">
   <LINK REL="Next"  HREF="003604.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] best practice for EC2 deployment?</H1>
    <B>Dmitriy Samovskiy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20best%20practice%20for%20EC2%20deployment%3F&In-Reply-To=E92924F1-63B6-4740-BF51-56ACDDB13DD7%40pobox.com"
       TITLE="[rabbitmq-discuss] best practice for EC2 deployment?">dmitriy.samovskiy at cohesiveft.com
       </A><BR>
    <I>Wed May 20 21:09:41 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003599.html">[rabbitmq-discuss] best practice for EC2 deployment?
</A></li>
        <LI>Next message: <A HREF="003604.html">[rabbitmq-discuss] best practice for EC2 deployment?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3600">[ date ]</a>
              <a href="thread.html#3600">[ thread ]</a>
              <a href="subject.html#3600">[ subject ]</a>
              <a href="author.html#3600">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Geir,

Geir Magnusson Jr. wrote:
&gt;<i> I'm about to create a rabbitMQ cluster on EC2.
</I>&gt;<i> 
</I>&gt;<i> Anyone have any pointers or suggestions for best-practices or things  
</I>&gt;<i> that will make this easier?
</I>

Basically, there are several things that I have seen people on this list do when deploying 
on EC2.

1. Consider putting Mnesia dir and persister log on EBS if you need persistence beyond 
reboot.

2. If you go with EBS, before creating mnesia dir and before starting broker off of data 
on EBS, you want to make sure your instance is running with the hostname that you control, 
not the one assigned by amazon (not all AMIs are affected by this). This way you will be 
able to use mnesia on another instance if this one crashes (that new instance will need 
same hostname). [1]

3. All hostnames should be defined in /etc/hosts or in DNS that you control so that nodes 
can talk to each other. Plus, (afaik) erlang can't [easily?] communicate over IPs without 
names.

I personally don't know how well rabbitmq reacts to changes in /etc/hosts - say hostA was 
at 10.1.1.1 and that instance crashed and new instance is now 10.2.2.2. As a potential 
solution, (attention! shameless plug) - you may check out VPN-Cubed for EC2 solution, that 
can help you get rid of this problem. [3] Or you may consider Elastic IPs (but they cost $$$).

4. Your clients may need to set insist=True when opening connections. This may become 
especially relevant if some clients are in EC2 and some are not (or are located in another 
region). [2]

5. I would also consider if you need clustering in the first place. Since queues 
themselves are currently not replicated (afaik), I think one of the main use cases for 
clustering is support for large numbers of clients (to better spread IO and connections). 
If it's not your usecase, I don't know if you can benefit from clustering. I would love to 
hear others' opinions as to reasons why they are using broker clusters in their current form.

I may have missed something, hopefully other folks can add/adjust as needed.


[1] <A HREF="http://www.nabble.com/Mnesia-db-integrity-td21754791.html">http://www.nabble.com/Mnesia-db-integrity-td21754791.html</A>
[2] <A HREF="http://www.google.com/search?q=site%3Alists.rabbitmq.com+insist+ec2+internal">http://www.google.com/search?q=site%3Alists.rabbitmq.com+insist+ec2+internal</A>
[3] <A HREF="http://www.cohesiveft.com/vpn4ec2/">http://www.cohesiveft.com/vpn4ec2/</A>


Hope this gives you a good start!

Cheers,
Dmitriy


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003599.html">[rabbitmq-discuss] best practice for EC2 deployment?
</A></li>
	<LI>Next message: <A HREF="003604.html">[rabbitmq-discuss] best practice for EC2 deployment?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3600">[ date ]</a>
              <a href="thread.html#3600">[ thread ]</a>
              <a href="subject.html#3600">[ subject ]</a>
              <a href="author.html#3600">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
