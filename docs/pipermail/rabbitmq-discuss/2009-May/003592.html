<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] mysterious rabbit crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20mysterious%20rabbit%20crash&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003591.html">
   <LINK REL="Next"  HREF="003593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] mysterious rabbit crash</H1>
    <B>Dmitriy Samovskiy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20mysterious%20rabbit%20crash&In-Reply-To="
       TITLE="[rabbitmq-discuss] mysterious rabbit crash">dmitriy.samovskiy at cohesiveft.com
       </A><BR>
    <I>Tue May 19 16:44:20 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003591.html">[rabbitmq-discuss] flushing a queue?
</A></li>
        <LI>Next message: <A HREF="003593.html">[rabbitmq-discuss] mysterious rabbit crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3592">[ date ]</a>
              <a href="thread.html#3592">[ thread ]</a>
              <a href="subject.html#3592">[ subject ]</a>
              <a href="author.html#3592">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

One of my rabbits running on an old machine crashed last night.

Starting yesterday at 3:04pm, rabbit apparently has been complaining about &quot;alarm_handler: 
{set,{system_memory_high_watermark,[]}}&quot; in the log file.

But at 00:27am this morning, it rolled the persister log and crashed.

Please note that the size of rabbit_persister.LOG.previous is roughly the same as the 
amount of memory it failed to allocate.

My question is is this a coincidence that the numbers are close? I would think rabbit has 
no use for *previous* persister log in this situation.

Disk where mnesia and persister log are located was not full at the time of crash (I 
think). I am also nearly positive that consumers were around just before and during the 
crash, and were properly consuming from the broker (I have charts with data going all the 
way to roughly 00:27am). Which makes me wonder why rabbit was using so much memory if its 
queues were being drained normally...

-rw-r--r--    1 rabbitmq rabbitmq 22722770 May 19 00:27 rabbit_persister.LOG.previous

=erl_crash_dump:0.1
Tue May 19 00:27:27 2009
Slogan: binary_alloc: Cannot allocate 22615166 bytes of memory (of type &quot;binary&quot;
).
System version: Erlang (BEAM) emulator version 5.6.5 [source] [async-threads:30]
Compiled: Fri Apr  3 11:49:36 2009
Atoms: 9807
=memory
total: 931495488
processes: 90885644
processes_used: 90882996
system: 840609844
atom: 435481
atom_used: 426079
binary: 815315560
code: 3451735
ets: 20791156


{rabbit,&quot;RabbitMQ&quot;,&quot;1.5.4&quot;},
                         {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.4.7&quot;},
                         {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.1.8&quot;},
                         {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.5.4&quot;},
                         {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.15.5&quot;},
                         {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.12.5&quot;}]},

Has anybody seen anything like this?

This is a very low priority issue for me, I am just curious.

Thanks in advance for your thoughts and time spent looking into it.

- Dmitriy


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003591.html">[rabbitmq-discuss] flushing a queue?
</A></li>
	<LI>Next message: <A HREF="003593.html">[rabbitmq-discuss] mysterious rabbit crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3592">[ date ]</a>
              <a href="thread.html#3592">[ thread ]</a>
              <a href="subject.html#3592">[ subject ]</a>
              <a href="author.html#3592">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
