<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] General approaches for tracking unreclaimed	memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20General%20approaches%20for%20tracking%20unreclaimed%0A%09memory&In-Reply-To=4AE62323.5030603%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005246.html">
   <LINK REL="Next"  HREF="005253.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] General approaches for tracking unreclaimed	memory</H1>
    <B>Garrett Smith</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20General%20approaches%20for%20tracking%20unreclaimed%0A%09memory&In-Reply-To=4AE62323.5030603%40lshift.net"
       TITLE="[rabbitmq-discuss] General approaches for tracking unreclaimed	memory">g at rre.tt
       </A><BR>
    <I>Tue Oct 27 23:43:02 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005246.html">[rabbitmq-discuss] General approaches for tracking unreclaimed memory
</A></li>
        <LI>Next message: <A HREF="005253.html">[rabbitmq-discuss] General approaches for tracking unreclaimed memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5252">[ date ]</a>
              <a href="thread.html#5252">[ thread ]</a>
              <a href="subject.html#5252">[ subject ]</a>
              <a href="author.html#5252">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(repost to list)

On Mon, Oct 26, 2009 at 5:30 PM, Matthias Radestock &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt; wrote:
&gt;<i> Garrett Smith wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Apart from using rabbitmqctl to check some of the more obvious
</I>&gt;&gt;<i> sources for lost memory (e.g. connections, queues, etc.) are there
</I>&gt;&gt;<i> other techniques for tracking down where the broker might be
</I>&gt;&gt;<i> allocating resources that aren't cleaned up?
</I>&gt;<i>
</I>&gt;<i> The output of the various rabbitmqctl list_* commands is definitely the
</I>&gt;<i> first port of call. Do the &quot;row counts&quot; of these increase? Or do the message
</I>&gt;<i> counts in the queues increase?
</I>
Hah, I missed something obvious here. Thanks for reminding me to start
at the beginning :)

So, here's the problem, which everyone reasonably faces: when a
consumer goes away, their queues pile up, which is basically a &quot;leak&quot;
at the application/system level (not with rabbit).

I'm being a little lazy here by not looking into the docs or the AMQP
spec, but is there a way to guard against an eventual crash in this
case (I believe this has manifested itself for me once by running out
of Erlang processes, but memory is certainly an issue as well)?

Having worked with qpid a bit, their broker will respect the
time-to-live/expires info associated with a message. I know, at least
in 1.6, rabbit didn't do that. That would be one solution.

A fallback would be a limit to the number of messages a queue could handle.

Short of that, I can run a daemon to routinely check rabbit for queues
that pile up, but that's a moving part I'd prefer to avoid if
possible.

Garrett


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005246.html">[rabbitmq-discuss] General approaches for tracking unreclaimed memory
</A></li>
	<LI>Next message: <A HREF="005253.html">[rabbitmq-discuss] General approaches for tracking unreclaimed memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5252">[ date ]</a>
              <a href="thread.html#5252">[ thread ]</a>
              <a href="subject.html#5252">[ subject ]</a>
              <a href="author.html#5252">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
