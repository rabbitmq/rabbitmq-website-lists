<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] When is persister.log.previous made?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20When%20is%20persister.log.previous%20made%3F&In-Reply-To=84fb38e30910190910k2387d28du1cf3ebe55dae909b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005172.html">
   <LINK REL="Next"  HREF="005148.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] When is persister.log.previous made?</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20When%20is%20persister.log.previous%20made%3F&In-Reply-To=84fb38e30910190910k2387d28du1cf3ebe55dae909b%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] When is persister.log.previous made?">matthias at lshift.net
       </A><BR>
    <I>Mon Oct 19 17:54:57 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005172.html">[rabbitmq-discuss] When is persister.log.previous made?
</A></li>
        <LI>Next message: <A HREF="005148.html">[rabbitmq-discuss]  rabbitmq-stomp connection stats?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5173">[ date ]</a>
              <a href="thread.html#5173">[ thread ]</a>
              <a href="subject.html#5173">[ subject ]</a>
              <a href="author.html#5173">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Tsuraan,

tsuraan wrote:
&gt;&gt;<i> As an aside, why are you using transactions on the consuming side? I
</I>&gt;&gt;<i> have yet to come across a use case where that is genuinely required.
</I>&gt;<i> 
</I>&gt;<i> Our consumers are almost always also producers, so we do the message
</I>&gt;<i> ack and the creation of new messages in a transaction.  I'm not sure
</I>&gt;<i> that it's necessary; I'm used to databases, where I tend to do
</I>&gt;<i> everything in a transaction to ensure that everything is consistent
</I>&gt;<i> when I'm done, but our messaging stuff is designed to handle multiple
</I>&gt;<i> copies of the same message, so it's probably a bit overkill to also
</I>&gt;<i> use transactions.
</I>&gt;<i> 
</I>&gt;<i> I seem to remember that I had some problem when I was first looking at
</I>&gt;<i> rabbit that I could publish a stream of messages in non-transactional
</I>&gt;<i> mode, and not all the messages would be delivered (or enqueued).  I
</I>&gt;<i> think I may have been doing something stupid like exiting my program
</I>&gt;<i> without closing my channel, but moving to transactional mode fixed the
</I>&gt;<i> problem, and I think I've been a bit religious about transactions
</I>&gt;<i> since then.
</I>
Transactions are currently the only way for a client to get an
acknowledgment from the broker that sent messages have not only made it
to the broker (a normal connection/channel.close, or indeed any other
synchronous AMQP operation, is sufficient for that) but also will
survive a broker restart (if they were marked as persistent).

So use of tx mode on the sending side is quite common.

Use of tx mode on the receiving side, for acks, is much less common,
since the worst thing that can happen if an ack gets lost is that the
message will get delivered again. That can happen in other situations
anyway, e.g. client or connection failure, so apps need to be able to
cope with it already.

If your producers are also senders, and you want the aforementioned
guarantees on sending, I would recommend using two channels - one in tx
mode for sending and one on non-tx mode for receiving/ack'ing.


Regard,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005172.html">[rabbitmq-discuss] When is persister.log.previous made?
</A></li>
	<LI>Next message: <A HREF="005148.html">[rabbitmq-discuss]  rabbitmq-stomp connection stats?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5173">[ date ]</a>
              <a href="thread.html#5173">[ thread ]</a>
              <a href="subject.html#5173">[ subject ]</a>
              <a href="author.html#5173">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
