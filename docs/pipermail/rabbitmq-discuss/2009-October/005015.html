<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Dynamically binding to a topic exchange	without losing messages?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Dynamically%20binding%20to%20a%20topic%20exchange%0A%09without%20losing%20messages%3F&In-Reply-To=6a3ae47e0910020706n3f91cd1ag3de6b98a5e2f6ec4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005014.html">
   <LINK REL="Next"  HREF="005016.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Dynamically binding to a topic exchange	without losing messages?</H1>
    <B>Paul Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Dynamically%20binding%20to%20a%20topic%20exchange%0A%09without%20losing%20messages%3F&In-Reply-To=6a3ae47e0910020706n3f91cd1ag3de6b98a5e2f6ec4%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Dynamically binding to a topic exchange	without losing messages?">pauljones23 at gmail.com
       </A><BR>
    <I>Fri Oct  2 16:32:41 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005014.html">[rabbitmq-discuss] Dynamically binding to a topic exchange	without losing messages?
</A></li>
        <LI>Next message: <A HREF="005016.html">[rabbitmq-discuss] Dynamically binding to a topic exchange	without losing messages?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5015">[ date ]</a>
              <a href="thread.html#5015">[ thread ]</a>
              <a href="subject.html#5015">[ subject ]</a>
              <a href="author.html#5015">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Robert,

In terms of your application, is only one Erlang process every going to
process a given stream? Would it be possible to change the model slightly,
and in a start message send the name of a queue instead? That way your
producer could allocate a queue, connect it to that topic, and send out a
message telling consumers where to listen.

(Some might argue this violates some AMQP design principles though, since it
starts coupling the sender to the receiver more than you'd otherwise hope)

Paul.

On Fri, Oct 2, 2009 at 3:06 PM, Robert Raschke &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rtrlists at googlemail.com</A>&gt;wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I have a usage scenario that I am having a bit of trouble translating into
</I>&gt;<i> exchanges, queues and bindings. This is using the Erlang client.
</I>&gt;<i>
</I>&gt;<i> I have a stream of messages that have the identifying characteristics
</I>&gt;<i> &lt;type&gt; and &lt;id&gt;. I would like to process these such that I can recognise a
</I>&gt;<i> particular &lt;type&gt;=START to indicate that all messages related to &lt;id&gt; that
</I>&gt;<i> follow are to be processed in some fashion by a new Erlang process.
</I>&gt;<i>
</I>&gt;<i> So, I declare a topic exchange and bind a queue with the key 'START.*'. I
</I>&gt;<i> now get my &quot;starter&quot; messages, nice. My naive idea was to have this starter
</I>&gt;<i> create a new queue and bind it with key '*.ID' and then have a new Erlang
</I>&gt;<i> process work on the messages arriving there.
</I>&gt;<i>
</I>&gt;<i> What I am trying to get my head around is, how can I quarantee that any
</I>&gt;<i> messages arriving for the new ID don't get lost while my starter process is
</I>&gt;<i> setting stuff up? For example, a message with key START.27 arrives, the
</I>&gt;<i> starter now sets up the new queue and binding against '*.27', but before
</I>&gt;<i> that is complete, a message with key X.27 got published (and potentially
</I>&gt;<i> lost).
</I>&gt;<i>
</I>&gt;<i> One way I could see getting this to work, would be to have my starter
</I>&gt;<i> process read _all_ messages (not just the START ones), synchronously
</I>&gt;<i> starting the sub processes, and passing any non-starter messages to another
</I>&gt;<i> exchange where the sub-processes have bound their queues.
</I>&gt;<i>
</I>&gt;<i> Somehow this &quot;pass it along&quot; approach seems a bit clunky to me. Is there a
</I>&gt;<i> more elegant way? Or, alternatively, does RabbitMQ Erlang Client have some
</I>&gt;<i> nice and easy functions to &quot;consume message from here, look at it, and if
</I>&gt;<i> not for me, publish it to there&quot;? It looks to me as if I need to transmit
</I>&gt;<i> the RoutingKey as part of the message, as it doesn't seem to be part of the
</I>&gt;<i> #content{} structure. But maybe I've missed something.
</I>&gt;<i>
</I>&gt;<i> Thanks for any thoughts,
</I>&gt;<i> Robby
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091002/20160296/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091002/20160296/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005014.html">[rabbitmq-discuss] Dynamically binding to a topic exchange	without losing messages?
</A></li>
	<LI>Next message: <A HREF="005016.html">[rabbitmq-discuss] Dynamically binding to a topic exchange	without losing messages?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5015">[ date ]</a>
              <a href="thread.html#5015">[ thread ]</a>
              <a href="subject.html#5015">[ subject ]</a>
              <a href="author.html#5015">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
