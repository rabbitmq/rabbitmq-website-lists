<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Simple benchmark and results
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Simple%20benchmark%20and%20results&In-Reply-To=4ADD5443.6080701%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005181.html">
   <LINK REL="Next"  HREF="005189.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Simple benchmark and results</H1>
    <B>David Glaubman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Simple%20benchmark%20and%20results&In-Reply-To=4ADD5443.6080701%40lshift.net"
       TITLE="[rabbitmq-discuss] Simple benchmark and results">dglaubman at acm.org
       </A><BR>
    <I>Wed Oct 21 06:53:58 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005181.html">[rabbitmq-discuss] Simple benchmark and results
</A></li>
        <LI>Next message: <A HREF="005189.html">[rabbitmq-discuss] Simple benchmark and results
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5187">[ date ]</a>
              <a href="thread.html#5187">[ thread ]</a>
              <a href="subject.html#5187">[ subject ]</a>
              <a href="author.html#5187">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Matthias,

&gt;<i> It looks like MSMQ may have some optimisation for the local case - 
</I>&gt;<i> perhaps it bypasses the TCP/IP stack?
</I>
Yes, I believe local MSMQ is highly optimized (perhaps using pipes?).
My major interest there was the send rate of 33K messages per second 
that MSMQ managed for the remote case, 
compared  to 4K with Rabbit's .Net client.
It's odd -- MSMQ Send seems to be  8X faster than Rabbit/.Net Publish, 
but MSMQ Receive is 8X slower than Consume!

&gt;<i> As for rabbit, I suspect the main bottleneck is actually the .net 
</I>&gt;<i> client. What's the CPU load like for the client? It may well be maxing 
</I>&gt;<i> out one core.
</I>
For Rabbit, in remote case, client CPU load peaks at around 40% 
(2 cores at a little almost 60%, other 2 &lt; 10%).
Server CPU load goes to around 30%, 
concentrated on two cores(around 60%, 50%, 5%, 5%).

&gt;<i> [...]
</I>&gt;<i> If you can, try running some tests with the MulticastMain example that 
</I>&gt;<i> ships with the Java client, for comparison.
</I>
The Java client tells a very different story ...

   ./runjava.bat com.rabbitmq.examples.MulticastMain -h ca1tesla1 -x 1 -y 1
-z 20 -s 24 -a
   (Single Publisher, single consumer each on its own thread)

Averaged 20K/sec sends, 20K/sec receives.  All server CPUs were at 85-95%,
client CPUs at 35%, 
avg reported latency around 8 or 9 ms.

If #Publishers and/or #Consumers &gt; 1, 
    all server CPUs were maxed out the whole time, client stayed at 35%.

With #Producers = 2, # consumers = 1,   sends/sec = 30K, rcv/sec = 14K. 

With #Producers = 1, # consumers = 2,   sends/sec = 17K, rcv/sec = 27K 
(both consumers get the same messages)

&gt;<i> Also, note that in your particular test setup the RabbitMQ server will 
</I>&gt;<i> not be able to take full advantage of the multiple cores since there is 
</I>&gt;<i> too little inherent parallelism. 
</I>
Is load on the server cores so evenly distributed when using the Java client 
(even with single Publisher, single Consumer) 
largely because sends and receives are running simultaneously on separate
(client) threads? 

&gt;<i> Presumably your intended use case does 
</I>&gt;<i> have more than a single message stream, 
</I>&gt;<i> going from one producer to one 
</I>&gt;<i> consumer; such a configuration will produce higher message rates overall.
</I>
Yes.  I'm trying to pipeline a large computation 
which consists of a small number of massively parallel stages. 
Each stage consists of a large number of components 
each of which transform an input stream (from previous stage) 
to an output stream (next stage).
I'm basically looking for a way to send messages fast enough
to prove the concept is workable (or not).
If I can come close to saturating Gbit Ethernet 
using COTS h/w and s/w, 
I'll know I'm on the right track. (and, contrariwise).

David

-----Original Message-----
From: Matthias Radestock [mailto:<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>] 
Sent: Monday, October 19, 2009 11:10 PM
To: David Glaubman
Cc: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Simple benchmark and results

[...]
-- 
View this message in context: <A HREF="http://www.nabble.com/Simple-benchmark-and-results-tp25968960p25986856.html">http://www.nabble.com/Simple-benchmark-and-results-tp25968960p25986856.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005181.html">[rabbitmq-discuss] Simple benchmark and results
</A></li>
	<LI>Next message: <A HREF="005189.html">[rabbitmq-discuss] Simple benchmark and results
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5187">[ date ]</a>
              <a href="thread.html#5187">[ thread ]</a>
              <a href="subject.html#5187">[ subject ]</a>
              <a href="author.html#5187">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
