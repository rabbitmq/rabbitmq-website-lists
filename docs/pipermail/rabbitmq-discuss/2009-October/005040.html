<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbit disk_mode branch eating up all RAM, including swap, dying
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbit%20disk_mode%20branch%20eating%20up%20all%20RAM%2C%0A%20including%20swap%2C%20dying&In-Reply-To=dbd9700a0910051123t37207495g69b47a960b5ab3ba%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005034.html">
   <LINK REL="Next"  HREF="005035.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbit disk_mode branch eating up all RAM, including swap, dying</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbit%20disk_mode%20branch%20eating%20up%20all%20RAM%2C%0A%20including%20swap%2C%20dying&In-Reply-To=dbd9700a0910051123t37207495g69b47a960b5ab3ba%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] rabbit disk_mode branch eating up all RAM, including swap, dying">matthew at lshift.net
       </A><BR>
    <I>Tue Oct  6 11:01:24 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005034.html">[rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,	including swap, dying
</A></li>
        <LI>Next message: <A HREF="005035.html">[rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,	including swap, dying
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5040">[ date ]</a>
              <a href="thread.html#5040">[ thread ]</a>
              <a href="subject.html#5040">[ subject ]</a>
              <a href="author.html#5040">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Oct 05, 2009 at 02:23:14PM -0400, Brian Whitman wrote:
&gt;<i> &gt; How many messages did you have in there, and do you know the average
</I>&gt;<i> &gt; size?
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> Can't know for sure but my guess is about 20 queues, about 500K messages in
</I>&gt;<i> each queue, message sizes are about 1KB each.
</I>
Hmm, 10million rows in mnesia should be fine, but I can definitely
believe that mnesia would take more than 30 seconds to start up, esp if
this is on EC2 which is known to have disk bandwidth issues (correct me
if I'm wrong there). It's very possible that nothing was wrong at all -
it just timed out waiting for mnesia to start up and load in all the
tables, which would in turn stop Rabbit from starting up.

&gt;<i> Does bug21444 have the disk mode auto-pinning stuff?
</I>&gt;<i> 
</I>&gt;<i> I understand about the warnings, the stable branch though would crash almost
</I>&gt;<i> immediately with our message load.
</I>
Yes. Basically, a lot of the various features of 20980 got split out
into different branches. The main bulk of the work, in terms of the new
persister was in 21368, but that lacked the manual controls for pinning
queues to disk - everything it did was automatic only. 21368 then went
through a lot of QA - the code is in good shape (although flawed due to
issues with mnesia), and 21444 adds to 21368 the manual controls.

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005034.html">[rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,	including swap, dying
</A></li>
	<LI>Next message: <A HREF="005035.html">[rabbitmq-discuss] rabbit disk_mode branch eating up all RAM,	including swap, dying
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5040">[ date ]</a>
              <a href="thread.html#5040">[ thread ]</a>
              <a href="subject.html#5040">[ subject ]</a>
              <a href="author.html#5040">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
