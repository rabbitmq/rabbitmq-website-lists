<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] When is persister.log.previous made?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20When%20is%20persister.log.previous%20made%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005184.html">
   <LINK REL="Next"  HREF="005168.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] When is persister.log.previous made?</H1>
    <B>tsuraan</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20When%20is%20persister.log.previous%20made%3F&In-Reply-To="
       TITLE="[rabbitmq-discuss] When is persister.log.previous made?">tsuraan at gmail.com
       </A><BR>
    <I>Thu Oct 15 20:23:21 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005184.html">[rabbitmq-discuss] Streaming stock prices to long-polling	clients
</A></li>
        <LI>Next message: <A HREF="005168.html">[rabbitmq-discuss] When is persister.log.previous made?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5146">[ date ]</a>
              <a href="thread.html#5146">[ thread ]</a>
              <a href="subject.html#5146">[ subject ]</a>
              <a href="author.html#5146">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>One of our systems overfed the rabbit, and it's now a bit angry.  The
strange problem that we're having, though, is that it seems that the
commit after the thousandth ack'd message is triggering the persister
log rollover, which is then causing beam to run out of memory.  The
only thing we're doing is basic_get'ing messages, acking them, and
then committing (the channel is transactional).  We've also tried
committing every thousand messages; either way, the first commit after
the thousandth ack'd message is causing the persister log rollover,
followed immediately by beam crashing due to being out of RAM.

Does anybody know why rolling the persister log would cause the system
to run out of memory?  It seems like a strange place to need to
allocate a lot of RAM, but I'm not at all familiar with how the
persister rollover works.  I'm going to next try just doing basic_gets
without being in a transaction to see if that prevents the crash, but
I'd like a better understanding of how the log rollover works, and why
it seems to need a lot of memory to succeed.

Also, will the future (1.8?) persister still do the process described
in <A HREF="https://dev.rabbitmq.com/wiki/RabbitPersisterDesign">https://dev.rabbitmq.com/wiki/RabbitPersisterDesign</A> ?  Writing the
entire rabbit state to disk every so-often doesn't seem like it would
work terribly well when storing huge amounts of data, or am I
understanding how the persister log works?


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005184.html">[rabbitmq-discuss] Streaming stock prices to long-polling	clients
</A></li>
	<LI>Next message: <A HREF="005168.html">[rabbitmq-discuss] When is persister.log.previous made?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5146">[ date ]</a>
              <a href="thread.html#5146">[ thread ]</a>
              <a href="subject.html#5146">[ subject ]</a>
              <a href="author.html#5146">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
