<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Simple benchmark and results
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Simple%20benchmark%20and%20results&In-Reply-To=25986856.post%40talk.nabble.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005187.html">
   <LINK REL="Next"  HREF="005190.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Simple benchmark and results</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Simple%20benchmark%20and%20results&In-Reply-To=25986856.post%40talk.nabble.com"
       TITLE="[rabbitmq-discuss] Simple benchmark and results">matthias at lshift.net
       </A><BR>
    <I>Wed Oct 21 08:42:28 BST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005187.html">[rabbitmq-discuss] Simple benchmark and results
</A></li>
        <LI>Next message: <A HREF="005190.html">[rabbitmq-discuss] Simple benchmark and results
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5189">[ date ]</a>
              <a href="thread.html#5189">[ thread ]</a>
              <a href="subject.html#5189">[ subject ]</a>
              <a href="author.html#5189">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David,

David Glaubman wrote:
&gt;<i> For Rabbit, in remote case, client CPU load peaks at around 40% 
</I>&gt;<i> (2 cores at a little almost 60%, other 2 &lt; 10%).
</I>&gt;<i> Server CPU load goes to around 30%, 
</I>&gt;<i> concentrated on two cores(around 60%, 50%, 5%, 5%).
</I>
Given that sending is asynchronous, if neither the client or the server 
are maxing out a CPU then the network communication would seem to be the 
bottleneck.

Nagle is the obvious culprit, but both the client and the server disable 
that.

Could it be that the Windows firewall or antivirus is getting in the 
way? We have seen some very odd behaviour with these two. OTOH, that 
should affect the Java client too. Hmm.

&gt;<i> The Java client tells a very different story ...
</I>&gt;<i> 
</I>&gt;<i>    ./runjava.bat com.rabbitmq.examples.MulticastMain -h ca1tesla1 -x 1 -y 1
</I>&gt;<i> -z 20 -s 24 -a
</I>&gt;<i>    (Single Publisher, single consumer each on its own thread)
</I>&gt;<i> 
</I>&gt;<i> Averaged 20K/sec sends, 20K/sec receives.  All server CPUs were at 85-95%,
</I>&gt;<i> client CPUs at 35%, 
</I>&gt;<i> avg reported latency around 8 or 9 ms.
</I>
These figures are much more in line with what I'd expect to see.

Note that there is one obvious difference to the .net tests: By setting 
the &quot;-a&quot; flag the consumers will operate in auto-ack mode, whereas in 
the .net code you posted you do an explicit ack. The former is quite a 
bit more efficient and may well account for the bulk of the difference 
between the .net and java consumer performance. The setting won't affect 
the sending side at all though,

The discrepancy between the .net and Java client merits investigation. 
Can you package up your test code in a form that makes it 
straightforward to run and thus try to reproduce your results? Bonus 
points if it is easy to get the test to run under mono.

&gt;<i> If I can come close to saturating Gbit Ethernet using COTS h/w and
</I>&gt;<i> s/w, I'll know I'm on the right track.
</I>
Message size has a big impact. Small messages carry a significant 
(relative) framing and processing overhead. To get anywhere close to 
saturating Gbit Ethernet your message payloads would have to be 
substantially larger than 24 bytes. And you'd definitely want to create 
multiple streams. Our OPRA testing with Intel two years ago did both 
these things.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005187.html">[rabbitmq-discuss] Simple benchmark and results
</A></li>
	<LI>Next message: <A HREF="005190.html">[rabbitmq-discuss] Simple benchmark and results
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5189">[ date ]</a>
              <a href="thread.html#5189">[ thread ]</a>
              <a href="subject.html#5189">[ subject ]</a>
              <a href="author.html#5189">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
