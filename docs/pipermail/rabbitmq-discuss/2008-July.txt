From rabbitmq at tmm1.net  Tue Jul  1 04:18:33 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Mon, 30 Jun 2008 20:18:33 -0700
Subject: [rabbitmq-discuss] ACK modes in the STOMP adapter
Message-ID: <e1c05edd0806302018k5e87406dnc43272a70c770e2c@mail.gmail.com>

It seems the STOMP adapter does not support ack modes (
http://stomp.codehaus.org/Ack+Modes). If I subscribe to a queue using ack:
client, I continue to get additional messages from the queue, even before I
respond with an ACK for the original message.
  Aman Gupta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080630/a670a782/attachment.htm 

From tonyg at lshift.net  Tue Jul  1 11:41:12 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 01 Jul 2008 11:41:12 +0100
Subject: [rabbitmq-discuss] ACK modes in the STOMP adapter
In-Reply-To: <e1c05edd0806302018k5e87406dnc43272a70c770e2c@mail.gmail.com>
References: <e1c05edd0806302018k5e87406dnc43272a70c770e2c@mail.gmail.com>
Message-ID: <486A09C8.6070007@lshift.net>

Hi Aman,

It does support "ack: client", but acknowledgements are not used to 
perform flow control: instead, they can be used to arrange for 
at-least-once deliveries.

Essentially, "ack: client" is translated into setting "noack" to "false" 
on the "basic.consume" AMQP method that results from a STOMP "SUBSCRIBE" 
operation. Please see the AMQP specification for the semantics of the 
"noack" flag.

Regards,
   Tony


Aman Gupta wrote:
> It seems the STOMP adapter does not support ack modes 
> (http://stomp.codehaus.org/Ack+Modes). If I subscribe to a queue using 
> ack: client, I continue to get additional messages from the queue, even 
> before I respond with an ACK for the original message.
> 
>   Aman Gupta
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Tue Jul  1 13:38:00 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 01 Jul 2008 13:38:00 +0100
Subject: [rabbitmq-discuss] XMPP gateway released
Message-ID: <486A2528.90103@lshift.net>

Hi all,

I?m pleased to announce that our XMPP gateway for exposing AMQP services 
to the global XMPP network has been released.

By bridging between the two systems, we benefit from:

     * XMPP?s internet-scale addressing and federation
     * XMPP?s presence model
     * AMQP?s store-and-forward capability
     * AMQP?s routing and filtering (using exchanges and bindings)

The current implementation is a very simple mapping between the two 
systems. Its simplicity keeps the code short, but only exposes a subset 
of AMQP features to the XMPP network, and vice versa.

The full announcement, with links to documentation and downloads, is 
available at 
http://www.lshift.net/blog/2008/07/01/rabbitmq-xmpp-gateway-released.

I'd be very interested in any feedback on the current approach and any 
suggestions as to alternative ways of integrating the two networks.

Regards,
   Tony
-- 
  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From chime at mu.dk  Tue Jul  1 14:09:40 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Tue, 1 Jul 2008 15:09:40 +0200
Subject: [rabbitmq-discuss] XMPP gateway released
In-Reply-To: <486A2528.90103@lshift.net>
References: <486A2528.90103@lshift.net>
Message-ID: <EFCD5318-4295-4018-BAE4-4B6C954A133B@mu.dk>

Hi Tony,

This definitely sounds cool. I'll try to install it and play around  
with. This also seems like a way to do some kind of Human Management  
Interface.

Regards,

Michael Arnoldus

On Jul 1, 2008, at 14:38 , Tony Garnock-Jones wrote:

> Hi all,
>
> I?m pleased to announce that our XMPP gateway for exposing AMQP  
> services
> to the global XMPP network has been released.
>
> By bridging between the two systems, we benefit from:
>
>     * XMPP?s internet-scale addressing and federation
>     * XMPP?s presence model
>     * AMQP?s store-and-forward capability
>     * AMQP?s routing and filtering (using exchanges and bindings)
>
> The current implementation is a very simple mapping between the two
> systems. Its simplicity keeps the code short, but only exposes a  
> subset
> of AMQP features to the XMPP network, and vice versa.
>
> The full announcement, with links to documentation and downloads, is
> available at
> http://www.lshift.net/blog/2008/07/01/rabbitmq-xmpp-gateway-released.
>
> I'd be very interested in any feedback on the current approach and any
> suggestions as to alternative ways of integrating the two networks.
>
> Regards,
>   Tony
> -- 
>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080701/41de607e/attachment.bin 

From rabbitmq at tmm1.net  Wed Jul  2 00:02:42 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Tue, 1 Jul 2008 16:02:42 -0700
Subject: [rabbitmq-discuss] ACK modes in the STOMP adapter
In-Reply-To: <486A09C8.6070007@lshift.net>
References: <e1c05edd0806302018k5e87406dnc43272a70c770e2c@mail.gmail.com>
	<486A09C8.6070007@lshift.net>
Message-ID: <e1c05edd0807011602j5add273fn94fa3dec6b460b2d@mail.gmail.com>

Is there a way to handle flow control? I would like rabbitmq to stop sending
me new messages until I am done processing old ones, so that new messages
don't get lost.
  Aman

On Tue, Jul 1, 2008 at 3:41 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:

> Hi Aman,
>
> It does support "ack: client", but acknowledgements are not used to perform
> flow control: instead, they can be used to arrange for at-least-once
> deliveries.
>
> Essentially, "ack: client" is translated into setting "noack" to "false" on
> the "basic.consume" AMQP method that results from a STOMP "SUBSCRIBE"
> operation. Please see the AMQP specification for the semantics of the
> "noack" flag.
>
> Regards,
>  Tony
>
>
> Aman Gupta wrote:
>
>> It seems the STOMP adapter does not support ack modes (
>> http://stomp.codehaus.org/Ack+Modes). If I subscribe to a queue using
>> ack: client, I continue to get additional messages from the queue, even
>> before I respond with an ACK for the original message.
>>
>>  Aman Gupta
>>
>>
>> ------------------------------------------------------------------------
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> --
>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080701/c1d6fe05/attachment.htm 

From tonyg at lshift.net  Wed Jul  2 12:42:10 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 02 Jul 2008 12:42:10 +0100
Subject: [rabbitmq-discuss] ACK modes in the STOMP adapter
In-Reply-To: <e1c05edd0807011602j5add273fn94fa3dec6b460b2d@mail.gmail.com>
References: <e1c05edd0806302018k5e87406dnc43272a70c770e2c@mail.gmail.com>	
	<486A09C8.6070007@lshift.net>
	<e1c05edd0807011602j5add273fn94fa3dec6b460b2d@mail.gmail.com>
Message-ID: <486B6992.5050001@lshift.net>

Hi Aman,

Aman Gupta wrote:
> Is there a way to handle flow control? I would like rabbitmq to stop 
> sending me new messages until I am done processing old ones, so that new 
> messages don't get lost.

At present, no, there's no explicit flow control mechanism.

One option might be to extend the STOMP adapter with an equivalent of 
AMQP's "basic.get" method, which retrieves a single message at a time 
from a queue, without using a subscription.

However, it's worth pointing out that messages are *not* lost if you 
choose "ack: client" mode. Instead, if the connection is dropped with 
unACKed messages outstanding on it, the unACKed messages are requeued 
and redelivered to the next consumer that comes along.

This redelivery behaviour, in conjunction with TCP's built-in window 
management, means that a crude form of flow control is simply to stop 
reading from the socket. When the buffers fill up at each end, the 
RabbitMQ server will notice, and will stop feeding the busy connection.

Regards,
   Tony
-- 
  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From sustrik at imatix.com  Wed Jul  2 15:27:21 2008
From: sustrik at imatix.com (Martin Sustrik)
Date: Wed, 02 Jul 2008 16:27:21 +0200
Subject: [rabbitmq-discuss] XMPP gateway released
In-Reply-To: <486A2528.90103@lshift.net>
References: <486A2528.90103@lshift.net>
Message-ID: <486B9049.3030700@imatix.com>

Nice!

What way did you choose to encode AMQP binary messages? XEP-0047?

Martin

Tony Garnock-Jones wrote:
> Hi all,
> 
> I?m pleased to announce that our XMPP gateway for exposing AMQP services 
> to the global XMPP network has been released.
> 
> By bridging between the two systems, we benefit from:
> 
>      * XMPP?s internet-scale addressing and federation
>      * XMPP?s presence model
>      * AMQP?s store-and-forward capability
>      * AMQP?s routing and filtering (using exchanges and bindings)
> 
> The current implementation is a very simple mapping between the two 
> systems. Its simplicity keeps the code short, but only exposes a subset 
> of AMQP features to the XMPP network, and vice versa.
> 
> The full announcement, with links to documentation and downloads, is 
> available at 
> http://www.lshift.net/blog/2008/07/01/rabbitmq-xmpp-gateway-released.
> 
> I'd be very interested in any feedback on the current approach and any 
> suggestions as to alternative ways of integrating the two networks.
> 
> Regards,
>    Tony




From alexis.richardson at cohesiveft.com  Wed Jul  2 16:07:55 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 2 Jul 2008 16:07:55 +0100
Subject: [rabbitmq-discuss] XMPP gateway released
In-Reply-To: <EFCD5318-4295-4018-BAE4-4B6C954A133B@mu.dk>
References: <486A2528.90103@lshift.net>
	<EFCD5318-4295-4018-BAE4-4B6C954A133B@mu.dk>
Message-ID: <167204d20807020807q27c55f36wdacfe1d0e28cc1aa@mail.gmail.com>

Michael

Exactly.  If you click through to the linked docs, there is some
discussion about how to manage RabbitMQ over IM.

http://hg.rabbitmq.com/rabbitmq-xmpp/raw-file/tip/doc/index.html

alexis


On Tue, Jul 1, 2008 at 2:09 PM, Michael Arnoldus <chime at mu.dk> wrote:
> Hi Tony,
>
> This definitely sounds cool. I'll try to install it and play around with.
> This also seems like a way to do some kind of Human Management Interface.
>
> Regards,
>
> Michael Arnoldus
>
> On Jul 1, 2008, at 14:38 , Tony Garnock-Jones wrote:
>
>> Hi all,
>>
>> I'm pleased to announce that our XMPP gateway for exposing AMQP services
>> to the global XMPP network has been released.
>>
>> By bridging between the two systems, we benefit from:
>>
>>    * XMPP's internet-scale addressing and federation
>>    * XMPP's presence model
>>    * AMQP's store-and-forward capability
>>    * AMQP's routing and filtering (using exchanges and bindings)
>>
>> The current implementation is a very simple mapping between the two
>> systems. Its simplicity keeps the code short, but only exposes a subset
>> of AMQP features to the XMPP network, and vice versa.
>>
>> The full announcement, with links to documentation and downloads, is
>> available at
>> http://www.lshift.net/blog/2008/07/01/rabbitmq-xmpp-gateway-released.
>>
>> I'd be very interested in any feedback on the current approach and any
>> suggestions as to alternative ways of integrating the two networks.
>>
>> Regards,
>>  Tony
>> --
>>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From tonyg at lshift.net  Wed Jul  2 17:33:22 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 02 Jul 2008 17:33:22 +0100
Subject: [rabbitmq-discuss] XMPP gateway released
In-Reply-To: <486B9049.3030700@imatix.com>
References: <486A2528.90103@lshift.net> <486B9049.3030700@imatix.com>
Message-ID: <486BADD2.6070802@lshift.net>

Martin Sustrik wrote:
> Nice!
> What way did you choose to encode AMQP binary messages? XEP-0047?

:-) We didn't yet. So far, it's plain-text only. XEP-0047 doesn't look 
appropriate: I think XEP-0231 looks like the one to use instead.

I wonder whether the implied semantics of <message/> is 
multipart/alternative or multipart/related?

XEP 79 looks interesting, from an AMQP perspective!

XEP 184 could be interesting.

I will have to read XEP 60 in some detail fairly soon, no doubt.

Tony
-- 
  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From sustrik at imatix.com  Wed Jul  2 17:37:25 2008
From: sustrik at imatix.com (Martin Sustrik)
Date: Wed, 02 Jul 2008 18:37:25 +0200
Subject: [rabbitmq-discuss] XMPP gateway released
In-Reply-To: <486BADD2.6070802@lshift.net>
References: <486A2528.90103@lshift.net> <486B9049.3030700@imatix.com>
	<486BADD2.6070802@lshift.net>
Message-ID: <486BAEC5.7090506@imatix.com>

Still, XEP-0239 can be used :)

Tony Garnock-Jones wrote:
> Martin Sustrik wrote:
>> Nice!
>> What way did you choose to encode AMQP binary messages? XEP-0047?
> 
> :-) We didn't yet. So far, it's plain-text only. XEP-0047 doesn't look 
> appropriate: I think XEP-0231 looks like the one to use instead.
> 
> I wonder whether the implied semantics of <message/> is 
> multipart/alternative or multipart/related?
> 
> XEP 79 looks interesting, from an AMQP perspective!
> 
> XEP 184 could be interesting.
> 
> I will have to read XEP 60 in some detail fairly soon, no doubt.
> 
> Tony




From opendev at gmail.com  Wed Jul  2 19:58:06 2008
From: opendev at gmail.com (Joern)
Date: Wed, 2 Jul 2008 20:58:06 +0200
Subject: [rabbitmq-discuss] Process N messages / VM concurrently
Message-ID: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>

Dear list,

I'm new to AMQP and RabbitMQ and like to solve the following problem.
I am going to deploy a couple of JVMs on different nodes. Depending on
certain characteristics of these nodes they will be capable of
handling a node-specific N of messages concurrently. For each message
processed a worker Thread is used (probably using Java's Executor
framework). A message specific to the outcome of the work done in the
thread is put into the queue after the job is done and the transaction
is finished / the original message is acknowledged (I'm still a bit
unsure of the appropriate semantics here).

Is there a recommended strategy how to combine the Executor framework
of Java 5+ with the BlockingConsumer of Rabbit? I'm wiring the
application using Spring and use the latest version of RabbitMQ.

Best regards,


Joern
--



From tonyg at lshift.net  Wed Jul  2 21:23:04 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 02 Jul 2008 21:23:04 +0100
Subject: [rabbitmq-discuss] XMPP gateway released
In-Reply-To: <486BAEC5.7090506@imatix.com>
References: <486A2528.90103@lshift.net> <486B9049.3030700@imatix.com>
	<486BADD2.6070802@lshift.net> <486BAEC5.7090506@imatix.com>
Message-ID: <486BE3A8.3030109@lshift.net>

Whoa! Super efficient!

Martin Sustrik wrote:
> Still, XEP-0239 can be used :)
> 
> Tony Garnock-Jones wrote:
>> Martin Sustrik wrote:
>>> Nice!
>>> What way did you choose to encode AMQP binary messages? XEP-0047?
>>
>> :-) We didn't yet. So far, it's plain-text only. XEP-0047 doesn't look 
>> appropriate: I think XEP-0231 looks like the one to use instead.
>>
>> I wonder whether the implied semantics of <message/> is 
>> multipart/alternative or multipart/related?
>>
>> XEP 79 looks interesting, from an AMQP perspective!
>>
>> XEP 184 could be interesting.
>>
>> I will have to read XEP 60 in some detail fairly soon, no doubt.
>>
>> Tony
> 
> 



From tonyg at lshift.net  Thu Jul  3 14:57:01 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 03 Jul 2008 14:57:01 +0100
Subject: [rabbitmq-discuss] Core repositories now open
Message-ID: <486CDAAD.2070303@lshift.net>

Hi all,

We've finally (!!) finished the long, arduous process of making the 
RabbitMQ source-code repositories publicly available. This makes it much 
easier for people to track development without relying on us getting 
around to making snapshots.

  - http://hg.rabbitmq.com/rabbitmq-server/ - The core Erlang server
  - http://hg.rabbitmq.com/rabbitmq-java-client/ - The Java client

  - http://hg.rabbitmq.com/rabbitmq-codegen/
      - Both the above depend on this

For example, in order to build the latest development branch of the 
STOMP-enabled server, you would now:

  $ mkdir my-build-directory
  $ cd my-build-directory
  $ hg clone http://hg.rabbitmq.com/rabbitmq-codegen
  $ hg clone http://hg.rabbitmq.com/rabbitmq-server
  $ hg clone http://hg.rabbitmq.com/rabbitmq-stomp
  $ cd rabbitmq-server
  $ make
  $ cd ..
  $ cd rabbitmq-stomp
  $ make

Regards,
   Tony
-- 
  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From 0x6e6562 at gmail.com  Thu Jul  3 16:36:18 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 3 Jul 2008 16:36:18 +0100
Subject: [rabbitmq-discuss] Process N messages / VM concurrently
In-Reply-To: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
References: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
Message-ID: <269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>

Joern,

On Wed, Jul 2, 2008 at 7:58 PM, Joern <opendev at gmail.com> wrote:
> I'm new to AMQP and RabbitMQ and like to solve the following problem.
> I am going to deploy a couple of JVMs on different nodes. Depending on
> certain characteristics of these nodes they will be capable of
> handling a node-specific N of messages concurrently. For each message
> processed a worker Thread is used (probably using Java's Executor
> framework). A message specific to the outcome of the work done in the
> thread is put into the queue after the job is done and the transaction
> is finished / the original message is acknowledged (I'm still a bit
> unsure of the appropriate semantics here).
>
> Is there a recommended strategy how to combine the Executor framework
> of Java 5+ with the BlockingConsumer of Rabbit? I'm wiring the
> application using Spring and use the latest version of RabbitMQ.

I'm not sure about the Executor framework but I think one thing that
you may want to consider is binding one AMQP channel to each worker
thread. The connection is thread safe and hence can be shared, but the
channel is designed to be the smallest unit of parallelism.
Furthermore, they are not threadsafe for this very reason.

Whilst it is possible to spawn a new thread in your own consumer for
each message, but going down the multi-channel route is more in line
with the AMQP model.

HTH,

Ben



From alexis.richardson at cohesiveft.com  Thu Jul  3 16:40:58 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 3 Jul 2008 16:40:58 +0100
Subject: [rabbitmq-discuss] Process N messages / VM concurrently
In-Reply-To: <269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
References: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
	<269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
Message-ID: <167204d20807030840x30a6c24cuf3f0c19a3c037903@mail.gmail.com>

Joern

>> Is there a recommended strategy how to combine the Executor framework
>> of Java 5+ with the BlockingConsumer of Rabbit? I'm wiring the
>> application using Spring and use the latest version of RabbitMQ.

To add one thing to Ben's reply, may I request that you share with us
your experiences of using Spring with RabbitMQ BlockingConsumer
please.  Other Spring users may find this beneficial when looking at
RabbitMQ.

Cheers

alexis



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From 0x6e6562 at gmail.com  Thu Jul  3 16:51:54 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 3 Jul 2008 16:51:54 +0100
Subject: [rabbitmq-discuss] Process N messages / VM concurrently
In-Reply-To: <167204d20807030840x30a6c24cuf3f0c19a3c037903@mail.gmail.com>
References: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
	<269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
	<167204d20807030840x30a6c24cuf3f0c19a3c037903@mail.gmail.com>
Message-ID: <269388e30807030851r4aa41c72j505117dd2cab8e80@mail.gmail.com>

Joern,

On Thu, Jul 3, 2008 at 4:40 PM, Alexis Richardson
<alexis.richardson at cohesiveft.com> wrote:
> To add one thing to Ben's reply, may I request that you share with us
> your experiences of using Spring with RabbitMQ BlockingConsumer
> please.  Other Spring users may find this beneficial when looking at
> RabbitMQ.

I think I may have misunderstood your question. Were you perhaps
referring to the QueueingConsumer class that buffers messages into a
client side queue?

Ben



From dmitriy.samovskiy at cohesiveft.com  Thu Jul  3 16:52:11 2008
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Thu, 03 Jul 2008 10:52:11 -0500
Subject: [rabbitmq-discuss] rabbitmqctl diag command?
Message-ID: <486CF5AB.8090102@cohesiveft.com>

Hi all,

When you are running rabbitmq broker, what do you use to check its status and to make sure 
it's still operational?

I could open a test connection every 5 minutes or so, send and consume a message; if 
either fails, send an alarm. Does anybody else have other ideas?

I was also thinking that it would be nice to possibly extend rabbitmqctl command line tool 
to offer diag output (as a separate command under rabbitmqctl - like "rabbitmqctl diag"). 
If this output is easily parsed from shell, writing tests and alarms would be trivial. 
Something like "keyword: value" for things like mnesia database status, listener status, 
current # of open connections, # of messages published, etc. The more data points, the 
better. One could build charts off of that data too...

Thoughts?

- Dmitriy



From 0x6e6562 at gmail.com  Thu Jul  3 17:14:13 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 3 Jul 2008 17:14:13 +0100
Subject: [rabbitmq-discuss] rabbitmqctl diag command?
In-Reply-To: <486CF5AB.8090102@cohesiveft.com>
References: <486CF5AB.8090102@cohesiveft.com>
Message-ID: <269388e30807030914i35292085nfc3738114f6e545a@mail.gmail.com>

Dmitriy,

On Thu, Jul 3, 2008 at 4:52 PM, Dmitriy Samovskiy
<dmitriy.samovskiy at cohesiveft.com> wrote:
> When you are running rabbitmq broker, what do you use to check its status and to make sure
> it's still operational?

The crudest way is to call rabbitmqctl status which will list the
running nodes and running applications, e.g.

4> rabbit_control:action(status,node(),[]).
Status of node nonode at nohost ...
[{running_applications,[{rabbit,"RabbitMQ","%%VERSION%%"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.3"},
                        {os_mon,"CPO  CXC 138 46","2.1.6"},
                        {sasl,"SASL  CXC 138 11","2.1.5.3"},
                        {stdlib,"ERTS  CXC 138 10","1.15.3"},
                        {kernel,"ERTS  CXC 138 10","2.12.3"}]},
 {nodes,[nonode at nohost]},
 {running_nodes,[nonode at nohost]}]
ok

If those 6 OTP applications are not running, then you may have a problem.


> I could open a test connection every 5 minutes or so, send and consume a message; if
> either fails, send an alarm. Does anybody else have other ideas?

Ben



From tonyg at lshift.net  Thu Jul  3 17:22:52 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 03 Jul 2008 17:22:52 +0100
Subject: [rabbitmq-discuss] XMPP adapter compilation
Message-ID: <486CFCDC.50103@lshift.net>

Hi all,

Sorry I forgot to mention this: you will need to check out the RabbitMQ 
server code from mercurial (or take a snapshot from mercurial) to build 
and run the RabbitMQ XMPP adapter! It's too new to work with the 1.3.0 
release.

I'll update the blog announcement, too.

Regards,
   Tony
-- 
  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From 0x6e6562 at gmail.com  Thu Jul  3 17:31:45 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 3 Jul 2008 17:31:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ Java management module?
In-Reply-To: <486CEA41.4080504@wizards.de>
References: <486CEA41.4080504@wizards.de>
Message-ID: <269388e30807030931l239f04fy92bc69306c7ba337@mail.gmail.com>

Holger,

On Thu, Jul 3, 2008 at 4:03 PM, Holger Hoffst?tte <holger at wizards.de> wrote:

> I was just cloning the finally available rabbit repos and found in the
> erlang-client logs that you have (had?) apparently started with a Java
> management module, which has since been split off. Was that just an early
> prototype or are you still working on it?

It was just an early prototype that hasn't gone very far, mainly for
lack of interest.

The idea was to expose a proprietary Rabbit API via AMQP using a
language neutral serialization protocol to marshall the API calls
(e.g. JSON, Hessian) in the absence of a formal management aspect to
the core protocol.

So you could expose this API in whatever language you wanted to and
then just use AMQP as a transport mechanism.

On the broker side, you have an AMQP/RPC server that unmarshalls the
commands and invokes the native function within the address space of
the broker.

One of the underlying principles of this was to have a strongly typed
contract on the client side, which may or may not be a good thing,
depending on how you look at it.

That's about as far as the idea got I'm afraid.

Having said that, Tony may be able to comment on a different approach
that involves using a DSL over XMPP to achieve the same thing which is
naturally a lot more flexible.

> I ask because after visiting
> Alexis & LShift in April, I have been following the AMQP management "working
> group" and thinking about possible way of enabling/exposing various aspects
> of monitoring and management functions. If you want to share thoughts or
> ideas please let me know.


Yes, there is a lot of value in driving a discussion about this topic
and forming some kind of concrete proposal based on use cases. Ideally
the community should define the requirements of the system :-)


HTH,

Ben



From tonyg at lshift.net  Fri Jul  4 09:44:44 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 04 Jul 2008 09:44:44 +0100
Subject: [rabbitmq-discuss] Hg Repo
In-Reply-To: <269388e30806262238h8d2bc43l7d895fdb333ab5ff@mail.gmail.com>
References: <269388e30806260313o7c19d3bam552c44198a88ea82@mail.gmail.com>	<e1c05edd0806261317v32d73e0k3efd59b68248a70@mail.gmail.com>	<269388e30806261637l357ff0cem24e0a73bd23b67fe@mail.gmail.com>	<e1c05edd0806261643s6e3bb6a1vf7df5d5971cbd689@mail.gmail.com>
	<269388e30806262238h8d2bc43l7d895fdb333ab5ff@mail.gmail.com>
Message-ID: <486DE2FC.1060003@lshift.net>

Hi,

> Sorry, I didn't realize you were talking about the stomp adapter when
> you mentioned this branch issue.
> 
> Although I can't answer this question,  Tony will be able to, hence
> I'm forwarding this to the list (which is a good idea in general :-)

Now that the main RabbitMQ Server mercurial repository is available, you 
can use the "default" branch of the STOMP adapter so long as you also 
use the "default" branch from the server's repository.

The 1.3.0 support branch of the STOMP adapter will still have to be used 
for those using the 1.3.0 server release.

Regards,
   Tony



From tonyg at lshift.net  Fri Jul  4 09:49:51 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 04 Jul 2008 09:49:51 +0100
Subject: [rabbitmq-discuss] XMPP gateway released
In-Reply-To: <EFCD5318-4295-4018-BAE4-4B6C954A133B@mu.dk>
References: <486A2528.90103@lshift.net>
	<EFCD5318-4295-4018-BAE4-4B6C954A133B@mu.dk>
Message-ID: <486DE42F.9030005@lshift.net>

Hi Michael,

Michael Arnoldus wrote:
> This definitely sounds cool. I'll try to install it and play around 
> with. This also seems like a way to do some kind of Human Management 
> Interface.

For sure. The little bot in the gateway starts to explore the area in an 
adhoc way. It'd be interesting to define a "command-line transport" (or 
even an "english transport" or a "zork transport") for AMQP commands, so 
that they could be typed interactively to the bot in a uniform way.

 > EXAMINE QUEUE
You are not holding the queue.
 > GET QUEUE
You pick up the queue, noting its fine sheen and weighty heft.
 > EXAMINE QUEUE
The queue is covered in very fine writing, that you cannot quite make 
out. Perhaps if there was some more light?
 > CREATE EXCHANGE
Summoning your occult ability, you mutter a word of power, which echoes 
weirdly around you.
There is a flash.
An exchange is here.


Tony




From opendev at gmail.com  Fri Jul  4 11:54:09 2008
From: opendev at gmail.com (Joern)
Date: Fri, 4 Jul 2008 12:54:09 +0200
Subject: [rabbitmq-discuss] Process N messages / VM concurrently
In-Reply-To: <269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
References: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
	<269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
Message-ID: <9e009ad0807040354w4aed014ancfc16c759bcb096a@mail.gmail.com>

Hi Ben,

2008/7/3 Ben Hood <0x6e6562 at gmail.com>:

> I think I may have misunderstood your question. Were you perhaps
> referring to the QueueingConsumer class that buffers messages into a
> client side queue?

Yes. I wrote BlockingConsumer but meant QueueingConsumer.

> I'm not sure about the Executor framework but I think one thing that
> you may want to consider is binding one AMQP channel to each worker
> thread. The connection is thread safe and hence can be shared, but the
> channel is designed to be the smallest unit of parallelism.
> Furthermore, they are not threadsafe for this very reason.

Yes, I was aware of that. But hence Executor implementations use
concurrent queues (and QueueingConsumer does also) I was thinking
about using a single channel and some Executor instance. As far as I
understand there is no real benefit in using N channels for N workers
- the channel model seems to be there to multiplex N AMQP connections
into one logical i.e. TCP/IP connection.

Best regards,


Joern
--



From opendev at gmail.com  Fri Jul  4 12:00:11 2008
From: opendev at gmail.com (Joern)
Date: Fri, 4 Jul 2008 13:00:11 +0200
Subject: [rabbitmq-discuss] Process N messages / VM concurrently
In-Reply-To: <167204d20807030840x30a6c24cuf3f0c19a3c037903@mail.gmail.com>
References: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
	<269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
	<167204d20807030840x30a6c24cuf3f0c19a3c037903@mail.gmail.com>
Message-ID: <9e009ad0807040400u3f1526a5xd4dd8bf4d92c3419@mail.gmail.com>

Hi Alexis,

2008/7/3 Alexis Richardson <alexis.richardson at cohesiveft.com>:

> To add one thing to Ben's reply, may I request that you share with us
> your experiences of using Spring with RabbitMQ BlockingConsumer
> please.  Other Spring users may find this beneficial when looking at
> RabbitMQ.

Right now it has been trivial (as expected). I have not (yet?) been
writing templates for queue access though. Currently my configuration
consists out of the following:

 - com.rabbitmq.client.ConnectionFactory singleton with ConnectionParameters
 - a Spring FactoryBean for com.rabbitmq.client.Connection's (in order
to make the setting of port / hostname more bean-ish)
 - same for a channel, exposing exchange and queue parameters, realm
etc. This is where I'd like to hook concurrent queues into.

Best regards,


Joern



From 0x6e6562 at gmail.com  Fri Jul  4 12:33:28 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 4 Jul 2008 12:33:28 +0100
Subject: [rabbitmq-discuss] Process N messages / VM concurrently
In-Reply-To: <9e009ad0807040354w4aed014ancfc16c759bcb096a@mail.gmail.com>
References: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
	<269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
	<9e009ad0807040354w4aed014ancfc16c759bcb096a@mail.gmail.com>
Message-ID: <269388e30807040433o3dec7d36i3df0c497286c860a@mail.gmail.com>

Joern,

On Fri, Jul 4, 2008 at 11:54 AM, Joern <opendev at gmail.com> wrote:
>
> Yes, I was aware of that. But hence Executor implementations use
> concurrent queues (and QueueingConsumer does also) I was thinking
> about using a single channel and some Executor instance.

That *may* not be such a good idea because the interaction within a
channel is conversational. You may run into trouble when executing
synchronous calls within the channel (queue declaration and binding
for example).

> As far as I understand there is no real benefit in using N channels for N workers
> - the channel model seems to be there to multiplex N AMQP connections
> into one logical i.e. TCP/IP connection.

Channels are multiplexed into a single AMQP connection which is
invariably but not necessarily tied to a single TCP connection.
Channels were actually designed to do this kind of thing :-)

HTH,

Ben



From opendev at gmail.com  Fri Jul  4 19:53:27 2008
From: opendev at gmail.com (Joern)
Date: Fri, 4 Jul 2008 20:53:27 +0200
Subject: [rabbitmq-discuss] Process N messages / VM concurrently
In-Reply-To: <269388e30807040433o3dec7d36i3df0c497286c860a@mail.gmail.com>
References: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
	<269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
	<9e009ad0807040354w4aed014ancfc16c759bcb096a@mail.gmail.com>
	<269388e30807040433o3dec7d36i3df0c497286c860a@mail.gmail.com>
Message-ID: <9e009ad0807041153x675b0725te6a63a14066ab145@mail.gmail.com>

Hi Ben,

2008/7/4 Ben Hood <0x6e6562 at gmail.com>:

> That *may* not be such a good idea because the interaction within a
> channel is conversational. You may run into trouble when executing
> synchronous calls within the channel (queue declaration and binding
> for example).

I wasn't aware of that - this complicates things obviously. I'll come
back to the list as soon as things are running (using Spring).

Best regards,


Joern
--



From 0x6e6562 at gmail.com  Sat Jul  5 01:31:40 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 5 Jul 2008 01:31:40 +0100
Subject: [rabbitmq-discuss] Process N messages / VM concurrently
In-Reply-To: <9e009ad0807041153x675b0725te6a63a14066ab145@mail.gmail.com>
References: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
	<269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
	<9e009ad0807040354w4aed014ancfc16c759bcb096a@mail.gmail.com>
	<269388e30807040433o3dec7d36i3df0c497286c860a@mail.gmail.com>
	<9e009ad0807041153x675b0725te6a63a14066ab145@mail.gmail.com>
Message-ID: <269388e30807041731y662206b8v54f0bb9a9eacc9b1@mail.gmail.com>

Joern,

On Fri, Jul 4, 2008 at 7:53 PM, Joern <opendev at gmail.com> wrote:
> Hi Ben,
>
> 2008/7/4 Ben Hood <0x6e6562 at gmail.com>:
>
>> That *may* not be such a good idea because the interaction within a
>> channel is conversational. You may run into trouble when executing
>> synchronous calls within the channel (queue declaration and binding
>> for example).
>
> I wasn't aware of that - this complicates things obviously. I'll come
> back to the list as soon as things are running (using Spring).

I don't see how this complicates things - after all, you have a simple
1:1 mapping between a thread and a channel. Such is the intention of
the AMQP model. Furthermore, since the thread mapping is so simple and
straight forward, you never have do any locking on any channel object,
since you have eliminated race conditions but have maintained
concurrency.

A crude way of mapping a channel to a thread (in Java) is to stick the
channel reference in the thread local and make sure that you perform
any synchronous operations eagerly in a single threaded fashion or
lazily in a thread safe fashion. I'm sure you can think of more
elegant ways to use a channel in a single threaded fashion.

HTH,

Ben



From everett at mailinator.com  Sat Jul  5 17:19:07 2008
From: everett at mailinator.com (everett)
Date: Sat, 5 Jul 2008 09:19:07 -0700 (PDT)
Subject: [rabbitmq-discuss]  IOException when connecting, using Glassfish
Message-ID: <18288523.post@talk.nabble.com>


Hi,

I am using the 1.3.0 release of RabbitMQ (on Debian Sid) along with the Java
client. When the newConnection method on the ConnectionFactory instance is
called within my web  application (deployed in Glassfish V2 UR2; running on
the same machine as RabbitMQ), it throws an IOException and I get the
following message in the rabbit.log file:

=INFO REPORT==== 4-Jul-2008::16:40:02 ===
accepted TCP connection on 0.0.0.0:5672 from 192.168.42.104:44453

=ERROR REPORT==== 4-Jul-2008::16:40:04 ===
error on TCP connection from 192.168.42.104:44453
connection_closed_abruptly

=INFO REPORT==== 4-Jul-2008::16:40:04 ===
closing TCP connection from 192.168.42.104:44453

I've been through the mailing list several times and I was also unable to
find any answers through Google. I appreciate any assistance.

--
Everett
-- 
View this message in context: http://www.nabble.com/IOException-when-connecting%2C-using-Glassfish-tp18288523p18288523.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From 0x6e6562 at gmail.com  Sat Jul  5 18:59:09 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 5 Jul 2008 18:59:09 +0100
Subject: [rabbitmq-discuss] IOException when connecting, using Glassfish
In-Reply-To: <18288523.post@talk.nabble.com>
References: <18288523.post@talk.nabble.com>
Message-ID: <269388e30807051059i38fc54ebi12d8e5a48751b150@mail.gmail.com>

Everett,

On Sat, Jul 5, 2008 at 5:19 PM, everett <everett at mailinator.com> wrote:
> I am using the 1.3.0 release of RabbitMQ (on Debian Sid) along with the Java
> client. When the newConnection method on the ConnectionFactory instance is
> called within my web  application (deployed in Glassfish V2 UR2; running on
> the same machine as RabbitMQ), it throws an IOException and I get the
> following message in the rabbit.log file:
>
> =INFO REPORT==== 4-Jul-2008::16:40:02 ===
> accepted TCP connection on 0.0.0.0:5672 from 192.168.42.104:44453
>
> =ERROR REPORT==== 4-Jul-2008::16:40:04 ===
> error on TCP connection from 192.168.42.104:44453
> connection_closed_abruptly
>
> =INFO REPORT==== 4-Jul-2008::16:40:04 ===
> closing TCP connection from 192.168.42.104:44453

Are you able to run a standalone client test on the 192.168.42.104
host to try and isolate where the problem might lie? For example, the
Java client ships with some test cases that can be used to test
connectivity - look for the ProducerMain and ConsumerMain classes that
have simple main methods.

I suspect that you may be having some network related issues, so it
would be good to be able to rule this out.

HTH,

Ben



From everett at mailinator.com  Sun Jul  6 20:09:34 2008
From: everett at mailinator.com (everett)
Date: Sun, 6 Jul 2008 12:09:34 -0700 (PDT)
Subject: [rabbitmq-discuss] IOException when connecting, using Glassfish
In-Reply-To: <269388e30807051059i38fc54ebi12d8e5a48751b150@mail.gmail.com>
References: <18288523.post@talk.nabble.com>
	<269388e30807051059i38fc54ebi12d8e5a48751b150@mail.gmail.com>
Message-ID: <18304694.post@talk.nabble.com>



Ben Hood wrote:
> 
> Everett,
> 
> On Sat, Jul 5, 2008 at 5:19 PM, everett <everett at mailinator.com> wrote:
>> I am using the 1.3.0 release of RabbitMQ (on Debian Sid) along with the
>> Java
>> client. When the newConnection method on the ConnectionFactory instance
>> is
>> called within my web  application (deployed in Glassfish V2 UR2; running
>> on
>> the same machine as RabbitMQ), it throws an IOException and I get the
>> following message in the rabbit.log file:
>>
>> =INFO REPORT==== 4-Jul-2008::16:40:02 ===
>> accepted TCP connection on 0.0.0.0:5672 from 192.168.42.104:44453
>>
>> =ERROR REPORT==== 4-Jul-2008::16:40:04 ===
>> error on TCP connection from 192.168.42.104:44453
>> connection_closed_abruptly
>>
>> =INFO REPORT==== 4-Jul-2008::16:40:04 ===
>> closing TCP connection from 192.168.42.104:44453
> 
> Are you able to run a standalone client test on the 192.168.42.104
> host to try and isolate where the problem might lie? For example, the
> Java client ships with some test cases that can be used to test
> connectivity - look for the ProducerMain and ConsumerMain classes that
> have simple main methods.
> 
> I suspect that you may be having some network related issues, so it
> would be good to be able to rule this out.
> 
> HTH,
> 
> Ben
> 
> 

Hi Ben,

Thank you for your help. By running these test cases I was able to discover
that my IOException was caused because I did not include commons-io-1.2.jar
in my classpath. Previously I was only deploying rabbitmq-client.jar with my
web application.

Cheers,

--
Everett
-- 
View this message in context: http://www.nabble.com/IOException-when-connecting%2C-using-Glassfish-tp18288523p18304694.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From alexis.richardson at cohesiveft.com  Mon Jul  7 07:02:13 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Mon, 7 Jul 2008 07:02:13 +0100
Subject: [rabbitmq-discuss] recent blog posts and rabbit clients
Message-ID: <167204d20807062302l6d536abfyca6ea1c5a274d36b@mail.gmail.com>

Hi everyone

This is a quick and nugatory email for those not tracking recent
RabbitMQ related blogs.

Recent postings may be of interest to you:

* Tony and Matthias on RabbitMQ architecture - slides linked to here:
http://www.lshift.net/blog/2008/07/01/slides-from-our-erlang-exchange-talk
- this also shows the current universe of RabbitMQ clients
* Dmitriy's note on using RabbitMQ with Ruby -
http://somic-org.homelinux.org/blog/2008/06/24/ruby-amqp-rabbitmq-example/
* Ben's rather excellent data relay (a bit like a transmission queue)
- http://hopper.squarespace.com/blog/2008/6/22/introducing-shovel-an-amqp-relay.html
- note that there is also a 'how to build a client' guide on Ben's
blog

Please let the list know if you want to help improve what is out there
but needs work, eg C++, Ruby, Perl, ...  Now that we have reorganised
the repos it will much easier for people to contribute and get
involved.  Some initial client downloads are shown on the second half
of this page: http://www.rabbitmq.com/download.html

Cheers

alexis






-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From chime at mu.dk  Mon Jul  7 10:12:18 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Mon, 7 Jul 2008 11:12:18 +0200
Subject: [rabbitmq-discuss] XMPP gateway released
In-Reply-To: <486DE42F.9030005@lshift.net>
References: <486A2528.90103@lshift.net>
	<EFCD5318-4295-4018-BAE4-4B6C954A133B@mu.dk>
	<486DE42F.9030005@lshift.net>
Message-ID: <3100A2AA-2D4A-420A-81D2-A251FAF22017@mu.dk>

Ho Tony,

Great idea - love the D&D language :-)

I just spotted that I need a newer unreleased (presumed less stable)  
version of Rabbit for the XMPP adapter, so unfortunately I'll have to  
wait until I can use it with an official release.

Michael

On Jul 4, 2008, at 10:49 , Tony Garnock-Jones wrote:

> Hi Michael,
>
> Michael Arnoldus wrote:
>> This definitely sounds cool. I'll try to install it and play around  
>> with. This also seems like a way to do some kind of Human  
>> Management Interface.
>
> For sure. The little bot in the gateway starts to explore the area  
> in an adhoc way. It'd be interesting to define a "command-line  
> transport" (or even an "english transport" or a "zork transport")  
> for AMQP commands, so that they could be typed interactively to the  
> bot in a uniform way.
>
> > EXAMINE QUEUE
> You are not holding the queue.
> > GET QUEUE
> You pick up the queue, noting its fine sheen and weighty heft.
> > EXAMINE QUEUE
> The queue is covered in very fine writing, that you cannot quite  
> make out. Perhaps if there was some more light?
> > CREATE EXCHANGE
> Summoning your occult ability, you mutter a word of power, which  
> echoes weirdly around you.
> There is a flash.
> An exchange is here.
>
>
> Tony
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080707/38a09872/attachment.bin 

From opendev at gmail.com  Mon Jul  7 12:29:25 2008
From: opendev at gmail.com (Joern)
Date: Mon, 7 Jul 2008 13:29:25 +0200
Subject: [rabbitmq-discuss] Process N messages / VM concurrently
In-Reply-To: <269388e30807041731y662206b8v54f0bb9a9eacc9b1@mail.gmail.com>
References: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
	<269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
	<9e009ad0807040354w4aed014ancfc16c759bcb096a@mail.gmail.com>
	<269388e30807040433o3dec7d36i3df0c497286c860a@mail.gmail.com>
	<9e009ad0807041153x675b0725te6a63a14066ab145@mail.gmail.com>
	<269388e30807041731y662206b8v54f0bb9a9eacc9b1@mail.gmail.com>
Message-ID: <9e009ad0807070429l4833e48g53b92388a71de2aa@mail.gmail.com>

Hi Ben,

2008/7/5 Ben Hood <0x6e6562 at gmail.com>:

>> I wasn't aware of that - this complicates things obviously. I'll come
>> back to the list as soon as things are running (using Spring).
>
> I don't see how this complicates things - after all, you have a simple
> 1:1 mapping between a thread and a channel. Such is the intention of

That was a misunderstanding. I wasn't aware that a channel has state -
this complicates things.

> A crude way of mapping a channel to a thread (in Java) is to stick the
> channel reference in the thread local and make sure that you perform
> any synchronous operations eagerly in a single threaded fashion or
> lazily in a thread safe fashion. I'm sure you can think of more
> elegant ways to use a channel in a single threaded fashion.

Not so crude actually. I think I'll use a ThreadLocal channel instance.

Best regards,


Joern



From teemu.pentinsaari at kassa.fi  Mon Jul  7 12:38:24 2008
From: teemu.pentinsaari at kassa.fi (Teemu Pentinsaari)
Date: Mon, 07 Jul 2008 14:38:24 +0300
Subject: [rabbitmq-discuss] One producer multiple subscribers
Message-ID: <48720030.5090403@kassa.fi>

Hello list,

I have been trying to establish a message queue where one producer fills 
the queue and multiple subscribers consumes it.
The hard part, which I can't get my head around, is to keep messages in 
the queue until every single last one of the subscribers have received 
it and only after, that the message should be deleted.

I have been able to replicate java api examples and send and receive 
messages with BasicPublish and DefaultConsumer but can't figure out how 
to make messages last for every subscriber.

Is this possible to do with RabbitMQ?


Thanks,

Teemu




From matthias at lshift.net  Mon Jul  7 13:12:18 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 07 Jul 2008 13:12:18 +0100
Subject: [rabbitmq-discuss] One producer multiple subscribers
In-Reply-To: <48720030.5090403@kassa.fi>
References: <48720030.5090403@kassa.fi>
Message-ID: <48720822.3040004@lshift.net>

Teemu,

Teemu Pentinsaari wrote:
> I have been trying to establish a message queue where one producer fills 
> the queue and multiple subscribers consumes it.
> The hard part, which I can't get my head around, is to keep messages in 
> the queue until every single last one of the subscribers have received 
> it and only after, that the message should be deleted.
> 
> I have been able to replicate java api examples and send and receive 
> messages with BasicPublish and DefaultConsumer but can't figure out how 
> to make messages last for every subscriber.

So, if I understand you correctly, you want every message to go to *all* 
subscribers. Correct? In that case you should create one queue per 
subscriber, and bind them to the same exchange (a 'fanout' exchange in 
the simplest case).


Matthias.



From teemu.pentinsaari at kassa.fi  Mon Jul  7 13:28:23 2008
From: teemu.pentinsaari at kassa.fi (Teemu Pentinsaari)
Date: Mon, 07 Jul 2008 15:28:23 +0300
Subject: [rabbitmq-discuss] One producer multiple subscribers
In-Reply-To: <48720822.3040004@lshift.net>
References: <48720030.5090403@kassa.fi> <48720822.3040004@lshift.net>
Message-ID: <48720BE7.30908@kassa.fi>

Matthias,

Thanks for your reply. You assume correctly; I do want to send message 
(from single producer) to all subscribers, but due to a limited hardware 
resources, I'd like to use single queue. We are going to send somewhat 
large messages to quite a few clients at once and replicating that same 
message to multiple queues might become a problem. This queue also must 
be durable and all messages must be persistent for we can't quarantee 
that all our clients are online at the same time.

If this can't be done, we are going to investigate 'fanout' and other 
options as you suggested.


Teemu

Matthias Radestock kirjoitti:
> Teemu,
>
> Teemu Pentinsaari wrote:
>> I have been trying to establish a message queue where one producer 
>> fills the queue and multiple subscribers consumes it.
>> The hard part, which I can't get my head around, is to keep messages 
>> in the queue until every single last one of the subscribers have 
>> received it and only after, that the message should be deleted.
>>
>> I have been able to replicate java api examples and send and receive 
>> messages with BasicPublish and DefaultConsumer but can't figure out 
>> how to make messages last for every subscriber.
>
> So, if I understand you correctly, you want every message to go to 
> *all* subscribers. Correct? In that case you should create one queue 
> per subscriber, and bind them to the same exchange (a 'fanout' 
> exchange in the simplest case).
>
>
> Matthias.




From matthias at lshift.net  Mon Jul  7 13:42:44 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 07 Jul 2008 13:42:44 +0100
Subject: [rabbitmq-discuss] One producer multiple subscribers
In-Reply-To: <48720BE7.30908@kassa.fi>
References: <48720030.5090403@kassa.fi> <48720822.3040004@lshift.net>
	<48720BE7.30908@kassa.fi>
Message-ID: <48720F44.7050603@lshift.net>

Teemu,

Teemu Pentinsaari wrote:
> Thanks for your reply. You assume correctly; I do want to send message 
> (from single producer) to all subscribers, but due to a limited hardware 
> resources, I'd like to use single queue. We are going to send somewhat 
> large messages to quite a few clients at once and replicating that same 
> message to multiple queues might become a problem.

As long as the queues are on the same node the message payload will be 
shared between them, not copied.

> This queue also must be durable and all messages must be persistent
> for we can't quarantee that all our clients are online at the same time.

Persistence and durability in AMQP terminology refer to preserving 
messages / queues across broker restarts.

 From the above description it doesn't look like you need either of 
these - plain, non-exclusive, non-durable queues with well-known names 
should be sufficient.

And even if you did use durable queues and persistent messages, only one 
copy of each message would be persisted per node.


Matthias.



From 0x6e6562 at gmail.com  Mon Jul  7 23:14:17 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 7 Jul 2008 23:14:17 +0100
Subject: [rabbitmq-discuss]  Process N messages / VM concurrently
In-Reply-To: <269388e30807071513l74a36df2ua72b489d510d9825@mail.gmail.com>
References: <9e009ad0807021158l3c817b57t20a12255c252ab4d@mail.gmail.com>
	<269388e30807030836v12c8a8cbo3f3a8a2a8358a1fe@mail.gmail.com>
	<9e009ad0807040354w4aed014ancfc16c759bcb096a@mail.gmail.com>
	<269388e30807040433o3dec7d36i3df0c497286c860a@mail.gmail.com>
	<9e009ad0807041153x675b0725te6a63a14066ab145@mail.gmail.com>
	<269388e30807041731y662206b8v54f0bb9a9eacc9b1@mail.gmail.com>
	<9e009ad0807070429l4833e48g53b92388a71de2aa@mail.gmail.com>
	<269388e30807071513l74a36df2ua72b489d510d9825@mail.gmail.com>
Message-ID: <269388e30807071514i6aa0f1b0n343432cf1ef8fc7c@mail.gmail.com>

Joern,

On Mon, Jul 7, 2008 at 12:29 PM, Joern <opendev at gmail.com> wrote:
> Not so crude actually. I think I'll use a ThreadLocal channel instance.

You maybe also want to make sure that you are not accessing resources
(e.g. publishing to queues) from within a channel that hasn't acquired
access to that resource. Although your code maybe threadsafe, you
maybe misusing resources across channels. Having said that, if each
channel has access to the same resources, then this won't be an issue.

HTH,

Ben



From David.Corcoran at edftrading.com  Thu Jul 10 17:24:23 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Thu, 10 Jul 2008 17:24:23 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
Message-ID: <OF2A31B996.719E0E47-ON80257482.0059251C-80257482.005A1FBA@Edftrading.com>


Hey,

We're having some memory problems with RabbitMQ and I'm trying to track
down their cause. What's happening is that RabbitMQ quite quickly starts to
eat up memory and around the 2GB mark dies (it's a 32bit machine). The logs
look fine and the startup.err just has a memory allocation error.

I've attached the output of stat_all() to see if that might help. It
doesn't look very informative. Is there another command I should be
running?

(specs)
redhat el5 32bit
erlang 12b3
rabbitmq 1.3.0

(stat_all)

(test at vsdlbblue01)4> rpc:call('rabbit at vsdlbblue01', rabbit_amqqueue,
stat_all, []).
[{ok,{resource,<<"/">>,queue,
               <<"amq.q.gen2458_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen2127_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen904_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen972_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen486_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen3773_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen1827_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen1839_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen1277_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen507_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen221_rabbit at vsdlbblue01_20080710111628_">>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen2904_rabbit at vsdlbblue01_20080710111"...>>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen873_rabbit at vsdlbblue01_20080710"...>>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen312_rabbit at vsdlbblue01_2008"...>>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen2149_rabbit at vsdlbblue01"...>>},
     0,1},
 {ok,{resource,<<"/">>,queue,
               <<"amq.q.gen570_rabbit at vsdlbblu"...>>},
     0,1},
 {ok,{resource,<<"/">>,queue,<<"amq.q.gen4091_rabbit at vsd"...>>},
     0,1},
 {ok,{resource,<<"/">>,queue,<<"amq.q.gen4019_rabbit"...>>},0,1},
 {ok,{resource,<<"/">>,queue,<<"amq.q.gen3219_ra"...>>},0,1},
 {ok,{resource,<<"/">>,queue,<<"amq.q.gen308"...>>},0,1},
 {ok,{resource,<<"/">>,queue,<<"amq.q.ge"...>>},0,1},
 {ok,{resource,<<"/">>,queue,<<"amq."...>>},0,1},
 {ok,{resource,<<"/">>,queue,<<...>>},0,1},
 {ok,{resource,<<"/">>,queue,...},0,1},
 {ok,{resource,<<...>>,...},0,1},
 {ok,{resource,...},0,...},
 {ok,{...},...},
 {ok,...},
 {...}|...]
(test at vsdlbblue01)5>

RabbitMQ was using 1.7GB of RAM when I ran stat_all

Thanks,

Dave



*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From 0x6e6562 at gmail.com  Thu Jul 10 17:32:42 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 10 Jul 2008 11:32:42 -0500
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <OF2A31B996.719E0E47-ON80257482.0059251C-80257482.005A1FBA@Edftrading.com>
References: <OF2A31B996.719E0E47-ON80257482.0059251C-80257482.005A1FBA@Edftrading.com>
Message-ID: <269388e30807100932r4b426af8v798a2e8ac860aa6f@mail.gmail.com>

David,

On Thu, Jul 10, 2008 at 11:24 AM,  <David.Corcoran at edftrading.com> wrote:
>
> Hey,
>
> We're having some memory problems with RabbitMQ and I'm trying to track
> down their cause. What's happening is that RabbitMQ quite quickly starts to
> eat up memory and around the 2GB mark dies (it's a 32bit machine). The logs
> look fine and the startup.err just has a memory allocation error.

What actual error message are you getting?

Ben



From tonyg at lshift.net  Thu Jul 10 17:38:40 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 10 Jul 2008 17:38:40 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <OF2A31B996.719E0E47-ON80257482.0059251C-80257482.005A1FBA@Edftrading.com>
References: <OF2A31B996.719E0E47-ON80257482.0059251C-80257482.005A1FBA@Edftrading.com>
Message-ID: <48763B10.5010208@lshift.net>

Hi David,

David.Corcoran at edftrading.com wrote:
> I've attached the output of stat_all() to see if that might help. It
> doesn't look very informative. Is there another command I should be
> running?

How about length(rabbit_amqqueue:stat_all())?

Tony
-- 
  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From David.Corcoran at edftrading.com  Thu Jul 10 17:46:52 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Thu, 10 Jul 2008 17:46:52 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <269388e30807100932r4b426af8v798a2e8ac860aa6f@mail.gmail.com>
Message-ID: <OF839F04ED.DFAE21F5-ON80257482.005C1FC4-80257482.005C2EA8@Edftrading.com>



rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 10/07/2008 17:32:42:


>
> What actual error message are you getting?

Hey Ben,

Unfortunately I don't know the exact error. I'll copy it next time it runs
out of memory. The rabbitmq.log log looks fine. It doesn't have anything
weird in it.

The clients start to die before it runs out of memory with java errors
complaining "attempt to used closed channel" for queueDeclare.

Dave

>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From David.Corcoran at edftrading.com  Thu Jul 10 17:52:16 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Thu, 10 Jul 2008 17:52:16 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <48763B10.5010208@lshift.net>
Message-ID: <OFD05C058C.1F2282BC-ON80257482.005C3433-80257482.005CAD4C@Edftrading.com>



Tony Garnock-Jones <tonyg at lshift.net> wrote on 10/07/2008 17:38:40:

> Hi David,
>

> How about length(rabbit_amqqueue:stat_all())?

Hi Tony,

Unfortunately I had to restart the server because people were noticing ;)

After restarting there were a very reasonable 9 queues. After running some
of our code it's now up to 200. I suspect we have a queue leak ;)

Is there a way of seeing an untruncated list of queues?

Thanks,

Dave


>
> Tony
> --
>   [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>     [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>   []  [] http://www.lshift.net/ | Email: tonyg at lshift.net


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From JAzoff at uamail.albany.edu  Thu Jul 10 18:04:51 2008
From: JAzoff at uamail.albany.edu (Justin Azoff)
Date: Thu, 10 Jul 2008 13:04:51 -0400
Subject: [rabbitmq-discuss] amqp usage and msg ack timeout
Message-ID: <1215709491.23808.40.camel@stewie.datacomm.albany.edu>

This is also somewhat related to the "One producer multiple subscribers"
thread.

My potential use case for AMQP is for distributed "event" handling.  A
simple example is where one process detects that a device is down.
Prior to queueing it would do something like:

if is_down(device):
  send_email(device)
  send_page(device)
  play_sound(device)

In my testing with amqp, I wrote a wrapper(attached)  which lets me do
the following in different programs on different machines.

#poller.py
e = Events("device_down")
if is_down(device):
  e.add_event(device)

#send_email.py
e = Events("device_down")
e.register_callback('send_email', send_email)

#play_sound.py
e = Events("device_down")
e.register_callback('play_sound', play_sound)
...

The wrapper automatically creates a fanout exchange called 'device_down'
and creates a durable queue for each registered handler.

So my first question is, am I correctly using rabbitmq/AMQP for this, or
did I completely miss some built in feature that would make all of this
much easier?  I wanted each handler to be able to be restarted and never
miss a message, and I wanted a decoupling between the process emitting
the events and each handler.  I think durable queues and fanout
exchanges are the proper solution for this, but I may be wrong.

My second question involves a timeout for the acknowledgment of
messages.  I noticed that if a process crashed, a message would
automatically be put back into the queue, but if instead the process
went into an infinite loop, the message would stay checked out
indefinitely.  Is there a way to tell the server that if a message has
been received, but not acked in a period of time, that it should be put
back into the queue?

I know there is also one potential issue where it may be difficult to
manage the different exchanges and queues on the server. It would be
nice to be able to specify that a queue is durable, but if messages are
not consumed for a long period of time then it should be deleted.


-- 
-- Justin Azoff
-- Network Performance Analyst
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqpevent.py
Type: text/x-python
Size: 3287 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080710/041df608/attachment.py 

From alexis.richardson at cohesiveft.com  Thu Jul 10 18:07:52 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 10 Jul 2008 12:07:52 -0500
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <OFD05C058C.1F2282BC-ON80257482.005C3433-80257482.005CAD4C@Edftrading.com>
References: <48763B10.5010208@lshift.net>
	<OFD05C058C.1F2282BC-ON80257482.005C3433-80257482.005CAD4C@Edftrading.com>
Message-ID: <167204d20807101007i74b07fdfr132221f8e362ab50@mail.gmail.com>

Dave

On Thu, Jul 10, 2008 at 11:52 AM,  <David.Corcoran at edftrading.com> wrote:
> After restarting there were a very reasonable 9 queues. After running some
> of our code it's now up to 200. I suspect we have a queue leak ;)
>
> Is there a way of seeing an untruncated list of queues?

Queue leaks are one very good way to stress the server.  One behaviour
we observed some time ago was a case where a queue was created each
time a message was sent, and then not discarded.  Hence the number of
queues grew and grew without any GC.  Is that what is happening here?

alexis





>
>>
>> Tony
>> --
>>   [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>>     [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>>   []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>
>
> *********************************************************************
> This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you.
> EDF Trading Limited
> 80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
> A Company registered in England No. 4255974.
> Switchboard: 020 7061 4000
> EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
> VAT number: GB 735 5479 07
> *********************************************************************
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From David.Corcoran at edftrading.com  Thu Jul 10 18:15:40 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Thu, 10 Jul 2008 18:15:40 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <167204d20807101007i74b07fdfr132221f8e362ab50@mail.gmail.com>
Message-ID: <OF61B45C62.5E4C3E2A-ON80257482.005E4738-80257482.005ED165@Edftrading.com>



rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 10/07/2008 18:07:52:

>
> Queue leaks are one very good way to stress the server.  One behaviour
> we observed some time ago was a case where a queue was created each
> time a message was sent, and then not discarded.  Hence the number of
> queues grew and grew without any GC.  Is that what is happening here?
>

Hey Alexis,

I think what's happening here is that I create a lot of reply queues for
quite transient producers. But I don't close the channel after I'm finished
and so I guess the auto-delete reply queue isn't being cleaned up. We've
done a lot of refactoring of our RabbitMQ code recently and I think the
call to close got lost. I'm going to put it back in and do some more
testing to see what happens.

Dave

> alexis
>
>
>


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From alexis.richardson at cohesiveft.com  Thu Jul 10 18:18:46 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 10 Jul 2008 12:18:46 -0500
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <OF61B45C62.5E4C3E2A-ON80257482.005E4738-80257482.005ED165@Edftrading.com>
References: <167204d20807101007i74b07fdfr132221f8e362ab50@mail.gmail.com>
	<OF61B45C62.5E4C3E2A-ON80257482.005E4738-80257482.005ED165@Edftrading.com>
Message-ID: <167204d20807101018s64bbc2f4if2b7755f8657e805@mail.gmail.com>

Dave

On Thu, Jul 10, 2008 at 12:15 PM,  <David.Corcoran at edftrading.com> wrote:
>
> I think what's happening here is that I create a lot of reply queues for
> quite transient producers. But I don't close the channel after I'm finished
> and so I guess the auto-delete reply queue isn't being cleaned up. We've
> done a lot of refactoring of our RabbitMQ code recently and I think the
> call to close got lost. I'm going to put it back in and do some more
> testing to see what happens.

Good.  That sounds like a very sensible approach.

You'll need to run some management calls to see #queues etc.  Do you
know how to do that?

alexis



>>
>
>
> *********************************************************************
> This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you.
> EDF Trading Limited
> 80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
> A Company registered in England No. 4255974.
> Switchboard: 020 7061 4000
> EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
> VAT number: GB 735 5479 07
> *********************************************************************
>



-- 
Alexis Richardson
+44 20 7617 7339 (UK)
+44 77 9865 2911 (cell)
+1 650 206 2517 (US)



From David.Corcoran at edftrading.com  Thu Jul 10 18:22:00 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Thu, 10 Jul 2008 18:22:00 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <167204d20807101018s64bbc2f4if2b7755f8657e805@mail.gmail.com>
Message-ID: <OFC0964BD9.722A1B9A-ON80257482.005F4239-80257482.005F6612@Edftrading.com>



rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 10/07/2008 18:18:46:

>
> Good.  That sounds like a very sensible approach.
>
> You'll need to run some management calls to see #queues etc.  Do you
> know how to do that?

Not really. I only know stat_all and length(stat_all). Can you suggest some
others?

Dave


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From 0x6e6562 at gmail.com  Thu Jul 10 20:02:05 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 10 Jul 2008 14:02:05 -0500
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <OFC0964BD9.722A1B9A-ON80257482.005F4239-80257482.005F6612@Edftrading.com>
References: <167204d20807101018s64bbc2f4if2b7755f8657e805@mail.gmail.com>
	<OFC0964BD9.722A1B9A-ON80257482.005F4239-80257482.005F6612@Edftrading.com>
Message-ID: <269388e30807101202y7b80c855ja3f4d4f0b88e4e61@mail.gmail.com>

Hi Dave,

On Thu, Jul 10, 2008 at 12:22 PM,  <David.Corcoran at edftrading.com> wrote:
> Not really. I only know stat_all and length(stat_all). Can you suggest some
> others?

Short of running Tony's suggestion there are no other exposed
diagnostic functions that would give you what you want.

And the reason why you cannot run this is because Rabbit has been
killed, so even if there were some cooler stats you could query for,
you wouldn't be able to anyway :-(

On the one hand, this brings us on to the topic of what kind of
management information users would like to be able to see and how it
should be delivered, but that is a topic for itself.

To solve you problem I can suggest 3-4 practical ways forward:

1. Try to reproduce the error and tell me what the exact error message
actually is. I think this will tell us a lot;
2. Avoid creating too many throw-away queues;
3. I think that the current work I am doing in development would solve
a lot of the issues you are having, which is nearing a QA milestone
and you might do well to test with this in a beta form. Having said
this, I am currently Stateside on other business so I have to
de-prioritize unpaid work :-( , but I'll do it as soon as possible;
4. Engage with us to have a closer look at what problems you are
trying to solve.

HTH,

Ben



From 0x6e6562 at gmail.com  Thu Jul 10 20:35:29 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 10 Jul 2008 14:35:29 -0500
Subject: [rabbitmq-discuss] amqp usage and msg ack timeout
In-Reply-To: <1215709491.23808.40.camel@stewie.datacomm.albany.edu>
References: <1215709491.23808.40.camel@stewie.datacomm.albany.edu>
Message-ID: <269388e30807101235p6d8e8328te469792b5c452a66@mail.gmail.com>

Justin,

On Thu, Jul 10, 2008 at 12:04 PM, Justin Azoff <JAzoff at uamail.albany.edu> wrote:
> The wrapper automatically creates a fanout exchange called 'device_down'
> and creates a durable queue for each registered handler.
>
> So my first question is, am I correctly using rabbitmq/AMQP for this, or
> did I completely miss some built in feature that would make all of this
> much easier?

On face value I don't see any problem with this approach, but I
haven't had the time to look at your code in too much detail yet, so
this is just a preliminary response.

> I wanted each handler to be able to be restarted and never
> miss a message, and I wanted a decoupling between the process emitting
> the events and each handler.  I think durable queues and fanout
> exchanges are the proper solution for this, but I may be wrong.
>
> My second question involves a timeout for the acknowledgment of
> messages.  I noticed that if a process crashed, a message would
> automatically be put back into the queue, but if instead the process
> went into an infinite loop, the message would stay checked out
> indefinitely.  Is there a way to tell the server that if a message has
> been received, but not acked in a period of time, that it should be put
> back into the queue?

This is handled by volume and not by time. After a certain amount of
unroutable messages have queued up (because their consumption is not
ack'ed) they will be returned to the sender.

>
> I know there is also one potential issue where it may be difficult to
> manage the different exchanges and queues on the server. It would be
> nice to be able to specify that a queue is durable, but if messages are
> not consumed for a long period of time then it should be deleted.

This issue touches on the message expiration property in the message
header, which unfortunately is not clearly defined and hence is not
yet implemented in Rabbit.

HTH,

Ben



From tonyg at lshift.net  Thu Jul 10 21:07:45 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 10 Jul 2008 21:07:45 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <OFD05C058C.1F2282BC-ON80257482.005C3433-80257482.005CAD4C@Edftrading.com>
References: <OFD05C058C.1F2282BC-ON80257482.005C3433-80257482.005CAD4C@Edftrading.com>
Message-ID: <48766C11.6030507@lshift.net>

Hi,

David.Corcoran at edftrading.com wrote:
> After restarting there were a very reasonable 9 queues. After running some
> of our code it's now up to 200. I suspect we have a queue leak ;)

Ah, good - in the sense that it's a relief it's nothing more sinister :-)

(Do let us know if the queue-leak diagnosis turns out to be accurate or 
in-.)

> Is there a way of seeing an untruncated list of queues?

The output from the shell is truncated for REPL reasons; you could also 
iterate over the results of stat_all/0:

lists:foreach(fun (Q) -> io:format("~p~n", [Q]) end,
               rabbit_amqqueue:stat_all()).

Actually, io:format/2 doesn't truncate like the REPL does, so a simple 
io:format("~p~n", [rabbit_amqqueue:stat_all()]) also kind-of works. I 
prefer the iteration because there's then one output line per queue, and 
it doesn't build a printed representation of the whole list before 
outputting anything.

Regards,
   Tony




From david.cornell at sophos.com  Fri Jul 11 08:36:51 2008
From: david.cornell at sophos.com (David Cornell)
Date: Fri, 11 Jul 2008 00:36:51 -0700
Subject: [rabbitmq-discuss] Perl client?
Message-ID: <62E6E7A1E9E20F4899B4E40EC870917C669BC1@ca-exchange.activestate.ca>


Hello,

I am evaluating RabbitMQ this week. I am wondering if anyone knows if a
Perl client exists or is in development? 

Thanks in advance,
Dave

 





From David.Corcoran at edftrading.com  Fri Jul 11 08:47:55 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Fri, 11 Jul 2008 08:47:55 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <48766C11.6030507@lshift.net>
Message-ID: <OFE0F84F75.18211A69-ON80257483.002A6320-80257483.002AD71B@Edftrading.com>



rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 10/07/2008 21:07:45:

>
> Ah, good - in the sense that it's a relief it's nothing more sinister :-)
>
> (Do let us know if the queue-leak diagnosis turns out to be accurate or
> in-.)

I've done some quick tests and it seems to work. At least the queue size
isn't growing too much and it shrinks back after we're finished. Today will
be a real test as we run massive amounts of jobs and I'll let you know how
it goes.


> lists:foreach(fun (Q) -> io:format("~p~n", [Q]) end,
>                rabbit_amqqueue:stat_all()).
>

That works perfectly, thanks. With the broken code most of the queues are
in the format "amq.q.gen688_rabbit at vsdlbblue01_20080710164314_" which I
guess are anonymous reply queues. Which would definitely point to a leak.
In the new version of the code there are very few queues and they all have
nice normal names ;)

Thanks,

Dave


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From tonyg at lshift.net  Fri Jul 11 10:00:55 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 11 Jul 2008 10:00:55 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <OFE0F84F75.18211A69-ON80257483.002A6320-80257483.002AD71B@Edftrading.com>
References: <OFE0F84F75.18211A69-ON80257483.002A6320-80257483.002AD71B@Edftrading.com>
Message-ID: <48772147.8050600@lshift.net>

David.Corcoran at edftrading.com wrote:
> That works perfectly, thanks. With the broken code most of the queues are
> in the format "amq.q.gen688_rabbit at vsdlbblue01_20080710164314_" which I
> guess are anonymous reply queues. Which would definitely point to a leak.
> In the new version of the code there are very few queues and they all have
> nice normal names ;)

Great. Thanks for letting us know :-)

Tony




From 0x6e6562 at gmail.com  Fri Jul 11 12:33:43 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 11 Jul 2008 06:33:43 -0500
Subject: [rabbitmq-discuss] Perl client?
In-Reply-To: <62E6E7A1E9E20F4899B4E40EC870917C669BC1@ca-exchange.activestate.ca>
References: <62E6E7A1E9E20F4899B4E40EC870917C669BC1@ca-exchange.activestate.ca>
Message-ID: <269388e30807110433r1d461a3ka5bd2fe138728780@mail.gmail.com>

Dave,

On Fri, Jul 11, 2008 at 2:36 AM, David Cornell <david.cornell at sophos.com> wrote:
> I am evaluating RabbitMQ this week. I am wondering if anyone knows if a
> Perl client exists or is in development?

I did gather in some other discussion that a member of the Rabbit
community was contemplating writing a Perl client, but I don't know
how far they got with that contemplation.

If you would like, it would not be a hard task to implement one
yourself - here is a guide about to build your own client:
http://hopper.squarespace.com/blog/2008/6/21/build-your-own-amqp-client.html

HTH,

Ben



From 0x6e6562 at gmail.com  Fri Jul 11 13:02:03 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 11 Jul 2008 07:02:03 -0500
Subject: [rabbitmq-discuss] amqp usage and msg ack timeout
In-Reply-To: <269388e30807101235p6d8e8328te469792b5c452a66@mail.gmail.com>
References: <1215709491.23808.40.camel@stewie.datacomm.albany.edu>
	<269388e30807101235p6d8e8328te469792b5c452a66@mail.gmail.com>
Message-ID: <269388e30807110502h3887c58dka1137dce0d106817@mail.gmail.com>

On Thu, Jul 10, 2008 at 2:35 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
>> My second question involves a timeout for the acknowledgment of
>> messages.  I noticed that if a process crashed, a message would
>> automatically be put back into the queue, but if instead the process
>> went into an infinite loop, the message would stay checked out
>> indefinitely.  Is there a way to tell the server that if a message has
>> been received, but not acked in a period of time, that it should be put
>> back into the queue?
>
> This is handled by volume and not by time. After a certain amount of
> unroutable messages have queued up (because their consumption is not
> ack'ed) they will be returned to the sender.

Apologies for the misleading statement, this is actually incorrect.
The messages are not returned to the sender.

If there are outstanding unack'ed messages that have been delivered to
a consumer, when the channel is closed that the messages were sent in,
all of those outstanding messages will be requeued.

Ben



From david.cornell at sophos.com  Sat Jul 12 01:09:00 2008
From: david.cornell at sophos.com (David Cornell)
Date: Fri, 11 Jul 2008 17:09:00 -0700
Subject: [rabbitmq-discuss] Perl client?
In-Reply-To: <269388e30807110433r1d461a3ka5bd2fe138728780@mail.gmail.com>
Message-ID: <62E6E7A1E9E20F4899B4E40EC870917C0133F81A@ca-exchange.activestate.ca>

 

> -----Original Message-----
> From: Ben Hood [mailto:0x6e6562 at gmail.com] 
> Sent: Friday, July 11, 2008 4:34 AM
> To: David Cornell
> Cc: rabbitmq
> Subject: Re: [rabbitmq-discuss] Perl client?
> 
> Dave,
> 
> On Fri, Jul 11, 2008 at 2:36 AM, David Cornell 
> <david.cornell at sophos.com> wrote:
> > I am evaluating RabbitMQ this week. I am wondering if 
> anyone knows if 
> > a Perl client exists or is in development?
> 
> I did gather in some other discussion that a member of the 
> Rabbit community was contemplating writing a Perl client, but 
> I don't know how far they got with that contemplation.
> 
> If you would like, it would not be a hard task to implement 
> one yourself - here is a guide about to build your own client:
> http://hopper.squarespace.com/blog/2008/6/21/build-your-own-am
> qp-client.html

Thanks Ben, I will attempt to make one and report back.

Dave



From rabbitmq at tmm1.net  Sat Jul 12 10:45:18 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Sat, 12 Jul 2008 02:45:18 -0700
Subject: [rabbitmq-discuss] AMQP ruby client
Message-ID: <e1c05edd0807120245i1993333bs25d834d45aa5d52e@mail.gmail.com>

I've been working on a Ruby/EventMachine AMQP client over the past few days
and I have a simple client up and running:

    def receive_data data
      Frame.extract(data).each do |frame|
        # log 'got a frame', frame

        case method = frame.payload
        when Protocol::Connection::Start
          send Protocol::Connection::StartOk.new({:platform =>
'Ruby/EventMachine',
                                                  :product => 'AMQP',
                                                  :information => '
http://github.com/tmm1/amqp',
                                                  :version => '0.0.1'},
                                                 'AMQPLAIN',
                                                 {:LOGIN => 'guest',
                                                  :PASSWORD => 'guest'},
                                                 'en_US')

        when Protocol::Connection::Tune
          send Protocol::Connection::TuneOk.new :channel_max => 0,
                                                :frame_max => 131072,
                                                :heartbeat => 0

          send Protocol::Connection::Open.new :virtual_host => '/',
                                              :capabilities => '',
                                              :insist => false

        when Protocol::Connection::OpenOk
          send Protocol::Channel::Open.new, :channel => 1
        end
      end
    end

Feedback and ideas for a higher-level queue/exchange/binding API are
welcome.

  Aman Gupta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080712/5ef725c3/attachment.htm 

From 0x6e6562 at gmail.com  Sat Jul 12 10:59:34 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 12 Jul 2008 04:59:34 -0500
Subject: [rabbitmq-discuss] Perl client?
In-Reply-To: <62E6E7A1E9E20F4899B4E40EC870917C0133F81A@ca-exchange.activestate.ca>
References: <269388e30807110433r1d461a3ka5bd2fe138728780@mail.gmail.com>
	<62E6E7A1E9E20F4899B4E40EC870917C0133F81A@ca-exchange.activestate.ca>
Message-ID: <269388e30807120259i247e94cdue5f9c4a2e486c541@mail.gmail.com>

David,

On Fri, Jul 11, 2008 at 7:09 PM, David Cornell <david.cornell at sophos.com> wrote:
> Thanks Ben, I will attempt to make one and report back.

Cool. If you need any help at all, you can catch me on IM.

There are also a few guys writing a Ruby client ATM and their
preliminary work is on Github, so you can just search for AMQP on
Github.

That might also be a resource for you as well as being able to share
some ideas, solution patterns and gotchas.

HTH,

Ben



From mietek at erlang-consulting.com  Mon Jul 14 15:37:39 2008
From: mietek at erlang-consulting.com (=?UTF-8?Q?Mietek_B=C4=85k?=)
Date: Mon, 14 Jul 2008 15:37:39 +0100
Subject: [rabbitmq-discuss] Problem with direct client tests
Message-ID: <10DE72D7-4380-47C7-AFCA-C33A216B8B38@erlang-consulting.com>

Hello,

I'm unable to get the Erlang client for RabbitMQ to run the direct  
client tests.

It appears that the direct_client_test:test_wrapper/1 function  
attempts to call an nonexistent function, as evidenced by the  
following error message:

{error, "*** eval: {'EXIT',
                     {undef,
                      [{rabbit_multi,get_pid, 
[rabbit_test_direct at erebos,0]},
                       {direct_client_test,test_wrapper,1},
                       {erl_eval,do_apply,5},
                       {lib,eval_str,1},
                       {rpc,'-handle_call/3-fun-0-',5}]}}

Is this a known problem?

Thanks,

-- 
Mietek B?k
Erlang Training & Consulting
http://www.erlang-consulting.com




From 0x6e6562 at gmail.com  Mon Jul 14 16:24:01 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 14 Jul 2008 16:24:01 +0100
Subject: [rabbitmq-discuss] Problem with direct client tests
In-Reply-To: <10DE72D7-4380-47C7-AFCA-C33A216B8B38@erlang-consulting.com>
References: <10DE72D7-4380-47C7-AFCA-C33A216B8B38@erlang-consulting.com>
Message-ID: <269388e30807140824w35030b16x6c6cdfbcdc529818@mail.gmail.com>

Mietek,

On Mon, Jul 14, 2008 at 3:37 PM, Mietek B?k
<mietek at erlang-consulting.com> wrote:
> I'm unable to get the Erlang client for RabbitMQ to run the direct
> client tests.
>
> It appears that the direct_client_test:test_wrapper/1 function
> attempts to call an nonexistent function, as evidenced by the
> following error message:
>
> {error, "*** eval: {'EXIT',
>                     {undef,
>                      [{rabbit_multi,get_pid,
> [rabbit_test_direct at erebos,0]},
>                       {direct_client_test,test_wrapper,1},
>                       {erl_eval,do_apply,5},
>                       {lib,eval_str,1},
>                       {rpc,'-handle_call/3-fun-0-',5}]}}
>
> Is this a known problem?

I think that the the test_wrapper/1 function is old code and has not
been used for a while, especially seeing as the rabbit_multi module
does not export a get_pid function. I'll look into why this is still
there.

In the meantime, the proper way to run the tests is to use the eunit
methods, i.e. direct_client_test:test() will run all of the unit
tests.

HTH,

Ben

From 0x6e6562 at gmail.com  Mon Jul 14 17:11:59 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 14 Jul 2008 17:11:59 +0100
Subject: [rabbitmq-discuss] Problem with direct client tests
In-Reply-To: <269388e30807140824w35030b16x6c6cdfbcdc529818@mail.gmail.com>
References: <10DE72D7-4380-47C7-AFCA-C33A216B8B38@erlang-consulting.com>
	<269388e30807140824w35030b16x6c6cdfbcdc529818@mail.gmail.com>
Message-ID: <269388e30807140911j1c832cd6k84f479af2d6a63d6@mail.gmail.com>

Mietek,

2008/7/14 Ben Hood <0x6e6562 at gmail.com>:
> I think that the the test_wrapper/1 function is old code and has not
> been used for a while, especially seeing as the rabbit_multi module
> does not export a get_pid function. I'll look into why this is still
> there.

I have removed this function from the client test, as it is not doing
anything of any value anyway.

Ben



From david.cornell at sophos.com  Mon Jul 14 19:48:46 2008
From: david.cornell at sophos.com (David Cornell)
Date: Mon, 14 Jul 2008 11:48:46 -0700
Subject: [rabbitmq-discuss] Stomp gateway incompatible with recent builds?
Message-ID: <62E6E7A1E9E20F4899B4E40EC870917C0133F889@ca-exchange.activestate.ca>


I downloaded the stomp gateway and followed the directions, but make run
failed. Is it incompatible with the most recent release? Is this why it
is not linked in on the downloads area?

Here is the output of make:

# make run
make -C ../rabbitmq-server run \
                RABBIT_ARGS='-pa '"$(pwd)/ebin"' -rabbit \
                        stomp_listeners [{\"0.0.0.0\",61613}] \
                        extra_startup_steps
[{\"STOMP-listeners\",rabbit_stomp,kickstart,[]}]'
make[1]: Entering directory `/root/rabbitmq-server'
make[1]: *** No rule to make target `run'.  Stop.
make[1]: Leaving directory `/root/rabbitmq-server'
make: *** [start_server] Error 2




From 0x6e6562 at gmail.com  Mon Jul 14 22:27:17 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 14 Jul 2008 22:27:17 +0100
Subject: [rabbitmq-discuss] Stomp gateway incompatible with recent
	builds?
In-Reply-To: <62E6E7A1E9E20F4899B4E40EC870917C0133F889@ca-exchange.activestate.ca>
References: <62E6E7A1E9E20F4899B4E40EC870917C0133F889@ca-exchange.activestate.ca>
Message-ID: <269388e30807141427w44189be8pd572ee3b1cbffce6@mail.gmail.com>

David,

On Mon, Jul 14, 2008 at 7:48 PM, David Cornell <david.cornell at sophos.com> wrote:
>
> I downloaded the stomp gateway and followed the directions, but make run
> failed. Is it incompatible with the most recent release? Is this why it
> is not linked in on the downloads area?
>
> Here is the output of make:
>
> # make run
> make -C ../rabbitmq-server run \
>                RABBIT_ARGS='-pa '"$(pwd)/ebin"' -rabbit \
>                        stomp_listeners [{\"0.0.0.0\",61613}] \
>                        extra_startup_steps
> [{\"STOMP-listeners\",rabbit_stomp,kickstart,[]}]'
> make[1]: Entering directory `/root/rabbitmq-server'
> make[1]: *** No rule to make target `run'.  Stop.
> make[1]: Leaving directory `/root/rabbitmq-server'
> make: *** [start_server] Error 2
>

Do you have the Rabbit broker installed in ../rabbitmq-server ?

Ben



From 0x6e6562 at gmail.com  Mon Jul 14 23:31:31 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 14 Jul 2008 23:31:31 +0100
Subject: [rabbitmq-discuss] [Fwd: Regarding Permission filters alongwith
	RabbitMQ]
In-Reply-To: <5098.71.249.248.100.1216061015.squirrel@email.mailforbusiness.com>
References: <487B7F77.6080609@lshift.net>
	<269388e30807140937y19913f0ax2f06aa0011ee810a@mail.gmail.com>
	<5098.71.249.248.100.1216061015.squirrel@email.mailforbusiness.com>
Message-ID: <269388e30807141531j28eb4618oc16d81b5f0f39bda@mail.gmail.com>

Abhishek,

On Mon, Jul 14, 2008 at 7:43 PM,  <abhishek at reloadnyc.com> wrote:
> Ben,
>
> Thank you very much for writing.
>
> The idea is to provide some kind of message authorizing before passing it
> to the RabbitMQ system for routing. That authorizing policy acts on all
> the messages. Say, a message doesn't meet the necessary  permissions, in
> that case it may be disallowed to pass through and no need to route it.
> Similarly, another functionality can be to add/delete similar filters in
> the future.

With respect to permissions, AMQP has the concept of ACL based on
vhost, which you can configure on a per user basis and update as you
go along.

If you do not have the necessary permissions, you cannot start a
connection to the broker.

This may be a bit too coarse grained for you though.

> Can you suggest something in this regard like Mule, Synapse etc., which
> can serve our purpose.

I'm reasonably confident that Mule can offer some content based
routing that may be more applicable to your application.

Because AMQP would merely be a transport in Mule, you'd have to refer
to the Mule manual for this.

BTW, it is always a better idea to post to the Rabbit list, because
you can reach the entire subscription base who may have already solved
your problem.


>> On Mon, Jul 14, 2008 at 5:31 PM, Ben Hood <ben at lshift.net> wrote:
>>> Can you please suggest one thing. We need to have an abstraction layer
>>> between the publishers and the RabbitMQ server i.e. a message processor
>>> sitting between the publisher and the RabbitMQ server that receives the
>>> message from the publisher, checks for certain permissions/tags and then
>>> forwards the message to the RabbitMQ system. Is there any ESB or
>>> mediation
>>> router that can be integrated with RabbitMQ and that can provide the
>>> filtering functionality, like Mule or Apache Synapse?
>>
>> Do you have any more detailed requirements about how things get
>> routed, e.g. what happens to messages that don't match a particular
>> condition.
>>
>> This may help in making a suggestion.
>>
>> BTW, at the core of Rabbit is a generic message routing mechanism
>> (binding queues to exchanges using patterns). This may be of interest
>> for this use case.

Ben



From david.cornell at sophos.com  Tue Jul 15 00:22:22 2008
From: david.cornell at sophos.com (David Cornell)
Date: Mon, 14 Jul 2008 16:22:22 -0700
Subject: [rabbitmq-discuss] Stomp gateway incompatible with recent
	builds?
In-Reply-To: <269388e30807141427w44189be8pd572ee3b1cbffce6@mail.gmail.com>
Message-ID: <62E6E7A1E9E20F4899B4E40EC870917C0133F8DB@ca-exchange.activestate.ca>

 

> -----Original Message-----
> From: Ben Hood [mailto:0x6e6562 at gmail.com] 
> Sent: Monday, July 14, 2008 2:27 PM
> To: David Cornell
> Cc: rabbitmq
> Subject: Re: [rabbitmq-discuss] Stomp gateway incompatible 
> with recent builds?
> 
> David,
> 
> On Mon, Jul 14, 2008 at 7:48 PM, David Cornell 
> <david.cornell at sophos.com> wrote:
> >
> > I downloaded the stomp gateway and followed the directions, 
> but make 
> > run failed. Is it incompatible with the most recent 
> release? Is this 
> > why it is not linked in on the downloads area?
> >
> > Here is the output of make:
> >
> > # make run
> > make -C ../rabbitmq-server run \
> >                RABBIT_ARGS='-pa '"$(pwd)/ebin"' -rabbit \
> >                        stomp_listeners [{\"0.0.0.0\",61613}] \
> >                        extra_startup_steps 
> > [{\"STOMP-listeners\",rabbit_stomp,kickstart,[]}]'
> > make[1]: Entering directory `/root/rabbitmq-server'
> > make[1]: *** No rule to make target `run'.  Stop.
> > make[1]: Leaving directory `/root/rabbitmq-server'
> > make: *** [start_server] Error 2
> >
> 
> Do you have the Rabbit broker installed in ../rabbitmq-server ?
> 
> Ben
> 

Not initially, but later renamed the directory from rabbitmq to
rabbitmq-server when the make complained about not being able to find
the directory.

Dave



From rabbitmq at tmm1.net  Tue Jul 15 00:32:07 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Mon, 14 Jul 2008 16:32:07 -0700
Subject: [rabbitmq-discuss] encoding content body frames
Message-ID: <e1c05edd0807141632p5e216380n18430819a5f5e19a@mail.gmail.com>

The amqp0-8.pdf spec states:

The content body payload is an opaque binary block followed by a frame
end octet:

+-----------------------+ +-----------+

| Opaque binary payload | | frame-end |

+-----------------------+ +-----------+


However, sending the extra frame-end octet with the content causes rabbitmq
to get "stuck". In fact, this occurs anytime rabbitmq reads more content
data than it is expecting. Here is a naive patch to ignore extra content in
the body frame:


diff -r 2453e5783900 src/rabbit_framing_channel.erl

--- a/src/rabbit_framing_channel.erl Tue Jul 08 12:16:59 2008 +0100

+++ b/src/rabbit_framing_channel.erl Mon Jul 14 16:31:03 2008 -0700

@@ -101,6 +101,10 @@



 collect_content_payload(_ChannelPid, 0, Acc) ->

     Acc;

+collect_content_payload(_ChannelPid, RemainingByteCount, Acc) when
RemainingByteCount < 0 ->

+    Content = list_to_binary(Acc),

+    {Ret, _} = split_binary(Content, size(Content) + RemainingByteCount),

+    [Ret];

 collect_content_payload(ChannelPid, RemainingByteCount, Acc) ->

     case read_frame(ChannelPid) of

         {content_body, FragmentBin} ->


  Aman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080714/52ee2ee8/attachment.htm 

From rabbitmq at tmm1.net  Tue Jul 15 03:51:45 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Mon, 14 Jul 2008 19:51:45 -0700
Subject: [rabbitmq-discuss] runjava.sh
Message-ID: <e1c05edd0807141951n46428ab8qa8ca134898b2a70a@mail.gmail.com>

I patched runjava.sh as such:
diff -r e3bd1f5c1b3b scripts/runjava.sh
--- a/scripts/runjava.sh Mon Jul 14 20:02:20 2008 +0100
+++ b/scripts/runjava.sh Mon Jul 14 19:50:30 2008 -0700
@@ -1,6 +1,6 @@
 #!/bin/sh
 RABBIT_JARS=
-for d in *.jar
+for d in *.jar `dirname $0`/../build/lib/*.jar `dirname $0`/../lib/*.jar
 do
     RABBIT_JARS="$d:$RABBIT_JARS"
 done

so that I can run:

  make dist1.5
  ./scripts/runjava.sh com.rabbitmq.tools.Tracer

  Aman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080714/e0da890d/attachment.htm 

From holger at wizards.de  Tue Jul 15 11:49:26 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Tue, 15 Jul 2008 12:49:26 +0200
Subject: [rabbitmq-discuss] Broker leak with MulticastMain?
Message-ID: <487C80B6.1030108@wizards.de>


I've been trying a few things with the Java client and noticed that 
MulticastMain seems to cause unlimited broker growth. Periodically the 
process' rsize shrinks, but not as much as it subsequently continues to 
grow again. I noticed this when the Multicast test printed ever increasing 
latencies (see attachment).
The Java client is on Windows and runs with the default settings (one 
producer, one consumer); the broker is run on Linux 2.6.26 with r12b3. It 
happens with both rabbit 1.3.0 and a fresh build pulled from hg.

What can I do to help fix this? I have the beam process table & info (via 
ctrl-c in the emulator) but as they are fairly large I don't want to spam 
the list with them.

Thanks,
Holger

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: latency.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080715/e3a8e132/attachment.txt 

From holger at wizards.de  Tue Jul 15 12:03:40 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Tue, 15 Jul 2008 13:03:40 +0200
Subject: [rabbitmq-discuss] Broker leak with MulticastMain?
In-Reply-To: <487C80B6.1030108@wizards.de>
References: <487C80B6.1030108@wizards.de>
Message-ID: <487C840C.8000001@wizards.de>


I just realized that I could call the stat_all() functions while the test 
is running :-)

--snip--

(rabbit at tux)2> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)3> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)4> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)5> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)6> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)7> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)8> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)9> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)10> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)11> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)12> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      0,1}]
(rabbit at tux)13> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      1858,0}]
(rabbit at tux)14> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      2328,0}]
(rabbit at tux)15> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      3203,0}]
(rabbit at tux)16> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      3784,0}]
(rabbit at tux)17> rabbit_amqqueue:stat_all().
[{ok,{resource,<<"/">>,queue,
                <<"amq.gen-ktU1xAvf7t5rKxDBpsCbgg==">>},
      4279,0}]
(rabbit at tux)18>

--snip--

There is no queue leak and the first few calls always return 0,1 (what are 
those?) but then suddenly the first number starts to grow, just as the 
latencies printed from the Java client start to increase.

Hope this helps.

Holger



From matthias at lshift.net  Tue Jul 15 20:15:50 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 15 Jul 2008 20:15:50 +0100
Subject: [rabbitmq-discuss] Broker leak with MulticastMain?
In-Reply-To: <487C80B6.1030108@wizards.de>
References: <487C80B6.1030108@wizards.de>
Message-ID: <487CF766.3050506@lshift.net>

Holger,

Holger Hoffst?tte wrote:
> I've been trying a few things with the Java client and noticed that 
> MulticastMain seems to cause unlimited broker growth. Periodically the 
> process' rsize shrinks, but not as much as it subsequently continues to 
> grow again. I noticed this when the Multicast test printed ever 
> increasing latencies (see attachment).

The broker grows because it is queuing messages. And that in turn 
happens because the producer sends messages as fast as it can, and the 
broker cannot deliver them to consumers at the same rate.

MulticastMain allows you to limit the sender rate with "-r". So just use 
that option to control the rate.

Matthias.



From tonyg at lshift.net  Wed Jul 16 10:44:18 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 16 Jul 2008 10:44:18 +0100
Subject: [rabbitmq-discuss] Internal services (was Re:  Queue info)
In-Reply-To: <3D9A6D60-2D06-46C8-847F-56923360C878@mu.dk>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
	<3D9A6D60-2D06-46C8-847F-56923360C878@mu.dk>
Message-ID: <487DC2F2.1050206@lshift.net>

Hi Michael,

Michael Arnoldus wrote:
> Speaking of which - if it should happen that I one late night are 
> finding myself sorely missing working in erlang to the degree that I'd 
> like to experiment with this - do you have any docs or just pointers to 
> how to receive and send AMQP from inside erlang? I guess using the 
> erlang AMQP client to let the server talk to itself isn't exactly the 
> right approach ...

Take a look at rabbit_error_logger.erl. This code relays all SASL (and 
other) log messages into a special topic exchange, "amq.rabbitmq.log", 
which can be bound to. (This isn't officially documented, yet.)

It declares the exchange and publishes to it:

     #exchange{} = rabbit_exchange:declare(
                     #resource{virtual_host = DefaultVHost,
                               kind = realm,
                               name = <<"/admin">>},
                     ?LOG_EXCH_NAME,
                     topic, true, false, []),
     ...
     {ok, _QueueNames} = rabbit_exchange:simple_publish(
                           false, false, LogExch, RoutingKey,
                           <<"text/plain">>,
                           list_to_binary(io_lib:format(Format, Data))),

Receiving is a bit more complex; take a look at 
rabbit_amqqueue:pseudo_queue/3.

Regards,
   Tony




From tonyg at lshift.net  Wed Jul 16 11:11:51 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 16 Jul 2008 11:11:51 +0100
Subject: [rabbitmq-discuss] Durable queues for STOMP broker
In-Reply-To: <F6F3ED9C-0CE2-4C0A-8EC9-4C6D691C4C9F@soundcloud.com>
References: <EC24AD2C-7F4C-4B63-8C0A-E5687F237BA3@soundcloud.com>
	<48427486.9000408@lshift.net>
	<F6F3ED9C-0CE2-4C0A-8EC9-4C6D691C4C9F@soundcloud.com>
Message-ID: <487DC967.1050206@lshift.net>

Sean Treadway wrote:
> while msg = conn.receive
>   puts msg.body
> end

Ahaaaaaa. OK. Thanks. I've committed those changes to the hg repo.

Regards,
   Tony




From tonyg at lshift.net  Wed Jul 16 11:20:06 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 16 Jul 2008 11:20:06 +0100
Subject: [rabbitmq-discuss] Stomp gateway incompatible with recent
	builds?
In-Reply-To: <62E6E7A1E9E20F4899B4E40EC870917C0133F889@ca-exchange.activestate.ca>
References: <62E6E7A1E9E20F4899B4E40EC870917C0133F889@ca-exchange.activestate.ca>
Message-ID: <487DCB56.6060009@lshift.net>

David Cornell wrote:
> I downloaded the stomp gateway and followed the directions, but make run
> failed. Is it incompatible with the most recent release? Is this why it
> is not linked in on the downloads area?

Hi David,

Yes, the STOMP gateway in mercurial needs to be run against the rabbitmq 
server from mercurial as well. The 1.3.0 release is too old.

Here's a script that should work for you:

   $ mkdir my-build-directory
   $ cd my-build-directory
   $ hg clone http://hg.rabbitmq.com/rabbitmq-codegen
   $ hg clone http://hg.rabbitmq.com/rabbitmq-server
   $ hg clone http://hg.rabbitmq.com/rabbitmq-stomp
   $ cd rabbitmq-server
   $ make
   $ cd ..
   $ cd rabbitmq-stomp
   $ make

(Followed by "make run" to start the augmented broker running 
interactively.)

Regards,
   Tony
-- 
  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From 0x6e6562 at gmail.com  Wed Jul 16 11:20:28 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 16 Jul 2008 11:20:28 +0100
Subject: [rabbitmq-discuss] encoding content body frames
In-Reply-To: <e1c05edd0807141632p5e216380n18430819a5f5e19a@mail.gmail.com>
References: <e1c05edd0807141632p5e216380n18430819a5f5e19a@mail.gmail.com>
Message-ID: <269388e30807160320u68c8ffe7jffe2962b505dfa6f@mail.gmail.com>

Aman,

On Tue, Jul 15, 2008 at 12:32 AM, Aman Gupta <rabbitmq at tmm1.net> wrote:
> The amqp0-8.pdf spec states:
>
> The content body payload is an opaque binary block followed by a frame end octet:
>
> +-----------------------+ +-----------+
>
> | Opaque binary payload | | frame-end |
>
> +-----------------------+ +-----------+
>
> However, sending the extra frame-end octet with the content causes rabbitmq
> to get "stuck". In fact, this occurs anytime rabbitmq reads more content
> data than it is expecting. Here is a naive patch to ignore extra content in
> the body frame:

Sorry for the delay in responding and thanks for the patch.

Unfortuneately, I would say that the ambiguity of the spec is slightly
to blame here. It does actually say in a footnote that this ending
octet is redundant, hence why it is not used in the frame parser in
Rabbit.

Also, there are a number of clients that currently work well with
Rabbit, so it hasn't been a practical issue thus far either.

This ties in with the weight field in the content header, which was
originally an attempt of allowing a form of MIME-Multipart content
within a body.

As it turned out, this capability became deprecated.

I think that your observations are very valuable because it means that
there are more eyes on the spec, reviewing it and identifying
mistakes.

Ben



From tonyg at lshift.net  Wed Jul 16 11:27:37 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 16 Jul 2008 11:27:37 +0100
Subject: [rabbitmq-discuss] encoding content body frames
In-Reply-To: <e1c05edd0807141632p5e216380n18430819a5f5e19a@mail.gmail.com>
References: <e1c05edd0807141632p5e216380n18430819a5f5e19a@mail.gmail.com>
Message-ID: <487DCD19.9070105@lshift.net>

Hi Aman,

Aman Gupta wrote:
> The content body payload is an opaque binary block followed by a frame end octet:

That's right - the language in the spec isn't quite precise enough to 
pin down the expected behaviour here. The way it is intended to be, and 
the way the current implementations work, is as follows.

Each frame (no matter its type) is built from
   - 7 bytes of header
   - N bytes of body
   - 1 byte of frame end marker

So for method, content header, and content body frames (and also the 
others mentioned in the spec), the same generic pattern is used.

In more detail, a full frame looks like

  - 1 byte of type (method, content header, content body etc)
  - 2 bytes of channel number
  - 4 bytes of payload size (= N)
  - N bytes of payload
  - 1 byte of frame end marker (0xCE)

Note that the payload size word counts neither the 7 bytes of header nor 
the 1 bytes of frame end marker.

Once a complete frame is read, its type is examined, and the payload can 
be further decoded if the frame is a method or content header frame.

Regards,
   Tony




From tonyg at lshift.net  Wed Jul 16 11:29:39 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 16 Jul 2008 11:29:39 +0100
Subject: [rabbitmq-discuss] runjava.sh
In-Reply-To: <e1c05edd0807141951n46428ab8qa8ca134898b2a70a@mail.gmail.com>
References: <e1c05edd0807141951n46428ab8qa8ca134898b2a70a@mail.gmail.com>
Message-ID: <487DCD93.4030806@lshift.net>

Hi Aman; the way I usually work is

  $ ant dist
  $ (cd build/dist; bash runjava.sh com.rabbitmq.tools.Tracer)

Regards,
   Tony


Aman Gupta wrote:
> I patched runjava.sh as such:
> 
> diff -r e3bd1f5c1b3b scripts/runjava.sh
> --- a/scripts/runjava.sh Mon Jul 14 20:02:20 2008 +0100
> +++ b/scripts/runjava.sh Mon Jul 14 19:50:30 2008 -0700
> @@ -1,6 +1,6 @@
>  #!/bin/sh
>  RABBIT_JARS=
> -for d in *.jar
> +for d in *.jar `dirname $0`/../build/lib/*.jar `dirname $0`/../lib/*.jar
>  do
>      RABBIT_JARS="$d:$RABBIT_JARS"
>  done
> 
> so that I can run:
> 
>   make dist1.5
>   ./scripts/runjava.sh com.rabbitmq.tools.Tracer
> 
>   Aman




From 0x6e6562 at gmail.com  Wed Jul 16 11:41:32 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 16 Jul 2008 11:41:32 +0100
Subject: [rabbitmq-discuss] runjava.sh
In-Reply-To: <487DCD93.4030806@lshift.net>
References: <e1c05edd0807141951n46428ab8qa8ca134898b2a70a@mail.gmail.com>
	<487DCD93.4030806@lshift.net>
Message-ID: <269388e30807160341l4a90d29cy8a963086915c2170@mail.gmail.com>

Aman,

On Wed, Jul 16, 2008 at 11:29 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Hi Aman; the way I usually work is
>
>  $ ant dist
>  $ (cd build/dist; bash runjava.sh com.rabbitmq.tools.Tracer)

So this a feature and not a bug :-)

Having said that, I have taken it down as an improvement that we'll
make to the script to avoid any future confusion.

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Jul 16 11:48:20 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 16 Jul 2008 11:48:20 +0100
Subject: [rabbitmq-discuss] encoding content body frames
In-Reply-To: <269388e30807160320u68c8ffe7jffe2962b505dfa6f@mail.gmail.com>
References: <e1c05edd0807141632p5e216380n18430819a5f5e19a@mail.gmail.com>
	<269388e30807160320u68c8ffe7jffe2962b505dfa6f@mail.gmail.com>
Message-ID: <269388e30807160348n13f5bfc3yd0cc0c6869d80f3f@mail.gmail.com>

Aman,

On Wed, Jul 16, 2008 at 11:20 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Unfortuneately, I would say that the ambiguity of the spec is slightly
> to blame here. It does actually say in a footnote that this ending
> octet is redundant, hence why it is not used in the frame parser in
> Rabbit.

To clarify this statement, the end marker is not used in the content
collection within the rabbit_framing_chanel module. It will parsed in
the rabbit_reader module however, check out the handle_input/3
function. So whilst this is not theoretically necessary, this is
actually read in order to be compiant with the spec.

Ben



From 0x6e6562 at gmail.com  Wed Jul 16 11:55:33 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 16 Jul 2008 11:55:33 +0100
Subject: [rabbitmq-discuss] Internal services (was Re: Queue info)
In-Reply-To: <487DC2F2.1050206@lshift.net>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>
	<47C65F88.8020700@lshift.net>
	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>
	<3D9A6D60-2D06-46C8-847F-56923360C878@mu.dk>
	<487DC2F2.1050206@lshift.net>
Message-ID: <269388e30807160355v4f86fa12r48dd4cc0d46def1d@mail.gmail.com>

Michael,

On Wed, Jul 16, 2008 at 10:44 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Hi Michael,
>
> Michael Arnoldus wrote:
>> Speaking of which - if it should happen that I one late night are
>> finding myself sorely missing working in erlang to the degree that I'd
>> like to experiment with this - do you have any docs or just pointers to
>> how to receive and send AMQP from inside erlang? I guess using the
>> erlang AMQP client to let the server talk to itself isn't exactly the
>> right approach ...

Can you elaborate on why using the Erlang client to let the *server
speak to itself* may the wrong approach?

As Tony has pointed out in the previous post, you can use the internal
rabbit API to send and receive messages, but this means that you tie
yourself in the internals of Rabbit, which *may* change over time.

HTH,

Ben



From tonyg at lshift.net  Wed Jul 16 12:34:27 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 16 Jul 2008 12:34:27 +0100
Subject: [rabbitmq-discuss] Internal services (was Re: Queue info)
In-Reply-To: <269388e30807160355v4f86fa12r48dd4cc0d46def1d@mail.gmail.com>
References: <DC162902A1CB844CBEF4A6753064B42D03584055@usamal03.usatech.com>	<47C65F88.8020700@lshift.net>	<167204d20802280025i56ea3f83u55b5b19219a2b1b@mail.gmail.com>	<3D9A6D60-2D06-46C8-847F-56923360C878@mu.dk>	<487DC2F2.1050206@lshift.net>
	<269388e30807160355v4f86fa12r48dd4cc0d46def1d@mail.gmail.com>
Message-ID: <487DDCC3.5040201@lshift.net>

Ben Hood wrote:
> As Tony has pointed out in the previous post, you can use the internal
> rabbit API to send and receive messages, but this means that you tie
> yourself in the internals of Rabbit, which *may* change over time.

This is a very good point. It'd probably be better, if possible, to use 
the Erlang client - perhaps in its "native transport" mode.

Tony




From holger at wizards.de  Wed Jul 16 12:42:05 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Wed, 16 Jul 2008 13:42:05 +0200
Subject: [rabbitmq-discuss] Broker leak with MulticastMain?
In-Reply-To: <487CF766.3050506@lshift.net>
References: <487C80B6.1030108@wizards.de> <487CF766.3050506@lshift.net>
Message-ID: <487DDE8D.4070809@wizards.de>

Matthias Radestock wrote:
> The broker grows because it is queuing messages. And that in turn 
> happens because the producer sends messages as fast as it can, and the 
> broker cannot deliver them to consumers at the same rate.
> 
> MulticastMain allows you to limit the sender rate with "-r". So just use 
> that option to control the rate.

Ah yes - now that explains it. I had misunderstood the test and assumed 
that it always received the same number of messages that the producer(s) 
sent, but  fully reading through the code I now see that it calculates 
only based on the fixed time interval, and that of course can lead to 
queue-up if the rates are not symmetric. Using the -r flag works fine and 
keeps the broker steady.

Thanks!
Holger



From holger at wizards.de  Wed Jul 16 15:28:06 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Wed, 16 Jul 2008 16:28:06 +0200
Subject: [rabbitmq-discuss] Suggestion for performance options
Message-ID: <487E0576.2010100@wizards.de>

Hi,

Afte playing with the Multicast test I wanted to share something and 
suggest an improvement to the client connection setup.

By default the MulticastMain test blasts many empty messages over the 
wire, and I was puzzled by the numbers I got. While the machine running 
the broker is "only" an old single-core 2.4GHz P4 (client is a dual-core 
Thinkpad with Windows) I expected much more than ~2000 messages/sec over 
Gigabit ethernet. Turns out that the Java client by default does not set 
any socket buffer options, which are crucial for TCP performance. This is 
usually only a problem over long distances and WANs with large latencies, 
but the situation is essentially the same with many small messages on a 
LAN - just the scales are different.

A quick test confirmed this. I added the following bits to 
SocketFrameHandler's constructor after the socket has been created:

     _socket.setSendBufferSize(16777216);
     _socket.setReceiveBufferSize(16777216);

This resulted in a jump from ~2000 messages/sec to >35000 for the 
producer. Variations with e.g. multiple consumers show similar gains with 
continous receives in the ~20k/sec range.

Now, that 16M value is just an almost arbitrary "big value" for gigabit 
LAN; you might get similar results with something like ~2-4 MB, and in 
fact too large values often degrade performance again (it's all very 
obscure). Both Linux and Windows are supposed to have auto-tuning for the 
TCP stack including dynamically growing the TCP window, but in practice 
this only seems to work in special cases and/or for continuously high 
bandwidth transfers like FTP.

It seems to me that being able to set these values would be a good 
addition to the ConnectionParameters class. They could then be configured 
on the underlying socket when it is created by the ConnectionFactory.

cheers!
Holger



From rabbitmq-discuss_efine at usa.net  Wed Jul 16 23:28:27 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Wed, 16 Jul 2008 18:28:27 -0400
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com>
Message-ID: <6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>

I've spoken to Ben about this topic in the past, and he advised me to open
an new topic on it, which is what I'm doing.

In the MQ world (IIRC) there is an administration API through which one can
do virtually anything that one can do using the command runmqsc. I believe
that RabbitMQ really, really needs something similar. When I could not
figure out how to delete a no-longer needed permanent queue using
rabbitmqctl, I wrote a simple Erlang module (source code attached), which I
named rbmq_admin, that makes available a number of administrative RabbitMQ
commands.

This exports the following Erlang functions:

stop/1, stop_app/1, start_app/1, reset/1, force_reset/1, cluster/2,
status/1, add_user/3,
delete_user/2, change_password/3, list_users/1, add_vhost/2, delete_vhost/2,
list_vhosts/1,
map_user_vhost/3, unmap_user_vhost/3, list_user_vhosts/2,
list_vhost_users/2, add_realm/3,
delete_realm/3, list_realms/2, set_permissions/5, list_permissions/3,
list_queues/1, delete_queue/3,
permission_list/1

With these, I can do just about anything I need to administer RabbitMQ. It
uses rpc:call() to communicate with the Rabbit node, so it's usable across
nodes, subject to Erlang features like cookies and -sname/-name usage. I use
it to create realms, vhosts, users, and so on using Erlang. I even wrote a
simple Yaws web page that lists all the queues on a given node and vhost,
together with how many messages are outstanding on the queue and how many
consumers are attached. With the wrapper, it's fairly trivial to do.

Now the weakness of this approach is that these commands are really just a
thin wrapper over functions exported by the following RabbitMQ modules:

rabbit, rabbit_mnesia, rabbit_access_control, rabbit_realm, and
rabbit_amqqueue.

This has the following shortcomings:

   1. It is intimately tied to rabbit internal APIs. Any change to the APIs,
   even just for the sake of refactoring, will break this.
   2. It uses internal formats (e.g. tuples) returned by the API, which also
   tightly couples it to the internals.
   3. It is non-standard.
   4. It's only available in Erlang.

For me, these are not huge issues right now (until they change the internals
:). However, if there is to be a standard RabbitMQ Admin API, Ben and his
colleagues will need to implement it and release it officially. We can help
by defining what we would like to see in it.

What this topic hopes to achieve is to (a) gauge the interest in the
RabbitMQ community for something like this, and (b) if there is enough
interest, gather requirements -- or even just a wish list -- from the
community. The wrapper I wrote and this post could be a starting point for
this discussion.

The API would require at least the following:

   1. It would need to be available in multiple languages, to support the
   multiple clients (e.g. Java, .NET, Erlang). Hopefully it could be defined in
   such a way that one language-agnostic manual could be written for all the
   languages, together with short language-specific chapters to clarify exact
   usage for that language binding.
   2. The formats of data passed to and returned from the API would have to
   become cast in concrete. For example, at the moment a list of queues
   returned by rabbit_amqqueue:stat_all/0 is in this format:
   [{ok,{resource,<<"resource name">>,queue,<<"queue name">>},
   NumMsgs,NumConsumers},...]. A canonical format for this (and all the
   others) needs to be defined, which won't change (or can change in a
   non-breaking way), even if there are internal RabbitMQ changes. Preferably,
   the data formats should be extensible so that new data points can easily be
   added that will not break existing code. How to do this across multiple
   languages is a good question, unless a language-agnostic format such as XML
   (heavy) or JSON (haven't used it) or something similar is used. I expect
   there will be much debate about this.
   3. It would need to be powerful enough to do most or all administrative
   tasks. Again, the list of functions above could be a starting point.

I hope this is of interest.

Regards,
Edwin Fine

On Wed, Jul 16, 2008 at 6:55 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Michael,
>
> On Wed, Jul 16, 2008 at 10:44 AM, Tony Garnock-Jones <tonyg at lshift.net>
> wrote:
> > Hi Michael,
> >
> > Michael Arnoldus wrote:
> >> Speaking of which - if it should happen that I one late night are
> >> finding myself sorely missing working in erlang to the degree that I'd
> >> like to experiment with this - do you have any docs or just pointers to
> >> how to receive and send AMQP from inside erlang? I guess using the
> >> erlang AMQP client to let the server talk to itself isn't exactly the
> >> right approach ...
>
> Can you elaborate on why using the Erlang client to let the *server
> speak to itself* may the wrong approach?
>
> As Tony has pointed out in the previous post, you can use the internal
> rabbit API to send and receive messages, but this means that you tie
> yourself in the internals of Rabbit, which *may* change over time.
>
> HTH,
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
The great enemy of the truth is very often not the lie -- deliberate,
contrived and dishonest, but the myth, persistent, persuasive, and
unrealistic. Belief in myths allows the comfort of opinion without the
discomfort of thought.
John F. Kennedy 35th president of US 1961-1963 (1917 - 1963)



-- 
The great enemy of the truth is very often not the lie -- deliberate,
contrived and dishonest, but the myth, persistent, persuasive, and
unrealistic. Belief in myths allows the comfort of opinion without the
discomfort of thought.
John F. Kennedy 35th president of US 1961-1963 (1917 - 1963)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080716/11e7f0c8/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rbmq_admin.erl
Type: application/octet-stream
Size: 6922 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080716/11e7f0c8/attachment.obj 

From david.cornell at sophos.com  Thu Jul 17 00:10:09 2008
From: david.cornell at sophos.com (David Cornell)
Date: Wed, 16 Jul 2008 16:10:09 -0700
Subject: [rabbitmq-discuss] Stomp gateway incompatible with recent
	builds?
In-Reply-To: <487DCB56.6060009@lshift.net>
Message-ID: <62E6E7A1E9E20F4899B4E40EC870917C0133FA79@ca-exchange.activestate.ca>

 

> -----Original Message-----
> From: Tony Garnock-Jones [mailto:tonyg at lshift.net] 
> Sent: Wednesday, July 16, 2008 3:20 AM
> To: David Cornell
> Cc: rabbitmq
> Subject: Re: [rabbitmq-discuss] Stomp gateway incompatible 
> with recent builds?
> 
> David Cornell wrote:
> > I downloaded the stomp gateway and followed the directions, 
> but make 
> > run failed. Is it incompatible with the most recent 
> release? Is this 
> > why it is not linked in on the downloads area?
> 
> Hi David,
> 
> Yes, the STOMP gateway in mercurial needs to be run against 
> the rabbitmq server from mercurial as well. The 1.3.0 release 
> is too old.
> 
> Here's a script that should work for you:
> 
>    $ mkdir my-build-directory
>    $ cd my-build-directory
>    $ hg clone http://hg.rabbitmq.com/rabbitmq-codegen
>    $ hg clone http://hg.rabbitmq.com/rabbitmq-server
>    $ hg clone http://hg.rabbitmq.com/rabbitmq-stomp
>    $ cd rabbitmq-server
>    $ make
>    $ cd ..
>    $ cd rabbitmq-stomp
>    $ make
> 
> (Followed by "make run" to start the augmented broker running
> interactively.)
> 
> Regards,
>    Tony

It worked for me thanks! Is this how additional gateways will be
released going forward or are there plans to have a different plugin
architecture in place at some point?



From rabbitmq at tmm1.net  Thu Jul 17 01:35:55 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Wed, 16 Jul 2008 17:35:55 -0700
Subject: [rabbitmq-discuss] Perl client?
In-Reply-To: <269388e30807120259i247e94cdue5f9c4a2e486c541@mail.gmail.com>
References: <269388e30807110433r1d461a3ka5bd2fe138728780@mail.gmail.com>
	<62E6E7A1E9E20F4899B4E40EC870917C0133F81A@ca-exchange.activestate.ca>
	<269388e30807120259i247e94cdue5f9c4a2e486c541@mail.gmail.com>
Message-ID: <e1c05edd0807161735w386de2e0v32bcb1cf2b6e3561@mail.gmail.com>

You might find this helpful if you're writing a client:
http://github.com/tmm1/amqp/tree/3cc235715c9ffec2e10d89c281a76bd67cf7d4d6/protocol/doc.txt
It documents all the packets exchanged between the server and client during
a typical session, in both their binary and decoded forms.

  Aman

On Sat, Jul 12, 2008 at 2:59 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> David,
>
> On Fri, Jul 11, 2008 at 7:09 PM, David Cornell <david.cornell at sophos.com>
> wrote:
> > Thanks Ben, I will attempt to make one and report back.
>
> Cool. If you need any help at all, you can catch me on IM.
>
> There are also a few guys writing a Ruby client ATM and their
> preliminary work is on Github, so you can just search for AMQP on
> Github.
>
> That might also be a resource for you as well as being able to share
> some ideas, solution patterns and gotchas.
>
> HTH,
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080716/42d6530f/attachment.htm 

From tonyg at lshift.net  Thu Jul 17 09:18:12 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 17 Jul 2008 09:18:12 +0100
Subject: [rabbitmq-discuss] Stomp gateway incompatible with recent
	builds?
In-Reply-To: <62E6E7A1E9E20F4899B4E40EC870917C0133FA79@ca-exchange.activestate.ca>
References: <62E6E7A1E9E20F4899B4E40EC870917C0133FA79@ca-exchange.activestate.ca>
Message-ID: <487F0044.1030002@lshift.net>

David Cornell wrote:
> It worked for me thanks! Is this how additional gateways will be
> released going forward or are there plans to have a different plugin
> architecture in place at some point?

The latter. The reason it's awkward right now is that these are the very 
first few plugins. Any ideas about how it could be improved? Something 
like ejabberd's mod_* system, with a behaviour(rabbitmq_plugin) or 
something, perhaps?

Tony




From hubert at lshift.net  Thu Jul 17 12:14:54 2008
From: hubert at lshift.net (Hubert Plociniczak)
Date: Thu, 17 Jul 2008 12:14:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ .Net/C# AMQP client library 1.4.0
	released
Message-ID: <487F29AE.6080203@lshift.net>

The RabbitMQ team is pleased to announce the release of
the RabbitMQ .Net/C# AMQP client library 1.4.0.

This release has beta status and focuses on the following areas:
- bug fixes for a number of race conditions
- improved shutdown protocol
- bug fix for usage of read timeouts in .Net sockets
- more documentation

For details see the attached release notes.
Binary and source distributions of the new release can be found in the
usual place, at http://www.rabbitmq.com/dotnet.html.

We recommend that all users of earlier versions of the RabbitMQ .Net/C#
AMQP client library 1.4.0. upgrade to this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at ..., or directly at
info at ....

Regards,

The RabbitMQ Team
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: release-notes.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080717/46a32c94/attachment.txt 

From JWatson at sis.tv  Thu Jul 17 14:27:36 2008
From: JWatson at sis.tv (John Watson)
Date: Thu, 17 Jul 2008 14:27:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com> 
	<6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>
Message-ID: <85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>

When this was discussed earlier on the rabbit forum:- http://www.trapexit.org/forum/viewtopic.php?p=37702 I thought that one of the most interesting responses described the approach taken by QPID: http://cwiki.apache.org/qpid/management-design-notes.html .

 

Cheers

John Watson


**********************************************************************
Satellite Information Services Limited Registered Office:
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality. If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
**********************************************************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080717/4b49f175/attachment.htm 

From alexis.richardson at cohesiveft.com  Thu Jul 17 14:37:19 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 17 Jul 2008 14:37:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com>
	<6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>
	<85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>
Message-ID: <167204d20807170637j6e549d44m1971ac65a4b17426@mail.gmail.com>

Thanks John.

FYI, all, that design was created by iMatix and extended by Qpid.

A reference is here - http://wiki.amqp.org/wiki:cml-specification

Some of this work has evolved into AMQP management spec work.

I would also like to see how people see this playing out with the XMPP
IM gateway, as in 'Creating, Listing and Deleting Exchanges' here:
http://hg.rabbitmq.com/rabbitmq-xmpp/raw-file/tip/doc/index.html

Note that this is all very generic - I applaud Edwin's approach for its focus!

alexis


On Thu, Jul 17, 2008 at 2:27 PM, John Watson <JWatson at sis.tv> wrote:
> When this was discussed earlier on the rabbit forum:-
> http://www.trapexit.org/forum/viewtopic.php?p=37702 I thought that one of
> the most interesting responses described the approach taken by QPID:
> http://cwiki.apache.org/qpid/management-design-notes.html .
>
>
>
> Cheers
>
> John Watson
>
> **********************************************************************
>
> Satellite Information Services Limited Registered Office:
>
> 17 Corsham Street London N1 6DR, Company No. 4243307
>
>
>
> The information in this e-mail (which includes any files
>
> transmitted with it) is confidential and is intended for the
>
> addressee only. Unauthorised recipients are required to
>
> maintain confidentiality. If you have received this e-mail
>
> in error please notify the sender immediately, destroy any
>
> copies and delete it from your computer system.
>
> **********************************************************************
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From cctrieloff at redhat.com  Thu Jul 17 15:03:26 2008
From: cctrieloff at redhat.com (Carl Trieloff)
Date: Thu, 17 Jul 2008 10:03:26 -0400
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <167204d20807170637j6e549d44m1971ac65a4b17426@mail.gmail.com>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com>	<6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>	<85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>
	<167204d20807170637j6e549d44m1971ac65a4b17426@mail.gmail.com>
Message-ID: <487F512E.9060006@redhat.com>

Alexis Richardson wrote:
> Thanks John.
>
> FYI, all, that design was created by iMatix and extended by Qpid.
>
>   

Here is the work as 'extended by Qpid' as referenced by Alexis

http://cwiki.apache.org/qpid/management-design-notes.html
http://cwiki.apache.org/qpid/mgmtc.html

and a simple example:
http://svn.apache.org/viewvc/incubator/qpid/trunk/qpid/cpp/examples/qmf-agent/

regards
Carl.



From alexis.richardson at cohesiveft.com  Thu Jul 17 15:15:12 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 17 Jul 2008 15:15:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <487F512E.9060006@redhat.com>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com>
	<6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>
	<85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>
	<167204d20807170637j6e549d44m1971ac65a4b17426@mail.gmail.com>
	<487F512E.9060006@redhat.com>
Message-ID: <167204d20807170715n45aeeac6oac89429362fdb81d@mail.gmail.com>

Carl, that was the link John provided.

Just to be clear and on the record - I think Qpid have done some
excellent work here.  I just want to make sure that iMatix get some
credit too.

Hope everyone is happy with that.

a


On Thu, Jul 17, 2008 at 3:03 PM, Carl Trieloff <cctrieloff at redhat.com> wrote:
> Alexis Richardson wrote:
>>
>> Thanks John.
>>
>> FYI, all, that design was created by iMatix and extended by Qpid.
>>
>>
>
> Here is the work as 'extended by Qpid' as referenced by Alexis
>
> http://cwiki.apache.org/qpid/management-design-notes.html
> http://cwiki.apache.org/qpid/mgmtc.html
>
> and a simple example:
> http://svn.apache.org/viewvc/incubator/qpid/trunk/qpid/cpp/examples/qmf-agent/
>
> regards
> Carl.
>



From cctrieloff at redhat.com  Thu Jul 17 15:17:47 2008
From: cctrieloff at redhat.com (Carl Trieloff)
Date: Thu, 17 Jul 2008 10:17:47 -0400
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <167204d20807170715n45aeeac6oac89429362fdb81d@mail.gmail.com>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com>	
	<6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>	
	<85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>	
	<167204d20807170637j6e549d44m1971ac65a4b17426@mail.gmail.com>	
	<487F512E.9060006@redhat.com>
	<167204d20807170715n45aeeac6oac89429362fdb81d@mail.gmail.com>
Message-ID: <487F548B.2050106@redhat.com>


I was not following the thread, just saw the last post and thus provided 
the link. sorry
if duplicate info.

regards
Carl.


Alexis Richardson wrote:
> Carl, that was the link John provided.
>
> Just to be clear and on the record - I think Qpid have done some
> excellent work here.  I just want to make sure that iMatix get some
> credit too.
>
> Hope everyone is happy with that.
>
> a
>
>
> On Thu, Jul 17, 2008 at 3:03 PM, Carl Trieloff <cctrieloff at redhat.com> wrote:
>   
>> Alexis Richardson wrote:
>>     
>>> Thanks John.
>>>
>>> FYI, all, that design was created by iMatix and extended by Qpid.
>>>
>>>
>>>       
>> Here is the work as 'extended by Qpid' as referenced by Alexis
>>
>> http://cwiki.apache.org/qpid/management-design-notes.html
>> http://cwiki.apache.org/qpid/mgmtc.html
>>
>> and a simple example:
>> http://svn.apache.org/viewvc/incubator/qpid/trunk/qpid/cpp/examples/qmf-agent/
>>
>> regards
>> Carl.
>>
>>     




From David.Corcoran at edftrading.com  Thu Jul 17 15:52:08 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Thu, 17 Jul 2008 15:52:08 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <48772147.8050600@lshift.net>
Message-ID: <OFB3F8B1E9.4B920DB4-ON80257489.004E87FF-80257489.0051AD17@Edftrading.com>



rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 11/07/2008 10:00:55:

>
> Great. Thanks for letting us know :-)

Hey Tony,

A further update on this. It's been a week since I fixed the queue leak we
were having and the amount of memory RabbitMQ uses has slowly grown since
then. It's currently using about 1GB. The queue count is 20 and they are
all empty legit queues.

This may be nothing to worry about. I'm not sure how Erlang's garbage
collection works but if it's anything like Java's it won't start giving
back memory until it really has to. Do you know if it is possible to force
a garbage collection? Or maybe something else I should try to see what the
problem is?

One thing I'm slightly wary of is that the memory spiked when I connected
250 clients to it. And when I disconnected them it didn't shrink very much.

I'll keep an eye on it.

Dave


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From rabbitmq-discuss_efine at usa.net  Thu Jul 17 16:51:21 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Thu, 17 Jul 2008 11:51:21 -0400
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com>
	<6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>
	<85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>
Message-ID: <6c2563b20807170851s74830b03q6a44eef45ef1b30@mail.gmail.com>

John,

Thanks for the reference to the earlier discussion. I missed that one. I am
also influenced to some degree by what MQ did for its admin control.

I'd like to contrast my approach with the QPID one.

My approach was extremely pragmatic and bottom-up. It did not try to solve
all the problems and create a grand design. The QPID approach is at the
opposite end of the spectrum. Both approaches have merits and shortcomings.
Mine is very limited and short-sighted, but has the advantage of being very
easy to understand, and immediately available to play with and get a feel
for what is wanted and needed. The QPID approach would take a great deal
more work, and testing, just to get something usable on RabbitMQ. This
impedes progress. I have always been a proponent of eliciting realistic
requirements by prototyping (as long as the prototype does not suddenly
become the production version, which is always a danger). It grounds us in
practicalities right from the start. Once we see what actually works, we do
another iteration to expand the design to become more generic. Another
disadvantage is that we may not think of a very important feature until late
in the game, and have to change the entire architecture. That's why it's
best to get high-level requirements up front, in a timeboxed fashion to
prevent analysis paralysis, and then try the various features out for
real-world usability, and iterate until cooked.

QPID's approach is interesting in that it uses the AMQP protocol itself as
the communication mechanism. I quite like this idea from the point of view
that every AMQP language binding will be able to use it. On the other hand,
it's a bit clumsy and heavyweight in that you have to set up one or more
private queues just to talk the the management broker, and as far as I can
see, it's very generic, so I am uncertain of exactly what capabilities are
exposed (e.g. how do you delete a queue?).

The major QPID concepts seem to be:

   - Defining the concept of a flexible schema structure
   - Querying object information
   - Setting up monitoring
   - Calling object methods
   - Defining the communication protocol

It suddenly struck me as I was writing this that there is already a very
well defined standard that does all this, which is SNMP. Since SNMP is a
widely-used standard, and Erlang supports it, and SNMP v3 has security
features built in, and SNMP allows one to monitor, configure and control any
arbitrary object, shouldn't we consider adding an SNMP agent to RabbitMQ,
and using SNMP for all these tasks?

The huge advantage of this is that it makes a RabbitMQ node automatically
become part of any SNMP management infrastructure. There are many existing
SNMP Management tools, and a lot of information and books on SNMP. Another
huge advantage is it would not be reinventing the wheel. The disadvantage is
that it is orthogonal to AMQP, but maybe that's not such a bad thing.

The task then becomes mostly one of defining appropriate MIBs that can
describe, monitor and control an AMQP infrastructure.

Thoughts? Am I missing something?

Regards,
Edwin Fine
On Thu, Jul 17, 2008 at 9:27 AM, John Watson <JWatson at sis.tv> wrote:

>  When this was discussed earlier on the rabbit forum:-
> http://www.trapexit.org/forum/viewtopic.php?p=37702 I thought that one of
> the most interesting responses described the approach taken by QPID:
> http://cwiki.apache.org/qpid/management-design-notes.html .
>
>
>
> Cheers
>
> John Watson
>
> **********************************************************************
>
> Satellite Information Services Limited Registered Office:
>
> 17 Corsham Street London N1 6DR, Company No. 4243307
>
>
>
> The information in this e-mail (which includes any files
>
> transmitted with it) is confidential and is intended for the
>
> addressee only. Unauthorised recipients are required to
>
> maintain confidentiality. If you have received this e-mail
>
> in error please notify the sender immediately, destroy any
>
> copies and delete it from your computer system.
>
> **********************************************************************
>
>
>



-- 
The great enemy of the truth is very often not the lie -- deliberate,
contrived and dishonest, but the myth, persistent, persuasive, and
unrealistic. Belief in myths allows the comfort of opinion without the
discomfort of thought.
John F. Kennedy 35th president of US 1961-1963 (1917 - 1963)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080717/b20970eb/attachment.htm 

From rabbitmq at tmm1.net  Fri Jul 18 02:57:43 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Thu, 17 Jul 2008 18:57:43 -0700
Subject: [rabbitmq-discuss] AMQP ruby client
In-Reply-To: <e1c05edd0807120245i1993333bs25d834d45aa5d52e@mail.gmail.com>
References: <e1c05edd0807120245i1993333bs25d834d45aa5d52e@mail.gmail.com>
Message-ID: <e1c05edd0807171857q17f4dd88hd8bf6c88c815394a@mail.gmail.com>

I've just finished a simple high level api, and committed several examples
showing off direct, topic, fanout and rpc style messaging over rabbitmq:
  http://github.com/tmm1/amqp/tree/master/examples/pingpong.rb
  http://github.com/tmm1/amqp/tree/master/examples/clock.rb
  http://github.com/tmm1/amqp/tree/master/examples/stocks.rb
  http://github.com/tmm1/amqp/tree/master/examples/hashtable.rb

The API revolves around an MQ object, which corresponds 1:1 with an AMQP
channel. An AMQP connection is created automatically by the MQ class (on
demand), so you don't have to worry about connection, channel or sessions.
In the simplest case, MQ objects allow publishing to exchanges and reading
from queues:

  amq = MQ.new

  amq.queue('queue_name').subscribe{ |msg|
    puts "i got a message: #{msg}"   # msg == "hello world"
  end

  amq.direct.publish('hello world', :key => 'queue_name')

  Aman Gupta

On Sat, Jul 12, 2008 at 2:45 AM, Aman Gupta <rabbitmq at tmm1.net> wrote:

> I've been working on a Ruby/EventMachine AMQP client over the past few days
> and I have a simple client up and running:
>
>     def receive_data data
>       Frame.extract(data).each do |frame|
>         # log 'got a frame', frame
>
>         case method = frame.payload
>         when Protocol::Connection::Start
>           send Protocol::Connection::StartOk.new({:platform =>
> 'Ruby/EventMachine',
>                                                   :product => 'AMQP',
>                                                   :information => '
> http://github.com/tmm1/amqp',
>                                                   :version => '0.0.1'},
>                                                  'AMQPLAIN',
>                                                  {:LOGIN => 'guest',
>                                                   :PASSWORD => 'guest'},
>                                                  'en_US')
>
>         when Protocol::Connection::Tune
>           send Protocol::Connection::TuneOk.new :channel_max => 0,
>                                                 :frame_max => 131072,
>                                                 :heartbeat => 0
>
>           send Protocol::Connection::Open.new :virtual_host => '/',
>                                               :capabilities => '',
>                                               :insist => false
>
>         when Protocol::Connection::OpenOk
>           send Protocol::Channel::Open.new, :channel => 1
>         end
>       end
>     end
>
> Feedback and ideas for a higher-level queue/exchange/binding API are
> welcome.
>
>   Aman Gupta
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080717/39e40a5f/attachment.htm 

From alexis.richardson at cohesiveft.com  Fri Jul 18 09:24:09 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 18 Jul 2008 09:24:09 +0100
Subject: [rabbitmq-discuss] AMQP ruby client
In-Reply-To: <e1c05edd0807171857q17f4dd88hd8bf6c88c815394a@mail.gmail.com>
References: <e1c05edd0807120245i1993333bs25d834d45aa5d52e@mail.gmail.com>
	<e1c05edd0807171857q17f4dd88hd8bf6c88c815394a@mail.gmail.com>
Message-ID: <167204d20807180124i15b16c64j7e3293657188686f@mail.gmail.com>

Aman

Congrats on your Ruby API for RabbitMQ :-)

On Fri, Jul 18, 2008 at 2:57 AM, Aman Gupta <rabbitmq at tmm1.net> wrote:
> I've just finished a simple high level api, and committed several examples
> showing off direct, topic, fanout and rpc style messaging over rabbitmq:
>   http://github.com/tmm1/amqp/tree/master/examples/pingpong.rb
>   http://github.com/tmm1/amqp/tree/master/examples/clock.rb
>   http://github.com/tmm1/amqp/tree/master/examples/stocks.rb
>   http://github.com/tmm1/amqp/tree/master/examples/hashtable.rb

Thanks so much for this, those examples are really useful.


> The API revolves around an MQ object, which corresponds 1:1 with an AMQP
> channel. An AMQP connection is created automatically by the MQ class (on
> demand), so you don't have to worry about connection, channel or sessions.
> In the simplest case, MQ objects allow publishing to exchanges and reading
> from queues:
>   amq = MQ.new
>   amq.queue('queue_name').subscribe{ |msg|
>     puts "i got a message: #{msg}"   # msg == "hello world"
>   end
>   amq.direct.publish('hello world', :key => 'queue_name')

Cool.  This a great base API.

So .. I guess what we are finding when talking about RabbitMQ with
folks from the Ruby and RoR community is that there are quite a few
different approaches to messaging.  In fact many people find messaging
to be unfamiliar and in need of explanation and use cases.

For example: http://nubyonrails.com/articles/about-this-blog-beanstalk-messaging-queue

For some people, a cache / hashtable type approach, where everything
looks like a 'get' or a 'set' feels intuitive.  Others like
ActiveMessaging.  Do you have a view on whether higher level APIs, eg
defaulting to a subset of all behaviours, would be of interest to
people?

And - generally - what do folks on the list think?

Cheers,

alexis








>   Aman Gupta
>
> On Sat, Jul 12, 2008 at 2:45 AM, Aman Gupta <rabbitmq at tmm1.net> wrote:
>>
>> I've been working on a Ruby/EventMachine AMQP client over the past few
>> days and I have a simple client up and running:
>>
>>     def receive_data data
>>       Frame.extract(data).each do |frame|
>>         # log 'got a frame', frame
>>
>>         case method = frame.payload
>>         when Protocol::Connection::Start
>>           send Protocol::Connection::StartOk.new({:platform =>
>> 'Ruby/EventMachine',
>>                                                   :product => 'AMQP',
>>                                                   :information =>
>> 'http://github.com/tmm1/amqp',
>>                                                   :version => '0.0.1'},
>>                                                  'AMQPLAIN',
>>                                                  {:LOGIN => 'guest',
>>                                                   :PASSWORD => 'guest'},
>>                                                  'en_US')
>>         when Protocol::Connection::Tune
>>           send Protocol::Connection::TuneOk.new :channel_max => 0,
>>                                                 :frame_max => 131072,
>>                                                 :heartbeat => 0
>>           send Protocol::Connection::Open.new :virtual_host => '/',
>>                                               :capabilities => '',
>>                                               :insist => false
>>         when Protocol::Connection::OpenOk
>>           send Protocol::Channel::Open.new, :channel => 1
>>         end
>>       end
>>     end
>> Feedback and ideas for a higher-level queue/exchange/binding API are
>> welcome.
>>   Aman Gupta
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at cohesiveft.com  Fri Jul 18 09:52:44 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 18 Jul 2008 09:52:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <6c2563b20807170851s74830b03q6a44eef45ef1b30@mail.gmail.com>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com>
	<6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>
	<85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>
	<6c2563b20807170851s74830b03q6a44eef45ef1b30@mail.gmail.com>
Message-ID: <167204d20807180152p1fe0ad4bs90c1cffa59239960@mail.gmail.com>

Edwin

I am going to topline this.  Apologies.

First of all, I agree with John that a general schema based approach
has genuine appeal, for example it can be applied to use AMQP as a
proxy service to manage other classes of objects via queues.  That's
quite cool, and makes AMQP more useful in the general context of
management and monitoring which is in itself an important use case.

Second, when discussing 'management' in the AMQP Working Group, we
found that management of an AMQP broker or cluster is context
dependent.  It means different things to different people.  For
network operations and administration folks, it means a set of
standard packet sniffing tools and management protocols.  For
application developers, it means platform integration eg JMX.  And
this is just if you assume that people will manage AMQP brokers as
they manage other servers.  But this assumption is not true - new
modes of management may be required, for example to propagate change
transactionally.

In such a case-based setting my preference would be to go with a
bottom-up approach based on Things That Already Work And Which We Use.
 Making use of the rich tooling and management capability provided by
erlang/OTP is a really good thing to do, and SNMP is completely
essentially to many people.  So I am all in favour of the sort of
approach Edwin has taken, and that he now proposes.

What do other people think?

alexis



On Thu, Jul 17, 2008 at 4:51 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> John,
>
> Thanks for the reference to the earlier discussion. I missed that one. I am
> also influenced to some degree by what MQ did for its admin control.
>
> I'd like to contrast my approach with the QPID one.
>
> My approach was extremely pragmatic and bottom-up. It did not try to solve
> all the problems and create a grand design. The QPID approach is at the
> opposite end of the spectrum. Both approaches have merits and shortcomings.
> Mine is very limited and short-sighted, but has the advantage of being very
> easy to understand, and immediately available to play with and get a feel
> for what is wanted and needed. The QPID approach would take a great deal
> more work, and testing, just to get something usable on RabbitMQ. This
> impedes progress. I have always been a proponent of eliciting realistic
> requirements by prototyping (as long as the prototype does not suddenly
> become the production version, which is always a danger). It grounds us in
> practicalities right from the start. Once we see what actually works, we do
> another iteration to expand the design to become more generic. Another
> disadvantage is that we may not think of a very important feature until late
> in the game, and have to change the entire architecture. That's why it's
> best to get high-level requirements up front, in a timeboxed fashion to
> prevent analysis paralysis, and then try the various features out for
> real-world usability, and iterate until cooked.
>
> QPID's approach is interesting in that it uses the AMQP protocol itself as
> the communication mechanism. I quite like this idea from the point of view
> that every AMQP language binding will be able to use it. On the other hand,
> it's a bit clumsy and heavyweight in that you have to set up one or more
> private queues just to talk the the management broker, and as far as I can
> see, it's very generic, so I am uncertain of exactly what capabilities are
> exposed (e.g. how do you delete a queue?).
>
> The major QPID concepts seem to be:
>
> Defining the concept of a flexible schema structure
> Querying object information
> Setting up monitoring
> Calling object methods
> Defining the communication protocol
>
> It suddenly struck me as I was writing this that there is already a very
> well defined standard that does all this, which is SNMP. Since SNMP is a
> widely-used standard, and Erlang supports it, and SNMP v3 has security
> features built in, and SNMP allows one to monitor, configure and control any
> arbitrary object, shouldn't we consider adding an SNMP agent to RabbitMQ,
> and using SNMP for all these tasks?
>
> The huge advantage of this is that it makes a RabbitMQ node automatically
> become part of any SNMP management infrastructure. There are many existing
> SNMP Management tools, and a lot of information and books on SNMP. Another
> huge advantage is it would not be reinventing the wheel. The disadvantage is
> that it is orthogonal to AMQP, but maybe that's not such a bad thing.
>
> The task then becomes mostly one of defining appropriate MIBs that can
> describe, monitor and control an AMQP infrastructure.
>
> Thoughts? Am I missing something?
>
> Regards,
> Edwin Fine
> On Thu, Jul 17, 2008 at 9:27 AM, John Watson <JWatson at sis.tv> wrote:
>>
>> When this was discussed earlier on the rabbit forum:-
>> http://www.trapexit.org/forum/viewtopic.php?p=37702 I thought that one of
>> the most interesting responses described the approach taken by QPID:
>> http://cwiki.apache.org/qpid/management-design-notes.html .
>>
>>
>>
>> Cheers
>>
>> John Watson
>>
>> **********************************************************************
>>
>> Satellite Information Services Limited Registered Office:
>>
>> 17 Corsham Street London N1 6DR, Company No. 4243307
>>
>>
>>
>> The information in this e-mail (which includes any files
>>
>> transmitted with it) is confidential and is intended for the
>>
>> addressee only. Unauthorised recipients are required to
>>
>> maintain confidentiality. If you have received this e-mail
>>
>> in error please notify the sender immediately, destroy any
>>
>> copies and delete it from your computer system.
>>
>> **********************************************************************
>>
>>
>
>
> --
> The great enemy of the truth is very often not the lie -- deliberate,
> contrived and dishonest, but the myth, persistent, persuasive, and
> unrealistic. Belief in myths allows the comfort of opinion without the
> discomfort of thought.
> John F. Kennedy 35th president of US 1961-1963 (1917 - 1963)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at cohesiveft.com  Fri Jul 18 10:09:49 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 18 Jul 2008 10:09:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <167204d20807180152p1fe0ad4bs90c1cffa59239960@mail.gmail.com>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com>
	<6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>
	<85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>
	<6c2563b20807170851s74830b03q6a44eef45ef1b30@mail.gmail.com>
	<167204d20807180152p1fe0ad4bs90c1cffa59239960@mail.gmail.com>
Message-ID: <167204d20807180209l5730d353t5fb4df963590e02c@mail.gmail.com>

I forgot to mention that for those who wish to follow the working
group discussions, the JIRA is 233 at jira.amqp.org.

alexis


On Fri, Jul 18, 2008 at 9:52 AM, Alexis Richardson
<alexis.richardson at cohesiveft.com> wrote:
> Edwin
>
> I am going to topline this.  Apologies.
>
> First of all, I agree with John that a general schema based approach
> has genuine appeal, for example it can be applied to use AMQP as a
> proxy service to manage other classes of objects via queues.  That's
> quite cool, and makes AMQP more useful in the general context of
> management and monitoring which is in itself an important use case.
>
> Second, when discussing 'management' in the AMQP Working Group, we
> found that management of an AMQP broker or cluster is context
> dependent.  It means different things to different people.  For
> network operations and administration folks, it means a set of
> standard packet sniffing tools and management protocols.  For
> application developers, it means platform integration eg JMX.  And
> this is just if you assume that people will manage AMQP brokers as
> they manage other servers.  But this assumption is not true - new
> modes of management may be required, for example to propagate change
> transactionally.
>
> In such a case-based setting my preference would be to go with a
> bottom-up approach based on Things That Already Work And Which We Use.
>  Making use of the rich tooling and management capability provided by
> erlang/OTP is a really good thing to do, and SNMP is completely
> essentially to many people.  So I am all in favour of the sort of
> approach Edwin has taken, and that he now proposes.
>
> What do other people think?
>
> alexis
>
>
>
> On Thu, Jul 17, 2008 at 4:51 PM, Edwin Fine
> <rabbitmq-discuss_efine at usa.net> wrote:
>> John,
>>
>> Thanks for the reference to the earlier discussion. I missed that one. I am
>> also influenced to some degree by what MQ did for its admin control.
>>
>> I'd like to contrast my approach with the QPID one.
>>
>> My approach was extremely pragmatic and bottom-up. It did not try to solve
>> all the problems and create a grand design. The QPID approach is at the
>> opposite end of the spectrum. Both approaches have merits and shortcomings.
>> Mine is very limited and short-sighted, but has the advantage of being very
>> easy to understand, and immediately available to play with and get a feel
>> for what is wanted and needed. The QPID approach would take a great deal
>> more work, and testing, just to get something usable on RabbitMQ. This
>> impedes progress. I have always been a proponent of eliciting realistic
>> requirements by prototyping (as long as the prototype does not suddenly
>> become the production version, which is always a danger). It grounds us in
>> practicalities right from the start. Once we see what actually works, we do
>> another iteration to expand the design to become more generic. Another
>> disadvantage is that we may not think of a very important feature until late
>> in the game, and have to change the entire architecture. That's why it's
>> best to get high-level requirements up front, in a timeboxed fashion to
>> prevent analysis paralysis, and then try the various features out for
>> real-world usability, and iterate until cooked.
>>
>> QPID's approach is interesting in that it uses the AMQP protocol itself as
>> the communication mechanism. I quite like this idea from the point of view
>> that every AMQP language binding will be able to use it. On the other hand,
>> it's a bit clumsy and heavyweight in that you have to set up one or more
>> private queues just to talk the the management broker, and as far as I can
>> see, it's very generic, so I am uncertain of exactly what capabilities are
>> exposed (e.g. how do you delete a queue?).
>>
>> The major QPID concepts seem to be:
>>
>> Defining the concept of a flexible schema structure
>> Querying object information
>> Setting up monitoring
>> Calling object methods
>> Defining the communication protocol
>>
>> It suddenly struck me as I was writing this that there is already a very
>> well defined standard that does all this, which is SNMP. Since SNMP is a
>> widely-used standard, and Erlang supports it, and SNMP v3 has security
>> features built in, and SNMP allows one to monitor, configure and control any
>> arbitrary object, shouldn't we consider adding an SNMP agent to RabbitMQ,
>> and using SNMP for all these tasks?
>>
>> The huge advantage of this is that it makes a RabbitMQ node automatically
>> become part of any SNMP management infrastructure. There are many existing
>> SNMP Management tools, and a lot of information and books on SNMP. Another
>> huge advantage is it would not be reinventing the wheel. The disadvantage is
>> that it is orthogonal to AMQP, but maybe that's not such a bad thing.
>>
>> The task then becomes mostly one of defining appropriate MIBs that can
>> describe, monitor and control an AMQP infrastructure.
>>
>> Thoughts? Am I missing something?
>>
>> Regards,
>> Edwin Fine
>> On Thu, Jul 17, 2008 at 9:27 AM, John Watson <JWatson at sis.tv> wrote:
>>>
>>> When this was discussed earlier on the rabbit forum:-
>>> http://www.trapexit.org/forum/viewtopic.php?p=37702 I thought that one of
>>> the most interesting responses described the approach taken by QPID:
>>> http://cwiki.apache.org/qpid/management-design-notes.html .
>>>
>>>
>>>
>>> Cheers
>>>
>>> John Watson
>>>
>>> **********************************************************************
>>>
>>> Satellite Information Services Limited Registered Office:
>>>
>>> 17 Corsham Street London N1 6DR, Company No. 4243307
>>>
>>>
>>>
>>> The information in this e-mail (which includes any files
>>>
>>> transmitted with it) is confidential and is intended for the
>>>
>>> addressee only. Unauthorised recipients are required to
>>>
>>> maintain confidentiality. If you have received this e-mail
>>>
>>> in error please notify the sender immediately, destroy any
>>>
>>> copies and delete it from your computer system.
>>>
>>> **********************************************************************
>>>
>>>
>>
>>
>> --
>> The great enemy of the truth is very often not the lie -- deliberate,
>> contrived and dishonest, but the myth, persistent, persuasive, and
>> unrealistic. Belief in myths allows the comfort of opinion without the
>> discomfort of thought.
>> John F. Kennedy 35th president of US 1961-1963 (1917 - 1963)
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>



From JWatson at sis.tv  Fri Jul 18 10:11:18 2008
From: JWatson at sis.tv (John Watson)
Date: Fri, 18 Jul 2008 10:11:18 +0100
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <167204d20807180152p1fe0ad4bs90c1cffa59239960@mail.gmail.com>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com> 
	<6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com> 
	<85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv> 
	<6c2563b20807170851s74830b03q6a44eef45ef1b30@mail.gmail.com> 
	<167204d20807180152p1fe0ad4bs90c1cffa59239960@mail.gmail.com>
Message-ID: <85FA03E6BB6F0340B5A117013571A9B7FD7899@exchange3.ad.sis.tv>

Hi, Alexis,

What I really need is something akin to MQSC -
http://publib.boulder.ibm.com/infocenter/wmqv6/v6r0/index.jsp?topic=/com
.ibm.mq.csqzaj.doc/sc10340_.htm .  My main Use Case is to be able
(eventually) to configure a network of autonomous rabbit nodes with
appropriate objects using some sort of scripting language, and to be
able to automatically generate, deploy and execute the scripts. I am not
going to make much use of dynamic changes - most of the networks I set
up have a reasonably static topology with the main change being the
setting up of new customers with appropriate content-based-routing
rules.

I tend to use SNMP just for monitoring a running network.

John

-----Original Message-----
From: alexis.richardson at gmail.com [mailto:alexis.richardson at gmail.com]
On Behalf Of Alexis Richardson
Sent: 18 July 2008 09:53
To: Edwin Fine
Cc: John Watson; rabbitmq
Subject: Re: [rabbitmq-discuss] RabbitMQ Administration API

Edwin

I am going to topline this.  Apologies.

First of all, I agree with John that a general schema based approach
has genuine appeal, for example it can be applied to use AMQP as a
proxy service to manage other classes of objects via queues.  That's
quite cool, and makes AMQP more useful in the general context of
management and monitoring which is in itself an important use case.

Second, when discussing 'management' in the AMQP Working Group, we
found that management of an AMQP broker or cluster is context
dependent.  It means different things to different people.  For
network operations and administration folks, it means a set of
standard packet sniffing tools and management protocols.  For
application developers, it means platform integration eg JMX.  And
this is just if you assume that people will manage AMQP brokers as
they manage other servers.  But this assumption is not true - new
modes of management may be required, for example to propagate change
transactionally.

In such a case-based setting my preference would be to go with a
bottom-up approach based on Things That Already Work And Which We Use.
 Making use of the rich tooling and management capability provided by
erlang/OTP is a really good thing to do, and SNMP is completely
essentially to many people.  So I am all in favour of the sort of
approach Edwin has taken, and that he now proposes.

What do other people think?

alexis


**********************************************************************
Satellite Information Services Limited Registered Office:
17 Corsham Street London N1 6DR, Company No. 4243307

The information in this e-mail (which includes any files
transmitted with it) is confidential and is intended for the
addressee only. Unauthorised recipients are required to
maintain confidentiality. If you have received this e-mail
in error please notify the sender immediately, destroy any
copies and delete it from your computer system. 
**********************************************************************




From tonyg at lshift.net  Fri Jul 18 10:40:35 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 18 Jul 2008 10:40:35 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <OFB3F8B1E9.4B920DB4-ON80257489.004E87FF-80257489.0051AD17@Edftrading.com>
References: <OFB3F8B1E9.4B920DB4-ON80257489.004E87FF-80257489.0051AD17@Edftrading.com>
Message-ID: <48806513.6010601@lshift.net>

David.Corcoran at edftrading.com wrote:
> One thing I'm slightly wary of is that the memory spiked when I connected
> 250 clients to it. And when I disconnected them it didn't shrink very much.

I'm on a training course today, so may not be able to answer with very 
low latency :-) but here's a quick thing to examine: if you have a shell 
into the rabbitmq VM, you could examine how many processes are still 
around, to see if there are any orphans. For instance, you could type 
"i()." into the shell:

Eshell V5.6.2  (abort with ^G)
1> i().
Pid                   Initial Call                          Heap 
Reds Msgs
Registered            Current Function                     Stack 

<0.0.0>               otp_ring0:start/2                      610 
2532    0
init                  init:loop/1                              2 

<0.2.0>               erlang:apply/2                        2584 
63255    0
erl_prim_loader       erl_prim_loader:loop/3                   5 


[much more output snipped]



Tony




From mietek at erlang-consulting.com  Fri Jul 18 15:47:41 2008
From: mietek at erlang-consulting.com (=?UTF-8?Q?Mietek_B=C4=85k?=)
Date: Fri, 18 Jul 2008 15:47:41 +0100
Subject: [rabbitmq-discuss] Roadmap to 0-10?
Message-ID: <6CD002A6-0911-42AA-A8BF-01C5AC93BF3D@erlang-consulting.com>

Hello,

I'm interested in utilizing certain AMQP 0-10 features, such as  
detaching/re-attaching from/to sessions.  Is the timeframe known for a  
RabbitMQ release (server, Java/Erlang clients) supporting this  
functionality?

Thanks,


-- 
Mietek B?k
Erlang Training & Consulting
http://www.erlang-consulting.com




From alexis.richardson at cohesiveft.com  Fri Jul 18 16:08:35 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 18 Jul 2008 16:08:35 +0100
Subject: [rabbitmq-discuss] Roadmap to 0-10?
In-Reply-To: <6CD002A6-0911-42AA-A8BF-01C5AC93BF3D@erlang-consulting.com>
References: <6CD002A6-0911-42AA-A8BF-01C5AC93BF3D@erlang-consulting.com>
Message-ID: <167204d20807180808l5690ae08uaed8b6f08a7eeb7d@mail.gmail.com>

Mietek

Which features from AMQP 0-10 make it into AMQP 1.0 is still under
discussion within the Working Group.  The features you list are
extremely likely to be there in some form but possibly not with the
exact 0-10 semantics.  Accordingly we have no fixed timeframe for
these roadmap features.  Please can you describe to what use you would
like to put them?

alexis

On Fri, Jul 18, 2008 at 3:47 PM, Mietek B?k
<mietek at erlang-consulting.com> wrote:
> Hello,
>
> I'm interested in utilizing certain AMQP 0-10 features, such as
> detaching/re-attaching from/to sessions.  Is the timeframe known for a
> RabbitMQ release (server, Java/Erlang clients) supporting this
> functionality?
>
> Thanks,
>
>
> --
> Mietek B?k
> Erlang Training & Consulting
> http://www.erlang-consulting.com
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From rabbitmq at tmm1.net  Fri Jul 18 21:32:14 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Fri, 18 Jul 2008 13:32:14 -0700
Subject: [rabbitmq-discuss] AMQP ruby client
In-Reply-To: <b546d9930807180345q2e60951fq46e4682ec90e24fe@mail.gmail.com>
References: <e1c05edd0807120245i1993333bs25d834d45aa5d52e@mail.gmail.com>
	<e1c05edd0807171857q17f4dd88hd8bf6c88c815394a@mail.gmail.com>
	<167204d20807180124i15b16c64j7e3293657188686f@mail.gmail.com>
	<b546d9930807180345q2e60951fq46e4682ec90e24fe@mail.gmail.com>
Message-ID: <e1c05edd0807181332j488c3f8aga0474e25ebc62f72@mail.gmail.com>

I plan on adding #peek and #pop to the queues, in addition to the #subscribe
already in there. However, like subscribe, these will be asynchronous,
requiring a block to process the return value:
  amq.queue('test').peek{ |value|
    # value is is still in the queue
  }

  amq.queue('test').pop{ |value|
    # value no longer in the queue
  }

I have a few other things on my todo list, the most important of which are
apis to remove bindings/queues and to ack/reject messages.

  Aman

On Fri, Jul 18, 2008 at 3:45 AM, Jonathan Conway <jonathan at jaikoo.com>
wrote:

> Fantastic stuff! I can't wait to start using this:)
> With regards to Alexis's question, everyone loves the simplest solution
> which is how things should be. I only think the get/set style became popular
> as it gave familiarity to an existing API which in this case was memcache
> and not because of it's technical merits, though I could be wrong.
>
> But personally I think the pub/sub model is better and dare I use the word
> more 'scalable' (I know it's a badly used word these days). Having an API
> that just exposes this and not other behaviors would be the simplest and
> best way forward in my lowly opinion. One true path:).
>
> Cheers
>
> Jonathan
>
> --
> http://www.jaikoo.com
>
>
> On Fri, Jul 18, 2008 at 9:24 AM, Alexis Richardson <
> alexis.richardson at cohesiveft.com> wrote:
>
>> Aman
>>
>> Congrats on your Ruby API for RabbitMQ :-)
>>
>> On Fri, Jul 18, 2008 at 2:57 AM, Aman Gupta <rabbitmq at tmm1.net> wrote:
>> > I've just finished a simple high level api, and committed several
>> examples
>> > showing off direct, topic, fanout and rpc style messaging over rabbitmq:
>> >   http://github.com/tmm1/amqp/tree/master/examples/pingpong.rb
>> >   http://github.com/tmm1/amqp/tree/master/examples/clock.rb
>> >   http://github.com/tmm1/amqp/tree/master/examples/stocks.rb
>> >   http://github.com/tmm1/amqp/tree/master/examples/hashtable.rb
>>
>> Thanks so much for this, those examples are really useful.
>>
>>
>> > The API revolves around an MQ object, which corresponds 1:1 with an AMQP
>> > channel. An AMQP connection is created automatically by the MQ class (on
>> > demand), so you don't have to worry about connection, channel or
>> sessions.
>> > In the simplest case, MQ objects allow publishing to exchanges and
>> reading
>> > from queues:
>> >   amq = MQ.new
>> >   amq.queue('queue_name').subscribe{ |msg|
>> >     puts "i got a message: #{msg}"   # msg == "hello world"
>> >   end
>> >   amq.direct.publish('hello world', :key => 'queue_name')
>>
>> Cool.  This a great base API.
>>
>> So .. I guess what we are finding when talking about RabbitMQ with
>> folks from the Ruby and RoR community is that there are quite a few
>> different approaches to messaging.  In fact many people find messaging
>> to be unfamiliar and in need of explanation and use cases.
>>
>> For example:
>> http://nubyonrails.com/articles/about-this-blog-beanstalk-messaging-queue
>>
>> For some people, a cache / hashtable type approach, where everything
>> looks like a 'get' or a 'set' feels intuitive.  Others like
>> ActiveMessaging.  Do you have a view on whether higher level APIs, eg
>> defaulting to a subset of all behaviours, would be of interest to
>> people?
>>
>> And - generally - what do folks on the list think?
>>
>> Cheers,
>>
>> alexis
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080718/75dadd00/attachment.htm 

From 0x6e6562 at gmail.com  Sun Jul 20 23:52:23 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 20 Jul 2008 23:52:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <47B07EBF-CBE0-4BB7-9CF7-5EEF958B3473@gmail.com>
References: <47B07EBF-CBE0-4BB7-9CF7-5EEF958B3473@gmail.com>
Message-ID: <269388e30807201552g8dee761yd7431e10ade75154@mail.gmail.com>

Joern,

On Sun, Jul 20, 2008 at 6:41 PM, Joern Barthel <joern.barthel at gmail.com> wrote:
> as I wrote earlier I made some progress with a Spring integration of
> RabbitMQ. Is there someone on your side to coordinate a release of
> documentation / code and/or examples suitable for public consumption?

Yes, you can always send examples and documentation via the list.

With regard to public documentation, we are currently going through
the process of changing our website to have a community authored
section in some kind of wiki-esque fashion, but we haven't made a
decision about which way to go yet. As with the much needed discussion
thread about management that Edwin started, we need a place for the
community to author content in a simple and cohesive fashion.

On that note, does anybody in the community have any ideas about how
they would like to see this happen? Any particular tools?

> There
> are quite possible obvious AQMP usage patterns that could be put into
> Templates which still elude me.

Are you asking about what kind of typical patterns one would like to
have from a high level client's perspective?

BTW, do you have any source that we can look at?

Thx,

Ben



From 0x6e6562 at gmail.com  Mon Jul 21 00:11:47 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 21 Jul 2008 00:11:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ Administration API
In-Reply-To: <85FA03E6BB6F0340B5A117013571A9B7FD7899@exchange3.ad.sis.tv>
References: <6c2563b20807161524h53cf53delbde34cecde8b2bfb@mail.gmail.com>
	<6c2563b20807161528y7ca5a50dob0fd2b06945d0403@mail.gmail.com>
	<85FA03E6BB6F0340B5A117013571A9B7FD788C@exchange3.ad.sis.tv>
	<6c2563b20807170851s74830b03q6a44eef45ef1b30@mail.gmail.com>
	<167204d20807180152p1fe0ad4bs90c1cffa59239960@mail.gmail.com>
	<85FA03E6BB6F0340B5A117013571A9B7FD7899@exchange3.ad.sis.tv>
Message-ID: <269388e30807201611pd249d41ybb342fbfe3478cc0@mail.gmail.com>

Edwin, John, et al,

Just so that you know that the management discussion is quite
important and we're thankful for your input to date, I'd like to refer
to a page that we've got on our dev wiki:
https://dev.rabbitmq.com/wiki/ManagementAndMonitoring

We'd like to capture the current state of thinking in one ledgible
place, rather than having things *forgotten* in old threads on the
list.

It is authorable if you sign up for an account as well.

Please bear in mind that we're also currently looking at changing our
web site to be (amonst other things) a place of collaberation for the
community.

If anybody has any ideas about they would like to see this kind of
thing occur, please start a new thread on the list.

HTH,

Ben



From David.Corcoran at edftrading.com  Mon Jul 21 10:51:32 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Mon, 21 Jul 2008 10:51:32 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <48806513.6010601@lshift.net>
Message-ID: <OF44AE14E8.51B09019-ON8025748D.0034ECC1-8025748D.00362868@Edftrading.com>



Tony Garnock-Jones <tonyg at lshift.net> wrote on 18/07/2008 10:40:35:

> David.Corcoran at edftrading.com wrote:
> For instance, you could type
> "i()." into the shell:

Hi Tony,

I hope you had a good weekend. I did what you suggested on Friday and have
attached the output. RabbitMQ is still running but is now at about 1.5GB
and one thing I forgot to mention is that it's constantly using about 10%
CPU. However it doesn't feel slow which is pretty impressive.

The output is huge so I'm not sure how helpful it will be to you apart from
to say it probably shouldn't be 13,000 lines ;)

Thanks,

Dave


(See attached file: rabbitmq_output.zip)

*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq_output.zip
Type: application/zip
Size: 45981 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080721/cc5c833b/attachment.zip 

From 0x6e6562 at gmail.com  Tue Jul 22 14:30:04 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 22 Jul 2008 14:30:04 +0100
Subject: [rabbitmq-discuss] Error with cast
Message-ID: <269388e30807220630y1c1af23bif65cb86a96ae5625@mail.gmail.com>

Mietek,

I'm responding to you via email because we both seem to be on IRC at
totally different times.

[{function_clause,
[{amqp_channel,call,
[<0.59.0>,
{'basic.publish',101,<<>>,<<"wire.request">>,
true,true},
{content,60,
{'P_basic',<<"application/octet-stream">>,
undefined,undefined,1,0,undefined,undefined,
undefined,undefined,undefined,undefined,
undefined,undefined,undefined},
none,
[<<"payload">>]}]}

This means that you trying to call amqp_channel:call/3 and not
amqp_channel:cast/3.

amqp_channel:call/3 is not defined for the pattern that you are using,
hence why it causes a function_clause error.

HTH,

Ben



From 0x6e6562 at gmail.com  Tue Jul 22 21:15:23 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 22 Jul 2008 21:15:23 +0100
Subject: [rabbitmq-discuss] Article about the new Ruby library
Message-ID: <269388e30807221315mf7f77hdf25834afdc7fb4f@mail.gmail.com>

Hi all,

For any interested in Aman's Ruby client, I've written a brief article
about it: http://hopper.squarespace.com/blog/2008/7/22/simple-amqp-library-for-ruby.html

HTH,

Ben



From matt at halomonitoring.com  Tue Jul 22 21:25:07 2008
From: matt at halomonitoring.com (Matt Smith)
Date: Tue, 22 Jul 2008 15:25:07 -0500
Subject: [rabbitmq-discuss] Scheduling
Message-ID: <d7d41ac30807221325ic2bc76fsd8ece44b1c555150@mail.gmail.com>

Is there a way to do scheduling in RabbitMQ?  What we need is a way to send
a message at a certain time of day.  We were wondering if this functionality
existed in RabbitMQ or if we needed to use an external scheduler?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080722/c17922e1/attachment.htm 

From 0x6e6562 at gmail.com  Tue Jul 22 21:28:47 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 22 Jul 2008 21:28:47 +0100
Subject: [rabbitmq-discuss] Scheduling
In-Reply-To: <d7d41ac30807221325ic2bc76fsd8ece44b1c555150@mail.gmail.com>
References: <d7d41ac30807221325ic2bc76fsd8ece44b1c555150@mail.gmail.com>
Message-ID: <269388e30807221328o11c9b427t6e7958093fd54d0f@mail.gmail.com>

Matt,

On Tue, Jul 22, 2008 at 9:25 PM, Matt Smith <matt at halomonitoring.com> wrote:
> Is there a way to do scheduling in RabbitMQ?  What we need is a way to send
> a message at a certain time of day.  We were wondering if this functionality
> existed in RabbitMQ or if we needed to use an external scheduler?

Not OOTB, but you might want to consider these approaches:

http://www.lshift.net/blog/2008/02/08/using-amqp-to-do-cron-like-scheduling

http://github.com/tmm1/amqp/tree/master/examples/clock.rb

HTH,

Ben



From opendev at gmail.com  Wed Jul 23 15:04:37 2008
From: opendev at gmail.com (opendev at gmail.com)
Date: Wed, 23 Jul 2008 16:04:37 +0200
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
Message-ID: <b93bbdbc0807230704k550e5087le3eeb2d38578a5c7@mail.gmail.com>

Hi Ben,

On 21.07.2008, at 00:52, Ben Hood wrote:

On that note, does anybody in the community have any ideas about how
they would like to see this happen? Any particular tools?

I'd apply for a Confluence OpenSource license [1].

Are you asking about what kind of typical patterns one would like to
have from a high level client's perspective?

Yes. Things like a bean which declares an exchange + queue(s) +
consumer(s) etc. Templates like "Consume something from A, do
something with it, reply to A', ack A", transactional semantics etc.
should probably be part of the integration, too.

BTW, do you have any source that we can look at?

Yes but nothing too fancy. I wrote a FactoryBean for Connections
(which is now, perhaps unwisely, called ConnectionFactoryBean with a
ConnectionFactoryBean as property) and for Channels. I also wrote an
example of how to wrap Channel instances with Spring Proxies for e.g.
thread-local behaviour (using ThreadLocalTargetSource) and how to
invert the channel numbering (if this is of relevance) using
Strategies such as simple increment, annotations (via a Proxy &
BeanPostProcessor combo) or e.g. Thread name.

I can send you sources if you want but discussing them in a Wiki might
be a better alternative.

Best regards,

Joern

[1]: http://www.atlassian.com/software/confluence/licensing.jsp#nonprofit



From 0x6e6562 at gmail.com  Wed Jul 23 18:36:46 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 23 Jul 2008 18:36:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <FDBED6E3-4D32-4FDB-BB7D-F155C989B862@gmail.com>
References: <47B07EBF-CBE0-4BB7-9CF7-5EEF958B3473@gmail.com>
	<269388e30807201552g8dee761yd7431e10ade75154@mail.gmail.com>
	<FDBED6E3-4D32-4FDB-BB7D-F155C989B862@gmail.com>
Message-ID: <269388e30807231036w2e5c9964s51f6f16aa440a226@mail.gmail.com>

Hi Joern,

Sorry about the delay in this reponse:

On Mon, Jul 21, 2008 at 11:51 AM, Joern Barthel <joern.barthel at gmail.com> wrote:

>> On that note, does anybody in the community have any ideas about how
>> they would like to see this happen? Any particular tools?
>
> I'd apply for a Confluence OpenSource license [1].

Vote noted. I think ATM with the people that I've spoken with they'd
like to go for a more lightweight solution than Confluence, but the
polling booths have just opened. Any more suggestions, community?

>> Are you asking about what kind of typical patterns one would like to
>> have from a high level client's perspective?
>
> Yes. Things like a bean which declares an exchange + queue(s) + consumer(s)
> etc. Templates like "Consume something from A, do something with it, reply
> to A', ack A", transactional semantics etc. should probably be part of the
> integration, too.

This template already exists (for Java at least) - check out the
RpcServer/RpcClient combination.

>
>> BTW, do you have any source that we can look at?
>
> Yes but nothing too fancy. I wrote a FactoryBean for Connections (which is
> now, perhaps unwisely, called ConnectionFactoryBean with a
> ConnectionFactoryBean as property) and for Channels. I also wrote an example
> of how to wrap Channel instances with Spring Proxies for e.g. thread-local
> behaviour (using ThreadLocalTargetSource) and how to invert the channel
> numbering (if this is of relevance) using Strategies such as simple
> increment, annotations (via a Proxy & BeanPostProcessor combo) or e.g.
> Thread name.

How does the connection factory differ to what's currently available
in the Java library?

>
> I can send you sources if you want but discussing them in a Wiki might be a
> better alternative.

Sure, but until we get a wiki, you might consider putting your code into Github.

HTH,

Ben



From matthias at lshift.net  Wed Jul 23 19:39:04 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 23 Jul 2008 19:39:04 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <OF44AE14E8.51B09019-ON8025748D.0034ECC1-8025748D.00362868@Edftrading.com>
References: <OF44AE14E8.51B09019-ON8025748D.0034ECC1-8025748D.00362868@Edftrading.com>
Message-ID: <48877AC8.3060506@lshift.net>

David,

David.Corcoran at edftrading.com wrote:
> Tony Garnock-Jones <tonyg at lshift.net> wrote on 18/07/2008 10:40:35:
>> For instance, you could type
>> "i()." into the shell:

> The output is huge so I'm not sure how helpful it will be to you apart from
> to say it probably shouldn't be 13,000 lines ;)

There is some useful info in there. For example, you have over 600 
connections. Nothing wrong with that in principle, but is it expected?

Unfortunately the information sheds no light on where the memory has 
gone. A more detailed report might provide some clues. Please run

file:write_file("/tmp/processes.erl", io_lib:format("~p", 
[[process_info(P) || P <- processes()]])).

and mail us the output file. The file may be quite big, so it's probably 
best to just send it to Tony or me rather than the list. Also, you may 
want to scan it for any sensitive information first.

> one thing I forgot to mention is that it's constantly using about 10%
> CPU.

And that happens when there are no messages going through the system?

Part of the time will be spent sending and receiving heartbeat frames on 
your 600+ connections. That should take much less than 10% of the CPU 
though. Still, you may want to increase the heartbeat interval to see 
whether that makes a difference. There are config params/methods in the 
client API for that.


Regards,

Matthias.



From david.cornell at sophos.com  Wed Jul 23 23:38:55 2008
From: david.cornell at sophos.com (David Cornell)
Date: Wed, 23 Jul 2008 15:38:55 -0700
Subject: [rabbitmq-discuss] Stomp gateway incompatible with recent
	builds?
In-Reply-To: <487F0044.1030002@lshift.net>
Message-ID: <62E6E7A1E9E20F4899B4E40EC870917C0133FE62@ca-exchange.activestate.ca>

 

> -----Original Message-----
> From: Tony Garnock-Jones [mailto:tonyg at lshift.net] 
> Sent: Thursday, July 17, 2008 1:18 AM
> To: David Cornell
> Cc: rabbitmq
> Subject: Re: [rabbitmq-discuss] Stomp gateway incompatible 
> with recent builds?
> 
> David Cornell wrote:
> > It worked for me thanks! Is this how additional gateways will be 
> > released going forward or are there plans to have a 
> different plugin 
> > architecture in place at some point?
> 
> The latter. The reason it's awkward right now is that these 
> are the very first few plugins. Any ideas about how it could 
> be improved? Something like ejabberd's mod_* system, with a 
> behaviour(rabbitmq_plugin) or something, perhaps?
> 
> Tony
> 
> 

Sorry for the late reply, busy busy busy..

I realize these are early contributions and they seem to work quite
well. I am not very familiar with ejaberd and I have just recently
started looking at Erlang so I cannot say if the module system they are
using would work well or not. At a high level, the system could allow
plugins/modules to be included in the config file and should not
interfere with the default startup method of RabbitMQ. The config/module
system most people are familiar with appears to be apache which has some
useful syntax like "ifmodule". Borrowing this layout may be a good idea
since the learning curve will be lower for most people.

Dave






From david.cornell at sophos.com  Thu Jul 24 00:38:45 2008
From: david.cornell at sophos.com (David Cornell)
Date: Wed, 23 Jul 2008 16:38:45 -0700
Subject: [rabbitmq-discuss] Perl client?
In-Reply-To: <269388e30807110433r1d461a3ka5bd2fe138728780@mail.gmail.com>
Message-ID: <62E6E7A1E9E20F4899B4E40EC870917C0133FE9E@ca-exchange.activestate.ca>

 

> -----Original Message-----
> From: Ben Hood [mailto:0x6e6562 at gmail.com] 
> Sent: Friday, July 11, 2008 4:34 AM
> To: David Cornell
> Cc: rabbitmq
> Subject: Re: [rabbitmq-discuss] Perl client?
> 
> Dave,
> 
> On Fri, Jul 11, 2008 at 2:36 AM, David Cornell 
> <david.cornell at sophos.com> wrote:
> > I am evaluating RabbitMQ this week. I am wondering if 
> anyone knows if 
> > a Perl client exists or is in development?
> 
> I did gather in some other discussion that a member of the 
> Rabbit community was contemplating writing a Perl client, but 
> I don't know how far they got with that contemplation.
> 
> If you would like, it would not be a hard task to implement 
> one yourself - here is a guide about to build your own client:
> http://hopper.squarespace.com/blog/2008/6/21/build-your-own-am
> qp-client.html
> 
> HTH,
> 
> Ben
> 

Update:

It appears Eric Rybski has proposed a module for inclusion  in the
NET::AMQP namespace. Apparently he is working on a Perl XS wrapper that
will interface with the OpenAMQ WireAPI client library (AMQP/0.9). He is
also contemplating a pure perl implementation.  I'll email him and see
how far along he is or if he needs any help. 

http://www.nntp.perl.org/group/perl.modules/2008/06/msg60950.html



From 0x6e6562 at gmail.com  Thu Jul 24 01:12:54 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 24 Jul 2008 01:12:54 +0100
Subject: [rabbitmq-discuss] Perl client?
In-Reply-To: <62E6E7A1E9E20F4899B4E40EC870917C0133FE9E@ca-exchange.activestate.ca>
References: <269388e30807110433r1d461a3ka5bd2fe138728780@mail.gmail.com>
	<62E6E7A1E9E20F4899B4E40EC870917C0133FE9E@ca-exchange.activestate.ca>
Message-ID: <269388e30807231712l1e9f0ecak476cf02f04601647@mail.gmail.com>

David,

On Thu, Jul 24, 2008 at 12:38 AM, David Cornell
<david.cornell at sophos.com> wrote:
> It appears Eric Rybski has proposed a module for inclusion  in the
> NET::AMQP namespace. Apparently he is working on a Perl XS wrapper that
> will interface with the OpenAMQ WireAPI client library (AMQP/0.9). He is
> also contemplating a pure perl implementation.  I'll email him and see
> how far along he is or if he needs any help.

It would be good if you could contact him. If he needs any help, we're
more than happy to assist.

If he needs some general guidance with 0-8 and/or the upcoming
revision to 0-9, then this is a good place to ask.

HTH,

Ben



From opendev at gmail.com  Thu Jul 24 11:00:12 2008
From: opendev at gmail.com (Joern)
Date: Thu, 24 Jul 2008 12:00:12 +0200
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <269388e30807231036w2e5c9964s51f6f16aa440a226@mail.gmail.com>
References: <47B07EBF-CBE0-4BB7-9CF7-5EEF958B3473@gmail.com>
	<269388e30807201552g8dee761yd7431e10ade75154@mail.gmail.com>
	<FDBED6E3-4D32-4FDB-BB7D-F155C989B862@gmail.com>
	<269388e30807231036w2e5c9964s51f6f16aa440a226@mail.gmail.com>
Message-ID: <9e009ad0807240300v6c5e38bamf9a68f0f4f1cd992@mail.gmail.com>

Hi Ben,

2008/7/23 Ben Hood <0x6e6562 at gmail.com>:

> This template already exists (for Java at least) - check out the
> RpcServer/RpcClient combination.

I'll have a look at it. As a first step I'd omit templates altogether
however. I simply do not understand enough of the possible usage
scenarios with AMQP involved.

> How does the connection factory differ to what's currently available
> in the Java library?

It does not. It's a Connection FactoryBean which makes it easier to
get connections out of a RabbitMQ connection factory.

> Sure, but until we get a wiki, you might consider putting your code into Github.

I did not find Rabbit on Github. Should I put in in my own account?

Best regards,


Joern
--



From holger at wizards.de  Thu Jul 24 11:35:50 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Thu, 24 Jul 2008 12:35:50 +0200
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <9e009ad0807240300v6c5e38bamf9a68f0f4f1cd992@mail.gmail.com>
References: <47B07EBF-CBE0-4BB7-9CF7-5EEF958B3473@gmail.com>	<269388e30807201552g8dee761yd7431e10ade75154@mail.gmail.com>	<FDBED6E3-4D32-4FDB-BB7D-F155C989B862@gmail.com>	<269388e30807231036w2e5c9964s51f6f16aa440a226@mail.gmail.com>
	<9e009ad0807240300v6c5e38bamf9a68f0f4f1cd992@mail.gmail.com>
Message-ID: <48885B06.7040005@wizards.de>

Joern wrote:
>> Sure, but until we get a wiki, you might consider putting your code into Github.
> 
> I did not find Rabbit on Github. Should I put in in my own account?

Hosting it at http://freehg.org/ would probably keep things simple. If you 
are using eclipse then the mercurialEclipse plugin 
(http://www.vectrace.com/mercurialeclipse/) works reasonably well. An 
alternative is merclipse at http://goldenhammers.com/merclipse/.

Holger




From mietek at erlang-consulting.com  Thu Jul 24 12:34:53 2008
From: mietek at erlang-consulting.com (=?UTF-8?Q?Mietek_B=C4=85k?=)
Date: Thu, 24 Jul 2008 12:34:53 +0100
Subject: [rabbitmq-discuss] Error with cast
In-Reply-To: <269388e30807220630y1c1af23bif65cb86a96ae5625@mail.gmail.com>
References: <269388e30807220630y1c1af23bif65cb86a96ae5625@mail.gmail.com>
Message-ID: <FCA2F9B8-E0E5-4C7B-A697-B6F0371E1558@erlang-consulting.com>

> I'm responding to you via email because we both seem to be on IRC at
> totally different times.


Thanks for your response.  I understand the direct cause of the error;  
I was trying to find out the reasoning behind disallowing synchronous  
'basic.publish' commands.

Regards,


-- 
Mietek B?k
Erlang Training & Consulting
http://www.erlang-consulting.com






From 0x6e6562 at gmail.com  Fri Jul 25 10:47:18 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 25 Jul 2008 10:47:18 +0100
Subject: [rabbitmq-discuss] Routing algorithm
Message-ID: <269388e30807250247o5d1c5ae1v2b53898647dd9cce@mail.gmail.com>

Hi Abhishek,

> Can you please let me know what kind of routing algorithm is being used in the server, to match the incoming events with the corresponding queues. I think Mnesia is used as the
> distributed DBMS, but I was just curious to know about the routing algorithm and its performance.

I'm forwarding this message to the rabbit discussion list because
we're trying to keep all conversations in one place, so that everybody
can benefit.

So it would be great to keep this discussion in this forum :-)

The answer to your question lies (unfortunately for you) in the spec:
http://jira.amqp.org/confluence/download/attachments/720900/amqp0-8.pdf?version=1

The type of routing depends on the type of exchange, whether it's
direct, fanout, topic or headers.

I hope this is a good starting point for your investigations,

Ben



From tonyg at lshift.net  Fri Jul 25 15:29:06 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 25 Jul 2008 15:29:06 +0100
Subject: [rabbitmq-discuss] rabbitmq out of memory
In-Reply-To: <OF44AE14E8.51B09019-ON8025748D.0034ECC1-8025748D.00362868@Edftrading.com>
References: <OF44AE14E8.51B09019-ON8025748D.0034ECC1-8025748D.00362868@Edftrading.com>
Message-ID: <4889E332.5020407@lshift.net>

Hi David,

David.Corcoran at edftrading.com wrote:
> The output is huge so I'm not sure how helpful it will be to you apart from
> to say it probably shouldn't be 13,000 lines ;)

Thanks for the file.

Could you send us the output of mnesia:info() and ets:i(), please? The 
missing memory could be in mnesia or ets tables.

Also, when you say the beam instance is 1.5GB, are you talking about 
virtual-address-space consumption, or RSS? (What does "ps v" give?)

Regards,
   Tony
-- 
  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Tue Jul 29 17:29:36 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 29 Jul 2008 17:29:36 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.4.0 released
Message-ID: <488F4570.90807@lshift.net>

The RabbitMQ team is pleased to announce the release of RabbitMQ 1.4.0.

This release has beta status and focuses on the following areas:

- switch to use of a DFSG-free JSON-formatted specification document
- bug fixes for a number of race conditions and non-compliances with the
    protocol specification
- several performance improvements for large numbers of queues
- bug fixes in Debian and RPM packaging
- improved error reporting
- improved performance

For details see the attached release notes.

Binary and source distributions of the new release can be found in the
usual place, at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.


Regards,

The RabbitMQ Team

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-1.4.0.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080729/596b617b/attachment.txt 

From 0x6e6562 at gmail.com  Tue Jul 29 23:54:10 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 29 Jul 2008 23:54:10 +0100
Subject: [rabbitmq-discuss] Integrating Ruby and Flash using AMQP
Message-ID: <269388e30807291554n576ffd5dhaf3e02f29b13a451@mail.gmail.com>

Hi all,

Following on from Aman Gupta's great work with the Ruby client for
AMQP, Peter Kieltyka has combined this library with the AS3 library
for AMQP to demonstrate how Rabbit can be used to integrate Ruby and
Flash.

His code is on Github, you can check it out here:
http://github.com/pkieltyka/amqp-flash-ruby-rpc/tree/master

HTH,

Ben



From rabbitmq at tmm1.net  Wed Jul 30 01:10:29 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Tue, 29 Jul 2008 17:10:29 -0700
Subject: [rabbitmq-discuss] ACK modes in the STOMP adapter
In-Reply-To: <e1c05edd0807291709v3fa91bc7s1799de465858fc48@mail.gmail.com>
References: <e1c05edd0806302018k5e87406dnc43272a70c770e2c@mail.gmail.com>
	<486A09C8.6070007@lshift.net>
	<e1c05edd0807011602j5add273fn94fa3dec6b460b2d@mail.gmail.com>
	<486B6992.5050001@lshift.net>
	<e1c05edd0807291709v3fa91bc7s1799de465858fc48@mail.gmail.com>
Message-ID: <e1c05edd0807291710y2d16bdcbna471d5859b17fb33@mail.gmail.com>

>
> At present, no, there's no explicit flow control mechanism.
>
> One option might be to extend the STOMP adapter with an equivalent of
> AMQP's "basic.get" method, which retrieves a single message at a time from a
> queue, without using a subscription.
>
> However, it's worth pointing out that messages are *not* lost if you choose
> "ack: client" mode. Instead, if the connection is dropped with unACKed
> messages outstanding on it, the unACKed messages are requeued and
> redelivered to the next consumer that comes along.
>
> This redelivery behaviour, in conjunction with TCP's built-in window
> management, means that a crude form of flow control is simply to stop
> reading from the socket. When the buffers fill up at each end, the RabbitMQ
> server will notice, and will stop feeding the busy connection.
>

What flow control mechanisms are available when using AMQP directly (not via
the STOMP adapter)? When working with many small messages, depending on the
TCP buffer does not seem ideal, as many hundreds or thousands of messages
can get queued up before RabbitMQ realizes the consumer is busy.

With no_ack=false, will RabbitMQ send a consumer new messages before
previous messages are acknowledged?

  Aman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080729/fb2ecaec/attachment.htm 

From nathan at comvine.com  Wed Jul 30 09:33:19 2008
From: nathan at comvine.com (Nathan Oorloff)
Date: Wed, 30 Jul 2008 18:33:19 +1000
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
	single queue
Message-ID: <b307b5520807300133y36bfd65dp607cb68dcb566c8a@mail.gmail.com>

Hello all,

I've searched and not seen this issue talked about on the mailing list so I
wanted to generate some discussion regarding the round-robin nature of
having multiple consumers on a single queue.

The scenario I'm using Rabbit-MQ for is as follows:
 - Many producers send messages to a direct exchange that end up in a "job"
queue
 - Many single-threaded consumers are listening on a single job queue using
basic_consume
 - When a consumer receives a job from the queue, they process it, put the
result on a reply queue then ack the message

The round-robin nature of message deliveries is great for load balancing if
all our jobs require equal processing time but this is not the case.. jobs
can range anywhere from a few seconds to a minute worth of processing.

I did up an artificial test where 3 consumers were using basic.consume on a
single queue. Two consumers processed their jobs immediately, however the
final consumer slept for 30 seconds to simulate getting a "big job" before
ack'ing the message and consuming the next one. The result (which I believe
is due to the round-robin nature specified by AMQP) was two consumers
pumping through their jobs and sitting idle, even though there were plenty
of jobs remaining on the queue and the third consumer left busy "processing"
all the "big jobs".
This was done using Barry Pederson's amqplib-0.3 library in Python.

I don't know erlang well enough to check the source but I assume RabbitMQ
does something like assigning jobs as they come in to each consumer on an
amqp queue? If this is the case, I think the desired behaviour would be
rather than assigning the jobs to a particular consumer immediately, assign
the job to the consumer when it sends an ack for the last message it
received to signify that it is ready to process a new job. This would work
too in the multi-threaded scenario where people wanted to ack the message
immediately before processing it so one thread can process the message
contents whilst the other downloads the next message.

As a work-around at the moment I am ack'ing a message after I receive it and
cancelling the consume before processing the job so other jobs will be
delivered to other consumers however, this means if the job fails for
whatever reason it will not be delivered to another consumer for processing.

I'm happy to put the test code up if anyone is interested in trying this for
themselves.

Nathan.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080730/e0a28f7c/attachment.htm 

From alexis.richardson at cohesiveft.com  Wed Jul 30 09:39:57 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 30 Jul 2008 09:39:57 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
	single queue
In-Reply-To: <b307b5520807300133y36bfd65dp607cb68dcb566c8a@mail.gmail.com>
References: <b307b5520807300133y36bfd65dp607cb68dcb566c8a@mail.gmail.com>
Message-ID: <167204d20807300139k7cd2587dvb5dfa77dd84f0ca4@mail.gmail.com>

Nathan,

On Wed, Jul 30, 2008 at 9:33 AM, Nathan Oorloff <nathan at comvine.com> wrote:
>
>  - Many producers send messages to a direct exchange that end up in a "job"
> queue
>  - Many single-threaded consumers are listening on a single job queue using
> basic_consume
>  - When a consumer receives a job from the queue, they process it, put the
> result on a reply queue then ack the message

Why use one job queue?  If you have multiple queues and use routing
keys as tags ("big", "small", "100Kb", ..) then you can constrain the
system to be fair without depending entirely on the broker.

None of which is to invalidate your proposal below of course :-)

alexis


> The round-robin nature of message deliveries is great for load balancing if
> all our jobs require equal processing time but this is not the case.. jobs
> can range anywhere from a few seconds to a minute worth of processing.
>
> I did up an artificial test where 3 consumers were using basic.consume on a
> single queue. Two consumers processed their jobs immediately, however the
> final consumer slept for 30 seconds to simulate getting a "big job" before
> ack'ing the message and consuming the next one. The result (which I believe
> is due to the round-robin nature specified by AMQP) was two consumers
> pumping through their jobs and sitting idle, even though there were plenty
> of jobs remaining on the queue and the third consumer left busy "processing"
> all the "big jobs".
> This was done using Barry Pederson's amqplib-0.3 library in Python.
>
> I don't know erlang well enough to check the source but I assume RabbitMQ
> does something like assigning jobs as they come in to each consumer on an
> amqp queue? If this is the case, I think the desired behaviour would be
> rather than assigning the jobs to a particular consumer immediately, assign
> the job to the consumer when it sends an ack for the last message it
> received to signify that it is ready to process a new job. This would work
> too in the multi-threaded scenario where people wanted to ack the message
> immediately before processing it so one thread can process the message
> contents whilst the other downloads the next message.
>
> As a work-around at the moment I am ack'ing a message after I receive it and
> cancelling the consume before processing the job so other jobs will be
> delivered to other consumers however, this means if the job fails for
> whatever reason it will not be delivered to another consumer for processing.
>
> I'm happy to put the test code up if anyone is interested in trying this for
> themselves.
>
> Nathan.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From David.Corcoran at edftrading.com  Wed Jul 30 12:39:46 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Wed, 30 Jul 2008 12:39:46 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on
 a	single queue
In-Reply-To: <b307b5520807300133y36bfd65dp607cb68dcb566c8a@mail.gmail.com>
Message-ID: <OF4E4A6846.DD3CACCB-ON80257496.003DC984-80257496.00401115@Edftrading.com>



rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 30/07/2008 09:33:19:


> The round-robin nature of message deliveries is great for load
> balancing if all our jobs require equal processing time but this is
> not the case.. jobs can range anywhere from a few seconds to a
> minute worth of processing.


Hey Nathan,

We're having the exact same problem. We have jobs of varying lengths and we
don't know how long each will take before we send it off. Some jobs can
take a few ms and others 5 minutes. So we can't do different queues for
different length jobs. One way we were looking at doing it is when a
consumer has an empty queue it sends to a topic saying so. If another
consumer has multiple jobs in its queue it negative acks the extra jobs and
lets rabbitmq redistribute them more evenly. The problem with this is that
we can't find a mechanism to negative ack. Cancelling the consumer, as you
pointed out, doesn't work because you have to ack first. We can't do this
because we could lose a job that way.

The rabbitmq javadocs have classes called AMQP.Basic.Reject and
AMQP.Basic.Return that look like they might do the job but unfortunately
they are not commented so I'm not sure if they're what I'm looking for. It
would be great if they could be used to selectively Nak.

> This was done using Barry Pederson's amqplib-0.3 library in Python.

I use the java library and it looks like ChannelN.java could do a basicNak
in the same way it does a basicAck. I'm going to test this later. Perhaps
it's the same with the python library.

Dave




*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From opendev at gmail.com  Wed Jul 30 13:38:54 2008
From: opendev at gmail.com (opendev at gmail.com)
Date: Wed, 30 Jul 2008 14:38:54 +0200
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
Message-ID: <b93bbdbc0807300538l509e87car2f66b422f20ec9ec@mail.gmail.com>

Hello Holger,

>Hosting it at http://freehg.org/ would probably keep things simple. If you
>are using eclipse then the mercurialEclipse plugin
>(http://www.vectrace.com/mercurialeclipse/) works reasonably well. An
>alternative is merclipse at http://goldenhammers.com/merclipse/.

I'm not really aquainted with mercurial. Would github work, too?

Best regards,


Joern
--



From holger at wizards.de  Wed Jul 30 14:53:30 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Wed, 30 Jul 2008 15:53:30 +0200
Subject: [rabbitmq-discuss] RabbitMQ / Spring integration
In-Reply-To: <b93bbdbc0807300538l509e87car2f66b422f20ec9ec@mail.gmail.com>
References: <b93bbdbc0807300538l509e87car2f66b422f20ec9ec@mail.gmail.com>
Message-ID: <4890725A.4040602@wizards.de>

opendev at gmail.com wrote:
> Hello Holger,
> 
>> Hosting it at http://freehg.org/ would probably keep things simple. If you
>> are using eclipse then the mercurialEclipse plugin
>> (http://www.vectrace.com/mercurialeclipse/) works reasonably well. An
>> alternative is merclipse at http://goldenhammers.com/merclipse/.
> 
> I'm not really aquainted with mercurial. Would github work, too?

In that case yes, of course. :)

cheers
Holger




From David.Corcoran at edftrading.com  Wed Jul 30 15:10:08 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Wed, 30 Jul 2008 15:10:08 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on
 a	single queue
In-Reply-To: <OF4E4A6846.DD3CACCB-ON80257496.003DC984-80257496.00401115@Edftrading.com>
Message-ID: <OF13755709.FF5A508A-ON80257496.004D85F9-80257496.004DD558@Edftrading.com>


> I use the java library and it looks like ChannelN.java could do a
basicNak
> in the same way it does a basicAck. I'm going to test this later. Perhaps
> it's the same with the python library.

Basic.Reject looks absolutely perfect for negative acks. However my test
code produced this:
Main thread caught exception: com.rabbitmq.client.ShutdownSignalException
(connection error; reason:
{#method<connection.close>(reply-code=503,reply-text=COMMAND_INVALID -
unimplemented method,class-id=60,method-id=90),null,""})

Does anyone know if there are plans to implement this?

Thanks,

Dave


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From 0x6e6562 at gmail.com  Wed Jul 30 15:31:45 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 30 Jul 2008 15:31:45 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
	single queue
In-Reply-To: <OF13755709.FF5A508A-ON80257496.004D85F9-80257496.004DD558@Edftrading.com>
References: <OF4E4A6846.DD3CACCB-ON80257496.003DC984-80257496.00401115@Edftrading.com>
	<OF13755709.FF5A508A-ON80257496.004D85F9-80257496.004DD558@Edftrading.com>
Message-ID: <269388e30807300731x4a04d27peb3fb2a9751c3b65@mail.gmail.com>

Dave,

On Wed, Jul 30, 2008 at 3:10 PM,  <David.Corcoran at edftrading.com> wrote:
>
>> I use the java library and it looks like ChannelN.java could do a
> basicNak
>> in the same way it does a basicAck. I'm going to test this later. Perhaps
>> it's the same with the python library.
>
> Basic.Reject looks absolutely perfect for negative acks. However my test
> code produced this:
> Main thread caught exception: com.rabbitmq.client.ShutdownSignalException
> (connection error; reason:
> {#method<connection.close>(reply-code=503,reply-text=COMMAND_INVALID -
> unimplemented method,class-id=60,method-id=90),null,""})

The spec says that for messages thus rejected "The server MUST NOT
deliver the message to the same client within the context of the
current channel.". This requires queues to track which channels have
rejected a particular message. Clearly that can be done, but it's more
than a few minutes work and so far we have not had anybody complaining
about the absence of basic.reject.

IIRC you are the first :-(

There are a couple of options that we have:

1. Obviously implement this feature;
2. Implement message delivery credit window management, which would be
to solution to the root cause

What the timelines are for either of case I cannot say at the moment,
we will need to consider other plans and what is coming up in 0-9 SP1.

So we'll have to get back to you on that.

BTW, In general, you can see what parts of the spec have been
implemented in this table:
http://www.rabbitmq.com/compatibility.html#classes

HTH,

Ben



From David.Corcoran at edftrading.com  Wed Jul 30 16:31:11 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Wed, 30 Jul 2008 16:31:11 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on
 a	single queue
In-Reply-To: <269388e30807300731x4a04d27peb3fb2a9751c3b65@mail.gmail.com>
Message-ID: <OFE71C5453.F22D1392-ON80257496.0052ABBD-80257496.005540E4@Edftrading.com>

rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 30/07/2008 15:31:45:

> ... so far we have not had anybody complaining
> about the absence of basic.reject.
>
> IIRC you are the first :-(

I'm just difficult ;)

>
> There are a couple of options that we have:
>
> 1. Obviously implement this feature;
> 2. Implement message delivery credit window management, which would be
> to solution to the root cause

I'm not sure how message delivery credits work but having read through a
little it looks like it might be size oriented. So producer and consumer
have a credit of bytes and when either hits zero they wait. Unfortunately
our long running jobs are no larger than our short running ones. So our
credit window would have be based on job running length which we don't know
in advance.

What we're really looking for is a nice pattern called "work stealing".
There are lots of papers out there on it but basically it just means taking
jobs from the end of other peoples' queues when you've nothing more in your
own queue. I'm not sure of the best way to do this in the rabbitmq world.

>
> What the timelines are for either of case I cannot say at the moment,
> we will need to consider other plans and what is coming up in 0-9 SP1.

That's ok. In the very short term I think we have a way around it.
Basically receiving jobs, acking and then resending them back to the same
queue. It's not pretty but it should do the trick.

Thanks for the help,

Dave



*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From matthias at lshift.net  Wed Jul 30 18:02:30 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 30 Jul 2008 18:02:30 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
 single queue
In-Reply-To: <OF4E4A6846.DD3CACCB-ON80257496.003DC984-80257496.00401115@Edftrading.com>
References: <OF4E4A6846.DD3CACCB-ON80257496.003DC984-80257496.00401115@Edftrading.com>
Message-ID: <48909EA6.1080903@lshift.net>

David.Corcoran at edftrading.com wrote:
> 
> rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 30/07/2008 09:33:19:
> 
> 
>> The round-robin nature of message deliveries is great for load
>> balancing if all our jobs require equal processing time but this is
>> not the case.. jobs can range anywhere from a few seconds to a
>> minute worth of processing.
> 
> 
> Hey Nathan,
> 
> We're having the exact same problem. We have jobs of varying lengths and we
> don't know how long each will take before we send it off. Some jobs can
> take a few ms and others 5 minutes. So we can't do different queues for
> different length jobs.

Wouldn't a simple solution be to have all consumers consuming off a 
single queue using basic.get? I.e. consumer gets job with basic.get, 
does work, sends ack, gets next job with basic.get, etc.

This does involve polling if the job queue is empty (basic.get doesn't 
block; it returns a get-empty response), but you could probably work out 
some reasonably straightforward heuristics to stop that from getting out 
of hand.


Matthias.



From matthias at lshift.net  Wed Jul 30 18:26:42 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 30 Jul 2008 18:26:42 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
 single queue
In-Reply-To: <OFE71C5453.F22D1392-ON80257496.0052ABBD-80257496.005540E4@Edftrading.com>
References: <OFE71C5453.F22D1392-ON80257496.0052ABBD-80257496.005540E4@Edftrading.com>
Message-ID: <4890A452.9050300@lshift.net>

David.Corcoran at edftrading.com wrote:
> I'm not sure how message delivery credits work but having read through a
> little it looks like it might be size oriented.

basic.qos can do count based windows too. So with a window size of one 
you can guarantee that at most one message is "in flight" or being 
processed by the consumer.

This has come up before, and basic.qos is on our todo list. As with 
basic.reject, and perhaps more so, there are quite a few challenges in 
implementing it, which is why it hasn't been done yet. One difficulty is 
that basic.qos operates on an entire channel (or, optionally, even an 
entire connection). Since a single channel can consume messages from 
multiple queues, and these queues can have consumers on other channels 
(with consumption possibly limited by basic.qos) we basically have a 
nice little optimisation & consensus problem at our hands: figuring out 
which queues should send which messages to which channels such that the 
maximum number of messages gets delivered while staying inside the 
configured qos limits. And all that in a distributed setting. And the 
limits change all the time outside the brokers control - clients ack 
messages whenever they please, the topology may change, etc, etc. Great 
fun :)


Matthias.



From David.Corcoran at edftrading.com  Wed Jul 30 18:39:04 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Wed, 30 Jul 2008 18:39:04 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
 single queue
In-Reply-To: <48909EA6.1080903@lshift.net>
Message-ID: <OFEBE1BE72.4C966F45-ON80257496.005E29AA-80257496.0060F5F1@Edftrading.com>



rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 30/07/2008 18:02:30:

Hey Matthias,
>
> Wouldn't a simple solution be to have all consumers consuming off a
> single queue using basic.get? I.e. consumer gets job with basic.get,
> does work, sends ack, gets next job with basic.get, etc.

Not really because a lot of our jobs are only a few ms so the rtt would
play too much part if we did it this way. The idea of having a local queue
full of messages works great for us, as long as there's a way to reject
messages if someone else's queue is empty.

>
> This does involve polling if the job queue is empty (basic.get doesn't
> block; it returns a get-empty response), but you could probably work out
> some reasonably straightforward heuristics to stop that from getting out
> of hand.
>

I tried the polling way before and it kills RabbitMQ for us. We can have
over 500 consumers all polling and with a small wait time between polls
this causes RabbitMQ to grind to a halt. A longer wait time between polls
means we aren't efficient when there are short jobs to be run.

Dave


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From rabbitmq-discuss_efine at usa.net  Wed Jul 30 18:52:22 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Wed, 30 Jul 2008 13:52:22 -0400
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
	single queue
In-Reply-To: <4890A452.9050300@lshift.net>
References: <OFE71C5453.F22D1392-ON80257496.0052ABBD-80257496.005540E4@Edftrading.com>
	<4890A452.9050300@lshift.net>
Message-ID: <6c2563b20807301052t69687f26p5219e4a5f568b759@mail.gmail.com>

I think I was the one with the basic.qos problem because in stress testing,
my consumers (started with basic.consume) were being flooded with messages
and could not keep up, so their Erlang message queues became huge and
eventually there were memory problems. What I eventually wound up doing was,
indeed, changing the code to use basic.get with a short timeout. This keeps
the messages in RabbitMQ's camp. Since they are persistent I imagine they
will be stored on disk and not take too much memory. Essentially, when I
receive a basic.get_empty, I call erlang.send_after() to kick off a new
basic.get in a short while. When the queues are busy, there will be no
overhead; it's only when idle that there will be a number of timers
expiring.

So far I have not seen significant performance hits, but then again, I am
only using 50 queues and and aggregate of 140 messages/second. Maybe
Matthias's suggestion will work for you.

Hope this helps.

Edwin

On Wed, Jul 30, 2008 at 1:26 PM, Matthias Radestock <matthias at lshift.net>wrote:

> David.Corcoran at edftrading.com wrote:
> > I'm not sure how message delivery credits work but having read through a
> > little it looks like it might be size oriented.
>
> basic.qos can do count based windows too. So with a window size of one
> you can guarantee that at most one message is "in flight" or being
> processed by the consumer.
>
> This has come up before, and basic.qos is on our todo list. As with
> basic.reject, and perhaps more so, there are quite a few challenges in
> implementing it, which is why it hasn't been done yet. One difficulty is
> that basic.qos operates on an entire channel (or, optionally, even an
> entire connection). Since a single channel can consume messages from
> multiple queues, and these queues can have consumers on other channels
> (with consumption possibly limited by basic.qos) we basically have a
> nice little optimisation & consensus problem at our hands: figuring out
> which queues should send which messages to which channels such that the
> maximum number of messages gets delivered while staying inside the
> configured qos limits. And all that in a distributed setting. And the
> limits change all the time outside the brokers control - clients ack
> messages whenever they please, the topology may change, etc, etc. Great
> fun :)
>
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
For every expert there is an equal and opposite expert - Arthur C. Clarke
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080730/46fc6813/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Wed Jul 30 19:08:25 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Wed, 30 Jul 2008 14:08:25 -0400
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
	single queue
In-Reply-To: <6c2563b20807301052t69687f26p5219e4a5f568b759@mail.gmail.com>
References: <OFE71C5453.F22D1392-ON80257496.0052ABBD-80257496.005540E4@Edftrading.com>
	<4890A452.9050300@lshift.net>
	<6c2563b20807301052t69687f26p5219e4a5f568b759@mail.gmail.com>
Message-ID: <6c2563b20807301108i467391c1t5b5315d1e470a8f@mail.gmail.com>

I just noticed David is using Java, so my Erlang-related comments won't be
helpful. Timers and processes have much lower overhead in Erlang than in
other languages so what works for Erlang probably won't work as well in
these languages. I also noticed that things ground to a halt when using 500
consumers doing basic.get in a polling fashion. I'd be very curious to know
what polling interval was used to get RabbitMQ to grind to a halt with 500
consumers.

On Wed, Jul 30, 2008 at 1:52 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net>wrote:

> I think I was the one with the basic.qos problem because in stress testing,
> my consumers (started with basic.consume) were being flooded with messages
> and could not keep up, so their Erlang message queues became huge and
> eventually there were memory problems. What I eventually wound up doing was,
> indeed, changing the code to use basic.get with a short timeout. This keeps
> the messages in RabbitMQ's camp. Since they are persistent I imagine they
> will be stored on disk and not take too much memory. Essentially, when I
> receive a basic.get_empty, I call erlang.send_after() to kick off a new
> basic.get in a short while. When the queues are busy, there will be no
> overhead; it's only when idle that there will be a number of timers
> expiring.
>
> So far I have not seen significant performance hits, but then again, I am
> only using 50 queues and and aggregate of 140 messages/second. Maybe
> Matthias's suggestion will work for you.
>
> Hope this helps.
>
> Edwin
>
>
> On Wed, Jul 30, 2008 at 1:26 PM, Matthias Radestock <matthias at lshift.net>wrote:
>
>> David.Corcoran at edftrading.com wrote:
>> > I'm not sure how message delivery credits work but having read through a
>> > little it looks like it might be size oriented.
>>
>> basic.qos can do count based windows too. So with a window size of one
>> you can guarantee that at most one message is "in flight" or being
>> processed by the consumer.
>>
>> This has come up before, and basic.qos is on our todo list. As with
>> basic.reject, and perhaps more so, there are quite a few challenges in
>> implementing it, which is why it hasn't been done yet. One difficulty is
>> that basic.qos operates on an entire channel (or, optionally, even an
>> entire connection). Since a single channel can consume messages from
>> multiple queues, and these queues can have consumers on other channels
>> (with consumption possibly limited by basic.qos) we basically have a
>> nice little optimisation & consensus problem at our hands: figuring out
>> which queues should send which messages to which channels such that the
>> maximum number of messages gets delivered while staying inside the
>> configured qos limits. And all that in a distributed setting. And the
>> limits change all the time outside the brokers control - clients ack
>> messages whenever they please, the topology may change, etc, etc. Great
>> fun :)
>>
>>
>> Matthias.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> For every expert there is an equal and opposite expert - Arthur C. Clarke
>



-- 
For every expert there is an equal and opposite expert - Arthur C. Clarke
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080730/990d848d/attachment.htm 

From petr.sturc at gmail.com  Wed Jul 30 21:09:25 2008
From: petr.sturc at gmail.com (Petr Sturc)
Date: Wed, 30 Jul 2008 22:09:25 +0200
Subject: [rabbitmq-discuss] Replay order
Message-ID: <73b10e5b0807301309o200c254aj12965a4f46690842@mail.gmail.com>

Hi,

the 1.4.0 "Release highlights" is mentioning that there is bugfix for
"maintain message order on persister replay".
Does it mean the messages are replayed in the same order there way sent?

I am playing with single producer and two consumers taking messages
from the same queue without ACK. I am receiving them in round-robin
order as expected. When I stop the consumers and connect another one
WITH ACK, the messages are redelivered, but with no particular order.
Is it correcect behavour? How does it correspond to the claim about
maintaining message order?

Regards,
Petr



From rabbitmq-discuss_efine at usa.net  Thu Jul 31 01:38:18 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Wed, 30 Jul 2008 20:38:18 -0400
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
	single queue
In-Reply-To: <6c2563b20807301108i467391c1t5b5315d1e470a8f@mail.gmail.com>
References: <OFE71C5453.F22D1392-ON80257496.0052ABBD-80257496.005540E4@Edftrading.com>
	<4890A452.9050300@lshift.net>
	<6c2563b20807301052t69687f26p5219e4a5f568b759@mail.gmail.com>
	<6c2563b20807301108i467391c1t5b5315d1e470a8f@mail.gmail.com>
Message-ID: <6c2563b20807301738lf76c58ub2ffbaafc57281b2@mail.gmail.com>

I was curious about the cost of polling using basic.get, so I wrote a small
Erlang client program to start up 500 consumers, on one TCP/IP channel,
listening on one queue, each polling with a basic.get every 100ms. I know
this is a high rate, but I wanted to see how it behaved.

Maybe my code was naive or inefficient, but I found the polling program's
Linux process to be taking 85% CPU (and off the chart in appmon), while
Rabbit's process was about 30% (on a 4-core Intel Q6600 box, hence CPU
numbers don't add up to 100%). I haven't tried it with the "native" client.
It seemed to make no difference if kernel poll was enabled.

Regards,
Edwin

Environment: Ubuntu Linux 8.04, 2.4 GHz Q6600, 8 GB RAM, Erlang R12B-3,
RabbitMQ 1.4.0, RabbitMQ Erlang client as of 2008/06/23.

On Wed, Jul 30, 2008 at 2:08 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net>wrote:

> I just noticed David is using Java, so my Erlang-related comments won't be
> helpful. Timers and processes have much lower overhead in Erlang than in
> other languages so what works for Erlang probably won't work as well in
> these languages. I also noticed that things ground to a halt when using 500
> consumers doing basic.get in a polling fashion. I'd be very curious to know
> what polling interval was used to get RabbitMQ to grind to a halt with 500
> consumers.
>
>
> On Wed, Jul 30, 2008 at 1:52 PM, Edwin Fine <
> rabbitmq-discuss_efine at usa.net> wrote:
>
>> I think I was the one with the basic.qos problem because in stress
>> testing, my consumers (started with basic.consume) were being flooded with
>> messages and could not keep up, so their Erlang message queues became huge
>> and eventually there were memory problems. What I eventually wound up doing
>> was, indeed, changing the code to use basic.get with a short timeout. This
>> keeps the messages in RabbitMQ's camp. Since they are persistent I imagine
>> they will be stored on disk and not take too much memory. Essentially, when
>> I receive a basic.get_empty, I call erlang.send_after() to kick off a new
>> basic.get in a short while. When the queues are busy, there will be no
>> overhead; it's only when idle that there will be a number of timers
>> expiring.
>>
>> So far I have not seen significant performance hits, but then again, I am
>> only using 50 queues and and aggregate of 140 messages/second. Maybe
>> Matthias's suggestion will work for you.
>>
>> Hope this helps.
>>
>> Edwin
>>
>>
>> On Wed, Jul 30, 2008 at 1:26 PM, Matthias Radestock <matthias at lshift.net>wrote:
>>
>>> David.Corcoran at edftrading.com wrote:
>>> > I'm not sure how message delivery credits work but having read through
>>> a
>>> > little it looks like it might be size oriented.
>>>
>>> basic.qos can do count based windows too. So with a window size of one
>>> you can guarantee that at most one message is "in flight" or being
>>> processed by the consumer.
>>>
>>> This has come up before, and basic.qos is on our todo list. As with
>>> basic.reject, and perhaps more so, there are quite a few challenges in
>>> implementing it, which is why it hasn't been done yet. One difficulty is
>>> that basic.qos operates on an entire channel (or, optionally, even an
>>> entire connection). Since a single channel can consume messages from
>>> multiple queues, and these queues can have consumers on other channels
>>> (with consumption possibly limited by basic.qos) we basically have a
>>> nice little optimisation & consensus problem at our hands: figuring out
>>> which queues should send which messages to which channels such that the
>>> maximum number of messages gets delivered while staying inside the
>>> configured qos limits. And all that in a distributed setting. And the
>>> limits change all the time outside the brokers control - clients ack
>>> messages whenever they please, the topology may change, etc, etc. Great
>>> fun :)
>>>
>>>
>>> Matthias.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>>
>> --
>> For every expert there is an equal and opposite expert - Arthur C. Clarke
>>
>
>
>
> --
> For every expert there is an equal and opposite expert - Arthur C. Clarke
>



-- 
For every expert there is an equal and opposite expert - Arthur C. Clarke
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080730/3ee0d301/attachment.htm 

From David.Corcoran at edftrading.com  Thu Jul 31 08:33:10 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Thu, 31 Jul 2008 08:33:10 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on
 a	single queue
In-Reply-To: <6c2563b20807301738lf76c58ub2ffbaafc57281b2@mail.gmail.com>
Message-ID: <OF9F09E10B.ADDF8E73-ON80257497.002875E1-80257497.00297D70@Edftrading.com>


Morning Edwin,

Unfortunately the polling can't work for us because a 100ms delay between
each basic.get is too long. A lot of our jobs are only a few ms. But when I
first started using RabbitMq I used basic.get and a 10ms delay with 250
consumers on 250 tcp connections (although we could easily need 500 or
more). At the time we were using Erlang 11b5 and RabbitMQ 1.3 and it didn't
handle it very well. Obviously in our tests the 250 different clients
weren't registering any cpu usage on their machines but RabbitMQ was at
100%.

I stopped the tests and moved onto consumers soon after.

Dave

rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 31/07/2008 01:38:18:

> I was curious about the cost of polling using basic.get, so I wrote
> a small Erlang client program to start up 500 consumers, on one
> TCP/IP channel, listening on one queue, each polling with a basic.
> get every 100ms. I know this is a high rate, but I wanted to see how
> it behaved.
>
> Maybe my code was naive or inefficient, but I found the polling
> program's Linux process to be taking 85% CPU (and off the chart in
> appmon), while Rabbit's process was about 30% (on a 4-core Intel
> Q6600 box, hence CPU numbers don't add up to 100%). I haven't tried
> it with the "native" client. It seemed to make no difference if
> kernel poll was enabled.
>
> Regards,
> Edwin
>
> Environment: Ubuntu Linux 8.04, 2.4 GHz Q6600, 8 GB RAM, Erlang
> R12B-3, RabbitMQ 1.4.0, RabbitMQ Erlang client as of 2008/06/23.


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



From gsim at redhat.com  Thu Jul 31 09:20:36 2008
From: gsim at redhat.com (Gordon Sim)
Date: Thu, 31 Jul 2008 09:20:36 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
 single queue
In-Reply-To: <OFEBE1BE72.4C966F45-ON80257496.005E29AA-80257496.0060F5F1@Edftrading.com>
References: <OFEBE1BE72.4C966F45-ON80257496.005E29AA-80257496.0060F5F1@Edftrading.com>
Message-ID: <489175D4.7060104@redhat.com>

David.Corcoran at edftrading.com wrote:
> 
> rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 30/07/2008 18:02:30:
> 
> Hey Matthias,
>> Wouldn't a simple solution be to have all consumers consuming off a
>> single queue using basic.get? I.e. consumer gets job with basic.get,
>> does work, sends ack, gets next job with basic.get, etc.
> 
> Not really because a lot of our jobs are only a few ms so the rtt would
> play too much part if we did it this way. The idea of having a local queue
> full of messages works great for us, as long as there's a way to reject
> messages if someone else's queue is empty.

Could you use basic.recover(requeue=true) in that case? You could ack 
the first n messages on your local queue that you want to deal with, 
then issue the recover to have any subsequently delievered messages 
requeued.

Of course when requeued those messages will be allocated to available 
consumers, so some may come back to the same subscriber (that would also 
be the case if you ack and sent them back to the same queue yourself).

To avoid that (without having some form of flow control or prefetch 
limit) you would I think need to temporarily cancel your subscription 
and re-subscribe when you have processed the n messages (or a portion 
thereof) from your local queue.



From gsim at redhat.com  Thu Jul 31 09:32:48 2008
From: gsim at redhat.com (Gordon Sim)
Date: Thu, 31 Jul 2008 09:32:48 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
 single queue
In-Reply-To: <489175D4.7060104@redhat.com>
References: <OFEBE1BE72.4C966F45-ON80257496.005E29AA-80257496.0060F5F1@Edftrading.com>
	<489175D4.7060104@redhat.com>
Message-ID: <489178B0.2000106@redhat.com>

Gordon Sim wrote:
> David.Corcoran at edftrading.com wrote:
>> rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 30/07/2008 18:02:30:
>>
>> Hey Matthias,
>>> Wouldn't a simple solution be to have all consumers consuming off a
>>> single queue using basic.get? I.e. consumer gets job with basic.get,
>>> does work, sends ack, gets next job with basic.get, etc.
>> Not really because a lot of our jobs are only a few ms so the rtt would
>> play too much part if we did it this way. The idea of having a local queue
>> full of messages works great for us, as long as there's a way to reject
>> messages if someone else's queue is empty.
> 
> Could you use basic.recover(requeue=true) in that case? You could ack 
> the first n messages on your local queue that you want to deal with, 
> then issue the recover to have any subsequently delievered messages 
> requeued.

Sorry, didn't think this one through enough! Of course you can't ack 
before you process the tasks in case the client dies before actually 
doing the work and the messages are lost.

So for this to be of any use you would have to finish processing your 
current task, ack that then requeue everything everything else. That may 
be less attractive an option if it happens often as it removes the value 
of the prefetch.

> Of course when requeued those messages will be allocated to available 
> consumers, so some may come back to the same subscriber (that would also 
> be the case if you ack and sent them back to the same queue yourself).
> 
> To avoid that (without having some form of flow control or prefetch 
> limit) you would I think need to temporarily cancel your subscription 
> and re-subscribe when you have processed the n messages (or a portion 
> thereof) from your local queue.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 




From David.Corcoran at edftrading.com  Thu Jul 31 09:40:54 2008
From: David.Corcoran at edftrading.com (David.Corcoran at edftrading.com)
Date: Thu, 31 Jul 2008 09:40:54 +0100
Subject: [rabbitmq-discuss] Load balancing with multiple consumers on a
 single queue
In-Reply-To: <489178B0.2000106@redhat.com>
Message-ID: <OFB6A00138.536BBD2C-ON80257497.002EF08F-80257497.002FB0E4@Edftrading.com>



rabbitmq-discuss-bounces at lists.rabbitmq.com wrote on 31/07/2008 09:32:48:

> Sorry, didn't think this one through enough! Of course you can't ack
> before you process the tasks in case the client dies before actually
> doing the work and the messages are lost.
>

Hey Gordon,

Yeah this is the same problem with cancelling the consumer. You have to ack
what you're working on first which is a bit dangerous.

> So for this to be of any use you would have to finish processing your
> current task, ack that then requeue everything everything else. That may
> be less attractive an option if it happens often as it removes the value
> of the prefetch.

It also means the grid could be idle while I'm doing that. For example if
I'm working on a 10 minute task with other tasks in the local queue behind
it and there are idle consumers on the grid.

It's a tough problem but once it's solved it'll be great. We've looked at
lots of other grid solutions and none of them can do this. RabbitMQ is the
closest we've gotten.

Dave


*********************************************************************
This communication contains confidential information, some or all of which may be privileged. It is for the intended recipient only and others must not disclose, distribute, copy, print or rely on this communication. If an addressing or transmission error has misdirected this communication, please notify the sender by replying to this e-mail and then delete the e-mail. E-mail sent to EDF Trading may be monitored by the company. Thank you. 
EDF Trading Limited
80 Victoria Street, 3rd Floor, Cardinal Place, London, SW1E 5JL
A Company registered in England No. 4255974. 
Switchboard: 020 7061 4000
EDF Trading Markets Limited is a member of the EDF Trading Limited Group and is authorised and regulated by the Financial Services Authority.
VAT number: GB 735 5479 07
*********************************************************************



