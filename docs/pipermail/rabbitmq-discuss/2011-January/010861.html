<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] internal sequence ID
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20internal%20sequence%20ID&In-Reply-To=%3C20110124154123.GB11337%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010860.html">
   <LINK REL="Next"  HREF="010862.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] internal sequence ID</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20internal%20sequence%20ID&In-Reply-To=%3C20110124154123.GB11337%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] internal sequence ID">matthew at rabbitmq.com
       </A><BR>
    <I>Mon Jan 24 15:41:24 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010860.html">[rabbitmq-discuss] internal sequence ID
</A></li>
        <LI>Next message: <A HREF="010862.html">[rabbitmq-discuss] Responsibility Transfer using RabbitMQ .NET API:	How it works?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10861">[ date ]</a>
              <a href="thread.html#10861">[ thread ]</a>
              <a href="subject.html#10861">[ subject ]</a>
              <a href="author.html#10861">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Jan 24, 2011 at 07:13:21AM -0600, Jon Brisbin wrote:
&gt;<i> I'm able to persist messages to Riak now but I'm trying to figure out how to return a proper sequence ID from publish/3.
</I>&gt;<i> 
</I>&gt;<i> What's the easiest way to implement this sequence ID that won't cause things to explode? :) Would an in-memory counter that starts at 1 all the time be sufficient? Or do I need to keep track of that by persisting some kind of metadata? It looks like variable_queue uses rabbit_queue_index, which I wasn't sure if I would be able to simply scab onto.
</I>
The seqid is a pure number. The purpose of queue_index is that at best,
without it, you'll end up with a queue of elements where each element
probably looks like {Guid, IsDelivered}. In order to avoid the memory
costs of queues of millions of such items, you need to be able to store
such queues on disk. If you assign each element a seqid then you'll be
able to compress down to what's helpfully called a &#948; in vq - i.e. a
start seqid, an end seqid and a count. And of course, there can be gaps
which is why you may need the count. At that point you can just lift off
disk the relevant records you need to be able to then rehydrate them to
{Guid, IsDelivered} elements, and from there get back to the whole msg.

How you achieve this in riak or elsewhere is of course entirely up to
you!

Matthew
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010860.html">[rabbitmq-discuss] internal sequence ID
</A></li>
	<LI>Next message: <A HREF="010862.html">[rabbitmq-discuss] Responsibility Transfer using RabbitMQ .NET API:	How it works?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10861">[ date ]</a>
              <a href="thread.html#10861">[ thread ]</a>
              <a href="subject.html#10861">[ subject ]</a>
              <a href="author.html#10861">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
