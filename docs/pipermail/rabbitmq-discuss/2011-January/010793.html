<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Shovel bug? Consumer hangs after network failure.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20bug%3F%20Consumer%20hangs%20after%20network%20failure.&In-Reply-To=%3CC0DB3E20-AC51-4027-8E5A-860751563E17%40tjervaag.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010859.html">
   <LINK REL="Next"  HREF="010809.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Shovel bug? Consumer hangs after network failure.</H1>
    <B>&#216;yvind Tjervaag</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20bug%3F%20Consumer%20hangs%20after%20network%20failure.&In-Reply-To=%3CC0DB3E20-AC51-4027-8E5A-860751563E17%40tjervaag.com%3E"
       TITLE="[rabbitmq-discuss] Shovel bug? Consumer hangs after network failure.">oyvind at tjervaag.com
       </A><BR>
    <I>Thu Jan 20 08:03:13 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010859.html">[rabbitmq-discuss] Restarting management plugin without restarting the whole server
</A></li>
        <LI>Next message: <A HREF="010809.html">[rabbitmq-discuss] Shovel bug? Consumer hangs after network failure.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10793">[ date ]</a>
              <a href="thread.html#10793">[ thread ]</a>
              <a href="subject.html#10793">[ subject ]</a>
              <a href="author.html#10793">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi!

I don't know if I've found a bug or if there is something in my setup that needs changing..
I have 2 RabbitMQ servers (v2.2.0 of everything, windows 2003 r2, Erlang 5.8.1.1) connected via a very unstable radio link (well.. they're in my development LAN at the moment, but will be moved to an unstable link in not too many weeks...). My test setup is something like this:

Rabbit1 --&gt; Network switch --&gt; Horrible bad network link --&gt; Network switch --&gt; Rabbit2

I needed to move messages in both directions between the rabbit servers. I first installed the shovel plugin on rabbit2 only, and configured that to move messages in both directions. If I consume from a queue on Rabbit1 with the shovel on Rabbit2 and disconnect the network between them, the consumer doesn't seem to be able to reconnect to rabbit1 when the network comes back up, generating errors like this:

=SUPERVISOR REPORT==== 19-Jan-2011::12:57:30 ===
     Supervisor: {&lt;0.1973.0&gt;,amqp_connection_sup}
     Context:    child_terminated
     Reason:     {error,etimedout}
     Offender:   [{pid,&lt;0.1976.0&gt;},
                  {name,connection},
                  {mfa,
                      {amqp_gen_connection,start_link,
                          [amqp_network_connection,
                           {amqp_params,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;/&quot;&gt;&gt;,
                               &quot;192.168.0.2&quot;,5672,0,0,0,none,[]},
                           #Fun&lt;amqp_connection_sup.0.64044238&gt;,
                           #Fun&lt;amqp_connection_sup.2.105785818&gt;,[]]}},
                  {restart_type,intrinsic},
                  {shutdown,brutal_kill},
                  {child_type,worker}]

The shovel that moves messages from Rabbit2 to Rabbit1 however detects that the network was down, and reconnects properly. I've done a temporary workaround by always having my shovel plugin on the same server where I consume messages.

This seems to be the same &quot;issue&quot; I had with the .NET client a while ago where I had to call a passive queue declare in my consumer code to trigger a (channel?-) fault to detect that a connection had gone away.

.. So I suppose the question is: Is there any way to configure the shovel plugin differently to get it to detect that a connection to a remote rabbit server has gone away?

thanks,

&#216;yvind
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010859.html">[rabbitmq-discuss] Restarting management plugin without restarting the whole server
</A></li>
	<LI>Next message: <A HREF="010809.html">[rabbitmq-discuss] Shovel bug? Consumer hangs after network failure.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10793">[ date ]</a>
              <a href="thread.html#10793">[ thread ]</a>
              <a href="subject.html#10793">[ subject ]</a>
              <a href="author.html#10793">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
