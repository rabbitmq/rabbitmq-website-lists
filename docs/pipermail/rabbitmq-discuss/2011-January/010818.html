<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Test case - Possible Memory Leak	problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Test%20case%20-%20Possible%20Memory%20Leak%0A%09problem&In-Reply-To=%3CAANLkTi%3DdDJLJrf67%2BKrA1Y6TxFYEs48_oisjyyeo-mwX%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010690.html">
   <LINK REL="Next"  HREF="010870.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Test case - Possible Memory Leak	problem</H1>
    <B>Crisoforo Seccia</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Test%20case%20-%20Possible%20Memory%20Leak%0A%09problem&In-Reply-To=%3CAANLkTi%3DdDJLJrf67%2BKrA1Y6TxFYEs48_oisjyyeo-mwX%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Test case - Possible Memory Leak	problem">cristofer.seccia at gmail.com
       </A><BR>
    <I>Fri Jan 21 11:44:16 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010690.html">[rabbitmq-discuss] RabbitMQ Test case - Possible Memory Leak problem
</A></li>
        <LI>Next message: <A HREF="010870.html">[rabbitmq-discuss] RabbitMQ Test case - Possible Memory	Leak	problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10818">[ date ]</a>
              <a href="thread.html#10818">[ thread ]</a>
              <a href="subject.html#10818">[ subject ]</a>
              <a href="author.html#10818">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've fallowed your instructions and configured my RabbitMQ server under
windows to use different configuration setup:

1) [{rabbit, [{vm_memory_high_watermark, 0.80}]}].
2) [{rabbit, [{vm_memory_high_watermark, 0.40}]}].
3) [{rabbit, [{vm_memory_high_watermark, 0.25}]}].
4) [{rabbit, [{vm_memory_high_watermark, 0.20}]}].
5) [{rabbit, [{vm_memory_high_watermark, 0.10}]}].

Every time I've started RabbiitMQ server with one of the previous
configuration and then started my Test application but every time the
RabbitMQ server crashed down after a few minutes.I don't sincerly find any
problem in my application's code and, as I've stated in previous e-mail the
test is very simple. Anyway I've attached my project and hope someone can
test my application under different machine then window because for the
moment I'm unable to operate this kind of test. Hope to have a response.
Thanks, best regards

P.S. (How to use the project):

The attached file is a MAVEN project (platform independent) which produces
as output an executable project. The project is composed by two sub-modules,
one is use to test ActiveMQ and another one is used to test RabbitMQ.
Basically the project is a ready to go for running, just configure the
properties file (server connection, login, etc.). The configuration files
are respectively placed under
&quot;${broker_type}mq/publisher/data/publisher.properties&quot;. Both the two
sub-modules (and both publisher or subscriber applications) produces as
output a .csv file under the folder
&quot;${broker_type}mq/${application_type}/results&quot; where are printed some test
results. Also the messages number and the size of the message can be
configured to the publishers by using the file located under the folder
&quot;${broker_type}mq/${application_type}/data/${broker_type}MQTesterPublisher.txt&quot;
(an example is already provided).

Cristoforo.

2011/1/14 Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt;

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> On Tue, Jan 11, 2011 at 12:44:54PM +0100, Crisoforo Seccia wrote:
</I>&gt;<i> &gt; . Am I adopting a very strange test case which is not well handled by
</I>&gt;<i> &gt; RabbitMQ?
</I>&gt;<i>
</I>&gt;<i> Not really, no. However, there are problems with RabbitMQ under Windows,
</I>&gt;<i> and you may have to do some tweaking of the configuration. The fact that
</I>&gt;<i> you crashed on an eheap allocation suggests that Rabbit tried to
</I>&gt;<i> allocate memory that Windows refused it.
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/extensions.html#memsup">http://www.rabbitmq.com/extensions.html#memsup</A>
</I>&gt;<i>
</I>&gt;<i> Rabbit by default assumes that it's the only application running on a
</I>&gt;<i> machine, and thus it can expect to be allocated all memory. You may
</I>&gt;<i> wish, as suggested in the above page, to try reducing the
</I>&gt;<i> vm_memory_high_watermark and repeat the tests.
</I>&gt;<i>
</I>&gt;<i> &gt; . Is there any connection with the solved bug described in the RabbitMQ
</I>&gt;<i> 2.2
</I>&gt;<i> &gt; release notes (&#8220;fix memory leak when long-running channels consume and
</I>&gt;<i> &gt; cancel on many queues&#8221;)?
</I>&gt;<i>
</I>&gt;<i> Nope - that bug would have likely taken months of constant tripping to
</I>&gt;<i> actually result in any sizable memory leak.
</I>&gt;<i>
</I>&gt;<i> &gt; . How does RabbitMQ handle message flooding? As stated in ActiveMQ
</I>&gt;<i> official
</I>&gt;<i> &gt; page, the flow control, in the current version means that: &#8220;if the broker
</I>&gt;<i> &gt; detects that the memory limit for the destination, or the temp- or
</I>&gt;<i> &gt; file-store limits for the broker, have been exceeded, then the flow of
</I>&gt;<i> &gt; messages can be slowed down. The producer will be either blocked until
</I>&gt;<i> &gt; resources are available or will receive a JMSException&#8221;.
</I>&gt;<i>
</I>&gt;<i> Again, the above link will explain it all, but in short, Rabbit uses TCP
</I>&gt;<i> back pressure to prevent producers flooding it with too many messages.
</I>&gt;<i> Ultimately, you're always limited by the rate at which you can get rid
</I>&gt;<i> of messages - whether to clients or to disk. In effect, RAM just acts as
</I>&gt;<i> a huge (hopefully!) buffer.
</I>&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110121/3099811d/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110121/3099811d/attachment-0001.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: MQTester.rar
Type: application/rar
Size: 41564 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110121/3099811d/attachment-0001.rar">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110121/3099811d/attachment-0001.rar</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010690.html">[rabbitmq-discuss] RabbitMQ Test case - Possible Memory Leak problem
</A></li>
	<LI>Next message: <A HREF="010870.html">[rabbitmq-discuss] RabbitMQ Test case - Possible Memory	Leak	problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10818">[ date ]</a>
              <a href="thread.html#10818">[ thread ]</a>
              <a href="subject.html#10818">[ subject ]</a>
              <a href="author.html#10818">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
