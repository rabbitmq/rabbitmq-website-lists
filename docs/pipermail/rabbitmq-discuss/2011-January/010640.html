<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Strange RabbitMQ management plugin error!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Strange%20RabbitMQ%20management%20plugin%20error%21&In-Reply-To=%3C4D2DC6DC.3090008%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010631.html">
   <LINK REL="Next"  HREF="010642.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Strange RabbitMQ management plugin error!</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Strange%20RabbitMQ%20management%20plugin%20error%21&In-Reply-To=%3C4D2DC6DC.3090008%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Strange RabbitMQ management plugin error!">simon at rabbitmq.com
       </A><BR>
    <I>Wed Jan 12 15:21:00 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010631.html">[rabbitmq-discuss] Strange RabbitMQ management plugin error!
</A></li>
        <LI>Next message: <A HREF="010642.html">[rabbitmq-discuss] Strange RabbitMQ management plugin error!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10640">[ date ]</a>
              <a href="thread.html#10640">[ thread ]</a>
              <a href="subject.html#10640">[ subject ]</a>
              <a href="author.html#10640">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/01/11 18:48, Ciprian Dorin Craciun wrote:
&gt;<i>      I don't see any errors displayed from the management plugin. It
</I>&gt;<i> just says that it started the web server, serving the usual URL.
</I>&gt;<i>      I've also tried to set both the `force_fine_statistics` and
</I>&gt;<i> `collect_statistics` but they don't seem to have any effect.
</I>
I had a play with your run_rabbit script and I found the problem.

RabbitMQ has the concept of a boot step - part of the startup process of 
the rabbit application. These are the things like

&quot;starting xyz                                          ...done&quot;

that appear on stdout during startup.

Some plugins, including rabbit_management_agent need to insert boot 
steps into the rabbit app (as well as being their own apps). 
rabbit_management_agent does this in order to collect the statistics 
it's asked for.

The way this works is that when rabbit starts up it looks for boot steps 
in all *loaded* applications. Our boot script loads all applications, 
then starts them. So you need to as well:

~~~~
-module (run_rabbit).

-export ([run/0]).

run () -&gt;
     Apps1 = [sasl, os_mon, mnesia, inets, crypto, mochiweb,
              rabbit_mochiweb],
     Apps2 = [rabbit, amqp_client, rabbit_management_agent, webmachine,
              rabbit_management],

     [ok = application:load(A) || A &lt;- Apps1 ++ Apps2],

     [ok = application:start(A, permanent) || A &lt;- Apps1],
     ok = rabbit:prepare(),
     [ok = application:start(A, permanent) || A &lt;- Apps2],

     ok = timer:sleep(120 * 1000),
     ok = init:stop(),
     ok.
~~~~

&gt;&gt;<i> Also, why have you done this? What problem is it solving?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>      Good question. :) We'll I'm trying to &quot;embed&quot; RabbitMQ into
</I>&gt;<i> another Erlang application -- a web server that instead of handling
</I>&gt;<i> the requests it just puts them on a queue, and waits for the response
</I>&gt;<i> (the same pattern as in the rpc module is doing). I intend to use
</I>&gt;<i> `amqp_client` in with the `direct` connector. I've seen that there is
</I>&gt;<i> a similar project but for SMTP -- `rabbitmq-smtp`.
</I>
I think rabbitmq-smtp is just a regular plugin. You might want to 
consider doing the same thing - turning things inside out so that your 
web server is running as a RabbitMQ plugin. This is more or less exactly 
what the management plugin does.

Or you can continue on your current path, but the extent to which we 
don't support running RabbitMQ this way is quite high :)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010631.html">[rabbitmq-discuss] Strange RabbitMQ management plugin error!
</A></li>
	<LI>Next message: <A HREF="010642.html">[rabbitmq-discuss] Strange RabbitMQ management plugin error!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10640">[ date ]</a>
              <a href="thread.html#10640">[ thread ]</a>
              <a href="subject.html#10640">[ subject ]</a>
              <a href="author.html#10640">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
