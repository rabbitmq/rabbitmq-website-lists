<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Erlang crashes trying to allocate 583848200	bytes of memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Erlang%20crashes%20trying%20to%20allocate%20583848200%0A%09bytes%20of%20memory&In-Reply-To=%3Ca6e30b5f-e859-4e7f-b507-68fd5e5f00b2%40v31g2000pri.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010887.html">
   <LINK REL="Next"  HREF="010723.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Erlang crashes trying to allocate 583848200	bytes of memory</H1>
    <B>Dom54</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Erlang%20crashes%20trying%20to%20allocate%20583848200%0A%09bytes%20of%20memory&In-Reply-To=%3Ca6e30b5f-e859-4e7f-b507-68fd5e5f00b2%40v31g2000pri.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Erlang crashes trying to allocate 583848200	bytes of memory">D.Rotondi at Computer.Org
       </A><BR>
    <I>Tue Jan 25 14:03:45 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010887.html">[rabbitmq-discuss] Erlang crashes trying to allocate 583848200	bytes of memory
</A></li>
        <LI>Next message: <A HREF="010723.html">[rabbitmq-discuss] A developer's topic on the main docs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10892">[ date ]</a>
              <a href="thread.html#10892">[ thread ]</a>
              <a href="subject.html#10892">[ subject ]</a>
              <a href="author.html#10892">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On Jan 25, 12:44&#160;pm, Dom54 &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">D.Roto... at Computer.Org</A>&gt; wrote:
Hi,
perhaps a good news. As announced we are trying to use the same
RabbitMQ version (the last stable one) with the last R14B01 Erlang
release.
The first stress tests seem to work.
We made 2 sets of tests (always using the same test code as indicated
in my previous replies and posted on the RabbitMQ forum), the 1st one
with vm_memory_high_watermark set to 0.25 and the 2nd one at its
default value 0.40.
Both tests seem to work (we run them under Windows Server 2008 R2 64
bit with a 4 GB VM).
In the 1st set we saw a used memory raising up to 512MB (0.25 of 2GB;
I think Erlang is always a 32 bit process, so its max usable address
space is always 2 GB) and them quickly dropping to around 200 MB. I
think the RabbitMQ flow-control mechanism was started and reduced the
pace of the subscriber.
In the 2nd case the memory raised till around 700 MB.

We will due further tests (and compare their speed with similar tests
using ActiveMQ) to finally check if the new Erlang release actually
solve the issue we repoterd.
Thanks to all for their hints and support.
Ciao
   Domenico

&gt;<i> On Jan 25, 11:44&#160;am, Matthias Radestock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matth... at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i> Hi Matthias,
</I>&gt;<i>
</I>&gt;<i> &gt; Dom,
</I>&gt;<i>
</I>&gt;<i> &gt; Dom54 wrote:
</I>&gt;<i> &gt; &gt; To our understanding the RabbitMQ broker (and its supporting
</I>&gt;<i> &gt; &gt; Erlang environment) keeps to be delivered messages in memory; if the
</I>&gt;<i> &gt; &gt; consumer is not fast enough the Erlang memory footprint grows till the
</I>&gt;<i> &gt; &gt; broker crash.
</I>&gt;<i>
</I>&gt;<i> &gt; The rabbit code does not hold on to messages in memory when it has
</I>&gt;<i> &gt; delivered them to consumers and it is under memory pressure.
</I>&gt;<i>
</I>&gt;<i> Thats what I stated above. In memory seems to be buffered only
</I>&gt;<i> messages that have not been delivered.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; But we do rely on the underlying erlang network stack and O/S to tell us
</I>&gt;<i> &gt; when it can't send messages to the consumers. Rather than, say, blindly
</I>&gt;<i> &gt; buffering them. It's possible that therein lies the problem on Windows.
</I>&gt;<i>
</I>&gt;<i> &gt; Btw, when you tweaked the vm_memory_high_watermark settings, did you
</I>&gt;<i> &gt; check that they were actually taking effect? There is a message near the
</I>&gt;<i> &gt; beginning of the rabbit log file indicating how much memory it is trying
</I>&gt;<i> &gt; to limit itself to.
</I>&gt;<i>
</I>&gt;<i> Yes we checked the tweak effect in the log file and the log file
</I>&gt;<i> reflects the setting.
</I>&gt;<i> BTW we have just completed another test using a Windows Server 2008 R2
</I>&gt;<i> 64 bit version on a vM with 4 BG RAM, and the problem is still there.
</I>&gt;<i> We are now trying using the last Erlang release (R14B01) instead of
</I>&gt;<i> the R13B03 included in the RabbitMQ distribution, hoping this release
</I>&gt;<i> has fixed some of the problems.
</I>&gt;<i> Thanks, ciao
</I>&gt;<i> &#160; &#160;Dom
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Regards,
</I>&gt;<i>
</I>&gt;<i> &gt; Matthias.
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010887.html">[rabbitmq-discuss] Erlang crashes trying to allocate 583848200	bytes of memory
</A></li>
	<LI>Next message: <A HREF="010723.html">[rabbitmq-discuss] A developer's topic on the main docs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10892">[ date ]</a>
              <a href="thread.html#10892">[ thread ]</a>
              <a href="subject.html#10892">[ subject ]</a>
              <a href="author.html#10892">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
