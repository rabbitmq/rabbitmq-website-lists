<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Implementing a &quot;processing&quot; queue with message	expiry
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Implementing%20a%20%22processing%22%20queue%20with%20message%0A%09expiry&In-Reply-To=%3CAANLkTikRt91x_VFa1aXqzvMeX1hLE9nDAaA6BHe226Ur%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010642.html">
   <LINK REL="Next"  HREF="010618.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Implementing a &quot;processing&quot; queue with message	expiry</H1>
    <B>Sami Samhuri</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Implementing%20a%20%22processing%22%20queue%20with%20message%0A%09expiry&In-Reply-To=%3CAANLkTikRt91x_VFa1aXqzvMeX1hLE9nDAaA6BHe226Ur%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Implementing a &quot;processing&quot; queue with message	expiry">sami at samhuri.net
       </A><BR>
    <I>Tue Jan 11 00:15:25 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010642.html">[rabbitmq-discuss] Strange RabbitMQ management plugin error!
</A></li>
        <LI>Next message: <A HREF="010618.html">[rabbitmq-discuss] Implementing a &quot;processing&quot; queue with	message expiry
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10614">[ date ]</a>
              <a href="thread.html#10614">[ thread ]</a>
              <a href="subject.html#10614">[ subject ]</a>
              <a href="author.html#10614">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I'm designing a small distributed system with some queueing involved and
have some doubts that Rabbit is the right solution for parts of it. Hoping
that some of you can shed some light and let me know if Rabbit can do it
all, which would be great, or if there's a better and/or simpler solution
I've missed. I realize that Rabbit is for message passing and is not a work
queue, so perhaps I'm trying to shove a square peg into a round hole. If so
please tell me that I'm barking up the wrong tree.

The system is pretty simple and will only have 2 persistent queues, 1
producer, and 1 consumer (initially anyway). Our frontend machine will act
on requests from our users and queue up jobs on request. The worker machine
will get jobs from that queue, process them, and then place the results in a
2nd queue which the frontend machine will consume, making the results
available to our users. So far it's pretty straightforward and RabbitMQ
handles this with ease.

,----------,                    ,--------,
|<i>          |  --- Queue #1 ---&gt; |        |   Work to be done goes in Queue
</I>#1
|<i> Frontend |                    | Worker |
</I>|<i>          | &lt;--- Queue #2 ---  |        |   Completed work goes in Queue #2
</I>`----------`                    `--------`

Now real life has to come along and mess it all up. When a worker is struck
by lightning in the simple system above the job it was working on would be
lost, which is bad. To me it seems like we need a 3rd &quot;queue&quot; that holds
jobs that are currently being processed, and a timeout so that if a job
being processed hasn't completed within N minutes it's put back into the
first queue so another worker can pick up the job. This queue must also be
persistent. The problem is that this 3rd thing isn't really a queue at all.
I'd like to remove any specific item from this thing, whether the job was
completed or timed out, and thus I need to find and remove arbitrary
messages/items.

I feel like I need to write a bit of code that handles the list of
jobs-in-progress and persists it to our main data store (distributed, backed
up, etc). If I do all of that when not just put the other 2 queues in our
main data store as well? Rabbit still buys us a little for those 2 queues,
but not very much. It's easy enough for me to add authenticated HTTP
endpoints and distributed, fault-tolerance persistence for a couple of
queues.

Is there some other solution that makes this easier, or does Rabbit have
something to handle these sorts of cases? If I can't use Rabbit for all of
this it may not be worth adding Rabbit to our infrastructure for the 2 very
simple queues illustrated above.

Thanks for reading this far :)

-s
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110110/2ce3b615/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110110/2ce3b615/attachment.htm</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010642.html">[rabbitmq-discuss] Strange RabbitMQ management plugin error!
</A></li>
	<LI>Next message: <A HREF="010618.html">[rabbitmq-discuss] Implementing a &quot;processing&quot; queue with	message expiry
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10614">[ date ]</a>
              <a href="thread.html#10614">[ thread ]</a>
              <a href="subject.html#10614">[ subject ]</a>
              <a href="author.html#10614">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
