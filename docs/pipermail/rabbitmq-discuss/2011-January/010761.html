<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] php talking to ruby
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20php%20talking%20to%20ruby&In-Reply-To=%3CAANLkTi%3DRm8%3DBNUST7r0T4VygYwedKtkGsYXz%3D2AmfzDt%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010753.html">
   <LINK REL="Next"  HREF="010767.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] php talking to ruby</H1>
    <B>Robin Wood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20php%20talking%20to%20ruby&In-Reply-To=%3CAANLkTi%3DRm8%3DBNUST7r0T4VygYwedKtkGsYXz%3D2AmfzDt%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] php talking to ruby">robin at digininja.org
       </A><BR>
    <I>Wed Jan 19 10:24:14 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010753.html">[rabbitmq-discuss] php talking to ruby
</A></li>
        <LI>Next message: <A HREF="010767.html">[rabbitmq-discuss] php talking to ruby
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10761">[ date ]</a>
              <a href="thread.html#10761">[ thread ]</a>
              <a href="subject.html#10761">[ subject ]</a>
              <a href="author.html#10761">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think I've got a little bit further from where I was when I
originally posted so here are the examples I'm working on now.

This is the Ruby consumer that I've got. It has come directly from the
Gem examples, it just listens for messages:

$:.unshift File.dirname(__FILE__) + '/../../lib'
require 'mq'
require 'pp'

EM.run do

  # connect to the amqp server
  connection = AMQP.connect(:host =&gt; 'localhost', :logging =&gt; false)

  # open a channel on the AMQP connection
  channel = MQ.new(connection)

  # declare a queue on the channel
  queue = MQ::Queue.new(channel, 'queue1')

  # create a fanout exchange
  exchange = MQ::Exchange.new(channel, :direct, 'direct1')

  # bind the queue to the exchange
  queue.bind(exchange)

  # subscribe to messages in the queue
  queue.subscribe do |headers, msg|
    pp [:got, headers, msg]
    connection.close{ EM.stop_event_loop }
  end

end

If I understand things right I've got it setup to listen for direct
messages in queue1 on an exchange called direct1.

Seeing as you are offering help with PECL I've got the example from
the php site

&lt;?php

// Create a connection
$cnn = new AMQPConnection();
$cnn-&gt;connect();

// Declare a new exchange
$ex = new AMQPExchange($cnn);
$ex-&gt;declare('direct1', AMQP_EX_TYPE_DIRECT);

// Create a new queue
$q = new AMQPQueue($cnn);
$q-&gt;declare('queue1');

// Bind it on the exchange to routing.key
$ex-&gt;bind('queue1', 'routing.key');

// Publish a message to the exchange with a routing key
$ex-&gt;publish('message', 'routing.key');

// Read from the queue
$msg = $q-&gt;consume();

?&gt;

This should be trying to publish a message to queue1 on exchange direct1.

When I run the php I get:

PHP Fatal error:  Uncaught exception 'AMQPQueueException' with message
'Server channel error: 406, message: PRECONDITION_FAILED - parameters
for queue 'queue1' in vhost '/' not equivalent' in
/home/robin/sched/a.php:13
Stack trace:
#0 /home/robin/sched/a.php(13): AMQPQueue-&gt;declare('queue1')
#1 {main}
  thrown in /home/robin/sched/a.php on line 13

Don't know if this output will help or not:

scheduler:/etc/php5/cli/conf.d# rabbitmqctl list_queues
Listing queues ...
queue1  0
...done.

scheduler:/etc/php5/cli/conf.d# rabbitmqctl list_vhosts
Listing vhosts ...
/
...done.

scheduler:/etc/php5/cli/conf.d# rabbitmqctl list_exchanges
Listing exchanges ...
amq.rabbitmq.log        topic
amq.match       headers
direct1 direct
amq.headers     headers
amq.topic       topic
amq.direct      direct
amq.fanout      fanout
        direct
...done.


Just in case I'm going about this the wrong way, the aim of all this
is to simply get a php web app to be able to send messages off to a
Ruby scheduler application which then in its own time processes the
request then sends the resulting data back. At the moment it is one to
one communication, that is why I went for direct rather than fanout.

I guess once I get communication going in one direction I hope the
reverse should be fairly simply.

I'd normally prefer to do a lot more reading around a new technology
before shouting for help but I've been given a short deadline and the
communication level is the lowest priority as we could potentially
just do this by calling shell scripts but I'd rather do it the proper
way.

Robin



2011/1/19 Pieter de Zwart &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pdezwart at rubiconproject.com</A>&gt;:
&gt;<i> Robin,
</I>&gt;<i>
</I>&gt;<i> There is no reason why you cant do this. We are currently actively using the
</I>&gt;<i> PHP PECL extension to read messages published by both a Perl and Python
</I>&gt;<i> client. I know I hate it when people ask this of me, but could you cobble
</I>&gt;<i> together some very basic sample code and let us know what client versions
</I>&gt;<i> you are using? If it's the PHP client's fault, I will be more than happy to
</I>&gt;<i> fix it.
</I>&gt;<i>
</I>&gt;<i> me
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 1/18/11 3:45 PM, &quot;Robin Wood&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">robin at digininja.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> 2011/1/18 Alexandre Kalendarev &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">akalend at mail.ru</A>&gt;:
</I>&gt;&gt;<i> Robin,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You must to use
</I>&gt;&gt;<i> the universal  data  format : JSON or XML, or other conventional
</I>&gt;&gt;<i> dataformat.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm completely new to RabbitMQ, any pointers as to where to
</I>&gt;&gt;<i> look for
</I>&gt;<i> this? Do you know if both the libraries I've chosen will do
</I>&gt;&gt;<i> this?
</I>&gt;<i>
</I>&gt;<i> Robin
</I>&gt;<i>
</I>&gt;&gt;<i> Alexandre
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Tue, 18 Jan 2011 20:13:10 +0000 &#1087;&#1080;&#1089;&#1100;&#1084;&#1086; &#1086;&#1090;
</I>&gt;&gt;<i> Robin Wood &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">robin at digininja.org</A>&gt;:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi
</I>&gt;&gt;&gt;<i> I'm trying to get Ruby, using the
</I>&gt;&gt;<i> AMQP gem to talk to PHP using the
</I>&gt;&gt;&gt;<i> php-amqp library. Both on their own work
</I>&gt;&gt;<i> and talk between their own
</I>&gt;&gt;&gt;<i> consumer/publisher but I can't get them to talk
</I>&gt;&gt;<i> cross language.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Before I post my randomly hacked together code does
</I>&gt;&gt;<i> anyone have good
</I>&gt;&gt;&gt;<i> sample code that shows the two languages talking to each
</I>&gt;&gt;<i> other?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I'm new to MQ stuff but roughly what I'm seeing is the channel
</I>&gt;&gt;<i> and
</I>&gt;&gt;&gt;<i> queues are being created OK and messages are being sent but when I
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> watch them in Wireshark I see the PHP one has a content type of
</I>&gt;&gt;&gt;<i> plain/text
</I>&gt;&gt;<i> but the Ruby message has application/octet.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Any tips?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Robin
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing
</I>&gt;&gt;<i> list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing
</I>&gt;&gt;<i> list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i> _______
</I>&gt;&gt;<i> ________________________________________
</I>&gt;<i> rabbitmq-discuss mailing
</I>&gt;&gt;<i> list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/ma">https://lists.rabbitmq.com/cgi-bin/ma</A>
</I>&gt;&gt;<i> ilman/listinfo/rabbitmq-discuss
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> the rubicon project
</I>&gt;<i>
</I>&gt;<i> PIETER DE ZWART | LEAD, INTERFACES TEAM
</I>&gt;<i> *** P 310 207 0272 | x224
</I>&gt;<i> *** C 408 666 4443
</I>&gt;<i> *** F 323 466 7119
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1925 S. BUNDY DRIVE
</I>&gt;<i> LOS ANGELES, CALIFORNIA 90025
</I>&gt;<i>
</I>&gt;<i> WWW.RUBICONPROJECT.COM &lt;<A HREF="http://www.rubiconproject.com/">http://www.rubiconproject.com/</A>&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &quot;MOST INNOVATIVE COMPANY&quot; - AMERICAN BUSINESS AWARDS '10
</I>&gt;<i>  REVV IS OPTIMIZING 1.4 MILLION ADS PER MINUTE
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010753.html">[rabbitmq-discuss] php talking to ruby
</A></li>
	<LI>Next message: <A HREF="010767.html">[rabbitmq-discuss] php talking to ruby
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10761">[ date ]</a>
              <a href="thread.html#10761">[ thread ]</a>
              <a href="subject.html#10761">[ subject ]</a>
              <a href="author.html#10761">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
