<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Shovel bug? Consumer hangs after network failure.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20bug%3F%20Consumer%20hangs%20after%20network%0A%20failure.&In-Reply-To=%3C20110120224502.GA13371%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010793.html">
   <LINK REL="Next"  HREF="010815.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Shovel bug? Consumer hangs after network failure.</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20bug%3F%20Consumer%20hangs%20after%20network%0A%20failure.&In-Reply-To=%3C20110120224502.GA13371%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Shovel bug? Consumer hangs after network failure.">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Jan 20 22:45:02 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010793.html">[rabbitmq-discuss] Shovel bug? Consumer hangs after network failure.
</A></li>
        <LI>Next message: <A HREF="010815.html">[rabbitmq-discuss] Shovel bug? Consumer hangs after network	failure.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10809">[ date ]</a>
              <a href="thread.html#10809">[ thread ]</a>
              <a href="subject.html#10809">[ subject ]</a>
              <a href="author.html#10809">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On Thu, Jan 20, 2011 at 09:03:13AM +0100, &#216;yvind Tjervaag wrote:
&gt;<i> I needed to move messages in both directions between the rabbit
</I>&gt;<i> servers. I first installed the shovel plugin on rabbit2 only, and
</I>&gt;<i> configured that to move messages in both directions. If I consume from
</I>&gt;<i> a queue on Rabbit1 with the shovel on Rabbit2 and disconnect the
</I>&gt;<i> network between them, the consumer doesn't seem to be able to
</I>&gt;<i> reconnect to rabbit1 when the network comes back up, generating errors
</I>&gt;<i> like this:
</I>&gt;<i> 
</I>&gt;<i> The shovel that moves messages from Rabbit2 to Rabbit1 however detects
</I>&gt;<i> that the network was down, and reconnects properly. I've done a
</I>&gt;<i> temporary workaround by always having my shovel plugin on the same
</I>&gt;<i> server where I consume messages.
</I>
Yes, this is largely to be expected. Consuming is an asynchronous
activity and the Rabbit1 -&gt; Rabbit2 shovel is just consuming from queues
on Rabbit1. Until the socket is closed by the kernel, it won't
necessarily notice that Rabbit1 has gone down. TCP timeouts can
sometimes be quite long. So, I would recommend that you turn on
heartbeats on that shovel. Unfortunately, looking through the source, I
see there is no way to turn on heartbeats. Sigh. I'll file a bug and get
that added.

Writing to a socket rather than reading from it is much more likely to
prompt an error quickly. Thus if you make your Rabbit1 -&gt; Rabbit2 shovel
a shovel running in Rabbit1 (i.e. Rabbit1 is pushing to Rabbit2 rather
than Rabbit2 pulling from Rabbit1 as it is currently) then you should
find that's more reliable and copes without the addition of heartbeats.

Best wishes,

Matthew
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010793.html">[rabbitmq-discuss] Shovel bug? Consumer hangs after network failure.
</A></li>
	<LI>Next message: <A HREF="010815.html">[rabbitmq-discuss] Shovel bug? Consumer hangs after network	failure.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10809">[ date ]</a>
              <a href="thread.html#10809">[ thread ]</a>
              <a href="subject.html#10809">[ subject ]</a>
              <a href="author.html#10809">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
