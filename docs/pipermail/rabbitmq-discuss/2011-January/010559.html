<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Handling Undelivered messages in rabbitmq
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Handling%20Undelivered%20messages%20in%20rabbitmq&In-Reply-To=%3C11EC96EC521B304EA05595E6F2987FC2028D4BFB%40EXCHBAN.machcorp.lan%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010558.html">
   <LINK REL="Next"  HREF="010560.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Handling Undelivered messages in rabbitmq</H1>
    <B>Prashant Yadav</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Handling%20Undelivered%20messages%20in%20rabbitmq&In-Reply-To=%3C11EC96EC521B304EA05595E6F2987FC2028D4BFB%40EXCHBAN.machcorp.lan%3E"
       TITLE="[rabbitmq-discuss] Handling Undelivered messages in rabbitmq">PRYD at mach.com
       </A><BR>
    <I>Thu Jan  6 11:49:05 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010558.html">[rabbitmq-discuss] Handling Undelivered messages in rabbitmq
</A></li>
        <LI>Next message: <A HREF="010560.html">[rabbitmq-discuss] Handling Undelivered messages in rabbitmq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10559">[ date ]</a>
              <a href="thread.html#10559">[ thread ]</a>
              <a href="subject.html#10559">[ subject ]</a>
              <a href="author.html#10559">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Emile,

Thanks for the quick response.

I presume by &quot;consumer registered on queue&quot;, you mean binding queue to
the QueuingConsumer in my case. I changed the basicPublish immediate
flag to true and changed the queue declaration and binding of my
consumer.
Still am not able to get any response on my Producer for undelivered
messages.
According to you &quot; If you had 'immediate' set and there were no
consumers registered on any of the relevant queues then
handleBasicReturn would be called &quot;
My set up has single queue where producer is publishing messages and
consumers listens on different queue( which effectively fulfills your
condition, isn't ? I even tried just publishing with no consumers
running, still handleBasicReturn does not get called. 

Regds
Prashant


-----Original Message-----
From: Emile Joubert [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at rabbitmq.com</A>] 
Sent: Thursday, January 06, 2011 4:29 PM
To: Prashant Yadav
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Handling Undelivered messages in
rabbitmq

Hi Prashant,

On 06/01/11 09:15, Prashant Yadav wrote:

&gt;<i> *1)*Publish the messages with Mandatory and Immediate flag sent
</I>&gt;<i> *channel.basicPublish 'exchange' ,'rKey',true,false, props,&quot;Hello
</I>&gt;<i> World&quot;.bytes*
</I>
The 'false' in that call should be 'true' if you want 'immediate' set.

&gt;<i> *2)*The consumer consumes even marked ( I have put numbers from 1..10
</I>as
&gt;<i> marked value in header of each messages) and does not ACKS odd
</I>numbered
&gt;<i> messages.**
</I>&gt;<i>
</I>&gt;<i> *3)*I have implemented setReturnListnere in the publisher to capture
</I>&gt;<i> undelivered messages.**
</I>&gt;<i>
</I>&gt;<i> While am able to get the number of unack messages via Rabbmitmqctl
</I>&gt;<i> list_queues messages_unacknowledged, somehow my handleBasicReturn
</I>method
&gt;<i> does not gets called. Am in missing something.
</I>
In your case the 'mandatory' flag will cause handleBasicReturn to be 
called only if the message cannot be routed, i.e.  the message ends up 
in 0 queues. But your messages can be routed so handleBasicReturn won't 
be called.

If you had 'immediate' set and there were no consumers registered on any

of the relevant queues then handleBasicReturn would be called. But you 
do have consumers registered so handleBasicReturn won't be called.

You could make use of the 'redelivered' flag upon message delivery to 
check whether processing has already been attempted and act accordingly.

You could republish messages to success and failure queues after 
processing, depending on the outcome and depending on how you want to 
treat failed messages.

---

Of possible interest is the ability of the management and monitoring 
plugin to report the number of unacknowledged messages.
See <A HREF="http://www.rabbitmq.com/management.html">http://www.rabbitmq.com/management.html</A> .

You can also retrieve queue depth over AMQP in the queue declare-ok 
return value after passively declaring a queue.


Regards

Emile
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010558.html">[rabbitmq-discuss] Handling Undelivered messages in rabbitmq
</A></li>
	<LI>Next message: <A HREF="010560.html">[rabbitmq-discuss] Handling Undelivered messages in rabbitmq
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10559">[ date ]</a>
              <a href="thread.html#10559">[ thread ]</a>
              <a href="subject.html#10559">[ subject ]</a>
              <a href="author.html#10559">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
