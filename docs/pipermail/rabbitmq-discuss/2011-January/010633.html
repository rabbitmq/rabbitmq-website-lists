<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ JavaAPI Queueing Consumer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20JavaAPI%20Queueing%20Consumer&In-Reply-To=%3C330CB210-9164-4DBA-B37E-A052C003DA52%40vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010607.html">
   <LINK REL="Next"  HREF="010610.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ JavaAPI Queueing Consumer</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20JavaAPI%20Queueing%20Consumer&In-Reply-To=%3C330CB210-9164-4DBA-B37E-A052C003DA52%40vmware.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ JavaAPI Queueing Consumer">jerryk at vmware.com
       </A><BR>
    <I>Tue Jan 11 21:39:54 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010607.html">[rabbitmq-discuss] RabbitMQ JavaAPI Queueing Consumer
</A></li>
        <LI>Next message: <A HREF="010610.html">[rabbitmq-discuss] Pika
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10633">[ date ]</a>
              <a href="thread.html#10633">[ thread ]</a>
              <a href="subject.html#10633">[ subject ]</a>
              <a href="author.html#10633">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Abhishek...

&gt;<i> I want to pass the message to a Separate Java Runnable Class (I am using Java ThreadPool Executors).
</I>&gt;<i> So I want to know how can the separate thread acknowledge the message.
</I>&gt;<i> I believe the message gets re-enqueued once the channel is closed.
</I>
The main thing to keep in mind is that you must avoid sharing channel instances between threads, or, if multiple threads are going to use a particular channel, then you need to handle mutual exclusion of access to that channel in your own code.  

One plausible design for your scenario would be the following.  When you pass a &quot;unit of work&quot; object off to your Executor, have it include a reference to the channel on which you need to ack the message once your work with its contents concludes.  Make sure that you add synchronization to ensure that you have exclusive access to that channel when you make calls on it to ack, etc.

&gt;<i> Also how can I handle channel closing down or going stale (due to reasons like network outage)   in the above scenario.
</I>
If the channel has closed when your executor thread comes to try to work on it, an exception should be thrown when you try to ack (or do pretty much anything else).  

In this case you've got a situation where a message has been sent to you, and received by you, and you've done the work it entailed, but not acknowledged back to Rabbit that your'e done with it.  

Since you haven't managed to transmit an ack back, as far as Rabbit knows this message is still in play and should be requeued.  

The easiest way to take care of this is for your application to be as idempotent as possible in the case where a requeued work-requiring messaging comes in for a second time.

You'll need to do this in any event, since, in addition to a channel or connection going down, your own code could have crashed after doing its work but before sending an ack to let Rabbit to know that it no longer has to worry about your message. 

Best regards,
Jerry

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010607.html">[rabbitmq-discuss] RabbitMQ JavaAPI Queueing Consumer
</A></li>
	<LI>Next message: <A HREF="010610.html">[rabbitmq-discuss] Pika
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10633">[ date ]</a>
              <a href="thread.html#10633">[ thread ]</a>
              <a href="subject.html#10633">[ subject ]</a>
              <a href="author.html#10633">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
