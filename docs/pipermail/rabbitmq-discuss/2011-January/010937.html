<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Massive distributed pub/sub system
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Massive%20distributed%20pub/sub%20system&In-Reply-To=%3C4D4189F4.6010609%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010903.html">
   <LINK REL="Next"  HREF="010945.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Massive distributed pub/sub system</H1>
    <B>Michael Bridgen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Massive%20distributed%20pub/sub%20system&In-Reply-To=%3C4D4189F4.6010609%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Massive distributed pub/sub system">mikeb at rabbitmq.com
       </A><BR>
    <I>Thu Jan 27 15:06:28 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010903.html">[rabbitmq-discuss] Massive distributed pub/sub system
</A></li>
        <LI>Next message: <A HREF="010945.html">[rabbitmq-discuss] Massive distributed pub/sub system
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10937">[ date ]</a>
              <a href="thread.html#10937">[ thread ]</a>
              <a href="subject.html#10937">[ subject ]</a>
              <a href="author.html#10937">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Kaiduan,

Your questions suggest you're attempting something very interesting, 
which I would love to hear more about.  Federation and distribution are 
very much on our minds here at Rabbit Towers, as you might imagine.

In the meantime ---

&gt;<i> 1) Any user can subscribe to the interested topic, but only topic
</I>&gt;<i> owner can publish message to the group. There is no limit on the
</I>&gt;<i> number of subscribers in each group. Potentially it can be huge, for
</I>&gt;<i> example, the fans of U2 around the world.
</I>
Is there anything that determines who can own topics?  For example, is 
it just the first person to declare a topic that is the exclusive 
publisher to that topic?  Can the publishing rights, so to speak, be 
handed to another publisher?

&gt;<i> 2) User including subscriber and publisher is not always connected to
</I>&gt;<i> the system, and not always connected to the same node in the system,
</I>&gt;<i> and the message delivery should be guaranteed. When publisher
</I>&gt;<i> publishes a message, the system should deliver the message to all
</I>&gt;<i> subscribers. If the subscriber is connected to the system, the message
</I>&gt;<i> should be delivered immediately. If the subscriber is not connected,
</I>&gt;<i> system should hold the message, and the next time the user comes
</I>&gt;<i> connected, system will deliver the message to the user. Just imagine
</I>&gt;<i> the user can be any mobile user and moves out of cellular coverage.
</I>
So far as I know, this is still an area of active research.  Typically, 
distributed pub/sub systems like Scribe and Hermes give rather weak 
guarantees of delivery and ordering and so on.

In particular, &quot;If the subscriber is not connected, system should hold 
the message, and the next time the user comes connected, system will 
deliver the message to the user&quot; is difficult if the subscriber can 
connect to any node, and I don't think most pub/sub systems would allow 
that.

&gt;<i> 3) The system should be able to support tens to hundreds of millions
</I>&gt;<i> users spreading around the world, so the system will consist hundred
</I>&gt;<i> of nodes located in different physical locations.
</I>
This is rather ambitious.  But systems on this kind of scale are indeed 
being built: <A HREF="http://ci.oceanobservatories.org/">http://ci.oceanobservatories.org/</A> for instance.

&gt;<i> 4) The number of topics/groups in the system is unlimited.
</I>&gt;<i>
</I>&gt;<i> 5) As to the latency, it should be in the range of 1 minute if
</I>&gt;<i> subscriber is connected.
</I>&gt;<i>
</I>&gt;<i> It looks like RabbitMQ already has functionalities to meet the above
</I>&gt;<i> requirement, for example, fan out exchange, and persistent message.
</I>&gt;<i> The following is my understanding on how to build the above system
</I>&gt;<i> with RabbitMQ,
</I>
Perhaps, in the sense that it can be a building block.  But it doesn't 
fulfill all the requirements you've given above, &quot;out of the box&quot;.  In 
other words, you (or we) would have to invent a substantial part of the 
technology.

&gt;<i> a) Publisher creates an exchange. For example, U2 creates an exchange
</I>&gt;<i> noted as &quot;U2&quot; for &quot;U2's next world wide tour&quot; on Node 1.
</I>&gt;<i>
</I>&gt;<i> b) Each subscriber creates a queue in the system. For example, Alice
</I>&gt;<i> creates a queue noted as &quot;Alice&quot; on Node 2 and binds to exchange U2;
</I>&gt;<i> and Bob creates a queue noted as &quot;Bob&quot; on Node 3 and binds to exchange
</I>&gt;<i> &quot;U2&quot; on Node 2.
</I>&gt;<i>
</I>&gt;<i> c) U2 publishes a message, m1 on Node 1 to exchange &quot;U2&quot;; and RabbitMQ
</I>&gt;<i> will deliver the message m1 to queue &quot;Alice&quot; on Node 2 and to queue
</I>&gt;<i> &quot;Bob&quot; on Node 3.
</I>&gt;<i>
</I>&gt;<i> How we handles the following scenarios?
</I>&gt;<i>
</I>&gt;<i> 1) When U2 wants to publish a message, but Node 1 is done.
</I>&gt;<i>
</I>&gt;<i> 2) When message m1 is delivered to queue &quot;Alice&quot; on Node 2, Node 2
</I>&gt;<i> crashed or the network link between Node 1 (publisher's node) is
</I>&gt;<i> disconnected? Will exchange &quot;U2&quot; on Node 1 persist the message?
</I>
No; the message will be lost so far as Alice is concerned.  In AMQP 
terms, you're asking for queues to be replicated.  Rabbit doesn't do 
this, yet.

(Actually, we are working on queue replication right now.  I think you 
would need both replication and some kind of queue migration or 
distribution.)

&gt;<i> 3) After message m1 is arrived on queue &quot;Alice&quot;, but the connection
</I>&gt;<i> between Alice and Node 2 is gone, the message will be stored on Node
</I>&gt;<i> 2, right? Next time, Alice connects to the system, but she is
</I>&gt;<i> connected to Node n instead of Node 2, how to handle this?
</I>
In Rabbit's clustering as it works now, the messages will be delivered 
across the cluster to Node n.

&gt;<i> 4) What is the multi-cast technology used in RabbitMQ to deliver the
</I>&gt;<i> message to queues located on different locations spreading around
</I>&gt;<i> different countries?
</I>
There isn't any right now.  Clustering is really for nodes that are 
co-located and have reliable connections.  It uses Erlang's distribution 
mechanism, which essentially forms a fully-connected graph of nodes.  It 
doesn't really scale beyond a handful of nodes.

There /is/ a plugin called the &quot;shovel&quot;, which will relay messages from 
one broker to another.  However, it is statically configured, and 
constrained by using AMQP to do the relaying (i.e., you cannot tell it 
to relay all messages from a direct exchange; only to relay, e.g., 
messages with a particular routing key).


Regards,
Michael
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010903.html">[rabbitmq-discuss] Massive distributed pub/sub system
</A></li>
	<LI>Next message: <A HREF="010945.html">[rabbitmq-discuss] Massive distributed pub/sub system
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10937">[ date ]</a>
              <a href="thread.html#10937">[ thread ]</a>
              <a href="subject.html#10937">[ subject ]</a>
              <a href="author.html#10937">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
