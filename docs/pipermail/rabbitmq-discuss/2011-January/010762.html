<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consumers stops to pick up messages after long inactivity
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumers%20stops%20to%20pick%20up%20messages%20after%0A%20long%20inactivity&In-Reply-To=%3C4D36BE5C.6070106%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010668.html">
   <LINK REL="Next"  HREF="010611.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consumers stops to pick up messages after long inactivity</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumers%20stops%20to%20pick%20up%20messages%20after%0A%20long%20inactivity&In-Reply-To=%3C4D36BE5C.6070106%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Consumers stops to pick up messages after long inactivity">emile at rabbitmq.com
       </A><BR>
    <I>Wed Jan 19 10:35:08 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010668.html">[rabbitmq-discuss] Consumers stops to pick up messages after	long inactivity
</A></li>
        <LI>Next message: <A HREF="010611.html">[rabbitmq-discuss] Strange RabbitMQ management plugin error!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10762">[ date ]</a>
              <a href="thread.html#10762">[ thread ]</a>
              <a href="subject.html#10762">[ subject ]</a>
              <a href="author.html#10762">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Neha,

It is possible that the combination of broker restarts and automatic 
connection re-establishment is part of the problem. Are you able to 
repeat the test over a weekend without restarting the broker and see 
whether the outcome is any different?

Regards

Emile

On 18/01/11 18:01, Neha wrote:
 &gt; Hi Emile
 &gt;
 &gt; I tracked the status of the connection by logging the value of
 &gt; 'connection.isOpen()'. I observed that somewhere in between it became
 &gt; false, i.e. the connection was closed. It doesn't give me any
 &gt; exceptions or the reason why the connection was closed. The connection
 &gt; is not null, thus it still exits but is closed. The broker log file
 &gt; shows that after the connection is closed it retries to establish the
 &gt; shared rabbit mq connection and is successful. It restarts the broker
 &gt; too. I have a logic in place where after the broker is restarted it
 &gt; puts the messages back in the queue. Once the connection is
 &gt; reestablished and broker is restarted the 'connection.isOpen()' always
 &gt; remains false. The broker still publishes messages on the queue but
 &gt; the consumer is unable to consume it.
 &gt;
 &gt; I restarted the consumer and it starts picking up the messages on the
 &gt; queue.
 &gt;
 &gt; Is there a way to find out the reason why the connection was closed?
 &gt; Also once the connection is re-established again, is it necessary to
 &gt; restart the consumer as well?


On 13/01/11 19:46, Neha wrote:
&gt;<i> Hi Emile
</I>&gt;<i>
</I>&gt;<i> Thanks for the reply.
</I>&gt;<i> I checked the broker logfiles and it has a few
</I>&gt;<i> &quot;AutoFailoverConnectionFactory&quot; messages. But it again connects
</I>&gt;<i> successfully.
</I>&gt;<i> I checked the timeout and that is listed as 0.
</I>&gt;<i> To check the clients connected to the broker I'll have to wait for
</I>&gt;<i> Monday and see if the brokers considers the consumers to be connected.
</I>&gt;<i>
</I>&gt;<i> Will keep this post updated with the cause of the problem.
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i> Neha
</I>&gt;<i>
</I>&gt;<i> On Jan 11, 10:47 am, Emile Joubert&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">em... at rabbitmq.com</A>&gt;  wrote:
</I>&gt;&gt;<i> Hi Neha,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 10/01/11 21:57, Neha wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I have an application which uses rabbitmq. It has messages being sent
</I>&gt;&gt;&gt;<i> from Monday to Friday and on the weekend there are no messages sent.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The application works fine on regular days, i.e producers puts the
</I>&gt;&gt;&gt;<i> message on the queue and the consumer receives the message. But every
</I>&gt;&gt;&gt;<i> Monday, after the weekend the consumer starts behaving strangely. It
</I>&gt;&gt;&gt;<i> stops receiving messages even though the queue has messages present.
</I>&gt;&gt;&gt;<i> The heartbeat of the consumer all this time is working fine but it
</I>&gt;&gt;&gt;<i> still doesn't receive all these messages on the queue. To overcome
</I>&gt;&gt;&gt;<i> this problem I have to restart the consumers every Monday, and as soon
</I>&gt;&gt;&gt;<i> as I do that, all the messages that are present in the queue starts
</I>&gt;&gt;&gt;<i> getting consumed.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Looking at a problem, I feel it might be due to inactivity during the
</I>&gt;&gt;&gt;<i> weekend. I wanted to know if anyone else has faced this problem
</I>&gt;&gt;&gt;<i> wherein the consumer stops consuming after a long duration of
</I>&gt;&gt;&gt;<i> inactivity? Is there a setting to be tweaked to increase this period?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Long periods of inactivity should have no effect. The problem is almost
</I>&gt;&gt;<i> certainly network-related. Here are some things to check.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is there anything of interest in the broker logfile?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As there any device along the network path that might have caused the
</I>&gt;&gt;<i> connections to be reset?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does the broker consider the clients to be connected on Monday mornings?
</I>&gt;&gt;<i> &quot;rabbitmqctl list_connections&quot; and &quot;rabbitmqctl list_consumers&quot; can help
</I>&gt;&gt;<i> determine this. The logfile will show when any connections were
</I>&gt;&gt;<i> terminated. Also verify the connection timeout (rabbitmqctl
</I>&gt;&gt;<i> list_connections timeout).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You may want to try using a different connection heartbeat value and
</I>&gt;&gt;<i> check whether the message consumers are able to recover from network
</I>&gt;&gt;<i> interruptions automatically.
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010668.html">[rabbitmq-discuss] Consumers stops to pick up messages after	long inactivity
</A></li>
	<LI>Next message: <A HREF="010611.html">[rabbitmq-discuss] Strange RabbitMQ management plugin error!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10762">[ date ]</a>
              <a href="thread.html#10762">[ thread ]</a>
              <a href="subject.html#10762">[ subject ]</a>
              <a href="author.html#10762">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
