<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ management plugin memory usage in	Chrome
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20management%20plugin%20memory%20usage%20in%0A%09Chrome&In-Reply-To=%3CAANLkTinLwKRVQ-Nd7bnG_92G5jjwcoQExpUj5vVYkwU_%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010925.html">
   <LINK REL="Next"  HREF="010955.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ management plugin memory usage in	Chrome</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20management%20plugin%20memory%20usage%20in%0A%09Chrome&In-Reply-To=%3CAANLkTinLwKRVQ-Nd7bnG_92G5jjwcoQExpUj5vVYkwU_%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ management plugin memory usage in	Chrome">majek04 at gmail.com
       </A><BR>
    <I>Thu Jan 27 08:59:07 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010925.html">[rabbitmq-discuss] RabbitMQ management plugin memory usage in Chrome
</A></li>
        <LI>Next message: <A HREF="010955.html">[rabbitmq-discuss] RabbitMQ management plugin memory usage in	Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10931">[ date ]</a>
              <a href="thread.html#10931">[ thread ]</a>
              <a href="subject.html#10931">[ subject ]</a>
              <a href="author.html#10931">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Jan 26, 2011 at 23:15, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
&gt;<i> On 25/01/2011 9:14AM, Jon Rowland wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I don't have Firefox but I tried this in IE 8.0 and get the same
</I>&gt;&gt;<i> behaviour (1GB usage after leaving running overnight).
</I>&gt;<i>
</I>&gt;<i> Hmm. Not sure IE counts as much evidence for the bug being in the plugin :)
</I>&gt;<i>
</I>&gt;<i> But seeing the same problem in two browsers is a concern.
</I>&gt;<i>
</I>&gt;<i> But I still have no idea how to debug this kind of problem.
</I>&gt;<i>
</I>&gt;<i> But I'll have a look anyway.
</I>&gt;<i>
</I>&gt;<i> But I'm not promising anything.
</I>
Simon,

There definitely is a memory leak. Actually, not a memory
leak - it's just the document that is growing, the
elements aren't leaked, they are referenced somewhere.

I did some debugging and I have some results.
Though, there is probably still much to be said.

1. in main.js we use innerHTML in one place, it's helpful to
    zero the element out before that:
<A HREF="http://javascript.crockford.com/memory/leak.html">http://javascript.crockford.com/memory/leak.html</A>

2. I modified the purge() function above to unlink all childs,
   and it seems to work a bit better. (ie: explicitly unlink all
   elements of the tree)

3. The single biggest thing is IMO broken element caching
    in jQuery. Check out jQuery.fragments. It's growing...
    Removing this cache by hacking jQuery brought
    wonderful results. (there is also jQuery.cache, but
    I haven't played with that).
    Basically, in one of the tests I noticed that Dom nodes
    &quot;document-fragment&quot; were using the majority of memory.

4. In the queue view  there is a gc-cycle in the &lt;form&gt;
    responsible for adding a queue. I'm not sure what
    can be done about that.

5. In some other test I noticed that &quot;slideUp/Down&quot; and
    &quot;toggleUp/Down&quot; methods were increasing memory
    usage significantly, but that may be a false lead,
    as it may have something to do with the 'document-fragment'
    issue mentioned above.

6. For debugging I used 'sieve' for IE.
      <A HREF="http://home.wanadoo.nl/jsrosman/">http://home.wanadoo.nl/jsrosman/</A>
    It's a simple tool but allows traversing the DOM and looking
    at what contains what. It would be nice to find a similar
    tool for chrome and firefox.


Cheers,
  Marek
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010925.html">[rabbitmq-discuss] RabbitMQ management plugin memory usage in Chrome
</A></li>
	<LI>Next message: <A HREF="010955.html">[rabbitmq-discuss] RabbitMQ management plugin memory usage in	Chrome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10931">[ date ]</a>
              <a href="thread.html#10931">[ thread ]</a>
              <a href="subject.html#10931">[ subject ]</a>
              <a href="author.html#10931">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
