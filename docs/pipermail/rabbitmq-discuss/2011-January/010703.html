<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cannot start cluster?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cannot%20start%20cluster%3F&In-Reply-To=%3C4D3187FB.9090705%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010699.html">
   <LINK REL="Next"  HREF="010705.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cannot start cluster?</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cannot%20start%20cluster%3F&In-Reply-To=%3C4D3187FB.9090705%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Cannot start cluster?">simon at rabbitmq.com
       </A><BR>
    <I>Sat Jan 15 11:41:47 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010699.html">[rabbitmq-discuss] Cannot start cluster?
</A></li>
        <LI>Next message: <A HREF="010705.html">[rabbitmq-discuss] Custom storage backends for queues (MySQL)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10703">[ date ]</a>
              <a href="thread.html#10703">[ thread ]</a>
              <a href="subject.html#10703">[ subject ]</a>
              <a href="author.html#10703">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/01/2011 7:38PM, Brian Parkinson wrote:
&gt;<i> Hello - starting to play with clustering - I am using Rabbit 2.2.0 on
</I>&gt;<i> Mac.
</I>&gt;<i>
</I>&gt;<i> Running one server (either by 'rabbit-server' or 'rabbit-multi
</I>&gt;<i> start_all 1') works fine. Trying to start a cluster with 2 nodes
</I>&gt;<i> fails - see output below.
</I>&gt;<i>
</I>&gt;<i> 1. Any ideas?
</I>
Hi Brian. If I had to guess I would say this is because you've got the 
management plugin installed. rabbitmq-multi assigns sequential AMQP 
listening ports for the nodes it starts, but it doesn't know anything 
about the port opened by rabbitmq_mochiweb (or any other ports the nodes 
might be configured to open - SSL, STOMP etc).

I think you'll want to start the nodes without using rabbitmq-multi, 
just with multiple invocations of rabbitmq-server, using environment 
variables to configure each node differently. I use a script like:

start-node.sh:
~~~~
#!/bin/sh
RABBITMQ_NODE_PORT=$1 RABBITMQ_NODENAME=$2 \
RABBITMQ_MNESIA_DIR=/tmp/rabbitmq-$2-mnesia \
RABBITMQ_PLUGINS_EXPAND_DIR=/tmp/rabbitmq-$2-plugins-scratch \
RABBITMQ_LOG_BASE=/tmp \
RABBITMQ_SERVER_START_ARGS=&quot;-rabbit_mochiweb port 5$1&quot; \
/path/to/rabbitmq-server
~~~~

and then invoke it as

start-node.sh 5672 rabbit
start-node.sh 5673 hare

etc. Note that this will start RabbitMQ in the foreground.

Note that neither rabbitmq-multi nor this approach will actually cluster 
the nodes; you'll need something like:

rabbitmqctl stop_app
rabbitmqctl reset
rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at hostname</A> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">hare at hostname</A>
rabbitmqctl start_app

to form a cluster.

&gt;<i> 2. A quick question/confirmation about a cluster. Assume I have a
</I>2-node cluster running, and my client app connects via a
ConnectionFactory pointing at host/port of node1. If node1 then goes
down, will my client app continue to talk to node2?

No, I'm afraid you need to handle reconnection yourself.

Cheers, Simon
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010699.html">[rabbitmq-discuss] Cannot start cluster?
</A></li>
	<LI>Next message: <A HREF="010705.html">[rabbitmq-discuss] Custom storage backends for queues (MySQL)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10703">[ date ]</a>
              <a href="thread.html#10703">[ thread ]</a>
              <a href="subject.html#10703">[ subject ]</a>
              <a href="author.html#10703">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
