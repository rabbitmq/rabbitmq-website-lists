<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] failure on startup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20failure%20on%20startup&In-Reply-To=%3CF78BCF638F95D74A99D036114107EDB5023948CC1F%40EXCH-MBX-3.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010789.html">
   <LINK REL="Next"  HREF="010788.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] failure on startup</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20failure%20on%20startup&In-Reply-To=%3CF78BCF638F95D74A99D036114107EDB5023948CC1F%40EXCH-MBX-3.vmware.com%3E"
       TITLE="[rabbitmq-discuss] failure on startup">jerryk at vmware.com
       </A><BR>
    <I>Thu Jan 20 01:20:21 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010789.html">[rabbitmq-discuss] failure on startup
</A></li>
        <LI>Next message: <A HREF="010788.html">[rabbitmq-discuss] New rebar template for RabbitMQ plugins
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10791">[ date ]</a>
              <a href="thread.html#10791">[ thread ]</a>
              <a href="subject.html#10791">[ subject ]</a>
              <a href="author.html#10791">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>  jailed FreeBSD 8.x, rabbitmq 2.1.0_1, erlang-lite-r14b01,1 hydra#
</I>&gt;<i> /usr/local/etc/rc.d/rabbitmq start
</I>&gt;<i> {error_logger,{{2011,1,19},{14,40,28}},&quot;Protocol: ~p: register
</I>&gt;<i> error:
</I>&gt;<i> ~p~n&quot;,[&quot;inet_tcp&quot;,{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1},{net&gt;
</I>&gt;<i> _kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
</I>&gt;<i>
</I>&gt;<i> [ rest of dump deleted ]
</I>&gt;<i>
</I>
It looks like your Rabbit is having trouble connecting to epmd, the
Erlang Port Mapper Daemon.  When an Erlang VM fires up it tries to
register itself with a daemon listening on port 4369 by default, and
starts one if it can't find one.

Can you 'ps' and see if you have an epmd process up and running?  Can
your Erlang node connect to it when running in the jailed
configuration you're in?  If you just try to start up a distributed
Erlang node with a bogus name like so:

erl -name bogusnode

what happens?

If you need to start an epmd up to play with you can see its man page
with:

erl -man epmd

There are reports that Erlang 14B may have a congenital problem with
free BSD jails due to some hardcoding that expects to find epmd at
127.0.0.1.  I gather that jails rewrite connections to localhost with
the IP address that the jail is bound to, which trips up some checks
that Erlang does.  The thread below discusses a patch for this
behavior dating from late last fall.  I don't know what it's release
status is:

<A HREF="http://groups.google.com/group/erlang-programming/msg/244597dd7f874e73">http://groups.google.com/group/erlang-programming/msg/244597dd7f874e73</A>

<A HREF="http://groups.google.com/group/mailing.freebsd.ports/browse_thread/thread/1f7210334fc11646">http://groups.google.com/group/mailing.freebsd.ports/browse_thread/thread/1f7210334fc11646</A>

There are claims that switching to a slightly older Erlang, with which
Rabbit ought to still work, may help as well.  My jail knowledge is
super rusty, but it might also be possible to reconfigure your jail's
settings to give Erlang something more akin to the vanilla localhost
it's expecting...

Best regards,
Jerry
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010789.html">[rabbitmq-discuss] failure on startup
</A></li>
	<LI>Next message: <A HREF="010788.html">[rabbitmq-discuss] New rebar template for RabbitMQ plugins
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10791">[ date ]</a>
              <a href="thread.html#10791">[ thread ]</a>
              <a href="subject.html#10791">[ subject ]</a>
              <a href="author.html#10791">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
