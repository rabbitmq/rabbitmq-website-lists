<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] (pika) slow asyncore loop?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%28pika%29%20slow%20asyncore%20loop%3F&In-Reply-To=%3C4D3F346A.2030106%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010898.html">
   <LINK REL="Next"  HREF="010905.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] (pika) slow asyncore loop?</H1>
    <B>Marcin Krol</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%28pika%29%20slow%20asyncore%20loop%3F&In-Reply-To=%3C4D3F346A.2030106%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] (pika) slow asyncore loop?">mrkafk at gmail.com
       </A><BR>
    <I>Tue Jan 25 20:36:58 GMT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="010898.html">[rabbitmq-discuss] Making sure a message gets to every consumer
</A></li>
        <LI>Next message: <A HREF="010905.html">[rabbitmq-discuss] (pika) slow asyncore loop?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10900">[ date ]</a>
              <a href="thread.html#10900">[ thread ]</a>
              <a href="subject.html#10900">[ subject ]</a>
              <a href="author.html#10900">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


Apparently I'm having RPC responses coming back to client before
asyncore loop in pika can react. It reacts later, but slowly, like 20-30
seconds later than callbacks happen.

Setup: rpc client sends a message to fanout exchange, gets 3 replies
from 3 servers back. That is not a problem.

The thing is, callbacks apparently happen before asyncore loop can do
another iteration.

Loop:

while respnum &lt; servnum:
        pika.asyncore_loop(count=1)
        respnum += 1
        print 'respnum', respnum, 'at',
datetime.datetime.now().strftime('%H:%S')


Output from client:
 . sending  hello 20:23 at 20:23
#### (below is callback output ####
 . recvd  echo: hello 20:23 at 20:23
 . recvd  echo: hello 20:23 at 20:23
 . recvd  echo: hello 20:23 at 20:23
#### below there's output produced while exiting and entering asyncore
loop ####
respnum 1 at 20:23
respnum 2 at 20:53
respnum 3 at 20:23

2nd iteration of asyncore loop happened 20 seconds later than callback
(. recvd) happened.

Is there any way to deal with it, other than rather naive solutions like
delaying basic_publish in server?



Server code:

<A HREF="http://pastie.org/pastes/1497146/text">http://pastie.org/pastes/1497146/text</A>

Client code:

<A HREF="http://pastie.org/pastes/1497144/text">http://pastie.org/pastes/1497144/text</A>

- --

Regards,
mk

- --
Premature optimization is the root of all fun.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (MingW32)
Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org/">http://enigmail.mozdev.org/</A>

iQEcBAEBAgAGBQJNPzRqAAoJEFMgHzhQQ7hO/IQH/3F6LtLungt7tj3j5DD8tICe
CYr7LppIFPUrWiVialnhai2OaQNzM217Fexd7SGAhW90ixX7Bl3n5n7Rq0CgjyGn
h92/N4AlyqeXxQvhefgBtt54TXHMpgMhJcyqzOBh6B/pxEia5MjeNLIWf6KwJwmH
aiv4FjJsN3Ba6GrVhhM2r2WoYj17mTN9jZg+RA29KrMINW3q9isJUy005uMJ+kn2
Liy4Fs/iOctMH0npdQaANL8zjfYbd5i7DGbn4Z/u1i5dvZ5ZHH4oJiswzqRPlxSz
P8k0n0F8xSCLWxWUBOx6sWO2p7L+0tG4cGkWrSjI4/dELUKbEbwmSukS60+bXWY=
=vzB/
-----END PGP SIGNATURE-----
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010898.html">[rabbitmq-discuss] Making sure a message gets to every consumer
</A></li>
	<LI>Next message: <A HREF="010905.html">[rabbitmq-discuss] (pika) slow asyncore loop?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10900">[ date ]</a>
              <a href="thread.html#10900">[ thread ]</a>
              <a href="subject.html#10900">[ subject ]</a>
              <a href="author.html#10900">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
