<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after	several hours running MulticastMain from 1.7.2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%201.7.2%20with%20Erlang%20R13B04%20crashes%20after%0A%09several%20hours%20running%20MulticastMain%20from%201.7.2&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006765.html">
   <LINK REL="Next"  HREF="006778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after	several hours running MulticastMain from 1.7.2</H1>
    <B>John Apps</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%201.7.2%20with%20Erlang%20R13B04%20crashes%20after%0A%09several%20hours%20running%20MulticastMain%20from%201.7.2&In-Reply-To="
       TITLE="[rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after	several hours running MulticastMain from 1.7.2">johndapps at gmail.com
       </A><BR>
    <I>Thu Apr  1 15:58:57 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006765.html">[rabbitmq-discuss] New RabbitMQ Groovy DSL
</A></li>
        <LI>Next message: <A HREF="006778.html">[rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after several hours running MulticastMain from 1.7.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6766">[ date ]</a>
              <a href="thread.html#6766">[ thread ]</a>
              <a href="subject.html#6766">[ subject ]</a>
              <a href="author.html#6766">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wondering why this crashes when vm_memory_high_watermark is set?

This message &quot;vm_memory_high_watermark set. Memory used:935,079,976
allowed:858,993,459&quot; is rather intriguing, or am I missing something? (The
commas were inserted by me in order to make the number more legible.)

Environment:

   - Windows 7 X64 (4GB memory)
   - RabbitMQ 1.7.2
   - Erlang R13B04

rabbitmq.config

[
  {rabbit, [{vm_memory_high_watermark, 0.4}]},
  {rabbit, [{memory_alarms, true}]},
  {mnesia, [{dump_log_write_threshold, 1000}]},
  {rabbit, []}
].


Running these two clients:

   - MulticastMain -y 0 -s 128 -e e -t fanout -r 1100 -f persistent
   - MulticastMain -x 0 -e e -t fanout -y 10 -n 500 -q 1000

The broker crashed with:

Thu Apr 01 15:22:19 2010
Slogan: eheap_alloc: Cannot allocate 153052320 bytes of memory (of type
&quot;heap&quot;).
System version: Erlang R13B04 (erts-5.7.5) [smp:2:2] [rq:2]
[async-threads:30]
Compiled: Mon Feb 22 20:02:36 2010


--- this is the log file ---
=INFO REPORT==== 1-Apr-2010::15:15:04 ===
Memory limit set to 819MB.

=INFO REPORT==== 1-Apr-2010::15:15:04 ===
disk_log: repairing
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.2/db/BIGPOOH-mnesia/ra
bbit_persister.LOG&quot; ...
=INFO REPORT==== 1-Apr-2010::15:15:08 ===
Repaired persister log - 501 recovered, 0 bad
=INFO REPORT==== 1-Apr-2010::15:15:21 ===
Rolling persister log to
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.2/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous&quot;
=INFO REPORT==== 1-Apr-2010::15:15:22 ===
started TCP Listener on 0.0.0.0:5672
=INFO REPORT==== 1-Apr-2010::15:17:50 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37477
=INFO REPORT==== 1-Apr-2010::15:17:50 ===
starting TCP connection &lt;0.315.0&gt; from 127.0.0.1:37477
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37484
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
starting TCP connection &lt;0.339.0&gt; from 127.0.0.1:37484
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37485
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
starting TCP connection &lt;0.345.0&gt; from 127.0.0.1:37485
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37488
=INFO REPORT==== 1-Apr-2010::15:18:08 ===
starting TCP connection &lt;0.352.0&gt; from 127.0.0.1:37488
=INFO REPORT==== 1-Apr-2010::15:18:09 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37489
=INFO REPORT==== 1-Apr-2010::15:18:09 ===
starting TCP connection &lt;0.362.0&gt; from 127.0.0.1:37489
=INFO REPORT==== 1-Apr-2010::15:18:10 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37490
=INFO REPORT==== 1-Apr-2010::15:18:10 ===
starting TCP connection &lt;0.371.0&gt; from 127.0.0.1:37490
=INFO REPORT==== 1-Apr-2010::15:18:11 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37491
=INFO REPORT==== 1-Apr-2010::15:18:11 ===
starting TCP connection &lt;0.383.0&gt; from 127.0.0.1:37491
=INFO REPORT==== 1-Apr-2010::15:18:12 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37492
=INFO REPORT==== 1-Apr-2010::15:18:12 ===
starting TCP connection &lt;0.393.0&gt; from 127.0.0.1:37492
=INFO REPORT==== 1-Apr-2010::15:18:13 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37493
=INFO REPORT==== 1-Apr-2010::15:18:13 ===
starting TCP connection &lt;0.404.0&gt; from 127.0.0.1:37493
=INFO REPORT==== 1-Apr-2010::15:18:16 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37494
=INFO REPORT==== 1-Apr-2010::15:18:16 ===
starting TCP connection &lt;0.419.0&gt; from 127.0.0.1:37494
=INFO REPORT==== 1-Apr-2010::15:18:20 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:37496
=INFO REPORT==== 1-Apr-2010::15:18:20 ===
starting TCP connection &lt;0.440.0&gt; from 127.0.0.1:37496
=INFO REPORT==== 1-Apr-2010::15:18:37 ===
Rolling persister log to
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.2/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous&quot;
=INFO REPORT==== 1-Apr-2010::15:20:25 ===
Rolling persister log to
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.2/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous&quot;
=INFO REPORT==== 1-Apr-2010::15:21:38 ===
vm_memory_high_watermark set. Memory used:935079976 allowed:858993459
=INFO REPORT==== 1-Apr-2010::15:21:39 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 1-Apr-2010::15:21:41 ===
vm_memory_high_watermark clear. Memory used:857734144 allowed:858993459
=INFO REPORT==== 1-Apr-2010::15:21:41 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 1-Apr-2010::15:21:54 ===
Rolling persister log to
&quot;c:/AMQP/RabbitMQ/rabbitmq_server-1.7.2/db/BIGPOOH-mnes
ia/rabbit_persister.LOG.previous&quot;
=INFO REPORT==== 1-Apr-2010::15:22:12 ===
vm_memory_high_watermark set. Memory used:874137976 allowed:858993459
=INFO REPORT==== 1-Apr-2010::15:22:12 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}
=INFO REPORT==== 1-Apr-2010::15:22:15 ===
vm_memory_high_watermark clear. Memory used:829796064 allowed:858993459
=INFO REPORT==== 1-Apr-2010::15:22:15 ===
    alarm_handler: {clear,vm_memory_high_watermark}
=INFO REPORT==== 1-Apr-2010::15:22:17 ===
vm_memory_high_watermark set. Memory used:861047168 allowed:858993459
=INFO REPORT==== 1-Apr-2010::15:22:17 ===
    alarm_handler: {set,{vm_memory_high_watermark,[]}}

--- end of log file ---
---
John Apps
(49) 171 869 1813
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100401/0e615e26/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100401/0e615e26/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006765.html">[rabbitmq-discuss] New RabbitMQ Groovy DSL
</A></li>
	<LI>Next message: <A HREF="006778.html">[rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after several hours running MulticastMain from 1.7.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6766">[ date ]</a>
              <a href="thread.html#6766">[ thread ]</a>
              <a href="subject.html#6766">[ subject ]</a>
              <a href="author.html#6766">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
