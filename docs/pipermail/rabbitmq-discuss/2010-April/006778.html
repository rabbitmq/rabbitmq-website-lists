<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after several hours running MulticastMain from 1.7.2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%201.7.2%20with%20Erlang%20R13B04%20crashes%0A%20after%20several%20hours%20running%20MulticastMain%20from%201.7.2&In-Reply-To=z2x173a1edc1004010758m31b83ca5r56e0ee56e90ef338%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006766.html">
   <LINK REL="Next"  HREF="006790.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after several hours running MulticastMain from 1.7.2</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%201.7.2%20with%20Erlang%20R13B04%20crashes%0A%20after%20several%20hours%20running%20MulticastMain%20from%201.7.2&In-Reply-To=z2x173a1edc1004010758m31b83ca5r56e0ee56e90ef338%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after several hours running MulticastMain from 1.7.2">matthew at lshift.net
       </A><BR>
    <I>Fri Apr  2 17:01:14 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006766.html">[rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after	several hours running MulticastMain from 1.7.2
</A></li>
        <LI>Next message: <A HREF="006790.html">[rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes	after several hours running MulticastMain from 1.7.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6778">[ date ]</a>
              <a href="thread.html#6778">[ thread ]</a>
              <a href="subject.html#6778">[ subject ]</a>
              <a href="author.html#6778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi John,

On Thu, Apr 01, 2010 at 04:58:57PM +0200, John Apps wrote:
&gt;<i> Wondering why this crashes when vm_memory_high_watermark is set?
</I>&gt;<i> 
</I>&gt;<i> This message &quot;vm_memory_high_watermark set. Memory used:935,079,976
</I>&gt;<i> allowed:858,993,459&quot; is rather intriguing, or am I missing something? (The
</I>&gt;<i> commas were inserted by me in order to make the number more legible.)
</I>
When Rabbit raises its alarms, it does not mean that it'll stop using
more memory. It will raise channel.flow to the client, but it can take
some time for the client to respond to that, and in the meantime, the
client can continue to send more messages in. At the moment we do not
drop such messages on the floor, but it's something that we have been
looking at.

Furthermore, Erlang's GC can mean that substantially more memory can be
used by the Erlang process than the (artificial) threshold at which we
raise channel.flow.

&gt;<i> Thu Apr 01 15:22:19 2010
</I>&gt;<i> Slogan: eheap_alloc: Cannot allocate 153052320 bytes of memory (of type
</I>&gt;<i> &quot;heap&quot;).
</I>&gt;<i> System version: Erlang R13B04 (erts-5.7.5) [smp:2:2] [rq:2]
</I>&gt;<i> [async-threads:30]
</I>&gt;<i> Compiled: Mon Feb 22 20:02:36 2010
</I>
Interesting. It's asking for 153MB and apparently Windows said &quot;no&quot; to
it. Was there really no free memory available for Windows? Have you
disabled the page file? 

The &quot;Memory limit set to 819MB.&quot; shows that rabbit really did detect
4GB of Ram in there, which is interesting for a Windows system - it
suggests you're running a 64-bit Erlang. If you just start up erl, and
type in:

os:type().
erlang:system_info(wordsize).

Also, if you start up rabbit, and in the rabbit shell, type:

vm_memory_monitor:get_total_memory().

what results do you get?

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006766.html">[rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes after	several hours running MulticastMain from 1.7.2
</A></li>
	<LI>Next message: <A HREF="006790.html">[rabbitmq-discuss] RabbitMQ 1.7.2 with Erlang R13B04 crashes	after several hours running MulticastMain from 1.7.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6778">[ date ]</a>
              <a href="thread.html#6778">[ thread ]</a>
              <a href="subject.html#6778">[ subject ]</a>
              <a href="author.html#6778">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
