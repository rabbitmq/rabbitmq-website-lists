<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] erlang 1.6.0 client possible problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20erlang%201.6.0%20client%20possible%20problem&In-Reply-To=4BD07AF7.40801%40echostar.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006951.html">
   <LINK REL="Next"  HREF="006953.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] erlang 1.6.0 client possible problem</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20erlang%201.6.0%20client%20possible%20problem&In-Reply-To=4BD07AF7.40801%40echostar.com"
       TITLE="[rabbitmq-discuss] erlang 1.6.0 client possible problem">matthew at lshift.net
       </A><BR>
    <I>Thu Apr 22 17:58:50 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006951.html">[rabbitmq-discuss] erlang 1.6.0 client possible problem
</A></li>
        <LI>Next message: <A HREF="006953.html">[rabbitmq-discuss] erlang 1.6.0 client possible problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6952">[ date ]</a>
              <a href="thread.html#6952">[ thread ]</a>
              <a href="subject.html#6952">[ subject ]</a>
              <a href="author.html#6952">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Mark,

Needless to say, 1.6.0 is pretty ancient and we'd recommend that you
upgrade to the latest 1.7.2, where lib_amqp has vanished, and the
problem you're reporting has been abstracted away by the library.

On Thu, Apr 22, 2010 at 10:36:07AM -0600, Mark Geib wrote:
&gt;<i> case lib_amqp:get(Channel, Queue, false) of
</I>&gt;<i>   basic.get_emtpy -&gt;
</I>&gt;<i>      ...
</I>&gt;<i> 
</I>&gt;<i>   {DeliveryTag, Content} -&gt;
</I>&gt;<i>      #content{payload_fragments_rev = Payload, class_id = ClassId,
</I>&gt;<i> properties_bin = Props} = Content,
</I>&gt;<i>      Message = list_to_binary(Payload),
</I>
The clue is in the name ;) payload_fragments_rev is a *reversed* list of
fragments. Thus you'll need to reverse it first. The reason this only
affects you with large messages is that smaller messages will be under
the max frame size, and thus will only be a single fragment.

Just ftr, if you do upgrade to 1.7.2, the API is now:

    {#'basic.get_ok'{}, #amqp_msg{payload = Payload}}
        = amqp_channel:call(Channel, #'basic.get'{queue = Q, no_ack = false}),

There, Payload is a single binary, not reversed, and not a list, thus
all the work has been done for you.

Best wishes,

Matthew


</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006951.html">[rabbitmq-discuss] erlang 1.6.0 client possible problem
</A></li>
	<LI>Next message: <A HREF="006953.html">[rabbitmq-discuss] erlang 1.6.0 client possible problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6952">[ date ]</a>
              <a href="thread.html#6952">[ thread ]</a>
              <a href="subject.html#6952">[ subject ]</a>
              <a href="author.html#6952">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
