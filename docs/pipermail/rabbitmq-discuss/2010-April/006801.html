<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Persister log size calculation and rolling persister log frequency?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Persister%20log%20size%20calculation%20and%20rolling%0A%20persister%20log%20frequency%3F&In-Reply-To=20100402163014.GK11613%40wellquite.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006780.html">
   <LINK REL="Next"  HREF="006810.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Persister log size calculation and rolling persister log frequency?</H1>
    <B>Tony Garnock-Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Persister%20log%20size%20calculation%20and%20rolling%0A%20persister%20log%20frequency%3F&In-Reply-To=20100402163014.GK11613%40wellquite.org"
       TITLE="[rabbitmq-discuss] Persister log size calculation and rolling persister log frequency?">tonyg at lshift.net
       </A><BR>
    <I>Mon Apr  5 18:53:47 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006780.html">[rabbitmq-discuss] Persister log size calculation and rolling persister log frequency?
</A></li>
        <LI>Next message: <A HREF="006810.html">[rabbitmq-discuss] Persister log size calculation and rolling persister log frequency?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6801">[ date ]</a>
              <a href="thread.html#6801">[ thread ]</a>
              <a href="subject.html#6801">[ subject ]</a>
              <a href="author.html#6801">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi John, Matthew,

Matthew Sackman wrote:
&gt;<i> On Thu, Apr 01, 2010 at 06:53:57PM +0200, John Apps wrote:
</I>&gt;&gt;<i> The size is presumably determined by the number of messages pending, i.e.,
</I>&gt;&gt;<i> not yet acknowledged?
</I>
Roughly, yes. The size of each log file is proportional to

 - the number of undelivered messages at previous rollover,
 - the total size of undelivered messages at previous rollover,
 - the number of deliveries since rollover,
 - the total size of deliveries since rollover, and
 - the number of acknowledgements since rollover.

Rollover happens at the moment whenever more than MAX_WRAP_ENTRIES
(currently set to only 500!) &quot;entries&quot; are written to the log, or after
HIBERNATE_AFTER (currently 10,000) milliseconds of persister inactivity.

An &quot;entry&quot; for the purposes of MAX_WRAP_ENTRIES is the amount of work
the persister collects in either 5ms or 2ms, depending on context.

At its most frequent, log rolling should happen about once a second.
This is way, way too often. I'll write a separate message now asking
people to experiment with different settings for MAX_WRAP_ENTRIES.

&gt;<i> &quot;[...] probably we should not roll whilst we're really busy&quot;.
</I>
Hmm. Was this a change to callers of the persister? I can't see any
logic in the persister that takes system load into account at the moment.

&gt;<i> I know some people aren't a fan of semantically significant spaces in
</I>&gt;<i> programming languages, but they're generally favoured in English...
</I>
Presumably mutt mangled the HTML somehow :-)

Regards,
  Tony



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006780.html">[rabbitmq-discuss] Persister log size calculation and rolling persister log frequency?
</A></li>
	<LI>Next message: <A HREF="006810.html">[rabbitmq-discuss] Persister log size calculation and rolling persister log frequency?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6801">[ date ]</a>
              <a href="thread.html#6801">[ thread ]</a>
              <a href="subject.html#6801">[ subject ]</a>
              <a href="author.html#6801">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
