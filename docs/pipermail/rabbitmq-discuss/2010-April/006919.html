<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq-mochiweb
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbitmq-mochiweb&In-Reply-To=y2j8801cb2b1004171529uf79db460r92e9a728ba7f8883%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006918.html">
   <LINK REL="Next"  HREF="006923.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq-mochiweb</H1>
    <B>Paul Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20rabbitmq-mochiweb&In-Reply-To=y2j8801cb2b1004171529uf79db460r92e9a728ba7f8883%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] rabbitmq-mochiweb">pauljones23 at gmail.com
       </A><BR>
    <I>Sat Apr 17 23:46:21 BST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006918.html">[rabbitmq-discuss] rabbitmq-mochiweb
</A></li>
        <LI>Next message: <A HREF="006923.html">[rabbitmq-discuss] rabbitmq-mochiweb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6919">[ date ]</a>
              <a href="thread.html#6919">[ thread ]</a>
              <a href="subject.html#6919">[ subject ]</a>
              <a href="author.html#6919">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Benjamin,

In the production mode, mochiweb doesn't really have a docroot setup.
/rabbitmq_lib will serve the files in priv/www, but that is as far as it
goes.

However... if you want to serve some other files then you could always use
code similar to what the test mode does to make it happen. For example, if
you were to add:

Handler = rabbit_mochiweb:static_context_handler(&quot;&quot;, ?MODULE,
&quot;priv/mydocroot&quot;),
ok = rabbit_mochiweb:register_global_handler(Handler),

after the line:
rabbit_mochiweb:register_static_context(ContextRoot, ?MODULE, &quot;priv/www&quot;)

in src/rabbit_jsonrpc_channel_app.erl, then once you've installed the plugin
into Rabbit, any file put into
priv/plugins/rabbitmq-jsonrpc-channel/priv/mydocroot should be served from
the root context of mochiweb.

BTW, I've just noticed a bug in the packaging of the jsonrpc-channel plugin
such that if you do run that plugin by installing it via a .ez, you'll need
to copy the priv/www directory into
priv/plugins/rabbitmq-jsonrpc-channel/priv/www (otherwise libraries such as
rabbitmq.js won't be available).

Thanks,
Paul.

On Sat, Apr 17, 2010 at 11:29 PM, Benjamin Polidore &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">polidore at gmail.com</A>&gt;wrote:

&gt;<i> Hey, paul, I installed all the dependencies to rabbitmq-jsonrpc-channel
</I>&gt;<i> (see below).
</I>&gt;<i>
</I>&gt;<i> I see that you add a little context in test mode.  Basically, I was hoping
</I>&gt;<i> to use the plugin to host my HTML and javascript in dev mode so I don't have
</I>&gt;<i> to run another webserver on my laptop.  I prefer to run rabbitmq in
</I>&gt;<i> &quot;production&quot; mode on my laptop, and I was curious what mochiweb thinks the
</I>&gt;<i> docroot is in this mode.
</I>&gt;<i>
</I>&gt;<i> [{running_applications,
</I>&gt;<i>      [{rabbit_jsonrpc_channel,&quot;RabbitMQ JSON-RPC Channels&quot;,&quot;0.01&quot;},
</I>&gt;<i>       {rabbit,&quot;RabbitMQ&quot;,&quot;1.7.2&quot;},
</I>&gt;<i>       {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.5&quot;},
</I>&gt;<i>       {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.9&quot;},
</I>&gt;<i>       {rabbit_jsonrpc,&quot;Rabbit JSON-RPC&quot;,&quot;0.01&quot;},
</I>&gt;<i>       {rfc4627_jsonrpc,&quot;JSON RPC Service&quot;,&quot;0.01&quot;},
</I>&gt;<i>       {rabbit_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;0.01&quot;},
</I>&gt;<i>       {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;0.01&quot;},
</I>&gt;<i>       {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.4.13&quot;},
</I>&gt;<i>       {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.16.5&quot;},
</I>&gt;<i>       {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.13.5&quot;}]},
</I>&gt;<i>  {nodes,[<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at H5Pro</A>]},
</I>&gt;<i>  {running_nodes,[<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at H5Pro</A>]}]
</I>&gt;<i> ...done.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sat, Apr 17, 2010 at 4:11 PM, Paul Jones &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">pauljones23 at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi Benjamin,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Which plugins have you installed into RabbitMQ? The mochiweb plugin alone
</I>&gt;&gt;<i> simply embeds a webserver - you'll need to install rabbitmq-jsonrpc and
</I>&gt;&gt;<i> rabbitmq-jsonrpc-channel to get the JSON services.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you have done this, then you might be hitting the fact that when
</I>&gt;&gt;<i> running under test, an additional context is installed under the root that
</I>&gt;&gt;<i> provides all the various test examples. We don't activate this in the
</I>&gt;&gt;<i> &quot;production&quot; mode, since we don't expect you'll want them in a real
</I>&gt;&gt;<i> deployment. The scripts for doing JSON-RPC are still there though - under
</I>&gt;&gt;<i> /rabbitmq_lib (the scripts that are made available via this can be found on
</I>&gt;&gt;<i> the filesystem in priv/www).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I hope this answers your question.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers,
</I>&gt;&gt;<i> Paul
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Sat, Apr 17, 2010 at 8:28 PM, Benjamin Polidore &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">polidore at gmail.com</A>&gt;wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> hi, i'm trying to use the json-channel plugin, and it runs ok when i do
</I>&gt;&gt;&gt;<i> make test, but it doesn't seem to work when i try to start up my broker.
</I>&gt;&gt;&gt;<i>   the port is open, but everything returns 404.  what is mochiweb using
</I>&gt;&gt;&gt;<i> as a docroot when I run it outside make test?  sorry if this is obvious, but
</I>&gt;&gt;&gt;<i> i've been struggling with it for a couple hours.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> thanks,
</I>&gt;&gt;&gt;<i> bp
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100417/d0f3a2ab/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20100417/d0f3a2ab/attachment.htm</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006918.html">[rabbitmq-discuss] rabbitmq-mochiweb
</A></li>
	<LI>Next message: <A HREF="006923.html">[rabbitmq-discuss] rabbitmq-mochiweb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6919">[ date ]</a>
              <a href="thread.html#6919">[ thread ]</a>
              <a href="subject.html#6919">[ subject ]</a>
              <a href="author.html#6919">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
