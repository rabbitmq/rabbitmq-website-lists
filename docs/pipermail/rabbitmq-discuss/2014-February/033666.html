<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Why consumer become slow if publish faster?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Why%20consumer%20become%20slow%20if%20publish%20faster%3F&In-Reply-To=%3C52F4DF2C.700%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033665.html">
   <LINK REL="Next"  HREF="033673.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Why consumer become slow if publish faster?</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Why%20consumer%20become%20slow%20if%20publish%20faster%3F&In-Reply-To=%3C52F4DF2C.700%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Why consumer become slow if publish faster?">simon at rabbitmq.com
       </A><BR>
    <I>Fri Feb  7 13:27:08 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033665.html">[rabbitmq-discuss] Why consumer become slow if publish faster?
</A></li>
        <LI>Next message: <A HREF="033673.html">[rabbitmq-discuss] Regex expression to exclude certain queues in	the &quot;Queue&quot; tab?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33666">[ date ]</a>
              <a href="thread.html#33666">[ thread ]</a>
              <a href="subject.html#33666">[ subject ]</a>
              <a href="author.html#33666">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/02/2014 1:04PM, &#26928;&#39118; wrote:
&gt;<i> Why the speed of the consumer reduced to 1200/s when speed of the
</I>&gt;<i> publish grown to 4000/s?
</I>
Each queue can only use a single CPU core. Therefore as the publish rate 
goes up, the maximum consume rate goes down.

At the moment, the queue does not make any effort to prioritise 
consumers over publishers in this situation, leading to backlogs as you 
have seen.

In 3.3.0 we will be introducing a prioritisation feature so that when a 
queue is CPU-bound it will attempt to deliver messages 10% faster than 
it accepts them, leading it to tend towards being empty rather than 
growing uncontrollably.

(Historical note: we had a simpler prioritisation scheme from 1.7.0 to 
2.8.2 inclusive, which &quot;infinitely&quot; prioritised consuming when the queue 
was CPU bound. The trouble was you could get into situations where a 
large queue which gained some fast consumers would refuse to accept even 
a single publish until it was completely drained.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033665.html">[rabbitmq-discuss] Why consumer become slow if publish faster?
</A></li>
	<LI>Next message: <A HREF="033673.html">[rabbitmq-discuss] Regex expression to exclude certain queues in	the &quot;Queue&quot; tab?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33666">[ date ]</a>
              <a href="thread.html#33666">[ thread ]</a>
              <a href="subject.html#33666">[ subject ]</a>
              <a href="author.html#33666">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
