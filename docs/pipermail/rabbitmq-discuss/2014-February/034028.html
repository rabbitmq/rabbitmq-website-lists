<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] JavaClient HeartbeatSender
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20JavaClient%20HeartbeatSender&In-Reply-To=%3C530733EA.7030409%40alertme.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034027.html">
   <LINK REL="Next"  HREF="034029.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] JavaClient HeartbeatSender</H1>
    <B>Dmitry Andrianov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20JavaClient%20HeartbeatSender&In-Reply-To=%3C530733EA.7030409%40alertme.com%3E"
       TITLE="[rabbitmq-discuss] JavaClient HeartbeatSender">dmitry.andrianov at alertme.com
       </A><BR>
    <I>Fri Feb 21 11:09:30 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034027.html">[rabbitmq-discuss] JavaClient HeartbeatSender
</A></li>
        <LI>Next message: <A HREF="034029.html">[rabbitmq-discuss] JavaClient HeartbeatSender
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34028">[ date ]</a>
              <a href="thread.html#34028">[ thread ]</a>
              <a href="subject.html#34028">[ subject ]</a>
              <a href="author.html#34028">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I think I understood. If HeartbeatSender is the only piece of RabbitMQ 
which creates its own executor (given that I tell it to use another 
executor for consumer work pool), then yes, I can use a custom thread 
factory and always return the same thread. This effectively make all 
HeartbeatSenders to share the same thread and yes, it is what I want.

The concern I expressed in previous email was only about the case if 
RabbitMQ can create any other executors under some circumstances. In 
that case I would not be able to distinguish between them in my thread 
factory and the same thread would be used not just for HeartbeatSenders 
but for something else. Which would be undesired behaviour.
But if there are no other executors created, your solution will work. 
(Although feels a little bit dodgy because if you introduce more 
executors later, our custom thread factory will break everything)

Yes, we are going to use multiple machines to generate load. But before 
going there we want to optimise for single machine as much as possible 
so in the end we will need smaller cluster.

Thanks for your help.


On 21/02/14 10:48, Michael Klishin wrote:
&gt;<i> On 21 Feb 2014, at 14:13, Dmitry Andrianov &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dmitry.andrianov at alertme.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> But it won't be possible to see that this particular newThread() is invoked by executor created by HeartbeatSender?
</I>&gt;<i> If you provide a ThreadFactory, j.u.c. executors will use it. I&#8217;m not sure what you&#8217;re saying.
</I>&gt;<i>
</I>&gt;&gt;<i> If we return the same thread without such checks we effectively make the entire stress testing client single threaded so it won't serve its purpose.
</I>&gt;<i> You said you intend to open lots of connections. If that&#8217;s the case, all connections will share a heartbeat thread but network I/O
</I>&gt;<i> threads won&#8217;t be shared. Consumer work pool executor can be shared via ConnectionFactory#setSharedExecutor (I don&#8217;t recall if this is in 3.2 or not).
</I>&gt;<i>
</I>&gt;<i> In practice shared consumer work pool executor makes much more difference than heartbeat sender.
</I>&gt;<i> If the # of threads is a limiting factor for your test suite (can&#8217;t you just use multiple machines?),
</I>&gt;<i> consider using Go client [1] for your stress tests.
</I>&gt;<i>
</I>&gt;<i> 1. <A HREF="http://github.com/streadway/amqp">http://github.com/streadway/amqp</A>
</I>&gt;<i>
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i> Software Engineer, Pivotal/RabbitMQ
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034027.html">[rabbitmq-discuss] JavaClient HeartbeatSender
</A></li>
	<LI>Next message: <A HREF="034029.html">[rabbitmq-discuss] JavaClient HeartbeatSender
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34028">[ date ]</a>
              <a href="thread.html#34028">[ thread ]</a>
              <a href="subject.html#34028">[ subject ]</a>
              <a href="author.html#34028">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
