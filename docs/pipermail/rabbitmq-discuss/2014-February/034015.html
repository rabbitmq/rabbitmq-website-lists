<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Cluster,	split network &amp; VMWare snapshot
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Cluster%2C%0A%09split%20network%20%26%20VMWare%20snapshot&In-Reply-To=%3CCANOx8NmyErBW7TdvRODwMM8X0DswLHG_Pbb9-y5dKKM4Z2hHMQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034008.html">
   <LINK REL="Next"  HREF="034018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Cluster,	split network &amp; VMWare snapshot</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Cluster%2C%0A%09split%20network%20%26%20VMWare%20snapshot&In-Reply-To=%3CCANOx8NmyErBW7TdvRODwMM8X0DswLHG_Pbb9-y5dKKM4Z2hHMQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Cluster,	split network &amp; VMWare snapshot">jkuch at gopivotal.com
       </A><BR>
    <I>Fri Feb 21 01:05:26 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034008.html">[rabbitmq-discuss] RabbitMQ Cluster,	split network &amp; VMWare snapshot
</A></li>
        <LI>Next message: <A HREF="034018.html">[rabbitmq-discuss] RabbitMQ Cluster,	split network &amp; VMWare snapshot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34015">[ date ]</a>
              <a href="thread.html#34015">[ thread ]</a>
              <a href="subject.html#34015">[ subject ]</a>
              <a href="author.html#34015">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Feb 20, 2014 at 12:11 PM, Michael Oullion &lt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michael.oullion at norbert-dentressangle.com</A>&gt; wrote:

&gt;<i> Thanks Jerry for your quick answer.
</I>&gt;<i> What can we do in this situation?
</I>&gt;<i> Maybe we can uprise the net tick or use a specific behaviour to manage
</I>&gt;<i> network split.
</I>&gt;<i> Or simply stop take snapshot of the vm because it's not necessary?
</I>&gt;<i>
</I>You may want to think about why you take the snapshots in your particular
workflow.  As long as you have a once in a while snapshot with the
configuration of your Rabbit nodes, as you use them in your
dev/test/production environment, you should be fine for restoration
purposes.  You probably don't need to do that every night unless a lot is
changing on them from day to day.

Besides, if that VM were restored from a snapshot, it will wake up into a
world where any connected clients and whatnot are likely gone and forgotten
and have to slough such things off anyway.  And there may be messages
sitting in queues that were long ago delivered to consumers and acted upon,
that are now going to come back from the un-snapshotted grave.  If your
apps are designed sensibly, favoring idempotency and suitable
de-duplication of action at the consumer end, this won't be a big deal, of
course.

You may also want to keep an eye on your vSphere monitoring and management
stuff to see if anything else is going on around the times these partitions
occur.  Partitions are in the eye of each participating beholder, and we
detect (really *define*) them via timeout, so anything that renders a node
temporarily unable to participate in heart beating will manifest this way.

Beyond snapshotting, which paralyzes the VM for part of the time the
snapshot is being made, I'd also watch out for vMotion, which briefly stuns
the VM being motioned into a quiescent state just before vSphere switches
over to the migrated VM at its new location, and, possibly the hypervisor
paging memory out beneath the guest OS that Rabbit is running on top of,
which could make things lag enough that a heartbeat exchange would be
missed.  The latter case can be especially sneaky since an ESX host under
memory pressure may be paging out guest OSes without them, as far as they
know, swapping...

Best regards,
Jerry
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140220/8f257e08/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140220/8f257e08/attachment.html</A>&gt;
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034008.html">[rabbitmq-discuss] RabbitMQ Cluster,	split network &amp; VMWare snapshot
</A></li>
	<LI>Next message: <A HREF="034018.html">[rabbitmq-discuss] RabbitMQ Cluster,	split network &amp; VMWare snapshot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34015">[ date ]</a>
              <a href="thread.html#34015">[ thread ]</a>
              <a href="subject.html#34015">[ subject ]</a>
              <a href="author.html#34015">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
