<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ management down after cluster issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20management%20down%20after%20cluster%20issue&In-Reply-To=%3CCAHn_LrwRT%3DiTgJnAiGJR3qFDGfA7aewTyU6yNABXc-fRSM3E7g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033600.html">
   <LINK REL="Next"  HREF="033623.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ management down after cluster issue</H1>
    <B>Johanes Soetanto</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20management%20down%20after%20cluster%20issue&In-Reply-To=%3CCAHn_LrwRT%3DiTgJnAiGJR3qFDGfA7aewTyU6yNABXc-fRSM3E7g%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ management down after cluster issue">otnateos at gmail.com
       </A><BR>
    <I>Wed Feb  5 22:20:32 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033600.html">[rabbitmq-discuss] problem seen with multiple listeners on a single	reply queue
</A></li>
        <LI>Next message: <A HREF="033623.html">[rabbitmq-discuss] RabbitMQ management down after cluster issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33601">[ date ]</a>
              <a href="thread.html#33601">[ thread ]</a>
              <a href="subject.html#33601">[ subject ]</a>
              <a href="author.html#33601">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry, reposting this since the original one was sent using unregistered
email address

Johanes


---------- Forwarded message ----------
Date: 6 February 2014 09:17
Subject: RabbitMQ management down after cluster issue
To:
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>


Hi all,

We are having problem with our RabbitMQ cluster which we are not quite sure
how to debug the root cause. We have 2 nodes in a cluster and one of the
node (MQ1) had its management console down after clustering issue/network
partition. (I assume this is what happen because we ping the management
console from zabbix every minute)

Last month we experience network partition and the same node's management
plugin was down as well. Since then that node had been reinstalled with the
same RabbitMQ version and we use &quot;auto-heal&quot; policy when a network
partition happen.

Looking at both nodes' log here is some critical information i can gather

MQ1
=INFO REPORT==== 5-Feb-2014::11:14:49 ===
rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2</A> down
=INFO REPORT==== 5-Feb-2014::11:14:51 ===
Statistics database started.
=INFO REPORT==== 5-Feb-2014::11:14:51 ===
Mirrored-queue (queue 'email.out.5' in vhost '/'): Slave
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1.3.10297.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2.2.</A>
289.0&gt;
.......
=ERROR REPORT==== 5-Feb-2014::11:14:52 ===
Mnesia(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>): ** ERROR ** mnesia_event got {inconsistent_database,
running_partitioned_network, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2</A>}
=INFO REPORT==== 5-Feb-2014::11:14:52 ===
Autoheal request sent to <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>
=INFO REPORT==== 5-Feb-2014::11:14:52 ===
Autoheal request received from <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>
=INFO REPORT==== 5-Feb-2014::11:14:52 ===
global: Name conflict terminating {rabbit_mgmt_db,&lt;2705.453.0&gt;}
=ERROR REPORT==== 5-Feb-2014::11:14:52 ===
** Generic server &lt;0.10360.0&gt; terminating
** Last message in was {<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mnesia_locker,rabbit at mq2</A>,granted}
** When Server state == {state,&lt;0.10358.0&gt;,&lt;0.10359.0&gt;,rabbit_mgmt_sup,
                            [{rabbit_mgmt_db,
                                 {rabbit_mgmt_db,start_link,[]},
                                 permanent,4294967295,worker,
                                 [rabbit_mgmt_db]}]}
** Reason for termination ==
** {unexpected_info,{<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mnesia_locker,rabbit at mq2</A>,granted}}
=INFO REPORT==== 5-Feb-2014::11:14:52 ===
Autoheal decision
  * Partitions: [[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>],[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2</A>]]
  * Winner:     <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>
  * Losers:     [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2</A>]
=INFO REPORT==== 5-Feb-2014::11:14:52 ===
Autoheal: I am the winner, waiting for [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2</A>] to stop
=INFO REPORT==== 5-Feb-2014::11:14:53 ===
rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2</A> down
=INFO REPORT==== 5-Feb-2014::11:14:58 ===
Autoheal: final node has stopped, starting...
=INFO REPORT==== 5-Feb-2014::11:16:14 ===
rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2</A> up


MQ2
=ERROR REPORT==== 5-Feb-2014::11:14:49 ===
** Node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A> not responding **
** Removing (timedout) connection **
=INFO REPORT==== 5-Feb-2014::11:14:49 ===
rabbit on node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A> down
=INFO REPORT==== 5-Feb-2014::11:14:51 ===
Mirrored-queue (queue 'managedAmqpOutboundSms5' in vhost '/'): Master
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2.2.277.0</A>&gt; saw deaths of mirrors &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1.3.10289.0</A>&gt;
...
=ERROR REPORT==== 5-Feb-2014::11:14:52 ===
Mnesia(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2</A>): ** ERROR ** mnesia_event got {inconsistent_database,
running_partitioned_network, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>}
...
=INFO REPORT==== 5-Feb-2014::11:14:52 ===
Statistics database started.
=WARNING REPORT==== 5-Feb-2014::11:14:52 ===
Autoheal: we were selected to restart; winner is <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>
=INFO REPORT==== 5-Feb-2014::11:14:52 ===
Stopping RabbitMQ
=INFO REPORT==== 5-Feb-2014::11:14:53 ===
stopped TCP Listener on [::]:5672
=ERROR REPORT==== 5-Feb-2014::11:14:59 ===
Mnesia(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq2</A>): ** ERROR ** mnesia_event got {inconsistent_database,
starting_partitioned_network, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>}
=INFO REPORT==== 5-Feb-2014::11:15:13 ===
Starting RabbitMQ 3.1.5 on Erlang R14B04
Copyright (C) 2007-2013 GoPivotal, Inc.
Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>
...


Is there some obvious error I should be looking at from RabbitMQ log to
find out what's happening? because the other log files do not seem to
provide meaningful information.


Here's our system setup (in case it may help)
- 2 nodes cluster on Linode
- Ubuntu 12.04.3 instance
- RabbitMQ 3.1.5
- management plugin enabled
- both nodes communicating on private LAN ip address
- both nodes is used by our app servers using spring-amqp to communicate
(might be unrelated information)



Any hints or help to debug the issue will be appreciated.


Thanks

Johanes
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140206/1ffe0d7f/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140206/1ffe0d7f/attachment.html</A>&gt;
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033600.html">[rabbitmq-discuss] problem seen with multiple listeners on a single	reply queue
</A></li>
	<LI>Next message: <A HREF="033623.html">[rabbitmq-discuss] RabbitMQ management down after cluster issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33601">[ date ]</a>
              <a href="thread.html#33601">[ thread ]</a>
              <a href="subject.html#33601">[ subject ]</a>
              <a href="author.html#33601">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
