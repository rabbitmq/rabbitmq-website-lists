<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] MQ Cluster Replication Traffic Questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20MQ%20Cluster%20Replication%20Traffic%20Questions&In-Reply-To=%3C095101cf33f4%24d1476e70%2473d64b50%24%40euphoriaaudio.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034217.html">
   <LINK REL="Next"  HREF="034232.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] MQ Cluster Replication Traffic Questions</H1>
    <B>Chris Larsen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20MQ%20Cluster%20Replication%20Traffic%20Questions&In-Reply-To=%3C095101cf33f4%24d1476e70%2473d64b50%24%40euphoriaaudio.com%3E"
       TITLE="[rabbitmq-discuss] MQ Cluster Replication Traffic Questions">clarsen at euphoriaaudio.com
       </A><BR>
    <I>Thu Feb 27 19:47:58 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034217.html">[rabbitmq-discuss] How to custom model &quot;Publish and Subscribe&quot;
</A></li>
        <LI>Next message: <A HREF="034232.html">[rabbitmq-discuss] How to restrict to one connection per same user at a time and same routing key ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34222">[ date ]</a>
              <a href="thread.html#34222">[ thread ]</a>
              <a href="subject.html#34222">[ subject ]</a>
              <a href="author.html#34222">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello folks, we're trying to troubleshoot our MQ clusters that kept
partitioning, despite their use of a direct cross-over connection to avoid
issues with a switch failing or cycling. We have 6 servers split into 3
clusters. All boxes accept traffic from producers and consumers on eth0
(connected to the switch) and eth1 is connected the other box in the
clustered pair. We use a host file override on each box to direct MQ traffic
over the crossover and Rabbit binds to all IPs. Both NICs on each box are
1gs.

 

Despite the cross-over we were seeing network partition alerts with version
3.2.2. We saw NIC reset errors (Intel NICs) and just upgraded the drivers to
fend off that problem and tried some buffer tuning. But we're still dropping
packets on the cross-over interface so I'm worried the partitions may
continue. Here are the questions I have:

 

1)      Is it a bad idea to use a cross-over like this? 

2)      We're seeing ~2.5Mbps in / ~10Mbps out on the public eth0 interface
but ~45Mbps in / ~30Mbps out on the cross-over. Is that kind of
amplification normal?

3)      If it's ok to use the cross-over, what TCP tuning am I missing?

 

Here are some more stats from our setup:

Ubuntu 12.04  3.2.0-30-generic

~5000 connections / 6000 queues / 12000 channels per cluster

~1 dropped packet ever few minutes on the cross-over if. No errors or
overruns, etc

net.ipv4.tcp_wmem = 10240 524288 16777216 

net.ipv4.tcp_rmem = 10240 524288 16777216 

net.core.rmem_max = 16777216 

net.core.wmem_max = 16777216

and the &quot;packets collapsed in receive queue due to low socket buffer&quot; keeps
incrementing

 

Thanks!

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140227/99fe77b7/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140227/99fe77b7/attachment.html</A>&gt;
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034217.html">[rabbitmq-discuss] How to custom model &quot;Publish and Subscribe&quot;
</A></li>
	<LI>Next message: <A HREF="034232.html">[rabbitmq-discuss] How to restrict to one connection per same user at a time and same routing key ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34222">[ date ]</a>
              <a href="thread.html#34222">[ thread ]</a>
              <a href="subject.html#34222">[ subject ]</a>
              <a href="author.html#34222">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
