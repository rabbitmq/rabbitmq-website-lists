<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publish-Confirm
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publish-Confirm&In-Reply-To=%3CCANOx8N%3D2wDFtaDWUTJU%3DZ03QwKT5_MmEk%2BKieKHZ7VZZSTyjXA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034177.html">
   <LINK REL="Next"  HREF="034179.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publish-Confirm</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publish-Confirm&In-Reply-To=%3CCANOx8N%3D2wDFtaDWUTJU%3DZ03QwKT5_MmEk%2BKieKHZ7VZZSTyjXA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Publish-Confirm">jkuch at gopivotal.com
       </A><BR>
    <I>Wed Feb 26 18:25:11 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034177.html">[rabbitmq-discuss] Publish-Confirm
</A></li>
        <LI>Next message: <A HREF="034179.html">[rabbitmq-discuss] Publish-Confirm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34178">[ date ]</a>
              <a href="thread.html#34178">[ thread ]</a>
              <a href="subject.html#34178">[ subject ]</a>
              <a href="author.html#34178">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It's sample code intended to illustrate the mechanism.  Whether your logic
really means you should be waiting or sleeping or whatever is another story.

The core of the idea:

   - Publisher keeps track, in some kind of set-like data structure, the
   publish sequence numbers associated with the messages he's published.
   - As the broker receives the messages and does the requested work it
   asynchronously issues confirms back to the publisher.
   - The publisher retires these no longer pending confirms by removing
   them from the set.
   - If the connection closes indicating a failure, than any sequence
   numbers in the pending set have to be re-published, because the publisher
   has no guarantee the broker received them or, if it did, that it
   successfully did anything with them before they went wrong.

The sample code is basically just napping periodically while it waits for
the pending confirms set to drain as confirms come in.  Obviously your own
producers may plan to run for long periods of time, or be doing other
useful work as they run, and will need somewhat different logic.




On Wed, Feb 26, 2014 at 10:16 AM, cw storm &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cwstorm at gmail.com</A>&gt; wrote:

&gt;<i> I would like to use the example code provided in
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/&lt;https://urldefense.proofpoint.com/v1/url?u=http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/&amp;k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&amp;r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&amp;m=QUfUbFS9YzM58pz9kll9YojUmz0BsQCmKTEyEzb0%2BoI%3D%0A&amp;s=b8ddf76532b9371ee56c739e1f4484e3de1919f070f791241be58f8200b4f29b">http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/&lt;https://urldefense.proofpoint.com/v1/url?u=http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/&amp;k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&amp;r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&amp;m=QUfUbFS9YzM58pz9kll9YojUmz0BsQCmKTEyEzb0%2BoI%3D%0A&amp;s=b8ddf76532b9371ee56c739e1f4484e3de1919f070f791241be58f8200b4f29b</A>&gt;
</I>&gt;<i>
</I>&gt;<i> I'm trying to understand the below snippet:
</I>&gt;<i>
</I>&gt;<i> for (long i = 0; i &lt; MSG_COUNT; ++i) {
</I>&gt;<i>      unconfirmedSet.add(ch.getNextPublishSeqNo());
</I>&gt;<i>      ch.basicPublish(&quot;&quot;, QUEUE_NAME, MessageProperties.PERSISTENT_BASIC,
</I>&gt;<i>                        &quot;nop&quot;.getBytes());
</I>&gt;<i>  }
</I>&gt;<i> while (unconfirmedSet.size() &gt; 0)
</I>&gt;<i>      Thread.sleep(10);
</I>&gt;<i>
</I>&gt;<i> As stated, &quot;the producer waits for all the messages to be confirmed.&quot;  Assuming that's the above code.  Is the &quot;while&quot; logic safe?  What happens when the &quot;unconfirmedSet.size&quot; is always greater than 0?  Also, the &quot;MSG_COUNT&quot; if set to 10000, does the for loop will always loop 10000 times even though there might only be say 10 messages?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&amp;k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&amp;r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&amp;m=QUfUbFS9YzM58pz9kll9YojUmz0BsQCmKTEyEzb0%2BoI%3D%0A&amp;s=8211f71263dd5091577809eb7793ada1a818ae26a30e60f2e2d1c9de4ad4d33a">https://urldefense.proofpoint.com/v1/url?u=https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&amp;k=oIvRg1%2BdGAgOoM1BIlLLqw%3D%3D%0A&amp;r=sF0ZnlnTVu0KrGgVA7hSe29cx%2BPGAwA3H8KZu6lkUvo%3D%0A&amp;m=QUfUbFS9YzM58pz9kll9YojUmz0BsQCmKTEyEzb0%2BoI%3D%0A&amp;s=8211f71263dd5091577809eb7793ada1a818ae26a30e60f2e2d1c9de4ad4d33a</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140226/79e9e5f0/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140226/79e9e5f0/attachment.html</A>&gt;
</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034177.html">[rabbitmq-discuss] Publish-Confirm
</A></li>
	<LI>Next message: <A HREF="034179.html">[rabbitmq-discuss] Publish-Confirm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34178">[ date ]</a>
              <a href="thread.html#34178">[ thread ]</a>
              <a href="subject.html#34178">[ subject ]</a>
              <a href="author.html#34178">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
