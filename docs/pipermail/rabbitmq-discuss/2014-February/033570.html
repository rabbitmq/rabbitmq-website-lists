<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publishing Performance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publishing%20Performance&In-Reply-To=%3CCAOQTPw5ZLuoxLAfAfi7xxpg62syBMtEsX6mnnZqwL4VHwDNaBg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033550.html">
   <LINK REL="Next"  HREF="033583.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publishing Performance</H1>
    <B>Simone Sciarrati</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publishing%20Performance&In-Reply-To=%3CCAOQTPw5ZLuoxLAfAfi7xxpg62syBMtEsX6mnnZqwL4VHwDNaBg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Publishing Performance">s.sciarrati at gmail.com
       </A><BR>
    <I>Wed Feb  5 00:10:02 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033550.html">[rabbitmq-discuss] Publishing Performance
</A></li>
        <LI>Next message: <A HREF="033583.html">[rabbitmq-discuss] Publishing Performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33570">[ date ]</a>
              <a href="thread.html#33570">[ thread ]</a>
              <a href="subject.html#33570">[ subject ]</a>
              <a href="author.html#33570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I tried rabbitmqctl list_queues and could not see
backing_queue_status.ram_msg_count, I think you mean ./rabbitmqadmin
list queues name backing_queue_status.ram_msg_count (or variations of
it)

How does backing_queue_status.ram_msg_count relate to the queue paging
messages to disk? I have seen a few threads and in one it was
suggested to look at the comments in
<A HREF="https://github.com/michaelklishin/rabbit-hole/blob/master/queues.go#L10">https://github.com/michaelklishin/rabbit-hole/blob/master/queues.go#L10</A>
but there I see:

RAMMessageCount       int64   `json:&quot;ram_msg_count&quot;`
// Number of outstanding acks held in RAM

It is not clear to me how 'number of outstanding acks held in RAM'
relates to messages being paged to disk. Also where does it show in
the UI?

Thanks,

S

On Tue, Feb 4, 2014 at 11:24 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
&gt;<i> On 04/02/2014 7:30AM, Michael Klishin wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 4 Feb 2014, at 11:24, Umutcan &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">umutcan at gamegos.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Does publishing get slower while number of the queued messages are
</I>&gt;&gt;&gt;<i> increasing?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> While I am doing an operation, publishing speed get slower in time.
</I>&gt;&gt;&gt;<i> Operation publishes a certain amount of messages to RMQ and then  a consumer
</I>&gt;&gt;&gt;<i> processes messages. Since publishing speed is higher than consuming speed,
</I>&gt;&gt;&gt;<i> messages waits for a while in the queue. I am not running operation again
</I>&gt;&gt;&gt;<i> until queue is empty.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If consumers do not keep up with publishers, eventually RabbitMQ will
</I>&gt;&gt;<i> throttle publishers
</I>&gt;&gt;<i> until consumers drain enough messages to eliminate RAM and disk space
</I>&gt;&gt;<i> pressure.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> First of all, RabbitMQ will start paging messages out to disk. Since at all
</I>&gt;<i> times RabbitMQ tries not to accept messages faster than it can do something
</I>&gt;<i> sensible with them, this will mean the publishing rate goes down
</I>&gt;<i> substantially at this point.
</I>&gt;<i>
</I>&gt;<i> You can see if a queue is paging to disk in the management plugin web UI, or
</I>&gt;<i> by looking at backing_queue_status.ram_msg_count in rabbitmqctl list_queues
</I>&gt;<i> or the HTTP API.
</I>&gt;<i>
</I>&gt;<i> Eventually if the disk fills up, or something else happens to make memory
</I>&gt;<i> usage spike, then the memory alarm can go off and block publishers
</I>&gt;<i> completely until memory use drops again.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> See <A HREF="http://rabbitmq.com/memory.html.">http://rabbitmq.com/memory.html.</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> OS swapping can also take place, which affects performance severely.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We try to avoid that, but on a machine where other services are running it's
</I>&gt;<i> not always possible.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033550.html">[rabbitmq-discuss] Publishing Performance
</A></li>
	<LI>Next message: <A HREF="033583.html">[rabbitmq-discuss] Publishing Performance
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33570">[ date ]</a>
              <a href="thread.html#33570">[ thread ]</a>
              <a href="subject.html#33570">[ subject ]</a>
              <a href="author.html#33570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
