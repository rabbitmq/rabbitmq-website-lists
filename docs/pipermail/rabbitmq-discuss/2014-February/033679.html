<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Web STOMP hangs after a while
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Web%20STOMP%20hangs%20after%20a%20while&In-Reply-To=%3CCAPH5wFrO31N-NgCYky%3DDxtFENmxdy8aTXPcrO3E_Zq4yr%2BoP2Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033678.html">
   <LINK REL="Next"  HREF="033682.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Web STOMP hangs after a while</H1>
    <B>Nikita Tsukanov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Web%20STOMP%20hangs%20after%20a%20while&In-Reply-To=%3CCAPH5wFrO31N-NgCYky%3DDxtFENmxdy8aTXPcrO3E_Zq4yr%2BoP2Q%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Web STOMP hangs after a while">keks9n at gmail.com
       </A><BR>
    <I>Sun Feb  9 12:49:57 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033678.html">[rabbitmq-discuss] Web STOMP hangs after a while
</A></li>
        <LI>Next message: <A HREF="033682.html">[rabbitmq-discuss] RabbitMQ server suddenly crashing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33679">[ date ]</a>
              <a href="thread.html#33679">[ thread ]</a>
              <a href="subject.html#33679">[ subject ]</a>
              <a href="author.html#33679">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Oh, I figured it out.
1) We're using nginx to proxy websocket connections (we need HTTPS)
2) For some reason connections get leaked in that case (nginx bug? dunno)
3) cowboy by default allows only limited amount of connections

So after a while the number of opened connections reaches the limit and
then it hangs

Now I've applied https patches from
<A HREF="https://github.com/jshiell/rabbitmq-web-stomp">https://github.com/jshiell/rabbitmq-web-stomp</A> (I hope it will be merged to
upstream) and web-stomp serves connections directly. No any leaks, works
like a charm.

Regards, Nikita


2014-02-09 13:34 GMT+04:00 Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">michael.s.klishin at gmail.com</A>&gt;:

&gt;<i>
</I>&gt;<i> 2014-02-09 13:05 GMT+04:00 Nikita Tsukanov &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">keks9n at gmail.com</A>&gt;:
</I>&gt;<i>
</I>&gt;&gt;<i> in RabbitMQ log and then even stomp/info stops responding to HTTP
</I>&gt;&gt;<i> requests. It happens after several hours under load of about 100-150
</I>&gt;&gt;<i> connections.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> RabbitMQ itself and regular STOMP (that one on port 61613) continue
</I>&gt;&gt;<i> working without any issues.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Nikita,
</I>&gt;<i>
</I>&gt;<i> Thanks for reporting.
</I>&gt;<i>
</I>&gt;<i> Do you have a small script or something that reproduces the issue most of
</I>&gt;<i> the time?
</I>&gt;<i> --
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://github.com/michaelklishin">http://github.com/michaelklishin</A>
</I>&gt;<i> <A HREF="http://twitter.com/michaelklishin">http://twitter.com/michaelklishin</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140209/bd585852/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140209/bd585852/attachment.html</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033678.html">[rabbitmq-discuss] Web STOMP hangs after a while
</A></li>
	<LI>Next message: <A HREF="033682.html">[rabbitmq-discuss] RabbitMQ server suddenly crashing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33679">[ date ]</a>
              <a href="thread.html#33679">[ thread ]</a>
              <a href="subject.html#33679">[ subject ]</a>
              <a href="author.html#33679">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
