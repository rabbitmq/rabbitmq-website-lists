<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustering setup - Inputs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20setup%20-%20Inputs&In-Reply-To=%3CCAEJg2GBaHSJdGn1nE3oN5dz4FDPymSm6m71hpODPD1mYbAaTaQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033808.html">
   <LINK REL="Next"  HREF="033889.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustering setup - Inputs</H1>
    <B>Arun Rao</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20setup%20-%20Inputs&In-Reply-To=%3CCAEJg2GBaHSJdGn1nE3oN5dz4FDPymSm6m71hpODPD1mYbAaTaQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Clustering setup - Inputs">arunrao.seattle at gmail.com
       </A><BR>
    <I>Fri Feb 14 20:06:18 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033808.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
        <LI>Next message: <A HREF="033889.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33836">[ date ]</a>
              <a href="thread.html#33836">[ thread ]</a>
              <a href="subject.html#33836">[ subject ]</a>
              <a href="author.html#33836">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Simon -

That was a wealth of information. I was trying to add this to one of your
blogs which would benefit all the readers but I couldnt find a relevant
topic. I will see where I can publish this information so it will be useful
for everyone.

Regarding this discussion -

&gt;<i> setting basic.qos (which causes message delivery [queue] -&gt; [consuming
</I>channel] to be synchronous inside the cluster).

what if the RabbitMQ client defines the channel as used only for Consuming
or Publishing or both publishing and consuming. I do not know if there is a
provision in AMQP or RabbitMQ can customize that.

When a channel from a (RabbitMQ client) consumer is defined as consumer
only, then there is no effect of this channel (connected from RabbitMQ
client to slave node queue), because replicated queues can only be consumed
from Master node. Will this provide async consumer replication?

Thanks!


On Thu, Feb 13, 2014 at 10:07 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;wrote:

&gt;<i> On 13/02/2014 17:07, Arun Rao wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Thank you so much, Simon, as always!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I learnt from the documentation that queues are single threaded
</I>&gt;&gt;<i> resource. What does this mean to delivering and acknowledging messages?
</I>&gt;&gt;<i> If prefetch_count=10.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Queues are single processes, but they don't get involved with any of the
</I>&gt;<i> work of communicating AMQP, they just accept and dole out messages to
</I>&gt;<i> channel processes (possibly not on the same node) which do that.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Cross cluster traffic are they asynchronous?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The general pattern is: if something is asynchronous in AMQP, then any
</I>&gt;<i> cross-cluster traffic associated with it is also asynchronous. So
</I>&gt;<i> publishing a messsage across a cluster is asynchronous, but starting a
</I>&gt;<i> consumer up with basic.consume is not.
</I>&gt;<i>
</I>&gt;<i> However, there are a couple of exceptions to that: publishing with
</I>&gt;<i> mandatory=true (which is synchronous for [publishing channel] -&gt; [queue]
</I>&gt;<i> inside the cluster) and setting basic.qos (which causes message delivery
</I>&gt;<i> [queue] -&gt; [consuming channel] to be synchronous inside the cluster).
</I>&gt;<i>
</I>&gt;<i> So both of these can have nasty performance in clusters.
</I>&gt;<i>
</I>&gt;<i> With regard to mandatory publishing, it's just that way for historical
</I>&gt;<i> reasons, and it will become async in 3.3.0 anyway.
</I>&gt;<i>
</I>&gt;<i> With regard to delivery when basic.qos is set, this is a painful one. As I
</I>&gt;<i> said in the previous mail, turning on basic.qos means that the prefetch
</I>&gt;<i> count is associated with the channel and hence could be shared between
</I>&gt;<i> multiple queues. That means that each queue needs to synchronously check
</I>&gt;<i> with the channel each time it wants to deliver a message, to see if some
</I>&gt;<i> other queue has used up the prefetch count. It can't just keep a counter.
</I>&gt;<i>
</I>&gt;<i> We're exploring ways to improve this situation in 3.3.x; one option which
</I>&gt;<i> we already have working is to provide a per-consumer prefetch option
</I>&gt;<i> separate from basic.qos; another is to optimise the common case when
</I>&gt;<i> basic.qos is used with a single consumer (although the transitions are a
</I>&gt;<i> bit painful there).
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140214/74af0822/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140214/74af0822/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033808.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
	<LI>Next message: <A HREF="033889.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33836">[ date ]</a>
              <a href="thread.html#33836">[ thread ]</a>
              <a href="subject.html#33836">[ subject ]</a>
              <a href="author.html#33836">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
