<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] .NET API - Using PublishConfirms to get	Reliability
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20.NET%20API%20-%20Using%20PublishConfirms%20to%20get%0A%09Reliability&In-Reply-To=%3C231C327C-A080-4828-B4A5-4B3F5B9DB279%40gopivotal.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034146.html">
   <LINK REL="Next"  HREF="034152.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] .NET API - Using PublishConfirms to get	Reliability</H1>
    <B>Michael Klishin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20.NET%20API%20-%20Using%20PublishConfirms%20to%20get%0A%09Reliability&In-Reply-To=%3C231C327C-A080-4828-B4A5-4B3F5B9DB279%40gopivotal.com%3E"
       TITLE="[rabbitmq-discuss] .NET API - Using PublishConfirms to get	Reliability">mklishin at gopivotal.com
       </A><BR>
    <I>Wed Feb 26 08:02:13 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034146.html">[rabbitmq-discuss] .NET API - Using PublishConfirms to get Reliability
</A></li>
        <LI>Next message: <A HREF="034152.html">[rabbitmq-discuss] .NET API - Using PublishConfirms to get Reliability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34148">[ date ]</a>
              <a href="thread.html#34148">[ thread ]</a>
              <a href="subject.html#34148">[ subject ]</a>
              <a href="author.html#34148">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 26 Feb 2014, at 11:48, Marty Wasznicky &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">marty.wasznicky at neudesic.com</A>&gt; wrote:

&gt;<i> As far as I can tell...it seems like Rabbit MQ loses messages when the servers are taking down.
</I>
So far we&#8217;ve seen no evidence of this.

&gt;<i> For instance...you send a message...and maybe you hit a race condition i.e. that for whatever reason the .net client API isn't designed to throw an error immediately because under the hood it sounds like your using peer networking for communication.
</I>
RabbitMQ .NET client use TCP sockets to communicate with RabbitMQ. When one side of the peer goes down
or becomes unreachable, it takes time for the OS to detect this. RabbitMQ .NET client relies on the OS
to do this and .NET APIs to throw exceptions accordingly:

<A HREF="http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/348a50e651cd/projects/client/RabbitMQ.Client/src/client/impl/ConnectionBase.cs#l618">http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/348a50e651cd/projects/client/RabbitMQ.Client/src/client/impl/ConnectionBase.cs#l618</A>

&gt;<i> 
</I>&gt;<i> I can understand that it takes the peer network perhaps a few seconds to detect that the servers are no longer available.  However, after I took down both servers, I let that consumer loop that reads off the queue run.  It continued to read , without error (of course no messages) for 10 minutes before I finally just killed the process in task manager.  Before I killed it...the channel and connection's IsOpen property was still true.
</I>
OK, this sounds like a .NET client bug. Can you put together a small program that reproduces it? What .NET version do you use,
what version of Windows?

&gt;<i>  That's a serious problem.  I can understand an argument that it takes time for the OS to get a network signal of some sort..but it doesn't take 10 minutes.
</I>&gt;<i> 
</I>&gt;<i> Acks/Nacks get lost.  Sure...we send 50,000 messages through.  Once they all go through. A few minutes later we'll check on our internal queue only to find that there are sometimes several thousand orphaned records that the publisher never received an ack/nack for.
</I>
Again, can you provide a small self-contained program that reproduces this? I expect this to be a .NET client bug
of some kind.

&gt;<i> 
</I>&gt;<i> I've so far only tried to resubmit the messages I have in the internal queue I maintain when there's a server failure....and the server comes back...then I resubmit everything in the queue.  But from your email...its making me think that Rabbit MQ is more unreliable than I thought....if I have to monitor the condition in healthy conditions as well and prepare to resubmit batches&#8230;..
</I>
It has nothing to do with the server but certain (fairly objective) limitations of the client library.

Note that even if there was no such limitation, to ensure a &#8220;never lose a message delivery&#8221; you still need to implement a WAL,
because in the time window between BasicPublish and subsequent socket write your process might die
(OS kills it, someone pulls the plug, etc).
--
MK

Software Engineer, Pivotal/RabbitMQ

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034146.html">[rabbitmq-discuss] .NET API - Using PublishConfirms to get Reliability
</A></li>
	<LI>Next message: <A HREF="034152.html">[rabbitmq-discuss] .NET API - Using PublishConfirms to get Reliability
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34148">[ date ]</a>
              <a href="thread.html#34148">[ thread ]</a>
              <a href="subject.html#34148">[ subject ]</a>
              <a href="author.html#34148">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
