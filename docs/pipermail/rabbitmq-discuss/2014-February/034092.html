<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] BrokerUnreachableException on specific thread	after node goes down
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20BrokerUnreachableException%20on%20specific%20thread%0A%09after%20node%20goes%20down&In-Reply-To=%3CCALDntb8tn2btR8C_4Dpavk_HNf%2ByJF-WhzOZe0QBc2n3XS6VKA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034093.html">
   <LINK REL="Next"  HREF="034094.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] BrokerUnreachableException on specific thread	after node goes down</H1>
    <B>Patrick Long</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20BrokerUnreachableException%20on%20specific%20thread%0A%09after%20node%20goes%20down&In-Reply-To=%3CCALDntb8tn2btR8C_4Dpavk_HNf%2ByJF-WhzOZe0QBc2n3XS6VKA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] BrokerUnreachableException on specific thread	after node goes down">pat at munkiisoft.com
       </A><BR>
    <I>Tue Feb 25 09:40:45 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034093.html">[rabbitmq-discuss] Doubts in bindings
</A></li>
        <LI>Next message: <A HREF="034094.html">[rabbitmq-discuss] BrokerUnreachableException on specific	thread after node goes down
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34092">[ date ]</a>
              <a href="thread.html#34092">[ thread ]</a>
              <a href="subject.html#34092">[ subject ]</a>
              <a href="author.html#34092">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Rabbit 3.2.1
.Net Client
F5 Load balancer
2 node cluster

I am trying to debug an issue with our dequeueing code and a cluster. We
have a Windows service that starts up with three threads each maintaining
its own instance of IModel. That Model is reused each time the thread loops
around to Dequeue a message.

I am testing how well our Windows service stands up to a node going down. I
do this by simply stopping the Rabbit MQ service on the Master node.

In our Windows Service I catch the OperationInterruptedException and
AlreadyClosedException exceptions. When caught I set that thread's Model to
null and it will be recreated the next time around the Dequeue loop.

This approach works fine when the Queues are empty and the loop time is
infrequent.However when I take the node down and our Windows service is
dequeuing and\or Acking messages I hit a problem on one of the threads.

As an example threads 1 and 2 will both catch separate instances of
AlreadyClosedException and reset their IModel. Next time around Thread 1
will reconnect its Model and start dequeueing but Thread 2 will get
a BrokerUnreachableException. I have tried retrying that reconnect with
some Thread.Sleep delays and it does not help. Once &quot;broken&quot; that thread
gets BrokerUnreachableException every time.

Any ideas as to why this might be?

Thanks











-- 
Patrick Long - Munkiisoft Ltd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140225/8fa495f4/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140225/8fa495f4/attachment.html</A>&gt;
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034093.html">[rabbitmq-discuss] Doubts in bindings
</A></li>
	<LI>Next message: <A HREF="034094.html">[rabbitmq-discuss] BrokerUnreachableException on specific	thread after node goes down
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34092">[ date ]</a>
              <a href="thread.html#34092">[ thread ]</a>
              <a href="subject.html#34092">[ subject ]</a>
              <a href="author.html#34092">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
