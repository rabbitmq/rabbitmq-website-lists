<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ throw 541 internal error when unbind an	non-existed binding?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20throw%20541%20internal%20error%20when%20unbind%20an%0A%09non-existed%20binding%3F&In-Reply-To=%3C007f01cf2bac%241ce0af50%2456a20df0%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033896.html">
   <LINK REL="Next"  HREF="033885.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ throw 541 internal error when unbind an	non-existed binding?</H1>
    <B>Junius Wang</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20throw%20541%20internal%20error%20when%20unbind%20an%0A%09non-existed%20binding%3F&In-Reply-To=%3C007f01cf2bac%241ce0af50%2456a20df0%24%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ throw 541 internal error when unbind an	non-existed binding?">wangjunbo924 at gmail.com
       </A><BR>
    <I>Mon Feb 17 06:46:43 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033896.html">[rabbitmq-discuss] Advice on runing mutiple rabbitmq instances in one machine
</A></li>
        <LI>Next message: <A HREF="033885.html">[rabbitmq-discuss] RabbitMQ throw 541 internal error when unbind an non-existed binding?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33882">[ date ]</a>
              <a href="thread.html#33882">[ thread ]</a>
              <a href="subject.html#33882">[ subject ]</a>
              <a href="author.html#33882">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

                Our team installed RabbitMQ 3.0.4 and I'm trying to upgrade
it to latest 3.2.3.   However we encounter an unexpected change from
RabbitMQ.  In 3.0.4, 404 error thrown when unbind an non-existed binding but
if try to unbind an non-existed binding from in RabbitMQ 3.2.3, it throws
541 error.   Is this change expected or an issue?   

In our applications, we may unbind a binding multiple times. The first
attempt succeeds and we expect the following attempts throw 404. We catch
the 404 exception and do something later.  It works well in 3.0.4 but
unlucky in 3.2.3.  If it's an issue of 3.2.3 I will wait for an newer
version. If not ,we will have to change our code or just use 3.0.4.

 

                What's more interesting is that only when the exchange type
is &quot;topic&quot;.  When the type is &quot;fanout&quot; or &quot;direct&quot;, the expected 404 thrown.
I wrote some python test codes today to verify it:

 

#!/usr/bin/env python

import pika

 

connection =
pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))

channel = connection.channel()

 

exchange_name = 'py_test_exchange'

queue_name = 'py_test_queue'

routing_key = 'black'

exchange_type='topic'

 

channel.exchange_declare(exchange=exchange_name,type=exchange_type)

channel.queue_declare(queue=queue_name)

channel.queue_bind(exchange=exchange_name,queue=queue_name,routing_key=routi
ng_key)

 

channel.queue_unbind(exchange=exchange_name,queue=queue_name,routing_key=rou
ting_key)

channel.queue_unbind(exchange=exchange_name,queue=queue_name,routing_key=rou
ting_key)

 

channel.queue_delete(queue=queue_name)

channel.exchange_delete(exchange=exchange_name)

 

And when I run this code, it says &quot;pika.exceptions.ChannelClosed: (541,
'INTERNAL_ERROR')&quot;.  And from the RabbitMQ logs(it says 'badmatch' probably
because the binding doesn't exist): 


=ERROR REPORT==== 17-Feb-2014::14:37:54 ===

AMQP connection &lt;0.12741.0&gt; (running), channel 1 - error:

{{error,

     {{badmatch,{error,[{root,none}],[&quot;black&quot;]}},

      [{rabbit_exchange_type_topic,follow_down_get_path,2,

           [{file,&quot;src/rabbit_exchange_type_topic.erl&quot;},{line,139}]},

       {rabbit_exchange_type_topic,'-remove_bindings/3-lc$^1/1-1-',1,

           [{file,&quot;src/rabbit_exchange_type_topic.erl&quot;},{line,81}]},

       {rabbit_exchange_type_topic,remove_bindings,3,

           [{file,&quot;src/rabbit_exchange_type_topic.erl&quot;},{line,79}]},

       {rabbit_binding,x_callback,4,

           [{file,&quot;src/rabbit_binding.erl&quot;},{line,542}]},

       {rabbit_binding,'-process_deletions/1-fun-0-',2,

           [{file,&quot;src/rabbit_binding.erl&quot;},{line,524}]},

       {dict,map_bucket,2,[{file,&quot;dict.erl&quot;},{line,460}]},

       {dict,map_bkt_list,2,[{file,&quot;dict.erl&quot;},{line,456}]},

       {dict,map_bkt_list,2,[{file,&quot;dict.erl&quot;},{line,456}]}]}},

[{rabbit_misc,execute_mnesia_transaction,1,

      [{file,&quot;src/rabbit_misc.erl&quot;},{line,509}]},

  {rabbit_misc,execute_mnesia_tx_with_tail,1,

      [{file,&quot;src/rabbit_misc.erl&quot;},{line,531}]},

  {rabbit_channel,binding_action,9,

      [{file,&quot;src/rabbit_channel.erl&quot;},{line,1279}]},

 
{rabbit_channel,handle_cast,2,[{file,&quot;src/rabbit_channel.erl&quot;},{line,274}]},

  {gen_server2,handle_msg,2,[{file,&quot;src/gen_server2.erl&quot;},{line,934}]},

  {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,239}]}]}

Any comment will be appreciated. 

 

Thanks

Junbo Wang

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140217/010c4ce1/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140217/010c4ce1/attachment.html</A>&gt;
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033896.html">[rabbitmq-discuss] Advice on runing mutiple rabbitmq instances in one machine
</A></li>
	<LI>Next message: <A HREF="033885.html">[rabbitmq-discuss] RabbitMQ throw 541 internal error when unbind an non-existed binding?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33882">[ date ]</a>
              <a href="thread.html#33882">[ thread ]</a>
              <a href="subject.html#33882">[ subject ]</a>
              <a href="author.html#33882">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
