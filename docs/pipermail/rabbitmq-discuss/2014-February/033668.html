<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Issue with RabbitMQ 2-way federation setup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Issue%20with%20RabbitMQ%202-way%20federation%20setup&In-Reply-To=%3CCA%2B_8W%2B0%3DnQ2V%3DONW37irbzinkNFAx%3DfSeT%3DCUjhi6tHY%3D9QEGg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033659.html">
   <LINK REL="Next"  HREF="033672.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Issue with RabbitMQ 2-way federation setup</H1>
    <B>Rahul</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Issue%20with%20RabbitMQ%202-way%20federation%20setup&In-Reply-To=%3CCA%2B_8W%2B0%3DnQ2V%3DONW37irbzinkNFAx%3DfSeT%3DCUjhi6tHY%3D9QEGg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Issue with RabbitMQ 2-way federation setup">rahulkj at gmail.com
       </A><BR>
    <I>Fri Feb  7 15:29:09 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033659.html">[rabbitmq-discuss] Issue with RabbitMQ 2-way federation setup
</A></li>
        <LI>Next message: <A HREF="033672.html">[rabbitmq-discuss] Issue with RabbitMQ 2-way federation setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33668">[ date ]</a>
              <a href="thread.html#33668">[ thread ]</a>
              <a href="subject.html#33668">[ subject ]</a>
              <a href="author.html#33668">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Simon for this info.

What I was trying to achieve is, ensure the messages are available in the
queues on both Node A and B.
So what I understand from the description is, federation does not simulate
the mirrored queues behavior.

I need to create queue with the same name/different name and bind them to
the same exchange. That way when a message is published to the exchange,
and if I've set the exchange federation policy, then the message will be
routed to respective queues.

Mirroring ensures the same message is available on all cluster nodes.

Is there a way I can simulate mirroring using federation?



On Fri, Feb 7, 2014 at 4:19 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> So with the configuration you have described, you will be federating both
</I>&gt;<i> your exchange and queue. That might not be what you want.
</I>&gt;<i>
</I>&gt;<i> Federated exchanges *copy* messages across the network, one per binding.
</I>&gt;<i>
</I>&gt;<i> Federated queues *move* messages to where the consumers are.
</I>&gt;<i>
</I>&gt;<i> It's possible that what you've done is created a federated exchange and a
</I>&gt;<i> federated queue, and only bound them together at one of the nodes?
</I>&gt;<i>
</I>&gt;<i> If you want messages to end up on both nodes then you want to only
</I>&gt;<i> federate the exchange, not the queue; create queues at each node and bind
</I>&gt;<i> them to the federated exchange.
</I>&gt;<i>
</I>&gt;<i> Also as Arun said, the config you've given references an upstream-set
</I>&gt;<i> &quot;test&quot; which doesn't appear to exist - create it or use &quot;all&quot;.
</I>&gt;<i>
</I>&gt;<i> And yes, federation works for all exchange types.
</I>&gt;<i>
</I>&gt;<i> Checking federation status (<A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>
</I>&gt;<i> federation-reference.html#status) is likely to prove illuminating.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 06/02/2014 11:07PM, Rahul Jain wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've been trying to setup a 2-way federation for my 2 nodes A and B.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I ran the following commands on Node A:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> |sudo rabbitmqctl set_parameter federation-upstream rabbit2
</I>&gt;&gt;<i> '{&quot;uri&quot;:&quot;<A HREF="amqp://&lt;Node">amqp://&lt;Node</A> B IP&gt;&quot;}'
</I>&gt;&gt;<i> sudo rabbitmqctl set_parameter federation local-nodename '&quot;rabbit1&quot;'
</I>&gt;&gt;<i> sudo rabbitmqctl set_policy federate-me &quot;^test\.&quot;
</I>&gt;&gt;<i> '{&quot;federation-upstream-set&quot;:&quot;test&quot;}'|
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> commands on Node B:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> |sudo rabbitmqctl set_parameter federation-upstream rabbit2
</I>&gt;&gt;<i> '{&quot;uri&quot;:&quot;<A HREF="amqp://&lt;Node">amqp://&lt;Node</A> A IP&gt;&quot;}'
</I>&gt;&gt;<i> sudo rabbitmqctl set_parameter federation local-nodename '&quot;rabbit2&quot;'
</I>&gt;&gt;<i> sudo rabbitmqctl set_policy federate-me &quot;^test\.&quot;
</I>&gt;&gt;<i> '{&quot;federation-upstream-set&quot;:&quot;test&quot;}'|
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Now I created a fanout exchange and queue on Node A, namely
</I>&gt;&gt;<i> test.fanout-Exchange and test.fanout-Queue, using the RabbitMQ console.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When I publish a message using RabbitMQ console of Node A, I see the
</I>&gt;&gt;<i> message reaches the queue on Node A alone, and not on Node B.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any clues?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i>
</I>


-- 
Regards,
Rahul
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140207/0751b339/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140207/0751b339/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033659.html">[rabbitmq-discuss] Issue with RabbitMQ 2-way federation setup
</A></li>
	<LI>Next message: <A HREF="033672.html">[rabbitmq-discuss] Issue with RabbitMQ 2-way federation setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33668">[ date ]</a>
              <a href="thread.html#33668">[ thread ]</a>
              <a href="subject.html#33668">[ subject ]</a>
              <a href="author.html#33668">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
