<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] ACKs getting lost
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ACKs%20getting%20lost&In-Reply-To=%3C80456ED3F63DCB4B9E0982F2DB8A5693F81AC088%40NeuExc13.corp.neudesic.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034068.html">
   <LINK REL="Next"  HREF="034037.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] ACKs getting lost</H1>
    <B>Michael Collins</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20ACKs%20getting%20lost&In-Reply-To=%3C80456ED3F63DCB4B9E0982F2DB8A5693F81AC088%40NeuExc13.corp.neudesic.net%3E"
       TITLE="[rabbitmq-discuss] ACKs getting lost">Michael.Collins at neudesic.com
       </A><BR>
    <I>Sat Feb 22 00:20:31 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034068.html">[rabbitmq-discuss] autoheal behavior in the presence of HA-queues mastered on multiple nodes?
</A></li>
        <LI>Next message: <A HREF="034037.html">[rabbitmq-discuss] ACKs getting lost
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34036">[ date ]</a>
              <a href="thread.html#34036">[ thread ]</a>
              <a href="subject.html#34036">[ subject ]</a>
              <a href="author.html#34036">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We're using RabbitMQ 3.2.2 and Erlang R16B03 on Windows and using the RabbitMQ.Client API to implement a message bus over RabbitMQ.

I am testing a scenario where I have an exchange and durable queues with auto-acknowledge set to false. If I publish a number of messages (say 100 messages), my receiver receives all 100 messages and sends back 100 ACKs using IModel.BasicAck(). My receiver is using a QueueingBasicConsumer object to receive the messages from RabbitMQ.

On the sender side, I am keeping the messages in a dictionary in memory keyed by the delivery tag of the message. When I receive an ACK, then I remove that message from the dictionary. What I am noticing is that when I send a batch of 100 messages, and the receiver says that it sends back 100 ACKS, there are sometimes 3-5 messages remaining in my dictionary that the sender didn't receive an ACK for.

I set up tracing on both applications and watched them run in batches of 100 or 1000. All of the messages were received and ACK'd by the receiver, but again, somewhere between 3-10 messages (depending on the batch size) are not getting ACK'd at the sender side.

I'm watching for ACKs, NACKs, and returns using the IModel.BasicAcks, IModel.BasicNacks, and IModel.BasicReturn events. I'm not getting back NACKs or returns either.

I tried changing my configuration to use auto-acknowledge on the receiver side. I'm seeing the behavior, but not as bad. With auto-acknowledge, it's about 1-3 messages per batch that are not receiving ACKs. These tests were also run on a single server, but we first noticed it when running in a RabbitMQ cluster.

Can anyone suggest ideas for diagnosing what the issue is or how to figure out where the ACKs are getting lost?

Thanks.

Michael Collins


Confidentiality Notice: This email and any attachments are confidential. If you have received this in error, please let us know by email reply and delete the email and all attachments from your system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140222/23c08cd9/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140222/23c08cd9/attachment.html</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034068.html">[rabbitmq-discuss] autoheal behavior in the presence of HA-queues mastered on multiple nodes?
</A></li>
	<LI>Next message: <A HREF="034037.html">[rabbitmq-discuss] ACKs getting lost
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34036">[ date ]</a>
              <a href="thread.html#34036">[ thread ]</a>
              <a href="subject.html#34036">[ subject ]</a>
              <a href="author.html#34036">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
