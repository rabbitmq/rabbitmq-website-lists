<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustering setup - Inputs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20setup%20-%20Inputs&In-Reply-To=%3C52FCE4EC.2030504%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033786.html">
   <LINK REL="Next"  HREF="033807.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustering setup - Inputs</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20setup%20-%20Inputs&In-Reply-To=%3C52FCE4EC.2030504%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Clustering setup - Inputs">simon at rabbitmq.com
       </A><BR>
    <I>Thu Feb 13 15:29:48 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033786.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
        <LI>Next message: <A HREF="033807.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33795">[ date ]</a>
              <a href="thread.html#33795">[ thread ]</a>
              <a href="subject.html#33795">[ subject ]</a>
              <a href="author.html#33795">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/02/14 06:25, Arun Rao wrote:
&gt;<i> 1. If I had 10 servers, will I achieve more throughput having 5 clusters
</I>&gt;<i> (2 nodes each) compared to 2 clusters (5 nodes each)? I get into the
</I>&gt;<i> grey area when i think if I had 5 servers in a cluster and all servers
</I>&gt;<i> are taking traffic, then there could be more load syncing traffic across
</I>&gt;<i> clusters?
</I>
The key question is really: &quot;Where are your queues?&quot; The question of how 
you arrange your nodes into clusters is actually quite secondary to this.

Any given queue can only be on one node at once (in the case of an HA 
queue the master can only be on one node and the slaves contribute 
greater reliability but not greater throughput). And cross cluster 
traffic is not free.

So if you only have one queue, you will get the best results if all 
publishers and consumers connect directly to that queue.

If you have more than one queue, you'll benefit from sharing the queues 
across nodes. It's still always best if your consumers and producers 
connect to the same node as the queue is on. Obviously this can't always 
be arranged :-) but it should be followed as much as possible.

&gt;<i> 2. Will I benefit if I had publishers publishing to 3 servers out of 4
</I>&gt;<i> servers (in a cluster) and consumers consuming from all 4 servers. This
</I>&gt;<i> way the 4th server not in publisher's radar will be more effective in
</I>&gt;<i> draining clusters queues?
</I>
Again, it depends where the queues are.

&gt;<i> 3. Higher QoS Prefetch count and multiple acknowledgements.
</I>
At the moment, turning off prefetch (either don't use basic.qos or set 
prefetch_count to 0) is much faster, especially when consuming across a 
cluster (i.e. with the connection of a different node to the queue). 
This is because qos is shared between consuming queues on a channel, so 
we need to do a bit of coordination between cluster nodes just to figure 
out if we can deliver a message.

We will have an improvement to this in 3.3.0.

Acknowledgements with multiple=true will help somewhat, if only by 
reducing the amount of work your consuming connection / channel have to 
do. But the queue will have to do nearly as much work, so they are no 
panacea.

Hope this helps.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033786.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
	<LI>Next message: <A HREF="033807.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33795">[ date ]</a>
              <a href="thread.html#33795">[ thread ]</a>
              <a href="subject.html#33795">[ subject ]</a>
              <a href="author.html#33795">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
