<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ publishing is taking time
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20publishing%20is%20taking%20time&In-Reply-To=%3CF83BA833AB75C246895C67CF618594F74C2C6206%40WSS-CHA-MX01.WSE.wsmain.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034085.html">
   <LINK REL="Next"  HREF="034197.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ publishing is taking time</H1>
    <B>Piyush Nagar</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20publishing%20is%20taking%20time&In-Reply-To=%3CF83BA833AB75C246895C67CF618594F74C2C6206%40WSS-CHA-MX01.WSE.wsmain.local%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ publishing is taking time">piyush.nagar at winshuttle.com
       </A><BR>
    <I>Tue Feb 25 06:27:49 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034085.html">[rabbitmq-discuss] Multiple enqueued RPC methods and	ShutdownSignalExceptions and simulating ConnectionTimeouts
</A></li>
        <LI>Next message: <A HREF="034197.html">[rabbitmq-discuss] RabbitMQ publishing is taking time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34084">[ date ]</a>
              <a href="thread.html#34084">[ thread ]</a>
              <a href="subject.html#34084">[ subject ]</a>
              <a href="author.html#34084">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Thanks for the reply. I used Firehose and below are my observations:

As soon as message is published using BasicPublish method, it reaches to queue with routing key publish.exchangename immediately. But it takes time while reaching deliver.queuename queue. I am correlating all messages with correlationID in header which is a GUID and it is same.

So that means, messages are reaching to rabbitMQ but are taking time to deliver (which should not be there and messages should come to this queue also immediately). I have sufficient consumers and prefetch counts available. Also when there is increase in number of concurrent messages, this time difference increases. All the messages are binary data with some file blob.

Also, I want to mention that, using logging in my publisher, I found out that, let 20 messages are published. But using management console, I can see only 6-7 messages, all are in unacked state (we send ack only after consumption by consumer, which takes some time).

Please suggest me the path to take from here.


-----Original Message-----
From: Simon MacMullen [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>]
Sent: Wednesday, January 29, 2014 6:30 PM
To: Discussions about RabbitMQ
Cc: Piyush Nagar
Subject: Re: [rabbitmq-discuss] RabbitMQ publishing is taking time

On 29/01/14 12:51, Piyush Nagar wrote:
&gt;<i> I am clue less what is happening here. Can anyone tell me what should
</I>&gt;<i> I search for or what other monitoring I can do her for RabbitMQ.
</I>
You could use tracing / firehose to generate trace messages with timestamps when the broker receives the messages.

<A HREF="http://www.rabbitmq.com/firehose.html">http://www.rabbitmq.com/firehose.html</A>
<A HREF="http://hg.rabbitmq.com/rabbitmq-tracing/file/rabbitmq_v3_2_3/README">http://hg.rabbitmq.com/rabbitmq-tracing/file/rabbitmq_v3_2_3/README</A>

That would give you some confirmation that the messages are not getting delayed in queues somehow.

But I suspect you'll find that the delay is before the broker generates the firehose message. So the next step would be to watch the publishing connection with Wireshark; that can analyse AMQP frames so you should be able to see the messages just before they reach the broker.

I strongly suspect you'll find the problem lies in your client application though...

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal
________________________________
Winshuttle Important Notice: The information contained in this e-mail message and any attachments hereto is confidential and is intended solely for the person to whom it is addressed. Any use, disclosure, reproduction, modification or distribution of the contents of this e-mail, or any part thereof, other than by the intended recipient, is strictly prohibited. If you are not the intended recipient or have received this message in error, please notify the sender of this e-mail immediately by return e-mail and destroy the message and all copies in your possession. Our messages are checked for viruses but please note that we do not accept liability for any viruses which may be transmitted in or with this message.
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034085.html">[rabbitmq-discuss] Multiple enqueued RPC methods and	ShutdownSignalExceptions and simulating ConnectionTimeouts
</A></li>
	<LI>Next message: <A HREF="034197.html">[rabbitmq-discuss] RabbitMQ publishing is taking time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34084">[ date ]</a>
              <a href="thread.html#34084">[ thread ]</a>
              <a href="subject.html#34084">[ subject ]</a>
              <a href="author.html#34084">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
