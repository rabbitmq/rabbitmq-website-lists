<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustering setup - Inputs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20setup%20-%20Inputs&In-Reply-To=%3C52FD09F9.9020109%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033807.html">
   <LINK REL="Next"  HREF="033836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustering setup - Inputs</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20setup%20-%20Inputs&In-Reply-To=%3C52FD09F9.9020109%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Clustering setup - Inputs">simon at rabbitmq.com
       </A><BR>
    <I>Thu Feb 13 18:07:53 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033807.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
        <LI>Next message: <A HREF="033836.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33808">[ date ]</a>
              <a href="thread.html#33808">[ thread ]</a>
              <a href="subject.html#33808">[ subject ]</a>
              <a href="author.html#33808">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/02/2014 17:07, Arun Rao wrote:
&gt;<i> Thank you so much, Simon, as always!
</I>&gt;<i>
</I>&gt;<i> I learnt from the documentation that queues are single threaded
</I>&gt;<i> resource. What does this mean to delivering and acknowledging messages?
</I>&gt;<i> If prefetch_count=10.
</I>
Queues are single processes, but they don't get involved with any of the 
work of communicating AMQP, they just accept and dole out messages to 
channel processes (possibly not on the same node) which do that.

&gt;<i> Cross cluster traffic are they asynchronous?
</I>
The general pattern is: if something is asynchronous in AMQP, then any 
cross-cluster traffic associated with it is also asynchronous. So 
publishing a messsage across a cluster is asynchronous, but starting a 
consumer up with basic.consume is not.

However, there are a couple of exceptions to that: publishing with 
mandatory=true (which is synchronous for [publishing channel] -&gt; [queue] 
inside the cluster) and setting basic.qos (which causes message delivery 
[queue] -&gt; [consuming channel] to be synchronous inside the cluster).

So both of these can have nasty performance in clusters.

With regard to mandatory publishing, it's just that way for historical 
reasons, and it will become async in 3.3.0 anyway.

With regard to delivery when basic.qos is set, this is a painful one. As 
I said in the previous mail, turning on basic.qos means that the 
prefetch count is associated with the channel and hence could be shared 
between multiple queues. That means that each queue needs to 
synchronously check with the channel each time it wants to deliver a 
message, to see if some other queue has used up the prefetch count. It 
can't just keep a counter.

We're exploring ways to improve this situation in 3.3.x; one option 
which we already have working is to provide a per-consumer prefetch 
option separate from basic.qos; another is to optimise the common case 
when basic.qos is used with a single consumer (although the transitions 
are a bit painful there).

Cheers, Simon

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033807.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
	<LI>Next message: <A HREF="033836.html">[rabbitmq-discuss] Clustering setup - Inputs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33808">[ date ]</a>
              <a href="thread.html#33808">[ thread ]</a>
              <a href="subject.html#33808">[ subject ]</a>
              <a href="author.html#33808">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
