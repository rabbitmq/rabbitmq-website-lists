<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] .NET Client - PublishConfirms and batching Acks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20.NET%20Client%20-%20PublishConfirms%20and%20batching%20Acks&In-Reply-To=%3C8E5A97AB8C29BC4385231967D868053A6CB6A5%40NeuExc13.corp.neudesic.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034122.html">
   <LINK REL="Next"  HREF="034131.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] .NET Client - PublishConfirms and batching Acks</H1>
    <B>Marty Wasznicky</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20.NET%20Client%20-%20PublishConfirms%20and%20batching%20Acks&In-Reply-To=%3C8E5A97AB8C29BC4385231967D868053A6CB6A5%40NeuExc13.corp.neudesic.net%3E"
       TITLE="[rabbitmq-discuss] .NET Client - PublishConfirms and batching Acks">marty.wasznicky at neudesic.com
       </A><BR>
    <I>Tue Feb 25 20:20:25 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="034122.html">[rabbitmq-discuss] php-amqplib Client publish to Queue and	redirect to a new page
</A></li>
        <LI>Next message: <A HREF="034131.html">[rabbitmq-discuss] .NET Client - PublishConfirms and batching	Acks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34128">[ date ]</a>
              <a href="thread.html#34128">[ thread ]</a>
              <a href="subject.html#34128">[ subject ]</a>
              <a href="author.html#34128">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I'm using the .NET client and attempting to get performance from using PublishConfirms. To date, I don't see much performance over using the txConfirm model though. Hence, I'm wondering if I'm doing something wrong.

I'm creating the Connection and Model and then calling ConfirmSelect()

Then in a tight loop, I'm publishing messages like so:
                    lock (this.activeMessagesLock)
                        {
                            var deliveryTag = 0UL;
                            deliveryTag = this.model.NextPublishSeqNo;

                            this.model.BasicPublish(
                                this.exchangeName,
                                message.Header.Topic,
                                this.properties.Durable,
                                false,
                                messageProperties,
                                body);

                            this.activeMessages[deliveryTag] = message;
                        }

On the consumer side I'm doing the following for receiving the messages:

        consumerModel = this.connection.CreateModel();
                consumerModel.BasicQos(0, 1, false);
                var consumer = new QueueingBasicConsumer(consumerModel);

                var consumerTag = consumerModel.BasicConsume(
                    this.queueName,true,
                    consumer);

                while (true)
                {
                           BasicDeliverEventArgs item = null;
                        if (!consumer.Queue.Dequeue(3000, out item))
                        {
                            if (this.terminateThreadConsume.WaitOne(0))
                            {
                                connectionClosed = true;
                                break;
                            }

                            continue;
                        }

               if (null == item)
                        {
                          continue;
                        }
                      consumerModel.BasicAck(item.DeliveryTag, true);

                }

Unfortunately this is really slow.  Is there some property I'm missing that I can use to increase performance?  Since I'm setting the &quot;multiple&quot; flag to True in the BasicAck, I tried to call that on every 100 or 1000th message....but I found if an ack isn't sent, I'm not allowed to read another message off the queue.

Thanks




Confidentiality Notice: This email and any attachments are confidential. If you have received this in error, please let us know by email reply and delete the email and all attachments from your system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140225/d0c75c9d/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140225/d0c75c9d/attachment.html</A>&gt;
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034122.html">[rabbitmq-discuss] php-amqplib Client publish to Queue and	redirect to a new page
</A></li>
	<LI>Next message: <A HREF="034131.html">[rabbitmq-discuss] .NET Client - PublishConfirms and batching	Acks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34128">[ date ]</a>
              <a href="thread.html#34128">[ thread ]</a>
              <a href="subject.html#34128">[ subject ]</a>
              <a href="author.html#34128">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
