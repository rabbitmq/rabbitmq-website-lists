<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queue failure, potential loss of data.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20failure%2C%20potential%20loss%20of%20data.&In-Reply-To=%3CCAD6m6fGXv_M64gSCMEfELpeggiicygPoXOgEwKjqtT-ndi8FeA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="033827.html">
   <LINK REL="Next"  HREF="033829.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queue failure, potential loss of data.</H1>
    <B>Jason McIntosh</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Queue%20failure%2C%20potential%20loss%20of%20data.&In-Reply-To=%3CCAD6m6fGXv_M64gSCMEfELpeggiicygPoXOgEwKjqtT-ndi8FeA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Queue failure, potential loss of data.">mcintoshj at gmail.com
       </A><BR>
    <I>Fri Feb 14 15:43:46 GMT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="033827.html">[rabbitmq-discuss] basicReject vs basicNack
</A></li>
        <LI>Next message: <A HREF="033829.html">[rabbitmq-discuss] Queue failure, potential loss of data.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33828">[ date ]</a>
              <a href="thread.html#33828">[ thread ]</a>
              <a href="subject.html#33828">[ subject ]</a>
              <a href="author.html#33828">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>RabbitMQ 3.2.0
Erlang R16B02-1

We have a queue that basically stopped doing anything intelligent.  Here
are the results.  What's bad about this - it appears that messages
continued to publish and didn't hit the dead letter exchange - they just
disappeared.  In this architecture, we've got a fanout exchange that
publishes to two queues.  One of the queues is working fine still.  Our
second queue though is what dropped off.  Publishing though hasn't failed
so I'm worried we've lost data for the last data.  Any input would be
welcome on this.  Here's the second queues information from the management
gui:
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cluster at rabbitmqm10pDLX</A> DLK D ArgsActive???0.00/s

When I try and select the queue, I just get an error message:
TypeError: Cannot read property 'ram_msg_count' of undefined

Any help/advice here?  Is there some way I can change this queue so I do
NOT lose messages and publishes fail??  I thought publisher confirms (need
to verify they're on) would have taken care of this situation - that the
message would have had to have been consumed or persisted to disk for all
queues or publishing would have been rejected.
Jason



=CRASH REPORT==== 13-Feb-2014::05:14:36 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.367.0&gt;
    registered_name: []
    exception exit: {{badmatch,{error,not_found}},
                     [{rabbit_mirror_queue_master,stop_all_slaves,2,[]},

{rabbit_mirror_queue_master,delete_and_terminate,2,[]},
                      {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',
                          6,[]},
                      {rabbit_amqqueue_process,terminate_shutdown,2,[]},
                      {gen_server2,terminate,3,[]},
                      {proc_lib,wake_up,3,
                          [{file,&quot;proc_lib.erl&quot;},{line,249}]}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,&lt;0.154.0&gt;]
    messages: []
    links: [&lt;0.250.0&gt;,#Port&lt;0.17147&gt;]
    dictionary: [{{ch,&lt;17654.9226.6150&gt;},
                   {cr,&lt;17654.9226.6150&gt;,#Ref&lt;0.0.18055.20563&gt;,
                       {[],[26925191]},
                       1,
                       {queue,
                           [{&lt;17654.9226.6150&gt;,

 {consumer,&lt;&lt;&quot;amq.ctag-LPmzPvp2doZ9pYs-cEEcFg&quot;&gt;&gt;,
                                 true,[]}}],
                           [],1},
                       {qstate,&lt;17654.21979.6150&gt;,suspended,{0,nil}},
                       4}},
                  {credit_blocked,[]},
                  {{ch,&lt;17659.4312.6334&gt;},
                   {cr,&lt;17659.4312.6334&gt;,#Ref&lt;0.0.18273.227308&gt;,
                       {[],[26925208]},
                       1,
                       {queue,
                           [{&lt;17659.4312.6334&gt;,

 {consumer,&lt;&lt;&quot;amq.ctag--3Kwc_Q-QS9kcpZ9U--8-Q&quot;&gt;&gt;,
                                 true,[]}}],
                           [],1},
                       {qstate,&lt;17659.2894.6334&gt;,suspended,{0,nil}},
                       19}},
                  {{ch,&lt;17659.3911.6334&gt;},
                   {cr,&lt;17659.3911.6334&gt;,#Ref&lt;0.0.18273.227286&gt;,
                       {[26925232,26925226],[26925214]},
                       1,
                       {queue,[],[],0},
                       {qstate,&lt;17659.2051.6334&gt;,active,{0,nil}},
                       22}},
                  {{#Ref&lt;0.0.0.36427&gt;,fhc_handle},
                   {handle,
                       {file_descriptor,prim_file,{#Port&lt;0.17147&gt;,132}},
                       118224,false,5136,infinity,
                       [[&lt;&lt;192,0,0,0,1,154,216,155&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,151&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,150&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,149&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,148&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,147&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,146&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,144&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,142&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,143&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,141&gt;&gt;],
                        [&lt;&lt;192,0,0,0,1,154,216,140&gt;&gt;],
.,...



=SUPERVISOR REPORT==== 13-Feb-2014::05:14:36 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {{badmatch,{error,not_found}},
                  [{rabbit_mirror_queue_master,stop_all_slaves,2,[]},
                   {rabbit_mirror_queue_master,delete_and_terminate,2,[]},

 {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6,[]},
                   {rabbit_amqqueue_process,terminate_shutdown,2,[]},
                   {gen_server2,terminate,3,[]},
                   {proc_lib,wake_up,3,[{file,&quot;proc_lib.erl&quot;},{line,249}]}]}
     Offender:   [{pid,&lt;0.367.0&gt;},
                  {name,rabbit_amqqueue},
                  {mfargs,{rabbit_amqqueue_process,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 13-Feb-2014::10:59:28 ===
     Supervisor: {&lt;0.19778.5266&gt;,
                                           amqp_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{nb_children,1},
                  {name,channel_sup},
                  {mfargs,

{amqp_channel_sup,start_link,[direct,&lt;0.20460.5266&gt;]}},
                  {restart_type,temporary},
                  {shutdown,brutal_kill},
                  {child_type,supervisor}]


=SUPERVISOR REPORT==== 13-Feb-2014::11:02:34 ===
     Supervisor: {&lt;0.852.5267&gt;,amqp_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{nb_children,1},
                  {name,channel_sup},
                  {mfargs,
                      {amqp_channel_sup,start_link,[direct,&lt;0.2623.5267&gt;]}},
                  {restart_type,temporary},
                  {shutdown,brutal_kill},
                  {child_type,supervisor}]


=SUPERVISOR REPORT==== 13-Feb-2014::11:03:24 ===
     Supervisor: {&lt;0.4628.5267&gt;,amqp_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{nb_children,1},
                  {name,channel_sup},
                  {mfargs,
                      {amqp_channel_sup,start_link,[direct,&lt;0.5878.5267&gt;]}},
                  {restart_type,temporary},
                  {shutdown,brutal_kill},
                  {child_type,supervisor}]


=CRASH REPORT==== 13-Feb-2014::11:12:31 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.4699.5268&gt;
    registered_name: []
    exception exit: {{badmatch,true},
                     [{rabbit_queue_index,init,2,[]},
                      {rabbit_variable_queue,init,5,[]},
                      {rabbit_mirror_queue_master,init,3,[]},
                      {rabbit_amqqueue_process,declare,3,[]},
                      {gen_server2,handle_msg,2,[]},
                      {proc_lib,init_p_do_apply,3,
                                [{file,&quot;proc_lib.erl&quot;},{line,239}]}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,&lt;0.154.0&gt;]
    messages: []
    links: [&lt;0.250.0&gt;]
    dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct}]
    trap_exit: true
    status: running
    heap_size: 1598
    stack_size: 27
    reductions: 1156
  neighbours:

=SUPERVISOR REPORT==== 13-Feb-2014::11:12:31 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {{badmatch,true},
                  [{rabbit_queue_index,init,2,[]},
                   {rabbit_variable_queue,init,5,[]},
                   {rabbit_mirror_queue_master,init,3,[]},
                   {rabbit_amqqueue_process,declare,3,[]},
                   {gen_server2,handle_msg,2,[]},
                   {proc_lib,init_p_do_apply,3,
                             [{file,&quot;proc_lib.erl&quot;},{line,239}]}]}
     Offender:   [{pid,&lt;0.4699.5268&gt;},
                  {name,rabbit_amqqueue},
                  {mfargs,{rabbit_amqqueue_process,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]

=SUPERVISOR REPORT==== 13-Feb-2014::11:35:08 ===
     Supervisor: {&lt;0.6708.5271&gt;,amqp_channel_sup_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{nb_children,1},
                  {name,channel_sup},
                  {mfargs,
                      {amqp_channel_sup,start_link,[direct,&lt;0.7855.5271&gt;]}},
                  {restart_type,temporary},
                  {shutdown,brutal_kill},
                  {child_type,supervisor}]


-- 
Jason McIntosh
<A HREF="https://github.com/jasonmcintosh/">https://github.com/jasonmcintosh/</A>
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140214/39120558/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140214/39120558/attachment.html</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="033827.html">[rabbitmq-discuss] basicReject vs basicNack
</A></li>
	<LI>Next message: <A HREF="033829.html">[rabbitmq-discuss] Queue failure, potential loss of data.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#33828">[ date ]</a>
              <a href="thread.html#33828">[ thread ]</a>
              <a href="subject.html#33828">[ subject ]</a>
              <a href="author.html#33828">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
