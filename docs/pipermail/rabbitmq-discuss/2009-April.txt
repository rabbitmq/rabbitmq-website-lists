From matthias at lshift.net  Wed Apr  1 00:22:10 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 01 Apr 2009 00:22:10 +0100
Subject: [rabbitmq-discuss] Flow Control in RabbitMQ 1.5.3
In-Reply-To: <de47e4420903311536r1e1227f3n7b38b31daa2596ce@mail.gmail.com>
References: <de47e4420903231145k6c16bffdoabd428d2270c06cb@mail.gmail.com>	<49C7ED93.6020600@lshift.net>	<de47e4420903231431n2f8b19acyf0ab2a3d968b74cb@mail.gmail.com>
	<de47e4420903311536r1e1227f3n7b38b31daa2596ce@mail.gmail.com>
Message-ID: <49D2A5A2.3080408@lshift.net>

Chris,

Chris Pettitt wrote:
> What I'm seeing is usually some variation of the following:
> 
> 1. Start broker clean
> 2. Start 1 consumer
> 3. Start 10 producers that publish as fast as they can (we're trying
> to stress the system)
> 4. Once system memory reaches the high water mark throttling occurs
> (I've tried settings from about 40% - 95%, the rest of the
> observations will refer to measurements at 70%).
> 5. Throttling toggles on and off a few times, between 3 - 5 times, and
> then all clients (including the consumer) get disconnected.
> 6. Memory sores to over 90%.
> 6. Sometimes the erlang process crashes at this point, other times all
> producers and consumers reconnect and within about 30 seconds the
> erlang process crashes. In most cases the producers never produce
> after the reconnect, but on some occasions the consumer does receive
> messages before dying.

I have tried to reproduce the above by running the 
com.rabbitmq.examples.MulticastMain test with the args "-a -x 10 -s 
1024", and while I can make RabbitMQ crash with the default 95% limit, 
once I lowered the limit to 70% it kept going.

That's on an old-ish machine with only 4GB of memory though. It's 
conceivable that a faster machine with more memory requires more of a 
margin. 40%, which is the lowest limit you tried, is quite low, but it 
may be worth trying even lower limits.

Can you send us the code for your tests? I'd like to gain a better 
understanding of exactly what parts of RabbitMQ get stressed, and how 
your test differs from what MulticastMain with the above params does.


Also, what version of Erlang are you running?


Regards,

Matthias.



From cpettitt at gmail.com  Wed Apr  1 18:07:58 2009
From: cpettitt at gmail.com (Chris Pettitt)
Date: Wed, 1 Apr 2009 10:07:58 -0700
Subject: [rabbitmq-discuss] Flow Control in RabbitMQ 1.5.3
In-Reply-To: <49D2A5A2.3080408@lshift.net>
References: <de47e4420903231145k6c16bffdoabd428d2270c06cb@mail.gmail.com>
	<49C7ED93.6020600@lshift.net>
	<de47e4420903231431n2f8b19acyf0ab2a3d968b74cb@mail.gmail.com>
	<de47e4420903311536r1e1227f3n7b38b31daa2596ce@mail.gmail.com>
	<49D2A5A2.3080408@lshift.net>
Message-ID: <de47e4420904011007m151009a0pb500fa549bd17c13@mail.gmail.com>

Matthias,

I tried MulticastMain with almost the same settings (except we're
using 2K messages) and a high water mark of 70%. With this
configuration, RabbitMQ stayed up for for much longer and I didn't see
the erlang node crash.

The difference in my producer is that it uses persistence. I see the
same crash (at 70% high water mark), using these settings with
MulticastMain: -a -x 10 -s 2048 -f persistent

Is persistent messaging compatible/supported with producer flow control?

Thanks for your help! If any specific observations, instrumentation,
logging, etc would be helpful, please let me know.

Thanks,
Chris

On Tue, Mar 31, 2009 at 4:22 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Chris,
>
> I have tried to reproduce the above by running the
> com.rabbitmq.examples.MulticastMain test with the args "-a -x 10 -s 1024",
> and while I can make RabbitMQ crash with the default 95% limit, once I
> lowered the limit to 70% it kept going.
>
> That's on an old-ish machine with only 4GB of memory though. It's
> conceivable that a faster machine with more memory requires more of a
> margin. 40%, which is the lowest limit you tried, is quite low, but it may
> be worth trying even lower limits.
>
> Can you send us the code for your tests? I'd like to gain a better
> understanding of exactly what parts of RabbitMQ get stressed, and how your
> test differs from what MulticastMain with the above params does.
>
>
> Also, what version of Erlang are you running?
>
>
> Regards,
>
> Matthias.
>



From cpettitt at gmail.com  Wed Apr  1 18:24:11 2009
From: cpettitt at gmail.com (Chris Pettitt)
Date: Wed, 1 Apr 2009 10:24:11 -0700
Subject: [rabbitmq-discuss] Flow Control in RabbitMQ 1.5.3
In-Reply-To: <de47e4420904011007m151009a0pb500fa549bd17c13@mail.gmail.com>
References: <de47e4420903231145k6c16bffdoabd428d2270c06cb@mail.gmail.com>
	<49C7ED93.6020600@lshift.net>
	<de47e4420903231431n2f8b19acyf0ab2a3d968b74cb@mail.gmail.com>
	<de47e4420903311536r1e1227f3n7b38b31daa2596ce@mail.gmail.com>
	<49D2A5A2.3080408@lshift.net>
	<de47e4420904011007m151009a0pb500fa549bd17c13@mail.gmail.com>
Message-ID: <de47e4420904011024l19902734q600cace2ef0897b6@mail.gmail.com>

Some additional data that may be helpful:

At a 40% high water mark with "-a -x 10 -s 2048 -f persistent" the
broker hangs after a few toggles of the flow control. Memory usage
sits at about %59 and the queue is empty.

Normally I reconnect the clients to the same queue and the broker
crashes. With MulticastMain I can't do that (it creates an exclusive
queue), so I just run it again with the same options. At this point
nothing happens, probably because flow control is still set and memory
is never coming below the 40% high water mark. However, it does not
crash.

- Chris

On Wed, Apr 1, 2009 at 10:07 AM, Chris Pettitt <cpettitt at gmail.com> wrote:
> Matthias,
>
> I tried MulticastMain with almost the same settings (except we're
> using 2K messages) and a high water mark of 70%. With this
> configuration, RabbitMQ stayed up for for much longer and I didn't see
> the erlang node crash.
>
> The difference in my producer is that it uses persistence. I see the
> same crash (at 70% high water mark), using these settings with
> MulticastMain: -a -x 10 -s 2048 -f persistent
>
> Is persistent messaging compatible/supported with producer flow control?
>
> Thanks for your help! If any specific observations, instrumentation,
> logging, etc would be helpful, please let me know.
>
> Thanks,
> Chris
>
> On Tue, Mar 31, 2009 at 4:22 PM, Matthias Radestock <matthias at lshift.net> wrote:
>> Chris,
>>
>> I have tried to reproduce the above by running the
>> com.rabbitmq.examples.MulticastMain test with the args "-a -x 10 -s 1024",
>> and while I can make RabbitMQ crash with the default 95% limit, once I
>> lowered the limit to 70% it kept going.
>>
>> That's on an old-ish machine with only 4GB of memory though. It's
>> conceivable that a faster machine with more memory requires more of a
>> margin. 40%, which is the lowest limit you tried, is quite low, but it may
>> be worth trying even lower limits.
>>
>> Can you send us the code for your tests? I'd like to gain a better
>> understanding of exactly what parts of RabbitMQ get stressed, and how your
>> test differs from what MulticastMain with the above params does.
>>
>>
>> Also, what version of Erlang are you running?
>>
>>
>> Regards,
>>
>> Matthias.
>>
>



From matthias at lshift.net  Wed Apr  1 18:53:35 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 01 Apr 2009 18:53:35 +0100
Subject: [rabbitmq-discuss] Flow Control in RabbitMQ 1.5.3
In-Reply-To: <de47e4420904011007m151009a0pb500fa549bd17c13@mail.gmail.com>
References: <de47e4420903231145k6c16bffdoabd428d2270c06cb@mail.gmail.com>	<49C7ED93.6020600@lshift.net>	<de47e4420903231431n2f8b19acyf0ab2a3d968b74cb@mail.gmail.com>	<de47e4420903311536r1e1227f3n7b38b31daa2596ce@mail.gmail.com>	<49D2A5A2.3080408@lshift.net>
	<de47e4420904011007m151009a0pb500fa549bd17c13@mail.gmail.com>
Message-ID: <49D3AA1F.5080100@lshift.net>

Chris,

Chris Pettitt wrote:
> The difference in my producer is that it uses persistence.

Ah, I thought that might be the case. There is a known performance 
limitation in the persister: In some scenarios RabbitMQ will end up 
spending most of its time writing new snapshots. That's because the time 
it takes to write a snapshot is proportional to the amount of persisted 
data, and snapshots are written every 500 entries (i.e. publishes, 
deliveries, acks) by default. Writing new snapshots is also very memory 
intensive.

Work is underway to fix this, but it's going to take some time.

> Is persistent messaging compatible/supported with producer flow control?

Yes, but because of the stress caused by the persister, the limits have 
to be set very low.


Matthias.



From matthias at lshift.net  Wed Apr  1 19:03:10 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 01 Apr 2009 19:03:10 +0100
Subject: [rabbitmq-discuss] Flow Control in RabbitMQ 1.5.3
In-Reply-To: <de47e4420904011024l19902734q600cace2ef0897b6@mail.gmail.com>
References: <de47e4420903231145k6c16bffdoabd428d2270c06cb@mail.gmail.com>	<49C7ED93.6020600@lshift.net>	<de47e4420903231431n2f8b19acyf0ab2a3d968b74cb@mail.gmail.com>	<de47e4420903311536r1e1227f3n7b38b31daa2596ce@mail.gmail.com>	<49D2A5A2.3080408@lshift.net>	<de47e4420904011007m151009a0pb500fa549bd17c13@mail.gmail.com>
	<de47e4420904011024l19902734q600cace2ef0897b6@mail.gmail.com>
Message-ID: <49D3AC5E.4010406@lshift.net>

Chris,

Chris Pettitt wrote:
> At a 40% high water mark with "-a -x 10 -s 2048 -f persistent" the
> broker hangs after a few toggles of the flow control. Memory usage
> sits at about %59 and the queue is empty.

That may well be due to another known problem with the persister: it can 
hang on to memory for too long. We fixed that a few weeks ago and the 
fix will be part of the next major release. Try out a recent snapshot in 
the meantime - build instructions are at 
http://www.rabbitmq.com/build-server.html


Regards,

Matthias.



From ndl at ravenbrook.com  Thu Apr  2 11:17:11 2009
From: ndl at ravenbrook.com (Nick Levine)
Date: Thu, 2 Apr 2009 11:17:11 +0100 (BST)
Subject: [rabbitmq-discuss] CL-RABBIT - LispWorks to RabbitMQ via JFLI
Message-ID: <200904021017.n32AHBoi079037@raven.ravenbrook.com>

I am very pleased to announce the release of version 0.1 of CL-RABBIT:
an interface from LispWorks to RabbitMQ, an implementation of the AMQP
messaging protocol.

  http://www.rabbitmq.com/
  http://www.amqp.org/

It's released under an MIT-style license, a copy of which appears in
each source file. Many thanks to Wiinz Limited for giving me
permission to do all this and I'm sorry it's taken so long to get
around to kicking the brute through the door.

 http://www.nicklevine.org/cl-rabbit/

Here's how it goes:

 - Open a connection and a channel (I'll be lazy and use the same
   channel for outgoing and incoming messages), declare exchange and
   queue, bind everything together:

    RABBITMQ 6 > (setf my-connection (new-connection "localhost" "/"))
    #<AMQCONNECTION. amqp://guest at localhost:5672/ 200DCD87>

    RABBITMQ 7 > (setf my-channel (new-channel my-connection))
    #<CHANNEL AMQChannel(amqp://guest at localhost:5672/,1) 200F7BB3>

    RABBITMQ 8 > (declare-exchange my-channel "my exchange" :direct)
    #<|com.rabbitmq.client.impl|::AMQIMPL$EXCHANGE$DECLAREOK. 2009159F>

    RABBITMQ 9 > (declare-queue my-channel "my queue")
    #<|com.rabbitmq.client.impl|::AMQIMPL$QUEUE$DECLAREOK. 21D050CF>

    RABBITMQ 10 > (bind-queue my-channel "my queue" "my exchange" "my routing key")
    #<|com.rabbitmq.client.impl|::AMQIMPL$QUEUE$BINDOK. 21CEEFD3>

 - Send a message into the void:

    RABBITMQ 11 > (setf outgoing-message (new-message))
    #<OUTGOING-MESSAGE 21CE265B>

    RABBITMQ 12 > (setf (message-id outgoing-message) "42"
			(message-body outgoing-message) "Hello, World")
    "Hello, World"

    RABBITMQ 13 > (publish outgoing-message my-channel "my exchange" "my routing key")
    NIL

 - And get it back again:

    RABBITMQ 14 > (consume-queue my-channel "my queue")
    "amq.ctag1_rabbit at gannet_20090402084407_"

    RABBITMQ 15 > (channel-arrived-count my-channel)
    1

    RABBITMQ 16 > (setf incoming-message (next-message my-channel))
    #<QUEUEINGCONSUMER$DELIVERY. 200E0E93>

    RABBITMQ 17 > (values (message-body incoming-message)
			  (message-id incoming-message))
    "Hello, World"
    "42"

    RABBITMQ 18 > 




From alexis.richardson at gmail.com  Thu Apr  2 17:57:21 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 2 Apr 2009 09:57:21 -0700
Subject: [rabbitmq-discuss] CL-RABBIT - LispWorks to RabbitMQ via JFLI
In-Reply-To: <200904021017.n32AHBoi079037@raven.ravenbrook.com>
References: <200904021017.n32AHBoi079037@raven.ravenbrook.com>
Message-ID: <167204d20904020957v480f8023k706f90246de8b7a1@mail.gmail.com>

Nick

Very cool.  And: many thanks to Wiinz for this!

alexis



On Thu, Apr 2, 2009 at 3:17 AM, Nick Levine <ndl at ravenbrook.com> wrote:
> I am very pleased to announce the release of version 0.1 of CL-RABBIT:
> an interface from LispWorks to RabbitMQ, an implementation of the AMQP
> messaging protocol.
>
> ?http://www.rabbitmq.com/
> ?http://www.amqp.org/
>
> It's released under an MIT-style license, a copy of which appears in
> each source file. Many thanks to Wiinz Limited for giving me
> permission to do all this and I'm sorry it's taken so long to get
> around to kicking the brute through the door.
>
> ?http://www.nicklevine.org/cl-rabbit/
>
> Here's how it goes:
>
> ?- Open a connection and a channel (I'll be lazy and use the same
> ? channel for outgoing and incoming messages), declare exchange and
> ? queue, bind everything together:
>
> ? ?RABBITMQ 6 > (setf my-connection (new-connection "localhost" "/"))
> ? ?#<AMQCONNECTION. amqp://guest at localhost:5672/ 200DCD87>
>
> ? ?RABBITMQ 7 > (setf my-channel (new-channel my-connection))
> ? ?#<CHANNEL AMQChannel(amqp://guest at localhost:5672/,1) 200F7BB3>
>
> ? ?RABBITMQ 8 > (declare-exchange my-channel "my exchange" :direct)
> ? ?#<|com.rabbitmq.client.impl|::AMQIMPL$EXCHANGE$DECLAREOK. 2009159F>
>
> ? ?RABBITMQ 9 > (declare-queue my-channel "my queue")
> ? ?#<|com.rabbitmq.client.impl|::AMQIMPL$QUEUE$DECLAREOK. 21D050CF>
>
> ? ?RABBITMQ 10 > (bind-queue my-channel "my queue" "my exchange" "my routing key")
> ? ?#<|com.rabbitmq.client.impl|::AMQIMPL$QUEUE$BINDOK. 21CEEFD3>
>
> ?- Send a message into the void:
>
> ? ?RABBITMQ 11 > (setf outgoing-message (new-message))
> ? ?#<OUTGOING-MESSAGE 21CE265B>
>
> ? ?RABBITMQ 12 > (setf (message-id outgoing-message) "42"
> ? ? ? ? ? ? ? ? ? ? ? ?(message-body outgoing-message) "Hello, World")
> ? ?"Hello, World"
>
> ? ?RABBITMQ 13 > (publish outgoing-message my-channel "my exchange" "my routing key")
> ? ?NIL
>
> ?- And get it back again:
>
> ? ?RABBITMQ 14 > (consume-queue my-channel "my queue")
> ? ?"amq.ctag1_rabbit at gannet_20090402084407_"
>
> ? ?RABBITMQ 15 > (channel-arrived-count my-channel)
> ? ?1
>
> ? ?RABBITMQ 16 > (setf incoming-message (next-message my-channel))
> ? ?#<QUEUEINGCONSUMER$DELIVERY. 200E0E93>
>
> ? ?RABBITMQ 17 > (values (message-body incoming-message)
> ? ? ? ? ? ? ? ? ? ? ? ? ?(message-id incoming-message))
> ? ?"Hello, World"
> ? ?"42"
>
> ? ?RABBITMQ 18 >
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From riteshrathi at gmail.com  Thu Apr  2 20:01:27 2009
From: riteshrathi at gmail.com (rathi)
Date: Fri, 3 Apr 2009 00:31:27 +0530
Subject: [rabbitmq-discuss] Broker data
In-Reply-To: <49C7EAEF.4020801@lshift.net>
References: <d31e757a0903180452o3b6af195l26e946c92a3ff85b@mail.gmail.com>
	<9e009ad0903190157m1a0cf884nb6e60f63bf8eb8cb@mail.gmail.com>
	<d31e757a0903210824j3be5430frd68d178d3443fe72@mail.gmail.com>
	<de47e4420903231231k45febcday82e51f01d9a0442e@mail.gmail.com>
	<49C7EAEF.4020801@lshift.net>
Message-ID: <d31e757a0904021201u2f11ffe6ta49d77d858a6a00@mail.gmail.com>

I have found out the various commands which I need to invoke to get the data
exposed via rabbitmqctl. Have been able to get the values via the JInterface
for some of them. But for queue, exchange related information I am not able
to get things via JInterface. The erlang command which I invoke to get the
list of exchanges :
rpc:call(rabbit at server,rabbit_exchange,info_all,[<<"/">>],3000)]

The above command represented in JInterface code :


        OtpSelf self = new OtpSelf("client", "rathitest");
        OtpPeer other  = new OtpPeer("rabbit at server");
        OtpConnection connection = self.connect(other);
        OtpErlangObject [] obj = {new OtpErlangAtom("<<\"/\">>")}
        OtpErlangList  arg = new OtpErlangList(obj);
        connection.sendRPC("rabbit_exchange","info_all",arg);

When I invoke the above given code it gives :

test :
receiveRPC{badrpc,{'EXIT',{function_clause,[{rabbit_misc,r,['<<\"/\">>',exchange]},{rabbit_exchange,list,1},{rabbit_exchange,map,2},{rpc,'-handle_call/3-fun-0-',5}]}}}

Can anybody please suggest what is going wrong here.

thanks & regards,
rathi



On Tue, Mar 24, 2009 at 1:32 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Chris,
>
> Chris Pettitt wrote:
>
>> A few weeks back I was looking at using JInterface to create a JMX
>> interface for RabbitMQ. I still haven't had cycles to work on it, but
>> one of the immediate issues I saw was that I could not use
>> rabbitmq_control.erl (the actual module for rabbitmqctl) directly,
>> because it does not return the results, but instead prints them to
>> stdout. You can make the same RPC calls that rabbitmqctl does though
>> to get the results.
>>
>
> rabbit_control.erl is just a thin wrapper around the internal APIs. It
> deals with option parsing and result presentation. So calling the internal
> APIs directly, as you suggest, is indeed the way to go if you want to expose
> the rabbit_control functionality programmatically.
>
>
> Matthias
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090403/90dffc5e/attachment.htm 

From matthias at lshift.net  Thu Apr  2 20:11:17 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 02 Apr 2009 20:11:17 +0100
Subject: [rabbitmq-discuss] Broker data
In-Reply-To: <d31e757a0904021201u2f11ffe6ta49d77d858a6a00@mail.gmail.com>
References: <d31e757a0903180452o3b6af195l26e946c92a3ff85b@mail.gmail.com>	<9e009ad0903190157m1a0cf884nb6e60f63bf8eb8cb@mail.gmail.com>	<d31e757a0903210824j3be5430frd68d178d3443fe72@mail.gmail.com>	<de47e4420903231231k45febcday82e51f01d9a0442e@mail.gmail.com>	<49C7EAEF.4020801@lshift.net>
	<d31e757a0904021201u2f11ffe6ta49d77d858a6a00@mail.gmail.com>
Message-ID: <49D50DD5.3060606@lshift.net>

Rathi,

rathi wrote:
> The erlang command which I invoke to get the list of exchanges :
> rpc:call(rabbit at server,rabbit_exchange,info_all,[<<"/">>],3000)]

The <<"/">> is Erlang's notation for a piece of binary data consisting 
of the a single byte with the value of 47.

>         OtpErlangObject [] obj = {new OtpErlangAtom("<<\"/\">>")}

The value on the rhs should be an OtpErlangBinary.


Matthias.



From dave at futuremint.com  Thu Apr  2 20:23:46 2009
From: dave at futuremint.com (Dave Woodward)
Date: Thu, 2 Apr 2009 15:23:46 -0400
Subject: [rabbitmq-discuss] rabbitmqctl problems on Mac OS X (10.5)
Message-ID: <9df5fc560904021223u473ca099i78b9a5decf49aee2@mail.gmail.com>

I ran into an issue where I the rabbitmq-server would run just fine (as
evidenced by ps output, and also using net_adm in erl to see it).  Also all
of my permissions we correct in terms of what user the server was running as
well as the user for rabbitmqctl.

However, I could not get rabbitmqctl to be able to talk to the server at all
(no matter what I put in the -n flag on the command line, or what I set the
RABBITMQ_NODE_IP_ADDRESS to).

To fix it, I simply added an entry in /etc/hosts for the output of 'hostname
-s' to 127.0.0.1.

I guess erlang uses the output of 'hostname -s' to determine what host it is
running on.  In my case, hostname -s output my Computer Name (from the
Sharing pane in System Preferences), which ended up resolving to the
external IP address of my router.  OS X wants to you put ".local" after your
computer name to signify localhost.  This is in OS X version 10.5 (Leopard).

Hope this helps others troubleshoot!  Thanks also for those who helped out
in #rabbitmq.

Dave Woodward
...................................................
www.futuremint.com
317.332.6438 | dave at futuremint.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090402/97524054/attachment.htm 

From dane.jensen at gmail.com  Thu Apr  2 23:14:58 2009
From: dane.jensen at gmail.com (Dane Jensen)
Date: Thu, 2 Apr 2009 15:14:58 -0700
Subject: [rabbitmq-discuss] Rabbits, Jackalopes. and R13
Message-ID: <E9D88D51-0F48-42E3-9129-A821BF7E5A69@gmail.com>

With RabbitMQ making its way into Jaunty Jackalope and Erlang R13 just  
around the corner, does anyone know if R13 will find its way into  
Jaunty as well?

If so, any idea as to how stable RabbitMQ is with it?

In a perfect world, R13 would make it into Jaunty and Rabbit would  
play nice with it.

-Dane



From jonathan.stott at gmail.com  Thu Apr  2 23:22:57 2009
From: jonathan.stott at gmail.com (Jonathan Stott)
Date: Thu, 2 Apr 2009 23:22:57 +0100
Subject: [rabbitmq-discuss] Problem running rabbitmq as a non-privileged user
Message-ID: <14cf210a0904021522n5bd83d5r4ee720234c3fafbc@mail.gmail.com>

Hi

I've installed rabbitmq (v 1.5.3) with erlang R12B.5.  Using
'rabbitmq-multi start_all 1' works fine as root, creating a rabbitmq
service that I can create queues on and all seems to work fine.

When I attempt to run that as the rabbitmq user I created (via "su -c
'rabbitmq-multi start_all 1'") then the command fails with the
following errors:

https://gist.github.com/fcba8ea3cca457c8c291

As far as I can tell, the permissions on all the relevant files are
fine (That is to say, owned by root, but world readable).  Does anyone
have any idea what might be going on?

Regards,
Jon



From elliot at canonical.com  Fri Apr  3 00:01:29 2009
From: elliot at canonical.com (Elliot Murphy)
Date: Thu, 2 Apr 2009 19:01:29 -0400
Subject: [rabbitmq-discuss] Rabbits, Jackalopes. and R13
In-Reply-To: <E9D88D51-0F48-42E3-9129-A821BF7E5A69@gmail.com>
References: <E9D88D51-0F48-42E3-9129-A821BF7E5A69@gmail.com>
Message-ID: <1438046D-84C0-44EE-B170-FD1295D4931E@canonical.com>

Jaunty (ubuntu 9.04) is already past Feature freeze, headed for  
release in 2 weeks, so I don't see how R13 could possibly go in.  
Should be easy to go into the 9.10 release though.

If you really need R13 on Jaunty, pehaps building a backport in a PPA  
would be the easiest thing.

I haven't had time to try Rabbit with any version of Erlang other than  
what is in Ubuntu.
-- 
Elliot Murphy

On Apr 2, 2009, at 6:14 PM, Dane Jensen <dane.jensen at gmail.com> wrote:

> With RabbitMQ making its way into Jaunty Jackalope and Erlang R13 just
> around the corner, does anyone know if R13 will find its way into
> Jaunty as well?
>
> If so, any idea as to how stable RabbitMQ is with it?
>
> In a perfect world, R13 would make it into Jaunty and Rabbit would
> play nice with it.
>
> -Dane
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Fri Apr  3 01:05:12 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 2 Apr 2009 17:05:12 -0700
Subject: [rabbitmq-discuss] Rabbits, Jackalopes. and R13
In-Reply-To: <1438046D-84C0-44EE-B170-FD1295D4931E@canonical.com>
References: <E9D88D51-0F48-42E3-9129-A821BF7E5A69@gmail.com>
	<1438046D-84C0-44EE-B170-FD1295D4931E@canonical.com>
Message-ID: <167204d20904021705t354eaed8o1f2c741aafb3c883@mail.gmail.com>

Elliot,

Very many thanks.

Please could you help Dane and others (some of whom may not have seen
PPA) by telling the list a bit more about the purpose and nature of
the PPA process?

Cheers

alexis


On Thu, Apr 2, 2009 at 4:01 PM, Elliot Murphy <elliot at canonical.com> wrote:
> Jaunty (ubuntu 9.04) is already past Feature freeze, headed for
> release in 2 weeks, so I don't see how R13 could possibly go in.
> Should be easy to go into the 9.10 release though.
>
> If you really need R13 on Jaunty, pehaps building a backport in a PPA
> would be the easiest thing.
>
> I haven't had time to try Rabbit with any version of Erlang other than
> what is in Ubuntu.
> --
> Elliot Murphy
>
> On Apr 2, 2009, at 6:14 PM, Dane Jensen <dane.jensen at gmail.com> wrote:
>
>> With RabbitMQ making its way into Jaunty Jackalope and Erlang R13 just
>> around the corner, does anyone know if R13 will find its way into
>> Jaunty as well?
>>
>> If so, any idea as to how stable RabbitMQ is with it?
>>
>> In a perfect world, R13 would make it into Jaunty and Rabbit would
>> play nice with it.
>>
>> -Dane
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From elliot at canonical.com  Fri Apr  3 02:41:17 2009
From: elliot at canonical.com (Elliot Murphy)
Date: Thu, 02 Apr 2009 21:41:17 -0400
Subject: [rabbitmq-discuss] Rabbits, Jackalopes. and R13
In-Reply-To: <167204d20904021705t354eaed8o1f2c741aafb3c883@mail.gmail.com>
References: <E9D88D51-0F48-42E3-9129-A821BF7E5A69@gmail.com>	
	<1438046D-84C0-44EE-B170-FD1295D4931E@canonical.com>
	<167204d20904021705t354eaed8o1f2c741aafb3c883@mail.gmail.com>
Message-ID: <49D5693D.7020002@canonical.com>

On 04/02/2009 08:05 PM, Alexis Richardson wrote:
> Please could you help Dane and others (some of whom may not have seen
> PPA) by telling the list a bit more about the purpose and nature of
> the PPA process?
You bet!

A PPA stands for Personal Package Archive, it is your very own personal
Ubuntu repository, where you can upload packages of all different kinds.
Wonderful for learning, experimenting, doing backports, a place to
publish nightly builds, to let a QA team work with before publishing to
an official repository, etc. More details on how to use them here:

https://help.launchpad.net/Packaging/PPA

Once you upload, packages are built on all the official Ubuntu
architectures, any person or team in launchpad.net can have a free PPA.

For example, I run a cron script that creates nightly builds of the bzr
package, which lets me test a daily snapshot of bzr on all my dev machines:
https://edge.launchpad.net/~bzr-nightly-ppa/+archive/ppa

Hope that helps!
-- 
Elliot Murphy | https://launchpad.net/~statik/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 197 bytes
Desc: OpenPGP digital signature
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090402/881bf35a/attachment.pgp 

From chime at mu.dk  Fri Apr  3 07:43:22 2009
From: chime at mu.dk (Michael Arnoldus)
Date: Fri, 3 Apr 2009 08:43:22 +0200
Subject: [rabbitmq-discuss] CL-RABBIT - LispWorks to RabbitMQ via JFLI
In-Reply-To: <200904021017.n32AHBoi079037@raven.ravenbrook.com>
References: <200904021017.n32AHBoi079037@raven.ravenbrook.com>
Message-ID: <210018CA-6B03-4A60-B4FF-38D3BBA9C740@mu.dk>

Hi Nick,

Good to see this out. Thank you for doing the work  :-)

Michael

On Apr 2, 2009, at 12:17 , Nick Levine wrote:

> I am very pleased to announce the release of version 0.1 of CL-RABBIT:
> an interface from LispWorks to RabbitMQ, an implementation of the AMQP
> messaging protocol.
>
> http://www.rabbitmq.com/
> http://www.amqp.org/
>
> It's released under an MIT-style license, a copy of which appears in
> each source file. Many thanks to Wiinz Limited for giving me
> permission to do all this and I'm sorry it's taken so long to get
> around to kicking the brute through the door.
>
> http://www.nicklevine.org/cl-rabbit/
>
> Here's how it goes:
>
> - Open a connection and a channel (I'll be lazy and use the same
> channel for outgoing and incoming messages), declare exchange and
> queue, bind everything together:
>
>  RABBITMQ 6 > (setf my-connection (new-connection "localhost" "/"))
>  #<AMQCONNECTION. amqp://guest at localhost:5672/ 200DCD87>
>
>  RABBITMQ 7 > (setf my-channel (new-channel my-connection))
>  #<CHANNEL AMQChannel(amqp://guest at localhost:5672/,1) 200F7BB3>
>
>  RABBITMQ 8 > (declare-exchange my-channel "my exchange" :direct)
>  #<|com.rabbitmq.client.impl|::AMQIMPL$EXCHANGE$DECLAREOK. 2009159F>
>
>  RABBITMQ 9 > (declare-queue my-channel "my queue")
>  #<|com.rabbitmq.client.impl|::AMQIMPL$QUEUE$DECLAREOK. 21D050CF>
>
>  RABBITMQ 10 > (bind-queue my-channel "my queue" "my exchange" "my  
> routing key")
>  #<|com.rabbitmq.client.impl|::AMQIMPL$QUEUE$BINDOK. 21CEEFD3>
>
> - Send a message into the void:
>
>  RABBITMQ 11 > (setf outgoing-message (new-message))
>  #<OUTGOING-MESSAGE 21CE265B>
>
>  RABBITMQ 12 > (setf (message-id outgoing-message) "42"
> 			(message-body outgoing-message) "Hello, World")
>  "Hello, World"
>
>  RABBITMQ 13 > (publish outgoing-message my-channel "my exchange"  
> "my routing key")
>  NIL
>
> - And get it back again:
>
>  RABBITMQ 14 > (consume-queue my-channel "my queue")
>  "amq.ctag1_rabbit at gannet_20090402084407_"
>
>  RABBITMQ 15 > (channel-arrived-count my-channel)
>  1
>
>  RABBITMQ 16 > (setf incoming-message (next-message my-channel))
>  #<QUEUEINGCONSUMER$DELIVERY. 200E0E93>
>
>  RABBITMQ 17 > (values (message-body incoming-message)
> 			  (message-id incoming-message))
>  "Hello, World"
>  "42"
>
>  RABBITMQ 18 >
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From matthias at lshift.net  Fri Apr  3 10:13:11 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 03 Apr 2009 10:13:11 +0100
Subject: [rabbitmq-discuss] Problem running rabbitmq as a non-privileged
 user
In-Reply-To: <14cf210a0904021522n5bd83d5r4ee720234c3fafbc@mail.gmail.com>
References: <14cf210a0904021522n5bd83d5r4ee720234c3fafbc@mail.gmail.com>
Message-ID: <49D5D327.3040804@lshift.net>

Jonathan,

Jonathan Stott wrote:
> I've installed rabbitmq (v 1.5.3) with erlang R12B.5.  Using
> 'rabbitmq-multi start_all 1' works fine as root, creating a rabbitmq
> service that I can create queues on and all seems to work fine.
> 
> When I attempt to run that as the rabbitmq user I created (via "su -c
> 'rabbitmq-multi start_all 1'") then the command fails with the
> following errors:
> 
> https://gist.github.com/fcba8ea3cca457c8c291
> 
> As far as I can tell, the permissions on all the relevant files are
> fine (That is to say, owned by root, but world readable).  Does anyone
> have any idea what might be going on?

It looks like Erlang is mostly complaining that it can't read from the 
current dir (notice how the file names all start with "./").

You may want to look at the Debian and RPM packages for clues as to how 
to get rabbit to run as a different user, since they do precisely that.


Regards,

Matthias.



From matthias at lshift.net  Fri Apr  3 10:49:14 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 03 Apr 2009 10:49:14 +0100
Subject: [rabbitmq-discuss] Problem running rabbitmq as a non-privileged
 user
In-Reply-To: <20090403104218.0b997812@amelia>
References: <14cf210a0904021522n5bd83d5r4ee720234c3fafbc@mail.gmail.com>	<49D5D327.3040804@lshift.net>
	<20090403104218.0b997812@amelia>
Message-ID: <49D5DB9A.2070700@lshift.net>

Jonathan,

Jonathan Stott wrote:
> On Fri, 03 Apr 2009 10:13:11 +0100
> Matthias Radestock <matthias at lshift.net> wrote:
>> You may want to look at the Debian and RPM packages for clues as to how 
>> to get rabbit to run as a different user, since they do precisely that.
>>
> 
> It appears that they don't, actually.

They certainly do.

> (Unless I'm misreading the file in init.d when I download and extract
> the .deb) They do set the USER environmental variable to 'rabbitmq',
> but then they do nothing with it, as far as I can make out.

The switching to the rabbitmq users happens in the wrapper scripts which 
are installed in /usr/sbin. They then in turn call the normal scripts in 
/usr/lib/rabbitmq/bin.


Matthias.



From riteshrathi at gmail.com  Fri Apr  3 13:40:29 2009
From: riteshrathi at gmail.com (rathi)
Date: Fri, 3 Apr 2009 18:10:29 +0530
Subject: [rabbitmq-discuss] Broker data
In-Reply-To: <49D50DD5.3060606@lshift.net>
References: <d31e757a0903180452o3b6af195l26e946c92a3ff85b@mail.gmail.com>
	<9e009ad0903190157m1a0cf884nb6e60f63bf8eb8cb@mail.gmail.com>
	<d31e757a0903210824j3be5430frd68d178d3443fe72@mail.gmail.com>
	<de47e4420903231231k45febcday82e51f01d9a0442e@mail.gmail.com>
	<49C7EAEF.4020801@lshift.net>
	<d31e757a0904021201u2f11ffe6ta49d77d858a6a00@mail.gmail.com>
	<49D50DD5.3060606@lshift.net>
Message-ID: <d31e757a0904030540m636c26em123cbca46004230d@mail.gmail.com>

Thanks for this information. It is working now :-).

rathi

On Fri, Apr 3, 2009 at 12:41 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Rathi,
>
> rathi wrote:
>
>> The erlang command which I invoke to get the list of exchanges :
>> rpc:call(rabbit at server,rabbit_exchange,info_all,[<<"/">>],3000)]
>>
>
> The <<"/">> is Erlang's notation for a piece of binary data consisting of
> the a single byte with the value of 47.
>
>         OtpErlangObject [] obj = {new OtpErlangAtom("<<\"/\">>")}
>>
>
> The value on the rhs should be an OtpErlangBinary.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090403/fc6a65ef/attachment.htm 

From matthias at lshift.net  Fri Apr  3 14:10:03 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 03 Apr 2009 14:10:03 +0100
Subject: [rabbitmq-discuss] Problem running rabbitmq as a non-privileged
 user
In-Reply-To: <20090403135114.774bf742@amelia>
References: <14cf210a0904021522n5bd83d5r4ee720234c3fafbc@mail.gmail.com>	<49D5D327.3040804@lshift.net>
	<20090403104218.0b997812@amelia>	<49D5DB9A.2070700@lshift.net>
	<20090403135114.774bf742@amelia>
Message-ID: <49D60AAB.2000403@lshift.net>

Jonathan,

Jonathan Stott wrote:
> On Fri, 03 Apr 2009 10:49:14 +0100
> Matthias Radestock <matthias at lshift.net> wrote:
>> The switching to the rabbitmq users happens in the wrapper scripts which 
>> are installed in /usr/sbin. They then in turn call the normal scripts in 
>> /usr/lib/rabbitmq/bin.
> 
> Some experimentation does reveal that if I cd to /var/lib/rabbitmq
> before I execute the script via 'su' then it does work. This seems like
> a step which shouldn't be necessary.

I am pretty sure this is down to Erlang/OTP, so there is little we can 
do about it.


Matthias.



From alexis.richardson at gmail.com  Sun Apr  5 03:49:16 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 4 Apr 2009 19:49:16 -0700
Subject: [rabbitmq-discuss] Talk Reminder for SF based folks - BayFP on
	Wednesday
Message-ID: <167204d20904041949q6923cf13t665b31fe2c7af25c@mail.gmail.com>

Folks,

If you are in SF please come to this and join us for a beer afterwards!

http://www.bayfp.org/blog/2009/03/25/next-meeting-rabbitmq-wednesday-april-8th-730pm/

And do please spread the word...

alexis



From matthias at lshift.net  Mon Apr  6 12:56:38 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 06 Apr 2009 12:56:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.5.4 release
Message-ID: <49D9EDF6.2050309@lshift.net>

The RabbitMQ team is pleased to announce the release of RabbitMQ 1.5.4.

This release has 'final' status and fixes a small number of bugs in the 
server, the startup and control scripts on Windows, and the Debian/RPM 
packaging. Also included are some minor enhancements to the way the 
server can be configured. The RabbitMQ clients have remained unchanged.

For details see the attached release notes.

Binary and source distributions of the new release can be found in the 
usual place, at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to 
this latest release.

As always, we welcome any questions, bug reports, and other feedback on 
this release, as well as general suggestions for features and 
enhancements in future releases. Mail us via the RabbitMQ discussion 
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at 
info at rabbitmq.com.


Regards,

The RabbitMQ Team

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-1.5.4.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090406/fffcc5a0/attachment.txt 

From Alister.Morton at tradition.com  Mon Apr  6 13:10:35 2009
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 6 Apr 2009 13:10:35 +0100
Subject: [rabbitmq-discuss] [rabbitmq-announce] RabbitMQ 1.5.4 release
In-Reply-To: <49D9EDF6.2050309@lshift.net>
References: <49D9EDF6.2050309@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891065C4CFDEE9A@SVR-2K3-BH-EMC.tradition.int>

> The RabbitMQ team is pleased to announce the release of RabbitMQ 1.5.4.

Can I make a small request regarding the .net client?

Could you give them a strong name, please?



Al.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From holger at wizards.de  Mon Apr  6 13:12:45 2009
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Mon, 06 Apr 2009 14:12:45 +0200
Subject: [rabbitmq-discuss] Messaging at SecondLife
Message-ID: <49D9F1BD.400@wizards.de>


SecondLife tried to evaluate several messaging solutions and a writeup of
the (quite sobering) results can be found here:
http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes

It mentions AMQP prominently so I guess it's of interest for many readers
here. :)

-h



From matthias at lshift.net  Mon Apr  6 13:47:36 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 06 Apr 2009 13:47:36 +0100
Subject: [rabbitmq-discuss] [rabbitmq-announce] RabbitMQ 1.5.4 release
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891065C4CFDEE9A@SVR-2K3-BH-EMC.tradition.int>
References: <49D9EDF6.2050309@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891065C4CFDEE9A@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <49D9F9E8.3020200@lshift.net>

Alister,

Alister Morton wrote:
>> The RabbitMQ team is pleased to announce the release of RabbitMQ 1.5.4.
> 
> Can I make a small request regarding the .net client?
> 
> Could you give them a strong name, please?

I have filed a bug for it. If you have a patch to resolve this please 
send it to me.


Regards,

Matthias.



From Alister.Morton at tradition.com  Mon Apr  6 13:50:31 2009
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 6 Apr 2009 13:50:31 +0100
Subject: [rabbitmq-discuss] [rabbitmq-announce] RabbitMQ 1.5.4 release
In-Reply-To: <49D9EDF6.2050309@lshift.net>
References: <49D9EDF6.2050309@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891065C4CFDEEB5@SVR-2K3-BH-EMC.tradition.int>

> The RabbitMQ team is pleased to announce the release of RabbitMQ 1.5.4.

> As always, we welcome any questions, bug reports, and other feedback on this release

I responded to this with a question about the .NET client. I asked for the client to be given a strong name.

My request got stamped on because it /also/ went to the announce list.

Isn't  there a way to separate these things so that requests for comment, ideas etc don't get put out on the /announce/ list.

Anyway, my request stands - can we have the .net client dlls signed properly, please?

Al.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From Alister.Morton at tradition.com  Mon Apr  6 13:59:27 2009
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 6 Apr 2009 13:59:27 +0100
Subject: [rabbitmq-discuss] [rabbitmq-announce] RabbitMQ 1.5.4 release
In-Reply-To: <49D9F9E8.3020200@lshift.net>
References: <49D9EDF6.2050309@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891065C4CFDEE9A@SVR-2K3-BH-EMC.tradition.int>
	<49D9F9E8.3020200@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891065C4CFDEEB8@SVR-2K3-BH-EMC.tradition.int>

> I have filed a bug for it. If you have a patch to resolve this please send it to me.

There's the rub. You need to create a key file yourselves and add the directive to the assemblyinfo.cs to make the assembly use it to validate and then build the binary - I could send you my patch but it would be invalid for you, although of course it validates /my/ build of he assembly.

Short answer

Create a key file...

Add directive

[assembly: AssemblyKeyFileAttribute(@"path to your key file")]

To asemblyinfo.cs(.in)


Al.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From sustrik at imatix.com  Mon Apr  6 14:44:04 2009
From: sustrik at imatix.com (Martin Sustrik)
Date: Mon, 06 Apr 2009 15:44:04 +0200
Subject: [rabbitmq-discuss] Messaging at SecondLife
In-Reply-To: <49D9F1BD.400@wizards.de>
References: <49D9F1BD.400@wizards.de>
Message-ID: <49DA0724.5020600@imatix.com>

Holger Hoffst?tte wrote:
> SecondLife tried to evaluate several messaging solutions and a writeup of
> the (quite sobering) results can be found here:
> http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes

Their scenario (load-balancing queues across several network locations) 
is pretty exotic. It's no surprise that none of the messaging systems 
supports it out of the box. AFAIK even MQ series or Tibco doesn't 
support this kind of thing. Interesting article though.

Martin

> 
> It mentions AMQP prominently so I guess it's of interest for many readers
> here. :)
> 
> -h
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From matthias at lshift.net  Mon Apr  6 15:03:36 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 06 Apr 2009 15:03:36 +0100
Subject: [rabbitmq-discuss] [rabbitmq-announce] RabbitMQ 1.5.4 release
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891065C4CFDEEB8@SVR-2K3-BH-EMC.tradition.int>
References: <49D9EDF6.2050309@lshift.net>	<5A46D132C446C04B9EFE8AD14E7891065C4CFDEE9A@SVR-2K3-BH-EMC.tradition.int>	<49D9F9E8.3020200@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891065C4CFDEEB8@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <49DA0BB8.8010800@lshift.net>

Alister,

Alister Morton wrote:
> You need to create a key file yourselves and add the directive to the
> assemblyinfo.cs to make the assembly use it to validate and then
> build the binary - I could send you my patch but it would be invalid
> for you, although of course it validates /my/ build of he assembly.

Understood. What we need is a patch to our build scripts that automates 
the process. The key file should to be supplied in a property to 
default.build such that when targets build the client assembly (the 
"windows-deliverables" target is the top-level target we use when 
building releases) it gets given an strong name.


Regards,

Matthias.



From Alister.Morton at tradition.com  Mon Apr  6 15:22:27 2009
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 6 Apr 2009 15:22:27 +0100
Subject: [rabbitmq-discuss] [rabbitmq-announce] RabbitMQ 1.5.4 release
In-Reply-To: <49DA0BB8.8010800@lshift.net>
References: <49D9EDF6.2050309@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891065C4CFDEE9A@SVR-2K3-BH-EMC.tradition.int>
	<49D9F9E8.3020200@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891065C4CFDEEB8@SVR-2K3-BH-EMC.tradition.int>
	<49DA0BB8.8010800@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891065C4CFDEEE7@SVR-2K3-BH-EMC.tradition.int>

> Understood. What we need is a patch to our build scripts that automates the process. The key file should to be supplied in a property to default.build > such that when targets build the client assembly (the "windows-deliverables" target is the top-level target we use when building releases) it gets
> given an strong name.


There you have me as I don't profess to understand how the build scripts work - I normally build in visual studio.

I can manually incorporate a key file but I wouldn't know how to alter the build scripts.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From alexis.richardson at gmail.com  Mon Apr  6 18:09:25 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 6 Apr 2009 10:09:25 -0700
Subject: [rabbitmq-discuss] Messaging at SecondLife
In-Reply-To: <49DA0724.5020600@imatix.com>
References: <49D9F1BD.400@wizards.de> <49DA0724.5020600@imatix.com>
Message-ID: <167204d20904061009s7cafe491n232985d77c880f03@mail.gmail.com>

2009/4/6 Martin Sustrik <sustrik at imatix.com>:
> Holger Hoffst?tte wrote:
>> SecondLife tried to evaluate several messaging solutions and a writeup of
>> the (quite sobering) results can be found here:
>> http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes
>
> Their scenario (load-balancing queues across several network locations)
> is pretty exotic. It's no surprise that none of the messaging systems
> supports it out of the box. AFAIK even MQ series or Tibco doesn't
> support this kind of thing. Interesting article though.

Indeed.

They actually have several use cases, not all of which are documented
here.  It's a very well structured analysis though.

If you extra nice to Brian Sullivan he may chat about some of their
use cases on this list.

a



> Martin
>
>>
>> It mentions AMQP prominently so I guess it's of interest for many readers
>> here. :)
>>
>> -h
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Mon Apr  6 18:25:31 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 6 Apr 2009 10:25:31 -0700
Subject: [rabbitmq-discuss] nice slide show by Ilya
Message-ID: <167204d20904061025n6d7c1b05p39443a6774c7c283@mail.gmail.com>

Ilya's slides from MeshU are up:

http://www.igvita.com/2009/04/06/henry-ford-event-driven-architecture/

These are a cool overview of Event Driven Architecture, a model for
using things like AMQP and XMPP.



From tsuraan at gmail.com  Mon Apr  6 19:15:25 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 6 Apr 2009 13:15:25 -0500
Subject: [rabbitmq-discuss] Java client transaction with basic.consume
Message-ID: <84fb38e30904061115o4682afb9rda35645b5ab2dee9@mail.gmail.com>

My desired workflow is:

basicConsume(...)
forever() {
consumer.nextDelivery()
channel.txSelect()
channel.basicAck(...)
for(msg in some messages that depend on the delivered message) {
  channel.basicPublish(msg)
}
channel.txCommit()
}

My understanding (probably wrong) is that attempting to do blocking
calls (like txSelect) on the channel being used by my consumer will
cause a deadlock.  The documentation for QueueingConsumer says that it
has straightforward blocking semantics, but I'm not sure what that
means.  Is there a way to have my desired workflow using basicConsume,
or do I need to do basicGet?



From matthias at lshift.net  Mon Apr  6 20:43:32 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 06 Apr 2009 20:43:32 +0100
Subject: [rabbitmq-discuss] Java client transaction with basic.consume
In-Reply-To: <84fb38e30904061115o4682afb9rda35645b5ab2dee9@mail.gmail.com>
References: <84fb38e30904061115o4682afb9rda35645b5ab2dee9@mail.gmail.com>
Message-ID: <49DA5B64.8090401@lshift.net>

Tsuraan,

tsuraan wrote:
> My desired workflow is:
> 
> basicConsume(...)
> forever() {
> consumer.nextDelivery()
> channel.txSelect()
> channel.basicAck(...)
> for(msg in some messages that depend on the delivered message) {
>   channel.basicPublish(msg)
> }
> channel.txCommit()
> }
> 
> My understanding (probably wrong) is that attempting to do blocking
> calls (like txSelect) on the channel being used by my consumer will
> cause a deadlock.  The documentation for QueueingConsumer says that it
> has straightforward blocking semantics, but I'm not sure what that
> means.  Is there a way to have my desired workflow using basicConsume,
> or do I need to do basicGet?

The above code should work with just a little bit of tweaking:

- call the basicConsume with a QueuingConsumer
- do the txSelect outside the loop - once a channel is in tx mode it 
stays in it

Or, to put it another way, just take the code from
   http://www.rabbitmq.com/api-guide.html#consuming
and add a channel.txSelect() outside the loop, and add the publishes and 
a channel.txCommit() inside the loop.


Matthias.



From tsuraan at gmail.com  Mon Apr  6 21:01:51 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 6 Apr 2009 15:01:51 -0500
Subject: [rabbitmq-discuss] Java client transaction with basic.consume
In-Reply-To: <49DA5B64.8090401@lshift.net>
References: <84fb38e30904061115o4682afb9rda35645b5ab2dee9@mail.gmail.com>
	<49DA5B64.8090401@lshift.net>
Message-ID: <84fb38e30904061301u7cdc7edbu38cd0c95080ddfc5@mail.gmail.com>

> The above code should work with just a little bit of tweaking:
>
> - call the basicConsume with a QueuingConsumer
> - do the txSelect outside the loop - once a channel is in tx mode it
> stays in it

Ok, that sounds easy enough.  Thanks!



From gsim at redhat.com  Tue Apr  7 14:05:10 2009
From: gsim at redhat.com (Gordon Sim)
Date: Tue, 07 Apr 2009 14:05:10 +0100
Subject: [rabbitmq-discuss] Messaging at SecondLife
In-Reply-To: <49DA0724.5020600@imatix.com>
References: <49D9F1BD.400@wizards.de> <49DA0724.5020600@imatix.com>
Message-ID: <49DB4F86.2020002@redhat.com>

Martin Sustrik wrote:
> Holger Hoffst?tte wrote:
>> SecondLife tried to evaluate several messaging solutions and a writeup of
>> the (quite sobering) results can be found here:
>> http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes
> 
> Their scenario (load-balancing queues across several network locations) 
> is pretty exotic. It's no surprise that none of the messaging systems 
> supports it out of the box. AFAIK even MQ series or Tibco doesn't 
> support this kind of thing. Interesting article though.

Is it load balancing queues in the sense of AMQP 0-8/0-9 'queues' or 
load balanced 'topics'. I.e. are the subscribers for those queues 
competing or non-competing consumers? (Or are both patterns required?).

--Gordon.



From gsim at redhat.com  Tue Apr  7 14:05:13 2009
From: gsim at redhat.com (Gordon Sim)
Date: Tue, 07 Apr 2009 14:05:13 +0100
Subject: [rabbitmq-discuss] Messaging at SecondLife
In-Reply-To: <167204d20904061009s7cafe491n232985d77c880f03@mail.gmail.com>
References: <49D9F1BD.400@wizards.de> <49DA0724.5020600@imatix.com>
	<167204d20904061009s7cafe491n232985d77c880f03@mail.gmail.com>
Message-ID: <49DB4F89.5010805@redhat.com>

Alexis Richardson wrote:
> 2009/4/6 Martin Sustrik <sustrik at imatix.com>:
>> Holger Hoffst?tte wrote:
>>> SecondLife tried to evaluate several messaging solutions and a writeup of
>>> the (quite sobering) results can be found here:
>>> http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes
>> Their scenario (load-balancing queues across several network locations)
>> is pretty exotic. It's no surprise that none of the messaging systems
>> supports it out of the box. AFAIK even MQ series or Tibco doesn't
>> support this kind of thing. Interesting article though.
> 
> Indeed.
> 
> They actually have several use cases, not all of which are documented
> here.  It's a very well structured analysis though.
> 
> If you extra nice to Brian Sullivan he may chat about some of their
> use cases on this list.

I'd be interested in understanding the comments around SSL and AMQP in 
more detail. AMQP to date has defined a special port for SSL/TLS based 
connections and to me that certainly seems an entirely acceptable 
solution (and one that is used already by implementations).

The upcoming 1.0 draft allows TLS to be started after the protocol 
'header' has been exchanged allowing the same port to be used for both 
SSL and clear connections. Is that the only thing missing? or are there 
other problems?

Also, can anyone explain the term 'cross-colo' to me? I've never come 
across that before.

--Gordon.



From sustrik at imatix.com  Tue Apr  7 14:26:29 2009
From: sustrik at imatix.com (Martin Sustrik)
Date: Tue, 07 Apr 2009 15:26:29 +0200
Subject: [rabbitmq-discuss] Messaging at SecondLife
In-Reply-To: <49DB4F86.2020002@redhat.com>
References: <49D9F1BD.400@wizards.de> <49DA0724.5020600@imatix.com>
	<49DB4F86.2020002@redhat.com>
Message-ID: <49DB5485.7050508@imatix.com>

Gordon Sim wrote:
> Martin Sustrik wrote:
>> Holger Hoffst?tte wrote:
>>> SecondLife tried to evaluate several messaging solutions and a 
>>> writeup of
>>> the (quite sobering) results can be found here:
>>> http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes
>>
>> Their scenario (load-balancing queues across several network 
>> locations) is pretty exotic. It's no surprise that none of the 
>> messaging systems supports it out of the box. AFAIK even MQ series or 
>> Tibco doesn't support this kind of thing. Interesting article though.
> 
> Is it load balancing queues in the sense of AMQP 0-8/0-9 'queues' or 
> load balanced 'topics'. I.e. are the subscribers for those queues 
> competing or non-competing consumers? (Or are both patterns required?).

Neither, as far as I understand. What they want is to have 100 brokers 
and create 1,000,000 queues. They would expect the messaging system to 
place 10,000 queues on each broker - and do so transparently to the 
application.

Martin



From gsim at redhat.com  Tue Apr  7 15:25:57 2009
From: gsim at redhat.com (Gordon Sim)
Date: Tue, 07 Apr 2009 15:25:57 +0100
Subject: [rabbitmq-discuss] Messaging at SecondLife
In-Reply-To: <49DB5485.7050508@imatix.com>
References: <49D9F1BD.400@wizards.de> <49DA0724.5020600@imatix.com>
	<49DB4F86.2020002@redhat.com> <49DB5485.7050508@imatix.com>
Message-ID: <49DB6275.2030306@redhat.com>

Martin Sustrik wrote:
> Neither, as far as I understand. What they want is to have 100 brokers 
> and create 1,000,000 queues. They would expect the messaging system to 
> place 10,000 queues on each broker - and do so transparently to the 
> application.

I see. Thanks for the clarification, Martin!

--Gordon



From esteve at sindominio.net  Tue Apr  7 19:05:43 2009
From: esteve at sindominio.net (Esteve Fernandez)
Date: Tue, 7 Apr 2009 20:05:43 +0200
Subject: [rabbitmq-discuss] shipping the amqp spec xml file
Message-ID: <200904072005.43952.esteve@sindominio.net>

Hi all,

after talking to several people at PyCon, the biggest complain about txAMQP 
was that they all had to figure out that they needed to pass the XML spec as 
an argument.

I think that autogenerating code out the official spec is a neat trick, but I 
understand that, sometimes, it's a pain having put that file somewhere, so 
the next version of txAMQP will come with all that autogenerated code already 
written.

Anyway, when we met in San Diego, I asked Tony about why RabbitMQ uses its own 
JSON spec file to generate the Java client API, and it seems it's because the 
XML file is not completely DFSG-free according to debian-legal. If so, do you 
know the exact reasons why Debian considers the XML spec file as non-free?

Cheers.



From matthias at lshift.net  Tue Apr  7 20:47:39 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 07 Apr 2009 20:47:39 +0100
Subject: [rabbitmq-discuss] shipping the amqp spec xml file
In-Reply-To: <200904072005.43952.esteve@sindominio.net>
References: <200904072005.43952.esteve@sindominio.net>
Message-ID: <49DBADDB.9060409@lshift.net>

Esteve,

Esteve Fernandez wrote:
> I asked Tony about why RabbitMQ uses its own JSON spec file to
> generate the Java client API, and it seems it's because the XML file
> is not completely DFSG-free according to debian-legal. If so, do you
>  know the exact reasons why Debian considers the XML spec file as
> non-free?

See http://www.nabble.com/AMQP-license-td14190114.html for the relevant 
thread in debian-legal.

John Leuner (cc'ed), who kicked off that thread when he started looking 
at getting RabbitMQ into Debian, may want to add some more detail, but 
basically we decided that of the three options available to us: a) 
convince debian-legal that the spec is dfsg-free, b) convince the AMQP 
WG to change the wording, or c) produce a dfsg-free version of the 
information we need for code generation, we chose the latter as it had 
the highest probability of success and a predictable timescale.

Options a) or b) are more desirable in the long run, but we simply do 
not have the time to pursue them. If somebody else wants to pick this up 
they are most welcome.


Regards,

Matthias.



From rdw at lindenlab.com  Tue Apr  7 22:50:20 2009
From: rdw at lindenlab.com (Ryan Williams (Which))
Date: Tue, 07 Apr 2009 14:50:20 -0700
Subject: [rabbitmq-discuss] Messaging at SecondLife
In-Reply-To: <167204d20904061009s7cafe491n232985d77c880f03@mail.gmail.com>
References: <49D9F1BD.400@wizards.de> <49DA0724.5020600@imatix.com>
	<167204d20904061009s7cafe491n232985d77c880f03@mail.gmail.com>
Message-ID: <49DBCA9C.2030606@lindenlab.com>

Alexis Richardson wrote:
> 2009/4/6 Martin Sustrik <sustrik at imatix.com>:
>> Holger Hoffst?tte wrote:
>>> SecondLife tried to evaluate several messaging solutions and a writeup of
>>> the (quite sobering) results can be found here:
>>> http://wiki.secondlife.com/wiki/Message_Queue_Evaluation_Notes
>> Their scenario (load-balancing queues across several network locations)
>> is pretty exotic. It's no surprise that none of the messaging systems
>> supports it out of the box. AFAIK even MQ series or Tibco doesn't
>> support this kind of thing. Interesting article though.
> 
> Indeed.
> 
> They actually have several use cases, not all of which are documented
> here.  It's a very well structured analysis though.
> 
> If you extra nice to Brian Sullivan he may chat about some of their
> use cases on this list.

I'm the horses's mouth for that wiki page (and the horse's ass too!).
We focused on the group chat use case pretty much to the exclusion of
all others because it is the hardest to solve and would provide the most
differentiation amongst implementations.  And it really served that
purpose well, seeing as how only 3 implementations even approached a
passable solution.

I started a thread about our intended usage here:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-February/003431.html
Which led me to produce the section on scaling.  We were definitely
hoping to stumble over some software that just did what we wanted, but,
since nothing appears to do so, that's an interesting negative result in
and of itself.  It was not such an obvious conclusion for us.

Now we're left with a bunch of options:
 - Improve Rabbit or some other message queue software so it's closer to
what we want.
 - Change some fundamental constants of the chat system so it is no
longer quite so esoteric.
 - Relegate group chat and IM to special-purpose software and use
message brokers for everything else.
 - Keep on looking for software that solves our use cases out of the box.

I'm not sure what the correct course of action is.  I believe that it is
technically possible to build the system we want, so I hold out hope
that it will be solved somewhere, somewhen.



From weaveinator at gmail.com  Wed Apr  8 00:36:54 2009
From: weaveinator at gmail.com (Steve Weaver)
Date: Tue, 7 Apr 2009 16:36:54 -0700
Subject: [rabbitmq-discuss] Using C# client libraries and channel close
Message-ID: <c05e896e0904071636q509604fek1f0cb93a183d1385@mail.gmail.com>

Hi -
Still mostly a noob with RabbitMQ but have a question regarding opening a
channel to Rabbit.  I have multiple clients that are sending messages using
Basic Publish and the C# library.  They are all sending sporadically so they
just open a channel send the message, get an acknowledgment, and close the
channel.  Everything is fine until the queue gets to about its 900 or so
open/publish/close sessions and then the rabbit server just fails with that
'bad rpc' error when you try to stop or get a status.  From watching it
there seems to be a problem with the channel not actually closing on the
rabbitmq side (using some network tools) so assuming it can only have x
amount of connections open.  I am using ch.Close(int,string) where the int
is 0 if no errors or > 0 if there is and string is just "closing" or the
error if it got trapped.  In any samples I have found no one uses the close
method (so maybe that is what I'm doing wrong).  There is no documentation
that I can find that explains exactly what going on there so was wondering
if anyone has experienced this or can anyone give me a tip on the best way
to handle many concurrent connections.

Thanks very much for your help!!
Steve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090407/e5b2330b/attachment.htm 

From mlartz at gmail.com  Wed Apr  8 02:01:08 2009
From: mlartz at gmail.com (Michael Artz)
Date: Tue, 7 Apr 2009 21:01:08 -0400
Subject: [rabbitmq-discuss] 0.9.1 Status?
Message-ID: <e9c163070904071801l421e5b7ep6566d1f5b3c2fe2d@mail.gmail.com>

Is there anywhere where I can check on the status of the AMQP 0.9.1
compatibility?

-Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090407/1c485018/attachment.htm 

From matthias at lshift.net  Wed Apr  8 08:38:33 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 08 Apr 2009 08:38:33 +0100
Subject: [rabbitmq-discuss] Using C# client libraries and channel close
In-Reply-To: <c05e896e0904071636q509604fek1f0cb93a183d1385@mail.gmail.com>
References: <c05e896e0904071636q509604fek1f0cb93a183d1385@mail.gmail.com>
Message-ID: <49DC5479.2060705@lshift.net>

Steve,

Steve Weaver wrote:
> I have multiple clients that are sending messages 
> using Basic Publish and the C# library.  They are all sending 
> sporadically so they just open a channel send the message, get an 
> acknowledgment, and close the channel.

Can you post the code for this?

> Everything is fine until the queue gets to about its 900 or so
> open/publish/close sessions and then the rabbit server just fails
> with that 'bad rpc' error when you try to stop or get a status. From
> watching it there seems to be a problem with the channel not actually
> closing on the rabbitmq side (using some network tools) so assuming
> it can only have x amount of connections open.

In AMQP terminology, a single network connection contains multiple 
channels. If you close the channel without closing the connection then 
the latter will remain open. That's not a problem though if in your test 
you subsequently use that existing connection to open/close more 
channels. Also, even if you opened new connections every time (without 
closing the old ones) you should get way more than 900 open connections 
before hitting any rabbit/erlang limits.

Hopefully all will become clear when I can take a look at the code.


Matthias.



From vlm at lionet.info  Wed Apr  8 15:55:26 2009
From: vlm at lionet.info (Lev Walkin)
Date: Wed, 08 Apr 2009 07:55:26 -0700
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
Message-ID: <49DCBADE.1060802@lionet.info>


I've started using Erlang native API to RabbitMQ recently (cloned out of 
v1_5 branch) and found a couple of issues I'd like someone "in the know" 
to clarify:

1. lib_amqp:close_channel(lib_amqp:start_channel()) leaks processes:

8> {now(), begin [lib_amqp:close_channel(lib_amqp:start_channel(Connection))
	|| _ <- lists:seq(1, 5000)], ok end, now()}.
{{1239,202072,747808},ok,{1239,202075,812575}}
9> length(processes()). 
         5031
10> {now(), begin 
[lib_amqp:close_channel(lib_amqp:start_channel(Connection))
	|| _ <- lists:seq(1, 5000)], ok end, now()}.
{{1239,202086,803935},ok,{1239,202089,761556}}
11> length(processes()). 
         10031
12>

Is it a normal intended behavior or something's wrong? I strongly 
believe it is wrong, because the channel itself is not alive after closing:

	1> length(processes()).
	24
	2> Connection = lib_amqp:start_connection("test-amqp").
	<0.33.0>
	3> Ch = lib_amqp:start_channel(Connection).
	<0.40.0>
	4> lib_amqp:close_channel(Ch).
	ok
	5> length(processes()).
	31
	6> is_process_alive(Ch).
	false
	7>

Moreover, if you close the Connection or restart the remote AMQP server, 
these thousands of processes won't go away:

	12> is_process_alive(Connection).
	true
	Broker forced connection: 320 -> <<"CONNECTION_FORCED - broker forced 
connection closure with reason 'shutdown'">>
	13> is_process_alive(Connection).
	false
	14> length(processes()). 
          	10027
	15>

	1> Connection = lib_amqp:start_connection("test-amqp").
	<0.37.0>
	2> {now(), begin 
[lib_amqp:close_channel(lib_amqp:start_channel(Connection))
		|| _ <- lists:seq(1, 5000)], ok end, now()}.
	{{1239,202400,604255},ok,{1239,202403,778267}}
	3> lib_amqp:close_connection(Connection).
	ok
	4> length(processes()).
	5026
	5>



2. One can not create a durable exclusive queue, that is, the following 
call does not result in a queue that persists between server app 
reloads. The queue _is_ created, but is not there after server restart.

         lib_amqp:declare_queue(Channel, #'queue.declare'{
                 queue = Q,
                 passive = false,
                 durable = true,		% NOTE
                 exclusive = true,	% NOTE
                 auto_delete = false,
                 nowait = false,
                 arguments = []
         }).


Please could someone comment on what's going on?

-- 
Lev Walkin
vlm at lionet.info



From matthias at lshift.net  Wed Apr  8 16:33:30 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 08 Apr 2009 16:33:30 +0100
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DCBADE.1060802@lionet.info>
References: <49DCBADE.1060802@lionet.info>
Message-ID: <49DCC3CA.5060904@lshift.net>

Lev,

Lev Walkin wrote:
> I've started using Erlang native API to RabbitMQ recently (cloned out of 
> v1_5 branch) and found a couple of issues I'd like someone "in the know" 
> to clarify:
> 
> 1. lib_amqp:close_channel(lib_amqp:start_channel()) leaks processes:

That looks like a bug. Do you get the same results against the default 
branch (of the erlang-client and rabbitmq-server)?

> 2. One can not create a durable exclusive queue, that is, the following 
> call does not result in a queue that persists between server app 
> reloads. The queue _is_ created, but is not there after server restart.
> 
>          lib_amqp:declare_queue(Channel, #'queue.declare'{
>                  queue = Q,
>                  passive = false,
>                  durable = true,		% NOTE
>                  exclusive = true,	% NOTE
>                  auto_delete = false,
>                  nowait = false,
>                  arguments = []
>          }).

I believe the problem here is that you set exclusive=true which ties the 
lifetime of the queue to that of the connection which created it.


Regards,

Matthias.



From vlm at lionet.info  Wed Apr  8 18:55:06 2009
From: vlm at lionet.info (Lev Walkin)
Date: Wed, 08 Apr 2009 10:55:06 -0700
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DCC3CA.5060904@lshift.net>
References: <49DCBADE.1060802@lionet.info> <49DCC3CA.5060904@lshift.net>
Message-ID: <49DCE4FA.8090109@lionet.info>

Matthias Radestock wrote:
> Lev,
> 
> Lev Walkin wrote:
>> I've started using Erlang native API to RabbitMQ recently (cloned out 
>> of v1_5 branch) and found a couple of issues I'd like someone "in the 
>> know" to clarify:
>>
>> 1. lib_amqp:close_channel(lib_amqp:start_channel()) leaks processes:
> 
> That looks like a bug. Do you get the same results against the default 
> branch (of the erlang-client and rabbitmq-server)?

Have not tried the default branch.

>> 2. One can not create a durable exclusive queue, that is, the 
>> following call does not result in a queue that persists between server 
>> app reloads. The queue _is_ created, but is not there after server 
>> restart.
>>
>>          lib_amqp:declare_queue(Channel, #'queue.declare'{
>>                  queue = Q,
>>                  passive = false,
>>                  durable = true,        % NOTE
>>                  exclusive = true,    % NOTE
>>                  auto_delete = false,
>>                  nowait = false,
>>                  arguments = []
>>          }).
> 
> I believe the problem here is that you set exclusive=true which ties the 
> lifetime of the queue to that of the connection which created it.

According to my understanding, exclusive provides access exclusivity 
(noone can get to this queue unless the exclusive accessor finishes). 
The lifetime tie is provided by auto_delete, which is set to false in 
this case.

Do you have a reference to an appropriate AMQP standard clause which 
says that my understanding is incorrect?

-- 
Lev Walkin
vlm at lionet.info



From matthias at lshift.net  Wed Apr  8 19:20:44 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 08 Apr 2009 19:20:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DCE4FA.8090109@lionet.info>
References: <49DCBADE.1060802@lionet.info> <49DCC3CA.5060904@lshift.net>
	<49DCE4FA.8090109@lionet.info>
Message-ID: <49DCEAFC.6010609@lshift.net>

Lev,

Lev Walkin wrote:
> According to my understanding, exclusive provides access exclusivity 
> (noone can get to this queue unless the exclusive accessor finishes). 
> The lifetime tie is provided by auto_delete, which is set to false in 
> this case.
> 
> Do you have a reference to an appropriate AMQP standard clause which 
> says that my understanding is incorrect?

 From the amqp0-8.xml: "Setting the 'exclusive' flag always implies 
'auto-delete'."

And from the amqp0-9-1.xml: "Exclusive queues ...are deleted when that 
connection closes."


Matthias.



From greenspan.levi at googlemail.com  Wed Apr  8 21:53:27 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Wed, 08 Apr 2009 22:53:27 +0200
Subject: [rabbitmq-discuss] Durable queues & bindings
Message-ID: <1239224007.27376.9.camel@localhost>

Dear list members,

I have a question w.r.t. clustering. Durable exchanges seem to survive
individual node crashes, but neither do queues and bindings if I am not
mistaken. The clustering guide [1] states:

"An exception to this [data & state replication] are message queues,
which currently only reside on the node that created them, though they
are visible and reachable from all nodes. Future releases of RabbitMQ
will introduce migration and replication of message queues."

Even though bindings are not mentioned I wanted to ask:

1. Is there an approximate time schedule, when to expect queue
replication in a cluster?

2. Assuming queues are replicated in a cluster, will I also get durable
bindings?

Many thanks for your replies!

Cheers,
Levi

-------------------------
[1] http://www.rabbitmq.com/clustering.html




From matthias at lshift.net  Wed Apr  8 22:15:45 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 08 Apr 2009 22:15:45 +0100
Subject: [rabbitmq-discuss] Durable queues & bindings
In-Reply-To: <1239224007.27376.9.camel@localhost>
References: <1239224007.27376.9.camel@localhost>
Message-ID: <49DD1401.1040306@lshift.net>

Levi,

Levi Greenspan wrote:
> Dear list members,
> 
> I have a question w.r.t. clustering. Durable exchanges seem to survive
> individual node crashes, but neither do queues and bindings if I am not
> mistaken.

The durable queues residing on the crashed node and their associated 
bindings do indeed disappear - but only for the duration of the outage; 
if/when the node comes back up the queues and bindings re-appear.

> 1. Is there an approximate time schedule, when to expect queue
> replication in a cluster?

Queue replication, or, more precisely, the ability of queues to stay 
alive in the presence of individual node failures, is fairly high on our 
priority list. There are a few other items we want/need to get out of 
the way first though, so I doubt we'll get round to it for another few 
months. As always, sponsors are welcome.

> 2. Assuming queues are replicated in a cluster, will I also get durable
> bindings?

As noted above, bindings are already durable. Moreover, they are already 
replicated.


Regards,

Matthias.



From greenspan.levi at googlemail.com  Wed Apr  8 22:43:03 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Wed, 08 Apr 2009 23:43:03 +0200
Subject: [rabbitmq-discuss] Durable queues & bindings
In-Reply-To: <49DD1401.1040306@lshift.net>
References: <1239224007.27376.9.camel@localhost> <49DD1401.1040306@lshift.net>
Message-ID: <1239226983.31701.1.camel@localhost>

On Wed, 2009-04-08 at 22:15 +0100, Matthias Radestock wrote:
> The durable queues residing on the crashed node and their associated 
> bindings do indeed disappear - but only for the duration of the outage; 
> if/when the node comes back up the queues and bindings re-appear.

Oops. My fault. Need to to further investigation why I got the wrong
impression.

Cheers,
Levi





From vlm at lionet.info  Wed Apr  8 23:33:33 2009
From: vlm at lionet.info (Lev Walkin)
Date: Wed, 08 Apr 2009 15:33:33 -0700
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DCEAFC.6010609@lshift.net>
References: <49DCBADE.1060802@lionet.info> <49DCC3CA.5060904@lshift.net>
	<49DCE4FA.8090109@lionet.info> <49DCEAFC.6010609@lshift.net>
Message-ID: <49DD263D.9090708@lionet.info>

Matthias Radestock wrote:
> Lev,
> 
> Lev Walkin wrote:
>> According to my understanding, exclusive provides access exclusivity 
>> (noone can get to this queue unless the exclusive accessor finishes). 
>> The lifetime tie is provided by auto_delete, which is set to false in 
>> this case.
>>
>> Do you have a reference to an appropriate AMQP standard clause which 
>> says that my understanding is incorrect?
> 
>  From the amqp0-8.xml: "Setting the 'exclusive' flag always implies 
> 'auto-delete'."
> 
> And from the amqp0-9-1.xml: "Exclusive queues ...are deleted when that 
> connection closes."

amqp-0-10 does not have this implication (page 228):

Exclusive queues can only be used from one session at a time. Once a 
session declares an exclusive queue, that queue cannot be used by any 
other session until the declaring session closes.

And wrt: auto-delete:

  If this field is set and the exclusive field is not set the queue is 
deleted when all the consumers have finished using it.

Which is ambiguous, but can easily mean that if auto-delete field is not 
set, the queue is not deleted.

-- 
Lev Walkin
vlm at lionet.info



From matthias at lshift.net  Thu Apr  9 06:52:19 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 09 Apr 2009 06:52:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DD263D.9090708@lionet.info>
References: <49DCBADE.1060802@lionet.info>
	<49DCC3CA.5060904@lshift.net>	<49DCE4FA.8090109@lionet.info>
	<49DCEAFC.6010609@lshift.net> <49DD263D.9090708@lionet.info>
Message-ID: <49DD8D13.4050602@lshift.net>

Lev,

Lev Walkin wrote:
> amqp-0-10 does not have this implication (page 228):
> 
> Exclusive queues can only be used from one session at a time. Once a 
> session declares an exclusive queue, that queue cannot be used by any 
> other session until the declaring session closes.

0-10's notion of exclusivity is different to 0-8/9/9-1's. In the latter 
exclusivity pertains to the creating session only, whereas in 0-10 it 
can be passed on, i.e. another session can become the exclusive user of 
a queue when the previous session has gone away.

> And wrt: auto-delete:
> 
>  If this field is set and the exclusive field is not set the queue is 
> deleted when all the consumers have finished using it.
> 
> Which is ambiguous, but can easily mean that if auto-delete field is not 
> set, the queue is not deleted.

IMHO the above is actually wrong, even in the context of 0-10. In 0-9-1 
we disentangled exclusivity and auto-deletion. The latter flag triggers 
deletion when the last *consumer* goes away, whereas exclusivity 
triggers deletion when the connection goes away. By contrast, the above 
would appear to make setting auto-delete on exclusive queues a no-op 
(it's ambiguous, but it would be stretch to read the statement differently).


Matthias.



From amos at geni.com  Thu Apr  9 07:32:10 2009
From: amos at geni.com (Amos Elliston)
Date: Wed, 8 Apr 2009 23:32:10 -0700
Subject: [rabbitmq-discuss] starting rabbit on centos 5
Message-ID: <62C32079-06F6-4B25-A97E-BB7CD258886D@geni.com>



On Wed, Apr 8, 2009 at 10:36 PM, Matthias Radestock  
<matthias at lshift.net> wrote:

     Amos,


     Amos Elliston wrote:

         i can't seem to install it. getting:

         [root at office002 rabbitmq]# /etc/init.d/rabbitmq-server start
         Starting rabbitmq-server: TIMEOUT - check /var/log/rabbitmq/ 
startup_{log,err}
         rabbitmq-server.

         [root at office002 rabbitmq]# ll
         total 8
         -rw-r--r-- 1 root root  77 Apr  8 16:33 startup_err
         -rw-r--r-- 1 root root 103 Apr  8 16:33 startup_log
         [root at office002 rabbitmq]# cat startup_*

         Crash dump was written to: erl_crash.dump
         init terminating in do_boot ()
         {"init terminating in do_boot",{undef,[{rabbit_multi,start, 
[]},{init,start_it,1},{init,start_em,1}]}}


     Is the thread
     http://www.nabble.com/error-connecting-to-rabbitmq-node-td19498782.html
     of any help?

     i.e. are you perhaps running a manually built Erlang?

     One way to find out is to run erl and call code:get_path(), e.g.

     $ erl
     Erlang (BEAM) emulator version 5.6.5 [source] [smp:4] [async- 
threads:0] [hipe] [kernel-poll:false]

     Eshell V5.6.5  (abort with ^G)
     1> code:get_path().
     [".","/usr/lib/erlang/lib/kernel-2.12.5/ebin",
      "/usr/lib/erlang/lib/stdlib-1.15.5/ebin",
     ...
      "/usr/lib/erlang/lib/rabbitmq_server-1.5.4/ebin",
     ...]

     If the result does not have /usr/lib/erlang/lib/... as the paths  
then you are not running the debian-packaged Erlang and either need to  
switch to that, or add some suitable symlinks, or tweak Erlang's load  
path.

     If the result *does* have /usr/lib/erlang/lib but there is no  
sign of rabbitmq_server-* in the list then the package didn't install  
properly.

     If the result looks as above but rabbit still won't start then  
something  weird is going on.


     Matthias.
     PS: Next time please email the rabbitmq-discuss list. You'll get  
an answer quicker that way and other users benefit from the findings.



thanks for the help!

turns out that there were 2 version of erlang installed on that  
computer. i386 and x86_64. i was installing the 64bit version of  
rabbit, but the default erl was 32 bit. if i removed the 32bit version  
and symlinked /usr/lib64/erlang/bin/erl to /usr/bin/erl, the server  
starts.

too bad erlang doesn't give more helpful error messages. like  
'rabbitmq not found in /usr/lib/erlang/lib'.



From mdarling at veodia.com  Thu Apr  9 08:04:39 2009
From: mdarling at veodia.com (Matt Darling)
Date: Thu, 09 Apr 2009 00:04:39 -0700
Subject: [rabbitmq-discuss] RabbitMQ meetup
In-Reply-To: <mailman.489.1239258736.15990.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <C602EC17.38AF%mdarling@veodia.com>

Here's a video from the BayFP 2009 discussion featuring Tony, from RabbitMQ,
discussing the happenings of RabbitMQ.

Thanks again to Hi5 for graciously offering the space (and their wifi)!

http://www.veodia.com/player.php?vid=ddiakWIOfFU


-matt

Matt Darling
Systems Architect, Business Services
Veodia
1825 S. Grant, #500
San Mateo, CA  94402
(w) 650.349.2100 x3119
(m) 415.505.4623




From matthias at lshift.net  Thu Apr  9 13:20:22 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 09 Apr 2009 13:20:22 +0100
Subject: [rabbitmq-discuss] 0.9.1 Status?
In-Reply-To: <e9c163070904071801l421e5b7ep6566d1f5b3c2fe2d@mail.gmail.com>
References: <e9c163070904071801l421e5b7ep6566d1f5b3c2fe2d@mail.gmail.com>
Message-ID: <49DDE806.7070500@lshift.net>

Michael,

Michael Artz wrote:
> Is there anywhere where I can check on the status of the AMQP 0.9.1 
> compatibility?

RabbitMQ implements AMQP 0-8. AMQP 0-9-1 removes many of the ambiguities 
present in AMQP 0-8/9. In many cases RabbitMQ already does the right 
thing, but in some it doesn't. Plus there are some actual changes 
between the two versions. For a good summary of the differences see
   https://dev.rabbitmq.com/wiki/Amqp08To091

Making the switch to 0-9-1 is on our medium-term radar.


Regards,

Matthias.



From alexis.richardson at gmail.com  Thu Apr  9 16:02:14 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 9 Apr 2009 08:02:14 -0700
Subject: [rabbitmq-discuss] RabbitMQ meetup
In-Reply-To: <C602EC17.38AF%mdarling@veodia.com>
References: <mailman.489.1239258736.15990.rabbitmq-discuss@lists.rabbitmq.com>
	<C602EC17.38AF%mdarling@veodia.com>
Message-ID: <167204d20904090802o3f6e57b4k47f4405034c2b9ec@mail.gmail.com>

Matt - thanks for making and posting that.  Thanks also to BayFP and Hi5.

Tony - are you going to post your slides on slideshare?





On Thu, Apr 9, 2009 at 12:04 AM, Matt Darling <mdarling at veodia.com> wrote:
> Here's a video from the BayFP 2009 discussion featuring Tony, from RabbitMQ,
> discussing the happenings of RabbitMQ.
>
> Thanks again to Hi5 for graciously offering the space (and their wifi)!
>
> http://www.veodia.com/player.php?vid=ddiakWIOfFU
>
>
> -matt
>
> Matt Darling
> Systems Architect, Business Services
> Veodia
> 1825 S. Grant, #500
> San Mateo, CA ?94402
> (w) 650.349.2100 x3119
> (m) 415.505.4623
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From amos at geni.com  Thu Apr  9 20:05:28 2009
From: amos at geni.com (Amos Elliston)
Date: Thu, 9 Apr 2009 12:05:28 -0700
Subject: [rabbitmq-discuss] channel.flow
Message-ID: <09140E75-7FE2-4766-8EC0-75ED2E0683D2@geni.com>

i started testing my new ruby amqp client in production last night.  
unfortunately, at 5 in the morning (when rabbit is most heavily  
loaded) i started receiving channel.flow frames after sending a  
basic.get. i don't really know what to do in this situation and the  
documentation is a bit confusing. can someone point me in the right  
direction? i'm using rabbit 1.5.4-1.



From matthias at lshift.net  Thu Apr  9 20:57:08 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 09 Apr 2009 20:57:08 +0100
Subject: [rabbitmq-discuss] channel.flow
In-Reply-To: <09140E75-7FE2-4766-8EC0-75ED2E0683D2@geni.com>
References: <09140E75-7FE2-4766-8EC0-75ED2E0683D2@geni.com>
Message-ID: <49DE5314.2090902@lshift.net>

Amos,

Amos Elliston wrote:
> i started testing my new ruby amqp client in production last night.  
> unfortunately, at 5 in the morning (when rabbit is most heavily  
> loaded) i started receiving channel.flow frames after sending a  
> basic.get. i don't really know what to do in this situation and the  
> documentation is a bit confusing. can someone point me in the right  
> direction? i'm using rabbit 1.5.4-1.

When a client receives a channel.flow{active = false}, it is supposed to 
stop publishing and reply with channel.flow_ok{active = false}. When it 
receives a channel.flow{active = true} it can resume publishing and 
should reply with channel.flow_ok{active = true}.

The RabbitMQ Java and .net clients automatically handle the flow_ok 
reply and block any threads that attempt to do a publish while 
active=false, resuming them when active=true.

Note that since channel.flow only affects publishes, it should have no 
effect on application code that only acts as a consumers.


Matthias.



From amos at geni.com  Thu Apr  9 21:14:16 2009
From: amos at geni.com (Amos Elliston)
Date: Thu, 9 Apr 2009 13:14:16 -0700
Subject: [rabbitmq-discuss] channel.flow
In-Reply-To: <49DE5314.2090902@lshift.net>
References: <09140E75-7FE2-4766-8EC0-75ED2E0683D2@geni.com>
	<49DE5314.2090902@lshift.net>
Message-ID: <DE603F0D-36E1-4026-BC30-37488A977035@geni.com>

i don't think aman's amqp ruby client supports that behavior. is that  
true aman? might explain why rabbit occasionally crashes on us.

On Apr 9, 2009, at 12:57 PM, Matthias Radestock wrote:

> Amos,
>
> Amos Elliston wrote:
>> i started testing my new ruby amqp client in production last  
>> night.  unfortunately, at 5 in the morning (when rabbit is most  
>> heavily  loaded) i started receiving channel.flow frames after  
>> sending a  basic.get. i don't really know what to do in this  
>> situation and the  documentation is a bit confusing. can someone  
>> point me in the right  direction? i'm using rabbit 1.5.4-1.
>
> When a client receives a channel.flow{active = false}, it is  
> supposed to stop publishing and reply with channel.flow_ok{active =  
> false}. When it receives a channel.flow{active = true} it can resume  
> publishing and should reply with channel.flow_ok{active = true}.
>
> The RabbitMQ Java and .net clients automatically handle the flow_ok  
> reply and block any threads that attempt to do a publish while  
> active=false, resuming them when active=true.
>
> Note that since channel.flow only affects publishes, it should have  
> no effect on application code that only acts as a consumers.
>
>
> Matthias.




From vlm at lionet.info  Fri Apr 10 09:38:36 2009
From: vlm at lionet.info (Lev Walkin)
Date: Fri, 10 Apr 2009 01:38:36 -0700
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DCE4FA.8090109@lionet.info>
References: <49DCBADE.1060802@lionet.info> <49DCC3CA.5060904@lshift.net>
	<49DCE4FA.8090109@lionet.info>
Message-ID: <49DF058C.4040301@lionet.info>

Lev Walkin wrote:
> Matthias Radestock wrote:
>> Lev,
>>
>> Lev Walkin wrote:
>>> I've started using Erlang native API to RabbitMQ recently (cloned out 
>>> of v1_5 branch) and found a couple of issues I'd like someone "in the 
>>> know" to clarify:
>>>
>>> 1. lib_amqp:close_channel(lib_amqp:start_channel()) leaks processes:
>> That looks like a bug. Do you get the same results against the default 
>> branch (of the erlang-client and rabbitmq-server)?
> 
> Have not tried the default branch.

The default branch for the client won't work with 1.5.4 server:

=== downloaded 1.5.4 server === def branch client ===
[vlm at test-amq ~/rabbitmq-erlang-client]> gmake test_direct
erl -pa ebin rabbitmq_server/ebin -noshell -mnesia dir tmp -boot 
start_sasl -s rabbit -noshell \
	-sasl sasl_error_logger '{file, "'/tmp'/rabbit-sasl.log"}' \
	-kernel error_logger '{file, "'/tmp'/rabbit.log"}' \
	-eval 'direct_client_test:test(),halt().'
RabbitMQ 1.5.4 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies 
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

Logging to "/tmp/rabbit.log"
SASL logging to "/tmp/rabbit-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done

broker running
direct_client_test:basic_get_test...*failed*
::exit:{{undef,[{rabbit_channel,start_link,
                               [1,<0.199.0>,<0.199.0>,<<"guest">>,<<"/">>]},
               {amqp_direct_driver,open_channel,3},
               {amqp_connection,handle_open_channel,2},
               {gen_server,handle_msg,5},
               {proc_lib,init_p_do_apply,3}]},
       {gen_server,call,[<0.198.0>,{open_channel,none,<<>>}]}}
   in function gen_server:call/2
   in call from test_util:basic_get_test/1

===================================================


If I check out the default branch server and the client, the following 
happens (pretty close to the above mismatch errors):

=== def branch server === def branch client ===

[vlm at test-amq ~/rabbitmq-erlang-client]> gmake test_direct
erl -pa ebin rabbitmq_server/ebin -noshell -mnesia dir tmp -boot 
start_sasl -s rabbit -noshell \
	-sasl sasl_error_logger '{file, "'/tmp'/rabbit-sasl.log"}' \
	-kernel error_logger '{file, "'/tmp'/rabbit.log"}' \
	-eval 'direct_client_test:test(),halt().'
RabbitMQ %%VERSION%% (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies 
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

Logging to "/tmp/rabbit.log"
SASL logging to "/tmp/rabbit-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done

broker running
direct_client_test:basic_qos_test...*timed out*
^C
BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
        (v)ersion (k)ill (D)b-tables (d)istribution
^C
[vlm at test-amq ~/rabbitmq-erlang-client]>
================================================

In my case, however, the 1.5.4 server and v1_5 client work together 
without a problem (except for process leaks described).

-- 
Lev Walkin
vlm at lionet.info



From matthias at lshift.net  Fri Apr 10 10:24:08 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 10 Apr 2009 10:24:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DF058C.4040301@lionet.info>
References: <49DCBADE.1060802@lionet.info>
	<49DCC3CA.5060904@lshift.net>	<49DCE4FA.8090109@lionet.info>
	<49DF058C.4040301@lionet.info>
Message-ID: <49DF1038.7060508@lshift.net>

Lev,

Lev Walkin wrote:
> Lev Walkin wrote:
>> Matthias Radestock wrote:
>>>> 1. lib_amqp:close_channel(lib_amqp:start_channel()) leaks processes:
>>> That looks like a bug. Do you get the same results against the 
>>> default branch (of the erlang-client and rabbitmq-server)?
>>
>> Have not tried the default branch.
> 
> The default branch for the client won't work with 1.5.4 server:

That is expected.

> If I check out the default branch server and the client, the following 
> happens (pretty close to the above mismatch errors):

> direct_client_test:basic_qos_test...*timed out*

That's actually just one of the tests timing out. This has been fixed 
but the changes haven't been qa'ed yet so they are not on 'default' yet.

Did you try running your tests to see whether you get the same process 
leaks you experienced in 1.5.x?


Matthias.



From vlm at lionet.info  Fri Apr 10 10:54:32 2009
From: vlm at lionet.info (Lev Walkin)
Date: Fri, 10 Apr 2009 02:54:32 -0700
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DF1038.7060508@lshift.net>
References: <49DCBADE.1060802@lionet.info>
	<49DCC3CA.5060904@lshift.net>	<49DCE4FA.8090109@lionet.info>
	<49DF058C.4040301@lionet.info> <49DF1038.7060508@lshift.net>
Message-ID: <49DF1758.2030302@lionet.info>

Matthias Radestock wrote:
> Lev,
> 
> Lev Walkin wrote:
>> Lev Walkin wrote:
>>> Matthias Radestock wrote:
>>>>> 1. lib_amqp:close_channel(lib_amqp:start_channel()) leaks processes:
>>>> That looks like a bug. Do you get the same results against the 
>>>> default branch (of the erlang-client and rabbitmq-server)?
>>>
>>> Have not tried the default branch.
>>
>> The default branch for the client won't work with 1.5.4 server:
> 
> That is expected.
> 
>> If I check out the default branch server and the client, the following 
>> happens (pretty close to the above mismatch errors):
> 
>> direct_client_test:basic_qos_test...*timed out*
> 
> That's actually just one of the tests timing out. This has been fixed 
> but the changes haven't been qa'ed yet so they are not on 'default' yet.
> 
> Did you try running your tests to see whether you get the same process 
> leaks you experienced in 1.5.x?

Heck, let's do it now... Here it is:

1> code:add_pathsa(["./rabbitmq-server/ebin", 
"./rabbitmq-erlang-client/ebin"]).
ok
2> Connection = lib_amqp:start_connection("amq1").
<0.33.0>
3> {length(processes()), "Processes before RabbitMQ Client leaks"}.
{30,"Processes before RabbitMQ Client leaks"}
4> lib_amqp:close_channel(lib_amqp:start_channel(Connection)).
ok
5> {length(processes()), "Processes after RabbitMQ Client leak test 1"}.
{31,"Processes after RabbitMQ Client leak test 1"}
6> lib_amqp:close_channel(lib_amqp:start_channel(Connection)).
ok
7> {length(processes()), "Processes after RabbitMQ Client leak test 1"}.
{32,"Processes after RabbitMQ Client leak test 1"}
8> lib_amqp:close_channel(lib_amqp:start_channel(Connection)).
ok
9> {length(processes()), "Processes after RabbitMQ Client leak test 1"}.
{33,"Processes after RabbitMQ Client leak test 1"}
10> {now(), begin 
[lib_amqp:close_channel(lib_amqp:start_channel(Connection))
	|| _ <- lists:seq(1, 5000)], ok end, now()}.
{{1239,357113,299622},ok,{1239,357116,128088}}
11> {length(processes()), "Processes after many leak tests"}. 

{5033,"Processes after many leak tests"}
12>
Connection: Handling exit from <0.37.0> --> 
connection_socket_closed_unexpectedly
Broker forced connection: 320 -> <<"CONNECTION_FORCED - broker forced 
connection closure with reason 'shutdown'">>
12> {length(processes()), "Processes after RabbitMQ Server shutdown"}.
{5029,"Processes after RabbitMQ Server shutdown"}
13>

-- 
Lev Walkin
vlm at lionet.info



From matthias at lshift.net  Fri Apr 10 12:36:15 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 10 Apr 2009 12:36:15 +0100
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DF1758.2030302@lionet.info>
References: <49DCBADE.1060802@lionet.info>	<49DCC3CA.5060904@lshift.net>	<49DCE4FA.8090109@lionet.info>	<49DF058C.4040301@lionet.info>
	<49DF1038.7060508@lshift.net> <49DF1758.2030302@lionet.info>
Message-ID: <49DF2F2F.3010006@lshift.net>

Lev,

Lev Walkin wrote:
> Matthias Radestock wrote:
>> Did you try running your tests to see whether you get the same process 
>> leaks you experienced in 1.5.x?
> 
> Heck, let's do it now...

I have found and fixed the problem. See the bug20579 branch of the 
rabbitmq-erlang-client, which I branched off v1_5. The change still has 
to go through QA, but feel free to try it in the meantime.

Thanks for reporting this bug.


Matthias.



From vlm at lionet.info  Fri Apr 10 13:30:49 2009
From: vlm at lionet.info (Lev Walkin)
Date: Fri, 10 Apr 2009 05:30:49 -0700
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DF2F2F.3010006@lshift.net>
References: <49DCBADE.1060802@lionet.info>	<49DCC3CA.5060904@lshift.net>	<49DCE4FA.8090109@lionet.info>	<49DF058C.4040301@lionet.info>
	<49DF1038.7060508@lshift.net> <49DF1758.2030302@lionet.info>
	<49DF2F2F.3010006@lshift.net>
Message-ID: <49DF3BF9.8040508@lionet.info>

Matthias Radestock wrote:
> Lev,
> 
> Lev Walkin wrote:
>> Matthias Radestock wrote:
>>> Did you try running your tests to see whether you get the same 
>>> process leaks you experienced in 1.5.x?
>>
>> Heck, let's do it now...
> 
> I have found and fixed the problem. See the bug20579 branch of the 
> rabbitmq-erlang-client, which I branched off v1_5. The change still has 
> to go through QA, but feel free to try it in the meantime.

Tested, works perfectly, thank you!

By the way, you might want to update the web site to specify the hg 
branch name for those wishing to use erlang client library against the 
officially released code.

-- 
Lev Walkin
vlm at lionet.info



From matthias at lshift.net  Fri Apr 10 13:52:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 10 Apr 2009 13:52:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DF3BF9.8040508@lionet.info>
References: <49DCBADE.1060802@lionet.info>	<49DCC3CA.5060904@lshift.net>	<49DCE4FA.8090109@lionet.info>	<49DF058C.4040301@lionet.info>	<49DF1038.7060508@lshift.net>
	<49DF1758.2030302@lionet.info>	<49DF2F2F.3010006@lshift.net>
	<49DF3BF9.8040508@lionet.info>
Message-ID: <49DF40F0.9050903@lshift.net>

Lev,

Lev Walkin wrote:
> By the way, you might want to update the web site to specify the hg 
> branch name for those wishing to use erlang client library against the 
> officially released code.

I think the instructions at http://www.rabbitmq.com/mercurial.html cover 
that, don't they?


Matthias



From vlm at lionet.info  Fri Apr 10 14:05:10 2009
From: vlm at lionet.info (Lev Walkin)
Date: Fri, 10 Apr 2009 06:05:10 -0700
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DF40F0.9050903@lshift.net>
References: <49DCBADE.1060802@lionet.info>	<49DCC3CA.5060904@lshift.net>	<49DCE4FA.8090109@lionet.info>	<49DF058C.4040301@lionet.info>	<49DF1038.7060508@lshift.net>
	<49DF1758.2030302@lionet.info>	<49DF2F2F.3010006@lshift.net>
	<49DF3BF9.8040508@lionet.info> <49DF40F0.9050903@lshift.net>
Message-ID: <49DF4406.3090705@lionet.info>

Matthias Radestock wrote:
> Lev,
> 
> Lev Walkin wrote:
>> By the way, you might want to update the web site to specify the hg 
>> branch name for those wishing to use erlang client library against the 
>> officially released code.
> 
> I think the instructions at http://www.rabbitmq.com/mercurial.html cover 
> that, don't they?

1. There is no mentioning that the erlang client branch should match the 
server version.

2. There is no information that despite the requirement that client 
branch must somehow "correspond" to the server branch, there is no 
v1_5_4 branch in the erlang client. The client only has v1_5 tag, no 
v1_5_[34].

3. There is no clear indication that in order to use -1.5.4 server, the 
client should be checked out using v1_5 branch.

And so on. A few subtle things you take for granted generate unrest in 
first time users who can't get their erlang clients to work the first 
time. Telling you from my first hand experience.

Thanks for the product, though! It is very neat once you get it to work.

-- 
Lev Walkin
vlm at lionet.info



From matthias at lshift.net  Fri Apr 10 14:17:33 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 10 Apr 2009 14:17:33 +0100
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DF4406.3090705@lionet.info>
References: <49DCBADE.1060802@lionet.info>	<49DCC3CA.5060904@lshift.net>	<49DCE4FA.8090109@lionet.info>	<49DF058C.4040301@lionet.info>	<49DF1038.7060508@lshift.net>	<49DF1758.2030302@lionet.info>	<49DF2F2F.3010006@lshift.net>	<49DF3BF9.8040508@lionet.info>
	<49DF40F0.9050903@lshift.net> <49DF4406.3090705@lionet.info>
Message-ID: <49DF46ED.2040607@lshift.net>

Lev,

Lev Walkin wrote:
> Matthias Radestock wrote:
>> I think the instructions at http://www.rabbitmq.com/mercurial.html 
>> cover that, don't they?
> 
> 1. There is no mentioning that the erlang client branch should match the 
> server version.

"It's important to make sure that all the repositories you are using are 
on the same tag as each other."

> 2. There is no information that despite the requirement that client 
> branch must somehow "correspond" to the server branch, there is no 
> v1_5_4 branch in the erlang client. The client only has v1_5 tag, no 
> v1_5_[34].

"If there is no specific tag for a repository for the version of the 
server you are using, try using the newest tag that has the same major 
and minor version number."

> 3. There is no clear indication that in order to use -1.5.4 server, the 
> client should be checked out using v1_5 branch.

"Another alternative for this hypothetical situation would be to use the 
tip of the 1.5.x branch:"

> And so on.

Granted, the instructions could definitely be improved. Do you have some 
concrete suggestions? If you send me some updated text I'd be happy to 
incorporate it.


Matthias.



From vlm at lionet.info  Fri Apr 10 19:37:29 2009
From: vlm at lionet.info (Lev Walkin)
Date: Fri, 10 Apr 2009 11:37:29 -0700
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DF46ED.2040607@lshift.net>
References: <49DCBADE.1060802@lionet.info>	<49DCC3CA.5060904@lshift.net>	<49DCE4FA.8090109@lionet.info>	<49DF058C.4040301@lionet.info>	<49DF1038.7060508@lshift.net>	<49DF1758.2030302@lionet.info>	<49DF2F2F.3010006@lshift.net>	<49DF3BF9.8040508@lionet.info>
	<49DF40F0.9050903@lshift.net> <49DF4406.3090705@lionet.info>
	<49DF46ED.2040607@lshift.net>
Message-ID: <49DF91E9.2090701@lionet.info>

Matthias Radestock wrote:
> Lev,
> 
> Lev Walkin wrote:
>> Matthias Radestock wrote:
>>> I think the instructions at http://www.rabbitmq.com/mercurial.html 
>>> cover that, don't they?
>>
>> 1. There is no mentioning that the erlang client branch should match 
>> the server version.
> 
> "It's important to make sure that all the repositories you are using are 
> on the same tag as each other."
> 
>> 2. There is no information that despite the requirement that client 
>> branch must somehow "correspond" to the server branch, there is no 
>> v1_5_4 branch in the erlang client. The client only has v1_5 tag, no 
>> v1_5_[34].
> 
> "If there is no specific tag for a repository for the version of the 
> server you are using, try using the newest tag that has the same major 
> and minor version number."
> 
>> 3. There is no clear indication that in order to use -1.5.4 server, 
>> the client should be checked out using v1_5 branch.
> 
> "Another alternative for this hypothetical situation would be to use the 
> tip of the 1.5.x branch:"
> 
>> And so on.
> 
> Granted, the instructions could definitely be improved. Do you have some 
> concrete suggestions? If you send me some updated text I'd be happy to 
> incorporate it.

See attached picture. The text "on how WE use mercurial" is not helping 
in detecting your intention, we need "information how YOU should use 
mercurial", conceptually. I propose adding something as the very next 
row right after rabbitmq-erlang-client snapshot. Something like

|| To get snapshot matching the latest released 1.5.4 server code: || hg 
clone -v1_5 ... || browse repo ||

and also "See more information on branch matching between the server and 
the client code repos _here_".

Or smth.

-- 
Lev Walkin
vlm at lionet.info
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Picture 19.png
Type: image/png
Size: 46061 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090410/a22050c0/attachment.png 

From lk at teamten.com  Fri Apr 10 22:01:06 2009
From: lk at teamten.com (Lawrence Kesteloot)
Date: Fri, 10 Apr 2009 14:01:06 -0700
Subject: [rabbitmq-discuss] Large number of connections
Message-ID: <997cab100904101401j7ffadca6kdd4ad7d4ef06e460@mail.gmail.com>

Hello,

I need to have a large number of connections to the message broker,
perhaps 10,000. There is typically (on Unix) a limit of 1024 open file
descriptors per process. The number of connections may blow up by a
factor of 10 later, I'm not sure yet. How would RabbitMQ deal with
this? Multiple instances of the broker? Also, each connection will
have its own queue. Can RabbitMQ deal with tens of thousands of
queues? The total message throughput will be on the order of the
number of connections per second (several thousand per second).

Thanks,

Lawrence



From tonyg at lshift.net  Fri Apr 10 22:53:43 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 10 Apr 2009 14:53:43 -0700
Subject: [rabbitmq-discuss] Large number of connections
In-Reply-To: <997cab100904101401j7ffadca6kdd4ad7d4ef06e460@mail.gmail.com>
References: <997cab100904101401j7ffadca6kdd4ad7d4ef06e460@mail.gmail.com>
Message-ID: <49DFBFE7.1020609@lshift.net>

Hi Lawrence,

Lawrence Kesteloot wrote:
> I need to have a large number of connections to the message broker,
> perhaps 10,000. There is typically (on Unix) a limit of 1024 open file
> descriptors per process.

Indeed. You will need to engage in kernel (or at least rlimit) tuning to 
raise the limit. (You may also need to increase the limit the erlang VM 
places on the maximum number of processes; "+P 1000000" argument to the VM)

I've had upwards of 4000 simultaneous connections to a single node 
before, but haven't done any serious testing of it with so many connections.

> Multiple instances of the broker?

Clustering will help spread the load, so yes, maybe.

> Also, each connection will
> have its own queue. Can RabbitMQ deal with tens of thousands of
> queues? The total message throughput will be on the order of the
> number of connections per second (several thousand per second).

It can deal with tens or even hundreds of thousands of queues. The 
throughput may be a limiting factor, but again clustering may help there.

Regards,
   Tony




From greenspan.levi at googlemail.com  Fri Apr 10 22:55:27 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Fri, 10 Apr 2009 23:55:27 +0200
Subject: [rabbitmq-discuss] Durable queues & bindings
In-Reply-To: <1239226983.31701.1.camel@localhost>
References: <1239224007.27376.9.camel@localhost>
	<49DD1401.1040306@lshift.net>  <1239226983.31701.1.camel@localhost>
Message-ID: <1239400527.14483.6.camel@localhost>

On Wed, 2009-04-08 at 23:43 +0200, Levi Greenspan wrote:
> On Wed, 2009-04-08 at 22:15 +0100, Matthias Radestock wrote:
> > The durable queues residing on the crashed node and their associated 
> > bindings do indeed disappear - but only for the duration of the outage; 
> > if/when the node comes back up the queues and bindings re-appear.
> 
> Oops. My fault. Need to to further investigation why I got the wrong
> impression.

I upgraded to version 1.5.4 and now I see the queues and bindings after
the node is running again. However in 1.5.3 it didn't work for me.

Anyway I noticed another difference between 1.5.3 and 1.5.4 - the call
to com.rabbitmq.client.Connection.getKnownHosts() in that Java client
API returns the list of all running node addresses in 1.5.3, but only
one host address in 1.5.4 - a bug?

Thanks,
Levi




From lk at teamten.com  Fri Apr 10 23:15:27 2009
From: lk at teamten.com (Lawrence Kesteloot)
Date: Fri, 10 Apr 2009 15:15:27 -0700
Subject: [rabbitmq-discuss] Large number of connections
In-Reply-To: <49DFBFE7.1020609@lshift.net>
References: <997cab100904101401j7ffadca6kdd4ad7d4ef06e460@mail.gmail.com> 
	<49DFBFE7.1020609@lshift.net>
Message-ID: <997cab100904101515h7c5d5126of883145d49b0f270@mail.gmail.com>

Hi Tony,

Thanks for the talk on Wednesday.

I'd rather not hack the kernel. If RabbitMQ can already handle the queues
and messages, could I instead have a dozen multiplexer processes that do
nothing but multiplex 1000 TCP AMQP connections into a single one? I don't
know if the AMQP protocol makes this possible. It might need to keep track
of virtual connections within the single connection.

Lawrence



On Fri, Apr 10, 2009 at 2:53 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Hi Lawrence,
>
> Lawrence Kesteloot wrote:
>
>> I need to have a large number of connections to the message broker,
>> perhaps 10,000. There is typically (on Unix) a limit of 1024 open file
>> descriptors per process.
>>
>
> Indeed. You will need to engage in kernel (or at least rlimit) tuning to
> raise the limit. (You may also need to increase the limit the erlang VM
> places on the maximum number of processes; "+P 1000000" argument to the VM)
>
> I've had upwards of 4000 simultaneous connections to a single node before,
> but haven't done any serious testing of it with so many connections.
>
>  Multiple instances of the broker?
>>
>
> Clustering will help spread the load, so yes, maybe.
>
>  Also, each connection will
>> have its own queue. Can RabbitMQ deal with tens of thousands of
>> queues? The total message throughput will be on the order of the
>> number of connections per second (several thousand per second).
>>
>
> It can deal with tens or even hundreds of thousands of queues. The
> throughput may be a limiting factor, but again clustering may help there.
>
> Regards,
>  Tony
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090410/3e9ec6ae/attachment.htm 

From matthias at lshift.net  Sat Apr 11 00:03:50 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 11 Apr 2009 00:03:50 +0100
Subject: [rabbitmq-discuss] RabbitMQ Erlang API questions
In-Reply-To: <49DF91E9.2090701@lionet.info>
References: <49DCBADE.1060802@lionet.info>	<49DCC3CA.5060904@lshift.net>	<49DCE4FA.8090109@lionet.info>	<49DF058C.4040301@lionet.info>	<49DF1038.7060508@lshift.net>	<49DF1758.2030302@lionet.info>	<49DF2F2F.3010006@lshift.net>	<49DF3BF9.8040508@lionet.info>	<49DF40F0.9050903@lshift.net>
	<49DF4406.3090705@lionet.info>	<49DF46ED.2040607@lshift.net>
	<49DF91E9.2090701@lionet.info>
Message-ID: <49DFD056.6080507@lshift.net>

Lev,

Lev Walkin wrote:
> The text "on how WE use mercurial" is not helping in detecting your
> intention, we need "information how YOU should use mercurial",
> conceptually.

Good point. I've changed the wording for this.

> I propose adding something as the very next row right after
> rabbitmq-erlang-client snapshot. Something like
> 
> || To get snapshot matching the latest released 1.5.4 server code: ||
> hg clone -v1_5 ... || browse repo ||

I can see how that would be useful but it may need some more tweaking. 
Firstly, ideally I'd like to avoid adding info that needs to be manually 
tweaked per release - our release process is already complicated enough 
as it is. Also, the same info would have to be added for all the other 
extensions. That's (just about) ok when it's just a single sentence - 
the reference to the mercurial instructions is an example of that - but 
anything beyond that becomes bloat.


Matthias.



From dialtone at gmail.com  Sat Apr 11 00:42:48 2009
From: dialtone at gmail.com (Valentino Volonghi)
Date: Fri, 10 Apr 2009 16:42:48 -0700
Subject: [rabbitmq-discuss] Large number of connections
In-Reply-To: <997cab100904101515h7c5d5126of883145d49b0f270@mail.gmail.com>
References: <997cab100904101401j7ffadca6kdd4ad7d4ef06e460@mail.gmail.com>
	<49DFBFE7.1020609@lshift.net>
	<997cab100904101515h7c5d5126of883145d49b0f270@mail.gmail.com>
Message-ID: <33E45E14-E975-44B3-AAC7-708DFA3827EA@gmail.com>


On Apr 10, 2009, at 3:15 PM, Lawrence Kesteloot wrote:

> Hi Tony,
>
> Thanks for the talk on Wednesday.
>
> I'd rather not hack the kernel.

That's not hacking the kernel... If you want to setup a server to  
seriously handle
many thousands of connections you _have to_ set it up so that it is as  
fast as possible
to handle that traffic. The default parameters in the kernel are for  
desktop
and minimal RAM usage, on servers this doesn't make sense at all  
because you
already know how much traffic you are going to deal with and what the  
server is
going to be working on (DB, reverse proxy, load balancer, app server  
etc).

Notice also that every connection uses a port and you only have room  
for 65k
ports per interface, so for example one other setting that you need to  
add is
to remove the 2 minutes windows of TCP_WAIT. If you don't change these
parameters, mind you, you are going to have serious issues in  
production, for example
not enough ports to bind new sockets.

Here's a set of parameters that you might want to change in your kernel
to make it faster and better for many TCP connections.

# some spoof protection
net.ipv4.conf.default.rp_filter=1
net.ipv4.conf.all.rp_filter=1

# General gigabit tuning:
net.core.rmem_max = 8738000
net.core.wmem_max = 6553600
net.ipv4.tcp_rmem = 8192 873800 8738000
net.ipv4.tcp_wmem = 4096 655360 6553600

# VERY important to reuse ports in TCP_WAIT
net.ipv4.tcp_tw_reuse = 1

net.ipv4.tcp_max_tw_buckets = 360000
net.core.netdev_max_backlog = 2500
vm.min_free_kbytes = 65536
vm.swappiness = 0

# Ports dedicated to clients from this server
net.ipv4.ip_local_port_range = 30000 65535

Furthermore you also might want to use ulimit to increase the number  
of allowed
fds per process and other parameters as tony already suggested.

--
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090410/1285cc8b/attachment.pgp 

From lk at teamten.com  Sat Apr 11 02:05:15 2009
From: lk at teamten.com (Lawrence Kesteloot)
Date: Fri, 10 Apr 2009 18:05:15 -0700
Subject: [rabbitmq-discuss] Large number of connections
In-Reply-To: <33E45E14-E975-44B3-AAC7-708DFA3827EA@gmail.com>
References: <997cab100904101401j7ffadca6kdd4ad7d4ef06e460@mail.gmail.com> 
	<49DFBFE7.1020609@lshift.net>
	<997cab100904101515h7c5d5126of883145d49b0f270@mail.gmail.com> 
	<33E45E14-E975-44B3-AAC7-708DFA3827EA@gmail.com>
Message-ID: <997cab100904101805n27f54c0cwe76f9e42b5638582@mail.gmail.com>

On Fri, Apr 10, 2009 at 4:42 PM, Valentino Volonghi <dialtone at gmail.com> wrote:
>> I'd rather not hack the kernel.
>
> That's not hacking the kernel... [...] Furthermore you
> also might want to use ulimit to increase the number
> of allowed fds per process and other parameters as
> tony already suggested.

You're right, my knowledge of FD limits is apparently over a decade
out of date. Last time I tried this you had to change a #define and
rebuild everything.

This removes a large objection I had to RabbitMQ.

Thanks!

Lawrence



From rgh at roughage.com.au  Sat Apr 11 07:02:18 2009
From: rgh at roughage.com.au (Richard Heycock)
Date: Sat, 11 Apr 2009 16:02:18 +1000
Subject: [rabbitmq-discuss] Large number of connections
In-Reply-To: <997cab100904101805n27f54c0cwe76f9e42b5638582@mail.gmail.com>
References: <997cab100904101401j7ffadca6kdd4ad7d4ef06e460@mail.gmail.com>
	<49DFBFE7.1020609@lshift.net>
	<997cab100904101515h7c5d5126of883145d49b0f270@mail.gmail.com>
	<33E45E14-E975-44B3-AAC7-708DFA3827EA@gmail.com>
	<997cab100904101805n27f54c0cwe76f9e42b5638582@mail.gmail.com>
Message-ID: <1239429689-sup-4969@wrasse>

Excerpts from Lawrence Kesteloot's message of Sat Apr 11 11:05:15 +1000 2009:
> On Fri, Apr 10, 2009 at 4:42 PM, Valentino Volonghi <dialtone at gmail.com> wrote:
> >> I'd rather not hack the kernel.
> >
> > That's not hacking the kernel... [...] Furthermore you
> > also might want to use ulimit to increase the number
> > of allowed fds per process and other parameters as
> > tony already suggested.
> 
> You're right, my knowledge of FD limits is apparently over a decade
> out of date. Last time I tried this you had to change a #define and
> rebuild everything.

I think it might more than a decade ;-)

rgh


> This removes a large objection I had to RabbitMQ.
> 
> Thanks!
> 
> Lawrence
> 



From matthias at lshift.net  Sat Apr 11 08:46:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 11 Apr 2009 08:46:12 +0100
Subject: [rabbitmq-discuss] Durable queues & bindings
In-Reply-To: <1239400527.14483.6.camel@localhost>
References: <1239224007.27376.9.camel@localhost>	<49DD1401.1040306@lshift.net>
	<1239226983.31701.1.camel@localhost>
	<1239400527.14483.6.camel@localhost>
Message-ID: <49E04AC4.7080805@lshift.net>

Levi,

Levi Greenspan wrote:
> I upgraded to version 1.5.4 and now I see the queues and bindings after
> the node is running again. However in 1.5.3 it didn't work for me.

I can't think of anything that has changed between 1.5.3 and 1.5.4 that 
would cause this, except that startup times for when there are lots of 
durable exchanges, queues or bindings have improved significantly. The 
recreation of these entities is now also happening incrementally. So 
it's possible that previously rabbitmqctl would not list any queues for 
you if it was called right after you started the broker - though it 
should have done so eventually - whereas now it does.

> Anyway I noticed another difference between 1.5.3 and 1.5.4 - the call
> to com.rabbitmq.client.Connection.getKnownHosts() in that Java client
> API returns the list of all running node addresses in 1.5.3, but only
> one host address in 1.5.4 - a bug?

Nothing has changed in that area of the code. Are you sure that all your 
nodes are running and listening?


Regards,

Matthias.



From vlm at lionet.info  Sat Apr 11 15:35:24 2009
From: vlm at lionet.info (Lev Walkin)
Date: Sat, 11 Apr 2009 07:35:24 -0700
Subject: [rabbitmq-discuss] Client API error recovery
Message-ID: <49E0AAAC.4050402@lionet.info>


Here I continue to check the Erlang Client library.

Suppose I want to establish a connection with a remote broker, and 
subscribe to some channel events. How do I ensure the broker is still 
there and have not actually disappeared?

Well, let's try stopping broker using `rabbitmqctl stop` and see what we 
can discover by monitoring the processes the Erlang way:

1> Connection = lib_amqp:start_connection("test-amq").
<0.33.0>
2> Channel = lib_amqp:start_channel(Connection).
<0.40.0>
3> {erlang:monitor(process, Connection), erlang:monitor(process, Channel)}.
{#Ref<0.0.0.41>,#Ref<0.0.0.42>}
4> R = fun() -> receive X -> X after 0 -> empty end end.
#Fun<erl_eval.20.67289768>
5> % Doing `rabbitmqctl stop` on the broker.
Broker forced connection: 320 -> <<"CONNECTION_FORCED - broker forced 
connection closure with reason 'shutdown'">>
Channel 1 is shutting down due to: normal
5> R().
{'DOWN',#Ref<0.0.0.41>,process,<0.33.0>,normal}
6> R().
{'DOWN',#Ref<0.0.0.42>,process,<0.40.0>,normal}
7> R().
empty
8>


So far so good: if the broker disappears, both Connection and Channel 
disappear as well. It seems I can just assume that if I receive a 'DOWN' 
message on a Connection, I must re-establish it.

But let's try doing a hard failure: killing the RabbitMQ beam using 
`killall beam` on the broker machine. This is a realistic failure scenario.

1> Connection = lib_amqp:start_connection("amq1").
<0.33.0>
2> Channel = lib_amqp:start_channel(Connection).
<0.40.0>
3> {erlang:monitor(process, Connection), erlang:monitor(process, Channel)}.
{#Ref<0.0.0.41>,#Ref<0.0.0.42>}
4> R = fun() -> receive X -> X after 0 -> empty end end.
#Fun<erl_eval.20.67289768>
5> % Doing `killall beam` on the broker.
Channel 1 is shutting down due to: normal
5> R().
{'DOWN',#Ref<0.0.0.42>,process,<0.40.0>,normal}
6> R().
empty
7> is_process_alive(Connection).
true
8>

You see, the channel is dead, but connection is still alive. What can we 
do with this connection? Can we start RabbitMQ, open a new Channel and 
see if it has reconnected automatically?

8> f(Channel).
ok
9> Channel = lib_amqp:start_channel(Connection).
Channel 1 is shutting down due to: {writer,send_failed,badarg}

=ERROR REPORT==== 11-Apr-2009::07:23:49 ===
** Generic server <0.33.0> terminating
** Last message in was {open_channel,none,<<>>}
** When Server state == {connection_state,"guest","guest","test-amq",
                             #Port<0.488>,<<"/">>,<0.37.0>,<0.38.0>,0,0,
                             amqp_network_driver,
                             {dict,0,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  []},
 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}}}
** Reason for termination ==
** {normal,{gen_server,call,[<0.50.0>,{call,{'channel.open',<<>>}}]}}
** exception exit: {{normal,
                         {gen_server,call,
                             [<0.50.0>,{call,{'channel.open',<<>>}}]}},
                     {gen_server,call,[<0.33.0>,{open_channel,none,<<>>}]}}
      in function  gen_server:call/2
10>

No, it hasn't. The Connection we have been holding to all this time has 
not been operational. It was alive, in Erlang process terms, but it is 
useless because we cannot use it. Moreover, we cannot discover that the 
connection is dead unless we try to use it.

But let's try using that non-operational Connection again and see how it 
behaves:

10> f(Channel), Channel = lib_amqp:start_channel(Connection).
** exception exit: {noproc,
 
{gen_server,call,[<0.33.0>,{open_channel,none,<<>>}]}}
      in function  gen_server:call/2
11> is_process_alive(Connection).
false
12>

Oh, it's dead! It didn't die at the time it received connection failure 
from the broker, it died when we tried to use it a considerable time later.

Let's see if RabbitMQ client library actually notices this hard failure, 
when no open channels are present:

	16> f(), Connection = lib_amqp:start_connection("test-amq").
	<0.66.0>
	17> erlang:monitor(process, Connection).
	#Ref<0.0.0.94>
	18> R = fun() -> receive X -> X after 0 -> empty end end. 

	#Fun<erl_eval.20.67289768>
	19> length(processes()).
	35
	20> % Killing the broker
	20> length(processes()).
	33
	21> R().
	empty
	22> is_process_alive(Connection).
	true
	23>

Yes, it does! But it does not die "in full".

I believe the right behavior for the Connection process is to die
right after receiving some network failure, avoid waiting in
non-operational state and not allowing the Erlang monitoring to take
care of network issues between the client and the broker.


-- 
Lev Walkin
vlm at lionet.info



From matthias at lshift.net  Sat Apr 11 17:10:44 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 11 Apr 2009 17:10:44 +0100
Subject: [rabbitmq-discuss] Client API error recovery
In-Reply-To: <49E0AAAC.4050402@lionet.info>
References: <49E0AAAC.4050402@lionet.info>
Message-ID: <49E0C104.5060404@lshift.net>

Lev,

Lev Walkin wrote:

> Let's see if RabbitMQ client library actually notices this hard failure, 
> when no open channels are present:
> 
> 	16> f(), Connection = lib_amqp:start_connection("test-amq").
> 	<0.66.0>
> 	17> erlang:monitor(process, Connection).
> 	#Ref<0.0.0.94>
> 	18> R = fun() -> receive X -> X after 0 -> empty end end. 
> 
> 	#Fun<erl_eval.20.67289768>
> 	19> length(processes()).
> 	35
> 	20> % Killing the broker
> 	20> length(processes()).
> 	33
> 	21> R().
> 	empty
> 	22> is_process_alive(Connection).
> 	true
> 	23>
> 
> Yes, it does! But it does not die "in full".

We did some work on the erlang client's error handling recently - I get 
the same result on the v1_5 branch, but on 'default' the above works 
fine for me, i.e. the final call returns 'false'.


Matthias.



From greenspan.levi at googlemail.com  Sat Apr 11 22:27:44 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Sat, 11 Apr 2009 23:27:44 +0200
Subject: [rabbitmq-discuss] Durable queues & bindings
In-Reply-To: <49E04AC4.7080805@lshift.net>
References: <1239224007.27376.9.camel@localhost>
	<49DD1401.1040306@lshift.net>  <1239226983.31701.1.camel@localhost>
	<1239400527.14483.6.camel@localhost>  <49E04AC4.7080805@lshift.net>
Message-ID: <1239485264.20272.18.camel@localhost>

Matthias,

On Sat, 2009-04-11 at 08:46 +0100, Matthias Radestock wrote:
> Levi,
> 
> Levi Greenspan wrote:
> > I upgraded to version 1.5.4 and now I see the queues and bindings after
> > the node is running again. However in 1.5.3 it didn't work for me.
> 
> I can't think of anything that has changed between 1.5.3 and 1.5.4 that 
> would cause this, except that startup times for when there are lots of 
> durable exchanges, queues or bindings have improved significantly. The 
> recreation of these entities is now also happening incrementally. So 
> it's possible that previously rabbitmqctl would not list any queues for 
> you if it was called right after you started the broker - though it 
> should have done so eventually - whereas now it does.


I have attached a small Java test client and a transcript which shows
the different behavior between version 1.5.3 and 1.5.4. Maybe you can
reproduce it.

> > Anyway I noticed another difference between 1.5.3 and 1.5.4 - the call
> > to com.rabbitmq.client.Connection.getKnownHosts() in that Java client
> > API returns the list of all running node addresses in 1.5.3, but only
> > one host address in 1.5.4 - a bug?
> 
> Nothing has changed in that area of the code. Are you sure that all your 
> nodes are running and listening?

Yes, I am. The test client prints the known hosts and for 1.5.3 the
reult is "localhost:5672", whereas for 1.5.4 it is "localhost:5673" and
"localhost:5672". Again I hope you can reproduce it with the attached
client. I am using Ubuntu 8.10 on x86 and I compiled erlang using the
offically released source, not the Ubuntu packages.

$ erl -version
Erlang (SMP,ASYNC_THREADS,HIPE) (BEAM) emulator version 5.6.5

Many thanks again,
Levi

-------------- next part --------------
A non-text attachment was scrubbed...
Name: Test.java
Type: text/x-java
Size: 1094 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090411/28c5dc16/attachment.java 
-------------- next part --------------
user at host ~ $ cd rabbitmq-server-1.5.3/
user at host ~/rabbitmq-server-1.5.3 $ scripts/rabbitmq-multi start_all 2
Starting all nodes...
Starting node rabbit at localhost...
RabbitMQ 1.5.3 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http:/www.rabbitmq.com/

Logging to "/opt/logs/rabbitmq/rabbit.log"
SASL logging to "/opt/logs/rabbitmq/rabbit-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done

broker running
OK
Starting node rabbit_1 at localhost...
RabbitMQ 1.5.3 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http:/www.rabbitmq.com/

Logging to "/opt/logs/rabbitmq/rabbit_1.log"
SASL logging to "/opt/logs/rabbitmq/rabbit_1-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done

broker running
OK
done.
user at host ~/rabbitmq-server-1.5.3 $ scripts/rabbitmqctl list_bindings
Listing bindings ...
...done.


    >>> Now I executed the test client in another shell. <<<


user at host ~/rabbitmq-server-1.5.3 $ scripts/rabbitmqctl list_bindings
Listing bindings ...
	my-queue	my-queue	[]
my-exchange	my-queue	my-key	[]
...done.
user at host ~/rabbitmq-server-1.5.3 $ scripts/rabbitmqctl stop
Stopping and halting node rabbit at localhost ...
Erlang has closed
...done.
user at host ~/rabbitmq-server-1.5.3 $ scripts/rabbitmq-server -detached
user at host ~/rabbitmq-server-1.5.3 $ scripts/rabbitmqctl list_bindings
Listing bindings ...
...done.
user at host ~/rabbitmq-server-1.5.3 $ scripts/rabbitmqctl list_bindings
Listing bindings ...
...done.
user at host ~/rabbitmq-server-1.5.3 $ scripts/rabbitmq-multi stop_all
Stopping all nodes...
Stopping node rabbit_1 at localhost
Erlang has closed
....OK
Stopping node rabbit at localhost
.OK
done.
user at host ~/rabbitmq-server-1.5.3 $ cd ../rabbitmq-server-1.5.4/


    >>> Deleted mnesia files to start from scratch. <<<


user at host ~/rabbitmq-server-1.5.4 $ scripts/rabbitmq-multi start_all 2
Starting all nodes...
Starting node rabbit at localhost...
RabbitMQ 1.5.4 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http:/www.rabbitmq.com/

Logging to "/opt/logs/rabbitmq/rabbit.log"
SASL logging to "/opt/logs/rabbitmq/rabbit-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done

broker running
OK
Starting node rabbit_1 at localhost...
RabbitMQ 1.5.4 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http:/www.rabbitmq.com/

Logging to "/opt/logs/rabbitmq/rabbit_1.log"
SASL logging to "/opt/logs/rabbitmq/rabbit_1-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done

broker running
OK
done.
user at host ~/rabbitmq-server-1.5.4 $ scripts/rabbitmqctl list_bindings
Listing bindings ...
...done.


    >>> Now I executed the test client in another shell. <<<


user at host ~/rabbitmq-server-1.5.4 $ scripts/rabbitmqctl list_bindings
Listing bindings ...
	my-queue	my-queue	[]
my-exchange	my-queue	my-key	[]
...done.
user at host ~/rabbitmq-server-1.5.4 $ scripts/rabbitmqctl stop
Stopping and halting node rabbit at localhost ...
...done.
Erlang has closed
user at host ~/rabbitmq-server-1.5.4 $ scripts/rabbitmq-server -detached
user at host ~/rabbitmq-server-1.5.4 $ scripts/rabbitmqctl list_bindings
Listing bindings ...
	my-queue	my-queue	[]
my-exchange	my-queue	my-key	[]
...done.
user at host ~/rabbitmq-server-1.5.4 $

From matthias at lshift.net  Sun Apr 12 00:32:53 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 12 Apr 2009 00:32:53 +0100
Subject: [rabbitmq-discuss] Durable queues & bindings
In-Reply-To: <1239485264.20272.18.camel@localhost>
References: <1239224007.27376.9.camel@localhost>	<49DD1401.1040306@lshift.net>
	<1239226983.31701.1.camel@localhost>	<1239400527.14483.6.camel@localhost>
	<49E04AC4.7080805@lshift.net> <1239485264.20272.18.camel@localhost>
Message-ID: <49E128A5.5010001@lshift.net>

Levi,

Levi Greenspan wrote:
> On Sat, 2009-04-11 at 08:46 +0100, Matthias Radestock wrote:
>> Levi,
>>
>> Levi Greenspan wrote:
>>> I upgraded to version 1.5.4 and now I see the queues and bindings after
>>> the node is running again. However in 1.5.3 it didn't work for me.
>> I can't think of anything that has changed between 1.5.3 and 1.5.4 that 
>> would cause this, except that startup times for when there are lots of 
>> durable exchanges, queues or bindings have improved significantly. The 
>> recreation of these entities is now also happening incrementally. So 
>> it's possible that previously rabbitmqctl would not list any queues for 
>> you if it was called right after you started the broker - though it 
>> should have done so eventually - whereas now it does.
> 
> 
> I have attached a small Java test client and a transcript which shows
> the different behavior between version 1.5.3 and 1.5.4. Maybe you can
> reproduce it.

What user did you run these as? Looks like 'user', based on the 
transcript. But usually only the 'rabbitmq' user can write to 
/var/log/rabbitmq etc, which would cause the script invocations to fail.

Did you make any adjustments to the permissions, or set some env vars to 
adjust the paths, or tweak the scripts?

Also, did you try running these tests when no clustering has been 
configured and you have just a single node?

>>> Anyway I noticed another difference between 1.5.3 and 1.5.4 - the call
>>> to com.rabbitmq.client.Connection.getKnownHosts() in that Java client
>>> API returns the list of all running node addresses in 1.5.3, but only
>>> one host address in 1.5.4 - a bug?
>> Nothing has changed in that area of the code. Are you sure that all your 
>> nodes are running and listening?
> 
> Yes, I am. The test client prints the known hosts and for 1.5.3 the
> reult is "localhost:5672", whereas for 1.5.4 it is "localhost:5673" and
> "localhost:5672". Again I hope you can reproduce it with the attached
> client. I am using Ubuntu 8.10 on x86 and I compiled erlang using the
> offically released source, not the Ubuntu packages.

So is it 1.5.3 that returns both hosts (which is what you said 
originally) or 1.5.4?

And how did you configure the clustering?


Regards,

Matthias.



From greenspan.levi at googlemail.com  Sun Apr 12 14:00:21 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Sun, 12 Apr 2009 15:00:21 +0200
Subject: [rabbitmq-discuss] Durable queues & bindings
In-Reply-To: <49E128A5.5010001@lshift.net>
References: <1239224007.27376.9.camel@localhost>
	<49DD1401.1040306@lshift.net>  <1239226983.31701.1.camel@localhost>
	<1239400527.14483.6.camel@localhost>  <49E04AC4.7080805@lshift.net>
	<1239485264.20272.18.camel@localhost>  <49E128A5.5010001@lshift.net>
Message-ID: <1239541221.6519.106.camel@localhost>

On Sun, 2009-04-12 at 00:32 +0100, Matthias Radestock wrote:
> What user did you run these as? Looks like 'user', based on the 
> transcript. But usually only the 'rabbitmq' user can write to 
> /var/log/rabbitmq etc, which would cause the script invocations to fail.
> 
> Did you make any adjustments to the permissions, or set some env vars to 
> adjust the paths, or tweak the scripts?

I have the following settings in /etc/rabbitmq/rabbitmq.conf

RABBITMQ_NODE_IP_ADDRESS=127.0.0.1
RABBITMQ_LOG_BASE=/opt/logs/rabbitmq
RABBITMQ_MNESIA_BASE=/opt/otp/mnesia
RABBITMQ_PIDS_FILE=/opt/otp/pids

and in /etc/rabbitmq/rabbitmq_cluster.conf:

[rabbit at localhost].

"user" has read & write permissions to these directories.

> Also, did you try running these tests when no clustering has been 
> configured and you have just a single node?

I just did and with only one node everything is fine with both versions.

> >>> Anyway I noticed another difference between 1.5.3 and 1.5.4 - the call
> >>> to com.rabbitmq.client.Connection.getKnownHosts() in that Java client
> >>> API returns the list of all running node addresses in 1.5.3, but only
> >>> one host address in 1.5.4 - a bug?
> >> Nothing has changed in that area of the code. Are you sure that all your 
> >> nodes are running and listening?
> > 
> > Yes, I am. The test client prints the known hosts and for 1.5.3 the
> > reult is "localhost:5672", whereas for 1.5.4 it is "localhost:5673" and
> > "localhost:5672". Again I hope you can reproduce it with the attached
> > client. I am using Ubuntu 8.10 on x86 and I compiled erlang using the
> > offically released source, not the Ubuntu packages.
> 
> So is it 1.5.3 that returns both hosts (which is what you said 
> originally) or 1.5.4?

Sorry. Screwed versions. 1.5.3 returns both and 1.5.4 only one.

> 
> And how did you configure the clustering?

Following http://www.rabbitmq.com/clustering.html#single-machine I just
put "[rabbit at localhost]." into /etc/rabbitmq_cluster.conf

Thanks,
Levi




From mark.geib at echostar.com  Mon Apr 13 18:47:58 2009
From: mark.geib at echostar.com (Mark Geib)
Date: Mon, 13 Apr 2009 11:47:58 -0600
Subject: [rabbitmq-discuss] RabbitMq will not start on debian-lenney,
	bare bones install
Message-ID: <49E37ACE.6020402@echostar.com>

I have rabbitmq, latest version, installed and running on debian-lenney 
desktop install. I am now trying to do the same with debian-lenney bare 
bones install, i.e. like server. However, rabbitmq fails to start with 
the following in the error logs.

(starup_err)
Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) 
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
Error: {node_start_failed,normal}

(startup_log)
Starting all nodes...
Starting node rabbit at che-sasscb01...
{error_logger,{{2009,4,13},{11,18,13}},"Protocol: ~p: register error: 
~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}
{error_logger,{{2009,4,13},{11,18,13}},crash_report,[[{pid,<0.22.0>},{registered_name,net_kernel},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p,5}]}},{initial_call,{gen,init_it,[gen_server,<0.19.0>,<0.19.0>,{local,net_kernel},net_kernel,{rabbit,shortnames,15000},[]]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.8>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,23},{reductions,490}],[]]}
{error_logger,{{2009,4,13},{11,18,13}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2009,4,13},{11,18,13}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2009,4,13},{11,18,13}},crash_report,[[{pid,<0.8.0>},{registered_name,[]},{error_info,{exit,{shutdown,{kernel,start,[normal,[]]}},[{application_master,init,4},{proc_lib,init_p,5}]}},{initial_call,{application_master,init,[<0.6.0>,<0.7.0>,{appl_data,kernel,[application_controller,erl_reply,auth,boot_server,code_server,disk_log_server,disk_log_sup,erl_prim_loader,error_logger,file_server_2,fixtable_server,global_group,global_name_server,heart,init,kernel_config,kernel_sup,net_kernel,net_sup,rex,user,os_server,ddll_server,erl_epmd,inet_db,pg2],undefined,{kernel,[]},[application,application_controller,application_master,application_starter,auth,code,code_aux,packages,code_server,dist_util,erl_boot_server,erl_distribution,erl_prim_loader,erl_reply,erlang,error_handler,error_logger,file,file_server,file_io_server,prim_file,global,global_group,global_search,group,heart,hipe_unified_loader,inet6_tcp,inet6_tcp_dist,inet6_udp,inet_config,inet_hosts,inet_gethost_native,in
et_tcp_dist,init,kernel,kernel_config,net,net_adm,net_kernel,os,ram_file,rpc,user,user_drv,user_sup,disk_log,disk_log_1,disk_log_server,disk_log_sup,dist_ac,erl_ddll,erl_epmd,erts_debug,gen_tcp,gen_udp,gen_sctp,prim_inet,inet,inet_db,inet_dns,inet_parse,inet_res,inet_tcp,inet_udp,inet_sctp,pg2,seq_trace,wrap_log_reader,zlib,otp_ring0],[],infinity,infinity},normal]}},{ancestors,[<0.7.0>]},{messages,[{'EXIT',<0.9.0>,normal}]},{links,[<0.7.0>,<0.6.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,23},{reductions,127}],[]]}
{error_logger,{{2009,4,13},{11,18,13}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid 
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

any ideas on the issue.??

thanks,
Mark.

-- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215




From reverri at gmail.com  Mon Apr 13 19:20:00 2009
From: reverri at gmail.com (Dan Reverri)
Date: Mon, 13 Apr 2009 11:20:00 -0700
Subject: [rabbitmq-discuss] RabbitMq will not start on debian-lenney,
	bare 	bones install
In-Reply-To: <49E37ACE.6020402@echostar.com>
References: <49E37ACE.6020402@echostar.com>
Message-ID: <e04d73f80904131120t39f178b1id5bd20ae04fbcd0b@mail.gmail.com>

Hi Mark,

I get that error when a rabbitmq-server node is already running on the
machine. Can you try running:
sudo rabbitmqctl status



On Mon, Apr 13, 2009 at 10:47 AM, Mark Geib <mark.geib at echostar.com> wrote:
> I have rabbitmq, latest version, installed and running on debian-lenney
> desktop install. I am now trying to do the same with debian-lenney bare
> bones install, i.e. like server. However, rabbitmq fails to start with
> the following in the error logs.
>
> (starup_err)
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> Error: {node_start_failed,normal}
>
> (startup_log)
> Starting all nodes...
> Starting node rabbit at che-sasscb01...
> {error_logger,{{2009,4,13},{11,18,13}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,duplicate_name}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]}]}
> {error_logger,{{2009,4,13},{11,18,13}},crash_report,[[{pid,<0.22.0>},{registered_name,net_kernel},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p,5}]}},{initial_call,{gen,init_it,[gen_server,<0.19.0>,<0.19.0>,{local,net_kernel},net_kernel,{rabbit,shortnames,15000},[]]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.8>,<0.19.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,23},{reductions,490}],[]]}
> {error_logger,{{2009,4,13},{11,18,13}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbit,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
> {error_logger,{{2009,4,13},{11,18,13}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
> {error_logger,{{2009,4,13},{11,18,13}},crash_report,[[{pid,<0.8.0>},{registered_name,[]},{error_info,{exit,{shutdown,{kernel,start,[normal,[]]}},[{application_master,init,4},{proc_lib,init_p,5}]}},{initial_call,{application_master,init,[<0.6.0>,<0.7.0>,{appl_data,kernel,[application_controller,erl_reply,auth,boot_server,code_server,disk_log_server,disk_log_sup,erl_prim_loader,error_logger,file_server_2,fixtable_server,global_group,global_name_server,heart,init,kernel_config,kernel_sup,net_kernel,net_sup,rex,user,os_server,ddll_server,erl_epmd,inet_db,pg2],undefined,{kernel,[]},[application,application_controller,application_master,application_starter,auth,code,code_aux,packages,code_server,dist_util,erl_boot_server,erl_distribution,erl_prim_loader,erl_reply,erlang,error_handler,error_logger,file,file_server,file_io_server,prim_file,global,global_group,global_search,group,heart,hipe_unified_loader,inet6_tcp,inet6_tcp_dist,inet6_udp,inet_config,inet_hosts,inet_gethost_native,in
> et_tcp_dist,init,kernel,kernel_config,net,net_adm,net_kernel,os,ram_file,rpc,user,user_drv,user_sup,disk_log,disk_log_1,disk_log_server,disk_log_sup,dist_ac,erl_ddll,erl_epmd,erts_debug,gen_tcp,gen_udp,gen_sctp,prim_inet,inet,inet_db,inet_dns,inet_parse,inet_res,inet_tcp,inet_udp,inet_sctp,pg2,seq_trace,wrap_log_reader,zlib,otp_ring0],[],infinity,infinity},normal]}},{ancestors,[<0.7.0>]},{messages,[{'EXIT',<0.9.0>,normal}]},{links,[<0.7.0>,<0.6.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,23},{reductions,127}],[]]}
> {error_logger,{{2009,4,13},{11,18,13}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>
> any ideas on the issue.??
>
> thanks,
> Mark.
>
> --
> Principal Engineer
> Cheyenne Software Engineering
> mark.geib at echostar.com / 35-215
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From theczintheroc2007 at gmail.com  Mon Apr 13 21:42:56 2009
From: theczintheroc2007 at gmail.com (Colin Z)
Date: Mon, 13 Apr 2009 16:42:56 -0400
Subject: [rabbitmq-discuss] RabbitMQ local consumer and producer
Message-ID: <ce47f6b80904131342h6fbf2142y10ae9acca6ee6aec@mail.gmail.com>

Sorry I'm very new to RabbitMQ and enterprise messaging as a whole. I'm
wondering if it's possible (or even a good idea) to have consumers and
producers reside locally within a single Erlang node, or an Erlang cluster.

Looking at what RabbitMQ offers, it seems like a great fit for MMO-type
applications. I'm not so much interested in passing messages to human
clients across the net as I am in using Rabbit for communication between
server-side game entities.

While I could just pass regular Erlang messages between processes, Rabbit
seems much more robust.

While some of the durability features of Rabbit would be great for game
features like auction houses or mailboxes, the channels and fast
point-to-point communication seem like a great fit for things like AI. I'm
imagining an architecture where game entities can subscribe to certain MQ
channels to be made aware of arbitrary things like collisions, combat
events, AI triggers, etc. Is this something Rabbit could support, or is it
way off base?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090413/87e0692d/attachment.htm 

From matthias at lshift.net  Tue Apr 14 09:09:28 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 14 Apr 2009 09:09:28 +0100
Subject: [rabbitmq-discuss] channel.flow
In-Reply-To: <e1c05edd0904101641k1e3f8674w53d917cc1ceaf66a@mail.gmail.com>
References: <09140E75-7FE2-4766-8EC0-75ED2E0683D2@geni.com>	<49DE5314.2090902@lshift.net>	<DE603F0D-36E1-4026-BC30-37488A977035@geni.com>
	<e1c05edd0904101641k1e3f8674w53d917cc1ceaf66a@mail.gmail.com>
Message-ID: <49E444B8.6080700@lshift.net>

Aman,

Aman Gupta wrote:
> Yep, I never knew this existed and my library does not implement it.

It shouldn't be hard to add support for channel.flow to your lib. I'd be 
happy to answer any questions on how it should work.


Matthias.



From alexis.richardson at gmail.com  Tue Apr 14 11:48:41 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 14 Apr 2009 11:48:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ local consumer and producer
In-Reply-To: <ce47f6b80904131342h6fbf2142y10ae9acca6ee6aec@mail.gmail.com>
References: <ce47f6b80904131342h6fbf2142y10ae9acca6ee6aec@mail.gmail.com>
Message-ID: <167204d20904140348w5219e545le9e9629f39e80a76@mail.gmail.com>

Colin,

On Mon, Apr 13, 2009 at 9:42 PM, Colin Z <theczintheroc2007 at gmail.com> wrote:
> Sorry I'm very new to RabbitMQ and enterprise messaging as a whole.

No problem!  This is a very open community consisting of all sorts of
messaging users, not just those in the enterprise.

> I'm
> wondering if it's possible (or even a good idea) to have consumers and
> producers reside locally within a single Erlang node, or an Erlang cluster.

It is a good idea and it is possible.  Take a look at Ben Hood's
"shovel" project to see an example use case.  This uses the RabbitMQ
erlang client in "embedded" mode to create a relay system - a step
towards federation.

http://hopper.squarespace.com/blog/2008/6/22/introducing-shovel-an-amqp-relay.html

Benefits of this approach might include:

* Latency reduction for multi-hop Rabbits
* Algorithmic routing by embedding logic in the broker
* Lower costs of management


> Looking at what RabbitMQ offers, it seems like a great fit for MMO-type
> applications. I'm not so much interested in passing messages to human
> clients across the net as I am in using Rabbit for communication between
> server-side game entities.

Very cool!

At least two production users of RabbitMQ are providers of MMOs.  They
may be tempted to pipe up on this list if you ask questions ;-)


> While I could just pass regular Erlang messages between processes, Rabbit
> seems much more robust.

Thank-you.  RabbitMQ benefits from semantics that includes routing and
queues, so that for example persistence can be introduced, as you
imply below.


> While some of the durability features of Rabbit would be great for game
> features like auction houses or mailboxes, the channels and fast
> point-to-point communication seem like a great fit for things like AI. I'm
> imagining an architecture where game entities can subscribe to certain MQ
> channels to be made aware of arbitrary things like collisions, combat
> events, AI triggers, etc. Is this something Rabbit could support, or is it
> way off base?

These are all excellent use cases for RabbitMQ.

Please feel free to bounce ideas off the list - people may take a
nibble at them.

alexis



> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Tue Apr 14 11:52:42 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 14 Apr 2009 11:52:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ local consumer and producer
In-Reply-To: <167204d20904140348w5219e545le9e9629f39e80a76@mail.gmail.com>
References: <ce47f6b80904131342h6fbf2142y10ae9acca6ee6aec@mail.gmail.com>
	<167204d20904140348w5219e545le9e9629f39e80a76@mail.gmail.com>
Message-ID: <167204d20904140352p7cee9cd2h1c2dcc723f3d08ed@mail.gmail.com>

Colin

Incidentally... "SMASH - MMO Engine in Erlang" --
http://sunweaver.blogspot.com/2009/04/auto-config-baby-steps.html

a


On Tue, Apr 14, 2009 at 11:48 AM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> Colin,
>
> On Mon, Apr 13, 2009 at 9:42 PM, Colin Z <theczintheroc2007 at gmail.com> wrote:
>> Sorry I'm very new to RabbitMQ and enterprise messaging as a whole.
>
> No problem! ?This is a very open community consisting of all sorts of
> messaging users, not just those in the enterprise.
>
>> I'm
>> wondering if it's possible (or even a good idea) to have consumers and
>> producers reside locally within a single Erlang node, or an Erlang cluster.
>
> It is a good idea and it is possible. ?Take a look at Ben Hood's
> "shovel" project to see an example use case. ?This uses the RabbitMQ
> erlang client in "embedded" mode to create a relay system - a step
> towards federation.
>
> http://hopper.squarespace.com/blog/2008/6/22/introducing-shovel-an-amqp-relay.html
>
> Benefits of this approach might include:
>
> * Latency reduction for multi-hop Rabbits
> * Algorithmic routing by embedding logic in the broker
> * Lower costs of management
>
>
>> Looking at what RabbitMQ offers, it seems like a great fit for MMO-type
>> applications. I'm not so much interested in passing messages to human
>> clients across the net as I am in using Rabbit for communication between
>> server-side game entities.
>
> Very cool!
>
> At least two production users of RabbitMQ are providers of MMOs. ?They
> may be tempted to pipe up on this list if you ask questions ;-)
>
>
>> While I could just pass regular Erlang messages between processes, Rabbit
>> seems much more robust.
>
> Thank-you. ?RabbitMQ benefits from semantics that includes routing and
> queues, so that for example persistence can be introduced, as you
> imply below.
>
>
>> While some of the durability features of Rabbit would be great for game
>> features like auction houses or mailboxes, the channels and fast
>> point-to-point communication seem like a great fit for things like AI. I'm
>> imagining an architecture where game entities can subscribe to certain MQ
>> channels to be made aware of arbitrary things like collisions, combat
>> events, AI triggers, etc. Is this something Rabbit could support, or is it
>> way off base?
>
> These are all excellent use cases for RabbitMQ.
>
> Please feel free to bounce ideas off the list - people may take a
> nibble at them.
>
> alexis
>
>
>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>



From matthias at lshift.net  Tue Apr 14 16:31:03 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 14 Apr 2009 16:31:03 +0100
Subject: [rabbitmq-discuss] Durable queues & bindings
In-Reply-To: <1239541221.6519.106.camel@localhost>
References: <1239224007.27376.9.camel@localhost>	<49DD1401.1040306@lshift.net>
	<1239226983.31701.1.camel@localhost>	<1239400527.14483.6.camel@localhost>
	<49E04AC4.7080805@lshift.net>	<1239485264.20272.18.camel@localhost>
	<49E128A5.5010001@lshift.net> <1239541221.6519.106.camel@localhost>
Message-ID: <49E4AC37.9080703@lshift.net>

Levi,

Levi Greenspan wrote:
> I have the following settings in /etc/rabbitmq/rabbitmq.conf
> 
> RABBITMQ_NODE_IP_ADDRESS=127.0.0.1
> RABBITMQ_LOG_BASE=/opt/logs/rabbitmq
> RABBITMQ_MNESIA_BASE=/opt/otp/mnesia
> RABBITMQ_PIDS_FILE=/opt/otp/pids
> 
> and in /etc/rabbitmq/rabbitmq_cluster.conf:
> 
> [rabbit at localhost].

The default location of the cluster config file is 
/etc/rabbitmq/cluster.config. The docs say 
/etc/rabbitmq/rabbitmq_cluster.config, which is wrong.

Did you change that setting to point to /etc/rabbitmq/rabbitmq_cluster.conf?

If not that would explain why getKnownHosts returns one node only, 
though it doesn't explain why it would only do that for 1.5.4 and not 
1.5.3. Perhaps your config changed?

To check whether the clustering is set up correctly, run "rabbitmqctl 
status". That should show both nodes as running.

>>> I upgraded to version 1.5.4 and now I see the queues and bindings after
>>> > > the node is running again. However in 1.5.3 it didn't work for me.
> [...]
> I have attached a small Java test client and a transcript which shows
> the different behavior between version 1.5.3 and 1.5.4. Maybe you can
> reproduce it.

I can indeed reproduce your findings: bindings to durable queues 
residing on nodes in a cluster are not restored when the queues' nodes 
restart. Thanks for reporting this; I have filed a bug.

This happens for me in both 1.5.3 and 1.5.4; the reason that it works 
for you in 1.5.4 is probably the same reason that getKnownHosts returns 
just one node, namely that the clustering was not set up correctly when 
you ran that test.


Regards,

Matthias.



From matthias at lshift.net  Tue Apr 14 17:14:02 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 14 Apr 2009 17:14:02 +0100
Subject: [rabbitmq-discuss] Durable queues & bindings
In-Reply-To: <49E4AC37.9080703@lshift.net>
References: <1239224007.27376.9.camel@localhost>	<49DD1401.1040306@lshift.net>
	<1239226983.31701.1.camel@localhost>	<1239400527.14483.6.camel@localhost>
	<49E04AC4.7080805@lshift.net>	<1239485264.20272.18.camel@localhost>
	<49E128A5.5010001@lshift.net> <1239541221.6519.106.camel@localhost>
	<49E4AC37.9080703@lshift.net>
Message-ID: <49E4B64A.5050406@lshift.net>

Levi,

Matthias Radestock wrote:
> The default location of the cluster config file is 
> /etc/rabbitmq/cluster.config. The docs say 
> /etc/rabbitmq/rabbitmq_cluster.config, which is wrong.
> 
> Did you change that setting to point to 
> /etc/rabbitmq/rabbitmq_cluster.conf?
> 
> If not that would explain why getKnownHosts returns one node only, 
> though it doesn't explain why it would only do that for 1.5.4 and not 
> 1.5.3. Perhaps your config changed?

Mystery solved. The default location of the cluster config is *supposed* 
to be /etc/rabbitmq/rabbitmq_cluster.config; and indeed that's what it 
was until we inadvertently changed it in 1.5.4.

Oops. Bug filed and fixed on the bug20593 branch. Until that fix has 
been qa'ed and released, please either correct the setting in the 
rabbitmq-server script, set the RABBITMQ_CLUSTER_CONFIG_FILE env var, or 
create a symlink from the broken location to the correct one.


Regards,

Matthias.



From EGustavson at rotohog.com  Tue Apr 14 21:37:58 2009
From: EGustavson at rotohog.com (Erik Gustavson)
Date: Tue, 14 Apr 2009 13:37:58 -0700
Subject: [rabbitmq-discuss] Strange behavior found under Mac OS X
Message-ID: <C60A4236.17552%egustavson@rotohog.com>

I found this thread while researching a local problem with RabbitMQ under MacOS:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-November/002518.html

The solution of commenting of changing "start_cpu_sup" to "false" in scripts/rabbitmq-server works for me.

This seems to be happening for me because I'm using macports GNU version of uptime instead of the installed mac version:

~ # which uptime
/opt/local/bin/uptime

~ # /opt/local/bin/uptime
 12:59pm  up 4 days  4:20,  7 users,  load average: 0.27, 0.35, 0.33

~ # /opt/local/bin/uptime --version
uptime (GNU coreutils) 6.12
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Joseph Arceneaux, David MacKenzie, and Kaveh Ghazi.

~ # /usr/bin/uptime
12:59  up 4 days,  4:21, 7 users, load averages: 0.25 0.34 0.33
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090414/1e9ab83b/attachment.htm 

From greenspan.levi at googlemail.com  Tue Apr 14 23:16:56 2009
From: greenspan.levi at googlemail.com (Levi Greenspan)
Date: Wed, 15 Apr 2009 00:16:56 +0200
Subject: [rabbitmq-discuss] Durable queues & bindings
In-Reply-To: <49E4B64A.5050406@lshift.net>
References: <1239224007.27376.9.camel@localhost>
	<49DD1401.1040306@lshift.net>  <1239226983.31701.1.camel@localhost>
	<1239400527.14483.6.camel@localhost>  <49E04AC4.7080805@lshift.net>
	<1239485264.20272.18.camel@localhost>  <49E128A5.5010001@lshift.net>
	<1239541221.6519.106.camel@localhost> <49E4AC37.9080703@lshift.net>
	<49E4B64A.5050406@lshift.net>
Message-ID: <1239747416.27435.1.camel@localhost>

On Tue, 2009-04-14 at 17:14 +0100, Matthias Radestock wrote:
> Mystery solved. The default location of the cluster config is *supposed* 
> to be /etc/rabbitmq/rabbitmq_cluster.config; and indeed that's what it 
> was until we inadvertently changed it in 1.5.4.
> 
> Oops. Bug filed and fixed on the bug20593 branch. Until that fix has 
> been qa'ed and released, please either correct the setting in the 
> rabbitmq-server script, set the RABBITMQ_CLUSTER_CONFIG_FILE env var, or 
> create a symlink from the broken location to the correct one.

Hi Matthias,

Many thanks! I created the symlink and everything works fine.

Cheers,
Levi





From has.sox at gmail.com  Wed Apr 15 05:51:12 2009
From: has.sox at gmail.com (Daniel N)
Date: Wed, 15 Apr 2009 14:51:12 +1000
Subject: [rabbitmq-discuss] Clustering Off LAN isn't working
Message-ID: <2fff50390904142151w7f4b694agcdb94dbabe8191f0@mail.gmail.com>

Hi

I've setup a cluster on my LAN (finally) and got it working by modifying the
startup script for rabbitmq-server (yuk) to set the cookie.  Then setup
/etc/rabbitmq/rabbitmq.conf to set the cookie:

CTL_ERL_ARGS="-setcookie mycookie"

On the lan:

$ sudo rabbitmqctl -n rabbit at ubi status
Status of node rabbit at ubi ...
[{running_applications,[{rabbit,"RabbitMQ","1.5.4"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.3"},
                        {os_mon,"CPO  CXC 138 46","2.1.6"},
                        {sasl,"SASL  CXC 138 11","2.1.5.3"},
                        {stdlib,"ERTS  CXC 138 10","1.15.3"},
                        {kernel,"ERTS  CXC 138 10","2.12.3"}]},
 {nodes,[rabbit at ubi,rabbit at hassox]},
 {running_nodes,[rabbit at ubi]}]
...done.

Over the Interwebs:

$ sudo rabbitmqctl -n rabbit at ubinet status
Status of node rabbit at ubinet ...
{badrpc,nodedown}
...done.

Where ubinet is setup in my hosts file.  If I use a full IP address:

 $ sudo rabbitmqctl -n rabbit at 123.456.789.123 status
Status of node 'rabbit at 123.456.789.123' ...

=ERROR REPORT==== 15-Apr-2009::14:50:00 ===
** System NOT running to use fully qualified hostnames **
** Hostname 123.456.789.123 is illegal **
{badrpc,nodedown}
...done.

IP addy changed...

Any idea on why this would cause an issue?  I can't find any documentation
on it on the rabbit site at all :(

Cheers
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090415/220815fe/attachment.htm 

From kdr2 at x-macro.com  Wed Apr 15 07:29:43 2009
From: kdr2 at x-macro.com (KDr2)
Date: Wed, 15 Apr 2009 14:29:43 +0800
Subject: [rabbitmq-discuss] The Message Selector
Message-ID: <efc790a30904142329p114c8d37r3a31d2d68e6cdaf7@mail.gmail.com>

I just made some extension for RabbitMQ, It is about Message Selector and
Dead Message,
maybe someone need it, here it is:

http://x-macro.com/products/carrot


-- 
Best Regards,
   -- KDr2, at x-macro.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090415/00c19665/attachment.htm 

From matthias at lshift.net  Wed Apr 15 07:51:29 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 15 Apr 2009 07:51:29 +0100
Subject: [rabbitmq-discuss] channel.flow
In-Reply-To: <C2B7DA46-F170-4EA0-A58A-9BA47BE53F47@geni.com>
References: <09140E75-7FE2-4766-8EC0-75ED2E0683D2@geni.com>	<49DE5314.2090902@lshift.net>	<DE603F0D-36E1-4026-BC30-37488A977035@geni.com>	<e1c05edd0904101641k1e3f8674w53d917cc1ceaf66a@mail.gmail.com>	<49E444B8.6080700@lshift.net>
	<C2B7DA46-F170-4EA0-A58A-9BA47BE53F47@geni.com>
Message-ID: <49E583F1.3040405@lshift.net>

Amos,

Amos Elliston wrote:
> On Apr 14, 2009, at 1:09 AM, Matthias Radestock wrote:
>> It shouldn't be hard to add support for channel.flow to your lib. I'd 
>> be happy to answer any questions on how it should work.
>
> i was going to add it to mine. do you know of a good way to test 
> channel.flow. can i force rabbit to send it?

At the rabbit erlang prompt, evaluate
   memsup:set_sysmem_high_watermark(0.01).
to lower the memory threshold. You should see a message
   alarm_handler: {set,{system_memory_high_watermark,[]}}
appear in the rabbit.log.

To raise the threshold again, evaluate
   memsup:set_sysmem_high_watermark(0.95).
at which point you should see
   alarm_handler: {clear,system_memory_high_watermark}
in the logs.


Matthias.



From matthias at lshift.net  Wed Apr 15 08:28:18 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 15 Apr 2009 08:28:18 +0100
Subject: [rabbitmq-discuss] Clustering Off LAN isn't working
In-Reply-To: <2fff50390904142151w7f4b694agcdb94dbabe8191f0@mail.gmail.com>
References: <2fff50390904142151w7f4b694agcdb94dbabe8191f0@mail.gmail.com>
Message-ID: <49E58C92.4060007@lshift.net>

Daniel,

Daniel N wrote:
> I've setup a cluster on my LAN (finally) and got it working by modifying 
> the startup script for rabbitmq-server (yuk) to set the cookie.

You don't have to modify the startup script. Just put
   SERVER_ERL_ARGS="${SERVER_ERL_ARGS} -setcookie mycookie"
in rabbitmq.conf.

> Then setup /etc/rabbitmq/rabbitmq.conf to set the cookie:
> 
> CTL_ERL_ARGS="-setcookie mycookie"
> 
> [...]
> 
> Over the Interwebs:
> 
> $ sudo rabbitmqctl -n rabbit at ubinet status
> Status of node rabbit at ubinet ...
> {badrpc,nodedown}
> ...done.
> 
> Where ubinet is setup in my hosts file.
>
> If I use a full IP address:
>  $ sudo rabbitmqctl -n rabbit at 123.456.789.123 status
> Status of node 'rabbit at 123.456.789.123' ...
> 
> =ERROR REPORT==== 15-Apr-2009::14:50:00 ===
> ** System NOT running to use fully qualified hostnames **
> ** Hostname 123.456.789.123 is illegal **
> {badrpc,nodedown}
> ...done.

That's expected; rabbit uses shortnames. You may have to modify the 
scripts to use long names to get this to work. I personally haven't 
experimented with getting rabbitmqctl or a rabbit cluster to work across 
multiple domains, but I am sure some other folks in the list have tried 
this (and hopefully succeeded) and may be able to help.


Regards,

Matthias.



From rabbitmq at tmm1.net  Wed Apr 15 09:24:49 2009
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Wed, 15 Apr 2009 01:24:49 -0700
Subject: [rabbitmq-discuss] channel.flow
In-Reply-To: <49E583F1.3040405@lshift.net>
References: <09140E75-7FE2-4766-8EC0-75ED2E0683D2@geni.com>
	<49DE5314.2090902@lshift.net>
	<DE603F0D-36E1-4026-BC30-37488A977035@geni.com>
	<e1c05edd0904101641k1e3f8674w53d917cc1ceaf66a@mail.gmail.com>
	<49E444B8.6080700@lshift.net>
	<C2B7DA46-F170-4EA0-A58A-9BA47BE53F47@geni.com>
	<49E583F1.3040405@lshift.net>
Message-ID: <e1c05edd0904150124n12b8627cvc98a4de81ccbed2e@mail.gmail.com>

Thanks! I'm trying to figure out what the behavior should be in the
async ruby library, since blocking is not possible. I probably need to
maintain a local queue per channel..

Is there something like Basic.PublishOk that I can hook up to a
callback on MQ::Queue#publish?

mq = MQ.new
mq.queue('name').publish('hi') do
  puts 'message was received!'
end

This way the user can atleast keep track of published messages to
ensure none are lost by the local process and channel queues.

  Aman

On Tue, Apr 14, 2009 at 11:51 PM, Matthias Radestock
<matthias at lshift.net> wrote:
> Amos,
>
> Amos Elliston wrote:
>> On Apr 14, 2009, at 1:09 AM, Matthias Radestock wrote:
>>> It shouldn't be hard to add support for channel.flow to your lib. I'd
>>> be happy to answer any questions on how it should work.
>>
>> i was going to add it to mine. do you know of a good way to test
>> channel.flow. can i force rabbit to send it?
>
> At the rabbit erlang prompt, evaluate
> ? memsup:set_sysmem_high_watermark(0.01).
> to lower the memory threshold. You should see a message
> ? alarm_handler: {set,{system_memory_high_watermark,[]}}
> appear in the rabbit.log.
>
> To raise the threshold again, evaluate
> ? memsup:set_sysmem_high_watermark(0.95).
> at which point you should see
> ? alarm_handler: {clear,system_memory_high_watermark}
> in the logs.
>
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthias at lshift.net  Wed Apr 15 09:42:16 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 15 Apr 2009 09:42:16 +0100
Subject: [rabbitmq-discuss] channel.flow
In-Reply-To: <e1c05edd0904150124n12b8627cvc98a4de81ccbed2e@mail.gmail.com>
References: <09140E75-7FE2-4766-8EC0-75ED2E0683D2@geni.com>	<49DE5314.2090902@lshift.net>	<DE603F0D-36E1-4026-BC30-37488A977035@geni.com>	<e1c05edd0904101641k1e3f8674w53d917cc1ceaf66a@mail.gmail.com>	<49E444B8.6080700@lshift.net>	<C2B7DA46-F170-4EA0-A58A-9BA47BE53F47@geni.com>	<49E583F1.3040405@lshift.net>
	<e1c05edd0904150124n12b8627cvc98a4de81ccbed2e@mail.gmail.com>
Message-ID: <49E59DE8.5020608@lshift.net>

Aman,

Aman Gupta wrote:
> Thanks! I'm trying to figure out what the behavior should be in the
> async ruby library, since blocking is not possible. I probably need to
> maintain a local queue per channel..
> 
> Is there something like Basic.PublishOk that I can hook up to a
> callback on MQ::Queue#publish?

basic.publish is asynchronous; there is no confirmation.

How is your lib dealing with errors during publish? On way to deal with 
channel.flow{active=false} in a client is to mark the channel as blocked 
and return/raise an error on all subsequent publishes.

You may also want to expose the channel.flow events to apps, so they can 
do internal flow control.


Matthias.



From alexis.richardson at gmail.com  Wed Apr 15 12:11:24 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 15 Apr 2009 12:11:24 +0100
Subject: [rabbitmq-discuss] The Message Selector
In-Reply-To: <efc790a30904142329p114c8d37r3a31d2d68e6cdaf7@mail.gmail.com>
References: <efc790a30904142329p114c8d37r3a31d2d68e6cdaf7@mail.gmail.com>
Message-ID: <167204d20904150411s7baaf817wad9d17858a24c5de@mail.gmail.com>

Hey that looks pretty neat!

Can you talk a bit more about how you are doing it?  Is it python
specific?  (I did not look at your code)

Also you mention a C++ client... any plans for that?

alexis


On Wed, Apr 15, 2009 at 7:29 AM, KDr2 <kdr2 at x-macro.com> wrote:
> I just made some extension for RabbitMQ, It is about Message Selector and
> Dead Message,
> maybe someone need it, here it is:
>
> http://x-macro.com/products/carrot
>
>
> --
> Best Regards,
> ? ?-- KDr2, at x-macro.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From kdr2 at x-macro.com  Wed Apr 15 13:07:24 2009
From: kdr2 at x-macro.com (KDr2)
Date: Wed, 15 Apr 2009 20:07:24 +0800
Subject: [rabbitmq-discuss] The Message Selector
In-Reply-To: <167204d20904150411s7baaf817wad9d17858a24c5de@mail.gmail.com>
References: <efc790a30904142329p114c8d37r3a31d2d68e6cdaf7@mail.gmail.com> 
	<167204d20904150411s7baaf817wad9d17858a24c5de@mail.gmail.com>
Message-ID: <efc790a30904150507i7390770al65278105cc5ab90b@mail.gmail.com>

I modified the RabbitMQ's code, and provide a patch for RabbitMQ-1.5.4, you
can use it like this:

unzip rabbitmq-server-1.5.4.zip
cd rabbitmq-server-1.5.4/
patch -p1 < /path/to/carrot-rabbitmq-1.5.4-090413.patch

Then you should make the rabbitmq,after that, your rabbitmq server will have
the "Message Selector"
and "Dead Message Queue" feature.

Your server is changed, your client need some changes too(client API needs
no changes,the way you
use the API needs some changes), I provider some code to show how you use
client API after you apply
the patch, the python code is just a client code example. So, my work is not
python specific.

I has written a c++ client for RabbitMQ(AMQP-Spec-08) under linux 32bit, It
will be released after more
testing.

On Wed, Apr 15, 2009 at 7:11 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Hey that looks pretty neat!
>
> Can you talk a bit more about how you are doing it?  Is it python
> specific?  (I did not look at your code)
>
> Also you mention a C++ client... any plans for that?
>
> alexis
>
>
> On Wed, Apr 15, 2009 at 7:29 AM, KDr2 <kdr2 at x-macro.com> wrote:
> > I just made some extension for RabbitMQ, It is about Message Selector and
> > Dead Message,
> > maybe someone need it, here it is:
> >
> > http://x-macro.com/products/carrot
> >
> >
> > --
> > Best Regards,
> >    -- KDr2, at x-macro.com.
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>



-- 
Best Regards,
   -- KDr2, at x-macro.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090415/da7efc3c/attachment.htm 

From kevin.conaway at gmail.com  Wed Apr 15 16:36:23 2009
From: kevin.conaway at gmail.com (Kevin Conaway)
Date: Wed, 15 Apr 2009 11:36:23 -0400
Subject: [rabbitmq-discuss] basicGet returns null when there are still
	messages in a queue
Message-ID: <aa945d340904150836gebb4af0w4e4a79e4d072484e@mail.gmail.com>

I have a program that polls every X seconds and tries to process N
messages.  For some reason, basicGet() will return null even if there are
messages still in the queue.

For example:

- I send 100 messages to a queue
- I have a Thread that polls every 3 seconds and processes 30 messages at a
time.

Doing so will result in processing 30 messages, 30 messages, 7 messages and
then leaving 3 messages in the queue.  I can't figure out why those 3
messages don't get processed.  If I rerun my sample program, the last three
messages are processed.

Attached is my sample code using the Java client library

Thank you

Kevin Conaway
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090415/a343a36f/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMqTest.java
Type: application/octet-stream
Size: 3185 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090415/a343a36f/attachment.obj 

From amos at geni.com  Wed Apr 15 23:40:16 2009
From: amos at geni.com (Amos Elliston)
Date: Wed, 15 Apr 2009 15:40:16 -0700
Subject: [rabbitmq-discuss] channel.flow
In-Reply-To: <49E59DE8.5020608@lshift.net>
References: <09140E75-7FE2-4766-8EC0-75ED2E0683D2@geni.com>	<49DE5314.2090902@lshift.net>	<DE603F0D-36E1-4026-BC30-37488A977035@geni.com>	<e1c05edd0904101641k1e3f8674w53d917cc1ceaf66a@mail.gmail.com>	<49E444B8.6080700@lshift.net>	<C2B7DA46-F170-4EA0-A58A-9BA47BE53F47@geni.com>	<49E583F1.3040405@lshift.net>
	<e1c05edd0904150124n12b8627cvc98a4de81ccbed2e@mail.gmail.com>
	<49E59DE8.5020608@lshift.net>
Message-ID: <9E2C9D03-A3A7-4273-90BA-C44EE08C0297@geni.com>

I think you would have to expose the channel.flow to apps, otherwise  
you may lose messages. If you're just queuing them up internally in a  
web server process, there's a strong possibility that you'll lose  
messages if the process is restarted. If I were the app writer I would  
rather catch exceptions so I could handle the messages some other way.

I'll probably block in the sync client.

On Apr 15, 2009, at 1:42 AM, Matthias Radestock wrote:

> Aman,
>
> Aman Gupta wrote:
>> Thanks! I'm trying to figure out what the behavior should be in the
>> async ruby library, since blocking is not possible. I probably need  
>> to
>> maintain a local queue per channel..
>> Is there something like Basic.PublishOk that I can hook up to a
>> callback on MQ::Queue#publish?
>
> basic.publish is asynchronous; there is no confirmation.
>
> How is your lib dealing with errors during publish? On way to deal  
> with channel.flow{active=false} in a client is to mark the channel  
> as blocked and return/raise an error on all subsequent publishes.
>
> You may also want to expose the channel.flow events to apps, so they  
> can do internal flow control.
>
>
> Matthias.




From matthias at lshift.net  Thu Apr 16 13:56:27 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 16 Apr 2009 13:56:27 +0100
Subject: [rabbitmq-discuss] basicGet returns null when there are still
 messages in a queue
In-Reply-To: <aa945d340904150836gebb4af0w4e4a79e4d072484e@mail.gmail.com>
References: <aa945d340904150836gebb4af0w4e4a79e4d072484e@mail.gmail.com>
Message-ID: <49E72AFB.3070008@lshift.net>

Kevin,

Kevin Conaway wrote:
> I have a program that polls every X seconds and tries to process N 
> messages.  For some reason, basicGet() will return null even if there 
> are messages still in the queue.
>  
> For example:
>  
> - I send 100 messages to a queue
> - I have a Thread that polls every 3 seconds and processes 30 messages 
> at a time.
>  
> Doing so will result in processing 30 messages, 30 messages, 7 messages 
> and then leaving 3 messages in the queue.  I can't figure out why those 
> 3 messages don't get processed.  If I rerun my sample program, the last 
> three messages are processed.
>  
> Attached is my sample code using the Java client library

The problem is that you are fetching *31* messages at a time, but only 
acknowledging 30.

To illustrate, here is the sequence your code would go through if 
messageCount was set to 2.

messageCount = 2, sent = 0
get
sent < messageCount == true
  sent++ -> sent = 1
  ack
  get
sent < messageCount == true
  sent++ -> sent = 2
  ack
  get
sent < messageCount == false
print sent -> '2'

So that's 3 gets, but it reports '2' and only acks two.


Matthias.



From Loren.Schlomer at echostar.com  Fri Apr 17 19:02:14 2009
From: Loren.Schlomer at echostar.com (Schlomer, Loren)
Date: Fri, 17 Apr 2009 12:02:14 -0600
Subject: [rabbitmq-discuss] Erlang Client - Possible to recover routing key?
Message-ID: <D5E2A9798F32464BA771983DEBBBAD16018FB43B@MER2-EXCHA3.echostar.com>

Hello,

 

I am writing an intelligent notification system, which pulls messages
off of amqp, parses the routing key and decides what users to send the
notification to.  The trouble is, the routing keys can be anywhere up to
10 segments and can be literally millions of different combinations.  I
am, of course, able to subscribe to the queue and retrieve all the
messages using wildcards.

 

The issue and question I have ---

I need the routing key the message was published with in order to parse
the notification.  Looking at the network traffic, the routing key is
included, but it seems to get lost somewhere in the client code.  The
tuple returned from lib_amqp:get/3 only seems to include the mime-type
and the Payload.

 

Is there a way to retrieve the routing key when pulling messages off a
queue?

 

%% sample code %%

 

%% Producer

Connection = lib_amqp:start_connection("localhost"),

Channel = lib_amqp:start_channel(Connection),

lib_amqp:declare_exchange(Channel, <<"test.exchange">>, <<"topic">>),

 

lib_amqp:publish(Channel, <<"test.exchange">>, <<"routing.key">>,
term_to_binary(Message)).

 

 

 

%% Consumer

Connection = lib_amqp:start_connection("localhost"),

Channel = lib_amqp:start_channel(Connection),

lib_amqp:declare_exchange(Channel, <<"test.exchange">>, <<"topic">>),

 

Queue = lib_amqp:declare_queue(Channel, <<"routing.*"">>),

lib_amqp:bind_queue(Channel, <<"test.exchange">>, Queue,
<<"routing.*">>,

 

 

Reply = lib_amqp:get(Channel, Queue, false),

 

 

--- Or am I way off on all of this?

 

 

Thank you!

 

-ls

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090417/0058bd16/attachment.htm 

From daviddcawley at gmail.com  Mon Apr 20 04:35:13 2009
From: daviddcawley at gmail.com (David Cawley)
Date: Mon, 20 Apr 2009 11:35:13 +0800
Subject: [rabbitmq-discuss] RabbitMQ + Stomp under FC9
Message-ID: <c454d1480904192035s3578bd4evf60da350b098eba3@mail.gmail.com>

I've been testing out several Message Queues under Redhat FC9
using Stomp e.g. POE based MQ and ActiveMQ. I also wanted to
try RabbitMQ but I'm unable to receive messages from the queue?
I see that Tony from lshift has been busy answering questions and
fixing issues so I'm hoping it's in a usable state.

I installed the rabbitmq-server-1.5.3-1 via yum (I had to manually create
a rabbitmq user/group and home directory for a cookie). I then compiled
the stomp adaptor as follows using the rabbitmq_v1_5_3 tag :

cd /usr/lib/erlang/lib/
hg clone http://hg.rabbitmq.com/rabbitmq-stomp
cd rabbitmq-stomp
hg update rabbitmq_v1_5_3
make RABBIT_SERVER_SOURCE_ROOT=../rabbitmq_server-1.5.3

I created a config file so that the stomp adaptor is used:
/etc/rabbitmq/rabbitmq.conf

    SERVER_START_ARGS='
      -pa /usr/lib/erlang/lib/rabbitmq-stomp/ebin
      -rabbit
         stomp_listeners [{"0.0.0.0",61613}]
         extra_startup_steps
[{"STOMP-listeners",rabbit_stomp,kickstart,[]}]'

I restarted the rabbitmq-server process and I can connect to port 61613. The
stomp
connect works. However, when I run the example perl test scripts I don't
receive any
of the messages. The rabbit.log file indicates the accepting of the TCP
connection
and starting and sending of Stomp connection and no errors. I also tried
using the ruby
examples but still no luck. I even tried doing the process above with the
latest 1.5.4
mq-server rpm with the v1_5_3 tagged rabbitmq-stomp. How can I get it
working?

./examples/perl/rabbitmq_stomp_send.pl
./examples/perl/rabbitmq_stomp_recv.pl

Thanks,

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090420/e6873810/attachment.htm 

From theczintheroc2007 at gmail.com  Mon Apr 20 16:58:13 2009
From: theczintheroc2007 at gmail.com (Colin Z)
Date: Mon, 20 Apr 2009 11:58:13 -0400
Subject: [rabbitmq-discuss] AMQP Administration
Message-ID: <ce47f6b80904200858r19b35dddpef4bfc55ef04d2e3@mail.gmail.com>

I'm wondering if there are any administration functions built into AMQP 0-8.
For example, is it possible for a client to get a list of exchanges, queues,
users, virtual hosts, etc directly from the server?

I'm interested in extending a winform app I have so that I can do remote
and/or GUI-based administation.

I know there's rabbitmqctl.bat and rabbit_control.erl but in order to use
that remotely or from a winform, I think I'd need to write a separate Erlang
application that accepts remote connections and proxies calls to the
rabbit_control module.

Just wondering if there's anything more directly available (like in mySQL
where I can log in as an admin and get a list of databases, etc)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090420/a519abfd/attachment.htm 

From matthias at lshift.net  Mon Apr 20 18:12:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 20 Apr 2009 18:12:12 +0100
Subject: [rabbitmq-discuss] Erlang Client - Possible to recover routing
 key?
In-Reply-To: <D5E2A9798F32464BA771983DEBBBAD16018FB43B@MER2-EXCHA3.echostar.com>
References: <D5E2A9798F32464BA771983DEBBBAD16018FB43B@MER2-EXCHA3.echostar.com>
Message-ID: <49ECACEC.20700@lshift.net>

Loren,

Schlomer, Loren wrote:
> The tuple returned from lib_amqp:get/3 only seems to include the
> mime-type and the Payload.
> Is there a way to retrieve the routing key when pulling messages off
> a queue?

You'll need to use the core api rather than the lib_amqp convenience 
wrappers, i.e. amqp_channel:call(#'basic.get'{queue = Q}).


Regards,

Matthias.



From Loren.Schlomer at echostar.com  Mon Apr 20 19:03:19 2009
From: Loren.Schlomer at echostar.com (Schlomer, Loren)
Date: Mon, 20 Apr 2009 12:03:19 -0600
Subject: [rabbitmq-discuss] Erlang Client - Possible to recover routing
	key?
In-Reply-To: <49ECACEC.20700@lshift.net>
References: <D5E2A9798F32464BA771983DEBBBAD16018FB43B@MER2-EXCHA3.echostar.com>
	<49ECACEC.20700@lshift.net>
Message-ID: <D5E2A9798F32464BA771983DEBBBAD16018FB566@MER2-EXCHA3.echostar.com>

This was exactly what I needed!  Thank you!

-ls

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: Monday, April 20, 2009 11:12 AM
To: Schlomer, Loren
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Erlang Client - Possible to recover
routing key?

Loren,

Schlomer, Loren wrote:
> The tuple returned from lib_amqp:get/3 only seems to include the
> mime-type and the Payload.
> Is there a way to retrieve the routing key when pulling messages off
> a queue?

You'll need to use the core api rather than the lib_amqp convenience 
wrappers, i.e. amqp_channel:call(#'basic.get'{queue = Q}).


Regards,

Matthias.



From alexis.richardson at gmail.com  Mon Apr 20 19:12:33 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 20 Apr 2009 19:12:33 +0100
Subject: [rabbitmq-discuss] AMQP Administration
In-Reply-To: <ce47f6b80904200858r19b35dddpef4bfc55ef04d2e3@mail.gmail.com>
References: <ce47f6b80904200858r19b35dddpef4bfc55ef04d2e3@mail.gmail.com>
Message-ID: <167204d20904201112p5931a157p1f1b8f6c72886648@mail.gmail.com>

Colin,

I'm afraid the rabbitmqctl and .erl capability is where it's at,
today.  But that's not for want of trying.  The issue is that each
platform has its own management metaphor.  We would *really*
appreciate some community thinking and code here.  What do you say?

alexis



On Mon, Apr 20, 2009 at 4:58 PM, Colin Z <theczintheroc2007 at gmail.com> wrote:
> I'm wondering if there are any administration functions built into AMQP 0-8.
> For example, is it possible for a client to get a list of exchanges, queues,
> users, virtual hosts, etc directly from the server?
>
> I'm interested in extending a winform app I have so that I can do remote
> and/or GUI-based administation.
>
> I know there's rabbitmqctl.bat and rabbit_control.erl but in order to use
> that remotely or from a winform, I think I'd need to write a separate Erlang
> application that accepts remote connections and proxies calls to the
> rabbit_control module.
>
> Just wondering if there's anything more directly available (like in mySQL
> where I can log in as an admin and get a list of databases, etc)
>
>
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Mon Apr 20 19:25:30 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 20 Apr 2009 19:25:30 +0100
Subject: [rabbitmq-discuss] AMQP Administration
In-Reply-To: <167204d20904201112p5931a157p1f1b8f6c72886648@mail.gmail.com>
References: <ce47f6b80904200858r19b35dddpef4bfc55ef04d2e3@mail.gmail.com>
	<167204d20904201112p5931a157p1f1b8f6c72886648@mail.gmail.com>
Message-ID: <49ECBE1A.9030607@lshift.net>

Alexis Richardson wrote:
> I'm afraid the rabbitmqctl and .erl capability is where it's at,
> today.

Actually there is one other option which people discussed here recently, 
namely invoking the rabbit APIs from Java with jinterface. See
   http://www.nabble.com/Broker-data-td22577496.html

Regards,

Matthias.



From kyle.burton at gmail.com  Mon Apr 20 20:32:20 2009
From: kyle.burton at gmail.com (Kyle R. Burton)
Date: Mon, 20 Apr 2009 15:32:20 -0400
Subject: [rabbitmq-discuss] AMQP Administration
In-Reply-To: <49ECBE1A.9030607@lshift.net>
References: <ce47f6b80904200858r19b35dddpef4bfc55ef04d2e3@mail.gmail.com>
	<167204d20904201112p5931a157p1f1b8f6c72886648@mail.gmail.com>
	<49ECBE1A.9030607@lshift.net>
Message-ID: <ac25b30c0904201232w103f38a1m28e981891145931@mail.gmail.com>

Are there any reserved exchange or routing namespaces for the
implementation itself?

This is something I've also got an interest in - being able to use the
protocol to interact with the broker itself for management, debugging
and monitoring concerns.

Regards,

Kyle

On Mon, Apr 20, 2009 at 2:25 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Alexis Richardson wrote:
>> I'm afraid the rabbitmqctl and .erl capability is where it's at,
>> today.
>
> Actually there is one other option which people discussed here recently,
> namely invoking the rabbit APIs from Java with jinterface. See
> ? http://www.nabble.com/Broker-data-td22577496.html
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
------------------------------------------------------------------------------
kyle.burton at gmail.com                            http://asymmetrical-view.com/
------------------------------------------------------------------------------



From clemesha at gmail.com  Mon Apr 20 21:25:02 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Mon, 20 Apr 2009 13:25:02 -0700
Subject: [rabbitmq-discuss] AMQP Administration
In-Reply-To: <49ECBE1A.9030607@lshift.net>
References: <ce47f6b80904200858r19b35dddpef4bfc55ef04d2e3@mail.gmail.com>
	<167204d20904201112p5931a157p1f1b8f6c72886648@mail.gmail.com>
	<49ECBE1A.9030607@lshift.net>
Message-ID: <d272f0690904201325v36d921b4t13823787a1cc38f7@mail.gmail.com>

On Mon, Apr 20, 2009 at 11:25 AM, Matthias Radestock
<matthias at lshift.net> wrote:
> Alexis Richardson wrote:
>> I'm afraid the rabbitmqctl and .erl capability is where it's at,
>> today.
>
> Actually there is one other option which people discussed here recently,
> namely invoking the rabbit APIs from Java with jinterface. See
> ? http://www.nabble.com/Broker-data-td22577496.html
Here's the equivalent of this technique for those more Python
(Twisted) inclined:
https://launchpad.net/twotp - "Twotp is an implementation of the
Erlang node protocol written in Python using the Twisted networking
engine"
and here is a useful tutorial to getting going with this stuff:
http://eikke.com/erlang-python-and-twisted-mashup-using-twotp/


hope this helps some,
Alex


>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alex Clemesha
clemesha.org



From jacek99 at gmail.com  Tue Apr 21 14:37:27 2009
From: jacek99 at gmail.com (Jacek)
Date: Tue, 21 Apr 2009 06:37:27 -0700 (PDT)
Subject: [rabbitmq-discuss]  Unable to install on Ubuntu 8.10
Message-ID: <23156301.post@talk.nabble.com>


I installer erlang using the standard "sudo apt-get install erlang". Then I
added the Rabbit MQ PPA and tried to do "sudo apt-get install
rabbitmq-server".

It failed to install with:

The following NEW packages will be installed:
  rabbitmq-server
0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.
Need to get 0B/366kB of archives.
After this operation, 795kB of additional disk space will be used.
Selecting previously deselected package rabbitmq-server.
(Reading database ... 202461 files and directories currently installed.)
Unpacking rabbitmq-server (from .../rabbitmq-server_1.5.4-1_all.deb) ...
Processing triggers for man-db ...
Setting up rabbitmq-server (1.5.4-1) ...
Starting rabbitmq-server: TIMEOUT - check
/var/log/rabbitmq/startup_{log,err}
rabbitmq-server.
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess post-installation script returned error exit status 1
Errors were encountered while processing:
 rabbitmq-server
E: Sub-process /usr/bin/dpkg returned an error code (1)

Any suggestions would be welcome, thanks

Jacek
-- 
View this message in context: http://www.nabble.com/Unable-to-install-on-Ubuntu-8.10-tp23156301p23156301.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Tue Apr 21 14:46:39 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 21 Apr 2009 14:46:39 +0100
Subject: [rabbitmq-discuss] Unable to install on Ubuntu 8.10
In-Reply-To: <23156301.post@talk.nabble.com>
References: <23156301.post@talk.nabble.com>
Message-ID: <49EDCE3F.8040600@lshift.net>

Jacek,

Jacek wrote:
> Starting rabbitmq-server: TIMEOUT - check
> /var/log/rabbitmq/startup_{log,err}

What's in the files mentioned above?


Matthias



From jacek99 at gmail.com  Tue Apr 21 14:48:24 2009
From: jacek99 at gmail.com (Jacek)
Date: Tue, 21 Apr 2009 06:48:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to install on Ubuntu 8.10
In-Reply-To: <49EDCE3F.8040600@lshift.net>
References: <23156301.post@talk.nabble.com> <49EDCE3F.8040600@lshift.net>
Message-ID: <23156489.post@talk.nabble.com>


Not very helpful, I'm afraid...

{"init terminating in
do_boot",{undef,[{rabbit_multi,start,[]},{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

-- 
View this message in context: http://www.nabble.com/Unable-to-install-on-Ubuntu-8.10-tp23156301p23156489.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From jacek99 at gmail.com  Tue Apr 21 14:51:12 2009
From: jacek99 at gmail.com (Jacek)
Date: Tue, 21 Apr 2009 06:51:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to install on Ubuntu 8.10
In-Reply-To: <23156489.post@talk.nabble.com>
References: <23156301.post@talk.nabble.com> <49EDCE3F.8040600@lshift.net>
	<23156489.post@talk.nabble.com>
Message-ID: <23156546.post@talk.nabble.com>




Jacek wrote:
> 
> Not very helpful, I'm afraid...
> 
> {"init terminating in
> do_boot",{undef,[{rabbit_multi,start,[]},{init,start_it,1},{init,start_em,1}]}}
> 
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> 
> 


Ah, I think I found it...looks like somehow I didn't remove my R13A Erlang
version (even though I attempted to reinstall the stable version from the
Ubuntu repos):

Erlang R13A (erts-5.7) [source] [smp:2:2] [rq:2] [async-threads:0]
[kernel-poll:false]

Let me ensure my box is back to the stable Erlang version and try again.
It's probably caused by me having installed the bleeding edge version of
Erlang earlier....




-- 
View this message in context: http://www.nabble.com/Unable-to-install-on-Ubuntu-8.10-tp23156301p23156546.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From Andrius.Norkaitis at oryo.lt  Tue Apr 21 16:32:50 2009
From: Andrius.Norkaitis at oryo.lt (Andrius Norkaitis)
Date: Tue, 21 Apr 2009 18:32:50 +0300
Subject: [rabbitmq-discuss] RabbitMQ in .NET Compact Framework
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAJv400tcb15MirtmqfOXj6XCgAAAEAAAAFIlBGd/+ABPhYJ/Nf6htM0BAAAAAA==@oryo.lt>

Hello,

 

I just tried to use rabbit .net Client in Microsoft .NET Compact Framework,
but it's incompatible with Compact framework. Any thoughts how to do
messaging in mobile environment?

I don't want to pull for new messages - subscriber functionality would be
great in my case. Perhaps we could workaround using one of XMPP component
compatible with .NET compact and rabbit xmpp gateway? Any thoughts and
suggestions?

 

Thanks,

Andrius

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090421/e7baa84e/attachment.htm 

From Andrius.Norkaitis at oryo.lt  Tue Apr 21 18:01:01 2009
From: Andrius.Norkaitis at oryo.lt (Andrius Norkaitis)
Date: Tue, 21 Apr 2009 20:01:01 +0300
Subject: [rabbitmq-discuss] RabbitMQ in .NET Compact Framework
In-Reply-To: <ce47f6b80904210913q607dc3d1n173b44fee301dc92@mail.gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAJv400tcb15MirtmqfOXj6XCgAAAEAAAAFIlBGd/+ABPhYJ/Nf6htM0BAAAAAA==@oryo.lt>
	<ce47f6b80904210913q607dc3d1n173b44fee301dc92@mail.gmail.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAJv400tcb15MirtmqfOXj6XCgAAAEAAAAI5JjPcRfE9CoGRQDTTQ9PwBAAAAAA==@oryo.lt>

No, first exception was about referencing System.Uri which is unavailable.
But even removing this from Client constructor other compatibility issues
appeared.

Mobile devices is near future and the need for messaging solution such as
RabbitMQ compatible with them would be increasing I think.

 

Currently in our country taxi's are using radios for voice communication and
we're looking forward how to implement messaging solution in 3G network for
them.

 

From: Colin Z [mailto:theczintheroc2007 at gmail.com] 
Sent: Tuesday, April 21, 2009 7:13 PM
To: Andrius Norkaitis
Subject: Re: [rabbitmq-discuss] RabbitMQ in .NET Compact Framework

 

Is it incompatible because it tries to generate the code from the AMQP spec
and the Compact Framework doesn't support Reflection.Emit?

On Tue, Apr 21, 2009 at 11:32 AM, Andrius Norkaitis
<Andrius.Norkaitis at oryo.lt> wrote:

Hello,

 

I just tried to use rabbit .net Client in Microsoft .NET Compact Framework,
but it's incompatible with Compact framework. Any thoughts how to do
messaging in mobile environment?

I don't want to pull for new messages - subscriber functionality would be
great in my case. Perhaps we could workaround using one of XMPP component
compatible with .NET compact and rabbit xmpp gateway? Any thoughts and
suggestions?

 

Thanks,

Andrius


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090421/4be661d7/attachment.htm 

From jacek99 at gmail.com  Tue Apr 21 18:29:23 2009
From: jacek99 at gmail.com (Jacek)
Date: Tue, 21 Apr 2009 10:29:23 -0700 (PDT)
Subject: [rabbitmq-discuss]  RabbitMQ dying during evaluation testing
Message-ID: <23160957.post@talk.nabble.com>


We're looking at replacing our creaky Weblogic 9 JMS with an alternative and
evaluating RabbitMQ as an replacement. We're all (mostly) Java guys here, so
we're newbies both to Erlang and RabbitMQ (but willing to learn, so bear
with us).

Anyway, as part of our test I wrote a *very* simple client that posts a few
million short messages. It seems to work very well for the first few
million, but after the first few runs RabbitMQ seems to die.

Looking at /var/log/rabbitmq/rabbit.log I see things like:

=WARNING REPORT==== 21-Apr-2009::13:12:59 ===
Mnesia('rabbit at jacek-desktop'): ** WARNING ** Mnesia is overloaded:
{dump_log,
                                                                    
time_threshold}

What makes this worse that after we get the initial socket exception on the
java side, RabbitMQ seems to be left in a really bad state. Asking for
status returns the dreaded

{badrpc,nodedown}

and even restarting it seems to fail:

jacek at jacek-desktop:/var/log/rabbitmq$ sudo rabbitmqctl stop
Stopping and halting node 'rabbit at jacek-desktop' ...
Error: {badrpc,nodedown}

The only solution seems to be to actually log in/out, but we can reliably
reproduce this every time.

I am sure this is something related to configuration, etc. so I would be
grateful for any pointers. I am attaching my simple Java test client.

Thank you in advance for any pointers or suggestions,
Jacek http://www.nabble.com/file/p23160957/Producer.java Producer.java 
-- 
View this message in context: http://www.nabble.com/RabbitMQ-dying-during-evaluation-testing-tp23160957p23160957.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Tue Apr 21 23:32:08 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 21 Apr 2009 23:32:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <23160957.post@talk.nabble.com>
References: <23160957.post@talk.nabble.com>
Message-ID: <49EE4968.7070302@lshift.net>

Jacek,

Jacek wrote:
> Anyway, as part of our test I wrote a *very* simple client that posts a few
> million short messages. It seems to work very well for the first few
> million, but after the first few runs RabbitMQ seems to die.

You have no consumers on the queue, so the messages the producer sends 
will just pile up at the server and eventually RabbitMQ will run out of 
memory.

Flow control should kick in and throttle the producer, but the default 
memory threshold of 95% is probably too high for the server to notice 
the memory pressure before its too late - see 
http://www.rabbitmq.com/admin-guide.html#memsup for adjusting the threshold.

We are working on disk-queues that will allow RabbitMQ to retain more 
message data than fits into memory.


Regards,

Matthias



From icambron at gmail.com  Wed Apr 22 00:21:43 2009
From: icambron at gmail.com (Isaac Cambron)
Date: Tue, 21 Apr 2009 19:21:43 -0400
Subject: [rabbitmq-discuss] basic design question
Message-ID: <42fa2da60904211621qe672ed9tb8c9ac4d58d17668@mail.gmail.com>

I'm a complete newbie to RabbitMQ and, really, messaging in general. I'm
trying to solve what seems like a simple problem, but am overwhelmed with
the number of moving parts: exchanges, bindings, queues, etc. Maybe someone
can sketch, at a high level, how my system should fit together.

I have a client that will publish a bunch of tasks to execute - tasks A, B,
C, D, E. I have a pool of machines that, individually, know how to do some
subset of the tasks. For example, let's say that machine 1 can do A, B, and
C, and machine 2 can do C, D, and E. A machine can only do one task at a
time, and I only want one machine to do any particular task. Tasks can wait
indefinitely until there's a free machine capable of executing it.

I'm not sure what pieces go where. Do I create one queue per task? (If so,
how will I make the machines only respond to one message from any queue at a
time?) Or do I make the tasks different routing keys and have one big queue?
(If so, how will I make a machine only subscribe to particular tasks?). In
general, how do I map the concepts in AMPQ to the concepts in my problem?

Any advice would help enormously.

Thanks,
Isaac
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090421/2c5d23a3/attachment.htm 

From matthias at lshift.net  Wed Apr 22 00:38:45 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Apr 2009 00:38:45 +0100
Subject: [rabbitmq-discuss] basic design question
In-Reply-To: <42fa2da60904211621qe672ed9tb8c9ac4d58d17668@mail.gmail.com>
References: <42fa2da60904211621qe672ed9tb8c9ac4d58d17668@mail.gmail.com>
Message-ID: <49EE5905.3000308@lshift.net>

Isaac,

Isaac Cambron wrote:
> I have a client that will publish a bunch of tasks to execute - tasks A, 
> B, C, D, E. I have a pool of machines that, individually, know how to do 
> some subset of the tasks. For example, let's say that machine 1 can do 
> A, B, and C, and machine 2 can do C, D, and E. A machine can only do one 
> task at a time, and I only want one machine to do any particular task. 
> Tasks can wait indefinitely until there's a free machine capable of 
> executing it.
> 
> I'm not sure what pieces go where. Do I create one queue per task? (If 
> so, how will I make the machines only respond to one message from any 
> queue at a time?)

That, in combination with a basic.qos prefetch count of 1, should work.

More specifically ...

- create a direct exchange to which tasks get published, using the task 
type as the routing key

- create one queue per task type and bind it to the direct exchange with 
the tasks type as the binding key

- let each worker machine open a channel, set the basic.qos prefetch 
count to 1, and then subscribe to (basic.consume) each of the queues 
corresponding to task types supported by that worker.

- when a worker is done with a task it basic.ack's the message


The prefetch count limits the number of tasks a worker will be sent 
before ack'ing them. Note that the basic.qos functionality required to 
do that has not made it into an official release yet; you'll have to use 
  a recent snapshot of the RabbitMQ source. Your example is actually a 
pretty interesting use case for basic.qos, exploiting some of the more 
advanced aspects of that feature, so I'd love to hear how it works out 
for you.


Regards,

Matthias.



From icambron at gmail.com  Wed Apr 22 03:19:37 2009
From: icambron at gmail.com (Isaac Cambron)
Date: Tue, 21 Apr 2009 22:19:37 -0400
Subject: [rabbitmq-discuss] basic design question
In-Reply-To: <49EE5905.3000308@lshift.net>
References: <42fa2da60904211621qe672ed9tb8c9ac4d58d17668@mail.gmail.com>
	<49EE5905.3000308@lshift.net>
Message-ID: <42fa2da60904211919l6eadb0c0t6da3e884ad40d291@mail.gmail.com>

Matthias,

Thanks, that's very helpful. A couple of follow-up questions:

1. What snapshot should I use? I tried out the default revision (not sure
what that tracks) and it didn't queue like I expected; the first consumer to
subscribe got all the tasks, even if more subscribers were added before the
acks. I can't get the tip to run at all (crashes on startup). Presumably I
need something in between?

2. It's not clear to me what all of the other available qos parameters mean.
It appears (and again, wasn't able to try this on the tip revision) that
only BasicQos(0, n, false) is supported. This sounds like it's what I want
anyway (with, obv, n=1); is that right?

If what I have was expected to work, I can provide source code, or the crash
dump if that's unexpected too.

Thanks,
Isaac

On Tue, Apr 21, 2009 at 7:38 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Isaac,
>
> Isaac Cambron wrote:
>
>> I have a client that will publish a bunch of tasks to execute - tasks A,
>> B, C, D, E. I have a pool of machines that, individually, know how to do
>> some subset of the tasks. For example, let's say that machine 1 can do A, B,
>> and C, and machine 2 can do C, D, and E. A machine can only do one task at a
>> time, and I only want one machine to do any particular task. Tasks can wait
>> indefinitely until there's a free machine capable of executing it.
>>
>> I'm not sure what pieces go where. Do I create one queue per task? (If so,
>> how will I make the machines only respond to one message from any queue at a
>> time?)
>>
>
> That, in combination with a basic.qos prefetch count of 1, should work.
>
> More specifically ...
>
> - create a direct exchange to which tasks get published, using the task
> type as the routing key
>
> - create one queue per task type and bind it to the direct exchange with
> the tasks type as the binding key
>
> - let each worker machine open a channel, set the basic.qos prefetch count
> to 1, and then subscribe to (basic.consume) each of the queues corresponding
> to task types supported by that worker.
>
> - when a worker is done with a task it basic.ack's the message
>
>
> The prefetch count limits the number of tasks a worker will be sent before
> ack'ing them. Note that the basic.qos functionality required to do that has
> not made it into an official release yet; you'll have to use  a recent
> snapshot of the RabbitMQ source. Your example is actually a pretty
> interesting use case for basic.qos, exploiting some of the more advanced
> aspects of that feature, so I'd love to hear how it works out for you.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090421/d25ecf76/attachment.htm 

From icambron at gmail.com  Wed Apr 22 04:33:16 2009
From: icambron at gmail.com (Isaac Cambron)
Date: Tue, 21 Apr 2009 23:33:16 -0400
Subject: [rabbitmq-discuss] basic design question
In-Reply-To: <42fa2da60904211919l6eadb0c0t6da3e884ad40d291@mail.gmail.com>
References: <42fa2da60904211621qe672ed9tb8c9ac4d58d17668@mail.gmail.com>
	<49EE5905.3000308@lshift.net>
	<42fa2da60904211919l6eadb0c0t6da3e884ad40d291@mail.gmail.com>
Message-ID: <42fa2da60904212033r4357a442n1c4f9ba684897722@mail.gmail.com>

I did get the tip revision to work (the problem was just that I hadn't shut
down the server properly). However, I'm still not seeing the desired
behavior. I have two programs:

The client, which does this:

ch.QueueDeclare("myqueue");
ch.ExchangeDeclare("ex", ExchangeType.Direct);
ch.QueueBind("myqueue", "ex", "test", false, null);
for (int i = 0; i < 11; i++ )
                    ch.BasicPublish("ex", "test", null,
Encoding.UTF8.GetBytes("message " + i));

and the server, which does this:

                QueueingBasicConsumer consumer = new
QueueingBasicConsumer();
                ch.BasicConsume("myqueue", true, null, consumer);
                ch.BasicQos(0, 1, false);

                while (true)
                {
                    try
                    {
                        BasicDeliverEventArgs e = (BasicDeliverEventArgs)
consumer.Queue.Dequeue();
                        Console.WriteLine(Encoding.UTF8.GetString(e.Body));

                        Thread.Sleep(seconds * 1000); //pretend to take a
while

                        ch.BasicAck(e.DeliveryTag, false);
                    }


If I run the client and then two different instances of the server, one with
the seconds variable set to 1 second and the other with 2, I'd expect the
former instance to print twice as many message bodies. Instead, they
alternate, as if they had just aggressively fetched everything in the queue
in a round-robin way.

Do I have something conceptually wrong, or is that an implementation issue?


On Tue, Apr 21, 2009 at 10:19 PM, Isaac Cambron <icambron at gmail.com> wrote:

> Matthias,
>
> Thanks, that's very helpful. A couple of follow-up questions:
>
> 1. What snapshot should I use? I tried out the default revision (not sure
> what that tracks) and it didn't queue like I expected; the first consumer to
> subscribe got all the tasks, even if more subscribers were added before the
> acks. I can't get the tip to run at all (crashes on startup). Presumably I
> need something in between?
>
> 2. It's not clear to me what all of the other available qos parameters
> mean. It appears (and again, wasn't able to try this on the tip revision)
> that only BasicQos(0, n, false) is supported. This sounds like it's what I
> want anyway (with, obv, n=1); is that right?
>
> If what I have was expected to work, I can provide source code, or the
> crash dump if that's unexpected too.
>
> Thanks,
> Isaac
>
> On Tue, Apr 21, 2009 at 7:38 PM, Matthias Radestock <matthias at lshift.net>wrote:
>
>> Isaac,
>>
>> Isaac Cambron wrote:
>>
>>> I have a client that will publish a bunch of tasks to execute - tasks A,
>>> B, C, D, E. I have a pool of machines that, individually, know how to do
>>> some subset of the tasks. For example, let's say that machine 1 can do A, B,
>>> and C, and machine 2 can do C, D, and E. A machine can only do one task at a
>>> time, and I only want one machine to do any particular task. Tasks can wait
>>> indefinitely until there's a free machine capable of executing it.
>>>
>>> I'm not sure what pieces go where. Do I create one queue per task? (If
>>> so, how will I make the machines only respond to one message from any queue
>>> at a time?)
>>>
>>
>> That, in combination with a basic.qos prefetch count of 1, should work.
>>
>> More specifically ...
>>
>> - create a direct exchange to which tasks get published, using the task
>> type as the routing key
>>
>> - create one queue per task type and bind it to the direct exchange with
>> the tasks type as the binding key
>>
>> - let each worker machine open a channel, set the basic.qos prefetch count
>> to 1, and then subscribe to (basic.consume) each of the queues corresponding
>> to task types supported by that worker.
>>
>> - when a worker is done with a task it basic.ack's the message
>>
>>
>> The prefetch count limits the number of tasks a worker will be sent before
>> ack'ing them. Note that the basic.qos functionality required to do that has
>> not made it into an official release yet; you'll have to use  a recent
>> snapshot of the RabbitMQ source. Your example is actually a pretty
>> interesting use case for basic.qos, exploiting some of the more advanced
>> aspects of that feature, so I'd love to hear how it works out for you.
>>
>>
>> Regards,
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090421/60a609fd/attachment.htm 

From tonyg at lshift.net  Wed Apr 22 05:02:05 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 22 Apr 2009 00:02:05 -0400
Subject: [rabbitmq-discuss] RabbitMQ in .NET Compact Framework
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAJv400tcb15MirtmqfOXj6XCgAAAEAAAAI5JjPcRfE9CoGRQDTTQ9PwBAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAJv400tcb15MirtmqfOXj6XCgAAAEAAAAFIlBGd/+ABPhYJ/Nf6htM0BAAAAAA==@oryo.lt>	<ce47f6b80904210913q607dc3d1n173b44fee301dc92@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAJv400tcb15MirtmqfOXj6XCgAAAEAAAAI5JjPcRfE9CoGRQDTTQ9PwBAAAAAA==@oryo.lt>
Message-ID: <49EE96BD.6050900@lshift.net>

Hi Andrius,

Andrius Norkaitis wrote:
> No, first exception was about referencing System.Uri which is 
> unavailable. But even removing this from Client constructor other 
> compatibility issues appeared.

Hmm. What were they? Where should we start? I haven't explored the 
compact framework at all -- what steps are you taking to try it all out? 
Is it as simple as setting some variables in the nant file, or is there 
a separate SDK/runtime to download?

Colin Z wrote:
> Is it incompatible because it tries to generate the code from the AMQP 
> spec and the Compact Framework doesn't support Reflection.Emit?

Heh - while we do use System.Reflection during codegen, we don't use 
System.Reflection.Emit. Instead, we use WriteLine() :-)

(Also, we don't use Reflection at runtime in any major way, IIRC)

Regards,
   Tony



From matthias at lshift.net  Wed Apr 22 07:29:24 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Apr 2009 07:29:24 +0100
Subject: [rabbitmq-discuss] basic design question
In-Reply-To: <42fa2da60904212033r4357a442n1c4f9ba684897722@mail.gmail.com>
References: <42fa2da60904211621qe672ed9tb8c9ac4d58d17668@mail.gmail.com>	<49EE5905.3000308@lshift.net>	<42fa2da60904211919l6eadb0c0t6da3e884ad40d291@mail.gmail.com>
	<42fa2da60904212033r4357a442n1c4f9ba684897722@mail.gmail.com>
Message-ID: <49EEB944.7050003@lshift.net>

Isaac,

Isaac Cambron wrote:
> I did get the tip revision to work

Careful. Please make sure you use the default branch, i.e. do
   hg update -C default

>                 ch.BasicConsume("myqueue", true, null, consumer);
>                 ch.BasicQos(0, 1, false);

There's your problem:

1) I wrote "set the basic.qos prefetch count to 1, *and then* subscribe 
to [...] the queues", i.e. you need to issue the BasicQos *before* the 
BasicConsume.

2) The second parameter to basicConsume, noAck, must be set to false, 
otherwise the server will automatically ack the messages as soon as it 
sends them, which makes the qos settings ineffective - I suggest you 
simply use the three-arg version of BasicConsume, which sets noAck=false.


Regards,

Matthias.



From rgh at roughage.com.au  Wed Apr 22 08:42:34 2009
From: rgh at roughage.com.au (Richard Heycock)
Date: Wed, 22 Apr 2009 17:42:34 +1000
Subject: [rabbitmq-discuss] moving mnesia between machines.
Message-ID: <1240385064-sup-8024@wrasse>

Hi,

I'm running rabbitmq on an ec2 instance with nmesia on amazon's
persistent block storage so when I shut the machine down and start
another the queues, etc are persisted.

However, during testing, when I mount the partition on the new machine
rabbitmq won't start up; I get a timeout error (from rabbit-sasl.log):


starting database             ...timeout
{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[user,user_vhost,vhost,rabbit_config,listener,durable_routes,route,reverse_route,durable_exchanges,exchange,durable_queues,amqqueue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}^M

When I mount the partition on the original machine rabbitmq starts up
properly.

Is it possible to move the database across machines like this or will I
need to dump it and reload?

rgh



From matthias at lshift.net  Wed Apr 22 09:06:06 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Apr 2009 09:06:06 +0100
Subject: [rabbitmq-discuss] moving mnesia between machines.
In-Reply-To: <1240385064-sup-8024@wrasse>
References: <1240385064-sup-8024@wrasse>
Message-ID: <49EECFEE.1080207@lshift.net>

Richard,

Richard Heycock wrote:
> Is it possible to move the database across machines like this or will I
> need to dump it and reload?

The Erlang node name on the new machine has to be the same as that of 
the original machine.

There is a way to change the node name in the schema, but it's fairly 
involved - http://www.erlang.org/doc/apps/mnesia/Mnesia_chap7.html#6.9 
has an example of doing this on a backup.


Regards,

Matthias.



From rgh at roughage.com.au  Wed Apr 22 09:11:17 2009
From: rgh at roughage.com.au (Richard Heycock)
Date: Wed, 22 Apr 2009 18:11:17 +1000
Subject: [rabbitmq-discuss] moving mnesia between machines.
In-Reply-To: <1240385064-sup-8024@wrasse>
References: <1240385064-sup-8024@wrasse>
Message-ID: <1240387279-sup-8977@wrasse>

Excerpts from Richard Heycock's message of Wed Apr 22 17:42:34 +1000 2009:
> Hi,
> 
> I'm running rabbitmq on an ec2 instance with nmesia on amazon's
> persistent block storage so when I shut the machine down and start
> another the queues, etc are persisted.
> 
> However, during testing, when I mount the partition on the new machine
> rabbitmq won't start up; I get a timeout error (from rabbit-sasl.log):
> 
> 
> starting database             ...timeout
> {"init terminating in
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for
> _tables,[user,user_vhost,vhost,rabbit_config,listener,durable_routes,route,rever
> se_route,durable_exchanges,exchange,durable_queues,amqqueue]},{rabbit,start,[nor
> mal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}^M
> 
> When I mount the partition on the original machine rabbitmq starts up
> properly.
> 
> Is it possible to move the database across machines like this or will I
> need to dump it and reload?
> 
> rgh

After a bit more experimenting I found that if I rename the machine to
the original name then the broker starts (startup_log):

  starting database             ...done
  starting core processes       ...done
  starting recovery             ...done
  starting persister            ...done
  starting guid generator       ...done
  starting builtin applications ...done
  starting TCP listeners        ...done

  broker running

But start_err contains:

  Error: cannot_get_pid

All the rabbitmq processes are running (they look the same as another
machine that is working) but when I try to connect with rabbitmqctl I
get: Error: {badrpc,nodedown}.

rgh



From alexis.richardson at gmail.com  Wed Apr 22 12:08:38 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 22 Apr 2009 12:08:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ in .NET Compact Framework
In-Reply-To: <49EE96BD.6050900@lshift.net>
References: <!&!AAAAAAAAAAAYAAAAAAAAAJv400tcb15MirtmqfOXj6XCgAAAEAAAAFIlBGd/+ABPhYJ/Nf6htM0BAAAAAA==@oryo.lt>
	<ce47f6b80904210913q607dc3d1n173b44fee301dc92@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAJv400tcb15MirtmqfOXj6XCgAAAEAAAAI5JjPcRfE9CoGRQDTTQ9PwBAAAAAA==@oryo.lt>
	<49EE96BD.6050900@lshift.net>
Message-ID: <167204d20904220408n3d1803a8y730bd9c01bd4a3a@mail.gmail.com>

Folks,

Some background info on the Compact Framework:

http://blogs.msdn.com/andrewarnottms/archive/2007/08/21/the-wcf-subset-supported-by-netcf.aspx

alexis


On Wed, Apr 22, 2009 at 5:02 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Hi Andrius,
>
> Andrius Norkaitis wrote:
>> No, first exception was about referencing System.Uri which is
>> unavailable. But even removing this from Client constructor other
>> compatibility issues appeared.
>
> Hmm. What were they? Where should we start? I haven't explored the
> compact framework at all -- what steps are you taking to try it all out?
> Is it as simple as setting some variables in the nant file, or is there
> a separate SDK/runtime to download?
>
> Colin Z wrote:
>> Is it incompatible because it tries to generate the code from the AMQP
>> spec and the Compact Framework doesn't support Reflection.Emit?
>
> Heh - while we do use System.Reflection during codegen, we don't use
> System.Reflection.Emit. Instead, we use WriteLine() :-)
>
> (Also, we don't use Reflection at runtime in any major way, IIRC)
>
> Regards,
> ? Tony
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From jacek99 at gmail.com  Wed Apr 22 12:47:52 2009
From: jacek99 at gmail.com (Jacek)
Date: Wed, 22 Apr 2009 04:47:52 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <49EE4968.7070302@lshift.net>
References: <23160957.post@talk.nabble.com> <49EE4968.7070302@lshift.net>
Message-ID: <23174699.post@talk.nabble.com>


Understand. Is it just a matter of switching from RAM to disk-based tables in
Mnesia?

Unfortunately for us we need to have that 100% guarantee that not a single
message is lost, even if the consumer has to go down for whatever
reason...hence the extreme nature of the test (and we do get hit with
potentially millions of calls every day, so it's a valid scenario for us).

The RabbitMQ performance was amazing (stunning even) and I love the
simplicity and clean API of your Java client. If you could enhance it to
start backing up at least some of the queued up messages to disk to ensure
reliability it would go a long way for us.

Cheers and thank you for your reply,

Jacek
-- 
View this message in context: http://www.nabble.com/RabbitMQ-dying-during-evaluation-testing-tp23160957p23174699.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From matthias at lshift.net  Wed Apr 22 13:01:23 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Apr 2009 13:01:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <23174699.post@talk.nabble.com>
References: <23160957.post@talk.nabble.com> <49EE4968.7070302@lshift.net>
	<23174699.post@talk.nabble.com>
Message-ID: <49EF0713.50300@lshift.net>

Jacek,

Jacek wrote:
> Understand. Is it just a matter of switching from RAM to disk-based tables in
> Mnesia?

Mnesia is only used for routing and config information. It's not 
designed to handle the kind of access patterns and volumes required for 
message storage.

> If you could enhance it to
> start backing up at least some of the queued up messages to disk to ensure
> reliability it would go a long way for us.

Understood. We are working on that, but it's a complex piece of work and 
hence will take a while.


Matthias.



From alexis.richardson at gmail.com  Wed Apr 22 14:11:47 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 22 Apr 2009 14:11:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <49EF0713.50300@lshift.net>
References: <23160957.post@talk.nabble.com> <49EE4968.7070302@lshift.net>
	<23174699.post@talk.nabble.com> <49EF0713.50300@lshift.net>
Message-ID: <167204d20904220611x169f12dbq55494c141ddd7f2@mail.gmail.com>

Jacek,

Is your requirement:

1. to persist messages on disk so that you do not lose them in a crash?
2. to remove messages from memory when they are stored on disk?

RabbitMQ already does 1.  If you make your messages persistent, they
are stored *both* in memory *and* on disk.

As Matthias mentioned, we are working on 2, which is needed in some situations.

alexis






On Wed, Apr 22, 2009 at 1:01 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Jacek,
>
> Jacek wrote:
>> Understand. Is it just a matter of switching from RAM to disk-based tables in
>> Mnesia?
>
> Mnesia is only used for routing and config information. It's not
> designed to handle the kind of access patterns and volumes required for
> message storage.
>
>> If you could enhance it to
>> start backing up at least some of the queued up messages to disk to ensure
>> reliability it would go a long way for us.
>
> Understood. We are working on that, but it's a complex piece of work and
> hence will take a while.
>
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From jacek99 at gmail.com  Wed Apr 22 14:28:34 2009
From: jacek99 at gmail.com (Jacek Furmankiewicz)
Date: Wed, 22 Apr 2009 09:28:34 -0400
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <167204d20904220611x169f12dbq55494c141ddd7f2@mail.gmail.com>
References: <23160957.post@talk.nabble.com> <49EE4968.7070302@lshift.net>
	<23174699.post@talk.nabble.com> <49EF0713.50300@lshift.net>
	<167204d20904220611x169f12dbq55494c141ddd7f2@mail.gmail.com>
Message-ID: <269a5c30904220628g5c02c09dvc401897d97194a99@mail.gmail.com>

Ah, I missed that. I guess that relates to this part of the docs?

channel.basicPublish(*exchangeName*, *routingKey*,
                     MessageProperties.PERSISTENT_TEXT_PLAIN,
                     messageBodyBytes);


channel.basicPublish(*exchangeName*, *routingKey*,
                     *new* AMQP.BasicProperties
                       (contentType, contentEncoding, headers, deliveryMode,
                        priority, correlationId, replyTo, expiration,
                        messageId, timestamp, type, userId,
                        appId, clusterId),
                     messageBodyBytes);


Let me try that, thanks for pointing that out.

Cheers, Jacek


On Wed, Apr 22, 2009 at 9:11 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Jacek,
>
> Is your requirement:
>
> 1. to persist messages on disk so that you do not lose them in a crash?
> 2. to remove messages from memory when they are stored on disk?
>
> RabbitMQ already does 1.  If you make your messages persistent, they
> are stored *both* in memory *and* on disk.
>
> As Matthias mentioned, we are working on 2, which is needed in some
> situations.
>
> alexis
>
>
>
>
>
>
> On Wed, Apr 22, 2009 at 1:01 PM, Matthias Radestock <matthias at lshift.net>
> wrote:
> > Jacek,
> >
> > Jacek wrote:
> >> Understand. Is it just a matter of switching from RAM to disk-based
> tables in
> >> Mnesia?
> >
> > Mnesia is only used for routing and config information. It's not
> > designed to handle the kind of access patterns and volumes required for
> > message storage.
> >
> >> If you could enhance it to
> >> start backing up at least some of the queued up messages to disk to
> ensure
> >> reliability it would go a long way for us.
> >
> > Understood. We are working on that, but it's a complex piece of work and
> > hence will take a while.
> >
> >
> > Matthias.
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090422/b53bca8a/attachment.htm 

From alexis.richardson at gmail.com  Wed Apr 22 14:36:43 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 22 Apr 2009 14:36:43 +0100
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <269a5c30904220628g5c02c09dvc401897d97194a99@mail.gmail.com>
References: <23160957.post@talk.nabble.com> <49EE4968.7070302@lshift.net>
	<23174699.post@talk.nabble.com> <49EF0713.50300@lshift.net>
	<167204d20904220611x169f12dbq55494c141ddd7f2@mail.gmail.com>
	<269a5c30904220628g5c02c09dvc401897d97194a99@mail.gmail.com>
Message-ID: <167204d20904220636p342fb024ya889096915d48646@mail.gmail.com>

Yes, give that a try and let us know how you get on!


On Wed, Apr 22, 2009 at 2:28 PM, Jacek Furmankiewicz <jacek99 at gmail.com> wrote:
> Ah, I missed that. I guess that relates to this part of the docs?
>
> channel.basicPublish(exchangeName, routingKey,
>                      MessageProperties.PERSISTENT_TEXT_PLAIN,
>
>                      messageBodyBytes);
>
> channel.basicPublish(exchangeName, routingKey,
>                      new AMQP.BasicProperties
>                        (contentType, contentEncoding, headers, deliveryMode,
>
>                         priority, correlationId, replyTo, expiration,
>                         messageId, timestamp, type, userId,
>                         appId, clusterId),
>                      messageBodyBytes);
>
> Let me try that, thanks for pointing that out.
>
> Cheers, Jacek
>
>
> On Wed, Apr 22, 2009 at 9:11 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Jacek,
>>
>> Is your requirement:
>>
>> 1. to persist messages on disk so that you do not lose them in a crash?
>> 2. to remove messages from memory when they are stored on disk?
>>
>> RabbitMQ already does 1. ?If you make your messages persistent, they
>> are stored *both* in memory *and* on disk.
>>
>> As Matthias mentioned, we are working on 2, which is needed in some
>> situations.
>>
>> alexis
>>
>>
>>
>>
>>
>>
>> On Wed, Apr 22, 2009 at 1:01 PM, Matthias Radestock <matthias at lshift.net>
>> wrote:
>> > Jacek,
>> >
>> > Jacek wrote:
>> >> Understand. Is it just a matter of switching from RAM to disk-based
>> >> tables in
>> >> Mnesia?
>> >
>> > Mnesia is only used for routing and config information. It's not
>> > designed to handle the kind of access patterns and volumes required for
>> > message storage.
>> >
>> >> If you could enhance it to
>> >> start backing up at least some of the queued up messages to disk to
>> >> ensure
>> >> reliability it would go a long way for us.
>> >
>> > Understood. We are working on that, but it's a complex piece of work and
>> > hence will take a while.
>> >
>> >
>> > Matthias.
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>
>



From matthias at lshift.net  Wed Apr 22 14:40:44 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Apr 2009 14:40:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <269a5c30904220628g5c02c09dvc401897d97194a99@mail.gmail.com>
References: <23160957.post@talk.nabble.com>
	<49EE4968.7070302@lshift.net>	<23174699.post@talk.nabble.com>
	<49EF0713.50300@lshift.net>	<167204d20904220611x169f12dbq55494c141ddd7f2@mail.gmail.com>
	<269a5c30904220628g5c02c09dvc401897d97194a99@mail.gmail.com>
Message-ID: <49EF1E5C.4090008@lshift.net>

Jacek,

Jacek Furmankiewicz wrote:
> Ah, I missed that. I guess that relates to this part of the docs?

Yes, but if your messages don't fit into memory when not marked as 
persistent then they sure won't fit when they are - as Alexis said, 
persistent messages are kept in *both* memory and disk.


Matthias.



From jacek99 at gmail.com  Wed Apr 22 14:44:45 2009
From: jacek99 at gmail.com (Jacek Furmankiewicz)
Date: Wed, 22 Apr 2009 09:44:45 -0400
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <49EF1E5C.4090008@lshift.net>
References: <23160957.post@talk.nabble.com> <49EE4968.7070302@lshift.net>
	<23174699.post@talk.nabble.com> <49EF0713.50300@lshift.net>
	<167204d20904220611x169f12dbq55494c141ddd7f2@mail.gmail.com>
	<269a5c30904220628g5c02c09dvc401897d97194a99@mail.gmail.com>
	<49EF1E5C.4090008@lshift.net>
Message-ID: <269a5c30904220644s67a5a42g881719ccafe437a0@mail.gmail.com>

Is there a way to make them disk-only?

I tried the updated version with the persistent switch and it died after a
million messages as well, unfortunately.
*
for(int i = 0; i < LIMIT; i++) {
                String msg = createMessageText(i);
                byte[] bytes = msg.getBytes();

                channel.basicPublish(exchange, key, true, false,
MessageProperties.PERSISTENT_TEXT_PLAIN, bytes);

            }*

We get this on the Java side:

java.net.SocketException: Broken pipe
    at java.net.SocketOutputStream.socketWrite0(Native Method)
    at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
    at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
    at
java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
    at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
    at java.io.DataOutputStream.flush(DataOutputStream.java:106)
    at
com.rabbitmq.client.impl.SocketFrameHandler.writeFrame(SocketFrameHandler.java:164)
    at
com.rabbitmq.client.impl.AMQConnection.writeFrame(AMQConnection.java:302)
    at com.rabbitmq.client.impl.AMQCommand.transmit(AMQCommand.java:197)
    at
com.rabbitmq.client.impl.AMQChannel.quiescingTransmit(AMQChannel.java:309)
    at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:285)
    at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:392)
    at test.RabbitMQProducer.main(RabbitMQProducer.java:57)
Exception in thread "main" com.rabbitmq.client.AlreadyClosedException (clean
connection shutdown; reason: Attempt to use closed channel)
    at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:189)
    at
com.rabbitmq.client.impl.AMQChannel.processShutdownSignal(AMQChannel.java:257)
    at
com.rabbitmq.client.impl.ChannelN.processShutdownSignal(ChannelN.java:164)
    at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:337)
    at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:291)
    at com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:285)
    at test.RabbitMQProducer.main(RabbitMQProducer.java:73)

and {badrpc,nodedown} when querying for status.

Jacek




On Wed, Apr 22, 2009 at 9:40 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Jacek,
>
> Jacek Furmankiewicz wrote:
>
>> Ah, I missed that. I guess that relates to this part of the docs?
>>
>
> Yes, but if your messages don't fit into memory when not marked as
> persistent then they sure won't fit when they are - as Alexis said,
> persistent messages are kept in *both* memory and disk.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090422/bb4a300e/attachment.htm 

From matthias at lshift.net  Wed Apr 22 15:05:54 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Apr 2009 15:05:54 +0100
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <269a5c30904220644s67a5a42g881719ccafe437a0@mail.gmail.com>
References: <23160957.post@talk.nabble.com>
	<49EE4968.7070302@lshift.net>	<23174699.post@talk.nabble.com>
	<49EF0713.50300@lshift.net>	<167204d20904220611x169f12dbq55494c141ddd7f2@mail.gmail.com>	<269a5c30904220628g5c02c09dvc401897d97194a99@mail.gmail.com>	<49EF1E5C.4090008@lshift.net>
	<269a5c30904220644s67a5a42g881719ccafe437a0@mail.gmail.com>
Message-ID: <49EF2442.505@lshift.net>

Jacek,

Jacek Furmankiewicz wrote:
> Is there a way to make them disk-only?

No. That's what we are working on.


Matthias.



From jacek99 at gmail.com  Wed Apr 22 15:18:37 2009
From: jacek99 at gmail.com (Jacek Furmankiewicz)
Date: Wed, 22 Apr 2009 10:18:37 -0400
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <49EF2442.505@lshift.net>
References: <23160957.post@talk.nabble.com> <49EE4968.7070302@lshift.net>
	<23174699.post@talk.nabble.com> <49EF0713.50300@lshift.net>
	<167204d20904220611x169f12dbq55494c141ddd7f2@mail.gmail.com>
	<269a5c30904220628g5c02c09dvc401897d97194a99@mail.gmail.com>
	<49EF1E5C.4090008@lshift.net>
	<269a5c30904220644s67a5a42g881719ccafe437a0@mail.gmail.com>
	<49EF2442.505@lshift.net>
Message-ID: <269a5c30904220718od115431x984656d6566db821@mail.gmail.com>

That makes sense, thanks for the update. Is there any ETA on this
enhancement (weeks? months? year?).

Jacek

On Wed, Apr 22, 2009 at 10:05 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Jacek,
>
> Jacek Furmankiewicz wrote:
>
>> Is there a way to make them disk-only?
>>
>
> No. That's what we are working on.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090422/dde2925d/attachment.htm 

From matthias at lshift.net  Wed Apr 22 16:06:40 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Apr 2009 16:06:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ dying during evaluation testing
In-Reply-To: <269a5c30904220718od115431x984656d6566db821@mail.gmail.com>
References: <23160957.post@talk.nabble.com>
	<49EE4968.7070302@lshift.net>	<23174699.post@talk.nabble.com>
	<49EF0713.50300@lshift.net>	<167204d20904220611x169f12dbq55494c141ddd7f2@mail.gmail.com>	<269a5c30904220628g5c02c09dvc401897d97194a99@mail.gmail.com>	<49EF1E5C.4090008@lshift.net>	<269a5c30904220644s67a5a42g881719ccafe437a0@mail.gmail.com>	<49EF2442.505@lshift.net>
	<269a5c30904220718od115431x984656d6566db821@mail.gmail.com>
Message-ID: <49EF3280.6000300@lshift.net>

Jacek,

Jacek Furmankiewicz wrote:
> That makes sense, thanks for the update. Is there any ETA on this 
> enhancement (weeks? months? year?).

We hope to have first versions of it available in our source tree within 
a few weeks, and should be able to release something within a coupe of 
months.


Matthias.



From nemik at nemik.net  Wed Apr 22 16:46:13 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Wed, 22 Apr 2009 10:46:13 -0500
Subject: [rabbitmq-discuss] Advice needed on new 'feature'
Message-ID: <acceaadf0904220846ud1f33fbl4393c26b955faa05@mail.gmail.com>

Hello,

So first off I want to say how delighted I am with RabbitMQ. Once I kinda
got the hang of Erlang, the code is really nice and easy enough to
understand; though I'm still very much new at this.

First a little background (sorry it's so long): I have a use-case where I'm
using RabbitMQ with the STOMP adapter (which is also wonderful BTW) but ran
into some limitations. We (my team working on a project) plan for every user
of our service to have their own 'inbox' (queue) to receive real-time data
over via a topic exchange. What we want to allow though is for same user (or
a default 'guest' account) to log in from multiple places and receive from
the same queue. Now one way to do this I suppose would be to create an
exchange per user to fan out and have new temporary/auto_delete queue's for
each connection; kind of like what the STOMP adapter docs describe for
broadcast. But creating an exchange per user just seemed too...heavy for me
and overkill, I think it's easier to just give each a queue.

Problem was, I couldn't properly map in my head (or in code) how to get all
consumers of that queue to get the message. The broadcast-like behaviour
using another fanout exchange like described didn't seem like it would work
for me.

So I modified the RabbitMQ-server code to add another boolean attribute to
each queue called 'broadcast'. When you declare a queue, you can turn on
'broadcast' (default is false) and that will make all the current/active
consumers of the queue receive the message at once instead of round-robining
to a single consumer. I thought about maybe setting this flag per message
instead but that thought only came as I was almost finished with the
per-queue one and that seems to work great for me.

I know this probably breaks the AMQP protocol as defined, but I found it to
be really useful and kind of surprised that such a behaviour didn't exist.

Because I've been Erlanging for all of 2 days now, I just wanted to post my
diff here with the changes to do this feature and see if some of you
talented RabbitMQ devs could give it a quick glance and see if I might have
royally screwed up somewhere. I tested it for me and it works fine, but
haven't done much load-testing on it yet. I just really love that I can have
however-many STOMP connections to a single broadcast-queue and they all get
a message going to it, it's really great.

So attached is the diff for the server. I did the testing for this using
Barry's nice py-amqplib and made a change there too to send another Bit for
the boolean broadcast flag when declaring a queue; I attached the new file I
changed for that too.

I would just appreciate any feedback you guys might be able to give for this
and thank you again for such a great peice of software!

-Nemanja

P.S. The changes I made were to the tip of hg as of yesterday morning (well
morning for me in GMT-6).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090422/f550617e/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqp-0.8.json
Type: application/octet-stream
Size: 25300 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090422/f550617e/attachment.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: channel.py
Type: application/octet-stream
Size: 84696 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090422/f550617e/attachment-0001.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: broadcast.diff
Type: application/octet-stream
Size: 6933 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090422/f550617e/attachment-0002.obj 

From icambron at gmail.com  Wed Apr 22 16:57:59 2009
From: icambron at gmail.com (Isaac Cambron)
Date: Wed, 22 Apr 2009 11:57:59 -0400
Subject: [rabbitmq-discuss] basic design question
In-Reply-To: <49EEB944.7050003@lshift.net>
References: <42fa2da60904211621qe672ed9tb8c9ac4d58d17668@mail.gmail.com>
	<49EE5905.3000308@lshift.net>
	<42fa2da60904211919l6eadb0c0t6da3e884ad40d291@mail.gmail.com>
	<42fa2da60904212033r4357a442n1c4f9ba684897722@mail.gmail.com>
	<49EEB944.7050003@lshift.net>
Message-ID: <42fa2da60904220857o33ec1130m42d0bd6e6cbe4b4f@mail.gmail.com>

Thanks! Works like a charm.

As a side note, noAck seems like a counter-intuitive name. I expected
noAck=flase to mean a double negative, telling the server to automatically
ack.

-Isaac

On Wed, Apr 22, 2009 at 2:29 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Isaac,
>
> Isaac Cambron wrote:
>
>> I did get the tip revision to work
>>
>
> Careful. Please make sure you use the default branch, i.e. do
>  hg update -C default
>
>                 ch.BasicConsume("myqueue", true, null, consumer);
>>                ch.BasicQos(0, 1, false);
>>
>
> There's your problem:
>
> 1) I wrote "set the basic.qos prefetch count to 1, *and then* subscribe to
> [...] the queues", i.e. you need to issue the BasicQos *before* the
> BasicConsume.
>
> 2) The second parameter to basicConsume, noAck, must be set to false,
> otherwise the server will automatically ack the messages as soon as it sends
> them, which makes the qos settings ineffective - I suggest you simply use
> the three-arg version of BasicConsume, which sets noAck=false.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090422/0d192d44/attachment.htm 

From matthias at lshift.net  Wed Apr 22 17:06:08 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Apr 2009 17:06:08 +0100
Subject: [rabbitmq-discuss] basic design question
In-Reply-To: <42fa2da60904220857o33ec1130m42d0bd6e6cbe4b4f@mail.gmail.com>
References: <42fa2da60904211621qe672ed9tb8c9ac4d58d17668@mail.gmail.com>	<49EE5905.3000308@lshift.net>	<42fa2da60904211919l6eadb0c0t6da3e884ad40d291@mail.gmail.com>	<42fa2da60904212033r4357a442n1c4f9ba684897722@mail.gmail.com>	<49EEB944.7050003@lshift.net>
	<42fa2da60904220857o33ec1130m42d0bd6e6cbe4b4f@mail.gmail.com>
Message-ID: <49EF4070.10006@lshift.net>

Isaac,

Isaac Cambron wrote:
> As a side note, noAck seems like a counter-intuitive name.

Agreed. The name is taken straight from the AMQP spec, so it's not 
Rabbit's fault :)


Matthias.



From matthias at lshift.net  Wed Apr 22 18:32:03 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Apr 2009 18:32:03 +0100
Subject: [rabbitmq-discuss] AMQP Administration
In-Reply-To: <ac25b30c0904201232w103f38a1m28e981891145931@mail.gmail.com>
References: <ce47f6b80904200858r19b35dddpef4bfc55ef04d2e3@mail.gmail.com>	<167204d20904201112p5931a157p1f1b8f6c72886648@mail.gmail.com>	<49ECBE1A.9030607@lshift.net>
	<ac25b30c0904201232w103f38a1m28e981891145931@mail.gmail.com>
Message-ID: <49EF5493.7050407@lshift.net>

Kyle,

Kyle R. Burton wrote:
> Are there any reserved exchange or routing namespaces for the
> implementation itself?

No, though a pretty safe bet is to use the "amq." namespace, which is 
reserved for "predeclared and standardised exchanges". So, for example, 
rabbit's internal log exchange is named "amq.rabbitmq.log".


Regards,

Matthias.



From theczintheroc2007 at gmail.com  Wed Apr 22 19:27:42 2009
From: theczintheroc2007 at gmail.com (Colin Z)
Date: Wed, 22 Apr 2009 14:27:42 -0400
Subject: [rabbitmq-discuss] AMQP Administration
In-Reply-To: <49EF5493.7050407@lshift.net>
References: <ce47f6b80904200858r19b35dddpef4bfc55ef04d2e3@mail.gmail.com>
	<167204d20904201112p5931a157p1f1b8f6c72886648@mail.gmail.com>
	<49ECBE1A.9030607@lshift.net>
	<ac25b30c0904201232w103f38a1m28e981891145931@mail.gmail.com>
	<49EF5493.7050407@lshift.net>
Message-ID: <ce47f6b80904221127jef903d5uc37135794913ed77@mail.gmail.com>

I think that would be a really useful addition for Rabbit.

A topic exchange named something like amq.admin or amq.broker.info that has
internal consumers listening to several queues whose bindings correspond to
a standardized set of messages and routes info messages to a response
exchange appropriately.

Just some off the cuff ideas:

amq.admin.listVirtualHosts.[pattern]
amq.admin.listUsers.[pattern]
amq.admin.listPrivileges.(user)
amq.admin.listExchanges.vHostName.[pattern]
amq.admin.listQueues.exchangeName.queueName.[pattern]
amq.admin.listQueues.exchangeName.binding.[pattern]
amq.admin.getMessageCount.queueName

where pattern might be a simple matching expression.
ex: if you sent a message with the routing key
amq.admin.listVirtualHosts.Rabbit* you would get back a message with a list
of all virtual hosts whos ename starts with "Rabbit".


So it might be like this, at a high level....

RabbitMQ server:
amq.admin - Topic exchange
   has a set of queues bound with routing keys corresponding to each command
   each queue has an internal consumer process listening. These processes
will use rabbit_control to get the requested info and construct a response
message.
   client messages should have a "secret" routing key in the payload (see
below) so the consumers know where to route their response.

amq.admin.response - Direct exchange
   clients bind exclusive queues with a "secret" routing key that they send
in the payload of their messages to amq.admin
   the internal consumer processes route their response messages to this
exchange with the "secret" key the client sent in their message.





On Wed, Apr 22, 2009 at 1:32 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Kyle,
>
> Kyle R. Burton wrote:
>
>> Are there any reserved exchange or routing namespaces for the
>> implementation itself?
>>
>
> No, though a pretty safe bet is to use the "amq." namespace, which is
> reserved for "predeclared and standardised exchanges". So, for example,
> rabbit's internal log exchange is named "amq.rabbitmq.log".
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090422/804bd00e/attachment.htm 

From norbu09 at googlemail.com  Wed Apr 22 22:55:25 2009
From: norbu09 at googlemail.com (lenz)
Date: Thu, 23 Apr 2009 09:55:25 +1200
Subject: [rabbitmq-discuss] RabbitMQ HTTP interface
Message-ID: <e25246b60904221455w1fd5623cv14e9570cbc3f5312@mail.gmail.com>

hi,
I want to give RabbitMQ another go (after falling short the last time with
the lack of features in STOMP). I write most of my code in perl - as domain
business is mainly perl - but migrate more and more stuff over to erlang. i
would love to have rabbit in the middle and talk to all sides.
the problem is the lack of a native amqp library in perl. some attempts but
no working lib yet. as we have JSON via HTTP in our stack anyway already
(for CouchDB) i played a bit with the HTTP interface yesterday. our stuff is
not so time critical/ high volume yet so this would be good enough i guess.
from the javascript client that comes with the rabbit-http2 repo i kind of
got an idea how things are supposed to work but i wanted to ask if there is
some sort of documentation/API description around that i could use to
implement a client from?

cheers
lenz

-- 
iWantMyName.com
painless domain registration (finally)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/fd6d4f1c/attachment.htm 

From matthias at lshift.net  Thu Apr 23 06:12:17 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 23 Apr 2009 06:12:17 +0100
Subject: [rabbitmq-discuss] Advice needed on new 'feature'
In-Reply-To: <acceaadf0904220846ud1f33fbl4393c26b955faa05@mail.gmail.com>
References: <acceaadf0904220846ud1f33fbl4393c26b955faa05@mail.gmail.com>
Message-ID: <49EFF8B1.9040903@lshift.net>

Nemanja,

Nemanja Stefanovic wrote:

> What we want to allow 
> though is for same user (or a default 'guest' account) to log in from 
> multiple places and receive from the same queue. Now one way to do this 
> I suppose would be to create an exchange per user to fan out and have 
> new temporary/auto_delete queue's for each connection

Why don't you simply create an auto_delete queue and bind it to the 
existing topic exchange exactly in the same way as the user's "primary" 
queue?

> So I modified the RabbitMQ-server code to add another boolean attribute 
> to each queue called 'broadcast'. When you declare a queue, you can turn 
> on 'broadcast' (default is false) and that will make all the 
> current/active consumers of the queue receive the message at once 
> instead of round-robining to a single consumer.

How do acknowledgements work in this scheme?


Matthias.



From nemik at nemik.net  Thu Apr 23 06:32:00 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Thu, 23 Apr 2009 00:32:00 -0500
Subject: [rabbitmq-discuss] Advice needed on new 'feature'
In-Reply-To: <49EFF8B1.9040903@lshift.net>
References: <acceaadf0904220846ud1f33fbl4393c26b955faa05@mail.gmail.com>
	<49EFF8B1.9040903@lshift.net>
Message-ID: <acceaadf0904222232t63bf3c02s9c22d21d1628c662@mail.gmail.com>

Matthias,

Thank you for replying on this.

The auto_delete's per connection is a good idea. I had considered it but it
seemed like duplicating many bindings per connection per 'primary' queue
might have unnecessary overhead. I suppose there probably wouldn't be more
than a few per user, but how does creating new queues and ~15 or so bindings
for each affect system performance? The other reason for avoiding
re-creation of bindings each time is that the topics are collected from a
user-profile from a database. I really liked the exchange for this reason
because it allowed for minimizing DB-calls. I realize this is probably a
minor point though.

Lastly, the current 'primary' queue allows me to store messages/events in
it, so when the first client connects it can consume past messages and
display them in a "here's what you missed while you were away" kind of case.
I wouldn't be able to get this same behaviour with auto_delete queue's since
(as far as I know) there's no way to 'synchronize' their contents with the
ones of the' primary' queue.

As for acknowledgements, I'm not using them in this case so I'm not too
worried about that.

-Nemanja


On Thu, Apr 23, 2009 at 12:12 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Nemanja,
>
> Nemanja Stefanovic wrote:
>
>  What we want to allow though is for same user (or a default 'guest'
>> account) to log in from multiple places and receive from the same queue. Now
>> one way to do this I suppose would be to create an exchange per user to fan
>> out and have new temporary/auto_delete queue's for each connection
>>
>
> Why don't you simply create an auto_delete queue and bind it to the
> existing topic exchange exactly in the same way as the user's "primary"
> queue?
>
>  So I modified the RabbitMQ-server code to add another boolean attribute to
>> each queue called 'broadcast'. When you declare a queue, you can turn on
>> 'broadcast' (default is false) and that will make all the current/active
>> consumers of the queue receive the message at once instead of round-robining
>> to a single consumer.
>>
>
> How do acknowledgements work in this scheme?
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/4aa72c2e/attachment.htm 

From alexis.richardson at gmail.com  Thu Apr 23 06:57:29 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 23 Apr 2009 06:57:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ HTTP interface
In-Reply-To: <e25246b60904221455w1fd5623cv14e9570cbc3f5312@mail.gmail.com>
References: <e25246b60904221455w1fd5623cv14e9570cbc3f5312@mail.gmail.com>
Message-ID: <167204d20904222257r7c3ec014x8e4af517df81813a@mail.gmail.com>

Lenz

You mentioned on twitter: "one sample in json structure of channel
create-send-recv-teardown would be enough i guess".  Lets see if we
can help you locate that.  The HTTP interface was created by Tony who
is on vacation this week so please bear with us..

alexis



On Wed, Apr 22, 2009 at 10:55 PM, lenz <norbu09 at googlemail.com> wrote:
> hi,
> I want to give RabbitMQ another go (after falling short the last time with
> the lack of features in STOMP). I write most of my code in perl - as domain
> business is mainly perl - but migrate more and more stuff over to erlang. i
> would love to have rabbit in the middle and talk to all sides.
> the problem is the lack of a native amqp library in perl. some attempts but
> no working lib yet. as we have JSON via HTTP in our stack anyway already
> (for CouchDB) i played a bit with the HTTP interface yesterday. our stuff is
> not so time critical/ high volume yet so this would be good enough i guess.
> from the javascript client that comes with the rabbit-http2 repo i kind of
> got an idea how things are supposed to work but i wanted to ask if there is
> some sort of documentation/API description around that i could use to
> implement a client from?
> cheers
> lenz
> --
> iWantMyName.com
> painless domain registration (finally)
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Thu Apr 23 07:39:39 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 23 Apr 2009 07:39:39 +0100
Subject: [rabbitmq-discuss] Advice needed on new 'feature'
In-Reply-To: <acceaadf0904222232t63bf3c02s9c22d21d1628c662@mail.gmail.com>
References: <acceaadf0904220846ud1f33fbl4393c26b955faa05@mail.gmail.com>	<49EFF8B1.9040903@lshift.net>
	<acceaadf0904222232t63bf3c02s9c22d21d1628c662@mail.gmail.com>
Message-ID: <49F00D2B.7080904@lshift.net>

Nemanja,

Nemanja Stefanovic wrote:
> The auto_delete's per connection is a good idea. I had considered it but 
> it seemed like duplicating many bindings per connection per 'primary' 
> queue might have unnecessary overhead. I suppose there probably wouldn't 
> be more than a few per user, but how does creating new queues and ~15 or 
> so bindings for each affect system performance? The other reason for 
> avoiding re-creation of bindings each time is that the topics are 
> collected from a user-profile from a database. I really liked the 
> exchange for this reason because it allowed for minimizing DB-calls. I 
> realize this is probably a minor point though.

An alternative to duplicating the bindings would be to introduce 
exchange-to-exchange bindings; something that was originally envisaged 
in AMQP and wouldn't be too hard to add to RabbitMQ.

You would then be able to have a three-level topology:

1) a topic exchange, just as you have now
2) one fanout exchange per user, with your ~15 bindings to the topic 
exchange
3) the primary and, temporarily, the secondary per-user queues bound 
with a single binding each to the user's fanout exchange.

You end up with one exchange and 15+1(+1 temporarily) bindings per user, 
which RabbitMQ should cope with fine and efficiently.

> Lastly, the current 'primary' queue allows me to store messages/events 
> in it, so when the first client connects it can consume past messages 
> and display them in a "here's what you missed while you were away" kind 
> of case. I wouldn't be able to get this same behaviour with auto_delete 
> queue's since (as far as I know) there's no way to 'synchronize' their 
> contents with the ones of the' primary' queue.

So, if I understand you correctly ...

- when none of the user's clients are connected, messages for that user 
should be buffered

- when a user's client connects it should receive all buffered messages 
(i.e. messages that have not been sent to *any* of the user's clients), 
followed by any new messages

That's an interesting use case.

One possible approach is to have one permanent queue per user and then 
temporary queues for each client, with all queues having the same 
bindings (or being bound to the fanout exchange described above). 
Clients subscribe to to both the permanent queue and temporary queue and 
maintain state to allow them to spot duplicates, i.e. messages that came 
from both the permanent and temporary queue.

While that is not the most efficient of solutions, the cost is bounded. 
Each message is sent to a client at most twice. And the de-dup state is 
bounded too - in the worst case you need to remember the hashes of all 
messages received from the permanent queue that have not been received 
(yet, or possibly never) from the temporary queue.

> As for acknowledgements, I'm not using them in this case so I'm not too 
> worried about that.

Right, but it stops the broadcast-queue feature from being orthogonal. 
Other aspects that will break things are transactional acks, network 
flow control (which blocks consumers) and channel flow control (ditto).


Regards,

Matthias.



From norbu09 at googlemail.com  Thu Apr 23 11:05:44 2009
From: norbu09 at googlemail.com (lenz)
Date: Thu, 23 Apr 2009 22:05:44 +1200
Subject: [rabbitmq-discuss] RabbitMQ HTTP interface
In-Reply-To: <167204d20904222257r7c3ec014x8e4af517df81813a@mail.gmail.com>
References: <e25246b60904221455w1fd5623cv14e9570cbc3f5312@mail.gmail.com>
	<167204d20904222257r7c3ec014x8e4af517df81813a@mail.gmail.com>
Message-ID: <e25246b60904230305g2083dbdcja7668b5e5a3ac07a@mail.gmail.com>

hi,
i am not in a hurry, just wanted to get it done somewhen :-) i
have absolutely no issue with waiting another week :-)

cheers
lenz

On Thu, Apr 23, 2009 at 5:57 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Lenz
>
> You mentioned on twitter: "one sample in json structure of channel
> create-send-recv-teardown would be enough i guess".  Lets see if we
> can help you locate that.  The HTTP interface was created by Tony who
> is on vacation this week so please bear with us..
>
> alexis
>
>
>
> On Wed, Apr 22, 2009 at 10:55 PM, lenz <norbu09 at googlemail.com> wrote:
> > hi,
> > I want to give RabbitMQ another go (after falling short the last time
> with
> > the lack of features in STOMP). I write most of my code in perl - as
> domain
> > business is mainly perl - but migrate more and more stuff over to erlang.
> i
> > would love to have rabbit in the middle and talk to all sides.
> > the problem is the lack of a native amqp library in perl. some attempts
> but
> > no working lib yet. as we have JSON via HTTP in our stack anyway already
> > (for CouchDB) i played a bit with the HTTP interface yesterday. our stuff
> is
> > not so time critical/ high volume yet so this would be good enough i
> guess.
> > from the javascript client that comes with the rabbit-http2 repo i kind
> of
> > got an idea how things are supposed to work but i wanted to ask if there
> is
> > some sort of documentation/API description around that i could use to
> > implement a client from?
> > cheers
> > lenz
> > --
> > iWantMyName.com
> > painless domain registration (finally)
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>



-- 
iWantMyName.com
painless domain registration (finally)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/26e8c528/attachment.htm 

From alexis.richardson at gmail.com  Thu Apr 23 12:47:42 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 23 Apr 2009 12:47:42 +0100
Subject: [rabbitmq-discuss] "pubsub" meet-ups
Message-ID: <167204d20904230447l28b17d4aq9e7b4c39b811396d@mail.gmail.com>

Hi all,

Last Tuesday, in London, some of the RabbitMQ team joined up with
other folks who are interested in pubsub and messaging of all
technology flavours.  The event was called "Pubsub - putting the 'pub'
back into pubsub".  About 20 people came and a great time was had.
For people who are interested in the next such event, I have created a
public google group called "pub-sub".  Feel free to join.  By all
means take a lead and organise one of these in your own city - use the
list to tell people about it.

alexis



From Alister.Morton at tradition.com  Thu Apr 23 13:07:17 2009
From: Alister.Morton at tradition.com (Alister Morton)
Date: Thu, 23 Apr 2009 13:07:17 +0100
Subject: [rabbitmq-discuss] "pubsub" meet-ups
In-Reply-To: <167204d20904230447l28b17d4aq9e7b4c39b811396d@mail.gmail.com>
References: <167204d20904230447l28b17d4aq9e7b4c39b811396d@mail.gmail.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891066EDBB9311B@SVR-2K3-BH-EMC.tradition.int>

> For people who are interested in the next such event, I have created a public google group called "pub-sub".

This seems to be a group to discuss someone's travels???

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From nemik at nemik.net  Thu Apr 23 13:50:25 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Thu, 23 Apr 2009 07:50:25 -0500
Subject: [rabbitmq-discuss] Advice needed on new 'feature'
In-Reply-To: <49F00D2B.7080904@lshift.net>
References: <acceaadf0904220846ud1f33fbl4393c26b955faa05@mail.gmail.com>
	<49EFF8B1.9040903@lshift.net>
	<acceaadf0904222232t63bf3c02s9c22d21d1628c662@mail.gmail.com>
	<49F00D2B.7080904@lshift.net>
Message-ID: <acceaadf0904230550s144b560l7124368244cd86fe@mail.gmail.com>

Matthias,

Exchange-to-exchange bindings sound very interesting, I didn't think about
that and didn't know it could be implemented easily.

And yes, your assumptions are correct, I would like the messages buffered
for the first client to connect and then as the others come on they just get
later ones. With the patch I submitted that is exactly how it works now and
I love it.
It also makes STOMP connections (since I'll be using STOMP as protocol for
client to subscribe and consume) very easy to handle since subscriptions can
be done easily and mapped directly to the queue. No need to create temporary
queue's on another exchange.

The second approach you gave about client handling de-dup with hashes and
feeding from primary and temporary I suppose could work, but would be much
more complicated in my case than the changes I had made to the server.
Because I don't plan on using transactional ack's or flow control, it is a
reasonable compromise for my purposes.

I'm by no means asking for this to get merged in or anything. I realize it
breaks AMQP specs; breaks all current client implimentations since it's
adding a new mandatory bit bool-field for broadcast in queue.declare, I had
to change py-amqplib and the STOMP adapter for this. I mainly sent to to the
list in case someone else might find it useful.
I realize this 'feature' isn't exactly welcome because of its effects on
ack's and flow/network controls (not mention AMQP spec), but I had just
hoped you guys who made the server to see if my changes make sense IF such a
feature was to be done; if only because I'm new to both Erlang and RabbitMQ.

Thank you though for all the other suggestions. One concern we have in the
team is users that don't come back and whose queue's as a result get filled
with many messages. Since the messages we're sending will not be persisent,
we're not worried about disk usage but more about memory. I'm not sure if
the garbage collector would purge old messages from such queues (I assume
no) and hence the node running out of memory. Some kind of cron-based
purging could also be possible but not very reliable. In which case we may
just go with auto_delete queue's per connection duplicating the bindings of
a 'primary' queue as you suggested in the first reply.

Thank you,
Nemanja

On Thu, Apr 23, 2009 at 1:39 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Nemanja,
>
> Nemanja Stefanovic wrote:
>
>> The auto_delete's per connection is a good idea. I had considered it but
>> it seemed like duplicating many bindings per connection per 'primary' queue
>> might have unnecessary overhead. I suppose there probably wouldn't be more
>> than a few per user, but how does creating new queues and ~15 or so bindings
>> for each affect system performance? The other reason for avoiding
>> re-creation of bindings each time is that the topics are collected from a
>> user-profile from a database. I really liked the exchange for this reason
>> because it allowed for minimizing DB-calls. I realize this is probably a
>> minor point though.
>>
>
> An alternative to duplicating the bindings would be to introduce
> exchange-to-exchange bindings; something that was originally envisaged in
> AMQP and wouldn't be too hard to add to RabbitMQ.
>
> You would then be able to have a three-level topology:
>
> 1) a topic exchange, just as you have now
> 2) one fanout exchange per user, with your ~15 bindings to the topic
> exchange
> 3) the primary and, temporarily, the secondary per-user queues bound with a
> single binding each to the user's fanout exchange.
>
> You end up with one exchange and 15+1(+1 temporarily) bindings per user,
> which RabbitMQ should cope with fine and efficiently.
>
>  Lastly, the current 'primary' queue allows me to store messages/events in
>> it, so when the first client connects it can consume past messages and
>> display them in a "here's what you missed while you were away" kind of case.
>> I wouldn't be able to get this same behaviour with auto_delete queue's since
>> (as far as I know) there's no way to 'synchronize' their contents with the
>> ones of the' primary' queue.
>>
>
> So, if I understand you correctly ...
>
> - when none of the user's clients are connected, messages for that user
> should be buffered
>
> - when a user's client connects it should receive all buffered messages
> (i.e. messages that have not been sent to *any* of the user's clients),
> followed by any new messages
>
> That's an interesting use case.
>
> One possible approach is to have one permanent queue per user and then
> temporary queues for each client, with all queues having the same bindings
> (or being bound to the fanout exchange described above). Clients subscribe
> to to both the permanent queue and temporary queue and maintain state to
> allow them to spot duplicates, i.e. messages that came from both the
> permanent and temporary queue.
>
> While that is not the most efficient of solutions, the cost is bounded.
> Each message is sent to a client at most twice. And the de-dup state is
> bounded too - in the worst case you need to remember the hashes of all
> messages received from the permanent queue that have not been received (yet,
> or possibly never) from the temporary queue.
>
>  As for acknowledgements, I'm not using them in this case so I'm not too
>> worried about that.
>>
>
> Right, but it stops the broadcast-queue feature from being orthogonal.
> Other aspects that will break things are transactional acks, network flow
> control (which blocks consumers) and channel flow control (ditto).
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/1d1cec38/attachment.htm 

From alexis.richardson at gmail.com  Thu Apr 23 14:15:50 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 23 Apr 2009 14:15:50 +0100
Subject: [rabbitmq-discuss] "pubsub" meet-ups
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891066EDBB9311B@SVR-2K3-BH-EMC.tradition.int>
References: <167204d20904230447l28b17d4aq9e7b4c39b811396d@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E7891066EDBB9311B@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <167204d20904230615t41ec2991kc1980a9318b2920@mail.gmail.com>

On Thu, Apr 23, 2009 at 1:07 PM, Alister Morton
<Alister.Morton at tradition.com> wrote:
>> For people who are interested in the next such event, I have created a public google group called "pub-sub".
>
> This seems to be a group to discuss someone's travels???

For some reason the group address is not showing up on google search yet.

Here are the essentials:

* Group name: pub-sub
* Group home page: http://groups.google.com/group/pub-sub
* Group email address pub-sub at googlegroups.com



From oliver at obeattie.com  Thu Apr 23 16:54:41 2009
From: oliver at obeattie.com (Oliver Beattie)
Date: Thu, 23 Apr 2009 05:54:41 -1000
Subject: [rabbitmq-discuss] AMQP and Python
Message-ID: <7a12fa870904230854s72f8cfc3i7607deed68540f13@mail.gmail.com>

Hey Guys,

I just wanted to get some advice on using RabbitMQ (well, of course, more
generally AMQP) from Python. We are going to be using RabbitMQ to queue
background jobs for our Django application to queue a lot of back-end tasks,
and I was wondering if anyone has experience doing this with Python?

So, as far as I can see I have three options open to me:
   * Qpid
   * txAMQP
   * py-amqplib

But from what I can gather from my pokings around on the interwebs, none of
them are that widely used? In terms of maturity, Qpid seems to be the most
solid of the lot? would anyone agree? I also noticed something called
carrot, but frankly that looks a little iffy to me.

In short, I really don't know which way to go. Performance is very important
for us, so the library that performs the best is obviously preferable. If
anyone has experience or advice they can give, I'd love to hear which way
you'd go :)
Thanks!
Oliver
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/777be333/attachment.htm 

From alexis.richardson at gmail.com  Thu Apr 23 17:04:45 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 23 Apr 2009 17:04:45 +0100
Subject: [rabbitmq-discuss] AMQP and Python
In-Reply-To: <7a12fa870904230854s72f8cfc3i7607deed68540f13@mail.gmail.com>
References: <7a12fa870904230854s72f8cfc3i7607deed68540f13@mail.gmail.com>
Message-ID: <167204d20904230904t7d285d37nc107af4b05410dec@mail.gmail.com>

Oliver

You might find this useful as a link store:
http://delicious.com/alexisrichardson/rabbitmq+python

In particular, does this help?  http://www.peloton-grid.net/site/labs/
 (I have not had time to look at it in full yet)

I think most people are using txAMQP and py-amqplib.  I hear good
things about both.  This is not meant to diss any of the other
clients.  There are definitely some ways in which txAMQP and
py-amqplib could be improved based on the use cases which folks wish
to support.  I am not qualified to discuss those ways.

Carrot for Django is new but its author seems to have an interest in
performance.

alexis



On Thu, Apr 23, 2009 at 4:54 PM, Oliver Beattie <oliver at obeattie.com> wrote:
> Hey Guys,
>
> I just wanted to get some advice on using RabbitMQ (well, of course,?more
> generally AMQP) from Python. We are going to be using RabbitMQ to?queue
> background jobs for our Django application to queue a lot of?back-end tasks,
> and I was wondering if anyone has experience doing?this with Python?
>
> So, as far as I can see I have three options open to me:
> ? ?* Qpid
> ? ?* txAMQP
> ? ?* py-amqplib
>
> But from what I can gather from my pokings around on the interwebs,?none of
> them are that widely used? In terms of maturity, Qpid seems to?be the most
> solid of the lot? would anyone agree? I also noticed?something called
> carrot, but frankly that looks a little iffy to me.
>
> In short, I really don't know which way to go. Performance is very?important
> for us, so the library that performs the best is?obviously?preferable. If
> anyone has experience or advice they can give, I'd love?to hear which way
> you'd go :)
> Thanks!
> Oliver
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From terry at jon.es  Thu Apr 23 17:43:55 2009
From: terry at jon.es (Terry Jones)
Date: Thu, 23 Apr 2009 18:43:55 +0200
Subject: [rabbitmq-discuss] AMQP and Python
In-Reply-To: Your message at 17:04:45 on Thursday, 23 April 2009
References: <7a12fa870904230854s72f8cfc3i7607deed68540f13@mail.gmail.com>
	<167204d20904230904t7d285d37nc107af4b05410dec@mail.gmail.com>
Message-ID: <18928.39627.547194.775897@jon.es>

Hi Oliver (and Alexis)

> I think most people are using txAMQP and py-amqplib.  I hear good things
> about both.  This is not meant to diss any of the other clients.  There
> are definitely some ways in which txAMQP and py-amqplib could be improved
> based on the use cases which folks wish to support.  I am not qualified
> to discuss those ways.

Nor am I :-)

But I can make a few quick points:

 - If you're not working with Twisted, or planning to, then using txAMQP is
   out of the question. This is a litmus test - if you're doing Twisted
   stuff you will surely want txAMQP; if not you will surely want
   py-amqplib.

 - txAMQP also includes Thrift support
   (http://incubator.apache.org/thrift/).  That's really nice if you're
   interested in RPC. I use txAMQP all the time, and once you have
   exchanges and queues set up and bound etc., you can make regular Python
   Twisted calls to methods in remote services and you get back a Deferred
   that fires when the result is available. All this goes through AMQP but
   you're not aware of that - txAMQP hides all the details of thrift and
   AMQP.  I certainly wouldn't say it's simple to put all this together,
   but if you're heading in that direction you're likely going to want
   something like that anyway. But, see above comment - you have to drink
   the Twisted Kool-Aid.

 - I can't say anything in particular about qpid (btw, it's a broker, not a
   client library - just in case that wasn't clear). I mention this because
   you say you're going to use RabbitMQ but then you mention qpid.

 - We (at Fluidinfo) are using txAMQP all the time, and are committed to
   supporting and improving it.  We have not yet done much stress or
   performance testing, but we'll get there. It's a young project. There
   are a few people who regularly submit questions, test things, and submit
   fixes.  We are also very concerned with performance.

 - Esteve Fernandez (who wrote the txAMQP code) told me the other day that
   he'd managed to hook txAMQP up to Django. That's not released but he'll
   surely be happy to send you the code if you want it. He's got a lot
   going on just now, so may not reply until next week.

Alexis, please feel free to post your thoughts, or feedback you've had from
others, about how txAMQP might be improved. You, or anyone, can also submit
comments or questions via our Launchpad PPA. https://launchpad.net/txamqp

OK, hope that helps!

Terry



From oliver at obeattie.com  Thu Apr 23 18:00:35 2009
From: oliver at obeattie.com (Oliver Beattie)
Date: Thu, 23 Apr 2009 07:00:35 -1000
Subject: [rabbitmq-discuss] AMQP and Python
In-Reply-To: <18928.39627.547194.775897@jon.es>
References: <7a12fa870904230854s72f8cfc3i7607deed68540f13@mail.gmail.com>
	<167204d20904230904t7d285d37nc107af4b05410dec@mail.gmail.com>
	<18928.39627.547194.775897@jon.es>
Message-ID: <7a12fa870904231000u591ef223i45f52277a8f28158@mail.gmail.com>

Hi Guys,

Thanks so much for replying so quickly. It's great to see the community is
so willing to share advice :)

You might find this useful as a link store:
> http://delicious.com/alexisrichardson/rabbitmq+python


Thank you for this, there looks to be a lot of good stuff there I hadn't
already seen :)

 - If you're not working with Twisted, or planning to, then using txAMQP is
>   out of the question. This is a litmus test - if you're doing Twisted
>   stuff you will surely want txAMQP; if not you will surely want
>   py-amqplib.
>

At the moment, no, we don't do anything with Twisted; though since we aren't
doing anything asynchronously right now (which is obviously changing), I am
open to start using it? I was considering running Django inside a Twisted
WSGI container, which would work I believe?


>  - I can't say anything in particular about qpid (btw, it's a broker, not a
>   client library - just in case that wasn't clear). I mention this because
>   you say you're going to use RabbitMQ but then you mention qpid.


Ah, of course. Sorry, my ignorance of this is showing :)


>  - Esteve Fernandez (who wrote the txAMQP code) told me the other day that
>   he'd managed to hook txAMQP up to Django. That's not released but he'll
>   surely be happy to send you the code if you want it. He's got a lot
>   going on just now, so may not reply until next week.


That would be awesome, I'd really love to see how that was done. Obviously
I'm just starting down the road of implementing this stuff and seeing how
others have done this would be a great help.

?Oliver
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/6fcc45c5/attachment.htm 

From alexis.richardson at gmail.com  Thu Apr 23 18:04:46 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 23 Apr 2009 18:04:46 +0100
Subject: [rabbitmq-discuss] AMQP and Python
In-Reply-To: <18928.39627.547194.775897@jon.es>
References: <7a12fa870904230854s72f8cfc3i7607deed68540f13@mail.gmail.com>
	<167204d20904230904t7d285d37nc107af4b05410dec@mail.gmail.com>
	<18928.39627.547194.775897@jon.es>
Message-ID: <167204d20904231004i2067bd7blba2e6192e21ee46d@mail.gmail.com>

Terry,

Thanks for that detailed note.  Very useful.  Indeed, I have heard a
lot of good things about twisted and txAMQP as a way for Pythonists to
Rabbit.  Mainly this is anecdotal stuff that is hard to remember but
from time to time I get to snapshot a use case and stick it on
del.icio.us.  Concerning ways to make txAMQP better, my impression was
that this was use case driven and not dissatisfaction.  As soon as I
can, I shall encourage the people concerned to suggest away.

alexis




On Thu, Apr 23, 2009 at 5:43 PM, Terry Jones <terry at jon.es> wrote:
> Hi Oliver (and Alexis)
>
>> I think most people are using txAMQP and py-amqplib. ?I hear good things
>> about both. ?This is not meant to diss any of the other clients. ?There
>> are definitely some ways in which txAMQP and py-amqplib could be improved
>> based on the use cases which folks wish to support. ?I am not qualified
>> to discuss those ways.
>
> Nor am I :-)
>
> But I can make a few quick points:
>
> ?- If you're not working with Twisted, or planning to, then using txAMQP is
> ? out of the question. This is a litmus test - if you're doing Twisted
> ? stuff you will surely want txAMQP; if not you will surely want
> ? py-amqplib.
>
> ?- txAMQP also includes Thrift support
> ? (http://incubator.apache.org/thrift/). ?That's really nice if you're
> ? interested in RPC. I use txAMQP all the time, and once you have
> ? exchanges and queues set up and bound etc., you can make regular Python
> ? Twisted calls to methods in remote services and you get back a Deferred
> ? that fires when the result is available. All this goes through AMQP but
> ? you're not aware of that - txAMQP hides all the details of thrift and
> ? AMQP. ?I certainly wouldn't say it's simple to put all this together,
> ? but if you're heading in that direction you're likely going to want
> ? something like that anyway. But, see above comment - you have to drink
> ? the Twisted Kool-Aid.
>
> ?- I can't say anything in particular about qpid (btw, it's a broker, not a
> ? client library - just in case that wasn't clear). I mention this because
> ? you say you're going to use RabbitMQ but then you mention qpid.
>
> ?- We (at Fluidinfo) are using txAMQP all the time, and are committed to
> ? supporting and improving it. ?We have not yet done much stress or
> ? performance testing, but we'll get there. It's a young project. There
> ? are a few people who regularly submit questions, test things, and submit
> ? fixes. ?We are also very concerned with performance.
>
> ?- Esteve Fernandez (who wrote the txAMQP code) told me the other day that
> ? he'd managed to hook txAMQP up to Django. That's not released but he'll
> ? surely be happy to send you the code if you want it. He's got a lot
> ? going on just now, so may not reply until next week.
>
> Alexis, please feel free to post your thoughts, or feedback you've had from
> others, about how txAMQP might be improved. You, or anyone, can also submit
> comments or questions via our Launchpad PPA. https://launchpad.net/txamqp
>
> OK, hope that helps!
>
> Terry
>



From alexis.richardson at gmail.com  Thu Apr 23 18:20:29 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 23 Apr 2009 18:20:29 +0100
Subject: [rabbitmq-discuss] AMQP and Python
In-Reply-To: <167204d20904231004i2067bd7blba2e6192e21ee46d@mail.gmail.com>
References: <7a12fa870904230854s72f8cfc3i7607deed68540f13@mail.gmail.com>
	<167204d20904230904t7d285d37nc107af4b05410dec@mail.gmail.com>
	<18928.39627.547194.775897@jon.es>
	<167204d20904231004i2067bd7blba2e6192e21ee46d@mail.gmail.com>
Message-ID: <167204d20904231020x2f4ece95t533312ad27f2a8fd@mail.gmail.com>

Folks,

Here is another txAMQP blog post: http://app.arat.us/blog/?p=67

a


On Thu, Apr 23, 2009 at 6:04 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> Terry,
>
> Thanks for that detailed note. ?Very useful. ?Indeed, I have heard a
> lot of good things about twisted and txAMQP as a way for Pythonists to
> Rabbit. ?Mainly this is anecdotal stuff that is hard to remember but
> from time to time I get to snapshot a use case and stick it on
> del.icio.us. ?Concerning ways to make txAMQP better, my impression was
> that this was use case driven and not dissatisfaction. ?As soon as I
> can, I shall encourage the people concerned to suggest away.
>
> alexis
>
>
>
>
> On Thu, Apr 23, 2009 at 5:43 PM, Terry Jones <terry at jon.es> wrote:
>> Hi Oliver (and Alexis)
>>
>>> I think most people are using txAMQP and py-amqplib. ?I hear good things
>>> about both. ?This is not meant to diss any of the other clients. ?There
>>> are definitely some ways in which txAMQP and py-amqplib could be improved
>>> based on the use cases which folks wish to support. ?I am not qualified
>>> to discuss those ways.
>>
>> Nor am I :-)
>>
>> But I can make a few quick points:
>>
>> ?- If you're not working with Twisted, or planning to, then using txAMQP is
>> ? out of the question. This is a litmus test - if you're doing Twisted
>> ? stuff you will surely want txAMQP; if not you will surely want
>> ? py-amqplib.
>>
>> ?- txAMQP also includes Thrift support
>> ? (http://incubator.apache.org/thrift/). ?That's really nice if you're
>> ? interested in RPC. I use txAMQP all the time, and once you have
>> ? exchanges and queues set up and bound etc., you can make regular Python
>> ? Twisted calls to methods in remote services and you get back a Deferred
>> ? that fires when the result is available. All this goes through AMQP but
>> ? you're not aware of that - txAMQP hides all the details of thrift and
>> ? AMQP. ?I certainly wouldn't say it's simple to put all this together,
>> ? but if you're heading in that direction you're likely going to want
>> ? something like that anyway. But, see above comment - you have to drink
>> ? the Twisted Kool-Aid.
>>
>> ?- I can't say anything in particular about qpid (btw, it's a broker, not a
>> ? client library - just in case that wasn't clear). I mention this because
>> ? you say you're going to use RabbitMQ but then you mention qpid.
>>
>> ?- We (at Fluidinfo) are using txAMQP all the time, and are committed to
>> ? supporting and improving it. ?We have not yet done much stress or
>> ? performance testing, but we'll get there. It's a young project. There
>> ? are a few people who regularly submit questions, test things, and submit
>> ? fixes. ?We are also very concerned with performance.
>>
>> ?- Esteve Fernandez (who wrote the txAMQP code) told me the other day that
>> ? he'd managed to hook txAMQP up to Django. That's not released but he'll
>> ? surely be happy to send you the code if you want it. He's got a lot
>> ? going on just now, so may not reply until next week.
>>
>> Alexis, please feel free to post your thoughts, or feedback you've had from
>> others, about how txAMQP might be improved. You, or anyone, can also submit
>> comments or questions via our Launchpad PPA. https://launchpad.net/txamqp
>>
>> OK, hope that helps!
>>
>> Terry
>>
>



From alexis.richardson at gmail.com  Thu Apr 23 18:27:16 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 23 Apr 2009 18:27:16 +0100
Subject: [rabbitmq-discuss] Ubuntu 9.04 is out today
Message-ID: <167204d20904231027n255459fbuc204f7f79fdb0394@mail.gmail.com>

Hi everyone,

We have some great news.

As of today, Ubuntu 9.04 is officially released by Canonical.  We at
the RabbitMQ team are extremely happy to let everyone know that this
contains RabbitMQ as part of the distro.  We very much look forward to
working with the Canonical team in the future.  They have been
super-helpful.

The Canonical press release is here:
http://www.emediawire.com/releases/2009/4/prweb2340344.htm  Feel free
to share this URL with people who ask about AMQP adoption ;-)

Right ... off to the launch party to happily hop...

alexis



From nemik at nemik.net  Thu Apr 23 18:28:46 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Thu, 23 Apr 2009 12:28:46 -0500
Subject: [rabbitmq-discuss] Ubuntu 9.04 is out today
In-Reply-To: <167204d20904231027n255459fbuc204f7f79fdb0394@mail.gmail.com>
References: <167204d20904231027n255459fbuc204f7f79fdb0394@mail.gmail.com>
Message-ID: <acceaadf0904231028s477cd619k7f90cccc4bbaef86@mail.gmail.com>

Congratulations guys! This is great news and hopefully makes RabbitMQ even
more popular.

-Nemanja

On Thu, Apr 23, 2009 at 12:27 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Hi everyone,
>
> We have some great news.
>
> As of today, Ubuntu 9.04 is officially released by Canonical.  We at
> the RabbitMQ team are extremely happy to let everyone know that this
> contains RabbitMQ as part of the distro.  We very much look forward to
> working with the Canonical team in the future.  They have been
> super-helpful.
>
> The Canonical press release is here:
> http://www.emediawire.com/releases/2009/4/prweb2340344.htm  Feel free
> to share this URL with people who ask about AMQP adoption ;-)
>
> Right ... off to the launch party to happily hop...
>
> alexis
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/ba902100/attachment.htm 

From rkaulakis at gmail.com  Thu Apr 23 20:37:17 2009
From: rkaulakis at gmail.com (Ryan Kaulakis)
Date: Thu, 23 Apr 2009 15:37:17 -0400
Subject: [rabbitmq-discuss] RabbitMQ Erlang Client
Message-ID: <590e4f640904231237m144e5a4co76f9d69b3643e64f@mail.gmail.com>

Hello Everyone,
I'm sure these questions have been asked before, but I'm starting on a
project that I'd like to use the library for:
1) What is the preferred way of using the erlang client for RabbitMQ?
I've seen examples that deal directly with the amqp_channel and
amqp_connection modules directly (with records like
#'queue.declare_ok'{} and such), but there also seems to be a lib_amqp
module as well. Is one more stable that the other?
2) What header file are all of those AMQP specific records defined
(like #'queue.declare')? I'm guessing that they're auto-generated
somewhere but I'd like to take a look at what is actually out there.
3) What plans are there for supporting AMQP 1-0 when the standard is approved?

Thanks a bunch,
Ryan Kaulakis



From sustrik at imatix.com  Thu Apr 23 20:39:47 2009
From: sustrik at imatix.com (Martin Sustrik)
Date: Thu, 23 Apr 2009 21:39:47 +0200
Subject: [rabbitmq-discuss] Ubuntu 9.04 is out today
In-Reply-To: <167204d20904231027n255459fbuc204f7f79fdb0394@mail.gmail.com>
References: <167204d20904231027n255459fbuc204f7f79fdb0394@mail.gmail.com>
Message-ID: <49F0C403.6000800@imatix.com>

Congratulations!

Martin

Alexis Richardson wrote:
> Hi everyone,
> 
> We have some great news.
> 
> As of today, Ubuntu 9.04 is officially released by Canonical.  We at
> the RabbitMQ team are extremely happy to let everyone know that this
> contains RabbitMQ as part of the distro.  We very much look forward to
> working with the Canonical team in the future.  They have been
> super-helpful.
> 
> The Canonical press release is here:
> http://www.emediawire.com/releases/2009/4/prweb2340344.htm  Feel free
> to share this URL with people who ask about AMQP adoption ;-)
> 
> Right ... off to the launch party to happily hop...
> 
> alexis
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From askh at opera.com  Thu Apr 23 20:50:04 2009
From: askh at opera.com (Ask Solem)
Date: Thu, 23 Apr 2009 21:50:04 +0200
Subject: [rabbitmq-discuss] AMQP and Python
In-Reply-To: <167204d20904230904t7d285d37nc107af4b05410dec@mail.gmail.com>
References: <7a12fa870904230854s72f8cfc3i7607deed68540f13@mail.gmail.com>
	<167204d20904230904t7d285d37nc107af4b05410dec@mail.gmail.com>
Message-ID: <E49A091C-9CBA-4BBD-9824-A6B0C0F4C950@opera.com>


On Apr 23, 2009, at 6:04 PM, Alexis Richardson wrote:
>
> Carrot for Django is new but its author seems to have an interest in
> performance.
>

Actually, carrot is not a client on its own. It's more a high-level  
framework to make messaging easier in python (especially Django).

Right now it's using py-amqlib as the backend, I chose it because it  
was the easiest for me to use (I don't have any experience using  
twisted). I've been thinking about a txAMQP backend for carrot too.  
Any help is appreciated.

Performance is important to me, but I doubt the sending/receiving  
messages part will be the bottleneck for the project I'm working on  
now. I'm using the multiprocessing module new to Python 2.6  
(backported to 2.5) to process the jobs concurrently, and it's working  
great so far! Spread over two machines and ten concurrent processes,  
the work I'm doing takes 8 seconds, compared to the 57 seconds it did  
before when using a single process without messaging.

Thanks a lot for RabbitMQ by the way, although I'm pretty new
to this, I'm really excited!

-- 
Ask Solem <askh at opera.com>
http://github.com/ask



From chime at mu.dk  Thu Apr 23 21:05:32 2009
From: chime at mu.dk (Michael Arnoldus)
Date: Thu, 23 Apr 2009 22:05:32 +0200
Subject: [rabbitmq-discuss] AMQP and Python
In-Reply-To: <E49A091C-9CBA-4BBD-9824-A6B0C0F4C950@opera.com>
References: <7a12fa870904230854s72f8cfc3i7607deed68540f13@mail.gmail.com>
	<167204d20904230904t7d285d37nc107af4b05410dec@mail.gmail.com>
	<E49A091C-9CBA-4BBD-9824-A6B0C0F4C950@opera.com>
Message-ID: <8EAC544E-70AF-4157-AA65-755F4478F99C@mu.dk>

Just for completeness sake - Qpid is a broker and several client  
implementations, including a python one.

We're using the Qpid python client (actually an old version),  
primarily because it was the only one available at the time we started  
with RabbitMQ.

I have no measurements on performance.

We don't want to use twisted and be forced to code in event-based  
style and py-amqplib doesn't seem to handle multithreaded code too  
well (at least that's my current understanding - please correct me if  
I'm wrong). So there's no real alternative to using the Qpid client in  
my case.

Michael Arnoldus

On Apr 23, 2009, at 21:50 , Ask Solem wrote:

>
> On Apr 23, 2009, at 6:04 PM, Alexis Richardson wrote:
>>
>> Carrot for Django is new but its author seems to have an interest in
>> performance.
>>
>
> Actually, carrot is not a client on its own. It's more a high-level
> framework to make messaging easier in python (especially Django).
>
> Right now it's using py-amqlib as the backend, I chose it because it
> was the easiest for me to use (I don't have any experience using
> twisted). I've been thinking about a txAMQP backend for carrot too.
> Any help is appreciated.
>
> Performance is important to me, but I doubt the sending/receiving
> messages part will be the bottleneck for the project I'm working on
> now. I'm using the multiprocessing module new to Python 2.6
> (backported to 2.5) to process the jobs concurrently, and it's working
> great so far! Spread over two machines and ten concurrent processes,
> the work I'm doing takes 8 seconds, compared to the 57 seconds it did
> before when using a single process without messaging.
>
> Thanks a lot for RabbitMQ by the way, although I'm pretty new
> to this, I'm really excited!
>
> -- 
> Ask Solem <askh at opera.com>
> http://github.com/ask
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/cec1a1af/attachment.bin 

From theczintheroc2007 at gmail.com  Thu Apr 23 21:44:01 2009
From: theczintheroc2007 at gmail.com (Colin Z)
Date: Thu, 23 Apr 2009 16:44:01 -0400
Subject: [rabbitmq-discuss] Erlang client problem
Message-ID: <ce47f6b80904231344v43ca473wd10c233fa01de980@mail.gmail.com>

Trying to get the erlang client to be able to connect to a local rabbit node
and am having some issues.

I start rabbit normally via rabbitmqctl, nothing special here.

I then start a separate erl shell (with paths to the erlang rabbit client
specified) and try this command:
amqp_connection:start("guest", "guest", "localhost").

This hangs forever.

The rabbit log looks like this:

=INFO REPORT==== 23-Apr-2009::16:40:07 ===
started TCP listener on 0.0.0.0:5672

=INFO REPORT==== 23-Apr-2009::16:40:19 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1649

=INFO REPORT==== 23-Apr-2009::16:40:19 ===
starting TCP connection <0.138.0> from 127.0.0.1:1649

=ERROR REPORT==== 23-Apr-2009::16:40:29 ===
error on TCP connection <0.138.0> from 127.0.0.1:1649
{handshake_timeout,frame_header}

=INFO REPORT==== 23-Apr-2009::16:40:29 ===
closing TCP connection <0.138.0> from 127.0.0.1:1649


Any ideas?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/7f7c3960/attachment.htm 

From matthias at lshift.net  Thu Apr 23 21:54:35 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 23 Apr 2009 21:54:35 +0100
Subject: [rabbitmq-discuss] Erlang client problem
In-Reply-To: <ce47f6b80904231344v43ca473wd10c233fa01de980@mail.gmail.com>
References: <ce47f6b80904231344v43ca473wd10c233fa01de980@mail.gmail.com>
Message-ID: <49F0D58B.8090403@lshift.net>

Colin,

Colin Z wrote:
> Trying to get the erlang client to be able to connect to a local rabbit 
> node and am having some issues.

The behaviour you are seeing is symptomatic of a version 
incompatibility. What versions of the server and client are you running?


Regards,

Matthias.



From matthias at lshift.net  Thu Apr 23 22:41:33 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 23 Apr 2009 22:41:33 +0100
Subject: [rabbitmq-discuss] Erlang client problem
In-Reply-To: <ce47f6b80904231416h5df54562ude0bf5f874112981@mail.gmail.com>
References: <ce47f6b80904231344v43ca473wd10c233fa01de980@mail.gmail.com>	<49F0D58B.8090403@lshift.net>
	<ce47f6b80904231416h5df54562ude0bf5f874112981@mail.gmail.com>
Message-ID: <49F0E08D.6050806@lshift.net>

Colin,

Colin Z wrote:
> rabbit 1.5.4
> 
> Not sure about the client version, I grabbed it from the Hg repository 
> on 4/14, so it's probably very recent. Should I try the .zip available 
> on the rabbit website?

You should use the v1_5 branch of the client, as per the instructions at
   http://www.rabbitmq.com/mercurial.html


Matthias.



From matthias at lshift.net  Thu Apr 23 23:00:55 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 23 Apr 2009 23:00:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ Erlang Client
In-Reply-To: <590e4f640904231237m144e5a4co76f9d69b3643e64f@mail.gmail.com>
References: <590e4f640904231237m144e5a4co76f9d69b3643e64f@mail.gmail.com>
Message-ID: <49F0E517.3000407@lshift.net>

Ryan,

Ryan Kaulakis wrote:
> 1) What is the preferred way of using the erlang client for RabbitMQ?
> I've seen examples that deal directly with the amqp_channel and
> amqp_connection modules directly (with records like
> #'queue.declare_ok'{} and such), but there also seems to be a lib_amqp
> module as well. Is one more stable that the other?

lib_amqp contains convenience wrappers for the amqp_{connection,channel} 
functions. In some cases they can save quite a bit of typing for common 
uses of AMQP. However, the wrappers are rather ad-hoc and do not provide 
anywhere near complete coverage of the AMQP functionality. Personally I 
prefer to just use the core functions. YMMV.

In theory the wrappers could insulate you somewhat from changes at the 
protocol level, but because of their ad-hoc nature they are actually 
more likely to change than the protocol. Also, the use of default values 
in the record definitions provide some a degree of stability in the 
presence of protocol changes.

> 2) What header file are all of those AMQP specific records defined
> (like #'queue.declare')? I'm guessing that they're auto-generated
> somewhere but I'd like to take a look at what is actually out there.

rabbit_framing.hrl, which is indeed auto-generated and can be found in 
the server "binary" packages.

> 3) What plans are there for supporting AMQP 1-0 when the standard is
> approved?

Please ask that question again nearer the time :)


Regards,

Matthias.



From nemik at nemik.net  Thu Apr 23 23:01:17 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Thu, 23 Apr 2009 17:01:17 -0500
Subject: [rabbitmq-discuss] STOMP Authentication Idea
Message-ID: <acceaadf0904231501i39f445fdhd52936ac75b8f1a1@mail.gmail.com>

Hello,

I just wanted to contribute some code I recently changes if anyone needs it.
We have a use-case where I'm using STOMP with RabbitMQ's STOMP adapter and
Orbited to push updates to a browser, or maybe even allow clients to connect
to the STOMP server, not sure yet. Anyway, we need to ensure that only
certain users get pushed certain content, hence authentication.

The way I have this working is: client connects to STOMP with generic
just-TLD cookie (so it can be passed also to STOMP server which would run on
another subdomain) and Orbited's io.js can read the cookie and send it up to
the STOMP adapter as a 'cookie' header. It (the JS) also generates a random
ID for the queue-name for that connection. This is all assuming I have 1
queue per connection as per the broadcast-style suggestion for STOMP
adapter.

So now the STOMP adapter reads that cookie header and hits a page using
http:request (via inets) with that cookie and passes in the queue name too.
The web-app will recognize the cookie as belonging to a user and read the
queue name. It (the web-app) will then set the appropriate bindings for that
user. Since this is a topic exchange, the bindings would be for the topics
updates the user will receive on her browser. If there is no cookie or the
cookie is invalid, the web-app can take care of all that and just assign
some default bindings for guests.

This is all working pretty well, except that I have to start 'inets:start()'
manually in the erl command prompt. I was wondering how could I get this to
be done on startup when the STOMP adapter starts?

I've attached the code and a diff (based on the tip of STOMP adapter from
hg). Right now the URL is hardcoded but I plan to make that more
configurable later.

Anyway, I hope maybe it can be of some use to someone who might need similar
functionality.

-Nemanja
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/06ae049a/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: auth.diff
Type: application/octet-stream
Size: 2616 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/06ae049a/attachment.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_stomp.erl
Type: application/octet-stream
Size: 25468 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090423/06ae049a/attachment-0001.obj 

From rkaulakis at gmail.com  Fri Apr 24 01:18:25 2009
From: rkaulakis at gmail.com (Ryan Kaulakis)
Date: Thu, 23 Apr 2009 20:18:25 -0400
Subject: [rabbitmq-discuss] RabbitMQ Erlang Client
In-Reply-To: <49F0E517.3000407@lshift.net>
References: <590e4f640904231237m144e5a4co76f9d69b3643e64f@mail.gmail.com>
	<49F0E517.3000407@lshift.net>
Message-ID: <590e4f640904231718qea83183w189f123059b96e97@mail.gmail.com>

Matthias,
I appreciate the quick response. Thanks for answering my questions,
that should be enough for me to work with.

Thanks,
Ryan



On Thu, Apr 23, 2009 at 6:00 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Ryan,
>
> Ryan Kaulakis wrote:
>>
>> 1) What is the preferred way of using the erlang client for RabbitMQ?
>> I've seen examples that deal directly with the amqp_channel and
>> amqp_connection modules directly (with records like
>> #'queue.declare_ok'{} and such), but there also seems to be a lib_amqp
>> module as well. Is one more stable that the other?
>
> lib_amqp contains convenience wrappers for the amqp_{connection,channel}
> functions. In some cases they can save quite a bit of typing for common uses
> of AMQP. However, the wrappers are rather ad-hoc and do not provide anywhere
> near complete coverage of the AMQP functionality. Personally I prefer to
> just use the core functions. YMMV.
>
> In theory the wrappers could insulate you somewhat from changes at the
> protocol level, but because of their ad-hoc nature they are actually more
> likely to change than the protocol. Also, the use of default values in the
> record definitions provide some a degree of stability in the presence of
> protocol changes.
>
>> 2) What header file are all of those AMQP specific records defined
>> (like #'queue.declare')? I'm guessing that they're auto-generated
>> somewhere but I'd like to take a look at what is actually out there.
>
> rabbit_framing.hrl, which is indeed auto-generated and can be found in the
> server "binary" packages.
>
>> 3) What plans are there for supporting AMQP 1-0 when the standard is
>> approved?
>
> Please ask that question again nearer the time :)
>
>
> Regards,
>
> Matthias.
>



From kdr2 at x-macro.com  Fri Apr 24 02:37:15 2009
From: kdr2 at x-macro.com (KDr2)
Date: Fri, 24 Apr 2009 09:37:15 +0800
Subject: [rabbitmq-discuss] The Message Selector
In-Reply-To: <efc790a30904150507i7390770al65278105cc5ab90b@mail.gmail.com>
References: <efc790a30904142329p114c8d37r3a31d2d68e6cdaf7@mail.gmail.com> 
	<167204d20904150411s7baaf817wad9d17858a24c5de@mail.gmail.com> 
	<efc790a30904150507i7390770al65278105cc5ab90b@mail.gmail.com>
Message-ID: <efc790a30904231837n22d5d97cg287a39f31925b5c7@mail.gmail.com>

I  put the rabbitmq-client package on
http://x-macro.com/depot/carrot/carrot_cpp_0.1.zip,
Notes it's only tested on linux-32bit machine yet, Someone may need it.

On Wed, Apr 15, 2009 at 8:07 PM, KDr2 <kdr2 at x-macro.com> wrote:

> I modified the RabbitMQ's code, and provide a patch for RabbitMQ-1.5.4, you
> can use it like this:
>
> unzip rabbitmq-server-1.5.4.zip
> cd rabbitmq-server-1.5.4/
> patch -p1 < /path/to/carrot-rabbitmq-1.5.4-090413.patch
>
> Then you should make the rabbitmq,after that, your rabbitmq server will
> have the "Message Selector"
> and "Dead Message Queue" feature.
>
> Your server is changed, your client need some changes too(client API needs
> no changes,the way you
> use the API needs some changes), I provider some code to show how you use
> client API after you apply
> the patch, the python code is just a client code example. So, my work is
> not python specific.
>
> I has written a c++ client for RabbitMQ(AMQP-Spec-08) under linux 32bit, It
> will be released after more
> testing.
>
>
> On Wed, Apr 15, 2009 at 7:11 PM, Alexis Richardson <
> alexis.richardson at gmail.com> wrote:
>
>> Hey that looks pretty neat!
>>
>> Can you talk a bit more about how you are doing it?  Is it python
>> specific?  (I did not look at your code)
>>
>> Also you mention a C++ client... any plans for that?
>>
>> alexis
>>
>>
>> On Wed, Apr 15, 2009 at 7:29 AM, KDr2 <kdr2 at x-macro.com> wrote:
>> > I just made some extension for RabbitMQ, It is about Message Selector
>> and
>> > Dead Message,
>> > maybe someone need it, here it is:
>> >
>> > http://x-macro.com/products/carrot
>> >
>> >
>> > --
>> > Best Regards,
>> >    -- KDr2, at x-macro.com.
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>
>
>
> --
> Best Regards,
>    -- KDr2, at x-macro.com.
>



-- 
Best Regards,
   -- KDr2, at x-macro.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090424/c0852647/attachment.htm 

From celldee at gmail.com  Sat Apr 25 07:08:39 2009
From: celldee at gmail.com (Chris Duncan)
Date: Sat, 25 Apr 2009 07:08:39 +0100
Subject: [rabbitmq-discuss] Headers exchange in RabbitMQ v1.5.4
Message-ID: <52C55961-81B4-4FBE-8334-9D1C75592181@gmail.com>

I recently installed RabbitMQ v1.5.4 and have been testing some Ruby
code. The headers exchange type does not seem to be implemented in the
server that I'm running. When I look at the output from 'rabbitmqctl
list_queues' there is no mention of an 'amq.match' exchange and I get
an error message if I try to instantiate an exchange of type
'headers'.

Could anyone please tell me whether they have had a similar experience
or confirm the presence/absence of the headers exchange in RabbitMQ
v1.5.4 ?

Regards,

Chris Duncan



From matthias at lshift.net  Sat Apr 25 08:39:22 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 25 Apr 2009 08:39:22 +0100
Subject: [rabbitmq-discuss] Headers exchange in RabbitMQ v1.5.4
In-Reply-To: <52C55961-81B4-4FBE-8334-9D1C75592181@gmail.com>
References: <52C55961-81B4-4FBE-8334-9D1C75592181@gmail.com>
Message-ID: <49F2BE2A.6070003@lshift.net>

Chris,

Chris Duncan wrote:
> I recently installed RabbitMQ v1.5.4 and have been testing some Ruby
> code. The headers exchange type does not seem to be implemented in the
> server that I'm running.

headers exchanges have not made it into an official release yet. You can 
find them in our mercurial repo though.


Regards,

Matthias.



From celldee at gmail.com  Sat Apr 25 10:56:34 2009
From: celldee at gmail.com (Chris Duncan)
Date: Sat, 25 Apr 2009 10:56:34 +0100
Subject: [rabbitmq-discuss] Headers exchange in RabbitMQ v1.5.4
In-Reply-To: <49F2BE2A.6070003@lshift.net>
References: <52C55961-81B4-4FBE-8334-9D1C75592181@gmail.com>
	<49F2BE2A.6070003@lshift.net>
Message-ID: <76E97A03-8474-4416-96E0-1AB74009E898@gmail.com>


On 25 Apr 2009, at 08:39, Matthias Radestock wrote:

> Chris,
>
> Chris Duncan wrote:
>> I recently installed RabbitMQ v1.5.4 and have been testing some Ruby
>> code. The headers exchange type does not seem to be implemented in  
>> the
>> server that I'm running.
>
> headers exchanges have not made it into an official release yet.  
> You can find them in our mercurial repo though.
>
>
> Regards,
>
> Matthias.

Thanks Mathias, that explains a lot :)

Regards,

Chris




From alexis.richardson at gmail.com  Sat Apr 25 12:34:33 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 25 Apr 2009 12:34:33 +0100
Subject: [rabbitmq-discuss] The Message Selector
In-Reply-To: <efc790a30904231837n22d5d97cg287a39f31925b5c7@mail.gmail.com>
References: <efc790a30904142329p114c8d37r3a31d2d68e6cdaf7@mail.gmail.com>
	<167204d20904150411s7baaf817wad9d17858a24c5de@mail.gmail.com>
	<efc790a30904150507i7390770al65278105cc5ab90b@mail.gmail.com>
	<efc790a30904231837n22d5d97cg287a39f31925b5c7@mail.gmail.com>
Message-ID: <167204d20904250434r4a887a27qc7f119546e35eb1e@mail.gmail.com>

Thanks very much for sharing this!

I think this is a client that several folks will want to try out and I
look forward to hearing about that.

alexis

On Fri, Apr 24, 2009 at 2:37 AM, KDr2 <kdr2 at x-macro.com> wrote:
> I? put the rabbitmq-client package on
> http://x-macro.com/depot/carrot/carrot_cpp_0.1.zip,
> Notes it's only tested on linux-32bit machine yet, Someone may need it.
>
> On Wed, Apr 15, 2009 at 8:07 PM, KDr2 <kdr2 at x-macro.com> wrote:
>>
>> I modified the RabbitMQ's code, and provide a patch for RabbitMQ-1.5.4,
>> you can use it like this:
>>
>> unzip rabbitmq-server-1.5.4.zip
>> cd rabbitmq-server-1.5.4/
>> patch -p1 < /path/to/carrot-rabbitmq-1.5.4-090413.patch
>>
>> Then you should make the rabbitmq,after that, your rabbitmq server will
>> have the "Message Selector"
>> and "Dead Message Queue" feature.
>>
>> Your server is changed, your client need some changes too(client API needs
>> no changes,the way you
>> use the API needs some changes), I provider some code to show how you use
>> client API after you apply
>> the patch, the python code is just a client code example. So, my work is
>> not python specific.
>>
>> I has written a c++ client for RabbitMQ(AMQP-Spec-08) under linux 32bit,
>> It will be released after more
>> testing.
>>
>> On Wed, Apr 15, 2009 at 7:11 PM, Alexis Richardson
>> <alexis.richardson at gmail.com> wrote:
>>>
>>> Hey that looks pretty neat!
>>>
>>> Can you talk a bit more about how you are doing it? ?Is it python
>>> specific? ?(I did not look at your code)
>>>
>>> Also you mention a C++ client... any plans for that?
>>>
>>> alexis
>>>
>>>
>>> On Wed, Apr 15, 2009 at 7:29 AM, KDr2 <kdr2 at x-macro.com> wrote:
>>> > I just made some extension for RabbitMQ, It is about Message Selector
>>> > and
>>> > Dead Message,
>>> > maybe someone need it, here it is:
>>> >
>>> > http://x-macro.com/products/carrot
>>> >
>>> >
>>> > --
>>> > Best Regards,
>>> > ? ?-- KDr2, at x-macro.com.
>>> >
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com
>>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >
>>> >
>>
>>
>>
>> --
>> Best Regards,
>> ? ?-- KDr2, at x-macro.com.
>
>
>
> --
> Best Regards,
> ? ?-- KDr2, at x-macro.com.
>



From celldee at gmail.com  Sat Apr 25 16:26:19 2009
From: celldee at gmail.com (Chris Duncan)
Date: Sat, 25 Apr 2009 16:26:19 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous Ruby
	AMQP client
Message-ID: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>

Bunny is intended to be a synchronous Ruby AMQP client. It's housed  
on GitHub (http://github.com/celldee/bunny) and Rubyforge (http:// 
rubyforge.org/projects/bunny-amqp). I would be very grateful if  
anyone who's interested could try it out and give me some feedback  
and/or suggestions for improvements and new features. Someone might  
even decide to hack on it themselves :)

I started Bunny as a learning aid for RabbitMQ, but now I'm getting  
quite enthusiastic about it so I've made it into an official project.

I hope that somebody other than me gets some use out of it.

Regards,

Chris



From alexis.richardson at gmail.com  Sat Apr 25 19:36:43 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 25 Apr 2009 19:36:43 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous
	Ruby AMQP client
In-Reply-To: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
References: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
Message-ID: <167204d20904251136i35db6a88u4692862fb192b48@mail.gmail.com>

Chris,

That is very cool.  Thank-you for posting this to the list.

I was wondering if you had seen Carrot which sets out to solve the
same problem?  I think it has been developed from @tmm1's EM client.
I am cc'ing the author (Amos).

http://github.com/famoseagle/carrot/tree/master

It would be interesting to see a comparison of the two approaches.

Possibly related to this, I saw Andrew Kuklewicz, author of
ActiveMessaging, mention that he was thinking about getting his code
to work with RabbitMQ in a blog post recently.

alexis



On Sat, Apr 25, 2009 at 4:26 PM, Chris Duncan <celldee at gmail.com> wrote:
> Bunny is intended to be a synchronous Ruby AMQP client. It's housed
> on GitHub (http://github.com/celldee/bunny) and Rubyforge (http://
> rubyforge.org/projects/bunny-amqp). I would be very grateful if
> anyone who's interested could try it out and give me some feedback
> and/or suggestions for improvements and new features. Someone might
> even decide to hack on it themselves :)
>
> I started Bunny as a learning aid for RabbitMQ, but now I'm getting
> quite enthusiastic about it so I've made it into an official project.
>
> I hope that somebody other than me gets some use out of it.
>
> Regards,
>
> Chris
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From celldee at gmail.com  Sat Apr 25 20:39:50 2009
From: celldee at gmail.com (Chris Duncan)
Date: Sat, 25 Apr 2009 20:39:50 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous
	Ruby AMQP client
In-Reply-To: <167204d20904251136i35db6a88u4692862fb192b48@mail.gmail.com>
References: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
	<167204d20904251136i35db6a88u4692862fb192b48@mail.gmail.com>
Message-ID: <3D01DA29-8DDA-4568-B36A-57CA8AB9DB81@gmail.com>

Alexis,

I emailed Amos (carrot) and Aman (amqp) to tell them what I was doing  
as I've used a whole lot of their code. Those guys have done some  
impressive work, I've just chopped it around a bit to suit my  
purposes so all credit goes to them.

There are two things that I'm thinking about now -

1. The codegen stuff that parses the json AMQP spec could do with  
it's own project. I'm thinking that it could play a similar role to  
the one that Rack does for Ruby webservers. Maybe someone's already  
doing that.

2. I heard mention of getting at the rabbitmqctl type of  
functionality via JInterface. I mean the 'list_queues',  
'list_exchanges' sort of things. I don't just want to put a wrapper  
around rabbitmqctl. I'm no Java man, but maybe we can do something  
with JRuby in this area. I've done a rudimentary test of Bunny in  
JRuby 1.2.0 and it seems to stand up (test specs and examples run).

Anyway, thanks for your interest and comments.

Regards,

Chris

On 25 Apr 2009, at 19:36, Alexis Richardson wrote:

> Chris,
>
> That is very cool.  Thank-you for posting this to the list.
>
> I was wondering if you had seen Carrot which sets out to solve the
> same problem?  I think it has been developed from @tmm1's EM client.
> I am cc'ing the author (Amos).
>
> http://github.com/famoseagle/carrot/tree/master
>
> It would be interesting to see a comparison of the two approaches.
>
> Possibly related to this, I saw Andrew Kuklewicz, author of
> ActiveMessaging, mention that he was thinking about getting his code
> to work with RabbitMQ in a blog post recently.
>
> alexis
>
>
>
> On Sat, Apr 25, 2009 at 4:26 PM, Chris Duncan <celldee at gmail.com>  
> wrote:
>> Bunny is intended to be a synchronous Ruby AMQP client. It's housed
>> on GitHub (http://github.com/celldee/bunny) and Rubyforge (http://
>> rubyforge.org/projects/bunny-amqp). I would be very grateful if
>> anyone who's interested could try it out and give me some feedback
>> and/or suggestions for improvements and new features. Someone might
>> even decide to hack on it themselves :)
>>
>> I started Bunny as a learning aid for RabbitMQ, but now I'm getting
>> quite enthusiastic about it so I've made it into an official project.
>>
>> I hope that somebody other than me gets some use out of it.
>>
>> Regards,
>>
>> Chris
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>




From abbaspour_amin at yahoo.com  Sun Apr 26 12:43:17 2009
From: abbaspour_amin at yahoo.com (Amin Abbaspour)
Date: Sun, 26 Apr 2009 04:43:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Consuming a Rollbacked Message
Message-ID: <455862.37226.qm@web50609.mail.re2.yahoo.com>


Dear All,

In my Java client, I cannot receive a message after I rollbacked its previous transaction and entry is returned to queue.

I open a transactional channel:
----
channel = connection.createChannel();
channel.queueDeclare(queueName);
consumer = new QueueingConsumer(channel);
channel.basicConsume(queueName, consumer);
channel.txSelect();
----

And rollback like this:
----
channel.txRollback();
----

but then this consumer does not receive anything from queue:
----
final QueueingConsumer.Delivery delivery = consumer.nextDelivery();
channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
----

This is while I can see that I have the entry in queue (via rabbitmqctl list_queues) and consumer receives this entry after I restart the application.

What I can? Is there something wrong with my rollback or ACK mechanism? should I do something more than a simple txRollback()?

I use the latest client and server (1.5.4). Java client in Ubuntu server.

Kind Regards,
Amin Abbaspour
http://twitter.com/abbaspour



      



From tonyg at lshift.net  Sun Apr 26 13:07:33 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 26 Apr 2009 13:07:33 +0100
Subject: [rabbitmq-discuss] Consuming a Rollbacked Message
In-Reply-To: <455862.37226.qm@web50609.mail.re2.yahoo.com>
References: <455862.37226.qm@web50609.mail.re2.yahoo.com>
Message-ID: <49F44E85.1050704@lshift.net>

Hi Amin,

Amin Abbaspour wrote:
> What I can? Is there something wrong with my rollback or ACK
> mechanism? should I do something more than a simple txRollback()?

TX-class transactions introduce grouping and limited atomicity for 
*publishes* and *acknowledgements*. This means that the scope of a 
transaction is only those basic.publish and basic.ack operations that 
the client has performed within the transaction. In particular, 
basic.delivers are not included in a transaction -- so it would be wrong 
for the server to resend them on a rollback!

A rollback, then, does not release any messages to other consumers, or 
cause them to be redelivered to this one; it is assumed by the server 
that since the client has seen the messages, and has clearly not crashed 
(since the connection is still open and healthy), there is no need to 
resend them. The server can trust the client in this case to continue 
thinking about which messages to acknowledge, and will wait for 
subsequent basic.acks followed by tx.commit.

If the client has forgotten what it has seen, it can use the 
basic.recover operation to get its pending deliveries resent. 
Alternatively, it can close and reopen the channel (though this has 
other consequences).

This is a confusing area of the spec: not only did we initially get our 
implementation wrong, other implementations did too, and in fact the 0-8 
spec does not fully specify the behaviour of rollbacks or basic.recover 
operations. Furthermore, there is a legitimate, if subtle, design 
question here: seen one way, the current behaviour -- transactional acks 
-- is correct; seen another, the alternative -- transactional deliveries 
-- is correct. (If you're interested, the former seems natural in a 
hub-and-spoke design for AMQP, but the latter starts to look oddly 
sensible in a fully peer-to-peer, internet-scale design...)

Regards,
   Tony



From abbaspour_amin at yahoo.com  Sun Apr 26 13:30:48 2009
From: abbaspour_amin at yahoo.com (Amin Abbaspour)
Date: Sun, 26 Apr 2009 05:30:48 -0700 (PDT)
Subject: [rabbitmq-discuss] Consuming a Rollbacked Message
In-Reply-To: <49F44E85.1050704@lshift.net>
Message-ID: <317121.73159.qm@web50601.mail.re2.yahoo.com>


Dear Tony,

I noticed your point. I wish this information what somewhere on site, since there is very little reflected about transactions in rabbitmq documents. 

For example I did not know before your mail that transactions are for acks and publish and not for deliver. This looks really odd for most of us whom have used to transactional consumers.

Then what is your proposed solution for this case? I don't like the reconnect model and is basic.recover the last alternative? How should I call it? periodically? I see basic.recover in docs but dono how to use it. 

Kind Regards and thanks for your help,
Amin Abbaspour

--- On Sun, 4/26/09, Tony Garnock-Jones <tonyg at lshift.net> wrote:

> From: Tony Garnock-Jones <tonyg at lshift.net>
> Subject: Re: [rabbitmq-discuss] Consuming a Rollbacked Message
> To: abbaspour_amin at yahoo.com
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Date: Sunday, April 26, 2009, 2:07 PM
> Hi Amin,
> 
> Amin Abbaspour wrote:
> > What I can? Is there something wrong with my rollback
> or ACK
> > mechanism? should I do something more than a simple
> txRollback()?
> 
> TX-class transactions introduce grouping and limited
> atomicity for *publishes* and *acknowledgements*. This means
> that the scope of a transaction is only those basic.publish
> and basic.ack operations that the client has performed
> within the transaction. In particular, basic.delivers are
> not included in a transaction -- so it would be wrong for
> the server to resend them on a rollback!
> 
> A rollback, then, does not release any messages to other
> consumers, or cause them to be redelivered to this one; it
> is assumed by the server that since the client has seen the
> messages, and has clearly not crashed (since the connection
> is still open and healthy), there is no need to resend them.
> The server can trust the client in this case to continue
> thinking about which messages to acknowledge, and will wait
> for subsequent basic.acks followed by tx.commit.
> 
> If the client has forgotten what it has seen, it can use
> the basic.recover operation to get its pending deliveries
> resent. Alternatively, it can close and reopen the channel
> (though this has other consequences).
> 
> This is a confusing area of the spec: not only did we
> initially get our implementation wrong, other
> implementations did too, and in fact the 0-8 spec does not
> fully specify the behaviour of rollbacks or basic.recover
> operations. Furthermore, there is a legitimate, if subtle,
> design question here: seen one way, the current behaviour --
> transactional acks -- is correct; seen another, the
> alternative -- transactional deliveries -- is correct. (If
> you're interested, the former seems natural in a
> hub-and-spoke design for AMQP, but the latter starts to look
> oddly sensible in a fully peer-to-peer, internet-scale
> design...)
> 
> Regards,
>   Tony


      



From alexis.richardson at gmail.com  Sun Apr 26 20:37:14 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sun, 26 Apr 2009 20:37:14 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous
	Ruby AMQP client
In-Reply-To: <3D01DA29-8DDA-4568-B36A-57CA8AB9DB81@gmail.com>
References: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
	<167204d20904251136i35db6a88u4692862fb192b48@mail.gmail.com>
	<3D01DA29-8DDA-4568-B36A-57CA8AB9DB81@gmail.com>
Message-ID: <167204d20904261237m682f910at77be165bef13f275@mail.gmail.com>

Chris,

On Sat, Apr 25, 2009 at 8:39 PM, Chris Duncan <celldee at gmail.com> wrote:
> Alexis,
>
> I emailed Amos (carrot) and Aman (amqp) to tell them what I was doing as
> I've used a whole lot of their code. Those guys have done some impressive
> work, I've just chopped it around a bit to suit my purposes so all credit
> goes to them.

Cool ;-)


> There are two things that I'm thinking about now -
>
> 1. The codegen stuff that parses the json AMQP spec could do with it's own
> project. I'm thinking that it could play a similar role to the one that Rack
> does for Ruby webservers. Maybe someone's already doing that.

Interesting.

Can you provide some more thinking on this?  Do you mean the RabbitMQ
codegen and if so, how would you split it out and where?  What I mean
is: what is the best way to socialise the code.



> 2. I heard mention of getting at the rabbitmqctl type of functionality via
> JInterface. I mean the 'list_queues', 'list_exchanges' sort of things. I
> don't just want to put a wrapper around rabbitmqctl. I'm no Java man, but
> maybe we can do something with JRuby in this area. I've done a rudimentary
> test of Bunny in JRuby 1.2.0 and it seems to stand up (test specs and
> examples run).

JInterface has been mentioned.  Again, feel free to continue this line
of thought on the list.  It is definitely interesting.  We would
really like to understand management better.

BTW on JRuby - this mboi:
http://github.com/jerryluk/rabbitmq-jruby-client/tree/master


> Anyway, thanks for your interest and comments.

My pleasure

alexis



> Regards,
>
> Chris
>
> On 25 Apr 2009, at 19:36, Alexis Richardson wrote:
>
>> Chris,
>>
>> That is very cool. ?Thank-you for posting this to the list.
>>
>> I was wondering if you had seen Carrot which sets out to solve the
>> same problem? ?I think it has been developed from @tmm1's EM client.
>> I am cc'ing the author (Amos).
>>
>> http://github.com/famoseagle/carrot/tree/master
>>
>> It would be interesting to see a comparison of the two approaches.
>>
>> Possibly related to this, I saw Andrew Kuklewicz, author of
>> ActiveMessaging, mention that he was thinking about getting his code
>> to work with RabbitMQ in a blog post recently.
>>
>> alexis
>>
>>
>>
>> On Sat, Apr 25, 2009 at 4:26 PM, Chris Duncan <celldee at gmail.com> wrote:
>>>
>>> Bunny is intended to be a synchronous Ruby AMQP client. It's housed
>>> on GitHub (http://github.com/celldee/bunny) and Rubyforge (http://
>>> rubyforge.org/projects/bunny-amqp). I would be very grateful if
>>> anyone who's interested could try it out and give me some feedback
>>> and/or suggestions for improvements and new features. Someone might
>>> even decide to hack on it themselves :)
>>>
>>> I started Bunny as a learning aid for RabbitMQ, but now I'm getting
>>> quite enthusiastic about it so I've made it into an official project.
>>>
>>> I hope that somebody other than me gets some use out of it.
>>>
>>> Regards,
>>>
>>> Chris
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
>



From celldee at gmail.com  Sun Apr 26 21:13:32 2009
From: celldee at gmail.com (Chris Duncan)
Date: Sun, 26 Apr 2009 21:13:32 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous
	Ruby AMQP client
In-Reply-To: <167204d20904261237m682f910at77be165bef13f275@mail.gmail.com>
References: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
	<167204d20904251136i35db6a88u4692862fb192b48@mail.gmail.com>
	<3D01DA29-8DDA-4568-B36A-57CA8AB9DB81@gmail.com>
	<167204d20904261237m682f910at77be165bef13f275@mail.gmail.com>
Message-ID: <C6EAD711-C7AD-4089-8D3A-6CB5D285E3EE@gmail.com>

Hi Alexis,

On 26 Apr 2009, at 20:37, Alexis Richardson wrote:

> Chris,
>
> On Sat, Apr 25, 2009 at 8:39 PM, Chris Duncan <celldee at gmail.com>  
> wrote:
>> Alexis,
>>
>> I emailed Amos (carrot) and Aman (amqp) to tell them what I was  
>> doing as
>> I've used a whole lot of their code. Those guys have done some  
>> impressive
>> work, I've just chopped it around a bit to suit my purposes so all  
>> credit
>> goes to them.
>
> Cool ;-)
>
>
>> There are two things that I'm thinking about now -
>>
>> 1. The codegen stuff that parses the json AMQP spec could do with  
>> it's own
>> project. I'm thinking that it could play a similar role to the one  
>> that Rack
>> does for Ruby webservers. Maybe someone's already doing that.
>
> Interesting.
>
> Can you provide some more thinking on this?  Do you mean the RabbitMQ
> codegen and if so, how would you split it out and where?  What I mean
> is: what is the best way to socialise the code.
>
>
>
>> 2. I heard mention of getting at the rabbitmqctl type of  
>> functionality via
>> JInterface. I mean the 'list_queues', 'list_exchanges' sort of  
>> things. I
>> don't just want to put a wrapper around rabbitmqctl. I'm no Java  
>> man, but
>> maybe we can do something with JRuby in this area. I've done a  
>> rudimentary
>> test of Bunny in JRuby 1.2.0 and it seems to stand up (test specs and
>> examples run).
>
> JInterface has been mentioned.  Again, feel free to continue this line
> of thought on the list.  It is definitely interesting.  We would
> really like to understand management better.
>
> BTW on JRuby - this mboi:
> http://github.com/jerryluk/rabbitmq-jruby-client/tree/master
>
>
>> Anyway, thanks for your interest and comments.
>
> My pleasure
>
> alexis

==============================================================

> Can you provide some more thinking on this?  Do you mean the RabbitMQ
> codegen and if so, how would you split it out and where?  What I mean
> is: what is the best way to socialise the code.

No, sorry I wasn't very clear. I don't mean the RabbitMQ codegen.py.  
I mean the codegen.rb script in Aman's amqp that parses the AMQP  
specification json document. I'm not sure where the json document  
comes from, maybe you could enlighten me :) It seems to me that the  
Ruby community could do with a reliable repository to get that code  
from rather than lifting it from amqp every time it's needed. It's  
fundamental to anything Ruby that wants to talk AMQP.  I've asked  
Aman and Amos about it, I don't know what  they think yet.

I'm new to the AMQP arena so I'm open to advice and guidance from  
anyone who wants to offer it :)

Thanks for the JRuby project link. I'll take a look.

Regards,

Chris



From alexis.richardson at gmail.com  Sun Apr 26 21:27:28 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sun, 26 Apr 2009 21:27:28 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous
	Ruby AMQP client
In-Reply-To: <C6EAD711-C7AD-4089-8D3A-6CB5D285E3EE@gmail.com>
References: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
	<167204d20904251136i35db6a88u4692862fb192b48@mail.gmail.com>
	<3D01DA29-8DDA-4568-B36A-57CA8AB9DB81@gmail.com>
	<167204d20904261237m682f910at77be165bef13f275@mail.gmail.com>
	<C6EAD711-C7AD-4089-8D3A-6CB5D285E3EE@gmail.com>
Message-ID: <167204d20904261327r5134505cnc03ac5278bbd8f22@mail.gmail.com>

Chris,

On Sun, Apr 26, 2009 at 9:13 PM, Chris Duncan <celldee at gmail.com> wrote:
>
>> Can you provide some more thinking on this? ?Do you mean the RabbitMQ
>> codegen and if so, how would you split it out and where? ?What I mean
>> is: what is the best way to socialise the code.
>
> No, sorry I wasn't very clear. I don't mean the RabbitMQ codegen.py. I mean
> the codegen.rb script in Aman's amqp that parses the AMQP specification json
> document. I'm not sure where the json document comes from, maybe you could
> enlighten me :)

Is it not the .json 0-8 document in 'files', here?

http://hg.rabbitmq.com/rabbitmq-codegen/

Also, just in case you have not seen it, does this help?

http://hopper.squarespace.com/blog/2008/6/21/build-your-own-amqp-client.html


> It seems to me that the Ruby community could do with a
> reliable repository to get that code from rather than lifting it from amqp
> every time it's needed. It's fundamental to anything Ruby that wants to talk
> AMQP. ?I've asked Aman and Amos about it, I don't know what ?they think yet.
>
> I'm new to the AMQP arena so I'm open to advice and guidance from anyone who
> wants to offer it :)

:-)

We'll do our best.




> Thanks for the JRuby project link. I'll take a look.
>
> Regards,
>
> Chris
>



From tonyg at lshift.net  Mon Apr 27 01:00:10 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 27 Apr 2009 01:00:10 +0100
Subject: [rabbitmq-discuss] Consuming a Rollbacked Message
In-Reply-To: <317121.73159.qm@web50601.mail.re2.yahoo.com>
References: <317121.73159.qm@web50601.mail.re2.yahoo.com>
Message-ID: <49F4F58A.4060506@lshift.net>

Hi Amin,

Amin Abbaspour wrote:
> Then what is your proposed solution for this case?

Either basic.recover, which does exactly what you want IIUC, or simply 
remember on the client side the unacked deliveries you have so far 
received, and revisit them at your leisure.

Regards,
   Tony




From vlm at lionet.info  Mon Apr 27 11:46:19 2009
From: vlm at lionet.info (Lev Walkin)
Date: Mon, 27 Apr 2009 03:46:19 -0700
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut: robustness
	problem
Message-ID: <49F58CFB.8070406@lionet.info>


During evaluation period, our RabbitMQ node has crashed at some point, 
killed by OOM killer. Unfortunately, killing corrupted the log files, so 
RabbitMQ restart did not fix the problem. RabbitMQ just would not start:

================
[broker at zamq ~]> /usr/local/bin/rabbitmq-server -kernel check_ip true 
-connect_all false
...
Logging to "/.../rabbitmq/log/rabbit.log"
SASL logging to "/.../rabbitmq/log/rabbit-sasl.log"

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...{"init terminating in 
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{badmatch,{error,{{{badmatch,eof},[{rabbit_persister,internal_load_snapshot,2},{rabbit_persister,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},{child,undefined,rabbit_persister,{rabbit_persister,start_link,[]},transient,100,worker,[rabbit_persister]}}}},[{rabbit,start_child,1},{rabbit,'-start/2-fun-4-',0},{rabbit,'-start/2-fun-0-',1},{lists,foreach,2},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}
init terminating in do_boot ()
[broker at zamq ~]>
=================

It turns out, the broker beam was killed during a persister operation, 
so persister logs were broken:

[broker at zamq ...]> ls -al | grep persister
-rw-r--r--  1 broker  wheel          8 Apr 24 18:48 rabbit_persister.LOG
-rw-r--r--  1 broker  wheel  661677171 Apr 24 18:19 
rabbit_persister.LOG.previous
[broker at zamq ~]> hd rabbit_persister.LOG
00000000  01 02 03 04 63 58 4d 0b                           |....cXM.|
00000008
[broker at zamq ...]>


I believe there is a way to make such error recovery more robust. Is 
there a solution you'd like to introduce for this kind of problem?

-- 
Lev Walkin
vlm at lionet.info



From brian at echonest.com  Mon Apr 27 15:00:33 2009
From: brian at echonest.com (Brian Whitman)
Date: Mon, 27 Apr 2009 10:00:33 -0400
Subject: [rabbitmq-discuss] millions of unack'd messages in a day -- disk
	store instead of ram?
Message-ID: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>

We run rabbitMQ on Amazon EC2 "small" servers (1.7GB ram.) The rabbitMQ
install is out of the box, simply installing from the debian package. We
access rabbit through a python AMQP interface (py-amqplib) and wrapper
client that we set up like this:
http://github.com/bwhitman/py-amqplib-wrapper/tree/master

Our use is probably non-normative: we keep millions of messages around most
of the day. An average message stays in a queue for up to 12 hours, and we
have a dozen or so queues that each reach about 1 million messages at peak.

We quickly determined that a single EC2 small node can support up to about
1-2m un-ack'd messages before it runs out of ram. And when it runs out of
ram the rabbit instance stops responding. To get around this we boot more
rabbit nodes and we shard via a consistent hash that routes messages based
on their ID. This gets us more message capacity but gets expensive and has
more moving parts that can break.

I am wondering if there is a better way. I would gladly take a message
consume speed hit to be able to have the rabbit store backed by disk instead
of keeping it live in ram as it seems to. Is this possible? How do people
set up simple message queues that can store millions of messages for long
periods of time?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090427/51f06e98/attachment.htm 

From alexis.richardson at gmail.com  Mon Apr 27 15:04:01 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 27 Apr 2009 15:04:01 +0100
Subject: [rabbitmq-discuss] millions of unack'd messages in a day --
	disk store instead of ram?
In-Reply-To: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>
Message-ID: <167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>

Brian

Your question is timely.  We are working on a feature in which
persistent messages are stored only on disk, instead of concurrently
on disk and in ram.  If you peruse the archives you will see some info
about this (eg timelines).

You may find this blog post relevant:
http://www.lshift.net/blog/2009/04/02/cranial-surgery-giving-rabbit-more-memory

What disk store do you use on Amazon?  Is it S3 or EBS?

alexis



On Mon, Apr 27, 2009 at 3:00 PM, Brian Whitman <brian at echonest.com> wrote:
> We run rabbitMQ on Amazon EC2 "small" servers (1.7GB ram.) The rabbitMQ
> install is out of the box, simply installing from the debian package. We
> access rabbit through a python AMQP interface (py-amqplib) and wrapper
> client that we set up like
> this:?http://github.com/bwhitman/py-amqplib-wrapper/tree/master
> Our use is probably non-normative: we keep millions of messages around most
> of the day. An average message stays in a queue for up to 12 hours, and we
> have a dozen or so queues that each reach about 1 million messages at peak.
> We quickly determined that a single EC2 small node can support up to about
> 1-2m un-ack'd messages before it runs out of ram. And when it runs out of
> ram the rabbit instance stops responding. To get around this we boot more
> rabbit nodes and we?shard via a consistent hash that routes messages based
> on their ID. This gets us more message capacity but gets expensive and has
> more moving parts that can break.
> I am wondering if there is a better way. I would gladly take a message
> consume speed hit to be able to have the rabbit store backed by disk instead
> of keeping it live in ram as it seems to. Is this possible? How do people
> set up simple message queues that can store millions of messages for long
> periods of time?
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Mon Apr 27 15:17:28 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 27 Apr 2009 15:17:28 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous
	Ruby AMQP client
In-Reply-To: <167204d20904261443l72bb8dbbl172b108bfc4c120f@mail.gmail.com>
References: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
	<167204d20904251136i35db6a88u4692862fb192b48@mail.gmail.com>
	<3D01DA29-8DDA-4568-B36A-57CA8AB9DB81@gmail.com>
	<167204d20904261237m682f910at77be165bef13f275@mail.gmail.com>
	<C6EAD711-C7AD-4089-8D3A-6CB5D285E3EE@gmail.com>
	<167204d20904261327r5134505cnc03ac5278bbd8f22@mail.gmail.com>
	<E3CB0804-323A-4F85-839C-ABFCC0970E37@gmail.com>
	<167204d20904261443l72bb8dbbl172b108bfc4c120f@mail.gmail.com>
Message-ID: <167204d20904270717l782c38bbm128a2134be834ac8@mail.gmail.com>

Chris,

OK - I have discussed this with Tony from the RabbitMQ engineering team.

There are two ways to proceed, both of which would require Aman's
consent and enthusiasm.  (He is cc'd).

1.  We copy Aman's codegen.rb to RabbitMQ's mercurial repo, and the
community uses that as the root file for .rb code generation.

2.  The codegen.rb file is refactored into two parts, one that
generates core protocol constructs, and one that generates
client-specific constructs (eg for EM in the case of Aman's client).
According to Tony, something like this is done in the .py code
generation.

If Aman likes the idea and someone is willing to help with 2, then
this might be a good outcome.

What do you think?

alexis




On Sun, Apr 26, 2009 at 10:43 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> On Sun, Apr 26, 2009 at 10:15 PM, Chris Duncan <celldee at gmail.com> wrote:
>> I did read Ben Hood's article thanks. It mentions parsing the json spec but
>> not who or what builds it. I went to the AMQP site and could see a .xml spec
>> but not a json version.
>
> Chris, as I mentioned: Is it not the .json 0-8 document in 'files', here?
>
> http://hg.rabbitmq.com/rabbitmq-codegen/
>
>
>
>> Does someone at Rabbit produce the json version?
>
> The doc in the above repo was created by John Leuner as a way to help Rabbit.
>
>
>
>> So to clarify. To build an AMQP client, you have to get hold of the
>> appropriate json spec and parse it using a codegen emitter for your chosen
>> language. Then you use the output from that to implement protocol methods
>> that can be used to produce an API. What I am suggesting is that the codegen
>> emitter in amqp (Aman's project) might become the de facto standard for
>> Ruby, provided that it can be maintained in a way that copes with changes to
>> the AMQP spec.
>>
>> I have no idea who should ultimately be the custodian of it, but I guess the
>> basic requirements are a good grasp of Ruby and excellent knowledge of AMQP
>> and the spec in particular. I know one thing; I don't qualify :)
>
> I need to discuss this with the engineering team and with Aman, and
> get back to you. ?We're happy to maintain all sorts of core code but
> are not Ruby experts.
>
> Thanks for the suggestion!
>
> alexis
>
>
>
>> Regards,
>>
>> Chris
>> On 26 Apr 2009, at 21:27, Alexis Richardson wrote:
>>
>>> Chris,
>>>
>>> On Sun, Apr 26, 2009 at 9:13 PM, Chris Duncan <celldee at gmail.com> wrote:
>>>>
>>>>> Can you provide some more thinking on this? ?Do you mean the RabbitMQ
>>>>> codegen and if so, how would you split it out and where? ?What I mean
>>>>> is: what is the best way to socialise the code.
>>>>
>>>> No, sorry I wasn't very clear. I don't mean the RabbitMQ codegen.py. I
>>>> mean
>>>> the codegen.rb script in Aman's amqp that parses the AMQP specification
>>>> json
>>>> document. I'm not sure where the json document comes from, maybe you
>>>> could
>>>> enlighten me :)
>>>
>>> Is it not the .json 0-8 document in 'files', here?
>>>
>>> http://hg.rabbitmq.com/rabbitmq-codegen/
>>>
>>> Also, just in case you have not seen it, does this help?
>>>
>>>
>>> http://hopper.squarespace.com/blog/2008/6/21/build-your-own-amqp-client.html
>>>
>>>
>>>> It seems to me that the Ruby community could do with a
>>>> reliable repository to get that code from rather than lifting it from
>>>> amqp
>>>> every time it's needed. It's fundamental to anything Ruby that wants to
>>>> talk
>>>> AMQP. ?I've asked Aman and Amos about it, I don't know what ?they think
>>>> yet.
>>>>
>>>> I'm new to the AMQP arena so I'm open to advice and guidance from anyone
>>>> who
>>>> wants to offer it :)
>>>
>>> :-)
>>>
>>> We'll do our best.
>>>
>>>
>>>
>>>
>>>> Thanks for the JRuby project link. I'll take a look.
>>>>
>>>> Regards,
>>>>
>>>> Chris
>>>>
>>
>>
>



From celldee at gmail.com  Mon Apr 27 15:29:42 2009
From: celldee at gmail.com (Chris Duncan)
Date: Mon, 27 Apr 2009 15:29:42 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous
	Ruby AMQP client
In-Reply-To: <167204d20904270717l782c38bbm128a2134be834ac8@mail.gmail.com>
References: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
	<167204d20904251136i35db6a88u4692862fb192b48@mail.gmail.com>
	<3D01DA29-8DDA-4568-B36A-57CA8AB9DB81@gmail.com>
	<167204d20904261237m682f910at77be165bef13f275@mail.gmail.com>
	<C6EAD711-C7AD-4089-8D3A-6CB5D285E3EE@gmail.com>
	<167204d20904261327r5134505cnc03ac5278bbd8f22@mail.gmail.com>
	<E3CB0804-323A-4F85-839C-ABFCC0970E37@gmail.com>
	<167204d20904261443l72bb8dbbl172b108bfc4c120f@mail.gmail.com>
	<167204d20904270717l782c38bbm128a2134be834ac8@mail.gmail.com>
Message-ID: <462C34D2-B245-46A8-94AE-C65A675F9FA3@gmail.com>


On 27 Apr 2009, at 15:17, Alexis Richardson wrote:

> Chris,
>
> OK - I have discussed this with Tony from the RabbitMQ engineering  
> team.
>
> There are two ways to proceed, both of which would require Aman's
> consent and enthusiasm.  (He is cc'd).
>
> 1.  We copy Aman's codegen.rb to RabbitMQ's mercurial repo, and the
> community uses that as the root file for .rb code generation.
>
> 2.  The codegen.rb file is refactored into two parts, one that
> generates core protocol constructs, and one that generates
> client-specific constructs (eg for EM in the case of Aman's client).
> According to Tony, something like this is done in the .py code
> generation.
>
> If Aman likes the idea and someone is willing to help with 2, then
> this might be a good outcome.
>
> What do you think?
>
> alexis
>

Thanks very much for your efforts Alexis. The second option sounds  
good to me. Hopefully Aman will take kindly to the idea. He's rapidly  
becoming the Ruby AMQP poster boy :)

Regards,

Chris




From alexis.richardson at gmail.com  Mon Apr 27 16:35:40 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 27 Apr 2009 16:35:40 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous
	Ruby AMQP client
In-Reply-To: <462C34D2-B245-46A8-94AE-C65A675F9FA3@gmail.com>
References: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
	<167204d20904251136i35db6a88u4692862fb192b48@mail.gmail.com>
	<3D01DA29-8DDA-4568-B36A-57CA8AB9DB81@gmail.com>
	<167204d20904261237m682f910at77be165bef13f275@mail.gmail.com>
	<C6EAD711-C7AD-4089-8D3A-6CB5D285E3EE@gmail.com>
	<167204d20904261327r5134505cnc03ac5278bbd8f22@mail.gmail.com>
	<E3CB0804-323A-4F85-839C-ABFCC0970E37@gmail.com>
	<167204d20904261443l72bb8dbbl172b108bfc4c120f@mail.gmail.com>
	<167204d20904270717l782c38bbm128a2134be834ac8@mail.gmail.com>
	<462C34D2-B245-46A8-94AE-C65A675F9FA3@gmail.com>
Message-ID: <167204d20904270835u5ab9eacbi4b0fc2aff39799eb@mail.gmail.com>

Chris,

On Mon, Apr 27, 2009 at 3:29 PM, Chris Duncan <celldee at gmail.com> wrote:
>
>> 2. ?The codegen.rb file is refactored into two parts, one that
>> generates core protocol constructs, and one that generates
>> client-specific constructs (eg for EM in the case of Aman's client).
>> According to Tony, something like this is done in the .py code
>> generation.
>>
>> If Aman likes the idea and someone is willing to help with 2, then
>> this might be a good outcome.
>
> Thanks very much for your efforts Alexis. The second option sounds good to
> me. Hopefully Aman will take kindly to the idea. He's rapidly becoming the
> Ruby AMQP poster boy :)

:-)

If Aman does not mind someone doing this, would you be able to do the factoring?

alexis





> Regards,
>
> Chris
>
>



From brian at echonest.com  Mon Apr 27 16:51:14 2009
From: brian at echonest.com (Brian Whitman)
Date: Mon, 27 Apr 2009 11:51:14 -0400
Subject: [rabbitmq-discuss] millions of unack'd messages in a day --
	disk store instead of ram?
In-Reply-To: <167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>
	<167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>
Message-ID: <dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>

On Mon, Apr 27, 2009 at 10:04 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Brian
> You may find this blog post relevant:
>
> http://www.lshift.net/blog/2009/04/02/cranial-surgery-giving-rabbit-more-memory



Ah great, putting an EBS swap behind it is probably a good temp solution.
I'll give that a go and run some tests. Thanks for the pointer. I wouldn't
recommend anyone use S3 for this-- we max out at about 40-50 "keys"/files a
second from other ec2 instances.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090427/02a5a135/attachment.htm 

From alexis.richardson at gmail.com  Mon Apr 27 16:53:25 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 27 Apr 2009 16:53:25 +0100
Subject: [rabbitmq-discuss] millions of unack'd messages in a day --
	disk store instead of ram?
In-Reply-To: <dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>
	<167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>
	<dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>
Message-ID: <167204d20904270853o773cd989g13cb2c0ce60b2d74@mail.gmail.com>

Brian,

On Mon, Apr 27, 2009 at 4:51 PM, Brian Whitman <brian at echonest.com> wrote:
> On Mon, Apr 27, 2009 at 10:04 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Brian
>> You may find this blog post relevant:
>>
>> http://www.lshift.net/blog/2009/04/02/cranial-surgery-giving-rabbit-more-memory
>
> Ah great, putting an EBS swap behind it is probably a good temp solution.
> I'll give that a go and run some tests. Thanks for the pointer. I wouldn't
> recommend anyone use S3 for this-- we max out at about 40-50 "keys"/files a
> second from other ec2 instances.

I have heard others have been successful with EBS.  Please do let us
all know how you get on!

alexis



From celldee at gmail.com  Mon Apr 27 17:27:28 2009
From: celldee at gmail.com (Chris Duncan)
Date: Mon, 27 Apr 2009 17:27:28 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous
	Ruby AMQP client
In-Reply-To: <167204d20904270835u5ab9eacbi4b0fc2aff39799eb@mail.gmail.com>
References: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
	<167204d20904251136i35db6a88u4692862fb192b48@mail.gmail.com>
	<3D01DA29-8DDA-4568-B36A-57CA8AB9DB81@gmail.com>
	<167204d20904261237m682f910at77be165bef13f275@mail.gmail.com>
	<C6EAD711-C7AD-4089-8D3A-6CB5D285E3EE@gmail.com>
	<167204d20904261327r5134505cnc03ac5278bbd8f22@mail.gmail.com>
	<E3CB0804-323A-4F85-839C-ABFCC0970E37@gmail.com>
	<167204d20904261443l72bb8dbbl172b108bfc4c120f@mail.gmail.com>
	<167204d20904270717l782c38bbm128a2134be834ac8@mail.gmail.com>
	<462C34D2-B245-46A8-94AE-C65A675F9FA3@gmail.com>
	<167204d20904270835u5ab9eacbi4b0fc2aff39799eb@mail.gmail.com>
Message-ID: <BE07C3BB-2BF8-4F8F-846C-14B9F0A733B2@gmail.com>


On 27 Apr 2009, at 16:35, Alexis Richardson wrote:

> Chris,
>
> On Mon, Apr 27, 2009 at 3:29 PM, Chris Duncan <celldee at gmail.com>  
> wrote:
>>
>>> 2.  The codegen.rb file is refactored into two parts, one that
>>> generates core protocol constructs, and one that generates
>>> client-specific constructs (eg for EM in the case of Aman's client).
>>> According to Tony, something like this is done in the .py code
>>> generation.
>>>
>>> If Aman likes the idea and someone is willing to help with 2, then
>>> this might be a good outcome.
>>
>> Thanks very much for your efforts Alexis. The second option sounds  
>> good to
>> me. Hopefully Aman will take kindly to the idea. He's rapidly  
>> becoming the
>> Ruby AMQP poster boy :)
>
> :-)
>
> If Aman does not mind someone doing this, would you be able to do  
> the factoring?
>
> alexis
>
>

Alexis,

I'd dearly love to take on the task, but a man has to know his  
limitations. I don't have the requisite knowledge to do any sort of a  
decent job of the refactoring. While I am trying to get to grips with  
as much of the low level stuff as I can, I'm nowhere near  
understanding enough to do anything useful. This has to be done  
properly, so the services of an industrial-strength 'bits and bytes'  
Ruby person are required. Sadly, I am not such a person :(

Regards,

Chris



From dmitriy.samovskiy at cohesiveft.com  Mon Apr 27 18:34:17 2009
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Mon, 27 Apr 2009 12:34:17 -0500
Subject: [rabbitmq-discuss] emulating rabbitmqctl from python
Message-ID: <49F5EC99.40408@cohesiveft.com>

Hi all,

In case anybody is interested, here is some sample code how one can emulate rabbitmqctl 
from python:

http://gist.github.com/102602

You'll need to change COOKIE and rabbit node name in rpc_list_bindings()


Cheers,
Dmitriy



From alexis.richardson at gmail.com  Mon Apr 27 19:37:17 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 27 Apr 2009 19:37:17 +0100
Subject: [rabbitmq-discuss] [ANN] Release v0.1.0 of Bunny a synchronous
	Ruby AMQP client
In-Reply-To: <BE07C3BB-2BF8-4F8F-846C-14B9F0A733B2@gmail.com>
References: <4D843C12-D208-4B9E-8ACA-230959C3FBCA@gmail.com>
	<167204d20904261237m682f910at77be165bef13f275@mail.gmail.com>
	<C6EAD711-C7AD-4089-8D3A-6CB5D285E3EE@gmail.com>
	<167204d20904261327r5134505cnc03ac5278bbd8f22@mail.gmail.com>
	<E3CB0804-323A-4F85-839C-ABFCC0970E37@gmail.com>
	<167204d20904261443l72bb8dbbl172b108bfc4c120f@mail.gmail.com>
	<167204d20904270717l782c38bbm128a2134be834ac8@mail.gmail.com>
	<462C34D2-B245-46A8-94AE-C65A675F9FA3@gmail.com>
	<167204d20904270835u5ab9eacbi4b0fc2aff39799eb@mail.gmail.com>
	<BE07C3BB-2BF8-4F8F-846C-14B9F0A733B2@gmail.com>
Message-ID: <167204d20904271137l6c0c3c9ar707cce926af72d44@mail.gmail.com>

Chris, we would be happy to advise.

Aman, if you see this, please let us know what you think..

alexis


On Mon, Apr 27, 2009 at 5:27 PM, Chris Duncan <celldee at gmail.com> wrote:
>
> On 27 Apr 2009, at 16:35, Alexis Richardson wrote:
>
>> Chris,
>>
>> On Mon, Apr 27, 2009 at 3:29 PM, Chris Duncan <celldee at gmail.com> wrote:
>>>
>>>> 2. ?The codegen.rb file is refactored into two parts, one that
>>>> generates core protocol constructs, and one that generates
>>>> client-specific constructs (eg for EM in the case of Aman's client).
>>>> According to Tony, something like this is done in the .py code
>>>> generation.
>>>>
>>>> If Aman likes the idea and someone is willing to help with 2, then
>>>> this might be a good outcome.
>>>
>>> Thanks very much for your efforts Alexis. The second option sounds good
>>> to
>>> me. Hopefully Aman will take kindly to the idea. He's rapidly becoming
>>> the
>>> Ruby AMQP poster boy :)
>>
>> :-)
>>
>> If Aman does not mind someone doing this, would you be able to do the
>> factoring?
>>
>> alexis
>>
>>
>
> Alexis,
>
> I'd dearly love to take on the task, but a man has to know his limitations.
> I don't have the requisite knowledge to do any sort of a decent job of the
> refactoring. While I am trying to get to grips with as much of the low level
> stuff as I can, I'm nowhere near understanding enough to do anything useful.
> This has to be done properly, so the services of an industrial-strength
> 'bits and bytes' Ruby person are required. Sadly, I am not such a person :(
>
> Regards,
>
> Chris
>



From aaron.feng at gmail.com  Mon Apr 27 22:41:13 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Mon, 27 Apr 2009 17:41:13 -0400
Subject: [rabbitmq-discuss] How to build rabbit management console
Message-ID: <4e3934860904271441k5bbd8e33wa3a40178ad8697a1@mail.gmail.com>

This question has been asked at least a few times on this list before.
 Someone may find this blog post helpful.

http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/

Aaron



From aaron.feng at gmail.com  Mon Apr 27 22:57:04 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Mon, 27 Apr 2009 17:57:04 -0400
Subject: [rabbitmq-discuss] emulating rabbitmqctl from python
In-Reply-To: <49F5EC99.40408@cohesiveft.com>
References: <49F5EC99.40408@cohesiveft.com>
Message-ID: <4e3934860904271457k51fe6f57p3f6f491b5896c462@mail.gmail.com>

Hi Dmitriy,

Thanks for sharing this.  I didn't know about py-interface.  I have updated
my blog post (
http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/)
with
this info.

I do have a question about py-interface.  How does this compare with
jinterface in terms of reliability?  Are there any obvious gotchas?

Thanks,

Aaron

On Mon, Apr 27, 2009 at 1:34 PM, Dmitriy Samovskiy <
dmitriy.samovskiy at cohesiveft.com> wrote:
> Hi all,
>
> In case anybody is interested, here is some sample code how one can
emulate rabbitmqctl
> from python:
>
> http://gist.github.com/102602
>
> You'll need to change COOKIE and rabbit node name in rpc_list_bindings()
>
>
> Cheers,
> Dmitriy
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090427/06f7e5d0/attachment.htm 

From rgh at roughage.com.au  Tue Apr 28 01:33:21 2009
From: rgh at roughage.com.au (Richard Heycock)
Date: Tue, 28 Apr 2009 10:33:21 +1000
Subject: [rabbitmq-discuss] millions of unack'd messages in a day --
	disk store instead of ram?
In-Reply-To: <167204d20904270853o773cd989g13cb2c0ce60b2d74@mail.gmail.com>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>
	<167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>
	<dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>
	<167204d20904270853o773cd989g13cb2c0ce60b2d74@mail.gmail.com>
Message-ID: <1240878542-sup-2268@wrasse>

Excerpts from Alexis Richardson's message of Tue Apr 28 01:53:25 +1000 2009:
> Brian,
> 
> On Mon, Apr 27, 2009 at 4:51 PM, Brian Whitman <brian at echonest.com> wrote:
> > On Mon, Apr 27, 2009 at 10:04 AM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Brian
> >> You may find this blog post relevant:
> >>
> >> http://www.lshift.net/blog/2009/04/02/cranial-surgery-giving-rabbit-more-memory
> >
> > Ah great, putting an EBS swap behind it is probably a good temp solution.
> > I'll give that a go and run some tests. Thanks for the pointer. I wouldn't
> > recommend anyone use S3 for this-- we max out at about 40-50 "keys"/files a
> > second from other ec2 instances.
> 
> I have heard others have been successful with EBS.  Please do let us
> all know how you get on!

I'm using rabbitmq on EC2 and EBS. There is a bit of messing around with
getting the hostname setup correctly (I change the hostname and then add
"127.0.0.1 hostname" to /etc/hosts otherwise it will not survive
reboots) but aside from that it works well.

I would point out though that my volumes are not that high

rgh

> alexis
> 



From drew.smathers at gmail.com  Tue Apr 28 15:45:16 2009
From: drew.smathers at gmail.com (Drew Smathers)
Date: Tue, 28 Apr 2009 10:45:16 -0400
Subject: [rabbitmq-discuss] emulating rabbitmqctl from python
In-Reply-To: <4e3934860904271457k51fe6f57p3f6f491b5896c462@mail.gmail.com>
References: <49F5EC99.40408@cohesiveft.com>
	<4e3934860904271457k51fe6f57p3f6f491b5896c462@mail.gmail.com>
Message-ID: <368574aa0904280745i6ac88fe5vf075d9706b793917@mail.gmail.com>

2009/4/27 Aaron Feng <aaron.feng at gmail.com>:
> Hi Dmitriy,
>
> Thanks for sharing this. ?I didn't know about py-interface. ?I have updated
> my blog post
> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/)?with
> this info.
>
> I do have a question about py-interface. ?How does this compare with
> jinterface in terms of reliability? ?Are there any?obvious?gotchas?
> Thanks,
> Aaron


Also on the Python front, there is twotp (https://launchpad.net/twotp)
for Twisted users.  (Note: I can't speak good or bad to its stability
or completeness of feature set.)

-Drew



From kdr2 at x-macro.com  Wed Apr 29 04:08:35 2009
From: kdr2 at x-macro.com (KDr2)
Date: Wed, 29 Apr 2009 11:08:35 +0800
Subject: [rabbitmq-discuss] emulating rabbitmqctl from python
In-Reply-To: <368574aa0904280745i6ac88fe5vf075d9706b793917@mail.gmail.com>
References: <49F5EC99.40408@cohesiveft.com>
	<4e3934860904271457k51fe6f57p3f6f491b5896c462@mail.gmail.com> 
	<368574aa0904280745i6ac88fe5vf075d9706b793917@mail.gmail.com>
Message-ID: <efc790a30904282008s5d877097yfe1f3703b88cd5d3@mail.gmail.com>

I start a project called "erlix", the ruby interface of erlang, now with it
you can control rammbit in ruby!

http://code.google.com/p/erlix/
http://code.google.com/p/erlix/wiki/ErlixTutorial

On Tue, Apr 28, 2009 at 10:45 PM, Drew Smathers <drew.smathers at gmail.com>wrote:

> 2009/4/27 Aaron Feng <aaron.feng at gmail.com>:
> > Hi Dmitriy,
> >
> > Thanks for sharing this.  I didn't know about py-interface.  I have
> updated
> > my blog post
> > (
> http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/
> ) with
> > this info.
> >
> > I do have a question about py-interface.  How does this compare with
> > jinterface in terms of reliability?  Are there any obvious gotchas?
> > Thanks,
> > Aaron
>
>
> Also on the Python front, there is twotp (https://launchpad.net/twotp)
> for Twisted users.  (Note: I can't speak good or bad to its stability
> or completeness of feature set.)
>
> -Drew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Best Regards,
   -- KDr2, at x-macro.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090429/635ab45e/attachment.htm 

From ashley.ohq at gmail.com  Wed Apr 29 09:35:24 2009
From: ashley.ohq at gmail.com (Ashley van Gerven)
Date: Wed, 29 Apr 2009 18:35:24 +1000
Subject: [rabbitmq-discuss] Performance questions
Message-ID: <150a3aa50904290135h6e384b1eid03ce9ff09eb73c@mail.gmail.com>

Hi,

I'm fairly new to rabbitMQ - one of the tests I did was to read 1000
messages from rabbitMQ server running locally vs. reading 1000 messages from
another server (using .NET client).

Performance was approx 1000 per second connecting from the same server, vs
approx 200 p/s connecting from another server (single-node broker).

The IConnection and IModel were instantiated once and reused (I assume this
is best practice).

What would the bottlekneck be here that's limiting the reads to 200 p/s? My
guess would be the network hardware.

Are there any tricks with setting up or connecting to minimise read times?

And what sort of performance benefits can there usually be realized for
every node added to a cluster?


thanks
Ashley
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090429/198f717a/attachment.htm 

From celldee at gmail.com  Wed Apr 29 16:12:47 2009
From: celldee at gmail.com (Chris Duncan)
Date: Wed, 29 Apr 2009 16:12:47 +0100
Subject: [rabbitmq-discuss] Default headers exchange
Message-ID: <BCB54B34-0EBF-41EB-81A7-3252F7534B9E@gmail.com>

I've just been writing a piece of code that infers the exchange type  
from the exchange name for default exchanges (amq.*). As far as I  
know, the default exchange name for a headers exchange is specified  
as 'amq.match'. Does anybody know why it isn't 'amq.headers'?

Regards,

Chris




From matthias at lshift.net  Wed Apr 29 16:28:54 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Apr 2009 16:28:54 +0100
Subject: [rabbitmq-discuss] Default headers exchange
In-Reply-To: <BCB54B34-0EBF-41EB-81A7-3252F7534B9E@gmail.com>
References: <BCB54B34-0EBF-41EB-81A7-3252F7534B9E@gmail.com>
Message-ID: <49F87236.2050603@lshift.net>

Chris,

Chris Duncan wrote:
> I've just been writing a piece of code that infers the exchange type  
> from the exchange name for default exchanges (amq.*). As far as I  
> know, the default exchange name for a headers exchange is specified  
> as 'amq.match'. Does anybody know why it isn't 'amq.headers'?

AFAIK it's just an oversight. AMQP 0-9-1 has "headers" in the xml spec 
and "match" in the pdf spec. Rabbit defines both :)


Matthias.



From aaron.feng at gmail.com  Wed Apr 29 16:50:21 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Wed, 29 Apr 2009 11:50:21 -0400
Subject: [rabbitmq-discuss] cookie file on Windows
Message-ID: <4e3934860904290850q3573d864q1748cecdc4be6815@mail.gmail.com>

I can't seem to find the cookie file in "C:\Documents and
Settings\UserName\Application Data\RabbitMQ".  All I see is db and log
directories.

Am I looking at the wrong place?

I'm using the broker from hg, and I started by running the
rabbitmq-server.bat.

Thanks,

Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090429/08dde8ee/attachment.htm 

From matthias at lshift.net  Wed Apr 29 16:56:16 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Apr 2009 16:56:16 +0100
Subject: [rabbitmq-discuss] cookie file on Windows
In-Reply-To: <4e3934860904290850q3573d864q1748cecdc4be6815@mail.gmail.com>
References: <4e3934860904290850q3573d864q1748cecdc4be6815@mail.gmail.com>
Message-ID: <49F878A0.4090608@lshift.net>

Aaron,

Aaron Feng wrote:
> I can't seem to find the cookie file in "C:\Documents and 
> Settings\UserName\Application Data\RabbitMQ".  All I see is db and log 
> directories. 
>  
> Am I looking at the wrong place?

Possibly. Evaluate
   init:get_arguments(home).
in an Erlang shell. That will tell you what Erlang thinks the home 
directory is, which is where it will read/write the cookie file.


Matthias.



From holger at wizards.de  Wed Apr 29 16:59:13 2009
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Wed, 29 Apr 2009 17:59:13 +0200
Subject: [rabbitmq-discuss] cookie file on Windows
In-Reply-To: <4e3934860904290850q3573d864q1748cecdc4be6815@mail.gmail.com>
References: <4e3934860904290850q3573d864q1748cecdc4be6815@mail.gmail.com>
Message-ID: <49F87951.8050400@wizards.de>

Aaron Feng wrote:
> I can't seem to find the cookie file in "C:\Documents and
> Settings\UserName\Application Data\RabbitMQ".  All I see is db and log
> directories. 
>  
> Am I looking at the wrong place?

Try wherever %USERPROFILE% points to - that's where mine is.

-h



From aaron.feng at gmail.com  Wed Apr 29 17:16:55 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Wed, 29 Apr 2009 12:16:55 -0400
Subject: [rabbitmq-discuss] cookie file on Windows
In-Reply-To: <49F878A0.4090608@lshift.net>
References: <4e3934860904290850q3573d864q1748cecdc4be6815@mail.gmail.com>
	<49F878A0.4090608@lshift.net>
Message-ID: <4e3934860904290916t40c6db0jb333460e42a9d63f@mail.gmail.com>

Hi Matthias,

Thanks, I found it.  It ended up on a network drive.  Is there a way to
specify the location of the cookie file?

Thanks,

Aaron

On Wed, Apr 29, 2009 at 11:56 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Aaron,
>
> Aaron Feng wrote:
>
>> I can't seem to find the cookie file in "C:\Documents and
>> Settings\UserName\Application Data\RabbitMQ".  All I see is db and log
>> directories.  Am I looking at the wrong place?
>>
>
> Possibly. Evaluate
>  init:get_arguments(home).
> in an Erlang shell. That will tell you what Erlang thinks the home
> directory is, which is where it will read/write the cookie file.
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090429/b39a50a9/attachment.htm 

From celldee at gmail.com  Wed Apr 29 17:25:33 2009
From: celldee at gmail.com (Chris Duncan)
Date: Wed, 29 Apr 2009 17:25:33 +0100
Subject: [rabbitmq-discuss] Default headers exchange
In-Reply-To: <49F87236.2050603@lshift.net>
References: <BCB54B34-0EBF-41EB-81A7-3252F7534B9E@gmail.com>
	<49F87236.2050603@lshift.net>
Message-ID: <B7C54FDD-6CF1-43B4-BBE1-24ACA18705F0@gmail.com>

Matthias,

On 29 Apr 2009, at 16:28, Matthias Radestock wrote:

> Chris,
>
> Chris Duncan wrote:
>> I've just been writing a piece of code that infers the exchange  
>> type  from the exchange name for default exchanges (amq.*). As far  
>> as I  know, the default exchange name for a headers exchange is  
>> specified  as 'amq.match'. Does anybody know why it isn't  
>> 'amq.headers'?
>
> AFAIK it's just an oversight. AMQP 0-9-1 has "headers" in the xml  
> spec and "match" in the pdf spec. Rabbit defines both :)
>
>
> Matthias.

Thanks for that. I was looking at the .pdf :)

Regards,

Chris




From matthias at lshift.net  Wed Apr 29 17:27:03 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Apr 2009 17:27:03 +0100
Subject: [rabbitmq-discuss] cookie file on Windows
In-Reply-To: <4e3934860904290916t40c6db0jb333460e42a9d63f@mail.gmail.com>
References: <4e3934860904290850q3573d864q1748cecdc4be6815@mail.gmail.com>	
	<49F878A0.4090608@lshift.net>
	<4e3934860904290916t40c6db0jb333460e42a9d63f@mail.gmail.com>
Message-ID: <49F87FD7.1080206@lshift.net>

Aaron,

Aaron Feng wrote:
> Is there a way to specify the location of the cookie file?

Not directly. You can pass the -setcookie option to erl to specify the 
cookie, which with
   erl -setcookie `cat path-to-cookie-file`
gives you what you want ... on Unix. I'll leave it to you to figure out 
how do that in a Windows .bat file ;)


Matthias.



From aaron.feng at gmail.com  Wed Apr 29 18:08:12 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Wed, 29 Apr 2009 13:08:12 -0400
Subject: [rabbitmq-discuss] cookie file on Windows
In-Reply-To: <49F87FD7.1080206@lshift.net>
References: <4e3934860904290850q3573d864q1748cecdc4be6815@mail.gmail.com>
	<49F878A0.4090608@lshift.net>
	<4e3934860904290916t40c6db0jb333460e42a9d63f@mail.gmail.com>
	<49F87FD7.1080206@lshift.net>
Message-ID: <4e3934860904291008i3b952505w4f82664ef97016b2@mail.gmail.com>

Hi Matthias,

That should do the trick.

Thanks,

Aaron

On Wed, Apr 29, 2009 at 12:27 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Aaron,
>
> Aaron Feng wrote:
>
>> Is there a way to specify the location of the cookie file?
>>
>
> Not directly. You can pass the -setcookie option to erl to specify the
> cookie, which with
>  erl -setcookie `cat path-to-cookie-file`
> gives you what you want ... on Unix. I'll leave it to you to figure out how
> do that in a Windows .bat file ;)
>
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090429/dcc30d06/attachment.htm 

From matthias at lshift.net  Wed Apr 29 22:08:31 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Apr 2009 22:08:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
 robustness problem
In-Reply-To: <49F58CFB.8070406@lionet.info>
References: <49F58CFB.8070406@lionet.info>
Message-ID: <49F8C1CF.7080405@lshift.net>

Lev,

Lev Walkin wrote:
> During evaluation period, our RabbitMQ node has crashed at some point, 
> killed by OOM killer. Unfortunately, killing corrupted the log files, so 
> RabbitMQ restart did not fix the problem. RabbitMQ just would not start:
> [...]
> It turns out, the broker beam was killed during a persister operation, 
> so persister logs were broken:
> 
> [broker at zamq ...]> ls -al | grep persister
> -rw-r--r--  1 broker  wheel          8 Apr 24 18:48 rabbit_persister.LOG
> -rw-r--r--  1 broker  wheel  661677171 Apr 24 18:19 
> rabbit_persister.LOG.previous
> [...]
> I believe there is a way to make such error recovery more robust. Is 
> there a solution you'd like to introduce for this kind of problem?

You should be able to just rename the .LOG.previous to .LOG.

I have filed a bug to get the broker to do s.t. along these lines 
automatically.


Regards,

Matthias.



From matthias at lshift.net  Wed Apr 29 22:21:11 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Apr 2009 22:21:11 +0100
Subject: [rabbitmq-discuss] Performance questions
In-Reply-To: <150a3aa50904290135h6e384b1eid03ce9ff09eb73c@mail.gmail.com>
References: <150a3aa50904290135h6e384b1eid03ce9ff09eb73c@mail.gmail.com>
Message-ID: <49F8C4C7.7090804@lshift.net>

Ashley,

Ashley van Gerven wrote:
> I'm fairly new to rabbitMQ - one of the tests I did was to read 1000 
> messages from rabbitMQ server running locally vs. reading 1000 messages 
> from another server (using .NET client).
> 
> Performance was approx 1000 per second connecting from the same server, 
> vs approx 200 p/s connecting from another server (single-node broker).
> 
> What would the bottleneck be here that's limiting the reads to 200 p/s? 
> My guess would be the network hardware.

What network bandwidth do you have?

And how exactly are you reading messages?

> Are there any tricks with setting up or connecting to minimise read times?

Are you using basic.get? If so then the throughput will be determined by 
the network latency, since basic.get incurs a full network round-trip 
per message. To avoid that use basic.consume to set up asynchronous 
"push" delivery that streams messages to the client.

> And what sort of performance benefits can there usually be realized for 
> every node added to a cluster?

That very much depends on your routing topology. At one extreme, if you 
have a single producer sending messages to a single consumer then adding 
nodes will not help at all. At the other extreme, if you have many 
disjoint streams then near-linear scalability is achievable.


Regards,

Matthias.



From brendan.ribera at gmail.com  Wed Apr 29 22:40:58 2009
From: brendan.ribera at gmail.com (Brendan Ribera)
Date: Wed, 29 Apr 2009 14:40:58 -0700
Subject: [rabbitmq-discuss] Evaluating RabbitMQ - a few questions
Message-ID: <ccad12500904291440t45e4fa1ck4ff72746209099dc@mail.gmail.com>

Hello all,

I'm investigating using RabbitMQ as a replacement for a few db-backed work
queues.  Our replication master sees considerable bit of write traffic into
these tables, and it would be nice to take that off of their hands.  My
first attempt will be to replace our dirty users queue -- this stores a
simple list of user ids, indicating for which users we need to do some
background processing & push out an updated user profile.  We mark many as
'dirty' during the course of the day, and run several workers to update the
profiles.  We usually have several hundred thousand users in the queue at a
time.

This seems like a good fit for RabbitMQ, but I have a few
questions/constraints:


   - Our current system allows us to do a unique constraint on userid -- if
   someone is already in the dirty queue and dirties his or her profile again,
   we don't want to update it multiple times. We do an 'insert ignore', leaving
   us with at most one row per user.  Are there any clever ways to emulate this
   behavior?

   I can think of a few ways to work around this outside of the queueing
   system, but all involve storing state elsewhere. I'd love a native solution
   that would allow me to fire as many "this user is dirty" messages into the
   queue, but guarantee my workers that the message message I read from a queue
   encapsulates all previous dirtying events.  Perhaps this is a pipe dream.


   - Our workers like to leak memory, so we often find ourselves killing
   them ungracefully.  While missing a few dirty profiles isn't terrible, it
   would be nice premature worker death didn't have to cause this.  Along these
   lines, I'm thinking we'd receive the message, do work, and then ack recieipt
   of the message.  If we die before the ack, the message lives on and someone
   else will clean that profile later.

   My question is about ack timing: how long does the worker have before the
   message is requeued? is this time configurable? is it configurable per
   queue?


I'm looking forward to hearing (er, reading) your thoughts.

-Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090429/bccf3f87/attachment.htm 

From vlm at lionet.info  Wed Apr 29 22:44:38 2009
From: vlm at lionet.info (Lev Walkin)
Date: Wed, 29 Apr 2009 14:44:38 -0700
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
 robustness problem
In-Reply-To: <49F8C1CF.7080405@lshift.net>
References: <49F58CFB.8070406@lionet.info> <49F8C1CF.7080405@lshift.net>
Message-ID: <49F8CA46.90505@lionet.info>

Matthias Radestock wrote:
> Lev,
> 
> Lev Walkin wrote:
>> During evaluation period, our RabbitMQ node has crashed at some point, 
>> killed by OOM killer. Unfortunately, killing corrupted the log files, 
>> so RabbitMQ restart did not fix the problem. RabbitMQ just would not 
>> start:
>> [...]
>> It turns out, the broker beam was killed during a persister operation, 
>> so persister logs were broken:
>>
>> [broker at zamq ...]> ls -al | grep persister
>> -rw-r--r--  1 broker  wheel          8 Apr 24 18:48 rabbit_persister.LOG
>> -rw-r--r--  1 broker  wheel  661677171 Apr 24 18:19 
>> rabbit_persister.LOG.previous
>> [...]
>> I believe there is a way to make such error recovery more robust. Is 
>> there a solution you'd like to introduce for this kind of problem?
> 
> You should be able to just rename the .LOG.previous to .LOG.

Yes, I did just that.

> I have filed a bug to get the broker to do s.t. along these lines 
> automatically.

Right, it is better for HA software to be able to heal itself to some 
degree, rather than to require a host of a special personnel to support 
it in the field 24/7.

-- 
Lev Walkin
vlm at lionet.info



From bsullivan at lindenlab.com  Wed Apr 29 23:15:24 2009
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Wed, 29 Apr 2009 15:15:24 -0700 (PDT)
Subject: [rabbitmq-discuss] Millions of Queues
In-Reply-To: <499BC08E.8020806@lshift.net>
References: <499B39F8.2040400@lindenlab.com> <499B4396.80902@lshift.net>
	<499B58B4.6010703@lindenlab.com> <499BC08E.8020806@lshift.net>
Message-ID: <23302411.post@talk.nabble.com>



Matthias Radestock-2 wrote:
> 
> 
> There is indeed some load balancing going on but, as you say, it will 
> only come into play when new connections are established. Also, 
> connection.redirect has been removed from version 0-9-1 of the AMQP spec 
> - ordinary load balancers should do a much better job so there is no 
> point in AMQP attempting to duplicate their functionality.
> 
> 

Hi Matthias,

Just wanted to follow up on this item.  Is connection.redirect really going
away?  If so, is there a way to turn it off in my current rabbitmq
configuration, or do I always need to use "insist" in my connection
parameters?  I scanned the docs and couldn't find anything here.

Thanks,
Brian

-- 
View this message in context: http://www.nabble.com/Millions-of-Queues-tp22067788p23302411.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From ashley.ohq at gmail.com  Thu Apr 30 05:12:22 2009
From: ashley.ohq at gmail.com (Ashley van Gerven)
Date: Thu, 30 Apr 2009 14:12:22 +1000
Subject: [rabbitmq-discuss] Performance questions
In-Reply-To: <49F8C4C7.7090804@lshift.net>
References: <150a3aa50904290135h6e384b1eid03ce9ff09eb73c@mail.gmail.com>
	<49F8C4C7.7090804@lshift.net>
Message-ID: <150a3aa50904292112h7107e7b6n17880b686a5e76a0@mail.gmail.com>

Matthias



It's a 100Mbps network.



The messages are retrieved like this:

-----

BasicGetResult result = ch.BasicGet("tempQ", false);

ch.BasicAck(result.DeliveryTag, false);

-----



I'll try out your suggested alternate method of basic.consume.



Thanks for the info



Cheers

Ashley



On Thu, Apr 30, 2009 at 7:21 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Ashley,
>
> Ashley van Gerven wrote:
>
>> I'm fairly new to rabbitMQ - one of the tests I did was to read 1000
>> messages from rabbitMQ server running locally vs. reading 1000 messages from
>> another server (using .NET client).
>>
>> Performance was approx 1000 per second connecting from the same server, vs
>> approx 200 p/s connecting from another server (single-node broker).
>>
>> What would the bottleneck be here that's limiting the reads to 200 p/s? My
>> guess would be the network hardware.
>>
>
> What network bandwidth do you have?
>
> And how exactly are you reading messages?
>
>  Are there any tricks with setting up or connecting to minimise read times?
>>
>
> Are you using basic.get? If so then the throughput will be determined by
> the network latency, since basic.get incurs a full network round-trip per
> message. To avoid that use basic.consume to set up asynchronous "push"
> delivery that streams messages to the client.
>
>  And what sort of performance benefits can there usually be realized for
>> every node added to a cluster?
>>
>
> That very much depends on your routing topology. At one extreme, if you
> have a single producer sending messages to a single consumer then adding
> nodes will not help at all. At the other extreme, if you have many disjoint
> streams then near-linear scalability is achievable.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090430/2b40bd72/attachment.htm 

From alexis.richardson at gmail.com  Thu Apr 30 08:07:31 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 30 Apr 2009 08:07:31 +0100
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
	robustness problem
In-Reply-To: <49F8CA46.90505@lionet.info>
References: <49F58CFB.8070406@lionet.info> <49F8C1CF.7080405@lshift.net>
	<49F8CA46.90505@lionet.info>
Message-ID: <167204d20904300007i2d34e7eaje72fee63f4af8ef8@mail.gmail.com>

Lev,

On Wed, Apr 29, 2009 at 10:44 PM, Lev Walkin <vlm at lionet.info> wrote:
>
> Right, it is better for HA software to be able to heal itself to some
> degree, rather than to require a host of a special personnel to support
> it in the field 24/7.

Absolutely.  We'll get there in the end, but by degrees.

alexis



From matthias at lshift.net  Thu Apr 30 13:58:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 30 Apr 2009 13:58:12 +0100
Subject: [rabbitmq-discuss] Millions of Queues
In-Reply-To: <23302411.post@talk.nabble.com>
References: <499B39F8.2040400@lindenlab.com>
	<499B4396.80902@lshift.net>	<499B58B4.6010703@lindenlab.com>
	<499BC08E.8020806@lshift.net> <23302411.post@talk.nabble.com>
Message-ID: <49F9A064.5030309@lshift.net>

Brian,

Brian Sullivan wrote:
> Is connection.redirect really going away?

Yes.

> If so, is there a way to turn it off in my current rabbitmq
> configuration, or do I always need to use "insist" in my connection
> parameters?

The latter. Is that a problem for your setup?


Regards,

Matthias.



From bsullivan at lindenlab.com  Thu Apr 30 15:29:04 2009
From: bsullivan at lindenlab.com (Brian Sullivan)
Date: Thu, 30 Apr 2009 07:29:04 -0700
Subject: [rabbitmq-discuss] Millions of Queues
In-Reply-To: <49F9A064.5030309@lshift.net>
References: <499B39F8.2040400@lindenlab.com>
	<499B4396.80902@lshift.net>	<499B58B4.6010703@lindenlab.com>
	<499BC08E.8020806@lshift.net> <23302411.post@talk.nabble.com>
	<49F9A064.5030309@lshift.net>
Message-ID: <345C1BAD-8A57-49AA-B86D-BA5630814149@lindenlab.com>


On Apr 30, 2009, at 5:58 AM, Matthias Radestock wrote:

>> If so, is there a way to turn it off in my current rabbitmq
>> configuration, or do I always need to use "insist" in my connection
>> parameters?
>
> The latter. Is that a problem for your setup?

Not a huge one, just wanted to make sure that was the only way to do  
it before making the changes in a number of places.  I thought I had  
heard there was a rabbitmq setting, which would just been a little  
cleaner (and clearer for any client usage of our cluster that I am not  
writing the code for).  But I can handle it via our docs.

Thanks, Matthias.

Brian




From brian at echonest.com  Thu Apr 30 15:55:19 2009
From: brian at echonest.com (Brian Whitman)
Date: Thu, 30 Apr 2009 10:55:19 -0400
Subject: [rabbitmq-discuss] why isn't my queue durable? (python client)
Message-ID: <dbd9700a0904300755y71ec6a81oe5eceb3ee95dcc9e@mail.gmail.com>

I'm trying to achieve a durable queue using the python client.
My setup is stock rabbit release from debian apt-get (using the rabbit apt
repository)

I set it up using this code:

http://github.com/bwhitman/py-amqplib-wrapper/blob/556f6daf498a7b84dba27dba38c6880b4a4b239a/amqp-wrapper.py

This uses amqplib.clent_0_8

I declare the queue and exchange with durable=True. I add a bunch of
messages and issue a /etc/init.d/rabbitmq-server restart. On restart the
queue I created has 0 messages.

Any ideas?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090430/d4a07191/attachment.htm 

From brian at echonest.com  Thu Apr 30 16:11:08 2009
From: brian at echonest.com (Brian Whitman)
Date: Thu, 30 Apr 2009 11:11:08 -0400
Subject: [rabbitmq-discuss] millions of unack'd messages in a day --
	disk store instead of ram?
In-Reply-To: <dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>
	<167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>
	<dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>
Message-ID: <dbd9700a0904300811j687429fen7e3d7051f26caf95@mail.gmail.com>

Just fyi to follow up to this
I created a 32GB swap on an EBS volume on an amzn mid-level instance (8GB
RAM)

I was able to hammer rabbit with far more messages than I've ever been able
to store. Once it crossed into swap amazingly write speed only suffered
slightly (probably because the old messages were swapped out, not the new
ones), but get speed did suffer. The important part is that the server
stayed up, even after using 20GB of virtual RAM (millions of large messages)

I did not alter rabbit or the configuration in any way. I am using the
version in apt. As a matter of fact, that memory warn config parameter was
not recognized by rabbit and would put a warning in the log when it started.




On Mon, Apr 27, 2009 at 11:51 AM, Brian Whitman <brian at echonest.com> wrote:

> On Mon, Apr 27, 2009 at 10:04 AM, Alexis Richardson <
> alexis.richardson at gmail.com> wrote:
>
>> Brian
>> You may find this blog post relevant:
>>
>> http://www.lshift.net/blog/2009/04/02/cranial-surgery-giving-rabbit-more-memory
>>
>
>
> Ah great, putting an EBS swap behind it is probably a good temp solution.
> I'll give that a go and run some tests. Thanks for the pointer. I wouldn't
> recommend anyone use S3 for this-- we max out at about 40-50 "keys"/files a
> second from other ec2 instances.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090430/3bd05d3a/attachment.htm 

From alexis.richardson at gmail.com  Thu Apr 30 16:16:54 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 30 Apr 2009 16:16:54 +0100
Subject: [rabbitmq-discuss] millions of unack'd messages in a day --
	disk store instead of ram?
In-Reply-To: <dbd9700a0904300811j687429fen7e3d7051f26caf95@mail.gmail.com>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>
	<167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>
	<dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>
	<dbd9700a0904300811j687429fen7e3d7051f26caf95@mail.gmail.com>
Message-ID: <167204d20904300816r2086ed6bh781b4531d765b4b6@mail.gmail.com>

Brian

That is pretty excellent.  Do you think you might be tempted to blog about it?

alexis


On Thu, Apr 30, 2009 at 4:11 PM, Brian Whitman <brian at echonest.com> wrote:
> Just fyi to follow up to this
> I created a 32GB swap on an EBS volume on an amzn mid-level instance (8GB
> RAM)
> I was able to hammer rabbit with far more messages than I've ever been able
> to store. Once it crossed into swap amazingly write speed only suffered
> slightly (probably because the old messages were swapped out, not the new
> ones), but get speed did suffer. The important part is that the server
> stayed up, even after using 20GB of?virtual?RAM (millions of large messages)
> I did not alter rabbit or the configuration in any way. I am using the
> version in apt. As a matter of fact, that memory warn config parameter was
> not?recognized?by rabbit and would put a warning in the log when it started.
>
>
>
> On Mon, Apr 27, 2009 at 11:51 AM, Brian Whitman <brian at echonest.com> wrote:
>>
>> On Mon, Apr 27, 2009 at 10:04 AM, Alexis Richardson
>> <alexis.richardson at gmail.com> wrote:
>>>
>>> Brian
>>> You may find this blog post relevant:
>>>
>>> http://www.lshift.net/blog/2009/04/02/cranial-surgery-giving-rabbit-more-memory
>>
>> Ah great, putting an EBS swap behind it is probably a good temp solution.
>> I'll give that a go and run some tests. Thanks for the pointer. I wouldn't
>> recommend anyone use S3 for this-- we max out at about 40-50 "keys"/files a
>> second from other ec2 instances.
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthew at lshift.net  Thu Apr 30 16:29:30 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 30 Apr 2009 16:29:30 +0100
Subject: [rabbitmq-discuss] millions of unack'd messages in a day
	--	disk store instead of ram?
In-Reply-To: <dbd9700a0904300811j687429fen7e3d7051f26caf95@mail.gmail.com>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>
	<167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>
	<dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>
	<dbd9700a0904300811j687429fen7e3d7051f26caf95@mail.gmail.com>
Message-ID: <20090430152930.GA10551@mrnibble.lshift.net>

On Thu, Apr 30, 2009 at 11:11:08AM -0400, Brian Whitman wrote:
> I was able to hammer rabbit with far more messages than I've ever been able
> to store. Once it crossed into swap amazingly write speed only suffered
> slightly (probably because the old messages were swapped out, not the new
> ones), but get speed did suffer. The important part is that the server
> stayed up, even after using 20GB of virtual RAM (millions of large messages)

Yes, this is broadly inline with my blog post at 
http://www.lshift.net/blog/2009/04/02/cranial-surgery-giving-rabbit-more-memory

But the behaviour you're seeing is not typical for a more general purpose
use case. When you're just hammering in messages, the OS can make
reasonably sensible decisions about which pages to evict and in general
all you're asking of the OS is "get me a new empty page which I can fill".

In the get case however, life is much harder. It's really quite likely
that the next page you're going to want back in as also the next page the
OS is going to choose to evict, so in the case where you're doing
1-in-1-out you could well find performance suffers catastrophically. Even
if you're just doing plain gets, until the GC runs (which on its own could
cause a lot of swap thrashing) and frees up pages, you're now asking a
more complex question of the OS - namely "choose a page to evict and in
its place get me this page which contains the messages I need to deliver".
This will typically thus be a write and a read.

Also, as I've recently commented on that blog post, we don't really have
enough details about how the Erlang VM is choosing to organise data and so
it may not be as efficient as we would like.

However, it is obviously a "good thing" that you have managed to get this
to work. Beware though that the broker you are using could have internal
messages timeout on it - this was fixed in bug 20546 which is in our
"default" development branch, not the stable "v1_5" branch. As such, you
may see messages coming out of the broker which indicate strange timeouts
occurred. Thus, if you're wishing to be able to use RabbitMQ in this way,
we would recommend you use the head of the "default" branch.

Also, you need the memory alarms turned off otherwise flow control will
kick in when you start to run out of memory.

Matthew



From tonyg at lshift.net  Thu Apr 30 17:13:09 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 30 Apr 2009 17:13:09 +0100
Subject: [rabbitmq-discuss] Evaluating RabbitMQ - a few questions
In-Reply-To: <ccad12500904291440t45e4fa1ck4ff72746209099dc@mail.gmail.com>
References: <ccad12500904291440t45e4fa1ck4ff72746209099dc@mail.gmail.com>
Message-ID: <49F9CE15.9070900@lshift.net>

Brendan Ribera wrote:
>     * Our current system allows us to do a unique constraint on userid

Off the top of my head I don't see a way of doing that with a stock
RabbitMQ. It's effectively the same problem as exactly-once messaging:
sending more than one copy and deduplicating at the ultimate receiver...

>       My question is about ack timing: how long does the worker have
>       before the message is requeued? is this time configurable? is it
>       configurable per queue?

The server will wait for an ack for as long as the connection (actually,
the channel within the connection) survives. If the channel is closed,
either by user action or by an error being reported by the server, then
all outstanding unacked messages are requeued for eventual delivery to
some other connection.

There are currently no timeouts involved: if you hold the Channel open,
you won't need to worry about anyone else being offered a message you're
working on.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Thu Apr 30 17:18:29 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 30 Apr 2009 17:18:29 +0100
Subject: [rabbitmq-discuss] why isn't my queue durable? (python client)
In-Reply-To: <dbd9700a0904300755y71ec6a81oe5eceb3ee95dcc9e@mail.gmail.com>
References: <dbd9700a0904300755y71ec6a81oe5eceb3ee95dcc9e@mail.gmail.com>
Message-ID: <49F9CF55.5060603@lshift.net>

Brian Whitman wrote:
> I declare the queue and exchange with durable=True. I add a bunch of
> messages and issue a /etc/init.d/rabbitmq-server restart. On restart the
> queue I created has 0 messages.

In AMQP, there are two concepts relating to sorts of permanence:

 - durability: queues and exchanges that survive restarts
 - persistence: *messages* that survive restarts

To get your messages to stick around after a restart, you must both

 - arrange for them to land in a durable queue, AND
 - publish them with delivery-mode set to 2 (meaning persistent)
   in the content header for the basic.publish

I'm not sure of the precise arguments to use with the python client, but
I'm sure they exist :-) (having just glanced at the demos, it looks like
the delivery_mode keyword to the Message() constructor is what you want.)

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Thu Apr 30 17:30:52 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 30 Apr 2009 17:30:52 +0100
Subject: [rabbitmq-discuss] Large number of connections
In-Reply-To: <997cab100904101515h7c5d5126of883145d49b0f270@mail.gmail.com>
References: <997cab100904101401j7ffadca6kdd4ad7d4ef06e460@mail.gmail.com>
	<49DFBFE7.1020609@lshift.net>
	<997cab100904101515h7c5d5126of883145d49b0f270@mail.gmail.com>
Message-ID: <49F9D23C.5020606@lshift.net>

Lawrence Kesteloot wrote:
> multiplexer processes
> that do nothing but multiplex 1000 TCP AMQP connections into a single
> one? I don't know if the AMQP protocol makes this possible. It might
> need to keep track of virtual connections within the single connection.

An interesting idea! One can easily imagine an AMQP 0-9-1 proxy that
accepts connections and multiplexes the opened channels into channels on
a single connection to the real RabbitMQ Server. Essentially an "AMQP
concentrator".

It ought even to be fairly easy to implement, using perhaps the
(internals of the) Java client library... anyone fancy having a go?

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Thu Apr 30 18:18:55 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 30 Apr 2009 18:18:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ HTTP interface
In-Reply-To: <e25246b60904221455w1fd5623cv14e9570cbc3f5312@mail.gmail.com>
References: <e25246b60904221455w1fd5623cv14e9570cbc3f5312@mail.gmail.com>
Message-ID: <49F9DD7F.5010705@lshift.net>

Hi,

lenz wrote:
> from the javascript client that comes with the rabbit-http2 repo i kind
> of got an idea how things are supposed to work but i wanted to ask if
> there is some sort of documentation/API description around that i could
> use to implement a client from?

I can think of a few things to get you started -- and BTW this sounds
like a really interesting project, do keep us up-to-date with your
progress as you go!

1. The service is standard JSON-RPC 1.1 (see spec mirrored here:
http://hg.opensource.lshift.net/erlang-rfc4627/raw-file/default/doc/JSON-RPC-1-1-WD-20060807.html).
You can probably use an off-the-shelf JSON-RPC client library.

2. There is plenty of documentation on the Erlang JSON-RPC service that
the RabbitMQ HTTP2 adapter uses here:
http://hg.opensource.lshift.net/erlang-rfc4627/raw-file/default/doc/index.html

3. The service descriptions (see the JSON-RPC 1.1 spec, ?10) are as follows:

* The channel factory at .../rpc/rabbitmq:

{
    "sdversion":"1.0",
    "name":"rabbitmq",
    "id":"urn:uuid:f98a4235-20a9-4321-a15c-94878a6a14f3",
    "version":"1.2",
    "address":"http://rabbitmq.lshift.net:55672/rpc/rabbitmq",
    "procs":[{"name":"open","idempotent":false,
	      "params":[{"name":"username","type":"str"},
			{"name":"password","type":"str"},
			{"name":"sessionTimeout","type":"num"},
			{"name":"virtualHost","type":"str"}]}]
}

* Each individual channel, at .../rpc/SOMEUNGUESSABLEHEXIDENTIFIER:

{
    "sdversion":"1.0",
    "name":"B10D3152ED205726DC3A8EF03FD00C7B",
    "id":"urn:uuid:b3f82f69-4f63-424b-8dbb-4fa53f63cf06",
    "version":"1.2",

"address":"http://rabbitmq.lshift.net:55672/rpc/SOMEUNGUESSABLEHEXIDENTIFIER",
    "procs":[{"name":"poll","idempotent":false,
	      "params":[]},
	     {"name":"close","idempotent":false,
	      "params":[]},
	     {"name":"call","idempotent":false,
	      "params":[{"name":"method","type":"str"},
			{"name":"args","type":"arr"}]},
	     {"name":"cast","idempotent":false,
	      "params":[{"name":"method","type":"str"},
			{"name":"args","type":"arr"},
			{"name":"content","type":"str"},
			{"name":"props","type":"arr"}]}]
}

The "poll" method returns details of all the asynchronous events that
have arrived for the channel -- the basic.delivers, the basic.returns.

The "close" method is used to shut down the channel.

The "call" and "cast" methods are used to perform synchronous (e.g.
exchange.declare) and asynchronous (e.g. basic.publish, basic.ack) AMQP
operations, respectively.

"call" returns the response to the synchronous call.

"cast" returns a list of asynchronous events that had been queued up at
the server-side of the Channel, *just like poll does*. So both poll and
cast can return deliveries intended for your program!

See rabbitmq.js's definitions of such as basicPublish() and
exchangeDeclare() for examples of usage.


Here's a login call (to .../rpc/rabbitmq):

REQUEST:
{"version":"1.1","id":2,"method":"open","params":["guest","guest",5,null]}

RESPONSE:
{"version":"1.1","id":2,"result":{"service":"SOMEUNGUESSABLEHEXIDENTIFIER"}}

Then, in the URL you're using to access the channel-opening service
(i.e. .../rpc/rabbitmq), replace "rabbitmq" with the "service" result
parameter, yielding .../rpc/SOMEUNGUESSABLEHEXIDENTIFIER. This is the
URL for your channel object. You use this to begin subscriptions and
issue AMQP commands.

Here's a queue declaration:

REQUEST:
{"version":"1.1","id":6,"method":"call","params":["queue.declare",[1,"test-queue-1a",false,false,false,true,false,{}]]}

RESPONSE:
{"version":"1.1","id":6,"result":{"method":"queue.declare_ok","args":["test-queue-1a",0,0]}}

Here's a use of "cast":

REQUEST:
{"version":"1.1","id":10,"method":"cast","params":["basic.publish",[1,"","test-queue-1a",false,false
],
"hello, world",
[null,null,null,null,null,null,null,null,null,null,null,null,null,null]]}

RESPONSE:
{"version":"1.1","id":10,"result":[{"method":"basic.deliver","args":["aa-cons-tag1",1,false,"","test-queue-1a"
],"content":"hello,
world","props":[null,null,null,null,null,null,null,null,null,null,null,null,null
,null]}]}

Note how the "result" array is non-empty, and that RabbitMQ is quick
enough that by the time the JSON-RPC object is ready to return to its
caller, the method that was just published has already been delivered :-)

Generally, for method arguments, follow the definitions given in the 0-8
json document:
http://hg.rabbitmq.com/rabbitmq-codegen/raw-file/default/amqp-0.8.json

Hopefully that is enough to get you started!

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Thu Apr 30 18:25:40 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 30 Apr 2009 18:25:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ + Stomp under FC9
In-Reply-To: <c454d1480904192035s3578bd4evf60da350b098eba3@mail.gmail.com>
References: <c454d1480904192035s3578bd4evf60da350b098eba3@mail.gmail.com>
Message-ID: <49F9DF14.5040008@lshift.net>

Hi David,

What you describe is really odd -- and unfortunately, it actually works
OK for me:

hg clone http://hg.rabbitmq.com/rabbitmq-codegen
hg clone http://hg.rabbitmq.com/rabbitmq-server
hg clone http://hg.rabbitmq.com/rabbitmq-stomp
(cd rabbitmq-codegen; hg up rabbitmq_v1_5_3)
(cd rabbitmq-server; hg up rabbitmq_v1_5_3)
(cd rabbitmq-stomp; hg up rabbitmq_v1_5_3)
make -C rabbitmq-server
make -C rabbitmq-stomp run

Then in another terminal,
rabbitmq-stomp/examples/perl/rabbitmq_stomp_recv.pl.

Then in another terminal, every call I make to
rabbitmq-stomp/examples/perl/rabbitmq_stomp_send.pl makes "testmessage"
appear on the console running the _recv.pl script.

It's especially odd that you can connect and everything seems to run
fine. Is there anything interesting in the rabbit.log file?

(Also worth checking: did you run the receiver before running the
sender? I think (?) the receiver needs to be running at the time the
sender runs)

Regards,
  Tony


David Cawley wrote:
> I've been testing out several Message Queues under Redhat FC9
> using Stomp e.g. POE based MQ and ActiveMQ. I also wanted to
> try RabbitMQ but I'm unable to receive messages from the queue?
> I see that Tony from lshift has been busy answering questions and
> fixing issues so I'm hoping it's in a usable state.
> 
> I installed the rabbitmq-server-1.5.3-1 via yum (I had to manually create
> a rabbitmq user/group and home directory for a cookie). I then compiled
> the stomp adaptor as follows using the rabbitmq_v1_5_3 tag :
> 
> cd /usr/lib/erlang/lib/
> hg clone http://hg.rabbitmq.com/rabbitmq-stomp
> cd rabbitmq-stomp
> hg update rabbitmq_v1_5_3
> make RABBIT_SERVER_SOURCE_ROOT=../rabbitmq_server-1.5.3
> 
> I created a config file so that the stomp adaptor is used:
> /etc/rabbitmq/rabbitmq.conf
> 
>     SERVER_START_ARGS='
>       -pa /usr/lib/erlang/lib/rabbitmq-stomp/ebin
>       -rabbit
>          stomp_listeners [{"0.0.0.0",61613}]
>          extra_startup_steps
> [{"STOMP-listeners",rabbit_stomp,kickstart,[]}]'
> 
> I restarted the rabbitmq-server process and I can connect to port 61613.
> The stomp
> connect works. However, when I run the example perl test scripts I don't
> receive any
> of the messages. The rabbit.log file indicates the accepting of the TCP
> connection
> and starting and sending of Stomp connection and no errors. I also tried
> using the ruby
> examples but still no luck. I even tried doing the process above with
> the latest 1.5.4
> mq-server rpm with the v1_5_3 tagged rabbitmq-stomp. How can I get it
> working?
> 
> ./examples/perl/rabbitmq_stomp_send.pl
> ./examples/perl/rabbitmq_stomp_recv.pl
> 
> Thanks,
> 
> David
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Thu Apr 30 18:35:04 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 30 Apr 2009 18:35:04 +0100
Subject: [rabbitmq-discuss] STOMP Authentication Idea
In-Reply-To: <acceaadf0904231501i39f445fdhd52936ac75b8f1a1@mail.gmail.com>
References: <acceaadf0904231501i39f445fdhd52936ac75b8f1a1@mail.gmail.com>
Message-ID: <49F9E148.1070702@lshift.net>

Hi Nemanja,

Interesting stuff!

Re the inets:start() automation issue: set "extra_startup_steps",
already used to start the STOMP plugin, to include a call to inets too:

 ... extra_startup_steps
      [{"STOMP-listeners",rabbit_stomp,kickstart,[]},
       {"inets",inets,start,[]}] ...

You will probably need to use backslash-escaping to make it look like
the "STOMP-listeners" setting you already have, and make sure there's no
whitespace anywhere in there. The shell gets mighty confused about
whitespace.

Regards,
  Tony


Nemanja Stefanovic wrote:
> Hello,
> 
> I just wanted to contribute some code I recently changes if anyone needs
> it. We have a use-case where I'm using STOMP with RabbitMQ's STOMP
> adapter and Orbited to push updates to a browser, or maybe even allow
> clients to connect to the STOMP server, not sure yet. Anyway, we need to
> ensure that only certain users get pushed certain content, hence
> authentication.
> 
> The way I have this working is: client connects to STOMP with generic
> just-TLD cookie (so it can be passed also to STOMP server which would
> run on another subdomain) and Orbited's io.js can read the cookie and
> send it up to the STOMP adapter as a 'cookie' header. It (the JS) also
> generates a random ID for the queue-name for that connection. This is
> all assuming I have 1 queue per connection as per the broadcast-style
> suggestion for STOMP adapter.
> 
> So now the STOMP adapter reads that cookie header and hits a page using
> http:request (via inets) with that cookie and passes in the queue name
> too. The web-app will recognize the cookie as belonging to a user and
> read the queue name. It (the web-app) will then set the appropriate
> bindings for that user. Since this is a topic exchange, the bindings
> would be for the topics updates the user will receive on her browser. If
> there is no cookie or the cookie is invalid, the web-app can take care
> of all that and just assign some default bindings for guests.
> 
> This is all working pretty well, except that I have to start
> 'inets:start()' manually in the erl command prompt. I was wondering how
> could I get this to be done on startup when the STOMP adapter starts?
> 
> I've attached the code and a diff (based on the tip of STOMP adapter
> from hg). Right now the URL is hardcoded but I plan to make that more
> configurable later.
> 
> Anyway, I hope maybe it can be of some use to someone who might need
> similar functionality.
> 
> -Nemanja
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Thu Apr 30 18:35:51 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 30 Apr 2009 18:35:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ broker's death by one cut:
 robustness problem
In-Reply-To: <49F8C1CF.7080405@lshift.net>
References: <49F58CFB.8070406@lionet.info> <49F8C1CF.7080405@lshift.net>
Message-ID: <49F9E177.9060508@lshift.net>

Matthias Radestock wrote:
> Lev Walkin wrote:
>> During evaluation period, our RabbitMQ node has crashed at some point, 
>> killed by OOM killer.

You may also wish to disable the OOM killer!!!

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From nemik at nemik.net  Thu Apr 30 18:47:44 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Thu, 30 Apr 2009 12:47:44 -0500
Subject: [rabbitmq-discuss] STOMP Authentication Idea
In-Reply-To: <49F9E148.1070702@lshift.net>
References: <acceaadf0904231501i39f445fdhd52936ac75b8f1a1@mail.gmail.com>
	<49F9E148.1070702@lshift.net>
Message-ID: <acceaadf0904301047m5c5ce335l60dc95af46b77d51@mail.gmail.com>

Tony,

Thanks! That's a bit more elegant than what I did, which was to change the
startup erl command and add '-s inets' there. Thanks!

BTW, I updated it a little to make the URL to hit customizable and based it
on a version that worked with 1.5.4 (the rabbit-version we plan to use in
production). I have it so the URL is put as an arg along with hostname and
port for the STOMP adapter; so the startup script had to be changed to:

stomp_listeners [{"0.0.0.0",61613,"http://nemik.net/test/test.php"}] or
whatever URL a user might need.

Thanks again,
Nemanja

On Thu, Apr 30, 2009 at 12:35 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Hi Nemanja,
>
> Interesting stuff!
>
> Re the inets:start() automation issue: set "extra_startup_steps",
> already used to start the STOMP plugin, to include a call to inets too:
>
>  ... extra_startup_steps
>      [{"STOMP-listeners",rabbit_stomp,kickstart,[]},
>       {"inets",inets,start,[]}] ...
>
> You will probably need to use backslash-escaping to make it look like
> the "STOMP-listeners" setting you already have, and make sure there's no
> whitespace anywhere in there. The shell gets mighty confused about
> whitespace.
>
> Regards,
>  Tony
>
>
> Nemanja Stefanovic wrote:
> > Hello,
> >
> > I just wanted to contribute some code I recently changes if anyone needs
> > it. We have a use-case where I'm using STOMP with RabbitMQ's STOMP
> > adapter and Orbited to push updates to a browser, or maybe even allow
> > clients to connect to the STOMP server, not sure yet. Anyway, we need to
> > ensure that only certain users get pushed certain content, hence
> > authentication.
> >
> > The way I have this working is: client connects to STOMP with generic
> > just-TLD cookie (so it can be passed also to STOMP server which would
> > run on another subdomain) and Orbited's io.js can read the cookie and
> > send it up to the STOMP adapter as a 'cookie' header. It (the JS) also
> > generates a random ID for the queue-name for that connection. This is
> > all assuming I have 1 queue per connection as per the broadcast-style
> > suggestion for STOMP adapter.
> >
> > So now the STOMP adapter reads that cookie header and hits a page using
> > http:request (via inets) with that cookie and passes in the queue name
> > too. The web-app will recognize the cookie as belonging to a user and
> > read the queue name. It (the web-app) will then set the appropriate
> > bindings for that user. Since this is a topic exchange, the bindings
> > would be for the topics updates the user will receive on her browser. If
> > there is no cookie or the cookie is invalid, the web-app can take care
> > of all that and just assign some default bindings for guests.
> >
> > This is all working pretty well, except that I have to start
> > 'inets:start()' manually in the erl command prompt. I was wondering how
> > could I get this to be done on startup when the STOMP adapter starts?
> >
> > I've attached the code and a diff (based on the tip of STOMP adapter
> > from hg). Right now the URL is hardcoded but I plan to make that more
> > configurable later.
> >
> > Anyway, I hope maybe it can be of some use to someone who might need
> > similar functionality.
> >
> > -Nemanja
> >
> >
> > ------------------------------------------------------------------------
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> --
>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090430/666344fb/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_stomp.erl_154
Type: application/octet-stream
Size: 20864 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090430/666344fb/attachment.obj 

From brian at echonest.com  Thu Apr 30 19:18:52 2009
From: brian at echonest.com (Brian Whitman)
Date: Thu, 30 Apr 2009 14:18:52 -0400
Subject: [rabbitmq-discuss] millions of unack'd messages in a day --
	disk store instead of ram?
In-Reply-To: <20090430152930.GA10551@mrnibble.lshift.net>
References: <dbd9700a0904270700p28222476vdf1f44e9d9ae7d04@mail.gmail.com>
	<167204d20904270704y150401f1ifcbebac56ad8aca6@mail.gmail.com>
	<dbd9700a0904270851h2c89488es3a41877e2c390b0c@mail.gmail.com>
	<dbd9700a0904300811j687429fen7e3d7051f26caf95@mail.gmail.com>
	<20090430152930.GA10551@mrnibble.lshift.net>
Message-ID: <dbd9700a0904301118v2834c10ap6fc38aba6602c4ad@mail.gmail.com>

Hi Matthew, all, of course, I used your blog post to figure it out :)
However, this:

> Also, you need the memory alarms turned off otherwise flow control will
> kick in when you start to run out of memory.
>

I tried to do that. I see this in my startup_err:

/etc/rabbitmq/rabbitmq.conf: line 1: memory_alarms: command not found


When I put this in my rabbitmq.conf:

SERVER_START_ARGS=-rabbit memory_alarms false


What am I doing wrong there?


>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090430/8e327ee5/attachment.htm 

From brian at echonest.com  Thu Apr 30 19:31:47 2009
From: brian at echonest.com (Brian Whitman)
Date: Thu, 30 Apr 2009 14:31:47 -0400
Subject: [rabbitmq-discuss] why isn't my queue durable? (python client)
In-Reply-To: <49F9CF55.5060603@lshift.net>
References: <dbd9700a0904300755y71ec6a81oe5eceb3ee95dcc9e@mail.gmail.com>
	<49F9CF55.5060603@lshift.net>
Message-ID: <dbd9700a0904301131r5be0a2d6g289f945761adfbbe@mail.gmail.com>

On Thu, Apr 30, 2009 at 12:18 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> To get your messages to stick around after a restart, you must both
>
>  - arrange for them to land in a durable queue, AND
>  - publish them with delivery-mode set to 2 (meaning persistent)
>   in the content header for the basic.publish
>

ah-ha! Thank you, in py-amqplib this is simple:
        m = amqp.Message(whatever, content_type='text/x-json')
        m.properties["delivery_mode"] = 2

i've confirmed this works..... thanks tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090430/736c46b9/attachment.htm 

From alexis.richardson at gmail.com  Thu Apr 30 22:04:13 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 30 Apr 2009 22:04:13 +0100
Subject: [rabbitmq-discuss] hg-git
Message-ID: <167204d20904301404t1e36d9f0q193ec912e770bfe5@mail.gmail.com>

Folks,

http://hg-git.github.com/

This may be of use to people using Github and hg.rabbitmq.com

a



