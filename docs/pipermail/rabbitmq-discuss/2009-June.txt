From weaveinator at gmail.com  Mon Jun  1 01:04:28 2009
From: weaveinator at gmail.com (Steve Weaver)
Date: Sun, 31 May 2009 17:04:28 -0700
Subject: [rabbitmq-discuss] Recovery and Upgrade Path
Message-ID: <c05e896e0905311704v3600f820ra6d3eb4f61054ec9@mail.gmail.com>

Hi all -
Have a two part question on RabbitMq.  First I have RabbitMq running on both
Windows Server and RHE server and was wondering what is the best way to go
about recovery if the server itself fails or RabbitMq needs a restart.  I'm
messing around with creating a windows service that starts it for the
windows box but was wondering what the best practice is for both windows and
linux.
Next - we are talking about upgrading rabbitmq so is that a just a matter of
unistalling/reinstalling or can I just rebuild over the top of the older
version.  I'm thinking more the point is for the RHE server as I'm still
getting the hang of the command line stuff (linux noob for the most part) so
that may just be clearing out the directory and dropping / compiling the new
version there.

Thanks very much for any help or insight!
Estaban
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090531/579a919e/attachment.htm 

From vlm at lionet.info  Mon Jun  1 14:29:00 2009
From: vlm at lionet.info (Lev Walkin)
Date: Mon, 01 Jun 2009 06:29:00 -0700
Subject: [rabbitmq-discuss] RabbitMQ heavy queue managing
Message-ID: <4A23D79C.1040308@lionet.info>


Hi,

My RabbitMQ (hg head) exhibits the following behavior: its
CPU usage grows from 20% to 99% in about two days, where a
persister log grows from about 1 megabyte to 15 megabytes.

During times when AMQ is 99% loaded it is still responsive,
although performance is severely degraded so it becomes mandatory
to do something with it.

In the initial, 20% CPU "after start" load the numbers are the
following:

Rough statistics:

     1   durable, persistent topic exchange
     100 persistent queues with no data stored for too long
         (removed quickly, the queue length is always at 0)
     50  persistent queues with about 100 to 500 1k messages TOTAL
	(0-15 messages in each), which are not drained for
	hours, if not days
     10  events per second sustained going through persistent
         queues (those which are drained quickly)
     50  events per second going through a single transient queue
         with multiple subscribers
     1   event every 10 minutes goes to one of those permanent queues
         which are not drained at all.

[vlm at tamq ~]> date; rabbitmqctl list_queues | awk '{sum += $2} END 
{print NR, sum}'
Mon Jun  1 06:05:29 PDT 2009
153 104
[vlm at tamq ~]>

The server CPU load is correlated to the TOTAL number of events in the
"never drained" queues. So the growth from 100 to 500 undrained 1k
events in those "never drained" queues gives me 20% -> 99% increase in 
CPU load.

The persister logs are filled with 100 kilobytes per second, and rotated
every few seconds (once the rabbit_persister.LOG is filled, it gets
renamed in a couple of seconds into .previous, then everything starts anew).

[vlm at tamq /js-kit/rabbitmq/mnesia/rabbit]> date; ls -al; sleep 1; date; 
ls -al rabbit_persister.LOG*
Mon Jun  1 06:00:05 PDT 2009
total 2232
drwxr-xr-x  2 www  wheel     1024 Jun  1 05:59 .
drwxr-xr-x  8 www  wheel      512 Jun  1 05:24 ..
-rw-r--r--  1 www  wheel      153 Jun  1 05:57 DECISION_TAB.LOG
-rw-r--r--  1 www  wheel     1531 Jun  1 05:59 LATEST.LOG
-rw-r--r--  1 www  wheel        8 May  3 23:43 rabbit_config.DCD
-rw-r--r--  1 www  wheel       87 Jun  1 05:24 rabbit_durable_exchange.DCD
-rw-r--r--  1 www  wheel      445 Jun  1 05:27 rabbit_durable_exchange.DCL
-rw-r--r--  1 www  wheel    13931 Jun  1 05:54 rabbit_durable_queue.DCD
-rw-r--r--  1 www  wheel      587 Jun  1 05:57 rabbit_durable_queue.DCL
-rw-r--r--  1 www  wheel    19442 Jun  1 05:54 rabbit_durable_route.DCD
-rw-r--r--  1 www  wheel     2009 Jun  1 05:57 rabbit_durable_route.DCL
-rw-r--r--  1 www  wheel   866427 Jun  1 06:00 rabbit_persister.LOG
-rw-r--r--  1 www  wheel  1308162 Jun  1 05:59 rabbit_persister.LOG.previous
-rw-r--r--  1 www  wheel      125 May  4 00:01 rabbit_user.DCD
-rw-r--r--  1 www  wheel      183 May  4 00:01 rabbit_user_permission.DCD
-rw-r--r--  1 www  wheel      124 May  4 00:01 rabbit_vhost.DCD
-rw-r--r--  1 www  wheel    12367 May  3 23:43 schema.DAT

Mon Jun  1 06:00:06 PDT 2009
-rw-r--r--  1 www  wheel  1163116 Jun  1 06:00 rabbit_persister.LOG
-rw-r--r--  1 www  wheel  1308162 Jun  1 05:59 rabbit_persister.LOG.previous
[vlm at tamq /js-kit/rabbitmq/mnesia/rabbit]>


My guess is that RabbitMQ does not like high-performance
persistent queue operations while other persistent queues contain
non-zero queues.

Having such 20% -> 99% dynamics is not acceptable for me. Moreover,
having consistently 1-10 mb persister log for somewhat 100 persistent
messages does seem like an excess and a promises potential for
optimization.
I would like to use RabbitMQ as a persistent mechanism capable of
holding 10-50 megabytes of 1k messages (50000 messages) until delivery,
the current situation seems two orders of magnitude worse than acceptable.

My question is what would you recommend doing with it? Or, better,
would someone be open to fix it, perhaps for a bit of money?


-- 
Lev Walkin
vlm at lionet.info



From matthias at lshift.net  Mon Jun  1 14:57:07 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 01 Jun 2009 14:57:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ heavy queue managing
In-Reply-To: <4A23D79C.1040308@lionet.info>
References: <4A23D79C.1040308@lionet.info>
Message-ID: <4A23DE33.9050908@lshift.net>

Lev,

Lev Walkin wrote:
> My guess is that RabbitMQ does not like high-performance
> persistent queue operations while other persistent queues contain
> non-zero queues.

That, in a nutshell, is one of the main achilles' heels of the current
persister.

> Or, better, would someone be open to fix it, perhaps for a bit of 
> money?

Work on the new persister, which fixes the above and a number of other
issues, is well underway. Contributions to this effort are welcome, and
Alexis will be in touch to discuss the options. We'd also welcome help
in testing the new persister. I'll drop you a line when it's ready.


Regards,

Matthias.



From vlm at lionet.info  Mon Jun  1 15:06:46 2009
From: vlm at lionet.info (Lev Walkin)
Date: Mon, 01 Jun 2009 07:06:46 -0700
Subject: [rabbitmq-discuss] Performance question
In-Reply-To: <C6420569.900B%rpunnoose@proteus-technologies.com>
References: <C6420569.900B%rpunnoose@proteus-technologies.com>
Message-ID: <4A23E076.9030200@lionet.info>


FYI: erlang client RabbitMQ performance is 15-20k messages a second.


Roshan Punnoose wrote:
> Thank you. That makes sense. Are there examples of using a fanout exchange
> with the Java api? I will also definitely start looking into using the C
> api. 




From tsuraan at gmail.com  Mon Jun  1 16:18:02 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 1 Jun 2009 10:18:02 -0500
Subject: [rabbitmq-discuss] RabbitMQ heavy queue managing
In-Reply-To: <4A23DE33.9050908@lshift.net>
References: <4A23D79C.1040308@lionet.info> <4A23DE33.9050908@lshift.net>
Message-ID: <84fb38e30906010818i1a5c63f5m73e8d7274054b15f@mail.gmail.com>

> Work on the new persister, which fixes the above and a number of other
> issues, is well underway. Contributions to this effort are welcome, and
> Alexis will be in touch to discuss the options. We'd also welcome help
> in testing the new persister. I'll drop you a line when it's ready.

Is that the new disk-based paging effort?  Is there a branch that I
can monitor to watch the progress, or is it too early to even look at
right now?



From matthias at lshift.net  Mon Jun  1 16:26:23 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 01 Jun 2009 16:26:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ heavy queue managing
In-Reply-To: <84fb38e30906010818i1a5c63f5m73e8d7274054b15f@mail.gmail.com>
References: <4A23D79C.1040308@lionet.info> <4A23DE33.9050908@lshift.net>
	<84fb38e30906010818i1a5c63f5m73e8d7274054b15f@mail.gmail.com>
Message-ID: <4A23F31F.6070805@lshift.net>

Tsuraan,

tsuraan wrote:
> Is that the new disk-based paging effort?

Yes.

> Is there a branch that I can monitor to watch the progress, or is it
> too early to even look at right now?

There is a branch, but it's definitely too early to look at it. Don't
worry, you are already on our list of early testers :)


Matthias.



From ryan at acceleration.net  Mon Jun  1 17:39:32 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Mon, 01 Jun 2009 12:39:32 -0400
Subject: [rabbitmq-discuss] rabbitmqctl status problem on windows server
 2008 (the vista-ish variant) KINDA SOLVED
In-Reply-To: <4A1EC905.9050405@acceleration.net>
References: <4A1EB2DA.1030601@acceleration.net>	<4A1EB8C7.6000607@cohesiveft.com>
	<4A1EC905.9050405@acceleration.net>
Message-ID: <4A240444.7040206@acceleration.net>

I was able to recreate this problem by logging out then logging back
in.  All .erlang.cookie files match, but it still doesn't take.  I do
not believe this is a rabbit-mq problem, but an erlang / erlsrv /
Windows Server 2008 problem, and I'll be pursuing this through more
appropriate channels.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506



Ryan Davis wrote:
> Dmitriy Samovskiy wrote:
>   
>> You are absolutely right, that post focuses on *nix systems, and I
>> have no idea how applicable it might be to Windows environments. Any
>> chance you can switch to Linux? :)
>>     
> I'm using Rabbit to replace some homegrown .NET/SQL Server queue
> solutions, and putting it on the same box running the .NET code was
> handy.  I can switch to linux, but brining up another system seemed like
> overkill for my message rates.
>   
>> Is there anything in the rabbit log (such as this "connection attempt
>> from disallowed node" [1])?
>>     
> No, I didn't see anything like that in the logs covering the time period
> this morning when I was futzing with it.
>
> I managed to get the status working by restarting the RabbitMQ service. 
> My best guess is that the erlang cookie in the running rabbit server for
> some reason did not match the one in C:\Windows\.erlang.cookie.  Maybe I
> accidentally overwrote that file?  Anyway, it works now, thanks for the
> quick response.  I'll keep an eye on it and see if I can recreate the
> problem.
>
> Thanks,
>
> Ryan Davis
> Acceleration.net
> Director of Programming Services
> 2831 NW 41st street, suite B
> Gainesville, FL 32606
>
> Office: 352-335-6500 x 124
> Fax: 352-335-6506
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090601/0895ba5d/attachment.htm 

From gmr at myyearbook.com  Tue Jun  2 16:22:07 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 2 Jun 2009 11:22:07 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
Message-ID: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>

I'm getting ready to do some production testing of rabbitmq as a
replacement of ActiveMQ. ?Beyond rabbitmqctl, I have not been able to
find any real data stubs for monitoring beyond how to write my own
(http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/).
?Before I go down the road of writing something I wanted to make sure
there was no pre-existing software since the rabbitmq homepage says
"Extensive facilities for management, monitoring, control and
debugging." ?I'm not trying to create a flame war, it's just
rabbitmqctl is not really an enterprise level monitoring tool.

I'm hoping I'm missing something, any suggestions?

Gavin



From alexis.richardson at gmail.com  Tue Jun  2 16:30:34 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 2 Jun 2009 16:30:34 +0100
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
Message-ID: <167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>

Gavin

Thanks!  The best way is to talk about this on-list as much as possible.

1. Please do let us know what features would make the console
enterprise class.  We have a shopping list on the RabbitMQ dev wiki
but it is not always obvious what people need first.

2. There is some work on using Graphite with RabbitMQ, and I am cc'ing
its author Dmitriy.
http://somic.org/2009/05/21/graphite-rabbitmq-integration/

3. A team based in Philly - led by Aaron (cc'd) whose blog that is -
is looking at taking this work further:
http://github.com/aaronfeng/trixx/tree/master

I think that summarises the known public state of play.  Obviously we
and the community want to get help with this and would welcome any
thoughts you have.

Cheers

alexis



On Tue, Jun 2, 2009 at 4:22 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
> I'm getting ready to do some production testing of rabbitmq as a
> replacement of ActiveMQ. ?Beyond rabbitmqctl, I have not been able to
> find any real data stubs for monitoring beyond how to write my own
> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/).
> ?Before I go down the road of writing something I wanted to make sure
> there was no pre-existing software since the rabbitmq homepage says
> "Extensive facilities for management, monitoring, control and
> debugging." ?I'm not trying to create a flame war, it's just
> rabbitmqctl is not really an enterprise level monitoring tool.
>
> I'm hoping I'm missing something, any suggestions?
>
> Gavin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From gmr at myyearbook.com  Tue Jun  2 16:46:17 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 2 Jun 2009 11:46:17 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
Message-ID: <af1bce590906020846x16bab5cfs60cf6e594861d8d3@mail.gmail.com>

Thanks for the info, I checked them out and I'm probably going to roll
my own.  Trixx has promise, but I'm not keen on running the interface
in a JVM instead of as a plugin, even if it is Lisp based ;-).

Would there be any interest in a mochiweb add-on / contrib based
module that gives rabbitmqctl like ability over a RESTful service?

On Tue, Jun 2, 2009 at 11:30 AM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> Gavin
>
> Thanks! ?The best way is to talk about this on-list as much as possible.
>
> 1. Please do let us know what features would make the console
> enterprise class. ?We have a shopping list on the RabbitMQ dev wiki
> but it is not always obvious what people need first.
>
> 2. There is some work on using Graphite with RabbitMQ, and I am cc'ing
> its author Dmitriy.
> http://somic.org/2009/05/21/graphite-rabbitmq-integration/
>
> 3. A team based in Philly - led by Aaron (cc'd) whose blog that is -
> is looking at taking this work further:
> http://github.com/aaronfeng/trixx/tree/master
>
> I think that summarises the known public state of play. ?Obviously we
> and the community want to get help with this and would welcome any
> thoughts you have.
>
> Cheers
>
> alexis
>
>
>
> On Tue, Jun 2, 2009 at 4:22 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>> I'm getting ready to do some production testing of rabbitmq as a
>> replacement of ActiveMQ. ?Beyond rabbitmqctl, I have not been able to
>> find any real data stubs for monitoring beyond how to write my own
>> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/).
>> ?Before I go down the road of writing something I wanted to make sure
>> there was no pre-existing software since the rabbitmq homepage says
>> "Extensive facilities for management, monitoring, control and
>> debugging." ?I'm not trying to create a flame war, it's just
>> rabbitmqctl is not really an enterprise level monitoring tool.
>>
>> I'm hoping I'm missing something, any suggestions?
>>
>> Gavin
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From alexis.richardson at gmail.com  Tue Jun  2 16:48:37 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 2 Jun 2009 16:48:37 +0100
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <af1bce590906020846x16bab5cfs60cf6e594861d8d3@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
	<af1bce590906020846x16bab5cfs60cf6e594861d8d3@mail.gmail.com>
Message-ID: <167204d20906020848w51a41acfr48e2e816643f96da@mail.gmail.com>

Gavin

Understood.  I think Aaron may have some comments on RESTful management.

But yes there would definitely be interest in that and please can you
say how you would approach it because several folks have been looking
at Mochification and web messaging ideas...

alexis


On Tue, Jun 2, 2009 at 4:46 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
> Thanks for the info, I checked them out and I'm probably going to roll
> my own. ?Trixx has promise, but I'm not keen on running the interface
> in a JVM instead of as a plugin, even if it is Lisp based ;-).
>
> Would there be any interest in a mochiweb add-on / contrib based
> module that gives rabbitmqctl like ability over a RESTful service?
>
> On Tue, Jun 2, 2009 at 11:30 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>> Gavin
>>
>> Thanks! ?The best way is to talk about this on-list as much as possible.
>>
>> 1. Please do let us know what features would make the console
>> enterprise class. ?We have a shopping list on the RabbitMQ dev wiki
>> but it is not always obvious what people need first.
>>
>> 2. There is some work on using Graphite with RabbitMQ, and I am cc'ing
>> its author Dmitriy.
>> http://somic.org/2009/05/21/graphite-rabbitmq-integration/
>>
>> 3. A team based in Philly - led by Aaron (cc'd) whose blog that is -
>> is looking at taking this work further:
>> http://github.com/aaronfeng/trixx/tree/master
>>
>> I think that summarises the known public state of play. ?Obviously we
>> and the community want to get help with this and would welcome any
>> thoughts you have.
>>
>> Cheers
>>
>> alexis
>>
>>
>>
>> On Tue, Jun 2, 2009 at 4:22 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>>> I'm getting ready to do some production testing of rabbitmq as a
>>> replacement of ActiveMQ. ?Beyond rabbitmqctl, I have not been able to
>>> find any real data stubs for monitoring beyond how to write my own
>>> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/).
>>> ?Before I go down the road of writing something I wanted to make sure
>>> there was no pre-existing software since the rabbitmq homepage says
>>> "Extensive facilities for management, monitoring, control and
>>> debugging." ?I'm not trying to create a flame war, it's just
>>> rabbitmqctl is not really an enterprise level monitoring tool.
>>>
>>> I'm hoping I'm missing something, any suggestions?
>>>
>>> Gavin
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>



From gmr at myyearbook.com  Tue Jun  2 16:57:42 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 2 Jun 2009 11:57:42 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <167204d20906020848w51a41acfr48e2e816643f96da@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
	<af1bce590906020846x16bab5cfs60cf6e594861d8d3@mail.gmail.com>
	<167204d20906020848w51a41acfr48e2e816643f96da@mail.gmail.com>
Message-ID: <af1bce590906020857o181632e1tfe91c5d2102ca617@mail.gmail.com>

On Tue, Jun 2, 2009 at 11:48 AM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> But yes there would definitely be interest in that and please can you
> say how you would approach it because several folks have been looking
> at Mochification and web messaging ideas...

Well, I could either expand on the work of rabbitmq-http2 and just
provide additional URL's for control or I could create a new add-on.
I'm probably leaning towards the latter, as an erlang learning
project.  As far as implementation details, I've not even come close
to figuring that one out, other than I know CouchDB makes good use of
mochiweb, which I've very lightly hacked on, and could serve as a
reference on how to accomplish what I am looking to do.

Gavin



From aaron.feng at gmail.com  Tue Jun  2 17:22:38 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Tue, 2 Jun 2009 12:22:38 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
Message-ID: <EBFD8110-5F19-41EB-83AD-7C115FCA736D@gmail.com>

Gavin,

Trixx is currently under heavy development and we should have  
something more presentable in a month or two.  There is really not  
much to look at on the frontend right now.  We are working on a  
dashboard idea for rabbit.

I would also be curious to know what features you are interested in.

Aaron

On Jun 2, 2009, at 11:30 AM, Alexis Richardson <alexis.richardson at gmail.com 
 > wrote:

> Gavin
>
> Thanks!  The best way is to talk about this on-list as much as  
> possible.
>
> 1. Please do let us know what features would make the console
> enterprise class.  We have a shopping list on the RabbitMQ dev wiki
> but it is not always obvious what people need first.
>
> 2. There is some work on using Graphite with RabbitMQ, and I am cc'ing
> its author Dmitriy.
> http://somic.org/2009/05/21/graphite-rabbitmq-integration/
>
> 3. A team based in Philly - led by Aaron (cc'd) whose blog that is -
> is looking at taking this work further:
> http://github.com/aaronfeng/trixx/tree/master
>
> I think that summarises the known public state of play.  Obviously we
> and the community want to get help with this and would welcome any
> thoughts you have.
>
> Cheers
>
> alexis
>
>
>
> On Tue, Jun 2, 2009 at 4:22 PM, Gavin M. Roy <gmr at myyearbook.com>  
> wrote:
>> I'm getting ready to do some production testing of rabbitmq as a
>> replacement of ActiveMQ.  Beyond rabbitmqctl, I have not been able to
>> find any real data stubs for monitoring beyond how to write my own
>> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/ 
>> ).
>>  Before I go down the road of writing something I wanted to make sure
>> there was no pre-existing software since the rabbitmq homepage says
>> "Extensive facilities for management, monitoring, control and
>> debugging."  I'm not trying to create a flame war, it's just
>> rabbitmqctl is not really an enterprise level monitoring tool.
>>
>> I'm hoping I'm missing something, any suggestions?
>>
>> Gavin
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>



From aaron.feng at gmail.com  Tue Jun  2 17:28:16 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Tue, 2 Jun 2009 12:28:16 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <167204d20906020848w51a41acfr48e2e816643f96da@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
	<af1bce590906020846x16bab5cfs60cf6e594861d8d3@mail.gmail.com>
	<167204d20906020848w51a41acfr48e2e816643f96da@mail.gmail.com>
Message-ID: <8A5B0641-E614-46C7-9E1E-89B5AFE0D38D@gmail.com>

Trixx does expose a RESTful interface to rabbitmqctl which retuns  
json. I can speak more about it if you are interested.

Aaron

On Jun 2, 2009, at 11:48 AM, Alexis Richardson <alexis.richardson at gmail.com 
 > wrote:

> Gavin
>
> Understood.  I think Aaron may have some comments on RESTful  
> management.
>
> But yes there would definitely be interest in that and please can you
> say how you would approach it because several folks have been looking
> at Mochification and web messaging ideas...
>
> alexis
>
>
> On Tue, Jun 2, 2009 at 4:46 PM, Gavin M. Roy <gmr at myyearbook.com>  
> wrote:
>> Thanks for the info, I checked them out and I'm probably going to  
>> roll
>> my own.  Trixx has promise, but I'm not keen on running the interface
>> in a JVM instead of as a plugin, even if it is Lisp based ;-).
>>
>> Would there be any interest in a mochiweb add-on / contrib based
>> module that gives rabbitmqctl like ability over a RESTful service?
>>
>> On Tue, Jun 2, 2009 at 11:30 AM, Alexis Richardson
>> <alexis.richardson at gmail.com> wrote:
>>> Gavin
>>>
>>> Thanks!  The best way is to talk about this on-list as much as  
>>> possible.
>>>
>>> 1. Please do let us know what features would make the console
>>> enterprise class.  We have a shopping list on the RabbitMQ dev wiki
>>> but it is not always obvious what people need first.
>>>
>>> 2. There is some work on using Graphite with RabbitMQ, and I am  
>>> cc'ing
>>> its author Dmitriy.
>>> http://somic.org/2009/05/21/graphite-rabbitmq-integration/
>>>
>>> 3. A team based in Philly - led by Aaron (cc'd) whose blog that is -
>>> is looking at taking this work further:
>>> http://github.com/aaronfeng/trixx/tree/master
>>>
>>> I think that summarises the known public state of play.  Obviously  
>>> we
>>> and the community want to get help with this and would welcome any
>>> thoughts you have.
>>>
>>> Cheers
>>>
>>> alexis
>>>
>>>
>>>
>>> On Tue, Jun 2, 2009 at 4:22 PM, Gavin M. Roy <gmr at myyearbook.com>  
>>> wrote:
>>>> I'm getting ready to do some production testing of rabbitmq as a
>>>> replacement of ActiveMQ.  Beyond rabbitmqctl, I have not been  
>>>> able to
>>>> find any real data stubs for monitoring beyond how to write my own
>>>> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/ 
>>>> ).
>>>>  Before I go down the road of writing something I wanted to make  
>>>> sure
>>>> there was no pre-existing software since the rabbitmq homepage says
>>>> "Extensive facilities for management, monitoring, control and
>>>> debugging."  I'm not trying to create a flame war, it's just
>>>> rabbitmqctl is not really an enterprise level monitoring tool.
>>>>
>>>> I'm hoping I'm missing something, any suggestions?
>>>>
>>>> Gavin
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>



From gmr at myyearbook.com  Tue Jun  2 17:42:32 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 2 Jun 2009 12:42:32 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <EBFD8110-5F19-41EB-83AD-7C115FCA736D@gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
	<EBFD8110-5F19-41EB-83AD-7C115FCA736D@gmail.com>
Message-ID: <af1bce590906020942o7b1a5e85y340ec291eb5b39c9@mail.gmail.com>

Ideally SNMP exposure through net-snmpd or similar would be key, but
the JSON exposure for now is keen.  The main issue I see is the need
to run in the JVM which we've been looking to move away from due to
poor experiences in a heavy transaction environment.

Cheers,

Gavin

On Tue, Jun 2, 2009 at 12:22 PM, Aaron Feng <aaron.feng at gmail.com> wrote:
> Gavin,
>
> Trixx is currently under heavy development and we should have something more
> presentable in a month or two. ?There is really not much to look at on the
> frontend right now. ?We are working on a dashboard idea for rabbit.
>
> I would also be curious to know what features you are interested in.
>
> Aaron
>
> On Jun 2, 2009, at 11:30 AM, Alexis Richardson <alexis.richardson at gmail.com>
> wrote:
>
>> Gavin
>>
>> Thanks! ?The best way is to talk about this on-list as much as possible.
>>
>> 1. Please do let us know what features would make the console
>> enterprise class. ?We have a shopping list on the RabbitMQ dev wiki
>> but it is not always obvious what people need first.
>>
>> 2. There is some work on using Graphite with RabbitMQ, and I am cc'ing
>> its author Dmitriy.
>> http://somic.org/2009/05/21/graphite-rabbitmq-integration/
>>
>> 3. A team based in Philly - led by Aaron (cc'd) whose blog that is -
>> is looking at taking this work further:
>> http://github.com/aaronfeng/trixx/tree/master
>>
>> I think that summarises the known public state of play. ?Obviously we
>> and the community want to get help with this and would welcome any
>> thoughts you have.
>>
>> Cheers
>>
>> alexis
>>
>>
>>
>> On Tue, Jun 2, 2009 at 4:22 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>>>
>>> I'm getting ready to do some production testing of rabbitmq as a
>>> replacement of ActiveMQ. ?Beyond rabbitmqctl, I have not been able to
>>> find any real data stubs for monitoring beyond how to write my own
>>>
>>> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/).
>>> ?Before I go down the road of writing something I wanted to make sure
>>> there was no pre-existing software since the rabbitmq homepage says
>>> "Extensive facilities for management, monitoring, control and
>>> debugging." ?I'm not trying to create a flame war, it's just
>>> rabbitmqctl is not really an enterprise level monitoring tool.
>>>
>>> I'm hoping I'm missing something, any suggestions?
>>>
>>> Gavin
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>



From aaron.feng at gmail.com  Tue Jun  2 19:21:52 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Tue, 2 Jun 2009 14:21:52 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
Message-ID: <D0318EC2-0F33-402A-A879-0B460A419989@gmail.com>

Gavin,

Sorry for the flurry and possibly out of sequence emails.  I'm on a  
plane so  I'm responding on my mobile device

We also thought about bypassing JInterface and using Erlang directly.   
Basically, exposing a separate Erlang node that communicates with  
rabbit nodes to retrieve info and have a restful interface around it.  
Right now we are focusing our efforts on the dashboard but we might  
eventually go the Erlang route.  That is one of the reasons why we  
decoupled the web frontend by consuming JSON.

If you are going down this route, I would be interested in what data  
you are returning and what it will look like. Maybe we can make it  
Trixx web compatible :)

Aaron

On Jun 2, 2009, at 11:46 AM, "Gavin M. Roy" <gmr at myyearbook.com> wrote:

> Thanks for the info, I checked them out and I'm probably going to roll
> my own.  Trixx has promise, but I'm not keen on running the interface
> in a JVM instead of as a plugin, even if it is Lisp based ;-).
>
> Would there be any interest in a mochiweb add-on / contrib based
> module that gives rabbitmqctl like ability over a RESTful service?
>
> On Tue, Jun 2, 2009 at 11:30 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>> Gavin
>>
>> Thanks!  The best way is to talk about this on-list as much as  
>> possible.
>>
>> 1. Please do let us know what features would make the console
>> enterprise class.  We have a shopping list on the RabbitMQ dev wiki
>> but it is not always obvious what people need first.
>>
>> 2. There is some work on using Graphite with RabbitMQ, and I am  
>> cc'ing
>> its author Dmitriy.
>> http://somic.org/2009/05/21/graphite-rabbitmq-integration/
>>
>> 3. A team based in Philly - led by Aaron (cc'd) whose blog that is -
>> is looking at taking this work further:
>> http://github.com/aaronfeng/trixx/tree/master
>>
>> I think that summarises the known public state of play.  Obviously we
>> and the community want to get help with this and would welcome any
>> thoughts you have.
>>
>> Cheers
>>
>> alexis
>>
>>
>>
>> On Tue, Jun 2, 2009 at 4:22 PM, Gavin M. Roy <gmr at myyearbook.com>  
>> wrote:
>>> I'm getting ready to do some production testing of rabbitmq as a
>>> replacement of ActiveMQ.  Beyond rabbitmqctl, I have not been able  
>>> to
>>> find any real data stubs for monitoring beyond how to write my own
>>> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/ 
>>> ).
>>> Before I go down the road of writing something I wanted to make sure
>>> there was no pre-existing software since the rabbitmq homepage says
>>> "Extensive facilities for management, monitoring, control and
>>> debugging."  I'm not trying to create a flame war, it's just
>>> rabbitmqctl is not really an enterprise level monitoring tool.
>>>
>>> I'm hoping I'm missing something, any suggestions?
>>>
>>> Gavin
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>




From darien at kindlund.com  Wed Jun  3 00:18:03 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Tue, 2 Jun 2009 19:18:03 -0400
Subject: [rabbitmq-discuss] Roadmap Questions
Message-ID: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>

Hi All,

After doing some functionality comparisons between v1.5.x and v1.6.x
branches, I have some basic questions about the upcoming release
schedules.

Specifically, I'm looking for a stable/tested (in other words,
released) version of RabbitMQ that supports the following features:

1) Basic QoS (allowing consumers to set the prefetch window to any
number, preferably 1)
2) Basic prioritization (allowing producers to set a priority of 1
through 10 [according to the spec?]) which RabbitMQ attempts to honor
on a best effort basis
3) Clean compatibility with OpenAMQ's C library (aka WireAPI?) -- or
clean compatibility with *some* type of C-based library that is
compatible with a recent version of RabbitMQ (maybe:
http://hg.rabbitmq.com/rabbitmq-c/ ?)
4) [Ideally], headers exchange support -- although I can make due
without this feature in the near term

I realize the developers may be tackling other higher-priority items
such as a high performance persister implementation, which may
effectively block any v1.6.x release from happening anytime soon.  I
also know that most (if not all?) of the 4 features are already baked
into the main RabbitMQ branch; however, some of the features still
need to be QA'd.

Can someone let me know if any of these features will be backported to
a future v1.5.x release?  If so, when would be an approximate
timeframe?  If not, is there any status update as to when a v1.6.x
would be released?  If there is no v1.6.x release timeframe, can you
list out what are the major blockers are (aside from the persister
problem)?  I was also wondering if there were any external
dependencies, such as a new AMQP spec version getting "ratified",
before a v1.6.x gets released?

Thanks,
-- Darien



From keith.irwin at gmail.com  Wed Jun  3 00:41:08 2009
From: keith.irwin at gmail.com (Keith Irwin)
Date: Tue, 2 Jun 2009 16:41:08 -0700
Subject: [rabbitmq-discuss] Roadmap Questions
In-Reply-To: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>
References: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>
Message-ID: <8aff81590906021641l73f2aba9nff5e40758dbbab0c@mail.gmail.com>

As a follow on to this, is there a roadmap document on the website anymore?
I notice the link:
    http://www.rabbitmq.com/roadmap.html

no longer resolves. I'm interested in the persistence improvements and would
have a ballpark figure for availability, even in a test branch.

Regards,

Keith

On Tue, Jun 2, 2009 at 4:18 PM, Darien Kindlund <darien at kindlund.com> wrote:

> Hi All,
>
> After doing some functionality comparisons between v1.5.x and v1.6.x
> branches, I have some basic questions about the upcoming release
> schedules.
>
> Specifically, I'm looking for a stable/tested (in other words,
> released) version of RabbitMQ that supports the following features:
>
> 1) Basic QoS (allowing consumers to set the prefetch window to any
> number, preferably 1)
> 2) Basic prioritization (allowing producers to set a priority of 1
> through 10 [according to the spec?]) which RabbitMQ attempts to honor
> on a best effort basis
> 3) Clean compatibility with OpenAMQ's C library (aka WireAPI?) -- or
> clean compatibility with *some* type of C-based library that is
> compatible with a recent version of RabbitMQ (maybe:
> http://hg.rabbitmq.com/rabbitmq-c/ ?)
> 4) [Ideally], headers exchange support -- although I can make due
> without this feature in the near term
>
> I realize the developers may be tackling other higher-priority items
> such as a high performance persister implementation, which may
> effectively block any v1.6.x release from happening anytime soon.  I
> also know that most (if not all?) of the 4 features are already baked
> into the main RabbitMQ branch; however, some of the features still
> need to be QA'd.
>
> Can someone let me know if any of these features will be backported to
> a future v1.5.x release?  If so, when would be an approximate
> timeframe?  If not, is there any status update as to when a v1.6.x
> would be released?  If there is no v1.6.x release timeframe, can you
> list out what are the major blockers are (aside from the persister
> problem)?  I was also wondering if there were any external
> dependencies, such as a new AMQP spec version getting "ratified",
> before a v1.6.x gets released?
>
> Thanks,
> -- Darien
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090602/30c97813/attachment.htm 

From matthias at lshift.net  Wed Jun  3 08:25:28 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 03 Jun 2009 08:25:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ in Fedora
Message-ID: <4A262568.1030901@lshift.net>

All,

RabbitMQ is now included in the Fedora Linux distribution. See 
https://admin.fedoraproject.org/updates/rabbitmq-server for the package 
details.

So, for all Fedora users RabbitMQ is now just a
   yum install rabbitmq-server
away :)

I'd like to thank the Fedora community, in particular Peter Lemenkov and 
Ruben Kerkhof, for their guidance in getting our RPM packages into shape 
for inclusion.


Regards,

Matthias.




From matthias at lshift.net  Wed Jun  3 11:53:30 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 03 Jun 2009 11:53:30 +0100
Subject: [rabbitmq-discuss] Roadmap Questions
In-Reply-To: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>
References: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>
Message-ID: <4A26562A.5080508@lshift.net>

Darien, Keith,

Darien Kindlund wrote:
> After doing some functionality comparisons between v1.5.x and v1.6.x
> branches, I have some basic questions about the upcoming release
> schedules.

There are quite a lot of changes going from v1.5.x to v1.6.0. We don't
normally let that many changes accumulate between releases, but our aim
was to get a stable version into major OS distributions, such as Ubuntu,
Debian and Fedora (as of yesterday!), which is quite a protracted
process. Now that's all done we are completely focused on getting v1.6.0
out.

> Specifically, I'm looking for a stable/tested (in other words,
> released) version of RabbitMQ that supports the following features:
> 
> 1) Basic QoS (allowing consumers to set the prefetch window to any
> number, preferably 1)
> 2) Basic prioritization (allowing producers to set a priority of 1
> through 10 [according to the spec?]) which RabbitMQ attempts to honor
> on a best effort basis
> 3) Clean compatibility with OpenAMQ's C library (aka WireAPI?) -- or
> clean compatibility with *some* type of C-based library that is
> compatible with a recent version of RabbitMQ (maybe:
> http://hg.rabbitmq.com/rabbitmq-c/ ?)
> 4) [Ideally], headers exchange support -- although I can make due
> without this feature in the near term

#1 and #4 will be in v1.6.0.

#2 is fairly high up our todo list, but won't happen until after the new
persister has been released since it touches areas of the code which
change substantially with the new persister code.

Note that there are a number of ways to mimic priority-like behaviour in
the current version, and even more with basic.qos in place.

#3 hasn't been asked for much, so it's currently a low priority task.
Having said that, any feedback on the experimental rabbitmq-c client is
of course welcome. Also, we are aiming for compatibility with OpenAMQ
when RabbitMQ implements AMQP 0-9-1.

> I realize the developers may be tackling other higher-priority items
> such as a high performance persister implementation, which may
> effectively block any v1.6.x release from happening anytime soon.

The new persister won't appear until after v1.6.x.

> Can someone let me know if any of these features will be backported to
> a future v1.5.x release?

I do not anticipate any more v1.5.x releases, and if there are any they
will be for low-risk/high-impact bug fixes only.

> If so, when would be an approximate timeframe? If not, is there any
> status update as to when a v1.6.x would be released? If there is no
> v1.6.x release timeframe, can you list out what are the major
> blockers are (aside from the persister problem)? I was also wondering
> if there were any external dependencies, such as a new AMQP spec
> version getting "ratified", before a v1.6.x gets released?

There aren't any major blockers left for v1.6.0. There is still a bit of
qa left to do, and a few minor bug fixes to make, so I'd expect to see
v1.6.0 to be released by mid June. The new persister should be ready in
early July.


Regards,

Matthias.




From samolet at gmail.com  Wed Jun  3 16:43:11 2009
From: samolet at gmail.com (Igor Kolomiets)
Date: Wed, 3 Jun 2009 11:43:11 -0400
Subject: [rabbitmq-discuss] Roadmap Questions
In-Reply-To: <4A26562A.5080508@lshift.net>
References: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com> 
	<4A26562A.5080508@lshift.net>
Message-ID: <bf5f1fdc0906030843v552484d7l8121a19c4d21e260@mail.gmail.com>

Hi Matthias,

On Wed, Jun 3, 2009 at 6:53 AM, Matthias Radestock <matthias at lshift.net> wrote:
...
>
> #3 hasn't been asked for much, so it's currently a low priority task.
> Having said that, any feedback on the experimental rabbitmq-c client is
> of course welcome. Also, we are aiming for compatibility with OpenAMQ
> when RabbitMQ implements AMQP 0-9-1.
>

AMQP version 0.9 introduced message's TTL. Any plans to support it in
RabbitMQ 1.6?

--
Igor Kolomiets



From alexis.richardson at gmail.com  Wed Jun  3 16:48:39 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 3 Jun 2009 16:48:39 +0100
Subject: [rabbitmq-discuss] Roadmap Questions
In-Reply-To: <8aff81590906021641l73f2aba9nff5e40758dbbab0c@mail.gmail.com>
References: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>
	<8aff81590906021641l73f2aba9nff5e40758dbbab0c@mail.gmail.com>
Message-ID: <167204d20906030848l4b10702bkcca8fd46ff5b081e@mail.gmail.com>

Keith

We are going to fix this.  The roadmap got a bit out of sync with what
we were actually doing.

I shall post a follow up to Matthias' note asap.

alexis


On Wed, Jun 3, 2009 at 12:41 AM, Keith Irwin <keith.irwin at gmail.com> wrote:
> As a follow on to this, is there a roadmap document on the website anymore?
> I notice the link:
> ?? ?http://www.rabbitmq.com/roadmap.html
> no longer resolves. I'm interested in the persistence improvements and would
> have a ballpark figure for availability, even in a test branch.
> Regards,
> Keith
>
> On Tue, Jun 2, 2009 at 4:18 PM, Darien Kindlund <darien at kindlund.com> wrote:
>>
>> Hi All,
>>
>> After doing some functionality comparisons between v1.5.x and v1.6.x
>> branches, I have some basic questions about the upcoming release
>> schedules.
>>
>> Specifically, I'm looking for a stable/tested (in other words,
>> released) version of RabbitMQ that supports the following features:
>>
>> 1) Basic QoS (allowing consumers to set the prefetch window to any
>> number, preferably 1)
>> 2) Basic prioritization (allowing producers to set a priority of 1
>> through 10 [according to the spec?]) which RabbitMQ attempts to honor
>> on a best effort basis
>> 3) Clean compatibility with OpenAMQ's C library (aka WireAPI?) -- or
>> clean compatibility with *some* type of C-based library that is
>> compatible with a recent version of RabbitMQ (maybe:
>> http://hg.rabbitmq.com/rabbitmq-c/ ?)
>> 4) [Ideally], headers exchange support -- although I can make due
>> without this feature in the near term
>>
>> I realize the developers may be tackling other higher-priority items
>> such as a high performance persister implementation, which may
>> effectively block any v1.6.x release from happening anytime soon. ?I
>> also know that most (if not all?) of the 4 features are already baked
>> into the main RabbitMQ branch; however, some of the features still
>> need to be QA'd.
>>
>> Can someone let me know if any of these features will be backported to
>> a future v1.5.x release? ?If so, when would be an approximate
>> timeframe? ?If not, is there any status update as to when a v1.6.x
>> would be released? ?If there is no v1.6.x release timeframe, can you
>> list out what are the major blockers are (aside from the persister
>> problem)? ?I was also wondering if there were any external
>> dependencies, such as a new AMQP spec version getting "ratified",
>> before a v1.6.x gets released?
>>
>> Thanks,
>> -- Darien
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Wed Jun  3 16:56:44 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 03 Jun 2009 16:56:44 +0100
Subject: [rabbitmq-discuss] Roadmap Questions
In-Reply-To: <bf5f1fdc0906030843v552484d7l8121a19c4d21e260@mail.gmail.com>
References: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>
	<4A26562A.5080508@lshift.net>
	<bf5f1fdc0906030843v552484d7l8121a19c4d21e260@mail.gmail.com>
Message-ID: <4A269D3C.7080201@lshift.net>

Igor,

Igor Kolomiets wrote:
> AMQP version 0.9 introduced message's TTL.

TTLs (or, more accurately, expiry times) are present in 0-8 too.

> Any plans to support it in RabbitMQ 1.6?

It's a reasonably high-priority feature, but it's also quite a lot of
work to implement. So I doubt it will get done soon unless there are a
many users asking for it or sponsor the development.


Matthias.



From kyle.burton at gmail.com  Wed Jun  3 18:01:33 2009
From: kyle.burton at gmail.com (Kyle R. Burton)
Date: Wed, 3 Jun 2009 13:01:33 -0400
Subject: [rabbitmq-discuss] Measuring Broker Behavior
Message-ID: <ac25b30c0906031001w3a4d22c2tdfc2030976878ca8@mail.gmail.com>

All,

I'm evaluating AMQP at work and wrote a post about the initial testing
approach.  Monadic (via twitter) asked me to share on the list, the
post I wrote up is here:

  http://asymmetrical-view.com/2009/06/02/incanter-amqp-benchmark.html

In it I go through the quick test we assembled and executed yesterday.
 I hesitate to call it a benchmark.  What we did was not that thorough
or controlled - it measured the behavior of two brokers (Rabbit and
Qpid) and produced a couple of graphs.  I was more posting about how
easy it was to do with Clojure and Incanter.

At this point I don't know much about tuning Erlang or Rabbit, if
anyone has any advice about where to look for information on tuning,
about our methodology, or questions please let me know.

I hope that you find the writeup useful.


Regards,

Kyle

-- 
------------------------------------------------------------------------------
kyle.burton at gmail.com                            http://asymmetrical-view.com/
------------------------------------------------------------------------------



From keith.irwin at gmail.com  Wed Jun  3 19:20:11 2009
From: keith.irwin at gmail.com (Keith Irwin)
Date: Wed, 3 Jun 2009 11:20:11 -0700
Subject: [rabbitmq-discuss] Roadmap Questions
In-Reply-To: <4A269D3C.7080201@lshift.net>
References: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>
	<4A26562A.5080508@lshift.net>
	<bf5f1fdc0906030843v552484d7l8121a19c4d21e260@mail.gmail.com>
	<4A269D3C.7080201@lshift.net>
Message-ID: <8aff81590906031120l2df5c5crd931e818243a8d6f@mail.gmail.com>

Is there a doc somewhere (even in the source code) that talks about the
features of the new persister? I'd love to use RabbitMQ, and if the
persistence is at least no worse than ActiveMQ, then I'll have a better
chance of persuading folks. ;)
For instance, here's what I'd like to see:

 * Can store a LOT of messages on disk (more than fits in memory).

 * When one of the nodes in a cluster goes down, the queues on that cluster
begin working on another node. In other words, a fatal crash of a node
(server goes up in flames, disk melts) does not result in message loss.
(Replicated queues?)

I'm not sure that my particular use case, flowing data from a transactional
system to a reporting system, needs to be as robust as the above requires,
but the folks I work with would be a lot happier if it were an option we
could opt out of, rather than one we can't have.

Anyway, it seems that I've seen mail regarding these sorts of subjects, but
I was wondering if there were something written up somewhere I could ponder.

Thanks!

Keith

On Wed, Jun 3, 2009 at 8:56 AM, Matthias Radestock <matthias at lshift.net>wrote:

> Igor,
>
> Igor Kolomiets wrote:
> > AMQP version 0.9 introduced message's TTL.
>
> TTLs (or, more accurately, expiry times) are present in 0-8 too.
>
> > Any plans to support it in RabbitMQ 1.6?
>
> It's a reasonably high-priority feature, but it's also quite a lot of
> work to implement. So I doubt it will get done soon unless there are a
> many users asking for it or sponsor the development.
>
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090603/7b44d915/attachment.htm 

From msmith1638 at gmail.com  Wed Jun  3 22:57:21 2009
From: msmith1638 at gmail.com (Mark Smith)
Date: Wed, 3 Jun 2009 16:57:21 -0500
Subject: [rabbitmq-discuss] rabbit MQ high-through put stock quotes
Message-ID: <e12fe9f10906031457j11f5935cu9432c89902ebcb3@mail.gmail.com>

Hello,Attached is a very simple version of my original experiment. I have
been playing around with the messages per-second and seem to top out at
about 5000 MS per second before the consumer appears to back up. Is this
normal performance? (one broker running on windows with out of the box
settings).
Now what I really want to do is develop a pub sub system for listening to
stock quotes that can handle 1000,000 messages per-second. I have a 8 core
windows server 2003 at my disposal, do you think this is possible?
If so how many brokers do you think I should run?
What would be the optimal way to arrangement for my exchanges and queues to
maximize use of all cores on the broker machine.
How can I use direct queues in a publish subscribe system, I ask because you
mentioned that direct queues are more efficient.

Thanks
Mark

-- 
Mark Smith

please send all correspondences to this
new email address



-- 
Mark Smith

please send all correspondences to this
new email address
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090603/47873cd3/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitMQsimple.zip
Type: application/zip
Size: 8559 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090603/47873cd3/attachment.zip 

From gmr at myyearbook.com  Wed Jun  3 23:13:13 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 3 Jun 2009 18:13:13 -0400
Subject: [rabbitmq-discuss] Stomp Connector not working in tip against 1.5.5
Message-ID: <af1bce590906031513k19c224aj8503312e68b5ffe1@mail.gmail.com>

Hello,

I've been working on troubleshooting Stomp connectivity with RabbitMQ.
 All of my R&D was on 1.5.3 with rabbitmq-stomp tag rabbitmq_v1_5_3
and it worked just fine.  I went to setup a production test with
RabbitMQ 1.5.5 and rabbitmq-stomp tip and it stopped working.

Here's the error output:

=ERROR REPORT==== 3-Jun-2009::18:06:44 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error\n"
Server private detail: {undef,
                           [{rabbit_channel,start_link,
                                [rabbit_stomp,<0.176.0>,<0.176.0>,<<"guest">>,
                                 <<"/">>]},
                            {rabbit_stomp,do_login,4},
                            {rabbit_stomp,process_frame,3},
                            {rabbit_stomp,process_received_bytes,2},
                            {rabbit_stomp,init,1},
                            {proc_lib,init_p_do_apply,3}]}

If you have any suggestions on how to fix this that would be helpful.
In addition, I would like to change the default auto-delete from true
to false:

[root at mq07 src]# hg diff
diff -r 8216e71f106c src/rabbit_stomp.erl
--- a/src/rabbit_stomp.erl	Mon Mar 09 13:47:54 2009 +0000
+++ b/src/rabbit_stomp.erl	Wed Jun 03 18:12:34 2009 -0400
@@ -534,7 +534,7 @@
                            passive     = BoolH("passive", false),
                            durable     = BoolH("durable", false),
                            exclusive   = BoolH("exclusive", false),
-                           auto_delete = BoolH("auto-delete", true),
+                           auto_delete = BoolH("auto-delete", false),
                            nowait      = true,
                            arguments   = [longstr_field(K, V) ||
                                              {"X-Q-" ++ K, V} <- Headers]},

But I wasn't sure if this could cause any problems.  Thoughts?

TIA,

Gavin



From matthias at lshift.net  Wed Jun  3 23:24:32 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 03 Jun 2009 23:24:32 +0100
Subject: [rabbitmq-discuss] Roadmap Questions
In-Reply-To: <8aff81590906031120l2df5c5crd931e818243a8d6f@mail.gmail.com>
References: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>	<4A26562A.5080508@lshift.net>	<bf5f1fdc0906030843v552484d7l8121a19c4d21e260@mail.gmail.com>	<4A269D3C.7080201@lshift.net>
	<8aff81590906031120l2df5c5crd931e818243a8d6f@mail.gmail.com>
Message-ID: <4A26F820.3080702@lshift.net>

Keith,

Keith Irwin wrote:
> For instance, here's what I'd like to see:
> 
>  * Can store a LOT of messages on disk (more than fits in memory).
> 
>  * When one of the nodes in a cluster goes down, the queues on that 
> cluster begin working on another node. In other words, a fatal crash of 
> a node (server goes up in flames, disk melts) does not result in message 
> loss. (Replicated queues?)

The two key features of the new persister are

- message storage space is bounded by disk space rather than available 
physical or virtual memory

- the computational cost of keeping a message stored is bounded

So these address your first point.


Your second point is only tangentially related to persistence - one can 
easily image a system where message loss is prevented by keeping a 
sufficient number of copies of the message in memory on different 
machines, without the messages ever hitting the disk.

There are actually some fairly easy ways to get the kind of reliability 
you refer to from the existing RabbitMQ broker. Just to mention two of 
the options: 1) get the persister to write to a SAN, such that in the 
event of a node failure a standby node can pick up from where the first 
node left off, 2) route the messages to multiple queues on different 
nodes and get the consumers to consume from all the queues and perform 
deduplication.

We have discussed these and other options with users on a number of 
occasions. Alexis may have some slides handy that illustrate the 
different approaches.


Regards,

Matthias.



From nemik at nemik.net  Wed Jun  3 23:24:50 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Wed, 3 Jun 2009 17:24:50 -0500
Subject: [rabbitmq-discuss] Stomp Connector not working in tip against
	1.5.5
In-Reply-To: <af1bce590906031513k19c224aj8503312e68b5ffe1@mail.gmail.com>
References: <af1bce590906031513k19c224aj8503312e68b5ffe1@mail.gmail.com>
Message-ID: <acceaadf0906031524p4698bfd2u425871fbcdf2cc31@mail.gmail.com>

Gavin,

I had this same issue. Luckily it's easy to take care of. Just edit
src/rabbit_stomp.erl in the stomp adapter (assuming it's from hg tip) and
change
line 364
ChPid = rabbit_channel:start_link(?MODULE, self(), self(), U#user.username,
list_to_binary(VirtualHost)),
to
ChPid = rabbit_channel:start_link(self(), self(), U#user.username,
list_to_binary(VirtualHost)),

Just remove the "?Module" since the start_link function changes in the new
rabbitmq-server version.

-Nemanja

On Wed, Jun 3, 2009 at 5:13 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> Hello,
>
> I've been working on troubleshooting Stomp connectivity with RabbitMQ.
>  All of my R&D was on 1.5.3 with rabbitmq-stomp tag rabbitmq_v1_5_3
> and it worked just fine.  I went to setup a production test with
> RabbitMQ 1.5.5 and rabbitmq-stomp tip and it stopped working.
>
> Here's the error output:
>
> =ERROR REPORT==== 3-Jun-2009::18:06:44 ===
> STOMP error frame sent:
> Message: "Processing error"
> Detail: "Processing error\n"
> Server private detail: {undef,
>                           [{rabbit_channel,start_link,
>
>  [rabbit_stomp,<0.176.0>,<0.176.0>,<<"guest">>,
>                                 <<"/">>]},
>                            {rabbit_stomp,do_login,4},
>                            {rabbit_stomp,process_frame,3},
>                            {rabbit_stomp,process_received_bytes,2},
>                            {rabbit_stomp,init,1},
>                            {proc_lib,init_p_do_apply,3}]}
>
> If you have any suggestions on how to fix this that would be helpful.
> In addition, I would like to change the default auto-delete from true
> to false:
>
> [root at mq07 src]# hg diff
> diff -r 8216e71f106c src/rabbit_stomp.erl
> --- a/src/rabbit_stomp.erl      Mon Mar 09 13:47:54 2009 +0000
> +++ b/src/rabbit_stomp.erl      Wed Jun 03 18:12:34 2009 -0400
> @@ -534,7 +534,7 @@
>                            passive     = BoolH("passive", false),
>                            durable     = BoolH("durable", false),
>                            exclusive   = BoolH("exclusive", false),
> -                           auto_delete = BoolH("auto-delete", true),
> +                           auto_delete = BoolH("auto-delete", false),
>                            nowait      = true,
>                            arguments   = [longstr_field(K, V) ||
>                                              {"X-Q-" ++ K, V} <- Headers]},
>
> But I wasn't sure if this could cause any problems.  Thoughts?
>
> TIA,
>
> Gavin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090603/93045f14/attachment.htm 

From matthias at lshift.net  Wed Jun  3 23:42:49 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 03 Jun 2009 23:42:49 +0100
Subject: [rabbitmq-discuss] Stomp Connector not working in tip against
 1.5.5
In-Reply-To: <af1bce590906031513k19c224aj8503312e68b5ffe1@mail.gmail.com>
References: <af1bce590906031513k19c224aj8503312e68b5ffe1@mail.gmail.com>
Message-ID: <4A26FC69.8010502@lshift.net>

Gavin,

Gavin M. Roy wrote:
> Hello,
> 
> I've been working on troubleshooting Stomp connectivity with RabbitMQ.
>  All of my R&D was on 1.5.3 with rabbitmq-stomp tag rabbitmq_v1_5_3
> and it worked just fine.  I went to setup a production test with
> RabbitMQ 1.5.5 and rabbitmq-stomp tip and it stopped working.

You shouldn't be using the rabbitmq-stomp tip with a v1.5.x server (*). 
The instructions that come with the STOMP adapter are quite explicit 
about that: "If there is no specific tag for the version of the server 
you are using, try using the newest tag that has the same major and 
minor version number.".

With the STOMP repo from a few moments ago, that means you should have 
been using the revision tagged rabbitmq_v1_5_3, but I've just added a 
rabbitmq_v1_5_5 tag now, so use that revision instead.


Matthias.
(*) In fact you should *never* use the tip of any of our repositories 
(unless you are really, really, sure that is what you want to do). We 
use branching extensively, and 'tip' will point to whatever happens to 
be the last commit, which could be on any branch. See 
http://www.rabbitmq.com/mercurial.html for more details.



From gmr at myyearbook.com  Wed Jun  3 23:46:34 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 3 Jun 2009 18:46:34 -0400
Subject: [rabbitmq-discuss] Different Stomp Issue: rabbitmq-stomp and
	Codehaus PHP Stomp class
Message-ID: <af1bce590906031546l6a6a05beifa2ac0acd659569a@mail.gmail.com>

In our testing of RabbitMQ and Stomp I ran across two issues with the
rabbitmq-stomp connector and the CodeHaus.org Stomp PHP class.

Even though the protocol clearly defines the frame format, the
codehaus code appends a linefeed after the frame's null terminator,
which rabbitmq-stomp does not like.  Instead of sending frame endings
as \0 they are sending them as \0\n.

In addition they send no-op \0's before senidng a frame, which
rabbitmq-stomp does not like.

I have uploaded a "fixed" version of the class which is based upon and
older version of CodeHaus's in addition to internal changes to use raw
sockets instead of file streams for communication:

http://github.com/gmr/StompConnection/tree/master

This version was tested against both ActiveMQ 5.1 and RabbitMQ 1.5.3.

However, I do believe that the rabbitmq-stomp connector should be more
protocol variance tolerant and accept the \0\n frame ends and out of
frame \0 characters without causing issues.  Since this is the
de-facto Stomp class for PHP, it makes sense to me for rabbitmq-stomp
to support their behavior.

I would publish a patch to them, but our code is based off of their
older single file, non re-factored code.  Last year they re-factored
their code into multiple files, however the latest version still has
this same behavior.

Regards,

Gavin



From gmr at myyearbook.com  Wed Jun  3 23:49:21 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 3 Jun 2009 18:49:21 -0400
Subject: [rabbitmq-discuss] Stomp Connector not working in tip against
	1.5.5
In-Reply-To: <4A26FC69.8010502@lshift.net>
References: <af1bce590906031513k19c224aj8503312e68b5ffe1@mail.gmail.com>
	<4A26FC69.8010502@lshift.net>
Message-ID: <af1bce590906031549o4c3766a6y891afcbe906c4e71@mail.gmail.com>

I also had an issue with rabbitmq-stomp with the tag rabbitmq_v1_5_3 against
rabbitmq 1.5.5, which I would guess is the change that Nemanja just wrote
about:

"I had this same issue. Luckily it's easy to take care of. Just edit
src/rabbit_stomp.erl in the stomp adapter (assuming it's from hg tip) and
change
line 364
ChPid = rabbit_channel:start_link(?MODULE, self(), self(), U#user.username,
list_to_binary(VirtualHost)),
to
ChPid = rabbit_channel:start_link(self(), self(), U#user.username,
list_to_binary(VirtualHost)),"


Thanks for the tag, I'll give it a try.

Regards,

Gavin

On Wed, Jun 3, 2009 at 6:42 PM, Matthias Radestock <matthias at lshift.net>
wrote:
> Gavin,
>
> Gavin M. Roy wrote:
>>
>> Hello,
>>
>> I've been working on troubleshooting Stomp connectivity with RabbitMQ.
>>  All of my R&D was on 1.5.3 with rabbitmq-stomp tag rabbitmq_v1_5_3
>> and it worked just fine.  I went to setup a production test with
>> RabbitMQ 1.5.5 and rabbitmq-stomp tip and it stopped working.
>
> You shouldn't be using the rabbitmq-stomp tip with a v1.5.x server (*).
The
> instructions that come with the STOMP adapter are quite explicit about
that:
> "If there is no specific tag for the version of the server you are using,
> try using the newest tag that has the same major and minor version
number.".
>
> With the STOMP repo from a few moments ago, that means you should have
been
> using the revision tagged rabbitmq_v1_5_3, but I've just added a
> rabbitmq_v1_5_5 tag now, so use that revision instead.
>
>
> Matthias.
> (*) In fact you should *never* use the tip of any of our repositories
> (unless you are really, really, sure that is what you want to do). We use
> branching extensively, and 'tip' will point to whatever happens to be the
> last commit, which could be on any branch. See
> http://www.rabbitmq.com/mercurial.html for more details.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090603/ffb0ff8e/attachment.htm 

From matthias at lshift.net  Wed Jun  3 23:58:20 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 03 Jun 2009 23:58:20 +0100
Subject: [rabbitmq-discuss] Stomp Connector not working in tip against
 1.5.5
In-Reply-To: <af1bce590906031549o4c3766a6y891afcbe906c4e71@mail.gmail.com>
References: <af1bce590906031513k19c224aj8503312e68b5ffe1@mail.gmail.com>	<4A26FC69.8010502@lshift.net>
	<af1bce590906031549o4c3766a6y891afcbe906c4e71@mail.gmail.com>
Message-ID: <4A27000C.6040408@lshift.net>

Gavin,

Gavin M. Roy wrote:
> I also had an issue with rabbitmq-stomp with the tag rabbitmq_v1_5_3 
> against rabbitmq 1.5.5, which I would guess is the change that Nemanja 
> just wrote about:
> 
>     "I had this same issue. Luckily it's easy to take care of. Just edit
>     src/rabbit_stomp.erl in the stomp adapter (assuming it's from hg
>     tip) and change
>     line 364     
>     ChPid = rabbit_channel:start_link(?MODULE, self(), self(),
>     U#user.username, list_to_binary(VirtualHost)),
>     to
>     ChPid = rabbit_channel:start_link(self(), self(), U#user.username,
>     list_to_binary(VirtualHost)),"

Nothing has changed in the rabbit_channel:start_link function between 
v1_5_3 and v1_5_5. However, the signature *has* changed between v1_5_x 
and our development branch. And the code base for the stomp connector 
has followed suit, i.e. the v1_5 branch (and all revisions tagged 
rabbitmq_v1_5_x) use the old signature and the development branch uses 
the new signature.

So the only way for the above error to occur is if a dev-branch stomp 
connector is used with a v1_5_x (or earlier) server code base.


Regards,

Matthias.



From tsuraan at gmail.com  Thu Jun  4 00:06:41 2009
From: tsuraan at gmail.com (tsuraan)
Date: Wed, 3 Jun 2009 18:06:41 -0500
Subject: [rabbitmq-discuss] Roadmap Questions
In-Reply-To: <4A26F820.3080702@lshift.net>
References: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>
	<4A26562A.5080508@lshift.net>
	<bf5f1fdc0906030843v552484d7l8121a19c4d21e260@mail.gmail.com>
	<4A269D3C.7080201@lshift.net>
	<8aff81590906031120l2df5c5crd931e818243a8d6f@mail.gmail.com>
	<4A26F820.3080702@lshift.net>
Message-ID: <84fb38e30906031606x24fa9cd8ub5274761580712eb@mail.gmail.com>

> There are actually some fairly easy ways to get the kind of reliability
> you refer to from the existing RabbitMQ broker. Just to mention two of
> the options: 1) get the persister to write to a SAN, such that in the
> event of a node failure a standby node can pick up from where the first
> node left off

is this a trivial thing to do?  I know the queue and binding
definitions are in a mnesia database, which is hostname dependent.  If
you had whatever machine that's actively running rabbit always have
the dns entry "rabbit.example.com", and you always start your erlang
with -name rabbit at rabbit.example.com, will mnesia always come up and
have everything working?



From nemik at nemik.net  Thu Jun  4 01:08:58 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Wed, 3 Jun 2009 19:08:58 -0500
Subject: [rabbitmq-discuss] Stomp Connector not working in tip against
	1.5.5
In-Reply-To: <4A27000C.6040408@lshift.net>
References: <af1bce590906031513k19c224aj8503312e68b5ffe1@mail.gmail.com>
	<4A26FC69.8010502@lshift.net>
	<af1bce590906031549o4c3766a6y891afcbe906c4e71@mail.gmail.com>
	<4A27000C.6040408@lshift.net>
Message-ID: <acceaadf0906031708k7ddc9576hafaea677b8abb00a@mail.gmail.com>

Makes sense. Sorry about the confusion then Gavin and thank you for the
clarification Matthias about the repository tips.

On Wed, Jun 3, 2009 at 5:58 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Gavin,
>
> Gavin M. Roy wrote:
> > I also had an issue with rabbitmq-stomp with the tag rabbitmq_v1_5_3
> > against rabbitmq 1.5.5, which I would guess is the change that Nemanja
> > just wrote about:
> >
> >     "I had this same issue. Luckily it's easy to take care of. Just edit
> >     src/rabbit_stomp.erl in the stomp adapter (assuming it's from hg
> >     tip) and change
> >     line 364
> >     ChPid = rabbit_channel:start_link(?MODULE, self(), self(),
> >     U#user.username, list_to_binary(VirtualHost)),
> >     to
> >     ChPid = rabbit_channel:start_link(self(), self(), U#user.username,
> >     list_to_binary(VirtualHost)),"
>
> Nothing has changed in the rabbit_channel:start_link function between
> v1_5_3 and v1_5_5. However, the signature *has* changed between v1_5_x
> and our development branch. And the code base for the stomp connector
> has followed suit, i.e. the v1_5 branch (and all revisions tagged
> rabbitmq_v1_5_x) use the old signature and the development branch uses
> the new signature.
>
> So the only way for the above error to occur is if a dev-branch stomp
> connector is used with a v1_5_x (or earlier) server code base.
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090603/0b2ee3f8/attachment.htm 

From 0x6e6562 at gmail.com  Thu Jun  4 08:24:16 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Jun 2009 08:24:16 +0100
Subject: [rabbitmq-discuss] [Fwd: erlang-client woes]
In-Reply-To: <4A2770C6.3040308@lshift.net>
References: <9b58f4550906031255t39eeb1e1jccd3426ed99f3b9c@mail.gmail.com>
	<4A2770C6.3040308@lshift.net>
Message-ID: <269388e30906040024q36ff06b5qcf381ea206354e82@mail.gmail.com>

Jack,

On Thu, Jun 4, 2009 at 7:59 AM, Ben Hood <ben at lshift.net> wrote:
>
>
> -------- Original Message --------
> From: Jack Moffitt <jack at collecta.com>
> Subject: erlang-client woes
> To: ben at lshift.net
>
> Hi Ben!
>
> I'm not sure what I'm doing wrong, but Alexis said you are the man to talk
> to.
>
> I'm using rabbitmq-erlang-client from hg as of today, and rabbitmq
> 1.5.5 (latest release on the site) under Erlang R13B.
>
> Using direct access mode fails because it can't find the username.
> Poking through the code, it seems to want direct access to mnesia
> databases.  I'm not sure how to grant it this access.  Pointing the
> node at the tables used by the rabbit node doesn't work.  Pointing it
> at a blank directory also doesn't work.  I assume that there is some
> magic mnesia setup bit that I'm missing.  It seems to me this should
> be done with rpc so that the clients don't have to know or care about
> data storage.
>
> Using TCP access mode just hangs forever.
>
> I must be doing something silly, but I can't seem to figure it out.
> Thanks for any assistance you can provide.

ATM the Erlang client does not work against the released version of
Rabbit rather only against the corresponding latest version of the
server in hg.

This is because the Erlang client shares some libraries with the
server and it  has not yet been released as a 1.0 package yet, so
currently there is no compatibility with the released version of the
server.

To get the server, clone the server repo,

hg up -C default; make run

and use one of the tests in the client, e.g.

make test_network.

HTH,

Ben



From matthias at lshift.net  Thu Jun  4 09:15:41 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 04 Jun 2009 09:15:41 +0100
Subject: [rabbitmq-discuss] [Fwd: erlang-client woes]
In-Reply-To: <269388e30906040024q36ff06b5qcf381ea206354e82@mail.gmail.com>
References: <9b58f4550906031255t39eeb1e1jccd3426ed99f3b9c@mail.gmail.com>	<4A2770C6.3040308@lshift.net>
	<269388e30906040024q36ff06b5qcf381ea206354e82@mail.gmail.com>
Message-ID: <4A2782AD.6010801@lshift.net>

Jack,

Ben Hood wrote:
> ATM the Erlang client does not work against the released version of
> Rabbit rather only against the corresponding latest version of the
> server in hg.

Actually, there is a v1_5 branch of the client, which does work with the
1.5.x brokers. I've just added a rabbitmq_v1_5_5 tag too, to make it
more obvious which version to use.


Matthias.



From alexis.richardson at gmail.com  Thu Jun  4 13:29:50 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 4 Jun 2009 13:29:50 +0100
Subject: [rabbitmq-discuss] Recovery and Upgrade Path
In-Reply-To: <c05e896e0905311704v3600f820ra6d3eb4f61054ec9@mail.gmail.com>
References: <c05e896e0905311704v3600f820ra6d3eb4f61054ec9@mail.gmail.com>
Message-ID: <167204d20906040529r5bf7c405t7bed29b778fb9c72@mail.gmail.com>

Estaban,

Hey there.

On Mon, Jun 1, 2009 at 1:04 AM, Steve Weaver <weaveinator at gmail.com> wrote:
> Hi all -
> Have a two part question on RabbitMq.? First I have RabbitMq running on both
> Windows Server and RHE server and was wondering what is the best way to go
> about recovery if the server itself fails or RabbitMq needs a restart.? I'm
> messing around with creating a windows service that starts it for the
> windows box but was wondering what the best practice is for both windows and
> linux.

RabbitMQ can already run as a Windows service; if you want to use that
to manage restarts, then that seems perfectly reaosnable to me.

I would not go so far as to say there is 'best practice' in these
cases.  How often might you need to restart and why?  Do you need to
recover data from disk?  Will you be running a cluster or just one
node?  How much automation do you need?

Let folks know, and some people might have some war stories and
recommendations that help ;-)


> Next - we are talking about upgrading rabbitmq so is that a just a matter of
> unistalling/reinstalling or can I just rebuild over the top of the older
> version.? I'm thinking more the point is for the RHE server as I'm still
> getting the hang of the command line stuff (linux noob for the most part) so
> that may just be clearing out the directory and dropping / compiling the new
> version there.

Are you asking: "how can I migrate my old configuration to a new install"?

alexis




> Thanks very much for any help or insight!
> Estaban
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Thu Jun  4 13:49:18 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 4 Jun 2009 13:49:18 +0100
Subject: [rabbitmq-discuss] 0-9-1 Coming Soon (Was:  Roadmap Questions)
Message-ID: <167204d20906040549q6ccabf26r2e7240fbf1298446@mail.gmail.com>

Hi all,

Just to add some colour to what Matthias said below, here are some
comments about backwards compatibility, and about AMQP spec versions.

On Wed, Jun 3, 2009 at 11:53 AM, Matthias Radestock <matthias at lshift.net> wrote:
>> 3) Clean compatibility with OpenAMQ's C library (aka WireAPI?) -- or
>> clean compatibility with *some* type of C-based library that is
>> compatible with a recent version of RabbitMQ (maybe:
>> http://hg.rabbitmq.com/rabbitmq-c/ ?)
>
> #3 hasn't been asked for much, so it's currently a low priority task.
> Having said that, any feedback on the experimental rabbitmq-c client is
> of course welcome. Also, we are aiming for compatibility with OpenAMQ
> when RabbitMQ implements AMQP 0-9-1.

The key point here is that we are converging on AMQP 0-9-1 and this
will mean a much greater degree of interoperability.  The aim is for
clients and brokers to work together out of the box, no matter who
made them.  In practice some edge cases won't work, and some code will
implement a subset of 0-9-1, but we have convinced ourselves that this
is going to make everyone's lives much easier and lead to greater
choice for users.

0-9-1 is coming very soon now (I'm avoiding dates for the usual
reasons...).  You may be able to help it come sooner.

Calling everyone - PLEASE do step up here.  We are looking for people
to help with 0-9-1 especially interop testing, and client migration.
Speak out on the list or contact me if for some reason you cannot do
the former.


>> Can someone let me know if any of these features will be backported to
>> a future v1.5.x release?
>
> I do not anticipate any more v1.5.x releases, and if there are any they
> will be for low-risk/high-impact bug fixes only.

To add to Matthias' comment: people in the community are of course
extremely welcome to help out here.  Obviously we can only do so much
and want to focus on the core features people are asking for.  We are
of course happy to help people out on the list.  If you want some
level of support that the list cannot give, let us know.

In the case of 0-9-1 some people will migrate and some people will
stay on 0-8.  Looking for feedback here: what do people want to do
about 0-9-1 migration vs staying on older versions?

Cheers,

alexis



From alexis.richardson at gmail.com  Thu Jun  4 13:56:12 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 4 Jun 2009 13:56:12 +0100
Subject: [rabbitmq-discuss] Roadmap Questions
In-Reply-To: <4A26F820.3080702@lshift.net>
References: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>
	<4A26562A.5080508@lshift.net>
	<bf5f1fdc0906030843v552484d7l8121a19c4d21e260@mail.gmail.com>
	<4A269D3C.7080201@lshift.net>
	<8aff81590906031120l2df5c5crd931e818243a8d6f@mail.gmail.com>
	<4A26F820.3080702@lshift.net>
Message-ID: <167204d20906040556q623ff3c3wfc986e886c11aa51@mail.gmail.com>

Hi guys,

I'd be happy to help people explore HA options until everyone is blue
in the face.  But, just in case that is not what people are looking
for, I think a good place to learn more is Tony's recent presentation
at London Geek Night.

Video and slides here:
http://skillsmatter.com/podcast/erlang/rabbitmq-internal-architecture-tony-garnock-jones

Enjoy!  And feel free to shoot questions to the list.

alexis



On Wed, Jun 3, 2009 at 11:24 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Keith,
>
> Keith Irwin wrote:
>> For instance, here's what I'd like to see:
>>
>> ?* Can store a LOT of messages on disk (more than fits in memory).
>>
>> ?* When one of the nodes in a cluster goes down, the queues on that
>> cluster begin working on another node. In other words, a fatal crash of
>> a node (server goes up in flames, disk melts) does not result in message
>> loss. (Replicated queues?)
>
> The two key features of the new persister are
>
> - message storage space is bounded by disk space rather than available
> physical or virtual memory
>
> - the computational cost of keeping a message stored is bounded
>
> So these address your first point.
>
>
> Your second point is only tangentially related to persistence - one can
> easily image a system where message loss is prevented by keeping a
> sufficient number of copies of the message in memory on different
> machines, without the messages ever hitting the disk.
>
> There are actually some fairly easy ways to get the kind of reliability
> you refer to from the existing RabbitMQ broker. Just to mention two of
> the options: 1) get the persister to write to a SAN, such that in the
> event of a node failure a standby node can pick up from where the first
> node left off, 2) route the messages to multiple queues on different
> nodes and get the consumers to consume from all the queues and perform
> deduplication.
>
> We have discussed these and other options with users on a number of
> occasions. Alexis may have some slides handy that illustrate the
> different approaches.
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthias at lshift.net  Thu Jun  4 14:39:33 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 04 Jun 2009 14:39:33 +0100
Subject: [rabbitmq-discuss] Roadmap Questions
In-Reply-To: <84fb38e30906031606x24fa9cd8ub5274761580712eb@mail.gmail.com>
References: <50c8ffe90906021618h24525035kbbb2f2ebfdfd2ab1@mail.gmail.com>	<4A26562A.5080508@lshift.net>	<bf5f1fdc0906030843v552484d7l8121a19c4d21e260@mail.gmail.com>	<4A269D3C.7080201@lshift.net>	<8aff81590906031120l2df5c5crd931e818243a8d6f@mail.gmail.com>	<4A26F820.3080702@lshift.net>
	<84fb38e30906031606x24fa9cd8ub5274761580712eb@mail.gmail.com>
Message-ID: <4A27CE95.5030106@lshift.net>

Tsuraan,

tsuraan wrote:
>> There are actually some fairly easy ways to get the kind of reliability
>> you refer to from the existing RabbitMQ broker. Just to mention two of
>> the options: 1) get the persister to write to a SAN, such that in the
>> event of a node failure a standby node can pick up from where the first
>> node left off
> 
> is this a trivial thing to do?  I know the queue and binding
> definitions are in a mnesia database, which is hostname dependent.  If
> you had whatever machine that's actively running rabbit always have
> the dns entry "rabbit.example.com", and you always start your erlang
> with -name rabbit at rabbit.example.com, will mnesia always come up and
> have everything working?

Generally yes. Mnesia recovers automatically from most faults, and the
steps for manual intervention in cases where it can't are well
documented. The same goes for the persister, though it may need a little
nudge (renaming the log file).

It's worth noting that the above is designed to cope with the
*occassional* fault - if you have machines falling over every day, or
cannot afford a few minutes outage, then option 2 - the dual queue
approach - is preferable.


Matthias.



From matthias at lshift.net  Thu Jun  4 15:08:18 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 04 Jun 2009 15:08:18 +0100
Subject: [rabbitmq-discuss] [Fwd: erlang-client woes]
In-Reply-To: <9b58f4550906040630x1016e9lf60365f6e5c903e@mail.gmail.com>
References: <9b58f4550906031255t39eeb1e1jccd3426ed99f3b9c@mail.gmail.com>	<4A2770C6.3040308@lshift.net>	<269388e30906040024q36ff06b5qcf381ea206354e82@mail.gmail.com>
	<9b58f4550906040630x1016e9lf60365f6e5c903e@mail.gmail.com>
Message-ID: <4A27D552.30102@lshift.net>

Jack,

Jack Moffitt wrote:
> I checked out rabbitmq_v1_5_5 of the erlang client, rebuilt, and I get
> exactly the same behavior for both local and network drivers.  User
> not found in the local case, and hung on recv() in the network case.
> 
> Hmm.  make test_network works.  Retrying with the guest user works.
> Using another created user hangs.  So at least we've made some forward
> progress.

So just to be clear, the test_network and test_direct tests pass, but
you are encountering problems when running your own code? If so, please
post a reproducible test case and I am sure we will be able to track
down the cause of the behaviour you are seeing.

>> This is because the Erlang client shares some libraries with the
>> server and it  has not yet been released as a 1.0 package yet, so
>> currently there is no compatibility with the released version of the
>> server.
> 
> That is mildly amusing since all the documentation talks about how you
> guys made it independent of the server API :)

The documentation talks about the API providing a layer of abstraction
over the internal server APIs. That means the code using the erlang
client API won't have to change with every change to the internal server
APIs, but the client lib implementation does, of course, need to track
the changes to the server code.

Regards,

Matthias.
PS: please keep rabbitmq-discuss cc'ed in your replies.



From matthias at lshift.net  Thu Jun  4 16:35:09 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 04 Jun 2009 16:35:09 +0100
Subject: [rabbitmq-discuss] [Fwd: erlang-client woes]
In-Reply-To: <9b58f4550906040614r7054a05ds854875ac122e47e6@mail.gmail.com>
References: <9b58f4550906031255t39eeb1e1jccd3426ed99f3b9c@mail.gmail.com>	<4A2770C6.3040308@lshift.net>	<269388e30906040024q36ff06b5qcf381ea206354e82@mail.gmail.com>	<4A2782AD.6010801@lshift.net>
	<9b58f4550906040614r7054a05ds854875ac122e47e6@mail.gmail.com>
Message-ID: <4A27E9AD.6010601@lshift.net>

Jack,

Jack Moffitt wrote:
> Should I be using this branch or the latest of both erlang-client and
> rabbitmq-server?

That depends on whether you need any of the new, post-1.5.x features,
and how much you value stability. That's not to say that the dev branch
is unstable, but it has a whole bunch of new features and changes that
haven't seen wide-spread testing, so the likelihood of bugs in it is
greater.


Matthias.



From 0x6e6562 at gmail.com  Thu Jun  4 16:41:41 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Jun 2009 16:41:41 +0100
Subject: [rabbitmq-discuss] [Fwd: erlang-client woes]
In-Reply-To: <9b58f4550906040801s45e90948qd7e60cc0094659eb@mail.gmail.com>
References: <9b58f4550906031255t39eeb1e1jccd3426ed99f3b9c@mail.gmail.com>
	<4A2770C6.3040308@lshift.net>
	<269388e30906040024q36ff06b5qcf381ea206354e82@mail.gmail.com>
	<9b58f4550906040630x1016e9lf60365f6e5c903e@mail.gmail.com>
	<4A27D552.30102@lshift.net>
	<9b58f4550906040801s45e90948qd7e60cc0094659eb@mail.gmail.com>
Message-ID: <269388e30906040841u21866b0fneb64b66d45add475@mail.gmail.com>

Jack,

On Thu, Jun 4, 2009 at 4:01 PM, Jack Moffitt <jack at collecta.com> wrote:
>> So just to be clear, the test_network and test_direct tests pass, but
>> you are encountering problems when running your own code? If so, please
>> post a reproducible test case and I am sure we will be able to track
>> down the cause of the behaviour you are seeing.
>
> No rabbitmq running, make test_direct passes. ?Launch rabbitmq, make
> test_network passes.
>
> Then:
>
> sliver:~/Sources/rabbitmq-erlang-client $ ~/rabbitmq/sbin/rabbitmqctl
> list_usersListing users ...
> guest
> jack
> ...done.
>
> And now:
>
> sliver:~/Sources/rabbitmq-erlang-client $ erl -name
> client at sliver.local -pa ebin ~/rabbitmq/ebin
> Erlang R13B (erts-5.7.1) [source] [smp:2:2] [rq:2] [async-threads:0]
> [hipe] [kernel-poll:false]
>
> Eshell V5.7.1 ?(abort with ^G)
> (client at sliver.local)1> Conn = amqp_connection:start("jack", "hackme").
> ** exception error: no match of right hand side value
> ? ? ? ? ? ? ? ? ? ?{error,{aborted,{no_exists,[user,<<"jack">>]}}}
> ? ? in function ?amqp_connection:start/3
>
> And:
>
> (client at sliver.local)3> Conn = amqp_connection:start("jack", "hackme",
> "localhost").
>
> hangs. ?If I use "guest", "guest" instead of "jack", "hackme", in the
> network version, it will work. ?However, "guest", "guest" does not
> work for the direct version. ?It gives the same error as above with
> either username,password pair.

Invoking amqp_connection:start/2 implies that you are trying to use
the direct client.

I suspect that you have not started Rabbit or Mnesia in this VM.

To find this out, tell what the output of which_applications/0 is, e.g.

3> application:which_applications().
[{rabbit,"RabbitMQ","%%VERSION%%"},
 {mnesia,"MNESIA  CXC 138 12","4.4.7"},
 {os_mon,"CPO  CXC 138 46","2.1.8"},
 {sasl,"SASL  CXC 138 11","2.1.5.4"},
 {stdlib,"ERTS  CXC 138 10","1.15.5"},
 {kernel,"ERTS  CXC 138 10","2.12.5"}]

If Rabbit and Mnesia are not there, then the broker instance cannot start.

One way to start these is to have them boot when you start the VM,
i.e. with these args:

erl -pa ebin rabbitmq_server/ebin -mnesia dir <SOME DIR> -s rabbit
-boot start_sasl

Doing this without adding your own user should result in an error like this:

{amqp,access_refused,"login refused for user 'jack'",none}

Which of course would be understandable if the mnesia instance in
<SOME DIR> did not contain that user.

HTH,

Ben



From jack at collecta.com  Thu Jun  4 16:54:23 2009
From: jack at collecta.com (Jack Moffitt)
Date: Thu, 4 Jun 2009 09:54:23 -0600
Subject: [rabbitmq-discuss] [Fwd: erlang-client woes]
In-Reply-To: <269388e30906040841u21866b0fneb64b66d45add475@mail.gmail.com>
References: <9b58f4550906031255t39eeb1e1jccd3426ed99f3b9c@mail.gmail.com>
	<4A2770C6.3040308@lshift.net>
	<269388e30906040024q36ff06b5qcf381ea206354e82@mail.gmail.com>
	<9b58f4550906040630x1016e9lf60365f6e5c903e@mail.gmail.com>
	<4A27D552.30102@lshift.net>
	<9b58f4550906040801s45e90948qd7e60cc0094659eb@mail.gmail.com>
	<269388e30906040841u21866b0fneb64b66d45add475@mail.gmail.com>
Message-ID: <9b58f4550906040854t2f6b63cdk561a95e7be4c7bd2@mail.gmail.com>

> Invoking amqp_connection:start/2 implies that you are trying to use
> the direct client.

Yes.  I'm familiar with the code paths.  I would like to use the
direct client since it has less overhead.

> I suspect that you have not started Rabbit or Mnesia in this VM.

Why would I?  Rabbit is already running in its own node.  Why should I
need to launch a second to talk to the first?  Why do I need mnesia as
a client?

It seems to me the design of the direct client is predicated on being
run in the same node as a running rabbit.  I guess my error is that I
assumed that the direct driver was replacing TCP socket calls with
Erlang rpc:call and node to node message passing.

Why bother checking the password at all for example?  If you have
access to the node, you have COMPLETE access, so it seems the API
should just ignore or not require the password in the first place.  Is
this all the mnesia bit is used for?

Any ideas why the network driver just hangs for non-guest users?

jack.



From 0x6e6562 at gmail.com  Thu Jun  4 17:27:42 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Jun 2009 17:27:42 +0100
Subject: [rabbitmq-discuss] [Fwd: erlang-client woes]
In-Reply-To: <9b58f4550906040854t2f6b63cdk561a95e7be4c7bd2@mail.gmail.com>
References: <9b58f4550906031255t39eeb1e1jccd3426ed99f3b9c@mail.gmail.com>
	<4A2770C6.3040308@lshift.net>
	<269388e30906040024q36ff06b5qcf381ea206354e82@mail.gmail.com>
	<9b58f4550906040630x1016e9lf60365f6e5c903e@mail.gmail.com>
	<4A27D552.30102@lshift.net>
	<9b58f4550906040801s45e90948qd7e60cc0094659eb@mail.gmail.com>
	<269388e30906040841u21866b0fneb64b66d45add475@mail.gmail.com>
	<9b58f4550906040854t2f6b63cdk561a95e7be4c7bd2@mail.gmail.com>
Message-ID: <269388e30906040927j1e86012ewca0d5480225efc99@mail.gmail.com>

Jack,

On Thu, Jun 4, 2009 at 4:54 PM, Jack Moffitt <jack at collecta.com> wrote:
>> I suspect that you have not started Rabbit or Mnesia in this VM.
>
> Why would I? ?Rabbit is already running in its own node. ?Why should I
> need to launch a second to talk to the first? ?Why do I need mnesia as
> a client?
>
> It seems to me the design of the direct client is predicated on being
> run in the same node as a running rabbit. ?I guess my error is that I
> assumed that the direct driver was replacing TCP socket calls with
> Erlang rpc:call and node to node message passing.

No, it is just using inner-VM message passing. Of course you could use
Erlang RPC to send these messages, but this may only be marginally
more efficient that AMQP encoding/decoding (but I haven't tested this
at all). The idea behind the direct driver is to avoid network
marshalling.

> Why bother checking the password at all for example? ?If you have
> access to the node, you have COMPLETE access, so it seems the API
> should just ignore or not require the password in the first place.

Sure, you can do whatever you want if you are inside the same node.
The motivation behind mandating credential checking was to keep the
API transparent to any client and maintain conformance with the AMQP
execution model FWIW.

> Is
> this all the mnesia bit is used for?

No, mnesia is used extensively in the broker to maintain routing tables.

HTH,

Ben



From matthias at lshift.net  Thu Jun  4 17:41:15 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 04 Jun 2009 17:41:15 +0100
Subject: [rabbitmq-discuss] [Fwd: erlang-client woes]
In-Reply-To: <9b58f4550906040854t2f6b63cdk561a95e7be4c7bd2@mail.gmail.com>
References: <9b58f4550906031255t39eeb1e1jccd3426ed99f3b9c@mail.gmail.com>	<4A2770C6.3040308@lshift.net>	<269388e30906040024q36ff06b5qcf381ea206354e82@mail.gmail.com>	<9b58f4550906040630x1016e9lf60365f6e5c903e@mail.gmail.com>	<4A27D552.30102@lshift.net>	<9b58f4550906040801s45e90948qd7e60cc0094659eb@mail.gmail.com>	<269388e30906040841u21866b0fneb64b66d45add475@mail.gmail.com>
	<9b58f4550906040854t2f6b63cdk561a95e7be4c7bd2@mail.gmail.com>
Message-ID: <4A27F92B.6080300@lshift.net>

Jack,

Jack Moffitt wrote:
> Any ideas why the network driver just hangs for non-guest users?

Are there any errors in the server logs?


Matthias.




From 0x6e6562 at gmail.com  Thu Jun  4 17:42:39 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Jun 2009 17:42:39 +0100
Subject: [rabbitmq-discuss] [Fwd: erlang-client woes]
In-Reply-To: <9b58f4550906040854t2f6b63cdk561a95e7be4c7bd2@mail.gmail.com>
References: <9b58f4550906031255t39eeb1e1jccd3426ed99f3b9c@mail.gmail.com>
	<4A2770C6.3040308@lshift.net>
	<269388e30906040024q36ff06b5qcf381ea206354e82@mail.gmail.com>
	<9b58f4550906040630x1016e9lf60365f6e5c903e@mail.gmail.com>
	<4A27D552.30102@lshift.net>
	<9b58f4550906040801s45e90948qd7e60cc0094659eb@mail.gmail.com>
	<269388e30906040841u21866b0fneb64b66d45add475@mail.gmail.com>
	<9b58f4550906040854t2f6b63cdk561a95e7be4c7bd2@mail.gmail.com>
Message-ID: <269388e30906040942v231e27e3md1cf683a169ec232@mail.gmail.com>

Jack,

On Thu, Jun 4, 2009 at 4:54 PM, Jack Moffitt <jack at collecta.com> wrote:
> Any ideas why the network driver just hangs for non-guest users?

That looks like it may be a bug. I've just tested this myself and the
server log shows this error:

{amqp,access_refused,
                      "access to vhost '/' refused for user 'guest2'",
                      'connection.open'}}

But the RPC doesn't return. I'll look into this.

Ben



From msmith1638 at gmail.com  Thu Jun  4 20:48:01 2009
From: msmith1638 at gmail.com (smittycb10)
Date: Thu, 4 Jun 2009 12:48:01 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbit MQ high-through put stock quotes
In-Reply-To: <e12fe9f10906031457j11f5935cu9432c89902ebcb3@mail.gmail.com>
References: <e12fe9f10906031457j11f5935cu9432c89902ebcb3@mail.gmail.com>
Message-ID: <23876536.post@talk.nabble.com>


This is a follow up to my previous message with some more details about how I
envision using Rabbit MQ.

Currently I have a system where a server takes in all messages from our data
provider and then streams the messages via UDP to a consumer application.
This set up can handle the message load but is proving to be difficult and
costly to scale. One producer to one Consuming server which then filters
data to desktop clients.

My idea for a future system is to have the same server simply push the
messages to a rabbit MQ Broker or Brokers and then have all clients simply
listen to whatever queues they need to get there jobs done. I need to design
for 100,000 (one hundred thousand) messages to made available for consuming
per second. Most consumers will only consume a fraction of these messages,
although some of our server pieces may need to subscribe to the whole
universe of incoming messages. Messages can and will be batched on the
publishing side.

So the use case would be, one publisher pushing messages to the "Broker
Cloud" many consumers some needing to listen to all messages others would
only be interested in a particular Stock symbol at a time. 

I will experiment with some fanout experiments next, any advice or direction
you have would be greatly appreciated. In a fanout pattern if say a quote
comes in for IBM how do I distribute only to people interested in IBM?

smittycb10 wrote:
> 
> Hello,Attached is a very simple version of my original experiment. I have
> been playing around with the messages per-second and seem to top out at
> about 5000 MS per second before the consumer appears to back up. Is this
> normal performance? (one broker running on windows with out of the box
> settings).
> Now what I really want to do is develop a pub sub system for listening to
> stock quotes that can handle 1000,000 messages per-second. I have a 8 core
> windows server 2003 at my disposal, do you think this is possible?
> If so how many brokers do you think I should run?
> What would be the optimal way to arrangement for my exchanges and queues
> to
> maximize use of all cores on the broker machine.
> How can I use direct queues in a publish subscribe system, I ask because
> you
> mentioned that direct queues are more efficient.
> 
> Thanks
> Mark
> 
> -- 
> Mark Smith
> 
> please send all correspondences to this
> new email address
> 
> 
> 
> -- 
> Mark Smith
> 
> please send all correspondences to this
> new email address
> 
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://www.nabble.com/rabbit-MQ-high-through-put-stock-quotes-tp23860396p23876536.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From jack at collecta.com  Fri Jun  5 06:03:03 2009
From: jack at collecta.com (Jack Moffitt)
Date: Thu, 4 Jun 2009 23:03:03 -0600
Subject: [rabbitmq-discuss] consuming problems
Message-ID: <9b58f4550906042203t31216e46ic43284c78adae6ad@mail.gmail.com>

So I've been able to figure out how to create queues, exchanges and
bindings, and also to publish messages to an exchange.  I can't find
documentation for what class_id does in the #content record, but
apparently it's required.  I set it to 60 which was what the only
example I could find used.

Now I'm trying to consume things from the queue.

BasicConsume  = #'basic.consume'{queue = <<"tostorage">>, consumer_tag
= <<"">>}.
#'basic.consume_ok'{consumer_tag = <<"">>} =
amqp_channel:call(Channel, BasicConsume, self()).

fails with:

Channel 1 is shutting down due to: {{badmatch,false},
                                    [{rabbit_writer,assemble_frames,4},
                                     {rabbit_writer,
                                      internal_send_command_async,5},
                                     {rabbit_writer,handle_message,2},
                                     {rabbit_writer,mainloop,1}]}

which seems to be from this line of rabbit_writer:assemble_frames/4:

true = rabbit_framing:method_has_content(MethodName), % assertion

And now I'm completely stuck again.

jack.



From matthias at lshift.net  Fri Jun  5 07:43:41 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 05 Jun 2009 07:43:41 +0100
Subject: [rabbitmq-discuss] consuming problems
In-Reply-To: <9b58f4550906042203t31216e46ic43284c78adae6ad@mail.gmail.com>
References: <9b58f4550906042203t31216e46ic43284c78adae6ad@mail.gmail.com>
Message-ID: <4A28BE9D.10906@lshift.net>

Jack,

Jack Moffitt wrote:
> So I've been able to figure out how to create queues, exchanges and
> bindings, and also to publish messages to an exchange.  I can't find
> documentation for what class_id does in the #content record, but
> apparently it's required.  I set it to 60 which was what the only
> example I could find used.

The class_id refers to the AMQP content class, of which there is only 
one defined in the current spec. It's called 'basic' and the id of it is 
indeed 60.

> Now I'm trying to consume things from the queue.
> 
> BasicConsume  = #'basic.consume'{queue = <<"tostorage">>, consumer_tag
> = <<"">>}.
> #'basic.consume_ok'{consumer_tag = <<"">>} =
> amqp_channel:call(Channel, BasicConsume, self()).
> 
> fails with:
> 
> Channel 1 is shutting down due to: {{badmatch,false},
>                                     [{rabbit_writer,assemble_frames,4},
>                                      {rabbit_writer,
>                                       internal_send_command_async,5},
>                                      {rabbit_writer,handle_message,2},
>                                      {rabbit_writer,mainloop,1}]}
> 
> which seems to be from this line of rabbit_writer:assemble_frames/4:
> 
> true = rabbit_framing:method_has_content(MethodName), % assertion
> 
> And now I'm completely stuck again.

amqp_channel:call/3 is defined as follows:

%% Generic AMQP send mechanism with content
call(Channel, Method, Content) ->
     gen_server:call(Channel, {call, Method, Content}).

So, as you can see, this function is for sending content-bearing 
methods. 'basic.consume' is not content-bearing, and setting the content 
to self() won't work, for obvious reasons.

You'll probably want to use amqp_channel:subscribe/3 instead.


Also, have you looked at lib_amqp.erl? It contains a number of 
convenient wrappers around the core API.


Regards,

Matthias



From matthias at lshift.net  Fri Jun  5 14:39:14 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 05 Jun 2009 14:39:14 +0100
Subject: [rabbitmq-discuss] rabbit MQ high-through put stock quotes
In-Reply-To: <23876536.post@talk.nabble.com>
References: <e12fe9f10906031457j11f5935cu9432c89902ebcb3@mail.gmail.com>
	<23876536.post@talk.nabble.com>
Message-ID: <4A292002.5080308@lshift.net>

Mark,

smittycb10 wrote:
> My idea for a future system is to have the same server simply push the
> messages to a rabbit MQ Broker or Brokers and then have all clients simply
> listen to whatever queues they need to get there jobs done. I need to design
> for 100,000 (one hundred thousand) messages to made available for consuming
> per second. Most consumers will only consume a fraction of these messages,
> although some of our server pieces may need to subscribe to the whole
> universe of incoming messages. Messages can and will be batched on the
> publishing side.

I recommend treating the "all messages to a few consumers" and "each
message to a small subset of lots of consumers" cases separately.

If you don't mind, I'd like to focus on the first part, since that one
is easier to set up. Once you have that working we can then move on to
the second part.

To get a 100KHz stream of messages distributed to a handful of
consumers, I'd suggest batching them based on time, e.g. 1 millisecond's
worth of messages, and send each batch as a single message to a fanout
exchange to which all consumers have bound a queue.

On the consuming side, use a no-ack consumer (and, consequently, do not
explicitly acknowledge the messages) for best performance.

Also, let me just re-iterate that for meaningful benchmark results it is
important to throttle the producer, e.g. send messages at a fixed rate.
If you do the time-based batching above you'll have good control over
that. Then monitor the rate at which messages are received by consumers,
and slowly increase the producing rate until the consumption rate starts
falling behind, at which point you have found the limits of that
particular setup.

Also, make sure you run the producers and consumers on a different
machine to the broker, and monitor their CPU usage in case they are
maxing out the CPU (and thus skew the results).


Regards,

Matthias.



From hwwatkins at gmail.com  Fri Jun  5 15:07:57 2009
From: hwwatkins at gmail.com (Hugh Watkins)
Date: Fri, 5 Jun 2009 10:07:57 -0400
Subject: [rabbitmq-discuss] Clustering Question
Message-ID: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>

I was trying to understand how the clustering support works in RabbitMQ

1) From the documentation the message queue data is not clustered, so if you
have queue created on one machine and the queue is not persisted then that
box going down will cause the queued messages to be destroyed. Is this a
correct interpretation?

I have a system that is creating perishable queue messages, i.e. they need
to be acted on in 100-200 ms or it's to late a timeout will occur further up
the chain.  I would like to setup a cluster an protect as many messages as
possible.  It would not be worth creating a persistent queue  because it
would slow down the processing and as I mentioned these are perishable
messages.

It seems like I should create different queues on each machine in the
cluster and try to load balance across those queues, either by having the
producers write too the local queue, round robin or some other mechanism.
 The workers in turn would listen on all queues.  Does this sound
reasonable?  It requires more configuration than I was hoping for because at
least the workers have to be aware on another queue being created if another
node is added.

Thanks,
Hugh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090605/aa8d1698/attachment.htm 

From cremes.devlist at mac.com  Fri Jun  5 15:09:14 2009
From: cremes.devlist at mac.com (Chuck Remes)
Date: Fri, 05 Jun 2009 09:09:14 -0500
Subject: [rabbitmq-discuss] Fwd:  rabbit MQ high-through put stock quotes
References: <994147BB-CD16-40E3-AFC9-1F2A6AC5FF04@mac.com>
Message-ID: <35ABC959-4B2B-4969-A740-67D76FB4A0F6@mac.com>

Oops, I meant to send this to the ML. Forwarding...

cr

Begin forwarded message:

> From: Chuck Remes <cremes.devlist at mac.com>
> Date: June 4, 2009 4:16:17 PM CDT
> To: smittycb10 <msmith1638 at gmail.com>
> Subject: Re: [rabbitmq-discuss] rabbit MQ high-through put stock  
> quotes
>
>
> On Jun 4, 2009, at 2:48 PM, smittycb10 wrote:
>
>>
>> This is a follow up to my previous message with some more details  
>> about how I
>> envision using Rabbit MQ.
>>
>> Currently I have a system where a server takes in all messages from  
>> our data
>> provider and then streams the messages via UDP to a consumer  
>> application.
>> This set up can handle the message load but is proving to be  
>> difficult and
>> costly to scale. One producer to one Consuming server which then  
>> filters
>> data to desktop clients.
>>
>> My idea for a future system is to have the same server simply push  
>> the
>> messages to a rabbit MQ Broker or Brokers and then have all clients  
>> simply
>> listen to whatever queues they need to get there jobs done. I need  
>> to design
>> for 100,000 (one hundred thousand) messages to made available for  
>> consuming
>> per second. Most consumers will only consume a fraction of these  
>> messages,
>> although some of our server pieces may need to subscribe to the whole
>> universe of incoming messages. Messages can and will be batched on  
>> the
>> publishing side.
>>
>> So the use case would be, one publisher pushing messages to the  
>> "Broker
>> Cloud" many consumers some needing to listen to all messages others  
>> would
>> only be interested in a particular Stock symbol at a time.
>>
>> I will experiment with some fanout experiments next, any advice or  
>> direction
>> you have would be greatly appreciated. In a fanout pattern if say a  
>> quote
>> comes in for IBM how do I distribute only to people interested in  
>> IBM?
>
> Let me take a crack at this. Be forewarned that everything I write  
> here might be wrong. :)
>
> We have 3 kinds of queues to choose from: direct, fanout and topic.
>
> In terms of performance, they behave in the order listed above from  
> fastest to slowest.
>
> For direct exchanges, you bind your queue to it with a specific  
> routing key. Any messages published to that exchange need to include  
> a routing key. If the message's routing key *exactly* matches your  
> binding's routing key, the message is delivered to your queue.
>
> For fanout exchanges, you bind a queue to it without any routing  
> key. Any messages published to it are *unconditionally* delivered to  
> the queue. The reason I didn't mark this as the fastest queue type  
> is because you generally only pick it when you have lots of bound  
> queues so the message needs to be copied to each. (Of course, this  
> is implementation specific and could be very fast or slow; I don't  
> know how Rabbit performs this operation.) If you only have one  
> subscriber, this will be faster than the direct exchange because you  
> skip the routing key comparison.
>
> For topic exchanges, you bind a queue to the exchange with a routing  
> pattern. Any messages published with a key that matches your pattern  
> are delivered to the queue.
>
> With that out of the way, I would suggest a fanout exchange per high- 
> volume symbol. Any interested subscribers can bind a uniquely-named  
> queue to that exchange and get all messages for IBM. Note I said you  
> need a uniquely-named queue per subscriber. If you use a single  
> queue for all subscribers, the subscribers will get messages in a  
> round-robin fashion (usually). So N subscribers would only see an  
> update every N messages which is probably not what you want.
>
> Alternately, you could use a direct exchange for the low-volume  
> stocks. Interested subscribers could bind their (again) uniquely- 
> named queue with a routing key matching the symbol (or some other  
> identifier). Rabbit is smart enough that it will only deliver  
> messages to queues where the keys match exactly. The reason I  
> suggest this is due to potential performance concerns on the server  
> side if it has to handle hundreds or thousands of unique exchanges.  
> I don't know if Rabbit suffers from any performance degradation in  
> this situation, so make sure to benchmark it.
>
> Additionally, you'll want to publish messages with "nowait" and  
> "noack" and "not persistent" and make sure the queues are not  
> "durable." See the API docs for your chosen library to see how to  
> set those flags. "Nowait" means the client should not wait for a  
> response to the publish method. "No ack" means the message itself  
> doesn't need to be acknowledged as received; the server will "pre- 
> ack" each message pulled from the queue. And the "not persistent"  
> setting interacts with the "durability" setting on the queue.  
> Durable messages (inside durable queues) are stored on disk so that  
> a crash and restart doesn't lose any messages. For transient  
> messages like stock quotes, you don't want them persisted at this  
> level.
>
> Someone else on the list will have to answer your questions about  
> scaling up to 100k/sec. I think Erlang processes are still single- 
> threaded so you probably need to run multiple instances to take  
> advantage of multi-core servers. Perhaps this is Rabbit  
> clustering... I honestly don't know.
>
> FYI, tests on my hardware show that publishing from one process to  
> another on the same box using a direct exchange and the suggestions  
> listed above introduces around 600 microseconds in delivery latency.  
> Pay close attention to your serialization/deserialization code; its  
> performance could be a gating factor.
>
> Let us know how things turn out.
>
> cr
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090605/68069719/attachment.htm 

From ryan at acceleration.net  Fri Jun  5 15:20:08 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Fri, 05 Jun 2009 10:20:08 -0400
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
Message-ID: <4A292998.3090407@acceleration.net>

I have some C# code extending SimpleRpcServer and am getting an
exception when trying to shut down.  In the documentation PDF, it said
to call the Close() function on your RpcServer when you are ready to
shutdown.  Since the MainLoop() function blocks, the Close() has to be
called from another thread, right?  I have code that looks something
like this:

//RpcServer is a member variable
parentObj.ShuttingDown += delegate {
  RpcServer.Close();
};
// glossing over the AMQP config a little here
using(var connection =  factory.CreateConnection("my-amqp-server"))
using(var model =  connection.CreateModel())
using(var subscription =  new Subscription(model, "queue", false))
using (RpcServer = new MyRpcServer(subscription, this)) { // MyRpcServer
extends SimpleRpcServer
  RpcServer.MainLoop();
}

When I do fire the ShuttingDown event from another thread, we call
Close() with no problems, and then the MainLoop throws a
NullReferenceException:

System.NullReferenceException: Object reference not set to an instance of an object.     
at RabbitMQ.Client.Impl.ModelBase.BasicCancel(String consumerTag)     
at RabbitMQ.Client.MessagePatterns.Subscription.Close()     
at RabbitMQ.Client.MessagePatterns.Subscription.System.IDisposable.Dispose()     
at RabbitMQ.Client.MessagePatterns.SimpleRpcServer.MainLoop()

I followed this call stack through the RabbitMQ.Client source and didn't
see anything obvious.

This isn't causing me any harm right now (other than red flags in my
logs), but it would be if I tried to put anything important after the
MainLoop call.

Is there a cleaner way to shut down an RpcServer?  Should I just swallow
this nullref when I'm shutting down?

Thanks,

-- 
Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506




From camilol at gmail.com  Fri Jun  5 15:32:50 2009
From: camilol at gmail.com (Camilo Lopez)
Date: Fri, 5 Jun 2009 10:32:50 -0400
Subject: [rabbitmq-discuss] Creating exchanges on demand.
Message-ID: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>

Hello list,

I'm pretty new to AMQP and Rabbit. I'm trying to solve a problem where
I have a queue of incoming jobs and a pool of worker process. Some of
the jobs have to be processed syncrhonically.

There is one producer process feeding jobs to a incoming queue (q1),
every job has a unique id encoded in the message. All the workers read
from q1, do the  processing and put back the result in a outgoing
queue (q2) using the unique id as routing key.

When a job is synchronous, the producer will subscribe to q2, waiting
for a result tagged with the unique id  assigned when it was put in
q1.

Now, in order to wait for a specific message the producer creates a
new exchange for every synchronous job  with the unique id as key and
binds it to the queue before subscribing.

Now the question/s:

Is it OK to create a large number of exchanges? is it going to impact
performance?
 or  Am I doing something terribly wrong here? is there a best
practice I can refer to? if so any advice on the correct way to do
this would be appreciated.

Thanks!

---
Camilo Lopez



From tonyg at lshift.net  Fri Jun  5 15:41:43 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 05 Jun 2009 15:41:43 +0100
Subject: [rabbitmq-discuss] Different Stomp Issue: rabbitmq-stomp and
 Codehaus PHP Stomp class
In-Reply-To: <af1bce590906031546l6a6a05beifa2ac0acd659569a@mail.gmail.com>
References: <af1bce590906031546l6a6a05beifa2ac0acd659569a@mail.gmail.com>
Message-ID: <4A292EA7.5030103@lshift.net>

Hi Gavin,

Yes, the ambiguity here is unfortunate.

Gavin M. Roy wrote:
> appends a linefeed after the frame's null terminator,
> which rabbitmq-stomp does not like.  Instead of sending frame endings
> as \0 they are sending them as \0\n.

The code currently (and at both the 1.5.3 and 1.5.5 tags) accepts any
number of leading \r and \n characters before a command -- what exactly
does the STOMP adapter do when it is sent a \0\n sequence as a frame
terminator?

> In addition they send no-op \0's before senidng a frame, which
> rabbitmq-stomp does not like.

Yes, that's a current problem. I'll fix that in a similar way to the way
excess \n's are (or at least *should be* :-) ) being ignored now.

> However, I do believe that the rabbitmq-stomp connector should be more
> protocol variance tolerant and accept the \0\n frame ends and out of
> frame \0 characters without causing issues.

Yes. I agree. I think it should, however, stay strict in terms of what
it emits (i.e. continue to use plain \0 for its frame terminator when
it's speaking) -- do you think that makes sense?

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri Jun  5 15:51:11 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 05 Jun 2009 15:51:11 +0100
Subject: [rabbitmq-discuss] Different Stomp Issue: rabbitmq-stomp and
 Codehaus PHP Stomp class
In-Reply-To: <4A292EA7.5030103@lshift.net>
References: <af1bce590906031546l6a6a05beifa2ac0acd659569a@mail.gmail.com>
	<4A292EA7.5030103@lshift.net>
Message-ID: <4A2930DF.8030008@lshift.net>

Tony Garnock-Jones wrote:
>Gavin M. Roy wrote:
>> In addition they send no-op \0's before senidng a frame, which
>> rabbitmq-stomp does not like.
> Yes, that's a current problem. I'll fix that in a similar way to the way
> excess \n's are (or at least *should be* :-) ) being ignored now.

I've added that fix on rabbitmq-stomp's v1_5 branch, as well as on its
default branch, and I've moved its rabbitmq_v1_5_5 tag to include the fix.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From jasonjwwilliams at gmail.com  Fri Jun  5 17:11:35 2009
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Fri, 5 Jun 2009 10:11:35 -0600
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
Message-ID: <3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>

Hi Hugh,
Queue data is not replicated to other members of the cluster (whether it's a
persistent or non-persistent queue), so if a cluster member dies, all queue
data goes poof if it's non-persistent. However, if it is persistent, while
queue data doesn't go poof (still in the log) when you restart the node the
queue data won't auto replay into the cluster.  You'll have to do that
manually.

-J

On Fri, Jun 5, 2009 at 8:07 AM, Hugh Watkins <hwwatkins at gmail.com> wrote:

>
> I was trying to understand how the clustering support works in RabbitMQ
>
> 1) From the documentation the message queue data is not clustered, so if
> you have queue created on one machine and the queue is not persisted then
> that box going down will cause the queued messages to be destroyed. Is this
> a correct interpretation?
>
> I have a system that is creating perishable queue messages, i.e. they need
> to be acted on in 100-200 ms or it's to late a timeout will occur further up
> the chain.  I would like to setup a cluster an protect as many messages as
> possible.  It would not be worth creating a persistent queue  because it
> would slow down the processing and as I mentioned these are perishable
> messages.
>
> It seems like I should create different queues on each machine in the
> cluster and try to load balance across those queues, either by having the
> producers write too the local queue, round robin or some other mechanism.
>  The workers in turn would listen on all queues.  Does this sound
> reasonable?  It requires more configuration than I was hoping for because at
> least the workers have to be aware on another queue being created if another
> node is added.
>
> Thanks,
> Hugh
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090605/1e236f9e/attachment.htm 

From keith.irwin at gmail.com  Fri Jun  5 17:25:02 2009
From: keith.irwin at gmail.com (Keith Irwin)
Date: Fri, 5 Jun 2009 09:25:02 -0700
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
	<3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>
Message-ID: <05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>


On Jun 5, 2009, at 9:11 AM, Jason J. W. Williams wrote:

> Hi Hugh,
>
> Queue data is not replicated to other members of the cluster  
> (whether it's a persistent or non-persistent queue), so if a cluster  
> member dies, all queue data goes poof if it's non-persistent.  
> However, if it is persistent, while queue data doesn't go poof  
> (still in the log) when you restart the node the queue data won't  
> auto replay into the cluster.  You'll have to do that manually.

Are you saying that if an instance of RabbitMQ does down and is  
brought back up, its persistent messages won't be delivered when a  
consumer re-attaches?  (I'm not sure what you mean by "manually".)

If that's the case, that seems quite broken and not fault-tolerant at  
all.

Surely, I'm misunderstanding.....

I so need to get out from under my workload and write some tests.

Keith

>
> -J
>
> On Fri, Jun 5, 2009 at 8:07 AM, Hugh Watkins <hwwatkins at gmail.com>  
> wrote:
>
> I was trying to understand how the clustering support works in  
> RabbitMQ
>
> 1) From the documentation the message queue data is not clustered,  
> so if you have queue created on one machine and the queue is not  
> persisted then that box going down will cause the queued messages to  
> be destroyed. Is this a correct interpretation?
>
> I have a system that is creating perishable queue messages, i.e.  
> they need to be acted on in 100-200 ms or it's to late a timeout  
> will occur further up the chain.  I would like to setup a cluster an  
> protect as many messages as possible.  It would not be worth  
> creating a persistent queue  because it would slow down the  
> processing and as I mentioned these are perishable messages.
>
> It seems like I should create different queues on each machine in  
> the cluster and try to load balance across those queues, either by  
> having the producers write too the local queue, round robin or some  
> other mechanism.  The workers in turn would listen on all queues.   
> Does this sound reasonable?  It requires more configuration than I  
> was hoping for because at least the workers have to be aware on  
> another queue being created if another node is added.
>
> Thanks,
> Hugh
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090605/8b8caa9d/attachment.htm 

From matthias at lshift.net  Fri Jun  5 18:26:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 05 Jun 2009 18:26:00 +0100
Subject: [rabbitmq-discuss] consuming problems
In-Reply-To: <9b58f4550906050908r47ede0ewb6c0d3ce90836c3@mail.gmail.com>
References: <9b58f4550906042203t31216e46ic43284c78adae6ad@mail.gmail.com>	<4A28BE9D.10906@lshift.net>
	<9b58f4550906050908r47ede0ewb6c0d3ce90836c3@mail.gmail.com>
Message-ID: <4A295528.9030906@lshift.net>

Jack,

Jack Moffitt wrote:
>> The class_id refers to the AMQP content class, of which there is only one
>> defined in the current spec. It's called 'basic' and the id of it is indeed
>> 60.
> 
> May I suggest that you put that as the default in the erlang record
> then?  Or at mention it in the comments in rabbit_framing.hrl?  I
> couldn't even find information about this in the specification.  It
> seems like unless I was an active participant in the AMQP standards
> process, I'd have no way to know what this was.

If you use lib_amqp then you are shielded from that particular aspect.

>> You'll probably want to use amqp_channel:subscribe/3 instead.
> 
> So basically the only documentation that exists:
> http://hopper.squarespace.com/blog/2008/1/12/introducing-the-erlang-amqp-client.html
> is wrong.

That page is nearly 18 months old. A few things have changed in the API
since that post.

>> Also, have you looked at lib_amqp.erl? It contains a number of convenient
>> wrappers around the core API.
> 
> How would I have found out about this?  I'll go investigate it now
> that you've mentioned it.
> 
> I think this would have gone a lot smoother had there been one or two
> examples in the README that had some comments and that got maintained
> along with the code.  It's not very fun to not have documentation, but
> its even worse when the documentation you can find is incorrect.

There are a whole bunch of tests that ship with the code which can serve
as a starting point for further exploration.

Having said that, the Erlang client is experimental, and clearly marked
as such. One reason for its experimental status is the sparseness of
documentation.

We welcome patches to improve the code, comments, examples, docs, etc.
Also, perhaps you could write a blog post that substitutes the
out-of-date one above.


Regards,

Matthias.



From aaron.feng at gmail.com  Fri Jun  5 18:33:31 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Fri, 5 Jun 2009 13:33:31 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
Message-ID: <4e3934860906051033q43a05a3ck3553a3619b899ad4@mail.gmail.com>

Trixx dashboard makeover.  We still have a lot of work left, but here's a
sneak peek.

http://cloud.github.com/downloads/aaronfeng/trixx/trixx-dashboard1.png
http://cloud.github.com/downloads/aaronfeng/trixx/trixx-dashboard2.png
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090605/35f87a6c/attachment.htm 

From gmr at myyearbook.com  Fri Jun  5 18:38:05 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 5 Jun 2009 13:38:05 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <4e3934860906051033q43a05a3ck3553a3619b899ad4@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
	<4e3934860906051033q43a05a3ck3553a3619b899ad4@mail.gmail.com>
Message-ID: <af1bce590906051038rb794a35ma08b2c6f6f07e533@mail.gmail.com>

Looks great :D

On Fri, Jun 5, 2009 at 1:33 PM, Aaron Feng <aaron.feng at gmail.com> wrote:

> Trixx dashboard makeover.  We still have a lot of work left, but here's a
> sneak peek.
>
> http://cloud.github.com/downloads/aaronfeng/trixx/trixx-dashboard1.png
> http://cloud.github.com/downloads/aaronfeng/trixx/trixx-dashboard2.png
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090605/b5002168/attachment.htm 

From work at anomalizer.net  Fri Jun  5 19:50:36 2009
From: work at anomalizer.net (Arvind Jayaprakash)
Date: Sat, 6 Jun 2009 00:20:36 +0530
Subject: [rabbitmq-discuss] rabbit MQ high-through put stock quotes
In-Reply-To: <23876536.post@talk.nabble.com>
References: <e12fe9f10906031457j11f5935cu9432c89902ebcb3@mail.gmail.com>
	<23876536.post@talk.nabble.com>
Message-ID: <20090605185011.GA11868@aa>

On Jun 04, smittycb10 wrote:
>I will experiment with some fanout experiments next, any advice or direction
>you have would be greatly appreciated. In a fanout pattern if say a quote
>comes in for IBM how do I distribute only to people interested in IBM?

I think you need to use topics and not fanout for that case.



From work at anomalizer.net  Fri Jun  5 19:55:53 2009
From: work at anomalizer.net (Arvind Jayaprakash)
Date: Sat, 6 Jun 2009 00:25:53 +0530
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
Message-ID: <20090605185553.GB11868@aa>

On Jun 05, Hugh Watkins wrote:
>I was trying to understand how the clustering support works in RabbitMQ
>
>1) From the documentation the message queue data is not clustered, so if you
>have queue created on one machine and the queue is not persisted then that
>box going down will cause the queued messages to be destroyed. Is this a
>correct interpretation?
>
>I have a system that is creating perishable queue messages, i.e. they need
>to be acted on in 100-200 ms or it's to late a timeout will occur further up
>the chain.  I would like to setup a cluster an protect as many messages as
>possible.  It would not be worth creating a persistent queue  because it
>would slow down the processing and as I mentioned these are perishable
>messages.
>
>It seems like I should create different queues on each machine in the
>cluster and try to load balance across those queues, either by having the
>producers write too the local queue, round robin or some other mechanism.
> The workers in turn would listen on all queues.  Does this sound
>reasonable?  It requires more configuration than I was hoping for because at
>least the workers have to be aware on another queue being created if another
>node is added.

Clustering is not going to help in increasing the queue reliability in
the current implementation. If you intend to replicate queues on
multiple nodes, they might as well be standalone nodes. Clustering
increases the availability of only bindings and exchanges.



From work at anomalizer.net  Fri Jun  5 20:03:09 2009
From: work at anomalizer.net (Arvind Jayaprakash)
Date: Sat, 6 Jun 2009 00:33:09 +0530
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
Message-ID: <20090605190309.GC11868@aa>

On Jun 05, Camilo Lopez wrote:
>Hello list,
>
>I'm pretty new to AMQP and Rabbit. I'm trying to solve a problem where
>I have a queue of incoming jobs and a pool of worker process. Some of
>the jobs have to be processed syncrhonically.
>
>There is one producer process feeding jobs to a incoming queue (q1),
>every job has a unique id encoded in the message. All the workers read
>from q1, do the  processing and put back the result in a outgoing
>queue (q2) using the unique id as routing key.
>
>When a job is synchronous, the producer will subscribe to q2, waiting
>for a result tagged with the unique id  assigned when it was put in
>q1.
>
>Now, in order to wait for a specific message the producer creates a
>new exchange for every synchronous job  with the unique id as key and
>binds it to the queue before subscribing.
>
>Now the question/s:
>
>Is it OK to create a large number of exchanges? is it going to impact
>performance?
> or  Am I doing something terribly wrong here? is there a best
>practice I can refer to? if so any advice on the correct way to do
>this would be appreciated.

Have you looked at this?
http://www.rabbitmq.com/api-guide.html#rpc



From alexis.richardson at gmail.com  Fri Jun  5 20:09:29 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 5 Jun 2009 20:09:29 +0100
Subject: [rabbitmq-discuss] Fwd:  Recovery and Upgrade Path
In-Reply-To: <c05e896e0906042037i21f6902esde9b1b8e61c208d1@mail.gmail.com>
References: <c05e896e0905311704v3600f820ra6d3eb4f61054ec9@mail.gmail.com>
	<167204d20906040529r5bf7c405t7bed29b778fb9c72@mail.gmail.com>
	<c05e896e0906042037i21f6902esde9b1b8e61c208d1@mail.gmail.com>
Message-ID: <167204d20906051209y5d6a30cch6ced51053b1e2d1d@mail.gmail.com>

With Estaban's permission, I am forwarding this to the list.

Estaban I think your own suggestion is reasonable but you could also
look at our Windows service for that platform.

Re Erlang, think of it as being like Java.  You won't upgrade it very
often.  Read the RabbitMQ release notes for upgrade recommendations.


---------- Forwarded message ----------
From: Steve Weaver <weaveinator at gmail.com>
Date: Fri, Jun 5, 2009 at 4:37 AM
Subject: Re: [rabbitmq-discuss] Recovery and Upgrade Path
To: Alexis Richardson <alexis.richardson at gmail.com>


Hi Alexis -
Thanks for the reply.? So yeah I was wondering if I just create a bat
file (and shell script) on Windows Server/RHE server so if the box
ever crashes or gets a reboot that RabbitMQ will come back
automatically.? That is what I was thinking but wanted to know if that
was the best way.
Next is - yes - what is the best (and read easiest) way to upgrade and
I'm thinking to remove the old version completely and reinstall.? But
the reason why I ask is - on Red Hat - do I need to upgrade Erlang
first?? Its included in the Windows install so no worries there.

Thanks so much for your help - and sorry if I sound like I'm new. Its
only because I am.
Cheers

On Thu, Jun 4, 2009 at 5:29 AM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
>
> Estaban,
>
> Hey there.
>
> On Mon, Jun 1, 2009 at 1:04 AM, Steve Weaver <weaveinator at gmail.com> wrote:
> > Hi all -
> > Have a two part question on RabbitMq.? First I have RabbitMq running on both
> > Windows Server and RHE server and was wondering what is the best way to go
> > about recovery if the server itself fails or RabbitMq needs a restart.? I'm
> > messing around with creating a windows service that starts it for the
> > windows box but was wondering what the best practice is for both windows and
> > linux.
>
> RabbitMQ can already run as a Windows service; if you want to use that
> to manage restarts, then that seems perfectly reaosnable to me.
>
> I would not go so far as to say there is 'best practice' in these
> cases. ?How often might you need to restart and why? ?Do you need to
> recover data from disk? ?Will you be running a cluster or just one
> node? ?How much automation do you need?
>
> Let folks know, and some people might have some war stories and
> recommendations that help ;-)
>
>
> > Next - we are talking about upgrading rabbitmq so is that a just a matter of
> > unistalling/reinstalling or can I just rebuild over the top of the older
> > version.? I'm thinking more the point is for the RHE server as I'm still
> > getting the hang of the command line stuff (linux noob for the most part) so
> > that may just be clearing out the directory and dropping / compiling the new
> > version there.
>
> Are you asking: "how can I migrate my old configuration to a new install"?
>
> alexis
>
>
>
>
> > Thanks very much for any help or insight!
> > Estaban
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >



From alexis.richardson at gmail.com  Fri Jun  5 20:29:12 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 5 Jun 2009 20:29:12 +0100
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <20090605185553.GB11868@aa>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
	<20090605185553.GB11868@aa>
Message-ID: <167204d20906051229x7c654c88h9d62773c223b7f90@mail.gmail.com>

Guys

I recommend Tony's recent london geek night talk on this subject.  I
think I posted the URL in the last day or two.

alexis


On Fri, Jun 5, 2009 at 7:55 PM, Arvind Jayaprakash<work at anomalizer.net> wrote:
> On Jun 05, Hugh Watkins wrote:
>>I was trying to understand how the clustering support works in RabbitMQ
>>
>>1) From the documentation the message queue data is not clustered, so if you
>>have queue created on one machine and the queue is not persisted then that
>>box going down will cause the queued messages to be destroyed. Is this a
>>correct interpretation?
>>
>>I have a system that is creating perishable queue messages, i.e. they need
>>to be acted on in 100-200 ms or it's to late a timeout will occur further up
>>the chain. ?I would like to setup a cluster an protect as many messages as
>>possible. ?It would not be worth creating a persistent queue ?because it
>>would slow down the processing and as I mentioned these are perishable
>>messages.
>>
>>It seems like I should create different queues on each machine in the
>>cluster and try to load balance across those queues, either by having the
>>producers write too the local queue, round robin or some other mechanism.
>> The workers in turn would listen on all queues. ?Does this sound
>>reasonable? ?It requires more configuration than I was hoping for because at
>>least the workers have to be aware on another queue being created if another
>>node is added.
>
> Clustering is not going to help in increasing the queue reliability in
> the current implementation. If you intend to replicate queues on
> multiple nodes, they might as well be standalone nodes. Clustering
> increases the availability of only bindings and exchanges.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From camilol at gmail.com  Fri Jun  5 20:30:47 2009
From: camilol at gmail.com (Camilo Lopez)
Date: Fri, 5 Jun 2009 15:30:47 -0400
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <20090605190309.GC11868@aa>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
	<20090605190309.GC11868@aa>
Message-ID: <f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>

Thanks for the link ,

No I had not seen it , I'm not using Java (using ruby btw) so I did
not really looked into the Java client specifics.  I just checked and
one of the ruby libraries does implement an RPC convenience.

I guess this will be a better idea that what I'm doing now, but in
genral is it a bad idea do create a bunch of Exchanges?


On Fri, Jun 5, 2009 at 3:03 PM, Arvind Jayaprakash <work at anomalizer.net> wrote:
> On Jun 05, Camilo Lopez wrote:
>>Hello list,
>>
>>I'm pretty new to AMQP and Rabbit. I'm trying to solve a problem where
>>I have a queue of incoming jobs and a pool of worker process. Some of
>>the jobs have to be processed syncrhonically.
>>
>>There is one producer process feeding jobs to a incoming queue (q1),
>>every job has a unique id encoded in the message. All the workers read
>>from q1, do the ?processing and put back the result in a outgoing
>>queue (q2) using the unique id as routing key.
>>
>>When a job is synchronous, the producer will subscribe to q2, waiting
>>for a result tagged with the unique id ?assigned when it was put in
>>q1.
>>
>>Now, in order to wait for a specific message the producer creates a
>>new exchange for every synchronous job ?with the unique id as key and
>>binds it to the queue before subscribing.
>>
>>Now the question/s:
>>
>>Is it OK to create a large number of exchanges? is it going to impact
>>performance?
>> or ?Am I doing something terribly wrong here? is there a best
>>practice I can refer to? if so any advice on the correct way to do
>>this would be appreciated.
>
> Have you looked at this?
> http://www.rabbitmq.com/api-guide.html#rpc
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Fri Jun  5 20:35:19 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 5 Jun 2009 20:35:19 +0100
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
	<20090605190309.GC11868@aa>
	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>
Message-ID: <167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>

Creating a lot of exchanges is fine, but many designs naturally fit
just a few.  There is no 'one' answer.



On Fri, Jun 5, 2009 at 8:30 PM, Camilo Lopez<camilol at gmail.com> wrote:
> Thanks for the link ,
>
> No I had not seen it , I'm not using Java (using ruby btw) so I did
> not really looked into the Java client specifics. ?I just checked and
> one of the ruby libraries does implement an RPC convenience.
>
> I guess this will be a better idea that what I'm doing now, but in
> genral is it a bad idea do create a bunch of Exchanges?
>
>
> On Fri, Jun 5, 2009 at 3:03 PM, Arvind Jayaprakash <work at anomalizer.net> wrote:
>> On Jun 05, Camilo Lopez wrote:
>>>Hello list,
>>>
>>>I'm pretty new to AMQP and Rabbit. I'm trying to solve a problem where
>>>I have a queue of incoming jobs and a pool of worker process. Some of
>>>the jobs have to be processed syncrhonically.
>>>
>>>There is one producer process feeding jobs to a incoming queue (q1),
>>>every job has a unique id encoded in the message. All the workers read
>>>from q1, do the ?processing and put back the result in a outgoing
>>>queue (q2) using the unique id as routing key.
>>>
>>>When a job is synchronous, the producer will subscribe to q2, waiting
>>>for a result tagged with the unique id ?assigned when it was put in
>>>q1.
>>>
>>>Now, in order to wait for a specific message the producer creates a
>>>new exchange for every synchronous job ?with the unique id as key and
>>>binds it to the queue before subscribing.
>>>
>>>Now the question/s:
>>>
>>>Is it OK to create a large number of exchanges? is it going to impact
>>>performance?
>>> or ?Am I doing something terribly wrong here? is there a best
>>>practice I can refer to? if so any advice on the correct way to do
>>>this would be appreciated.
>>
>> Have you looked at this?
>> http://www.rabbitmq.com/api-guide.html#rpc
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Fri Jun  5 20:36:21 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 5 Jun 2009 20:36:21 +0100
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <af1bce590906051038rb794a35ma08b2c6f6f07e533@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<167204d20906020830q6c9a5e9dk3d028ddd09a90cd3@mail.gmail.com>
	<4e3934860906051033q43a05a3ck3553a3619b899ad4@mail.gmail.com>
	<af1bce590906051038rb794a35ma08b2c6f6f07e533@mail.gmail.com>
Message-ID: <167204d20906051236x62d9b807l4938a8c5be217e6b@mail.gmail.com>

Keep up the good work guys.


On Fri, Jun 5, 2009 at 6:38 PM, Gavin M. Roy<gmr at myyearbook.com> wrote:
> Looks great :D
>
> On Fri, Jun 5, 2009 at 1:33 PM, Aaron Feng <aaron.feng at gmail.com> wrote:
>>
>> Trixx dashboard makeover.? We still have a lot of work left, but here's a
>> sneak peek.
>>
>> http://cloud.github.com/downloads/aaronfeng/trixx/trixx-dashboard1.png
>> http://cloud.github.com/downloads/aaronfeng/trixx/trixx-dashboard2.png
>
>



From camilol at gmail.com  Fri Jun  5 20:41:52 2009
From: camilol at gmail.com (Camilo Lopez)
Date: Fri, 5 Jun 2009 15:41:52 -0400
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
	<20090605190309.GC11868@aa>
	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>
	<167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>
Message-ID: <f5965c00906051241o6e595e0ev2792e8f7d10dc089@mail.gmail.com>

OK, I am mostly worried about the possible performance/memory hit, I
don't want to put some code in production and realize I just run out
of memory or becoming unresponsive. So I undestand that's not the
case.

On Fri, Jun 5, 2009 at 3:35 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> Creating a lot of exchanges is fine, but many designs naturally fit
> just a few. ?There is no 'one' answer.
>
>
>
> On Fri, Jun 5, 2009 at 8:30 PM, Camilo Lopez<camilol at gmail.com> wrote:
>> Thanks for the link ,
>>
>> No I had not seen it , I'm not using Java (using ruby btw) so I did
>> not really looked into the Java client specifics. ?I just checked and
>> one of the ruby libraries does implement an RPC convenience.
>>
>> I guess this will be a better idea that what I'm doing now, but in
>> genral is it a bad idea do create a bunch of Exchanges?
>>
>>
>> On Fri, Jun 5, 2009 at 3:03 PM, Arvind Jayaprakash <work at anomalizer.net> wrote:
>>> On Jun 05, Camilo Lopez wrote:
>>>>Hello list,
>>>>
>>>>I'm pretty new to AMQP and Rabbit. I'm trying to solve a problem where
>>>>I have a queue of incoming jobs and a pool of worker process. Some of
>>>>the jobs have to be processed syncrhonically.
>>>>
>>>>There is one producer process feeding jobs to a incoming queue (q1),
>>>>every job has a unique id encoded in the message. All the workers read
>>>>from q1, do the ?processing and put back the result in a outgoing
>>>>queue (q2) using the unique id as routing key.
>>>>
>>>>When a job is synchronous, the producer will subscribe to q2, waiting
>>>>for a result tagged with the unique id ?assigned when it was put in
>>>>q1.
>>>>
>>>>Now, in order to wait for a specific message the producer creates a
>>>>new exchange for every synchronous job ?with the unique id as key and
>>>>binds it to the queue before subscribing.
>>>>
>>>>Now the question/s:
>>>>
>>>>Is it OK to create a large number of exchanges? is it going to impact
>>>>performance?
>>>> or ?Am I doing something terribly wrong here? is there a best
>>>>practice I can refer to? if so any advice on the correct way to do
>>>>this would be appreciated.
>>>
>>> Have you looked at this?
>>> http://www.rabbitmq.com/api-guide.html#rpc
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From work at anomalizer.net  Fri Jun  5 20:45:52 2009
From: work at anomalizer.net (Arvind Jayaprakash)
Date: Sat, 6 Jun 2009 01:15:52 +0530
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
	<20090605190309.GC11868@aa>
	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>
Message-ID: <20090605194552.GB15127@aa>

On Jun 05, Camilo Lopez wrote:
>Thanks for the link ,
>
>No I had not seen it , I'm not using Java (using ruby btw) so I did
>not really looked into the Java client specifics.  I just checked and
>one of the ruby libraries does implement an RPC convenience.
>
>I guess this will be a better idea that what I'm doing now, but in
>genral is it a bad idea do create a bunch of Exchanges?

Though I don't have enough knowledge on the exact implementation
details, I'd think it is better to limit the number of exchanges but it
is better to have a large number of bindings instead



From matthias at lshift.net  Fri Jun  5 20:48:56 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 05 Jun 2009 20:48:56 +0100
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <f5965c00906051241o6e595e0ev2792e8f7d10dc089@mail.gmail.com>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>	<20090605190309.GC11868@aa>	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>	<167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>
	<f5965c00906051241o6e595e0ev2792e8f7d10dc089@mail.gmail.com>
Message-ID: <4A2976A8.5050105@lshift.net>

Camilo,

Camilo Lopez wrote:
> OK, I am mostly worried about the possible performance/memory hit, I
> don't want to put some code in production and realize I just run out
> of memory or becoming unresponsive. So I undestand that's not the
> case.

Creating a new exchange, or queue, or binding for every message would
definitely be a bad idea. As suggested already, check out the rpc
convenience wrappers in the various client libs.

Matthias.



From alexis.richardson at gmail.com  Fri Jun  5 20:53:46 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 5 Jun 2009 20:53:46 +0100
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <4A2976A8.5050105@lshift.net>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
	<20090605190309.GC11868@aa>
	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>
	<167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>
	<f5965c00906051241o6e595e0ev2792e8f7d10dc089@mail.gmail.com>
	<4A2976A8.5050105@lshift.net>
Message-ID: <167204d20906051253o33d6d685jdff8f1b537b12a6f@mail.gmail.com>

As Matthias implies, having as many exchanges or queues as you have
messages... is an ANTIPATTERN.  Avoid!


On Fri, Jun 5, 2009 at 8:48 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Camilo,
>
> Camilo Lopez wrote:
>> OK, I am mostly worried about the possible performance/memory hit, I
>> don't want to put some code in production and realize I just run out
>> of memory or becoming unresponsive. So I undestand that's not the
>> case.
>
> Creating a new exchange, or queue, or binding for every message would
> definitely be a bad idea. As suggested already, check out the rpc
> convenience wrappers in the various client libs.
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From camilol at gmail.com  Fri Jun  5 20:56:01 2009
From: camilol at gmail.com (Camilo Lopez)
Date: Fri, 5 Jun 2009 15:56:01 -0400
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <167204d20906051253o33d6d685jdff8f1b537b12a6f@mail.gmail.com>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
	<20090605190309.GC11868@aa>
	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>
	<167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>
	<f5965c00906051241o6e595e0ev2792e8f7d10dc089@mail.gmail.com>
	<4A2976A8.5050105@lshift.net>
	<167204d20906051253o33d6d685jdff8f1b537b12a6f@mail.gmail.com>
Message-ID: <f5965c00906051256m726376cbmd7df081d07ad0a94@mail.gmail.com>

Thanks for the advice,

I just changed my code to have many different bindings to a couple of
exchanges it works the same, and I think is a much  better way of
doing things.. right?.

On Fri, Jun 5, 2009 at 3:53 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
> As Matthias implies, having as many exchanges or queues as you have
> messages... is an ANTIPATTERN. ?Avoid!
>
>
> On Fri, Jun 5, 2009 at 8:48 PM, Matthias Radestock<matthias at lshift.net> wrote:
>> Camilo,
>>
>> Camilo Lopez wrote:
>>> OK, I am mostly worried about the possible performance/memory hit, I
>>> don't want to put some code in production and realize I just run out
>>> of memory or becoming unresponsive. So I undestand that's not the
>>> case.
>>
>> Creating a new exchange, or queue, or binding for every message would
>> definitely be a bad idea. As suggested already, check out the rpc
>> convenience wrappers in the various client libs.
>>
>> Matthias.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From alexis.richardson at gmail.com  Fri Jun  5 20:57:04 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 5 Jun 2009 20:57:04 +0100
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <f5965c00906051256m726376cbmd7df081d07ad0a94@mail.gmail.com>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
	<20090605190309.GC11868@aa>
	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>
	<167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>
	<f5965c00906051241o6e595e0ev2792e8f7d10dc089@mail.gmail.com>
	<4A2976A8.5050105@lshift.net>
	<167204d20906051253o33d6d685jdff8f1b537b12a6f@mail.gmail.com>
	<f5965c00906051256m726376cbmd7df081d07ad0a94@mail.gmail.com>
Message-ID: <167204d20906051257w54e2e212vca41d73ea6b8006a@mail.gmail.com>

Almost certainly.  Try to reuse the routing layer (exchanges) as much
as possible.

On Fri, Jun 5, 2009 at 8:56 PM, Camilo Lopez<camilol at gmail.com> wrote:
> Thanks for the advice,
>
> I just changed my code to have many different bindings to a couple of
> exchanges it works the same, and I think is a much ?better way of
> doing things.. right?.
>
> On Fri, Jun 5, 2009 at 3:53 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>> As Matthias implies, having as many exchanges or queues as you have
>> messages... is an ANTIPATTERN. ?Avoid!
>>
>>
>> On Fri, Jun 5, 2009 at 8:48 PM, Matthias Radestock<matthias at lshift.net> wrote:
>>> Camilo,
>>>
>>> Camilo Lopez wrote:
>>>> OK, I am mostly worried about the possible performance/memory hit, I
>>>> don't want to put some code in production and realize I just run out
>>>> of memory or becoming unresponsive. So I undestand that's not the
>>>> case.
>>>
>>> Creating a new exchange, or queue, or binding for every message would
>>> definitely be a bad idea. As suggested already, check out the rpc
>>> convenience wrappers in the various client libs.
>>>
>>> Matthias.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>



From matthias at lshift.net  Fri Jun  5 21:01:51 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 05 Jun 2009 21:01:51 +0100
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <f5965c00906051256m726376cbmd7df081d07ad0a94@mail.gmail.com>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>	<20090605190309.GC11868@aa>	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>	<167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>	<f5965c00906051241o6e595e0ev2792e8f7d10dc089@mail.gmail.com>	<4A2976A8.5050105@lshift.net>	<167204d20906051253o33d6d685jdff8f1b537b12a6f@mail.gmail.com>
	<f5965c00906051256m726376cbmd7df081d07ad0a94@mail.gmail.com>
Message-ID: <4A2979AF.3070109@lshift.net>

Camilo,

Camilo Lopez wrote:
> I just changed my code to have many different bindings to a couple of
> exchanges it works the same, and I think is a much  better way of
> doing things.. right?.

Yes, but one binding per message would still be bad.

Matthias.



From camilol at gmail.com  Fri Jun  5 21:04:06 2009
From: camilol at gmail.com (Camilo Lopez)
Date: Fri, 5 Jun 2009 16:04:06 -0400
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <4A2979AF.3070109@lshift.net>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
	<20090605190309.GC11868@aa>
	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>
	<167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>
	<f5965c00906051241o6e595e0ev2792e8f7d10dc089@mail.gmail.com>
	<4A2976A8.5050105@lshift.net>
	<167204d20906051253o33d6d685jdff8f1b537b12a6f@mail.gmail.com>
	<f5965c00906051256m726376cbmd7df081d07ad0a94@mail.gmail.com>
	<4A2979AF.3070109@lshift.net>
Message-ID: <f5965c00906051304y6ff36c67od27c978a81452621@mail.gmail.com>

Matthias,

Appart from the rpc facilities  in the clients is there a good pattern
to follow here?

On Fri, Jun 5, 2009 at 4:01 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Camilo,
>
> Camilo Lopez wrote:
>> I just changed my code to have many different bindings to a couple of
>> exchanges it works the same, and I think is a much ?better way of
>> doing things.. right?.
>
> Yes, but one binding per message would still be bad.
>
> Matthias.
>



From arun.suresh at gmail.com  Sun Jun  7 07:31:46 2009
From: arun.suresh at gmail.com (Arun Suresh)
Date: Sun, 7 Jun 2009 12:01:46 +0530
Subject: [rabbitmq-discuss] Workaround for basic reject...
Message-ID: <9f4a617f0906062331x73cb90a6qbdaf6b65e02e7b7b@mail.gmail.com>

Hello,

We are currently evaluating rabbitMQ for message passing between distributed
nodes. We have a scenario where we could like to restrict the number of
messages sent to a consume...
>From the documentation i understand that using 'basic.qos' is the way to go
(yes.. we are playing around with the snapshot 1.6 version).

Now assuming we set the prefetch size to lets say 5 for a channel,
everything works fine until the consumer encounters an error while
processing a message.. in which case i would ideally like to have the
consumer send a 'basic.reject', so that the same message may be sent to
another consumer... I then realized that rabbitMQ doesnt support
'basic.reject' and the prescribed way of handling this situation is to close
the channel, which will lead to all un-acked message being resent...

This unfortunately means that if consumer encouters an error on 1 message, I
would not be able to close the Channel immediately.. as there are still 4
messages outstanding... which means i would have to wait for all the other
messages to finish processing before i can send all the successfull acks and
then close th channel... during which time, i wont be able to accept anymore
messages...

I was wondering if anyone might be able to enlighten me with a better way of
doing things..

TIA
-Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090607/45124a94/attachment.htm 

From matthias at lshift.net  Sun Jun  7 12:03:28 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 07 Jun 2009 12:03:28 +0100
Subject: [rabbitmq-discuss] Workaround for basic reject...
In-Reply-To: <9f4a617f0906062331x73cb90a6qbdaf6b65e02e7b7b@mail.gmail.com>
References: <9f4a617f0906062331x73cb90a6qbdaf6b65e02e7b7b@mail.gmail.com>
Message-ID: <4A2B9E80.1050409@lshift.net>

Arun,

Arun Suresh wrote:
> This unfortunately means that if consumer encouters an error on 1 
> message, I would not be able to close the Channel immediately.. as there 
> are still 4 messages outstanding... which means i would have to wait for 
> all the other messages to finish processing before i can send all the 
> successfull acks and then close th channel... during which time, i wont 
> be able to accept anymore messages...

Why would closing the channel immediately not work? That will cause the 
<4 outstanding messages to get requeued (and, if possible, delivered to 
other consumers), just like the message on which you encountered an error.


Matthias.



From arun.suresh at gmail.com  Sun Jun  7 12:26:12 2009
From: arun.suresh at gmail.com (Arun Suresh)
Date: Sun, 7 Jun 2009 16:56:12 +0530
Subject: [rabbitmq-discuss] Workaround for basic reject...
In-Reply-To: <4A2B9E80.1050409@lshift.net>
References: <9f4a617f0906062331x73cb90a6qbdaf6b65e02e7b7b@mail.gmail.com>
	<4A2B9E80.1050409@lshift.net>
Message-ID: <9f4a617f0906070426v6f47c6abg21306b1c7c5e4ead@mail.gmail.com>

Matthias,

firstly, thanks for the quick response..

Why would closing the channel immediately not work? That will cause the <4
> outstanding messages to get requeued (and, if possible, delivered to other
> consumers), just like the message on which you encountered an error.
>

I was just trying to avoid exactly that situation.. basically i dont want
messages to be requeued untill I am sure the consumer has a problem while
processing them..

for the time being.. i have this workaround...
I have 5 Channels open on the consumer node (each with a prefetch of 1.. )..
so if the consumer has problem with any one message, I need to close just
that channel where the message came from... ofcourse, this would mean that
the message might get resent to another channel on the same consumer node...
but im still debating over whether thats a bad thing within the context of
our application...

do you think, generally speaking, this a good idea ?

-Arun

oh..  and by the way.. does setting prefetch to 1 just the same as not using
basic.qos ??
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090607/c4813770/attachment.htm 

From thomas.herve at canonical.com  Sun Jun  7 16:04:40 2009
From: thomas.herve at canonical.com (Thomas =?ISO-8859-1?Q?Herv=E9?=)
Date: Sun, 07 Jun 2009 17:04:40 +0200
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
Message-ID: <1244387080.4279.9.camel@brainwave>

Le mardi 02 juin 2009 ? 11:22 -0400, Gavin M. Roy a ?crit :
> I'm getting ready to do some production testing of rabbitmq as a
> replacement of ActiveMQ.  Beyond rabbitmqctl, I have not been able to
> find any real data stubs for monitoring beyond how to write my own
> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/).
>  Before I go down the road of writing something I wanted to make sure
> there was no pre-existing software since the rabbitmq homepage says
> "Extensive facilities for management, monitoring, control and
> debugging."  I'm not trying to create a flame war, it's just
> rabbitmqctl is not really an enterprise level monitoring tool.
> 
> I'm hoping I'm missing something, any suggestions?

Hi!

I'm writing a library called TwOTP (https://launchpad.net/twotp) which
allows to communicate with Erlang nodes using Python/Twisted (mentioned
in some posts). I've started using RabbitMQ, and I wrote some code to
show information you can easily extract.

Here you can see the summary page:

http://imagebin.org/51723

And here the virtual host page:

http://imagebin.org/51724

You can find the script in TwOTP source tree, and it will be in the next
release: http://bazaar.launchpad.net/~therve/twotp/trunk/annotate/head%
3A/examples/rabbitmq-webui.py

I've written that in an hour to show what's possible to do, but I'd be
happy to focus more on it if you have some ideas.

-- 
Thomas




From clemesha at gmail.com  Sun Jun  7 19:31:47 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Sun, 7 Jun 2009 11:31:47 -0700
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <1244387080.4279.9.camel@brainwave>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<1244387080.4279.9.camel@brainwave>
Message-ID: <d272f0690906071131n6f77e235r18090849d992daf1@mail.gmail.com>

>
> Hi!
>
> I'm writing a library called TwOTP (https://launchpad.net/twotp) which
> allows to communicate with Erlang nodes using Python/Twisted (mentioned
> in some posts). I've started using RabbitMQ, and I wrote some code to
> show information you can easily extract.
>
> Here you can see the summary page:
>
> http://imagebin.org/51723
>
> And here the virtual host page:
>
> http://imagebin.org/51724
>
> You can find the script in TwOTP source tree, and it will be in the next
> release: http://bazaar.launchpad.net/~therve/twotp/trunk/annotate/head%
> 3A/examples/rabbitmq-webui.py
Very nice!  This is approximately how far I got a couple weeks ago writing
very similar code using TwOTP (and then got bogged down by other work).
I have to say TwOTP is very nice to use, and it has a whole set of examples
to get started with.

I intend to come back to this and continue to improve on what I have, and your
example will help, so thanks very much for posting this!  If I get something
decent going, I'll post to the list.


thanks,
-Alex



>
> I've written that in an hour to show what's possible to do, but I'd be
> happy to focus more on it if you have some ideas.
>
> --
> Thomas
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alex Clemesha
clemesha.org



From matthias at lshift.net  Sun Jun  7 21:03:25 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 07 Jun 2009 21:03:25 +0100
Subject: [rabbitmq-discuss] Workaround for basic reject...
In-Reply-To: <9f4a617f0906070426v6f47c6abg21306b1c7c5e4ead@mail.gmail.com>
References: <9f4a617f0906062331x73cb90a6qbdaf6b65e02e7b7b@mail.gmail.com>	<4A2B9E80.1050409@lshift.net>
	<9f4a617f0906070426v6f47c6abg21306b1c7c5e4ead@mail.gmail.com>
Message-ID: <4A2C1D0D.8080205@lshift.net>

Arun,

Arun Suresh wrote:

> i dont want messages to be requeued until I am sure the consumer has
>  a problem while processing them..

If the consumer hasn't started processing the messages, why do you care 
if they get requeued and delivered to another consumer (or the same 
consumer when it reconnects)?

If, otoh, the consumer is processing up to n messages in parallel, then 
in the event of an error just wait for the processing of the remaining 
n-1 messages to finish before ack-ing the successfully processed 
messages and closing the channel.

> for the time being.. i have this workaround...
> I have 5 Channels open on the consumer node (each with a prefetch of 1.. 
> ).. so if the consumer has problem with any one message, I need to close 
> just that channel where the message came from... ofcourse, this would 
> mean that the message might get resent to another channel on the same 
> consumer node... but im still debating over whether thats a bad thing 
> within the context of our application...
> 
> do you think, generally speaking, this a good idea ?

I can't see anything wrong with that approach.

> oh..  and by the way.. does setting prefetch to 1 just the same as not 
> using basic.qos ??

Without basic.qos there is no prefetch limit, so the server will just 
keep sending messages down the channel whenever it can.


Regards,

Matthias.



From nico at rakar.com  Mon Jun  8 03:40:23 2009
From: nico at rakar.com (Nicolas Echaniz)
Date: Sun, 7 Jun 2009 23:40:23 -0300
Subject: [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
Message-ID: <200906072340.23972.nico@rakar.com>

Hello everyone,

There has recently been a discussion[1] in the Orbited[2] mailing list -to 
which I'm cc'ing this message-  about using RabbitMQ + stomp-adapter as STOMP 
Broker for a "comet" web-chat sample application.

The problems began when I replaced Orbited's own rather simple STOMP Broker 
(called morbid) with RabbitMQ + stomp-adapter. After configuration, the sample 
code worked fine, but the messages sent were not received by every client 
subscribed to the destination.

I found out that this was the RabbitMQ interpretation of how the broker should 
behave by reading some docs in your site[3] and a thread in your mailing 
list[4].

So I adapted my sample code to make it work with RabbitMQ in "broadcast 
behaviour".
As of his writing, you can find a running sample at:
http://www.proyectomutuo.org/live/public

Having solved this matter I started looking into the matter of subscribing my 
Django app to the STOMP broker. Before starting, I looked into the stomper 
Python module code to see if I'd be able to send the extra-headers that 
RabbitMQ needs to behave as I need it to, but it I found out that I wouldn't.

So a new thread[5] started in the Orbited list.

This lead me to re-read the STOMP Protocol spec[6] and judjing from the 
different clients code I've looked at it looks like everyone else's 
understanding of this paragraph:

"The SUBSCRIBE command is used to register to listen to a given destination. 
Like the SEND command, the SUBSCRIBE command requires a destination header 
indicating which destination to subscribe to. Any messages received on the 
subscription will henceforth be delivered as MESSAGE frames from the server to 
the client."

... is that if a client has subscribed to a destination, then it should 
receive every message that is sent to that destination - what you call 
"broadcast" behaviour in your docs.


So now I'm writing here because it seems to me rather odd that every STOMP 
client code should be modified to be able to send extra-headers to RabbitMQ  
when they seem to be correctly implementing their STOMP Clients according to 
the spec.
Although I must agree that the spec text is rather ambiguous on this matter, I 
believe that interoperability with existing clients is important here and it 
looks to me like non-STOMP extra-headers should not be required from the 
client in order to achieve what seems to be a rather common use case of a 
producer broadcasting to every subscribed consumer and not just to any of them 
(round-robinish behaviour).


I've been reading a lot these days and chose RabbitMQ over the other 
alternatives because it looks like the best alternative in terms of 
performance, reliability, and scallability but I'm not all too sure that 
"fixing" the client libraries myself is the way to go, considering that the 
stomp-adapter is still experimental code.


An Orbited user (who has come across the same issue) has offered to work on 
the erlang stomp-adapter code if needed.


I look forward to reading from you.

If I happen to sound rude or unpolite, please pardon my english... it's not my 
mother tongue.


Cheers,

NicoEch?niz

[1] http://groups.google.com/group/orbited-
users/browse_thread/thread/e6a2a4d1bf13eda1
[2] http://www.orbited.org
[3] http://dev.rabbitmq.com/wiki/StompGateway
[4] http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-
September/001784.html 

[5] http://groups.google.com/group/orbited-
users/browse_thread/thread/896d37d61dceb073

[6] http://stomp.codehaus.org/Protocol



From andrius.norkaitis at oryo.lt  Mon Jun  8 08:41:46 2009
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 8 Jun 2009 10:41:46 +0300
Subject: [rabbitmq-discuss] RabbitMQ .NET Client sometimes hangs up
In-Reply-To: <200906072340.23972.nico@rakar.com>
References: <200906072340.23972.nico@rakar.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAO6Z1r8kcDdMlN6RcNjwXgABAAAAAA==@oryo.lt>

Hello,

I can?t find the problem and how to fix it so your help would be very appreciated.

Our .net client starts new thread which loops calling ConnectAndListen method (loop is for automatic reconnect). In ConnectAndListen method we create new connection and model, bind to queries and listen for messages ("foreach (BasicDeliverEventArgs ee in subscription)").

Everything works like it has, but for sometimes unknown reason sometime client does not reconnect and hangs. It's not always and depends on network disturbances, so can?t easily debug. What I figured out, that thread halts after this statement is called: 

using (conn = cf.CreateConnection(serverAddress))


Any thoughts what can cause it and how to fix it?


Best regards
Andrius




From riteshrathi at gmail.com  Mon Jun  8 08:50:57 2009
From: riteshrathi at gmail.com (rathi)
Date: Mon, 8 Jun 2009 07:50:57 +0000
Subject: [rabbitmq-discuss] Running rabbit on a node which has its IPAddress
	as its hostname
Message-ID: <d31e757a0906080050haf10b0bwb4b115f14f9deac7@mail.gmail.com>

I am able to start rabbitmq server in the node which has its IPAddress as
its hostname but not able to query any further details about the queues and
exchanges using rabbitmqctl or using erlang commands via JInterface. If i
set the hostname to some short name it works.

Is it not possible to have IPAddress as the hostname or we need to do
something else.

thanks & regards
rathi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090608/1d0db067/attachment.htm 

From ryan at acceleration.net  Mon Jun  8 14:05:50 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Mon, 08 Jun 2009 09:05:50 -0400
Subject: [rabbitmq-discuss] [Spam] RabbitMQ .NET Client sometimes hangs
 up
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAO6Z1r8kcDdMlN6RcNjwXgABAAAAAA==@oryo.lt>
References: <200906072340.23972.nico@rakar.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAO6Z1r8kcDdMlN6RcNjwXgABAAAAAA==@oryo.lt>
Message-ID: <4A2D0CAE.10006@acceleration.net>

Is the thread throwing an exception before it halts?

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506



Andrius Norkaitis wrote:
> Hello,
>
> I can?t find the problem and how to fix it so your help would be very appreciated.
>
> Our .net client starts new thread which loops calling ConnectAndListen method (loop is for automatic reconnect). In ConnectAndListen method we create new connection and model, bind to queries and listen for messages ("foreach (BasicDeliverEventArgs ee in subscription)").
>
> Everything works like it has, but for sometimes unknown reason sometime client does not reconnect and hangs. It's not always and depends on network disturbances, so can?t easily debug. What I figured out, that thread halts after this statement is called: 
>
> using (conn = cf.CreateConnection(serverAddress))
>
>
> Any thoughts what can cause it and how to fix it?
>
>
> Best regards
> Andrius
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   



From andrius.norkaitis at oryo.lt  Mon Jun  8 15:05:21 2009
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 8 Jun 2009 17:05:21 +0300
Subject: [rabbitmq-discuss] [Spam] RabbitMQ .NET Client sometimes hangs
	up
In-Reply-To: <4A2D0CAE.10006@acceleration.net>
References: <200906072340.23972.nico@rakar.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAO6Z1r8kcDdMlN6RcNjwXgABAAAAAA==@oryo.lt>
	<4A2D0CAE.10006@acceleration.net>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAGE7rjDeHyJNsTbwcgu6/VMBAAAAAA==@oryo.lt>

I think no. All rabbit code is in try/catch and nothing is logged in catch statement. Otherwise, if .net rabbit client method CreateConnection does some asynchronous stuff (haven't watch at a source deeply), errors may not be caught and in this case thread may halt, I think.

-----Original Message-----
From: Ryan Davis [mailto:ryan at acceleration.net] 
Sent: Monday, June 08, 2009 4:06 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [Spam] [rabbitmq-discuss] RabbitMQ .NET Client sometimes hangs up

Is the thread throwing an exception before it halts?

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506



Andrius Norkaitis wrote:
> Hello,
>
> I can?t find the problem and how to fix it so your help would be very appreciated.
>
> Our .net client starts new thread which loops calling ConnectAndListen method (loop is for automatic reconnect). In ConnectAndListen method we create new connection and model, bind to queries and listen for messages ("foreach (BasicDeliverEventArgs ee in subscription)").
>
> Everything works like it has, but for sometimes unknown reason sometime client does not reconnect and hangs. It's not always and depends on network disturbances, so can?t easily debug. What I figured out, that thread halts after this statement is called: 
>
> using (conn = cf.CreateConnection(serverAddress))
>
>
> Any thoughts what can cause it and how to fix it?
>
>
> Best regards
> Andrius
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   




From ryan at acceleration.net  Mon Jun  8 15:20:35 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Mon, 08 Jun 2009 10:20:35 -0400
Subject: [rabbitmq-discuss] [Spam] RabbitMQ .NET Client sometimes hangs
 up
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAGE7rjDeHyJNsTbwcgu6/VMBAAAAAA==@oryo.lt>
References: <200906072340.23972.nico@rakar.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAO6Z1r8kcDdMlN6RcNjwXgABAAAAAA==@oryo.lt>
	<4A2D0CAE.10006@acceleration.net>
	<!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAGE7rjDeHyJNsTbwcgu6/VMBAAAAAA==@oryo.lt>
Message-ID: <4A2D1E33.7030803@acceleration.net>

Would it be possible to post your code?  I use the .NET client in a
similar way, spawning many threads each calling CreateConnection.  I've
simulated network problems by restarting my RabbitMQ server, and I see
the .NET client throwing exceptions when it fails.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506



Andrius Norkaitis wrote:
> I think no. All rabbit code is in try/catch and nothing is logged in catch statement. Otherwise, if .net rabbit client method CreateConnection does some asynchronous stuff (haven't watch at a source deeply), errors may not be caught and in this case thread may halt, I think.
>
> -----Original Message-----
> From: Ryan Davis [mailto:ryan at acceleration.net] 
> Sent: Monday, June 08, 2009 4:06 PM
> To: Andrius Norkaitis
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [Spam] [rabbitmq-discuss] RabbitMQ .NET Client sometimes hangs up
>
> Is the thread throwing an exception before it halts?
>
> Thanks,
>
> Ryan Davis
> Acceleration.net
> Director of Programming Services
> 2831 NW 41st street, suite B
> Gainesville, FL 32606
>
> Office: 352-335-6500 x 124
> Fax: 352-335-6506
>
>
>
> Andrius Norkaitis wrote:
>   
>> Hello,
>>
>> I can?t find the problem and how to fix it so your help would be very appreciated.
>>
>> Our .net client starts new thread which loops calling ConnectAndListen method (loop is for automatic reconnect). In ConnectAndListen method we create new connection and model, bind to queries and listen for messages ("foreach (BasicDeliverEventArgs ee in subscription)").
>>
>> Everything works like it has, but for sometimes unknown reason sometime client does not reconnect and hangs. It's not always and depends on network disturbances, so can?t easily debug. What I figured out, that thread halts after this statement is called: 
>>
>> using (conn = cf.CreateConnection(serverAddress))
>>
>>
>> Any thoughts what can cause it and how to fix it?
>>
>>
>> Best regards
>> Andrius
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>   
>>     



From matthias at lshift.net  Mon Jun  8 16:13:50 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Jun 2009 16:13:50 +0100
Subject: [rabbitmq-discuss] [PATCH] Licensing issue with AMQP spec files
	and generated code
Message-ID: <4A2D2AAE.1060308@lshift.net>

Michael,

> In the process of building the Mono/AMQP integration, we've run into a
> small problem with the licensing of the AMQP spec files and the
> generated code. [...]
> I have attached a small patch [...].
>  There is an additional command line option (/c) that can be used to
> re-enable the comments.  It would be useful if this patch could merged
> as it would save me from having to maintain this patch outside of the
> main rabbitmq source tree. 

Just to let you know that the next release of the .net client code will
introduce the /c flag for the code gen to enable generation of comments
from the spec. I have just qa'ed the changes we made for this (we didn't
use your patch in the end) and merged them into the 'default' branch in hg.

Thanks again for the suggestion.


Regards,

Matthias.



From matthias at lshift.net  Mon Jun  8 17:23:59 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Jun 2009 17:23:59 +0100
Subject: [rabbitmq-discuss] [rabbitmq-announce] RabbitMQ 1.5.4 release
In-Reply-To: <49D9F9E8.3020200@lshift.net>
References: <49D9EDF6.2050309@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891065C4CFDEE9A@SVR-2K3-BH-EMC.tradition.int>
	<49D9F9E8.3020200@lshift.net>
Message-ID: <4A2D3B1F.9020003@lshift.net>

Alister,

Matthias Radestock wrote:
> Alister Morton wrote:
>>> The RabbitMQ team is pleased to announce the release of RabbitMQ 1.5.4.
>>
>> Can I make a small request regarding the .net client?
>>
>> Could you give them a strong name, please?

Just to let you know that we will be giving the assembly a strong name
as of the next release.


Matthias.



From gmr at myyearbook.com  Mon Jun  8 17:51:40 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 8 Jun 2009 12:51:40 -0400
Subject: [rabbitmq-discuss] Different Stomp Issue: rabbitmq-stomp and
	Codehaus PHP Stomp class
In-Reply-To: <4A292EA7.5030103@lshift.net>
References: <af1bce590906031546l6a6a05beifa2ac0acd659569a@mail.gmail.com>
	<4A292EA7.5030103@lshift.net>
Message-ID: <af1bce590906080951u2b6dec29h63251f6011e81ba2@mail.gmail.com>

On Fri, Jun 5, 2009 at 10:41 AM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Hi Gavin,
>
> Yes, the ambiguity here is unfortunate.


I have opened a ticket in their Google Code repository, hopefully it will be
addressed.

The code currently (and at both the 1.5.3 and 1.5.5 tags) accepts any
> number of leading \r and \n characters before a command -- what exactly
> does the STOMP adapter do when it is sent a \0\n sequence as a frame
> terminator?


It does not respond to the frame.


> Yes. I agree. I think it should, however, stay strict in terms of what
> it emits (i.e. continue to use plain \0 for its frame terminator when
> it's speaking) -- do you think that makes sense?


Absolutely, and in this case, the only problem for them is the poor sending,
not receiving (even though the code is less than optimal, which is why I
rewrote that part of the code).

Thanks for the speedy updates.

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090608/ce63a6e0/attachment.htm 

From lynton.grice at logosworld.com  Mon Jun  8 18:37:41 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Mon, 8 Jun 2009 19:37:41 +0200
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client Error ({error, {aborted,
	{no_exists, [user, <<"guest">>]}}})
Message-ID: <000501c9e85f$d74f10b0$85ed3210$@grice@logosworld.com>

Hi there,

 

I am trying to get more into RabbitMQ and have downloaded and installed it
on my Windows box.....AWESOME product!

 

BTW: I am running Erlang R13B, RabbitMQ server
"rabbitmq-server-windows-1.5.5".....and also the latest client Erlang code
from the website. 

 

First off I can send and receive messages to the RabbitMQ server using a
PYTHON client....that is 100% fine...

 

But now I am trying to get a connection from an Erlang client and am coming
up with the following error...

 

   blog_example_2:test().

** exception error: no match of right hand side value

                    {error,{aborted,{no_exists,[user,<<"guest">>]}}}

     in function  amqp_connection:start/3

 



 

So this is the basic piece of code below (just a snippet for now)....all I
want to do is open up a connection to the RabbitMQ server...

 

test() ->

    User = Password = "guest",

    %% Start a connection to the server

    Connection = amqp_connection:start(User, Password).

   

I have been looking in the "amqp_connection.erl" code but cannot see exactly
where the error occurs.....I have an idea but nothing specific....

 

I presume this is a very basic error to solve? I have see some discussion on
this at
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-October/002110.htm
l but still see no concrete answer on how I can solve it....

 

Any help in this regard will be greatly appreciated ;-) 

 

Many thanks

 

Lynton 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090608/e7b662bb/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 3046 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090608/e7b662bb/attachment.png 

From lynton.grice at logosworld.com  Mon Jun  8 19:07:49 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Mon, 8 Jun 2009 20:07:49 +0200
Subject: [rabbitmq-discuss] Compile RabbitMQ Erlang Client on Windows
Message-ID: <000001c9e864$0dd3ae80$297b0b80$@grice@logosworld.com>

Hi there,

 

I have compiled the "RabbitMQ Erlang AMQP client" *manually* on my Windows
box.....

 

Just a question to make it easier for other Windows users wanting to use the
RabbitMQ client, has anyone been able to create a BAT file that is similar
to the MAKE file provided in the RabbitMQ AMQP client download?

 

I think this would be GREAT to have in the download as well.....;-)

 

Thanks for the help ;-)

 

Lynton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090608/1150031f/attachment.htm 

From matthias at lshift.net  Mon Jun  8 19:56:34 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Jun 2009 19:56:34 +0100
Subject: [rabbitmq-discuss] Measuring Broker Behavior
In-Reply-To: <ac25b30c0906031001w3a4d22c2tdfc2030976878ca8@mail.gmail.com>
References: <ac25b30c0906031001w3a4d22c2tdfc2030976878ca8@mail.gmail.com>
Message-ID: <4A2D5EE2.6020105@lshift.net>

Kyle,

Kyle R. Burton wrote:
> I'm evaluating AMQP at work and wrote a post about the initial testing
> approach.  Monadic (via twitter) asked me to share on the list, the
> post I wrote up is here:
> 
>   http://asymmetrical-view.com/2009/06/02/incanter-amqp-benchmark.html
> [...]
> At this point I don't know much about tuning Erlang or Rabbit, if
> anyone has any advice about where to look for information on tuning,
> about our methodology, or questions please let me know.

I have two recommendations on the methodology:

- Use basic.consume, ideally with noAck=true, instead of basic.get. The 
former is much more efficient.

- Throttle the producer. Measuring receiving rates and latencies when 
you are bombarding the broker with messages as fast as the client can 
send them is not going to give very good or reproducible results since 
the broker will try to keep up with the producers and queue messages.


Matthias.



From matthias at lshift.net  Mon Jun  8 20:11:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Jun 2009 20:11:00 +0100
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>	<3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>
	<05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>
Message-ID: <4A2D6244.1070201@lshift.net>

Keith, Jason,

Keith Irwin wrote:
> On Jun 5, 2009, at 9:11 AM, Jason J. W. Williams wrote:
>> when you restart the node the queue data won't auto replay into the 
>> cluster.  You'll have to do that manually.
> 
> Are you saying that if an instance of RabbitMQ does down and is brought 
> back up, its persistent messages won't be delivered when a consumer 
> re-attaches?  (I'm not sure what you mean by "manually".)
> 
> If that's the case, that seems quite broken and not fault-tolerant at all.
> 
> Surely, I'm misunderstanding.....

Persisted messages *do* get re-queued automatically on the appropriate 
durable queues when a node restarts.

Jason, did that not work for you? If so, a test case would be appreciated.


Regards,

Matthias.



From 0x6e6562 at gmail.com  Mon Jun  8 20:24:13 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 8 Jun 2009 20:24:13 +0100
Subject: [rabbitmq-discuss] Compile RabbitMQ Erlang Client on Windows
In-Reply-To: <000001c9e864$0dd3ae80$297b0b80$@grice@logosworld.com>
References: <000001c9e864$0dd3ae80$297b0b80$@grice@logosworld.com>
Message-ID: <4124E587-F11B-47C1-90B9-7B47C185D5AE@gmail.com>

Lynton,


On 8 Jun 2009, at 19:07, "Lynton Grice" <lynton.grice at logosworld.com>  
wrote:

> Hi there,
>
>
>
> I have compiled the ?RabbitMQ Erlang AMQP client? *manually* on  
> my Windows box.....
>
>
>
> Just a question to make it easier for other Windows users wanting to  
> use the RabbitMQ client, has anyone been able to create a BAT file  
> that is similar to the MAKE file provided in the RabbitMQ AMQP  
> client download?
>
I haven't done this myself, but have you considered a Windows port of  
make?

(I think it was Larry Wall who said that  it is easier to port a shell  
than a script)

HTH,

Ben

>
>
> I think this would be GREAT to have in the download as well.....;-)
>
>
>
> Thanks for the help ;-)
>
>
>
> Lynton
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090608/7fab616f/attachment.htm 

From keith.irwin at gmail.com  Mon Jun  8 20:31:25 2009
From: keith.irwin at gmail.com (Keith Irwin)
Date: Mon, 8 Jun 2009 12:31:25 -0700
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <4A2D6244.1070201@lshift.net>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
	<3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>
	<05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>
	<4A2D6244.1070201@lshift.net>
Message-ID: <8aff81590906081231w565c7079p14e6b834b5693c3a@mail.gmail.com>

On Mon, Jun 8, 2009 at 12:11 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Keith, Jason,
>
> Keith Irwin wrote:
>
>> On Jun 5, 2009, at 9:11 AM, Jason J. W. Williams wrote:
>>
>>> when you restart the node the queue data won't auto replay into the
>>> cluster.  You'll have to do that manually.
>>>
>>
>> Are you saying that if an instance of RabbitMQ does down and is brought
>> back up, its persistent messages won't be delivered when a consumer
>> re-attaches?  (I'm not sure what you mean by "manually".)
>>
>> If that's the case, that seems quite broken and not fault-tolerant at all.
>>
>> Surely, I'm misunderstanding.....
>>
>
> Persisted messages *do* get re-queued automatically on the appropriate
> durable queues when a node restarts.


That's good to know! In my research (thus far), about the only AMQP
implementation I know of that does full replication across a cluster (or
claims to), is Apache QPID. I'm trying to convince myself that trusting
anyone's guaranteed messaging strategy is probably not that wise.

Keith


>
>
> Jason, did that not work for you? If so, a test case would be appreciated.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090608/e22f7950/attachment.htm 

From alexis.richardson at gmail.com  Mon Jun  8 20:41:01 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 8 Jun 2009 20:41:01 +0100
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <8aff81590906081231w565c7079p14e6b834b5693c3a@mail.gmail.com>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
	<3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>
	<05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>
	<4A2D6244.1070201@lshift.net>
	<8aff81590906081231w565c7079p14e6b834b5693c3a@mail.gmail.com>
Message-ID: <167204d20906081241rbece4fdi180ff61ceb6fcb6a@mail.gmail.com>

Keith

As a matter of practicality we have found that 'eventual delivery'
(ie. what RabbitMQ currently does) combined with various 'lightweight'
forms of replicated flows, makes sense for many HA cases.  If you want
a combination of HA, reliability *and* timely delivery *and*
idempotency, then things get a little more 'fun'.

alexis


On Mon, Jun 8, 2009 at 8:31 PM, Keith Irwin<keith.irwin at gmail.com> wrote:
>
>
> On Mon, Jun 8, 2009 at 12:11 PM, Matthias Radestock <matthias at lshift.net>
> wrote:
>>
>> Keith, Jason,
>>
>> Keith Irwin wrote:
>>>
>>> On Jun 5, 2009, at 9:11 AM, Jason J. W. Williams wrote:
>>>>
>>>> when you restart the node the queue data won't auto replay into the
>>>> cluster. ?You'll have to do that manually.
>>>
>>> Are you saying that if an instance of RabbitMQ does down and is brought
>>> back up, its persistent messages won't be delivered when a consumer
>>> re-attaches? ?(I'm not sure what you mean by "manually".)
>>>
>>> If that's the case, that seems quite broken and not fault-tolerant at
>>> all.
>>>
>>> Surely, I'm misunderstanding.....
>>
>> Persisted messages *do* get re-queued automatically on the appropriate
>> durable queues when a node restarts.
>
> That's good to know! In my research (thus far), about the only AMQP
> implementation I know of that does full replication across a cluster (or
> claims to), is Apache QPID. I'm trying to convince myself that trusting
> anyone's guaranteed messaging strategy is probably not that wise.
> Keith
>
>>
>> Jason, did that not work for you? If so, a test case would be appreciated.
>>
>>
>> Regards,
>>
>> Matthias.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Mon Jun  8 20:44:44 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Jun 2009 20:44:44 +0100
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <f5965c00906051304y6ff36c67od27c978a81452621@mail.gmail.com>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>	<20090605190309.GC11868@aa>	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>	<167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>	<f5965c00906051241o6e595e0ev2792e8f7d10dc089@mail.gmail.com>	<4A2976A8.5050105@lshift.net>	<167204d20906051253o33d6d685jdff8f1b537b12a6f@mail.gmail.com>	<f5965c00906051256m726376cbmd7df081d07ad0a94@mail.gmail.com>	<4A2979AF.3070109@lshift.net>
	<f5965c00906051304y6ff36c67od27c978a81452621@mail.gmail.com>
Message-ID: <4A2D6A2C.1020409@lshift.net>

Camilo,

Camilo Lopez wrote:
> Appart from the rpc facilities  in the clients is there a good pattern
> to follow here?

The rpc wrappers actually implement a very straightforward pattern. Take 
a look at the code for Rpc{Client,Server}.java.

The pattern is this:

The server creates a queue for requests and binds that queue to an 
exchange. In the simplest case, the queue is named after the rpc service 
and the standard binding to AMQP's default exchange suffices - that's 
what I am assuming below. The server subscribes a consumer to that queue.

Each client creates a (usually anonymous and exclusive) queue for 
replies and subscribes a consumer (usually with noAck=true) to that queue.

RPCs then happen as follows:

1. The client publishes the request as a message to the default exchange 
with a routing key identifying the rpc service, the request as the 
payload, and two message properties (see 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.5.5/rabbitmq-java-client-javadoc-1.5.5/com/rabbitmq/client/AMQP.BasicProperties.html) 
a correlationId that identifies the requests (this is only necessary if 
the client wants to pipeline requests), and a replyTo property set to 
its reply queue name.

2. The server's consumer receives the request, performs the necessary 
invocations, and then publishes the reply to the default exchange with 
the routing key set to the value of the replyTo property of the request, 
and the correlationId message property set to the correlationId property 
of the request. The client then basic.ack's the request.

3. The client's consumer receives the reply, and correlates it with the 
request using the correlationId.


Regards,

Matthias.



From camilol at gmail.com  Mon Jun  8 21:07:04 2009
From: camilol at gmail.com (Camilo Lopez)
Date: Mon, 8 Jun 2009 16:07:04 -0400
Subject: [rabbitmq-discuss] Creating exchanges on demand.
In-Reply-To: <4A2D6A2C.1020409@lshift.net>
References: <f5965c00906050732u8bd2689k8b4c1c2920029ef4@mail.gmail.com>
	<f5965c00906051230r24479834m6e1a7365968c5585@mail.gmail.com>
	<167204d20906051235p52204e24ub2e0ffe107178f91@mail.gmail.com>
	<f5965c00906051241o6e595e0ev2792e8f7d10dc089@mail.gmail.com>
	<4A2976A8.5050105@lshift.net>
	<167204d20906051253o33d6d685jdff8f1b537b12a6f@mail.gmail.com>
	<f5965c00906051256m726376cbmd7df081d07ad0a94@mail.gmail.com>
	<4A2979AF.3070109@lshift.net>
	<f5965c00906051304y6ff36c67od27c978a81452621@mail.gmail.com>
	<4A2D6A2C.1020409@lshift.net>
Message-ID: <f5965c00906081307n52746172w6c1779152b07afa9@mail.gmail.com>

Thanks a lot Matthias,

I was trying to make sense of the Java code, I very rarely (if ever) use Java.

On Mon, Jun 8, 2009 at 3:44 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Camilo,
>
> Camilo Lopez wrote:
>>
>> Appart from the rpc facilities ?in the clients is there a good pattern
>> to follow here?
>
> The rpc wrappers actually implement a very straightforward pattern. Take a
> look at the code for Rpc{Client,Server}.java.
>
> The pattern is this:
>
> The server creates a queue for requests and binds that queue to an exchange.
> In the simplest case, the queue is named after the rpc service and the
> standard binding to AMQP's default exchange suffices - that's what I am
> assuming below. The server subscribes a consumer to that queue.
>
> Each client creates a (usually anonymous and exclusive) queue for replies
> and subscribes a consumer (usually with noAck=true) to that queue.
>
> RPCs then happen as follows:
>
> 1. The client publishes the request as a message to the default exchange
> with a routing key identifying the rpc service, the request as the payload,
> and two message properties (see
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.5.5/rabbitmq-java-client-javadoc-1.5.5/com/rabbitmq/client/AMQP.BasicProperties.html)
> a correlationId that identifies the requests (this is only necessary if the
> client wants to pipeline requests), and a replyTo property set to its reply
> queue name.
>
> 2. The server's consumer receives the request, performs the necessary
> invocations, and then publishes the reply to the default exchange with the
> routing key set to the value of the replyTo property of the request, and the
> correlationId message property set to the correlationId property of the
> request. The client then basic.ack's the request.
>
> 3. The client's consumer receives the reply, and correlates it with the
> request using the correlationId.
>
>
> Regards,
>
> Matthias.
>



From matthias at lshift.net  Mon Jun  8 21:12:21 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Jun 2009 21:12:21 +0100
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A292998.3090407@acceleration.net>
References: <4A292998.3090407@acceleration.net>
Message-ID: <4A2D70A5.6040907@lshift.net>

Ryan,

Ryan Davis wrote:
> I have some C# code extending SimpleRpcServer and am getting an
> exception when trying to shut down.  In the documentation PDF, it said
> to call the Close() function on your RpcServer when you are ready to
> shutdown.  Since the MainLoop() function blocks, the Close() has to be
> called from another thread, right?

Looking at the code, I am pretty sure that Close() is meant to be called 
from inside the HandleCall/Cast functions. Calling it from anywhere else 
is probably unsafe, and the error you are getting looks 
threading-related. It would be useful to get a stack trace with line 
numbers to work out exactly where the NPE occurs.


Regards,

Matthias.



From 0x6e6562 at gmail.com  Mon Jun  8 21:19:18 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 8 Jun 2009 21:19:18 +0100
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client Error ({error,
	{aborted, {no_exists, [user, <<"guest">>]}}})
In-Reply-To: <-8987642384993002738@unknownmsgid>
References: <-8987642384993002738@unknownmsgid>
Message-ID: <269388e30906081319n2b68bddao522201f3ef593353@mail.gmail.com>

Lynton,

On Mon, Jun 8, 2009 at 6:37 PM, Lynton Grice
<lynton.grice at logosworld.com> wrote:
> But now I am trying to get a connection from an Erlang client and am coming
> up with the following error...
...
> ?? blog_example_2:test().
>
> ** exception error: no match of right hand side value
>
> ??????????????????? {error,{aborted,{no_exists,[user,<<"guest">>]}}}
>
> ???? in function? amqp_connection:start/3
....
> So this is the basic piece of code below (just a snippet for now)....all I
> want to do is open up a connection to the RabbitMQ server...
>
>
>
> test() ->
>
> ??? User = Password = "guest",
>
> ??? %% Start a connection to the server
>
> ??? Connection = amqp_connection:start(User, Password).

This error is misleading because it doesn't tell you what you have
actually done wrong, so there is a bug in the way that errors are
handled which I'll take down and address at some stage.

Your issue is that you are using the start/2 call which is intended to
be used by the direct driver, not the network driver.

If you want to use plain jane networked AMQP, you need to supply the
hostname as a third argument, i.e.

Connection = amqp_connection:start(User, Password, "hostname").

HTH,

Ben



From jasonjwwilliams at gmail.com  Mon Jun  8 21:36:00 2009
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 8 Jun 2009 14:36:00 -0600
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <4A2D6244.1070201@lshift.net>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
	<3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>
	<05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>
	<4A2D6244.1070201@lshift.net>
Message-ID: <3b949f090906081336w177dcb63oad1f79e1162647ed@mail.gmail.com>

Hey Matthias,

In a clustered scenario no that did not work. But I haven't tried it
since 1.5.1.

-J

On Mon, Jun 8, 2009 at 1:11 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Keith, Jason,
>
> Keith Irwin wrote:
>>
>> On Jun 5, 2009, at 9:11 AM, Jason J. W. Williams wrote:
>>>
>>> when you restart the node the queue data won't auto replay into the
>>> cluster. ?You'll have to do that manually.
>>
>> Are you saying that if an instance of RabbitMQ does down and is brought
>> back up, its persistent messages won't be delivered when a consumer
>> re-attaches? ?(I'm not sure what you mean by "manually".)
>>
>> If that's the case, that seems quite broken and not fault-tolerant at all.
>>
>> Surely, I'm misunderstanding.....
>
> Persisted messages *do* get re-queued automatically on the appropriate
> durable queues when a node restarts.
>
> Jason, did that not work for you? If so, a test case would be appreciated.
>
>
> Regards,
>
> Matthias.
>



From 0x6e6562 at gmail.com  Mon Jun  8 21:41:09 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 08 Jun 2009 21:41:09 +0100
Subject: [rabbitmq-discuss] Erlang cllient libs / new_connection()
 results in "error on TCP connection <...> from 127.0.0.1
In-Reply-To: <4A2D69D0.50708@gmx.de>
References: <4A2D69D0.50708@gmx.de>
Message-ID: <4A2D7765.70008@gmail.com>

Ingo,

Ingo Kroger wrote:
> I get this error when trying to establish connection to Rabbitmq-Server
> on Ubuntu 9.04 server : {handshake_timeout,frame_header}
Because the Erlang client shares some common libraries with the server, 
you need to run compatible versions of both. Updating to the latest 
version on the default branch of both the server and client will do the 
trick, as will updating to the v1_5 branch of the client if you want to 
use a 1.5 series broker.

HTH,

Ben



From matthias at lshift.net  Mon Jun  8 21:48:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Jun 2009 21:48:00 +0100
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <3b949f090906081336w177dcb63oad1f79e1162647ed@mail.gmail.com>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>	<3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>	<05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>	<4A2D6244.1070201@lshift.net>
	<3b949f090906081336w177dcb63oad1f79e1162647ed@mail.gmail.com>
Message-ID: <4A2D7900.7040908@lshift.net>

Jason,

Jason J. W. Williams wrote:
> In a clustered scenario no that did not work. But I haven't tried it
> since 1.5.1.

There was a problem with the recovery of *bindings* in a clustered setup 
that we fixed in 1.5.5. But I have not seen any reports of problems with 
the recovery of *messages* in the 1.5.x releases. So please re-run your 
tests and let us know the results. If there is a bug in the message 
recovery we'll look into it straight away.


Regards,

Matthias.



From jasonjwwilliams at gmail.com  Mon Jun  8 21:50:35 2009
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 8 Jun 2009 14:50:35 -0600
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <4A2D7900.7040908@lshift.net>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
	<3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>
	<05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>
	<4A2D6244.1070201@lshift.net>
	<3b949f090906081336w177dcb63oad1f79e1162647ed@mail.gmail.com>
	<4A2D7900.7040908@lshift.net>
Message-ID: <3b949f090906081350s74a84362q2b4f9d6292eb93c3@mail.gmail.com>

Hi Matthias,

I'll recheck. The issue we ran into was:

Node A & Node B

Node A contains queue 1.
Node A dies. Persistent unserviced messages remain in queue 1.
Queue 1 moves to Node B.
Node A restarts and rejoins cluster.
Unserviced messages from before failure, do not replay into queue 1 as
located now on Node B.

-J


On Mon, Jun 8, 2009 at 2:48 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Jason,
>
> Jason J. W. Williams wrote:
>>
>> In a clustered scenario no that did not work. But I haven't tried it
>> since 1.5.1.
>
> There was a problem with the recovery of *bindings* in a clustered setup
> that we fixed in 1.5.5. But I have not seen any reports of problems with the
> recovery of *messages* in the 1.5.x releases. So please re-run your tests
> and let us know the results. If there is a bug in the message recovery we'll
> look into it straight away.
>
>
> Regards,
>
> Matthias.
>



From matthias at lshift.net  Mon Jun  8 22:19:24 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Jun 2009 22:19:24 +0100
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <3b949f090906081350s74a84362q2b4f9d6292eb93c3@mail.gmail.com>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>	<3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>	<05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>	<4A2D6244.1070201@lshift.net>	<3b949f090906081336w177dcb63oad1f79e1162647ed@mail.gmail.com>	<4A2D7900.7040908@lshift.net>
	<3b949f090906081350s74a84362q2b4f9d6292eb93c3@mail.gmail.com>
Message-ID: <4A2D805C.4070104@lshift.net>

Jason,

Jason J. W. Williams wrote:
> I'll recheck. The issue we ran into was:
> 
> Node A & Node B
> 
> Node A contains queue 1.
> Node A dies. Persistent unserviced messages remain in queue 1.
> Queue 1 moves to Node B.
> Node A restarts and rejoins cluster.
> Unserviced messages from before failure, do not replay into queue 1 as
> located now on Node B.

Interesting!

How did you "move" the queue between nodes? That is not a feature that 
is supported in RabbitMQ (yet).

I suppose that while node A is down a client may connect to node B and 
declare a queue with the same name. I am actually not sure what happens 
in that case, and how it affects re-queueing of persisted messages when 
node A subsequently recovers. So some test scenarios along these lines 
and observations of current behaviour would be very much appreciated.


Regards,

Matthias.



From jasonjwwilliams at gmail.com  Mon Jun  8 22:30:36 2009
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 8 Jun 2009 15:30:36 -0600
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <4A2D805C.4070104@lshift.net>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>
	<3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>
	<05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>
	<4A2D6244.1070201@lshift.net>
	<3b949f090906081336w177dcb63oad1f79e1162647ed@mail.gmail.com>
	<4A2D7900.7040908@lshift.net>
	<3b949f090906081350s74a84362q2b4f9d6292eb93c3@mail.gmail.com>
	<4A2D805C.4070104@lshift.net>
Message-ID: <3b949f090906081430w2d099b8axfffa13573628817c@mail.gmail.com>

Hey Matthias,

My wording is a bit sloppy. :-) My consumer recreated the queue on
reconnect. Then when Node A came up, it saw the queue already existed
and didn't replay into it.

-J

On Mon, Jun 8, 2009 at 3:19 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Jason,
>
> Jason J. W. Williams wrote:
>>
>> I'll recheck. The issue we ran into was:
>>
>> Node A & Node B
>>
>> Node A contains queue 1.
>> Node A dies. Persistent unserviced messages remain in queue 1.
>> Queue 1 moves to Node B.
>> Node A restarts and rejoins cluster.
>> Unserviced messages from before failure, do not replay into queue 1 as
>> located now on Node B.
>
> Interesting!
>
> How did you "move" the queue between nodes? That is not a feature that is
> supported in RabbitMQ (yet).
>
> I suppose that while node A is down a client may connect to node B and
> declare a queue with the same name. I am actually not sure what happens in
> that case, and how it affects re-queueing of persisted messages when node A
> subsequently recovers. So some test scenarios along these lines and
> observations of current behaviour would be very much appreciated.
>
>
> Regards,
>
> Matthias.
>



From jack at collecta.com  Mon Jun  8 22:41:17 2009
From: jack at collecta.com (Jack Moffitt)
Date: Mon, 8 Jun 2009 15:41:17 -0600
Subject: [rabbitmq-discuss] erlang client and server disconnection
Message-ID: <9b58f4550906081441t1dcba66al2cfffbd22641aad9@mail.gmail.com>

The Erlang client doesn't seem to detect that its socket is dead.  If
I start publishing to an exchange, then kill the server, future
publishes continue without error.  I would think that barring normal
TCP issues, destroying the server would cause amqp_channel:cast/3 to
error on the next call as the channel should no longer be valid.

Is this a bug, or is my code supposed to be getting connection error
notifications via some other mechanism?

jack.



From aconbere at gmail.com  Mon Jun  8 23:01:06 2009
From: aconbere at gmail.com (anders conbere)
Date: Mon, 8 Jun 2009 12:01:06 -1000
Subject: [rabbitmq-discuss] Catching messages sent to the stomp broker from
	other queues
Message-ID: <8ca3fbe80906081501q53370bdj4130c9a25356afff@mail.gmail.com>

Basically I have some clients connecting to rabbitmq via the stomp
broker, and some from the AMQP interface. The problem I'm having is
creating a queue that is capable of receiving messages sent by the
stomp client. I suspect that this is just a problem of defining my
routing key correctly (but my initial guess of making the key the
exchange name failed).

So this is what I've got.

via AMQP

1) a durable exchange named "a"
2) a queue named "b" bound to "a"

via STOMP

2) a message sent to "a"

if I then create a subscription in stomp to "a" I get the messages,
however I never receive a message at "b".

like I said I tried binding "b" to "a" with the routing key "a", but
that didn't work... any help?

~ Anders



From matthias at lshift.net  Mon Jun  8 23:13:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 08 Jun 2009 23:13:00 +0100
Subject: [rabbitmq-discuss] erlang client and server disconnection
In-Reply-To: <9b58f4550906081441t1dcba66al2cfffbd22641aad9@mail.gmail.com>
References: <9b58f4550906081441t1dcba66al2cfffbd22641aad9@mail.gmail.com>
Message-ID: <4A2D8CEC.2070401@lshift.net>

Jack,

Jack Moffitt wrote:
> The Erlang client doesn't seem to detect that its socket is dead.  If
> I start publishing to an exchange, then kill the server, future
> publishes continue without error.  I would think that barring normal
> TCP issues, destroying the server would cause amqp_channel:cast/3 to
> error on the next call as the channel should no longer be valid.
> 
> Is this a bug, or is my code supposed to be getting connection error
> notifications via some other mechanism?

amqp_channel:cast/3 does, as the name suggests, a gen_server:cast, which 
is totally asynchronous. The channel process should die when the 
connection dies, and the 'Erlang way' to get a notification of that 
event is to link to or monitor the channel process.


Regards,

Matthias.



From matthias at lshift.net  Tue Jun  9 06:09:17 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 06:09:17 +0100
Subject: [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
In-Reply-To: <200906072340.23972.nico@rakar.com>
References: <200906072340.23972.nico@rakar.com>
Message-ID: <4A2DEE7D.3030409@lshift.net>

Nicolas, Anders, and everybody else using the STOMP adapter,

Nicolas Echaniz wrote:

> it looks to me like non-STOMP extra-headers should not be required
> from the client in order to achieve what seems to be a rather common
> use case of a producer broadcasting to every subscribed consumer and
> not just to any  of them (round-robinish behaviour).

Choosing the right default behaviour - i.e. what happens when SEND and 
SUBSCRIBE specify nothing but the 'destination' header - is tricky.

Here are some key questions that we need to answer:

1) Should messages be routed to all subscribers or just one (round-robin)?

2) Should messages be queued when there are no subscribers?

3) When a client has multiple subscriptions to the same destination,
    should they receive one copy of a message or several?

Pretty much any combination of answers is plausible here and the STOMP 
spec does not prescribe any particular one.

So, recognising that with extra headers we can, in principle, get any 
behaviour we want, what should the *default* behaviour be?


The default behaviour of the current implementation of the RabbitMQ 
STOMP adapter

1) routes messages to one consumer (round-robin) - this can be changed 
to 'all' by specifying appropriate 'exchange' and 'routing_key' headers

2) does not queue messages when there are no subscribers - this can be 
changed by specifying an 'auto-delete = false' header (though that does 
require at least one SUBSCRIBE to start with)

3) sends only one copy of a message to a client in the event the client 
has more than one subscription for the same destination - this can be 
changed by specifying  appropriate 'exchange' and 'routing_key' headers


Should the default behaviour be different? And why?


Regards,

Matthias.



From mtodd at highgroove.com  Tue Jun  9 06:19:09 2009
From: mtodd at highgroove.com (Matt Todd)
Date: Tue, 9 Jun 2009 01:19:09 -0400
Subject: [rabbitmq-discuss] Objective-C AMQP Library
Message-ID: <2a8d4a710906082219ta499fcfx8a10f01f8f580ba8@mail.gmail.com>

As a new Objective-C developer (just fiddling around with it), I've been
thinking of a project to get my hands dirty with. I've been using RabbitMQ
for some time in my Ruby projects and really enjoy using it, and the AMQP
protocol should be fairly simple to grok and work with.
Because of this, I'm currently looking to start building an Objective-C
based client library as a pet project to get me actually working in the
language.

I'm thinking of using the experimental C language client code to power the
functionality and giving it a nice Obj-C DSL and handling everything through
a NSNotificationCenter to create an evented interface (similar to the
EventMachine Ruby AMQP library I'm used to working with). This is the goal
for now, anyhow.

Being still very new to the language, and certainly being unfamiliar with
the idiosyncrasies of developing libraries for Obj-C, I'm looking for input,
support, and contributions for this endeavor from experts and enthusiasts
with strong opinions and/or time.

Let me stress my lack of exposure to Obj-C (nor have I done anything
significant in C/C++ or any strongly typed, compiled language in quite some
time). This means I'm currently asking the following questions (as noob as
they may be):

1. How do I integrate the C library into this Obj-C library?
2. How do I write a distributable, clean Obj-C library?
3. Is an NSNotificationCenter-based implementation a good approach for an
evented AMQP library?
4. How do I mock objects in Obj-C (to not require an instance of RabbitMQ to
be running for tests)?
5. Should I just write this from scratch, including XML parsing et al?
6. What does a good Obj-C DSL look like?
7. Why would I start with a significant library to get familiar with the
language?

Fair warning, I'm a Ruby developer, mainly building web applications in
Rails.

Looking forward to hearing from you, and hope to get something worthwhile
out of this.

Matt



-- 
Matt Todd
Highgroove Studios
www.highgroove.com
cell: 404-314-2612
blog: maraby.org

Scout - Web Monitoring and Reporting Software
www.scoutapp.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/8256c3b3/attachment.htm 

From matthias at lshift.net  Tue Jun  9 06:25:34 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 06:25:34 +0100
Subject: [rabbitmq-discuss] Running rabbit on a node which has its
 IPAddress as its hostname
In-Reply-To: <d31e757a0906080050haf10b0bwb4b115f14f9deac7@mail.gmail.com>
References: <d31e757a0906080050haf10b0bwb4b115f14f9deac7@mail.gmail.com>
Message-ID: <4A2DF24E.5030707@lshift.net>

Rathi,

rathi wrote:
> I am able to start rabbitmq server in the node which has its IPAddress 
> as its hostname but not able to query any further details about the 
> queues and exchanges using rabbitmqctl or using erlang commands via 
> JInterface. If i set the hostname to some short name it works.
> 
> Is it not possible to have IPAddress as the hostname or we need to do 
> something else.

Having an IP address as the hostname will likely be tricky to get to 
work, so I recommend giving the machine a proper name. The folks on the 
erlang-questions mailing list may have a better idea.


Regards,

Matthias.



From matthias at lshift.net  Tue Jun  9 06:45:34 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 06:45:34 +0100
Subject: [rabbitmq-discuss] Catching messages sent to the stomp broker
 from other queues
In-Reply-To: <8ca3fbe80906081501q53370bdj4130c9a25356afff@mail.gmail.com>
References: <8ca3fbe80906081501q53370bdj4130c9a25356afff@mail.gmail.com>
Message-ID: <4A2DF6FE.9030301@lshift.net>

Anders,

anders conbere wrote:
> Basically I have some clients connecting to rabbitmq via the stomp
> broker, and some from the AMQP interface. The problem I'm having is
> creating a queue that is capable of receiving messages sent by the
> stomp client. I suspect that this is just a problem of defining my
> routing key correctly (but my initial guess of making the key the
> exchange name failed).
> 
> So this is what I've got.
> 
> via AMQP
> 
> 1) a durable exchange named "a"
> 2) a queue named "b" bound to "a"
> 
> via STOMP
> 
> 2) a message sent to "a"
> 
> if I then create a subscription in stomp to "a" I get the messages,
> however I never receive a message at "b".
> 
> like I said I tried binding "b" to "a" with the routing key "a", but
> that didn't work... any help?

SENDing a message to destination "a" is performing a basic.publish to 
the default exchange with a routing_key of "a". So in order to receive 
the message in AMQP-land you need to declare a queue named "a".

For more complex routing topologies the SEND needs to carry an 
'exchange' header, which then allows you to use any exchange of any 
type, and bind queues to that exchange in the normal AMQP way.


Regards,

Matthias.



From emile at lshift.net  Tue Jun  9 09:49:49 2009
From: emile at lshift.net (Emile Joubert)
Date: Tue, 09 Jun 2009 09:49:49 +0100
Subject: [rabbitmq-discuss] Compile RabbitMQ Erlang Client on Windows
In-Reply-To: <4124E587-F11B-47C1-90B9-7B47C185D5AE@gmail.com>
References: <000001c9e864$0dd3ae80$297b0b80$@grice@logosworld.com>
	<4124E587-F11B-47C1-90B9-7B47C185D5AE@gmail.com>
Message-ID: <4A2E222D.2040107@lshift.net>

Ben Hood wrote:
> Lynton,
> 
> 
> On 8 Jun 2009, at 19:07, "Lynton Grice" <lynton.grice at logosworld.com 
> <mailto:lynton.grice at logosworld.com>> wrote:
> 
>> Hi there,
>>
>>  
>>
>> I have compiled the "RabbitMQ Erlang AMQP client" **manually** on my 
>> Windows box.....
>>
>>  
>>
>> Just a question to make it easier for other Windows users wanting to 
>> use the RabbitMQ client, _has anyone been able to create a BAT file 
>> that is similar to the MAKE file provided in the RabbitMQ AMQP client 
>> download?_
>>
> I haven't done this myself, but have you considered a Windows port of make?

I can confirm that GNU Make 3.81 that ships with Cygwin compiles 
rabbitmq-erlang-client without warnings or errors.

-Emile



From lynton.grice at logosworld.com  Tue Jun  9 10:35:21 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Tue, 9 Jun 2009 11:35:21 +0200
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
	"State = Driver:handshake(InitialState), "
Message-ID: <000301c9e8e5$9f138060$dd3a8120$@grice@logosworld.com>

Hi there,

 

I am trying to run the Erlang RabbitMQ client tests and it is "hanging"
during the connection open.

 

BTW: I am running RabbitMQ 1.5.4 and the latest (just downloaded) Erlang
Client code from http://hg.rabbitmq.com (not sure what version that is...)

 

More specifically I am  trying to run the network_client_test.erl on my
local machine to a RabbitMQ server that is on "localhost". I can connect to
it happily with Python and am needing to get it working with Erlang now...

 

The "network_client_test.erl" tries to make a connection as follows:

 

new_connection() ->

  amqp_connection:start("guest", "guest", "localhost").

 

And then it seems to HANG on the "Driver:handshake" method (inside the
"amqp_connection.erl").....I have done some console debugging on this and it
is at this point that it hangs...

 

init([InitialState, Driver]) when is_atom(Driver) ->

    io:format("Inside INIT method... ~n"),

    State = Driver:handshake(InitialState),

    io:format("Inside INIT...after Driveriver:handshake... ~n"),

    {ok, State#connection_state{driver = Driver} }.

 

Any idea what the problem could be? Maybe a version thing?

 

Many thanks ;-)

 

Lynton

  _____  

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/39c1c8ef/attachment.htm 

From matthias at lshift.net  Tue Jun  9 10:44:10 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 10:44:10 +0100
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
 "State = Driver:handshake(InitialState), "
In-Reply-To: <000301c9e8e5$9f138060$dd3a8120$@grice@logosworld.com>
References: <000301c9e8e5$9f138060$dd3a8120$@grice@logosworld.com>
Message-ID: <4A2E2EEA.8090305@lshift.net>

Lynton,

Lynton Grice wrote:
> BTW: I am running RabbitMQ 1.5.4 and the latest (just downloaded) Erlang 
> Client code from http://hg.rabbitmq.com (not sure what version that is...)

That's a recipe for breakage. If you search the list for the error 
you'll find that you aren't the first person to run into this.

> Any idea what the problem could be? Maybe a version thing?

Yes. Please follow the instructions at 
http://www.rabbitmq.com/mercurial.html. Specifically make sure that your 
version of the Erlang client is from a 1.5.x-tag/branch.


Regards,

Matthias.



From lynton.grice at logosworld.com  Tue Jun  9 11:24:09 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Tue, 9 Jun 2009 12:24:09 +0200
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
	"State = Driver:handshake(InitialState), "
In-Reply-To: <4A2E2EEA.8090305@lshift.net>
References: <000301c9e8e5$9f138060$dd3a8120$@grice@logosworld.com>
	<4A2E2EEA.8090305@lshift.net>
Message-ID: <001101c9e8ec$72332490$56996db0$@grice@logosworld.com>

Hi Matthias,

 

Thanks for the help so far, I now have the latest versions for both the
client and server installed BUT now I am getting the following error.....it
is also in the "driver handshake"

 

26> network_client_test:lifecycle_test().

** exception error: no match of right hand side value

                    {error,

                        {undef,

                            [{rabbit_framing_channel,start_link,

                                 [#Fun<amqp_network_driver.0.121542398>,

                                  [<0.213.0>]]},

                             {amqp_network_driver,handshake,1},

                             {amqp_connection,init,1},

                             {gen_server,init_it,6},

                             {proc_lib,init_p_do_apply,3}]}}

     in function  amqp_connection:start/5

     in call from network_client_test:lifecycle_test/0

 

And here is the RabbitMQ log...seems to accept the connection and then
immediately close it....

 

=INFO REPORT==== 9-Jun-2009::11:57:51 ===

Rolling persister log to "c:/Documents and Settings/Lynton/Application
Data/RabbitMQ/db/rabbit-mnesia/rabbit_persister.LOG.previous"

 

=INFO REPORT==== 9-Jun-2009::11:57:51 ===

started TCP listener on 0.0.0.0:5672

 

=INFO REPORT==== 9-Jun-2009::11:58:17 ===

accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1359

 

=INFO REPORT==== 9-Jun-2009::11:58:17 ===

starting TCP connection <0.148.0> from 127.0.0.1:1359

 

=ERROR REPORT==== 9-Jun-2009::11:58:17 ===

error on TCP connection <0.148.0> from 127.0.0.1:1359

connection_closed_abruptly

 

=INFO REPORT==== 9-Jun-2009::11:58:17 ===

closing TCP connection <0.148.0> from 127.0.0.1:1359

 

Any ideas what this could be?

 

Thanks 

 

Lynton

  _____  

 

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 09 June 2009 11:44 AM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
"State = Driver:handshake(InitialState), "

 

Lynton,

 

Lynton Grice wrote:

> BTW: I am running RabbitMQ 1.5.4 and the latest (just downloaded) Erlang 

> Client code from http://hg.rabbitmq.com (not sure what version that is...)

 

That's a recipe for breakage. If you search the list for the error 

you'll find that you aren't the first person to run into this.

 

> Any idea what the problem could be? Maybe a version thing?

 

Yes. Please follow the instructions at 

http://www.rabbitmq.com/mercurial.html. Specifically make sure that your 

version of the Erlang client is from a 1.5.x-tag/branch.

 

 

Regards,

 

Matthias.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/59a5070c/attachment.htm 

From matthias at lshift.net  Tue Jun  9 11:48:28 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 11:48:28 +0100
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
 "State = Driver:handshake(InitialState), "
In-Reply-To: <001101c9e8ec$72332490$56996db0$@grice@logosworld.com>
References: <000301c9e8e5$9f138060$dd3a8120$@grice@logosworld.com>
	<4A2E2EEA.8090305@lshift.net>
	<001101c9e8ec$72332490$56996db0$@grice@logosworld.com>
Message-ID: <4A2E3DFC.6000502@lshift.net>

Lynton,

Lynton Grice wrote:
> Thanks for the help so far, I now have the latest versions for both the 
> client and server installed BUT now I am getting the following 
> error.....it is also in the ?driver handshake?

>                         {undef,
>                             [{rabbit_framing_channel,start_link,

This again is an error people have reported before - search the list for 
the previous reports. The error is indicative of the client not being 
able to locate the server modules on its load path. You'll need to 
adjust Erlang's load path such it can find these modules.


Matthias.



From matthias at lshift.net  Tue Jun  9 12:02:19 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 12:02:19 +0100
Subject: [rabbitmq-discuss] Clustering Question
In-Reply-To: <3b949f090906081430w2d099b8axfffa13573628817c@mail.gmail.com>
References: <c168360f0906050707s7c418826g4db93fc6b72f4978@mail.gmail.com>	<3b949f090906050911o22cd7048ge639220ea29b88cc@mail.gmail.com>	<05C38F2C-D035-4DC4-802D-7E25BF2F4D22@gmail.com>	<4A2D6244.1070201@lshift.net>	<3b949f090906081336w177dcb63oad1f79e1162647ed@mail.gmail.com>	<4A2D7900.7040908@lshift.net>	<3b949f090906081350s74a84362q2b4f9d6292eb93c3@mail.gmail.com>	<4A2D805C.4070104@lshift.net>
	<3b949f090906081430w2d099b8axfffa13573628817c@mail.gmail.com>
Message-ID: <4A2E413B.7020500@lshift.net>

Jason,


Jason J. W. Williams wrote:
> My wording is a bit sloppy. :-) My consumer recreated the queue on
> reconnect. Then when Node A came up, it saw the queue already existed
> and didn't replay into it.

I have just tested this (on 1.5.5 and default, but I am pretty sure it 
would work the same on any 1.5.x version):

1) create a two-node cluster - with nodes 'rabbit' and 'hare'
2) connect to 'hare', declare a durable queue 'foo', and send a 
persistent message to it
3) shut down 'hare'
4) connect to 'rabbit', declare a durable queue 'foo', and send a 
persistent message to it
5) restart 'hare'
6) run 'rabbitmqctl list_queues'

The last step shows a queue 'foo' with two messages, indicating that the 
message which was sent to the queue on 'hare' got requeued in the new 
queue on 'rabbit' when 'hare' recovered.

Whether or not that is the right thing to do is debatable, but it's 
certainly not obviously broken.


Matthias.



From lynton.grice at logosworld.com  Tue Jun  9 13:37:08 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Tue, 9 Jun 2009 14:37:08 +0200
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
	"State = Driver:handshake(InitialState), "
In-Reply-To: <4A2E3DFC.6000502@lshift.net>
References: <000301c9e8e5$9f138060$dd3a8120$@grice@logosworld.com>
	<4A2E2EEA.8090305@lshift.net>
	<001101c9e8ec$72332490$56996db0$@grice@logosworld.com>
	<4A2E3DFC.6000502@lshift.net>
Message-ID: <000001c9e8ff$05a2a720$10e7f560$@grice@logosworld.com>

Hi Matthias,

I have been looking through the posts and cannot see anything specific that
says exactly how to solve this issue. Yes, you mention load path etc....so I
assume "erl -pa" etc.....but can I see an example of what needs to be done
"load path" wise for the client to work? I have been trying to get the
client to work to almost 2 days now....;-(

I have installed BOTH the server and client folders into the
%ERLANG_HOME%\erl5.7.1\lib folder....surely that should be fine?

I just keep getting this:

=INFO REPORT==== 9-Jun-2009::14:23:53 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1319

=INFO REPORT==== 9-Jun-2009::14:23:53 ===
starting TCP connection <0.175.0> from 127.0.0.1:1319

=ERROR REPORT==== 9-Jun-2009::14:24:01 ===
error on TCP connection <0.175.0> from 127.0.0.1:1319
connection_closed_abruptly

=INFO REPORT==== 9-Jun-2009::14:24:01 ===
closing TCP connection <0.175.0> from 127.0.0.1:1319

Yes, I do agree I probably need to understand Erlang better with regard to
the "load path" etc....

But thanks for the help regardless, sorry for being a bit stupid with this
stuff ;-)

Lynton 

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 09 June 2009 12:48 PM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
"State = Driver:handshake(InitialState), "

Lynton,

Lynton Grice wrote:
> Thanks for the help so far, I now have the latest versions for both the 
> client and server installed BUT now I am getting the following 
> error.....it is also in the "driver handshake"

>                         {undef,
>                             [{rabbit_framing_channel,start_link,

This again is an error people have reported before - search the list for 
the previous reports. The error is indicative of the client not being 
able to locate the server modules on its load path. You'll need to 
adjust Erlang's load path such it can find these modules.


Matthias.




From matthias at lshift.net  Tue Jun  9 15:52:20 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 15:52:20 +0100
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
 "State = Driver:handshake(InitialState), "
In-Reply-To: <000001c9e8ff$05a2a720$10e7f560$@grice@logosworld.com>
References: <000301c9e8e5$9f138060$dd3a8120$@grice@logosworld.com>
	<4A2E2EEA.8090305@lshift.net>
	<001101c9e8ec$72332490$56996db0$@grice@logosworld.com>
	<4A2E3DFC.6000502@lshift.net>
	<000001c9e8ff$05a2a720$10e7f560$@grice@logosworld.com>
Message-ID: <4A2E7724.6070707@lshift.net>

Lynton,

Lynton Grice wrote:
> Hi Matthias,
> 
> I have been looking through the posts and cannot see anything specific that
> says exactly how to solve this issue. Yes, you mention load path etc....so I
> assume "erl -pa" etc.....but can I see an example of what needs to be done
> "load path" wise for the client to work? I have been trying to get the
> client to work to almost 2 days now....;-(
> 
> I have installed BOTH the server and client folders into the
> %ERLANG_HOME%\erl5.7.1\lib folder....surely that should be fine?

If you have the server in the above dir, as per the installation
instructions, then the client code should find the server libraries
without needing to modify the load path.

In order to diagnose this further, please send me

1) a directory listing of %ERLANG_HOME%\erl5.7.1\lib

2) a deep directory listing for all rabbitmq* directories in the above.

3) the location of the erlang client directory, and a deep directory
listing thereof

4) the exact command line used for invoking the erlang client, including
the dir it is run from

5) the output of [P || P <- code:get_path(), string:str(P, "rabbit") =/=
0]. when run inside the Erlang client's shell.

6) the output of  [code:which(M) || M <- [lib_amqp,
rabbit_framing_channel, rabbit]]. when run inside the Erlang client's shell.

7) the sequence of erlang function calls used in the test

> I just keep getting this:
> 
> =INFO REPORT==== 9-Jun-2009::14:23:53 ===
> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1319
> 
> =INFO REPORT==== 9-Jun-2009::14:23:53 ===
> starting TCP connection <0.175.0> from 127.0.0.1:1319
> 
> =ERROR REPORT==== 9-Jun-2009::14:24:01 ===
> error on TCP connection <0.175.0> from 127.0.0.1:1319
> connection_closed_abruptly
> 
> =INFO REPORT==== 9-Jun-2009::14:24:01 ===
> closing TCP connection <0.175.0> from 127.0.0.1:1319

Are you still getting {undef, [{rabbit_framing_channel,start_link,...}]}
error in the client? If so then the above is likely a consequence of that.

> Yes, I do agree I probably need to understand Erlang better with regard to
> the "load path" etc....

Some knowledge of Erlang when using the Erlang client is highly
recommended ;)


Regards,

Matthias.



From gmr at myyearbook.com  Tue Jun  9 16:06:14 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 9 Jun 2009 11:06:14 -0400
Subject: [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
In-Reply-To: <4A2DEE7D.3030409@lshift.net>
References: <200906072340.23972.nico@rakar.com> <4A2DEE7D.3030409@lshift.net>
Message-ID: <af1bce590906090806v417c5d6ftca82b722658cba4b@mail.gmail.com>

On Tue, Jun 9, 2009 at 1:09 AM, Matthias Radestock <matthias at lshift.net>wrote:

Please take this in context in that I am migrating a large scale ActiveMQ
install using STOMP to RabbitMQ and am looking to mirror default behaviors.
 That being said, I've changing the default behaviors in the stomp connector
when I download it so that I get the behaviors I need by default.

The default behaviour of the current implementation of the RabbitMQ
> STOMP adapter
>
> 1) routes messages to one consumer (round-robin) - this can be changed
> to 'all' by specifying appropriate 'exchange' and 'routing_key' headers


+1 This is good.

2) does not queue messages when there are no subscribers - this can be
> changed by specifying an 'auto-delete = false' header (though that does
> require at least one SUBSCRIBE to start with)


I change this auto-delete = false in the code before compilation to mirror
ActiveMQ behavior.

 3) sends only one copy of a message to a client in the event the client

> has more than one subscription for the same destination - this can be
> changed by specifying  appropriate 'exchange' and 'routing_key' headers


+1 This makes sense.


> Should the default behaviour be different? And why?


The only other oddity is the durable consumer.  Coming from an ActiveMQ
world, this is more of a server side setting than a header packet setting.

For what it's worth is the biggest issue I had to overcome (other than the
client issues) was the concept that one has to subscribe to a queue in order
to set the default behavior for it.  Our workflow has apps enqueueing all
over the place and a limited set of consumers that can be restarted or down
for small periods of time.  The natural flow for us is to start enqueueing
then add consumers that subscribe, not the other way around.  If the queue
behavior can be set when messages are sent, it would make things easier to
grok.  Even more ideal would be to set defaults by exchange, but that
probably is more work than is reasonably obtained, compared to just changing
defaults.

Regards,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/7d53ce76/attachment.htm 

From ryan at acceleration.net  Tue Jun  9 17:02:22 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Tue, 09 Jun 2009 12:02:22 -0400
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A2D70A5.6040907@lshift.net>
References: <4A292998.3090407@acceleration.net> <4A2D70A5.6040907@lshift.net>
Message-ID: <4A2E878E.3000700@acceleration.net>

Matthias Radestock wrote:
> Looking at the code, I am pretty sure that Close() is meant to be
> called from inside the HandleCall/Cast functions. 
Really?  The code comment on Close() says "Shut down the server, causing
MainLoop() to return to its caller.", which is exactly what I want.  I
dug deeper into SimpleRpcServer, and what I really need is to break from
MainLoop's foreach after the body of the loop has executed.  The
m_subscription is used after HandleCall / HandleCast / ProcessRequest,
and I don't see how I could close it in HandleCall without creating
problems later on down the line. 

If I call Close() at any point in HandleCall/Cast, then the byte[]
intended for the RPC caller will be lost, and I expect it would throw a
nullref when it tries to BasicPublish those bytes.
If I call Close() at the end of ProcessRequest, then the message will be
processed and the ack will be lost.  This isn't so bad as I have other
logic checking for duplicates, but I expect it would throw a nullref
when it tries to ack in MainLoop.
If I call Close() at the beginning of ProcessRequest, then the message
will not be processed and the ack will be lost.  This isn't so bad as we
should have a redelivery, but I expect it would throw a nullref when it
tries to ack in MainLoop.

> It would be useful to get a stack trace with line numbers to work out
> exactly where the NPE occurs.
I'm afraid I might be a minor version behind at this point.
System.NullReferenceException: Object reference not set to an instance of an object.
   at RabbitMQ.Client.Impl.ModelBase.BasicCancel(String consumerTag) in d:\Projects\rabbitmq-dotnet-client-1.5.3\src\client\impl\ModelBase.cs:line 668
   at RabbitMQ.Client.MessagePatterns.Subscription.Close() in d:\Projects\rabbitmq-dotnet-client-1.5.3\src\client\messagepatterns\Subscription.cs:line 223
   at RabbitMQ.Client.MessagePatterns.Subscription.System.IDisposable.Dispose() in d:\Projects\rabbitmq-dotnet-client-1.5.3\src\client\messagepatterns\Subscription.cs:line 454
   at RabbitMQ.Client.MessagePatterns.SimpleRpcServer.MainLoop() in d:\Projects\rabbitmq-dotnet-client-1.5.3\src\client\messagepatterns\SimpleRpcServer.cs:line 205

Line 668 is:
ModelShutdown -= new
ModelShutdownEventHandler(k.m_consumer.HandleModelShutdown);

I think I'm calling subscription.Close() multiple times, since my code
is essentially:

using(var subscription = new Subscription(model, "queue", false))
using (RpcServer = new MyRpcServer(subscription, this)) {
 RpcServer.MainLoop();
}

So I think I'm calling subscription.Close() 3 times in 2 threads:
# controller thread: calls RpcServer.Close()
# worker thread: when the using() invokes subscription.Dispose()
# worker thread: when the using() invokes RpcServer.Dispose()

Subscription.Close() is checking if m_consumer is null before calling
BasicCancel, so it looks like a race condition between the controlling
thread calling RpcServer.Close() and the worker thread cleaning up with
Dispose(), but I don't follow how the foreach in MainLoop would
terminate and start Disposing of things before the controller thread had
gotten through subscription.Close() to set m_consumer to null.

I've got a unit test that reproduces this behavior, so I'll  be playing
with this today, stepping through to better understand what is happening.

As a side note, the docs on
http://www.rabbitmq.com/build-dotnet-client.html could use mention of
the local.build file.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506





From cremes.devlist at mac.com  Tue Jun  9 17:24:26 2009
From: cremes.devlist at mac.com (Chuck Remes)
Date: Tue, 09 Jun 2009 11:24:26 -0500
Subject: [rabbitmq-discuss] Fwd:  Objective-C AMQP Library
References: <8018CECC-6BD8-4275-8DA4-7202B1221C84@mac.com>
Message-ID: <7C2FE79B-D629-4757-A1E6-3F148E9AA3DA@mac.com>


You're lucky in the sense that Obj-C gives you some of the same  
dynamism as Ruby. You should be able to give it a nice wrapper.

I'm not an Obj-C pro by any stretch but I'll take a crack at answering  
some of your questions.

1. Obj-C is a C superset, so integration is pretty simple. Just  
#include/#import the headers, make sure the correct files are on your  
path and start compiling stuff.

2. A few suggestions...
a. Keep the number of external dependencies low (see #5)

b. Use whatever the current standard is for C-based applications which  
is likely autoconf and make. This gets more complicated if you want  
your library to be usable from Windows too.

3. NSNotification is a Cocoa API so if you use it then you are tying  
the library to OSX (though NSNotification has probably been cloned by  
the GNUstep project). Use the dynamism allowed in Obj-C and use the  
Delegation pattern. If you are familiar with Cocoa at all, it uses  
delegation all over the place. Copy that idea.

4. Look at OCUnit which is an Obj-C testing framework similar to the  
old XUnit and JUnit frameworks. Ruby's Test::Unit was patterned after  
that API too so it might be familiar to you.

5. I highly recommend *against* writing common utilities like XML  
parsing. Someone else has already done the job for you so don't  
reinvent the wheel. Make it a project dependency. For an AMQP library  
I don't think you'll need to do this too often. If you really plan to  
mimic the Ruby AMQP gem, you'll want to  see out an embeddable C  
network server/library that can act as the central network reactor.

6. The largest body of Obj-C code in the world is in the Apple Cocoa  
API. Copy those patterns. You can't really make a DSL like you would  
in Ruby though.

7. Why not? You might want to write a few "spikes" (small programs  
that prove an idea out... kind of like what you do in irb).

Good luck!

cr


On Jun 9, 2009, at 12:19 AM, Matt Todd wrote:

> As a new Objective-C developer (just fiddling around with it), I've  
> been thinking of a project to get my hands dirty with. I've been  
> using RabbitMQ for some time in my Ruby projects and really enjoy  
> using it, and the AMQP protocol should be fairly simple to grok and  
> work with.
>
> Because of this, I'm currently looking to start building an  
> Objective-C based client library as a pet project to get me actually  
> working in the language.
>
> I'm thinking of using the experimental C language client code to  
> power the functionality and giving it a nice Obj-C DSL and handling  
> everything through a NSNotificationCenter to create an evented  
> interface (similar to the EventMachine Ruby AMQP library I'm used to  
> working with). This is the goal for now, anyhow.
>
> Being still very new to the language, and certainly being unfamiliar  
> with the idiosyncrasies of developing libraries for Obj-C, I'm  
> looking for input, support, and contributions for this endeavor from  
> experts and enthusiasts with strong opinions and/or time.
>
> Let me stress my lack of exposure to Obj-C (nor have I done anything  
> significant in C/C++ or any strongly typed, compiled language in  
> quite some time). This means I'm currently asking the following  
> questions (as noob as they may be):
>
> 1. How do I integrate the C library into this Obj-C library?
> 2. How do I write a distributable, clean Obj-C library?
> 3. Is an NSNotificationCenter-based implementation a good approach  
> for an evented AMQP library?
> 4. How do I mock objects in Obj-C (to not require an instance of  
> RabbitMQ to be running for tests)?
> 5. Should I just write this from scratch, including XML parsing et al?
> 6. What does a good Obj-C DSL look like?
> 7. Why would I start with a significant library to get familiar with  
> the language?
>
> Fair warning, I'm a Ruby developer, mainly building web applications  
> in Rails.
>
> Looking forward to hearing from you, and hope to get something  
> worthwhile out of this.
>
> Matt
>
>
>
> -- 
> Matt Todd
> Highgroove Studios
> www.highgroove.com
> cell: 404-314-2612
> blog: maraby.org
>
> Scout - Web Monitoring and Reporting Software
> www.scoutapp.com
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/47ef30a9/attachment.htm 

From lynton.grice at logosworld.com  Tue Jun  9 18:42:16 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Tue, 9 Jun 2009 19:42:16 +0200
Subject: [rabbitmq-discuss] FW: Re: Erlang RabbitMQ Client hanshake problem
	on "State = Driver:handshake(InitialState), "
Message-ID: <000001c9e929$a5cd5cc0$f1681640$@grice@logosworld.com>

Hi Matthias,

 

I have tried to do what you asked for in order for you to understand the
problem better, forgive me if I misinterpreted one or two things, just let
me know and I will try again ;-)

 

I really appreciate the help, thank you.

 

1) a directory listing of %ERLANG_HOME%\erl5.7.1\lib 

      You can see the Rabbit* folders below...

 

cid:image001.png at 01C9E936.39031960

cid:image002.png at 01C9E936.39031960

cid:image003.png at 01C9E936.39031960

 

2) a deep directory listing for all rabbitmq* directories in the above.

                Not sure how you wanted this represented?

 

cid:image004.png at 01C9E936.39031960

 

Just for interest this is the version etc of the Server....

cid:image005.png at 01C9E936.E23BB780

 

Here is the client.....latest version....

cid:image006.png at 01C9E936.E23BB780

 

 

3) the location of the erlang client directory, and a deep directory listing
thereof

 

cid:image007.png at 01C9E936.E23BB780

 

Here are my environment variables, not sure if you wanted to see them...

 

cid:image010.png at 01C9E937.54F671C0

 

4) the exact command line used for invoking the erlang client, including the
dir it is run from

NOTE: I *assume* that I don't need to add anything to the load path because
the server + client are in the Erlang LIB folder.....

Also, you can see it HANGING again.....

cid:image008.png at 01C9E938.2264EDD0

 

And just to see the LOG again from this evening...

 

=INFO REPORT==== 9-Jun-2009::19:13:10 ===

started TCP listener on 0.0.0.0:5672

 

=INFO REPORT==== 9-Jun-2009::19:22:59 ===

accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1822

 

=INFO REPORT==== 9-Jun-2009::19:22:59 ===

starting TCP connection <0.148.0> from 127.0.0.1:1822

 

=ERROR REPORT==== 9-Jun-2009::19:23:09 ===

error on TCP connection <0.148.0> from 127.0.0.1:1822

{handshake_timeout,frame_header}

 

=INFO REPORT==== 9-Jun-2009::19:23:09 ===

closing TCP connection <0.148.0> from 127.0.0.1:1822

 

5) the output of [P || P <- code:get_path(), string:str(P, "rabbit") =/= 0].
when run inside the Erlang client's shell.

 

cid:image009.png at 01C9E938.2264EDD0

 

6) the output of  [code:which(M) || M <- [lib_amqp, rabbit_framing_channel,
rabbit]]. when run inside the Erlang client's shell.

 

cid:image011.png at 01C9E938.2264EDD0

 

7) the sequence of erlang function calls used in the test

For this is am just calling the "lifecycle_test" function in the
"network_client_test.erl" script in the TESTS folder of the client code.....

 

-module(network_client_test).

 

-export([test_coverage/0]).

 

-include_lib("eunit/include/eunit.hrl").

 

basic_get_test() ->

    test_util:basic_get_test(new_connection()).

 

basic_return_test() ->

    test_util:basic_return_test(new_connection()).

 

basic_qos_test() ->

    test_util:basic_qos_test(new_connection()).

 

basic_recover_test() -> 

    test_util:basic_recover_test(new_connection()).

 

basic_consume_test() -> 

    test_util:basic_consume_test(new_connection()).

 

lifecycle_test() ->

    test_util:lifecycle_test(new_connection()).

 

basic_ack_test() ->

    test_util:basic_ack_test(new_connection()).

 

channel_lifecycle_test() ->

    test_util:channel_lifecycle_test(new_connection()).

 

queue_unbind_test() ->

    test_util:queue_unbind_test(new_connection()).

 

command_serialization_test() ->

    test_util:command_serialization_test(new_connection()).

 

teardown_test() ->

    test_util:teardown_test(new_connection()).

 

rpc_test() ->

    test_util:rpc_test(new_connection()).

 

%%--------------------------------------------------------------------------
-

%% Negative Tests

 

non_existent_exchange_test() -> 

  negative_test_util:non_existent_exchange_test(new_connection()).

 

hard_error_test() ->

    negative_test_util:hard_error_test(new_connection()).

 

%%--------------------------------------------------------------------------
-

%% Common Functions

 

new_connection() ->

  amqp_connection:start("guest", "guest", "localhost").

 

test_coverage() ->

    rabbit_misc:enable_cover(),

    test(),

    rabbit_misc:report_cover().

 

 

 

 

 

 

 

 

 

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 09 June 2009 04:52 PM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
"State = Driver:handshake(InitialState), "

 

Lynton,

 

Lynton Grice wrote:

> Hi Matthias,

> 

> I have been looking through the posts and cannot see anything specific
that

> says exactly how to solve this issue. Yes, you mention load path etc....so
I

> assume "erl -pa" etc.....but can I see an example of what needs to be done

> "load path" wise for the client to work? I have been trying to get the

> client to work to almost 2 days now....;-(

> 

> I have installed BOTH the server and client folders into the

> %ERLANG_HOME%\erl5.7.1\lib folder....surely that should be fine?

 

If you have the server in the above dir, as per the installation

instructions, then the client code should find the server libraries

without needing to modify the load path.

 

In order to diagnose this further, please send me

 

1) a directory listing of %ERLANG_HOME%\erl5.7.1\lib

 

2) a deep directory listing for all rabbitmq* directories in the above.

 

3) the location of the erlang client directory, and a deep directory

listing thereof

 

4) the exact command line used for invoking the erlang client, including

the dir it is run from

 

5) the output of [P || P <- code:get_path(), string:str(P, "rabbit") =/=

0]. when run inside the Erlang client's shell.

 

6) the output of  [code:which(M) || M <- [lib_amqp,

rabbit_framing_channel, rabbit]]. when run inside the Erlang client's shell.

 

7) the sequence of erlang function calls used in the test

 

> I just keep getting this:

> 

> =INFO REPORT==== 9-Jun-2009::14:23:53 ===

> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1319

> 

> =INFO REPORT==== 9-Jun-2009::14:23:53 ===

> starting TCP connection <0.175.0> from 127.0.0.1:1319

> 

> =ERROR REPORT==== 9-Jun-2009::14:24:01 ===

> error on TCP connection <0.175.0> from 127.0.0.1:1319

> connection_closed_abruptly

> 

> =INFO REPORT==== 9-Jun-2009::14:24:01 ===

> closing TCP connection <0.175.0> from 127.0.0.1:1319

 

Are you still getting {undef, [{rabbit_framing_channel,start_link,...}]}

error in the client? If so then the above is likely a consequence of that.

 

> Yes, I do agree I probably need to understand Erlang better with regard to

> the "load path" etc....

 

Some knowledge of Erlang when using the Erlang client is highly

recommended ;)

 

 

Regards,

 

Matthias.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 11127 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 9455 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment-0001.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 5719 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment-0002.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 5413 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment-0003.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 7932 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment-0004.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 11551 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment-0005.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 10750 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment-0006.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 33980 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment-0007.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 2993 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment-0008.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 4289 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment-0009.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 5227 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/d5273bd8/attachment-0010.png 

From lynton.grice at logosworld.com  Tue Jun  9 18:42:39 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Tue, 9 Jun 2009 19:42:39 +0200
Subject: [rabbitmq-discuss] FW: Re: Erlang RabbitMQ Client hanshake problem
	on "State = Driver:handshake(InitialState), "
Message-ID: <000001c9e929$b43f5470$1cbdfd50$@grice@logosworld.com>

Hi Matthias,

 

I have tried to do what you asked for in order for you to understand the
problem better, forgive me if I misinterpreted one or two things, just let
me know and I will try again ;-)

 

I really appreciate the help, thank you.

 

1) a directory listing of %ERLANG_HOME%\erl5.7.1\lib 

      You can see the Rabbit* folders below...

 

cid:image001.png at 01C9E936.39031960

cid:image002.png at 01C9E936.39031960

cid:image003.png at 01C9E936.39031960

 

2) a deep directory listing for all rabbitmq* directories in the above.

                Not sure how you wanted this represented?

 

cid:image004.png at 01C9E936.39031960

 

Just for interest this is the version etc of the Server....

cid:image005.png at 01C9E936.E23BB780

 

Here is the client.....latest version....

cid:image006.png at 01C9E936.E23BB780

 

 

3) the location of the erlang client directory, and a deep directory listing
thereof

 

cid:image007.png at 01C9E936.E23BB780

 

Here are my environment variables, not sure if you wanted to see them...

 

cid:image010.png at 01C9E937.54F671C0

 

4) the exact command line used for invoking the erlang client, including the
dir it is run from

NOTE: I *assume* that I don't need to add anything to the load path because
the server + client are in the Erlang LIB folder.....

Also, you can see it HANGING again.....

cid:image008.png at 01C9E938.2264EDD0

 

And just to see the LOG again from this evening...

 

=INFO REPORT==== 9-Jun-2009::19:13:10 ===

started TCP listener on 0.0.0.0:5672

 

=INFO REPORT==== 9-Jun-2009::19:22:59 ===

accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1822

 

=INFO REPORT==== 9-Jun-2009::19:22:59 ===

starting TCP connection <0.148.0> from 127.0.0.1:1822

 

=ERROR REPORT==== 9-Jun-2009::19:23:09 ===

error on TCP connection <0.148.0> from 127.0.0.1:1822

{handshake_timeout,frame_header}

 

=INFO REPORT==== 9-Jun-2009::19:23:09 ===

closing TCP connection <0.148.0> from 127.0.0.1:1822

 

5) the output of [P || P <- code:get_path(), string:str(P, "rabbit") =/= 0].
when run inside the Erlang client's shell.

 

cid:image009.png at 01C9E938.2264EDD0

 

6) the output of  [code:which(M) || M <- [lib_amqp, rabbit_framing_channel,
rabbit]]. when run inside the Erlang client's shell.

 

cid:image011.png at 01C9E938.2264EDD0

 

7) the sequence of erlang function calls used in the test

For this is am just calling the "lifecycle_test" function in the
"network_client_test.erl" script in the TESTS folder of the client code.....

 

-module(network_client_test).

 

-export([test_coverage/0]).

 

-include_lib("eunit/include/eunit.hrl").

 

basic_get_test() ->

    test_util:basic_get_test(new_connection()).

 

basic_return_test() ->

    test_util:basic_return_test(new_connection()).

 

basic_qos_test() ->

    test_util:basic_qos_test(new_connection()).

 

basic_recover_test() -> 

    test_util:basic_recover_test(new_connection()).

 

basic_consume_test() -> 

    test_util:basic_consume_test(new_connection()).

 

lifecycle_test() ->

    test_util:lifecycle_test(new_connection()).

 

basic_ack_test() ->

    test_util:basic_ack_test(new_connection()).

 

channel_lifecycle_test() ->

    test_util:channel_lifecycle_test(new_connection()).

 

queue_unbind_test() ->

    test_util:queue_unbind_test(new_connection()).

 

command_serialization_test() ->

    test_util:command_serialization_test(new_connection()).

 

teardown_test() ->

    test_util:teardown_test(new_connection()).

 

rpc_test() ->

    test_util:rpc_test(new_connection()).

 

%%--------------------------------------------------------------------------
-

%% Negative Tests

 

non_existent_exchange_test() -> 

  negative_test_util:non_existent_exchange_test(new_connection()).

 

hard_error_test() ->

    negative_test_util:hard_error_test(new_connection()).

 

%%--------------------------------------------------------------------------
-

%% Common Functions

 

new_connection() ->

  amqp_connection:start("guest", "guest", "localhost").

 

test_coverage() ->

    rabbit_misc:enable_cover(),

    test(),

    rabbit_misc:report_cover().

 

 

 

 

 

 

 

 

 

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 09 June 2009 04:52 PM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
"State = Driver:handshake(InitialState), "

 

Lynton,

 

Lynton Grice wrote:

> Hi Matthias,

> 

> I have been looking through the posts and cannot see anything specific
that

> says exactly how to solve this issue. Yes, you mention load path etc....so
I

> assume "erl -pa" etc.....but can I see an example of what needs to be done

> "load path" wise for the client to work? I have been trying to get the

> client to work to almost 2 days now....;-(

> 

> I have installed BOTH the server and client folders into the

> %ERLANG_HOME%\erl5.7.1\lib folder....surely that should be fine?

 

If you have the server in the above dir, as per the installation

instructions, then the client code should find the server libraries

without needing to modify the load path.

 

In order to diagnose this further, please send me

 

1) a directory listing of %ERLANG_HOME%\erl5.7.1\lib

 

2) a deep directory listing for all rabbitmq* directories in the above.

 

3) the location of the erlang client directory, and a deep directory

listing thereof

 

4) the exact command line used for invoking the erlang client, including

the dir it is run from

 

5) the output of [P || P <- code:get_path(), string:str(P, "rabbit") =/=

0]. when run inside the Erlang client's shell.

 

6) the output of  [code:which(M) || M <- [lib_amqp,

rabbit_framing_channel, rabbit]]. when run inside the Erlang client's shell.

 

7) the sequence of erlang function calls used in the test

 

> I just keep getting this:

> 

> =INFO REPORT==== 9-Jun-2009::14:23:53 ===

> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:1319

> 

> =INFO REPORT==== 9-Jun-2009::14:23:53 ===

> starting TCP connection <0.175.0> from 127.0.0.1:1319

> 

> =ERROR REPORT==== 9-Jun-2009::14:24:01 ===

> error on TCP connection <0.175.0> from 127.0.0.1:1319

> connection_closed_abruptly

> 

> =INFO REPORT==== 9-Jun-2009::14:24:01 ===

> closing TCP connection <0.175.0> from 127.0.0.1:1319

 

Are you still getting {undef, [{rabbit_framing_channel,start_link,...}]}

error in the client? If so then the above is likely a consequence of that.

 

> Yes, I do agree I probably need to understand Erlang better with regard to

> the "load path" etc....

 

Some knowledge of Erlang when using the Erlang client is highly

recommended ;)

 

 

Regards,

 

Matthias.

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 11127 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 9455 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment-0001.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 5719 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment-0002.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 5413 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment-0003.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 7932 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment-0004.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 11551 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment-0005.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 10750 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment-0006.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 33980 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment-0007.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 2993 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment-0008.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 4289 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment-0009.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 5227 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/20e89ac3/attachment-0010.png 

From matthias at lshift.net  Tue Jun  9 19:00:04 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 19:00:04 +0100
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
 "State = Driver:handshake(InitialState), "
In-Reply-To: <264B3EEDBD3B8D4AA2890372126360B3035B47A3@NDCDMSG01.sasol.com>
References: <264B3EEDBD3B8D4AA2890372126360B3035B47A3@NDCDMSG01.sasol.com>
Message-ID: <4A2EA324.8080100@lshift.net>

Lynton,

Grice, Lynton (L) wrote:
> I have tried to do what you asked for in order for you to understand the
> problem better, forgive me if I misinterpreted one or two things, just
> let me know and I will try again ;-)

That all looks fine, BUT ...

the reason I asked for this info is so that I could figure out why you
were getting the {undef, [{rabbit_framing_channel,start_link,...}]}
error. It looks like you are no longer getting that error. Is that correct?

What's the problem now? Does network_client_test:lifecycle_test() not
return, and you get an {handshake_timeout,frame_header} error in the
server logs?

If so, that does look like a version incompatibility problem again,
specifically it appears that you are running a 1.5.5 server, but a
non-1.5.x Erlang client. As I said before, if you are running with a
1.5.5 server, make sure that your version of the Erlang client is from a
1.5.x tag/branch. If that doesn't work for you, please send me a
transcript of the commands you are using to get hold of your copies of
the client and server code.


Regards,

Matthias.



From lynton.grice at logosworld.com  Tue Jun  9 19:12:26 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Tue, 9 Jun 2009 20:12:26 +0200
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
	"State = Driver:handshake(InitialState), "
Message-ID: <001301c9e92d$dd1598b0$9740ca10$@grice@logosworld.com>

Hi Matthias,

 

Yup, that is the new error, sorry for not making it clearer earlier....

 

>From a Windows perspective I will download the files from
http://hg.rabbitmq.com/rabbitmq-erlang-client/

 

BTW: How do I tell what version of the client I am running?

 

But I will just download the very latest one on top and compile them?

 

I have just installed Mercurial for Windows but will only try get familiar
with that tomorrow.....

 

Thanks again for the help thus far....

 

Lynton 

 



 

 

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthias
Radestock
Sent: 09 June 2009 08:00 PM
To: Grice, Lynton (L)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
"State = Driver:handshake(InitialState), "

 

Lynton,

 

Grice, Lynton (L) wrote:

> I have tried to do what you asked for in order for you to understand the

> problem better, forgive me if I misinterpreted one or two things, just

> let me know and I will try again ;-)

 

That all looks fine, BUT ...

 

the reason I asked for this info is so that I could figure out why you

were getting the {undef, [{rabbit_framing_channel,start_link,...}]}

error. It looks like you are no longer getting that error. Is that correct?

 

What's the problem now? Does network_client_test:lifecycle_test() not

return, and you get an {handshake_timeout,frame_header} error in the

server logs?

 

If so, that does look like a version incompatibility problem again,

specifically it appears that you are running a 1.5.5 server, but a

non-1.5.x Erlang client. As I said before, if you are running with a

1.5.5 server, make sure that your version of the Erlang client is from a

1.5.x tag/branch. If that doesn't work for you, please send me a

transcript of the commands you are using to get hold of your copies of

the client and server code.

 

 

Regards,

 

Matthias.

 

_______________________________________________

rabbitmq-discuss mailing list

rabbitmq-discuss at lists.rabbitmq.com

http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/98ce6984/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 12409 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/98ce6984/attachment.png 

From ryan at acceleration.net  Tue Jun  9 19:21:15 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Tue, 09 Jun 2009 14:21:15 -0400
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A2E878E.3000700@acceleration.net>
References: <4A292998.3090407@acceleration.net> <4A2D70A5.6040907@lshift.net>
	<4A2E878E.3000700@acceleration.net>
Message-ID: <4A2EA81B.8060303@acceleration.net>

Ryan Davis wrote:
> I don't follow how the foreach in MainLoop would
> terminate and start Disposing of things before the controller thread had
> gotten through subscription.Close() to set m_consumer to null.
>
> I've got a unit test that reproduces this behavior, so I'll  be playing
> with this today, stepping through to better understand what is happening.
>   
I think I figured it out.  The C# "foreach" loop also acts like a
"using" statement, and will call Dispose() on my subscription when it
finishes, which I didn't realize
(http://mark.michaelis.net/Blog/CForeachWithArrays.aspx).   This means
I'm actually calling Subscription.Close() a total of 4 times.

Here's the chronology
# controller thread: calls RpcServer.Close() -> Subscription.Close() ->
Model.BasicCancel()
# worker thread: throws and catches exceptions in Subscription.Next(),
terminating MainLoop's foreach
# worker thread: calls Subscription.Dispose() -> Subscription.Close() ->
Model.BasicCancel()
# controller thread: completes Model.BasicCancel(), sets some variables
to null
# worker thread: nullref trying to use those variables

I added some Console.WriteLine statements to the Close/Dispose methods,
and that solved the problem, so it's definitely a race condition when
calling Close() from another thread.

I'm going to add a flag and test out calling Close() from various points
in HandleCall/HandleCast/ProcessRequest.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506





From lynton.grice at logosworld.com  Tue Jun  9 19:32:58 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Tue, 9 Jun 2009 20:32:58 +0200
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
	"State = Driver:handshake(InitialState), "
Message-ID: <001901c9e930$bc4ec270$34ec4750$@grice@logosworld.com>

Hi Matthias,

 

One more thing that may be causing an issue on my side is the way I compile
the client into BEAM files...

 

Because I am (unfortunately) using Windows I obviously cannot use the MAKE
file to compile the files, so I am literally going in MANUALLY and compiling
them one by one. 

 

I have tried the following in the command line to compile everything but it
doesn't work....

 

for %i in (src/*.erl) do erlc -o ebin src/%i

 

Then it complains about that it cannot find the "amqp_client.hrl" file....

 



 

So I go change the files to see the file correctly...

 



 

And then I ASSUME it would work with the following command again

 

for %i in (src/*.erl) do erlc -o ebin src/%i

 

But it still has compilation errors....it seems to have an error writing the
BEAM files for some reason

 



 

BUT if I compile them individually they work fine......very weird...

 

So I compile them all and them move the BEAM files into an "ebin"
folder...and that is it......

 



 

Now I test again with this new erlang client....

 



 

And it hangs ;-(

 



 

And here is the latest LOG....

 

=INFO REPORT==== 9-Jun-2009::20:30:20 ===

accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:2364

 

=INFO REPORT==== 9-Jun-2009::20:30:20 ===

starting TCP connection <0.172.0> from 127.0.0.1:2364

 

=ERROR REPORT==== 9-Jun-2009::20:30:30 ===

error on TCP connection <0.172.0> from 127.0.0.1:2364

{handshake_timeout,frame_header}

 

=INFO REPORT==== 9-Jun-2009::20:30:30 ===

closing TCP connection <0.172.0> from 127.0.0.1:2364

 

So I seriously have not idea what to do now.....both the server and the
client are the LATEST I can find...am I compiling things wrong?

 

Any ideas? Thanks again

 

Lynton

 

 

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthias
Radestock
Sent: 09 June 2009 08:00 PM
To: Grice, Lynton (L)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
"State = Driver:handshake(InitialState), "

 

Lynton,

 

Grice, Lynton (L) wrote:

> I have tried to do what you asked for in order for you to understand the

> problem better, forgive me if I misinterpreted one or two things, just

> let me know and I will try again ;-)

 

That all looks fine, BUT ...

 

the reason I asked for this info is so that I could figure out why you

were getting the {undef, [{rabbit_framing_channel,start_link,...}]}

error. It looks like you are no longer getting that error. Is that correct?

 

What's the problem now? Does network_client_test:lifecycle_test() not

return, and you get an {handshake_timeout,frame_header} error in the

server logs?

 

If so, that does look like a version incompatibility problem again,

specifically it appears that you are running a 1.5.5 server, but a

non-1.5.x Erlang client. As I said before, if you are running with a

1.5.5 server, make sure that your version of the Erlang client is from a

1.5.x tag/branch. If that doesn't work for you, please send me a

transcript of the commands you are using to get hold of your copies of

the client and server code.

 

 

Regards,

 

Matthias.

 

_______________________________________________

rabbitmq-discuss mailing list

rabbitmq-discuss at lists.rabbitmq.com

http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/0129140f/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 13142 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/0129140f/attachment.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 4436 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/0129140f/attachment-0001.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 21167 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/0129140f/attachment-0002.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 8427 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/0129140f/attachment-0003.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 5478 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/0129140f/attachment-0004.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 2653 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/0129140f/attachment-0005.png 

From matthias at lshift.net  Tue Jun  9 19:40:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 19:40:00 +0100
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
 "State = Driver:handshake(InitialState), "
In-Reply-To: <001301c9e92d$dd1598b0$9740ca10$@grice@logosworld.com>
References: <001301c9e92d$dd1598b0$9740ca10$@grice@logosworld.com>
Message-ID: <4A2EAC80.3060901@lshift.net>

Lynton,

Lynton Grice wrote:
> From a Windows perspective I will download the files from 
> http://hg.rabbitmq.com/rabbitmq-erlang-client/
> 
> But I will just download the very latest one on top and compile them?

Do *not* use the "latest" version. That's the point I've been trying
(and obviously failing) to make. If you are running a 1.5.5 server you
must use a revision tagged with a 1.5.x tag, or from the v1_5 branch.

If you have mercurial installed, just
  hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
then cd into the rabbitmq-erlang-client directory and list the available
tags with
  hg tags
pick one that fits the bill, rabbitmq_v1_5_5 in this case, and run
  hg update rabbitmq_v1_5_5

See http://www.rabbitmq.com/mercurial.html for an explanation.

Or, alternatively, if you haven't got mercurial installed, look at the
tags visible in the hg web interface, pick a suitable one, and construct
a URL of the form

http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/<tag>.{zip,tar.gz}
e.g.
http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/rabbitmq_v1_5_5.zip

> BTW: How do I tell what version of the client I am running?

Since the Erlang client does not have official releases, the only way to
tell what version you are running is by looking at the revision
information supplied by hg.


Regards,

Matthias.



From matthias at lshift.net  Tue Jun  9 19:45:42 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 19:45:42 +0100
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
 "State = Driver:handshake(InitialState), "
In-Reply-To: <001901c9e930$bc4ec270$34ec4750$@grice@logosworld.com>
References: <001901c9e930$bc4ec270$34ec4750$@grice@logosworld.com>
Message-ID: <4A2EADD6.2060305@lshift.net>

Lynton,

Lynton Grice wrote:
> Because I am (unfortunately) using Windows I obviously cannot use the
> MAKE file to compile the files, so I am literally going in MANUALLY and
> compiling them one by one.

As my colleague Emile explained, you *can* and *should* use the
Makefiles - just install Cygwin.


Regards,

Matthias.



From ryan at acceleration.net  Tue Jun  9 20:05:01 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Tue, 09 Jun 2009 15:05:01 -0400
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A2EA81B.8060303@acceleration.net>
References: <4A292998.3090407@acceleration.net>
	<4A2D70A5.6040907@lshift.net>	<4A2E878E.3000700@acceleration.net>
	<4A2EA81B.8060303@acceleration.net>
Message-ID: <4A2EB25D.10907@acceleration.net>

Ryan Davis wrote:
> I'm going to add a flag and test out calling Close() from various points
> in HandleCall/HandleCast/ProcessRequest.
>   
Wow, I really didn't think that one through. 
HandleCall/HandleCast/ProcessRequest are only called when there is a
message to process.  If there is no message to process, the
SimpleRpcServer is blocked on Subscription.Next(), and will never
exit.   My current test case starts a SimpleRpcServer, then tries to
stop it, without sending any messages.

I changed my code so if the SimpleRpcServer sees a certain byte[]
message (stored as ShutdownKey), it will close itself:

public override void HandleCast(bool isRedelivered, IBasicProperties
requestProperties, byte[] body)
{
  for (var i = 0; i < body.Length; i++) {
     if (body[i] != ShutdownKey[i]) return;
  }
  Close(); //we must have matched, shut down.
}

As I expected, this throws a different exception:
System.InvalidOperationException: Operation is not valid due to the current state of the object.
   at RabbitMQ.Client.MessagePatterns.Subscription.Next() in d:\Projects\rabbitmq-dotnet-client-1.5.3\src\client\messagepatterns\Subscription.cs:line 323
   at RabbitMQ.Client.MessagePatterns.Subscription.System.Collections.IEnumerator.MoveNext() in d:\Projects\rabbitmq-dotnet-client-1.5.3\src\client\messagepatterns\Subscription.cs:line 437
   at RabbitMQ.Client.MessagePatterns.SimpleRpcServer.MainLoop() in d:\Projects\rabbitmq-dotnet-client-1.5.3\src\client\messagepatterns\SimpleRpcServer.cs:line 206

I'm going to start mucking about in SimpleRpcServer.cs/Subscription.cs
to see what's the smalled change I can make to fix it.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506




From 0x6e6562 at gmail.com  Tue Jun  9 21:42:01 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 09 Jun 2009 21:42:01 +0100
Subject: [rabbitmq-discuss] Erlang cllient libs / new_connection()
 results in "error on TCP connection <...> from 127.0.0.1
In-Reply-To: <4A2EC291.3090006@gmx.de>
References: <4A2D69D0.50708@gmx.de> <4A2D7765.70008@gmail.com>
	<4A2EC291.3090006@gmx.de>
Message-ID: <4A2EC919.6050808@gmail.com>

Ingo,

Ingo Kroger wrote:
> Hi,
> thank you for the fast answer.
> That did it for me. I uninstalled the server from the Ubuntu 
> repository (1.5.4), installed the one
> from Debian unstable ( 1.5.5-2 ) and used the client libs tagged as 
> 1.5.5.
> Now the make test_network is working ( "all 13 tests successfull" ) 
> but the logfile
> shows some errors, but I guess I can figure those out by myself ( 
> hopefully :-)
>
I presume that errors in the server log are due to the 2 tests in the 
negative_test_util module which are designed to test negative paths, 
i.e. those that should provoke a server side error.

HTH,

Ben



From matthias at lshift.net  Tue Jun  9 22:47:28 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 22:47:28 +0100
Subject: [rabbitmq-discuss] Erlang cllient libs / new_connection()
 results in "error on TCP connection <...> from 127.0.0.1
In-Reply-To: <4A2EC919.6050808@gmail.com>
References: <4A2D69D0.50708@gmx.de>
	<4A2D7765.70008@gmail.com>	<4A2EC291.3090006@gmx.de>
	<4A2EC919.6050808@gmail.com>
Message-ID: <4A2ED870.8060405@lshift.net>

Ingo,

Ben Hood wrote:
> Ingo Kroger wrote:
>> That did it for me. I uninstalled the server from the Ubuntu 
>> repository (1.5.4), installed the one
>> from Debian unstable ( 1.5.5-2 ) and used the client libs tagged as 
>> 1.5.5.

as an aside, I am pretty sure the 1.5.5 Erlang client libs work with the 
1.5.4 server code base, though I haven't tested that combination. If you 
can confirm this works that would be useful info for folks wanting to 
use the Erlang client but prefer sticking with the 1.5.4 server in jaunty.


Regards,

Matthias.



From ryan at acceleration.net  Tue Jun  9 23:03:33 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Tue, 09 Jun 2009 18:03:33 -0400
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A2EB25D.10907@acceleration.net>
References: <4A292998.3090407@acceleration.net>	<4A2D70A5.6040907@lshift.net>	<4A2E878E.3000700@acceleration.net>	<4A2EA81B.8060303@acceleration.net>
	<4A2EB25D.10907@acceleration.net>
Message-ID: <4A2EDC35.6030201@acceleration.net>

Ok, last one today, I promise.

I solved this problem my adding some explicit locks in Subscription and
SimpleRpcServer.  I tried to checkout the latest source (on linux,
cygwin, and tortoiseHG) but kept getting a zlib error, so this patch is
against the source in rabbitmq-dotnet-client-1.5.3.zip downloaded from
http://www.rabbitmq.com/dotnet.html.

This patch makes SimpleRpcServer.Close threadsafe by adding:

   1. locking SimpleRpcServer.m_subscription around the body of
      SimpleRpcServer.MainLoop's foreach (so we can't close while
      processing)
   2. checking for a null Subscription.Consumer before processing a
      message in SimpleRpcServer.MainLoop, but after we've locked
      m_subscription (to ensure we don't process after we've closed)
   3. locking this around the body of Subscription.Close (to ensure we
      don't close that same subscription at the same time)

I *think* that solves the potential race conditions.  It certainly makes
my tests work, and running "nant unit" on the 1.5.3 source gives 2
failures in TestSharedQueue.cs that look timing-related.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506



Ryan Davis wrote:
> Ryan Davis wrote:
>   
>> I'm going to add a flag and test out calling Close() from various points
>> in HandleCall/HandleCast/ProcessRequest.
>>   
>>     
> Wow, I really didn't think that one through. 
> HandleCall/HandleCast/ProcessRequest are only called when there is a
> message to process.  If there is no message to process, the
> SimpleRpcServer is blocked on Subscription.Next(), and will never
> exit.   My current test case starts a SimpleRpcServer, then tries to
> stop it, without sending any messages.
>
> I changed my code so if the SimpleRpcServer sees a certain byte[]
> message (stored as ShutdownKey), it will close itself:
>
> public override void HandleCast(bool isRedelivered, IBasicProperties
> requestProperties, byte[] body)
> {
>   for (var i = 0; i < body.Length; i++) {
>      if (body[i] != ShutdownKey[i]) return;
>   }
>   Close(); //we must have matched, shut down.
> }
>
> As I expected, this throws a different exception:
> System.InvalidOperationException: Operation is not valid due to the current state of the object.
>    at RabbitMQ.Client.MessagePatterns.Subscription.Next() in d:\Projects\rabbitmq-dotnet-client-1.5.3\src\client\messagepatterns\Subscription.cs:line 323
>    at RabbitMQ.Client.MessagePatterns.Subscription.System.Collections.IEnumerator.MoveNext() in d:\Projects\rabbitmq-dotnet-client-1.5.3\src\client\messagepatterns\Subscription.cs:line 437
>    at RabbitMQ.Client.MessagePatterns.SimpleRpcServer.MainLoop() in d:\Projects\rabbitmq-dotnet-client-1.5.3\src\client\messagepatterns\SimpleRpcServer.cs:line 206
>
> I'm going to start mucking about in SimpleRpcServer.cs/Subscription.cs
> to see what's the smalled change I can make to fix it.
>
> Thanks,
>
> Ryan Davis
> Acceleration.net
> Director of Programming Services
> 2831 NW 41st street, suite B
> Gainesville, FL 32606
>
> Office: 352-335-6500 x 124
> Fax: 352-335-6506
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/a5f582cc/attachment.htm 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: threadsafe-rpcserver.patch
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090609/a5f582cc/attachment.txt 

From matthias at lshift.net  Tue Jun  9 23:30:33 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 09 Jun 2009 23:30:33 +0100
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A2EDC35.6030201@acceleration.net>
References: <4A292998.3090407@acceleration.net>	<4A2D70A5.6040907@lshift.net>	<4A2E878E.3000700@acceleration.net>	<4A2EA81B.8060303@acceleration.net>
	<4A2EB25D.10907@acceleration.net>
	<4A2EDC35.6030201@acceleration.net>
Message-ID: <4A2EE289.3080505@lshift.net>

Ryan,

Ryan Davis wrote:
> I solved this problem my adding some explicit locks in Subscription and 
> SimpleRpcServer.

Thanks for the patch. If you don't mind, we'll look into this in a few 
weeks when the person who wrote the original code is back from holidays.

Some locking is most certainly required if you are going to call Close 
from a separate thread. So the question is whether we should cater for 
this in the first place (based on your findings I am pretty sure we need 
to), and if so whether the locks are in the right place.

On the latter point, the locks look a bit too coarse-grained to me, 
covering activities that can take an indeterminate amount of time, such 
as interactions with the server. That may be unavoidable, but without 
understanding every single detail of the code it's hard to be sure.


Regards,

Matthias.



From lynton.grice at logosworld.com  Wed Jun 10 06:25:08 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Wed, 10 Jun 2009 07:25:08 +0200
Subject: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
	"State = Driver:handshake(InitialState), "
In-Reply-To: <4A2EAC80.3060901@lshift.net>
References: <001301c9e92d$dd1598b0$9740ca10$@grice@logosworld.com>
	<4A2EAC80.3060901@lshift.net>
Message-ID: <000501c9e98b$d5ab0250$810106f0$@grice@logosworld.com>

Hi Matthias,

I guess I *assumed* the Erlang client version would be relatively in-sync
with the server version, that is why I always downloaded the latest ones for
both.

Thanks for all your help on this, it was a pure version issue like you
stated .....it is working now ;-)

Thanks for all your help on this, I really appreciate it ;-)

Lynton

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 09 June 2009 08:40 PM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Erlang RabbitMQ Client hanshake problem on
"State = Driver:handshake(InitialState), "

Lynton,

Lynton Grice wrote:
> From a Windows perspective I will download the files from 
> http://hg.rabbitmq.com/rabbitmq-erlang-client/
> 
> But I will just download the very latest one on top and compile them?

Do *not* use the "latest" version. That's the point I've been trying
(and obviously failing) to make. If you are running a 1.5.5 server you
must use a revision tagged with a 1.5.x tag, or from the v1_5 branch.

If you have mercurial installed, just
  hg clone http://hg.rabbitmq.com/rabbitmq-erlang-client
then cd into the rabbitmq-erlang-client directory and list the available
tags with
  hg tags
pick one that fits the bill, rabbitmq_v1_5_5 in this case, and run
  hg update rabbitmq_v1_5_5

See http://www.rabbitmq.com/mercurial.html for an explanation.

Or, alternatively, if you haven't got mercurial installed, look at the
tags visible in the hg web interface, pick a suitable one, and construct
a URL of the form

http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/<tag>.{zip,tar.gz}
e.g.
http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/rabbitmq_v1_5_5.zip

> BTW: How do I tell what version of the client I am running?

Since the Erlang client does not have official releases, the only way to
tell what version you are running is by looking at the revision
information supplied by hg.


Regards,

Matthias.




From mtodd at highgroove.com  Wed Jun 10 07:20:38 2009
From: mtodd at highgroove.com (Matt Todd)
Date: Wed, 10 Jun 2009 02:20:38 -0400
Subject: [rabbitmq-discuss] Fwd:  Fwd: Objective-C AMQP Library
In-Reply-To: <2a8d4a710906092320i7e84556ay80d8bbdbc0c1e4df@mail.gmail.com>
References: <8018CECC-6BD8-4275-8DA4-7202B1221C84@mac.com>
	<7C2FE79B-D629-4757-A1E6-3F148E9AA3DA@mac.com>
	<2a8d4a710906092320i7e84556ay80d8bbdbc0c1e4df@mail.gmail.com>
Message-ID: <2a8d4a710906092320w557861bbj50bdf10d1f5fc05e@mail.gmail.com>

Hi Chuck,
Wow, great feedback! I will definitely take the opportunity to write a few
of these "spikes", and recommending the actual Cocoa API as inspiration is
so obvious and elegant it hurts!

1. Great!

2. Standard tools sound great. My target audience is primarily Mac platform
apps, and didn't even think of Windows; partly due to my ignorance to Obj-C
on the Windows platform but also because I just haven't used Windows in
several
years. No offense to the users, but I don't care about that platform.
But, I do care enough about the library to want it to remain as simple
as possible,
which should improve the likelihood that it will work across platforms
(unless I do use the Cocoa framework, I guess).

3. See above, but I will definitely take this into consideration. I want a
library that Obj-C devs would use, not some lofty idea I think is the best
(or a great) approach. I love the evented model, and NSNotification seems to
match the ideas, but Delegation in itself is almost like an evented model.
I'm not married to either, though.

4. Is using SenTest discouraged then?

5. Pardon my misspeaking, I meant to say that I should write all of the
components of AMQP, even those parts that include XML parsing (as opposed to
letting the C library do that for me), using a proper XML parser handle that
for me. I'm certainly that last person that should be chosen for writing an
XML parser! :) Also, great suggestion to use C for the networking reactor.
Perhaps even a library like libev or kqueue can be used to create the
evented model I'm fond of? Though, I am speaking out of my zone of expertise
here.

6. As I said before, probably the best suggestion in your stellar email!

7. I may just end up with hundreds of these little "spikes" figuring all of
this out!

There is an article that I have been reading about writing your own AMQP
library which has been informative, though not entirely illuminating
(regarding implementation details). Any specific reading anyone would
recommend for both AMQP protocol implementation as well as Obj-C in general?

Thanks so much for the great feedback and general guidance!

Matt



On Tue, Jun 9, 2009 at 12:24 PM, Chuck Remes <cremes.devlist at mac.com> wrote:

>
> You're lucky in the sense that Obj-C gives you some of the same dynamism as
> Ruby. You should be able to give it a nice wrapper.
>
> I'm not an Obj-C pro by any stretch but I'll take a crack at answering some
> of your questions.
>
> 1. Obj-C is a C superset, so integration is pretty simple. Just
> #include/#import the headers, make sure the correct files are on your path
> and start compiling stuff.
>
> 2. A few suggestions...
> a. Keep the number of external dependencies low (see #5)
>
> b. Use whatever the current standard is for C-based applications which is
> likely autoconf and make. This gets more complicated if you want your
> library to be usable from Windows too.
>
> 3. NSNotification is a Cocoa API so if you use it then you are tying the
> library to OSX (though NSNotification has probably been cloned by the
> GNUstep project). Use the dynamism allowed in Obj-C and use the Delegation
> pattern. If you are familiar with Cocoa at all, it uses delegation all over
> the place. Copy that idea.
>
> 4. Look at OCUnit which is an Obj-C testing framework similar to the old
> XUnit and JUnit frameworks. Ruby's Test::Unit was patterned after that API
> too so it might be familiar to you.
>
> 5. I highly recommend *against* writing common utilities like XML parsing.
> Someone else has already done the job for you so don't reinvent the wheel.
> Make it a project dependency. For an AMQP library I don't think you'll need
> to do this too often. If you really plan to mimic the Ruby AMQP gem, you'll
> want to  see out an embeddable C network server/library that can act as the
> central network reactor.
>
> 6. The largest body of Obj-C code in the world is in the Apple Cocoa API.
> Copy those patterns. You can't really make a DSL like you would in Ruby
> though.
>
> 7. Why not? You might want to write a few "spikes" (small programs that
> prove an idea out... kind of like what you do in irb).
>
> Good luck!
>
> cr
>
>
> On Jun 9, 2009, at 12:19 AM, Matt Todd wrote:
>
> As a new Objective-C developer (just fiddling around with it), I've been
> thinking of a project to get my hands dirty with. I've been using RabbitMQ
> for some time in my Ruby projects and really enjoy using it, and the AMQP
> protocol should be fairly simple to grok and work with.
> Because of this, I'm currently looking to start building an Objective-C
> based client library as a pet project to get me actually working in the
> language.
>
> I'm thinking of using the experimental C language client code to power the
> functionality and giving it a nice Obj-C DSL and handling everything through
> a NSNotificationCenter to create an evented interface (similar to the
> EventMachine Ruby AMQP library I'm used to working with). This is the goal
> for now, anyhow.
>
> Being still very new to the language, and certainly being unfamiliar with
> the idiosyncrasies of developing libraries for Obj-C, I'm looking for input,
> support, and contributions for this endeavor from experts and enthusiasts
> with strong opinions and/or time.
>
> Let me stress my lack of exposure to Obj-C (nor have I done anything
> significant in C/C++ or any strongly typed, compiled language in quite some
> time). This means I'm currently asking the following questions (as noob as
> they may be):
>
> 1. How do I integrate the C library into this Obj-C library?
> 2. How do I write a distributable, clean Obj-C library?
> 3. Is an NSNotificationCenter-based implementation a good approach for an
> evented AMQP library?
> 4. How do I mock objects in Obj-C (to not require an instance of RabbitMQ
> to be running for tests)?
> 5. Should I just write this from scratch, including XML parsing et al?
> 6. What does a good Obj-C DSL look like?
> 7. Why would I start with a significant library to get familiar with the
> language?
>
> Fair warning, I'm a Ruby developer, mainly building web applications in
> Rails.
>
> Looking forward to hearing from you, and hope to get something worthwhile
> out of this.
>
> Matt
>
>
>
> --
> Matt Todd
> Highgroove Studios
> www.highgroove.com
> cell: 404-314-2612
> blog: maraby.org
>
> Scout - Web Monitoring and Reporting Software
> www.scoutapp.com
>  _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Matt Todd
Highgroove Studios
www.highgroove.com
cell: 404-314-2612
blog: maraby.org

Scout - Web Monitoring and Reporting Software
www.scoutapp.com



-- 
Matt Todd
Highgroove Studios
www.highgroove.com
cell: 404-314-2612
blog: maraby.org

Scout - Web Monitoring and Reporting Software
www.scoutapp.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090610/604edefc/attachment.htm 

From cremes.devlist at mac.com  Wed Jun 10 12:30:39 2009
From: cremes.devlist at mac.com (Chuck Remes)
Date: Wed, 10 Jun 2009 06:30:39 -0500
Subject: [rabbitmq-discuss] Fwd:  Fwd: Objective-C AMQP Library
In-Reply-To: <2a8d4a710906092320w557861bbj50bdf10d1f5fc05e@mail.gmail.com>
References: <8018CECC-6BD8-4275-8DA4-7202B1221C84@mac.com>
	<7C2FE79B-D629-4757-A1E6-3F148E9AA3DA@mac.com>
	<2a8d4a710906092320i7e84556ay80d8bbdbc0c1e4df@mail.gmail.com>
	<2a8d4a710906092320w557861bbj50bdf10d1f5fc05e@mail.gmail.com>
Message-ID: <AF65C1BF-7F48-4476-96C6-17753299F553@mac.com>

You're welcome!

4. I don't know anything about SenTest. It might be good; it might be  
bad. <shrug>

5. I was thinking along the lines of libev but someone may have  
already wrapped it in a nice little C API for creating embeddable  
servers. There are lots of projects out there so search around. Good  
places to start looking are github and sourceforge. It's kind of  
outside my zone of expertise too. I primarily write ruby stuff and  
when I need speed I dip into Java now instead of C.

As for general guidance, I would look at the available libraries for  
the various AMQP implementations from Apache, Rabbit, etc. Read  
through the protocol definition for 0-8 and 0-9-1 to get familiar with  
the protocol requirements. Make sure that whatever you create is *not*  
tied to a particular AMQP implementation. One of the best reasons for  
using AMQP is the stated goal of all vendors for perfect  
interoperability. It is achievable so make sure your library doesn't  
undermine that goal.

Have fun...

cr

On Jun 10, 2009, at 1:20 AM, Matt Todd wrote:

> Hi Chuck,
>
> Wow, great feedback! I will definitely take the opportunity to write  
> a few of these "spikes", and recommending the actual Cocoa API as  
> inspiration is so obvious and elegant it hurts!
>
> 1. Great!
>
> 2. Standard tools sound great. My target audience is primarily Mac  
> platform apps, and didn't even think of Windows; partly due to my  
> ignorance to Obj-C on the Windows platform but also because I just  
> haven't used Windows in several years. No offense to the users, but  
> I don't care about that platform. But, I do care enough about the  
> library to want it to remain as simple as possible, which should  
> improve the likelihood that it will work across platforms (unless I  
> do use the Cocoa framework, I guess).
>
> 3. See above, but I will definitely take this into consideration. I  
> want a library that Obj-C devs would use, not some lofty idea I  
> think is the best (or a great) approach. I love the evented model,  
> and NSNotification seems to match the ideas, but Delegation in  
> itself is almost like an evented model. I'm not married to either,  
> though.
>
> 4. Is using SenTest discouraged then?
>
> 5. Pardon my misspeaking, I meant to say that I should write all of  
> the components of AMQP, even those parts that include XML parsing  
> (as opposed to letting the C library do that for me), using a proper  
> XML parser handle that for me. I'm certainly that last person that  
> should be chosen for writing an XML parser! :) Also, great  
> suggestion to use C for the networking reactor. Perhaps even a  
> library like libev or kqueue can be used to create the evented model  
> I'm fond of? Though, I am speaking out of my zone of expertise here.
>
> 6. As I said before, probably the best suggestion in your stellar  
> email!
>
> 7. I may just end up with hundreds of these little "spikes" figuring  
> all of this out!
>
> There is an article that I have been reading about writing your own  
> AMQP library which has been informative, though not entirely  
> illuminating (regarding implementation details). Any specific  
> reading anyone would recommend for both AMQP protocol implementation  
> as well as Obj-C in general?
>
> Thanks so much for the great feedback and general guidance!
>
> Matt
>
>
>
> On Tue, Jun 9, 2009 at 12:24 PM, Chuck Remes  
> <cremes.devlist at mac.com> wrote:
>
> You're lucky in the sense that Obj-C gives you some of the same  
> dynamism as Ruby. You should be able to give it a nice wrapper.
>
> I'm not an Obj-C pro by any stretch but I'll take a crack at  
> answering some of your questions.
>
> 1. Obj-C is a C superset, so integration is pretty simple. Just  
> #include/#import the headers, make sure the correct files are on  
> your path and start compiling stuff.
>
> 2. A few suggestions...
> a. Keep the number of external dependencies low (see #5)
>
> b. Use whatever the current standard is for C-based applications  
> which is likely autoconf and make. This gets more complicated if you  
> want your library to be usable from Windows too.
>
> 3. NSNotification is a Cocoa API so if you use it then you are tying  
> the library to OSX (though NSNotification has probably been cloned  
> by the GNUstep project). Use the dynamism allowed in Obj-C and use  
> the Delegation pattern. If you are familiar with Cocoa at all, it  
> uses delegation all over the place. Copy that idea.
>
> 4. Look at OCUnit which is an Obj-C testing framework similar to the  
> old XUnit and JUnit frameworks. Ruby's Test::Unit was patterned  
> after that API too so it might be familiar to you.
>
> 5. I highly recommend *against* writing common utilities like XML  
> parsing. Someone else has already done the job for you so don't  
> reinvent the wheel. Make it a project dependency. For an AMQP  
> library I don't think you'll need to do this too often. If you  
> really plan to mimic the Ruby AMQP gem, you'll want to  see out an  
> embeddable C network server/library that can act as the central  
> network reactor.
>
> 6. The largest body of Obj-C code in the world is in the Apple Cocoa  
> API. Copy those patterns. You can't really make a DSL like you would  
> in Ruby though.
>
> 7. Why not? You might want to write a few "spikes" (small programs  
> that prove an idea out... kind of like what you do in irb).
>
> Good luck!
>
> cr
>
>
> On Jun 9, 2009, at 12:19 AM, Matt Todd wrote:
>
>> As a new Objective-C developer (just fiddling around with it), I've  
>> been thinking of a project to get my hands dirty with. I've been  
>> using RabbitMQ for some time in my Ruby projects and really enjoy  
>> using it, and the AMQP protocol should be fairly simple to grok and  
>> work with.
>>
>> Because of this, I'm currently looking to start building an  
>> Objective-C based client library as a pet project to get me  
>> actually working in the language.
>>
>> I'm thinking of using the experimental C language client code to  
>> power the functionality and giving it a nice Obj-C DSL and handling  
>> everything through a NSNotificationCenter to create an evented  
>> interface (similar to the EventMachine Ruby AMQP library I'm used  
>> to working with). This is the goal for now, anyhow.
>>
>> Being still very new to the language, and certainly being  
>> unfamiliar with the idiosyncrasies of developing libraries for Obj- 
>> C, I'm looking for input, support, and contributions for this  
>> endeavor from experts and enthusiasts with strong opinions and/or  
>> time.
>>
>> Let me stress my lack of exposure to Obj-C (nor have I done  
>> anything significant in C/C++ or any strongly typed, compiled  
>> language in quite some time). This means I'm currently asking the  
>> following questions (as noob as they may be):
>>
>> 1. How do I integrate the C library into this Obj-C library?
>> 2. How do I write a distributable, clean Obj-C library?
>> 3. Is an NSNotificationCenter-based implementation a good approach  
>> for an evented AMQP library?
>> 4. How do I mock objects in Obj-C (to not require an instance of  
>> RabbitMQ to be running for tests)?
>> 5. Should I just write this from scratch, including XML parsing et  
>> al?
>> 6. What does a good Obj-C DSL look like?
>> 7. Why would I start with a significant library to get familiar  
>> with the language?
>>
>> Fair warning, I'm a Ruby developer, mainly building web  
>> applications in Rails.
>>
>> Looking forward to hearing from you, and hope to get something  
>> worthwhile out of this.
>>
>> Matt
>>
>>
>>
>> -- 
>> Matt Todd
>> Highgroove Studios
>> www.highgroove.com
>> cell: 404-314-2612
>> blog: maraby.org
>>
>> Scout - Web Monitoring and Reporting Software
>> www.scoutapp.com
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> -- 
> Matt Todd
> Highgroove Studios
> www.highgroove.com
> cell: 404-314-2612
> blog: maraby.org
>
> Scout - Web Monitoring and Reporting Software
> www.scoutapp.com
>
>
>
> -- 
> Matt Todd
> Highgroove Studios
> www.highgroove.com
> cell: 404-314-2612
> blog: maraby.org
>
> Scout - Web Monitoring and Reporting Software
> www.scoutapp.com
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090610/23510ace/attachment.htm 

From majek04 at gmail.com  Wed Jun 10 13:29:10 2009
From: majek04 at gmail.com (majek04)
Date: Wed, 10 Jun 2009 13:29:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
In-Reply-To: <200906072340.23972.nico@rakar.com>
References: <200906072340.23972.nico@rakar.com>
Message-ID: <3bb0d9710906100529p712af8c7ue1c962acc0674d7c@mail.gmail.com>

On Mon, Jun 8, 2009 at 03:40, Nicolas Echaniz<nico at rakar.com> wrote:
> I found out that this was the RabbitMQ interpretation of how the broker should
> behave by reading some docs in your site[3] and a thread in your mailing
> list[4].
>
> This lead me to re-read the STOMP Protocol spec[6] and judjing from the
> different clients code I've looked at it looks like everyone else's
> understanding of this paragraph:
>
> ... is that if a client has subscribed to a destination, then it should
> receive every message that is sent to that destination - what you call
> "broadcast" behaviour in your docs.
>
> So now I'm writing here because it seems to me rather odd that every STOMP
> client code should be modified to be able to send extra-headers to RabbitMQ
> when they seem to be correctly implementing their STOMP Clients according to
> the spec.

As far as I understand, rabbit-stomp gateway implements
a subset of AMQP features - but over a STOMP protocol.

For example a STOMP 'destination' is treated as an AMQP 'queue',
but this abstractions represent slightly different thing.


As Matthias pointed out, STOMP spec doesn't give much information
of what the defaults should be. The problem is that even if changing
the defaults is easy, we must take care of all the other use cases.

Right now the default behavior is sane from the AMQP
point of view. Later you can get any kind of behavior you want
by playing with the extra parameters.

Marek Majkowski



From ryan at acceleration.net  Wed Jun 10 14:07:24 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Wed, 10 Jun 2009 09:07:24 -0400
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A2EE289.3080505@lshift.net>
References: <4A292998.3090407@acceleration.net>	<4A2D70A5.6040907@lshift.net>	<4A2E878E.3000700@acceleration.net>	<4A2EA81B.8060303@acceleration.net>
	<4A2EB25D.10907@acceleration.net>
	<4A2EDC35.6030201@acceleration.net> <4A2EE289.3080505@lshift.net>
Message-ID: <4A2FB00C.8010006@acceleration.net>

Matthias Radestock wrote:
> Thanks for the patch. If you don't mind, we'll look into this in a few
> weeks when the person who wrote the original code is back from holidays.
Certainly.  I'll put my patch into production today, and will send you a
new patch if I run into problems.

> On the latter point, the locks look a bit too coarse-grained to me,
> covering activities that can take an indeterminate amount of time,
> such as interactions with the server. That may be unavoidable, but
> without understanding every single detail of the code it's hard to be
> sure.
They are a bit heavy-handed.  It is very possible that Subscription /
SimpleRpcServer could be refactored to maintain thread safety with finer
locks.  I was wanting to make minimal changes, so I didn't go that
route.   I walked through it with another co-worker for a sanity check,
and locking those large blocks seemed the only way to ensure correctness
in these cases:

   1. calling Close() while the subscription is blocked waiting for a
      message
   2. calling Close() while the server is processing a message
   3. calling Close() after the subscription has fetched a message but
      before the server has started processing it

I'm looking forward to hearing from the original author next month.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090610/e9d87451/attachment.htm 

From matthias at lshift.net  Wed Jun 10 17:35:29 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 10 Jun 2009 17:35:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
In-Reply-To: <af1bce590906090806v417c5d6ftca82b722658cba4b@mail.gmail.com>
References: <200906072340.23972.nico@rakar.com> <4A2DEE7D.3030409@lshift.net>
	<af1bce590906090806v417c5d6ftca82b722658cba4b@mail.gmail.com>
Message-ID: <4A2FE0D1.1080005@lshift.net>

Gavin,

Gavin M. Roy wrote:
> I change this auto-delete = false in the code before compilation to
> mirror ActiveMQ behavior.
> [...]
> the biggest issue I had to overcome was the concept that one has to
> subscribe to a queue in order to set the default behavior for it.

>From your and other peoples' comments I gather that with the default
behaviour it should be possible to SEND messages to a destination even
when there are no (and never have been any) subscribers for that
destination. The messages should be queued and delivered to future
clients when they subsequently SUBSCRIBE to that destination.

Correct?

If so then the challenge we face in implementing that behaviour on top
of AMQP is that the only place messages get stored in AMQP is in queues,
and that these queues need to be created explicitly and, with the
exception of exclusive and auto-delete queues, destroyed explicitly.

Currently the STOMP adapter only declares queues on SUBSCRIBE. We could
change it so it also declares them on SEND. AMQP's queue.declare is
idempotent, so this should work fine but there is a performance penalty.

With that change in place messages will get queued w/o the need to have
a subscription first.

Now, declaring queues implicitly on SEND and SUBSCRIBE is all very well,
but how & when do we get rid of them? Setting "auto-delete = false" has
the unfortunate side effect of the queues sticking around forever, even
when they have no messages or subscribers. That does not matter much if
there are a finite and small(ish) number of possible destinations. But
when there are many destinations, only some of which are in use at any
given time, then server resources can be exhausted.

I can think of various approaches to address this problem, but none are
very pleasant.


Matthias.



From andrius.norkaitis at oryo.lt  Wed Jun 10 17:37:56 2009
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Wed, 10 Jun 2009 19:37:56 +0300
Subject: [rabbitmq-discuss] RabbitMQ .NET Client sometimes hangs up
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAMgAzF7zxkFFiJDSTPEON2ABAAAAAA==@oryo.lt>

Hello,

Here is out client code (business logic removed). It's interesting that client disconnects and reconnects 2-5 times a day, but hangs much rarely. Perhaps something related to rabbitmq .CreateConnection method freezes the thread, but we need to dig deeper into the rabbit source to find a problem.

Thanks.

Andrius


-----Original Message-----
From: Ryan Davis [mailto:ryan at acceleration.net]
Sent: Monday, June 08, 2009 5:21 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [Spam] [rabbitmq-discuss] RabbitMQ .NET Client sometimes hangs up

Would it be possible to post your code?  I use the .NET client in a similar way, spawning many threads each calling CreateConnection.  I've simulated network problems by restarting my RabbitMQ server, and I see the .NET client throwing exceptions when it fails.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506



Andrius Norkaitis wrote:
> I think no. All rabbit code is in try/catch and nothing is logged in catch statement. Otherwise, if .net rabbit client method CreateConnection does some asynchronous stuff (haven't watch at a source deeply), errors may not be caught and in this case thread may halt, I think.
>
> -----Original Message-----
> From: Ryan Davis [mailto:ryan at acceleration.net]
> Sent: Monday, June 08, 2009 4:06 PM
> To: Andrius Norkaitis
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [Spam] [rabbitmq-discuss] RabbitMQ .NET Client sometimes 
> hangs up
>
> Is the thread throwing an exception before it halts?
>
> Thanks,
>
> Ryan Davis
> Acceleration.net
> Director of Programming Services
> 2831 NW 41st street, suite B
> Gainesville, FL 32606
>
> Office: 352-335-6500 x 124
> Fax: 352-335-6506
>
>
>
> Andrius Norkaitis wrote:
>   
>> Hello,
>>
>> I can?t find the problem and how to fix it so your help would be very appreciated.
>>
>> Our .net client starts new thread which loops calling ConnectAndListen method (loop is for automatic reconnect). In ConnectAndListen method we create new connection and model, bind to queries and listen for messages ("foreach (BasicDeliverEventArgs ee in subscription)").
>>
>> Everything works like it has, but for sometimes unknown reason sometime client does not reconnect and hangs. It's not always and depends on network disturbances, so can?t easily debug. What I figured out, that thread halts after this statement is called: 
>>
>> using (conn = cf.CreateConnection(serverAddress))
>>
>>
>> Any thoughts what can cause it and how to fix it?
>>
>>
>> Best regards
>> Andrius
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>   
>>     
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rabbit.cs
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090610/a52a034f/attachment.txt 

From aaron.feng at gmail.com  Wed Jun 10 18:05:14 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Wed, 10 Jun 2009 13:05:14 -0400
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
Message-ID: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>

I noticed if I spin up around 500 threads and give it the following function:

public static void DoWork() {
  try {
    var factory = new ConnectionFactory();
    var param = factory.Parameters;
    param.RequestedHeartbeat = 100;
    using (var conn = factory.CreateConnection(server)) {
      using (var ch = conn.CreateModel()) {
        for (int i = 0; i < times; i++) ch.BasicPublish(exchange,
routingKey, null, data);
      }
    }
  }
  catch(Exception ex) {
    Console.WriteLine(ex.Message);
  }
}

Some of the threads would bomb with
RabbitMQ.Client.Exceptions.BrokerUnreachableException: "None of the
specified endpoints were reachable".  I can reproduce this behaviour
consistently with lots of threads.  Is my test valid?  Am I doing
something obviously wrong?  Mostly I'm just trying to see what type of
errors could crop up when the broker is under load.

I'm using the current released .NET client on Windows and broker from
hg 1054:fce2dad390ee running on Ubuntu.

Thanks,

Aaron



From matthias at lshift.net  Wed Jun 10 18:26:59 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 10 Jun 2009 18:26:59 +0100
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>
Message-ID: <4A2FECE3.6030408@lshift.net>

Aaron,

Aaron Feng wrote:
> I noticed if I spin up around 500 threads and give it the following function:
> 
> public static void DoWork() {
>   try {
>     var factory = new ConnectionFactory();
>     var param = factory.Parameters;
>     param.RequestedHeartbeat = 100;
>     using (var conn = factory.CreateConnection(server)) {
>       using (var ch = conn.CreateModel()) {
>         for (int i = 0; i < times; i++) ch.BasicPublish(exchange,
> routingKey, null, data);
>       }
>     }
>   }
>   catch(Exception ex) {
>     Console.WriteLine(ex.Message);
>   }
> }
> 
> Some of the threads would bomb with
> RabbitMQ.Client.Exceptions.BrokerUnreachableException: "None of the
> specified endpoints were reachable".  I can reproduce this behaviour
> consistently with lots of threads.  Is my test valid?

Does ToString on the BrokerUnreachableException provide any clues?

Is there anything noteworthy in the server logs?


Regards,

Matthias.



From gmr at myyearbook.com  Wed Jun 10 18:26:35 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 10 Jun 2009 13:26:35 -0400
Subject: [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
In-Reply-To: <4A2FE0D1.1080005@lshift.net>
References: <200906072340.23972.nico@rakar.com> <4A2DEE7D.3030409@lshift.net>
	<af1bce590906090806v417c5d6ftca82b722658cba4b@mail.gmail.com>
	<4A2FE0D1.1080005@lshift.net>
Message-ID: <af1bce590906101026h2b64436dy7e791fd6ad9a4ec8@mail.gmail.com>

On Wed, Jun 10, 2009 at 12:35 PM, Matthias Radestock <matthias at lshift.net>wrote:

> From your and other peoples' comments I gather that with the default
> behaviour it should be possible to SEND messages to a destination even
> when there are no (and never have been any) subscribers for that
> destination. The messages should be queued and delivered to future
> clients when they subsequently SUBSCRIBE to that destination.
>
> Correct?


Yes


> Now, declaring queues implicitly on SEND and SUBSCRIBE is all very well,
> but how & when do we get rid of them? Setting "auto-delete = false" has
> the unfortunate side effect of the queues sticking around forever, even
> when they have no messages or subscribers. That does not matter much if
> there are a finite and small(ish) number of possible destinations. But
> when there are many destinations, only some of which are in use at any
> given time, then server resources can be exhausted.
>
> I can think of various approaches to address this problem, but none are
> very pleasant.


How about defaulting to auto-delete = true, but allowing one to override it
in rabbitmq.conf:

        -rabbit
           stomp_listeners [{"0.0.0.0",61613}]
           queue_default_parameters [{"auto-delete: false"}]
           extra_startup_steps
[{"STOMP-listeners",rabbit_stomp,kickstart,[]}]

Or something along those lines?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090610/163a3b1f/attachment.htm 

From aaron.feng at gmail.com  Wed Jun 10 18:48:25 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Wed, 10 Jun 2009 13:48:25 -0400
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4A2FECE3.6030408@lshift.net>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>
	<4A2FECE3.6030408@lshift.net>
Message-ID: <4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>

Matthias,

Below is the ToString():

None of the specified endpoints were reachable
Endpoints attempted:
 endpoint=amqp-0-8://10.12.0.190:5672, attempts=1, outcome=The AMQP
operation w
as interrupted: AMQP close-reason, initiated by Library, code=0, text="End
of st
ream", classId=0, methodId=0, cause=System.IO.EndOfStreamException: Unable
to re
ad beyond the end of the stream.
  at System.IO.__Error.EndOfFile()
  at System.IO.BinaryReader.ReadByte()
  at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)
  at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()
  at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()
  at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()
Stack trace:
  at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects,
Amq
pTcpEndpoint[] endpoints)
  at RabbitMQ.Client.ConnectionFactory.CreateConnection(AmqpTcpEndpoint[]
endpo
ints)
  at RabbitMQ.Client.ConnectionFactory.CreateConnection(String address)
  at RabbitTest.Program.DoWork() in
C:\Development\RabbitTest\RabbitTest\Progra
m.cs:line 65

I also looked in the rabbit.log, nothing interesting.

Any thoughts?

Aaron

On Wed, Jun 10, 2009 at 1:26 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Aaron,
>
> Aaron Feng wrote:
> > I noticed if I spin up around 500 threads and give it the following
> function:
> >
> > public static void DoWork() {
> >   try {
> >     var factory = new ConnectionFactory();
> >     var param = factory.Parameters;
> >     param.RequestedHeartbeat = 100;
> >     using (var conn = factory.CreateConnection(server)) {
> >       using (var ch = conn.CreateModel()) {
> >         for (int i = 0; i < times; i++) ch.BasicPublish(exchange,
> > routingKey, null, data);
> >       }
> >     }
> >   }
> >   catch(Exception ex) {
> >     Console.WriteLine(ex.Message);
> >   }
> > }
> >
> > Some of the threads would bomb with
> > RabbitMQ.Client.Exceptions.BrokerUnreachableException: "None of the
> > specified endpoints were reachable".  I can reproduce this behaviour
> > consistently with lots of threads.  Is my test valid?
>
> Does ToString on the BrokerUnreachableException provide any clues?
>
> Is there anything noteworthy in the server logs?
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090610/83dc181c/attachment.htm 

From matthias at lshift.net  Wed Jun 10 19:15:14 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 10 Jun 2009 19:15:14 +0100
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>	<4A2FECE3.6030408@lshift.net>
	<4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>
Message-ID: <4A2FF832.2050201@lshift.net>

Aaron,

Aaron Feng wrote:
> Below is the ToString():
> 
> None of the specified endpoints were reachable
> Endpoints attempted:
>  endpoint=amqp-0-8://10.12.0.190:5672 <http://10.12.0.190:5672/>,
> attempts=1, outcome=The AMQP operation w
> as interrupted: AMQP close-reason, initiated by Library, code=0,
> text="End of st
> ream", classId=0, methodId=0, cause=System.IO.
> EndOfStreamException: Unable to re
> ad beyond the end of the stream.
>   at System.IO.__Error.EndOfFile()
>   at System.IO.BinaryReader.ReadByte()
>   at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)
>   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()
>   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()
>   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()
> Stack trace:
>   at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
> maxRedirects, Amq
> pTcpEndpoint[] endpoints)
>   at
> RabbitMQ.Client.ConnectionFactory.CreateConnection(AmqpTcpEndpoint[] endpo
> ints)
>   at RabbitMQ.Client.ConnectionFactory.CreateConnection(String address)
>   at RabbitTest.Program.DoWork() in
> C:\Development\RabbitTest\RabbitTest\Progra
> m.cs:line 65
> 
> I also looked in the rabbit.log, nothing interesting.

That looks like the server is dropping the connection, in which case
there really should be something in the server logs. How many "accepted
TCP connection", "starting TCP connection" and "closing TCP connection"
messages do you get for a typical test run? And are there really no
warnings or errors?

It is possible that the server is simply too busy draining messages from
your few hundred publish-as-fast-as-I-can channels.


Matthias.



From matthias at lshift.net  Wed Jun 10 19:17:19 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 10 Jun 2009 19:17:19 +0100
Subject: [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
In-Reply-To: <af1bce590906101026h2b64436dy7e791fd6ad9a4ec8@mail.gmail.com>
References: <200906072340.23972.nico@rakar.com>
	<4A2DEE7D.3030409@lshift.net>	<af1bce590906090806v417c5d6ftca82b722658cba4b@mail.gmail.com>	<4A2FE0D1.1080005@lshift.net>
	<af1bce590906101026h2b64436dy7e791fd6ad9a4ec8@mail.gmail.com>
Message-ID: <4A2FF8AF.7030909@lshift.net>

Gavin,

Gavin M. Roy wrote:
> How about defaulting to auto-delete = true, but allowing one to override
> it in rabbitmq.conf:
> 
>         -rabbit
>            stomp_listeners [{"0.0.0.0",61613}]
>            queue_default_parameters [{"auto-delete: false"}]
>            extra_startup_steps
> [{"STOMP-listeners",rabbit_stomp,kickstart,[]}]

IMO auto-delete=true gives undesirable results when queues are created
implicitly on SEND - messages would be queued until the first subscriber
arrives, but if that subscriber disappears before it has received all
the queued messages then the remaining messages are lost.

OTOH, auto-delete=false forces the user to step outside the confines of
STOMP and use ordinary AMQP operations if they ever want to delete the
implicitly created queues and thus free up server resources.


Matthias.



From zubacdragan at gmail.com  Wed Jun 10 20:04:54 2009
From: zubacdragan at gmail.com (Dragan Zubac)
Date: Wed, 10 Jun 2009 21:04:54 +0200
Subject: [rabbitmq-discuss] Queue + "sequencer"
Message-ID: <4A3003D6.2020509@gmail.com>

Hello

I was just wondering if anybody has experienced issue with various queue 
mechanism and need to specify a unique sequence/id in that same queue ? 
Is standard practice to use some external 'sequence generator' or 
so,obtain an id and then insert it into queue,or there's any internal 
mechanism where You may insert Your data into queue and the queue 
server/manager/whatever will give You back the unique sequence/id of 
that exact message in the queue ?

Hm,hope You understand my question,sorry if it's unclear or so.

Sincerely

Dragan Zubac



From aaron.feng at gmail.com  Wed Jun 10 20:34:06 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Wed, 10 Jun 2009 15:34:06 -0400
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4A2FF832.2050201@lshift.net>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>
	<4A2FECE3.6030408@lshift.net>
	<4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>
	<4A2FF832.2050201@lshift.net>
Message-ID: <4e3934860906101234g1abda03bx2c808a198b714672@mail.gmail.com>

Matthias.

For 500 threads:

accepted: 501
starting: 501
closed: 501

I didn't see any errors in the rabbit.log, but the client blew up.

Aaron

On Wed, Jun 10, 2009 at 2:15 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Aaron,
>
> Aaron Feng wrote:
>> Below is the ToString():
>>
>> None of the specified endpoints were reachable
>> Endpoints attempted:
>> ?endpoint=amqp-0-8://10.12.0.190:5672 <http://10.12.0.190:5672/>,
>> attempts=1, outcome=The AMQP operation w
>> as interrupted: AMQP close-reason, initiated by Library, code=0,
>> text="End of st
>> ream", classId=0, methodId=0, cause=System.IO.
>> EndOfStreamException: Unable to re
>> ad beyond the end of the stream.
>> ? at System.IO.__Error.EndOfFile()
>> ? at System.IO.BinaryReader.ReadByte()
>> ? at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)
>> ? at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()
>> ? at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()
>> ? at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()
>> Stack trace:
>> ? at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
>> maxRedirects, Amq
>> pTcpEndpoint[] endpoints)
>> ? at
>> RabbitMQ.Client.ConnectionFactory.CreateConnection(AmqpTcpEndpoint[] endpo
>> ints)
>> ? at RabbitMQ.Client.ConnectionFactory.CreateConnection(String address)
>> ? at RabbitTest.Program.DoWork() in
>> C:\Development\RabbitTest\RabbitTest\Progra
>> m.cs:line 65
>>
>> I also looked in the rabbit.log, nothing interesting.
>
> That looks like the server is dropping the connection, in which case
> there really should be something in the server logs. How many "accepted
> TCP connection", "starting TCP connection" and "closing TCP connection"
> messages do you get for a typical test run? And are there really no
> warnings or errors?
>
> It is possible that the server is simply too busy draining messages from
> your few hundred publish-as-fast-as-I-can channels.
>
>
> Matthias.
>



From matthias at lshift.net  Wed Jun 10 20:53:21 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 10 Jun 2009 20:53:21 +0100
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4e3934860906101234g1abda03bx2c808a198b714672@mail.gmail.com>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>	<4A2FECE3.6030408@lshift.net>	<4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>	<4A2FF832.2050201@lshift.net>
	<4e3934860906101234g1abda03bx2c808a198b714672@mail.gmail.com>
Message-ID: <4A300F31.2090908@lshift.net>

Aaron,

Aaron Feng wrote:
> For 500 threads:
> 
> accepted: 501
> starting: 501
> closed: 501
> 
> I didn't see any errors in the rabbit.log, but the client blew up.

In which case this sounds more like a client-side problem. Could be the 
client lib, or perhaps the O/S or built-in firewall are doing something 
weird. Might be worth running the same test under mono from a Linux machine.

Matthias.



From cremes.devlist at mac.com  Wed Jun 10 20:57:15 2009
From: cremes.devlist at mac.com (Chuck Remes)
Date: Wed, 10 Jun 2009 14:57:15 -0500
Subject: [rabbitmq-discuss] Queue + "sequencer"
In-Reply-To: <4A3003D6.2020509@gmail.com>
References: <4A3003D6.2020509@gmail.com>
Message-ID: <A3120D32-ADD3-4106-B6B8-75D83B4DA6DB@mac.com>


On Jun 10, 2009, at 2:04 PM, Dragan Zubac wrote:

> Hello
>
> I was just wondering if anybody has experienced issue with various  
> queue
> mechanism and need to specify a unique sequence/id in that same  
> queue ?
> Is standard practice to use some external 'sequence generator' or
> so,obtain an id and then insert it into queue,or there's any internal
> mechanism where You may insert Your data into queue and the queue
> server/manager/whatever will give You back the unique sequence/id of
> that exact message in the queue ?

Dragan,

take a look through the rabbitmq mail archives for "sequence." I asked  
this same question on Dec 29, 2008 and got some answers.

cr




From aaron.feng at gmail.com  Wed Jun 10 21:00:14 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Wed, 10 Jun 2009 16:00:14 -0400
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4A300F31.2090908@lshift.net>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>
	<4A2FECE3.6030408@lshift.net>
	<4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>
	<4A2FF832.2050201@lshift.net>
	<4e3934860906101234g1abda03bx2c808a198b714672@mail.gmail.com>
	<4A300F31.2090908@lshift.net>
Message-ID: <4e3934860906101300p465e0637ped3dc20eaf2553e1@mail.gmail.com>

Matthias,

Steve ran the exact same code on mono under OSX.  He also encountered
some errors on the client side.  He will be joining this thread soon.

Thanks,

Aaron

On Wed, Jun 10, 2009 at 3:53 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Aaron,
>
> Aaron Feng wrote:
>>
>> For 500 threads:
>>
>> accepted: 501
>> starting: 501
>> closed: 501
>>
>> I didn't see any errors in the rabbit.log, but the client blew up.
>
> In which case this sounds more like a client-side problem. Could be the
> client lib, or perhaps the O/S or built-in firewall are doing something
> weird. Might be worth running the same test under mono from a Linux machine.
>
> Matthias.
>



From matthias at lshift.net  Wed Jun 10 21:14:51 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 10 Jun 2009 21:14:51 +0100
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4e3934860906101300p465e0637ped3dc20eaf2553e1@mail.gmail.com>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>	<4A2FECE3.6030408@lshift.net>	<4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>	<4A2FF832.2050201@lshift.net>	<4e3934860906101234g1abda03bx2c808a198b714672@mail.gmail.com>	<4A300F31.2090908@lshift.net>
	<4e3934860906101300p465e0637ped3dc20eaf2553e1@mail.gmail.com>
Message-ID: <4A30143B.8030202@lshift.net>

Aaron,

Aaron Feng wrote:
> Steve ran the exact same code on mono under OSX.  He also encountered
> some errors on the client side.

Interesting.

Another data point worth gathering is what happens when your threads 
don't publish messages but just sleep instead.


Matthias.



From aaron.feng at gmail.com  Wed Jun 10 21:57:51 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Wed, 10 Jun 2009 16:57:51 -0400
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4A30143B.8030202@lshift.net>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>
	<4A2FECE3.6030408@lshift.net>
	<4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>
	<4A2FF832.2050201@lshift.net>
	<4e3934860906101234g1abda03bx2c808a198b714672@mail.gmail.com>
	<4A300F31.2090908@lshift.net>
	<4e3934860906101300p465e0637ped3dc20eaf2553e1@mail.gmail.com>
	<4A30143B.8030202@lshift.net>
Message-ID: <4e3934860906101357t28b305ddk8bf80742df93d613@mail.gmail.com>

Matthias,

ok, I took out the for loop and replaced it with sleep for 500msec
(assuming that is long enough?).  It ran fine, I tried it a few times.

Aaron

On Wed, Jun 10, 2009 at 4:14 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Aaron,
>
> Aaron Feng wrote:
>>
>> Steve ran the exact same code on mono under OSX. ?He also encountered
>> some errors on the client side.
>
> Interesting.
>
> Another data point worth gathering is what happens when your threads don't
> publish messages but just sleep instead.
>
>
> Matthias.
>



From matthias at lshift.net  Wed Jun 10 22:12:02 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 10 Jun 2009 22:12:02 +0100
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4e3934860906101357t28b305ddk8bf80742df93d613@mail.gmail.com>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>	<4A2FECE3.6030408@lshift.net>	<4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>	<4A2FF832.2050201@lshift.net>	<4e3934860906101234g1abda03bx2c808a198b714672@mail.gmail.com>	<4A300F31.2090908@lshift.net>	<4e3934860906101300p465e0637ped3dc20eaf2553e1@mail.gmail.com>	<4A30143B.8030202@lshift.net>
	<4e3934860906101357t28b305ddk8bf80742df93d613@mail.gmail.com>
Message-ID: <4A3021A2.2000509@lshift.net>

Aaron,

Aaron Feng wrote:
> ok, I took out the for loop and replaced it with sleep for 500msec
> (assuming that is long enough?).  It ran fine, I tried it a few times.

I'll try to reproduce the problem. Can you send through the complete 
code, please?


Matthias.



From markkicks at gmail.com  Thu Jun 11 02:10:35 2009
From: markkicks at gmail.com (mark)
Date: Wed, 10 Jun 2009 18:10:35 -0700
Subject: [rabbitmq-discuss] rabbitmq stomp 1.5.3 version error
In-Reply-To: <49ABBF51.3020708@lshift.net>
References: <82fa9e310903011052v6aa07269v4e5e10ff3795cd1f@mail.gmail.com>
	<49ABBF51.3020708@lshift.net>
Message-ID: <82fa9e310906101810x27420277q800f01104ec69119@mail.gmail.com>

Hi Tony,
Im trying to upgrade to the latest version of rabbitmq and stomp.
Should I use the hg version or the 1.5.5 version on the website? Which
is best for stomp? Please advise.
thank you


On Mon, Mar 2, 2009 at 4:13 AM, Tony Garnock-Jones<tonyg at lshift.net> wrote:
> Hi Mark,
>
> mark wrote:
>> i had rabbitmq stomp working. i upgraded to the latest 1.5.3 and i get
>> this error
>
> Are you sure you're on the rabbitmq_v1_5_3 tag for the rabbitmq-stomp
> module?
>
> This sequence works for me:
>
> hg clone http://hg.rabbitmq.com/rabbitmq-server
> hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> hg clone http://hg.rabbitmq.com/rabbitmq-stomp
> (cd rabbitmq-server; hg up rabbitmq_v1_5_3)
> (cd rabbitmq-codegen; hg up rabbitmq_v1_5_3)
> (cd rabbitmq-stomp; hg up rabbitmq_v1_5_3)
> make -C rabbitmq-server
> make -C rabbitmq-stomp run
>
> Regards,
> ?Tony
> --
> ?[][][] Tony Garnock-Jones ? ? | Mob: +44 (0)7905 974 211
> ? [][] LShift Ltd ? ? ? ? ? ? | Tel: +44 (0)20 7729 7060
> ?[] ?[] http://www.lshift.net/ | Email: tonyg at lshift.net
>



From matthias at lshift.net  Thu Jun 11 04:55:21 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 11 Jun 2009 04:55:21 +0100
Subject: [rabbitmq-discuss] rabbitmq stomp 1.5.3 version error
In-Reply-To: <82fa9e310906101810x27420277q800f01104ec69119@mail.gmail.com>
References: <82fa9e310903011052v6aa07269v4e5e10ff3795cd1f@mail.gmail.com>	<49ABBF51.3020708@lshift.net>
	<82fa9e310906101810x27420277q800f01104ec69119@mail.gmail.com>
Message-ID: <4A308029.5030009@lshift.net>

Mark,

mark wrote:
> Im trying to upgrade to the latest version of rabbitmq and stomp.
> Should I use the hg version or the 1.5.5 version on the website? Which
> is best for stomp? Please advise.

That depends on what you mean by "latest".

The latest *official release* of the server is 1.5.5, with which you 
should use the 'rabbitmq_v1_5_5' - tagged version of the stomp adapter 
in hg.

Or you can switch to the latest *development* version of both by using 
the 'default' branch in hg for both the server and stomp adapter (and 
the dependent codegen module).


Matthias.



From nico at rakar.com  Thu Jun 11 07:06:49 2009
From: nico at rakar.com (Nicolas Echaniz)
Date: Thu, 11 Jun 2009 03:06:49 -0300
Subject: [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
In-Reply-To: <3bb0d9710906100529p712af8c7ue1c962acc0674d7c@mail.gmail.com>
References: <200906072340.23972.nico@rakar.com>
	<3bb0d9710906100529p712af8c7ue1c962acc0674d7c@mail.gmail.com>
Message-ID: <200906110306.49582.nico@rakar.com>

On Wednesday 10 June 2009 09:29:10 you wrote:
> On Mon, Jun 8, 2009 at 03:40, Nicolas Echaniz<nico at rakar.com> wrote:
> > This lead me to re-read the STOMP Protocol spec[6] and judjing from the
> > different clients code I've looked at it looks like everyone else's
> > understanding of this paragraph:
> >
> > ... is that if a client has subscribed to a destination, then it should
> > receive every message that is sent to that destination - what you call
> > "broadcast" behaviour in your docs.
> >
> > So now I'm writing here because it seems to me rather odd that every
> > STOMP client code should be modified to be able to send extra-headers to
> > RabbitMQ when they seem to be correctly implementing their STOMP Clients
> > according to the spec.
>
> As far as I understand, rabbit-stomp gateway implements
> a subset of AMQP features - but over a STOMP protocol.
>
> For example a STOMP 'destination' is treated as an AMQP 'queue',
> but this abstractions represent slightly different thing.
>
>
> As Matthias pointed out, STOMP spec doesn't give much information
> of what the defaults should be. The problem is that even if changing
> the defaults is easy, we must take care of all the other use cases.

I agree that it seems impossible to take care of every use case with one 
dafault behaviour. The problem I see with the RabbitMQ approach here is the 
need for extra headers in order to get the desired behaviour, because many 
STOMP client libraries do not contemplate the use of extra headers at all, 
which is really fine from the point of view of the (rather sucint) STOMP spec.

What I believe would be a good approach at the moment is to let the user 
select the desired "defaults" for the stomp-adapter in their rabbitmq.conf 
file somehow.

There could be settings for all the key questions that Matthias enumerated:
1) Should messages be routed to all subscribers or just one (round-robin)?
2) Should messages be queued when there are no subscribers?
3) When a client has multiple subscriptions to the same destination,
    should they receive one copy of a message or several?

For example:

1) MESSAGE_ROUTING = queue | topic   (or round-robin|broadcast)
2) ALWAYS_QUEUE = true | false
3) UNIQUE_SUBSCRIPTION = true | false


I really wouldn't mind what the "factory defaults" are as long as I can tweak 
them for my deployment through a conf file.


One other thing... there has been much discussion in the Orbited IRC channel 
about the flaws in the STOMP spec and Michael Carter (Orbited dev) has 
proposed the creation of a better protocol that should be as much backwards 
compatible with STOMP as possible but specifies things more precisely.

I believe this could be the only real solution to the STOMP interoperability 
problems... What do you guys think?


--
NicoEch?niz




From steve.eichert at gmail.com  Thu Jun 11 14:59:27 2009
From: steve.eichert at gmail.com (Steve Eichert)
Date: Thu, 11 Jun 2009 09:59:27 -0400
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
Message-ID: <db2bfd40906110659r5abc3293y178c4d2af8e98ac1@mail.gmail.com>

As Aaron mentioned I've run the same code on OSX via mono and have
encountered similar errors.  I've been getting somewhat inconsistent results
depending on how many threads I spin up.  When set to run 500 threads I'm
currently getting the error below [1].  I do get a number of messages sent
to the queue (~24k) and based on the error am assuming the client can't
handle spinning up that many concurrent connections.

[1]
None of the specified endpoints were reachable
Endpoints attempted:
  endpoint=amqp-0-8://localhost:5672, attempts=1, outcome=Too many open
files
Stack trace:
  at RabbitMQ.Client.ConnectionFactory.CreateConnection (Int32 maxRedirects,
RabbitMQ.Client.AmqpTcpEndpoint[] endpoints) [0x00000]
  at RabbitMQ.Client.ConnectionFactory.CreateConnection
(RabbitMQ.Client.AmqpTcpEndpoint[] endpoints) [0x00000]
  at RabbitMQ.Client.ConnectionFactory.CreateConnection (System.String
address) [0x00000]
  at RabbitTest.Program.DoWork () [0x00000]
System.Net.Sockets.SocketException: The descriptor is not a socket
  at System.Net.Sockets.Socket.SetSocketOption (SocketOptionLevel level,
SocketOptionName name, Int32 opt_value) [0x00000]
  at System.Net.Sockets.TcpClient.set_ReceiveTimeout (Int32 value)
[0x00000]
  at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.set_Timeout (Int32 value)
[0x00000]
  at RabbitMQ.Client.Impl.ConnectionBase.ClosingLoop () [0x00000]
System.Net.Sockets.SocketException: The descriptor is not a socket
  at System.Net.Sockets.Socket.SetSocketOption (SocketOptionLevel level,
SocketOptionName name, Int32 opt_value) [0x00000]
  at System.Net.Sockets.TcpClient.set_ReceiveTimeout (Int32 value)
[0x00000]
  at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.set_Timeout (Int32 value)
[0x00000]
  at RabbitMQ.Client.Impl.ConnectionBase.ClosingLoop () [0x00000]

Matthias,

Steve ran the exact same code on mono under OSX.  He also encountered some
> errors on the client side.  He will be joining this thread soon.

 Thanks,

 Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090611/fc729041/attachment.htm 

From andrius.norkaitis at oryo.lt  Thu Jun 11 16:18:21 2009
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Thu, 11 Jun 2009 18:18:21 +0300
Subject: [rabbitmq-discuss] RabbitMQ .NET deadlock after calling
	.CreateConnection
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAOT+KPvJpqVHkPHiM6qtoMkBAAAAAA==@oryo.lt>

Any thoughts why this deadlocks may occur? The most problematic is that this deadlocks occurs rarely and at client's site... (after long monitoring it occurred on our machine too).

I have attached the source. Your help would be very appreciated.

Thanks.

Andrius


-----Original Message-----
From: Ryan Davis [mailto:ryan at acceleration.net]
Sent: Monday, June 08, 2009 5:21 PM
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [Spam] [rabbitmq-discuss] RabbitMQ .NET Client sometimes hangs up

Would it be possible to post your code?  I use the .NET client in a similar way, spawning many threads each calling CreateConnection.  I've simulated network problems by restarting my RabbitMQ server, and I see the .NET client throwing exceptions when it fails.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506



Andrius Norkaitis wrote:
> I think no. All rabbit code is in try/catch and nothing is logged in catch statement. Otherwise, if .net rabbit client method CreateConnection does some asynchronous stuff (haven't watch at a source deeply), errors may not be caught and in this case thread may halt, I think.
>
> -----Original Message-----
> From: Ryan Davis [mailto:ryan at acceleration.net]
> Sent: Monday, June 08, 2009 4:06 PM
> To: Andrius Norkaitis
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [Spam] [rabbitmq-discuss] RabbitMQ .NET Client sometimes 
> hangs up
>
> Is the thread throwing an exception before it halts?
>
> Thanks,
>
> Ryan Davis
> Acceleration.net
> Director of Programming Services
> 2831 NW 41st street, suite B
> Gainesville, FL 32606
>
> Office: 352-335-6500 x 124
> Fax: 352-335-6506
>
>
>
> Andrius Norkaitis wrote:
>   
>> Hello,
>>
>> I can?t find the problem and how to fix it so your help would be very appreciated.
>>
>> Our .net client starts new thread which loops calling ConnectAndListen method (loop is for automatic reconnect). In ConnectAndListen method we create new connection and model, bind to queries and listen for messages ("foreach (BasicDeliverEventArgs ee in subscription)").
>>
>> Everything works like it has, but for sometimes unknown reason sometime client does not reconnect and hangs. It's not always and depends on network disturbances, so can?t easily debug. What I figured out, that thread halts after this statement is called: 
>>
>> using (conn = cf.CreateConnection(serverAddress))
>>
>>
>> Any thoughts what can cause it and how to fix it?
>>
>>
>> Best regards
>> Andrius
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>   
>>     
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rabbit.cs
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090611/75a7fdef/attachment.txt 

From aaron.feng at gmail.com  Thu Jun 11 17:46:43 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Thu, 11 Jun 2009 12:46:43 -0400
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4A3021A2.2000509@lshift.net>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>
	<4A2FECE3.6030408@lshift.net>
	<4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>
	<4A2FF832.2050201@lshift.net>
	<4e3934860906101234g1abda03bx2c808a198b714672@mail.gmail.com>
	<4A300F31.2090908@lshift.net>
	<4e3934860906101300p465e0637ped3dc20eaf2553e1@mail.gmail.com>
	<4A30143B.8030202@lshift.net>
	<4e3934860906101357t28b305ddk8bf80742df93d613@mail.gmail.com>
	<4A3021A2.2000509@lshift.net>
Message-ID: <4e3934860906110946h6eda8f5eoe5b77e8c4b8d9078@mail.gmail.com>

Matthias,

I have attached the sample program.

Thanks,

Aaron

On Wed, Jun 10, 2009 at 5:12 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Aaron,
>
> Aaron Feng wrote:
>>
>> ok, I took out the for loop and replaced it with sleep for 500msec
>> (assuming that is long enough?). ?It ran fine, I tried it a few times.
>
> I'll try to reproduce the problem. Can you send through the complete code,
> please?
>
>
> Matthias.
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Program.cs
Type: text/x-csharp
Size: 1916 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090611/8f7191e5/attachment.bin 

From matthias at lshift.net  Thu Jun 11 17:55:23 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 11 Jun 2009 17:55:23 +0100
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <db2bfd40906110659r5abc3293y178c4d2af8e98ac1@mail.gmail.com>
References: <db2bfd40906110659r5abc3293y178c4d2af8e98ac1@mail.gmail.com>
Message-ID: <4A3136FB.7050209@lshift.net>

Steve,

Steve Eichert wrote:
> As Aaron mentioned I've run the same code on OSX via mono and have 
> encountered similar errors.  I've been getting somewhat inconsistent 
> results depending on how many threads I spin up.  When set to run 500 
> threads I'm currently getting the error below [1].  I do get a number of 
> messages sent to the queue (~24k) and based on the error am assuming the 
> client can't handle spinning up that many concurrent connections.
> 
> [1] 
> None of the specified endpoints were reachable
> Endpoints attempted:
>   endpoint=amqp-0-8://localhost:5672, attempts=1, outcome=Too many open 
> files

That is almost certainly caused by an operating system limit; there are 
no limits in the client code. Try increasing the OS limits. No idea how 
that's done on OSX but it shouldn't be hard.


Matthias.



From jack at collecta.com  Thu Jun 11 23:29:17 2009
From: jack at collecta.com (Jack Moffitt)
Date: Thu, 11 Jun 2009 16:29:17 -0600
Subject: [rabbitmq-discuss] rabbitmq memory grows with queue size
Message-ID: <9b58f4550906111529u134138afpcb44e0cc293a5c05@mail.gmail.com>

Perhaps I missed a config option, but I am running out of memory on
the machines running rabbitmq-server.

I have two queues and two fanout exchanges (each queue is bound to one
of the exchanges).   As the queue size grows so does memory use, even
though both queues are durable. and the messages persistent.  Does
rabbitmq require everything in memory as well even for persistent
queues?

jack.



From cremes.devlist at mac.com  Thu Jun 11 23:46:36 2009
From: cremes.devlist at mac.com (Chuck Remes)
Date: Thu, 11 Jun 2009 17:46:36 -0500
Subject: [rabbitmq-discuss] rabbitmq memory grows with queue size
In-Reply-To: <9b58f4550906111529u134138afpcb44e0cc293a5c05@mail.gmail.com>
References: <9b58f4550906111529u134138afpcb44e0cc293a5c05@mail.gmail.com>
Message-ID: <8F8CDBF5-799D-4586-BCC0-CAD4628A0678@mac.com>


On Jun 11, 2009, at 5:29 PM, Jack Moffitt wrote:

> Perhaps I missed a config option, but I am running out of memory on
> the machines running rabbitmq-server.
>
> I have two queues and two fanout exchanges (each queue is bound to one
> of the exchanges).   As the queue size grows so does memory use, even
> though both queues are durable. and the messages persistent.  Does
> rabbitmq require everything in memory as well even for persistent
> queues?

Regardless of queue type or settings, RabbitMQ stores all messages in  
memory. There is work on a new "persister" ongoing in one of the  
development branches to resolve this limitation. As far as I know  
there hasn't been any date set for its release, but it should be  
sometime this year.

cr




From matthias at lshift.net  Fri Jun 12 12:32:07 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 12 Jun 2009 12:32:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ stomp-adapter behaviour
In-Reply-To: <200906110306.49582.nico@rakar.com>
References: <200906072340.23972.nico@rakar.com>	<3bb0d9710906100529p712af8c7ue1c962acc0674d7c@mail.gmail.com>
	<200906110306.49582.nico@rakar.com>
Message-ID: <4A323CB7.6030602@lshift.net>

Nicolas,

Nicolas Echaniz wrote:
> What I believe would be a good approach at the moment is to let the user 
> select the desired "defaults" for the stomp-adapter in their rabbitmq.conf 
> file somehow.

That may indeed be the way to go, and Gavin suggested the same thing.
Though I'd rather wait with that until we have made the stomp adapter an
independent app, at which point we can give it its own config file.

> There could be settings for all the key questions that Matthias enumerated:
> 1) Should messages be routed to all subscribers or just one (round-robin)?
> 2) Should messages be queued when there are no subscribers?
> 3) When a client has multiple subscriptions to the same destination,
>     should they receive one copy of a message or several?

That then raises the question of what the default, err, defaults should
be :) Any opinions?


Matthias.



From matthias at lshift.net  Fri Jun 12 12:48:16 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 12 Jun 2009 12:48:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET Client sometimes hangs up
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAMgAzF7zxkFFiJDSTPEON2ABAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAMgAzF7zxkFFiJDSTPEON2ABAAAAAA==@oryo.lt>
Message-ID: <4A324080.5060501@lshift.net>

Andrius,

Andrius Norkaitis wrote:
> Here is out client code (business logic removed). It's interesting 
> that client disconnects and reconnects 2-5 times a day, but hangs
> much rarely. Perhaps something related to rabbitmq .CreateConnection
> method freezes the thread, but we need to dig deeper into the rabbit
> source to find a problem.

Could you get a stack trace of all the threads at the time the deadlock
occurs? I believe the VS debugger allows you to do that, but there may
be a more convenient way.


Regards,

Matthias.



From matthias at lshift.net  Sat Jun 13 00:00:21 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 13 Jun 2009 00:00:21 +0100
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4e3934860906110946h6eda8f5eoe5b77e8c4b8d9078@mail.gmail.com>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>	<4A2FECE3.6030408@lshift.net>	<4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>	<4A2FF832.2050201@lshift.net>	<4e3934860906101234g1abda03bx2c808a198b714672@mail.gmail.com>	<4A300F31.2090908@lshift.net>	<4e3934860906101300p465e0637ped3dc20eaf2553e1@mail.gmail.com>	<4A30143B.8030202@lshift.net>	<4e3934860906101357t28b305ddk8bf80742df93d613@mail.gmail.com>	<4A3021A2.2000509@lshift.net>
	<4e3934860906110946h6eda8f5eoe5b77e8c4b8d9078@mail.gmail.com>
Message-ID: <4A32DE05.6040909@lshift.net>

Aaron,

Aaron Feng wrote:
> I have attached the sample program.

This runs fine for me under mono except for some weird pauses where 
neither the client or server seem to do anything. Increasing mono's 
thread pool size (setting MONO_THREADS_PER_CPU=2000) gets rid of the pauses.

Btw, the test should really delete the exchange & queue at the end, 
otherwise the server will be accumulating garbage over time.


Matthias.



From alexis.richardson at gmail.com  Mon Jun 15 11:11:51 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 15 Jun 2009 11:11:51 +0100
Subject: [rabbitmq-discuss] rabbitmq memory grows with queue size
In-Reply-To: <8F8CDBF5-799D-4586-BCC0-CAD4628A0678@mac.com>
References: <9b58f4550906111529u134138afpcb44e0cc293a5c05@mail.gmail.com>
	<8F8CDBF5-799D-4586-BCC0-CAD4628A0678@mac.com>
Message-ID: <167204d20906150311n102f462cg4d69bcaa96c5be6f@mail.gmail.com>

Chuck - that's correct :-)

Jack, all,

The "page to disk" feature is now getting into QA and should be
visible on a branch on the repo.  If you would like to help us QA this
please speak out.  Matthias, as per usual, is in charge of getting
this feature into a releasable state.

The new feature enables messages that are persisted to exist on disk
and not in memory.  Previously persisted data would remain in memory
as well as being written to disk.

More generally, you can still drain queues into any store
programmatically, in the meantime.

alexis



On Thu, Jun 11, 2009 at 11:46 PM, Chuck Remes<cremes.devlist at mac.com> wrote:
>
> On Jun 11, 2009, at 5:29 PM, Jack Moffitt wrote:
>
>> Perhaps I missed a config option, but I am running out of memory on
>> the machines running rabbitmq-server.
>>
>> I have two queues and two fanout exchanges (each queue is bound to one
>> of the exchanges). ? As the queue size grows so does memory use, even
>> though both queues are durable. and the messages persistent. ?Does
>> rabbitmq require everything in memory as well even for persistent
>> queues?
>
> Regardless of queue type or settings, RabbitMQ stores all messages in
> memory. There is work on a new "persister" ongoing in one of the
> development branches to resolve this limitation. As far as I know
> there hasn't been any date set for its release, but it should be
> sometime this year.
>
> cr
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From brian at echonest.com  Mon Jun 15 15:15:38 2009
From: brian at echonest.com (Brian Whitman)
Date: Mon, 15 Jun 2009 10:15:38 -0400
Subject: [rabbitmq-discuss] rabbitmq memory grows with queue size
In-Reply-To: <167204d20906150311n102f462cg4d69bcaa96c5be6f@mail.gmail.com>
References: <9b58f4550906111529u134138afpcb44e0cc293a5c05@mail.gmail.com>
	<8F8CDBF5-799D-4586-BCC0-CAD4628A0678@mac.com>
	<167204d20906150311n102f462cg4d69bcaa96c5be6f@mail.gmail.com>
Message-ID: <dbd9700a0906150715u5b7f33fare447ce0537fcd829@mail.gmail.com>

Would love to try this out -- are there any configuration things I need to
know about, or will a default build from the branch "just work"?

On Mon, Jun 15, 2009 at 6:11 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Chuck - that's correct :-)
>
> Jack, all,
>
> The "page to disk" feature is now getting into QA and should be
> visible on a branch on the repo.  If you would like to help us QA this
> please speak out.  Matthias, as per usual, is in charge of getting
> this feature into a releasable state.
>
> The new feature enables messages that are persisted to exist on disk
> and not in memory.  Previously persisted data would remain in memory
> as well as being written to disk.
>
> More generally, you can still drain queues into any store
> programmatically, in the meantime.
>
> alexis
>
>
>
> On Thu, Jun 11, 2009 at 11:46 PM, Chuck Remes<cremes.devlist at mac.com>
> wrote:
> >
> > On Jun 11, 2009, at 5:29 PM, Jack Moffitt wrote:
> >
> >> Perhaps I missed a config option, but I am running out of memory on
> >> the machines running rabbitmq-server.
> >>
> >> I have two queues and two fanout exchanges (each queue is bound to one
> >> of the exchanges).   As the queue size grows so does memory use, even
> >> though both queues are durable. and the messages persistent.  Does
> >> rabbitmq require everything in memory as well even for persistent
> >> queues?
> >
> > Regardless of queue type or settings, RabbitMQ stores all messages in
> > memory. There is work on a new "persister" ongoing in one of the
> > development branches to resolve this limitation. As far as I know
> > there hasn't been any date set for its release, but it should be
> > sometime this year.
> >
> > cr
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090615/c2220de1/attachment.htm 

From brian at echonest.com  Mon Jun 15 15:28:55 2009
From: brian at echonest.com (Brian Whitman)
Date: Mon, 15 Jun 2009 10:28:55 -0400
Subject: [rabbitmq-discuss] rabbitmq memory grows with queue size
In-Reply-To: <dbd9700a0906150715u5b7f33fare447ce0537fcd829@mail.gmail.com>
References: <9b58f4550906111529u134138afpcb44e0cc293a5c05@mail.gmail.com>
	<8F8CDBF5-799D-4586-BCC0-CAD4628A0678@mac.com>
	<167204d20906150311n102f462cg4d69bcaa96c5be6f@mail.gmail.com>
	<dbd9700a0906150715u5b7f33fare447ce0537fcd829@mail.gmail.com>
Message-ID: <dbd9700a0906150728p2b014082k94bb90b98eb88a94@mail.gmail.com>

Also, which branch? I can't seem to find anything appropriate here:
http://hg.rabbitmq.com/rabbitmq-server


On Mon, Jun 15, 2009 at 10:15 AM, Brian Whitman <brian at echonest.com> wrote:

> Would love to try this out -- are there any configuration things I need to
> know about, or will a default build from the branch "just work"?
>
>
> On Mon, Jun 15, 2009 at 6:11 AM, Alexis Richardson <
> alexis.richardson at gmail.com> wrote:
>
>> Chuck - that's correct :-)
>>
>> Jack, all,
>>
>> The "page to disk" feature is now getting into QA and should be
>> visible on a branch on the repo.  If you would like to help us QA this
>> please speak out.  Matthias, as per usual, is in charge of getting
>> this feature into a releasable state.
>>
>> The new feature enables messages that are persisted to exist on disk
>> and not in memory.  Previously persisted data would remain in memory
>> as well as being written to disk.
>>
>> More generally, you can still drain queues into any store
>> programmatically, in the meantime.
>>
>> alexis
>>
>>
>>
>> On Thu, Jun 11, 2009 at 11:46 PM, Chuck Remes<cremes.devlist at mac.com>
>> wrote:
>> >
>> > On Jun 11, 2009, at 5:29 PM, Jack Moffitt wrote:
>> >
>> >> Perhaps I missed a config option, but I am running out of memory on
>> >> the machines running rabbitmq-server.
>> >>
>> >> I have two queues and two fanout exchanges (each queue is bound to one
>> >> of the exchanges).   As the queue size grows so does memory use, even
>> >> though both queues are durable. and the messages persistent.  Does
>> >> rabbitmq require everything in memory as well even for persistent
>> >> queues?
>> >
>> > Regardless of queue type or settings, RabbitMQ stores all messages in
>> > memory. There is work on a new "persister" ongoing in one of the
>> > development branches to resolve this limitation. As far as I know
>> > there hasn't been any date set for its release, but it should be
>> > sometime this year.
>> >
>> > cr
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090615/12317cad/attachment.htm 

From tsuraan at gmail.com  Mon Jun 15 17:51:27 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 15 Jun 2009 11:51:27 -0500
Subject: [rabbitmq-discuss] rabbitmq memory grows with queue size
In-Reply-To: <dbd9700a0906150728p2b014082k94bb90b98eb88a94@mail.gmail.com>
References: <9b58f4550906111529u134138afpcb44e0cc293a5c05@mail.gmail.com>
	<8F8CDBF5-799D-4586-BCC0-CAD4628A0678@mac.com>
	<167204d20906150311n102f462cg4d69bcaa96c5be6f@mail.gmail.com>
	<dbd9700a0906150715u5b7f33fare447ce0537fcd829@mail.gmail.com>
	<dbd9700a0906150728p2b014082k94bb90b98eb88a94@mail.gmail.com>
Message-ID: <84fb38e30906150951h49fe66beyc17c92f4203d53db@mail.gmail.com>

> Also, which branch? I can't seem to find anything appropriate here:
> http://hg.rabbitmq.com/rabbitmq-server

I'm guessing bug19662, since the last log on it is talking about
disk-only-mode operation of queues.  I'll be building it to see,
anyhow :)



From matthew at lshift.net  Mon Jun 15 17:52:19 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 15 Jun 2009 17:52:19 +0100
Subject: [rabbitmq-discuss] rabbitmq memory grows with queue size
In-Reply-To: <dbd9700a0906150728p2b014082k94bb90b98eb88a94@mail.gmail.com>
References: <9b58f4550906111529u134138afpcb44e0cc293a5c05@mail.gmail.com>
	<8F8CDBF5-799D-4586-BCC0-CAD4628A0678@mac.com>
	<167204d20906150311n102f462cg4d69bcaa96c5be6f@mail.gmail.com>
	<dbd9700a0906150715u5b7f33fare447ce0537fcd829@mail.gmail.com>
	<dbd9700a0906150728p2b014082k94bb90b98eb88a94@mail.gmail.com>
Message-ID: <20090615165219.GC21834@mrnibble.lshift.net>

For the list, I have replied to this off list. The reason being that the
new disk queue is not ready for a public release yet, we do expect there
still to be bugs in it, the code has not been QA'd yet, and about 25% of
the code base of Rabbit has changed. A substantial portion of the new
disk queue will change again over the coming weeks as it goes through
QA. Obviously, anyone wishing to try such experimental code would be
very well advised to treat it as such.

If you are desperate, despite such grave warnings, to try the new disk
queue then you may contact me directly off list. However, it will be
several weeks before this gets formally released, and I will not be
providing binary packages at this point whatsoever. Support is almost
certainly, at this very early point, to be "if you can't make it work,
then don't be surprised. Wait for the code to be released. (But, if it
does work for you, we'd be pretty interested in hearing how well it's
working for you!)"

In other words, if you're used to building Linux development kernels
(i.e. pre RC) then you may get some mileage out of this ;)

Matthew

On Mon, Jun 15, 2009 at 10:28:55AM -0400, Brian Whitman wrote:
> Also, which branch? I can't seem to find anything appropriate here:
> http://hg.rabbitmq.com/rabbitmq-server
> 
> 
> On Mon, Jun 15, 2009 at 10:15 AM, Brian Whitman <brian at echonest.com> wrote:
> 
> > Would love to try this out -- are there any configuration things I need to
> > know about, or will a default build from the branch "just work"?
> >
> >
> > On Mon, Jun 15, 2009 at 6:11 AM, Alexis Richardson <
> > alexis.richardson at gmail.com> wrote:
> >
> >> Chuck - that's correct :-)
> >>
> >> Jack, all,
> >>
> >> The "page to disk" feature is now getting into QA and should be
> >> visible on a branch on the repo.  If you would like to help us QA this
> >> please speak out.  Matthias, as per usual, is in charge of getting
> >> this feature into a releasable state.
> >>
> >> The new feature enables messages that are persisted to exist on disk
> >> and not in memory.  Previously persisted data would remain in memory
> >> as well as being written to disk.
> >>
> >> More generally, you can still drain queues into any store
> >> programmatically, in the meantime.
> >>
> >> alexis
> >>
> >>
> >>
> >> On Thu, Jun 11, 2009 at 11:46 PM, Chuck Remes<cremes.devlist at mac.com>
> >> wrote:
> >> >
> >> > On Jun 11, 2009, at 5:29 PM, Jack Moffitt wrote:
> >> >
> >> >> Perhaps I missed a config option, but I am running out of memory on
> >> >> the machines running rabbitmq-server.
> >> >>
> >> >> I have two queues and two fanout exchanges (each queue is bound to one
> >> >> of the exchanges).   As the queue size grows so does memory use, even
> >> >> though both queues are durable. and the messages persistent.  Does
> >> >> rabbitmq require everything in memory as well even for persistent
> >> >> queues?
> >> >
> >> > Regardless of queue type or settings, RabbitMQ stores all messages in
> >> > memory. There is work on a new "persister" ongoing in one of the
> >> > development branches to resolve this limitation. As far as I know
> >> > there hasn't been any date set for its release, but it should be
> >> > sometime this year.
> >> >
> >> > cr
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> >

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From tsuraan at gmail.com  Mon Jun 15 18:07:32 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 15 Jun 2009 12:07:32 -0500
Subject: [rabbitmq-discuss] Exchange matching performance
Message-ID: <84fb38e30906151007u7b909042n240e7aebaf26d309@mail.gmail.com>

I seem to remember that direct exchanges dispatch much faster than
topic due to the complexity of the matching in the topic exchange.
Now that the headers exchange is out (or at least appears to be in the
disk paging branch), how does that perform?  It seeks like it would be
similar to the direct exchange, but with multiple possible keys.  I
haven't done any speed testing yet; I'm just wondering what the
expectation would be.



From matthew at lshift.net  Mon Jun 15 18:17:56 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 15 Jun 2009 18:17:56 +0100
Subject: [rabbitmq-discuss] Exchange matching performance
In-Reply-To: <84fb38e30906151007u7b909042n240e7aebaf26d309@mail.gmail.com>
References: <84fb38e30906151007u7b909042n240e7aebaf26d309@mail.gmail.com>
Message-ID: <20090615171756.GD21834@mrnibble.lshift.net>

On Mon, Jun 15, 2009 at 12:07:32PM -0500, tsuraan wrote:
> I seem to remember that direct exchanges dispatch much faster than
> topic due to the complexity of the matching in the topic exchange.
> Now that the headers exchange is out (or at least appears to be in the
> disk paging branch), how does that perform?  It seeks like it would be
> similar to the direct exchange, but with multiple possible keys.  I
> haven't done any speed testing yet; I'm just wondering what the
> expectation would be.

I can't comment as I didn't write that code, and the person who did is
currently on holiday. Beware that header exchange is defined in AMQP
0-9-1 and that what you have checked out is in fact an interesting mix
of 0-8 and 0-9-1. Clients almost certainly will break.

Matthew



From matthias at lshift.net  Tue Jun 16 07:03:58 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 16 Jun 2009 07:03:58 +0100
Subject: [rabbitmq-discuss] Exchange matching performance
In-Reply-To: <20090615171756.GD21834@mrnibble.lshift.net>
References: <84fb38e30906151007u7b909042n240e7aebaf26d309@mail.gmail.com>
	<20090615171756.GD21834@mrnibble.lshift.net>
Message-ID: <4A3735CE.2020805@lshift.net>

Matthew Sackman wrote:
> On Mon, Jun 15, 2009 at 12:07:32PM -0500, tsuraan wrote:
>> I seem to remember that direct exchanges dispatch much faster than
>> topic due to the complexity of the matching in the topic exchange.
>> Now that the headers exchange is out (or at least appears to be in the
>> disk paging branch), how does that perform?  It seeks like it would be
>> similar to the direct exchange, but with multiple possible keys.  I
>> haven't done any speed testing yet; I'm just wondering what the
>> expectation would be.
> 
> I can't comment as I didn't write that code, and the person who did is
> currently on holiday. Beware that header exchange is defined in AMQP
> 0-9-1 and that what you have checked out is in fact an interesting mix
> of 0-8 and 0-9-1. Clients almost certainly will break.

The introduction of headers exchanges does not change the protocol's 
wire format or require any additional AMQP commands. So clients are 
unaffected.

As for efficiency; the current implementation of headers exchanges 
performs about the same as topic exchanges.


Matthias.



From alexis.richardson at gmail.com  Tue Jun 16 14:06:27 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 16 Jun 2009 14:06:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ at the Erlang Factory
Message-ID: <167204d20906160606n7de45b43m3f575fda4d10f2e@mail.gmail.com>

Hi all,

If you are in London on June 25th or 26th then you may be interested
in the Erlang Factory: http://www.erlang-factory.com/

We'll be doing one or more talks and hope to present one or more case studies.

alexis



From gmr at myyearbook.com  Tue Jun 16 23:27:56 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 16 Jun 2009 18:27:56 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
Message-ID: <af1bce590906161527y2ba4d178s6e6dd7b2e30622b4@mail.gmail.com>

I have committed my initial working copy of Cony, which is a HTTP based
service for providing insight into a running RabbitMQ process.  Right now it
only provides JSON output for the rabbit_amqque message, passing back all of
the queue data.  The intent is to first expose all of the stats data that
one can pull via rabbitmqctl and the to provide a simple web UI with
real-time graphing.
This is not meant to be an administrative tool, but rather just a tool to
get data out for monitoring and trending.

It is written in Python and
uses py_interface and requires Python 2.6 or higher.

You can check it out on github at http://myb.me/3c

Regards,

Gavin



On Tue, Jun 2, 2009 at 11:22 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> I'm getting ready to do some production testing of rabbitmq as a
> replacement of ActiveMQ.  Beyond rabbitmqctl, I have not been able to
> find any real data stubs for monitoring beyond how to write my own
> (
> http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/
> ).
>  Before I go down the road of writing something I wanted to make sure
> there was no pre-existing software since the rabbitmq homepage says
> "Extensive facilities for management, monitoring, control and
> debugging."  I'm not trying to create a flame war, it's just
> rabbitmqctl is not really an enterprise level monitoring tool.
>
> I'm hoping I'm missing something, any suggestions?
>
> Gavin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090616/b057edec/attachment.htm 

From gmr at myyearbook.com  Wed Jun 17 04:00:18 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 16 Jun 2009 23:00:18 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <af1bce590906161527y2ba4d178s6e6dd7b2e30622b4@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<af1bce590906161527y2ba4d178s6e6dd7b2e30622b4@mail.gmail.com>
Message-ID: <af1bce590906162000o771d7b8fr30ae810c4d6a30ca@mail.gmail.com>

I wanted to share a screenshot of my progress with you all ;-)
http://gmr.privatepaste.com/ad0WYLbxjG

On Tue, Jun 16, 2009 at 6:27 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

> I have committed my initial working copy of Cony, which is a HTTP based
> service for providing insight into a running RabbitMQ process.  Right now it
> only provides JSON output for the rabbit_amqque message, passing back all of
> the queue data.  The intent is to first expose all of the stats data that
> one can pull via rabbitmqctl and the to provide a simple web UI with
> real-time graphing.
> This is not meant to be an administrative tool, but rather just a tool to
> get data out for monitoring and trending.
>
> It is written in Python and
> uses py_interface and requires Python 2.6 or higher.
>
> You can check it out on github at http://myb.me/3c
>
> Regards,
>
> Gavin
>
>
>
>
> On Tue, Jun 2, 2009 at 11:22 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>
>> I'm getting ready to do some production testing of rabbitmq as a
>> replacement of ActiveMQ.  Beyond rabbitmqctl, I have not been able to
>> find any real data stubs for monitoring beyond how to write my own
>> (
>> http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/
>> ).
>>  Before I go down the road of writing something I wanted to make sure
>> there was no pre-existing software since the rabbitmq homepage says
>> "Extensive facilities for management, monitoring, control and
>> debugging."  I'm not trying to create a flame war, it's just
>> rabbitmqctl is not really an enterprise level monitoring tool.
>>
>> I'm hoping I'm missing something, any suggestions?
>>
>> Gavin
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090616/77bbd0ad/attachment.htm 

From jack at collecta.com  Wed Jun 17 04:31:24 2009
From: jack at collecta.com (Jack Moffitt)
Date: Tue, 16 Jun 2009 21:31:24 -0600
Subject: [rabbitmq-discuss] extra basic.consume_ok
Message-ID: <9b58f4550906162031yae21a76mdd9c95854da37b6f@mail.gmail.com>

My code calls amqp_channel:subscribe almost exactly like lib_amqp
does.  However, my pid always gets an extra basic.consume_ok message
in its inbox.  Why is that?

jack.



From matthias at lshift.net  Wed Jun 17 04:47:49 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 17 Jun 2009 04:47:49 +0100
Subject: [rabbitmq-discuss] extra basic.consume_ok
In-Reply-To: <9b58f4550906162031yae21a76mdd9c95854da37b6f@mail.gmail.com>
References: <9b58f4550906162031yae21a76mdd9c95854da37b6f@mail.gmail.com>
Message-ID: <4A386765.8070304@lshift.net>

Jack,

Jack Moffitt wrote:
> My code calls amqp_channel:subscribe almost exactly like lib_amqp
> does.  However, my pid always gets an extra basic.consume_ok message
> in its inbox.  Why is that?

The basic.consume_ok gets returned by amqp_channel:call, but also sent 
to the consumer process. Same for basic.cancel_ok. That way a consumer 
process is told when it gets (un)subscribed by some other process. 
However, it also means that if the consumer process itself is doing the 
(un)subscribing then it gets the same info twice, via different routes.


Matthias.



From anthony-rabbitmq at hogan.id.au  Wed Jun 17 08:10:25 2009
From: anthony-rabbitmq at hogan.id.au (Anthony)
Date: Wed, 17 Jun 2009 17:10:25 +1000
Subject: [rabbitmq-discuss] RabbitMQ Clustering in a changing network
	environment
Message-ID: <1bf8be120906170010l606f4bd9scc3cf109e819a594@mail.gmail.com>

We have several sites which run applications which hook into a
RabbitMQ implemented AMQP bus. At the moment, there's a single site
with a rabbit server, and everything connects into that, but obviously
as things grow and more apps request data etc., it seems like it might
be more efficient for each site to have its own RabbitMQ server to act
as somewhat of a concentrator and perform intelligent routing between
the sites as well as reduce the need for the transmission of duplicate
messages across the inter-site links.

What isn't quite so clear is how one might interconnect several sites
with respect to rabbit clustering when the link between one site and
others changes, if one site can only "connect out" and sites can't
connect back to it, and what happens if the node that contains a given
message queue dies

In our specific case, 3G wireless data links in Australia often have
internal, non-routable, pre-NAT'd addresses assigned to them, such
that when a site's primary ADSL or other connection fails and the
firewall router switches on the 3G link, other sites are no longer
able to connect in - this site is only able to connect out.

In the event of an inter-site link dropping, it's obviously important
to us that rabbit keep going and where alternate links come up, that
rabbit leverage those to keep the client network config simple and
keep everything running.

Reading through the rabbitmq docs, it seems the clustering is pretty
much all done by erlang - a language/environment I have little
experience with I admit..

When nodes join a cluster, do they then attempt to message one another
directly or go through the node they identified with specifically when
joining the cluster?
If they communicate via the specific node they identified to - can
they identify directly with several specific nodes?
Is this through a persistent connection, or something transient?
Are there any caveats with NAT (including the case where one can't map
a port back in) or dynamic IPs?
How does the whole nodename/hostname thing work/resolve?

It also sounded like each site, if it could be arguably cut off from
every other one, should be a disk node?

I guess I'm askin' a lot of questions here - reading the clustering
doc suggests it's primarily aimed for environments where each cluster
is located at a site with a single, pretty reliable connection with a
static IP and hostname which isn't always the case in our
environment...



From alexis.richardson at gmail.com  Wed Jun 17 08:57:43 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 17 Jun 2009 08:57:43 +0100
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <af1bce590906162000o771d7b8fr30ae810c4d6a30ca@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<af1bce590906161527y2ba4d178s6e6dd7b2e30622b4@mail.gmail.com>
	<af1bce590906162000o771d7b8fr30ae810c4d6a30ca@mail.gmail.com>
Message-ID: <167204d20906170057m69414263qaa457c0ba1782e4e@mail.gmail.com>

Gavin

Thank-you very much for doing this, it looks like you have made great
progress.  I am really excited to see what sort of feedback you get.

Good choice of name too ;-)

alexis


On Wed, Jun 17, 2009 at 4:00 AM, Gavin M. Roy<gmr at myyearbook.com> wrote:
> I wanted to share a screenshot of my progress with you all ;-)
> http://gmr.privatepaste.com/ad0WYLbxjG
>
> On Tue, Jun 16, 2009 at 6:27 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>>
>> I have committed my initial working copy of Cony, which is a HTTP based
>> service for providing insight into a running RabbitMQ process. ?Right now it
>> only provides JSON output for the rabbit_amqque message, passing back all of
>> the queue data. ?The intent is to first expose all of the stats data that
>> one can pull?via?rabbitmqctl?and?the?to?provide?a?simple?web?UI?with
>> real-time graphing.
>> This is not meant to be an administrative tool, but rather just a tool to
>> get data out for monitoring and trending.
>> It is written in Python and
>> uses?py_interface?and?requires?Python?2.6?or?higher.
>> You can check it out on github at?http://myb.me/3c
>> Regards,
>> Gavin
>>
>>
>>
>> On Tue, Jun 2, 2009 at 11:22 AM, Gavin M. Roy <gmr at myyearbook.com> wrote:
>>>
>>> I'm getting ready to do some production testing of rabbitmq as a
>>> replacement of ActiveMQ. ?Beyond rabbitmqctl, I have not been able to
>>> find any real data stubs for monitoring beyond how to write my own
>>>
>>> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/).
>>> ?Before I go down the road of writing something I wanted to make sure
>>> there was no pre-existing software since the rabbitmq homepage says
>>> "Extensive facilities for management, monitoring, control and
>>> debugging." ?I'm not trying to create a flame war, it's just
>>> rabbitmqctl is not really an enterprise level monitoring tool.
>>>
>>> I'm hoping I'm missing something, any suggestions?
>>>
>>> Gavin
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Wed Jun 17 09:13:35 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 17 Jun 2009 09:13:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ Clustering in a changing network
	environment
In-Reply-To: <1bf8be120906170010l606f4bd9scc3cf109e819a594@mail.gmail.com>
References: <1bf8be120906170010l606f4bd9scc3cf109e819a594@mail.gmail.com>
Message-ID: <167204d20906170113n735751d2tb9fff25338352457@mail.gmail.com>

Anthony

This presentation presents approaches to *some* but not all of your questions:

http://skillsmatter.com/podcast/cloud-grid/rabbitmq-internal-architecture-tony-garnock-jones

Federation-for-availability is required in a large number of
interesting cases - of which yours is a great example.  As we speak,
the AMQP working group is looking at some of these questions which -
as I think you imply - speak equally to networking concerns such as
addressing and multihoming.

Re your questions about 'nodes' below.  That depends if 'node'
explicitly means erlang node or not.  In the presentation above,
routing between clusters can be but does not have to be based on
erlang's communication mechanisms.  So, 'joining and leaving a group'
might have a different meaning for federated brokers (consisting of
"broker nodes"), than it does within a cluster (of "erlang nodes").
We are looking at the semantics of this during summer 2009.  It's an
interesting area and there is no 'one' answer at the moment.

alexis





On Wed, Jun 17, 2009 at 8:10 AM, Anthony<anthony-rabbitmq at hogan.id.au> wrote:
> We have several sites which run applications which hook into a
> RabbitMQ implemented AMQP bus. At the moment, there's a single site
> with a rabbit server, and everything connects into that, but obviously
> as things grow and more apps request data etc., it seems like it might
> be more efficient for each site to have its own RabbitMQ server to act
> as somewhat of a concentrator and perform intelligent routing between
> the sites as well as reduce the need for the transmission of duplicate
> messages across the inter-site links.
>
> What isn't quite so clear is how one might interconnect several sites
> with respect to rabbit clustering when the link between one site and
> others changes, if one site can only "connect out" and sites can't
> connect back to it, and what happens if the node that contains a given
> message queue dies
>
> In our specific case, 3G wireless data links in Australia often have
> internal, non-routable, pre-NAT'd addresses assigned to them, such
> that when a site's primary ADSL or other connection fails and the
> firewall router switches on the 3G link, other sites are no longer
> able to connect in - this site is only able to connect out.
>
> In the event of an inter-site link dropping, it's obviously important
> to us that rabbit keep going and where alternate links come up, that
> rabbit leverage those to keep the client network config simple and
> keep everything running.
>
> Reading through the rabbitmq docs, it seems the clustering is pretty
> much all done by erlang - a language/environment I have little
> experience with I admit..
>
> When nodes join a cluster, do they then attempt to message one another
> directly or go through the node they identified with specifically when
> joining the cluster?
> If they communicate via the specific node they identified to - can
> they identify directly with several specific nodes?
> Is this through a persistent connection, or something transient?
> Are there any caveats with NAT (including the case where one can't map
> a port back in) or dynamic IPs?
> How does the whole nodename/hostname thing work/resolve?
>
> It also sounded like each site, if it could be arguably cut off from
> every other one, should be a disk node?
>
> I guess I'm askin' a lot of questions here - reading the clustering
> doc suggests it's primarily aimed for environments where each cluster
> is located at a site with a single, pretty reliable connection with a
> static IP and hostname which isn't always the case in our
> environment...
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From anthony-rabbitmq at hogan.id.au  Wed Jun 17 09:55:14 2009
From: anthony-rabbitmq at hogan.id.au (Anthony)
Date: Wed, 17 Jun 2009 18:55:14 +1000
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <af1bce590906162000o771d7b8fr30ae810c4d6a30ca@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<af1bce590906161527y2ba4d178s6e6dd7b2e30622b4@mail.gmail.com>
	<af1bce590906162000o771d7b8fr30ae810c4d6a30ca@mail.gmail.com>
Message-ID: <1bf8be120906170155r18e8bc2i6fc4d2fb2678837c@mail.gmail.com>

Hi Gavin,

On Wed, Jun 17, 2009 at 13:00, Gavin M. Roy<gmr at myyearbook.com> wrote:
> I wanted to share a screenshot of my progress with you all ;-)
> http://gmr.privatepaste.com/ad0WYLbxjG

Looks cool! Got it to work under Python2.5 by installing simplejson
and importing simplejson as json..

I think we might have a few more queues etc. than the interface can
handle at the moment though :)

http://img26.imageshack.us/img26/3093/conysnap.png

... perhaps a configurable "top offenders" with the rest represented
by an aggregate statistic?



From matthias at lshift.net  Wed Jun 17 12:35:09 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 17 Jun 2009 12:35:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.6.0 release
Message-ID: <4A38D4ED.6020501@lshift.net>

The RabbitMQ team is pleased to announce the release of RabbitMQ 1.6.0

This release has 'beta' status and introduces a number of new features,
such as prefetch count limiting, headers exchanges, fine-grained access
control, and alternate exchanges. There are also improvements to
performance and stability under high load, improved compatibility with
other software (such as ejabberd and PowerShell), and a number of small
bug fixes.

For details see the attached release notes.

Binary and source distributions of the new release can be found in the
usual place, at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.


Regards,

The RabbitMQ Team

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-1.6.0.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090617/c0781ab0/attachment.txt 

From gmr at myyearbook.com  Wed Jun 17 13:21:37 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 17 Jun 2009 08:21:37 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <1bf8be120906170155r18e8bc2i6fc4d2fb2678837c@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<af1bce590906161527y2ba4d178s6e6dd7b2e30622b4@mail.gmail.com>
	<af1bce590906162000o771d7b8fr30ae810c4d6a30ca@mail.gmail.com>
	<1bf8be120906170155r18e8bc2i6fc4d2fb2678837c@mail.gmail.com>
Message-ID: <af1bce590906170521w3926687aq7c932d7ff899eb03@mail.gmail.com>

On Wed, Jun 17, 2009 at 4:55 AM, Anthony <anthony-rabbitmq at hogan.id.au>wrote:

> Looks cool! Got it to work under Python2.5 by installing simplejson
> and importing simplejson as json..


Thanks.  Re 2.5, the simplejson as json works, I just had not tested with
2.5.  I'll add 2.5 compatibility instructions in the README.


> I think we might have a few more queues etc. than the interface can
> handle at the moment though :)
>
> http://img26.imageshack.us/img26/3093/conysnap.png
>
> ... perhaps a configurable "top offenders" with the rest represented
> by an aggregate statistic?
>

That's too funny, yeah I'll have the same problem as well in production.  I
was thinking of two things, a table view for full data and in the graphs,
sorting by the top 5 and adding an "Others" entry that is the sum of all of
the other queues.

Are there other areas you'd like to see?  I was going to work on Connections
next, but noticed that in my environment, which is currently Stomp only,
they don't show.  I am working on a new consumer setup here that will be
AMQP, which I expect does register properly in the connection data.

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090617/6afbb60c/attachment.htm 

From aaron.feng at gmail.com  Wed Jun 17 13:35:26 2009
From: aaron.feng at gmail.com (Aaron Feng)
Date: Wed, 17 Jun 2009 08:35:26 -0400
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <af1bce590906162000o771d7b8fr30ae810c4d6a30ca@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<af1bce590906161527y2ba4d178s6e6dd7b2e30622b4@mail.gmail.com>
	<af1bce590906162000o771d7b8fr30ae810c4d6a30ca@mail.gmail.com>
Message-ID: <90B71345-F7A4-4373-B0F8-DC08483E1667@gmail.com>

Looking good.

Aaron

On Jun 16, 2009, at 11:00 PM, "Gavin M. Roy" <gmr at myyearbook.com> wrote:

> I wanted to share a screenshot of my progress with you all ;-)
>
> http://gmr.privatepaste.com/ad0WYLbxjG
>
> On Tue, Jun 16, 2009 at 6:27 PM, Gavin M. Roy <gmr at myyearbook.com>  
> wrote:
> I have committed my initial working copy of Cony, which is a HTTP  
> based service for providing insight into a running RabbitMQ  
> process.  Right now it only provides JSON output for the  
> rabbit_amqque message, passing back all of the queue data.  The  
> intent is to first expose all of the stats data that one can pull  
> via rabbitmqctl and the to provide a simple web UI with real-time  
> graphing.
>
> This is not meant to be an administrative tool, but rather just a  
> tool to get data out for monitoring and trending.
>
> It is written in Python and uses py_interface and requires Python  
> 2.6 or higher.
>
> You can check it out on github at http://myb.me/3c
>
> Regards,
>
> Gavin
>
>
>
>
> On Tue, Jun 2, 2009 at 11:22 AM, Gavin M. Roy <gmr at myyearbook.com>  
> wrote:
> I'm getting ready to do some production testing of rabbitmq as a
> replacement of ActiveMQ.  Beyond rabbitmqctl, I have not been able to
> find any real data stubs for monitoring beyond how to write my own
> (http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/ 
> ).
>  Before I go down the road of writing something I wanted to make sure
> there was no pre-existing software since the rabbitmq homepage says
> "Extensive facilities for management, monitoring, control and
> debugging."  I'm not trying to create a flame war, it's just
> rabbitmqctl is not really an enterprise level monitoring tool.
>
> I'm hoping I'm missing something, any suggestions?
>
> Gavin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090617/ea0a85c1/attachment.htm 

From suhail at mixpanel.com  Wed Jun 17 19:42:17 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Wed, 17 Jun 2009 11:42:17 -0700
Subject: [rabbitmq-discuss] Erlang client issues
Message-ID: <376f3e6f0906171142n3e240291uf9864d1696d9262c@mail.gmail.com>

Hi everyone,
I am having some erlang client problems, I can't seem to get past the
amqp_connection:start() phase, it just seems to halt at:

** Found 0 name clashes in code paths
"test": "state-1"

=PROGRESS REPORT==== 17-Jun-2009::11:22:45 ===
          supervisor: {local,inet_gethost_native_sup}
             started: [{pid,<0.54.0>},{mfa,{inet_gethost_native,init,[[]]}}]

=PROGRESS REPORT==== 17-Jun-2009::11:22:45 ===
          supervisor: {local,kernel_safe_sup}
             started: [{pid,<0.53.0>},
                       {name,inet_gethost_native_sup},
                       {mfa,{inet_gethost_native,start_link,[]}},
                       {restart_type,temporary},
                       {shutdown,1000},
                       {child_type,worker}]

Here's the code:
----------------------------------------------------------------

-module(metrics_queue).
-export([amqp_lifecycle/0, send_message/5, log/2]).

-include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit.hrl").
-include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit_framing.hrl").
-include("rabbitmq-erlang-client/include/amqp_client.hrl").

-record(rabbit_info, {channel, ticket, exchange, routing_key}).

amqp_lifecycle() ->
    User = Password = "mixpanel",
    Realm = <<"mixpanel">>, %% virtual_host
    log("test", "state-1"),
    Connection = amqp_connection:start(User, Password, "127.0.0.1"),
    log("test", "state-2"),
    Channel = amqp_connection:open_channel(Connection),
    Access = #'access.request'{
        realm = Realm,
        exclusive = false,
        passive = true,
        active = true,
        write = true,
        read = true
    },

Any help is greatly appreciated

Sincerely,
Suhail Doshi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090617/0175bf24/attachment.htm 

From suhail at mixpanel.com  Wed Jun 17 20:38:54 2009
From: suhail at mixpanel.com (Suhail Doshi)
Date: Wed, 17 Jun 2009 12:38:54 -0700
Subject: [rabbitmq-discuss] Erlang - Client update
Message-ID: <376f3e6f0906171238j3059ece9h4c2d73b1a085c43c@mail.gmail.com>

I managed to get the erlant client working with the unit tests, using v1_5
branch seems to fix things, however I have a new problem: I can't seem to
get it working with my vhosts/usernames:
tehmac
~/web/analytics/servers/metrics_queue/producer/src/rabbitmq_server/sbin:
sudo ./rabbitmqctl list_user_vhosts mixpanel
Listing vhosts for user "mixpanel" ...
mixpanel
...done.
tehmac
~/web/analytics/servers/metrics_queue/producer/src/rabbitmq_server/sbin:
sudo ./rabbitmqctl list_vhost_users mixpanel
Listing users for vhosts "mixpanel" ...
mixpanel
...done.


amqp_lifecycle() ->
    User = Password = "mixpanel",
    Realm = <<"mixpanel">>, %% virtual_host
    log("test", "state-1"),
    Connection = amqp_connection:start(User, Password, "127.0.0.1"),
    log("test", "state-2"),
    Channel = amqp_connection:open_channel(Connection),
    Channel.

Seems to get simply get stuck:

"test": "state-1"

=PROGRESS REPORT==== 17-Jun-2009::12:38:35 ===
          supervisor: {local,inet_gethost_native_sup}
             started: [{pid,<0.54.0>},{mfa,{inet_gethost_native,init,[[]]}}]

=PROGRESS REPORT==== 17-Jun-2009::12:38:35 ===
          supervisor: {local,kernel_safe_sup}
             started: [{pid,<0.53.0>},
                       {name,inet_gethost_native_sup},
                       {mfa,{inet_gethost_native,start_link,[]}},
                       {restart_type,temporary},
                       {shutdown,1000},
                       {child_type,worker}]



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090617/79ac7109/attachment.htm 

From 0x6e6562 at gmail.com  Thu Jun 18 00:07:21 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 18 Jun 2009 00:07:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ - Erlang
In-Reply-To: <376f3e6f0906171126j6ec132f3ged75c33c7c6e45c9@mail.gmail.com>
References: <376f3e6f0906171126j6ec132f3ged75c33c7c6e45c9@mail.gmail.com>
Message-ID: <4A397729.3080602@gmail.com>

Suhail,

Suhail Doshi wrote:
> Hey Ben,
>
> My name is Suhail, I am having a bit of trouble with the erlang client 
> lib for rabbitmq, for some reason my code simply just halts at the 
> amqp_connection:start() phase:
>
> -module(metrics_queue).
> -author('Suhail Doshi <suhail at mixpanel.com 
> <mailto:suhail at mixpanel.com>>').
> -export([amqp_lifecycle/0, send_message/5, log/2]).
>
> -include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit.hrl").
> -include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit_framing.hrl").
> -include("rabbitmq-erlang-client/include/amqp_client.hrl").
>
> -record(rabbit_info, {channel, ticket, exchange, routing_key}).
>
> amqp_lifecycle() ->
>     User = Password = "mixpanel",
>     Realm = <<"mixpanel">>, %% virtual_host
>     log("test", "state-1"),
>     Connection = amqp_connection:start(User, Password, "127.0.0.1"),
>     log("test", "state-2"),
>     Channel = amqp_connection:open_channel(Connection),
>     Access = #'access.request'{
>         realm = Realm,
>         exclusive = false,
>         passive = true,
>         active = true,
>         write = true,
>         read = true
>     },
>
> I added you on gchat if you have any time to talk.

Is there anything in the server log? Can you supply some details about 
your environment and the versions of the client and server you are using?

Also, you're using the a deprecated API - realms have been removed from 
the spec.

I'm posting this to the Rabbit list - this is the most appropriate place 
to get help from the community.

HTH,

Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/3f36971b/attachment.htm 

From digitalwarfare at gmail.com  Thu Jun 18 00:20:41 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Wed, 17 Jun 2009 16:20:41 -0700
Subject: [rabbitmq-discuss] RabbitMQ - Erlang
In-Reply-To: <4A397729.3080602@gmail.com>
References: <376f3e6f0906171126j6ec132f3ged75c33c7c6e45c9@mail.gmail.com> 
	<4A397729.3080602@gmail.com>
Message-ID: <376f3e6f0906171620ycde493y98378bf9b5fe93c1@mail.gmail.com>

I actually got it working after looking at the /var/logs for rabbitmq.
Suhail

On Wed, Jun 17, 2009 at 4:07 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

>  Suhail,
>
>
> Suhail Doshi wrote:
>
> Hey Ben,
>  My name is Suhail, I am having a bit of trouble with the erlang client
> lib for rabbitmq, for some reason my code simply just halts at the
> amqp_connection:start() phase:
>
>  -module(metrics_queue).
> -author('Suhail Doshi <suhail at mixpanel.com>').
> -export([amqp_lifecycle/0, send_message/5, log/2]).
>
>
> -include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit.hrl").
>
> -include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit_framing.hrl").
> -include("rabbitmq-erlang-client/include/amqp_client.hrl").
>
>  -record(rabbit_info, {channel, ticket, exchange, routing_key}).
>
>  amqp_lifecycle() ->
>     User = Password = "mixpanel",
>     Realm = <<"mixpanel">>, %% virtual_host
>     log("test", "state-1"),
>     Connection = amqp_connection:start(User, Password, "127.0.0.1"),
>     log("test", "state-2"),
>     Channel = amqp_connection:open_channel(Connection),
>     Access = #'access.request'{
>         realm = Realm,
>         exclusive = false,
>         passive = true,
>         active = true,
>         write = true,
>         read = true
>     },
>
>  I added you on gchat if you have any time to talk.
>
>
> Is there anything in the server log? Can you supply some details about your
> environment and the versions of the client and server you are using?
>
> Also, you're using the a deprecated API - realms have been removed from the
> spec.
>
> I'm posting this to the Rabbit list - this is the most appropriate place to
> get help from the community.
>
> HTH,
>
> Ben
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090617/90fa015d/attachment.htm 

From lynton.grice at logosworld.com  Thu Jun 18 06:13:12 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Thu, 18 Jun 2009 07:13:12 +0200
Subject: [rabbitmq-discuss] What Erlang client version with RabbitMQ 1.6.0?
Message-ID: <000001c9efd3$7f56e970$7e04bc50$@grice@logosworld.com>

Hi there,

 

I have just installed the RabbitMQ 1.6.0 version on my windows box. 

 

Can someone let me know what version of the RabbitMQ Erlang client I can use
now to talk to the server?

 

I am currently using version 1.5.5 of the client...

 

http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/rabbitmq_v1_5_5.zip

 

Thanks for the help

 

Lynton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/f228f1b1/attachment.htm 

From keith.irwin at gmail.com  Thu Jun 18 06:17:46 2009
From: keith.irwin at gmail.com (Keith Irwin)
Date: Wed, 17 Jun 2009 22:17:46 -0700
Subject: [rabbitmq-discuss] What Erlang client version with RabbitMQ
	1.6.0?
In-Reply-To: <000001c9efd3$7f56e970$7e04bc50$@grice@logosworld.com>
References: <000001c9efd3$7f56e970$7e04bc50$@grice@logosworld.com>
Message-ID: <CCE69334-F1C2-4140-BC5C-C67BE437E94B@gmail.com>

I managed to get the "tip" of the rabbitmq-erlang-client to work with  
1.6.0. It's easy to test: just check out the source next to the  
rabbitmq-server and rabbitmq-codegen repos, then compile and test.

In one window, cd into rabbitmq-server, "make," and "make run".

Then, cd into rabbitmq-erlang-client, and "make," then "make test- 
network". If you don't get any errors, it worked.

Keith

On Jun 17, 2009, at 10:13 PM, Lynton Grice wrote:

> Hi there,
>
> I have just installed the RabbitMQ 1.6.0 version on my windows box.
>
> Can someone let me know what version of the RabbitMQ Erlang client I  
> can use now to talk to the server?
>
> I am currently using version 1.5.5 of the client...
>
> http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/rabbitmq_v1_5_5.zip
>
> Thanks for the help
>
> Lynton
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090617/5d52ccf3/attachment.htm 

From digitalwarfare at gmail.com  Thu Jun 18 06:20:26 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Wed, 17 Jun 2009 22:20:26 -0700
Subject: [rabbitmq-discuss] What Erlang client version with RabbitMQ
	1.6.0?
In-Reply-To: <CCE69334-F1C2-4140-BC5C-C67BE437E94B@gmail.com>
References: <CCE69334-F1C2-4140-BC5C-C67BE437E94B@gmail.com>
Message-ID: <376f3e6f0906172220k3dfbdf68r3ca5a3b882916e26@mail.gmail.com>

Pay attention to your /var/log/rabbit/rabbit.log file, it proved to be
really useful in debugging--probably save you hours.
Suhail Doshi

On Wed, Jun 17, 2009 at 10:17 PM, Keith Irwin <keith.irwin at gmail.com> wrote:

> I managed to get the "tip" of the rabbitmq-erlang-client to work with
> 1.6.0. It's easy to test: just check out the source next to the
> rabbitmq-server and rabbitmq-codegen repos, then compile and test.
> In one window, cd into rabbitmq-server, "make," and "make run".
>
> Then, cd into rabbitmq-erlang-client, and "make," then "make test-network".
> If you don't get any errors, it worked.
>
> Keith
>
> On Jun 17, 2009, at 10:13 PM, Lynton Grice wrote:
>
> Hi there,
>
> I have just installed the RabbitMQ 1.6.0 version on my windows box.
>
> Can someone let me know what version of the RabbitMQ Erlang client I can
> use now to talk to the server?
>
> I am currently using version 1.5.5 of the client...
>
> http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/rabbitmq_v1_5_5.zip
>
> Thanks for the help
>
> Lynton
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090617/5944917d/attachment.htm 

From lynton.grice at logosworld.com  Thu Jun 18 06:54:24 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Thu, 18 Jun 2009 07:54:24 +0200
Subject: [rabbitmq-discuss] What Erlang client version with RabbitMQ
	1.6.0?
In-Reply-To: <CCE69334-F1C2-4140-BC5C-C67BE437E94B@gmail.com>
References: <000001c9efd3$7f56e970$7e04bc50$@grice@logosworld.com>
	<CCE69334-F1C2-4140-BC5C-C67BE437E94B@gmail.com>
Message-ID: <001b01c9efd9$3fb1fa20$bf15ee60$@grice@logosworld.com>

Hi Keith,

 

Thanks for that, much appreciated. I have downloaded the latest tip of the
client but for some reason this time when I run make I am getting this
error:

 

"can't find include lib "rabbitmq_server/include/rabbit.hrl"

 



 

Last time with version 1.5.5 it compiled fine.....mmmmmm.....

 

This is what my lib folder looks like:

 



 

The server is compiled perfect..for some reason my Erlang environment is not
finding that library.....any ideas?

 

Thanks

 

Lynton

 

 

 

From: Keith Irwin [mailto:keith.irwin at gmail.com] 
Sent: 18 June 2009 07:18 AM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] What Erlang client version with RabbitMQ
1.6.0?

 

I managed to get the "tip" of the rabbitmq-erlang-client to work with 1.6.0.
It's easy to test: just check out the source next to the rabbitmq-server and
rabbitmq-codegen repos, then compile and test.

 

In one window, cd into rabbitmq-server, "make," and "make run".

 

Then, cd into rabbitmq-erlang-client, and "make," then "make test-network".
If you don't get any errors, it worked.

 

Keith

 

On Jun 17, 2009, at 10:13 PM, Lynton Grice wrote:





Hi there,

 

I have just installed the RabbitMQ 1.6.0 version on my windows box.

 

Can someone let me know what version of the RabbitMQ Erlang client I can use
now to talk to the server?

 

I am currently using version 1.5.5 of the client...

 

http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/rabbitmq_v1_5_5.zip

 

Thanks for the help

 

Lynton

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/32164448/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 50241 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/32164448/attachment.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 5760 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/32164448/attachment-0001.png 

From lynton.grice at logosworld.com  Thu Jun 18 06:56:57 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Thu, 18 Jun 2009 07:56:57 +0200
Subject: [rabbitmq-discuss] What Erlang client version with RabbitMQ
	1.6.0?
References: <000001c9efd3$7f56e970$7e04bc50$@grice@logosworld.com>
	<CCE69334-F1C2-4140-BC5C-C67BE437E94B@gmail.com> 
Message-ID: <002101c9efd9$9b3e8fc0$d1bbaf40$@grice@logosworld.com>

Oops...I see my mistake...I have "rabbitmq-server" and not
"rabbitmq_server"......all fine now ;-)

 

From: Lynton Grice [mailto:lynton.grice at logosworld.com] 
Sent: 18 June 2009 07:54 AM
To: 'Keith Irwin'
Cc: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: RE: [rabbitmq-discuss] What Erlang client version with RabbitMQ
1.6.0?

 

Hi Keith,

 

Thanks for that, much appreciated. I have downloaded the latest tip of the
client but for some reason this time when I run make I am getting this
error:

 

"can't find include lib "rabbitmq_server/include/rabbit.hrl"

 



 

Last time with version 1.5.5 it compiled fine.....mmmmmm.....

 

This is what my lib folder looks like:

 



 

The server is compiled perfect..for some reason my Erlang environment is not
finding that library.....any ideas?

 

Thanks

 

Lynton

 

 

 

From: Keith Irwin [mailto:keith.irwin at gmail.com] 
Sent: 18 June 2009 07:18 AM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] What Erlang client version with RabbitMQ
1.6.0?

 

I managed to get the "tip" of the rabbitmq-erlang-client to work with 1.6.0.
It's easy to test: just check out the source next to the rabbitmq-server and
rabbitmq-codegen repos, then compile and test.

 

In one window, cd into rabbitmq-server, "make," and "make run".

 

Then, cd into rabbitmq-erlang-client, and "make," then "make test-network".
If you don't get any errors, it worked.

 

Keith

 

On Jun 17, 2009, at 10:13 PM, Lynton Grice wrote:

 

Hi there,

 

I have just installed the RabbitMQ 1.6.0 version on my windows box.

 

Can someone let me know what version of the RabbitMQ Erlang client I can use
now to talk to the server?

 

I am currently using version 1.5.5 of the client...

 

http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/rabbitmq_v1_5_5.zip

 

Thanks for the help

 

Lynton

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/b16f25a7/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 50241 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/b16f25a7/attachment.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 5760 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/b16f25a7/attachment-0001.png 

From matthias at lshift.net  Thu Jun 18 07:37:52 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 18 Jun 2009 07:37:52 +0100
Subject: [rabbitmq-discuss] What Erlang client version with RabbitMQ
	1.6.0?
In-Reply-To: <CCE69334-F1C2-4140-BC5C-C67BE437E94B@gmail.com>
References: <000001c9efd3$7f56e970$7e04bc50$@grice@logosworld.com>
	<CCE69334-F1C2-4140-BC5C-C67BE437E94B@gmail.com>
Message-ID: <4A39E0C0.3080706@lshift.net>

Keith, Lynton, et al,

Keith Irwin wrote:
> I managed to get the "tip" of the rabbitmq-erlang-client to work with 
> 1.6.0.

I have mentioned that a few times before, but here goes again ...

Never ever use the 'tip' of any of our repositories as the basis for any 
work. The 'tip' points to the last commit, which could have happend on 
any, possibly highly experimental, branch. Instead all development work 
must be based on (the tips of) named branches, or tagged revisions.

I have added a note in bold to http://stage.rabbitmq.com/mercurial.html, 
to warn people about this.

In this particular case, tip of 'default' works atm (but may stop doing 
so at some point). I have also just added a rabbitmq_v1_6_0 tag. Use 
that instead.


Matthias.



From keith.irwin at gmail.com  Thu Jun 18 07:48:13 2009
From: keith.irwin at gmail.com (Keith Irwin)
Date: Wed, 17 Jun 2009 23:48:13 -0700
Subject: [rabbitmq-discuss] What Erlang client version with RabbitMQ
	1.6.0?
In-Reply-To: <4A39E0C0.3080706@lshift.net>
References: <000001c9efd3$7f56e970$7e04bc50$@grice@logosworld.com>
	<CCE69334-F1C2-4140-BC5C-C67BE437E94B@gmail.com>
	<4A39E0C0.3080706@lshift.net>
Message-ID: <E8D35663-D5C4-4606-B46E-FCAB4ACB3ECE@gmail.com>

Matthias--

Thanks for the advice. I checked out a fresh copy of the erlang-client  
(and a v1.6.0 version of the server) and didn't see a tag for 1.6.0  
and was prepared to use 1.5.X. I decided to use the tip on a whim, and  
I was quite surprised that the tip worked! It hadn't in previous tests.

Thanks for applying the tag.

My apologies: I know not to use the tip and have read your many  
warnings. I was pretty happy that the tip worked, though. ;)

Next time, I'll try to be a bit more clear, and maybe not write posts  
at the end of a long day.

Keith

On Jun 17, 2009, at 11:37 PM, Matthias Radestock wrote:

> Keith, Lynton, et al,
>
> Keith Irwin wrote:
>> I managed to get the "tip" of the rabbitmq-erlang-client to work  
>> with 1.6.0.
>
> I have mentioned that a few times before, but here goes again ...
>
> Never ever use the 'tip' of any of our repositories as the basis for  
> any work. The 'tip' points to the last commit, which could have  
> happend on any, possibly highly experimental, branch. Instead all  
> development work must be based on (the tips of) named branches, or  
> tagged revisions.
>
> I have added a note in bold to http://stage.rabbitmq.com/mercurial.html 
> , to warn people about this.
>
> In this particular case, tip of 'default' works atm (but may stop  
> doing so at some point). I have also just added a rabbitmq_v1_6_0  
> tag. Use that instead.
>
>
> Matthias.




From alexis.richardson at gmail.com  Thu Jun 18 08:02:47 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 18 Jun 2009 08:02:47 +0100
Subject: [rabbitmq-discuss] What Erlang client version with RabbitMQ
	1.6.0?
In-Reply-To: <4A39E0C0.3080706@lshift.net>
References: <CCE69334-F1C2-4140-BC5C-C67BE437E94B@gmail.com>
	<4A39E0C0.3080706@lshift.net>
Message-ID: <167204d20906180002v147bbf6ela5be2d19619ab593@mail.gmail.com>

On Thu, Jun 18, 2009 at 7:37 AM, Matthias Radestock<matthias at lshift.net> wrote:

> Never ever use the 'tip' of any of our repositories as the basis for any
> work. The 'tip' points to the last commit, which could have happend on
> any, possibly highly experimental, branch. Instead all development work
> must be based on (the tips of) named branches, or tagged revisions.
>
> I have added a note in bold to http://stage.rabbitmq.com/mercurial.html,
> to warn people about this.

Footnote:

The link http://www.rabbitmq.com/mercurial.html will work.

a







> In this particular case, tip of 'default' works atm (but may stop doing
> so at some point). I have also just added a rabbitmq_v1_6_0 tag. Use
> that instead.
>
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From paul.nendick at gmail.com  Thu Jun 18 11:34:14 2009
From: paul.nendick at gmail.com (Paul Nendick)
Date: Thu, 18 Jun 2009 11:34:14 +0100
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <90B71345-F7A4-4373-B0F8-DC08483E1667@gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com> 
	<af1bce590906161527y2ba4d178s6e6dd7b2e30622b4@mail.gmail.com> 
	<af1bce590906162000o771d7b8fr30ae810c4d6a30ca@mail.gmail.com> 
	<90B71345-F7A4-4373-B0F8-DC08483E1667@gmail.com>
Message-ID: <d437de8f0906180334v1b9df70dwf9d282c24eaf10e9@mail.gmail.com>

Wow - that looks great - perfect for those (like me) after some blinky
lights!
/p

2009/6/17 Aaron Feng <aaron.feng at gmail.com>

> Looking good.
>
> Aaron
>
>
> On Jun 16, 2009, at 11:00 PM, "Gavin M. Roy" <gmr at myyearbook.com> wrote:
>
> I wanted to share a screenshot of my progress with you all ;-)
> <http://gmr.privatepaste.com/ad0WYLbxjG>
> http://gmr.privatepaste.com/ad0WYLbxjG
>
> On Tue, Jun 16, 2009 at 6:27 PM, Gavin M. Roy < <gmr at myyearbook.com>
> gmr at myyearbook.com> wrote:
>
>> I have committed my initial working copy of Cony, which is a HTTP based
>> service for providing insight into a running RabbitMQ process.  Right now it
>> only provides JSON output for the rabbit_amqque message, passing back all of
>> the queue data.  The intent is to first expose all of the stats data that
>> one can pull via rabbitmqctl and the to provide a simple web UI with
>> real-time graphing.
>> This is not meant to be an administrative tool, but rather just a tool to
>> get data out for monitoring and trending.
>>
>> It is written in Python and
>> uses py_interface and requires Python 2.6 or higher.
>>
>> You can check it out on github at  <http://myb.me/3c>http://myb.me/3c
>>
>> Regards,
>>
>> Gavin
>>
>>
>>
>>
>> On Tue, Jun 2, 2009 at 11:22 AM, Gavin M. Roy < <gmr at myyearbook.com>
>> gmr at myyearbook.com> wrote:
>>
>>> I'm getting ready to do some production testing of rabbitmq as a
>>> replacement of ActiveMQ.  Beyond rabbitmqctl, I have not been able to
>>> find any real data stubs for monitoring beyond how to write my own
>>> (<http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/>
>>> http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/
>>> ).
>>>  Before I go down the road of writing something I wanted to make sure
>>> there was no pre-existing software since the rabbitmq homepage says
>>> "Extensive facilities for management, monitoring, control and
>>> debugging."  I'm not trying to create a flame war, it's just
>>> rabbitmqctl is not really an enterprise level monitoring tool.
>>>
>>> I'm hoping I'm missing something, any suggestions?
>>>
>>> Gavin
>>>
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/04c32dbf/attachment.htm 

From ryan at acceleration.net  Thu Jun 18 15:59:35 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Thu, 18 Jun 2009 10:59:35 -0400
Subject: [rabbitmq-discuss] problem with hg clone
	http://hg.rabbitmq.com/rabbitmq-dotnet-client/
Message-ID: <4A3A5657.6040503@acceleration.net>

I'm having trouble checking out the .net client source from mercurial, I
get back two different errors this morning:

$ hg clone http://hg.rabbitmq.com/rabbitmq-dotnet-client/
destination directory: rabbitmq-dotnet-client
requesting all changes
adding changesets
adding manifests
adding file changes
transaction abort!
rollback completed
** unknown exception encountered, details follow
** report bug details to http://www.selenic.com/mercurial/bts
** or mercurial at selenic.com
** Mercurial Distributed SCM (version 1.1)
** Extensions loaded:
Traceback (most recent call last):
  File "/usr/bin/hg", line 20, in <module>
    mercurial.dispatch.run()
  File "dispatch.py", line 20, in run
  File "dispatch.py", line 29, in dispatch
  File "dispatch.py", line 45, in _runcatch
  File "dispatch.py", line 367, in _dispatch
  File "dispatch.py", line 416, in _runcommand
  File "dispatch.py", line 376, in checkargs
  File "dispatch.py", line 361, in <lambda>
  File "util.py", line 715, in check
  File "/usr/lib/python2.5/commands.py", line 595, in clone

  File "hg.py", line 215, in clone
  File "localrepo.py", line 2137, in clone
  File "localrepo.py", line 1481, in pull
  File "localrepo.py", line 2029, in addchangegroup
  File "revlog.py", line 1202, in addgroup
  File "changegroup.py", line 31, in chunkiter
  File "changegroup.py", line 21, in getchunk
  File "util.py", line 1662, in read
  File "httprepo.py", line 19, in zgenerator
zlib.error: Error -3 while decompressing: invalid stored block lengths

And later the same day:

$ hg clone http://hg.rabbitmq.com/rabbitmq-dotnet-client/
destination directory: rabbitmq-dotnet-client
requesting all changes
adding changesets
adding manifests
adding file changes
transaction abort!
rollback completed
abort: premature EOF reading chunk (got 1761403 bytes, expected 4715305)

I've tried this using cygwin's hg and TortoiseHG on Windows, and using
hg on ubuntu, all with a similar errors.  A few other things lead me to
believe this is a problem with the configuration of the
rabbitmq-dotnet-client repository:

   1. the zip/bz2/gz archives I can download from
      http://hg.rabbitmq.com/rabbitmq-dotnet-client/ are all corrupt
   2. "hg clone http://hg.rabbitmq.com/rabbitmq-java-client/" works
      perfectly
   3. the zip archive I downloaded from
      http://hg.rabbitmq.com/rabbitmq-java-client/ works perfectly

I'm primarily using cygwin with hg version 1.1. 

Thanks,

-- 
Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/50e31a5d/attachment.htm 

From darien at kindlund.com  Thu Jun 18 18:16:00 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Thu, 18 Jun 2009 13:16:00 -0400
Subject: [rabbitmq-discuss] RabbitMQ 1.6.0 release
In-Reply-To: <4A38D4ED.6020501@lshift.net>
References: <4A38D4ED.6020501@lshift.net>
Message-ID: <50c8ffe90906181016h29e10b1cgf51a57e723125c77@mail.gmail.com>

Hi Matthias,

Thanks for the update!  Couple of questions:
 - If we encounter any similar "persister timeout" errors logged via
STOMP adapter [that we saw in v1.5.x], should we post our findings to
the list?
 - If the persister bug has been fixed, does that mean the
prioritization feature may get added in v1.6.1? ;)
 - Does the STOMP adapter need to be updated/tested before using with
v1.6.0?  If the current version is fine, can Tony tag the latest
stable as rabbitmq_v1_6_0?
- Also, does rabbitmq-c work with v1.6.0?
- Assuming we don't find any bugs with v1.6.0, is the standard
procedure to just mark v1.6.0 status as "stable" (from "beta"), or
were you planning on bumping the version number (and updating the
packages) to reflect a "stable" status?

Regards,
-- Darien

On Wed, Jun 17, 2009 at 7:35 AM, Matthias Radestock<matthias at lshift.net> wrote:
> The RabbitMQ team is pleased to announce the release of RabbitMQ 1.6.0
>
> This release has 'beta' status and introduces a number of new features,
> such as prefetch count limiting, headers exchanges, fine-grained access
> control, and alternate exchanges. There are also improvements to
> performance and stability under high load, improved compatibility with
> other software (such as ejabberd and PowerShell), and a number of small
> bug fixes.
>
> For details see the attached release notes.
>
> Binary and source distributions of the new release can be found in the
> usual place, at http://www.rabbitmq.com/download.html
>
> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release.
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
>
>
> Regards,
>
> The RabbitMQ Team
>
>
> Release: RabbitMQ 1.6.0
> Status : final
>
> Release Highlights
> ==================
>
> server
> ------
> bug fixes
> - eliminate potential memory leak of transactionally published
> ?messages in certain system errors
> - prevent possible starvation of some consumers on channels that get
> ?temporarily blocked due to backlogs
> - do not send more messages to backlogged channels when accepting a
> ?new consumer
> - prevent possible message reordering in the event of temporary node
> ?failure in a clustered setup
> - return 'not_found' error in all cases of 'queue.unbind' attempting
> ?to remove a non-existing binding
>
> enhancements
> - implement AMQP's basic.qos' channel prefetch count limiting
> - implement AMQP 0-9/0-9-1's headers exchange type
> - introduce a permissions system which allows fine-grained access
> ?control on resources involved in AMQP operations. See
> ?http://www.rabbitmq.com/admin-guide.html#access-control for details
> - introduce 'alternate exchanges' to handle messages which are
> ?otherwise unroutable. See
> ?http://www.rabbitmq.com/extensions.html#alternate-exchange for
> ?details
> - improve performance and stability under high load
> - reduce memory consumption
> - prefix all mnesia tables with "rabbit_" in order to prevent name
> ?clashes with other Erlang applications, in particular ejabberd
> - handle rabbitmqctl commands with higher priority, thus ensuring that
> ?answers are returned promptly even under high load
> - reduce severity of "connection closed abruptly" log event from
> ?'error' to 'warning'
>
> Java client
> -----------
> enhancements
> - support extended list of table field types
>
> .net client
> -----------
> bug fixes
> - make unit tests work under .NET 2.0
>
> enhancements
> - rename public fields to avoid name clashes with properties that trip
> ?up tools like PowerShell
> - suppress inclusion of spec comments in generated code due to
> ?licensing issues
> - generate strong named (i.e. signed) assemblies. See the bottom of
> ?http://www.rabbitmq.com/dotnet.html for details
>
> building & packaging
> --------------------
> enhancements
> - introduce wrapper scripts in macports, as in the Debian and RPM
> ?packaging, which ensure the real scripts are run as the right
> ?('rabbitmq') user
> - remove build-time dependency on mnesia
> - trim Debian Erlang package dependencies
> - auto-generate the module list in rabbit.app, thus ensuring it is
> ?always up to date
>
> Upgrading
> =========
>
> When upgrading from releases earlier than 1.5.3, note that the place
> from which the server startup and control scripts source configuration
> information on Unix systems has changed from /etc/default/rabbitmq to
> /etc/rabbitmq/rabbitmq.conf. If you have been using the former, just
> move the file to the latter location. ?The /etc/default/rabbitmq file
> (/etc/sysconfig/rabbitmq on RPM-based systems) is still being sourced
> by the init.d script, but it should only contain settings directly
> affecting the behaviour of the init.d script, such as NODE_COUNT.
>
> The database schema has changed. When the RabbitMQ server detects the
> presence of an old database, it moves it to a backup location, creates
> a fresh, empty database, and logs a warning. If your RabbitMQ
> installation contains important data, such as user accounts, durable
> exchanges and queues, or persistent messages, then we recommend you
> contact support at rabbitmq.com for assistance with the upgrade.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Thu Jun 18 18:46:26 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 18 Jun 2009 18:46:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.6.0 release
In-Reply-To: <50c8ffe90906181016h29e10b1cgf51a57e723125c77@mail.gmail.com>
References: <4A38D4ED.6020501@lshift.net>
	<50c8ffe90906181016h29e10b1cgf51a57e723125c77@mail.gmail.com>
Message-ID: <4A3A7D72.6030700@lshift.net>

Darien,

Darien Kindlund wrote:
>  - If we encounter any similar "persister timeout" errors logged via
> STOMP adapter [that we saw in v1.5.x], should we post our findings to
> the list?

Yes, please.

>  - If the persister bug has been fixed, does that mean the
> prioritization feature may get added in v1.6.1? ;)

I don't expect message priorities to make it into a release in the next
few months, unless market forces (such as somebody paying us money for
that feature, or a revolt by rabbit users ;) require us to alter our plans.

>  - Does the STOMP adapter need to be updated/tested before using with
> v1.6.0?  If the current version is fine, can Tony tag the latest
> stable as rabbitmq_v1_6_0?

The version on 'default' is probably fine but I haven't tested it. If
you can confirm it works then I'd be happy to tag it.

> - Also, does rabbitmq-c work with v1.6.0?

Should do. Nothing has changed in the protocol.

> - Assuming we don't find any bugs with v1.6.0, is the standard
> procedure to just mark v1.6.0 status as "stable" (from "beta"), or
> were you planning on bumping the version number (and updating the
> packages) to reflect a "stable" status?

I doubt 1.6.x will ever become non-beta since there will be a 1.7.0
release along well before I'd feel comfortable removing the beta tag
from 1.6.x.


Matthias.



From darien at kindlund.com  Thu Jun 18 20:06:52 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Thu, 18 Jun 2009 15:06:52 -0400
Subject: [rabbitmq-discuss] RabbitMQ 1.6.0 release
In-Reply-To: <4A3A7D72.6030700@lshift.net>
References: <4A38D4ED.6020501@lshift.net>
	<50c8ffe90906181016h29e10b1cgf51a57e723125c77@mail.gmail.com> 
	<4A3A7D72.6030700@lshift.net>
Message-ID: <50c8ffe90906181206i8a1b94cw76bc6fd2ee6c4db6@mail.gmail.com>

Hi Matthias,

>> ?- If the persister bug has been fixed, does that mean the
>> prioritization feature may get added in v1.6.1? ;)
>
> I don't expect message priorities to make it into a release in the next
> few months, unless market forces (such as somebody paying us money for
> that feature, or a revolt by rabbit users ;) require us to alter our plans.

Okay, understood.  I'll adjust our development schedule accordingly.
I'm pretty sure I can use the headers exchange implementation in order
to implement a "poor man's prioritization" capability, anyway.

>> ?- Does the STOMP adapter need to be updated/tested before using with
>> v1.6.0? ?If the current version is fine, can Tony tag the latest
>> stable as rabbitmq_v1_6_0?
>
> The version on 'default' is probably fine but I haven't tested it. If
> you can confirm it works then I'd be happy to tag it.

Okay, I'll let you know how testing goes.

>> - Also, does rabbitmq-c work with v1.6.0?
>
> Should do. Nothing has changed in the protocol.

Okay.

>> - Assuming we don't find any bugs with v1.6.0, is the standard
>> procedure to just mark v1.6.0 status as "stable" (from "beta"), or
>> were you planning on bumping the version number (and updating the
>> packages) to reflect a "stable" status?
>
> I doubt 1.6.x will ever become non-beta since there will be a 1.7.0
> release along well before I'd feel comfortable removing the beta tag
> from 1.6.x.

Interesting.  So is this your usual development cycle -- reserving
1.even_number == beta and 1.odd_number == stable? (similar to Linux
kernel release versions?)  Just curious.

-- Darien



From bmurphy1976 at gmail.com  Thu Jun 18 20:16:04 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Thu, 18 Jun 2009 14:16:04 -0500
Subject: [rabbitmq-discuss] Message TTL/Expiration
Message-ID: <7fd310d10906181216o767ae8fagb5a23ec91f766bf4@mail.gmail.com>

Hey guys, I'm new to RabbitMQ and am having trouble finding the answer to
this question on Google, so please forgive me if this is old hat.
I'm trying to setup a request/response queue with a TTL on the request
messages.  My client is only going wait 500ms for a response.  If the client
does not get a response in 500ms it's going to bail.  Because of this,
there's no reason for the server to handle messages that have been in the
queue for longer than 500ms.

I've setup a simple test case using SimpleRpcClient and SimpleRpcServer.
 Everything works except message expiration.  All requests sent to the queue
are processed by the server code, regardless of how long they sat in the
queue.  I could, of course, add a timestamp to my message and handle filter
them manually, but I was hoping the RabbitMQ infrastructure could do this
for me.

Here's the client code (C#):

var connectionFactory = new ConnectionFactory();

using (var connection = connectionFactory.CreateConnection("127.0.0.1"))
using (var model = connection.CreateModel())
{
model.ExchangeDeclare("TestExchange", ExchangeType.Direct);
model.QueueDeclare("TestQueue");
model.QueueBind("TestQueue", "TestExchange", "TestRoute", false, null);

var client = new SimpleRpcClient(model, "TestExchange", "TestQueue",
"TestRoute");

client.TimeoutMilliseconds = 500;

var request = Guid.NewGuid().ToString("N");
var requestData = Encoding.UTF32.GetBytes(request);

var requestProperties = model.CreateBasicProperties();
requestProperties.Expiration = "1000";

var responseData = client.Call(requestProperties, requestData);

if (responseData == null)
Console.Out.WriteLine("{0}: Timed Out", request);
else
Console.Out.WriteLine("{0}: {1}", request,
Encoding.UTF32.GetString(responseData.Body));
}

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/0f33320d/attachment.htm 

From matthias at lshift.net  Thu Jun 18 20:35:22 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 18 Jun 2009 20:35:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.6.0 release
In-Reply-To: <50c8ffe90906181206i8a1b94cw76bc6fd2ee6c4db6@mail.gmail.com>
References: <4A38D4ED.6020501@lshift.net>	<50c8ffe90906181016h29e10b1cgf51a57e723125c77@mail.gmail.com>
	<4A3A7D72.6030700@lshift.net>
	<50c8ffe90906181206i8a1b94cw76bc6fd2ee6c4db6@mail.gmail.com>
Message-ID: <4A3A96FA.1060303@lshift.net>

Darien,

Darien Kindlund wrote:
>> I doubt 1.6.x will ever become non-beta since there will be a 1.7.0
>> release along well before I'd feel comfortable removing the beta tag
>> from 1.6.x.
> 
> Interesting.  So is this your usual development cycle -- reserving
> 1.even_number == beta and 1.odd_number == stable? (similar to Linux
> kernel release versions?)  Just curious.

We generally release significant new features frequently enough, or make 
other significant changes, that most releases carry a "beta" or even 
"alpha" status.

IIRC the 1.5.x series is the only one so far that went to "final", and 
that's only because we decided to keep the feature set stable while we 
ironed out the packaging so we could get into Ubuntu, Fedora etc.

That decision actually came at a considerable cost. Maintaining a stable 
branch alongside a development branch slows down development quite a 
bit. And several of the new features which appeared in 1.6.0 could have 
been released months ago if we hadn't had the feature freeze.

I don't know yet when we are next going to make a concerted effort to 
push a release series all the way to "final" status. Generally though, 
as the product matures, the install base grows, etc, I would expect the 
frequency of release series that make it to "final" to increase.


Regards,

Matthias.



From dialtone at gmail.com  Fri Jun 19 03:20:01 2009
From: dialtone at gmail.com (Valentino Volonghi)
Date: Thu, 18 Jun 2009 19:20:01 -0700
Subject: [rabbitmq-discuss] Monitoring options beyond rabbitmqctl
In-Reply-To: <af1bce590906170521w3926687aq7c932d7ff899eb03@mail.gmail.com>
References: <af1bce590906020822q53b9d73fp6f919aa41ab24100@mail.gmail.com>
	<af1bce590906161527y2ba4d178s6e6dd7b2e30622b4@mail.gmail.com>
	<af1bce590906162000o771d7b8fr30ae810c4d6a30ca@mail.gmail.com>
	<1bf8be120906170155r18e8bc2i6fc4d2fb2678837c@mail.gmail.com>
	<af1bce590906170521w3926687aq7c932d7ff899eb03@mail.gmail.com>
Message-ID: <39C3BD43-57B1-4603-AFEA-1050F01B8C9E@gmail.com>


On Jun 17, 2009, at 5:21 AM, Gavin M. Roy wrote:
> Are there other areas you'd like to see?  I was going to work on  
> Connections
> next, but noticed that in my environment, which is currently Stomp  
> only,
> they don't show.  I am working on a new consumer setup here that  
> will be
> AMQP, which I expect does register properly in the connection data.


Another thing is:

mimetypes.guess_type is actually not thread safe, if you look at the  
code
it loads the mime table on the fly, when multiple threads access it at  
the
same time... On OSX it segfaults python 2.6, just returning  
'application/octet-stream'
fixes everything.

Also you are opening files with the 'r' flag. This makes the software  
not correct
under windows, you should use 'rb' and 'wb' for writing files, but  
this is not
fundamental to work.

Good job and thanks :)

--
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090618/b58ac180/attachment.pgp 

From matthias at lshift.net  Fri Jun 19 06:26:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 19 Jun 2009 06:26:12 +0100
Subject: [rabbitmq-discuss] problem with hg clone
	http://hg.rabbitmq.com/rabbitmq-dotnet-client/
In-Reply-To: <4A3A5657.6040503@acceleration.net>
References: <4A3A5657.6040503@acceleration.net>
Message-ID: <4A3B2174.8020408@lshift.net>

Ryan,

Ryan Davis wrote:
> I'm having trouble checking out the .net client source from mercurial
> [...]
> I've tried this using cygwin's hg and TortoiseHG on Windows, and using 
> hg on ubuntu, all with a similar errors.  A few other things lead me to 
> believe this is a problem with the configuration of the 
> rabbitmq-dotnet-client repository:
> 
>    1. the zip/bz2/gz archives I can download from
>       http://hg.rabbitmq.com/rabbitmq-dotnet-client/ are all corrupt
>    2. "hg clone http://hg.rabbitmq.com/rabbitmq-java-client/" works
>       perfectly
>    3. the zip archive I downloaded from
>       http://hg.rabbitmq.com/rabbitmq-java-client/ works perfectly
> 
> I'm primarily using cygwin with hg version 1.1. 

Are you still seeing this problem?

There is nothing special about the .net client repo; the config hasn't 
changed and it gets served by the same software as all the other repos.

What is different though is that the repo is larger than some of the 
other repos. My guess is that either you are experiencing networking 
problems or there is a bug in the hg client.

I suggest trying the following:

- get hold of a more recent version of hg, say 1.2.1
- use a fast, wired connection, from a different location (and 
preferably not behind some corp firewall)


Regards,

Matthias.



From matthias at lshift.net  Fri Jun 19 06:43:25 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 19 Jun 2009 06:43:25 +0100
Subject: [rabbitmq-discuss] Message TTL/Expiration
In-Reply-To: <7fd310d10906181216o767ae8fagb5a23ec91f766bf4@mail.gmail.com>
References: <7fd310d10906181216o767ae8fagb5a23ec91f766bf4@mail.gmail.com>
Message-ID: <4A3B257D.2030305@lshift.net>

Bryan,

Bryan Murphy wrote:
> I've setup a simple test case using SimpleRpcClient and SimpleRpcServer. 
>  Everything works except message expiration.  All requests sent to the 
> queue are processed by the server code, regardless of how long they sat 
> in the queue.  I could, of course, add a timestamp to my message and 
> handle filter them manually, but I was hoping the RabbitMQ 
> infrastructure could do this for me.

RabbitMQ does not (yet) implement message expiration. It's quite high up 
our todo list though and has been requested by a few other users.

Meanwhile, as you say, filtering at the client end is probably your best 
option, and should be fairly straightforward to implement.


Regards,

Matthias.



From alexis.richardson at gmail.com  Fri Jun 19 11:39:11 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 19 Jun 2009 11:39:11 +0100
Subject: [rabbitmq-discuss] pubbing and subbing at the Erlang Factory next
	week
Message-ID: <167204d20906190339x1b765a59v487336b67c2f9711@mail.gmail.com>

Hi folks,

There may be some pubsubbery next week on Thursday evening at the free
"Erlounge" event after Day 1 of the Erlang Factory in Clerkenwell
Green in London.  There are 10 min talks plus free-as-in-beer
refreshments from 6pm to 7:30pm.  All welcome.  Lots of interesting
people are speaking at the main event and so I'd imagine they'll stick
around for the evening.

Sign up here to attend the "Erlounge":
http://www.erlang-consulting.com/erlang/events.html#91

alexis



From celldee at gmail.com  Fri Jun 19 12:21:08 2009
From: celldee at gmail.com (celldee)
Date: Fri, 19 Jun 2009 04:21:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Headers exchange in RabbitMQ v1.6.0
Message-ID: <58b1ced4-6900-43bd-ae3f-5fecce97199c@z7g2000vbh.googlegroups.com>

Hi,

I'm trying to test some Ruby code for a headers exchange example, but
am having no success getting the matching to work. I create the
exchange and bind a queue to it specifying a routing key "h1=a, x-
match=all". Then I publish a message to the exchange specifying a
headers option. The message reaches the queue regardless of the
options that I specify, matching or otherwise.

Has anyone got a working example that I can look at to see where I'm
going wrong? It doesn't matter about the language used.

Regards,

Chris



From matthias at lshift.net  Fri Jun 19 12:36:16 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 19 Jun 2009 12:36:16 +0100
Subject: [rabbitmq-discuss] Headers exchange in RabbitMQ v1.6.0
In-Reply-To: <58b1ced4-6900-43bd-ae3f-5fecce97199c@z7g2000vbh.googlegroups.com>
References: <58b1ced4-6900-43bd-ae3f-5fecce97199c@z7g2000vbh.googlegroups.com>
Message-ID: <4A3B7830.40709@lshift.net>

Chris,

celldee wrote:
> I'm trying to test some Ruby code for a headers exchange example, but
> am having no success getting the matching to work.
> [...]
> Has anyone got a working example that I can look at to see where I'm
> going wrong? It doesn't matter about the language used.

See
http://hg.rabbitmq.com/rabbitmq-java-client/annotate/rabbitmq_v1_6_0/test/src/com/rabbitmq/client/test/functional/Routing.java#l168


Matthias.



From alexis.richardson at gmail.com  Fri Jun 19 12:54:37 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 19 Jun 2009 12:54:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET deadlock after calling
	.CreateConnection
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAOT+KPvJpqVHkPHiM6qtoMkBAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAOT+KPvJpqVHkPHiM6qtoMkBAAAAAA==@oryo.lt>
Message-ID: <167204d20906190454g375d3fe4x5d3113102c63b0da@mail.gmail.com>

Andrius

I just noticed nobody has replied to this thread.

Any thoughts on this anyone?

alexis


On Thu, Jun 11, 2009 at 4:18 PM, Andrius
Norkaitis<andrius.norkaitis at oryo.lt> wrote:
> Any thoughts why this deadlocks may occur? The most problematic is that this deadlocks occurs rarely and at client's site... (after long monitoring it occurred on our machine too).
>
> I have attached the source. Your help would be very appreciated.
>
> Thanks.
>
> Andrius
>
>
> -----Original Message-----
> From: Ryan Davis [mailto:ryan at acceleration.net]
> Sent: Monday, June 08, 2009 5:21 PM
> To: Andrius Norkaitis
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [Spam] [rabbitmq-discuss] RabbitMQ .NET Client sometimes hangs up
>
> Would it be possible to post your code? ?I use the .NET client in a similar way, spawning many threads each calling CreateConnection. ?I've simulated network problems by restarting my RabbitMQ server, and I see the .NET client throwing exceptions when it fails.
>
> Thanks,
>
> Ryan Davis
> Acceleration.net
> Director of Programming Services
> 2831 NW 41st street, suite B
> Gainesville, FL 32606
>
> Office: 352-335-6500 x 124
> Fax: 352-335-6506
>
>
>
> Andrius Norkaitis wrote:
>> I think no. All rabbit code is in try/catch and nothing is logged in catch statement. Otherwise, if .net rabbit client method CreateConnection does some asynchronous stuff (haven't watch at a source deeply), errors may not be caught and in this case thread may halt, I think.
>>
>> -----Original Message-----
>> From: Ryan Davis [mailto:ryan at acceleration.net]
>> Sent: Monday, June 08, 2009 4:06 PM
>> To: Andrius Norkaitis
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [Spam] [rabbitmq-discuss] RabbitMQ .NET Client sometimes
>> hangs up
>>
>> Is the thread throwing an exception before it halts?
>>
>> Thanks,
>>
>> Ryan Davis
>> Acceleration.net
>> Director of Programming Services
>> 2831 NW 41st street, suite B
>> Gainesville, FL 32606
>>
>> Office: 352-335-6500 x 124
>> Fax: 352-335-6506
>>
>>
>>
>> Andrius Norkaitis wrote:
>>
>>> Hello,
>>>
>>> I can?t find the problem and how to fix it so your help would be very appreciated.
>>>
>>> Our .net client starts new thread which loops calling ConnectAndListen method (loop is for automatic reconnect). In ConnectAndListen method we create new connection and model, bind to queries and listen for messages ("foreach (BasicDeliverEventArgs ee in subscription)").
>>>
>>> Everything works like it has, but for sometimes unknown reason sometime client does not reconnect and hangs. It's not always and depends on network disturbances, so can?t easily debug. What I figured out, that thread halts after this statement is called:
>>>
>>> using (conn = cf.CreateConnection(serverAddress))
>>>
>>>
>>> Any thoughts what can cause it and how to fix it?
>>>
>>>
>>> Best regards
>>> Andrius
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From celldee at gmail.com  Fri Jun 19 12:55:15 2009
From: celldee at gmail.com (celldee)
Date: Fri, 19 Jun 2009 04:55:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Headers exchange in RabbitMQ v1.6.0
In-Reply-To: <4A3B7830.40709@lshift.net>
References: <58b1ced4-6900-43bd-ae3f-5fecce97199c@z7g2000vbh.googlegroups.com>
	<4A3B7830.40709@lshift.net>
Message-ID: <a4514ab9-8adb-4d2a-b86e-ea843f675547@q37g2000vbi.googlegroups.com>

Matthias

On Jun 19, 12:36?pm, Matthias Radestock <matth... at lshift.net> wrote:
> Chris,
>
> celldee wrote:
> > I'm trying to test some Ruby code for a headers exchange example, but
> > am having no success getting the matching to work.
> > [...]
> > Has anyone got a working example that I can look at to see where I'm
> > going wrong? It doesn't matter about the language used.
>
> Seehttp://hg.rabbitmq.com/rabbitmq-java-client/annotate/rabbitmq_v1_6_0/...
>

Thanks very much. That example cleared up my confusion. I needed to
use the arguments option to specify the matching criteria when binding
the queue.

Regards,

Chris



From ryan at acceleration.net  Fri Jun 19 14:06:05 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Fri, 19 Jun 2009 09:06:05 -0400
Subject: [rabbitmq-discuss] problem with hg clone
	http://hg.rabbitmq.com/rabbitmq-dotnet-client/
In-Reply-To: <4A3B2174.8020408@lshift.net>
References: <4A3A5657.6040503@acceleration.net> <4A3B2174.8020408@lshift.net>
Message-ID: <4A3B8D3D.4070807@acceleration.net>

I am on a fast, wired connection, and still no dice with hg 1.2.1 /cygwin:

$ hg clone http://hg.rabbitmq.com/rabbitmq-dotnet-client/
destination directory: rabbitmq-dotnet-client
requesting all changes
adding changesets
adding manifests
adding file changes
transaction abort!
rollback completed
** unknown exception encountered, details follow
** report bug details to http://www.selenic.com/mercurial/bts
** or mercurial at selenic.com
** Mercurial Distributed SCM (version 1.2.1)
** Extensions loaded:
Traceback (most recent call last):
  File "/usr/bin/hg", line 5, in <module>
    pkg_resources.run_script('mercurial==unknown', 'hg')
  File "build/bdist.linux-i686/egg/pkg_resources.py", line 448, in
run_script
  File "build/bdist.linux-i686/egg/pkg_resources.py", line 1166, in
run_script
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/EGG-INFO/scripts/hg",
line 27, in <module>
    mercurial.dispatch.run()
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
line 16, in run
    sys.exit(dispatch(sys.argv[1:]))
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
line 25, in dispatch
    return _runcatch(u, args)
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
line 41, in _runcatch
    return _dispatch(ui, args)
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
line 372, in _dispatch
    return runcommand(lui, repo, cmd, fullargs, ui, options, d)
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
line 247, in runcommand
    ret = _runcommand(ui, options, cmd, d)
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
line 417, in _runcommand
    return checkargs()
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
line 377, in checkargs
    return cmdfunc()
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
line 371, in <lambda>
    d = lambda: util.checksignature(func)(ui, *args, **cmdoptions)
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/util.py",
line 718, in check
    return func(*args, **kwargs)
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/commands.py",
line 603, in clone
    update=not opts.get('noupdate'))
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/hg.py",
line 215, in clone
    dest_repo.clone(src_repo, heads=revs, stream=stream)
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/localrepo.py",
line 2152, in clone
    return self.pull(remote, heads)
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/localrepo.py",
line 1495, in pull
    return self.addchangegroup(cg, 'pull', remote.url())
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/localrepo.py",
line 2043, in addchangegroup
    if fl.addgroup(chunkiter, revmap, trp) is None:
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/revlog.py",
line 1192, in addgroup
    for chunk in revs:
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/changegroup.py",
line 31, in chunkiter
    c = getchunk(source)
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/changegroup.py",
line 21, in getchunk
    d = source.read(l - 4)
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/util.py",
line 1674, in read
    for chunk in self.iter:
  File
"/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/httprepo.py",
line 18, in zgenerator
    yield zd.decompress(chunk)
zlib.error: Error -3 while decompressing: invalid code lengths set

I'll try a different network this weekend.

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506



Matthias Radestock wrote:
> Ryan,
>
> Ryan Davis wrote:
>> I'm having trouble checking out the .net client source from mercurial
>> [...]
>> I've tried this using cygwin's hg and TortoiseHG on Windows, and
>> using hg on ubuntu, all with a similar errors.  A few other things
>> lead me to believe this is a problem with the configuration of the
>> rabbitmq-dotnet-client repository:
>>
>>    1. the zip/bz2/gz archives I can download from
>>       http://hg.rabbitmq.com/rabbitmq-dotnet-client/ are all corrupt
>>    2. "hg clone http://hg.rabbitmq.com/rabbitmq-java-client/" works
>>       perfectly
>>    3. the zip archive I downloaded from
>>       http://hg.rabbitmq.com/rabbitmq-java-client/ works perfectly
>>
>> I'm primarily using cygwin with hg version 1.1. 
>
> Are you still seeing this problem?
>
> There is nothing special about the .net client repo; the config hasn't
> changed and it gets served by the same software as all the other repos.
>
> What is different though is that the repo is larger than some of the
> other repos. My guess is that either you are experiencing networking
> problems or there is a bug in the hg client.
>
> I suggest trying the following:
>
> - get hold of a more recent version of hg, say 1.2.1
> - use a fast, wired connection, from a different location (and
> preferably not behind some corp firewall)
>
>
> Regards,
>
> Matthias.



From michael.greene at gmail.com  Fri Jun 19 14:17:22 2009
From: michael.greene at gmail.com (Michael Greene)
Date: Fri, 19 Jun 2009 08:17:22 -0500
Subject: [rabbitmq-discuss] problem with hg clone
	http://hg.rabbitmq.com/rabbitmq-dotnet-client/
In-Reply-To: <4A3B8D3D.4070807@acceleration.net>
References: <4A3A5657.6040503@acceleration.net> <4A3B2174.8020408@lshift.net>
	<4A3B8D3D.4070807@acceleration.net>
Message-ID: <f4d6a21a0906190617i61a63b2ekc9683cf9bcdbf4a9@mail.gmail.com>

This similar issue was reported back in March and never resolved:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-March/003493.html

Every once in awhile (25% maybe?) a rabbitmq-dotnet-client clone works
for me, regardless of OS or network location.  I'd recommend trying
again.

Michael

On Fri, Jun 19, 2009 at 8:06 AM, Ryan Davis<ryan at acceleration.net> wrote:
> I am on a fast, wired connection, and still no dice with hg 1.2.1 /cygwin:
>
> $ hg clone http://hg.rabbitmq.com/rabbitmq-dotnet-client/
> destination directory: rabbitmq-dotnet-client
> requesting all changes
> adding changesets
> adding manifests
> adding file changes
> transaction abort!
> rollback completed
> ** unknown exception encountered, details follow
> ** report bug details to http://www.selenic.com/mercurial/bts
> ** or mercurial at selenic.com
> ** Mercurial Distributed SCM (version 1.2.1)
> ** Extensions loaded:
> Traceback (most recent call last):
> ?File "/usr/bin/hg", line 5, in <module>
> ? ?pkg_resources.run_script('mercurial==unknown', 'hg')
> ?File "build/bdist.linux-i686/egg/pkg_resources.py", line 448, in
> run_script
> ?File "build/bdist.linux-i686/egg/pkg_resources.py", line 1166, in
> run_script
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/EGG-INFO/scripts/hg",
> line 27, in <module>
> ? ?mercurial.dispatch.run()
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
> line 16, in run
> ? ?sys.exit(dispatch(sys.argv[1:]))
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
> line 25, in dispatch
> ? ?return _runcatch(u, args)
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
> line 41, in _runcatch
> ? ?return _dispatch(ui, args)
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
> line 372, in _dispatch
> ? ?return runcommand(lui, repo, cmd, fullargs, ui, options, d)
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
> line 247, in runcommand
> ? ?ret = _runcommand(ui, options, cmd, d)
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
> line 417, in _runcommand
> ? ?return checkargs()
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
> line 377, in checkargs
> ? ?return cmdfunc()
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/dispatch.py",
> line 371, in <lambda>
> ? ?d = lambda: util.checksignature(func)(ui, *args, **cmdoptions)
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/util.py",
> line 718, in check
> ? ?return func(*args, **kwargs)
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/commands.py",
> line 603, in clone
> ? ?update=not opts.get('noupdate'))
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/hg.py",
> line 215, in clone
> ? ?dest_repo.clone(src_repo, heads=revs, stream=stream)
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/localrepo.py",
> line 2152, in clone
> ? ?return self.pull(remote, heads)
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/localrepo.py",
> line 1495, in pull
> ? ?return self.addchangegroup(cg, 'pull', remote.url())
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/localrepo.py",
> line 2043, in addchangegroup
> ? ?if fl.addgroup(chunkiter, revmap, trp) is None:
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/revlog.py",
> line 1192, in addgroup
> ? ?for chunk in revs:
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/changegroup.py",
> line 31, in chunkiter
> ? ?c = getchunk(source)
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/changegroup.py",
> line 21, in getchunk
> ? ?d = source.read(l - 4)
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/util.py",
> line 1674, in read
> ? ?for chunk in self.iter:
> ?File
> "/usr/lib/python2.5/site-packages/mercurial-unknown-py2.5-cygwin-1.5.25-i686.egg/mercurial/httprepo.py",
> line 18, in zgenerator
> ? ?yield zd.decompress(chunk)
> zlib.error: Error -3 while decompressing: invalid code lengths set
>
> I'll try a different network this weekend.
>
> Thanks,
>
> Ryan Davis
> Acceleration.net
> Director of Programming Services
> 2831 NW 41st street, suite B
> Gainesville, FL 32606
>
> Office: 352-335-6500 x 124
> Fax: 352-335-6506
>
>
>
> Matthias Radestock wrote:
>> Ryan,
>>
>> Ryan Davis wrote:
>>> I'm having trouble checking out the .net client source from mercurial
>>> [...]
>>> I've tried this using cygwin's hg and TortoiseHG on Windows, and
>>> using hg on ubuntu, all with a similar errors. ?A few other things
>>> lead me to believe this is a problem with the configuration of the
>>> rabbitmq-dotnet-client repository:
>>>
>>> ? ?1. the zip/bz2/gz archives I can download from
>>> ? ? ? http://hg.rabbitmq.com/rabbitmq-dotnet-client/ are all corrupt
>>> ? ?2. "hg clone http://hg.rabbitmq.com/rabbitmq-java-client/" works
>>> ? ? ? perfectly
>>> ? ?3. the zip archive I downloaded from
>>> ? ? ? http://hg.rabbitmq.com/rabbitmq-java-client/ works perfectly
>>>
>>> I'm primarily using cygwin with hg version 1.1.
>>
>> Are you still seeing this problem?
>>
>> There is nothing special about the .net client repo; the config hasn't
>> changed and it gets served by the same software as all the other repos.
>>
>> What is different though is that the repo is larger than some of the
>> other repos. My guess is that either you are experiencing networking
>> problems or there is a bug in the hg client.
>>
>> I suggest trying the following:
>>
>> - get hold of a more recent version of hg, say 1.2.1
>> - use a fast, wired connection, from a different location (and
>> preferably not behind some corp firewall)
>>
>>
>> Regards,
>>
>> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthias at lshift.net  Fri Jun 19 14:36:28 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 19 Jun 2009 14:36:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ .NET deadlock after calling
	.CreateConnection
In-Reply-To: <167204d20906190454g375d3fe4x5d3113102c63b0da@mail.gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAOT+KPvJpqVHkPHiM6qtoMkBAAAAAA==@oryo.lt>
	<167204d20906190454g375d3fe4x5d3113102c63b0da@mail.gmail.com>
Message-ID: <4A3B945C.7010807@lshift.net>

Alexis,

Alexis Richardson wrote:
> I just noticed nobody has replied to this thread.

Actually that thread got continued at
  http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-June/004192.html

to which I responded here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-June/004218.html

For some reason Nabble has put that message in the wrong thread:

http://www.nabble.com/RabbitMQ-stomp-adapter-behaviour-td23917501.html#a23997427

which probably explains why you thought nobody had responded.


Matthias.



From peter.fischer at gbconsite.de  Fri Jun 19 15:16:48 2009
From: peter.fischer at gbconsite.de (Peter Fischer (gb consite GmbH))
Date: Fri, 19 Jun 2009 16:16:48 +0200
Subject: [rabbitmq-discuss] AMQP 0.9 CLI client
Message-ID: <4A3B9DD0.5080501@gbconsite.de>

Hi list!

I'm currently trying to get myself acustomed to rabbitMQ and AMQP.

It seems to me that there is no binary executable CLI client availible
which is able to work with the current AMQP 0.9 implementation in
rabbitMQ (and adequate to reuse some proven hives of shell scripts
within an AMQPed infrastructure).
I read about an OpenAMQP CLI client, but it seems to speak an advanced
version of AMQP already, which rabbitMQ is not able to answer yet (if I
understood correctly).

Any hints/pointers for me?

Cheers,
    Peter



From pekenney at gmail.com  Fri Jun 19 23:55:25 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Fri, 19 Jun 2009 15:55:25 -0700
Subject: [rabbitmq-discuss] Max Message Size
Message-ID: <3a5f03340906191555l7c1a553jc8067a01b3820184@mail.gmail.com>

Looking for Max Message Size and other capacities...

thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090619/8d6e9997/attachment.htm 

From celldee at gmail.com  Sat Jun 20 02:39:57 2009
From: celldee at gmail.com (celldee)
Date: Fri, 19 Jun 2009 18:39:57 -0700 (PDT)
Subject: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap Questions)
In-Reply-To: <167204d20906040549q6ccabf26r2e7240fbf1298446@mail.gmail.com>
References: <167204d20906040549q6ccabf26r2e7240fbf1298446@mail.gmail.com>
Message-ID: <b7d14f99-b62b-4664-829e-2414d2577afb@h23g2000vbc.googlegroups.com>

Alexis,

On Jun 4, 1:49?pm, Alexis Richardson <alexis.richard... at gmail.com>
wrote:
> Hi all,
>
> Just to add some colour to what Matthias said below, here are some
> comments about backwards compatibility, and about AMQP spec versions.
>
> On Wed, Jun 3, 2009 at 11:53 AM, Matthias Radestock <matth... at lshift.net> wrote:
> >> 3) Clean compatibility with OpenAMQ's C library (aka WireAPI?) -- or
> >> clean compatibility with *some* type of C-based library that is
> >> compatible with a recent version of RabbitMQ (maybe:
> >>http://hg.rabbitmq.com/rabbitmq-c/?)
>
> > #3 hasn't been asked for much, so it's currently a low priority task.
> > Having said that, any feedback on the experimental rabbitmq-c client is
> > of course welcome. Also, we are aiming for compatibility with OpenAMQ
> > when RabbitMQ implements AMQP 0-9-1.
>
> The key point here is that we are converging on AMQP 0-9-1 and this
> will mean a much greater degree of interoperability. ?The aim is for
> clients and brokers to work together out of the box, no matter who
> made them. ?In practice some edge cases won't work, and some code will
> implement a subset of 0-9-1, but we have convinced ourselves that this
> is going to make everyone's lives much easier and lead to greater
> choice for users.
>
> 0-9-1 is coming very soon now (I'm avoiding dates for the usual
> reasons...). ?You may be able to help it come sooner.
>
> Calling everyone - PLEASE do step up here. ?We are looking for people
> to help with 0-9-1 especially interop testing, and client migration.
> Speak out on the list or contact me if for some reason you cannot do
> the former.
>
> >> Can someone let me know if any of these features will be backported to
> >> a future v1.5.x release?
>
> > I do not anticipate any more v1.5.x releases, and if there are any they
> > will be for low-risk/high-impact bug fixes only.
>
> To add to Matthias' comment: people in the community are of course
> extremely welcome to help out here. ?Obviously we can only do so much
> and want to focus on the core features people are asking for. ?We are
> of course happy to help people out on the list. ?If you want some
> level of support that the list cannot give, let us know.
>
> In the case of 0-9-1 some people will migrate and some people will
> stay on 0-8. ?Looking for feedback here: what do people want to do
> about 0-9-1 migration vs staying on older versions?
>

I'm currently looking at enabling the Bunny Ruby AMQP client to use
either 0-8 or 0-9-1 depending on a user supplied option. I've started
to do some interop testing against Qpid 0.5 with a view to tackling
OpenAMQ later. I would be happy to help out if I can.

Is there a version of RabbitMQ that I can test 0-9-1 functionality
against. I have v1.6.0, can I use that? I've tried but can't get a
connection/channel going. Not sure if I'm sending the correct
information to initiate a communication session.

Regards,

Chris



From dialtone at gmail.com  Sat Jun 20 03:38:02 2009
From: dialtone at gmail.com (Valentino Volonghi)
Date: Fri, 19 Jun 2009 19:38:02 -0700
Subject: [rabbitmq-discuss] Request for comments
Message-ID: <CE3F8934-7DB6-4A8B-B254-0CFB308B064C@gmail.com>

So... As everybody these days I'm writing a task queue, the thing that  
is different
from the other alternatives (that I also have written myself) is that  
this one is
kind of a copy of ideas coming from the just released google app  
engine taskqueue.

First of all... the name is quebert and you can find it here:
http://bitbucket.org/adroll/quebert/

I'm writing in RabbitMQ-discuss because the project uses AMQP (and  
I've tested it
with RabbitMQ 1.6.0 [minimum required for one feature]) as a distributed
transactional queue, and also because here there are probably many many
developers that are doing something similar.

So how does the system work... Essentially it's explained here:
http://googleappengine.blogspot.com/2009/06/new-task-queue-api-on-google-app-engine.html

There are 3 components in this system:

  - a queue of tasks
  - some dispatcher
  - something that executes tasks from web requests

How does this work:

  - When somebody adds a task, it mainly pushes a URL that should be  
requested by the
    dispatcher.

  - the dispatcher gets the task and makes the request

  - If the task completes successfully (with a 200) then it's  
considered completed, otherwise
     it's rescheduled.

Now... My small project, the actual code is around 250 lines in  
Twisted Matrix plus
roughly the same number for a small wrapper against txamqp (must get  
this fresh
from launchpad until they release the next one), has a couple of extras:

- It's more like a framework rather than an end user application and  
you have full control
over the dispatcher (called mediator). For example it's trivial to  
implement a mediator that
does exponential backoff in case of failures (in fact it's already  
implemented and it's roughly
30 lines of code including comments).

- It includes pre and post execution hooks so that you can easily  
update the task status
on an external service, or filter tasks that you don't want to run  
anymore or update other
kinds of counters etc. etc.

- It implements time to live (and you can easily implement priorities  
like in the example)
   using timestamps even if rabbitmq doesn't support it. The added  
cost is trivial for this kind
   of use.

  - If you need it, it uses basic_qos.prefetch_count to limit the  
number of events that each
    listener receives concurrently (the mediator itself has no such  
limit).

There are many nice things that come with a queue done with HTTP  
everywhere:
-  you can reuse existing tools!
    For example you might have a load balancer that keeps track of  
machine load or response
    time or any other metric (like what elastic load balancer does on  
AWS) and have that guy
    route the task request to the freshest worker machine.

- You can easily write executors in the language that you need for  
that specific task, it just
    needs an HTTP server and some encode/decoder for the wire format  
(by default JSON).

- The executors don't even need to be in the same network since the  
HTTP request can go
    anywhere and since it's created just when you need it and only for  
the time it takes to execute
    it there's no added cost for maintaining it open.

And I'm pretty sure there are many other cool things you can think of  
for your specific case.

The project has still one small bit of problem and that would be  
unittests that I still need to
write... lazy... But I'll do that soon. However the source code is  
pretty well formatted and
fully documented in all the obscure places. I would like comments from  
anybody interested
or not interested so that I can cover the most usecases possible.

Now... given that this guy doesn't need to keep track of machine load  
for load balancing or
other things and it's actually fairly simple and requires just a  
little bit of knowledge to be
used, and almost no deployment complexity, taking from one of the  
examples:

This is an example of a custom dispatcher that backoffs exponentially
on failures, prints before and after the task is executed and supports
3 different priority levels with 5 events concurrently in each.

http://bitbucket.org/adroll/quebert/src/tip/examples/med.py

from twisted.internet import reactor
from twisted.python import log

from quebert import amqp, mediator
def _run():
     username = "guest"
     password = "guest"
     host = "localhost"
     exchange = "flow"

     def pre_hook(task):
         log.msg("I'm about to execute this %s" % (task,))

     def post_process(task, result):
         log.msg("Result for task %s is %s" % (task, result))

     m = mediator.DelayOnErrorMediator()
     m.add_prehook(pre_hook)

     m.add_posthook(post_process)

     def onConnectionError(e):
         log.err(e)

     client = amqp.TxAMQPClient(host, username, password)
     routingKeys = [("tasks.high", "high-priority-queue"),
                    ("tasks.medium", "medium-priority-queue"),
                    ("tasks.low", "low-priority-queue")]

     for key, queue in routingKeys:
         client.watch(exchange, queue, key, m.messageReceived,
                      onDisconnect=onConnectionError, maxEvents=5
                      ).addErrback(onConnectionError)

import sys
log.startLogging(sys.stdout)
reactor.callLater(0, _run)
reactor.run()


--
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090619/8b2831f1/attachment.pgp 

From terry at jon.es  Sat Jun 20 03:51:41 2009
From: terry at jon.es (Terry Jones)
Date: Sat, 20 Jun 2009 04:51:41 +0200
Subject: [rabbitmq-discuss] Request for comments
In-Reply-To: Your message at 19:38:02 on Friday, 19 June 2009
References: <CE3F8934-7DB6-4A8B-B254-0CFB308B064C@gmail.com>
Message-ID: <19004.20157.129910.430975@jon.es>

Hi Valentino

>>>>> "Valentino" == Valentino Volonghi <dialtone at gmail.com> writes:
Valentino> - When somebody adds a task, it mainly pushes a URL that should
Valentino> be requested by the dispatcher.
Valentino> - the dispatcher gets the task and makes the request
Valentino> - If the task completes successfully (with a 200) then it's
Valentino> considered completed, otherwise it's rescheduled.

Cool! I can think of uses for it immediately, such as dealing with getting
things into Amazon S3 in the face of occasional transient failures /
unavailability.

Valentino> Now... My small project, the actual code is around 250 lines in
Valentino> Twisted Matrix plus roughly the same number for a small wrapper
Valentino> against txamqp (must get this fresh from launchpad until they
Valentino> release the next one)

Please do update on txAMQP. Esteve has been merging in various enhancements
recently.  It would be good to know what else might be added to help you
use it, to have your opinions, code, etc.

Terry



From matthew at lshift.net  Sat Jun 20 11:53:16 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Sat, 20 Jun 2009 11:53:16 +0100
Subject: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap Questions)
In-Reply-To: <b7d14f99-b62b-4664-829e-2414d2577afb@h23g2000vbc.googlegroups.com>
References: <167204d20906040549q6ccabf26r2e7240fbf1298446@mail.gmail.com>
	<b7d14f99-b62b-4664-829e-2414d2577afb@h23g2000vbc.googlegroups.com>
Message-ID: <20090620105316.GA9338@wellquite.org>

Hi Chris,

On Fri, Jun 19, 2009 at 06:39:57PM -0700, celldee wrote:
> Is there a version of RabbitMQ that I can test 0-9-1 functionality
> against. I have v1.6.0, can I use that? I've tried but can't get a
> connection/channel going. Not sure if I'm sending the correct
> information to initiate a communication session.

No, v1.6 does not contain 0-9-1, it's still 0-8. 0-9-1 work is in
development but is not going to appear until at least v1.8 as we pretty
much already have a good idea as to what we're planning for v1.7.
However, don't let that scare you, as Matthias mentioned, v1.5 has taken
much more time than we had wanted, so we are not expecting v1.6 or v1.7
to take as much time. I.e. don't try and use the gap between v1.5 and
v1.6 to estimate the gaps between v1.6 and v1.7 or later.

Matthew



From digitalwarfare at gmail.com  Sun Jun 21 19:05:28 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Sun, 21 Jun 2009 11:05:28 -0700
Subject: [rabbitmq-discuss] RabbitMQ consumer connection issue
Message-ID: <376f3e6f0906211105l12edd1e5p5ce64966c1748837@mail.gmail.com>

Is there a way to detect if the connection has been severed during a
channel.wait()?

Suhail
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090621/ddbfd730/attachment.htm 

From jack at collecta.com  Mon Jun 22 00:55:01 2009
From: jack at collecta.com (Jack Moffitt)
Date: Sun, 21 Jun 2009 17:55:01 -0600
Subject: [rabbitmq-discuss] my gen_fsm's supervisor getting channel 'DOWN'
	messages
Message-ID: <9b58f4550906211655k6b5440cdw92c71c02d16737f4@mail.gmail.com>

I have a gen_fsm that monitors a rabbitmq queue.  Everything works
fine unti lthere is an error.

When I connect and open the channel, I put a monitor on it so that I
get a 'DOWN' message when the channel dies.  Before I down the channel
myself, I always demonitor the reference.

Unfortunately, for some reason whenever I close the channel and
connection, the supervisor starts trying to shut down my process.  I'm
opening the connection with start() not start_link(), so I don't
understand why my supervisor is being notified about AMQP connection
process states.

This is actually causing us serious problems because Erlang
supervisors can't do backoff, so this usually results in the
supervisor exceeding the restart limits and terminating the whole
application.

Any ideas?

jack.



From tonyg at lshift.net  Mon Jun 22 16:58:50 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 22 Jun 2009 16:58:50 +0100
Subject: [rabbitmq-discuss] AMQP 0.9 CLI client
In-Reply-To: <4A3B9DD0.5080501@gbconsite.de>
References: <4A3B9DD0.5080501@gbconsite.de>
Message-ID: <4A3FAA3A.7050406@lshift.net>

Peter Fischer (gb consite GmbH) wrote:
> It seems to me that there is no binary executable CLI client availible

Try rabbitmq-c:

hg clone http://hg.rabbitmq.com/rabbitmq-codegen
hg clone http://hg.rabbitmq.com/rabbitmq-c
cd rabbitmq-c
autoreconf -i
./configure
make
./examples/amqp_listen dev.rabbitmq.com 5672 amq.rabbitmq.log error

There are other examples in the ./examples directory.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Mon Jun 22 17:20:56 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 22 Jun 2009 17:20:56 +0100
Subject: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap Questions)
In-Reply-To: <b7d14f99-b62b-4664-829e-2414d2577afb@h23g2000vbc.googlegroups.com>
References: <167204d20906040549q6ccabf26r2e7240fbf1298446@mail.gmail.com>
	<b7d14f99-b62b-4664-829e-2414d2577afb@h23g2000vbc.googlegroups.com>
Message-ID: <4A3FAF68.1000601@lshift.net>

celldee wrote:
> Is there a version of RabbitMQ that I can test 0-9-1 functionality
> against. I have v1.6.0, can I use that? I've tried but can't get a
> connection/channel going. Not sure if I'm sending the correct
> information to initiate a communication session.

Please try the "amqp_0_9_1" branch(es). You'll need both
rabbitmq-codegen and rabbitmq-server from mercurial, both on the
"amqp_0_9_1" branch.

I'm very keen to hear how you get on! :-) Bug reports especially welcome.

We periodically merge the "default" branch into the "amqp_0_9_1" branch,
so that it tracks (roughly) the ongoing development and bugfixing work
from the mainline (0-8) release.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Mon Jun 22 17:27:03 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 22 Jun 2009 17:27:03 +0100
Subject: [rabbitmq-discuss] Fwd: rabbit MQ high-through put stock quotes
In-Reply-To: <35ABC959-4B2B-4969-A740-67D76FB4A0F6@mac.com>
References: <994147BB-CD16-40E3-AFC9-1F2A6AC5FF04@mac.com>
	<35ABC959-4B2B-4969-A740-67D76FB4A0F6@mac.com>
Message-ID: <4A3FB0D7.2010208@lshift.net>

Hi Chuck,

Chuck Remes wrote:
>> With that out of the way, I would suggest a fanout exchange per
>> high-volume symbol. [...]
>> Alternately, you could use a direct exchange for the low-volume
>> stocks.

RabbitMQ should be about as fast with direct as with fanout exchanges.

To find a list of matching queues for a publish to a fanout exchange, it
searches a mnesia table indexed by exchange name, and for direct
exchanges, it searches a table indexed by the pair of (exchange name,
routing key) -- in both cases it's effectively a simple "dictionary"
lookup resulting in a list of queue names.

The implementation of topic exchanges is quite different (and quite a
bit slower!), but broadly speaking, direct and fanout exchanges should
be en par with each other, performance-wise.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From celldee at gmail.com  Mon Jun 22 18:38:02 2009
From: celldee at gmail.com (Chris Duncan)
Date: Mon, 22 Jun 2009 18:38:02 +0100
Subject: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap Questions)
In-Reply-To: <4A3FAF68.1000601@lshift.net>
References: <167204d20906040549q6ccabf26r2e7240fbf1298446@mail.gmail.com>
	<b7d14f99-b62b-4664-829e-2414d2577afb@h23g2000vbc.googlegroups.com>
	<4A3FAF68.1000601@lshift.net>
Message-ID: <0BEB0DC1-33FE-4BAD-8558-E47479E9D251@gmail.com>

Hi Tony,

On 22 Jun 2009, at 17:20, Tony Garnock-Jones wrote:

> celldee wrote:
>> Is there a version of RabbitMQ that I can test 0-9-1 functionality
>> against. I have v1.6.0, can I use that? I've tried but can't get a
>> connection/channel going. Not sure if I'm sending the correct
>> information to initiate a communication session.
>
> Please try the "amqp_0_9_1" branch(es). You'll need both
> rabbitmq-codegen and rabbitmq-server from mercurial, both on the
> "amqp_0_9_1" branch.
>
> I'm very keen to hear how you get on! :-) Bug reports especially  
> welcome.
>
> We periodically merge the "default" branch into the "amqp_0_9_1"  
> branch,
> so that it tracks (roughly) the ongoing development and bugfixing work
> from the mainline (0-8) release.
>
>

Thanks for the info. I'll let you know how I get on.

Regards,

Chris






From cremes.devlist at mac.com  Mon Jun 22 18:45:10 2009
From: cremes.devlist at mac.com (Chuck Remes)
Date: Mon, 22 Jun 2009 12:45:10 -0500
Subject: [rabbitmq-discuss] Fwd: rabbit MQ high-through put stock quotes
In-Reply-To: <4A3FB0D7.2010208@lshift.net>
References: <994147BB-CD16-40E3-AFC9-1F2A6AC5FF04@mac.com>
	<35ABC959-4B2B-4969-A740-67D76FB4A0F6@mac.com>
	<4A3FB0D7.2010208@lshift.net>
Message-ID: <09E74EBE-CA99-4250-BB01-CD4367EAA853@mac.com>


On Jun 22, 2009, at 11:27 AM, Tony Garnock-Jones wrote:

> Hi Chuck,
>
> Chuck Remes wrote:
>>> With that out of the way, I would suggest a fanout exchange per
>>> high-volume symbol. [...]
>>> Alternately, you could use a direct exchange for the low-volume
>>> stocks.
>
> RabbitMQ should be about as fast with direct as with fanout exchanges.
>
> To find a list of matching queues for a publish to a fanout  
> exchange, it
> searches a mnesia table indexed by exchange name, and for direct
> exchanges, it searches a table indexed by the pair of (exchange name,
> routing key) -- in both cases it's effectively a simple "dictionary"
> lookup resulting in a list of queue names.
>
> The implementation of topic exchanges is quite different (and quite a
> bit slower!), but broadly speaking, direct and fanout exchanges should
> be en par with each other, performance-wise.

Good to know!

cr




From drew.smathers at gmail.com  Mon Jun 22 20:44:34 2009
From: drew.smathers at gmail.com (Drew Smathers)
Date: Mon, 22 Jun 2009 15:44:34 -0400
Subject: [rabbitmq-discuss] Inconsistent results on nodes for rabbitmqctl
	list_queues
Message-ID: <368574aa0906221244p1c36a9bdo7c2bb8c3a71530da@mail.gmail.com>

I'm using rabbitmq (1.5.3) in a cluster of nodes and noticed that
rabbitmqctl will sometimes report inconsistent results for list_queues
from one to another.  "status" indicates the cluster is operating
normally, showing all nodes running:

  [{running_applications,[{rabbit,"RabbitMQ","1.5.3"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.3"},
                        {os_mon,"CPO  CXC 138 46","2.1.6"},
                        {sasl,"SASL  CXC 138 11","2.1.5.3"},
                        {stdlib,"ERTS  CXC 138 10","1.15.3"},
                        {kernel,"ERTS  CXC 138 10","2.12.3"}]},
 {nodes,[rabbit at hostA,rabbit at hostB,
         rabbit at hostC,rabbit at hostD]},
 {running_nodes,[rabbit at hostA,rabbit at hostB,
                 rabbit at hostC,rabbit at hostD]}]

Where hostA/B are disc nodes and hostC/D are ram nodes.  However,
running list_queues on hostC shows incosistent results from hostA,B,D.

list_queues on hostA:

  foo1  rabbit at hostA  0
  foo2  rabbit at hostA  0
  foo3  rabbit at hostA  0
  foo4  rabbit at hostA  0

list_queues on hostC:

  foo1  rabbit at hostA  0
  foo3  rabbit at hostA  0
  foo4  rabbit at hostA  0

What kind of scenarios could cause this to occur?  This is of concern
to, me because upon testing declaration of foo2 from hostC,
unexpectedly the queue "migrates" from hostA to hostC (from the
perspective of all hosts) with consumers reset to 0; hence, consumers
on foo2 stop receiving messages.

-Drew



From darien at kindlund.com  Tue Jun 23 07:14:22 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Tue, 23 Jun 2009 02:14:22 -0400
Subject: [rabbitmq-discuss] STOMP Adapter Example: Headers Exchange
Message-ID: <50c8ffe90906222314w5af83fbbl16057236a5ad9f92@mail.gmail.com>

Hi Tony,

As a sanity check for my code, could you upload a perl example using
the new headers exchange via STOMP?  Also, is there example ruby code
using the headers exchange via the AMQP ruby library?

Thanks,
-- Darien



From ritesh.mehta at apics.org  Tue Jun 23 19:00:25 2009
From: ritesh.mehta at apics.org (Ritesh Mehta)
Date: Tue, 23 Jun 2009 13:00:25 -0500
Subject: [rabbitmq-discuss] FW: Clustering Issue
Message-ID: <19021D62937541468BF11891BB3CB753047706BD@MAIL.apicshq.org>

Hi ALL,

 

Please see the draft below

 

Hi,

 

We are currently testing out clustering on RabbitMQ on two servers
running on Windows. However I am not able to do so. The

Following is the error I get when I try to cluster with an existing
server:

 

ERROR REPORT==== 22-Jun-2009::15:09:45 ===
** Connection attempt from disallowed node rabbit at PC09023 **

 

The following are the steps that we implemented:

1.	Save a common cookie file (We tried at different locations i.e.
C:\Windows, C:\Documents and Settings\<User_Name>\Application Data,
C:\Documents and Settings\<User_Name>\Application Data\RabbitMQ as we
were not sure which is the right location)
2.	C:\Program
Files\erl5.5.5\lib\rabbitmq_server-1.5.4\sbin>rabbitmq-server.bat
-detached
3.	C:\Program
Files\erl5.5.5\lib\rabbitmq_server-1.5.4\sbin>rabbitmqctl.bat status
4.	C:\Program
Files\erl5.5.5\lib\rabbitmq_server-1.5.4\sbin>rabbitmqctl.bat stop_app
5.	C:\Program
Files\erl5.5.5\lib\rabbitmq_server-1.5.4\sbin>rabbitmqctl.bat reset
6.	C:\Program
Files\erl5.5.5\lib\rabbitmq_server-1.5.4\sbin>rabbitmqctl cluster
rabbit at 2269x rabbit at PC09023

 

I also tried implementing it as a service and I had no luck there as
well. Following is log when I used it as a service

 

 

=INFO REPORT==== 23-Jun-2009::10:38:14 ===

    application: rabbit

    exited: {{unable_to_join_cluster,

                 [rabbit at 2269x,rabbit at PC09023],

                 {merge_schema_failed,

                     "Incompatible schema cookies. Please, restart from
old backup.rabbit at 2269x =
[{name,schema},{type,set},{ram_copies,[]},{disc_copies,[rabbit at apicsubun
tu,rabbit at 2269x]},{disc_only_copies,[]},{load_order,0},{access_mode,read
_write},{index,[]},{snmp,[]},{local_content,false},{record_name,schema},
{attributes,[table,cstruct]},{user_properties,[]},{frag_properties,[]},{
cookie,{{1245,704290,424002},rabbit at 2269x}},{version,{{16,0},{rabbit at api
csubuntu,{1245,706725,297168}}}}], rabbit at PC09023 =
[{name,schema},{type,set},{ram_copies,[]},{disc_copies,[rabbit at PC09023]}
,{disc_only_copies,[]},{load_order,0},{access_mode,read_write},{index,[]
},{snmp,[]},{local_content,false},{record_name,schema},{attributes,[tabl
e,cstruct]},{user_properties,[]},{frag_properties,[]},{cookie,{{1245,702
205,450004},rabbit at PC09023}},{version,{{2,0},[]}}]\n"}},

             {rabbit,start,[normal,[]]}}

    type: temporary

 

 

I would appreciate any suggestions on how we could resolve this issue as
clustering is extremely critical for successfully launching out
applications.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090623/dd684f28/attachment.htm 

From mark.geib at echostar.com  Tue Jun 23 23:58:51 2009
From: mark.geib at echostar.com (Mark Geib)
Date: Tue, 23 Jun 2009 16:58:51 -0600
Subject: [rabbitmq-discuss]  flow control and erlang client(s)
Message-ID: <4A415E2B.30301@echostar.com>

I have seen in the erlang client test code that #'channel.flow'{active = 
false} is supported for flow control related to memory high/low water 
marks. However I need to limit the number of message published to a 
queue on a broker and need to know if in 1.6 it is supported and if so 
how to create the queue for support flow control, that is stopping 
message publishing until message are dequeued...

Thanks,
Mark.

-- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215




From matthias at lshift.net  Wed Jun 24 02:06:21 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 24 Jun 2009 02:06:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ consumer connection issue
In-Reply-To: <376f3e6f0906211105l12edd1e5p5ce64966c1748837@mail.gmail.com>
References: <376f3e6f0906211105l12edd1e5p5ce64966c1748837@mail.gmail.com>
Message-ID: <4A417C0D.8060901@lshift.net>

Suhail,

Suhail Doshi wrote:
> Is there a way to detect if the connection has been severed during a 
> channel.wait()?

What client library are you using?

Most AMQP client libraries will return an error/exception when a 
connection gets severed during a synchronous operation. And it is often 
also possible to register handlers for connection events. The details 
depend on the particular library.


Matthias.



From matthias at lshift.net  Wed Jun 24 02:23:19 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 24 Jun 2009 02:23:19 +0100
Subject: [rabbitmq-discuss] Inconsistent results on nodes for
 rabbitmqctl list_queues
In-Reply-To: <368574aa0906221244p1c36a9bdo7c2bb8c3a71530da@mail.gmail.com>
References: <368574aa0906221244p1c36a9bdo7c2bb8c3a71530da@mail.gmail.com>
Message-ID: <4A418007.5090903@lshift.net>

Drew,

Drew Smathers wrote:
> I'm using rabbitmq (1.5.3) in a cluster of nodes and noticed that
> rabbitmqctl will sometimes report inconsistent results for list_queues
> from one to another.

You certainly shouldn't be getting inconsistent results from list_queue 
on different nodes in a cluster. How often does that happen?

Have you seen this problem in 1.6.0? There were some clustering-related 
bug fixes in that release.


Regards,

Matthias.



From matthias at lshift.net  Wed Jun 24 02:36:25 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 24 Jun 2009 02:36:25 +0100
Subject: [rabbitmq-discuss] FW: Clustering Issue
In-Reply-To: <19021D62937541468BF11891BB3CB753047706BD@MAIL.apicshq.org>
References: <19021D62937541468BF11891BB3CB753047706BD@MAIL.apicshq.org>
Message-ID: <4A418319.9010605@lshift.net>

Ritesh,

Ritesh Mehta wrote:
> We are currently testing out clustering on RabbitMQ on two servers 
> running on Windows. However I am not able to do so.
> [...]
> I also tried implementing it as a service and I had no luck there as 
> well. Following is log when I used it as a service
> 
> =INFO REPORT==== 23-Jun-2009::10:38:14 ===
>     application: rabbit
>     exited: {{unable_to_join_cluster,
>                  [rabbit at 2269x,rabbit at PC09023],
>                  {merge_schema_failed,
>                      "Incompatible schema cookies. Please, restart from 
> old backup.rabbit at 2269x = 
> [...]

The above indicates that the basic erlan communication must have been 
working, unlike in your non-service example. The problem above is most 
likely due to not having 'reset' the db of the node you are joining to 
the cluster. I'd recommend starting from a clean install, set up the two 
nodes as windows services, ensure that they are working properly, and 
then run the stop_app, reset, cluster, start_app sequence on one of the 
nodes.

Regards,

Matthias



From matthias at lshift.net  Wed Jun 24 02:53:32 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 24 Jun 2009 02:53:32 +0100
Subject: [rabbitmq-discuss] Error running rabbitmq-server on Mac OS X
In-Reply-To: <b247595e-309a-4cc3-a3d4-37a3bbbce3bd@c18g2000prh.googlegroups.com>
References: <C6269406.6F7F6%kyle@pelago.com> <4A027EBB.2050201@lshift.net>
	<b247595e-309a-4cc3-a3d4-37a3bbbce3bd@c18g2000prh.googlegroups.com>
Message-ID: <4A41871C.3040203@lshift.net>

PanosJee wrote:
> Hi Matthias, I wanted to post to the google group but it would not
> allow me so i write to you personally and i hope you do not mind.

You really should subscribe to our mailing list at
   http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

This reply is cc'ed there.

> I have the typical problem upon booting of the server:
> $ sudo -H -u rabbitmq rabbitmq-server
> Password:
> {"init terminating in do_boot",{undef,[{rabbit,start,[]},
> {init,start_it,1},{init,start_em,1}]}}
> 
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> 
> Only root should run rabbitmq-server
> 
> What seems very frustrating is the last warning about root only being
> able to run the server.

Is that a macports install? These are in a state of flux, and depending 
on when & where you got your version from the instructions on the web 
site are incorrect. Specifically, in the most recent versions you should 
now be able to start rabbit just with
   sudo rabbitmq-server
and, similarly, control it with
   sudo rabbitmqctl <command> ...

> Furthermore, i found that the rabbitmq library exists inside the
> erlang lib as it was pointed out in previous posts. But it seems that
> is not loaded into erl:
> 
> Eshell V5.7.1  (abort with ^G)
> 1> code:get_path().
> [".","/usr/local/lib/erlang/lib/kernel-2.13.1/ebin",
>  "/usr/local/lib/erlang/lib/stdlib-1.16.1/ebin",
>  "/usr/local/lib/erlang/lib/xmerl-1.1.12/ebin",
>  "/usr/local/lib/erlang/lib/wx-0.98.1/ebin",
>  "/usr/local/lib/erlang/lib/webtool-0.8.4/ebin",
>  "/usr/local/lib/erlang/lib/typer-0.1.7/ebin",
>  "/usr/local/lib/erlang/lib/tv-2.1.4.3/ebin",
>  "/usr/local/lib/erlang/lib/tools-2.6.4/ebin",
>  "/usr/local/lib/erlang/lib/toolbar-1.4/ebin",
>  "/usr/local/lib/erlang/lib/test_server-3.3.1/ebin",
>  "/usr/local/lib/erlang/lib/syntax_tools-1.6/ebin",
>  "/usr/local/lib/erlang/lib/ssl-3.10.1/ebin",
>  "/usr/local/lib/erlang/lib/ssh-1.1.2/ebin",
>  "/usr/local/lib/erlang/lib/snmp-4.13.1/ebin",
>  "/usr/local/lib/erlang/lib/sasl-2.1.6/ebin",
>  "/usr/local/lib/erlang/lib/runtime_tools-1.8/ebin",
>  "/usr/local/lib/erlang/lib/reltool-0.2.1/ebin",
>  "/usr/local/lib/erlang/lib/public_key-0.2/ebin",
>  "/usr/local/lib/erlang/lib/pman-2.7/ebin",
>  "/usr/local/lib/erlang/lib/percept-0.8.1/ebin",
>  "/usr/local/lib/erlang/lib/parsetools-1.4.7/ebin",
>  "/usr/local/lib/erlang/lib/otp_mibs-1.0.5/ebin",
>  "/usr/local/lib/erlang/lib/os_mon-2.2.1/ebin",
>  "/usr/local/lib/erlang/lib/orber-3.6.12/ebin",
>  "/usr/local/lib/erlang/lib/odbc-2.10.4/ebin",
>  "/usr/local/lib/erlang/lib/observer-0.9.8/ebin",
>  "/usr/local/lib/erlang/lib/mnesia-4.4.9/ebin",
>  [...]|...]
> 2>

You do actually need to display the *whole* list - the above has been 
truncated by the Erlang shell. Or, even better, just check where Erlang 
thinks rabbit lives (if anywhere):
   code:which(rabbit).

If that comes up with nothing, check that there really is a 
rabbitmq_server-<vsn> directory in /usr/local/lib/erlang/lib, alongside 
all the other erlang apps.


Regards,

Matthias.



From matthias at lshift.net  Wed Jun 24 03:07:58 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 24 Jun 2009 03:07:58 +0100
Subject: [rabbitmq-discuss] flow control and erlang client(s)
In-Reply-To: <4A415E2B.30301@echostar.com>
References: <4A415E2B.30301@echostar.com>
Message-ID: <4A418A7E.7010902@lshift.net>

Mark,

Mark Geib wrote:
> I have seen in the erlang client test code that #'channel.flow'{active = 
> false} is supported for flow control related to memory high/low water 
> marks. However I need to limit the number of message published to a 
> queue on a broker and need to know if in 1.6 it is supported and if so 
> how to create the queue for support flow control, that is stopping 
> message publishing until message are dequeued...

What you are asking for is actually conceptually impossible.

In AMQP producers publish messages to an *exchange* (note that they are 
not "connected" to that exchange; each publish command can potentially 
go to a different exchange), which then routes them to *zero or more* 
queues, depending on the type of exchange, routing key in the message, 
and existing bindings between queues and the exchange.

So there is no way for the broker to know which of its connected clients 
might next send a message that ends up getting routed to a particular 
queue. Hence it cannot throttle clients based on any queue-based limits.

If there were per-queue message count limits (and this is something 
which has been discussed, though it's not part of the AMQP spec and not 
something RabbitMQ currently implements), the best the broker could do 
is reject, return or discard any messages that arrive after the limit 
has been reached.


Regards,

Matthias



From cctrieloff at redhat.com  Wed Jun 24 03:20:04 2009
From: cctrieloff at redhat.com (Carl Trieloff)
Date: Tue, 23 Jun 2009 22:20:04 -0400
Subject: [rabbitmq-discuss] flow control and erlang client(s)
In-Reply-To: <4A418A7E.7010902@lshift.net>
References: <4A415E2B.30301@echostar.com> <4A418A7E.7010902@lshift.net>
Message-ID: <4A418D54.7010209@redhat.com>


> If there were per-queue message count limits (and this is something 
> which has been discussed, though it's not part of the AMQP spec and not 
> something RabbitMQ currently implements), the best the broker could do 
> is reject, return or discard any messages that arrive after the limit 
> has been reached.
>
>
>   

Matthias,

don't know if this helps, but we do this in Qpid, and it works quite well. Also
in AMQP 0-10 and AMQP 1-0 draft, you have message credit which is the what is missing
on 0-8/0-9 to be able to implement this - thus the producer can be flow controlled. Complex 
policies can be implemented using this mechanism. The simplest that we have implemented in 
Qpid is to be able to specify a max publish rate for example for a producer.

maybe that gives you some ideas as you move toward 1-0
regards,
Carl.




From Mark.Geib at echostar.com  Wed Jun 24 03:35:58 2009
From: Mark.Geib at echostar.com (Geib, Mark)
Date: Tue, 23 Jun 2009 20:35:58 -0600
Subject: [rabbitmq-discuss] flow control and erlang client(s)
References: <4A415E2B.30301@echostar.com> <4A418A7E.7010902@lshift.net>
Message-ID: <60774C345843F8489D49A4F3A817D83301739B3A@MER2-EXCHA1.echostar.com>

Matthias,

I actually suspected that was the case. Would it be expensive then to have the publisher of the message check the number of messages in the queue prior to publishing. The publisher actually binds the queue to make sure that messages are not dropped when no subscriber has bound the queue yet. This would all be from erlang.

Thanks again for the help,
Mark.


-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net]
Sent: Tue 6/23/2009 8:07 PM
To: Geib, Mark
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss]  flow control and erlang client(s)
 
Mark,

Mark Geib wrote:
> I have seen in the erlang client test code that #'channel.flow'{active = 
> false} is supported for flow control related to memory high/low water 
> marks. However I need to limit the number of message published to a 
> queue on a broker and need to know if in 1.6 it is supported and if so 
> how to create the queue for support flow control, that is stopping 
> message publishing until message are dequeued...

What you are asking for is actually conceptually impossible.

In AMQP producers publish messages to an *exchange* (note that they are 
not "connected" to that exchange; each publish command can potentially 
go to a different exchange), which then routes them to *zero or more* 
queues, depending on the type of exchange, routing key in the message, 
and existing bindings between queues and the exchange.

So there is no way for the broker to know which of its connected clients 
might next send a message that ends up getting routed to a particular 
queue. Hence it cannot throttle clients based on any queue-based limits.

If there were per-queue message count limits (and this is something 
which has been discussed, though it's not part of the AMQP spec and not 
something RabbitMQ currently implements), the best the broker could do 
is reject, return or discard any messages that arrive after the limit 
has been reached.


Regards,

Matthias

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090623/0dfd1702/attachment.htm 

From eric at grokthis.net  Wed Jun 24 04:59:03 2009
From: eric at grokthis.net (eric)
Date: Tue, 23 Jun 2009 23:59:03 -0400
Subject: [rabbitmq-discuss] flow control and erlang client(s)
In-Reply-To: <60774C345843F8489D49A4F3A817D83301739B3A@MER2-EXCHA1.echostar.com>
References: <4A415E2B.30301@echostar.com> <4A418A7E.7010902@lshift.net>
	<60774C345843F8489D49A4F3A817D83301739B3A@MER2-EXCHA1.echostar.com>
Message-ID: <1245815943.25897.118.camel@eric-desktop.grokthis.net>

It makes sense that it is not reasonable to rate limit a publisher's
connection to a queue, since publishers don't connect to queues, they
connect to exchanges.   However, it shouldn't be too complex to rate
limit any two points that connect directly.  The trouble here is in
rate-limiting through a routed path.  Its like a train where you can
adjust the tension between two connected cars, but not the tension
between the first and last cars.  Thus, if you want to rate-limit
between an exchange and a specific queue, that might be possible, but if
you want to rate limit between a publisher and a queue, that isn't.

Yet, I'm not sure that its *impossible* to rate limit a publisher's
messages destined for a specific queue, even on the current code, but it
would be such a kludge, and so site-specific, that nobody would
reasonably wish to implement it.  Even then, it would be very limited in
its effectiveness.  Of course, Matthias knows better than I do, but I
believe I'm speaking rightly.  With major architecture changes, this
might be easier to implement, and it might be a use-case to suggest
when/if an architectural change is considered.  Again, refer to Matthias
on this.

Now, as for the "more reasonable" rate-limiting features, such as "from
car to car" in my train example, there are still concerns.  Based on my
discussions with Matthias, there is a significant and reasonable worry
that such checks can be performance heavy.  They're arguably vital for
some deployments, but unnecessarily slow for everyone else.  Surely,
like any software, there must be a line drawn between performance and
functionality, and I personally suspect that performance is the current
priority amongst the core team.

Last night, I suggested to Matthias that it might be worthwhile to
investigate ways to tack on "slow" code for those that need it, without
significantly impacting everyone else.  Examples I provided would be
registering handlers via modules, or an ability to subclass and extend
the Rabbit server itself, building independent servers built on a Rabbit
framework.  For this precise reason, as two examples, Apache and Linux
both have pluggable modules, compile-time feature sets, varied
workers/schedulers, etc.

The first step to this would be to decide if such an architecture is the
compromise solution for this problem, if Rabbit wants to go there, and
broadly, how.   Then, address the roadmap (something I feel not
worthwhile discussing at this point).

-- 
Regards,
Eric Windisch




From sam.owen at gazprom-mt.com  Wed Jun 24 09:51:04 2009
From: sam.owen at gazprom-mt.com (Sam Owen)
Date: Wed, 24 Jun 2009 09:51:04 +0100
Subject: [rabbitmq-discuss] Many clients using .NET API
Message-ID: <98842C6BBCC0764F8D92A62407D455F876E7A5@ex01kguk.Gazpromuk.intra>

Hi,

 

I've just started to look at RabbitMQ. I'm wondering whether the
following would be an idiomatic use of RabbitMQ from the .NET API:

 

Routing.Listen("queue1", "#", new ConsoleAlert());

Routing.Listen("queue1", "news.#", new EmailAlert());

Routing.Listen("queue2", "email.#", new ConsoleAlert());

 

Each call to Listen sets up a thread where the connection and channel
are maintained. 

 

public static void Listen(string queue, string routing, IRabbitListener
alert)

{

ThreadPool.QueueUserWorkItem(RunThis, new AlertState(queue, routing,
alert));

}

 

private static void RunThis(object state)

{

var alertState = state as AlertState;

      using (IConnection conn = new
ConnectionFactory().CreateConnection("localhost"))

{

            using (IModel channel = conn.CreateModel())

            {

                  var sub = new Subscription(channel, alertState.Queue,
"topic", alertState.Routing);

 

                  foreach (BasicDeliverEventArgs e in sub)

{

                        alertState.Alert.OnMessage(e.Exchange,
e.RoutingKey, Encoding.UTF8.GetString(e.Body));

                        sub.Ack(e);

                  }

            }

}

}

 

Given that .NET processes are more heavy weight than erlang's is this
the preferred way to set up many clients? 

Have I missed something in the .NET API for handling this type of case?

 

Thanks,

Sam



The information transmitted is the property of Gazprom Marketing & Trading Ltd and is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material. Statements and opinions expressed in this e-mail may not represent those of the company. Any review, retransmission, dissemination and other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender immediately and delete the material from any computer. 

Registered office: Gazprom Marketing & Trading Ltd, Gazprom House, 60 Marina Place, Hampton Wick, Kingston upon Thames, KT1 4BH. Registered in England No. 3768267


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090624/a0ac7fd4/attachment.htm 

From bms at incunabulum.net  Wed Jun 24 10:08:41 2009
From: bms at incunabulum.net (Bruce Simpson)
Date: Wed, 24 Jun 2009 10:08:41 +0100
Subject: [rabbitmq-discuss] FreeBSD ports/net/rabbitmq updated to 1.6.0
Message-ID: <4A41ED19.6050901@incunabulum.net>

Hi all,

This is just a brief heads-up, to let you all know that I've just 
updated the FreeBSD port entry for RabbitMQ.

The FreshPorts page for RabbitMQ is here:
    http://www.freshports.org/net/rabbitmq

I ran the Qpid 0.5 Python broker test suite against it, and pretty much 
got the same results as reported here:
    http://www.rabbitmq.com/interoperability.html

thanks,
BMS




From celldee at gmail.com  Wed Jun 24 17:16:51 2009
From: celldee at gmail.com (celldee)
Date: Wed, 24 Jun 2009 09:16:51 -0700 (PDT)
Subject: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap Questions)
In-Reply-To: <4A3FAF68.1000601@lshift.net>
References: <167204d20906040549q6ccabf26r2e7240fbf1298446@mail.gmail.com> 
	<b7d14f99-b62b-4664-829e-2414d2577afb@h23g2000vbc.googlegroups.com> 
	<4A3FAF68.1000601@lshift.net>
Message-ID: <2a70b2e4-51d2-4bfa-b4ac-1d6c24378261@f33g2000vbm.googlegroups.com>

Hi Tony,

On Jun 22, 5:20?pm, Tony Garnock-Jones <to... at lshift.net> wrote:
> Please try the "amqp_0_9_1" branch(es). You'll need both
> rabbitmq-codegen and rabbitmq-server from mercurial, both on the
> "amqp_0_9_1" branch.
>
> I'm very keen to hear how you get on! :-) Bug reports especially welcome.
>
> We periodically merge the "default" branch into the "amqp_0_9_1" branch,
> so that it tracks (roughly) the ongoing development and bugfixing work
> from the mainline (0-8) release.
>

Pardon my ignorance, but how do I get hold of the "amqp_0_9_1" branch?
I've looked at http://hg.rabbitmq.com/rabbitmq-server but the
whereabouts of the "amqp_0_9_1" branch is not apparent to me.

Regards,

Chris



From holger.hoffstaette at googlemail.com  Wed Jun 24 17:42:22 2009
From: holger.hoffstaette at googlemail.com (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Wed, 24 Jun 2009 18:42:22 +0200
Subject: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap Questions)
In-Reply-To: <2a70b2e4-51d2-4bfa-b4ac-1d6c24378261@f33g2000vbm.googlegroups.com>
References: <167204d20906040549q6ccabf26r2e7240fbf1298446@mail.gmail.com>
	<b7d14f99-b62b-4664-829e-2414d2577afb@h23g2000vbc.googlegroups.com>
	<4A3FAF68.1000601@lshift.net>
	<2a70b2e4-51d2-4bfa-b4ac-1d6c24378261@f33g2000vbm.googlegroups.com>
Message-ID: <4A42576E.3020601@googlemail.com>

celldee wrote:
> Pardon my ignorance, but how do I get hold of the "amqp_0_9_1" branch?
> I've looked at http://hg.rabbitmq.com/rabbitmq-server but the
> whereabouts of the "amqp_0_9_1" branch is not apparent to me.

All explained at http://www.rabbitmq.com/mercurial.html

hg clone http://hg.rabbitmq.com/rabbitmq-server
cd rabbitmq-server
hg up amqp_0_9_1

-h



From 0x6e6562 at gmail.com  Wed Jun 24 17:45:36 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 24 Jun 2009 17:45:36 +0100
Subject: [rabbitmq-discuss] my gen_fsm's supervisor getting channel
	'DOWN' messages
In-Reply-To: <9b58f4550906211655k6b5440cdw92c71c02d16737f4@mail.gmail.com>
References: <9b58f4550906211655k6b5440cdw92c71c02d16737f4@mail.gmail.com>
Message-ID: <269388e30906240945j4c3b515bmd3d9e1871e1d3d6@mail.gmail.com>

Hi Jack,

On Mon, Jun 22, 2009 at 12:55 AM, Jack Moffitt<jack at collecta.com> wrote:
> I have a gen_fsm that monitors a rabbitmq queue. ?Everything works
> fine unti lthere is an error.
>
> When I connect and open the channel, I put a monitor on it so that I
> get a 'DOWN' message when the channel dies. ?Before I down the channel
> myself, I always demonitor the reference.
>
> Unfortunately, for some reason whenever I close the channel and
> connection, the supervisor starts trying to shut down my process. ?I'm
> opening the connection with start() not start_link(), so I don't
> understand why my supervisor is being notified about AMQP connection
> process states.
>
> This is actually causing us serious problems because Erlang
> supervisors can't do backoff, so this usually results in the
> supervisor exceeding the restart limits and terminating the whole
> application.

Alexis has brought this to my attention, and I gather that there has
been some initial discourse, but unfortunately I don't have anything
with which I can diagnose the issue.

Is it possible for you to send a cut down version of some code that
provokes this symptom and also the log or error output that it
produces for you?

Thx,

Ben



From sho.fukamachi at gmail.com  Wed Jun 24 19:42:29 2009
From: sho.fukamachi at gmail.com (Sho Fukamachi)
Date: Thu, 25 Jun 2009 04:42:29 +1000
Subject: [rabbitmq-discuss] problems with rabbitmqctl & rabbitmq-server on
	RHEL5
Message-ID: <159D09A4-6499-40D2-9CA0-3971A7F36AAF@gmail.com>

Hi list,

I've had some issues with rabbitmq on x86_64 RHEL5. At first I had a  
problem not being able to run it at all, but tracked down the problem  
to conflicting (i386/x86_64) erlang installs. I can now start and  
connect to the server using the init.d scripts. I mention that just  
for background.

However, when trying to run anything from the command line, things go  
a bit pear-shaped. Here's the system:

RHEL 5.2 ( I think ..)
erlang.x86_64 R12B-5.6.el5.1
rabbitmq-server-1.6.0-1.x86_64.rpm (downloaded from web page and  
installed via rpm)

Try to run rabbitmqctl:

# rabbitmqctl status
{"init terminating in do_boot",{undef,[{rabbit_control,start,[]}, 
{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

That crash dump is very long and, to me, utterly incomprehensible.  
Running rabbitmq-server gets a similar result:

# /usr/sbin/rabbitmq-server
{"init terminating in do_boot",{undef,[{rabbit,start,[]}, 
{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

Even though it runs fine from the init script:

# service start rabbitmq-server
 > Starting rabbitmq-server: SUCCESS

I've been tinkering and playing around but can't figure it out. Any  
clues? It's not a showstopper, rabbitmq's running fine from the  
scripts, just wondering what it could be and not familiar enough with  
the erlang environment to put my finger on it.

Thanks a lot,

Sho




From panosjee at gmail.com  Wed Jun 24 21:40:03 2009
From: panosjee at gmail.com (Panayiotis Papadopoulos)
Date: Wed, 24 Jun 2009 13:40:03 -0700
Subject: [rabbitmq-discuss] Max OS X failure on start up / Trivial
Message-ID: <2c6a2a5a0906241340t2c7b1392mf6c62352f16affb3@mail.gmail.com>

Hi everyone, I know it is trivial but I could not do anything so far, i
guess cos i am a noob in ErlangAnyway I have followed the port install way
to install both erlang and rabbitmq. Rabbit is install in the the lib folder
of Erland
and erlang loads rabbit

2> code:which(rabbit).
"/opt/local/lib/erlang/lib/rabbitmq_server-1.6.0/ebin/rabbit.beam"

Despite that when i start the rabbit by sudo rabbitmq-server i get the usual


Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

the rabbit.log has this output

=INFO REPORT==== 23-Jun-2009::15:23:02 ===
    application: mnesia
    exited: stopped
    type: temporary

=INFO REPORT==== 23-Jun-2009::15:23:07 ===
Added vhost <<"/">>

=INFO REPORT==== 23-Jun-2009::15:23:07 ===
Created user <<"guest">>

=INFO REPORT==== 23-Jun-2009::15:23:07 ===
    application: rabbit
    exited:
{{bad_type,realm_exchange,{realm_resource,'_',<<"amq.fanout">>}},
             {rabbit,start,[normal,[]]}}
    type: temporary

=INFO REPORT==== 23-Jun-2009::15:23:07 ===
    application: mnesia
    exited: stopped
    type: temporary

=INFO REPORT==== 23-Jun-2009::15:23:07 ===
    application: os_mon
    exited: stopped
    type: temporary

I have no clue, i am sorry :) But i hope to learn it some day
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090624/9bb4cdfa/attachment.htm 

From alexis.richardson at gmail.com  Wed Jun 24 21:46:47 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 24 Jun 2009 21:46:47 +0100
Subject: [rabbitmq-discuss] AMQP 0.9 CLI client
In-Reply-To: <4A3FAA3A.7050406@lshift.net>
References: <4A3B9DD0.5080501@gbconsite.de> <4A3FAA3A.7050406@lshift.net>
Message-ID: <167204d20906241346y64afc1aflc45c4b58018f4cf4@mail.gmail.com>

I'm cross-posting an off list question - and Peter's reply - back
here.  Suggestions welcome :-)



> Do you mean a C client, or a command line interface?

Yes, I meant a command line interface.

I have somehow "inherited" an application, and parts of it are written
in bash.

All I need is to make it consume job-IDs from a queue and provide result
codes to a queue, then I could a) reuse that old report generation
stack, and b) I would be able to control it in an asynchrounous way.

That would provide me with spare time to improve the overall design of
the application one modeule at a time.

Hence my question for a tiny little something like /usr/bin/amqp which
fits in a shell script.

-----






On Mon, Jun 22, 2009 at 4:58 PM, Tony Garnock-Jones<tonyg at lshift.net> wrote:
> Peter Fischer (gb consite GmbH) wrote:
>> It seems to me that there is no binary executable CLI client availible
>
> Try rabbitmq-c:
>
> hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> hg clone http://hg.rabbitmq.com/rabbitmq-c
> cd rabbitmq-c
> autoreconf -i
> ./configure
> make
> ./examples/amqp_listen dev.rabbitmq.com 5672 amq.rabbitmq.log error
>
> There are other examples in the ./examples directory.
>
> Regards,
> ?Tony
> --
> ?[][][] Tony Garnock-Jones ? ? | Mob: +44 (0)7905 974 211
> ? [][] LShift Ltd ? ? ? ? ? ? | Tel: +44 (0)20 7729 7060
> ?[] ?[] http://www.lshift.net/ | Email: tonyg at lshift.net
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From peter.fischer at gbconsite.de  Wed Jun 24 21:55:45 2009
From: peter.fischer at gbconsite.de (Peter Fischer (gb consite GmbH))
Date: Wed, 24 Jun 2009 22:55:45 +0200
Subject: [rabbitmq-discuss] AMQP 0.9 CLI client
In-Reply-To: <4A3FAA3A.7050406@lshift.net>
References: <4A3B9DD0.5080501@gbconsite.de> <4A3FAA3A.7050406@lshift.net>
Message-ID: <4A4292D1.7010905@gbconsite.de>

Just tried to build this, compile worked, playing/learning starts
tomorrow (it's almost 11pm over here).

Who ever wants to try this:

apt-get install mercurial autoconf automake1.9 libtool python-simplejson

*before* Tony's little howto will help.

Cheers,
     Peter

Tony Garnock-Jones schrieb:
> Peter Fischer (gb consite GmbH) wrote:
>   
>> It seems to me that there is no binary executable CLI client availible
>>     
>
> Try rabbitmq-c:
>
> hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> hg clone http://hg.rabbitmq.com/rabbitmq-c
> cd rabbitmq-c
> autoreconf -i
> ./configure
> make
> ./examples/amqp_listen dev.rabbitmq.com 5672 amq.rabbitmq.log error
>
> There are other examples in the ./examples directory.
>
> Regards,
>   Tony
>   

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090624/a2f8a1ee/attachment.htm 

From tonyg at lshift.net  Wed Jun 24 23:25:19 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 24 Jun 2009 23:25:19 +0100
Subject: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap Questions)
In-Reply-To: <2a70b2e4-51d2-4bfa-b4ac-1d6c24378261@f33g2000vbm.googlegroups.com>
References: <167204d20906040549q6ccabf26r2e7240fbf1298446@mail.gmail.com>
	<b7d14f99-b62b-4664-829e-2414d2577afb@h23g2000vbc.googlegroups.com>
	<4A3FAF68.1000601@lshift.net>
	<2a70b2e4-51d2-4bfa-b4ac-1d6c24378261@f33g2000vbm.googlegroups.com>
Message-ID: <4A42A7CF.3060507@lshift.net>

Hi Chris,

celldee wrote:
> Pardon my ignorance, but how do I get hold of the "amqp_0_9_1" branch?
> I've looked at http://hg.rabbitmq.com/rabbitmq-server but the
> whereabouts of the "amqp_0_9_1" branch is not apparent to me.

Here's an example that checks out the server, the code generator, and 
the C client, switches the checkouts to the amqp_0_9_1 branch, builds 
them, and runs the examples:

# Check out the code
hg clone http://hg.rabbitmq.com/rabbitmq-codegen
hg clone http://hg.rabbitmq.com/rabbitmq-server
hg clone http://hg.rabbitmq.com/rabbitmq-c

# Switch to amqp_0_9_1 branches
(cd rabbitmq-codegen; hg up amqp_0_9_1)
(cd rabbitmq-server; hg up amqp_0_9_1)
(cd rabbitmq-c; hg up amqp_0_9_1)

# Build and start the server
make -C rabbitmq-server run

# Build the C client examples
(cd rabbitmq-c; autoreconf -i)
(cd rabbitmq-c; ./configure)
(cd rabbitmq-c; make)

# Run a listener
./rabbitmq-c/examples/amqp_listen localhost 5672 amq.direct foo

# Send a couple of test messages (from another window)
./rabbitmq-c/examples/amqp_sendstring localhost 5672 amq.direct foo 1
./rabbitmq-c/examples/amqp_sendstring localhost 5672 amq.direct foo 2
./rabbitmq-c/examples/amqp_sendstring localhost 5672 amq.direct foo 3


Regards,
   Tony



From panosjee at gmail.com  Wed Jun 24 23:27:47 2009
From: panosjee at gmail.com (Panayiotis Papadopoulos)
Date: Wed, 24 Jun 2009 15:27:47 -0700
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 25, Issue 54
In-Reply-To: <mailman.143.1245882326.15719.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.143.1245882326.15719.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <2c6a2a5a0906241527h5f071ff8r556f651c71a20f7e@mail.gmail.com>

Please ignore my message, I fixed it. Thank you for your time

On Wed, Jun 24, 2009 at 3:25 PM, <
rabbitmq-discuss-request at lists.rabbitmq.com> wrote:

> Send rabbitmq-discuss mailing list submissions to
>        rabbitmq-discuss at lists.rabbitmq.com
>
> To subscribe or unsubscribe via the World Wide Web, visit
>        http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> or, via email, send a message with subject or body 'help' to
>        rabbitmq-discuss-request at lists.rabbitmq.com
>
> You can reach the person managing the list at
>        rabbitmq-discuss-owner at lists.rabbitmq.com
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of rabbitmq-discuss digest..."
>
>
> Today's Topics:
>
>   1. Re: 0-9-1 Coming Soon (Was: Roadmap Questions) (celldee)
>   2. Re: 0-9-1 Coming Soon (Was: Roadmap Questions) (Holger Hoffst?tte)
>   3. Re: my gen_fsm's supervisor getting channel       'DOWN' messages
>      (Ben Hood)
>   4. problems with rabbitmqctl & rabbitmq-server on    RHEL5
>      (Sho Fukamachi)
>   5. Max OS X failure on start up / Trivial (Panayiotis Papadopoulos)
>   6. Re: AMQP 0.9 CLI client (Alexis Richardson)
>   7. Re: AMQP 0.9 CLI client (Peter Fischer (gb consite GmbH))
>   8. Re: 0-9-1 Coming Soon (Was: Roadmap Questions)
>      (Tony Garnock-Jones)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Wed, 24 Jun 2009 09:16:51 -0700 (PDT)
> From: celldee <celldee at gmail.com>
> Subject: Re: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap
>        Questions)
> To: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID:
>        <2a70b2e4-51d2-4bfa-b4ac-1d6c24378261 at f33g2000vbm.googlegroups.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> Hi Tony,
>
> On Jun 22, 5:20?pm, Tony Garnock-Jones <to... at lshift.net> wrote:
> > Please try the "amqp_0_9_1" branch(es). You'll need both
> > rabbitmq-codegen and rabbitmq-server from mercurial, both on the
> > "amqp_0_9_1" branch.
> >
> > I'm very keen to hear how you get on! :-) Bug reports especially welcome.
> >
> > We periodically merge the "default" branch into the "amqp_0_9_1" branch,
> > so that it tracks (roughly) the ongoing development and bugfixing work
> > from the mainline (0-8) release.
> >
>
> Pardon my ignorance, but how do I get hold of the "amqp_0_9_1" branch?
> I've looked at http://hg.rabbitmq.com/rabbitmq-server but the
> whereabouts of the "amqp_0_9_1" branch is not apparent to me.
>
> Regards,
>
> Chris
>
>
>
> ------------------------------
>
> Message: 2
> Date: Wed, 24 Jun 2009 18:42:22 +0200
> From: Holger Hoffst?tte <holger.hoffstaette at googlemail.com>
> Subject: Re: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap
>        Questions)
> To: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID: <4A42576E.3020601 at googlemail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> celldee wrote:
> > Pardon my ignorance, but how do I get hold of the "amqp_0_9_1" branch?
> > I've looked at http://hg.rabbitmq.com/rabbitmq-server but the
> > whereabouts of the "amqp_0_9_1" branch is not apparent to me.
>
> All explained at http://www.rabbitmq.com/mercurial.html
>
> hg clone http://hg.rabbitmq.com/rabbitmq-server
> cd rabbitmq-server
> hg up amqp_0_9_1
>
> -h
>
>
>
> ------------------------------
>
> Message: 3
> Date: Wed, 24 Jun 2009 17:45:36 +0100
> From: Ben Hood <0x6e6562 at gmail.com>
> Subject: Re: [rabbitmq-discuss] my gen_fsm's supervisor getting
>        channel 'DOWN' messages
> To: Jack Moffitt <jack at collecta.com>
> Cc: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com>
> Message-ID:
>        <269388e30906240945j4c3b515bmd3d9e1871e1d3d6 at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> Hi Jack,
>
> On Mon, Jun 22, 2009 at 12:55 AM, Jack Moffitt<jack at collecta.com> wrote:
> > I have a gen_fsm that monitors a rabbitmq queue. ?Everything works
> > fine unti lthere is an error.
> >
> > When I connect and open the channel, I put a monitor on it so that I
> > get a 'DOWN' message when the channel dies. ?Before I down the channel
> > myself, I always demonitor the reference.
> >
> > Unfortunately, for some reason whenever I close the channel and
> > connection, the supervisor starts trying to shut down my process. ?I'm
> > opening the connection with start() not start_link(), so I don't
> > understand why my supervisor is being notified about AMQP connection
> > process states.
> >
> > This is actually causing us serious problems because Erlang
> > supervisors can't do backoff, so this usually results in the
> > supervisor exceeding the restart limits and terminating the whole
> > application.
>
> Alexis has brought this to my attention, and I gather that there has
> been some initial discourse, but unfortunately I don't have anything
> with which I can diagnose the issue.
>
> Is it possible for you to send a cut down version of some code that
> provokes this symptom and also the log or error output that it
> produces for you?
>
> Thx,
>
> Ben
>
>
>
> ------------------------------
>
> Message: 4
> Date: Thu, 25 Jun 2009 04:42:29 +1000
> From: Sho Fukamachi <sho.fukamachi at gmail.com>
> Subject: [rabbitmq-discuss] problems with rabbitmqctl &
>        rabbitmq-server on      RHEL5
> To: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com>
> Message-ID: <159D09A4-6499-40D2-9CA0-3971A7F36AAF at gmail.com>
> Content-Type: text/plain; charset=US-ASCII; format=flowed; delsp=yes
>
> Hi list,
>
> I've had some issues with rabbitmq on x86_64 RHEL5. At first I had a
> problem not being able to run it at all, but tracked down the problem
> to conflicting (i386/x86_64) erlang installs. I can now start and
> connect to the server using the init.d scripts. I mention that just
> for background.
>
> However, when trying to run anything from the command line, things go
> a bit pear-shaped. Here's the system:
>
> RHEL 5.2 ( I think ..)
> erlang.x86_64 R12B-5.6.el5.1
> rabbitmq-server-1.6.0-1.x86_64.rpm (downloaded from web page and
> installed via rpm)
>
> Try to run rabbitmqctl:
>
> # rabbitmqctl status
> {"init terminating in do_boot",{undef,[{rabbit_control,start,[]},
> {init,start_it,1},{init,start_em,1}]}}
>
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
>
> That crash dump is very long and, to me, utterly incomprehensible.
> Running rabbitmq-server gets a similar result:
>
> # /usr/sbin/rabbitmq-server
> {"init terminating in do_boot",{undef,[{rabbit,start,[]},
> {init,start_it,1},{init,start_em,1}]}}
>
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
>
> Even though it runs fine from the init script:
>
> # service start rabbitmq-server
>  > Starting rabbitmq-server: SUCCESS
>
> I've been tinkering and playing around but can't figure it out. Any
> clues? It's not a showstopper, rabbitmq's running fine from the
> scripts, just wondering what it could be and not familiar enough with
> the erlang environment to put my finger on it.
>
> Thanks a lot,
>
> Sho
>
>
>
>
> ------------------------------
>
> Message: 5
> Date: Wed, 24 Jun 2009 13:40:03 -0700
> From: Panayiotis Papadopoulos <panosjee at gmail.com>
> Subject: [rabbitmq-discuss] Max OS X failure on start up / Trivial
> To: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID:
>        <2c6a2a5a0906241340t2c7b1392mf6c62352f16affb3 at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> Hi everyone, I know it is trivial but I could not do anything so far, i
> guess cos i am a noob in ErlangAnyway I have followed the port install way
> to install both erlang and rabbitmq. Rabbit is install in the the lib
> folder
> of Erland
> and erlang loads rabbit
>
> 2> code:which(rabbit).
> "/opt/local/lib/erlang/lib/rabbitmq_server-1.6.0/ebin/rabbit.beam"
>
> Despite that when i start the rabbit by sudo rabbitmq-server i get the
> usual
>
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>
> the rabbit.log has this output
>
> =INFO REPORT==== 23-Jun-2009::15:23:02 ===
>    application: mnesia
>    exited: stopped
>    type: temporary
>
> =INFO REPORT==== 23-Jun-2009::15:23:07 ===
> Added vhost <<"/">>
>
> =INFO REPORT==== 23-Jun-2009::15:23:07 ===
> Created user <<"guest">>
>
> =INFO REPORT==== 23-Jun-2009::15:23:07 ===
>    application: rabbit
>    exited:
> {{bad_type,realm_exchange,{realm_resource,'_',<<"amq.fanout">>}},
>             {rabbit,start,[normal,[]]}}
>    type: temporary
>
> =INFO REPORT==== 23-Jun-2009::15:23:07 ===
>    application: mnesia
>    exited: stopped
>    type: temporary
>
> =INFO REPORT==== 23-Jun-2009::15:23:07 ===
>    application: os_mon
>    exited: stopped
>    type: temporary
>
> I have no clue, i am sorry :) But i hope to learn it some day
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090624/9bb4cdfa/attachment-0001.htm
>
> ------------------------------
>
> Message: 6
> Date: Wed, 24 Jun 2009 21:46:47 +0100
> From: Alexis Richardson <alexis.richardson at gmail.com>
> Subject: Re: [rabbitmq-discuss] AMQP 0.9 CLI client
> To: Tony Garnock-Jones <tonyg at lshift.net>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID:
>        <167204d20906241346y64afc1aflc45c4b58018f4cf4 at mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> I'm cross-posting an off list question - and Peter's reply - back
> here.  Suggestions welcome :-)
>
>
>
> > Do you mean a C client, or a command line interface?
>
> Yes, I meant a command line interface.
>
> I have somehow "inherited" an application, and parts of it are written
> in bash.
>
> All I need is to make it consume job-IDs from a queue and provide result
> codes to a queue, then I could a) reuse that old report generation
> stack, and b) I would be able to control it in an asynchrounous way.
>
> That would provide me with spare time to improve the overall design of
> the application one modeule at a time.
>
> Hence my question for a tiny little something like /usr/bin/amqp which
> fits in a shell script.
>
> -----
>
>
>
>
>
>
> On Mon, Jun 22, 2009 at 4:58 PM, Tony Garnock-Jones<tonyg at lshift.net>
> wrote:
> > Peter Fischer (gb consite GmbH) wrote:
> >> It seems to me that there is no binary executable CLI client availible
> >
> > Try rabbitmq-c:
> >
> > hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> > hg clone http://hg.rabbitmq.com/rabbitmq-c
> > cd rabbitmq-c
> > autoreconf -i
> > ./configure
> > make
> > ./examples/amqp_listen dev.rabbitmq.com 5672 amq.rabbitmq.log error
> >
> > There are other examples in the ./examples directory.
> >
> > Regards,
> > ?Tony
> > --
> > ?[][][] Tony Garnock-Jones ? ? | Mob: +44 (0)7905 974 211
> > ? [][] LShift Ltd ? ? ? ? ? ? | Tel: +44 (0)20 7729 7060
> > ?[] ?[] http://www.lshift.net/ | Email: tonyg at lshift.net
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
>
>
> ------------------------------
>
> Message: 7
> Date: Wed, 24 Jun 2009 22:55:45 +0200
> From: "Peter Fischer (gb consite GmbH)" <peter.fischer at gbconsite.de>
> Subject: Re: [rabbitmq-discuss] AMQP 0.9 CLI client
> To: Tony Garnock-Jones <tonyg at lshift.net>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID: <4A4292D1.7010905 at gbconsite.de>
> Content-Type: text/plain; charset="iso-8859-1"
>
> Just tried to build this, compile worked, playing/learning starts
> tomorrow (it's almost 11pm over here).
>
> Who ever wants to try this:
>
> apt-get install mercurial autoconf automake1.9 libtool python-simplejson
>
> *before* Tony's little howto will help.
>
> Cheers,
>     Peter
>
> Tony Garnock-Jones schrieb:
> > Peter Fischer (gb consite GmbH) wrote:
> >
> >> It seems to me that there is no binary executable CLI client availible
> >>
> >
> > Try rabbitmq-c:
> >
> > hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> > hg clone http://hg.rabbitmq.com/rabbitmq-c
> > cd rabbitmq-c
> > autoreconf -i
> > ./configure
> > make
> > ./examples/amqp_listen dev.rabbitmq.com 5672 amq.rabbitmq.log error
> >
> > There are other examples in the ./examples directory.
> >
> > Regards,
> >   Tony
> >
>
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090624/a2f8a1ee/attachment-0001.htm
>
> ------------------------------
>
> Message: 8
> Date: Wed, 24 Jun 2009 23:25:19 +0100
> From: Tony Garnock-Jones <tonyg at lshift.net>
> Subject: Re: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap
>        Questions)
> To: celldee <celldee at gmail.com>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Message-ID: <4A42A7CF.3060507 at lshift.net>
> Content-Type: text/plain; charset=ISO-8859-1; format=flowed
>
> Hi Chris,
>
> celldee wrote:
> > Pardon my ignorance, but how do I get hold of the "amqp_0_9_1" branch?
> > I've looked at http://hg.rabbitmq.com/rabbitmq-server but the
> > whereabouts of the "amqp_0_9_1" branch is not apparent to me.
>
> Here's an example that checks out the server, the code generator, and
> the C client, switches the checkouts to the amqp_0_9_1 branch, builds
> them, and runs the examples:
>
> # Check out the code
> hg clone http://hg.rabbitmq.com/rabbitmq-codegen
> hg clone http://hg.rabbitmq.com/rabbitmq-server
> hg clone http://hg.rabbitmq.com/rabbitmq-c
>
> # Switch to amqp_0_9_1 branches
> (cd rabbitmq-codegen; hg up amqp_0_9_1)
> (cd rabbitmq-server; hg up amqp_0_9_1)
> (cd rabbitmq-c; hg up amqp_0_9_1)
>
> # Build and start the server
> make -C rabbitmq-server run
>
> # Build the C client examples
> (cd rabbitmq-c; autoreconf -i)
> (cd rabbitmq-c; ./configure)
> (cd rabbitmq-c; make)
>
> # Run a listener
> ./rabbitmq-c/examples/amqp_listen localhost 5672 amq.direct foo
>
> # Send a couple of test messages (from another window)
> ./rabbitmq-c/examples/amqp_sendstring localhost 5672 amq.direct foo 1
> ./rabbitmq-c/examples/amqp_sendstring localhost 5672 amq.direct foo 2
> ./rabbitmq-c/examples/amqp_sendstring localhost 5672 amq.direct foo 3
>
>
> Regards,
>   Tony
>
>
>
> ------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> End of rabbitmq-discuss Digest, Vol 25, Issue 54
> ************************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090624/3621e6c5/attachment.htm 

From tonyg at lshift.net  Wed Jun 24 23:28:09 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 24 Jun 2009 23:28:09 +0100
Subject: [rabbitmq-discuss] Max OS X failure on start up / Trivial
In-Reply-To: <2c6a2a5a0906241340t2c7b1392mf6c62352f16affb3@mail.gmail.com>
References: <2c6a2a5a0906241340t2c7b1392mf6c62352f16affb3@mail.gmail.com>
Message-ID: <4A42A879.4080601@lshift.net>

Hello,

You may have an old database from a previous installation -- if you 
don't mind recreating your queues and exchanges, you can delete it, and 
the next time rabbitmq starts, it will create a fresh empty database. 
The database lives by default in 
/opt/local/var/lib/rabbitmq/mnesia/rabbit under macports.

Regards,
   Tony

Panayiotis Papadopoulos wrote:
> Hi everyone, I know it is trivial but I could not do anything so far, i 
> guess cos i am a noob in Erlang
> Anyway I have followed the port install way to install both erlang and 
> rabbitmq. Rabbit is install in the the lib folder of Erland
> and erlang loads rabbit
>  
> 2> code:which(rabbit).
> "/opt/local/lib/erlang/lib/rabbitmq_server-1.6.0/ebin/rabbit.beam"
> 
> Despite that when i start the rabbit by sudo rabbitmq-server i get the usual
> 
> 
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) 
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
> 
> the rabbit.log has this output
> 
> =INFO REPORT==== 23-Jun-2009::15:23:02 ===
>     application: mnesia
>     exited: stopped
>     type: temporary
> 
> =INFO REPORT==== 23-Jun-2009::15:23:07 ===
> Added vhost <<"/">>
> 
> =INFO REPORT==== 23-Jun-2009::15:23:07 ===
> Created user <<"guest">>
> 
> =INFO REPORT==== 23-Jun-2009::15:23:07 ===
>     application: rabbit
>     exited: 
> {{bad_type,realm_exchange,{realm_resource,'_',<<"amq.fanout">>}},
>              {rabbit,start,[normal,[]]}}
>     type: temporary
> 
> =INFO REPORT==== 23-Jun-2009::15:23:07 ===
>     application: mnesia
>     exited: stopped
>     type: temporary
> 
> =INFO REPORT==== 23-Jun-2009::15:23:07 ===
>     application: os_mon
>     exited: stopped
>     type: temporary
> 
> I have no clue, i am sorry :) But i hope to learn it some day
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From ken.anderson at sungard.com  Thu Jun 25 00:33:41 2009
From: ken.anderson at sungard.com (Anderson, Ken)
Date: Wed, 24 Jun 2009 19:33:41 -0400
Subject: [rabbitmq-discuss] .Net 2.0 and HTTPS as a client
Message-ID: <C6683015.16FE0%ken.anderson@sungard.com>

Hello list!

We're working on implementing a system where the front end is a .Net client
that communicates with a java back end through a message broker.  RabbitMQ
was on our short list because it has advertised the ability for .Net access
and HTTPS transports.

Is anyone doing this?  Are there any gotchas?

We need https because the app will be run on client systems where there are
typically firewalls and proxy servers in the way.

Thanks in advance,
Ken 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090624/3f552b7f/attachment.htm 

From celldee at gmail.com  Thu Jun 25 05:51:18 2009
From: celldee at gmail.com (celldee)
Date: Wed, 24 Jun 2009 21:51:18 -0700 (PDT)
Subject: [rabbitmq-discuss] 0-9-1 Coming Soon (Was: Roadmap Questions)
In-Reply-To: <4A42A7CF.3060507@lshift.net>
References: <167204d20906040549q6ccabf26r2e7240fbf1298446@mail.gmail.com> 
	<b7d14f99-b62b-4664-829e-2414d2577afb@h23g2000vbc.googlegroups.com> 
	<4A3FAF68.1000601@lshift.net>
	<2a70b2e4-51d2-4bfa-b4ac-1d6c24378261@f33g2000vbm.googlegroups.com>
	<4A42A7CF.3060507@lshift.net>
Message-ID: <f0b9fc17-0e7c-4a54-bdfa-73936c958c6d@j19g2000vbp.googlegroups.com>

Gentlemen,

On Jun 24, 11:25?pm, Tony Garnock-Jones <to... at lshift.net> wrote:
> Hi Chris,
>
> celldee wrote:
> > Pardon my ignorance, but how do I get hold of the "amqp_0_9_1" branch?
> > I've looked athttp://hg.rabbitmq.com/rabbitmq-serverbut the
> > whereabouts of the "amqp_0_9_1" branch is not apparent to me.
>
> Here's an example that checks out the server, the code generator, and
> the C client, switches the checkouts to the amqp_0_9_1 branch, builds
> them, and runs the examples:
>
> # Check out the code
> hg clonehttp://hg.rabbitmq.com/rabbitmq-codegen
> hg clonehttp://hg.rabbitmq.com/rabbitmq-server
> hg clonehttp://hg.rabbitmq.com/rabbitmq-c
>
> # Switch to amqp_0_9_1 branches
> (cd rabbitmq-codegen; hg up amqp_0_9_1)
> (cd rabbitmq-server; hg up amqp_0_9_1)
> (cd rabbitmq-c; hg up amqp_0_9_1)
>
> # Build and start the server
> make -C rabbitmq-server run
>
> # Build the C client examples
> (cd rabbitmq-c; autoreconf -i)
> (cd rabbitmq-c; ./configure)
> (cd rabbitmq-c; make)
>
> # Run a listener
> ./rabbitmq-c/examples/amqp_listen localhost 5672 amq.direct foo
>
> # Send a couple of test messages (from another window)
> ./rabbitmq-c/examples/amqp_sendstring localhost 5672 amq.direct foo 1
> ./rabbitmq-c/examples/amqp_sendstring localhost 5672 amq.direct foo 2
> ./rabbitmq-c/examples/amqp_sendstring localhost 5672 amq.direct foo 3
>

Thanks for your assistance. I shall now proceed :)

Regards,

Chris



From matthias at yacc.se  Thu Jun 25 09:59:15 2009
From: matthias at yacc.se (Matthias Karlsson)
Date: Thu, 25 Jun 2009 10:59:15 +0200
Subject: [rabbitmq-discuss] Multithreaded application,
	separation of connections and channels
Message-ID: <83eb635f0906250159u1c700aa6r94f0e124119393a0@mail.gmail.com>

Hi,

I'm currently in the design phase of a new system and we are going to
experiment with AMQP as it allows us to model a few things much better
than JMS than we used before. Perhaps this would better belong on a
AMQP general list, but since I was planning on using RabbitMQ I
figured I could try here, there might be some implementation details
that are relevant for example.

Anyway, at the simplest level, there will be an application that will
need to consume and produce messages in multiple threads. For say,
producing, one channel will be given for each thread that is
responsible for writing data as they are not thread safe, but I was
wondering if there are any best practices regarding the connections
that the channels are created from.

The way I see it, there are 3 possible combinations.

1) Each thread has its own connection from which it creates one channel
2) One connection is shared for the whole application, multiple
channels are created and given to threads
3) A hybrid variant where X channels is created from every connection,
and depending on the number of threads, a number of connections are
created

The application needs to be fail-safe and be able to restablish
connections to the broker in case of network problems, broker goes
down etc. For that reason, [1] looks easier to implement as each
thread can handle all by itself in isolation. For [2] it would be more
tricky, as the failure of the connection would be reported in one part
of the application, who would then need to produce new channels and
give to the worker threads. [3] would be basically the same as [2]

I was also curious about performance. If a large amount of messages
are sent, it seems like it would be more efficient to send those over
a set of sockets ([1] or [3] above), instead of forcing them all
through the only one available ([2] above).

Any input would be greatly appreciated.

Thanks!

Matthias



From vivek.kubaji at onmobile.com  Thu Jun 25 16:18:13 2009
From: vivek.kubaji at onmobile.com (Vivek Ramesh. Kubaji)
Date: Thu, 25 Jun 2009 20:48:13 +0530
Subject: [rabbitmq-discuss] RabbitMQ/Spring integration - help required
Message-ID: <A767955DD6BCC54C99FC1C628AA8BBA009278BBF@newexchangemail.onmobile.com>

Hi,

 

I'm trying to evaluate RabbitMQ for our project. And I'm using
Spring-integration framework. From the posts in the forum I ended up
using the following configuration (jms part):

 

      <beans:bean id="amqConnectionFactory"

class="org.apache.qpid.client.AMQConnectionFactory">

            <beans:constructor-arg

value="amqp://guest:guest@/localhost?brokerlist='tcp://localhost:5672'"
/>

      </beans:bean>

 

      <beans:bean id="connectionFactory"

class="org.springframework.jms.connection.SingleConnectionFactory">

            <beans:property name="targetConnectionFactory"

ref="amqConnectionFactory"/>

      </beans:bean>

      

      <beans:bean id="jms_QueueWest"
class="org.apache.qpid.client.AMQQueue">

            <beans:constructor-arg>

                  <beans:bean class="org.apache.qpid.url.AMQBindingURL">

                        <beans:constructor-arg value="${jms.queue1}"/>

                  </beans:bean>

            </beans:constructor-arg>

      </beans:bean>

 

and have this in my properties file:

 

jms.queue1=direct://rabbit//my.queue1

 

I'm running the RabbitMQ broker using the command
$RABBITMQ_HOME$/sbin/rabbitmq-server.bat. When I start my client
application I am getting the following error:

 

2009-06-25 19:00:21,192 INFO

org.springframework.jms.listener.DefaultMessageListenerContainer#0-1

[DefaultMessageListenerContainer.refreshConnectionUntilSuccessful] -
Could not refresh JMS Connection for destination
'direct://rabbit/my.queue1/my.queue1?routingkey='my.queue1'' - retrying
in 5000 ms. Cause: Error creating connection: Unable to Connect
org.apache.qpid.transport.ConnectionException

        at
org.apache.qpid.transport.Connection.close(Connection.java:494)

        at
org.apache.qpid.transport.Connection.connect(Connection.java:193)

        at

org.apache.qpid.client.AMQConnectionDelegate_0_10.makeBrokerConnection(A
MQConnectionDelegate_0_10.java:161)

        at

org.apache.qpid.client.AMQConnection.makeBrokerConnection(AMQConnection.
java:728)

        at

org.apache.qpid.client.AMQConnection.<init>(AMQConnection.java:520)

        at

org.apache.qpid.client.AMQConnectionFactory.createConnection(AMQConnecti
onFactory.java:276)

        at

org.springframework.jms.connection.SingleConnectionFactory.doCreateConne
ction(SingleConnectionFactory.java:343)

        at

org.springframework.jms.connection.SingleConnectionFactory.initConnectio
n(SingleConnectionFactory.java:290)

        at

org.springframework.jms.connection.SingleConnectionFactory.createConnect
ion(SingleConnectionFactory.java:227)

        at

org.springframework.jms.support.JmsAccessor.createConnection(JmsAccessor
.java:184)

        at

org.springframework.jms.listener.AbstractJmsListeningContainer.createSha
redConnection(AbstractJmsListeningContainer.java:378)

        at

org.springframework.jms.listener.AbstractJmsListeningContainer.refreshSh
aredConnection(AbstractJmsListeningContainer.java:363)

        at

org.springframework.jms.listener.DefaultMessageListenerContainer.refresh
ConnectionUntilSuccessful(DefaultMessageListenerContainer.java:785)

        at

org.springframework.jms.listener.DefaultMessageListenerContainer.recover
AfterListenerSetupFailure(DefaultMessageListenerContainer.java:767)

        at

org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMe
ssageListenerInvoker.run(DefaultMessageListenerContainer.java:898)

        at java.lang.Thread.run(Thread.java:619)

Caused by: org.apache.qpid.transport.ConnectionException

        at

org.apache.qpid.transport.Connection.exception(Connection.java:405)

        at

org.apache.qpid.transport.network.Assembler.exception(Assembler.java:108
)

        at

org.apache.qpid.transport.network.InputHandler.exception(InputHandler.ja
va:196)

        at

org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:146)

        ... 1 more

Caused by: java.lang.IllegalStateException

        at

org.apache.qpid.transport.network.InputHandler.next(InputHandler.java:19
0)

        at

org.apache.qpid.transport.network.InputHandler.received(InputHandler.jav
a:103)

        at

org.apache.qpid.transport.network.InputHandler.received(InputHandler.jav
a:42)

        at

org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:128)

        ... 1 more

 

Seeing the error I feel I have done some stupid mistake  . Somebody
please help me ...

 

Thanks in advance.

 

Regards,

Vivek

 

 

Regards,

Vivek Kubaji

 

Mail       : vivek.kubaji at onmobile.com

Mobile  : 9880199884

Ext          : 6147

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090625/2c53291c/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 2358 bytes
Desc: image001.gif
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090625/2c53291c/attachment.gif 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/gif
Size: 825 bytes
Desc: image002.gif
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090625/2c53291c/attachment-0001.gif 
-------------- next part --------------
==============================
DISCLAIMER: The information in this message is confidential and may be legally privileged. It is intended solely for the addressee. Access to this message by anyone else is unauthorized. If you are not the intended recipient, any disclosure, copying, or distribution of the message, or any action or omission taken by you in reliance on it, is prohibited and may be unlawful. Please immediately contact the sender if you have received this message in error. Further, this e-mail may contain viruses and all reasonable precaution to minimize the risk arising there from is taken by OnMobile. OnMobile is not liable for any damage sustained by you as a result of any virus in this e-mail. All applicable virus checks should be carried out by you before opening this e-mail or any attachment thereto. 
Thank you - OnMobile Global Limited.
==============================

From tsuraan at gmail.com  Thu Jun 25 17:57:20 2009
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 25 Jun 2009 11:57:20 -0500
Subject: [rabbitmq-discuss] opposite of basicAck?
Message-ID: <84fb38e30906250957od213dfl139022812d19a57a@mail.gmail.com>

If I have a message that I know that I don't want to handle right now,
is there something like basicAck that rejects a deliveryTag instead of
acking it?  IIRC, after some timeout, or a channel close, the message
will be queued for redelivery, but I have a case where I know that a
message I received isn't useful for me yet, so I'd like to immediately
reject it so I can pick it up later.  Is that possible?



From dialtone at gmail.com  Thu Jun 25 20:20:04 2009
From: dialtone at gmail.com (Valentino Volonghi)
Date: Thu, 25 Jun 2009 12:20:04 -0700
Subject: [rabbitmq-discuss] opposite of basicAck?
In-Reply-To: <84fb38e30906250957od213dfl139022812d19a57a@mail.gmail.com>
References: <84fb38e30906250957od213dfl139022812d19a57a@mail.gmail.com>
Message-ID: <B97A0C85-8EF4-4443-9731-F11570212335@gmail.com>


On Jun 25, 2009, at 9:57 AM, tsuraan wrote:

> If I have a message that I know that I don't want to handle right now,
> is there something like basicAck that rejects a deliveryTag instead of
> acking it?  IIRC, after some timeout, or a channel close, the message
> will be queued for redelivery, but I have a case where I know that a
> message I received isn't useful for me yet, so I'd like to immediately
> reject it so I can pick it up later.  Is that possible?


Not really I suppose. Unless some exchange is created that delivers
messages in a future date.

This incidentally is a problem that I'm dealing with in quebert.

http://bitbucket.org/adroll/quebert/src/tip/quebert/amqp.py#cl-140

There are a bunch of ways in which you could try to deal with the  
problem,
and I still haven't figured out which one is the best one... But  
essentially
you could (with your wanted variations):

If there is a prefetch count set to X:
   Option A:
       - Only after an exception raise X to X+1
       - Backoff an arbitrary delay (exponentially or fixed)
       - call basic_recover (with requeue=True if you want it  
redelivered
                                            potentially to any queue)
       - decrease X+1 back to X

   Option B:
      - After "timeout" time passed raise X to X+1
      - When the message that is taking the timeout has finished
         waiting call basic_recover (same options as above)
     - decrease X+1 to X

If there's no prefetch simply hold the message unackd for your preferred
delay.

Currently in quebert I implemented option B. But that's suboptimal for
tasks that actually take long because they are heavy and increasing
the number of prefetches might not be good because with few machines
it might end up clogging those few workers and grow indefinitely (if all
tasks in the worst case go to timeout).

If I can find a clean way in my code to implement Option A I would go  
for
it... But a simple exception might not be good enough... I dunno, plus  
it's
hard to keep the "event handler" fully separated from amqp when, in  
order
to increase/decrease the prefetch window it needs access to the  
channel...

Agh... My head is already hurting...

--
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090625/2efa48a1/attachment.pgp 

From matthias at lshift.net  Fri Jun 26 00:26:36 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 26 Jun 2009 00:26:36 +0100
Subject: [rabbitmq-discuss] Max Message Size
In-Reply-To: <3a5f03340906191555l7c1a553jc8067a01b3820184@mail.gmail.com>
References: <3a5f03340906191555l7c1a553jc8067a01b3820184@mail.gmail.com>
Message-ID: <4A4407AC.3080104@lshift.net>

Patrick,

Patrick Kenney wrote:
> Looking for Max Message Size and other capacities...

The limit in the protocol is 2^64 bytes. Rabbit's limit is "whatever 
fits into virtual memory (and is less than 2^64 bytes)".

If you let me know what other specific capacity information you are 
looking for I'll try to dig out the relevant info. I also recommend 
reading the AMQP specs to learn about any limits imposed by the protocol.


Regards,

Matthias.



From matthias at lshift.net  Fri Jun 26 01:20:43 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 26 Jun 2009 01:20:43 +0100
Subject: [rabbitmq-discuss] Max OS X failure on start up / Trivial
In-Reply-To: <4A42A879.4080601@lshift.net>
References: <2c6a2a5a0906241340t2c7b1392mf6c62352f16affb3@mail.gmail.com>
	<4A42A879.4080601@lshift.net>
Message-ID: <4A44145B.2010501@lshift.net>

Tony Garnock-Jones wrote:
> You may have an old database from a previous installation

I don't think that's the problem. From the release notes: "When the 
RabbitMQ server detects the presence of an old database, it moves it to 
a backup location, creates a fresh, empty database, and logs a warning."

In fact the error looks more like it's picking up an ancient version of 
rabbitmq - folks were seeing this error 8 months ago when attempting to 
run RabbitMQ 1.4.0 or earlier on R12B-5 (or later). See, for example, 
http://www.nabble.com/RabbitMQ-starting-problem-on-Ubuntu-td20480353.html

So I recommend searching the system for any remnants of other rabbitmq 
installations, in particular rabbit_*.beam files, and remove them.


Regards,

Matthias.



From david.wragg at lshift.net  Fri Jun 26 03:50:23 2009
From: david.wragg at lshift.net (David Wragg)
Date: Fri, 26 Jun 2009 03:50:23 +0100
Subject: [rabbitmq-discuss] problems with rabbitmqctl & rabbitmq-server
	on RHEL5
In-Reply-To: <159D09A4-6499-40D2-9CA0-3971A7F36AAF@gmail.com> (Sho Fukamachi's
	message of "Thu\, 25 Jun 2009 04\:42\:29 +1000")
References: <159D09A4-6499-40D2-9CA0-3971A7F36AAF@gmail.com>
Message-ID: <k53a9n7low.fsf@mrbraver.lshift.net>

Hi Sho,

sho.fukamachi at gmail.com (Sho Fukamachi) writes:
> Try to run rabbitmqctl:
>
> # rabbitmqctl status
> {"init terminating in do_boot",{undef,[{rabbit_control,start,[]}, 
> {init,start_it,1},{init,start_em,1}]}}
>
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
>
> That crash dump is very long and, to me, utterly incomprehensible.  

I've tried to reproduce this on a fairly clean CentOS 5 VM with the
same erlang version, but rabbitmqctl behaves normally.  Could you send
the crash dump over so we can take a look?

Thanks,
David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net




From bmurphy1976 at gmail.com  Fri Jun 26 16:46:25 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Fri, 26 Jun 2009 10:46:25 -0500
Subject: [rabbitmq-discuss] Thank You
Message-ID: <7fd310d10906260846n36e2ad06r5216dff108d01988@mail.gmail.com>

We just moved from ActiveMQ to RabbitMQ over the past few weeks.  ActiveMQ
was a complete nightmare for us.  We're a .NET shop, and we run a major
portion of our software on top of Mono so MSMQ wasn't an option.  Also,
we're a small startup running in the cloud and could not afford something
like TIBCO, and we needed something far more flexible than what the cloud
provider provided us.
The switch over to RabbitMQ was so easy, and it's working so well that I am
simply stunned.  The API is simple, makes sense, and isn't bogged down with
a ton of overbearing Java standards crap.  The configuration is so simple
and flexible, and it performs so well, I can't imagine how we ever lived
without this product.

I want to thank you guys for doing such a great job with it.  I'm very much
looking forward to future releases, and feel like a major weight has been
lifted off my back.  Thank you!  Thank you!

Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090626/97a7fd3c/attachment.htm 

From geir at pobox.com  Fri Jun 26 16:59:03 2009
From: geir at pobox.com (Geir Magnusson Jr.)
Date: Fri, 26 Jun 2009 11:59:03 -0400
Subject: [rabbitmq-discuss] Thank You
In-Reply-To: <7fd310d10906260846n36e2ad06r5216dff108d01988@mail.gmail.com>
References: <7fd310d10906260846n36e2ad06r5216dff108d01988@mail.gmail.com>
Message-ID: <70454FDF-3B96-4196-9701-413A877278D3@pobox.com>

While I'm a big fan of "overbearing Java standards crap" (or, for  
those of us in the business, "OJSC"),  :)  what did you find  
nightmarish about ActiveMQ?

geir

On Jun 26, 2009, at 11:46 AM, Bryan Murphy wrote:

> We just moved from ActiveMQ to RabbitMQ over the past few weeks.   
> ActiveMQ was a complete nightmare for us.  We're a .NET shop, and we  
> run a major portion of our software on top of Mono so MSMQ wasn't an  
> option.  Also, we're a small startup running in the cloud and could  
> not afford something like TIBCO, and we needed something far more  
> flexible than what the cloud provider provided us.
>
> The switch over to RabbitMQ was so easy, and it's working so well  
> that I am simply stunned.  The API is simple, makes sense, and isn't  
> bogged down with a ton of overbearing Java standards crap.  The  
> configuration is so simple and flexible, and it performs so well, I  
> can't imagine how we ever lived without this product.
>
> I want to thank you guys for doing such a great job with it.  I'm  
> very much looking forward to future releases, and feel like a major  
> weight has been lifted off my back.  Thank you!  Thank you!
>
> Bryan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From bmurphy1976 at gmail.com  Fri Jun 26 17:12:17 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Fri, 26 Jun 2009 11:12:17 -0500
Subject: [rabbitmq-discuss] Thank You
In-Reply-To: <70454FDF-3B96-4196-9701-413A877278D3@pobox.com>
References: <7fd310d10906260846n36e2ad06r5216dff108d01988@mail.gmail.com>
	<70454FDF-3B96-4196-9701-413A877278D3@pobox.com>
Message-ID: <7fd310d10906260912i40c6c293r76c1f7babea35109@mail.gmail.com>

On Fri, Jun 26, 2009 at 10:59 AM, Geir Magnusson Jr. <geir at pobox.com> wrote:

> While I'm a big fan of "overbearing Java standards crap" (or, for
> those of us in the business, "OJSC"),  :)  what did you find
> nightmarish about ActiveMQ?
>
> geir


I don't want to turn this thread into a big "ActiveMQ sucks" thread.
 ActiveMQ is what it is and it's good for people who use it for what it is.
 It just wasn't a good fit for us.

Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090626/87dc616c/attachment.htm 

From geir at pobox.com  Fri Jun 26 17:17:24 2009
From: geir at pobox.com (Geir Magnusson Jr.)
Date: Fri, 26 Jun 2009 12:17:24 -0400
Subject: [rabbitmq-discuss] Thank You
In-Reply-To: <7fd310d10906260912i40c6c293r76c1f7babea35109@mail.gmail.com>
References: <7fd310d10906260846n36e2ad06r5216dff108d01988@mail.gmail.com>
	<70454FDF-3B96-4196-9701-413A877278D3@pobox.com>
	<7fd310d10906260912i40c6c293r76c1f7babea35109@mail.gmail.com>
Message-ID: <48545A93-F537-418B-BA78-176787943890@pobox.com>

I'm not looking for that either - just wondering what you ran into.

geir

On Jun 26, 2009, at 12:12 PM, Bryan Murphy wrote:

> On Fri, Jun 26, 2009 at 10:59 AM, Geir Magnusson Jr.  
> <geir at pobox.com> wrote:
> While I'm a big fan of "overbearing Java standards crap" (or, for
> those of us in the business, "OJSC"),  :)  what did you find
> nightmarish about ActiveMQ?
>
> geir
>
> I don't want to turn this thread into a big "ActiveMQ sucks"  
> thread.  ActiveMQ is what it is and it's good for people who use it  
> for what it is.  It just wasn't a good fit for us.
>
> Bryan




From ivdelchev at gmail.com  Sat Jun 27 20:48:30 2009
From: ivdelchev at gmail.com (Ivan Delchev)
Date: Sat, 27 Jun 2009 21:48:30 +0200
Subject: [rabbitmq-discuss] When is a rabbitmq-stomp 1.6.0 adapter coming?
Message-ID: <14f55850906271248p80399fcw7e50d46befe5017@mail.gmail.com>

Hi everyone,

I'm new to the list but I'm very fascinated by the features of
RabbitMQ and plan to use it for a project of mine. For the purpose I
would also require the rabbitmq-stomp adapter. I noticed that the
current version of RabbitMQ is 1.6.0 but the latest tagged
rabbitmq-stomp adapter is 1.5.5. When do you plan to release a 1.6
rabbitmq-stomp adapter - I quite like the newly introduced access
control features of RabbitMQ 1.6.0. Are there any recorded issues when
using the new server with the older adapter?

Great job!

Regards,
Ivan



From vivek.kubaji at onmobile.com  Sat Jun 27 21:27:12 2009
From: vivek.kubaji at onmobile.com (krv)
Date: Sat, 27 Jun 2009 13:27:12 -0700 (PDT)
Subject: [rabbitmq-discuss]  RabbitMQ/Spring integration - help required
Message-ID: <24236352.post@talk.nabble.com>


Hi,

I'm trying to evaluate RabbitMQ for our project. And I'm using
Spring-integration framework. From the posts in the forum I ended up using
the following configuration (jms part):

        <beans:bean id="amqConnectionFactory"
class="org.apache.qpid.client.AMQConnectionFactory">
                <beans:constructor-arg
value="amqp://guest:guest@/localhost?brokerlist='tcp://localhost:5672'" />
        </beans:bean>

        <beans:bean id="connectionFactory"
class="org.springframework.jms.connection.SingleConnectionFactory">
                <beans:property name="targetConnectionFactory"
ref="amqConnectionFactory"/>
        </beans:bean>
       
        <beans:bean id="jms_QueueWest"
class="org.apache.qpid.client.AMQQueue">
                <beans:constructor-arg>
                        <beans:bean
class="org.apache.qpid.url.AMQBindingURL">
                                <beans:constructor-arg
value="${jms.queue1}"/>
                        </beans:bean>
                </beans:constructor-arg>
        </beans:bean>

and have this in my properties file:

jms.queue1=direct://rabbit//my.queue1

I'm running the RabbitMQ broker using the command
$RABBITMQ_HOME$/sbin/rabbitmq-server.bat. When I start my client application
I am getting the following error:

2009-06-25 19:00:21,192 INFO
org.springframework.jms.listener.DefaultMessageListenerContainer#0-1
[DefaultMessageListenerContainer.refreshConnectionUntilSuccessful] - Could
not refresh JMS Connection for destination
'direct://rabbit/my.queue1/my.queue1?routingkey='my.queue1'' - retrying in
5000 ms. Cause: Error creating connection: Unable to Connect
org.apache.qpid.transport.ConnectionException
        at org.apache.qpid.transport.Connection.close(Connection.java:494)
        at org.apache.qpid.transport.Connection.connect(Connection.java:193)
        at
org.apache.qpid.client.AMQConnectionDelegate_0_10.makeBrokerConnection(AMQConnectionDelegate_0_10.java:161)
        at
org.apache.qpid.client.AMQConnection.makeBrokerConnection(AMQConnection.java:728)
        at
org.apache.qpid.client.AMQConnection.<init>(AMQConnection.java:520)
        at
org.apache.qpid.client.AMQConnectionFactory.createConnection(AMQConnectionFactory.java:276)
        at
org.springframework.jms.connection.SingleConnectionFactory.doCreateConnection(SingleConnectionFactory.java:343)
        at
org.springframework.jms.connection.SingleConnectionFactory.initConnection(SingleConnectionFactory.java:290)
        at
org.springframework.jms.connection.SingleConnectionFactory.createConnection(SingleConnectionFactory.java:227)
        at
org.springframework.jms.support.JmsAccessor.createConnection(JmsAccessor.java:184)
        at
org.springframework.jms.listener.AbstractJmsListeningContainer.createSharedConnection(AbstractJmsListeningContainer.java:378)
        at
org.springframework.jms.listener.AbstractJmsListeningContainer.refreshSharedConnection(AbstractJmsListeningContainer.java:363)
        at
org.springframework.jms.listener.DefaultMessageListenerContainer.refreshConnectionUntilSuccessful(DefaultMessageListenerContainer.java:785)
        at
org.springframework.jms.listener.DefaultMessageListenerContainer.recoverAfterListenerSetupFailure(DefaultMessageListenerContainer.java:767)
        at
org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:898)
        at java.lang.Thread.run(Thread.java:619)
Caused by: org.apache.qpid.transport.ConnectionException
        at
org.apache.qpid.transport.Connection.exception(Connection.java:405)
        at
org.apache.qpid.transport.network.Assembler.exception(Assembler.java:108)
        at
org.apache.qpid.transport.network.InputHandler.exception(InputHandler.java:196)
        at
org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:146)
        ... 1 more
Caused by: java.lang.IllegalStateException
        at
org.apache.qpid.transport.network.InputHandler.next(InputHandler.java:190)
        at
org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:103)
        at
org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:42)
        at
org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:128)
        ... 1 more

Seeing the error I feel I have some stupid mistake . Somebody please help me
...

Thanks in advance.

Regards,
Vivek
-- 
View this message in context: http://www.nabble.com/RabbitMQ-Spring-integration---help-required-tp24236352p24236352.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From alexis.richardson at gmail.com  Sun Jun 28 20:15:50 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sun, 28 Jun 2009 20:15:50 +0100
Subject: [rabbitmq-discuss] RabbitMQ/Spring integration - help required
In-Reply-To: <24236352.post@talk.nabble.com>
References: <24236352.post@talk.nabble.com>
Message-ID: <167204d20906281215h7537e81ew72fb8a517f167bc4@mail.gmail.com>

Vivek,

It looks like you are using a Java/JMS client from the Qpid
distribution on Apache.  Not all of these clients are compatible with
RabbitMQ which implements AMQP 0-8 (though we are soon moving to AMQP
0-9-1).

Please can you check that you are using a Qpid client set up for AMQP
0-8, or, if you prefer, you can try out the OpenAMQ JMS client which
works with RabbitMQ here:
http://www.lshift.net/blog/2009/03/16/openamqs-jms-client-with-rabbitmq-server

I also recommend that you take a look at the RabbitMQ Java client
pages here: http://www.rabbitmq.com/java-client.html

Let us know how you get on - other folks have made Spring work with RabbitMQ.

Best wishes

alexis




On Sat, Jun 27, 2009 at 9:27 PM, krv<vivek.kubaji at onmobile.com> wrote:
>
> Hi,
>
> I'm trying to evaluate RabbitMQ for our project. And I'm using
> Spring-integration framework. From the posts in the forum I ended up using
> the following configuration (jms part):
>
> ? ? ? ?<beans:bean id="amqConnectionFactory"
> class="org.apache.qpid.client.AMQConnectionFactory">
> ? ? ? ? ? ? ? ?<beans:constructor-arg
> value="amqp://guest:guest@/localhost?brokerlist='tcp://localhost:5672'" />
> ? ? ? ?</beans:bean>
>
> ? ? ? ?<beans:bean id="connectionFactory"
> class="org.springframework.jms.connection.SingleConnectionFactory">
> ? ? ? ? ? ? ? ?<beans:property name="targetConnectionFactory"
> ref="amqConnectionFactory"/>
> ? ? ? ?</beans:bean>
>
> ? ? ? ?<beans:bean id="jms_QueueWest"
> class="org.apache.qpid.client.AMQQueue">
> ? ? ? ? ? ? ? ?<beans:constructor-arg>
> ? ? ? ? ? ? ? ? ? ? ? ?<beans:bean
> class="org.apache.qpid.url.AMQBindingURL">
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?<beans:constructor-arg
> value="${jms.queue1}"/>
> ? ? ? ? ? ? ? ? ? ? ? ?</beans:bean>
> ? ? ? ? ? ? ? ?</beans:constructor-arg>
> ? ? ? ?</beans:bean>
>
> and have this in my properties file:
>
> jms.queue1=direct://rabbit//my.queue1
>
> I'm running the RabbitMQ broker using the command
> $RABBITMQ_HOME$/sbin/rabbitmq-server.bat. When I start my client application
> I am getting the following error:
>
> 2009-06-25 19:00:21,192 INFO
> org.springframework.jms.listener.DefaultMessageListenerContainer#0-1
> [DefaultMessageListenerContainer.refreshConnectionUntilSuccessful] - Could
> not refresh JMS Connection for destination
> 'direct://rabbit/my.queue1/my.queue1?routingkey='my.queue1'' - retrying in
> 5000 ms. Cause: Error creating connection: Unable to Connect
> org.apache.qpid.transport.ConnectionException
> ? ? ? ?at org.apache.qpid.transport.Connection.close(Connection.java:494)
> ? ? ? ?at org.apache.qpid.transport.Connection.connect(Connection.java:193)
> ? ? ? ?at
> org.apache.qpid.client.AMQConnectionDelegate_0_10.makeBrokerConnection(AMQConnectionDelegate_0_10.java:161)
> ? ? ? ?at
> org.apache.qpid.client.AMQConnection.makeBrokerConnection(AMQConnection.java:728)
> ? ? ? ?at
> org.apache.qpid.client.AMQConnection.<init>(AMQConnection.java:520)
> ? ? ? ?at
> org.apache.qpid.client.AMQConnectionFactory.createConnection(AMQConnectionFactory.java:276)
> ? ? ? ?at
> org.springframework.jms.connection.SingleConnectionFactory.doCreateConnection(SingleConnectionFactory.java:343)
> ? ? ? ?at
> org.springframework.jms.connection.SingleConnectionFactory.initConnection(SingleConnectionFactory.java:290)
> ? ? ? ?at
> org.springframework.jms.connection.SingleConnectionFactory.createConnection(SingleConnectionFactory.java:227)
> ? ? ? ?at
> org.springframework.jms.support.JmsAccessor.createConnection(JmsAccessor.java:184)
> ? ? ? ?at
> org.springframework.jms.listener.AbstractJmsListeningContainer.createSharedConnection(AbstractJmsListeningContainer.java:378)
> ? ? ? ?at
> org.springframework.jms.listener.AbstractJmsListeningContainer.refreshSharedConnection(AbstractJmsListeningContainer.java:363)
> ? ? ? ?at
> org.springframework.jms.listener.DefaultMessageListenerContainer.refreshConnectionUntilSuccessful(DefaultMessageListenerContainer.java:785)
> ? ? ? ?at
> org.springframework.jms.listener.DefaultMessageListenerContainer.recoverAfterListenerSetupFailure(DefaultMessageListenerContainer.java:767)
> ? ? ? ?at
> org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:898)
> ? ? ? ?at java.lang.Thread.run(Thread.java:619)
> Caused by: org.apache.qpid.transport.ConnectionException
> ? ? ? ?at
> org.apache.qpid.transport.Connection.exception(Connection.java:405)
> ? ? ? ?at
> org.apache.qpid.transport.network.Assembler.exception(Assembler.java:108)
> ? ? ? ?at
> org.apache.qpid.transport.network.InputHandler.exception(InputHandler.java:196)
> ? ? ? ?at
> org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:146)
> ? ? ? ?... 1 more
> Caused by: java.lang.IllegalStateException
> ? ? ? ?at
> org.apache.qpid.transport.network.InputHandler.next(InputHandler.java:190)
> ? ? ? ?at
> org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:103)
> ? ? ? ?at
> org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:42)
> ? ? ? ?at
> org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:128)
> ? ? ? ?... 1 more
>
> Seeing the error I feel I have some stupid mistake . Somebody please help me
> ...
>
> Thanks in advance.
>
> Regards,
> Vivek
> --
> View this message in context: http://www.nabble.com/RabbitMQ-Spring-integration---help-required-tp24236352p24236352.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From dln at eintr.org  Mon Jun 29 10:12:33 2009
From: dln at eintr.org (Daniel Lundin)
Date: Mon, 29 Jun 2009 11:12:33 +0200
Subject: [rabbitmq-discuss] Durable queues and high availability (broker
	failage)
In-Reply-To: <4A488522.9000003@eintr.org>
References: <4A488522.9000003@eintr.org>
Message-ID: <185945640906290212t54a0ea15lcf1d6595f48d833a@mail.gmail.com>

Hi, new guy here with a bunch of thanks for the awesome rabbitmq!

And a conundrum ...

I'm somewhat puzzled by how to manage a HA config of rabbit, especially
regarding durable queues.

I understand durable queues exist only on the node where created, and
also why. I also get that if that node fails it'll come back up once the
broker is restarted, and that's cool. But, while that broker is down,
the queue can be recreated on another node, because our system didn't
think waiting for mr sysadm to fix the failed node was a viable option.
And it isn't, we got work to do here. :)

Q1) Is there some notification mechanism to rely on to reliably tell a
queues has failed so apps can take measures to manage the failure, i.e
recreate the queue or set up a "temporary fail" queue?

Q2) Is there a way to "replay" recovered messages from the failed,
no-longer-relevant queue, into the newly/upon-failure created one? This
seems it would allow graceful recovery, even automatically so, once the
failed node does come back up.

I'd like refrain from putting too much messaging logic in the apps
themselves, and if possible I'd like to avoid managing a "temporary
failover" state at all in the app.

Overall though, I feel like I'm missing something since this surely
can't be a problem unique to our system.

So, what is the preferred way to handle node failure in a real-life
rabbitmq-based app today?

Cheers,
/Daniel



From dln at eintr.org  Mon Jun 29 13:02:05 2009
From: dln at eintr.org (Daniel Lundin)
Date: Mon, 29 Jun 2009 14:02:05 +0200
Subject: [rabbitmq-discuss] Declare queue on specific node
Message-ID: <4A48AD3D.8070002@eintr.org>

Still designing something workable for high availability over here. A
workable solution would be to bind multiple queues on different nodes to
the same exchange, hence assuring persistence on multiple locations
while maintaining availability.

This would suffice quite well for my case.

Is there currently a way to ensure that queues are, in fact, created on
different or specific nodes?

Is a queue always created on the node the client connected to before
declaring it?



From anand.ved at Xoriant.Com  Mon Jun 29 13:40:12 2009
From: anand.ved at Xoriant.Com (Anand Ved)
Date: Mon, 29 Jun 2009 18:10:12 +0530
Subject: [rabbitmq-discuss] Issue related to message consumption
Message-ID: <FA3D7C54DA3A1540B2C92C93ACD215600556AB04@XOREXCH.India.XoriantCorp.com>

Hi,

I am implementing Rabbit MQ where in I have a client in Java that sends
out messages to a single Q. There is a consumer (extending
DefaultConsumer) that deals with this message, however, when ever I get
an exception in my consumer, it travels up to the Connection level and
closes the connection.  This leads to no other messages being consumed
anymore.

I have a singleton class that initializes a Connection using
ConnectionFactory.
Using this connection, I have a Channel that declares an Exchange,
declares a Queue and binds the exchange and queue. As per the suggestion
in the documentation, since channel is not thread safe, I have it local
to each thread.

However, during consumption, I face an exception (say NullPointer) which
although I am catching it, traveses up to the Connection triggering it
to be closed.

Please suggest if there is a better way of managing this.


Regards,
Anand Ved | Xoriant Solutions Pvt. Ltd. 
Winchester, Hiranandani Business Park, Powai, Mumbai 400076, INDIA. 
Tel: +91 22 30511000 | +91 22 3051 1058 (Direct) | VOIP: + 1 408 834
4495 
Yahoo IM: anandved  | http://www.xoriant.com <http://www.xoriant.com/>

 <<Picture (Device Independent Bitmap)>> Modern technology, Owes
ecology, An apology. ~Alan M. Eddison - Go Green!!


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090629/5fc2dd32/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/bmp
Size: 3126 bytes
Desc: Picture (Device Independent Bitmap)
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090629/5fc2dd32/attachment.bin 

From alexis.richardson at gmail.com  Mon Jun 29 21:30:43 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 29 Jun 2009 21:30:43 +0100
Subject: [rabbitmq-discuss] recent and upcoming RabbitMQ / txAMQP talks
Message-ID: <167204d20906291330r2bf73aafud412057251e02a56@mail.gmail.com>

Hi all,

This is a short note to announce that Esteve Fernandez, author of the
txAMQP client for Python/Twisted, will give a talk at 4pm on Friday
July 3rd at RabbitHQ in London.  Please come along and join us for a
beer afterwards.  If you want to come, please email me so that I can
get a rough idea of numbers.

Last week there were several RabbitMQ-related talks at the Erlang
Factory that were filmed.  Keep an eye out for videos about the
following:

* Heroku mixing Ruby with Erlang and using some RabbitMQ
* A short intro talk from me with some use cases
* Matthew's talk about adding page-to-disk to RabbitMQ - with code and
commentary on Erlang
* Tony's talk on RabbitHub web messaging with Rabbit+webhooks
* Sean O'Halpin on the BBC's use of RabbitMQ, ejabberd and CouchDB

All the best,

alexis



From alexis.richardson at gmail.com  Mon Jun 29 22:19:03 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 29 Jun 2009 22:19:03 +0100
Subject: [rabbitmq-discuss] RabbitMQ/Spring integration - help required
In-Reply-To: <A767955DD6BCC54C99FC1C628AA8BBA009278BBF@newexchangemail.onmobile.com>
References: <A767955DD6BCC54C99FC1C628AA8BBA009278BBF@newexchangemail.onmobile.com>
Message-ID: <167204d20906291419x5122dbb9n31cc1e37a01ac295@mail.gmail.com>

Vivek

Have you been able to resolve this issue?

alexis


On Thu, Jun 25, 2009 at 4:18 PM, Vivek Ramesh.
Kubaji<vivek.kubaji at onmobile.com> wrote:
> Hi,
>
>
>
> I'm trying to evaluate RabbitMQ for our project. And I'm using
> Spring-integration framework. From the posts in the forum I ended up using
> the following configuration (jms part):
>
>
>
> ????? <beans:bean id="amqConnectionFactory"
>
> class="org.apache.qpid.client.AMQConnectionFactory">
>
> ??????????? <beans:constructor-arg
>
> value="amqp://guest:guest@/localhost?brokerlist='tcp://localhost:5672'" />
>
> ????? </beans:bean>
>
>
>
> ????? <beans:bean id="connectionFactory"
>
> class="org.springframework.jms.connection.SingleConnectionFactory">
>
> ??????????? <beans:property name="targetConnectionFactory"
>
> ref="amqConnectionFactory"/>
>
> ????? </beans:bean>
>
>
>
> ????? <beans:bean id="jms_QueueWest"
> class="org.apache.qpid.client.AMQQueue">
>
> ??????????? <beans:constructor-arg>
>
> ????????????????? <beans:bean class="org.apache.qpid.url.AMQBindingURL">
>
> ??????????????????????? <beans:constructor-arg value="${jms.queue1}"/>
>
> ????????????????? </beans:bean>
>
> ??????????? </beans:constructor-arg>
>
> ????? </beans:bean>
>
>
>
> and have this in my properties file:
>
>
>
> jms.queue1=direct://rabbit//my.queue1
>
>
>
> I'm running the RabbitMQ broker using the command
> $RABBITMQ_HOME$/sbin/rabbitmq-server.bat. When I start my client application
> I am getting the following error:
>
>
>
> 2009-06-25 19:00:21,192 INFO
>
> org.springframework.jms.listener.DefaultMessageListenerContainer#0-1
>
> [DefaultMessageListenerContainer.refreshConnectionUntilSuccessful] - Could
> not refresh JMS Connection for destination
> 'direct://rabbit/my.queue1/my.queue1?routingkey='my.queue1'' - retrying in
> 5000 ms. Cause: Error creating connection: Unable to Connect
> org.apache.qpid.transport.ConnectionException
>
> ??????? at org.apache.qpid.transport.Connection.close(Connection.java:494)
>
> ??????? at org.apache.qpid.transport.Connection.connect(Connection.java:193)
>
> ??????? at
>
> org.apache.qpid.client.AMQConnectionDelegate_0_10.makeBrokerConnection(AMQConnectionDelegate_0_10.java:161)
>
> ??????? at
>
> org.apache.qpid.client.AMQConnection.makeBrokerConnection(AMQConnection.java:728)
>
> ??????? at
>
> org.apache.qpid.client.AMQConnection.<init>(AMQConnection.java:520)
>
> ??????? at
>
> org.apache.qpid.client.AMQConnectionFactory.createConnection(AMQConnectionFactory.java:276)
>
> ??????? at
>
> org.springframework.jms.connection.SingleConnectionFactory.doCreateConnection(SingleConnectionFactory.java:343)
>
> ??????? at
>
> org.springframework.jms.connection.SingleConnectionFactory.initConnection(SingleConnectionFactory.java:290)
>
> ??????? at
>
> org.springframework.jms.connection.SingleConnectionFactory.createConnection(SingleConnectionFactory.java:227)
>
> ??????? at
>
> org.springframework.jms.support.JmsAccessor.createConnection(JmsAccessor.java:184)
>
> ??????? at
>
> org.springframework.jms.listener.AbstractJmsListeningContainer.createSharedConnection(AbstractJmsListeningContainer.java:378)
>
> ??????? at
>
> org.springframework.jms.listener.AbstractJmsListeningContainer.refreshSharedConnection(AbstractJmsListeningContainer.java:363)
>
> ??????? at
>
> org.springframework.jms.listener.DefaultMessageListenerContainer.refreshConnectionUntilSuccessful(DefaultMessageListenerContainer.java:785)
>
> ??????? at
>
> org.springframework.jms.listener.DefaultMessageListenerContainer.recoverAfterListenerSetupFailure(DefaultMessageListenerContainer.java:767)
>
> ??????? at
>
> org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:898)
>
> ??? ????at java.lang.Thread.run(Thread.java:619)
>
> Caused by: org.apache.qpid.transport.ConnectionException
>
> ??????? at
>
> org.apache.qpid.transport.Connection.exception(Connection.java:405)
>
> ??????? at
>
> org.apache.qpid.transport.network.Assembler.exception(Assembler.java:108)
>
> ??????? at
>
> org.apache.qpid.transport.network.InputHandler.exception(InputHandler.java:196)
>
> ??????? at
>
> org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:146)
>
> ?????? ?... 1 more
>
> Caused by: java.lang.IllegalStateException
>
> ??????? at
>
> org.apache.qpid.transport.network.InputHandler.next(InputHandler.java:190)
>
> ??????? at
>
> org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:103)
>
> ??????? at
>
> org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:42)
>
> ??????? at
>
> org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:128)
>
> ??????? ... 1 more
>
>
>
> Seeing the error I feel I have done some stupid mistake . Somebody please
> help me ...
>
>
>
> Thanks in advance.
>
>
>
> Regards,
>
> Vivek
>
>
>
>
>
> Regards,
>
> Vivek Kubaji
>
> Mail?????? : vivek.kubaji at onmobile.com
>
> Mobile? : 9880199884
>
> Ext????????? : 6147
>
>
>
> ==============================
> DISCLAIMER: The information in this message is confidential and may be
> legally privileged. It is intended solely for the addressee. Access to this
> message by anyone else is unauthorized. If you are not the intended
> recipient, any disclosure, copying, or distribution of the message, or any
> action or omission taken by you in reliance on it, is prohibited and may be
> unlawful. Please immediately contact the sender if you have received this
> message in error. Further, this e-mail may contain viruses and all
> reasonable precaution to minimize the risk arising there from is taken by
> OnMobile. OnMobile is not liable for any damage sustained by you as a result
> of any virus in this e-mail. All applicable virus checks should be carried
> out by you before opening this e-mail or any attachment thereto.
> Thank you - OnMobile Global Limited.
> ==============================
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Mon Jun 29 22:44:49 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 29 Jun 2009 22:44:49 +0100
Subject: [rabbitmq-discuss] Declare queue on specific node
In-Reply-To: <4A48AD3D.8070002@eintr.org>
References: <4A48AD3D.8070002@eintr.org>
Message-ID: <167204d20906291444s770cba9cx24881f3e7b4fe774@mail.gmail.com>

Daniel

I am not sure if this will completely answer your question but ...

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-February/003359.html

"The node to which a client is connected when it
issues a queue.declare that creates a new queue is the node that the
created queue is situated on until it's deleted and recreated."

Re HA ... it's doable in various ways.  A short video about this and
federation is here:

http://skillsmatter.com/podcast/cloud-grid/rabbitmq-internal-architecture-tony-garnock-jones

Please *do* tell us more about your problem if the above does not
help.  Your approach is sound but managing it optimally over time may
require more info about your use case.

Best wishes

alexis



On Mon, Jun 29, 2009 at 1:02 PM, Daniel Lundin<dln at eintr.org> wrote:
> Still designing something workable for high availability over here. A
> workable solution would be to bind multiple queues on different nodes to
> the same exchange, hence assuring persistence on multiple locations
> while maintaining availability.
>
> This would suffice quite well for my case.
>
> Is there currently a way to ensure that queues are, in fact, created on
> different or specific nodes?
>
> Is a queue always created on the node the client connected to before
> declaring it?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From tonyg at lshift.net  Tue Jun 30 08:10:33 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 30 Jun 2009 08:10:33 +0100
Subject: [rabbitmq-discuss] Max OS X failure on start up / Trivial
In-Reply-To: <4A44145B.2010501@lshift.net>
References: <2c6a2a5a0906241340t2c7b1392mf6c62352f16affb3@mail.gmail.com>
	<4A42A879.4080601@lshift.net> <4A44145B.2010501@lshift.net>
Message-ID: <4A49BA69.7060908@lshift.net>

Matthias Radestock wrote:
> So I recommend searching the system for any remnants of other rabbitmq 
> installations, in particular rabbit_*.beam files, and remove them.

Good point. I just used Spotlight to search for "rabbit.beam" and found 
four separate instances. (All of which were, in my case, expected, but 
nonetheless it's a valuable troubleshooting hint...)

Tony




From tonyg at lshift.net  Tue Jun 30 08:16:02 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 30 Jun 2009 08:16:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ/Spring integration - help required
In-Reply-To: <24236352.post@talk.nabble.com>
References: <24236352.post@talk.nabble.com>
Message-ID: <4A49BBB2.2000704@lshift.net>

Hi Vivek,

krv wrote:
> amqp://guest:guest@/localhost?brokerlist='tcp://localhost:5672'

Based on a cursory study of 
http://qpid.apache.org/connection-url-format.html, could it be the case 
that you want the following instead?

amqp://guest:guest@/?brokerlist='tcp://localhost:5672'

RabbitMQ ships with these default settings:

  - username "guest"
  - password "guest"
  - virtual-host "/" (not "/localhost")

Regards,
   Tony




From tonyg at lshift.net  Tue Jun 30 08:33:41 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 30 Jun 2009 08:33:41 +0100
Subject: [rabbitmq-discuss] Multithreaded application,
 separation of connections and channels
In-Reply-To: <83eb635f0906250159u1c700aa6r94f0e124119393a0@mail.gmail.com>
References: <83eb635f0906250159u1c700aa6r94f0e124119393a0@mail.gmail.com>
Message-ID: <4A49BFD5.40505@lshift.net>

Hi Matthias,

Matthias Karlsson wrote:
> 1) Each thread has its own connection from which it creates one channel
> 2) One connection is shared for the whole application, multiple
> channels are created and given to threads
> 3) A hybrid variant where X channels is created from every connection,
> and depending on the number of threads, a number of connections are
> created

Unless you have a very high number of threads and/or separate VMs, your 
option (1) seems easiest to work with. Suitably abstracted, it can 
always be switched out for one of the others later.

The main differences are in terms of error handling: who is affected by 
a dropped connection. If multiple channels share a connection, a bug in 
a thread using one channel can disturb the clean operation of other 
channels. (Partly because AMQP 0-8's error design is not as clean as it 
could be, and accidentally specifies connection-level errors in some 
cases where a channel-level error was clearly a better idea.)

> The application needs to be fail-safe and be able to restablish
> connections to the broker in case of network problems, broker goes
> down etc.

Many people have this need. It'd be great if you could share the design 
(or even the implementation!) of what you come up with for this; our 
java library is very much a thin layer atop the protocol, and could 
definitely stand to grow some affordances for the developer.

As a complete aside, since it's not directly relevant to getting 
something working for solving the problem you have, we've been thinking 
a little bit about how best to do reconnection/HA/etc in a 
language-neutral way. Our current thinking is something along the lines 
of a small, standalone, light-weight *client-side* AMQP proxy, 
accessible from any AMQP-speaking language library. The proxy would deal 
with connection reestablishment and message redelivery, making use of 
the "fate-sharing" notion used in the design of TCP. The idea is that 
it'd be trustworthy because it'd be on the same machine as the client 
itself. Such a proxy could also help with various HA and sharding 
scenarios (by automating and abstracting-out communication patterns like 
N-of-M and deduplication etc).

> I was also curious about performance. If a large amount of messages
> are sent, it seems like it would be more efficient to send those over
> a set of sockets ([1] or [3] above), instead of forcing them all
> through the only one available ([2] above).

Latency can suffer when multiplexing multiple channels over a socket, 
but generally not to more than epsilon above multiple sockets being 
multiplexed over an ethernet: after all, there's still just the one 
physical access medium! That said, 'one channel per connection' really 
should give slightly smoother operation -- at least in theory :)

Regards,
   Tony




From tonyg at lshift.net  Tue Jun 30 08:37:37 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 30 Jun 2009 08:37:37 +0100
Subject: [rabbitmq-discuss] .Net 2.0 and HTTPS as a client
In-Reply-To: <C6683015.16FE0%ken.anderson@sungard.com>
References: <C6683015.16FE0%ken.anderson@sungard.com>
Message-ID: <4A49C0C1.90308@lshift.net>

Hi Ken,

Anderson, Ken wrote:
>  RabbitMQ was on our short list because it has advertised the ability 
> for .Net access and HTTPS transports.
> Is anyone doing this?  Are there any gotchas?

The only gotcha I can think of is that there are apparently some issues 
with certificate validation under Mono. If you're using MS .NET, it 
should be fine.

Improved (i.e. built-in) SSL support for RabbitMQ is *this close* to 
landing in default, AIUI, meaning that stunnel will be able to be dropped.

Regards,
   Tony



From tonyg at lshift.net  Tue Jun 30 08:45:00 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 30 Jun 2009 08:45:00 +0100
Subject: [rabbitmq-discuss] Many clients using .NET API
In-Reply-To: <98842C6BBCC0764F8D92A62407D455F876E7A5@ex01kguk.Gazpromuk.intra>
References: <98842C6BBCC0764F8D92A62407D455F876E7A5@ex01kguk.Gazpromuk.intra>
Message-ID: <4A49C27C.8000802@lshift.net>

Hi Sam,

Sam Owen wrote:
> I?ve just started to look at RabbitMQ. I?m wondering whether the 
> following would be an idiomatic use of RabbitMQ from the .NET API:
> 
> Routing.Listen("queue1", "#", new ConsoleAlert());
> Routing.Listen("queue1", "news.#", new EmailAlert());
> Routing.Listen("queue2", "email.#", new ConsoleAlert());

Are you suggesting a layer atop IModel?

> Each call to Listen sets up a thread where the connection and channel 
> are maintained.

That makes sense -- especially if it could abstract away the three 
options for multiplexing channels over connections that Matthias 
Karlsson mentioned in 
<83eb635f0906250159u1c700aa6r94f0e124119393a0 at mail.gmail.com>.

Ah, I see by your implementation that you *are* suggesting a layer atop 
IModel! It looks, at a glance, plausible, but I'm afraid I'm not the man 
to at-a-glance evaluate the code more closely than that :-)

> Given that .NET processes are more heavy weight than erlang?s is this 
> the preferred way to set up many clients?

Hmm. Well, in Java there's a thread or so* per connection too, so it's 
not an awful way of doing it. On the other hand, if your error-handling 
model supports it, you could share a single channel between multiple 
subscriptions. It all depends (complexly) on the message rate, the 
consequences of a dropped connection, and the level of parallelism you 
want in your application.

Regards,
   Tony

* depending on heartbeat settings




From tonyg at lshift.net  Tue Jun 30 08:56:53 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 30 Jun 2009 08:56:53 +0100
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4A3136FB.7050209@lshift.net>
References: <db2bfd40906110659r5abc3293y178c4d2af8e98ac1@mail.gmail.com>
	<4A3136FB.7050209@lshift.net>
Message-ID: <4A49C545.6070300@lshift.net>

Matthias Radestock wrote:
> That is almost certainly caused by an operating system limit; there are 
> no limits in the client code. Try increasing the OS limits. No idea how 
> that's done on OSX but it shouldn't be hard.

bash$ help ulimit

, and

$ # POSIX C API for the same
$ man getrlimit
$ man setrlimit


Tony




From m.nacos at gmail.com  Tue Jun 30 09:31:41 2009
From: m.nacos at gmail.com (Michael Nacos)
Date: Tue, 30 Jun 2009 09:31:41 +0100
Subject: [rabbitmq-discuss] tcp -> rabbitmq gives emfile + 541
Message-ID: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>

Hi all and thank you for the Erlang Factory talks

I have tried to implement a very basic erlang tcp server which accepts
requests and forwards everything to rabbitmq exchanges. This is meant to be
a workaround the lack of a 0.8 C client, I am trying to get Postgresql to
send notifications through rabbitmq. Things work as expected up to a point,
until I get

{{badmatch,{error,emfile}},[{cinumber_daemon,connect,1}]}

followed by

Broker forced connection: 541 -> <<"INTERNAL_ERROR">>

I am pretty much an Erlang newbie, so please forgive me if this is not
really a rabbitmq issue. This could be useful to others, too.

cheers, Michael

Here is the relevant part of the code (I am certain recv_loop terminates):
recv_loop also does all the rabbity stuff (closes channel, closes
connection)

--------------------------------------------------------------------------------------------------

start_server() ->
    % start up the service and error out if we cannot
    case gen_tcp:listen(?LISTEN_PORT, ?TCP_OPTS) of
        {ok, Listen} ->
            spawn(?MODULE, connect, [Listen]),
            io:format("~p Server Started.~n", [erlang:localtime()]),
            sleep(infinity);
        Error ->
            io:format("Error: ~p~n", [Error])
    end.

connect(Listen) ->
    {ok, Socket} = gen_tcp:accept(Listen),
    inet:setopts(Socket, ?TCP_OPTS),
    % kick off another process to handle connections concurrently
    spawn(fun() -> connect(Listen) end),
    recv_loop(Socket),
    gen_tcp:close(Socket),
    exit(normal).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090630/16fef241/attachment.htm 

From sam.owen at gazprom-mt.com  Tue Jun 30 10:45:10 2009
From: sam.owen at gazprom-mt.com (Sam Owen)
Date: Tue, 30 Jun 2009 10:45:10 +0100
Subject: [rabbitmq-discuss] Many clients using .NET API
In-Reply-To: <4A49C27C.8000802@lshift.net>
References: <98842C6BBCC0764F8D92A62407D455F876E7A5@ex01kguk.Gazpromuk.intra>
	<4A49C27C.8000802@lshift.net>
Message-ID: <98842C6BBCC0764F8D92A62407D455F876E7C0@ex01kguk.Gazpromuk.intra>

Hi Tony,

Thanks for the feedback. Yes I'm looking to find a simple way to scale
publishers and subscribers to topics. We're only looking at a few dozen
of these which would be less than 100 threads in the worst case - the
CLR should be able to cope with. What's nice about this approach is that
we could scale to more processes or boxes if required. 

At the moment we're using non-durable topics only and the approach seems
to work fine. "Routing" has the following methods:

****
//IListener is a call back that receives the message, routing and
exchange the message was sent on
public static void Listen(Destination from, IListener alert) {...

//IFeed should not return until interrupted. It receives a blocking
queue to write messages to as needed
public static void Publish(Destination to, IFeed action) { ...

//The IEvent will be called according to the Quartz trigger. It is given
a blocking queue to write to.
public static void Schedule(Destination to, string jobName, Trigger
trigger, IEvent @event) { ...

//Listens to 'from', filters/transforms and publishes to 'to'.
public static void ListenTransformAndPublish(Destination from,
TransformingFeed feed, Destination to) { ...

//interrupts all threads
public static void Shutdown() { ...
****

Cheers, 
-- Sam

-----Original Message-----
From: Tony Garnock-Jones [mailto:tonyg at lshift.net] 
Sent: 30 June 2009 08:45
To: Sam Owen
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Many clients using .NET API

Hi Sam,

Sam Owen wrote:
> I've just started to look at RabbitMQ. I'm wondering whether the 
> following would be an idiomatic use of RabbitMQ from the .NET API:
> 
> Routing.Listen("queue1", "#", new ConsoleAlert());
> Routing.Listen("queue1", "news.#", new EmailAlert());
> Routing.Listen("queue2", "email.#", new ConsoleAlert());

Are you suggesting a layer atop IModel?

> Each call to Listen sets up a thread where the connection and channel 
> are maintained.

That makes sense -- especially if it could abstract away the three 
options for multiplexing channels over connections that Matthias 
Karlsson mentioned in 
<83eb635f0906250159u1c700aa6r94f0e124119393a0 at mail.gmail.com>.

Ah, I see by your implementation that you *are* suggesting a layer atop 
IModel! It looks, at a glance, plausible, but I'm afraid I'm not the man

to at-a-glance evaluate the code more closely than that :-)

> Given that .NET processes are more heavy weight than erlang's is this 
> the preferred way to set up many clients?

Hmm. Well, in Java there's a thread or so* per connection too, so it's 
not an awful way of doing it. On the other hand, if your error-handling 
model supports it, you could share a single channel between multiple 
subscriptions. It all depends (complexly) on the message rate, the 
consequences of a dropped connection, and the level of parallelism you 
want in your application.

Regards,
   Tony

* depending on heartbeat settings



The information transmitted is the property of Gazprom Marketing & Trading Ltd and is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material. Statements and opinions expressed in this e-mail may not represent those of the company. Any review, retransmission, dissemination and other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender immediately and delete the material from any computer. 

Registered office: Gazprom Marketing & Trading Ltd, Gazprom House, 60 Marina Place, Hampton Wick, Kingston upon Thames, KT1 4BH. Registered in England No. 3768267





From tonyg at lshift.net  Tue Jun 30 10:46:37 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 30 Jun 2009 10:46:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ C client (was Re: tcp -> rabbitmq gives
 emfile + 541)
In-Reply-To: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
References: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
Message-ID: <4A49DEFD.2040308@lshift.net>

Michael Nacos wrote:
> I have tried to implement a very basic erlang tcp server which accepts
> requests and forwards everything to rabbitmq exchanges. This is meant to
> be a workaround the lack of a 0.8 C client

I'm afraid I haven't the time right now to look at your code properly
(though glancing at it, I don't see anything wrong), but perhaps you'd
like to try http://hg.rabbitmq.com/rabbitmq-c ?

The instructions in this message should get you started -- simply omit
the "hg up amqp_0_9_1" steps:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-June/004304.html

You will need both rabbitmq-codegen and rabbitmq-c.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From matthias at yacc.se  Tue Jun 30 12:27:47 2009
From: matthias at yacc.se (Matthias Karlsson)
Date: Tue, 30 Jun 2009 13:27:47 +0200
Subject: [rabbitmq-discuss] Multithreaded application,
	separation of 	connections and channels
In-Reply-To: <4A49BFD5.40505@lshift.net>
References: <83eb635f0906250159u1c700aa6r94f0e124119393a0@mail.gmail.com>
	<4A49BFD5.40505@lshift.net>
Message-ID: <83eb635f0906300427y48d3d09fi24458e999473a578@mail.gmail.com>

Hi Tony,

thanks for your input!

>
> Unless you have a very high number of threads and/or separate VMs, your
> option (1) seems easiest to work with. Suitably abstracted, it can always be
> switched out for one of the others later.
>

Implementation-wise, this seems to be the easier one to get right and
it'll most likely be the one I'll use when prototyping. There will be
many instances of the same application (so more VMs) though so I will
have to make some careful benchmarking I think.

> Many people have this need. It'd be great if you could share the design (or
> even the implementation!) of what you come up with for this; our java
> library is very much a thin layer atop the protocol, and could definitely
> stand to grow some affordances for the developer.
>
> As a complete aside, since it's not directly relevant to getting something
> working for solving the problem you have, we've been thinking a little bit
> about how best to do reconnection/HA/etc in a language-neutral way. Our
> current thinking is something along the lines of a small, standalone,
> light-weight *client-side* AMQP proxy, accessible from any AMQP-speaking
> language library. The proxy would deal with connection reestablishment and
> message redelivery, making use of the "fate-sharing" notion used in the
> design of TCP. The idea is that it'd be trustworthy because it'd be on the
> same machine as the client itself. Such a proxy could also help with various
> HA and sharding scenarios (by automating and abstracting-out communication
> patterns like N-of-M and deduplication etc).
>

When I get something up and running (I haven't planned the actual work
until late July however) I can definitely share any information I have
found (ideas, code etc.).

My planned implementation for the fail-safe is to basically take an
existing solution I wrote for when the application communicated over
pure TCP sockets. Basically, each socket (5-10) is associated with a
thread hidden behind a common "output"-interface. This thread is
responsible for delivering messages received, and to (re)establish the
connection when needed. Further more, if messages are recieved when in
disconnected state, messages are queued waiting for the socket to be
reestablished. When the number of queued messages reach a certain
threshold, they are flushed to local disk to avoid an ultimate
OutOfMemoryException (these messages are then of course read back when
the connection is up again).

In this regard, this seems to be along the same lines as your proxy,
though yours is more general and low-level. Have you given any thought
about how to handle messages received when not connected? With proper
callbacks to application code, a developer could himself decide how to
handle messages that couldn't be delivered due to communication
problems, e.g. discard, save to disk locally, queue in memory and so
on. That is, perhaps make the failhandling pluggable with perhaps at
least two obvious implementations available by default, one that
discards messages and one that queues in memory forever waiting for
reconnect.

// Matthias



From mail at sebastian-latza.de  Tue Jun 30 17:04:19 2009
From: mail at sebastian-latza.de (Sebastian Latza)
Date: Tue, 30 Jun 2009 18:04:19 +0200
Subject: [rabbitmq-discuss] In-band listing of exchanges and queues
Message-ID: <78FF24D7-7291-466E-90B9-5C21C674890E@sebastian-latza.de>

Hi everybody,

I am looking for a way to list all declared exchanges, queues and  
links inside rabbitmq, preferrably AMQP-in-band. I have a client  
process which should be able to detect all active queues and as a  
result connect to them to listen for incoming messages. So basically a  
rabbitmqctl list_* whithout the shell ;)

Looking through the Java-client api there doesn't seem to be such an  
interface, but maybe there is some kind of proprietary "management  
exchange" inside rabbit I don't know of.

Regards
Sebastian



From riteshrathi at gmail.com  Tue Jun 30 19:33:06 2009
From: riteshrathi at gmail.com (rathi)
Date: Wed, 1 Jul 2009 00:03:06 +0530
Subject: [rabbitmq-discuss] In-band listing of exchanges and queues
In-Reply-To: <78FF24D7-7291-466E-90B9-5C21C674890E@sebastian-latza.de>
References: <78FF24D7-7291-466E-90B9-5C21C674890E@sebastian-latza.de>
Message-ID: <d31e757a0906301133y5035ec0cufb374b98f01bfbec@mail.gmail.com>

Check this link
http://leftrightfold.com/2009/04/26/how-to-build-rabbit-management-console/
or
http://www.nabble.com/Broker-data-td22577496.html

rathi

On Tue, Jun 30, 2009 at 9:34 PM, Sebastian Latza <mail at sebastian-latza.de>wrote:

> Hi everybody,
>
> I am looking for a way to list all declared exchanges, queues and
> links inside rabbitmq, preferrably AMQP-in-band. I have a client
> process which should be able to detect all active queues and as a
> result connect to them to listen for incoming messages. So basically a
> rabbitmqctl list_* whithout the shell ;)
>
> Looking through the Java-client api there doesn't seem to be such an
> interface, but maybe there is some kind of proprietary "management
> exchange" inside rabbit I don't know of.
>
> Regards
> Sebastian
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090701/d98e7567/attachment.htm 

From andrius.norkaitis at oryo.lt  Tue Jun 30 21:43:18 2009
From: andrius.norkaitis at oryo.lt (Andrius Norkaitis)
Date: Tue, 30 Jun 2009 23:43:18 +0300
Subject: [rabbitmq-discuss] RabbitMQ .NET deadlock after calling
	.CreateConnection
In-Reply-To: <4A3B945C.7010807@lshift.net>
References: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAOT+KPvJpqVHkPHiM6qtoMkBAAAAAA==@oryo.lt>
	<167204d20906190454g375d3fe4x5d3113102c63b0da@mail.gmail.com>
	<4A3B945C.7010807@lshift.net>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAGPzthVRDe9PgwIyDk6cGE/CgAAAEAAAAK0HzYNqratGvdgauhIJIGMBAAAAAA==@oryo.lt>

To answer to your question Matthias, we found that the thread blocks after
calling "using (conn = cf.CreateConnection(serverAddress))" (I provided our
source code some time ago). Currently we can't do more debugging on this.

This problem occurs only on the instable/bad quality internet connection (if
I just unplug cable it do not hangs). Few days ago I had problems with my
home internet (not only rabbit, but other software had connection problems
too) and that described problem with calling .CreateConnection after current
connection interups occurred frequently. Now it's ok, but to one of our
clients such connection losses with hangs up when reconnecting occurs few
times a day (perhaps their internet isn't very stable).

As for temporary solution we created monitoring thread, which aborts and
recreates thread which manages rabbit connection (if it starts not
responding after calling .CreateConnection).

Does anybody else use rabbit with internet (maybe 3G)? What reconnect
strategy do you use and had you ever any problems with .CreateConnection?
Hope this rare bug will be fixed in the future.

Best regards
Andrius

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: Friday, June 19, 2009 4:36 PM
To: Alexis Richardson
Cc: Andrius Norkaitis; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ .NET deadlock after calling
.CreateConnection

Alexis,

Alexis Richardson wrote:
> I just noticed nobody has replied to this thread.

Actually that thread got continued at
  http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-June/004192.html

to which I responded here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-June/004218.html

For some reason Nabble has put that message in the wrong thread:

http://www.nabble.com/RabbitMQ-stomp-adapter-behaviour-td23917501.html#a2399
7427

which probably explains why you thought nobody had responded.


Matthias.




From allen.fowler at yahoo.com  Tue Jun 30 22:51:12 2009
From: allen.fowler at yahoo.com (Allen Fowler)
Date: Tue, 30 Jun 2009 14:51:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Sample code for python?
Message-ID: <795548.16020.qm@web45601.mail.sp1.yahoo.com>


Hello,

I am looking at RabbitMQ to perhaps add message passing to a Python program being written.   

Right now "messages" are being pased in and out of a database.  Not a very good solution.

How hard is it to produce and consume messages from Python using RabbitMQ?  What libraries do I need, and is there sample code  / tutorial available?

Thank you,
:)


      




From clemesha at gmail.com  Tue Jun 30 22:57:49 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Tue, 30 Jun 2009 14:57:49 -0700
Subject: [rabbitmq-discuss] Sample code for python?
In-Reply-To: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
Message-ID: <d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>

On Tue, Jun 30, 2009 at 2:51 PM, Allen Fowler<allen.fowler at yahoo.com> wrote:
>
> Hello,
>
> I am looking at RabbitMQ to perhaps add message passing to a Python program being written.
>
> Right now "messages" are being pased in and out of a database. ?Not a very good solution.
>
> How hard is it to produce and consume messages from Python using RabbitMQ? ?What libraries do I need, and is there sample code ?/ tutorial available?

It's both fun and pretty easy to get started.

Start here:
http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/


-Alex





> Thank you,
> :)
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Alex Clemesha
clemesha.org



