<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Scheduled Message Delivery
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Scheduled%20Message%20Delivery&In-Reply-To=%3CAD65495C-D45A-47BA-BCF3-061B47EABB7F%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019292.html">
   <LINK REL="Next"  HREF="019290.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Scheduled Message Delivery</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Scheduled%20Message%20Delivery&In-Reply-To=%3CAD65495C-D45A-47BA-BCF3-061B47EABB7F%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Scheduled Message Delivery">steve at rabbitmq.com
       </A><BR>
    <I>Fri Mar 30 14:28:00 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019292.html">[rabbitmq-discuss] Scheduled Message Delivery
</A></li>
        <LI>Next message: <A HREF="019290.html">[rabbitmq-discuss] RabbitMQ and SockJS at London Realtime hackathon	- April 13th - 15th
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19296">[ date ]</a>
              <a href="thread.html#19296">[ thread ]</a>
              <a href="subject.html#19296">[ subject ]</a>
              <a href="author.html#19296">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>James, 

There is no such thing as a dead-letter queue. Just dead-letter
exchanges.

You never attached any consumers to the 'send.later' queue which has the
delayed messages, and the broker certainly doesn't attach any, so an
auto-delete event will never get triggered for that queue.

The act of transferring the messages from 'send.later' to the 'real' one
when the messages expire doesn't use consumers, and the broker is not
&quot;maintaining a connection&quot; to it.  The x-expires argument on the queue
is the right solution, but for the wrong reason; the auto-delete option
is not necessary.

Steve Powell
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 30 Mar 2012, at 12:59, James Carr wrote:

&gt;<i> Yeah, my suspicion is the broker might be a consumer when the queue is
</I>&gt;<i> dead lettered. Because until I defined it as a dead letter queue it
</I>&gt;<i> disappeared as soon as my consumer went away.
</I>&gt;<i> 
</I>&gt;<i> Still pretty cool though. I like it. :)
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> James
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Fri, Mar 30, 2012 at 5:29 AM, Steve Powell &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>&gt; wrote:
</I>&gt;&gt;<i> Fascinating James,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I think the reason the queue stays around (even though you specify
</I>&gt;&gt;<i> auto-delete) is because auto-delete on queues is designed to be
</I>&gt;&gt;<i> triggered when the last consumer is cancelled. If there are never any
</I>&gt;&gt;<i> consumers for the queue this event never occurs and the queue stays
</I>&gt;&gt;<i> around. (If this wasn't the case, an auto-delete queue could disappear
</I>&gt;&gt;<i> as soon as it was created!). It's all in the spec  :-)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Steve Powell
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
</I>&gt;&gt;<i> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On 30 Mar 2012, at 07:42, James Carr wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Hey All,
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I thought I'd share a neat &quot;trick&quot; I came up with lately to &quot;schedule&quot;
</I>&gt;&gt;&gt;<i> messages to be delivered at a specific duration. I had a lot of
</I>&gt;&gt;&gt;<i> polling going on in my application for things like scheduling
</I>&gt;&gt;&gt;<i> callbacks with leads and was getting sick of having to add even more
</I>&gt;&gt;&gt;<i> interval based polling each time a new feature came along.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> So here's an example of what I'm doing to schedule messages to be
</I>&gt;&gt;&gt;<i> delivered at a time in the future:
</I>&gt;&gt;&gt;<i> <A HREF="https://github.com/jamescarr/rabbitmq-scheduled-delivery.">https://github.com/jamescarr/rabbitmq-scheduled-delivery.</A> It makes
</I>&gt;&gt;&gt;<i> interesting use of x-message-ttl and x-dead-letter-exchange. :)
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Cheers,
</I>&gt;&gt;&gt;<i> James
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> 
</I>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019292.html">[rabbitmq-discuss] Scheduled Message Delivery
</A></li>
	<LI>Next message: <A HREF="019290.html">[rabbitmq-discuss] RabbitMQ and SockJS at London Realtime hackathon	- April 13th - 15th
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19296">[ date ]</a>
              <a href="thread.html#19296">[ thread ]</a>
              <a href="subject.html#19296">[ subject ]</a>
              <a href="author.html#19296">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
