<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss]  problem on queue depth checking?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%20problem%20on%20queue%20depth%20checking%3F&In-Reply-To=%3C33494003.post%40talk.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018860.html">
   <LINK REL="Next"  HREF="018777.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss]  problem on queue depth checking?</H1>
    <B>sameekmishra</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%20problem%20on%20queue%20depth%20checking%3F&In-Reply-To=%3C33494003.post%40talk.nabble.com%3E"
       TITLE="[rabbitmq-discuss]  problem on queue depth checking?">sameek at arosys.com
       </A><BR>
    <I>Tue Mar 13 13:01:13 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018860.html">[rabbitmq-discuss] Issue with running two RabbitMQ servers on	one machine
</A></li>
        <LI>Next message: <A HREF="018777.html">[rabbitmq-discuss] problem on queue depth checking?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18776">[ date ]</a>
              <a href="thread.html#18776">[ thread ]</a>
              <a href="subject.html#18776">[ subject ]</a>
              <a href="author.html#18776">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi All,

I am running a thread for checking the depth of queue(i.e. no of messages in
queue), and one thread to consume the message.
Both the threads are running infinitely.
in both the thread the common object is mq connection object. In both thread
i am creating seperate channel and binding them with same queue.
Consumer thread consumes message if available and then sleep for 1
minutes(This scenario is for testing only).
Queue Depth checking thread checks the queuedepth and then sleep for 10
seconds.
Now if i publish 2 messages then one message will be consumed(and thread
will sleep for one minute) and one will be in the queue;
And queue depth checking thread must show the queuedepth = 1. But I am
getting the queuedepth 0.
But if we dont consume the message from queue then queuedepth is shown
correctly. 

I observed that the below code creating separte channel and both are reading
same queue. may that is the reason it show queuedeptha wrong.

used consumer code:

		channel = connection.createChannel();
                channel.exchangeDeclare(requestExchangeName, exchangeType,
durable);
                channel.queueDeclare(requestQueueName, durable, false,
false, null);
                channel.queueBind(requestQueueName, requestExchangeName,
requestRoutingKey);
                consumer = new QueueingConsumer(channel);
                channel.basicConsume(requestQueueName, noAck, consumer);

used queueDepth code:

                channel = connection.createChannel();
		DeclareOk queueDeclarePassive = channel.queueDeclarePassive(queueName);
                queueDepth=  queueDeclarePassive.getMessageCount();
                

please help me to figure out the problem and solution as well.
-- 
View this message in context: <A HREF="http://old.nabble.com/problem-on-queue-depth-checking--tp33494003p33494003.html">http://old.nabble.com/problem-on-queue-depth-checking--tp33494003p33494003.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.

</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018860.html">[rabbitmq-discuss] Issue with running two RabbitMQ servers on	one machine
</A></li>
	<LI>Next message: <A HREF="018777.html">[rabbitmq-discuss] problem on queue depth checking?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18776">[ date ]</a>
              <a href="thread.html#18776">[ thread ]</a>
              <a href="subject.html#18776">[ subject ]</a>
              <a href="author.html#18776">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
