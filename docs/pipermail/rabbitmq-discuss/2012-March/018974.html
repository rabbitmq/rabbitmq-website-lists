<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Active consumers in declare-ok is less than the	actual number of consumers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active%20consumers%20in%20declare-ok%20is%20less%20than%0A%20the%09actual%20number%20of%20consumers&In-Reply-To=%3C4F68674C.4030407%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018964.html">
   <LINK REL="Next"  HREF="018982.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Active consumers in declare-ok is less than the	actual number of consumers</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Active%20consumers%20in%20declare-ok%20is%20less%20than%0A%20the%09actual%20number%20of%20consumers&In-Reply-To=%3C4F68674C.4030407%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Active consumers in declare-ok is less than the	actual number of consumers">simon at rabbitmq.com
       </A><BR>
    <I>Tue Mar 20 11:17:32 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018964.html">[rabbitmq-discuss] Active consumers in declare-ok is less than the	actual number of consumers
</A></li>
        <LI>Next message: <A HREF="018982.html">[rabbitmq-discuss] Active consumers in declare-ok is less than the actual number of consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18974">[ date ]</a>
              <a href="thread.html#18974">[ thread ]</a>
              <a href="subject.html#18974">[ subject ]</a>
              <a href="author.html#18974">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/03/12 06:43, Gerolf Seitz wrote:
&gt;<i> When passively declaring a queue, the returned consumer count is not the
</I>&gt;<i> same as the consumer count via the management plugin / http API. Turns
</I>&gt;<i> out, rabbitmq returns the number of consumers that are ready to receive
</I>&gt;<i> a message.
</I>&gt;<i>
</I>&gt;<i> As an example: there are 5 (manually acknowledging) consumers, 3 of
</I>&gt;<i> which have consumed a message from the queue, but have not sent an ACK
</I>&gt;<i> for the respective messages to the broker. Declaring a queue now returns
</I>&gt;<i> a declare-ok with consumer-count == 2, whereas I would have expected it
</I>&gt;<i> to be 5.
</I>&gt;<i>
</I>&gt;<i> Looking at the rabbitmq-server code reveals that the &quot;active consumer&quot;
</I>&gt;<i> part of the state is used for getting the next consumer for round robin
</I>&gt;<i> delivery and returning the number of consumers as part of the declare-ok
</I>&gt;<i> message.
</I>&gt;<i>
</I>&gt;<i> Since I don't suspect this to be an oversight but rather a conscious
</I>&gt;<i> decision, I'm interested in the rationale behind it. I'm aware that
</I>&gt;<i> changing the semantics at this point is probably not possible and I may
</I>&gt;<i> have to resort to fetching the consumer count via the http api (which
</I>&gt;<i> brings some organizational overhead).
</I>&gt;<i>
</I>&gt;<i> Can anybody shed some light on this?
</I>
Hi Gerolf.

Yes, this is deliberate. Code archaeology yielded this:

<A HREF="http://hg.rabbitmq.com/rabbitmq-server/rev/32e357ad03d6">http://hg.rabbitmq.com/rabbitmq-server/rev/32e357ad03d6</A>

&quot;count queue consumers as required by the spec&quot;.

The spec actually says:

     Reports the number of active consumers for the queue. Note that
     consumers can  suspend activity (Channel.Flow) in which case they
     do not appear in this count.

So that is slightly ambiguous - we are excluding consumers that have 
issued channel.flow, but also those which are blocked due to qos / ack 
interaction. But those could easily be defined as &quot;inactive&quot;...

Hmm. I'll have a think about this. What are you trying to do?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>












































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018964.html">[rabbitmq-discuss] Active consumers in declare-ok is less than the	actual number of consumers
</A></li>
	<LI>Next message: <A HREF="018982.html">[rabbitmq-discuss] Active consumers in declare-ok is less than the actual number of consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18974">[ date ]</a>
              <a href="thread.html#18974">[ thread ]</a>
              <a href="subject.html#18974">[ subject ]</a>
              <a href="author.html#18974">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
