<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How to persist message when mq server	restarts?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20persist%20message%20when%20mq%20server%0A%09restarts%3F&In-Reply-To=%3C4F6317BB.7030107%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018894.html">
   <LINK REL="Next"  HREF="018895.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How to persist message when mq server	restarts?</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20persist%20message%20when%20mq%20server%0A%09restarts%3F&In-Reply-To=%3C4F6317BB.7030107%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] How to persist message when mq server	restarts?">simon at rabbitmq.com
       </A><BR>
    <I>Fri Mar 16 10:36:43 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018894.html">[rabbitmq-discuss] How to persist message when mq server restarts?
</A></li>
        <LI>Next message: <A HREF="018895.html">[rabbitmq-discuss] newbie problem--'Error: unable to connect to node 'rabbit at rabbitmq-small02-dev': nodedown'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18898">[ date ]</a>
              <a href="thread.html#18898">[ thread ]</a>
              <a href="subject.html#18898">[ subject ]</a>
              <a href="author.html#18898">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/03/12 10:18, cheepu wrote:
&gt;<i> Messages are persistent when the server is running but when I restart the
</I>&gt;<i> server all the published messages are lost. For now there are no consumer
</I>&gt;<i> running.
</I>
You are not using confirms or transactions - therefore you are telling 
RabbitMQ that the messages should be persisted, but not that there is 
any rush to do so. And RabbitMQ 2.7.1 will really not rush to do so in 
this situation.

The upcoming 2.8.0 release will be more aggressive about persisting 
messages in the absence of confirms / tx, but there is always the 
possibility of message loss if you are just asking RabbitMQ to persist 
the messages, but not tell you when it has done so.

I would suggest that you either:

* Wrap a batch of publishes in a transaction. When the transaction has 
committed, you know the messages are on disc.

* Switch on confirm mode, and every so often invoke the convenience 
method Channel.waitForConfirms(). When this has returned, you know the 
messages are on disc.

* For best performance, switch on confirm mode and add a confirm 
listener to your channel. You will then get notified whenever a message 
or batch of messages makes it to disc.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018894.html">[rabbitmq-discuss] How to persist message when mq server restarts?
</A></li>
	<LI>Next message: <A HREF="018895.html">[rabbitmq-discuss] newbie problem--'Error: unable to connect to node 'rabbit at rabbitmq-small02-dev': nodedown'
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18898">[ date ]</a>
              <a href="thread.html#18898">[ thread ]</a>
              <a href="subject.html#18898">[ subject ]</a>
              <a href="author.html#18898">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
