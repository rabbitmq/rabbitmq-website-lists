<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Federated exchange slowdown
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federated%20exchange%20slowdown&In-Reply-To=%3CCAOn7oW_rzuZPVxUjC-wqAXZhHaG3kYMvh%2BvDZffQYdEy%3DwK4Dg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018916.html">
   <LINK REL="Next"  HREF="018930.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Federated exchange slowdown</H1>
    <B>Simone Busoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federated%20exchange%20slowdown&In-Reply-To=%3CCAOn7oW_rzuZPVxUjC-wqAXZhHaG3kYMvh%2BvDZffQYdEy%3DwK4Dg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Federated exchange slowdown">simone.busoli at gmail.com
       </A><BR>
    <I>Sun Mar 18 11:42:58 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018916.html">[rabbitmq-discuss] Federated exchange slowdown
</A></li>
        <LI>Next message: <A HREF="018930.html">[rabbitmq-discuss] Federated exchange slowdown
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18922">[ date ]</a>
              <a href="thread.html#18922">[ thread ]</a>
              <a href="subject.html#18922">[ subject ]</a>
              <a href="author.html#18922">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Following up on this issue, the problem has worsened to a great extent.
Here's a bit more information about the setup.
Two brokers B1 and B2, running version 2.7.1 and Erlang R14B04 on Windows,
about 15000 km away from each other. Both machines running the brokers are
physical machines with several cores, lots of RAM, fast disks, and reported
no problems in disk access, CPU or memory consumption.

We have two federated durable topic exchanges X1 and X2, the upstream
connection to the other broker is configured with an hearbeat of a few
seconds and the prefetch count is 100. X1 is bidirectionally federated with
max_hops = 1 to prevent messages from going in loops (which nonetheless
suffer the additional roundtrip before being discarded, a problem I
reported a while ago), X2 unidirectionally federated from B1 to B2.
Messages are all published on B1, all those published on X1 are persistent,
while those published on X2 aren't. Messages are published on X1 with an
average rate of 3 msg/sec, and on X2 with an average rate of 10 msg/sec.

What we experienced is that messages published on X1 queue up on the
outgoing queue on B1, and even worse on the outgoing queue on B2 (although
we don't care about them as the would be discarded once delivered thanks to
the max_hops setting). Looking at the Web UI it appears that the
acknowledges for those messages come in more slowly than messages are
published, but I really can't understand why this might be the case, given
the very low publish rate. The visible effect is a delay of even several
minutes between when a message is published on B1 and received on B2, but
again, only for the low-rate messages published on X1 (perhaps even worse
for the other direction if the messages were not thrown away by the
federation because of the max_hops setting, as the outgoing queue on B2 has
several thousands of messages versus the few hundreds of that on B1). In
other words, the only difference between the two federated exchanges
appears to be the bidirectionality of the first versus the
unidirectionality of the second and the fact that those published on the
first are persistent.
The logs of the two brokers contain apparently no relevant information, and
the network link between the two has always appeared to be in a good state.

Any help is appreciated

On Sat, Mar 17, 2012 at 05:09, Busoli, Simone &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">Simone.Busoli at ferrari.com</A>&gt;wrote:

&gt;<i>  Hello, I&#8217;ve experienced an unexpected behavior with a federated exchange
</I>&gt;<i> whereby messages would build-up on the upstream queue for no apparent
</I>&gt;<i> reasons.****
</I>&gt;<i>
</I>&gt;<i> The network link seemed ok, as well as the two machines on which the
</I>&gt;<i> brokers are installed.****
</I>&gt;<i>
</I>&gt;<i> I would like to know under which circumstances the federation plugin on
</I>&gt;<i> the downstream would slowdown pulling messages from the upstream.****
</I>&gt;<i>
</I>&gt;<i> ** **
</I>&gt;<i>
</I>&gt;<i> Thanks****
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _________________________________________________________________________________________________________________
</I>&gt;<i> Questo messaggio e da intendersi esclusivamente ad uso del destinatario e
</I>&gt;<i> puo contenere informazioni che sono di natura privilegiata, confidenziale
</I>&gt;<i> o non divulgabile secondo le leggi vigenti. Se il lettore del presente
</I>&gt;<i> messaggio non e il destinatario designato, o il dipendente/agente
</I>&gt;<i> responsabile
</I>&gt;<i> per la consegna del messaggio al destinatario designato, si informa che
</I>&gt;<i> ogni disseminazione, distribuzione o copiatura di questa comunicazione e
</I>&gt;<i> strettamente proibita anche ai sensi del decreto legislativo 196/03 . Se
</I>&gt;<i> avete ricevuto questo messaggio per errore, vi preghiamo di notificarcelo
</I>&gt;<i> immediatamente a mezzo e-mail di risposta e successivamente di procedere
</I>&gt;<i> alla cancellazione di questa e-mail e relativi allegati dal vostro sistema.
</I>&gt;<i>
</I>&gt;<i> _________________________________________________________________________________________________________________
</I>&gt;<i> This message is intended only for the use of the addressee and may contain
</I>&gt;<i> information that is privileged, confidential and exempt from
</I>&gt;<i> disclosure under applicable law. If the reader of this message is not the
</I>&gt;<i> intended recipient, or the employee or agent responsible for delivering the
</I>&gt;<i> message to the intended recipient, you are hereby notified that any
</I>&gt;<i> dissemination, distribution or copying of this communication is strictly
</I>&gt;<i> prohibited. If you have received this e-mail in error, please notify us
</I>&gt;<i> immediately by return e-mail and delete this e-mail and all attachments
</I>&gt;<i> from
</I>&gt;<i> your system.
</I>&gt;<i>
</I>&gt;<i> _________________________________________________________________________________________________________________
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120318/86227ae9/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120318/86227ae9/attachment.htm</A>&gt;
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018916.html">[rabbitmq-discuss] Federated exchange slowdown
</A></li>
	<LI>Next message: <A HREF="018930.html">[rabbitmq-discuss] Federated exchange slowdown
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18922">[ date ]</a>
              <a href="thread.html#18922">[ thread ]</a>
              <a href="subject.html#18922">[ subject ]</a>
              <a href="author.html#18922">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
