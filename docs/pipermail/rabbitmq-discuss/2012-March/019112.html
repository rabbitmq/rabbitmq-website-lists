<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ hangs, does not accept connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20hangs%2C%20does%20not%20accept%20connections&In-Reply-To=%3CCANTUpDDgWVbkXu%2B2ph9O7VcWCHdXyWXYDi3spEbL03LizdhW%2BQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018685.html">
   <LINK REL="Next"  HREF="018598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ hangs, does not accept connections</H1>
    <B>Dmitri Minaev</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20hangs%2C%20does%20not%20accept%20connections&In-Reply-To=%3CCANTUpDDgWVbkXu%2B2ph9O7VcWCHdXyWXYDi3spEbL03LizdhW%2BQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ hangs, does not accept connections">minaev at gmail.com
       </A><BR>
    <I>Mon Mar 26 06:45:45 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018685.html">[rabbitmq-discuss] RabbitMQ hangs, does not accept connections
</A></li>
        <LI>Next message: <A HREF="018598.html">[rabbitmq-discuss] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19112">[ date ]</a>
              <a href="thread.html#19112">[ thread ]</a>
              <a href="subject.html#19112">[ subject ]</a>
              <a href="author.html#19112">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9 March 2012 16:37, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
&gt;<i> On 09/03/12 07:57, Dmitri Minaev wrote:
</I>
&gt;&gt;<i> If I understand correctly, the number of file descriptors used by
</I>&gt;&gt;<i> RabbitMQ in normal situation is roughly equal to the number of
</I>&gt;&gt;<i> `rabbitmqctl list_connections` + some constant (~30)? In case of that
</I>&gt;&gt;<i> hanging server, the number of AMQP connections never was close to the
</I>&gt;&gt;<i> FD limit (ulimit -n is 1024, fs.file-max = 1605698). The graph
</I>&gt;&gt;<i> reflecting &#160;the number of open AMQP connections is attached to this
</I>&gt;&gt;<i> message.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It's not really a constant, but to a first approximation, yes.
</I>&gt;<i>
</I>&gt;<i> Ultimately, the error I saw being passed up from the OS was ENFILE - that's
</I>&gt;<i> pretty unambiguous :)
</I>&gt;<i>
</I>&gt;<i> It's possible that if you're churning connections then &quot;closed&quot; connections
</I>&gt;<i> in FIN_WAIT2 could account for the majority of the used FDs. In 2.8.0 we'll
</I>&gt;<i> set SO_LINGER to 0 to prevent this.
</I>
I am still not sure about the role of the file descriptors in this
event. Last Friday, our Rabbit died again. Until the very last moment
the number of open file descriptors as reported by the management
plugin was 143 out of the total available number of 32765. It was
RabbitMQ v.2.7.0. On that same day I have upgraded to 2.8.1. Will
report on its behaviour later.

-- 
With best regards,
Dmitri Minaev
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018685.html">[rabbitmq-discuss] RabbitMQ hangs, does not accept connections
</A></li>
	<LI>Next message: <A HREF="018598.html">[rabbitmq-discuss] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19112">[ date ]</a>
              <a href="thread.html#19112">[ thread ]</a>
              <a href="subject.html#19112">[ subject ]</a>
              <a href="author.html#19112">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
