<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Testing Shovel on a WAN
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Testing%20Shovel%20on%20a%20WAN&In-Reply-To=%3CC3481B5CE3E61E438EEF6143B51DC17F66A0C1C356%40Y000IIIV01.rd1.rf1%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019214.html">
   <LINK REL="Next"  HREF="019220.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Testing Shovel on a WAN</H1>
    <B>MELIQUE Denis (MORPHO)</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Testing%20Shovel%20on%20a%20WAN&In-Reply-To=%3CC3481B5CE3E61E438EEF6143B51DC17F66A0C1C356%40Y000IIIV01.rd1.rf1%3E"
       TITLE="[rabbitmq-discuss] Testing Shovel on a WAN">denis.melique at morpho.com
       </A><BR>
    <I>Wed Mar 28 14:47:05 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019214.html">[rabbitmq-discuss] Why default connection heartbeat = 0?
</A></li>
        <LI>Next message: <A HREF="019220.html">[rabbitmq-discuss] Testing Shovel on a WAN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19215">[ date ]</a>
              <a href="thread.html#19215">[ thread ]</a>
              <a href="subject.html#19215">[ subject ]</a>
              <a href="author.html#19215">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'am testing shovel with Rabbit 2.7.1.
I set two clusters of 2 hosts RedHat 6, and a shovel configuration to forward incoming messages from one
cluster to the other.
Messages shoveled from one cluster to the other, are travelling through a bridge (Linux machine configured as bridge).
I can change the bridge configuration to simulate a WAN (slow speed, add latency, lose some packets),
I also can cut the WAN by resetting the bridge, wait a while and then reconnect it, to simulate a network outage.

The input throughput is about 4Mbit/s.

In most of cases everything is fine, I just notice two things :

First:
-----
When I slow the WAN to 1 Mbit/s, I see messages accumulating in the shovel queue, which is what as expected.
Then once my throughput go to zero, messages are slowly transferred to the distant cluster, and that's OK as well.

The problem is that messages are not processed in the same order on the distant cluster than on the local.
My feeling is that with 1 Mbit/s some messages fail to be transferred correctly, and are re-sent later.
( I have the same problem when I simulate a very high level of packet loss (30%), with a 10Mbit/s speed)

Is there such a logic in Shovel ?
Is there a way to configured Shovel to guaranty the sequence of messages ?

Second:
---------
When a simulate a WAN outage lasting 2 hours, messages staying in the shovel queue have a status,
first set to &quot;unacknowledged&quot;.
Then, after about 900 sec,  they all have their status changed to &quot;ready&quot;.
When the network recovers, all the pending messages change back to &quot;unacknowledged&quot;, before being sent
to the distant cluster.
It does not seems to be a problem for us, just I'd like to understand this behavior, and if it could impact rabbit performances.

Thank you.

Denis
#
&quot; Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract&#232;re priv&#233;. S'ils ne vous sont pas destin&#233;s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani&#232;re que ce soit le contenu. Si ce message vous a &#233;t&#233; transmis par erreur, merci d'en informer l'exp&#233;diteur et de supprimer imm&#233;diatement de votre syst&#232;me informatique ce courriel ainsi que tous les documents qui y sont attach&#233;s.&quot;
******
&quot; This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system.&quot;
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/30769a2b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120328/30769a2b/attachment.htm</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019214.html">[rabbitmq-discuss] Why default connection heartbeat = 0?
</A></li>
	<LI>Next message: <A HREF="019220.html">[rabbitmq-discuss] Testing Shovel on a WAN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19215">[ date ]</a>
              <a href="thread.html#19215">[ thread ]</a>
              <a href="subject.html#19215">[ subject ]</a>
              <a href="author.html#19215">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
