<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [help] [beginner] what are the semantics of channels? (was testing with pika)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Bhelp%5D%20%5Bbeginner%5D%20what%20are%20the%20semantics%20of%0A%20channels%3F%20%28was%20testing%20with%20pika%29&In-Reply-To=%3CCAKYODbjnwtuCumC3i5pZASGOzUu8JmwACzwDU6ZyENYHM56gSg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018590.html">
   <LINK REL="Next"  HREF="018595.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [help] [beginner] what are the semantics of channels? (was testing with pika)</H1>
    <B>Alistair Bayley</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Bhelp%5D%20%5Bbeginner%5D%20what%20are%20the%20semantics%20of%0A%20channels%3F%20%28was%20testing%20with%20pika%29&In-Reply-To=%3CCAKYODbjnwtuCumC3i5pZASGOzUu8JmwACzwDU6ZyENYHM56gSg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] [help] [beginner] what are the semantics of channels? (was testing with pika)">alistair at abayley.org
       </A><BR>
    <I>Mon Mar  5 22:36:22 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018590.html">[rabbitmq-discuss] Serialized Java Objects in Message bodies	not supported by RabbitMQ??
</A></li>
        <LI>Next message: <A HREF="018595.html">[rabbitmq-discuss] [help] [beginner] what are the semantics of channels? (was testing with pika)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18594">[ date ]</a>
              <a href="thread.html#18594">[ thread ]</a>
              <a href="subject.html#18594">[ subject ]</a>
              <a href="author.html#18594">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29 February 2012 23:28, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
&gt;&gt;<i>
</I>&gt;&gt;<i> Pika (is this better posted to the pika mailing list?):
</I>&gt;<i> Maybe?
</I>
Well, the pika mailing list looks a bit dead, so I was hoping I'd get
better mileage here. The pika FAQ recommends posting here.


&gt;&gt;<i> 4. &#160;why doesn't basic_ack do what I expect?
</I>&gt;<i> That sounds like somehow the ack is malformed somehow (wrong ack tag?) and
</I>
Turns out it was because I had enabled transactions on the channel,
and was not commiting the ack. My mistake.


&gt;<i> The server is not swallowing the message without responding; it's stopped
</I>&gt;<i> accepting messages altogether, and will (eventually) send confirms for
</I>&gt;<i> everything it's accepted. However, in this scenario you're presumably
</I>&gt;<i> hammering the server with messages, and in that case there can be lots of
</I>&gt;<i> messages waiting in the OS TCP buffers - RabbitMQ hasn't seen them at all.
</I>&gt;<i>
</I>&gt;<i> It's not clear what else RabbitMQ could do in this situation - for
</I>&gt;<i> guaranteed delivery you need to treat the message as the producer's
</I>&gt;<i> responsibility until you see the confirm or tx.commit-ok.
</I>
A nack or reject would be nice; then the client can decide to retry
later or discard. I can see that I should implement a timeout on the
client.

I've done some more testing with the server in this situation as best
I can; I've simulated it by setting the high-water-mark to 0. The test
creates two channels, and two queues:
 - in channel 1 we publish a message to queue 2, and then get from
queue 1 (queue 1 is always empty)
 - in channel 2 we get from queue 2

When the server has breached the high-water-mark, both gets wait
indefinitely for a response from the server. Is this what I should
expect? I was hoping that consumer channels would still be responsive,
but it looks like the entire connection is blocked.

Some other variations:
 - no publish i.e. all we do is get from empty queues: the server is responsive.
 - publish on channel 1 to queue 2, get in channel 2 from queue 2
(i.e. no get in channel 1, so channel 1 is pure producer, channel 2 is
pure consumer): hangs/waits after Basic.Get.
 - 3rd channel that gets from empty queue 3: hangs/waits after Basic.Get.
 - a separate connection that gets from queue 2 is ok; it receives a
Basic.GetEmpty.


Also, when the client shuts down, the channels are closed on the
client (channel close callback is invoked with code 200), but they
remain on the server, causing a resource leak. From tcpdump I can see
the client sending Channel.Close frames, but it does not get back
Channel.Close-Ok from the server, which is what happens in the normal
case (where the server is not throttling clients).

Alistair
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018590.html">[rabbitmq-discuss] Serialized Java Objects in Message bodies	not supported by RabbitMQ??
</A></li>
	<LI>Next message: <A HREF="018595.html">[rabbitmq-discuss] [help] [beginner] what are the semantics of channels? (was testing with pika)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18594">[ date ]</a>
              <a href="thread.html#18594">[ thread ]</a>
              <a href="subject.html#18594">[ subject ]</a>
              <a href="author.html#18594">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
