<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Basics: Queues, Routing Keys
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Basics%3A%20Queues%2C%20Routing%20Keys&In-Reply-To=%3C27963806.509.1333065421119.JavaMail.geo-discussion-forums%40yno37%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019272.html">
   <LINK REL="Next"  HREF="019288.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Basics: Queues, Routing Keys</H1>
    <B>aloharich</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Basics%3A%20Queues%2C%20Routing%20Keys&In-Reply-To=%3C27963806.509.1333065421119.JavaMail.geo-discussion-forums%40yno37%3E"
       TITLE="[rabbitmq-discuss] Basics: Queues, Routing Keys">rich.aloha at gmail.com
       </A><BR>
    <I>Fri Mar 30 00:57:01 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019272.html">[rabbitmq-discuss] Must basic.reject be done on the same channel as received on?
</A></li>
        <LI>Next message: <A HREF="019288.html">[rabbitmq-discuss] Basics: Queues, Routing Keys
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19282">[ date ]</a>
              <a href="thread.html#19282">[ thread ]</a>
              <a href="subject.html#19282">[ subject ]</a>
              <a href="author.html#19282">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm trying to wrap my head around exchanges,queues, routing keys. My 
assumption which code is proving incorrect is: I can create a single 
exchange, with multiple queues. A consumer can point to a particular queue 
and get messages just for that queue. Now here is where my brain loses the 
plot: I had assumed I could use routing keys to have particular consumers 
just get messages on a queue that match a particular &quot;routing_key'.

So assuming I have a queue FOO and a queue BAR, I'd expect the below 
senders messages to queue BAR to NOT show up on queue FOO. However, when 
running the below, the queue FOO receiver receives messages if the routing 
key matches 

% python send.py a.b.c
% python recy.py a.b.c
(receives a message on QUEUE FOO since it appears routing key is matching)

Are routing keys global? Ie, if you have a key a.b.c any body on any queue 
will match that?

What I'm trying to achieve is the ability to send certain messages that 
only a group of consumers on a particular &quot;queue&quot; will process.

Thanks,

Rich


#!/usr/bin/env python
import pika
import sys

ex = &quot;dev.test&quot;
q = &quot;BAR&quot;

connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='127.0.0.1'))
channel = connection.channel()
channel.exchange_declare(exchange=ex,
                         type='direct', durable=True)
result = channel.queue_declare(queue=q,auto_delete=False, durable=True)
print &quot;queue %s&quot; % result.method.queue
channel.queue_bind(exchange=ex,
                   queue=q)
routing_key = sys.argv[1] if len(sys.argv) &gt; 1 else 'anonymous.info'
message = &quot;hello&quot;
for i in range(1,2):
    channel.basic_publish(exchange=ex,
                          routing_key=routing_key,
                          body=message,
                          properties=pika.BasicProperties(
            delivery_mode = 2, 
            ))
    print &quot; [x] Sent %r&quot; % (message,)


recv:

#!/usr/bin/env python
import pika
import sys

ex = &quot;dev.test&quot;
q = &quot;FOO&quot;

connection = pika.BlockingConnection(pika.ConnectionParameters(
        host='127.0.0.1'))
channel = connection.channel()
channel.exchange_declare(exchange=ex,
                         type='direct', durable=True)

result = channel.queue_declare(queue=q, durable=True)
queue_name = result.method.queue
binding_keys = sys.argv[1:]
if not binding_keys:
    print &gt;&gt; sys.stderr, &quot;Usage: %s [binding_key]...&quot; % (sys.argv[0],)
    sys.exit(1)

for binding_key in binding_keys:
    channel.queue_bind(exchange=ex,
                       queue=queue_name,
                       routing_key=binding_key)

print ' [*] Waiting for logs. To exit press CTRL+C'

def callback(ch, method, properties, body):
    print &quot;Routing key: %r&quot; % (method.routing_key)
    print &quot;Body %r&quot; % (body,)

channel.basic_consume(callback,
                      queue=queue_name,
                      no_ack=True)

channel.start_consuming()

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/6b18078f/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120329/6b18078f/attachment.htm</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019272.html">[rabbitmq-discuss] Must basic.reject be done on the same channel as received on?
</A></li>
	<LI>Next message: <A HREF="019288.html">[rabbitmq-discuss] Basics: Queues, Routing Keys
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19282">[ date ]</a>
              <a href="thread.html#19282">[ thread ]</a>
              <a href="subject.html#19282">[ subject ]</a>
              <a href="author.html#19282">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
