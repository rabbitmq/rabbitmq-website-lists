<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss]  basic.Get and basic.Consume on the same queue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%20basic.Get%20and%20basic.Consume%20on%20the%20same%20queue&In-Reply-To=%3CCABzX%2Bqwx8CXrs_%2BRbapZrCQys1Uo4mtLXaay9EVrs5WRy2g%3Dpw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018628.html">
   <LINK REL="Next"  HREF="018634.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss]  basic.Get and basic.Consume on the same queue</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%20basic.Get%20and%20basic.Consume%20on%20the%20same%20queue&In-Reply-To=%3CCABzX%2Bqwx8CXrs_%2BRbapZrCQys1Uo4mtLXaay9EVrs5WRy2g%3Dpw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss]  basic.Get and basic.Consume on the same queue">majek04 at gmail.com
       </A><BR>
    <I>Wed Mar  7 14:03:48 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018628.html">[rabbitmq-discuss] basic.Get and basic.Consume on the same queue
</A></li>
        <LI>Next message: <A HREF="018634.html">[rabbitmq-discuss] basic.Get and basic.Consume on the same queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18629">[ date ]</a>
              <a href="thread.html#18629">[ thread ]</a>
              <a href="subject.html#18629">[ subject ]</a>
              <a href="author.html#18629">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Mar 7, 2012 at 13:52, Greg &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">gregory.sainson at gmail.com</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I can't find any info on the web about it.
</I>&gt;<i>
</I>&gt;<i> I currently have different programs that consumes the same queue.
</I>&gt;<i> One program is registered to the queue with a basic.Consume.
</I>&gt;<i> The other one is receiving messages with basic.Get. Unfortunately, It
</I>&gt;<i> doesn't get any messages, basic.Get always returns null, like the queue is
</I>&gt;<i> empty.
</I>&gt;<i> If I change it with a basic.Consume, it works fine. I'm using the Java
</I>&gt;<i> client of RabbitMQ.
</I>&gt;<i>
</I>&gt;<i> Anyone has any idea with this happens?
</I>
If you're using Basic.Consume without setting Basic.QOS, Rabbit
sends a bulk of messages to the consumer. (in hundreds of messages).

Assuming the consumer uses Acks, the messages are then slowly
marked as Acknowledged and deleted.

But in the meantime all the messages were already sent to the
BasicConsume client - thus Basic.Get will find that there
aren't any messages ready!

The solution is to configure prefetch count using Basic.Qos
and also you must use Acknowledgments. (Basic.Qos without
acks makes no sense).

When you change second consumer to use BasicConsume,
it will hang and wait for mesages. Rabbit than sees:
okay, there are two consumes waiting on that queue.
When a new message arrives Rabbit will make a decision
where to send the message. It will try to do something
like round-robin. Thus - your second consumer will
receive some messages (every second one in a perfect
world).

Hope that helps,
&#160;Marek
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018628.html">[rabbitmq-discuss] basic.Get and basic.Consume on the same queue
</A></li>
	<LI>Next message: <A HREF="018634.html">[rabbitmq-discuss] basic.Get and basic.Consume on the same queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18629">[ date ]</a>
              <a href="thread.html#18629">[ thread ]</a>
              <a href="subject.html#18629">[ subject ]</a>
              <a href="author.html#18629">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
