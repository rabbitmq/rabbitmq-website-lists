<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] STOMP Plugin: Alternative exchange other than amq.topic?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20Plugin%3A%20Alternative%20exchange%20other%0A%20than%20amq.topic%3F&In-Reply-To=%3C20268292.993.1330969521998.JavaMail.geo-discussion-forums%40ynll40%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018573.html">
   <LINK REL="Next"  HREF="018620.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] STOMP Plugin: Alternative exchange other than amq.topic?</H1>
    <B>Cliff Redmond</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20Plugin%3A%20Alternative%20exchange%20other%0A%20than%20amq.topic%3F&In-Reply-To=%3C20268292.993.1330969521998.JavaMail.geo-discussion-forums%40ynll40%3E"
       TITLE="[rabbitmq-discuss] STOMP Plugin: Alternative exchange other than amq.topic?">cliff.redmond at gmail.com
       </A><BR>
    <I>Mon Mar  5 17:45:21 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018573.html">[rabbitmq-discuss] STOMP Plugin: Alternative exchange other	than amq.topic?
</A></li>
        <LI>Next message: <A HREF="018620.html">[rabbitmq-discuss] STOMP Plugin: Alternative exchange other	than amq.topic?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18587">[ date ]</a>
              <a href="thread.html#18587">[ thread ]</a>
              <a href="subject.html#18587">[ subject ]</a>
              <a href="author.html#18587">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Steve,

sorry for the delay in my reply: my posts were blocked.

We were attempting to replace an installation of ActiveMQ with RabbitMQ, 
with minimal (read: no) producer and consumer code changes.

Producers and consumers used Stomp, and subscribed to topics using 
destinations beginning with 'topic':

/topic/&lt;topicname&gt;

Your suggestion, to use an explicit exchange name in these destinations, 
would seem like introducing a RabbitMQ dependency.

The Stomp plugin interprets subscriptions to topic destinations quite 
sensibly as far as it goes, but choosing to route via the default topic 
exchange (amq.topic) prevented us from replicating queues between data 
centers using the Federation plugin (which doesn't seem to be able to 
federate inbuilt exchanges). We eventually got it working using Shovel, 
though.

As I suggested before, there are two possible solutions here:
- be able to specify a topic exchange in the Stomp plugin config (i.e. 
rather than have it always use amq.topic),
- be able to federate internal/predefined exchanges in the Federation 
plugin.

I'd say the former would be easier to implement - perhaps you could talk to 
your colleagues working on the Stomp plugin?

Regards and thanks,

Cliff.

On Monday, 5 March 2012 16:22:05 UTC, Steve Powell wrote:
&gt;<i>
</I>&gt;<i> Cliff,
</I>&gt;<i>
</I>&gt;<i> Did you see my previous answer:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018456.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018456.html</A>
</I>&gt;<i> ?
</I>&gt;<i>
</I>&gt;<i> Please get back to me if this isn't what you want.
</I>&gt;<i>
</I>&gt;<i> Steve Powell  (a hopeful bunny)
</I>&gt;<i> ----------some more definitions from the SPD----------
</I>&gt;<i> vermin (v.) Treating the dachshund for roundworm.
</I>&gt;<i> chinchilla (n.) Cooling device for the lower jaw.
</I>&gt;<i> socialcast (n.) Someone to whom everyone is speaking but nobody likes.
</I>&gt;<i>
</I>&gt;<i> On 24 Feb 2012, at 12:43, Cliff Redmond wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Hi Steve,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; thanks for your answer.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I was facing the exact same problem as Ken: I think your solution only
</I>&gt;<i> &gt; partially addresses the issue - requiring a subscription to a pre-
</I>&gt;<i> &gt; existing queue significantly reduces the flexibility of Stomp/
</I>&gt;<i> &gt; RabbitMQ.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; One of the most useful features of the Stomp plugin is that when a
</I>&gt;<i> &gt; Stomp consumer subscribes to a topic, it automatically creates a new
</I>&gt;<i> &gt; queue (with a lifecycle dictated by the subscription) and binds it to
</I>&gt;<i> &gt; the default topic exchange on that broker.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; e.g. invoking the following in a consumer:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; $frame = Net::Stomp::Frame-&gt;new( {
</I>&gt;<i> &gt;      command =&gt; &quot;SUBSCRIBE&quot;,
</I>&gt;<i> &gt;      headers =&gt; {
</I>&gt;<i> &gt;          destination =&gt; &quot;/topic/durable-topic-prefetch&quot;,
</I>&gt;<i> &gt;          id =&gt; $subscriberId,
</I>&gt;<i> &gt;          persistent =&gt; &quot;true&quot;,
</I>&gt;<i> &gt;          ack =&gt; &quot;client&quot;,
</I>&gt;<i> &gt;          prefetch_count =&gt; 1,
</I>&gt;<i> &gt;      },
</I>&gt;<i> &gt; });
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; $stomp-&gt;send_frame($frame);
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; will create a queue on the relevant broker:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; sh-3.2# rabbitmqctl list_queues
</I>&gt;<i> &gt; Listing queues ...
</I>&gt;<i> &gt; [...]
</I>&gt;<i> &gt; stomp.dsub.durable-topic-prefetch.?&#1819;?R?M?\0006??1&gt;?U        0
</I>&gt;<i> &gt; [...]
</I>&gt;<i> &gt; ...done.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; and bind it to the default topic exchange:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Listing bindings ...
</I>&gt;<i> &gt; [...]
</I>&gt;<i> &gt; 
</I>&gt;<i> amq.topic        exchange        stomp.dsub.durable-topic-prefetch.?&#1819;?R?M?\0006??1&gt;?
</I>&gt;<i> &gt; U        queue        durable-topic-prefetch        []
</I>&gt;<i> &gt; [...]
</I>&gt;<i> &gt; ...done.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Pre-configuring AMQ queues is considerably less flexible, and the
</I>&gt;<i> &gt; alternative, creating a queue (and binding it to an alternatively
</I>&gt;<i> &gt; named federated topic exchange) using AMQP before each Stomp
</I>&gt;<i> &gt; subscription, militates against using Stomp at all.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Would it be possible to make a change to either of the Stomp or
</I>&gt;<i> &gt; Federation plugins:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; - be able to specify a topic exchange in the Stomp plugin config (i.e.
</I>&gt;<i> &gt; rather than have it always use amq.topic),
</I>&gt;<i> &gt; - be able to federate internal/predefined exchanges in the Federation
</I>&gt;<i> &gt; plugin.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; (I used the Shovel plugin to workaround this issue).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Many thanks,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Cliff.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Feb 21, 6:25 pm, Steve Powell &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">st... at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt; Hi Ken,
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; It is possible for you to SEND to the exchange of your choice from 
</I>&gt;<i> aSTOMP
</I>&gt;<i> &gt;&gt; application, using a destination of the form: 
</I>&gt;<i> /exchange/&lt;name&gt;/&lt;pattern&gt; (<A HREF="seehttp://www.rabbitmq.com/stomp.html#d.ed">seehttp://www.rabbitmq.com/stomp.html#d.ed</A>) 
</I>&gt;<i> and there is no reason why this
</I>&gt;<i> &gt;&gt; shouldn't be a topic exchange of your own making.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; If you need to SUBSCRIBE to AMQP destinations you can use the 
</I>&gt;<i> destination
</I>&gt;<i> &gt;&gt; /amq/queue/&lt;name&gt; (but the queue must exist).
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Between them, these should allow you to useSTOMPwith federated exchanges
</I>&gt;<i> &gt;&gt; without plugin modifications.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Let us know how you get on.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Steve Powell  (a federated bunny)
</I>&gt;<i> &gt;&gt; ----------some more definitions from the SPD----------
</I>&gt;<i> &gt;&gt; vermin (v.) Treating the dachshund for roundworm.
</I>&gt;<i> &gt;&gt; chinchilla (n.) Cooling device for the lower jaw.
</I>&gt;<i> &gt;&gt; socialcast (n.) Someone to whom everyone is speaking but nobody likes.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; On 20 Feb 2012, at 16:19, Ken Simon wrote:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; Greetings,
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; I'm trying to getfederationworking (via the rabbitmq_federation
</I>&gt;<i> &gt;&gt;&gt; plugin) in our environment ofSTOMPhosts, and to do so I have to
</I>&gt;<i> &gt;&gt;&gt; enablefederationin theSTOMPplugin's exchange: amq.topic.  This
</I>&gt;<i> &gt;&gt;&gt; unfortunately doesn't seem to work because amq.* exchanges are
</I>&gt;<i> &gt;&gt;&gt; reserved and cannot be re-declared.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; My solution at this point has been to edit the source of theSTOMP
</I>&gt;<i> &gt;&gt;&gt; plugin and point it at an exchange called &quot;stomp_topic&quot; (which I made
</I>&gt;<i> &gt;&gt;&gt; up, but could be anything) instead of the default amq.topic.  Then I
</I>&gt;<i> &gt;&gt;&gt; just configure thefederationplugin to work with that exchange and it
</I>&gt;<i> &gt;&gt;&gt; works fine.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; My question is, is there a better way of doing this?  I hate
</I>&gt;<i> &gt;&gt;&gt; maintaining my own downstream changes to plugins if I don't have to.
</I>&gt;<i> &gt;&gt;&gt; The docs say that theSTOMPplugin routes all messages through
</I>&gt;<i> &gt;&gt;&gt; amq.topic, so it appears that's not configurable.  But wouldn't it
</I>&gt;<i> &gt;&gt;&gt; make sense to allow use of an exchange that's not reserved?  Or am I
</I>&gt;<i> &gt;&gt;&gt; missing something, and this is actually way easier?  I'm having
</I>&gt;<i> &gt;&gt;&gt; trouble finding any documented cases of people using bothSTOMPand
</I>&gt;<i> &gt;&gt;&gt; federation.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; Thanks,
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; --
</I>&gt;<i> &gt;&gt;&gt; Ken
</I>&gt;<i> &gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt;&gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://
</I>&gt;<i> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/19f1c44b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120305/19f1c44b/attachment.htm</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018573.html">[rabbitmq-discuss] STOMP Plugin: Alternative exchange other	than amq.topic?
</A></li>
	<LI>Next message: <A HREF="018620.html">[rabbitmq-discuss] STOMP Plugin: Alternative exchange other	than amq.topic?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18587">[ date ]</a>
              <a href="thread.html#18587">[ thread ]</a>
              <a href="subject.html#18587">[ subject ]</a>
              <a href="author.html#18587">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
