<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] atomic transactions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20atomic%20transactions&In-Reply-To=%3Cloom.20120323T151810-129%40post.gmane.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019083.html">
   <LINK REL="Next"  HREF="019097.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] atomic transactions</H1>
    <B>gaillard</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20atomic%20transactions&In-Reply-To=%3Cloom.20120323T151810-129%40post.gmane.org%3E"
       TITLE="[rabbitmq-discuss] atomic transactions">jonathan.gaillard at dominionenterprises.com
       </A><BR>
    <I>Fri Mar 23 14:25:37 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019083.html">[rabbitmq-discuss] atomic transactions
</A></li>
        <LI>Next message: <A HREF="019097.html">[rabbitmq-discuss] atomic transactions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19093">[ date ]</a>
              <a href="thread.html#19093">[ thread ]</a>
              <a href="subject.html#19093">[ subject ]</a>
              <a href="author.html#19093">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Emile Joubert &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">emile at ...</A>&gt; writes:

&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> On 22/03/12 03:39, gaillard wrote:
</I>&gt;<i> &gt; I have need to use transactions in the following way:
</I>&gt;<i> &gt; -get a message (m1) from queue A
</I>&gt;<i> &gt; -transforms the message and create new message (m2)
</I>&gt;<i> &gt; -publish m2 to queue B
</I>&gt;<i> &gt; -ack m1
</I>&gt;<i> &gt; -commit the transaction (includes ack and publish)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Which i believe in all failure scenarios should result in possibly two
</I>&gt;<i> &gt; things:
</I>&gt;<i> &gt; m1 on queue A, nothing on queue B
</I>&gt;<i> &gt; m2 on queue B, nothing on queue A
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Is this what will happen in rabbit 2.7 or 2.8?
</I>&gt;<i> 
</I>&gt;<i> Mostly yes, but bear in mind that transactions are not atomic in
</I>&gt;<i> RabbitMQ. So if the broker crashes or an error occurs during commit then
</I>&gt;<i> your invariant might not hold. If you are dealing with very high value
</I>&gt;<i> messages then you should add additional logging and correlate the input
</I>&gt;<i> and output.
</I>&gt;<i> 
</I>&gt;<i> This page has more information about transaction semantics:
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/semantics.html">http://www.rabbitmq.com/semantics.html</A>
</I>&gt;<i> 
</I>&gt;<i> -Emile
</I>&gt;<i> 
</I>&gt;<i> 
</I>
Well i have done some testing with different failure cases now..
As far as I can tell if the broker stays up, and clients are the ones that fail, 
the transactions are adhered to atomically. But if I kill the broker its not 
hard to get messages where they shouldnt be.

I dont have need for persistent messages so I think i am safe with relying on 
the atomicity since on broker death the messages are gone anyways. Is this not 
the case?

Any idea when fully atomic transactions will be put in rabbit? It is a common 
feature on jms and qpid etc..

Also, would you mind elaborating on how you would correlate in the publishing 
back to the same queue where you dont want multiple copies on that queue? The 
best I can come up with is just erroring if you receive the redelivered. But 
redeliveries are ok with the transaction route since you will never get the 
multiple copies. I see no substitute for transactions.

Thanks for the help !

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019083.html">[rabbitmq-discuss] atomic transactions
</A></li>
	<LI>Next message: <A HREF="019097.html">[rabbitmq-discuss] atomic transactions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19093">[ date ]</a>
              <a href="thread.html#19093">[ thread ]</a>
              <a href="subject.html#19093">[ subject ]</a>
              <a href="author.html#19093">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
