<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Testing Shovel on a WAN
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Testing%20Shovel%20on%20a%20WAN&In-Reply-To=%3C4F7334D7.6030709%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019215.html">
   <LINK REL="Next"  HREF="019239.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Testing Shovel on a WAN</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Testing%20Shovel%20on%20a%20WAN&In-Reply-To=%3C4F7334D7.6030709%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Testing Shovel on a WAN">simon at rabbitmq.com
       </A><BR>
    <I>Wed Mar 28 16:57:11 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019215.html">[rabbitmq-discuss] Testing Shovel on a WAN
</A></li>
        <LI>Next message: <A HREF="019239.html">[rabbitmq-discuss] Testing Shovel on a WAN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19220">[ date ]</a>
              <a href="thread.html#19220">[ thread ]</a>
              <a href="subject.html#19220">[ subject ]</a>
              <a href="author.html#19220">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/03/12 14:47, MELIQUE Denis (MORPHO) wrote:
&gt;<i> When I slow the WAN to 1 Mbit/s, I see messages accumulating in the
</I>&gt;<i> shovel queue, which is what as expected.
</I>&gt;<i>
</I>&gt;<i> Then once my throughput go to zero, messages are slowly transferred to
</I>&gt;<i> the distant cluster, and that&#8217;s OK as well.
</I>&gt;<i>
</I>&gt;<i> The problem is that messages are not processed in the same order on the
</I>&gt;<i> distant cluster than on the local.
</I>&gt;<i>
</I>&gt;<i> My feeling is that with 1 Mbit/s some messages fail to be transferred
</I>&gt;<i> correctly, and are re-sent later.
</I>&gt;<i>
</I>&gt;<i> ( I have the same problem when I simulate a very high level of packet
</I>&gt;<i> loss (30%), with a 10Mbit/s speed)
</I>&gt;<i>
</I>&gt;<i> Is there such a logic in Shovel ?
</I>
That seems unlikely. Packet loss should lead to redelivery at the TCP 
level, which the shovel should be unaware of.

Messages should only get redelivered if the consumer rejects them or the 
TCP connection is interrupted completely. Shovel won't reject messages, 
but maybe the connection is being interrupted and re-established? You 
should be able to see this in the logs. You would also see a 
&quot;redelivered&quot; message rate in mgmt.

&gt;<i> Is there a way to configured Shovel to guaranty the sequence of messages ?
</I>
This should already be happening.

&gt;<i> Second:
</I>&gt;<i>
</I>&gt;<i> ---------
</I>&gt;<i>
</I>&gt;<i> When a simulate a WAN outage lasting 2 hours, messages staying in the
</I>&gt;<i> shovel queue have a status,
</I>&gt;<i>
</I>&gt;<i> first set to &#8220;unacknowledged&#8221;.
</I>&gt;<i>
</I>&gt;<i> Then, after about 900 sec, they all have their status changed to &#8220;ready&#8221;.
</I>&gt;<i>
</I>&gt;<i> When the network recovers, all the pending messages change back to
</I>&gt;<i> &#8220;unacknowledged&#8221;, before being sent
</I>&gt;<i>
</I>&gt;<i> to the distant cluster.
</I>&gt;<i>
</I>&gt;<i> It does not seems to be a problem for us, just I&#8217;d like to understand
</I>&gt;<i> this behavior, and if it could impact rabbit performances.
</I>
unacknowledged -&gt; the message has been consumed by the remote end, but 
not acknowledged.

After 900 seconds presumably the connection is determined to be dead by 
RabbitMQ and then the messages go back into the queue (&quot;ready&quot;).

Then when the network recovers, they are sent again and become 
&quot;unacknowledged&quot; again, until the acks come in.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019215.html">[rabbitmq-discuss] Testing Shovel on a WAN
</A></li>
	<LI>Next message: <A HREF="019239.html">[rabbitmq-discuss] Testing Shovel on a WAN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19220">[ date ]</a>
              <a href="thread.html#19220">[ thread ]</a>
              <a href="subject.html#19220">[ subject ]</a>
              <a href="author.html#19220">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
