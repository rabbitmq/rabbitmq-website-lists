<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] No error reported when tx_select/basic_publish/tx_commit is given an undefined queue name?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20No%20error%20reported%20when%0A%20tx_select/basic_publish/tx_commit%20is%20given%20an%20undefined%20queue%20name%3F&In-Reply-To=%3CCABzX%2BqzXQj8mUmor_xXYsGMAcdE5cCWGisVrXjH4g9EPwTZjng%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019270.html">
   <LINK REL="Next"  HREF="019242.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] No error reported when tx_select/basic_publish/tx_commit is given an undefined queue name?</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20No%20error%20reported%20when%0A%20tx_select/basic_publish/tx_commit%20is%20given%20an%20undefined%20queue%20name%3F&In-Reply-To=%3CCABzX%2BqzXQj8mUmor_xXYsGMAcdE5cCWGisVrXjH4g9EPwTZjng%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] No error reported when tx_select/basic_publish/tx_commit is given an undefined queue name?">majek04 at gmail.com
       </A><BR>
    <I>Fri Mar 30 11:33:00 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019270.html">[rabbitmq-discuss] No error reported when tx_select/basic_publish/tx_commit is given an undefined queue name?
</A></li>
        <LI>Next message: <A HREF="019242.html">[rabbitmq-discuss] Mirrored queue failover
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19286">[ date ]</a>
              <a href="thread.html#19286">[ thread ]</a>
              <a href="subject.html#19286">[ subject ]</a>
              <a href="author.html#19286">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Mar 29, 2012 at 19:13, Matt Pietrek &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mpietrek at skytap.com</A>&gt; wrote:
&gt;<i> Thanks Marek,
</I>&gt;<i>
</I>&gt;<i> Every day's a school day. I didn't know about the mandatory flag.
</I>&gt;<i>
</I>&gt;<i> HOWEVER... Having added to the code below, I still don't get and indication
</I>&gt;<i> of error. Stepping into the tx_commit code, I see what looks like a
</I>&gt;<i> Tx.CommitOK message back from the server. I've double-verified that the
</I>&gt;<i> queue I'm sending to doesn't exist.
</I>
Yes, messages sent with `mandatory` &#160;flag don't result in an error.

Instead the message is returned by the broker to your client.
This is done using Basic.Return AMQP method, you should be able
to catch this from pika.

My guess is that `channel.add_on_return_callback` allows
you to pass a callback for this case.
&#160; &#160;<A HREF="http://pika.github.com/channel.html#id1">http://pika.github.com/channel.html#id1</A>

Marek

&gt;<i> On Thu, Mar 29, 2012 at 3:52 AM, Marek Majkowski &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">majek04 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Mar 29, 2012 at 01:16, Matt Pietrek &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mpietrek at skytap.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; I have a Pika code sequence that looks like this:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; channel = self._channel
</I>&gt;&gt;<i> &gt; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; channel.tx_select()
</I>&gt;&gt;<i> &gt; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; channel.basic_publish(exchange='',
</I>&gt;&gt;<i> &gt; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; routing_key=queue_name,
</I>&gt;&gt;<i> &gt; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; body=json_string,
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; properties=pika.BasicProperties(delivery_mode=2))
</I>&gt;&gt;<i> &gt; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; channel.tx_commit()
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; During some robustness testing, I found that if I passed an invalid
</I>&gt;&gt;<i> &gt; queue
</I>&gt;&gt;<i> &gt; name to basic_get, I get an AMQPChannelError as expected. However, when
</I>&gt;&gt;<i> &gt; using the above code to write a message to an invalid queue name, no
</I>&gt;&gt;<i> &gt; exception is seen.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Is this normal or am I missing&#160;something? In our scenario, we have to
</I>&gt;&gt;<i> &gt; absolutely, positively know that the message was received by the broker.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, this is normal.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> AMQP does not allow you to send message to a &quot;queue&quot;, instead, you
</I>&gt;&gt;<i> send a message to an exchange with a routing key.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This routing key is a queue name in this case but it can be just anything.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Messages sent with a routing key that is not matched by appropriate
</I>&gt;&gt;<i> binding will be lost. This is the correct behaviour.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you need to ensure that message is delivered use 'mandatory' flag
</I>&gt;&gt;<i> on basic.publish:
</I>&gt;&gt;<i> <A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish">http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers,
</I>&gt;&gt;<i> &#160;Marek
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019270.html">[rabbitmq-discuss] No error reported when tx_select/basic_publish/tx_commit is given an undefined queue name?
</A></li>
	<LI>Next message: <A HREF="019242.html">[rabbitmq-discuss] Mirrored queue failover
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19286">[ date ]</a>
              <a href="thread.html#19286">[ thread ]</a>
              <a href="subject.html#19286">[ subject ]</a>
              <a href="author.html#19286">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
