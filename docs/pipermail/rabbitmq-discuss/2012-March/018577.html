<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on slave nodes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%202.7.1%20mirrored%20queues%20leak%20a%20lot%20of%20memory%0A%20on%20slave%20nodes&In-Reply-To=%3C4F54EDC5.5010802%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018580.html">
   <LINK REL="Next"  HREF="018689.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on slave nodes</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%202.7.1%20mirrored%20queues%20leak%20a%20lot%20of%20memory%0A%20on%20slave%20nodes&In-Reply-To=%3C4F54EDC5.5010802%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory on slave nodes">simon at rabbitmq.com
       </A><BR>
    <I>Mon Mar  5 16:45:57 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018580.html">[rabbitmq-discuss] RabbitMQ in Action, Final call for errata
</A></li>
        <LI>Next message: <A HREF="018689.html">[rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory	on slave nodes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18577">[ date ]</a>
              <a href="thread.html#18577">[ thread ]</a>
              <a href="subject.html#18577">[ subject ]</a>
              <a href="author.html#18577">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Max, thanks for writing. Are you the &quot;local Erlang expert&quot; Chip 
referred to?

On 24/02/12 15:19, Max Kalika wrote:
&gt;<i> 3) There was one process with over 2 million pages.  It was constantly
</I>&gt;<i> running lists:zipwith/3.  Info on it showed lots and lots of messages
</I>&gt;<i> in the mailbox that just wasn't decreasing.
</I>
I don't suppose you have any record of what these messages were? Or any 
logs from around this time?

&gt;<i> I mentioned earlier that the system is *mostly* recovered.  The
</I>&gt;<i> remaining problem is disk utilization.  I suspect that since our
</I>&gt;<i> messages are marked durable, disk cleanup didn't occur.  I'm not sure
</I>&gt;<i> how to sync this up with runtime reality without restarting.
</I>
So the only code in the rabbit codebase which invokes lists:zipwith/3 is 
the file_handle_cache. Hmm. Unfortunately it uses it in a rather generic 
location so this is still not exactly clear.

This would help explain why disk cleanup didn't occur, since you killed 
something that was in the middle of doing some file handling.

Hmm.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018580.html">[rabbitmq-discuss] RabbitMQ in Action, Final call for errata
</A></li>
	<LI>Next message: <A HREF="018689.html">[rabbitmq-discuss] 2.7.1 mirrored queues leak a lot of memory	on slave nodes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18577">[ date ]</a>
              <a href="thread.html#18577">[ thread ]</a>
              <a href="subject.html#18577">[ subject ]</a>
              <a href="author.html#18577">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
