<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] What does Rabbit do with messages that have	been	delivered and ack'd
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20What%20does%20Rabbit%20do%20with%20messages%20that%20have%0A%09been%09delivered%20and%20ack%27d&In-Reply-To=%3C220b1662-b9cc-4821-b81f-ec327c85db31%40csb-2-eng-dhcp113.eng.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018613.html">
   <LINK REL="Next"  HREF="018616.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] What does Rabbit do with messages that have	been	delivered and ack'd</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20What%20does%20Rabbit%20do%20with%20messages%20that%20have%0A%09been%09delivered%20and%20ack%27d&In-Reply-To=%3C220b1662-b9cc-4821-b81f-ec327c85db31%40csb-2-eng-dhcp113.eng.vmware.com%3E"
       TITLE="[rabbitmq-discuss] What does Rabbit do with messages that have	been	delivered and ack'd">jerryk at vmware.com
       </A><BR>
    <I>Tue Mar  6 16:44:42 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018613.html">[rabbitmq-discuss] What does Rabbit do with messages that have been	delivered and ack'd
</A></li>
        <LI>Next message: <A HREF="018616.html">[rabbitmq-discuss] Lost message in 50k size range
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18615">[ date ]</a>
              <a href="thread.html#18615">[ thread ]</a>
              <a href="subject.html#18615">[ subject ]</a>
              <a href="author.html#18615">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Mark:

The maintaining of messages is done at the queue end of the messaging pipeline,
not the exchange end.  Thus, if the message properties and bindings have
resulted in your message passing through the topic exchange into multiple
queues, then each of those queues will try to maintain the integrity of that
message, up to whatever guarantees you've asked for (e.g. persistence) until
it's been delivered to, and ACKed by (or delivered to a consumer who is in noAck
mode) somebody.

On any single given queue, the first consumer to consume and ACK a message 
from that queue tells Rabbit that it's free to forget about the message.  That 
same consumer, or another consumer on the same queue would only see the same
message again if the consumer either crashed before ACK-ing, or rejected the 
message, both of which would result in a re-queueing.

This is a good thing to ask about and be mindful of; a happy Rabbit is an empty
Rabbit, and application mis-designs (or failures of components at runtime) can
result in the broker hanging on to many messages that are either undelivered or
delivered but not properly ACKed, which over the long run leads to more work
for the broker, more consumption of RAM, eventually paging of messages to disk,
etc.  In production you'd always want to monitor to make sure there's not some
queue growing surprisingly long, since that's a sign that, at the very least
something has changed in your assumptions about the world, or that perhaps
you have a problem like slow or crashed consumers, a sudden upswing in producer
activity, etc.

Best regards,
Jerry

----- Original Message -----
From: &quot;Mark Petrovic&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mspetrovic at gmail.com</A>&gt;
To: &quot;Rabbit-Mq Discuss-Mailing List&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
Sent: Tuesday, March 6, 2012 8:34:45 AM
Subject: [rabbitmq-discuss] What does Rabbit do with messages that have been	delivered and ack'd

I have an application that uses a topic exchange.  If I have N
consumers and each of those ack's the message when it is delivered to
them, Rabbit does not keep a  copy of that message beyond the last
consumer ack'ing it does it?

I ask because I want to know if there are exchange or queue
configurations that I may be inadvertently foisting on Rabbit brokers
that induce them to hold onto messages in its backing db that I
actually no longer care about.

Thanks much.

-- 
Mark
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018613.html">[rabbitmq-discuss] What does Rabbit do with messages that have been	delivered and ack'd
</A></li>
	<LI>Next message: <A HREF="018616.html">[rabbitmq-discuss] Lost message in 50k size range
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18615">[ date ]</a>
              <a href="thread.html#18615">[ thread ]</a>
              <a href="subject.html#18615">[ subject ]</a>
              <a href="author.html#18615">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
