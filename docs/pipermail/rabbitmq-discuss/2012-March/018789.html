<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmqctl%20stall/hang%20when%20leaving%20a%20cluster&In-Reply-To=%3CCACLE7iz_KL2UYjWxXZbH6vsJqg6Ex9fO42JaLw6%2B0jgRoB8Chw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018848.html">
   <LINK REL="Next"  HREF="018847.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmqctl%20stall/hang%20when%20leaving%20a%20cluster&In-Reply-To=%3CCACLE7iz_KL2UYjWxXZbH6vsJqg6Ex9fO42JaLw6%2B0jgRoB8Chw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster">mpietrek at skytap.com
       </A><BR>
    <I>Tue Mar 13 22:00:30 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018848.html">[rabbitmq-discuss] Inconsistent queue synchronization behavior
</A></li>
        <LI>Next message: <A HREF="018847.html">[rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18789">[ date ]</a>
              <a href="thread.html#18789">[ thread ]</a>
              <a href="subject.html#18789">[ subject ]</a>
              <a href="author.html#18789">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Some other work came up so I needed to drop this thread for a few weeks.
However, coming back to it, I can easily reproduce this issue within one or
two tries.

In a nutshell, in a clustered environment, simply stop one node, wait a few
seconds, then restart it. The last output seen is:

starting database
                               ...

I've let it wait for much longer than 30 seconds and it has never come back.

Any chance this may have been stamped out in RabbitMQ 2.8?



On Fri, Feb 24, 2012 at 1:43 PM, Matt Pietrek &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mpietrek at skytap.com</A>&gt; wrote:

&gt;<i> | So how long are you waiting when determining it's hanging? Less than 30
</I>&gt;<i> seconds?
</I>&gt;<i>
</I>&gt;<i> Just to be double sure, I let it sit for an hour yesterday. I would have
</I>&gt;<i> expected a timeout, but it never came.
</I>&gt;<i>
</I>&gt;<i> It's a pretty easy scenario to script and try out. I'd send you my code,
</I>&gt;<i> but it relies on other internal commands.
</I>&gt;<i>
</I>&gt;<i> There may also be a timing issue. If I put a 10 second delay after
</I>&gt;<i> restarting one broker, and before stopping the next, it seems to help.
</I>&gt;<i>
</I>&gt;<i> That is:
</I>&gt;<i>
</I>&gt;<i> for x in broker_list:
</I>&gt;<i>     stop x
</I>&gt;<i>     start x
</I>&gt;<i>     sleep(10)
</I>&gt;<i>
</I>&gt;<i> Matt
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Fri, Feb 24, 2012 at 4:22 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On 23/02/12 21:00, Matt Pietrek wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The nohup.out on the failing node ends with:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &lt;snip&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  starting database                                                     ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So how long are you waiting when determining it's hanging? Less than 30
</I>&gt;&gt;<i> seconds?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Because that looks like Rabbit is waiting for another cluster node (if it
</I>&gt;&gt;<i> was not the last to shut down, but is the first to start up, it will wait
</I>&gt;&gt;<i> for the one that was the last to shut down. But it will only wait for 30
</I>&gt;&gt;<i> seconds before spitting out an error. I'm not sure how else you could get
</I>&gt;&gt;<i> it to stop there *without* any further output though.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers, Simon
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Simon MacMullen
</I>&gt;&gt;<i> RabbitMQ, VMware
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/6a23bf37/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120313/6a23bf37/attachment.htm</A>&gt;
</PRE>
































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018848.html">[rabbitmq-discuss] Inconsistent queue synchronization behavior
</A></li>
	<LI>Next message: <A HREF="018847.html">[rabbitmq-discuss] rabbitmqctl stall/hang when leaving a cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18789">[ date ]</a>
              <a href="thread.html#18789">[ thread ]</a>
              <a href="subject.html#18789">[ subject ]</a>
              <a href="author.html#18789">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
