<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq - retrieving messages concurrently
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20-%20retrieving%20messages%20concurrently&In-Reply-To=%3CCF5E0AF0-A5B8-464F-A307-F8D1733CE2AE%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019291.html">
   <LINK REL="Next"  HREF="019299.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq - retrieving messages concurrently</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20-%20retrieving%20messages%20concurrently&In-Reply-To=%3CCF5E0AF0-A5B8-464F-A307-F8D1733CE2AE%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq - retrieving messages concurrently">steve at rabbitmq.com
       </A><BR>
    <I>Fri Mar 30 14:09:32 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019291.html">[rabbitmq-discuss] Rabbitmq - retrieving messages concurrently
</A></li>
        <LI>Next message: <A HREF="019299.html">[rabbitmq-discuss] pub/sub and disconnections handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19294">[ date ]</a>
              <a href="thread.html#19294">[ thread ]</a>
              <a href="subject.html#19294">[ subject ]</a>
              <a href="author.html#19294">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

The critical point to realise is that to get multiple consumers running
concurrently in the same Java Client, you need to use multiple channels.

Your code so far has 20 threads (potentially) able to process concurrent
consumers; if you want 20 consumers to be concurrently receiving
messages from the same queue then create 20 channels on that connection
and put one consumer on each channel.

The consumers need not be instantiated each time (unless they have
private state), and the consumer calls (handleDelivery() for example)
get passed the consumerTag used when attaching the consumer (with
basicConsume()) as a parameter, so the code can, in principle service
many of the consumer callbacks. Be aware that if you set it up sharing
the Consumer objects in this way, the code you write must be
thread-safe.

As for assigning a number to each message this is going to be a little
tricky. However, using a shared AtomicInteger will permit you to
generate an increment a number in the handleDelivery callbacks, without
the possibility of accidentally using the same number. What you do with
that number is then up to you.

You have correctly created an ExecutorService to increase the number of
threads from the default (5). In this case you should ensure that the
ExecutorSercvice is shutdown after the connection is closed, or else you
might find that there are daemon threads left in the JVM that might
prevent an orderly shutdown.

I hope this helps you. The details are, of course, very application
specific.

Steve Powell
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 30 Mar 2012, at 12:51, Santhoshsd wrote:

&gt;<i> 
</I>&gt;<i> I want to retrieve 5000 messages/second from a single RabbitMQ server
</I>&gt;<i> and for each message assign a number and then push it into redis.
</I>&gt;<i> 
</I>&gt;<i> I want to use a single queue multiple consumer approach in the
</I>&gt;<i> rabbitmq client. Please let me know the way the proceed after this
</I>&gt;<i> point in Java.
</I>&gt;<i> 
</I>&gt;<i> ConnectionFactory factory = new ConnectionFactory();
</I>&gt;<i>        factory.setUsername(Constants.USERNAME);
</I>&gt;<i>        factory.setPassword(Constants.PASSWORD);
</I>&gt;<i>        factory.setVirtualHost(Constants.VIRTUALHOST);
</I>&gt;<i>        factory.setHost(Constants.HOSTNAME);
</I>&gt;<i>        factory.setPort(Constants.PORTNUMBER);
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>        ExecutorService es = Executors.newFixedThreadPool(20);
</I>&gt;<i>        Connection conn = factory.newConnection(es);
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019291.html">[rabbitmq-discuss] Rabbitmq - retrieving messages concurrently
</A></li>
	<LI>Next message: <A HREF="019299.html">[rabbitmq-discuss] pub/sub and disconnections handling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19294">[ date ]</a>
              <a href="thread.html#19294">[ thread ]</a>
              <a href="subject.html#19294">[ subject ]</a>
              <a href="author.html#19294">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
