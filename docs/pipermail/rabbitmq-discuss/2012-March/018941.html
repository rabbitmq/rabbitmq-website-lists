<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Federation with Clusters and Load Balancers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20with%20Clusters%20and%20Load%20Balancers&In-Reply-To=%3CCAJreXKAFU-qRwncT%2Bz2tMmh_pwxf4QT6Z%3DB%2BbihoPQZ5FzJWsw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018874.html">
   <LINK REL="Next"  HREF="018943.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Federation with Clusters and Load Balancers</H1>
    <B>James Carr</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20with%20Clusters%20and%20Load%20Balancers&In-Reply-To=%3CCAJreXKAFU-qRwncT%2Bz2tMmh_pwxf4QT6Z%3DB%2BbihoPQZ5FzJWsw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Federation with Clusters and Load Balancers">james.r.carr at gmail.com
       </A><BR>
    <I>Mon Mar 19 14:43:55 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018874.html">[rabbitmq-discuss] Federation with Clusters and Load Balancers
</A></li>
        <LI>Next message: <A HREF="018943.html">[rabbitmq-discuss] Federation with Clusters and Load Balancers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18941">[ date ]</a>
              <a href="thread.html#18941">[ thread ]</a>
              <a href="subject.html#18941">[ subject ]</a>
              <a href="author.html#18941">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

So one problem I had while testing out federation across clusters with
is the upstream node eventually gets queues created for each
downstream node in the downstream cluster. For example from randomly
restarting downstream brokers I wind up with the following queues on
the upstream box:

federation: usage -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at dc2rabbitmq3</A>
federation: usage -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at dc2rabbitmq4</A>
federation: usage -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at dc2rabbitmq5</A>
federation: usage -&gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at dc2rabbitmq6</A>

This would seem to be okay but unfortunately when the downstream
cluster reconnects to the upstream, only one of the nodes (say 6 will
connect and empty its queue. 3, 4, and 5 will just sit there with
messages in them and will only get empty if one of those nodes happen
to reconnect when node 6 disconnects.

Is there a good solution to this? it seems like it might work if there
was someway for each of the 4 nodes to just use the same queue on the
upstream broker since they are logically part of the same group.

Thanks,
James


On Thu, Mar 15, 2012 at 5:59 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:
&gt;<i> On 14/03/12 20:34, James Carr wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've been wondering what the &quot;right&quot; setup is to federate between
</I>&gt;&gt;<i> clusters. Do I just setup each node in the cluster to federate with
</I>&gt;&gt;<i> the upstream through the load balancer? My fear here is I'll end up
</I>&gt;&gt;<i> with with all the nodes on one cluster connected to a single node
</I>&gt;&gt;<i> (through the load balancer) and hence 3 sepeare queues causing
</I>&gt;&gt;<i> messages to be duplicated three times! :)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You need to make sure that all nodes in the cluster have the federation
</I>&gt;<i> plugin enabled, and have the same configuration. The federation plugin will
</I>&gt;<i> then make sure that only one node establishes a link to the upstream (which
</I>&gt;<i> will fail over to another node if that node goes down).
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, VMware
</I></PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018874.html">[rabbitmq-discuss] Federation with Clusters and Load Balancers
</A></li>
	<LI>Next message: <A HREF="018943.html">[rabbitmq-discuss] Federation with Clusters and Load Balancers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18941">[ date ]</a>
              <a href="thread.html#18941">[ thread ]</a>
              <a href="subject.html#18941">[ subject ]</a>
              <a href="author.html#18941">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
