<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Reconnect to RabbitMQ broker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Reconnect%20to%20RabbitMQ%20broker&In-Reply-To=%3C26602465.2.1331779574134.JavaMail.geo-discussion-forums%40pbgr4%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018855.html">
   <LINK REL="Next"  HREF="018868.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Reconnect to RabbitMQ broker</H1>
    <B>Matthew Ward</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Reconnect%20to%20RabbitMQ%20broker&In-Reply-To=%3C26602465.2.1331779574134.JavaMail.geo-discussion-forums%40pbgr4%3E"
       TITLE="[rabbitmq-discuss] Reconnect to RabbitMQ broker">matt.c.ward at gmail.com
       </A><BR>
    <I>Thu Mar 15 02:46:14 GMT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="018855.html">[rabbitmq-discuss] Pika 0.9.5 KeyError: Tx.SelectOk
</A></li>
        <LI>Next message: <A HREF="018868.html">[rabbitmq-discuss] Reconnect to RabbitMQ broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18867">[ date ]</a>
              <a href="thread.html#18867">[ thread ]</a>
              <a href="subject.html#18867">[ subject ]</a>
              <a href="author.html#18867">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am running some tests for an async process that consumes messages from 
rabbitmq. We are trying to figure out how to gracefully handle rabbitmq 
going away and coming back. The goal is to have the async process reconnect 
and resume operations. To simulate the situation I start my consumer, then 
I turn rabbitmq off, wait then turn it back on.

As expected, Connection Refused exceptions are thrown (and caught) while 
rabbitmq is off. As soon as I bring the server back online, it throws 
ShutDownSignalExceptions:

com.rabbitmq.client.ShutdownSignalException: connection error; reason: 
{#method&lt;connection.close&gt;(reply-code=320, reply-text=CONNECTION_FORCED - 
broker forced connection closure with reason 'shutdown', class-id=0, 
method-id=0), null, &quot;[<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">B at 275e538e</A>&quot;}
at com.rabbitmq.client.QueueingConsumer.handle(QueueingConsumer.java:198)
at com.rabbitmq.client.QueueingConsumer.nextDelivery(
QueueingConsumer.java:214)

How do I gracefully handle the shutdown so that I can get back to 
consuming? I attempted shutting the channel / connection and creating a new 
connection from the factory but the shutdown signal exception is still 
thrown after 'reconnect'. What's going on under the hood that keeps me from 
successfully consuming again? Is there some sort of message I need to tell 
RabbitMQ &quot;yes I know I shut you down, but its you're back up so 
stop crying...&quot;

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/b67bc3a3/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120314/b67bc3a3/attachment.htm</A>&gt;
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018855.html">[rabbitmq-discuss] Pika 0.9.5 KeyError: Tx.SelectOk
</A></li>
	<LI>Next message: <A HREF="018868.html">[rabbitmq-discuss] Reconnect to RabbitMQ broker
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18867">[ date ]</a>
              <a href="thread.html#18867">[ thread ]</a>
              <a href="subject.html#18867">[ subject ]</a>
              <a href="author.html#18867">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
