<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] New and Fundamental Confusion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20and%20Fundamental%20Confusion&In-Reply-To=%3CAF4AD4ADFB23054CB4C75F50FF8C40B73B41695BA4%40MAILCCR.us.syncsort.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019273.html">
   <LINK REL="Next"  HREF="019275.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] New and Fundamental Confusion</H1>
    <B>Bell, Paul M.</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20and%20Fundamental%20Confusion&In-Reply-To=%3CAF4AD4ADFB23054CB4C75F50FF8C40B73B41695BA4%40MAILCCR.us.syncsort.com%3E"
       TITLE="[rabbitmq-discuss] New and Fundamental Confusion">pbell at syncsort.com
       </A><BR>
    <I>Thu Mar 29 23:45:08 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019273.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
        <LI>Next message: <A HREF="019275.html">[rabbitmq-discuss] New and Fundamental Confusion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19274">[ date ]</a>
              <a href="thread.html#19274">[ thread ]</a>
              <a href="subject.html#19274">[ subject ]</a>
              <a href="author.html#19274">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

As things are beginning to crystallize in our imminent use of Rabbit, I find myself going over various concepts, just trying to make sure that I understand what we are doing and how we are doing it.

I today stumbled upon a painful confusion which I am sure can be easily dispelled.

I was pondering what it means that a producer writes to an exchange when I realized that I didn't fully understand how this can even work without at least *some* hint as to what queue these messages are destined for. If such a hint, e.g., a queue name, is lacking when the messages are sent to the exchange, then how does it help a consumer to declare the queue name? That is, doesn't the broker need to know that the bunch of messages it is holding should be routed to one or more consumers because they've declared the *same* queue name as the producer?

Using a fanout exchange, my producer code looks like this. Note that the RabbitAdmin object is told via &quot;declare&quot; of both the exchange and the queue. Isn't this just such a &quot;hint?&quot;

                 RabbitAdmin admin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
                 Exchange ex = new FanoutExchange(exchName, true, false);
                 admin.declareExchange(ex);
                 admin.declareQueue(new Queue(this.queueName));

But in the case of a topic exchange, my producer does this:

                rabbitTemplate = new RabbitTemplate(connectionFactory);
                rabbitAdmin = new RabbitAdmin(rabbitTemplate.getConnectionFactory());
                Queue queue = new Queue(&quot;pbJobMgmtRqst&quot;, false, false, false);
                rabbitAdmin.declareQueue(queue);
             rabbitTemplate.send(exchangeName, &quot;mgmt.clientID.&quot; + routingKeySuffix, msg);

Is the declareQueue here even necessary? The .send() call specifies the exchange, the routing key, and the message. Or, could it be that, for a topic exchange, the broker needs only to pattern match the routing and binding keys, i.e., the producer need not provide any hint of the queue the message is destined for? But, for a fanout exchange where routing and binding is irrelevant, such a hint is needed?

Here's how my lack of understanding first hit me: if two consumers declare the same queue name, then the broker sees them as competing for messages, resulting in an &quot;even&quot; distribution of messages across consumers. But if they declare different queue names, then they are no longer competing, i.e., each will get all messages. I think I understand how this can work when routing and binding matter. But in the fanout exchange case, if one consumer declared &quot;queue1&quot; and the other declared &quot;queue2&quot;, then only one of them is going to get messages, right? I mean the case where producer has declared &quot;queue1&quot;...

I am a bit embarrassed that so fundamental a question has escaped me until now. And I am grateful for your help.

Thanks.

-Paul




ATTENTION: -----

The information contained in this message (including any files transmitted with this message) may contain proprietary, trade secret or other  confidential and/or legally privileged information. Any pricing information contained in this message or in any files transmitted with this message is always confidential and cannot be shared with any third parties without prior written approval from Syncsort. This message is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any use, disclosure, copying or distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and/or Syncsort and destroy all copies of this message in your possession, custody or control.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019273.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
	<LI>Next message: <A HREF="019275.html">[rabbitmq-discuss] New and Fundamental Confusion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19274">[ date ]</a>
              <a href="thread.html#19274">[ thread ]</a>
              <a href="subject.html#19274">[ subject ]</a>
              <a href="author.html#19274">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
