<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Per-Connection%20Flow%20Control%20-%20RMQ%202.8.1&In-Reply-To=%3C4F730718.6080908%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019204.html">
   <LINK REL="Next"  HREF="019273.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Per-Connection%20Flow%20Control%20-%20RMQ%202.8.1&In-Reply-To=%3C4F730718.6080908%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1">simon at rabbitmq.com
       </A><BR>
    <I>Wed Mar 28 13:42:00 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019204.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
        <LI>Next message: <A HREF="019273.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19210">[ date ]</a>
              <a href="thread.html#19210">[ thread ]</a>
              <a href="subject.html#19210">[ subject ]</a>
              <a href="author.html#19210">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/03/12 11:32, Simon MacMullen wrote:
&gt;<i> I will try to reproduce based on the above, but anything else you can
</I>&gt;<i> tell me would be a great help.
</I>
Hmm, I'm struggling with this.

I can certainly get into a state with a combination of x-message-ttl, 
lots of messages expiring, and enough memory pressure to push much of 
the queue onto disc, such that the queue performance fluctuates quite a 
bit (as it switches between accepting new messages / paging messages out 
to disc / paging them back in / expiring them).

But I can't get a message rate that works OK in this scenario with flow 
control disabled but blocks for long periods with it enabled. If the 
message rate is high enough for flow control to kick in, then it's also 
high enough for memory use to go up as messages wait to enter the queue 
if flow control is disabled. Eventually the memory alarm goes off instead.

So can you provide more information about your use pattern?

Having said that, if you just want to disable flow control and are 
prepared to build from source, you could apply the following patch:

diff -r f0dafaca6cd1 src/rabbit_reader.erl
--- a/src/rabbit_reader.erl	Mon Mar 26 17:12:41 2012 +0100
+++ b/src/rabbit_reader.erl	Wed Mar 28 13:40:03 2012 +0100
@@ -360,7 +360,7 @@

  control_throttle(State = #v1{connection_state = CS,
                               conserve_memory  = Mem}) -&gt;
-    case {CS, Mem orelse credit_flow:blocked()} of
+    case {CS, Mem} of
          {running,   true} -&gt; State#v1{connection_state = blocking};
          {blocking, false} -&gt; State#v1{connection_state = running};
          {blocked,  false} -&gt; ok = rabbit_heartbeat:resume_monitor(

But I would like to understand more about what you're seeing.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019204.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
	<LI>Next message: <A HREF="019273.html">[rabbitmq-discuss] Per-Connection Flow Control - RMQ 2.8.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19210">[ date ]</a>
              <a href="thread.html#19210">[ thread ]</a>
              <a href="subject.html#19210">[ subject ]</a>
              <a href="author.html#19210">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
