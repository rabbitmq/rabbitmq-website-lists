<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Basics: Queues, Routing Keys
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Basics%3A%20Queues%2C%20Routing%20Keys&In-Reply-To=%3C2BDFA182-9AF5-48DD-A96B-710F330539A0%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019282.html">
   <LINK REL="Next"  HREF="019283.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Basics: Queues, Routing Keys</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Basics%3A%20Queues%2C%20Routing%20Keys&In-Reply-To=%3C2BDFA182-9AF5-48DD-A96B-710F330539A0%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Basics: Queues, Routing Keys">steve at rabbitmq.com
       </A><BR>
    <I>Fri Mar 30 11:44:23 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="019282.html">[rabbitmq-discuss] Basics: Queues, Routing Keys
</A></li>
        <LI>Next message: <A HREF="019283.html">[rabbitmq-discuss] fanout queue not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19288">[ date ]</a>
              <a href="thread.html#19288">[ thread ]</a>
              <a href="subject.html#19288">[ subject ]</a>
              <a href="author.html#19288">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Rich,

The bit you're missing is the proper role of the exchange and the
routing-key and the fact that queues are *bound* to the exchange with a
binding key. Try reading
<A HREF="http://www.rabbitmq.com/tutorials/amqp-concepts.html,">http://www.rabbitmq.com/tutorials/amqp-concepts.html,</A> and come back here
(the reading list &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;) if you still
don't get it.

Steve Powell
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 30 Mar 2012, at 00:57, aloharich wrote:

&gt;<i> I'm trying to wrap my head around exchanges,queues, routing keys. My assumption which code is proving incorrect is: I can create a single exchange, with multiple queues. A consumer can point to a particular queue and get messages just for that queue. Now here is where my brain loses the plot: I had assumed I could use routing keys to have particular consumers just get messages on a queue that match a particular &quot;routing_key'.
</I>&gt;<i> 
</I>&gt;<i> So assuming I have a queue FOO and a queue BAR, I'd expect the below senders messages to queue BAR to NOT show up on queue FOO. However, when running the below, the queue FOO receiver receives messages if the routing key matches 
</I>&gt;<i> 
</I>&gt;<i> % python send.py a.b.c
</I>&gt;<i> % python recy.py a.b.c
</I>&gt;<i> (receives a message on QUEUE FOO since it appears routing key is matching)
</I>&gt;<i> 
</I>&gt;<i> Are routing keys global? Ie, if you have a key a.b.c any body on any queue will match that?
</I>&gt;<i> 
</I>&gt;<i> What I'm trying to achieve is the ability to send certain messages that only a group of consumers on a particular &quot;queue&quot; will process.
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> 
</I>&gt;<i> Rich
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> #!/usr/bin/env python
</I>&gt;<i> import pika
</I>&gt;<i> import sys
</I>&gt;<i> 
</I>&gt;<i> ex = &quot;dev.test&quot;
</I>&gt;<i> q = &quot;BAR&quot;
</I>&gt;<i> 
</I>&gt;<i> connection = pika.BlockingConnection(pika.ConnectionParameters(
</I>&gt;<i>         host='127.0.0.1'))
</I>&gt;<i> channel = connection.channel()
</I>&gt;<i> channel.exchange_declare(exchange=ex,
</I>&gt;<i>                          type='direct', durable=True)
</I>&gt;<i> result = channel.queue_declare(queue=q,auto_delete=False, durable=True)
</I>&gt;<i> print &quot;queue %s&quot; % result.method.queue
</I>&gt;<i> channel.queue_bind(exchange=ex,
</I>&gt;<i>                    queue=q)
</I>&gt;<i> routing_key = sys.argv[1] if len(sys.argv) &gt; 1 else 'anonymous.info'
</I>&gt;<i> message = &quot;hello&quot;
</I>&gt;<i> for i in range(1,2):
</I>&gt;<i>     channel.basic_publish(exchange=ex,
</I>&gt;<i>                           routing_key=routing_key,
</I>&gt;<i>                           body=message,
</I>&gt;<i>                           properties=pika.BasicProperties(
</I>&gt;<i>             delivery_mode = 2, 
</I>&gt;<i>             ))
</I>&gt;<i>     print &quot; [x] Sent %r&quot; % (message,)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> recv:
</I>&gt;<i> 
</I>&gt;<i> #!/usr/bin/env python
</I>&gt;<i> import pika
</I>&gt;<i> import sys
</I>&gt;<i> 
</I>&gt;<i> ex = &quot;dev.test&quot;
</I>&gt;<i> q = &quot;FOO&quot;
</I>&gt;<i> 
</I>&gt;<i> connection = pika.BlockingConnection(pika.ConnectionParameters(
</I>&gt;<i>         host='127.0.0.1'))
</I>&gt;<i> channel = connection.channel()
</I>&gt;<i> channel.exchange_declare(exchange=ex,
</I>&gt;<i>                          type='direct', durable=True)
</I>&gt;<i> 
</I>&gt;<i> result = channel.queue_declare(queue=q, durable=True)
</I>&gt;<i> queue_name = result.method.queue
</I>&gt;<i> binding_keys = sys.argv[1:]
</I>&gt;<i> if not binding_keys:
</I>&gt;<i>     print &gt;&gt; sys.stderr, &quot;Usage: %s [binding_key]...&quot; % (sys.argv[0],)
</I>&gt;<i>     sys.exit(1)
</I>&gt;<i> 
</I>&gt;<i> for binding_key in binding_keys:
</I>&gt;<i>     channel.queue_bind(exchange=ex,
</I>&gt;<i>                        queue=queue_name,
</I>&gt;<i>                        routing_key=binding_key)
</I>&gt;<i> 
</I>&gt;<i> print ' [*] Waiting for logs. To exit press CTRL+C'
</I>&gt;<i> 
</I>&gt;<i> def callback(ch, method, properties, body):
</I>&gt;<i>     print &quot;Routing key: %r&quot; % (method.routing_key)
</I>&gt;<i>     print &quot;Body %r&quot; % (body,)
</I>&gt;<i> 
</I>&gt;<i> channel.basic_consume(callback,
</I>&gt;<i>                       queue=queue_name,
</I>&gt;<i>                       no_ack=True)
</I>&gt;<i> 
</I>&gt;<i> channel.start_consuming()
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019282.html">[rabbitmq-discuss] Basics: Queues, Routing Keys
</A></li>
	<LI>Next message: <A HREF="019283.html">[rabbitmq-discuss] fanout queue not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19288">[ date ]</a>
              <a href="thread.html#19288">[ thread ]</a>
              <a href="subject.html#19288">[ subject ]</a>
              <a href="author.html#19288">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
