<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] One node in a cluster never fully starts up
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20One%20node%20in%20a%20cluster%20never%20fully%20starts%20up&In-Reply-To=%3C87r4ryc138.wl%25francesco%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021527.html">
   <LINK REL="Next"  HREF="021546.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] One node in a cluster never fully starts up</H1>
    <B>Francesco Mazzoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20One%20node%20in%20a%20cluster%20never%20fully%20starts%20up&In-Reply-To=%3C87r4ryc138.wl%25francesco%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] One node in a cluster never fully starts up">francesco at rabbitmq.com
       </A><BR>
    <I>Thu Jul 26 10:40:11 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021527.html">[rabbitmq-discuss] One node in a cluster never fully starts up
</A></li>
        <LI>Next message: <A HREF="021546.html">[rabbitmq-discuss] One node in a cluster never fully starts up
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21536">[ date ]</a>
              <a href="thread.html#21536">[ thread ]</a>
              <a href="subject.html#21536">[ subject ]</a>
              <a href="author.html#21536">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matt,

At Wed, 25 Jul 2012 11:48:56 -0700,
Matt Pietrek wrote:
&gt;<i> We have a 3 node cluster (mq1, mq2, mq3) running 2.8.4 supporting a small
</I>&gt;<i> number of HA queues. During startup of the cluster, we start all nodes in
</I>&gt;<i> parallel.
</I>
This is not a good idea when dealing with clustering.  RabbitMQ clustering is
basically a thin layer over mnesia clustering, and we need to do some additional
bookkeeping that is prone to race conditions (e.g. storing the online nodes at
shutdown).  We are putting efforts in making this process more reliable on the
rabbit side.

For this reason you should always execute clustering operations sequentially.

&gt;<i> Usually everything works fine. However, we've just recently seen one of the
</I>&gt;<i> nodes (mq3) won't start, i.e., the rabbitmqctl wait &lt;pid&gt; doesn't complete.
</I>&gt;<i> 
</I>&gt;<i> I can log in to the management UI on mq1 and mq2, so they're at least
</I>&gt;<i> minimally running.
</I>&gt;<i> 
</I>&gt;<i> Luckily, we've turned on verbose Mnesia logging. here's what the failing node
</I>&gt;<i> (mq3) shows in the console spew:
</I>&gt;<i>
</I>&gt;<i> [...]
</I>&gt;<i>
</I>&gt;<i> The pattern of &quot;Getting table rabbit_durable_exchange (disc_copies) from node
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at mq1</A>:&quot; cycles between mq1 and mq2 repeatedly until I kill mq3.
</I>
Uhm.  It looks like mnesia is detecting a deadlock, and I'm not sure why.  What
happens if you don't kill it?  Does it terminate by itself, eventually?

&gt;<i> What other sort of information can I provide or look for when this situation
</I>&gt;<i> repeats?
</I>
Well, the normal rabbit logs would help.

--
Francesco * Often in error, never in doubt
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021527.html">[rabbitmq-discuss] One node in a cluster never fully starts up
</A></li>
	<LI>Next message: <A HREF="021546.html">[rabbitmq-discuss] One node in a cluster never fully starts up
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21536">[ date ]</a>
              <a href="thread.html#21536">[ thread ]</a>
              <a href="subject.html#21536">[ subject ]</a>
              <a href="author.html#21536">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
