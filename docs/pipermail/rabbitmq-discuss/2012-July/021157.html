<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Handle Stale Connections on Clients
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Handle%20Stale%20Connections%20on%20Clients&In-Reply-To=%3C1341938859568-20687.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021187.html">
   <LINK REL="Next"  HREF="021159.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Handle Stale Connections on Clients</H1>
    <B>cogitate</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Handle%20Stale%20Connections%20on%20Clients&In-Reply-To=%3C1341938859568-20687.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Handle Stale Connections on Clients">monish.unni at gmail.com
       </A><BR>
    <I>Tue Jul 10 17:47:39 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021187.html">[rabbitmq-discuss] Clustering issue: Error: unable to connect to node rabbit at CNTD3BWEB87O: nodedown
</A></li>
        <LI>Next message: <A HREF="021159.html">[rabbitmq-discuss] Handle Stale Connections on Clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21157">[ date ]</a>
              <a href="thread.html#21157">[ thread ]</a>
              <a href="subject.html#21157">[ subject ]</a>
              <a href="author.html#21157">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Mathias et al:

Given:
-- java rabbitmq client 2.8.2
-- rabbitmq broker 2.8.2
-- wrote an amqp client library (java) that has the following semantics:
[1] setting up connection properties
 [1.1] username, password (authentication)
 [1.2] host, port ( endpoint )
 [1.3] # of threads(concurrent users), # of connections(conn.), conn.
timeout, receive timeout
 * # of usable clients effectively = threads x connections

[2] A manager sets up a pool for fair-sharing of resources per thread.
 [2.1] sets up a connection pool
 [2.2] sets up request/reply channels
 [2.3] sets up re-usable reply-queues

[3] A client class derived from the manager
 [3.1] this pre-configured (with properties in [2])
 [3.2] specify exchange(context), routing-key(service), payload(a message)
 

when a broker is shutdown and restarted, the stack i get is :
[ERROR:clean connection shutdown; reason: Attempt to use closed channel]
com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
reason: Attempt to use closed channel
	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:190)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:223)
	at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:209)
	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
	at
com.rabbitmq.client.impl.ChannelN.exchangeDeclarePassive(ChannelN.java:660)
	at
com.rabbitmq.client.impl.ChannelN.exchangeDeclarePassive(ChannelN.java:61)
	at com.xx.s2.amqp.AmqpClient.doSend(AmqpClient.java:187)
	at com.xx.s2.amqp.AmqpClient.callService(AmqpClient.java:80)
	at
com.xx.s2.amqp.StaleConnectionTest.callLoopTest(StaleConnectionTest.java:132)
	at com.xx.s2.amqp.StaleConnectionTest.loopTest(StaleConnectionTest.java:86)

at this point, i have to shutdown the client using the library and restart
it. is there a way to handle this exception and re-establish the connection?
any utilities that will allow me to do this &quot;automatically&quot;?

thanks and regards,
-monish

--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687.html">http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021187.html">[rabbitmq-discuss] Clustering issue: Error: unable to connect to node rabbit at CNTD3BWEB87O: nodedown
</A></li>
	<LI>Next message: <A HREF="021159.html">[rabbitmq-discuss] Handle Stale Connections on Clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21157">[ date ]</a>
              <a href="thread.html#21157">[ thread ]</a>
              <a href="subject.html#21157">[ subject ]</a>
              <a href="author.html#21157">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
