<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Consumer's confirm
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumer%27s%20confirm&In-Reply-To=%3CC3838973-C151-41C9-9423-7D5798048155%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021382.html">
   <LINK REL="Next"  HREF="021388.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Consumer's confirm</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Consumer%27s%20confirm&In-Reply-To=%3CC3838973-C151-41C9-9423-7D5798048155%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Consumer's confirm">steve at rabbitmq.com
       </A><BR>
    <I>Thu Jul 19 12:11:56 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021382.html">[rabbitmq-discuss] Consumer's confirm
</A></li>
        <LI>Next message: <A HREF="021388.html">[rabbitmq-discuss] Consumer's confirm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21384">[ date ]</a>
              <a href="thread.html#21384">[ thread ]</a>
              <a href="subject.html#21384">[ subject ]</a>
              <a href="author.html#21384">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>ML,

I realise that I haven't really answered your question:

&gt;&gt;<i> what should I do to route consumers ack to producer?
</I>

The RabbitMQ broker isolates the publishers from knowledge of the
consumers and vice versa; this includes knowing if there are there and
have acknowledged the message. This makes it tricky to get RabbitMQ to
do what you want directly.

One way to achieve it is to use reply-to queues: temporary queues which
the publisher sets up (for a particular message, or for many messages)
which the consumer can then publish a response to. If the reply-to queue
is provided to the consumer with the published message, the consumer can
programmatically respond to the publisher without having to know who the
publisher is (or if it is available, etc.).

This mechanism is exploited in the RPC tutorial [1], which you should
read. With RPC, the client (caller) blocks until the reply is received;
but you might not want to do that. I'm sure this will help you to
implement a solution for your case.

Good luck,

Steve Powell
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

[1] <A HREF="http://www.rabbitmq.com/tutorials/tutorial-six-java.html">http://www.rabbitmq.com/tutorials/tutorial-six-java.html</A>

&gt;<i> ML,
</I>&gt;<i> 
</I>&gt;<i> The definitive guide to Publish-confirms is in the extensions
</I>&gt;<i> documentation [1], where it says:
</I>&gt;<i> 
</I>&gt;&gt;<i> By confirming a message the broker assumes responsibility for it and
</I>&gt;&gt;<i> indicates that it has done something it deems reasonable with it.
</I>&gt;&gt;<i> Unroutable mandatory or immediate messages are confirmed right after
</I>&gt;&gt;<i> thebasic.return. Transient messages are confirmed as soon as they arrive
</I>&gt;&gt;<i> on all the queues they were routed to. Persistent messages are confirmed
</I>&gt;&gt;<i> when all queues have either delivered the message and received an
</I>&gt;&gt;<i> acknowledgement (if required), or persisted the message.
</I>&gt;<i> 
</I>&gt;<i> Notice that a confirmation does not necessarily mean that a consumer has
</I>&gt;<i> received and acknowledged the message; in general it means that RabbitMQ
</I>&gt;<i> has successfully 'processed' the message, which might mean 'persisted' it, if
</I>&gt;<i> it is persistent, or returned it, if it was unroutable (and marked
</I>&gt;<i> mandatory), etc.
</I>&gt;<i> 
</I>&gt;<i> You may wish to investigate the 'immediate' and 'mandatory' flags. Be
</I>&gt;<i> aware that you cannot use 'publisher confirms' on a transactional
</I>&gt;<i> channel.
</I>&gt;<i> 
</I>&gt;<i> [1] <A HREF="http://www.rabbitmq.com/extensions.html#confirms">http://www.rabbitmq.com/extensions.html#confirms</A>
</I>&gt;<i> 
</I>&gt;<i> Steve Powell
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
</I>&gt;<i> [wrk: +44-2380-111-528] [mob: +44-7815-838-558]
</I>&gt;<i> 
</I>&gt;<i> On 19 Jul 2012, at 10:25, Mohsen Lotfizad wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hi
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I have a project that producers want to assure their message are delivered to consumers.
</I>&gt;&gt;<i> I make a Google search and find rabbitMQ transaction and confirm from (<A HREF="http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/">http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/</A>) . I download discussed examples and run them. But I comment the consumer part. with my surprise producer gives ack, even if I uncomment  consumer part and send NACK instead of ack!
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> what should I do to route consumers ack to producer?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ps: does com.rabbitmq.client.Channel#addReturnListener helps me?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Sincerely 
</I>&gt;&gt;<i> ML
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021382.html">[rabbitmq-discuss] Consumer's confirm
</A></li>
	<LI>Next message: <A HREF="021388.html">[rabbitmq-discuss] Consumer's confirm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21384">[ date ]</a>
              <a href="thread.html#21384">[ thread ]</a>
              <a href="subject.html#21384">[ subject ]</a>
              <a href="author.html#21384">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
