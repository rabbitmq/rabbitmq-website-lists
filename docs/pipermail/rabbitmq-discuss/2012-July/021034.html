<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] STOMP plug-in, HA queues,	and consumer cancelations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20plug-in%2C%20HA%20queues%2C%0A%09and%20consumer%20cancelations&In-Reply-To=%3C9E830826-692A-4D36-8233-59B0385EA098%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021032.html">
   <LINK REL="Next"  HREF="021036.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] STOMP plug-in, HA queues,	and consumer cancelations</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20STOMP%20plug-in%2C%20HA%20queues%2C%0A%09and%20consumer%20cancelations&In-Reply-To=%3C9E830826-692A-4D36-8233-59B0385EA098%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] STOMP plug-in, HA queues,	and consumer cancelations">steve at rabbitmq.com
       </A><BR>
    <I>Tue Jul  3 17:06:32 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021032.html">[rabbitmq-discuss] RabbitMQ Subscriber Timeout When Waiting for	Delivery
</A></li>
        <LI>Next message: <A HREF="021036.html">[rabbitmq-discuss] STOMP plug-in, HA queues,	and consumer cancelations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21034">[ date ]</a>
              <a href="thread.html#21034">[ thread ]</a>
              <a href="subject.html#21034">[ subject ]</a>
              <a href="author.html#21034">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Elias,

Mea Culpa,

You are quite right. Your understanding of HA queues is better than
mine. However, AFAICS the STOMP adapter doesn't present
the consumer_cancel_notify capability to the (Erlang) connection, so
will not receive a notification when the consumer is cancelled.

The STOMP client will think that the subscription is sound even if the
underlying consumer was cancelled. We can probably do better than this.

Although the STOMP client will stop receiving messages, I would not
characterise this as 'dangerous', merely frustrating.

Can you say what you think the correct STOMP behaviour ought to be if a
subscription's consumer is unilaterally cancelled? I'm tempted to simply
send an ERROR frame and simulate an UNSUBSCRIBE,
leaving the STOMP client to recover however it thinks fit.

Steve Powell
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">steve at rabbitmq.com</A>
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 2 Jul 2012, at 17:21, Elias Levy wrote:

&gt;<i> On Mon, Jul 2, 2012 at 8:50 AM, Steve Powell &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">spowell at vmware.com</A>&gt; wrote:
</I>&gt;<i> STOMP doesn't know that a queue is HA and will not mend a broken
</I>&gt;<i> subscription; however, the subscription shouldn't be broken unless the
</I>&gt;<i> broker connected to goes down, in which case the connection will be
</I>&gt;<i> lost, the STOMP session will fail, and the subscription with it.
</I>&gt;<i> 
</I>&gt;<i> Why do you say that the subscription will not be broken unless the broker connected to (I assume by the STOMP client) goes down?
</I>&gt;<i> 
</I>&gt;<i> My understanding is that with a HA queue if the node hosting the HA queue master goes down, the new promoted HA queue master considers all previous subscriptions to have been disconnected, and issues a consumer cancelation to all consumers of those subscriptions that support the feature.  Thus, a consumer that does not support consumer cancelation will believe his subscription to the HA queue is still valid and wait indefinitely for messages that will never arrive.
</I>&gt;<i> 
</I>&gt;<i> Am I wrong?
</I>&gt;<i> 
</I>&gt;<i> By this logic, if the RMQ STOMP proxy does not handle consumer cancelations, then its rather dangerous to use it to consume from a HA queue.
</I>&gt;<i> 
</I>&gt;<i> Elias Levy
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/3df388db/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120703/3df388db/attachment.htm</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021032.html">[rabbitmq-discuss] RabbitMQ Subscriber Timeout When Waiting for	Delivery
</A></li>
	<LI>Next message: <A HREF="021036.html">[rabbitmq-discuss] STOMP plug-in, HA queues,	and consumer cancelations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21034">[ date ]</a>
              <a href="thread.html#21034">[ thread ]</a>
              <a href="subject.html#21034">[ subject ]</a>
              <a href="author.html#21034">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
