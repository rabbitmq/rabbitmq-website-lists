<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] &#31572;&#22797;:  something about message priority
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%0A%20%3D%3Futf-8%3Fb%3F562U5aSNOiAgc29tZXRoaW5nIGFib3V0IG1l%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fssage_priority%3F%3D&In-Reply-To=%3C50126009.7070001%40comarch.pl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021558.html">
   <LINK REL="Next"  HREF="021561.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] &#31572;&#22797;:  something about message priority</H1>
    <B>Ernest Staszuk</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%0A%20%3D%3Futf-8%3Fb%3F562U5aSNOiAgc29tZXRoaW5nIGFib3V0IG1l%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fssage_priority%3F%3D&In-Reply-To=%3C50126009.7070001%40comarch.pl%3E"
       TITLE="[rabbitmq-discuss] &#31572;&#22797;:  something about message priority">ernest.staszuk at comarch.pl
       </A><BR>
    <I>Fri Jul 27 10:31:53 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021558.html">[rabbitmq-discuss] &#31572;&#22797;:  something about message priority
</A></li>
        <LI>Next message: <A HREF="021561.html">[rabbitmq-discuss] &#31572;&#22797;:  something about message priority
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21559">[ date ]</a>
              <a href="thread.html#21559">[ thread ]</a>
              <a href="subject.html#21559">[ subject ]</a>
              <a href="author.html#21559">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I didn't use spring amqp api, so I can not provide you working example.

I use consuming with small timeout (and there is a cost of time - small 
delay,
  not an issue in my case, cpu usage and network fingerprints stays very 
small).
I was also taking advantage of rabbit's java client prefetching (I am 
not sure
if spring implements that). These two combined gave me acceptable 
approximation of priorities.

You could also add to messages own argument (for example myPriority) and 
consume all messages
as they are available (or let's say up to 200 messages or sth), then put 
them in a priority
queue on your application side. And then process them from the head of 
this container (using
dedicated thread). That also may give you acceptable results.

Note that the state of art is as follows: RabbitMQ is a FIFO queue, and 
does not make
use of message priorities today. It could be changed in one of the 
future releases, I don't
know when it may be. As consequence of that you should apply some 
reasonable workaround
which will be acceptable for you or reconsider your needs (maybe you 
don't really need
priorities?) or use something else than RabbitMQ or implement it by 
yourself. By the way
AMQP itself says that &quot;Messages with higher priorities MAY be delivered 
before those with
lower priorities&quot;. Following that messages priority in any 
implementation of AMQP may
be not consistent.

Best regards,
Ernest Staszuk





W dniu 2012-07-27 10:50, andy pisze:
&gt;<i> at as you say ,if we are processing 2st queue message as soon as the 
</I>&gt;<i> 1^st queue gets a new message needed to process,how can we switch to 
</I>&gt;<i> process 1^st ? It also means that we should check the amount of 
</I>&gt;<i>  messages in the queue  in order ,I think it will cost much time and 
</I>&gt;<i> machine resource.and could you tell me  how I could  use spring amqp a
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/14f9a601/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120727/14f9a601/attachment.htm</A>&gt;
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021558.html">[rabbitmq-discuss] &#31572;&#22797;:  something about message priority
</A></li>
	<LI>Next message: <A HREF="021561.html">[rabbitmq-discuss] &#31572;&#22797;:  something about message priority
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21559">[ date ]</a>
              <a href="thread.html#21559">[ thread ]</a>
              <a href="subject.html#21559">[ subject ]</a>
              <a href="author.html#21559">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
