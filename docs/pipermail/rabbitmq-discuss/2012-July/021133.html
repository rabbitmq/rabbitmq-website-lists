<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Envelop redeliver question ( clustering ha redelivery question)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Envelop%20redeliver%20question%20%28%20clustering%20ha%0A%20redelivery%20question%29&In-Reply-To=%3C4FFAD974.8070404%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021129.html">
   <LINK REL="Next"  HREF="021107.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Envelop redeliver question ( clustering ha redelivery question)</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Envelop%20redeliver%20question%20%28%20clustering%20ha%0A%20redelivery%20question%29&In-Reply-To=%3C4FFAD974.8070404%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Envelop redeliver question ( clustering ha redelivery question)">emile at rabbitmq.com
       </A><BR>
    <I>Mon Jul  9 14:15:32 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021129.html">[rabbitmq-discuss] Envelop redeliver question ( clustering ha	redelivery question)
</A></li>
        <LI>Next message: <A HREF="021107.html">[rabbitmq-discuss] time to arrive in queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21133">[ date ]</a>
              <a href="thread.html#21133">[ thread ]</a>
              <a href="subject.html#21133">[ subject ]</a>
              <a href="author.html#21133">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On 09/07/12 12:58, Vikas wrote:
&gt;<i> Thanks for your reply . I've set QoS prefetch count set to one.
</I>&gt;<i> 
</I>&gt;<i> The problem is observed in only one scenario 
</I>&gt;<i> 
</I>&gt;<i> Node1 and Node2 are running in cluster ha
</I>&gt;<i> Stop Node2
</I>&gt;<i> Start Node2
</I>&gt;<i> Restart Consumer
</I>&gt;<i> All old messages are received with redeliver as true .
</I>
How are you stopping the node? It is not clear from your last email
whether nodes are being shutdown cleanly or forcibly. Disregarding HA
for the moment, if the broker is stopped forcibly then all recovered
queues will have their contents set to redelivered. The information
about which messages were delivered is held in RAM, so when the broker
starts up after crashing it must assume that all messages could have
been delivered, hence a redelivered flag on all messages.

The situation with HA is different, because another node can take over
the master role. But if the last node is shut down uncleanly then you
can also observe all messages being marked redelivered after the node
starts up and the queue is recovered.

In the scenario you describe, I would expect Node1 to be the master for
all queues when Node2 stops, and any unacknowledged messages held by the
consumer when it disconnects to be have the redelivered flag set. Does
that match up with what you are seeing? I'm not sure what you mean by
&quot;old messages&quot; - does this refer to messages that have not been
delivered before?


-Emile


</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021129.html">[rabbitmq-discuss] Envelop redeliver question ( clustering ha	redelivery question)
</A></li>
	<LI>Next message: <A HREF="021107.html">[rabbitmq-discuss] time to arrive in queue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21133">[ date ]</a>
              <a href="thread.html#21133">[ thread ]</a>
              <a href="subject.html#21133">[ subject ]</a>
              <a href="author.html#21133">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
