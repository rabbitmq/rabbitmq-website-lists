<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Plz%20give%20me%20help%20about%20EPMD%3A%20Non-local%20peer%0A%20connected&In-Reply-To=%3C4FF7218F.3090105%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021069.html">
   <LINK REL="Next"  HREF="021110.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Plz%20give%20me%20help%20about%20EPMD%3A%20Non-local%20peer%0A%20connected&In-Reply-To=%3C4FF7218F.3090105%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected">tim at rabbitmq.com
       </A><BR>
    <I>Fri Jul  6 18:34:07 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021069.html">[rabbitmq-discuss] Plz give me help about EPMD: Non-local peer	connected
</A></li>
        <LI>Next message: <A HREF="021110.html">[rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21079">[ date ]</a>
              <a href="thread.html#21079">[ thread ]</a>
              <a href="subject.html#21079">[ subject ]</a>
              <a href="author.html#21079">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

On 06/07/2012 06:53, &#20309;&#25996; wrote:
&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I installed RabbotMQ &amp; tried to start it.
</I>&gt;<i>
</I>&gt;<i> But I always got error as following:
</I>&gt;<i>
</I>
Ok so first of all, let's see if we can get you to start a stand alone 
distributed Erlang node successfully. Normally stack traces like that 
occur when the host environment isn't set up quite right (from Erlang's 
perspective).

We need to be able to run `erl -sname rabbit` on the command line and 
see the Erlang emulator start successfully. It should look something 
like this:

##############

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">t4 at malachi</A>:systest $ erl -sname rabbit
Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:2:2] [async-threads:0] 
[hipe] [kernel-poll:false]

Eshell V5.9.1  (abort with ^G)
(<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at malachi</A>)1&gt;

##############

Can you start Erlang like that successfully? I'm assuming not, but 
please let us know.

I'm also interested in understanding what your hosts configuration 
(e.g., /etc/hosts) looks like. On some Operating Systems (such as CentOS 
for example), failing to set an explicit host name prevents you from 
starting a distributed Erlang node.

&gt;<i> {error_logger,{{2012,7,6},{13,32,21}},&quot;Protocol: ~p: register error:
</I>&gt;<i> ~p~n&quot;,[&quot;inet_tcp&quot;,{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1,[{file,&quot;inet_tcp_dist.erl&quot;},{line,70}]},{net_kernel,start_protos,4,[{file,&quot;net_kernel.erl&quot;},{line,1314}]},{net_kernel,start_protos,3,[{file,&quot;net_kernel.erl&quot;},{line,1307}]},{net_kernel,init_node,2,[{file,&quot;net_kernel.erl&quot;},{line,1197}]},{net_kernel,init,1,[{file,&quot;net_kernel.erl&quot;},{line,357}]},{gen_server,init_it,6,[{file,&quot;gen_server.erl&quot;},{line,304}]},{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]}]}
</I>&gt;<i> {error_logger,{{2012,7,6},{13,32,21}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,&lt;0.20.0&gt;},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6,[{file,&quot;gen_server.erl&quot;},{line,320}]},{proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]}},{ancest
</I>&gt;<i> ors,[net_sup,kernel_sup,&lt;0.9.0&gt;]},{messages,[]},{links,[#Port&lt;0.90&gt;,&lt;0.17.0&gt;]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,987},{stack_size,24},{reductions,551}],[]]}
</I>&gt;<i> {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch1077,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
</I>&gt;<i> {error_logger,{{2012,7,6},{13,32,21}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
</I>&gt;<i> {error_logger,{{2012,7,6},{13,32,21}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
</I>&gt;<i> {&quot;Kern el pid
</I>&gt;<i> terminated&quot;,application_controller,&quot;{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}&quot;}
</I>&gt;<i>
</I>&gt;<i> Crash dump was written to: erl_crash.dump
</I>&gt;<i> Kernel pid terminated (application_controller)
</I>&gt;<i> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I ran it on a server with public IP 183.*.*.* .
</I>&gt;<i>
</I>&gt;<i> In Erlang src, I found that epmd checks connection src.
</I>&gt;<i>
</I>&gt;<i>        /* Determine if connection is from localhost */
</I>&gt;<i>        if (getpeername(s-&gt;fd,(struct sockaddr*) &amp;si,&amp;st) ||
</I>&gt;<i>            st &lt; sizeof(si)) {
</I>&gt;<i>            /* Failure to get peername is regarded as non local host */
</I>&gt;<i>            s-&gt;local_peer = EPMD_FALSE;
</I>&gt;<i>        } else {
</I>&gt;<i>            /* Only 127.x.x.x and connections from the host's IP address
</I>&gt;<i>               allowed, no false positives */
</I>&gt;<i>            s-&gt;local_peer =
</I>&gt;<i> (((((unsigned) ntohl(si.sin_addr.s_addr)) &amp; 0xFF000000U) ==
</I>&gt;<i>                 0x7F000000U) ||
</I>&gt;<i> (getsockname(s-&gt;fd,(struct sockaddr*) &amp;di,&amp;st) ?
</I>&gt;<i>                 EPMD_FALSE : si.sin_addr.s_addr == di.s in_addr.s_addr));
</I>&gt;<i>        }
</I>&gt;<i>        dbg_tty_printf(g,2,(s-&gt;local_peer) ? &quot;Local peer connected&quot; :
</I>&gt;<i>                       &quot;Non-local peer connected&quot;);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> But unfortunately, si.sin_addr.s_addr was 183.*.*.*, while
</I>&gt;<i> di.sin_addr.s_addr was 127.0.0.1
</I>&gt;<i>
</I>&gt;<i> My log&#65306;Checking peer address, getsockname ret: 0, si_addr=0xb7??????,
</I>&gt;<i> di_addr=0x7f000001
</I>&gt;<i>
</I>&gt;<i>
</I>
I could be wrong, but I suspect this is a red herring. You can restart 
epmd with -d to get debugging information as well, but I suspect this 
isn't relevant.

Is there any way to force RabbitMQ server connect epmd via a specified
&gt;<i> address&#65311;
</I>&gt;<i>
</I>
I'm not really sure what you mean by this, but I'm fairly confident that 
it is not necessary to even attempt to do something like that. Erlang 
should be able to start up nodes with `-sname &lt;name&gt;` or `-name 
&lt;name&gt;@&lt;host&gt;` and if either doesn't work, a little tweaking of the host 
configuration should solve it.

Based on your original comment (starting rabbitmq but always getting an 
error) my understanding is that you're trying to start rabbit on this 
machine and it fails. AFAIK when a distributed Erlang node connects to 
EPMD on the localhost it should be treated as such. The rabbitmq-server 
script starts rabbit up with `-sname rabbit` which implies that the node 
name will be rabbit@&lt;hostname&gt; so you should make sure that `erl -sname 
rabbit` works first of all.
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021069.html">[rabbitmq-discuss] Plz give me help about EPMD: Non-local peer	connected
</A></li>
	<LI>Next message: <A HREF="021110.html">[rabbitmq-discuss] Plz give me help about EPMD: Non-local peer connected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21079">[ date ]</a>
              <a href="thread.html#21079">[ thread ]</a>
              <a href="subject.html#21079">[ subject ]</a>
              <a href="author.html#21079">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
