<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Handle Stale Connections on Clients
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Handle%20Stale%20Connections%20on%20Clients&In-Reply-To=%3CCAE0Sz%3DwVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv%2BPWg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021157.html">
   <LINK REL="Next"  HREF="021191.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Handle Stale Connections on Clients</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Handle%20Stale%20Connections%20on%20Clients&In-Reply-To=%3CCAE0Sz%3DwVjM3XT2w_pe4bnxQ6de_xhh2aiaMh1jL-W0AhCv%2BPWg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Handle Stale Connections on Clients">jerryk at rbcon.com
       </A><BR>
    <I>Tue Jul 10 17:59:58 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021157.html">[rabbitmq-discuss] Handle Stale Connections on Clients
</A></li>
        <LI>Next message: <A HREF="021191.html">[rabbitmq-discuss] Handle Stale Connections on Clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21159">[ date ]</a>
              <a href="thread.html#21159">[ thread ]</a>
              <a href="subject.html#21159">[ subject ]</a>
              <a href="author.html#21159">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Monish:

If you're using the naked Java client, you'll have to implement your own
reconnection logic.  If you're using Spring AMQP there's some helper code
that wraps your connections with some retry logic for you.

Best regards,
Jerry

On Tue, Jul 10, 2012 at 9:47 AM, cogitate &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">monish.unni at gmail.com</A>&gt; wrote:

&gt;<i> Hi Mathias et al:
</I>&gt;<i>
</I>&gt;<i> Given:
</I>&gt;<i> -- java rabbitmq client 2.8.2
</I>&gt;<i> -- rabbitmq broker 2.8.2
</I>&gt;<i> -- wrote an amqp client library (java) that has the following semantics:
</I>&gt;<i> [1] setting up connection properties
</I>&gt;<i>  [1.1] username, password (authentication)
</I>&gt;<i>  [1.2] host, port ( endpoint )
</I>&gt;<i>  [1.3] # of threads(concurrent users), # of connections(conn.), conn.
</I>&gt;<i> timeout, receive timeout
</I>&gt;<i>  * # of usable clients effectively = threads x connections
</I>&gt;<i>
</I>&gt;<i> [2] A manager sets up a pool for fair-sharing of resources per thread.
</I>&gt;<i>  [2.1] sets up a connection pool
</I>&gt;<i>  [2.2] sets up request/reply channels
</I>&gt;<i>  [2.3] sets up re-usable reply-queues
</I>&gt;<i>
</I>&gt;<i> [3] A client class derived from the manager
</I>&gt;<i>  [3.1] this pre-configured (with properties in [2])
</I>&gt;<i>  [3.2] specify exchange(context), routing-key(service), payload(a message)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> when a broker is shutdown and restarted, the stack i get is :
</I>&gt;<i> [ERROR:clean connection shutdown; reason: Attempt to use closed channel]
</I>&gt;<i> com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
</I>&gt;<i> reason: Attempt to use closed channel
</I>&gt;<i>         at
</I>&gt;<i> com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:190)
</I>&gt;<i>         at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:223)
</I>&gt;<i>         at
</I>&gt;<i> com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:209)
</I>&gt;<i>         at
</I>&gt;<i> com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)
</I>&gt;<i>         at
</I>&gt;<i> com.rabbitmq.client.impl.ChannelN.exchangeDeclarePassive(ChannelN.java:660)
</I>&gt;<i>         at
</I>&gt;<i> com.rabbitmq.client.impl.ChannelN.exchangeDeclarePassive(ChannelN.java:61)
</I>&gt;<i>         at com.xx.s2.amqp.AmqpClient.doSend(AmqpClient.java:187)
</I>&gt;<i>         at com.xx.s2.amqp.AmqpClient.callService(AmqpClient.java:80)
</I>&gt;<i>         at
</I>&gt;<i>
</I>&gt;<i> com.xx.s2.amqp.StaleConnectionTest.callLoopTest(StaleConnectionTest.java:132)
</I>&gt;<i>         at
</I>&gt;<i> com.xx.s2.amqp.StaleConnectionTest.loopTest(StaleConnectionTest.java:86)
</I>&gt;<i>
</I>&gt;<i> at this point, i have to shutdown the client using the library and restart
</I>&gt;<i> it. is there a way to handle this exception and re-establish the
</I>&gt;<i> connection?
</I>&gt;<i> any utilities that will allow me to do this &quot;automatically&quot;?
</I>&gt;<i>
</I>&gt;<i> thanks and regards,
</I>&gt;<i> -monish
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687.html">http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687.html</A>
</I>&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/8e2059be/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120710/8e2059be/attachment.htm</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021157.html">[rabbitmq-discuss] Handle Stale Connections on Clients
</A></li>
	<LI>Next message: <A HREF="021191.html">[rabbitmq-discuss] Handle Stale Connections on Clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21159">[ date ]</a>
              <a href="thread.html#21159">[ thread ]</a>
              <a href="subject.html#21159">[ subject ]</a>
              <a href="author.html#21159">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
