<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Security Exception in IIS using RabbitMQ	Client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Security%20Exception%20in%20IIS%20using%20RabbitMQ%0A%09Client&In-Reply-To=%3CCE935BAB-1E50-4A86-8365-7629CFF533AF%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021437.html">
   <LINK REL="Next"  HREF="021521.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Security Exception in IIS using RabbitMQ	Client</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Security%20Exception%20in%20IIS%20using%20RabbitMQ%0A%09Client&In-Reply-To=%3CCE935BAB-1E50-4A86-8365-7629CFF533AF%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Security Exception in IIS using RabbitMQ	Client">tim at rabbitmq.com
       </A><BR>
    <I>Fri Jul 20 23:39:46 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021437.html">[rabbitmq-discuss] Security Exception in IIS using RabbitMQ	Client
</A></li>
        <LI>Next message: <A HREF="021521.html">[rabbitmq-discuss] Security Exception in IIS using RabbitMQ	Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21440">[ date ]</a>
              <a href="thread.html#21440">[ thread ]</a>
              <a href="subject.html#21440">[ subject ]</a>
              <a href="author.html#21440">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 20 Jul 2012, at 22:56, Tim Watson wrote:

&gt;<i> 
</I>&gt;<i> On 20 Jul 2012, at 19:43, Dave Seltzer &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dseltzer at tveyes.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Thanks for your help Tim,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> It seems like this isn't an issue with actual file IO, but rather Code
</I>&gt;&gt;<i> Security.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've tried setting &lt;trust level=&quot;Full&quot; originUrl=&quot;&quot; /&gt; in the web.config,
</I>&gt;&gt;<i> but it doesn't seem to help.
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>
Ok so according to msdn, FULL is the default level anyway, but these are only partially trusted app domains. Hmn, this will require a bit more configuration I think.

Two things to bare in mind. Firstly, you don't need to set the originUrl to &quot;&quot; and secondly, just setting the appilcation's trust level may not be enough if the server or .NET framework installation have settings (on the host machine) overriding this. I'm assuming you're using ASP.NET 4, which seems to have a slightly different interpretation of the trust level(s) than I remember. Certainly though the central IIS configuration can refuse to give applications (lower down) Full trust, so you need to check with the IIS admin (unless that's you, in which case consult MSDN to figure out where this would be configured).  

Normally I'd also suggest setting a FileIOPermission attribute around the handler that's failing (or inserting a CAS assertion in the code) but I'm still a little unclear what's going on here. My reading of the situation is that as the connection factory instance is initialising, it accesses the DefaultClientProperties property in ConnectionBase, which in turn introspects the assembly itself using reflection. Incidentally, this might be a bit gratuitous, and should certainly assert its own CAS demands - I will file a bug for that. 

Nonetheless, this shouldn't actually prevent you from using the assembly in an ASP.NET application. Interestingly, I would've expected to see a CAS demand for ReflectionPermission (or whatever it's called) rather than FileIOPermission! Please check a few things

- Is the assembly in the GAC? That might not be the panacea it ought to be and a local reference in the bin directory of your webapp might be preferable.
- Is this failing for you locally or only on a remote IIS that you're working with? If you have control over the IIS server, make sure Full trust is available everywhere or at least can be overridden by applications

If you have put the client assembly in the GAC then the calls to Assembly.GetName (that are made in ConnectionBase) will demand FileIOPermission, so that's one to bare in mind.
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021437.html">[rabbitmq-discuss] Security Exception in IIS using RabbitMQ	Client
</A></li>
	<LI>Next message: <A HREF="021521.html">[rabbitmq-discuss] Security Exception in IIS using RabbitMQ	Client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21440">[ date ]</a>
              <a href="thread.html#21440">[ thread ]</a>
              <a href="subject.html#21440">[ subject ]</a>
              <a href="author.html#21440">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
