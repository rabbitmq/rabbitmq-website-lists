<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Issue%20in%20creating%20a%20RabbitMQ%20Cluster&In-Reply-To=%3C4FF24350.4080001%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020992.html">
   <LINK REL="Next"  HREF="020998.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Issue in creating a RabbitMQ Cluster</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Issue%20in%20creating%20a%20RabbitMQ%20Cluster&In-Reply-To=%3C4FF24350.4080001%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Issue in creating a RabbitMQ Cluster">tim at rabbitmq.com
       </A><BR>
    <I>Tue Jul  3 01:56:48 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="020992.html">[rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
</A></li>
        <LI>Next message: <A HREF="020998.html">[rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20996">[ date ]</a>
              <a href="thread.html#20996">[ thread ]</a>
              <a href="subject.html#20996">[ subject ]</a>
              <a href="author.html#20996">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/07/2012 22:05, Aravindh S wrote:
&gt;<i> Hi.
</I>&gt;<i>
</I>&gt;<i> I am trying to create a cluster of three RabbitMQ nodes.
</I>&gt;<i> I am having trouble setting the &quot;.erlang.cookie&quot; file correctly.
</I>&gt;<i>
</I>&gt;<i> Node1 - x.y.z.28        - Ubuntu 12.04 - RabbitMQ installed from
</I>&gt;<i> repositories.
</I>&gt;<i> Node2 - x.y.z.38        - Ubuntu 12.04 - RabbitMQ installed from
</I>&gt;<i> repositories.
</I>&gt;<i> Node3 - x.y.z.39        - Ubuntu 12.04 - RabbitMQ installed from
</I>&gt;<i> repositories.
</I>&gt;<i>
</I>&gt;<i> Individually all the three nodes are working fine.
</I>&gt;<i>
</I>&gt;<i> Step 1 : copy the erlang magic cookie between the nodes
</I>&gt;<i>
</I>&gt;<i>   * I replace the /var/lib/rabbitmq/.erlang.cookie file in Node 2 with
</I>&gt;<i>     that of Node 1
</I>&gt;<i>   * ls -al shows the file is owned by &quot;rabbitmq&quot; user
</I>
make sure the permissions are tight enough (readable ONLY):

-r--------    1 t4    staff      20  8 Apr  2010 .erlang.cookie

&gt;<i>
</I>&gt;<i> step 2 : I try to add Node2 to a cluster with Node1
</I>&gt;<i>
</I>&gt;<i>   * Every rabbitmqctl command fails like below
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at rabbit3</A>:/home/aravindh# rabbitmqctl cluster <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at 130.127.39.28</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at 130.127.39.28</A>&gt;
</I>&gt;<i> Clustering node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3</A> with ['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at 130.127.39.28</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at 130.127.39.28</A>&gt;'] ...
</I>&gt;<i> Error: unable to connect to node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3</A>: nodedown
</I>&gt;<i> diagnostics:
</I>&gt;<i> - nodes and their ports on rabbit3:
</I>&gt;<i> [{rabbit,37223},{rabbitmqctl12238,44154}]
</I>&gt;<i> - current node: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl12238 at rabbit3</A>
</I>&gt;<i> - current node home dir: /var/lib/rabbitmq
</I>&gt;<i> - current node cookie hash: rMqeVIBUabtB2sZrvleTTQ==
</I>&gt;<i>
</I>&gt;<i>
</I>
Well why are you using an IP addr instead of hostname!? It looks like 
you're not even running rabbit on rabbit3. Have you actually run 
rabbitmq-server to start the broker? What does erl -sname rabbit look 
like on the local machine(s)?

&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at rabbit3</A>:/home/aravindh# rabbitmqctl status
</I>&gt;<i> Status of node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3</A> ...
</I>&gt;<i> Error: unable to connect to node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3</A>: nodedown
</I>&gt;<i> diagnostics:
</I>&gt;<i> - nodes and their ports on rabbit3:
</I>&gt;<i> [{rabbit,37223},{rabbitmqctl12271,38179}]
</I>&gt;<i> - current node: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl12271 at rabbit3</A>
</I>&gt;<i> - current node home dir: /var/lib/rabbitmq
</I>&gt;<i> - current node cookie hash: rMqeVIBUabtB2sZrvleTTQ==
</I>&gt;<i>
</I>
This is saying that the local node (<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit3</A>) is not running. This 
is *probably* because your Erlang cookie's permissions aren't tight enough.

&gt;<i> Reverting back to the original .erlang.cookie file gets rid of the
</I>&gt;<i> error, but I cannot proceed with cluster without this cookie step right ?
</I>&gt;<i>
</I>
That is correct. Try making the permission on the cookie file more 
restrictive. Don't forget to start the broker and then try running 
`rabbitmqctl status` and see if you're up and running locally.

</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020992.html">[rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
</A></li>
	<LI>Next message: <A HREF="020998.html">[rabbitmq-discuss] Issue in creating a RabbitMQ Cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20996">[ date ]</a>
              <a href="thread.html#20996">[ thread ]</a>
              <a href="subject.html#20996">[ subject ]</a>
              <a href="author.html#20996">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
