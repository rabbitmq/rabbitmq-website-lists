<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Lockup in QueueDeclare()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lockup%20in%20QueueDeclare%28%29&In-Reply-To=%3Cd0bc1129-b6a1-42b9-baed-3c46b4488ad1%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021127.html">
   <LINK REL="Next"  HREF="021147.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Lockup in QueueDeclare()</H1>
    <B>Galmok</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lockup%20in%20QueueDeclare%28%29&In-Reply-To=%3Cd0bc1129-b6a1-42b9-baed-3c46b4488ad1%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Lockup in QueueDeclare()">galmok at gmail.com
       </A><BR>
    <I>Mon Jul  9 15:25:29 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021127.html">[rabbitmq-discuss] rabbitmq server slows down for cluster set	up - (multiple stop_app scenario)
</A></li>
        <LI>Next message: <A HREF="021147.html">[rabbitmq-discuss] Lockup in QueueDeclare()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21138">[ date ]</a>
              <a href="thread.html#21138">[ thread ]</a>
              <a href="subject.html#21138">[ subject ]</a>
              <a href="author.html#21138">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have an issue with QueueDeclare locking up on me. It works fine for the 
most part, but eventually, it locks up (no error, just doesn't return). I 
have tried to find out where it happens and this is the spot:

When running:

channel.QueueDeclare()

RabbitMQ enters an idle state at the line marked below:

namespace RabbitMQ.Client.Impl
{
    public class SimpleBlockingRpcContinuation : IRpcContinuation
    {
        public virtual Command GetReply()
        {
====&gt;&gt;&gt;     Either result = (Either)m_cell.Value;
            switch (result.Alternative)
...

Now, I call QueueDeclare() from a callback created like this (I receive a 
message from AMQP and create/bind to a new queue):

        public string subscribe(string routingKey, BasicDeliverEventHandler 
e )
        {
            lock (channel)
            {
                string queueName = channel.QueueDeclare();
                EventingBasicConsumer consumer = new 
EventingBasicConsumer();
                consumer.Received += e;
                string consumerTag = channel.BasicConsume(queueName, true, 
consumer); // true; noAck
                channel.QueueBind(queueName, ExchangeName, routingKey);
                return queueName;
            }
        }

Is it not allowed to create/bind to a new queue when being called from this 
callback? Can I avoid the lockup somehow?

I use 'lock' to avoid triggering the non-multithread safe .NET 
implementation. Could this be an issue here?

Any hints would be nice here.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/5f9594c6/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20120709/5f9594c6/attachment.htm</A>&gt;
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021127.html">[rabbitmq-discuss] rabbitmq server slows down for cluster set	up - (multiple stop_app scenario)
</A></li>
	<LI>Next message: <A HREF="021147.html">[rabbitmq-discuss] Lockup in QueueDeclare()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21138">[ date ]</a>
              <a href="thread.html#21138">[ thread ]</a>
              <a href="subject.html#21138">[ subject ]</a>
              <a href="author.html#21138">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
