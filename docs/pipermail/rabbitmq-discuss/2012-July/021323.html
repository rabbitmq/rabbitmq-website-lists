<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] building system architecture
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20building%20system%20architecture&In-Reply-To=%3C87r4sapjtf.wl%25francesco%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021242.html">
   <LINK REL="Next"  HREF="021331.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] building system architecture</H1>
    <B>Francesco Mazzoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20building%20system%20architecture&In-Reply-To=%3C87r4sapjtf.wl%25francesco%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] building system architecture">francesco at rabbitmq.com
       </A><BR>
    <I>Tue Jul 17 15:02:20 BST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="021242.html">[rabbitmq-discuss] building system architecture
</A></li>
        <LI>Next message: <A HREF="021331.html">[rabbitmq-discuss] building system architecture
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21323">[ date ]</a>
              <a href="thread.html#21323">[ thread ]</a>
              <a href="subject.html#21323">[ subject ]</a>
              <a href="author.html#21323">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Anton,

At Fri, 13 Jul 2012 12:32:33 +0400,
Anton Kirilenko wrote:
&gt;<i> 1) Every building client can process its task for an hour or more. Is it 
</I>&gt;<i> correct to send ACK only after the building is done?
</I>
That should not pose any particular problem, unless you have a considerable
amount of acks piling up and thus occupying memory on the broker.

&gt;<i> 2) Now I've got one queue for each combination of building platform and
</I>&gt;<i> architecture. Lots of client consume from it. But I need a task scheduling
</I>&gt;<i> mechanism (send all the task to queue when we get them is not a good idea),
</I>&gt;<i> ability to stop building... It looks like I need separate queue for every
</I>&gt;<i> client (it can be exclusive consumer for every queue).  Is it possible to
</I>&gt;<i> configure RabbitMQ to close the queue and notify building server (that have
</I>&gt;<i> sent the message) about it?
</I>
Check the `auto-delete' field in the AMQP `queue.declare' method. I am not sure
what you mean with &quot;notifying the building server&quot;.

If you mean that you want to notify the publisher when the queue the published
on has been deleted, then you can't do that - the publisher has no knowledge
about which queue(s) he's publishing in anyway. In general the only messages
you'll get from the broker to a publisher are return messages after a publish.

You can, however, be notified if the message you are publishing could not be
routed using the `mandatory' flag.

You can also be notified on the consumer side about queue deletion, see
<A HREF="http://www.rabbitmq.com/extensions.html#consumer-cancel-notify">http://www.rabbitmq.com/extensions.html#consumer-cancel-notify</A> .

&gt;<i> The important thing: it's very bad for the system to loose building 
</I>&gt;<i> tasks. In case of client failure RabbitMQ should notify server,
</I>
As said before, publishers and consumers are very decoupled, so this is not
possible.

&gt;<i> in case of RabbitMQ failure (or connection failure) server should know that
</I>&gt;<i> the task was not processed well and resend it to another client.
</I>
It seems here that you are referring to RabbitMQ and &quot;server&quot; as different
entities, when they are the same thing.

In any case, you can have strong guarantees about the delivery of messages, for
example using durable queues and publisher confirms:
<A HREF="http://www.rabbitmq.com/extensions.html#publishing">http://www.rabbitmq.com/extensions.html#publishing</A> .

&gt;<i> In other words - after building server have sent the message, it should be
</I>&gt;<i> notified if the task was not (and will never be) processed.
</I>
Again it's not clear to me what you mean here. It seems to me that a
one-queue-per-client solution with publisher confirms would suffice in your
case. You have strong guarantees against the loss of messages, and you can ack
the messages once you've finished building. If rabbit fails, you know that the
messages are persisted and thus they won't be lost. If the consumer fails, the
messages pending acks will be redelivered to the next consumer (with a
`redeliver' flag to indicate that the messages was sent before).

--
Francesco * Often in error, never in doubt
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021242.html">[rabbitmq-discuss] building system architecture
</A></li>
	<LI>Next message: <A HREF="021331.html">[rabbitmq-discuss] building system architecture
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21323">[ date ]</a>
              <a href="thread.html#21323">[ thread ]</a>
              <a href="subject.html#21323">[ subject ]</a>
              <a href="author.html#21323">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
