<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20crashes%20hard%20when%20it%20runs%20out%20of%0A%20memory&In-Reply-To=4d376de30911061257p163ac74eh31f82d0f4e74a19%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005378.html">
   <LINK REL="Next"  HREF="005343.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ crashes hard when it runs out of memory</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20crashes%20hard%20when%20it%20runs%20out%20of%0A%20memory&In-Reply-To=4d376de30911061257p163ac74eh31f82d0f4e74a19%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ crashes hard when it runs out of memory">matthew at lshift.net
       </A><BR>
    <I>Wed Nov 11 11:32:31 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005378.html">[rabbitmq-discuss] RabbitMQ crashes hard when it runs out of	memory
</A></li>
        <LI>Next message: <A HREF="005343.html">[rabbitmq-discuss] auto_delete queues not going away
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5424">[ date ]</a>
              <a href="thread.html#5424">[ thread ]</a>
              <a href="subject.html#5424">[ subject ]</a>
              <a href="author.html#5424">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Steve,

On Fri, Nov 06, 2009 at 12:57:33PM -0800, Stephen Day wrote:
&gt;<i> On Fri, Nov 6, 2009 at 2:43 AM, Matthew Sackman &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at lshift.net</A>&gt; wrote:
</I>&gt;<i> However, with rabbit's current memory problems, I wouldn't run it with more
</I>&gt;<i> than 10 queues, let alone millions ;). I will give the java client test a
</I>&gt;<i> try.
</I>
Queues themselves don't take much memory - it's just a process and a
little state. I'm seeing about 35KB for a queue with nothing in it. It's
the number and size of messages that are the issue. We tend to encourage
users to make sure that the bottleneck is at the producing side, not the
consuming side, to prevent queues growing much in Rabbit. In such a
setup, many thousands of queues is very possible. However, people using
Rabbit as a buffering / decoupling mechanism to cope with load spikes
between different systems is a very common and important use case and
this should get much much better once the new resource management and
persister finally lands.

&gt;<i> This was my initial thought as well. However, by the time the alarm goes
</I>&gt;<i> off, it is often too late for this to stop rabbit from crashing. For
</I>&gt;<i> example, the default memory alarm is set to 0.95.
</I>
Right, but it's not hardcoded at 0.95. Feel free to lower it
substantially.

&gt;<i> I would say the correct pattern would be something like python's MemoryError
</I>&gt;<i> or handling of a malloc failure in C. Is there an exception that is thrown,
</I>&gt;<i> where a garbage collect can be run?
</I>
Sure, but what exactly can you do in that situation? The malloc is
failing during a GC run, because of the generational copying GC, so it
doesn't really make much difference whether you catch the exception or
not - you still can't allocate new memory, which makes life somewhat
challenging, especially in the middle of a GC run, where processes are
suspended.

Our resource management is getting much better, and is something we're
working hard on improving. Sadly though, we're not going to give out
ETAs only to break them, though we understand how fun that is for all ;)

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005378.html">[rabbitmq-discuss] RabbitMQ crashes hard when it runs out of	memory
</A></li>
	<LI>Next message: <A HREF="005343.html">[rabbitmq-discuss] auto_delete queues not going away
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5424">[ date ]</a>
              <a href="thread.html#5424">[ thread ]</a>
              <a href="subject.html#5424">[ subject ]</a>
              <a href="author.html#5424">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
