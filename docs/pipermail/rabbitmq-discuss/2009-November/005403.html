<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] intermittent erl.exe crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20intermittent%20erl.exe%20crash&In-Reply-To=000601ca5f2d%24d59e7860%2480db6920%24%40com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005379.html">
   <LINK REL="Next"  HREF="005422.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] intermittent erl.exe crash</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20intermittent%20erl.exe%20crash&In-Reply-To=000601ca5f2d%24d59e7860%2480db6920%24%40com"
       TITLE="[rabbitmq-discuss] intermittent erl.exe crash">matthew at lshift.net
       </A><BR>
    <I>Tue Nov 10 15:12:25 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005379.html">[rabbitmq-discuss] intermittent erl.exe crash
</A></li>
        <LI>Next message: <A HREF="005422.html">[rabbitmq-discuss] intermittent erl.exe crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5403">[ date ]</a>
              <a href="thread.html#5403">[ thread ]</a>
              <a href="subject.html#5403">[ subject ]</a>
              <a href="author.html#5403">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Nov 06, 2009 at 02:09:38PM -0800, JD Conley wrote:
&gt;<i> It seems like it ran out of memory. How much memory overhead is there per
</I>&gt;<i> queue/stored message? I might need to make my timeout sweeping more
</I>&gt;<i> aggressive, or bring up more instances.
</I>
It entirely depends on the size of the messages. Also note that until
you ack a message explicitly, or set the NoAck option on consumption,
Rabbit will not forget about messages.

&gt;<i> Or, more likely, my queue configuration or consuming code is wrong and my
</I>&gt;<i> messages are being stored forever in memory causing the memory leak. Here
</I>&gt;<i> are some c# snippets:
</I>&gt;<i> 
</I>&gt;<i> //start consuming
</I>&gt;<i> _model.QueueDeclare(userQueue, false, false, false, false, false, null);
</I>&gt;<i> consumerTag = _model.BasicConsume(userQueue, true, null, _consumer);
</I>
Ok, you're setting noAck true, so you shouldn't need to ack explicitly.

&gt;<i> //publish message
</I>&gt;<i> var props = _model.CreateBasicProperties();
</I>&gt;<i> props.Expiration = &quot;5000&quot;; //is this right? desired expiration time is 5
</I>&gt;<i> seconds.
</I>&gt;<i> _model.BasicPublish(_exchange, key, false, false, props, body);
</I>
Expiration is not implemented. There is no notion of Time To Live or
messages expiring in RabbitMQ. This is an oft requested feature and is
high on our todo list, but is not in active development yet.

&gt;<i> Crash dump was written to: erl_crash.dump
</I>&gt;<i> temp_alloc: Cannot allocate 9176036 bytes of memory (of type &quot;tmp_heap&quot;).
</I>
Err, that's odd, that's only about 8MB of RAM. How much RAM do you have
in this machine that's available to Rabbit? Also, before it crashes,
run:
rabbitmqctl list_queues name messages messages_unacknowledged memory

as that might give you some more information.

Matthew


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005379.html">[rabbitmq-discuss] intermittent erl.exe crash
</A></li>
	<LI>Next message: <A HREF="005422.html">[rabbitmq-discuss] intermittent erl.exe crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5403">[ date ]</a>
              <a href="thread.html#5403">[ thread ]</a>
              <a href="subject.html#5403">[ subject ]</a>
              <a href="author.html#5403">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
