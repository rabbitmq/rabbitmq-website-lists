<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] intermittent erl.exe crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20intermittent%20erl.exe%20crash&In-Reply-To=01bf01ca5e47%2467c0d4a0%2437427de0%24%40com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005332.html">
   <LINK REL="Next"  HREF="005336.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] intermittent erl.exe crash</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20intermittent%20erl.exe%20crash&In-Reply-To=01bf01ca5e47%2467c0d4a0%2437427de0%24%40com"
       TITLE="[rabbitmq-discuss] intermittent erl.exe crash">matthias at lshift.net
       </A><BR>
    <I>Thu Nov  5 19:29:48 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005332.html">[rabbitmq-discuss] intermittent erl.exe crash
</A></li>
        <LI>Next message: <A HREF="005336.html">[rabbitmq-discuss] intermittent erl.exe crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5333">[ date ]</a>
              <a href="thread.html#5333">[ thread ]</a>
              <a href="subject.html#5333">[ subject ]</a>
              <a href="author.html#5333">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>JD,

JD Conley wrote:
&gt;&gt;<i> Why are your clients trying to unbind non-existing bindings?
</I>&gt;<i> 
</I>&gt;<i> They don't know the bindings are non-existent since the queues/exchange in
</I>&gt;<i> question aren't durable and, say, a server might crash and restart.
</I>
Rabbit doesn't usually crash ;)

&gt;<i> I persist the list of currently bound routing keys in a database and a
</I>&gt;<i> binding will usually last a few minutes before it is unbound. There is a
</I>&gt;<i> background cleanup process that runs and removes bindings and destroys
</I>&gt;<i> queues after users haven't polled in a while.
</I>&gt;<i> 
</I>&gt;<i> If there's a better way to do something like this, I'm open to suggestion.
</I>
I think what you are doing is fine. One possible improvement is to 
(re)declare the queues/bindings just before attempting to delete them. 
It's a cheap operation for the server if the entities do exist already - 
which is the common case - and it prevents the errors when they don't.

One possible extension of RabbitMQ could allow queues to have a 
&quot;automatically delete if idle for longer than X&quot; setting. That would 
actually be quite easy to implement and is a natural extension of the 
existing exclusivity and auto-delete flags. Would that work for you or 
do you actually need an idle timeout for *bindings*? Those would be a 
lot harder to implement.

&gt;&gt;<i> The AMQP spec requires that this results in an error.
</I>&gt;<i> 
</I>&gt;<i> That's fine, but that doesn't seem critical enough for the connection to
</I>&gt;<i> have to drop.
</I>
Actually, not_found (404) is defined to be *soft* error, which means it 
only closes the channel, not the connection. So I suspect your 
application code is tripping over the channel error and causing the 
connection to close.

&gt;<i> As a newcomer in the space, it's ironic to me that I can declare
</I>&gt;<i> duplicate queues and exchanges without any errors but not silently 
</I>&gt;<i> remove a binding that doesn't exist.
</I>
Declaration is an assertion of existence, and hence is idempotent - you 
can assert the existence of something as many times as you like; you 
cannot create duplicates. Now, deletion/unbind should really be an 
assertion of non-existence and hence be idempotent too, but 
unfortunately it isn't. One day that will hopefully get fixed in the 
protocol spec.

&gt;<i> It would be great if it were an option to behave like the .NET
</I>&gt;<i> generic Dictionary that returns 'true' on remove if there was
</I>&gt;<i> actually something there, or silently ignores the call and returns 
</I>&gt;<i> 'false' if not. Is there a DoesBindingExist method I can use to do
</I>&gt;<i> things cleanly today? I didn't see one.
</I>
There is no such mechanism. Ideally the protocol would allow the listing 
of existing entities. RabbitMQ currently allows that via the 
'rabbitmqctl list_*' commands, but that is outside the protocol and not 
designed for high rates of execution.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005332.html">[rabbitmq-discuss] intermittent erl.exe crash
</A></li>
	<LI>Next message: <A HREF="005336.html">[rabbitmq-discuss] intermittent erl.exe crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5333">[ date ]</a>
              <a href="thread.html#5333">[ thread ]</a>
              <a href="subject.html#5333">[ subject ]</a>
              <a href="author.html#5333">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
