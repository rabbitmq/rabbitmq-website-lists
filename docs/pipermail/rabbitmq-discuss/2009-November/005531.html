<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Slow throughput on consume side using java	client API
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Slow%20throughput%20on%20consume%20side%20using%20java%0A%09client%20API&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005538.html">
   <LINK REL="Next"  HREF="005534.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Slow throughput on consume side using java	client API</H1>
    <B>scott w</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Slow%20throughput%20on%20consume%20side%20using%20java%0A%09client%20API&In-Reply-To="
       TITLE="[rabbitmq-discuss] Slow throughput on consume side using java	client API">scottblanc at gmail.com
       </A><BR>
    <I>Thu Nov 26 01:19:25 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005538.html">[rabbitmq-discuss] Re-declaring named exchange with passive	argument set to true
</A></li>
        <LI>Next message: <A HREF="005534.html">[rabbitmq-discuss] Slow throughput on consume side using java client API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5531">[ date ]</a>
              <a href="thread.html#5531">[ thread ]</a>
              <a href="subject.html#5531">[ subject ]</a>
              <a href="author.html#5531">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm not seeing the expected throughput on the consume side of things using
the Java client API and looking for some suggestions. The way I've set up my
tests I create N=25 channels/queue consumers for a single queue (according
to the java api docs you can't have more than one thread on a given channel
at once) and then I have 50 threads that fill up the queue (publish
throughput is fine) and then another 50 threads which pull from the queue. I
synchronize on the channels and each thread uses round robin to to select a
channel and queue consumer pair and uses that to do the consume and ack. But
even after some twiddling I am not able to get beyond 50 reads per sec which
is less than 10x what I am seeing on the publish side. Below is what the key
code looks like. Any suggestions for what may be causing the slowness?

thanks,
Scott

Here is the consume code looks like:

    Integer channelNum = pickRandomChannel();
    Channel channel = getChannel( channelNum );
    QueueingConsumer consumer = getConsumer( channelNum );
    synchronized (getChannel( channelNum )) {
      try {
        channel.basicConsume( getQueueName(), noAck, consumer ); //noAck =
false here
      } catch (IOException e) {
        logger.warn( &quot;Exception when consuming message from queue: &quot; +
getQueueName(), e );
      }
      try {
        QueueingConsumer.Delivery delivery = consumer.nextDelivery(
this.defaultTimeout );
        if (delivery == null) {
          return null;
        }
        return delivery.getBody()
      } catch (InterruptedException ie) {
        logger.warn( &quot;Interruped exception on next delivery&quot;, ie );
        return null;
      }
    }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091125/c041d734/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091125/c041d734/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005538.html">[rabbitmq-discuss] Re-declaring named exchange with passive	argument set to true
</A></li>
	<LI>Next message: <A HREF="005534.html">[rabbitmq-discuss] Slow throughput on consume side using java client API
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5531">[ date ]</a>
              <a href="thread.html#5531">[ thread ]</a>
              <a href="subject.html#5531">[ subject ]</a>
              <a href="author.html#5531">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
