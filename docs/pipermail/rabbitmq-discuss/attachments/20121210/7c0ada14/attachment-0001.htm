<tt>
When&nbsp;using&nbsp;publisher&nbsp;confirms&nbsp;with&nbsp;the&nbsp;C#&nbsp;code,&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;client&nbsp;when&nbsp;experiencing&nbsp;any&nbsp;significant&nbsp;load.&nbsp;&amp;nbsp;The&nbsp;offending&nbsp;code&nbsp;is&nbsp;in&nbsp;the&nbsp;client&nbsp;&quot;RabbitMQ.Client.Impl.ModelBase&quot;&nbsp;class&nbsp;in&nbsp;the&nbsp;&quot;BasicPublish&quot;&nbsp;method.&nbsp;&amp;nbsp;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;(m_nextPubSeqNo&nbsp;&amp;gt;&nbsp;0)&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;m_unconfirmedSet.&lt;b&gt;Add&lt;/b&gt;(m_nextPubSeqNo,&nbsp;null);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;m_nextPubSeqNo++;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;looks&nbsp;like&nbsp;there&nbsp;are&nbsp;multiple&nbsp;threads&nbsp;hitting&nbsp;the&nbsp;bolded&nbsp;&quot;&lt;b&gt;Add&lt;/b&gt;&quot;&nbsp;method&nbsp;before&nbsp;the&nbsp;sequence&nbsp;number&nbsp;is&nbsp;incremented&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;leading&nbsp;to&nbsp;duplicate&nbsp;key&nbsp;exceptions&nbsp;being&nbsp;thrown&nbsp;by&nbsp;the&nbsp;&quot;m_unconfirmedSet&quot;&nbsp;sorted&nbsp;list.&nbsp;&amp;nbsp;&amp;nbsp;This&nbsp;code&nbsp;either&nbsp;needs&nbsp;to&nbsp;have&nbsp;a&nbsp;lock&nbsp;around&nbsp;it&nbsp;or&nbsp;have&nbsp;m_nextPubSeqNo&nbsp;change&nbsp;to&nbsp;a&nbsp;long&nbsp;so&nbsp;that&nbsp;&quot;Interlocked.Increment&quot;&nbsp;can&nbsp;be&nbsp;used&nbsp;in&nbsp;the&nbsp;assignment.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
