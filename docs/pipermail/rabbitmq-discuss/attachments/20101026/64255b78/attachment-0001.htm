<tt>
&lt;html&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;font-family:times&nbsp;new&nbsp;roman,&nbsp;new&nbsp;york,&nbsp;times,&nbsp;serif;font-size:12pt&quot;&gt;&lt;div&gt;&lt;span&gt;Matthias,&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;times&nbsp;new&nbsp;roman,new&nbsp;york,times,serif;&quot;&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;font-family:&nbsp;times&nbsp;new&nbsp;roman,new&nbsp;york,times,serif;&quot;&gt;&lt;br&gt;&amp;gt;&nbsp;have&nbsp;you&nbsp;had&nbsp;a&nbsp;chance&nbsp;to&nbsp;run&nbsp;your&nbsp;tests&nbsp;against&nbsp;the&nbsp;latest&nbsp;(2.1.1)&nbsp;broker&nbsp;release?&nbsp;We&nbsp;fixed&nbsp;an&nbsp;excessive&nbsp;queue&nbsp;memory&nbsp;usage&nbsp;bug&nbsp;&amp;gt;&nbsp;in&nbsp;that&nbsp;release,&nbsp;which&nbsp;might&nbsp;well&nbsp;have&nbsp;been&nbsp;the&nbsp;cause&nbsp;of&nbsp;the&nbsp;problems&nbsp;you&nbsp;were&nbsp;seeing.&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;reminding&nbsp;me!&lt;br&gt;I&nbsp;tested&nbsp;2.1.1&nbsp;release&nbsp;today&nbsp;with&nbsp;1000&nbsp;queues.&amp;nbsp;&nbsp;When&nbsp;the&nbsp;message&nbsp;store&nbsp;reached&nbsp;120&nbsp;GB,&nbsp;the&nbsp;broker's&nbsp;memory&nbsp;reached&nbsp;4GB&nbsp;and&nbsp;started&nbsp;to&nbsp;slow&nbsp;down&nbsp;the&nbsp;publishers.&amp;nbsp;&nbsp;Publish&nbsp;rate&nbsp;dropped&nbsp;from&nbsp;80&nbsp;MB/sec&nbsp;to&nbsp;less&nbsp;than&nbsp;1&nbsp;MB/sec.&amp;nbsp;&nbsp;The&nbsp;memory&nbsp;stayed&nbsp;around&nbsp;4GB&nbsp;for&nbsp;long&nbsp;time.&amp;nbsp;&nbsp;If&nbsp;I&nbsp;stopped&nbsp;the&nbsp;publishers,&nbsp;the&nbsp;memory&nbsp;would&nbsp;drop&nbsp;to&nbsp;2.8&nbsp;GB.&amp;nbsp;&nbsp;However,&nbsp;as&nbsp;soon&nbsp;as&nbsp;i&nbsp;started&nbsp;the&nbsp;publishers&nbsp;again,&nbsp;memory<br>
&nbsp;would&nbsp;reach&nbsp;4GB&nbsp;again&nbsp;and&nbsp;the&nbsp;publish&nbsp;rate&nbsp;dropped&nbsp;significantly.&lt;br&gt;&lt;br&gt;I&nbsp;tried&nbsp;to&nbsp;change&nbsp;the&nbsp;memory&nbsp;threshold&nbsp;from&nbsp;0.4&nbsp;to&nbsp;0.7,&nbsp;and&nbsp;restarted&nbsp;the&nbsp;broker.&amp;nbsp;&nbsp;Howerver,&nbsp;the&nbsp;log&nbsp;showed&nbsp;that&nbsp;the&nbsp;broker's&nbsp;memory&nbsp;limit&nbsp;is&nbsp;3.2&nbsp;GB&nbsp;(our&nbsp;machine&nbsp;has&nbsp;8&nbsp;GB&nbsp;&lt;span&nbsp;style=&quot;font-family:&nbsp;times&nbsp;new&nbsp;roman,new&nbsp;york,times,serif;&quot;&nbsp;class=&quot;tab&quot;&gt;&amp;nbsp;&nbsp;RAM).&amp;nbsp;&nbsp;It&nbsp;seems&nbsp;to&nbsp;me&nbsp;release&nbsp;2.1.1&nbsp;would&nbsp;not&nbsp;allow&nbsp;the&nbsp;broker&nbsp;to&nbsp;use&nbsp;more&nbsp;than&nbsp;0.4&nbsp;of&nbsp;the&nbsp;total&nbsp;RAM.&amp;nbsp;&nbsp;I&nbsp;remember&nbsp;with&nbsp;2.0.0,&nbsp;I&nbsp;could&nbsp;set&nbsp;the&nbsp;memory&nbsp;threshold&nbsp;to&nbsp;0.7&nbsp;and&nbsp;the&nbsp;broker's&nbsp;memory&nbsp;would&nbsp;reach&nbsp;10&nbsp;GB&nbsp;with&nbsp;120&nbsp;GB&nbsp;message&nbsp;stored.&amp;nbsp;&nbsp;the&nbsp;publish&nbsp;rate&nbsp;was&nbsp;higher&nbsp;than&nbsp;2.1.1&nbsp;under&nbsp;this&nbsp;condition.&lt;br&gt;&lt;br&gt;BTW,&nbsp;we&nbsp;are&nbsp;using&nbsp;erlang&nbsp;R14A,&nbsp;because&nbsp;it&nbsp;uses&nbsp;200%&nbsp;of&nbsp;the&nbsp;CPU&nbsp;(8&nbsp;core)&nbsp;comparing&nbsp;to&nbsp;680%&nbsp;for&nbsp;R13B&nbsp;with&nbsp;our&nbsp;test&nbsp;cases.&lt;br&gt;the&nbsp;2.1.1&nbsp;release&nbsp;has&nbsp;build&nbsp;error&nbsp;from&nbsp;rabbitmq_ssl.erl.&amp;nbsp;&nbsp;I&nbsp;commented&nbsp;out&nbsp;&quot;-include(ssl/src/ssl_int.hrl)&quot;&nbsp;to&nbsp;make&nbsp;it&nbsp;work.&lt;br&gt;i&nbsp;will&nbsp;test&nbsp;R14B&nbsp;tomorrow.&lt;br&gt;&lt;br&gt;thanks.&lt;br&gt;&lt;br&gt;&lt;span<br>
&nbsp;style=&quot;font-family:&nbsp;times&nbsp;new&nbsp;roman,new&nbsp;york,times,serif;&quot;&nbsp;class=&quot;tab&quot;&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;-alex&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;&lt;/html&gt;
</tt>
