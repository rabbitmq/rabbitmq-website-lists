<tt>
I&nbsp;can&amp;#39;t&nbsp;tell&nbsp;you&nbsp;why&nbsp;its&nbsp;hanging,&nbsp;but&nbsp;in&nbsp;general&nbsp;when&nbsp;a&nbsp;channel&nbsp;throws&nbsp;an&nbsp;exception,&nbsp;the&nbsp;channel&nbsp;is&nbsp;closed&nbsp;(its&nbsp;how&nbsp;the&nbsp;AMQP&nbsp;protocol&nbsp;works).&nbsp; Trying&nbsp;to&nbsp;use&nbsp;the&nbsp;channel&nbsp;after&nbsp;a&nbsp;channel&nbsp;exception&nbsp;(or&nbsp;any&nbsp;closed&nbsp;channel)&nbsp;will&nbsp;result&nbsp;in&nbsp;connection&nbsp;exception&nbsp;which&nbsp;will&nbsp;shut&nbsp;down&nbsp;the&nbsp;entire&nbsp;connection.&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;-Alan&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Mar&nbsp;28,&nbsp;2012&nbsp;at&nbsp;2:04&nbsp;PM,&nbsp;Matt&nbsp;Pietrek&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mpietrek@skytap.com&quot;&gt;mpietrek@skytap.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Following&nbsp;up&nbsp;on&nbsp;this&nbsp;problem,&nbsp;I&amp;#39;ve&nbsp;narrowed&nbsp;the&nbsp;issue&nbsp;down&nbsp;to&nbsp;a&nbsp;trivial&nbsp;example&nbsp;that&nbsp;hangs:&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;import&nbsp;pika&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;HOSTNAME&nbsp;=&nbsp;&amp;quot;192.168.78.18&amp;quot; &nbsp;#&nbsp;Plug&nbsp;in&nbsp;your&nbsp;own&nbsp;server&nbsp;name&nbsp;here.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;if&nbsp;__name__&nbsp;==&nbsp;&amp;#39;__main__&amp;#39;:&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;connection&nbsp;=&nbsp;pika.BlockingConnection(pika.ConnectionParameters(host=HOSTNAME,&nbsp;port=5672))&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;channel&nbsp;=&nbsp;connection.channel()&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;try:&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;       &nbsp;method_frame,&nbsp;_,&nbsp;body&nbsp;=&nbsp;channel.basic_get(queue=&amp;quot;NotAValidQueue&amp;quot;)&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;except&nbsp;Exception&nbsp;as&nbsp;e:&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;       &nbsp;print&nbsp;&amp;quot;channel.basic_get&nbsp;threw&nbsp;%s&nbsp;-&nbsp;This&nbsp;is&nbsp;expected&amp;quot;&nbsp;%&nbsp;(e)&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;else:&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;       &nbsp;print&nbsp;&amp;quot;channel.basic_get&nbsp;unexpectedly&nbsp;did&nbsp;not&nbsp;throw&nbsp;an&nbsp;exception.&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;print&nbsp;&amp;quot;Before&nbsp;channel.tx_select&nbsp;-&nbsp;Will&nbsp;hang&nbsp;on&nbsp;next&nbsp;line.&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;channel.tx_select()&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;print&nbsp;&amp;quot;After&nbsp;channel.tx_select&nbsp;-&nbsp;Unexpectedly&nbsp;got&nbsp;here.&amp;quot;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;br&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;   &nbsp;channel.tx_commit()&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;<br>
&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Mar&nbsp;27,&nbsp;2012&nbsp;at&nbsp;4:54&nbsp;PM,&nbsp;Matt&nbsp;Pietrek&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mpietrek@skytap.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mpietrek@skytap.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;style=&quot;font-size:14px;font-family:Calibri,sans-serif;word-wrap:break-word&quot;&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;Pika&nbsp;0.9.5.&nbsp;app&nbsp;communicating&nbsp;with&nbsp;a&nbsp;2.81&nbsp;rabbitmq-server&nbsp;instance.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;noticing&nbsp;some&nbsp;odd&nbsp;behavior,&nbsp;and&nbsp;am&nbsp;not&nbsp;sure&nbsp;if&nbsp;it&amp;#39;s&nbsp;a&nbsp;problem&nbsp;on&nbsp;my&nbsp;end,&nbsp;on&nbsp;rabbitmq&amp;#39;s&nbsp;end,&nbsp;or&nbsp;in&nbsp;Pika.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;At&nbsp;it&amp;#39;s&nbsp;simplest,&nbsp;I&amp;#39;m&nbsp;seeing&nbsp;a&nbsp;call&nbsp;to&nbsp;channel.tx_select()&nbsp;hang.&nbsp;Breaking&nbsp;in&nbsp;with&nbsp;the&nbsp;debugger,&nbsp;the&nbsp;stack&nbsp;looks&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;_handle_read&nbsp;[base_connection.py:151]&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;process_data_events&nbsp;[blocking_connection.py:94]&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;send_method&nbsp;[blocking_connection.py:244]&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;rpc&nbsp;[blocking_connection.py:216]&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;tx_select&nbsp;[spec.py:2615]&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Stepping&nbsp;for&nbsp;a&nbsp;bit,&nbsp;I&nbsp;see&nbsp;that&nbsp;the&nbsp;code&nbsp;never&nbsp;gets&nbsp;out&nbsp;of&nbsp;the&nbsp;loop&nbsp;in&nbsp;the&nbsp;send_method()&nbsp;function.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;In&nbsp;ordinary&nbsp;circumstances,&nbsp;my&nbsp;code&nbsp;that&nbsp;calls&nbsp;tx_select()&nbsp;works&nbsp;fine.&nbsp;However,&nbsp;in&nbsp;the&nbsp;case&nbsp;where&nbsp;it&nbsp;hangs,&nbsp;an&nbsp;immediately&nbsp;prior&nbsp;call&nbsp;to&nbsp;channel.basic_get()&nbsp;has&nbsp;thrown&nbsp;an&nbsp;exception:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;#39;pika.exceptions.AMQPChannelError&amp;#39;&amp;gt;:(404,&nbsp;&amp;quot;NOT_FOUND&nbsp;-&nbsp;no&nbsp;queue&nbsp;&amp;#39;foobar&amp;#39;&nbsp;in&nbsp;vhost&nbsp;&amp;#39;/&amp;#39;&amp;quot;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;baffled.&nbsp;Known&nbsp;issue?&nbsp;Something&nbsp;I&amp;#39;m&nbsp;doing&nbsp;wrong?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Matt&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
