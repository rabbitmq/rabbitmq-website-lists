<tt>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;I'll&nbsp;take&nbsp;a&nbsp;look&nbsp;shortly,&nbsp;mind&nbsp;opening&nbsp;a&nbsp;issue&nbsp;on&nbsp;github&nbsp;for&nbsp;me&nbsp;to&nbsp;track&nbsp;with?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&nbsp;style=&quot;color:&nbsp;#a0a0a0;&quot;&gt;On&nbsp;Thursday,&nbsp;July&nbsp;28,&nbsp;2011&nbsp;at&nbsp;7:04&nbsp;PM,&nbsp;Christian&nbsp;Haintz&nbsp;wrote:&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;border-left-style:solid;border-width:1px;margin-left:0px;padding-left:10px;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;&lt;div&gt;&lt;div&gt;On&nbsp;29/7/11&nbsp;24:54,&nbsp;Gavin&nbsp;M.&nbsp;Roy&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;br&gt;On&nbsp;Thursday,&nbsp;July&nbsp;28,&nbsp;2011&nbsp;at&nbsp;6:45&nbsp;PM,&nbsp;Christian&nbsp;Haintz&nbsp;wrote:&lt;br&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;br&gt;I&nbsp;want&nbsp;to&nbsp;stop&nbsp;the&nbsp;consuming&nbsp;loop&nbsp;of&nbsp;a&nbsp;BlockingConnection&nbsp;after&nbsp;some&lt;br&gt;timeout.&nbsp;I&nbsp;used&nbsp;the&nbsp;following&nbsp;code.&nbsp;Producer&nbsp;is&nbsp;not&nbsp;running&nbsp;because&nbsp;I&lt;br&gt;want&nbsp;to&nbsp;simulate&nbsp;the&nbsp;timeout.&nbsp;Current&nbsp;pika&nbsp;version&nbsp;is&nbsp;used&nbsp;from&nbsp;github.&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;I'd&nbsp;not&nbsp;consider&nbsp;the&nbsp;master&nbsp;branch&nbsp;on&nbsp;Pika&nbsp;stable,&nbsp;which&nbsp;is&nbsp;one&nbsp;of&nbsp;the&lt;br&gt;reasons&nbsp;I've&nbsp;not&nbsp;tagged&nbsp;0.9.6.&nbsp;I'd&nbsp;do&nbsp;a&nbsp;pip&nbsp;install&nbsp;of&nbsp;0.9.5&nbsp;and&nbsp;see&nbsp;if&lt;br&gt;that&nbsp;solves&nbsp;your&nbsp;problem.&lt;br&gt;&lt;br&gt;Gavin&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;I&nbsp;tried&nbsp;it&nbsp;first&nbsp;with&nbsp;0.9.5&nbsp;but&nbsp;that&nbsp;leads&nbsp;to&nbsp;a&nbsp;different&nbsp;error&nbsp;which&nbsp;&lt;br&gt;seams&nbsp;to&nbsp;be&nbsp;fixed&nbsp;in&nbsp;the&nbsp;master&nbsp;branch&nbsp;(used&nbsp;the&nbsp;same&nbsp;test&nbsp;code&nbsp;as&nbsp;in&nbsp;&lt;br&gt;the&nbsp;previous&nbsp;e-mail):&lt;br&gt;&lt;br&gt;--------8&amp;lt;---------&nbsp;snip&nbsp;----------8&amp;lt;-----------&lt;br&gt;python&nbsp;pika_test.py&lt;br&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt;&nbsp;&nbsp;&nbsp;File&nbsp;&quot;pika_test.py&quot;,&nbsp;line&nbsp;21,&nbsp;in&nbsp;&amp;lt;module&amp;gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.start_consuming()&lt;br&gt;&nbsp;&nbsp;&nbsp;File&nbsp;&lt;br&gt;&quot;build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py&quot;,&nbsp;&lt;br&gt;line&nbsp;293,&nbsp;in&nbsp;start_consuming&lt;br&gt;&nbsp;&nbsp;&nbsp;File&nbsp;&lt;br&gt;&quot;build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py&quot;,&nbsp;&lt;br&gt;line&nbsp;103,&nbsp;in&nbsp;process_data_events&lt;br&gt;&nbsp;&nbsp;&nbsp;File&nbsp;&lt;br&gt;&quot;build/bdist.macosx-10.6-universal/egg/pika/adapters/blocking_connection.py&quot;,&nbsp;&lt;br&gt;line&nbsp;157,&nbsp;in&nbsp;process_timeouts&lt;br&gt;NameError:&nbsp;global&nbsp;name&nbsp;'log'&nbsp;is&nbsp;not&nbsp;defined&lt;br&gt;--------8&amp;lt;-------&nbsp;snip&nbsp;end&nbsp;--------8&amp;lt;-----------&lt;br&gt;&lt;br&gt;Best&nbsp;Regards,&lt;br&gt;Christian&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;br&gt;--------8&amp;lt;---------&nbsp;snip&nbsp;----------8&amp;lt;-----------&lt;br&gt;import&nbsp;pika&lt;br&gt;connection&nbsp;=&nbsp;pika.BlockingConnection(pika.ConnectionParameters(&lt;br&gt;host='localhost'))&lt;br&gt;&lt;br&gt;channel&nbsp;=&nbsp;connection.channel()&lt;br&gt;&lt;br&gt;result&nbsp;=&nbsp;channel.queue_declare(exclusive=True)&lt;br&gt;callback_queue&nbsp;=&nbsp;result.method.queue&lt;br&gt;&lt;br&gt;def&nbsp;on_response(self,&nbsp;ch,&nbsp;method,&nbsp;props,&nbsp;body):&lt;br&gt;#do&nbsp;some&nbsp;processing&lt;br&gt;channel.stop_consuming()&lt;br&gt;&lt;br&gt;#&nbsp;normaly&nbsp;i&nbsp;do&nbsp;some&nbsp;publish&nbsp;here&nbsp;but&nbsp;that's&nbsp;not&nbsp;relevant&lt;br&gt;#&nbsp;to&nbsp;reproduce&nbsp;the&nbsp;error&lt;br&gt;&lt;br&gt;channel.basic_consume(on_response,&nbsp;no_ack=True,&lt;br&gt;queue=callback_queue)&lt;br&gt;&lt;br&gt;def&nbsp;panic():&lt;br&gt;channel.stop_consuming()&lt;br&gt;&lt;br&gt;connection.add_timeout(1,&nbsp;panic)&lt;br&gt;channel.start_consuming()&lt;br&gt;&lt;br&gt;--------8&amp;lt;-------&nbsp;snip&nbsp;end&nbsp;--------8&amp;lt;-----------&lt;br&gt;&lt;br&gt;But&nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;error:&lt;br&gt;&lt;br&gt;--------8&amp;lt;---------&nbsp;snip&nbsp;----------8&amp;lt;-----------&lt;br&gt;$&nbsp;python&nbsp;pika_test.py&lt;br&gt;/Users/christian/devel/pika/pika/callback.py:69:&nbsp;UserWarning:&lt;br&gt;CallbackManager.add:&nbsp;Duplicate&nbsp;callback&nbsp;found&nbsp;for&nbsp;&quot;1:Basic.CancelOk&quot;&lt;br&gt;(self.__class__.__name__,&nbsp;prefix,&nbsp;key))&lt;br&gt;Traceback&nbsp;(most&nbsp;recent&nbsp;call&nbsp;last):&lt;br&gt;File&nbsp;&quot;pika_test.py&quot;,&nbsp;line&nbsp;21,&nbsp;in&nbsp;&amp;lt;module&amp;gt;&lt;br&gt;channel.start_consuming()&lt;br&gt;File&lt;br&gt;&quot;/Users/christian/devel/pika/pika/adapters/blocking_connection.py&quot;,&nbsp;line&lt;br&gt;307,&nbsp;in&nbsp;start_consuming&lt;br&gt;self.transport.connection.process_data_events()&lt;br&gt;File&lt;br&gt;&quot;/Users/christian/devel/pika/pika/adapters/blocking_connection.py&quot;,&nbsp;line&lt;br&gt;104,&nbsp;in&nbsp;process_data_events&lt;br&gt;self.process_timeouts()&lt;br&gt;File&lt;br&gt;&quot;/Users/christian/devel/pika/pika/adapters/blocking_connection.py&quot;,&nbsp;line&lt;br&gt;164,&nbsp;in&nbsp;process_timeouts&lt;br&gt;self._timeouts[timeout_id]['handler']()&lt;br&gt;File&nbsp;&quot;pika_test.py&quot;,&nbsp;line&nbsp;18,&nbsp;in&nbsp;panic&lt;br&gt;channel.stop_consuming()&lt;br&gt;File&lt;br&gt;&quot;/Users/christian/devel/pika/pika/adapters/blocking_connection.py&quot;,&nbsp;line&lt;br&gt;318,&nbsp;in&nbsp;stop_consuming&lt;br&gt;self.basic_cancel(consumer_tag)&lt;br&gt;File&nbsp;&quot;/Users/christian/devel/pika/pika/channel.py&quot;,&nbsp;line&nbsp;333,&nbsp;in&lt;br&gt;basic_cancel&lt;br&gt;self._on_cancel_ok,&nbsp;[spec.Basic.CancelOk])&lt;br&gt;File&lt;br&gt;&quot;/Users/christian/devel/pika/pika/adapters/blocking_connection.py&quot;,&nbsp;line&lt;br&gt;220,&nbsp;in&nbsp;rpc&lt;br&gt;self.send_method(method,&nbsp;None,&nbsp;wait)&lt;br&gt;File&lt;br&gt;&quot;/Users/christian/devel/pika/pika/adapters/blocking_connection.py&quot;,&nbsp;line&lt;br&gt;249,&nbsp;in&nbsp;send_method&lt;br&gt;self.connection.process_data_events()&lt;br&gt;File&lt;br&gt;&quot;/Users/christian/devel/pika/pika/adapters/blocking_connection.py&quot;,&nbsp;line&lt;br&gt;104,&nbsp;in&nbsp;process_data_events&lt;br&gt;self.process_timeouts()&lt;br&gt;File&lt;br&gt;&quot;/Users/christian/devel/pika/pika/adapters/blocking_connection.py&quot;,&nbsp;line&lt;br&gt;164,&nbsp;in&nbsp;process_timeouts&lt;br&gt;self._timeouts[timeout_id]['handler']()&lt;br&gt;File&nbsp;&quot;pika_test.py&quot;,&nbsp;line&nbsp;18,&nbsp;in&nbsp;panic&lt;br&gt;channel.stop_consuming()&lt;br&gt;File&lt;br&gt;&quot;/Users/christian/devel/pika/pika/adapters/blocking_connection.py&quot;,&nbsp;line&lt;br&gt;318,&nbsp;in&nbsp;stop_consuming&lt;br&gt;self.basic_cancel(consumer_tag)&lt;br&gt;File&nbsp;&quot;/Users/christian/devel/pika/pika/channel.py&quot;,&nbsp;line&nbsp;333,&nbsp;in&lt;br&gt;basic_cancel&lt;br&gt;self._on_cancel_ok,&nbsp;[spec.Basic.CancelOk])&lt;br&gt;File&lt;br&gt;&quot;/Users/christian/devel/pika/pika/adapters/blocking_connection.py&quot;,&nbsp;line&lt;br&gt;209,&nbsp;in&nbsp;rpc&lt;br&gt;self._on_rpc_complete)&lt;br&gt;TypeError:&nbsp;'NoneType'&nbsp;object&nbsp;is&nbsp;not&nbsp;iterable&lt;br&gt;&lt;br&gt;&lt;br&gt;What&nbsp;I&nbsp;am&nbsp;doing&nbsp;wrong?&nbsp;Are&nbsp;the&nbsp;timeout&nbsp;callbacks&nbsp;not&nbsp;capable&nbsp;of&nbsp;stopping&lt;br&gt;the&nbsp;consumer?&lt;br&gt;&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;Christian&lt;br&gt;_______________________________________________&lt;br&gt;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;mailto:rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&amp;gt;&lt;br&gt;&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</tt>
