<tt>
Matthias,&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2010/2/8&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@lshift.net&quot;&gt;matthias@lshift.net&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
That&nbsp;indicates&nbsp;that&nbsp;the&nbsp;client&nbsp;closed&nbsp;the&nbsp;connection.&nbsp;Or&nbsp;the&nbsp;network&nbsp;died.&lt;/blockquote&gt;&lt;div&gt;Yep;&nbsp;I&nbsp;also&nbsp;reached&nbsp;that&nbsp;conclusion.&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;used&nbsp;to&nbsp;have&nbsp;immediate&nbsp;and&nbsp;mandatory&nbsp;flags&nbsp;set&nbsp;but&nbsp;I&amp;#39;ve&nbsp;removed&lt;br&gt;<br>
these&nbsp;to&nbsp;make&nbsp;the&nbsp;connection&nbsp;as&nbsp;plain&nbsp;vanilla&nbsp;as&nbsp;possible.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
With&nbsp;these&nbsp;flags&nbsp;set&nbsp;the&nbsp;server&nbsp;may&nbsp;send&nbsp;&amp;#39;basic.return&amp;#39;&nbsp;commands&nbsp;to&nbsp;the&nbsp;client.&nbsp;Perhaps&nbsp;amqplib&nbsp;doesn&amp;#39;t&nbsp;handle&nbsp;these&nbsp;and&nbsp;dies?&lt;/blockquote&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;As&nbsp;the&nbsp;problem&nbsp;manifests&nbsp;itself&nbsp;with&nbsp;a&nbsp;plain&nbsp;connection&nbsp;this&nbsp;is&nbsp;not&nbsp;likely&nbsp;to&nbsp;be&nbsp;the&nbsp;cause. &lt;/div&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;&lt;/div&gt;<br>
Also&nbsp;note&nbsp;that&nbsp;the&nbsp;frame&nbsp;size&nbsp;does&nbsp;not&nbsp;limit&nbsp;the&nbsp;message&nbsp;size,&nbsp;since&nbsp;messages&nbsp;can&nbsp;be&nbsp;split&nbsp;across&nbsp;multiple&nbsp;frames.&nbsp;All&nbsp;our&nbsp;supported&nbsp;client&nbsp;libraries&nbsp;do&nbsp;that&nbsp;automatically&nbsp;but&nbsp;it&amp;#39;s&nbsp;possible&nbsp;that&nbsp;amqplib&nbsp;doesn&amp;#39;t.&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;ve&nbsp;found&nbsp;out that&nbsp;pika&nbsp;takes&nbsp;the&nbsp;min()&nbsp;of&nbsp;the&nbsp;server-mandated&nbsp;framesize&nbsp;(128k)&nbsp;and&nbsp;the&nbsp;one&nbsp;I&nbsp;specified&nbsp;in&nbsp;the&nbsp;ConnectionParameters() meaning&nbsp;that&nbsp;I&nbsp;cannot&nbsp;set&nbsp;a&nbsp;larger&nbsp;frame-size.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;From&nbsp;reviewing&nbsp;the&nbsp;pika&nbsp;&amp;amp;&nbsp;amqplib&nbsp;code&nbsp;it&nbsp;seems&nbsp;that:&lt;/div&gt;&lt;div&gt;-&nbsp;pika takes&nbsp;the&nbsp;header/footer&nbsp;sizes&nbsp;into&nbsp;account&nbsp;when&nbsp;computing&nbsp;the&nbsp;frame-max&nbsp;to&nbsp;use&lt;/div&gt;&lt;div&gt;-&nbsp;pika&nbsp;actually&nbsp;writes&nbsp;in&nbsp;frame-max&nbsp;blocks,&nbsp;which&nbsp;I&nbsp;don&amp;#39;t&nbsp;believe&nbsp;amqplib&nbsp;does.&nbsp;Not&nbsp;sure&nbsp;yet&nbsp;whether&nbsp;this&nbsp;could&nbsp;cause&nbsp;the&nbsp;issue&nbsp;observed.&lt;/div&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;finish&nbsp;translating&nbsp;my&nbsp;threaded&nbsp;amqplib&nbsp;app&nbsp;into&nbsp;pika&nbsp;using&nbsp;asyncore&nbsp;I&nbsp;hope&nbsp;to&nbsp;find&nbsp;that&nbsp;it&nbsp;solves&nbsp;the&nbsp;problem. &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;<br>
Try&nbsp;to&nbsp;get&nbsp;a&nbsp;trace&nbsp;that&nbsp;includes&nbsp;the&nbsp;connection&nbsp;disappearance.&nbsp;The&nbsp;pattern&nbsp;of&nbsp;commands&nbsp;just&nbsp;prior&nbsp;to&nbsp;that&nbsp;might&nbsp;shed&nbsp;some&nbsp;light&nbsp;on&nbsp;what&nbsp;causes&nbsp;the&nbsp;client&nbsp;to&nbsp;trip&nbsp;up.&lt;/blockquote&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;Tracer&nbsp;writes&nbsp;the&nbsp;full&nbsp;message-body&nbsp;to&nbsp;stdout&nbsp;which&nbsp;isn&amp;#39;t&nbsp;helpful&nbsp;when&nbsp;sending&nbsp;multi-megabyte&nbsp;bodies.&nbsp;I&amp;#39;ll&nbsp;try&nbsp;using&nbsp;wireshark&nbsp;for&nbsp;diagnostics&nbsp;instead.&lt;/div&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;&lt;/div&gt;<br>
Feel&nbsp;free&nbsp;to&nbsp;give&nbsp;it&nbsp;a&nbsp;try,&nbsp;but&nbsp;since&nbsp;we&nbsp;do&nbsp;not&nbsp;know&nbsp;what&nbsp;the&nbsp;problem&nbsp;is&nbsp;there&nbsp;is&nbsp;no&nbsp;way&nbsp;to&nbsp;tell&nbsp;in&nbsp;advance&nbsp;whether&nbsp;it&nbsp;will&nbsp;fare&nbsp;any&nbsp;better.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;I&nbsp;like&nbsp;the&nbsp;design&nbsp;principles&nbsp;of&nbsp;pika,&nbsp;but&nbsp;the&nbsp;example&nbsp;of&nbsp;demo_relay.py&nbsp;is&nbsp;a&nbsp;little&nbsp;hard&nbsp;going.&nbsp;Can&nbsp;you&nbsp;point&nbsp;me&nbsp;at&nbsp;any&nbsp;other&nbsp;real-world&nbsp;examples&nbsp;of&nbsp;asyncore-based&nbsp;connection&nbsp;handling?&nbsp;And&nbsp;what&nbsp;is&nbsp;the&nbsp;recommended&nbsp;way&nbsp;to&nbsp;detect/handle&nbsp;connection-failure?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sigurd&lt;/div&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
