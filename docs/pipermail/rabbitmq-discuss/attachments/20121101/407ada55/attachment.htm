<tt>
I&nbsp;am&nbsp;running&nbsp;an&nbsp;active-active&nbsp;RabbitMQ&nbsp;cluster,&nbsp;and&nbsp;as&nbsp;recommended&nbsp;by&nbsp;&amp;quot;High&nbsp;Availability&nbsp;in&nbsp;RabbitMQ:&nbsp;solving&nbsp;part&nbsp;of&nbsp;the&nbsp;puzzle&amp;quot;&nbsp;(&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solving-part-of-the-puzzle/&quot;&gt;http://www.rabbitmq.com/blog/2011/10/25/high-availability-in-rabbitmq-solving-part-of-the-puzzle/&lt;/a&gt;),&nbsp;I&amp;#39;m&nbsp;connecting&nbsp;to&nbsp;the&nbsp;cluster&nbsp;of&nbsp;message&nbsp;brokers&nbsp;via&nbsp;an&nbsp;haproxy&nbsp;load&nbsp;balancer.&nbsp; Everything&nbsp;was&nbsp;working&nbsp;fine&nbsp;until&nbsp;one&nbsp;of&nbsp;the&nbsp;nodes&nbsp;failed,&nbsp;after&nbsp;which&nbsp;it&nbsp;seemed&nbsp;that&nbsp;the&nbsp;haproxy&nbsp;load&nbsp;balancer&nbsp;did&nbsp;not&nbsp;appear&nbsp;to&nbsp;detect&nbsp;the&nbsp;failed&nbsp;node.&nbsp; Clients&nbsp;would&nbsp;initiate&nbsp;connections&nbsp;and&nbsp;often&nbsp;just&nbsp;hang,&nbsp;I&nbsp;assume&nbsp;because&nbsp;the&nbsp;load&nbsp;balancer&nbsp;is&nbsp;forwarding&nbsp;them&nbsp;on&nbsp;to&nbsp;the&nbsp;failed&nbsp;node.&nbsp; As&nbsp;a&nbsp;workaround,&nbsp;I&amp;#39;ve&nbsp;reconfigured&nbsp;clients&nbsp;to&nbsp;connect&nbsp;directly&nbsp;to&nbsp;a&nbsp;working&nbsp;node,&nbsp;and&nbsp;everything&nbsp;returned&nbsp;to&nbsp;normal,&nbsp;so&nbsp;I&nbsp;am&nbsp;suspecting&nbsp;my&nbsp;haproxy&nbsp;configuration&nbsp;is&nbsp;not&nbsp;correct.&lt;div&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Does&nbsp;anyone&nbsp;have&nbsp;experience&nbsp;using&nbsp;haproxy&nbsp;as&nbsp;a&nbsp;load&nbsp;balancer&nbsp;for&nbsp;RabbitMQ,&nbsp;and&nbsp;if&nbsp;so,&nbsp;can&nbsp;you&nbsp;share&nbsp;your&nbsp;config&nbsp;or&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;my&nbsp;configuration&nbsp;and&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;you&nbsp;have&nbsp;any&nbsp;recommendations?&lt;/div&gt;&lt;div&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;haproxy.cfg:&lt;/div&gt;&lt;div&gt;&lt;div&gt;global&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;log&nbsp;127.0.0.1&nbsp; &nbsp;local0&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;log&nbsp;127.0.0.1&nbsp; &nbsp;local1&nbsp;notice&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;maxconn&nbsp;4096&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;user&nbsp;haproxy&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;group&nbsp;haproxy&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;daemon&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;defaults&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;log&nbsp; &nbsp; &nbsp;global&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;mode&nbsp; &nbsp; http&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;option&nbsp; dontlognull&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;retries&nbsp;3&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;option&nbsp;redispatch&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;maxconn&nbsp;2000&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;contimeout&nbsp; &nbsp; &nbsp; 5000&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;clitimeout&nbsp; &nbsp; &nbsp; 50000&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;srvtimeout&nbsp; &nbsp; &nbsp; 50000&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;listen&nbsp;rabbitmq&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:5672&quot;&gt;0.0.0.0:5672&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;mode&nbsp;tcp&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;stats&nbsp;enable&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;balance&nbsp;roundrobin&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;option&nbsp;forwardfor&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;option&nbsp;tcpka&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;server&nbsp;rabbit01&nbsp;&lt;a&nbsp;href=&quot;http://1.2.3.4:5672&quot;&gt;1.2.3.4:5672&lt;/a&gt;&nbsp;check&nbsp;inter&nbsp;5000&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;server&nbsp;rabbit02&nbsp;&lt;a&nbsp;href=&quot;http://1.2.3.5:5672&quot;&gt;1.2.3.5:5672&lt;/a&gt;&nbsp;check&nbsp;inter&nbsp;5000&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;server&nbsp;rabbit03&nbsp;&lt;a&nbsp;href=&quot;http://1.2.3.6:5672&quot;&gt;1.2.3.6:5672&lt;/a&gt;&nbsp;check&nbsp;inter&nbsp;5000&lt;/div&gt;&lt;/div&gt;<br>

</tt>
