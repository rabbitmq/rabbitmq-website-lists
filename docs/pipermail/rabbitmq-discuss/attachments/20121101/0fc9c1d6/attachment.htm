<tt>
&lt;br&gt;&lt;br&gt;понедельник,&nbsp;26&nbsp;марта&nbsp;2012&amp;nbsp;г.,&nbsp;9:45:45&nbsp;UTC+4&nbsp;пользователь&nbsp;Dmitri&nbsp;Minaev&nbsp;написал:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;On&nbsp;9&nbsp;March&nbsp;2012&nbsp;16:37,&nbsp;Simon&nbsp;MacMullen&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;javascript:&quot;&nbsp;target=&quot;_blank&quot;&nbsp;gdf-obfuscated-mailto=&quot;qg9JUcMwJLkJ&quot;&gt;si...@rabbitmq.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;On&nbsp;09/03/12&nbsp;07:57,&nbsp;Dmitri&nbsp;Minaev&nbsp;wrote:&lt;p&gt;&amp;gt;&amp;gt;&nbsp;If&nbsp;I&nbsp;understand&nbsp;correctly,&nbsp;the&nbsp;number&nbsp;of&nbsp;file&nbsp;descriptors&nbsp;used&nbsp;by&lt;br&gt;&amp;gt;&amp;gt;&nbsp;RabbitMQ&nbsp;in&nbsp;normal&nbsp;situation&nbsp;is&nbsp;roughly&nbsp;equal&nbsp;to&nbsp;the&nbsp;number&nbsp;of&lt;br&gt;&amp;gt;&amp;gt;&nbsp;`rabbitmqctl&nbsp;list_connections`&nbsp;+&nbsp;some&nbsp;constant&nbsp;(~30)?&nbsp;In&nbsp;case&nbsp;of&nbsp;that&lt;br&gt;&amp;gt;&amp;gt;&nbsp;hanging&nbsp;server,&nbsp;the&nbsp;number&nbsp;of&nbsp;AMQP&nbsp;connections&nbsp;never&nbsp;was&nbsp;close&nbsp;to&nbsp;the&lt;br&gt;&amp;gt;&amp;gt;&nbsp;FD&nbsp;limit&nbsp;(ulimit&nbsp;-n&nbsp;is&nbsp;1024,&nbsp;fs.file-max&nbsp;=&nbsp;1605698).&nbsp;The&nbsp;graph&lt;br&gt;&amp;gt;&amp;gt;&nbsp;reflecting&nbsp;&amp;nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;AMQP&nbsp;connections&nbsp;is&nbsp;attached&nbsp;to&nbsp;this&lt;br&gt;&amp;gt;&amp;gt;&nbsp;message.&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;It's&nbsp;not&nbsp;really&nbsp;a&nbsp;constant,&nbsp;but&nbsp;to&nbsp;a&nbsp;first&nbsp;approximation,&nbsp;yes.&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;Ultimately,&nbsp;the&nbsp;error&nbsp;I&nbsp;saw&nbsp;being&nbsp;passed&nbsp;up&nbsp;from&nbsp;the&nbsp;OS&nbsp;was&nbsp;ENFILE&nbsp;-&nbsp;that's&lt;br&gt;&amp;gt;&nbsp;pretty&nbsp;unambiguous&nbsp;:)&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;It's&nbsp;possible&nbsp;that&nbsp;if&nbsp;you're&nbsp;churning&nbsp;connections&nbsp;then&nbsp;&quot;closed&quot;&nbsp;connections&lt;br&gt;&amp;gt;&nbsp;in&nbsp;FIN_WAIT2&nbsp;could&nbsp;account&nbsp;for&nbsp;the&nbsp;majority&nbsp;of&nbsp;the&nbsp;used&nbsp;FDs.&nbsp;In&nbsp;2.8.0&nbsp;we'll&lt;br&gt;&amp;gt;&nbsp;set&nbsp;SO_LINGER&nbsp;to&nbsp;0&nbsp;to&nbsp;prevent&nbsp;this.&lt;/p&gt;&lt;p&gt;I&nbsp;am&nbsp;still&nbsp;not&nbsp;sure&nbsp;about&nbsp;the&nbsp;role&nbsp;of&nbsp;the&nbsp;file&nbsp;descriptors&nbsp;in&nbsp;this&lt;br&gt;event.&nbsp;Last&nbsp;Friday,&nbsp;our&nbsp;Rabbit&nbsp;died&nbsp;again.&nbsp;Until&nbsp;the&nbsp;very&nbsp;last&nbsp;moment&lt;br&gt;the&nbsp;number&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;as&nbsp;reported&nbsp;by&nbsp;the&nbsp;management&lt;br&gt;plugin&nbsp;was&nbsp;143&nbsp;out&nbsp;of&nbsp;the&nbsp;total&nbsp;available&nbsp;number&nbsp;of&nbsp;32765.&nbsp;It&nbsp;was&lt;br&gt;RabbitMQ&nbsp;v.2.7.0.&nbsp;On&nbsp;that&nbsp;same&nbsp;day&nbsp;I&nbsp;have&nbsp;upgraded&nbsp;to&nbsp;2.8.1.&nbsp;Will&lt;br&gt;report&nbsp;on&nbsp;its&nbsp;behaviour&nbsp;later.&lt;/p&gt;&lt;p&gt;--&nbsp;&lt;br&gt;With&nbsp;best&nbsp;regards,&lt;br&gt;Dmitri&nbsp;Minaev&lt;br&gt;______________________________&lt;wbr&gt;_________________&lt;br&gt;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;javascript:&quot;&nbsp;target=&quot;_blank&quot;&nbsp;gdf-obfuscated-mailto=&quot;qg9JUcMwJLkJ&quot;&gt;rabbitmq...@lists.&lt;wbr&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;wbr&gt;cgi-bin/mailman/listinfo/&lt;wbr&gt;rabbitmq-discuss&lt;/a&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</tt>
