<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&nbsp;http-equiv=Content-Type&gt;<br>
&lt;META&nbsp;name=GENERATOR&nbsp;content=&quot;MSHTML&nbsp;8.00.6001.19088&quot;&gt;&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;SPAN&nbsp;class=632273221-22072011&gt;&lt;FONT&nbsp;color=#0000ff&nbsp;<br>
face=Arial&gt;To&nbsp;extend&nbsp;my&nbsp;previous&nbsp;question,&nbsp;if&nbsp;I&nbsp;set&nbsp;the&nbsp;prefetch&nbsp;count&nbsp;to&nbsp;10&nbsp;but&nbsp;<br>
there&nbsp;is&nbsp;only&nbsp;1&nbsp;message&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;and&nbsp;if&nbsp;I&nbsp;read&nbsp;the&nbsp;message&nbsp;but&nbsp;do&nbsp;not&nbsp;ack&nbsp;<br>
it,&nbsp;will&nbsp;I&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;up&nbsp;to&nbsp;9&nbsp;messages&nbsp;later&nbsp;when&nbsp;they&nbsp;show&nbsp;up?&amp;nbsp;&nbsp;Or&nbsp;is&nbsp;<br>
the&nbsp;prefetch&nbsp;only&nbsp;applicable&nbsp;when&nbsp;the&nbsp;messages&nbsp;are&nbsp;actually&nbsp;available&nbsp;in&nbsp;the&nbsp;<br>
buffer?&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;SPAN&nbsp;class=632273221-22072011&gt;&lt;FONT&nbsp;color=#0000ff&nbsp;<br>
face=Arial&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;SPAN&nbsp;class=632273221-22072011&gt;&lt;FONT&nbsp;color=#0000ff&nbsp;<br>
face=Arial&gt;Thanks,&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;dir=ltr&nbsp;align=left&gt;&lt;SPAN&nbsp;class=632273221-22072011&gt;&lt;FONT&nbsp;color=#0000ff&nbsp;<br>
face=Arial&gt;&amp;nbsp;&amp;nbsp;&nbsp;Lowell&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;&lt;BR&gt;<br>
&lt;BLOCKQUOTE&nbsp;style=&quot;MARGIN-RIGHT:&nbsp;0px&quot;&nbsp;dir=ltr&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;dir=ltr&nbsp;lang=en-us&nbsp;class=OutlookMessageHeader&nbsp;align=left&gt;<br>
&nbsp;&nbsp;&lt;HR&nbsp;tabIndex=-1&gt;<br>
&nbsp;&nbsp;&lt;FONT&nbsp;size=2&nbsp;face=Tahoma&gt;&lt;B&gt;From:&lt;/B&gt;&nbsp;Boggs&nbsp;Jr.,&nbsp;Lowell&nbsp;&lt;BR&gt;&lt;B&gt;Sent:&lt;/B&gt;&nbsp;<br>
&nbsp;&nbsp;Friday,&nbsp;July&nbsp;22,&nbsp;2011&nbsp;4:28&nbsp;PM&lt;BR&gt;&lt;B&gt;To:&lt;/B&gt;&nbsp;<br>
&nbsp;&nbsp;rabbitmq-discuss@lists.rabbitmq.com&lt;BR&gt;&lt;B&gt;Subject:&lt;/B&gt;&nbsp;Reading&nbsp;messages&nbsp;<br>
&nbsp;&nbsp;without&nbsp;acking&nbsp;them&lt;BR&gt;&lt;/FONT&gt;&lt;BR&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;id=body&nbsp;class=&quot;mb&nbsp;cb&nbsp;fontsize2&nbsp;&quot;&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;id=inbdy&gt;&lt;A&nbsp;name=msg_c9cc14c924840370&gt;&lt;/A&gt;&lt;FONT&nbsp;class=fixed_width&nbsp;<br>
&nbsp;&nbsp;face=&quot;Courier,&nbsp;Monospaced&quot;&gt;<br>
&nbsp;&nbsp;&lt;P&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;id=qhide_315340&nbsp;class=qt&gt;&lt;SPAN&nbsp;<br>
&nbsp;&nbsp;class=179012621-22072011&gt;&lt;FONT&nbsp;face=Arial&gt;Thanks&nbsp;Michael&nbsp;and&nbsp;<br>
&nbsp;&nbsp;Matt.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;class=qt&gt;&lt;SPAN&nbsp;class=179012621-22072011&gt;&lt;FONT&nbsp;<br>
&nbsp;&nbsp;face=Arial&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;class=qt&gt;&lt;SPAN&nbsp;class=179012621-22072011&gt;&lt;FONT&nbsp;<br>
&nbsp;&nbsp;face=Arial&gt;In&nbsp;the&nbsp;attached,&nbsp;Matt&nbsp;says&nbsp;that&nbsp;with&nbsp;a&nbsp;QOS/prefetch&nbsp;of&nbsp;1,&nbsp;I&nbsp;<br>
&nbsp;&nbsp;rabbitmq&nbsp;will&nbsp;not&nbsp;let&nbsp;me&nbsp;read&nbsp;more&nbsp;than&nbsp;one&nbsp;message&nbsp;without&nbsp;acking&nbsp;<br>
&nbsp;&nbsp;it.&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;class=qt&gt;&lt;SPAN&nbsp;class=179012621-22072011&gt;&lt;FONT&nbsp;<br>
&nbsp;&nbsp;face=Arial&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;class=qt&gt;&lt;SPAN&nbsp;class=179012621-22072011&gt;&lt;FONT&nbsp;<br>
&nbsp;&nbsp;face=Arial&gt;So,&nbsp;is&nbsp;it&nbsp;true&nbsp;then&nbsp;that&nbsp;if&nbsp;I&nbsp;set&nbsp;the&nbsp;prefetch&nbsp;number&nbsp;to&amp;nbsp;&nbsp;10,&nbsp;<br>
&nbsp;&nbsp;I&nbsp;can&nbsp;read&nbsp;up&nbsp;to&nbsp;10&nbsp;without&nbsp;acking&nbsp;any&nbsp;of&nbsp;them?&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;class=qt&gt;&lt;SPAN&nbsp;class=179012621-22072011&gt;&lt;FONT&nbsp;<br>
&nbsp;&nbsp;face=Arial&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;class=qt&gt;&lt;SPAN&nbsp;class=179012621-22072011&gt;&lt;FONT&nbsp;<br>
&nbsp;&nbsp;face=Arial&gt;Thanks,&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;class=qt&gt;&lt;SPAN&nbsp;class=179012621-22072011&gt;&lt;FONT&nbsp;<br>
&nbsp;&nbsp;face=Arial&gt;&amp;nbsp;&amp;nbsp;&nbsp;Lowell&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;class=qt&gt;&lt;SPAN&nbsp;class=179012621-22072011&gt;&lt;FONT&nbsp;<br>
&nbsp;&nbsp;face=Arial&gt;&lt;/FONT&gt;&lt;/SPAN&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;class=qt&gt;&lt;FONT&nbsp;face=Arial&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;class=qt&gt;On&nbsp;Fri,&nbsp;Jul&nbsp;22,&nbsp;2011&nbsp;at&nbsp;12:10:13PM&nbsp;-0400,&nbsp;<br>
&nbsp;&nbsp;Lowell.Bo&lt;A&nbsp;<br>
&nbsp;&nbsp;href=&quot;blocked::http://groups.google.com/groups/unlock?_done=/group/rabbitmq-discuss/browse_thread/thread/c764b1ebb8471857&amp;amp;msg=c9cc14c924840370&quot;&nbsp;<br>
&nbsp;&nbsp;target=_parent&gt;...&lt;/A&gt;@emc.com&nbsp;wrote:&nbsp;&lt;BR&gt;&amp;gt;&nbsp;What&nbsp;happens&nbsp;to&nbsp;messages&nbsp;in&nbsp;<br>
&nbsp;&nbsp;durable&nbsp;queues&nbsp;which&nbsp;have&nbsp;already&nbsp;been&nbsp;_read_&nbsp;but&nbsp;which&nbsp;have&nbsp;not&nbsp;yet&nbsp;been&nbsp;<br>
&nbsp;&nbsp;_acked_&nbsp;when:&nbsp;&lt;BR&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&amp;gt;&nbsp;1.&nbsp;&amp;nbsp;rabbit&nbsp;is&nbsp;shutdown&nbsp;gracefully?&nbsp;&lt;BR&gt;&lt;BR&gt;&lt;/P&gt;&lt;/DIV&gt;They&nbsp;are&nbsp;<br>
&nbsp;&nbsp;requeued&nbsp;to&nbsp;the&nbsp;back&nbsp;of&nbsp;the&nbsp;queue.&nbsp;&lt;BR&gt;<br>
&nbsp;&nbsp;&lt;P&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;id=qhide_315341&nbsp;class=qt&gt;&amp;gt;&nbsp;2.&nbsp;&amp;nbsp;the&nbsp;<br>
&nbsp;&nbsp;consumer&nbsp;channel&nbsp;closes&nbsp;abruptly&nbsp;--&nbsp;say&nbsp;from&nbsp;crash,&nbsp;kill,&nbsp;or&nbsp;forced&nbsp;shutdown?&nbsp;<br>
&nbsp;&nbsp;&lt;BR&gt;&lt;BR&gt;&lt;/DIV&gt;They&nbsp;are&nbsp;requeued&nbsp;to&nbsp;the&nbsp;back&nbsp;of&nbsp;the&nbsp;queue.&nbsp;&lt;BR&gt;<br>
&nbsp;&nbsp;&lt;P&gt;This&nbsp;is&nbsp;only&nbsp;relevant&nbsp;for&nbsp;persistent&nbsp;messages&nbsp;-&nbsp;transient&nbsp;messages&nbsp;will&nbsp;<br>
&nbsp;&nbsp;&lt;BR&gt;be&nbsp;lost&nbsp;if&nbsp;rabbit&nbsp;dies&nbsp;in&nbsp;any&nbsp;way.&nbsp;&lt;BR&gt;<br>
&nbsp;&nbsp;&lt;P&gt;The&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;requeuing&nbsp;at&nbsp;the&nbsp;back&nbsp;rule&nbsp;is&nbsp;if&nbsp;rabbit&nbsp;is&nbsp;hard&nbsp;<br>
&nbsp;&nbsp;&lt;BR&gt;killed.&nbsp;There's&nbsp;a&nbsp;possibility&nbsp;that&nbsp;the&nbsp;fact&nbsp;that&nbsp;the&nbsp;message&nbsp;has&nbsp;been&nbsp;<br>
&nbsp;&nbsp;&lt;BR&gt;delivered&nbsp;to&nbsp;a&nbsp;consumer&nbsp;has&nbsp;not&nbsp;been&nbsp;successfully&nbsp;recorded&nbsp;on&nbsp;disk.&nbsp;As&nbsp;<br>
&nbsp;&nbsp;&lt;BR&gt;such,&nbsp;on&nbsp;recovery,&nbsp;the&nbsp;message&nbsp;may&nbsp;reappear&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;queue,&nbsp;<br>
&nbsp;&nbsp;&lt;BR&gt;rather&nbsp;than&nbsp;the&nbsp;back.&nbsp;&lt;BR&gt;<br>
&nbsp;&nbsp;&lt;P&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;id=qhide_315342&nbsp;class=qt&gt;&amp;gt;&nbsp;The&nbsp;rabbitmq&nbsp;<br>
&nbsp;&nbsp;documentation&nbsp;gives&nbsp;me&nbsp;the&nbsp;impression&nbsp;that&nbsp;I&nbsp;can&nbsp;read&nbsp;&lt;BR&gt;&amp;gt;&nbsp;messages&nbsp;from&nbsp;a&nbsp;<br>
&nbsp;&nbsp;durable&nbsp;queue&nbsp;and&nbsp;choose&nbsp;not&nbsp;to&nbsp;ack&nbsp;them&nbsp;until&nbsp;I&nbsp;&amp;nbsp;want&nbsp;&lt;BR&gt;&amp;gt;&nbsp;--&nbsp;<br>
&nbsp;&nbsp;perhaps&nbsp;hours&nbsp;later.&nbsp;&amp;nbsp;Obviously,&nbsp;I&nbsp;have&nbsp;to&nbsp;watch&nbsp;my&nbsp;queue&nbsp;sizes&nbsp;in&nbsp;<br>
&nbsp;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;this&nbsp;situation.&nbsp;&amp;nbsp;But&nbsp;what&nbsp;happens&nbsp;if&nbsp;the&nbsp;application&nbsp;never&nbsp;acks&nbsp;<br>
&nbsp;&nbsp;the&nbsp;&lt;BR&gt;&amp;gt;&nbsp;messages&nbsp;before&nbsp;it&nbsp;terminates?&nbsp;&amp;nbsp;What&nbsp;will&nbsp;happen&nbsp;when&nbsp;the&nbsp;<br>
&nbsp;&nbsp;&lt;BR&gt;&amp;gt;&nbsp;rabbitmq-server&nbsp;is&nbsp;restarted&nbsp;or&nbsp;when&nbsp;or&nbsp;the&nbsp;program&nbsp;is&nbsp;restarted,&nbsp;<br>
&nbsp;&nbsp;will&nbsp;&lt;BR&gt;&amp;gt;&nbsp;it&nbsp;get&nbsp;the&nbsp;messages&nbsp;again?&nbsp;&lt;BR&gt;&lt;BR&gt;&lt;/DIV&gt;They&nbsp;are&nbsp;requeued&nbsp;to&nbsp;<br>
&nbsp;&nbsp;the&nbsp;back&nbsp;of&nbsp;the&nbsp;queue.&nbsp;&lt;BR&gt;<br>
&nbsp;&nbsp;&lt;P&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;id=qhide_315343&nbsp;class=qt&gt;&amp;gt;&nbsp;Suppose&nbsp;I&nbsp;have&nbsp;<br>
&nbsp;&nbsp;multiple&nbsp;consumers&nbsp;reading&nbsp;from&nbsp;the&nbsp;same&nbsp;durable&nbsp;queue&nbsp;&lt;BR&gt;&amp;gt;&nbsp;in&nbsp;a&nbsp;round&nbsp;<br>
&nbsp;&nbsp;robin&nbsp;fashion&nbsp;(read&nbsp;ahead&nbsp;is&nbsp;1)&nbsp;and&nbsp;one&nbsp;consumer&nbsp;has&nbsp;read&nbsp;&lt;BR&gt;&amp;gt;&nbsp;but&nbsp;not&nbsp;<br>
&nbsp;&nbsp;acked&nbsp;10&nbsp;messages.&nbsp;&lt;BR&gt;&lt;BR&gt;&lt;/DIV&gt;Not&nbsp;possible.&nbsp;If&nbsp;qos&nbsp;prefetch&nbsp;is&nbsp;1&nbsp;then&nbsp;that&nbsp;<br>
&nbsp;&nbsp;consumer&nbsp;will&nbsp;be&nbsp;sent&nbsp;at&nbsp;&lt;BR&gt;most&nbsp;1&nbsp;message&nbsp;at&nbsp;a&nbsp;time&nbsp;and&nbsp;will&nbsp;then&nbsp;receive&nbsp;no&nbsp;<br>
&nbsp;&nbsp;more&nbsp;until&nbsp;it&nbsp;acks&nbsp;&lt;BR&gt;that&nbsp;message.&nbsp;&lt;BR&gt;<br>
&nbsp;&nbsp;&lt;P&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;style=&quot;DISPLAY:&nbsp;block&quot;&nbsp;id=qhide_315344&nbsp;class=qt&gt;&amp;gt;&nbsp;&amp;nbsp;If&nbsp;it&nbsp;dies,&nbsp;or&nbsp;<br>
&nbsp;&nbsp;at&nbsp;least&nbsp;closes&nbsp;the&nbsp;&lt;BR&gt;&amp;gt;&nbsp;connection&nbsp;abruptly,&nbsp;will&nbsp;those&nbsp;10&nbsp;messages&nbsp;be&nbsp;<br>
&nbsp;&nbsp;sent&nbsp;to&nbsp;the&nbsp;other&nbsp;&lt;BR&gt;&amp;gt;&nbsp;consumers&nbsp;to&nbsp;read?&nbsp;&lt;BR&gt;&lt;BR&gt;&lt;/DIV&gt;Yes.&nbsp;&lt;BR&gt;<br>
&nbsp;&nbsp;&lt;P&gt;Matthew&nbsp;&lt;BR&gt;&lt;/P&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
