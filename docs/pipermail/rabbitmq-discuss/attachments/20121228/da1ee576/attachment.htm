<tt>
What&nbsp;I'd&nbsp;do&nbsp;is&nbsp;snapshot&nbsp;the&nbsp;time,&nbsp;down&nbsp;to&nbsp;the&nbsp;millisecond,&nbsp;on&nbsp;both&nbsp;servers,&nbsp;both&nbsp;before&nbsp;and&nbsp;after&nbsp;the&nbsp;message&nbsp;goes&nbsp;through&nbsp;the&nbsp;pipeline&nbsp;(to&nbsp;verify&nbsp;that&nbsp;they&nbsp;didn't&nbsp;drift&nbsp;apart&nbsp;or&nbsp;closer&nbsp;during&nbsp;the&nbsp;message&nbsp;sending&nbsp;event).&nbsp;Then&nbsp;timestamp&nbsp;the&nbsp;message&nbsp;and&nbsp;use&nbsp;the&nbsp;time&nbsp;delta&nbsp;between&nbsp;the&nbsp;two&nbsp;servers&nbsp;to&nbsp;adjust&nbsp;the&nbsp;message&nbsp;sent&nbsp;and&nbsp;receive&nbsp;timestamps&nbsp;to&nbsp;figure&nbsp;out&nbsp;the&nbsp;true&nbsp;time&nbsp;it&nbsp;took&nbsp;to&nbsp;send&nbsp;the&nbsp;message.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&nbsp;Eric&lt;br&gt;&lt;br&gt;On&nbsp;Saturday,&nbsp;December&nbsp;22,&nbsp;2012&nbsp;11:01:34&nbsp;PM&nbsp;UTC-5,&nbsp;dbu...@peopleanswers.com&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;Firstly,&nbsp;kudos&nbsp;to&nbsp;the&nbsp;RabbitMQ&nbsp;team&nbsp;for&nbsp;an&nbsp;astonishingly&nbsp;good&nbsp;product.&nbsp;We&nbsp;are&nbsp;using&nbsp;it&nbsp;as&nbsp;the&nbsp;messaging&nbsp;bus&nbsp;backbone&nbsp;for&nbsp;our&nbsp;flagship&nbsp;application&nbsp;and&nbsp;have&nbsp;had&nbsp;literally&nbsp;zero&nbsp;problems&nbsp;with&nbsp;it.&nbsp;Can't&nbsp;say&nbsp;enough&nbsp;good&nbsp;things.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;hoping&nbsp;someone&nbsp;can&nbsp;help&nbsp;me&nbsp;figure&nbsp;out&nbsp;a&nbsp;solution&nbsp;for&nbsp;this.&nbsp;When&nbsp;we&nbsp;send&nbsp;a&nbsp;message,&nbsp;it&nbsp;generally&nbsp;goes&nbsp;through&nbsp;a&nbsp;pipeline&nbsp;something&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;(Sending&nbsp;JVM)&nbsp;A&nbsp;Java&nbsp;thread&nbsp;will&nbsp;push&nbsp;the&nbsp;message&nbsp;into&nbsp;a&nbsp;ThreadPoolExecutor&nbsp;queue.&lt;/div&gt;&lt;div&gt;2.&amp;nbsp;(Sending&nbsp;JVM)&amp;nbsp;The&nbsp;ThreadPoolExecutor&nbsp;sends&nbsp;the&nbsp;message&nbsp;to&nbsp;RabbitMQ.&lt;/div&gt;&lt;div&gt;3.&nbsp;RabbitMQ&nbsp;delivers&nbsp;the&nbsp;message&nbsp;to&nbsp;the&nbsp;consumer.&lt;/div&gt;&lt;div&gt;4.&nbsp;(Receiving&nbsp;JVM)&nbsp;The&nbsp;consumer&nbsp;receives&nbsp;the&nbsp;message&nbsp;and&nbsp;pushes&nbsp;it&nbsp;into&nbsp;a&nbsp;ThreadPoolExecutor&nbsp;queue&lt;/div&gt;&lt;div&gt;5.&nbsp;(Receiving&nbsp;JVM)&nbsp;The&nbsp;ThreadPoolExecutor&nbsp;handles&nbsp;the&nbsp;message&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;goal&nbsp;is&nbsp;to&nbsp;measure&nbsp;the&nbsp;total&nbsp;time&nbsp;spent,&nbsp;per&nbsp;message,&nbsp;with&nbsp;millisecond&nbsp;accuracy,&nbsp;from&nbsp;one&nbsp;end&nbsp;of&nbsp;this&nbsp;pipeline&nbsp;to&nbsp;the&nbsp;other.&nbsp;I&nbsp;want&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;calculate&nbsp;this&nbsp;for&nbsp;every&nbsp;message&nbsp;sent&nbsp;through&nbsp;our&nbsp;message&nbsp;bus,&nbsp;so&nbsp;then&nbsp;I&nbsp;can&nbsp;do&nbsp;analysis&nbsp;on&nbsp;those&nbsp;times,&nbsp;in&nbsp;real-time,&nbsp;and&nbsp;draw&nbsp;useful&nbsp;conclusions.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;trouble&nbsp;is&nbsp;that&nbsp;the&nbsp;part&nbsp;pre-RabbitMQ&nbsp;(1-2)&nbsp;could&nbsp;be&nbsp;in&nbsp;a&nbsp;different&nbsp;JVM&nbsp;on&nbsp;a&nbsp;different&nbsp;physical&nbsp;server&nbsp;than&nbsp;the&nbsp;part&nbsp;post-RabbitMQ&nbsp;(4-5).&nbsp;So&nbsp;I&nbsp;can&nbsp;measure&nbsp;the&nbsp;time&nbsp;for&nbsp;steps&nbsp;1,&nbsp;2,&nbsp;4,&nbsp;and&nbsp;5.&nbsp;But&nbsp;how&nbsp;do&nbsp;I&nbsp;measure&nbsp;the&nbsp;time&nbsp;it&nbsp;took&nbsp;for&nbsp;the&nbsp;message&nbsp;to&nbsp;actually&nbsp;travel&nbsp;through&nbsp;RabbitMQ&nbsp;(step&nbsp;3)?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;can't&nbsp;just&nbsp;time-stamp&nbsp;the&nbsp;message&nbsp;because&nbsp;the&nbsp;local&nbsp;time&nbsp;on&nbsp;the&nbsp;two&nbsp;physical&nbsp;servers&nbsp;cannot&nbsp;be&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;synchronized&nbsp;to&nbsp;the&nbsp;millisecond.&nbsp;We&nbsp;use&nbsp;NTP&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;keep&nbsp;the&nbsp;two&nbsp;servers&nbsp;that&nbsp;closely&nbsp;synchronized.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;my&nbsp;question&nbsp;is:&nbsp;does&nbsp;RabbitMQ&nbsp;offer&nbsp;anything&nbsp;I&nbsp;can&nbsp;use&nbsp;that&nbsp;will&nbsp;allow&nbsp;me&nbsp;to&nbsp;figure&nbsp;out&nbsp;how&nbsp;long&nbsp;step&nbsp;4&nbsp;took&nbsp;for&nbsp;each&nbsp;message&nbsp;I&nbsp;send&nbsp;through&nbsp;RabbitMQ,&nbsp;or&nbsp;at&nbsp;least&nbsp;approximate&nbsp;it&nbsp;closely?&nbsp;Or&nbsp;is&nbsp;there&nbsp;some&nbsp;other&nbsp;clever&nbsp;technoloogy&nbsp;I&nbsp;could&nbsp;use&nbsp;to&nbsp;accomplish&nbsp;the&nbsp;same&nbsp;thing?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance,&lt;/div&gt;&lt;div&gt;Darrell&nbsp;Burgan&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;
</tt>
