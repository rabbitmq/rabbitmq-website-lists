<tt>
&lt;div&nbsp;class=&quot;h5&quot;&gt;Hi&nbsp;Ciprian,&lt;br&gt;&lt;br&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&nbsp; &nbsp; I&amp;#39;ve&nbsp;also&nbsp;pondered&nbsp;about&nbsp;the&nbsp;same&nbsp;topic&nbsp;a&nbsp;while&nbsp;ago...&nbsp;(Though&nbsp;I&lt;br&gt;<br>
haven&amp;#39;t&nbsp;tried&nbsp;it&nbsp;in&nbsp;practice.)&nbsp;As&nbsp;such&nbsp;my&nbsp;options&nbsp;were&nbsp;the&nbsp;following:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; a)&nbsp;(the&nbsp;easiest&nbsp;one)&nbsp;Go&nbsp;with&nbsp;the&nbsp;choreography&nbsp;approach,&nbsp;but&lt;br&gt;<br>
instead&nbsp;of&nbsp;naming&nbsp;the&nbsp;queue&nbsp;of&nbsp;the&nbsp;next&nbsp;service&nbsp;(and&nbsp;send&nbsp;to&nbsp;a&nbsp;direct&lt;br&gt;<br>
exchange),&nbsp;just&nbsp;send&nbsp;it&nbsp;to&nbsp;an&nbsp;exchange&nbsp;named&nbsp;by&nbsp;the&nbsp;next&nbsp;step&amp;#39;s&lt;br&gt;<br>
purpose&nbsp;(like&nbsp;&amp;quot;enrich&amp;quot;,&nbsp;&amp;quot;validate&amp;quot;,&nbsp;etc.).&nbsp;Maybe&nbsp;make&nbsp;this&nbsp;a&nbsp;topic&lt;br&gt;<br>
exchange&nbsp;and&nbsp;put&nbsp;enough&nbsp;information&nbsp;in&nbsp;the&nbsp;routing&nbsp;key&nbsp;to&nbsp;allow&lt;br&gt;<br>
&amp;quot;debugging&amp;quot;&nbsp;by&nbsp;being&nbsp;able&nbsp;to&nbsp;register&nbsp;another&nbsp;queue&nbsp;and&nbsp;&amp;quot;capture&amp;quot;&nbsp;the&lt;br&gt;<br>
traffic.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Yes,&nbsp;I&nbsp;agree&nbsp;with&nbsp;you,&nbsp;send&nbsp;to&nbsp;a&nbsp;exchange&nbsp;is&nbsp;more&nbsp;apropriate&lt;br&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&nbsp; &nbsp; b)&nbsp;(the&nbsp;&amp;quot;declarative&amp;quot;&nbsp;approach)&nbsp;Why&nbsp;not&nbsp;have&nbsp;the&nbsp;orchestration&lt;br&gt;<br>
approach&nbsp;(in&nbsp;a&nbsp;declarative&nbsp;flavor)&nbsp;combined&nbsp;with&nbsp;choreography:&lt;br&gt;<br>
&nbsp; &nbsp; *&nbsp;let&amp;#39;s&nbsp;assume&nbsp;that&nbsp;you&nbsp;have&nbsp;a&nbsp;task&nbsp;which&nbsp;goes&nbsp;through&nbsp;a&nbsp;set&nbsp;of&lt;br&gt;<br>
processes&nbsp;(transformations&nbsp;or&nbsp;just&nbsp;validations,&nbsp;etc.)&nbsp;which&nbsp;can&nbsp;be&lt;br&gt;<br>
described&nbsp;as&nbsp;decision&nbsp;tree&nbsp;(a&nbsp;binary&nbsp;tree&nbsp;of&nbsp;actions,&nbsp;where&nbsp;each&nbsp;node&lt;br&gt;<br>
is&nbsp;a&nbsp;process&nbsp;and&nbsp;the&nbsp;two&nbsp;children&nbsp;(one&nbsp;for&nbsp;success&nbsp;and&nbsp;one&nbsp;for&lt;br&gt;<br>
failure)&nbsp;are&nbsp;the&nbsp;next&nbsp;process&nbsp;to&nbsp;be&nbsp;executed);&lt;br&gt;<br>
&nbsp; &nbsp; *&nbsp;now&nbsp;you&nbsp;just&nbsp;put&nbsp;this&nbsp;decision&nbsp;tree&nbsp;inside&nbsp;the&nbsp;&amp;quot;envelope&amp;quot;&nbsp;of&lt;br&gt;<br>
each&nbsp;message,&nbsp;send&nbsp;it&nbsp;to&nbsp;the&nbsp;root&nbsp;process;&lt;br&gt;<br>
&nbsp; &nbsp; *&nbsp;this&nbsp;process&nbsp;executes&nbsp;its&nbsp;logic&nbsp;and&nbsp;based&nbsp;on&nbsp;the&nbsp;outcome&lt;br&gt;<br>
(success&nbsp;or&nbsp;failure),&nbsp;extracts&nbsp;one&nbsp;of&nbsp;it&amp;#39;s&nbsp;subtrees,&nbsp;puts&nbsp;that&nbsp;in&nbsp;the&lt;br&gt;<br>
new&nbsp;envelope&nbsp;and&nbsp;together&nbsp;with&nbsp;the&nbsp;new&nbsp;message&nbsp;sends&nbsp;it&nbsp;to&nbsp;the&nbsp;root&nbsp;of&lt;br&gt;<br>
the&nbsp;new&nbsp;tree;&nbsp;(evidently&nbsp;at&nbsp;some&nbsp;point&nbsp;the&nbsp;new&nbsp;tree&nbsp;would&nbsp;be&nbsp;empty,&lt;br&gt;<br>
which&nbsp;means&nbsp;it&nbsp;should&nbsp;stop&nbsp;sending&nbsp;it&nbsp;further;)&lt;br&gt;<br>
&nbsp; &nbsp; *&nbsp;(you&nbsp;could&nbsp;again&nbsp;use&nbsp;&amp;quot;purpose&amp;quot;&nbsp;names&nbsp;for&nbsp;exchanges&nbsp;instead&nbsp;of&lt;br&gt;<br>
direct&nbsp;queues;)&lt;br&gt;<br>
&nbsp; &nbsp; *&nbsp;you&nbsp;could&nbsp;extend&nbsp;this&nbsp;to&nbsp;a&nbsp;graph&nbsp;(maybe&nbsp;containing&nbsp;cycles,&nbsp;thus&lt;br&gt;<br>
obtaining&nbsp;loops),&nbsp;by&nbsp;saying&nbsp;that&nbsp;each&nbsp;node&nbsp;has&nbsp;two&nbsp;links&nbsp;to&nbsp;other&lt;br&gt;<br>
nodes;&lt;br&gt;<br>
&nbsp; &nbsp; *&nbsp;of&nbsp;course&nbsp;yet&nbsp;another&nbsp;extension&nbsp;would&nbsp;be&nbsp;to&nbsp;allow&nbsp;&amp;quot;labeled&amp;quot;&nbsp;node&lt;br&gt;<br>
links,&nbsp;i.e.&nbsp;each&nbsp;process&nbsp;outputs&nbsp;two&nbsp;things:&nbsp;a&nbsp;next-step&nbsp;string&nbsp;label,&lt;br&gt;<br>
and&nbsp;the&nbsp;new&nbsp;message,&nbsp;and&nbsp;now&nbsp;you&nbsp;select&nbsp;from&nbsp;the&nbsp;labeled&nbsp;links&nbsp;the&nbsp;one&lt;br&gt;<br>
matching&nbsp;the&nbsp;label;&nbsp;(maybe&nbsp;have&nbsp;something&nbsp;as&nbsp;a&nbsp;default&nbsp;link);&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; Thus&nbsp;with&nbsp;option&nbsp;b)&nbsp;you&nbsp;obtain&nbsp;both&nbsp;the&nbsp;advantages&nbsp;of&nbsp;choreography&lt;br&gt;<br>
(i.e.&nbsp;no&nbsp;middle&nbsp;man&nbsp;to&nbsp;become&nbsp;a&nbsp;single&nbsp;point&nbsp;of&nbsp;failure&nbsp;or&lt;br&gt;<br>
bottleneck),&nbsp;but&nbsp;also&nbsp;the&nbsp;advantages&nbsp;of&nbsp;orchestration&nbsp;(i.e.&nbsp;each&lt;br&gt;<br>
message&nbsp;having&nbsp;it&amp;#39;s&nbsp;own&nbsp;&amp;quot;route&amp;quot;&nbsp;through&nbsp;the&nbsp;processes).&nbsp;At&nbsp;the&nbsp;same&lt;br&gt;<br>
time&nbsp;you&nbsp;keep&nbsp;the&nbsp;processors&nbsp;&amp;quot;dumb&amp;quot;,&nbsp;none&nbsp;knowing&nbsp;of&nbsp;another.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Very&nbsp;interesting&nbsp;this&nbsp;approach,&nbsp;and&nbsp;better&nbsp;the&nbsp;possibility&nbsp;to&nbsp;eliminate&nbsp;a&nbsp;possible&nbsp;SPOF.&lt;br&gt;&lt;br&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
<br>
<br>
&lt;br&gt;<br>
&nbsp; &nbsp; Hope&nbsp;this&nbsp;helps.&lt;br&gt;<br>
&nbsp; &nbsp; Ciprian.&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp; P.S.:&nbsp;If&nbsp;you&nbsp;like&nbsp;this&nbsp;approach&nbsp;(b),&nbsp;you&nbsp;could&nbsp;go&nbsp;even&nbsp;further&nbsp;and&lt;br&gt;<br>
instead&nbsp;of&nbsp;using&nbsp;a&nbsp;static&nbsp;decision&nbsp;tree&nbsp;(or&nbsp;graph)&nbsp;you&nbsp;could&lt;br&gt;<br>
substitute&nbsp;that&nbsp;with&nbsp;an&nbsp;embedded&nbsp;language&nbsp;or&nbsp;machine&nbsp;which&nbsp;allows&lt;br&gt;<br>
generic&nbsp;operations&nbsp;on&nbsp;both&nbsp;the&nbsp;old&nbsp;and&nbsp;new&nbsp;message&nbsp;to&nbsp;decide&nbsp;the&nbsp;next&lt;br&gt;<br>
actions.&nbsp;(I&nbsp;could&nbsp;expand&nbsp;on&nbsp;this&nbsp;if&nbsp;someone&nbsp;is&nbsp;interested.)&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;I&nbsp;think&nbsp;that&nbsp;(b)&nbsp;approach&nbsp;can&nbsp;be&nbsp;more&nbsp;flexible&nbsp;for&nbsp;large&nbsp;and&nbsp;complex&nbsp;process&nbsp;and&nbsp;it&nbsp;sounds&nbsp;good.&lt;br&gt;&lt;br&gt;Maybe&nbsp;this&nbsp;topic&nbsp;can&nbsp;generate&nbsp;good&nbsp;discussions&nbsp;and&nbsp;patterns&nbsp;for&nbsp;complex&nbsp;process&nbsp;management.&lt;br&gt;<br>
<br>
&lt;br&gt;Best&nbsp;regards&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&nbsp; &nbsp; A&nbsp;practical&nbsp;(not&nbsp;very&nbsp;elegant)&nbsp;Java&nbsp;approach:&lt;br&gt;<br>
&nbsp; &nbsp; *&nbsp;define&nbsp;a&nbsp;Java&nbsp;interface&nbsp;with&nbsp;a&nbsp;method&nbsp;like&nbsp;`public&nbsp;AmqpTarget&lt;br&gt;<br>
decide&nbsp;(MyMessage&nbsp;old,&nbsp;MyMessage&nbsp;new)`&nbsp;(or&nbsp;something&nbsp;similar),&nbsp;where&lt;br&gt;<br>
`AmqpTarget`&nbsp;has&nbsp;two&nbsp;fields&nbsp;for&nbsp;exchange&nbsp;and&nbsp;routing&nbsp;key;&lt;br&gt;<br>
&nbsp; &nbsp; a)&nbsp;if&nbsp;all&nbsp;the&nbsp;processes&nbsp;share&nbsp;the&nbsp;same&nbsp;code&nbsp;and&nbsp;are&nbsp;upgraded&nbsp;at&lt;br&gt;<br>
the&nbsp;same&nbsp;time,&nbsp;just&nbsp;instantiate&nbsp;a&nbsp;serializable&nbsp;object&nbsp;implementing&lt;br&gt;<br>
that&nbsp;interface&nbsp;and&nbsp;put&nbsp;that&nbsp;in&nbsp;the&nbsp;envelope&nbsp;instead&nbsp;of&nbsp;the&nbsp;decision&lt;br&gt;<br>
tree;&lt;br&gt;<br>
&nbsp; &nbsp; b)&nbsp;if&nbsp;you&nbsp;don&amp;#39;t&nbsp;have&nbsp;shared&nbsp;code&nbsp;or&nbsp;you&nbsp;want&nbsp;to&nbsp;keep&nbsp;your&nbsp;options&nbsp;opened:&lt;br&gt;<br>
&nbsp; &nbsp; *&nbsp;for&nbsp;each&nbsp;different&nbsp;&amp;quot;workflow&amp;quot;&nbsp;define&nbsp;a&nbsp;new&nbsp;public&nbsp;&amp;quot;top&amp;quot;&nbsp;class&lt;br&gt;<br>
(i.e.&nbsp;not&nbsp;nested&nbsp;or&nbsp;anonymous)&nbsp;implementing&nbsp;that&nbsp;interface&nbsp;with&nbsp;as&nbsp;few&lt;br&gt;<br>
dependencies&nbsp;as&nbsp;possible;&lt;br&gt;<br>
&nbsp; &nbsp; *&nbsp;in&nbsp;the&nbsp;envelope&nbsp;instead&nbsp;of&nbsp;the&nbsp;decision&nbsp;tree&nbsp;put&nbsp;the&nbsp;byte-code&lt;br&gt;<br>
of&nbsp;this&nbsp;class&nbsp;(you&nbsp;can&nbsp;use&nbsp;the&lt;br&gt;<br>
`MyWorkflowClass.class.getResourceStream(MyWorkflowClass.class.getCanonicalName())`&lt;br&gt;<br>
and&nbsp;the&nbsp;canonical&nbsp;name;&nbsp;(be&nbsp;careful&nbsp;to&nbsp;use&nbsp;caching&nbsp;or&nbsp;you&amp;#39;ll&nbsp;get&lt;br&gt;<br>
`PermGenError`&nbsp;or&nbsp;similar;)&lt;br&gt;<br>
&nbsp; &nbsp; *&nbsp;to&nbsp;instantiate&nbsp;the&nbsp;class&nbsp;on&nbsp;the&nbsp;receiver&nbsp;just&nbsp;create&nbsp;a&nbsp;custom&lt;br&gt;<br>
classloader&nbsp;which&nbsp;when&nbsp;asked&nbsp;for&nbsp;the&nbsp;bytecode&nbsp;of&nbsp;that&nbsp;known&nbsp;class&nbsp;just&lt;br&gt;<br>
returns&nbsp;the&nbsp;bytes&nbsp;previously&nbsp;stored;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;Isaías&nbsp;Barroso&lt;br&gt;&lt;br&gt;<br>

</tt>
