<tt>
&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Apr&nbsp;21,&nbsp;2011&nbsp;at&nbsp;3:07&nbsp;PM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
Shalin,&lt;br&gt;<br>
&lt;br&gt;<br>
Shalin&nbsp;Shekhar&nbsp;Mangar&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
The&nbsp;rate&nbsp;of&nbsp;consumption&nbsp;keeps&nbsp;dropping.&nbsp;CPU&nbsp;usage&nbsp;of&nbsp;rabbitmq&nbsp;is&nbsp;constant&nbsp;at&nbsp;approx&nbsp;170%.&nbsp;[...]&nbsp;Am&nbsp;I&nbsp;doing&nbsp;something&nbsp;wrong?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Yes,&nbsp;you&nbsp;are&nbsp;:)&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;&lt;a&nbsp;href=&quot;https://gist.github.com/935196#L85&quot;&nbsp;target=&quot;_blank&quot;&gt;https://gist.github.com/935196#L85&lt;/a&gt;&nbsp;you&nbsp;are&nbsp;creating&nbsp;a&nbsp;new&nbsp;AMQP&nbsp;consumer&nbsp;every&nbsp;time&nbsp;you&nbsp;want&nbsp;to&nbsp;receive&nbsp;a&nbsp;message&nbsp;from&nbsp;the&nbsp;queue.&nbsp;Simply&nbsp;move&nbsp;that&nbsp;line&nbsp;out&nbsp;of&nbsp;the&nbsp;loop.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;Thanks&nbsp;Matthias!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;moved&nbsp;that&nbsp;out&nbsp;of&nbsp;the&nbsp;loop&nbsp;and&nbsp;here&nbsp;are&nbsp;the&nbsp;numbers&nbsp;running&nbsp;the&nbsp;test&nbsp;again:&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;210443&nbsp;throughput:&nbsp;20716.97184485135&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;119824&nbsp;throughput:&nbsp;11796.022839141564&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;444574&nbsp;throughput:&nbsp;22054.46968945332&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;244677&nbsp;throughput:&nbsp;12137.960115090782&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;700164&nbsp;throughput:&nbsp;23215.756490599822&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;360837&nbsp;throughput:&nbsp;11964.488212473889&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;931030&nbsp;throughput:&nbsp;23183.59520904405&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;476592&nbsp;throughput:&nbsp;11867.626185911004&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;1183641&nbsp;throughput:&nbsp;23597.779062580994&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;590305&nbsp;throughput:&nbsp;11768.675611555254&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;1427614&nbsp;throughput:&nbsp;23730.28590425532&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;702821&nbsp;throughput:&nbsp;11682.529920212766&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;1667459&nbsp;throughput:&nbsp;23766.51938426454&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;803325&nbsp;throughput:&nbsp;11449.900228050172&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;1905431&nbsp;throughput:&nbsp;23770.346806387228&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;913091&nbsp;throughput:&nbsp;11390.855788423154&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;2154468&nbsp;throughput:&nbsp;23896.051464063887&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;1017438&nbsp;throughput:&nbsp;11284.80479148181&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;2359715&nbsp;throughput:&nbsp;23559.21965635327&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;1129760&nbsp;throughput:&nbsp;11279.440101436687&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Produced:&nbsp;2587303&nbsp;throughput:&nbsp;23486.560579515437&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Consumed:&nbsp;1232315&nbsp;throughput:&nbsp;11186.490681820245&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;consumption&nbsp;rate&nbsp;holds&nbsp;throughout&nbsp;the&nbsp;test&nbsp;but&nbsp;it&nbsp;still&nbsp;seems&nbsp;low&nbsp;to&nbsp;me.&nbsp;I&amp;#39;d&nbsp;think&nbsp;that&nbsp;for&nbsp;such&nbsp;a&nbsp;small&nbsp;message&nbsp;payload,&nbsp;a&nbsp;single&nbsp;box&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;do&nbsp;much&nbsp;more&nbsp;than&nbsp;these.&nbsp;Is&nbsp;there&nbsp;something&nbsp;else&nbsp;that&nbsp;I&nbsp;should&nbsp;do&nbsp;to&nbsp;get&nbsp;better&nbsp;performance&nbsp;out&nbsp;of&nbsp;a&nbsp;single&nbsp;box?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--Â &lt;/div&gt;&lt;/div&gt;Regards,&lt;br&gt;Shalin&nbsp;Shekhar&nbsp;Mangar.&lt;br&gt;<br>
&lt;/div&gt;<br>

</tt>
