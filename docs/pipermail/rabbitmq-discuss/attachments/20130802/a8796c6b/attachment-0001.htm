<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=iso-8859-1&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;&lt;div&gt;Adding&nbsp;rabbitmq-discuss&nbsp;back.&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:'Helvetica';&nbsp;font-size:medium;&nbsp;color:rgba(0,&nbsp;0,&nbsp;0,&nbsp;1.0);&quot;&gt;&lt;b&gt;From:&nbsp;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:'Helvetica';&nbsp;font-size:medium;&quot;&gt;Burtsev&nbsp;Aleksey&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:brokenpipe.coder@gmail.com&quot;&gt;brokenpipe.coder@gmail.com&lt;/a&gt;&amp;gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&quot;&gt;&lt;b&gt;To:&nbsp;&lt;/b&gt;Michael&nbsp;Klishin&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mklishin@gopivotal.com&quot;&gt;mklishin@gopivotal.com&lt;/a&gt;&amp;gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Yes.&nbsp;It's&nbsp;not&nbsp;exactly&nbsp;a&nbsp;bug&nbsp;in&nbsp;your&nbsp;.NET&nbsp;client,&nbsp;but&nbsp;it's&nbsp;very&nbsp;weak&nbsp;spot&nbsp;in&nbsp;you&nbsp;code.&nbsp;It&nbsp;is&nbsp;very&nbsp;easy&nbsp;to&nbsp;stumble&nbsp;on&nbsp;this&nbsp;problem.&nbsp;I&nbsp;had&nbsp;to&nbsp;wrap&nbsp;all&nbsp;calls&nbsp;to&nbsp;IModel&nbsp;in&nbsp;if&nbsp;blocks&nbsp;checking&nbsp;CloseReason.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;sounds&nbsp;like&nbsp;a&nbsp;bug&nbsp;to&nbsp;me&nbsp;;)&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;At&nbsp;least&nbsp;you&nbsp;should&nbsp;set&nbsp;closeReason&nbsp;for&nbsp;IModel&nbsp;and&nbsp;inner&nbsp;ISession&nbsp;when&nbsp;IModel.Close()&nbsp;is&nbsp;called.&nbsp;Even&nbsp;better&nbsp;would&nbsp;be&nbsp;to&nbsp;add&nbsp;IsClosing&nbsp;prop&nbsp;to&nbsp;Imodel&nbsp;and&nbsp;check&nbsp;it&nbsp;before&nbsp;sending&nbsp;commands&nbsp;to&nbsp;ISession,&nbsp;this&nbsp;will&nbsp;not&nbsp;break&nbsp;you&nbsp;existing&nbsp;session&nbsp;shutdown&nbsp;command&nbsp;sequence.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Jul&nbsp;31,&nbsp;2013&nbsp;at&nbsp;9:58&nbsp;PM,&nbsp;Michael&nbsp;Klishin&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mklishin@gopivotal.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mklishin@gopivotal.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;position:&nbsp;static;&nbsp;z-index:&nbsp;auto;&nbsp;&quot;&gt;&amp;nbsp;Burtsev&nbsp;Aleksey:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;The&nbsp;code&nbsp;inside&nbsp;ModelBase.BasicGet&nbsp;doesn't&nbsp;Enqueue&nbsp;BasicGetRpcContinuation&nbsp;because&nbsp;m_closeReason&nbsp;&amp;nbsp;is&nbsp;not&nbsp;null&lt;br&gt;<br>
&amp;gt;&nbsp;but&nbsp;send&nbsp;this&nbsp;command&nbsp;to&nbsp;server&nbsp;using&nbsp;_Private_BasicGet(),&nbsp;this&nbsp;method&nbsp;checks&nbsp;ModelBase.m_sessions.m_closeReason&nbsp;which&nbsp;is&nbsp;not&nbsp;null,&nbsp;and&nbsp;then&nbsp;when&nbsp;server&nbsp;reply&nbsp;is&nbsp;received&nbsp;command&nbsp;handler&nbsp;for&nbsp;BasicGetEmpty&nbsp;tries&nbsp;to&nbsp;dequeue&nbsp;(calls&nbsp;Next())&nbsp;item&nbsp;from&nbsp;m_continuationQueue&nbsp;in&nbsp;which&nbsp;BasicGetRpcContinuation&nbsp;&amp;nbsp;wasn't&nbsp;put.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
So&nbsp;in&nbsp;order&nbsp;to&nbsp;reproduce&nbsp;the&nbsp;problem&nbsp;one&nbsp;has&nbsp;to&nbsp;use&nbsp;basic.get&nbsp;on&nbsp;a&nbsp;closed&nbsp;channel?&lt;br&gt;<br>
--&lt;br&gt;<br>
MK&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Helvetica;&nbsp;font-size:&nbsp;medium;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;2;&nbsp;text-align:&nbsp;-webkit-auto;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;2;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&gt;MK&lt;/div&gt;&lt;/div&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
