<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;11&nbsp;May&nbsp;2013,&nbsp;at&nbsp;13:08,&nbsp;Jure&nbsp;Noviƒç&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;question&nbsp;about&nbsp;about&nbsp;connections&nbsp;to&nbsp;server&nbsp;from&nbsp;java&nbsp;client.&nbsp;I'm&nbsp;developing&nbsp;a&nbsp;Android&nbsp;application&nbsp;using&nbsp;rabbitmq-java-client&nbsp;library.&nbsp;I&nbsp;followed&nbsp;the&nbsp;tutorials&nbsp;on&nbsp;the&nbsp;rabbitmq&nbsp;website,&nbsp;so&nbsp;I&nbsp;created&nbsp;a&nbsp;ConnectionFactory&nbsp;with&nbsp;my&nbsp;own&nbsp;ip&nbsp;address&nbsp;(without&nbsp;any&nbsp;timeout&nbsp;or&nbsp;heartbeat),&nbsp;then&nbsp;called&nbsp;newConnection().&nbsp;Everything&nbsp;works&nbsp;fine,&nbsp;sending&nbsp;and&nbsp;receiving.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;arrises&nbsp;when&nbsp;I&nbsp;turn&nbsp;off&nbsp;network&nbsp;connection&nbsp;on&nbsp;an&nbsp;android&nbsp;device,&nbsp;the&nbsp;connection&nbsp;on&nbsp;rabbitmq-server&nbsp;is&nbsp;still&nbsp;there&nbsp;(for&nbsp;long&nbsp;time).&nbsp;If&nbsp;I&nbsp;want&nbsp;to&amp;nbsp;achieve&nbsp;that&nbsp;the&nbsp;server&nbsp;clear&nbsp;my&nbsp;connection&nbsp;I&nbsp;have&nbsp;to&nbsp;use&nbsp;heartbeat.&nbsp;I&nbsp;also&nbsp;tried&nbsp;to&nbsp;create&nbsp;new&nbsp;&lt;i&gt;ConnectionFactory&lt;/i&gt;&nbsp;class&nbsp;and&nbsp;override&amp;nbsp;&lt;i&gt;configureSocket&lt;/i&gt;&nbsp;and&nbsp;call&nbsp;socket.setKeepAlive(true).&nbsp;That&nbsp;neither&nbsp;helped.&amp;nbsp;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;I'm&nbsp;not&nbsp;mistaken,&nbsp;you'll&nbsp;need&nbsp;to&nbsp;enable&nbsp;TCP&nbsp;keep-alive&nbsp;at&nbsp;the&nbsp;OS&nbsp;level&nbsp;to&nbsp;take&nbsp;advantage&nbsp;of&nbsp;that.&nbsp;Check&nbsp;out&nbsp;`man&nbsp;tcp`,&nbsp;at&nbsp;which&nbsp;point&nbsp;you&nbsp;might&nbsp;want&nbsp;to&nbsp;consider&nbsp;'tcp_retries1'&nbsp;and&nbsp;the&nbsp;RTO&nbsp;settings&nbsp;as&nbsp;well.&nbsp;Better&nbsp;still,&nbsp;get&nbsp;your&nbsp;network&nbsp;admin&nbsp;to&nbsp;look&nbsp;at&nbsp;these,&nbsp;since&nbsp;they'll&nbsp;have&nbsp;a&nbsp;much&nbsp;better&nbsp;idea&nbsp;of&nbsp;the&nbsp;impact&nbsp;any&nbsp;changes&nbsp;might&nbsp;have.&amp;nbsp;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;colleague&nbsp;is&nbsp;developing&nbsp;an&nbsp;iOS&nbsp;application,&nbsp;and&nbsp;another&nbsp;one&nbsp;is&nbsp;developing&nbsp;an&nbsp;erlang&nbsp;client.&nbsp;They&nbsp;don't&nbsp;have&nbsp;this&nbsp;problem,&nbsp;if&nbsp;they&nbsp;kill&nbsp;the&nbsp;app&nbsp;or&nbsp;turn&nbsp;of&nbsp;network&nbsp;connection,&nbsp;the&nbsp;connections&nbsp;on&nbsp;rabbitmq-server&nbsp;are&nbsp;cleared&amp;nbsp;immediately&nbsp;(2-4s).&nbsp;&lt;b&gt;They&nbsp;are&nbsp;not&nbsp;using&nbsp;any&nbsp;timeouts&nbsp;or&nbsp;heartbeats&lt;/b&gt;.&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Perhaps&nbsp;that's&nbsp;true&nbsp;at&nbsp;the&nbsp;application&nbsp;level,&nbsp;but&nbsp;it's&nbsp;entirely&nbsp;possible&nbsp;that&nbsp;at&nbsp;the&nbsp;OS&nbsp;level&nbsp;(on&nbsp;either&nbsp;client&nbsp;or&nbsp;server)&nbsp;they&nbsp;have&nbsp;configured&nbsp;the&nbsp;network&nbsp;stack&nbsp;to&nbsp;detect&nbsp;connection&nbsp;failures&nbsp;in&nbsp;a&nbsp;timely&nbsp;fashion.&nbsp;This&nbsp;could&nbsp;be&nbsp;the&nbsp;case&nbsp;either&nbsp;because&nbsp;they've&nbsp;explicitly&nbsp;tuned&nbsp;the&nbsp;kernel's&nbsp;TCP&nbsp;parameters&nbsp;themselves,&nbsp;or&nbsp;that&nbsp;their&nbsp;chosen&nbsp;OS&nbsp;provides&nbsp;different&nbsp;defaults&nbsp;to&nbsp;yours.&nbsp;If&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;case,&nbsp;it's&nbsp;also&nbsp;possible&nbsp;that&nbsp;intermediate&nbsp;network&nbsp;kit&nbsp;(such&nbsp;as&nbsp;routers,&nbsp;load&nbsp;balancers,&nbsp;proxies&nbsp;and&nbsp;firewalls)&nbsp;could&nbsp;be&nbsp;responsible&nbsp;for&nbsp;the&nbsp;timely&nbsp;detection&nbsp;of&nbsp;a&nbsp;closed&nbsp;socket.&lt;/div&gt;&lt;br&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Tim&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
