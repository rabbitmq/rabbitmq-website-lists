<tt>
&lt;html&gt;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;&lt;div&gt;Forwarded&nbsp;from&nbsp;the&nbsp;address&nbsp;I&nbsp;subscribed&nbsp;to&nbsp;the&nbsp;list&nbsp;with.&nbsp;:-/&lt;/div&gt;&lt;div&gt;&lt;br&gt;Begin&nbsp;forwarded&nbsp;message:&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;Jeremy&nbsp;Dunck&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jeremy@radiotime.com&quot;&gt;jeremy@radiotime.com&lt;/a&gt;&amp;gt;&lt;br&gt;&lt;b&gt;Date:&lt;/b&gt;&nbsp;January&nbsp;14,&nbsp;2010&nbsp;11:42:25&nbsp;PM&nbsp;CST&lt;br&gt;&lt;b&gt;To:&lt;/b&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;/a&gt;&lt;br&gt;&lt;b&gt;Cc:&lt;/b&gt;&nbsp;Thomas&nbsp;Hutchings&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:thomas@radiotime.com&quot;&gt;thomas@radiotime.com&lt;/a&gt;&amp;gt;&lt;br&gt;&lt;b&gt;Subject:&lt;/b&gt;&nbsp;&lt;b&gt;Messages&nbsp;not&nbsp;consistently&nbsp;delivered&nbsp;to&nbsp;two&nbsp;consumers&nbsp;bound&nbsp;to&nbsp;same&nbsp;key&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;span&gt;I'm&nbsp;using&nbsp;Rabbit&nbsp;1.7.0&nbsp;w/&nbsp;the&nbsp;.Net&nbsp;client.&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;I&nbsp;am&nbsp;publishing&nbsp;messages&nbsp;with&nbsp;a&nbsp;routing&nbsp;key,&nbsp;say&nbsp;&quot;A&quot;,&nbsp;and&nbsp;two&nbsp;queues&lt;/span&gt;&lt;br&gt;&lt;span&gt;bound&nbsp;to&nbsp;that&nbsp;routing&nbsp;key&nbsp;on&nbsp;a&nbsp;Direct&nbsp;exchange:&lt;/span&gt;&lt;br&gt;&lt;span&gt;_mqChannel.ExchangeDeclare(SHARED_EXCHANGE,&nbsp;ExchangeType.Direct,&nbsp;NOT_DURABLE);&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;(I've&nbsp;aliased&nbsp;the&nbsp;various&nbsp;boolean&nbsp;flags&nbsp;as&nbsp;variables&nbsp;so&nbsp;I&nbsp;can&nbsp;more&lt;/span&gt;&lt;br&gt;&lt;span&gt;easily&nbsp;maintain&nbsp;the&nbsp;code;&nbsp;I&nbsp;fnd&nbsp;a&nbsp;series&nbsp;of&nbsp;true/false&nbsp;literals&nbsp;pretty&lt;/span&gt;&lt;br&gt;&lt;span&gt;hard&nbsp;to&nbsp;remember.)&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;I&nbsp;then&nbsp;have&nbsp;a&nbsp;basic&nbsp;consumer&nbsp;on&nbsp;each&nbsp;of&nbsp;the&nbsp;queues&nbsp;dispatching.&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;It&nbsp;seems&nbsp;that&nbsp;messages&nbsp;published&nbsp;to&nbsp;A&nbsp;are&nbsp;being&nbsp;alternately&nbsp;delivered&lt;/span&gt;&lt;br&gt;&lt;span&gt;to&nbsp;the&nbsp;two&nbsp;queues,&nbsp;rather&nbsp;than&nbsp;consistently&nbsp;to&nbsp;both&nbsp;queues.&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;Here's&nbsp;how&nbsp;I'm&nbsp;declaring&nbsp;and&nbsp;binding&nbsp;the&nbsp;queues&nbsp;(in&nbsp;separate&nbsp;processes):&lt;/span&gt;&lt;br&gt;&lt;span&gt;_mqChannel.QueueDeclare(_busId,&nbsp;NOT_PASSIVE,&nbsp;NOT_DURABLE,&lt;/span&gt;&lt;br&gt;&lt;span&gt;NOT_EXCLUSIVE,&nbsp;AUTODELETE,&nbsp;WAIT,&nbsp;new&nbsp;Hashtable());&lt;/span&gt;&lt;br&gt;&lt;span&gt;_mqChannel.QueueBind(_busId,&nbsp;SHARED_EXCHANGE,&nbsp;&quot;A&quot;,&nbsp;WAIT,&nbsp;null);&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;I&nbsp;then&nbsp;have&nbsp;a&nbsp;basic&nbsp;consumer&nbsp;on&nbsp;each&nbsp;of&nbsp;the&nbsp;queues:&lt;/span&gt;&lt;br&gt;&lt;span&gt;var&nbsp;consumer&nbsp;=&nbsp;new&nbsp;QueueingBasicConsumer(_mqChannel);&lt;/span&gt;&lt;br&gt;&lt;span&gt;_mqChannel.BasicConsume(_busId,&nbsp;null,&nbsp;consumer);&lt;/span&gt;&lt;br&gt;&lt;span&gt;e&nbsp;=&nbsp;(BasicDeliverEventArgs)consumer.Queue.Dequeue();&lt;/span&gt;&lt;br&gt;&lt;span&gt;...&lt;/span&gt;&lt;br&gt;&lt;span&gt;If&nbsp;it&nbsp;matters,&nbsp;I'm&nbsp;acknowledging&nbsp;messages&nbsp;is&nbsp;*both*&nbsp;consumers&nbsp;as&nbsp;follows:&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;_mqChannel.BasicAck(e.DeliveryTag,&nbsp;false);&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;And&nbsp;here's&nbsp;how&nbsp;I'm&nbsp;publishing:&lt;/span&gt;&lt;br&gt;&lt;span&gt;_mqChannel.BasicPublish(SHARED_EXCHANGE,&nbsp;&quot;A&quot;,&nbsp;MANDATORY,&lt;/span&gt;&lt;br&gt;&lt;span&gt;NOT_IMMEDIATE,&nbsp;props,&nbsp;&amp;lt;bytes&amp;gt;);&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;I&nbsp;was&nbsp;wondering&nbsp;what&nbsp;might&nbsp;cause&nbsp;this&nbsp;behavior?&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;While&nbsp;I'm&nbsp;here,&nbsp;are&nbsp;there&nbsp;any&nbsp;semantics&nbsp;to&nbsp;DeliveryTag?&nbsp;&amp;nbsp;It&nbsp;appears&nbsp;to&lt;/span&gt;&lt;br&gt;&lt;span&gt;be&nbsp;a&nbsp;sequentially-incrementing&nbsp;number,&nbsp;but&nbsp;it's&nbsp;not&nbsp;for&nbsp;all&nbsp;messages&lt;/span&gt;&lt;br&gt;&lt;span&gt;published&nbsp;--&nbsp;is&nbsp;it&nbsp;per&nbsp;consumer?&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;Just&nbsp;when&nbsp;I&nbsp;think&nbsp;I've&nbsp;got&nbsp;the&nbsp;hang&nbsp;of&nbsp;Rabbit,&nbsp;I&nbsp;find&nbsp;I'm&nbsp;still&nbsp;on&lt;/span&gt;&lt;br&gt;&lt;span&gt;shaky&nbsp;ground.&nbsp;&amp;nbsp;:-/&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
