<tt>
&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,sans-serif&quot;&gt;Following&nbsp;up&nbsp;on&nbsp;this&nbsp;issue,&nbsp;the&nbsp;problem&nbsp;has&nbsp;worsened&nbsp;to&nbsp;a&nbsp;great&nbsp;extent.&nbsp;Here&amp;#39;s&nbsp;a&nbsp;bit&nbsp;more&nbsp;information&nbsp;about&nbsp;the&nbsp;setup.&lt;/font&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;Two&nbsp;brokers&nbsp;B1&nbsp;and&nbsp;B2,&nbsp;running&nbsp;version&nbsp;2.7.1&nbsp;and&nbsp;Erlang&nbsp;R14B04&nbsp;on&nbsp;Windows,&nbsp;about&nbsp;15000&nbsp;km&nbsp;away&nbsp;from&nbsp;each&nbsp;other.&nbsp;Both&nbsp;machines&nbsp;running&nbsp;the&nbsp;brokers&nbsp;are&nbsp;physical&nbsp;machines&nbsp;with&nbsp;several&nbsp;cores,&nbsp;lots&nbsp;of&nbsp;RAM,&nbsp;fast&nbsp;disks,&nbsp;and&nbsp;reported&nbsp;no&nbsp;problems&nbsp;in&nbsp;disk&nbsp;access,&nbsp;CPU&nbsp;or&nbsp;memory&nbsp;consumption. &lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;We&nbsp;have&nbsp;two&nbsp;federated&nbsp;durable&nbsp;topic&nbsp;exchanges&nbsp;X1&nbsp;and&nbsp;X2,&nbsp;the&nbsp;upstream&nbsp;connection&nbsp;to&nbsp;the&nbsp;other&nbsp;broker&nbsp;is&nbsp;configured&nbsp;with&nbsp;an&nbsp;hearbeat&nbsp;of&nbsp;a&nbsp;few&nbsp;seconds&nbsp;and&nbsp;the&nbsp;prefetch&nbsp;count&nbsp;is&nbsp;100.&nbsp;X1&nbsp;is&nbsp;bidirectionally&nbsp;federated&nbsp;with&nbsp;max_hops&nbsp;=&nbsp;1&nbsp;to&nbsp;prevent&nbsp;messages&nbsp;from&nbsp;going&nbsp;in&nbsp;loops&nbsp;(which&nbsp;nonetheless&nbsp;suffer&nbsp;the&nbsp;additional&nbsp;roundtrip&nbsp;before&nbsp;being&nbsp;discarded,&nbsp;a&nbsp;problem&nbsp;I&nbsp;reported&nbsp;a&nbsp;while&nbsp;ago),&nbsp;X2&nbsp;unidirectionally&nbsp;federated&nbsp;from&nbsp;B1&nbsp;to&nbsp;B2.&nbsp;Messages&nbsp;are&nbsp;all&nbsp;published&nbsp;on&nbsp;B1,&nbsp;all&nbsp;those&nbsp;published&nbsp;on&nbsp;X1&nbsp;are&nbsp;persistent,&nbsp;while&nbsp;those&nbsp;published&nbsp;on&nbsp;X2&nbsp;aren&amp;#39;t.&nbsp;Messages&nbsp;are&nbsp;published&nbsp;on&nbsp;X1&nbsp;with&nbsp;an&nbsp;average&nbsp;rate&nbsp;of&nbsp;3&nbsp;msg/sec,&nbsp;and&nbsp;on&nbsp;X2&nbsp;with&nbsp;an&nbsp;average&nbsp;rate&nbsp;of&nbsp;10&nbsp;msg/sec.&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;What&nbsp;we&nbsp;experienced&nbsp;is&nbsp;that&nbsp;messages&nbsp;published&nbsp;on&nbsp;X1&nbsp;queue&nbsp;up&nbsp;on&nbsp;the&nbsp;outgoing&nbsp;queue&nbsp;on&nbsp;B1,&nbsp;and&nbsp;even&nbsp;worse&nbsp;on&nbsp;the&nbsp;outgoing&nbsp;queue&nbsp;on&nbsp;B2&nbsp;(although&nbsp;we&nbsp;don&amp;#39;t&nbsp;care&nbsp;about&nbsp;them&nbsp;as&nbsp;the&nbsp;would&nbsp;be&nbsp;discarded&nbsp;once&nbsp;delivered&nbsp;thanks&nbsp;to&nbsp;the&nbsp;max_hops&nbsp;setting).&nbsp;Looking&nbsp;at&nbsp;the&nbsp;Web&nbsp;UI&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;acknowledges&nbsp;for&nbsp;those&nbsp;messages&nbsp;come&nbsp;in&nbsp;more&nbsp;slowly&nbsp;than&nbsp;messages&nbsp;are&nbsp;published,&nbsp;but&nbsp;I&nbsp;really&nbsp;can&amp;#39;t&nbsp;understand&nbsp;why&nbsp;this&nbsp;might&nbsp;be&nbsp;the&nbsp;case,&nbsp;given&nbsp;the&nbsp;very&nbsp;low&nbsp;publish&nbsp;rate.&nbsp;The&nbsp;visible&nbsp;effect&nbsp;is&nbsp;a&nbsp;delay&nbsp;of&nbsp;even&nbsp;several&nbsp;minutes&nbsp;between&nbsp;when&nbsp;a&nbsp;message&nbsp;is&nbsp;published&nbsp;on&nbsp;B1&nbsp;and&nbsp;received&nbsp;on&nbsp;B2,&nbsp;but&nbsp;again,&nbsp;only&nbsp;for&nbsp;the&nbsp;low-rate&nbsp;messages&nbsp;published&nbsp;on&nbsp;X1&nbsp;(perhaps&nbsp;even&nbsp;worse&nbsp;for&nbsp;the&nbsp;other&nbsp;direction&nbsp;if&nbsp;the&nbsp;messages&nbsp;were&nbsp;not&nbsp;thrown&nbsp;away&nbsp;by&nbsp;the&nbsp;federation&nbsp;because&nbsp;of&nbsp;the&nbsp;max_hops&nbsp;setting,&nbsp;as&nbsp;the&nbsp;outgoing&nbsp;queue&nbsp;on&nbsp;B2&nbsp;has&nbsp;several&nbsp;thousands&nbsp;of&nbsp;messages&nbsp;versus&nbsp;the&nbsp;few&nbsp;hundreds&nbsp;of&nbsp;that&nbsp;on&nbsp;B1).&nbsp;In&nbsp;other&nbsp;words,&nbsp;the&nbsp;only&nbsp;difference&nbsp;between&nbsp;the&nbsp;two&nbsp;federated&nbsp;exchanges&nbsp;appears&nbsp;to&nbsp;be&nbsp;the&nbsp;bidirectionality&nbsp;of&nbsp;the&nbsp;first&nbsp;versus&nbsp;the&nbsp;unidirectionality&nbsp;of&nbsp;the&nbsp;second&nbsp;and&nbsp;the&nbsp;fact&nbsp;that&nbsp;those&nbsp;published&nbsp;on&nbsp;the&nbsp;first&nbsp;are&nbsp;persistent.&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&amp;#39;trebuchet&nbsp;ms&amp;#39;,sans-serif&quot;&gt;The&nbsp;logs&nbsp;of&nbsp;the&nbsp;two&nbsp;brokers&nbsp;contain&nbsp;apparently&nbsp;no&nbsp;relevant&nbsp;information,&nbsp;and&nbsp;the&nbsp;network&nbsp;link&nbsp;between&nbsp;the&nbsp;two&nbsp;has&nbsp;always&nbsp;appeared&nbsp;to&nbsp;be&nbsp;in&nbsp;a&nbsp;good&nbsp;state.&lt;/span&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;Any&nbsp;help&nbsp;is&nbsp;appreciated&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Mar&nbsp;17,&nbsp;2012&nbsp;at&nbsp;05:09,&nbsp;Busoli,&nbsp;Simone&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:Simone.Busoli@ferrari.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Simone.Busoli@ferrari.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;div&nbsp;lang=&quot;EN-US&quot;&nbsp;link=&quot;blue&quot;&nbsp;vlink=&quot;purple&quot;&gt;<br>
&lt;div&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;font&nbsp;face=&quot;Calibri&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11.0pt&quot;&gt;Hello,&nbsp;I’ve&nbsp;experienced&nbsp;an&nbsp;unexpected&nbsp;behavior&nbsp;with&nbsp;a&nbsp;federated&nbsp;exchange&nbsp;whereby&nbsp;messages&nbsp;would&nbsp;build-up&nbsp;on&nbsp;the&nbsp;upstream&nbsp;queue&nbsp;for&nbsp;no&nbsp;apparent&nbsp;reasons.&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;font&nbsp;face=&quot;Calibri&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11.0pt&quot;&gt;The&nbsp;network&nbsp;link&nbsp;seemed&nbsp;ok,&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;two&nbsp;machines&nbsp;on&nbsp;which&nbsp;the&nbsp;brokers&nbsp;are&nbsp;installed.&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;font&nbsp;face=&quot;Calibri&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11.0pt&quot;&gt;I&nbsp;would&nbsp;like&nbsp;to&nbsp;know&nbsp;under&nbsp;which&nbsp;circumstances&nbsp;the&nbsp;federation&nbsp;plugin&nbsp;on&nbsp;the&nbsp;downstream&nbsp;would&nbsp;slowdown&nbsp;pulling&nbsp;messages&nbsp;from&nbsp;the&nbsp;upstream.&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;font&nbsp;face=&quot;Calibri&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11.0pt&quot;&gt;&lt;u&gt;&lt;/u&gt; &lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;font&nbsp;face=&quot;Calibri&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11.0pt&quot;&gt;Thanks&lt;u&gt;&lt;/u&gt;&lt;u&gt;&lt;/u&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;p&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;_________________________________________________________________________________________________________________&lt;br&gt;Questo&nbsp;messaggio&nbsp;e&nbsp;da&nbsp;intendersi&nbsp;esclusivamente&nbsp;ad&nbsp;uso&nbsp;del&nbsp;destinatario&nbsp;e&nbsp;puo&nbsp;contenere&nbsp;informazioni&nbsp;che&nbsp;sono&nbsp;di&nbsp;natura&nbsp;privilegiata,&nbsp;confidenziale&lt;br&gt;<br>
<br>
<br>
o&nbsp;non&nbsp;divulgabile&nbsp;secondo&nbsp;le&nbsp;leggi&nbsp;vigenti.&nbsp;Se&nbsp;il&nbsp;lettore&nbsp;del&nbsp;presente&nbsp;messaggio&nbsp;non&nbsp;e&nbsp;il&nbsp;destinatario&nbsp;designato,&nbsp;o&nbsp;il&nbsp;dipendente/agente&nbsp;responsabile&lt;br&gt;per&nbsp;la&nbsp;consegna&nbsp;del&nbsp;messaggio&nbsp;al&nbsp;destinatario&nbsp;designato,&nbsp;si&nbsp;informa&nbsp;che&nbsp;ogni&nbsp;disseminazione,&nbsp;distribuzione&nbsp;o&nbsp;copiatura&nbsp;di&nbsp;questa&nbsp;comunicazione&nbsp;e&nbsp;&lt;br&gt;<br>
<br>
<br>
strettamente&nbsp;proibita&nbsp;anche&nbsp;ai&nbsp;sensi&nbsp;del&nbsp;decreto&nbsp;legislativo&nbsp;196/03&nbsp;.&nbsp;Se&nbsp;avete&nbsp;ricevuto&nbsp;questo&nbsp;messaggio&nbsp;per&nbsp;errore,&nbsp;vi&nbsp;preghiamo&nbsp;di&nbsp;notificarcelo&lt;br&gt;immediatamente&nbsp;a&nbsp;mezzo&nbsp;e-mail&nbsp;di&nbsp;risposta&nbsp;e&nbsp;successivamente&nbsp;di&nbsp;procedere&nbsp;alla&nbsp;cancellazione&nbsp;di&nbsp;questa&nbsp;e-mail&nbsp;e&nbsp;relativi&nbsp;allegati&nbsp;dal&nbsp;vostro&nbsp;sistema.&lt;br&gt;<br>
<br>
<br>
_________________________________________________________________________________________________________________&lt;br&gt;This&nbsp;message&nbsp;is&nbsp;intended&nbsp;only&nbsp;for&nbsp;the&nbsp;use&nbsp;of&nbsp;the&nbsp;addressee&nbsp;and&nbsp;may&nbsp;contain&nbsp;information&nbsp;that&nbsp;is&nbsp;privileged,&nbsp;confidential&nbsp;and&nbsp;exempt&nbsp;from&nbsp;&lt;br&gt;<br>
<br>
<br>
disclosure&nbsp;under&nbsp;applicable&nbsp;law.&nbsp;If&nbsp;the&nbsp;reader&nbsp;of&nbsp;this&nbsp;message&nbsp;is&nbsp;not&nbsp;the&nbsp;intended&nbsp;recipient,&nbsp;or&nbsp;the&nbsp;employee&nbsp;or&nbsp;agent&nbsp;responsible&nbsp;for&nbsp;delivering&nbsp;the&nbsp;&lt;br&gt;message&nbsp;to&nbsp;the&nbsp;intended&nbsp;recipient,&nbsp;you&nbsp;are&nbsp;hereby&nbsp;notified&nbsp;that&nbsp;any&nbsp;dissemination,&nbsp;distribution&nbsp;or&nbsp;copying&nbsp;of&nbsp;this&nbsp;communication&nbsp;is&nbsp;strictly&nbsp;&lt;br&gt;<br>
<br>
<br>
prohibited.&nbsp;If&nbsp;you&nbsp;have&nbsp;received&nbsp;this&nbsp;e-mail&nbsp;in&nbsp;error,&nbsp;please&nbsp;notify&nbsp;us&nbsp;immediately&nbsp;by&nbsp;return&nbsp;e-mail&nbsp;and&nbsp;delete&nbsp;this&nbsp;e-mail&nbsp;and&nbsp;all&nbsp;attachments&nbsp;from&nbsp;&lt;br&gt;your&nbsp;system.&lt;br&gt;_________________________________________________________________________________________________________________&lt;br&gt;<br>
<br>
<br>
&lt;/font&gt;&lt;/p&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
