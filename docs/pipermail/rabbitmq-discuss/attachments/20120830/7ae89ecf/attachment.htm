<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;30&nbsp;Aug&nbsp;2012,&nbsp;at&nbsp;15:08,&nbsp;gerhard&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Running&nbsp;a&nbsp;rabbitmq&nbsp;cluster&nbsp;makes&nbsp;rabbitmq&nbsp;extremely&nbsp;unstable.&nbsp;I&nbsp;have&nbsp;a&nbsp;very&nbsp;simple,&nbsp;2&nbsp;nodes&nbsp;setup&nbsp;(both&nbsp;disc)&nbsp;for&nbsp;HA&nbsp;purposes.&nbsp;The&nbsp;most&nbsp;important&nbsp;queues&nbsp;have&nbsp;the&nbsp;HA&nbsp;flag&nbsp;ensuring&nbsp;they&nbsp;get&nbsp;replicated&nbsp;on&nbsp;both&nbsp;nodes&nbsp;so&nbsp;that&nbsp;if&nbsp;one&nbsp;goes&nbsp;down,&nbsp;the&nbsp;clients&nbsp;can&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;other&nbsp;one&nbsp;and&nbsp;continue&nbsp;consuming&nbsp;messages&nbsp;as&nbsp;if&nbsp;nothing&nbsp;happened.&nbsp;In&nbsp;theory,&nbsp;it&nbsp;sounds&nbsp;perfect,&nbsp;but&nbsp;in&nbsp;practice&nbsp;it's&nbsp;such&nbsp;a&nbsp;pain!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;shouldn't&nbsp;be&nbsp;the&nbsp;case,&nbsp;obviously.&nbsp;From&nbsp;the&nbsp;sounds&nbsp;of&nbsp;things,&nbsp;the&nbsp;issues&nbsp;you're&nbsp;experiencing&nbsp;are&nbsp;to&nbsp;do&nbsp;with&nbsp;HA,&nbsp;rather&nbsp;than&nbsp;clustering,&nbsp;which&nbsp;in&nbsp;and&nbsp;of&nbsp;itself&nbsp;is&nbsp;not&nbsp;just&nbsp;an&nbsp;HA&nbsp;feature.&amp;nbsp;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;If&nbsp;one&nbsp;node&nbsp;goes&nbsp;down,&nbsp;the&nbsp;performance&nbsp;of&nbsp;the&nbsp;remaining&nbsp;node&nbsp;gets&nbsp;seriously&nbsp;affected.&nbsp;Everything&nbsp;slows&nbsp;down,&nbsp;on&nbsp;occasions&nbsp;the&nbsp;broker&nbsp;just&nbsp;crashes.&nbsp;Any&nbsp;rabbitmqctl&nbsp;commands&nbsp;on&nbsp;the&nbsp;remaing&nbsp;node&nbsp;take&nbsp;30seconds+&nbsp;if&nbsp;the&nbsp;node&nbsp;is&nbsp;relatively&nbsp;quiet.&nbsp;Resetting&nbsp;the&nbsp;cluster&nbsp;doesn't&nbsp;work&nbsp;without&nbsp;a&nbsp;force_reset,&nbsp;I&nbsp;keep&nbsp;getting&nbsp;the&amp;nbsp;&lt;b&gt;no_running_cluster_nodes&lt;/b&gt;&nbsp;error.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;not&nbsp;normal&nbsp;behaviour.&nbsp;In&nbsp;a&nbsp;two&nbsp;node&nbsp;cluster&nbsp;with&nbsp;HA&nbsp;enabled,&nbsp;there&nbsp;will&nbsp;be&nbsp;*some*&nbsp;performance&nbsp;degradation&nbsp;during&nbsp;failover,&nbsp;as&nbsp;the&nbsp;remaining&nbsp;node&nbsp;has&nbsp;a&nbsp;lot&nbsp;of&nbsp;work&nbsp;to&nbsp;do,&nbsp;but&nbsp;this&nbsp;'slow&nbsp;down'&nbsp;should&nbsp;not&nbsp;last&nbsp;for&nbsp;too&nbsp;long,&nbsp;the&nbsp;broker&nbsp;should&nbsp;not&nbsp;crash&nbsp;and&nbsp;rabbitmqctl&nbsp;should&nbsp;not&nbsp;keep&nbsp;taking&nbsp;30+&nbsp;seconds&nbsp;to&nbsp;complete&nbsp;commands&nbsp;once&nbsp;things&nbsp;have&nbsp;evened&nbsp;out&nbsp;a&nbsp;bit.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;*sounds*&nbsp;to&nbsp;me&nbsp;like&nbsp;your&nbsp;problems&nbsp;are&nbsp;worth&nbsp;investigating,&nbsp;but&nbsp;we'll&nbsp;need&nbsp;some&nbsp;more&nbsp;information&nbsp;to&nbsp;go&nbsp;on.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&amp;nbsp;How&nbsp;often&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;nodes&nbsp;failing?&nbsp;This&nbsp;(obviously)&nbsp;shouldn't&nbsp;happen&nbsp;very&nbsp;often.&amp;nbsp;&lt;/div&gt;&lt;div&gt;-&nbsp;What&nbsp;is&nbsp;causing&nbsp;one&nbsp;of&nbsp;the&nbsp;nodes&nbsp;to&nbsp;fail?&nbsp;Is&nbsp;it&nbsp;a&nbsp;rabbit&nbsp;crash,&nbsp;or&nbsp;something&nbsp;else&nbsp;(external&nbsp;to&nbsp;the&nbsp;broker)?&lt;/div&gt;&lt;div&gt;-&nbsp;What&nbsp;kind&nbsp;of&nbsp;load&nbsp;is&nbsp;the&nbsp;system&nbsp;(i.e.,&nbsp;the&nbsp;broker)&nbsp;under&nbsp;whilst&nbsp;failover&nbsp;takes&nbsp;place?&lt;/div&gt;&lt;div&gt;-&nbsp;How&nbsp;many&nbsp;HA&nbsp;queues&nbsp;do&nbsp;you&nbsp;have&nbsp;and&nbsp;how&nbsp;many&nbsp;exchanges&nbsp;+&nbsp;bindings&nbsp;around&nbsp;these?&lt;/div&gt;&lt;div&gt;-&nbsp;Are&nbsp;the&nbsp;machines&nbsp;on&nbsp;the&nbsp;same&nbsp;LAN,&nbsp;Subnet,&nbsp;etc.&nbsp;Any&nbsp;specific&nbsp;network&nbsp;kit&nbsp;in&nbsp;between&nbsp;them?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;can&nbsp;post&nbsp;the&nbsp;logs&nbsp;(and&nbsp;sasl&nbsp;logs)&nbsp;from&nbsp;both&nbsp;brokers&nbsp;and&nbsp;`rabbitmqctl&nbsp;report`&nbsp;output,&nbsp;that&nbsp;would&nbsp;also&nbsp;be&nbsp;very&nbsp;helpful.&nbsp;If&nbsp;you're&nbsp;able&nbsp;to&nbsp;provide&nbsp;a&nbsp;minimal&nbsp;example&nbsp;(written,&nbsp;scripted&nbsp;or&nbsp;whatever)&nbsp;then&nbsp;that&nbsp;would&nbsp;also&nbsp;enable&nbsp;us&nbsp;to&nbsp;diagnose&nbsp;and&nbsp;fix&nbsp;any&nbsp;problems&nbsp;more&nbsp;rapidly.&nbsp;Any&nbsp;other&nbsp;diagnostic&nbsp;information&nbsp;would&nbsp;also&nbsp;be&nbsp;useful&nbsp;(info&nbsp;on&nbsp;CPU,&nbsp;memory,&nbsp;network&nbsp;and&nbsp;disk&nbsp;usage&nbsp;on&nbsp;the&nbsp;given&nbsp;nodes&nbsp;for&nbsp;example).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;Is&nbsp;anyone&nbsp;else&nbsp;having&nbsp;the&nbsp;same&nbsp;issues&nbsp;with&nbsp;RabbitMQ&nbsp;clustering?&nbsp;As&nbsp;it&nbsp;stands,&nbsp;it's&nbsp;pretty&nbsp;unusable.&nbsp;I'm&nbsp;running&amp;nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(72,&nbsp;72,&nbsp;72);&nbsp;font-family:&nbsp;Verdana,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12px;&nbsp;&quot;&gt;RabbitMQ&amp;nbsp;&lt;/span&gt;&lt;b&nbsp;style=&quot;color:&nbsp;black;&nbsp;font-weight:&nbsp;normal;&nbsp;font-family:&nbsp;Verdana,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12px;&nbsp;&quot;&gt;2.8.6&lt;/b&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(72,&nbsp;72,&nbsp;72);&nbsp;font-family:&nbsp;Verdana,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12px;&nbsp;&quot;&gt;&amp;nbsp;on&nbsp;Erlang&amp;nbsp;&lt;/span&gt;&lt;b&nbsp;style=&quot;color:&nbsp;black;&nbsp;font-family:&nbsp;Verdana,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12px;&nbsp;font-weight:&nbsp;normal;&nbsp;&quot;&gt;R13B03&nbsp;under&nbsp;Ubuntu&nbsp;10.04.03&nbsp;64bit,&nbsp;installed&nbsp;via&nbsp;the&nbsp;official&amp;nbsp;&lt;/b&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;11.80555534362793px;&quot;&gt;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/debian/dists/testing/&quot;&gt;http://www.rabbitmq.com/debian/dists/testing/&lt;/a&gt;&lt;/span&gt;&lt;/font&gt;&lt;b&nbsp;style=&quot;color:&nbsp;black;&nbsp;font-family:&nbsp;Verdana,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12px;&nbsp;font-weight:&nbsp;normal;&nbsp;&quot;&gt;&amp;nbsp;packages.&lt;/b&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We've&nbsp;seen&nbsp;a&nbsp;few&nbsp;bugs&nbsp;in&nbsp;the&nbsp;HA&nbsp;code&nbsp;which&nbsp;can&nbsp;crop&nbsp;up&nbsp;under&nbsp;very&nbsp;specific&nbsp;circumstances&nbsp;and&nbsp;we've&nbsp;fixed&nbsp;most&nbsp;of&nbsp;them,&nbsp;released&nbsp;many&nbsp;of&nbsp;the&nbsp;fixes&nbsp;and&nbsp;are&nbsp;trying&nbsp;to&nbsp;get&nbsp;the&nbsp;remaining&nbsp;fixes&nbsp;completed&nbsp;and&nbsp;released&nbsp;asap.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please&nbsp;also&nbsp;note&nbsp;that&nbsp;we&nbsp;*highly*&nbsp;recommend&nbsp;upgrading&nbsp;to&nbsp;the&nbsp;latest&nbsp;Erlang/OTP&nbsp;release&nbsp;if&nbsp;possible&nbsp;(R15B01&nbsp;at&nbsp;this&nbsp;time),&nbsp;as&nbsp;R13&nbsp;is&nbsp;quite&nbsp;old&nbsp;and&nbsp;a&nbsp;lot&nbsp;of&nbsp;fixes&nbsp;and&nbsp;performance&nbsp;improvements&nbsp;have&nbsp;gone&nbsp;into&nbsp;the&nbsp;VM&nbsp;since&nbsp;then.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Tim&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
