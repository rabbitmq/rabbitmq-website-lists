<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;14px;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;&lt;div&gt;We're&nbsp;moving&nbsp;towards&nbsp;a&nbsp;production&nbsp;deployment&nbsp;of&nbsp;mirrored&nbsp;queues&nbsp;for&nbsp;our&nbsp;platform&nbsp;using&nbsp;RabbitMQ&nbsp;2.71&nbsp;on&nbsp;Ubuntu&nbsp;10.04.&amp;nbsp;One&nbsp;of&nbsp;the&nbsp;things&nbsp;we&nbsp;need&nbsp;to&nbsp;support&nbsp;is&nbsp;rolling&nbsp;upgrades.&nbsp;Thus,&nbsp;while&nbsp;running&nbsp;in&nbsp;a&nbsp;mirrored&nbsp;cluster,&nbsp;we&nbsp;plan&nbsp;to&nbsp;bring&nbsp;down&nbsp;one&nbsp;node&nbsp;at&nbsp;a&nbsp;time&nbsp;while&nbsp;leaving&nbsp;at&nbsp;least&nbsp;one&nbsp;node&nbsp;running.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;potential&nbsp;problem&nbsp;arises&nbsp;in&nbsp;that&nbsp;our&nbsp;queue&nbsp;client&nbsp;may&nbsp;drain&nbsp;the&nbsp;queue&nbsp;very&nbsp;slowly,&nbsp;e.g.,&nbsp;a&nbsp;single&nbsp;message&nbsp;may&nbsp;take&nbsp;hours&nbsp;to&nbsp;execute,&nbsp;and&nbsp;we&nbsp;only&nbsp;process&nbsp;one&nbsp;message&nbsp;at&nbsp;a&nbsp;time&nbsp;per&nbsp;client.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After&nbsp;completing&nbsp;the&nbsp;maintenance&nbsp;on&nbsp;a&nbsp;node&nbsp;and&nbsp;having&nbsp;it&nbsp;rejoin&nbsp;the&nbsp;cluster,&nbsp;it&nbsp;might&nbsp;be&nbsp;a&nbsp;long&nbsp;time&nbsp;before&nbsp;the&nbsp;queues&nbsp;are&nbsp;synched&nbsp;again.&nbsp;&amp;nbsp;(I'm&nbsp;aware&nbsp;that&nbsp;there's&nbsp;no&nbsp;eager&nbsp;synchronization,&nbsp;and&nbsp;that&nbsp;message&nbsp;synchronization&nbsp;occurs&nbsp;only&nbsp;on&nbsp;message&nbsp;publish.)&amp;nbsp;As&nbsp;a&nbsp;workaround&nbsp;to&nbsp;speed&nbsp;up&nbsp;synchronization,&nbsp;I'm&nbsp;thinking&nbsp;of&nbsp;a&nbsp;small&nbsp;&quot;synchronize&nbsp;now&quot;&nbsp;app&nbsp;that&nbsp;transactionally&nbsp;reads&nbsp;all&nbsp;current&nbsp;messages&nbsp;from&nbsp;the&nbsp;master's&nbsp;queue&nbsp;and&nbsp;republishes&nbsp;them.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Our&nbsp;code&nbsp;is&nbsp;designed&nbsp;to&nbsp;handle&nbsp;duplicate&nbsp;messages,&nbsp;but&nbsp;we&nbsp;really&nbsp;want&nbsp;to&nbsp;avoid&nbsp;losing&nbsp;messages.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Questions:&nbsp;Are&nbsp;there&nbsp;any&nbsp;potential&nbsp;pitfalls&nbsp;with&nbsp;this&nbsp;approach?&nbsp;And&nbsp;is&nbsp;there&nbsp;some&nbsp;optimal&nbsp;way&nbsp;to&nbsp;do&nbsp;this&nbsp;that's&nbsp;better&nbsp;than&nbsp;&quot;read/re-publish/ack&quot;&nbsp;&amp;nbsp;for&nbsp;each&nbsp;message&nbsp;in&nbsp;a&nbsp;loop?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Matt&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;<br>

</tt>
