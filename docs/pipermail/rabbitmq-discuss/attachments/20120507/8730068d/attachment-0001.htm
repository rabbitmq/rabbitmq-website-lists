<tt>
Hi&nbsp;Simon,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yup,&nbsp;I&nbsp;spotted&nbsp;that&nbsp;just&nbsp;after&nbsp;posting.&nbsp;It&nbsp;now&nbsp;reads:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;...&lt;br&gt;rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;stop_app&lt;br&gt;rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;reset&lt;br&gt;rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;cluster&nbsp;rabbit1@dfooks-ubuntu64&nbsp;rabbit2@dfooks-ubuntu64&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;start_app&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;after&nbsp;that&nbsp;fix&nbsp;I&amp;#39;m&nbsp;still&nbsp;seeing&nbsp;the&nbsp;same&nbsp;error.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;the&nbsp;tip&nbsp;on&nbsp;RABBITMQ_PID_FILE&nbsp;(it&nbsp;should&nbsp;be&nbsp;documented&nbsp;that&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;work&nbsp;with&nbsp;-detached).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;4&nbsp;May&nbsp;2012&nbsp;18:00,&nbsp;Simon&nbsp;MacMullen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
On&nbsp;04/05/12&nbsp;17:46,&nbsp;David&nbsp;Fooks&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
I&amp;#39;m&nbsp;trying&nbsp;to&nbsp;emulate&nbsp;the&nbsp;guide&nbsp;here:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/clustering.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.rabbitmq.com/&lt;u&gt;&lt;/u&gt;clustering.html&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
But&nbsp;I&amp;#39;m&nbsp;having&nbsp;a&nbsp;lot&nbsp;of&nbsp;issues!&nbsp;Every&nbsp;time&nbsp;I&nbsp;run&nbsp;I&nbsp;seem&nbsp;to&nbsp;be&nbsp;getting&nbsp;a&lt;br&gt;<br>
different&nbsp;crash.&nbsp;Is&nbsp;this&nbsp;feature&nbsp;actually&nbsp;supported&nbsp;in&nbsp;2.8.1?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Yes!&nbsp;But&nbsp;running&nbsp;a&nbsp;cluster&nbsp;on&nbsp;a&nbsp;single&nbsp;machine&nbsp;is&nbsp;more&nbsp;fiddly&nbsp;than&nbsp;running&nbsp;it&nbsp;on&nbsp;separate&nbsp;machines&nbsp;as&nbsp;you&nbsp;need&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;nodes&nbsp;don&amp;#39;t&nbsp;tread&nbsp;on&nbsp;each&nbsp;other.&nbsp;I&nbsp;don&amp;#39;t&nbsp;think&nbsp;that&amp;#39;s&nbsp;your&nbsp;problem&nbsp;though.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Is&nbsp;there&nbsp;a&nbsp;proper&nbsp;way&nbsp;to&nbsp;completely&nbsp;reset&nbsp;all&nbsp;of&nbsp;the&nbsp;state&nbsp;that&nbsp;rabbitmq&lt;br&gt;<br>
creates&nbsp;about&nbsp;other&nbsp;nodes/the&nbsp;cluster?&nbsp;My&nbsp;clean&nbsp;up&nbsp;script&nbsp;at&nbsp;the&nbsp;moment&lt;br&gt;<br>
looks&nbsp;like&nbsp;this:&lt;br&gt;<br>
&lt;br&gt;<br>
rm&nbsp;/var/run/rabbitmq/*&lt;br&gt;<br>
rm&nbsp;-f&nbsp;/var/log/rabbitmq/*&lt;br&gt;<br>
rm&nbsp;-rf&nbsp;/var/lib/rabbitmq/*&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
OK,&nbsp;that&nbsp;should&nbsp;be&nbsp;fine.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Here&nbsp;is&nbsp;my&nbsp;start-up&nbsp;script&nbsp;(I&amp;#39;m&nbsp;running&nbsp;this&nbsp;with&nbsp;sudo):&lt;br&gt;<br>
&lt;br&gt;<br>
RABBITMQ_NODE_PORT=5672&nbsp;RABBITMQ_NODENAME=rabbit1&lt;br&gt;<br>
RABBITMQ_SERVER_START_ARGS=&amp;quot;-&lt;u&gt;&lt;/u&gt;rabbitmq_mochiweb&nbsp;listeners&lt;br&gt;<br>
[{mgmt,[{port,55672}]}]&amp;quot;&nbsp;rabbitmq-server&nbsp;-detached&lt;br&gt;<br>
RABBITMQ_NODE_PORT=5673&nbsp;RABBITMQ_NODENAME=rabbit2&lt;br&gt;<br>
RABBITMQ_SERVER_START_ARGS=&amp;quot;-&lt;u&gt;&lt;/u&gt;rabbitmq_mochiweb&nbsp;listeners&lt;br&gt;<br>
[{mgmt,[{port,55673}]}]&amp;quot;&nbsp;rabbitmq-server&nbsp;-detached&lt;br&gt;<br>
RABBITMQ_NODE_PORT=5674&nbsp;RABBITMQ_NODENAME=rabbit3&lt;br&gt;<br>
RABBITMQ_SERVER_START_ARGS=&amp;quot;-&lt;u&gt;&lt;/u&gt;rabbitmq_mochiweb&nbsp;listeners&lt;br&gt;<br>
[{mgmt,[{port,55674}]}]&amp;quot;&nbsp;rabbitmq-server&nbsp;-detached&lt;br&gt;<br>
&lt;br&gt;<br>
ps&nbsp;-ef&nbsp;|&nbsp;grep&nbsp;rabbit1&nbsp;|&nbsp;grep&nbsp;-v&nbsp;grep&nbsp;|&nbsp;awk&nbsp;&amp;#39;{print&nbsp;$2}&amp;#39;&nbsp;&amp;gt;&lt;br&gt;<br>
/var/run/rabbitmq/rabbit1.pid&lt;br&gt;<br>
ps&nbsp;-ef&nbsp;|&nbsp;grep&nbsp;rabbit2&nbsp;|&nbsp;grep&nbsp;-v&nbsp;grep&nbsp;|&nbsp;awk&nbsp;&amp;#39;{print&nbsp;$2}&amp;#39;&nbsp;&amp;gt;&lt;br&gt;<br>
/var/run/rabbitmq/rabbit2.pid&lt;br&gt;<br>
ps&nbsp;-ef&nbsp;|&nbsp;grep&nbsp;rabbit3&nbsp;|&nbsp;grep&nbsp;-v&nbsp;grep&nbsp;|&nbsp;awk&nbsp;&amp;#39;{print&nbsp;$2}&amp;#39;&nbsp;&amp;gt;&lt;br&gt;<br>
/var/run/rabbitmq/rabbit3.pid&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Ew,&nbsp;those&nbsp;ps&amp;#39;es&nbsp;are&nbsp;not&nbsp;nice.&nbsp;You&nbsp;may&nbsp;prefer&nbsp;to&nbsp;set&nbsp;RABBITMQ_PID_FILE&nbsp;for&nbsp;each&nbsp;startup,&nbsp;although&nbsp;this&nbsp;means&nbsp;you&nbsp;cannot&nbsp;use&nbsp;-detached&nbsp;(instead&nbsp;just&nbsp;background&nbsp;it&nbsp;with&nbsp;&amp;amp;)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit1&nbsp;wait&nbsp;/var/run/rabbitmq/rabbit1.pid&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit2&nbsp;wait&nbsp;/var/run/rabbitmq/rabbit2.pid&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;wait&nbsp;/var/run/rabbitmq/rabbit3.pid&lt;br&gt;<br>
&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit1&nbsp;stop_app&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit1&nbsp;reset&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit1&nbsp;start_app&lt;br&gt;<br>
&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit2&nbsp;stop_app&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit2&nbsp;reset&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit2&nbsp;start_app&lt;br&gt;<br>
&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;stop_app&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;reset&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;start_app&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit1&nbsp;status&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit2&nbsp;status&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;status&lt;br&gt;<br>
&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;stop_app&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;cluster&nbsp;rabbit1@dfooks-ubuntu64&lt;br&gt;<br>
rabbit2@dfooks-ubuntu64&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;start_app&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
But&nbsp;here&amp;#39;s&nbsp;the&nbsp;problem.&nbsp;You&nbsp;need&nbsp;to&nbsp;do:&lt;br&gt;<br>
&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;stop_app&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;reset&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;cluster&nbsp;rabbit1@dfooks-ubuntu64&nbsp;\&lt;br&gt;<br>
&nbsp; &nbsp; rabbit2@dfooks-ubuntu64&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;start_app&lt;br&gt;<br>
&lt;br&gt;<br>
Instead&nbsp;you&nbsp;are&nbsp;doing&nbsp;something&nbsp;like&nbsp;(considering&nbsp;only&nbsp;rabbit3):&lt;br&gt;<br>
&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;stop_app&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;reset&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;start_app&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;stop_app&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;cluster&nbsp;rabbit1@dfooks-ubuntu64&nbsp;\&lt;br&gt;<br>
&nbsp; &nbsp; rabbit2@dfooks-ubuntu64&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;rabbit3&nbsp;start_app&lt;br&gt;<br>
&lt;br&gt;<br>
Clustering&nbsp;can&nbsp;only&nbsp;take&nbsp;place&nbsp;when&nbsp;the&nbsp;state&nbsp;is&nbsp;*completely*&nbsp;reset&nbsp;-&nbsp;the&nbsp;fact&nbsp;that&nbsp;you&nbsp;are&nbsp;starting&nbsp;and&nbsp;stopping&nbsp;the&nbsp;app&nbsp;again&nbsp;between&nbsp;reset&nbsp;and&nbsp;cluster&nbsp;is&nbsp;recreating&nbsp;a&nbsp;blank&nbsp;database...&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;lt;snip&amp;gt;&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
{merge_schema_failed,&nbsp;&amp;quot;Incompatible&nbsp;schema&nbsp;cookies.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&amp;lt;snip&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
...which&nbsp;is&nbsp;exactly&nbsp;what&nbsp;would&nbsp;lead&nbsp;to&nbsp;this&nbsp;error&nbsp;message.&lt;br&gt;<br>
&lt;br&gt;<br>
And&nbsp;yes,&nbsp;at&nbsp;some&nbsp;point&nbsp;we&nbsp;hope&nbsp;to&nbsp;make&nbsp;clustering&nbsp;easier&nbsp;to&nbsp;use.&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&nbsp;Simon&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Simon&nbsp;MacMullen&lt;br&gt;<br>
RabbitMQ,&nbsp;VMware&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
