<tt>
I&amp;#39;ve&nbsp;built&nbsp;a&nbsp;behavior&nbsp;in&nbsp;erlang&nbsp;to&nbsp;subscribe&nbsp;to&nbsp;a&nbsp;given&nbsp;topic&nbsp;exchange&nbsp;and&nbsp;farm&nbsp;out&nbsp;message&nbsp;handling.&nbsp; I&amp;#39;m&nbsp;using&nbsp;the&nbsp;rabbitmq&nbsp;amqp_client&nbsp;library&nbsp;for&nbsp;erlang&nbsp;and&nbsp;when&nbsp;I&nbsp;put&nbsp;the&nbsp;system&nbsp;under&nbsp;heavy&nbsp;load&nbsp;I&nbsp;get,&nbsp;on&nbsp;occasion,&nbsp;the&nbsp;following&nbsp;error:&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;=ERROR&nbsp;REPORT====&nbsp;29-Jun-2011::18:02:18&nbsp;===&lt;/div&gt;&lt;div&gt;**&nbsp;Generic&nbsp;server&nbsp;&amp;lt;0.1117.0&amp;gt;&nbsp;terminating &lt;/div&gt;&lt;div&gt;**&nbsp;Last&nbsp;message&nbsp;in&nbsp;was&nbsp;{&amp;#39;$gen_cast&amp;#39;,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{method,&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&amp;#39;channel.close&amp;#39;,406,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;lt;&amp;lt;&amp;quot;PRECONDITION_FAILED&nbsp;-&nbsp;unknown&nbsp;delivery&nbsp;tag&nbsp;856&amp;quot;&amp;gt;&amp;gt;,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;60,80},&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;none}}&lt;/div&gt;&lt;div&gt;**&nbsp;When&nbsp;Server&nbsp;state&nbsp;==&nbsp;{state,1,&amp;lt;0.1116.0&amp;gt;,network,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[]},&lt;/div&gt;&lt;div&gt;<br>
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{dict,0,16,16,8,80,48,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[],[],[],[],[],[],[],[],[],[],[],[],&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [],[],[]},&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{{[],[],[],[],[],[],[],[],[],[],[],[],[],&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[],[],[]}}},&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;false,&amp;lt;0.1118.0&amp;gt;,none,none,0,true,none,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{dict,1,16,16,8,80,48,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{[],[],[],[],[],[],[],[],[],[],[],[],[],&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [],[],[]},&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{{[[&amp;lt;&amp;lt;&amp;quot;amq.ctag-1sViVE9Y/wIKyAliWqjeCA==&amp;quot;&amp;gt;&amp;gt;|&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;etl_dispatch]],&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[],[],[],[],[],[],[],[],[],[],[],[],[],&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[],[]}}},&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;none,#Fun&amp;lt;amqp_channel_sup.1.53915388&amp;gt;}&lt;/div&gt;<br>
&lt;div&gt;**&nbsp;Reason&nbsp;for&nbsp;termination&nbsp;== &lt;/div&gt;&lt;div&gt;**&nbsp;{server_initiated_close,406,&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;lt;&amp;lt;&amp;quot;PRECONDITION_FAILED&nbsp;-&nbsp;unknown&nbsp;delivery&nbsp;tag&nbsp;856&amp;quot;&amp;gt;&amp;gt;}&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
The&nbsp;server&nbsp;receive&nbsp;loop&nbsp;where&nbsp;the&nbsp;ack&nbsp;happens&nbsp;looks&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&gt;receive&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;&lt;div&gt;{#&amp;#39;basic.deliver&amp;#39;{delivery_tag&nbsp;=&nbsp;Tag,&nbsp;routing_key&nbsp;=&nbsp;RoutingKey},&nbsp;#amqp_msg{payload&nbsp;=&nbsp;Payload}}&nbsp;-&amp;gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp; &nbsp; amqp_channel:cast(get(amqp_channel_pid),&nbsp;#&amp;#39;basic.ack&amp;#39;{delivery_tag&nbsp;=&nbsp;Tag}),&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp; &nbsp; spawn_and_queue(spawn_handle_message,&nbsp;Module,&nbsp;RoutingKey,&nbsp;Payload),&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp; &nbsp; loop(Module);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;end&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;amqp_client_sup&nbsp;can&amp;#39;t&nbsp;seem&nbsp;to&nbsp;bring&nbsp;back&nbsp;the&nbsp;the&nbsp;client&nbsp;either&nbsp;and&nbsp;dies&nbsp;from&nbsp;the&nbsp;retry&nbsp;intensity&nbsp;being&nbsp;reached.&nbsp; I&amp;#39;ve&nbsp;done&nbsp;a&nbsp;hefty&nbsp;amount&nbsp;of&nbsp;googling&nbsp;and&nbsp;can&amp;#39;t&nbsp;seem&nbsp;to&nbsp;find&nbsp;where&nbsp;things&nbsp;could&nbsp;be&nbsp;going&nbsp;wrong.&nbsp; Before&nbsp;jumping&nbsp;into&nbsp;the&nbsp;amqp_client&nbsp;code&nbsp;I&nbsp;thought&nbsp;I&amp;#39;d&nbsp;ask&nbsp;the&nbsp;mailing&nbsp;list&nbsp;if&nbsp;they&nbsp;have&nbsp;any&nbsp;ideas.&nbsp; The&nbsp;only&nbsp;thing&nbsp;I&nbsp;can&nbsp;think&nbsp;is&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;race&nbsp;condition&nbsp;within&nbsp;the&nbsp;client&nbsp;library.&nbsp; I&nbsp;will&nbsp;be&nbsp;double&nbsp;checking&nbsp;my&nbsp;code&nbsp;to&nbsp;be&nbsp;sure&nbsp;it&nbsp;isn&amp;#39;t&nbsp;sending&nbsp;the&nbsp;ack&nbsp;twice,&nbsp;but&nbsp;given&nbsp;the&nbsp;simplicity&nbsp;of&nbsp;the&nbsp;ack&nbsp;the&nbsp;only&nbsp;way&nbsp;it&nbsp;could&nbsp;is&nbsp;if&nbsp;it&nbsp;receives&nbsp;the&nbsp;same&nbsp;message&nbsp;(with&nbsp;identical&nbsp;delivery&nbsp;tag)&nbsp;from&nbsp;the&nbsp;amqp_client&nbsp;library&nbsp;twice.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;-Max&lt;/div&gt;<br>

</tt>
