<tt>
Hi&nbsp;all,&lt;br&gt;&lt;br&gt;I&amp;#39;m&nbsp;having&nbsp;problems&nbsp;achieving&nbsp;a&nbsp;high&nbsp;publish&nbsp;throughput&nbsp;with&nbsp;RabbitMQ&nbsp;2.2.&lt;br&gt;&lt;br&gt;I&nbsp;am&nbsp;using&nbsp;the&nbsp;.NET&nbsp;client&nbsp;on&nbsp;two&nbsp;Win7/64&nbsp;desktops&nbsp;with&nbsp;Core&nbsp;2&nbsp;duos,&nbsp;and&nbsp;the&nbsp;broker&nbsp;is&nbsp;running&nbsp;on&nbsp;RHEL5.6&nbsp;(OTP&nbsp;R14B01)&nbsp;on&nbsp;a&nbsp;quad&nbsp;core&nbsp;Xeon&nbsp;blade,&nbsp;and&nbsp;the&nbsp;link&nbsp;between&nbsp;the&nbsp;blade&nbsp;and&nbsp;the&nbsp;desktops&nbsp;is&nbsp;1Gb/s&nbsp;ethernet.&nbsp;&lt;br&gt;<br>
&lt;br&gt;I&nbsp;created&nbsp;a&nbsp;minimal&nbsp;publisher&nbsp;and&nbsp;consumer&nbsp;in&nbsp;.NET&nbsp;and&nbsp;ran&nbsp;one&nbsp;on&nbsp;each&nbsp;machine.&nbsp;The&nbsp;consumer&nbsp;was&nbsp;able&nbsp;to&nbsp;receive&nbsp;more&nbsp;than&nbsp;50&nbsp;000&nbsp;empty&nbsp;messages&nbsp;per&nbsp;second,&nbsp;however&nbsp;the&nbsp;publisher&nbsp;was&nbsp;only&nbsp;able&nbsp;to&nbsp;publish&nbsp;5000&nbsp;empty&nbsp;messages&nbsp;per&nbsp;second&nbsp;before&nbsp;maxing&nbsp;out&nbsp;my&nbsp;desktop&amp;#39;s&nbsp;CPU.&nbsp;I&nbsp;ported&nbsp;the&nbsp;publisher&nbsp;to&nbsp;Java,&nbsp;and&nbsp;that&nbsp;went&nbsp;up&nbsp;to&nbsp;10&nbsp;000&nbsp;per&nbsp;second,&nbsp;which&nbsp;is&nbsp;better&nbsp;but&nbsp;still&nbsp;not&nbsp;great.&nbsp;The&nbsp;network&nbsp;utilization&nbsp;is&nbsp;almost&nbsp;insignificant&nbsp;and&nbsp;the&nbsp;broker&amp;#39;s&nbsp;CPU&nbsp;usage&nbsp;was&nbsp;around&nbsp;10%&nbsp;on&nbsp;one&nbsp;core.&nbsp;The&nbsp;bottleneck&nbsp;appears&nbsp;to&nbsp;be&nbsp;CPU&nbsp;usage&nbsp;inside&nbsp;the&nbsp;RabbitMQ&nbsp;.NET&nbsp;library.&nbsp;I&nbsp;achieve&nbsp;at&nbsp;least&nbsp;45MB/s&nbsp;throughput&nbsp;in&nbsp;a&nbsp;single&nbsp;plain&nbsp;TCP&nbsp;connection&nbsp;<br>
from&nbsp;Win7&nbsp;to&nbsp;the&nbsp;blade,&nbsp;so&nbsp;the&nbsp;link&nbsp;is&nbsp;definitely&nbsp;not&nbsp;the&nbsp;problem.&lt;br&gt;&lt;br&gt;I&nbsp;attached&nbsp;a&nbsp;profiler&nbsp;to&nbsp;my&nbsp;publisher&nbsp;and&nbsp;I&nbsp;found&nbsp;that&nbsp;more&nbsp;than&nbsp;90%&nbsp;of&nbsp;the&nbsp;CPU&nbsp;time&nbsp;was&nbsp;spent&nbsp;calling&nbsp;Flush&nbsp;in&nbsp;WriteFrame&nbsp;(called&nbsp;by&nbsp;BasicPublish).&nbsp;I&nbsp;created&nbsp;an&nbsp;alternate&nbsp;non-flushing&nbsp;code&nbsp;path&nbsp;in&nbsp;the&nbsp;RabbitMQ&nbsp;for&nbsp;BasicPublish,&nbsp;and&nbsp;the&nbsp;publishing&nbsp;speed&nbsp;went&nbsp;up&nbsp;to&nbsp;between&nbsp;35&nbsp;000&nbsp;and&nbsp;45&nbsp;000&nbsp;messages&nbsp;per&nbsp;second,&nbsp;and&nbsp;the&nbsp;messages&nbsp;still&nbsp;got&nbsp;to&nbsp;the&nbsp;client&nbsp;quickly.&lt;br&gt;<br>
&lt;br&gt;Am&nbsp;I&nbsp;doing&nbsp;something&nbsp;incorrect?&nbsp;I&nbsp;presume&nbsp;the&nbsp;client&nbsp;flushes&nbsp;as&nbsp;soon&nbsp;as&nbsp;possible&nbsp;to&nbsp;reduce&nbsp;latency,&nbsp;but&nbsp;in&nbsp;this&nbsp;case,&nbsp;I&nbsp;don&amp;#39;t&nbsp;mind&nbsp;giving&nbsp;up&nbsp;some&nbsp;latency&nbsp;to&nbsp;get&nbsp;better&nbsp;throughput,&nbsp;such&nbsp;as&nbsp;by&nbsp;only&nbsp;explicitly&nbsp;flushing&nbsp;once&nbsp;every&nbsp;50ms&nbsp;or&nbsp;something&nbsp;along&nbsp;these&nbsp;lines.&nbsp;Is&nbsp;there&nbsp;a&nbsp;way&nbsp;to&nbsp;support&nbsp;my&nbsp;requirements&nbsp;with&nbsp;the&nbsp;RabbitMQ&nbsp;.NET&nbsp;library?&lt;br&gt;<br>
&lt;br&gt;Thanks!&lt;br&nbsp;clear=&quot;all&quot;&gt;Cameron&nbsp;Harris&lt;br&gt;<br>

</tt>
