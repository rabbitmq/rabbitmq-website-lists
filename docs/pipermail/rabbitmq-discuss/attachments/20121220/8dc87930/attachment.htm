<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&amp;#39;ve&nbsp;been&nbsp;given&nbsp;a&nbsp;chance&nbsp;to&nbsp;try&nbsp;a&nbsp;high&nbsp;core&nbsp;server&nbsp;(4x10)&nbsp;as&nbsp;a&nbsp;possible&nbsp;RMQ&nbsp;server&nbsp;and&nbsp;have&nbsp;hit&nbsp;a&nbsp;few&nbsp;throughput&nbsp;issues&nbsp;that&nbsp;I&nbsp;hope&nbsp;someone&nbsp;can&nbsp; help&nbsp;shed&nbsp;some&nbsp;light&nbsp;on.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;We&nbsp;currently&nbsp;have&nbsp;a&nbsp;decently&nbsp;powered&nbsp;single&nbsp;RMQ&nbsp;server&nbsp;that&nbsp;is&nbsp;running&nbsp;as&nbsp;a&nbsp;standalone&nbsp;node&nbsp;and&nbsp;has&nbsp;RHEL&nbsp;6.2.&nbsp;It&nbsp;has&nbsp;12&nbsp;cores&nbsp;running&nbsp;at&nbsp;3.4GHz.&nbsp;There&nbsp;are&nbsp;22&nbsp;queues,&nbsp;some&nbsp;configured&nbsp;with&nbsp;no-ack,&nbsp;but&nbsp;mostly&nbsp;with&nbsp;acks&nbsp;being&nbsp;used.&nbsp;The&nbsp;message&nbsp;sizes&nbsp;are&nbsp;varied&nbsp;but&nbsp;can&nbsp;get&nbsp;large&nbsp;and&nbsp;we&nbsp;hit&nbsp;about&nbsp;51k&nbsp;messages/sec&nbsp;throughput&nbsp;through&nbsp;all&nbsp;queues.&nbsp;During&nbsp;the&nbsp;day&nbsp;this&nbsp;system&nbsp;caps&nbsp;out&nbsp;at&nbsp;63%&nbsp;CPU&nbsp;utilization&nbsp;(13%&nbsp;system)&nbsp;and&nbsp;stays&nbsp;that&nbsp;way&nbsp;until&nbsp;the&nbsp;evening.&nbsp;We&nbsp;are&nbsp;definitely&nbsp;hitting&nbsp;a&nbsp;bottleneck&nbsp;with&nbsp;it.&nbsp;I&amp;#39;ve&nbsp;tried&nbsp;HiPE&nbsp;in&nbsp;the&nbsp;past,&nbsp;but&nbsp;the&nbsp;system&nbsp;%&nbsp;jumped&nbsp;considerably&nbsp;and&nbsp;we&nbsp;actually&nbsp;got&nbsp;poorer&nbsp;performance&nbsp;and&nbsp;instability.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;A&nbsp;vendor&nbsp;let&nbsp;us&nbsp;borrow&nbsp;the&nbsp;40-core&nbsp;machine&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;would&nbsp;work&nbsp;better.&nbsp;When&nbsp;I&nbsp;switched&nbsp;over&nbsp;to&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;configuration&nbsp;as&nbsp;the&nbsp;production&nbsp;machine,&nbsp;it&nbsp;capped&nbsp;out&nbsp;at&nbsp;around&nbsp;12,000&nbsp;messages/sec.&nbsp;We&nbsp;changed&nbsp;the&nbsp;network&nbsp;card&nbsp;and&nbsp;tweaked&nbsp;MTU&nbsp;to&nbsp;see&nbsp;if&nbsp;that&nbsp;was&nbsp;causing&nbsp;a&nbsp;problem,&nbsp;but&nbsp;it&nbsp;still&nbsp;seems&nbsp;capped.&nbsp;What&amp;#39;s&nbsp;odd&nbsp;is&nbsp;I&nbsp;can&amp;#39;t&nbsp;determine&nbsp;what&nbsp;is&nbsp;causing&nbsp;the&nbsp;bottleneck&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Each&nbsp;core&nbsp;is&nbsp;only&nbsp;11-15%&nbsp;utilized.&nbsp;There&nbsp;is&nbsp;no&nbsp;iowait&nbsp;at&nbsp;all.&nbsp;The&nbsp;machine&nbsp;does&nbsp;have&nbsp;a&nbsp;lot&nbsp;more&nbsp;RAM&nbsp;at&nbsp;256&nbsp;GB&nbsp;vs&nbsp;72&nbsp;GB&nbsp;on&nbsp;the&nbsp;existing&nbsp;hardware.&nbsp;We&nbsp;disabled&nbsp;NUMA&nbsp;in&nbsp;the&nbsp;bios&nbsp;to&nbsp;see&nbsp;if&nbsp;that&nbsp;would&nbsp;change&nbsp;things&nbsp;but&nbsp;we&nbsp;got&nbsp;the&nbsp;same&nbsp;performance.&nbsp;On&nbsp;the&nbsp;producer&nbsp;side&nbsp;that&nbsp;injects&nbsp;the&nbsp;initial&nbsp;data,&nbsp;the&nbsp;logs&nbsp;show&nbsp;it&nbsp;can&amp;#39;t&nbsp;push&nbsp;data&nbsp;into&nbsp;the&nbsp;new&nbsp;machine&nbsp;fast&nbsp;enough.&nbsp;There&nbsp;are&nbsp;in-memory&nbsp;queues&nbsp;that&nbsp;store&nbsp;data&nbsp;in&nbsp;case&nbsp;of&nbsp;slow&nbsp;downs&nbsp;and&nbsp;they&nbsp;immediately&nbsp;begin&nbsp;to&nbsp;fill&nbsp;up&nbsp;when&nbsp;pushing&nbsp;to&nbsp;the&nbsp;new&nbsp;machine,&nbsp;whereas&nbsp;it&nbsp;rarely&nbsp;happens&nbsp;with&nbsp;the&nbsp;old&nbsp;one.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Are&nbsp;there&nbsp;any&nbsp;other&nbsp;tools&nbsp;that&nbsp;I&nbsp;can&nbsp;use&nbsp;to&nbsp;see&nbsp;why&nbsp;the&nbsp;erlang&nbsp;processes&nbsp;don&amp;#39;t&nbsp;seem&nbsp;to&nbsp;be&nbsp;fully&nbsp;utilizing&nbsp;the&nbsp;server&amp;#39;s&nbsp;capacity?&nbsp;I&nbsp;know&nbsp;the&nbsp;cores&nbsp;are&nbsp;slower&nbsp;in&nbsp;overall&nbsp;speed,&nbsp;but&nbsp;I&nbsp;would&nbsp;have&nbsp;bet&nbsp;money&nbsp;that&nbsp;in&nbsp;aggregate&nbsp;this&nbsp;machine&nbsp;would&nbsp;outperform&nbsp;our&nbsp;other&nbsp;one. &lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Thanks&nbsp;in&nbsp;advance&nbsp;for&nbsp;any&nbsp;suggestions,&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt; Chris&lt;/div&gt;&lt;/div&gt;<br>

</tt>
