<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;straightforward&nbsp;issue:&nbsp;If&nbsp;you&nbsp;supply&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;to&nbsp;a&nbsp;new&nbsp;AmqpTcpEndpoint&nbsp;in&nbsp;an&nbsp;IPv6-enabled&nbsp;Windows&nbsp;environment&nbsp;(Windows7)&nbsp;then&nbsp;pass&nbsp;that&nbsp;endpoint&nbsp;to&nbsp;a&nbsp;connection&nbsp;factory&nbsp;it&nbsp;will&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;create&nbsp;connections.&nbsp;&nbsp;It&nbsp;seems&nbsp;that&nbsp;if&nbsp;the&nbsp;client&nbsp;environment&nbsp;supports&nbsp;IPv6&nbsp;you&nbsp;have&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;or&nbsp;a&nbsp;hostname.&nbsp;&nbsp;My&nbsp;sample&nbsp;code&nbsp;is&nbsp;running&nbsp;the&nbsp;3.3.0&nbsp;RabbitMQ&nbsp;.Net&nbsp;client:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;var&nbsp;factory&nbsp;=&nbsp;new&nbsp;ConnectionFactory()&nbsp;&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;UserName&nbsp;=&nbsp;&quot;eric&quot;,&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;Password&nbsp;=&nbsp;&quot;pwd&quot;&nbsp;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//&nbsp;WORKS&nbsp;(ipv6&nbsp;addr)&lt;/div&gt;&lt;div&gt;//&nbsp;var&nbsp;uri&nbsp;=&nbsp;new&nbsp;Uri(&quot;amqp-0-9://[2001:a9fe:3100:1:f06c:255a:43e2:1459]:5672&quot;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//&nbsp;WORKS&nbsp;(hostname)&lt;/div&gt;&lt;div&gt;//&nbsp;var&nbsp;uri&nbsp;=&nbsp;new&nbsp;Uri(&quot;amqp-0-9://s6-2k8r2-3:5672&quot;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//&nbsp;Times&nbsp;out&nbsp;(mapped&nbsp;ipv4&nbsp;[socket&nbsp;is&nbsp;probably&nbsp;not&nbsp;dual-stack?])&lt;/div&gt;&lt;div&gt;//&nbsp;var&nbsp;uri&nbsp;=&nbsp;new&nbsp;Uri(&quot;amqp-0-9://[0:0:0:0:0:ffff:172.31.195.246]:5672&quot;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//&nbsp;Throws&nbsp;a&nbsp;System.ArgumentException&nbsp;in&nbsp;CreateConnection()&lt;/div&gt;&lt;div&gt;var&nbsp;uri&nbsp;=&nbsp;new&nbsp;Uri(&quot;amqp-0-9://172.31.195.246:5672&quot;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;factory.Endpoint&nbsp;=&nbsp;new&nbsp;AmqpTcpEndpoint(uri);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;using&nbsp;(var&nbsp;connection&nbsp;=&nbsp;factory.CreateConnection())&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;using&nbsp;(var&nbsp;channel&nbsp;=&nbsp;connection.CreateModel())&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;channel.QueueDeclare(&quot;test&quot;,&nbsp;false,&nbsp;false,&nbsp;false,&nbsp;null);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;string&nbsp;message&nbsp;=&nbsp;&quot;Hello&nbsp;World&quot;;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;var&nbsp;body&nbsp;=&nbsp;Encoding.UTF8.GetBytes(message);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;channel.BasicPublish(&quot;&quot;,&nbsp;&quot;hello&quot;,&nbsp;null,&nbsp;body);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;Console.WriteLine(&quot;&nbsp;[x]&nbsp;Sent&nbsp;{0}&quot;,&nbsp;message);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;appears&nbsp;to&nbsp;be&nbsp;in&nbsp;the&nbsp;way&nbsp;the&nbsp;SocketFrameHandler_0_9.ctor()&nbsp;determines&nbsp;the&nbsp;socket&nbsp;address&nbsp;family:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;if&nbsp;(Socket.OSSupportsIPv6)&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_socket&nbsp;=&nbsp;socketFactory(AddressFamily.InterNetworkV6);&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.Connect(this.m_socket,&nbsp;endpoint,&nbsp;timeout);&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;catch&nbsp;(ConnectFailureException)&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.m_socket&nbsp;=&nbsp;null;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;may&nbsp;not&nbsp;be&nbsp;the&nbsp;best&nbsp;way&nbsp;to&nbsp;determine&nbsp;whether&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv6&nbsp;socket&nbsp;or&nbsp;an&nbsp;IPv4&nbsp;socket.&nbsp;&nbsp;The&nbsp;ArgumentException&nbsp;which&nbsp;is&nbsp;getting&nbsp;thrown&nbsp;from&nbsp;down&nbsp;in&nbsp;the&nbsp;Socket's&nbsp;DoDnsCallback&nbsp;is&nbsp;not&nbsp;caught&nbsp;in&nbsp;the&nbsp;FrameHandler&nbsp;ctor&nbsp;and&nbsp;instead&nbsp;makes&nbsp;its&nbsp;way&nbsp;up&nbsp;to&nbsp;the&nbsp;caller.&nbsp;&nbsp;You&nbsp;may&nbsp;want&nbsp;to&nbsp;consider&nbsp;IPAddress.TryParsing&nbsp;the&nbsp;host&nbsp;from&nbsp;the&nbsp;Amqp&nbsp;endpoint&nbsp;and&nbsp;then&nbsp;getting&nbsp;the&nbsp;address&nbsp;family&nbsp;from&nbsp;that.&nbsp;&nbsp;It&nbsp;would&nbsp;probably&nbsp;be&nbsp;faster&nbsp;than&nbsp;this&nbsp;method,&nbsp;too.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;it&nbsp;stands&nbsp;I&nbsp;cannot&nbsp;figure&nbsp;out&nbsp;a&nbsp;workaround&nbsp;for&nbsp;this&nbsp;issue.&nbsp;&nbsp;If&nbsp;the&nbsp;only&nbsp;way&nbsp;you&nbsp;can&nbsp;access&nbsp;a&nbsp;machine&nbsp;from&nbsp;an&nbsp;IPv6-enabled&nbsp;Windows&nbsp;box&nbsp;is&nbsp;via&nbsp;its&nbsp;IPv4&nbsp;address&nbsp;you&nbsp;would&nbsp;appear&nbsp;to&nbsp;be&nbsp;out&nbsp;of&nbsp;luck.&nbsp;&nbsp;In&nbsp;the&nbsp;.Net&nbsp;client,&nbsp;anyway.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Eric&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
