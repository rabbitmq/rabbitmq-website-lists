<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;p&nbsp;class=&quot;p1&quot;&gt;Hello,&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;We&nbsp;have&nbsp;a&nbsp;distributed&nbsp;Java&nbsp;application&nbsp;talking&nbsp;to&nbsp;a&nbsp;clustered&nbsp;RabbitMQ&nbsp;instance,&nbsp;and&nbsp;we&nbsp;are&nbsp;encountering&nbsp;a&nbsp;situation&nbsp;where&nbsp;the&nbsp;message-producing&nbsp;Java&nbsp;client&nbsp;will&nbsp;occasionally&nbsp;hang&nbsp;indefinitely&nbsp;during&nbsp;queueing&nbsp;operations.&nbsp;&nbsp;It&nbsp;is&nbsp;not&nbsp;the&nbsp;result&nbsp;of&nbsp;server&nbsp;memory&nbsp;limits&nbsp;being&nbsp;exceeded,&nbsp;or&nbsp;delays&nbsp;from&nbsp;flow&nbsp;control,&nbsp;as&nbsp;the&nbsp;management&nbsp;console&nbsp;displays&nbsp;both&nbsp;as&nbsp;healthy.&nbsp;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;Attached&nbsp;is&nbsp;the&nbsp;output&nbsp;of&nbsp;'rabbitmqctl&nbsp;report'&nbsp;on&nbsp;the&nbsp;cluster&nbsp;nodes,&nbsp;and&nbsp;a&nbsp;Java&nbsp;thread&nbsp;stack.&nbsp;&nbsp;Note&nbsp;the&nbsp;presence&nbsp;of&nbsp;the&nbsp;blocked&nbsp;threads&nbsp;attempting&nbsp;to&nbsp;write&nbsp;to&nbsp;Rabbit&nbsp;in&nbsp;the&nbsp;attached&nbsp;stack.&nbsp;&nbsp;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&gt;Our&nbsp;application&nbsp;producer&nbsp;node&nbsp;is&nbsp;running&nbsp;RabbitMQ&nbsp;3.1.3&nbsp;Client&nbsp;through&nbsp;spring-rabbit&nbsp;1.2.1.RELEASE,&nbsp;on&nbsp;CentOS&nbsp;release&nbsp;5.6&nbsp;(Final),&nbsp;Java(TM)&nbsp;SE&nbsp;Runtime&nbsp;Environment&nbsp;(build&nbsp;1.6.0_45-b06).&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p3&quot;&gt;Our&nbsp;application&nbsp;is&nbsp;configured&nbsp;to&nbsp;talk&nbsp;directly&nbsp;to&nbsp;the&nbsp;Rabbit&nbsp;server&nbsp;at&nbsp;the&nbsp;moment,&nbsp;though&nbsp;we&nbsp;have&nbsp;previously&nbsp;connected&nbsp;to&nbsp;the&nbsp;cluster&nbsp;through&nbsp;a&nbsp;hardware&nbsp;load&nbsp;balancer.&nbsp;&nbsp;We&nbsp;see&nbsp;the&nbsp;same&nbsp;issue&nbsp;whether&nbsp;we&nbsp;connect&nbsp;directly,&nbsp;or&nbsp;through&nbsp;the&nbsp;load&nbsp;balancer.&lt;/p&gt;&lt;p&nbsp;class=&quot;p2&quot;&gt;We&nbsp;have&nbsp;the&nbsp;following&nbsp;RabbitMQ&nbsp;ConnectionFactory&nbsp;settings&nbsp;in&nbsp;our&nbsp;application:&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p2&quot;&gt;requestedHeartbeat:&nbsp;10&nbsp;seconds&lt;/p&gt;&lt;p&nbsp;class=&quot;p2&quot;&gt;connectionTimeout:&nbsp;60&nbsp;seconds&lt;/p&gt;&lt;p&nbsp;class=&quot;p2&quot;&gt;This&nbsp;connectionFactory&nbsp;gets&nbsp;passed&nbsp;to&nbsp;a&nbsp;Spring&nbsp;CachingConnectionFactory&nbsp;with&nbsp;a&nbsp;channelCacheSize&nbsp;of&nbsp;100.&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;p2&quot;&gt;Messages&nbsp;are&nbsp;being&nbsp;sent&nbsp;to&nbsp;the&nbsp;default&nbsp;exchange&nbsp;on&nbsp;an&nbsp;application-specific&nbsp;virtual&nbsp;host;&nbsp;the&nbsp;queues&nbsp;are&nbsp;direct&nbsp;queues&nbsp;with&nbsp;ha-mode:all&nbsp;set&nbsp;as&nbsp;a&nbsp;policy.&lt;/p&gt;&lt;p&nbsp;class=&quot;p2&quot;&gt;The&nbsp;application&nbsp;has&nbsp;a&nbsp;single&nbsp;master&nbsp;node&nbsp;with&nbsp;multiple&nbsp;threads&nbsp;writing&nbsp;to,&nbsp;and&nbsp;many&nbsp;consumer&nbsp;nodes,&nbsp;each&nbsp;with&nbsp;multiple&nbsp;threads&nbsp;consuming&nbsp;from&nbsp;the&nbsp;server.&nbsp;&nbsp;We&nbsp;are&nbsp;queueing&nbsp;between&nbsp;25&nbsp;to&nbsp;75&nbsp;million&nbsp;messages&nbsp;a&nbsp;day.&lt;/p&gt;&lt;p&nbsp;class=&quot;p1&quot;&nbsp;style=&quot;margin:&nbsp;0px&nbsp;0px&nbsp;1em;&nbsp;padding:&nbsp;0px;&nbsp;border:&nbsp;0px;&nbsp;vertical-align:&nbsp;baseline;&nbsp;font-size:&nbsp;13px;&nbsp;line-height:&nbsp;18px;&nbsp;color:&nbsp;rgb(34,&nbsp;34,&nbsp;34);&nbsp;font-family:&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&quot;&gt;Weâ€™re&nbsp;wondering&nbsp;if&nbsp;anyone&nbsp;has&nbsp;encountered&nbsp;an&nbsp;issue&nbsp;similar&nbsp;to&nbsp;this&nbsp;running&nbsp;the&nbsp;versions&nbsp;of&nbsp;Rabbit&nbsp;server&nbsp;/&nbsp;client&nbsp;we&nbsp;are.&nbsp;&nbsp;Are&nbsp;there&nbsp;any&nbsp;suggestions&nbsp;for&nbsp;what&nbsp;we&nbsp;can&nbsp;do&nbsp;to&nbsp;prevent&nbsp;this?&nbsp;&nbsp;Could&nbsp;upgrading&nbsp;the&nbsp;server&nbsp;version&nbsp;help?&lt;/p&gt;&lt;p&nbsp;class=&quot;p3&quot;&gt;Thank&nbsp;you,&lt;/p&gt;&lt;p&nbsp;class=&quot;p3&quot;&gt;Jeff&lt;/p&gt;&lt;/div&gt;
</tt>
