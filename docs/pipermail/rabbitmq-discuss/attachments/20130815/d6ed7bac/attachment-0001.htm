<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;We're&nbsp;seeing&nbsp;this&nbsp;happening&nbsp;too,&nbsp;though&nbsp;I&nbsp;did&nbsp;not&nbsp;think&nbsp;to&nbsp;check&nbsp;if&nbsp;the&nbsp;management&nbsp;plugin&nbsp;&amp;nbsp;was&nbsp;the&nbsp;culprit.&nbsp;We&nbsp;started&nbsp;using&nbsp;the&nbsp;plugin&nbsp;and&nbsp;its&nbsp;web&nbsp;interface&nbsp;around&nbsp;the&nbsp;time&nbsp;our&nbsp;rabbitmq&nbsp;crashes&nbsp;started&nbsp;happneing&nbsp;-&nbsp;all&nbsp;due&nbsp;to&nbsp;out&nbsp;of&nbsp;memory&nbsp;and&nbsp;being&nbsp;killed&nbsp;by&nbsp;the&nbsp;kernel.&nbsp;&amp;nbsp;We've&nbsp;disabled&nbsp;the&nbsp;management&nbsp;plugin&nbsp;and&nbsp;haven't&nbsp;seen&nbsp;the&nbsp;crashes&nbsp;yet&nbsp;though&nbsp;its&nbsp;too&nbsp;early&nbsp;to&nbsp;call.&amp;nbsp;&lt;div&gt;&lt;br&gt;&lt;br&gt;On&nbsp;Saturday,&nbsp;15&nbsp;June&nbsp;2013&nbsp;03:09:21&nbsp;UTC+1,&nbsp;Travis&nbsp;Mehlinger&nbsp;&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;We&nbsp;recently&nbsp;upgraded&nbsp;RabbitMQ&nbsp;from&nbsp;3.0.4&nbsp;to&nbsp;3.1.1&nbsp;after&nbsp;noticing&nbsp;two&nbsp;bug&nbsp;fixes&nbsp;in&nbsp;3.1.0&nbsp;related&nbsp;to&nbsp;our&nbsp;RabbitMQ&nbsp;deployment:&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);white-space:pre-wrap&quot;&gt;25524&nbsp;fix&nbsp;memory&nbsp;leak&nbsp;in&nbsp;mirror&nbsp;queue&nbsp;slave&nbsp;with&nbsp;many&nbsp;short-lived&nbsp;publishing&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);white-space:pre-wrap&quot;&gt;channel&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal;white-space:pre-wrap;color:rgb(0,0,0)&quot;&gt;25290&nbsp;fix&nbsp;per-queue&nbsp;memory&nbsp;leak&nbsp;recording&nbsp;stats&nbsp;for&nbsp;mirror&nbsp;queue&nbsp;slaves&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;However,&nbsp;in&nbsp;our&nbsp;case,&nbsp;it&nbsp;seems&nbsp;that&nbsp;the&nbsp;management&nbsp;plugin&nbsp;may&nbsp;still&nbsp;have&nbsp;a&nbsp;memory&nbsp;leak.&nbsp;We&nbsp;have&nbsp;a&nbsp;monitoring&nbsp;agent&nbsp;that&nbsp;hits&nbsp;the&nbsp;REST&nbsp;API&nbsp;to&nbsp;gather&nbsp;information&nbsp;about&nbsp;the&nbsp;broker&nbsp;(number&nbsp;of&nbsp;queues,&nbsp;queue&nbsp;depth,&nbsp;etc.).&nbsp;With&nbsp;the&nbsp;monitoring&nbsp;agent&nbsp;running&nbsp;and&nbsp;making&nbsp;requests&nbsp;against&nbsp;the&nbsp;API,&nbsp;memory&nbsp;consumption&nbsp;steadily&nbsp;increased;&nbsp;when&nbsp;we&nbsp;stopped&nbsp;the&nbsp;agent,&nbsp;memory&nbsp;consumption&nbsp;in&nbsp;the&nbsp;management&nbsp;plugin&nbsp;leveled&nbsp;off.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;a&nbsp;couple&nbsp;graphs&nbsp;detailing&nbsp;memory&nbsp;consumption&nbsp;in&nbsp;the&nbsp;broker&nbsp;(the&nbsp;figures&nbsp;are&nbsp;parsed&nbsp;from&nbsp;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;rabbitmqctl&nbsp;report&lt;/font&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;).&nbsp;The&nbsp;first&nbsp;graph&nbsp;shows&nbsp;the&nbsp;ebb&nbsp;and&nbsp;flow&nbsp;of&nbsp;memory&nbsp;consumption&nbsp;in&nbsp;a&nbsp;number&nbsp;of&nbsp;components&nbsp;and&nbsp;the&nbsp;second&nbsp;shows&nbsp;just&nbsp;consumption&nbsp;by&nbsp;the&nbsp;management&nbsp;plugin.&nbsp;You&nbsp;can&nbsp;see&nbsp;pretty&nbsp;clearly&nbsp;where&nbsp;we&nbsp;stopped&nbsp;the&nbsp;monitoring&nbsp;agent&nbsp;at&nbsp;1:20.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;a&nbsp;href=&quot;https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png&quot;&nbsp;target=&quot;_blank&quot;&gt;https://dl.dropboxusercontent.&lt;wbr&gt;com/u/7022167/Screenshots/n-&lt;wbr&gt;np6obt-m9f.png&lt;/a&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;a&nbsp;href=&quot;https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png&quot;&nbsp;target=&quot;_blank&quot;&gt;https://dl.dropboxusercontent.&lt;wbr&gt;com/u/7022167/Screenshots/&lt;wbr&gt;an6dpup33xvx.png&lt;/a&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;We&nbsp;have&nbsp;two&nbsp;clustered&nbsp;brokers,&nbsp;both&nbsp;running&nbsp;RabbitMQ&nbsp;3.1.1&nbsp;on&nbsp;Erlang&nbsp;R14B-04.1.&nbsp;There&nbsp;are&nbsp;typically&nbsp;around&nbsp;200&nbsp;queues,&nbsp;about&nbsp;20&nbsp;of&nbsp;which&nbsp;are&nbsp;mirrored.&nbsp;There&nbsp;are&nbsp;generally&nbsp;about&nbsp;200&nbsp;consumers.&nbsp;Messages&nbsp;are&nbsp;rarely&nbsp;queued&nbsp;and&nbsp;most&nbsp;queues&nbsp;typically&nbsp;sit&nbsp;idle.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;I'll&nbsp;be&nbsp;happy&nbsp;to&nbsp;provide&nbsp;any&nbsp;further&nbsp;diagnostic&nbsp;information.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Thanks!&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
