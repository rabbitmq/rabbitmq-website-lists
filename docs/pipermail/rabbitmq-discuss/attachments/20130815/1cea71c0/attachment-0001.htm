<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Matthias,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;the&nbsp;reply.&nbsp;When&nbsp;you&nbsp;say&nbsp;resource&nbsp;alarms,&nbsp;do&nbsp;you&nbsp;mean&nbsp;on&nbsp;the&nbsp;server&nbsp;or&nbsp;from&nbsp;the&nbsp;clients?&nbsp;We&nbsp;don&amp;#39;t&nbsp;have&nbsp;any&nbsp;issues&nbsp;whatsoever&nbsp;there.&nbsp;We&amp;#39;ve&nbsp;been&nbsp;running&nbsp;the&nbsp;same&nbsp;workload,&nbsp;and&nbsp;this&nbsp;issue&nbsp;only&nbsp;occurs&nbsp;since&nbsp;the&nbsp;upgrade&nbsp;to&nbsp;3.1.4.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&amp;#39;ve&nbsp;performed&nbsp;some&nbsp;further&nbsp;experimentation&nbsp;since&nbsp;-&nbsp;we&amp;#39;ve&nbsp;configured&nbsp;clients&nbsp;to&nbsp;only&nbsp;connect&nbsp;to&nbsp;node&nbsp;B.&nbsp;This&nbsp;has&nbsp;resolved&nbsp;the&nbsp;problem&nbsp;entirely.&nbsp;The&nbsp;queues&nbsp;are&nbsp;still&nbsp;mirrored&nbsp;but&nbsp;we&nbsp;have&nbsp;no&nbsp;&amp;quot;stuck&amp;quot;&nbsp;connections.&nbsp;It&nbsp;seems&nbsp;that&nbsp;we&nbsp;have&nbsp;a&nbsp;sick&nbsp;rabbit&nbsp;on&nbsp;node&nbsp;A.&nbsp;How&nbsp;can&nbsp;we&nbsp;help&nbsp;diagnose&nbsp;this?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Paul&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;Paul&nbsp;Bowsher&lt;/div&gt;<br>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Aug&nbsp;14,&nbsp;2013&nbsp;at&nbsp;10:23&nbsp;PM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Paul,&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;14/08/13&nbsp;10:41,&nbsp;Paul&nbsp;Bowsher&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
After&nbsp;the&nbsp;upgrade&nbsp;to&nbsp;RabbitMQ&nbsp;3.1.4&nbsp;we&amp;#39;re&nbsp;seeing&nbsp;a&nbsp;large&nbsp;number&nbsp;of&lt;br&gt;<br>
linearly-increasing&nbsp;channels&nbsp;which&nbsp;seem&nbsp;to&nbsp;hang&nbsp;around&nbsp;after&nbsp;the&lt;br&gt;<br>
connection&nbsp;is&nbsp;closed.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;very&nbsp;unlikely&nbsp;to&nbsp;be&nbsp;related&nbsp;to&nbsp;the&nbsp;upgrade...&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
-&nbsp;Initially,&nbsp;larger&nbsp;than&nbsp;expected&nbsp;consumer&nbsp;count&nbsp;on&nbsp;queue&nbsp;from&nbsp;our&lt;br&gt;<br>
monitoring&lt;br&gt;<br>
-&nbsp;Stopping&nbsp;all&nbsp;expected&nbsp;consumers&nbsp;on&nbsp;that&nbsp;channel&nbsp;removes&nbsp;the&nbsp;expected&lt;br&gt;<br>
number&nbsp;of&nbsp;consumers,&nbsp;leaving&nbsp;orphans&nbsp;(700+&nbsp;at&nbsp;present)&lt;br&gt;<br>
-&nbsp;Each&nbsp;orphaned&nbsp;consumer&amp;#39;s&nbsp;channel&nbsp;is&nbsp;reachable&nbsp;using&nbsp;Management&nbsp;tool&lt;br&gt;<br>
-&nbsp;Each&nbsp;connection&nbsp;for&nbsp;the&nbsp;channel&nbsp;is&nbsp;reachable,&nbsp;is&nbsp;in&nbsp;either&nbsp;a&nbsp;&amp;quot;flow&amp;quot;&nbsp;or&lt;br&gt;<br>
&amp;quot;blocked&amp;quot;&nbsp;state&nbsp;with&nbsp;zero&nbsp;data&nbsp;flow.&nbsp;Timeout&nbsp;is&nbsp;set&nbsp;to&nbsp;600s&nbsp;(count&lt;br&gt;<br>
doesn&amp;#39;t&nbsp;decrease&nbsp;after&nbsp;10&nbsp;minutes)&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
The&nbsp;above&nbsp;is&nbsp;all&nbsp;consistent&nbsp;with&nbsp;connections&nbsp;being&nbsp;blocked&nbsp;due&nbsp;to&nbsp;resource&nbsp;alarms.&nbsp;Blocked&nbsp;connections&nbsp;do&nbsp;not&nbsp;get&nbsp;closed&nbsp;until&nbsp;they&nbsp;are&nbsp;unblocked.&nbsp;Check&nbsp;the&nbsp;server&nbsp;logs&nbsp;for&nbsp;alarm&nbsp;warnings.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
-&nbsp;Forcing&nbsp;a&nbsp;stuck&nbsp;connection&nbsp;closed&nbsp;through&nbsp;the&nbsp;management&nbsp;interface&lt;br&gt;<br>
results&nbsp;in&nbsp;a&nbsp;500:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;The&nbsp;server&nbsp;encountered&nbsp;an&nbsp;error&nbsp;while&nbsp;processing&nbsp;this&nbsp;request:&lt;br&gt;<br>
 &nbsp; &nbsp;{exit,{normal,{gen_server,&lt;u&gt;&lt;/u&gt;call,&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [&amp;lt;0.16806.1347&amp;gt;,&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{shutdown,&amp;quot;Closed&nbsp;via&nbsp;management&nbsp;plugin&amp;quot;},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;infinity]}},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [{gen_server,call,3,[{file,&amp;quot;&lt;u&gt;&lt;/u&gt;gen_server.erl&amp;quot;},{line,188}]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{rabbit_mgmt_wm_connection,&lt;u&gt;&lt;/u&gt;delete_resource,2,[]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{webmachine_resource,resource_&lt;u&gt;&lt;/u&gt;call,3,[]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{webmachine_resource,do,3,[]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{webmachine_decision_core,&lt;u&gt;&lt;/u&gt;resource_call,1,[]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{webmachine_decision_core,&lt;u&gt;&lt;/u&gt;decision,1,[]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{webmachine_decision_core,&lt;u&gt;&lt;/u&gt;handle_request,2,[]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{rabbit_webmachine,&amp;#39;-makeloop/&lt;u&gt;&lt;/u&gt;1-fun-0-&amp;#39;,2,[]}]}&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
That&nbsp;looks&nbsp;like&nbsp;a&nbsp;bug.&nbsp;Alas&nbsp;I&nbsp;cannot&nbsp;see&nbsp;anything&nbsp;obviously&nbsp;wrong&nbsp;in&nbsp;the&nbsp;code&nbsp;and&nbsp;I&nbsp;cannot&nbsp;reproduce&nbsp;it&nbsp;:(&nbsp;Is&nbsp;this&nbsp;easily&nbsp;reproducible&nbsp;for&nbsp;you?&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
