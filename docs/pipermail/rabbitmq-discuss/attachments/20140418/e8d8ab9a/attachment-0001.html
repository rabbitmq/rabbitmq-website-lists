<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;Here&#39;s&nbsp;the&nbsp;output&nbsp;of&nbsp;the&nbsp;command&nbsp;around&nbsp;(within&nbsp;10s)&nbsp;when&nbsp;it&nbsp;segfaults. &nbsp;I&#39;ve&nbsp;truncated&nbsp;a&nbsp;bunch&nbsp;of&nbsp;similar&nbsp;lines,&nbsp;since&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;25k&nbsp;lines.&lt;br&gt;&lt;br&gt;USER    &nbsp;CMD         &nbsp;PID  &nbsp;FD&nbsp;MOUNT     &nbsp;INUM&nbsp;MODE        &nbsp;SZ|DV&nbsp;R/W&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462&nbsp;text&nbsp;/       &nbsp;17977559&nbsp;-r-xr-xr-x &nbsp;2397040 &nbsp;r&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462&nbsp;ctty&nbsp;/dev        &nbsp;89&nbsp;crw--w----  &nbsp;pts/0&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;wd&nbsp;/       &nbsp;15810621&nbsp;drwxr-xr-x   &nbsp;1024 &nbsp;r&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462&nbsp;root&nbsp;/            &nbsp;2&nbsp;drwxr-xr-x   &nbsp;1024 &nbsp;r&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462   &nbsp;0&nbsp;/dev        &nbsp;89&nbsp;crw--w----  &nbsp;pts/0&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462   &nbsp;1&nbsp;/dev        &nbsp;89&nbsp;crw--w----  &nbsp;pts/0&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462   &nbsp;2&nbsp;/dev        &nbsp;89&nbsp;crw--w----  &nbsp;pts/0&nbsp;rw&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462   &nbsp;3&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462   &nbsp;4*&nbsp;pipe&nbsp;fffff8000a978000&nbsp;&lt;-&gt;&nbsp;fffff8000a978160     &nbsp;0&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462   &nbsp;5*&nbsp;pipe&nbsp;fffff8000a978160&nbsp;&lt;-&gt;&nbsp;fffff8000a978000     &nbsp;0&nbsp;rw&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462   &nbsp;6*&nbsp;pipe&nbsp;fffff8008b5b22e8&nbsp;&lt;-&gt;&nbsp;fffff8008b5b2448     &nbsp;0&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462   &nbsp;7*&nbsp;pipe&nbsp;fffff8008b5b2448&nbsp;&lt;-&gt;&nbsp;fffff8008b5b22e8     &nbsp;0&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462   &nbsp;8*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff8027d821000&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462   &nbsp;9*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff80566596800&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;10&nbsp;-       &nbsp;15810857&nbsp;-rw-r--r-- &nbsp;3093764 &nbsp;w&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;11&nbsp;-       &nbsp;15810858&nbsp;-rw-r--r--      &nbsp;0 &nbsp;w&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;12&nbsp;-       &nbsp;15891126&nbsp;-rw-r--r--     &nbsp;96&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;13&nbsp;-       &nbsp;15891137&nbsp;-rw-r--r--      &nbsp;0&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;14&nbsp;-       &nbsp;15891139&nbsp;-rw-r--r--      &nbsp;0&nbsp;rw&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;15*&nbsp;internet6&nbsp;stream&nbsp;tcp&nbsp;fffff80458487800&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;16*&nbsp;pipe&nbsp;fffff803c3f4b000&nbsp;&lt;-&gt;&nbsp;fffff803c3f4b160     &nbsp;0&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;17*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff80458449400&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;18*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff802be9b4c00&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;19*&nbsp;pipe&nbsp;fffff8000a9bca18&nbsp;&lt;-&gt;&nbsp;fffff8000a9bc8b8     &nbsp;0&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;20*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff802bee95400&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;21*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff802be4ad400&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;22*&nbsp;pipe&nbsp;fffff801ea5f52e8&nbsp;&lt;-&gt;&nbsp;fffff801ea5f5448     &nbsp;0&nbsp;rw&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;23*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff804edad0800&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;24*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff80249ff8400&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462  &nbsp;25*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff80566026400&lt;br&gt;...&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462&nbsp;25018*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff8045848d000&lt;br&gt;<br>
brandon &nbsp;beam.smp  &nbsp;65462&nbsp;25019*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff805662fb400&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462&nbsp;25020*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff804a4633400&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462&nbsp;25021*&nbsp;internet&nbsp;stream&nbsp;tcp&nbsp;fffff802495a8000&lt;br&gt;brandon &nbsp;beam.smp  &nbsp;65462&nbsp;25024*&nbsp;pipe&nbsp;fffff8049522a160&nbsp;&lt;-&gt;&nbsp;fffff8049522a000     &nbsp;0&nbsp;rw&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;you&nbsp;need&nbsp;anything&nbsp;else,&nbsp;or&nbsp;if&nbsp;you&nbsp;spot&nbsp;anything&nbsp;that&nbsp;I&nbsp;can&nbsp;do&nbsp;to&nbsp;mitigate&nbsp;the&nbsp;issue.&lt;br&gt;&lt;br&gt;&lt;/div&gt;-Brandon&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Apr&nbsp;18,&nbsp;2014&nbsp;at&nbsp;8:16&nbsp;AM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Brandon,&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;15/04/14&nbsp;17:25,&nbsp;Brandon&nbsp;Munroe&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
The&nbsp;message&nbsp;in&nbsp;the&nbsp;logs&nbsp;reads:&lt;br&gt;<br>
&lt;br&gt;<br>
**&nbsp;Generic&nbsp;server&nbsp;rabbit_mgmt_external_stats&nbsp;terminating&lt;br&gt;<br>
**&nbsp;Last&nbsp;message&nbsp;in&nbsp;was&nbsp;emit_update&lt;br&gt;<br>
**&nbsp;When&nbsp;Server&nbsp;state&nbsp;==&nbsp;{state,707130}&lt;br&gt;<br>
**&nbsp;Reason&nbsp;for&nbsp;termination&nbsp;==&lt;br&gt;<br>
**&nbsp;{function_clause,[{lists,nth,[&lt;u&gt;&lt;/u&gt;1,[]],[{file,&quot;lists.erl&quot;},{&lt;u&gt;&lt;/u&gt;line,168}]},&lt;br&gt;<br>
&lt;br&gt;<br>
{rabbit_mgmt_external_stats,&#39;-&lt;u&gt;&lt;/u&gt;get_used_fd/1-fun-1-&#39;,2,[]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{lists,&#39;-filter/2-lc$^0/1-0-&#39;,&lt;u&gt;&lt;/u&gt;2,&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [{file,&quot;lists.erl&quot;},{line,&lt;u&gt;&lt;/u&gt;1271}]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{lists,&#39;-filter/2-lc$^0/1-0-&#39;,&lt;u&gt;&lt;/u&gt;2,&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [{file,&quot;lists.erl&quot;},{line,&lt;u&gt;&lt;/u&gt;1271}]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{rabbit_mgmt_external_stats,&lt;u&gt;&lt;/u&gt;get_used_fd,1,[]},&lt;br&gt;<br>
&lt;br&gt;<br>
{rabbit_mgmt_external_stats,&#39;-&lt;u&gt;&lt;/u&gt;infos/2-lc$^0/1-0-&#39;,2,[]},&lt;br&gt;<br>
&lt;br&gt;<br>
{rabbit_mgmt_external_stats,&#39;-&lt;u&gt;&lt;/u&gt;infos/2-lc$^0/1-0-&#39;,2,[]},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{rabbit_mgmt_external_stats,&lt;u&gt;&lt;/u&gt;emit_update,1,[]}]}&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
On&nbsp;BSD&nbsp;RabbitMQ&nbsp;invokes&nbsp;&#39;fstat&nbsp;-p&nbsp;&lt;pid&gt;&#39;&nbsp;to&nbsp;determine&nbsp;the&nbsp;number&nbsp;of&nbsp;used&nbsp;file&nbsp;descriptors.&nbsp;In&nbsp;the&nbsp;above&nbsp;it&nbsp;is&nbsp;tripping&nbsp;over&nbsp;the&nbsp;parsing&nbsp;of&nbsp;the&nbsp;output.&nbsp;If&nbsp;you&nbsp;can,&nbsp;please&nbsp;post&nbsp;the&nbsp;output&nbsp;of&nbsp;that&nbsp;command&nbsp;just&nbsp;before&nbsp;rabbit&nbsp;dies.&nbsp;Meanwhile&nbsp;I&#39;ve&nbsp;filed&nbsp;a&nbsp;bug&nbsp;to&nbsp;make&nbsp;our&nbsp;parsing&nbsp;code&nbsp;more&nbsp;robust.&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
