<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;have&nbsp;separate&nbsp;AppDomains&nbsp;(not&nbsp;primary)&nbsp;where&nbsp;I&nbsp;use&nbsp;RabbitMq.Client&nbsp;(RMQC).&nbsp;When&nbsp;I&nbsp;try&nbsp;to&nbsp;unload&nbsp;domain&nbsp;it&nbsp;seems&nbsp;like&nbsp;RMQC&nbsp;prevents&nbsp;to&nbsp;do&nbsp;it&nbsp;gracefully.&lt;div&gt;ConnectionBase&nbsp;creates&nbsp;2&nbsp;_foreground_&nbsp;threads&nbsp;which&nbsp;in&nbsp;case&nbsp;of&nbsp;absence&nbsp;of&nbsp;messages&nbsp;are&nbsp;blocked&nbsp;inside&nbsp;Socket.Receive&nbsp;and&nbsp;do&nbsp;not&nbsp;check&nbsp;external&nbsp;flags&nbsp;like&nbsp;m_running/m_closed.&lt;/div&gt;&lt;div&gt;Yes,&nbsp;ConnectionBase&nbsp;has&nbsp;subscription&nbsp;to&nbsp;DomainUnload:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;pre&gt;&lt;a&nbsp;title=&quot;System.AppDomain<br>
<br>
CTRL+Click&nbsp;to&nbsp;open&nbsp;in&nbsp;new&nbsp;tab.&quot;&nbsp;href=&quot;http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.AppDomain&quot;&gt;AppDomain&lt;/a&gt;.&lt;a&nbsp;title=&quot;AppDomain&nbsp;System.AppDomain.CurrentDomain&nbsp;{&nbsp;...&nbsp;}<br>
<br>
CTRL+Click&nbsp;to&nbsp;open&nbsp;in&nbsp;new&nbsp;tab.&quot;&nbsp;href=&quot;http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:4.0.0.0:b77a5c561934e089/System.AppDomain/property:CurrentDomain:System.AppDomain&quot;&gt;CurrentDomain&lt;/a&gt;.&lt;a&nbsp;title=&quot;event&nbsp;EventHandler&nbsp;System.AppDomain.DomainUnload;<br>
<br>
CTRL+Click&nbsp;to&nbsp;open&nbsp;in&nbsp;new&nbsp;tab.&quot;&nbsp;href=&quot;http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:4.0.0.0:b77a5c561934e089/System.AppDomain/event:DomainUnload:System.EventHandler&quot;&gt;DomainUnload&lt;/a&gt;&nbsp;+=&nbsp;&lt;font&nbsp;color=&quot;#1000a0&quot;&gt;new&lt;/font&gt;&nbsp;&lt;a&nbsp;title=&quot;System.EventHandler<br>
<br>
CTRL+Click&nbsp;to&nbsp;open&nbsp;in&nbsp;new&nbsp;tab.&quot;&nbsp;href=&quot;http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://mscorlib:2.0.0.0:b77a5c561934e089/System.EventHandler&quot;&gt;EventHandler&lt;/a&gt;(&lt;font&nbsp;color=&quot;#1000a0&quot;&gt;this&lt;/font&gt;.&lt;a&nbsp;title=&quot;void&nbsp;RabbitMQ.Client.Impl.ConnectionBase.HandleDomainUnload(object&nbsp;sender,&nbsp;EventArgs&nbsp;ea);<br>
<br>
CTRL+Click&nbsp;to&nbsp;open&nbsp;in&nbsp;new&nbsp;tab.&quot;&nbsp;href=&quot;http://127.0.0.1/roeder/dotnet/Default.aspx?Target=code://RabbitMQ.Client:3.2.1.0:89e7d7c5feba84ce/RabbitMQ.Client.Impl.ConnectionBase/HandleDomainUnload(Object,System.EventArgs)&quot;&gt;HandleDomainUnload&lt;/a&gt;);<br>
&lt;/pre&gt;&lt;pre&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;white-space:&nbsp;normal;&quot;&gt;but&nbsp;it&nbsp;won't&nbsp;be&nbsp;called&nbsp;if&nbsp;any&nbsp;foreground&nbsp;threads&nbsp;prevent&nbsp;domain&nbsp;from&nbsp;unloading.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;white-space:&nbsp;normal;&quot;&gt;It&nbsp;would&nbsp;be&nbsp;nice&nbsp;if&nbsp;all&nbsp;threads&nbsp;created&nbsp;inside&nbsp;ConnectionBase&nbsp;would&nbsp;have&nbsp;IsBackground&nbsp;set&nbsp;to&nbsp;true.&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
