<tt>
Hi,&lt;br&gt;&lt;br&gt;I&nbsp;wanted&nbsp;to&nbsp;follow&nbsp;up&nbsp;on&nbsp;an&nbsp;issue&nbsp;that&amp;#39;s&nbsp;been&nbsp;on&nbsp;our&nbsp;radar&nbsp;for&nbsp;a&nbsp;while,&nbsp;but&nbsp;I&nbsp;haven&amp;#39;t&nbsp;seen&nbsp;any&nbsp;updates&nbsp;on&nbsp;it&nbsp;and&nbsp;wanted&nbsp;to&nbsp;see&nbsp;what&nbsp;our&nbsp;options&nbsp;might&nbsp;be&nbsp;here.&lt;br&gt;&lt;br&gt;We&nbsp;have&nbsp;been&nbsp;leveraging&nbsp;the&nbsp;py-amqplib&nbsp;client&nbsp;library&nbsp;with&nbsp;rabbitmq,&nbsp;which&nbsp;has&nbsp;performed&nbsp;quite&nbsp;well&nbsp;in&nbsp;our&nbsp;application&nbsp;with&nbsp;one&nbsp;main&nbsp;limitation. &nbsp;The&nbsp;main&nbsp;issue&nbsp;we&nbsp;have&nbsp;with&nbsp;it&nbsp;is&nbsp;that&nbsp;it&nbsp;does&nbsp;not&nbsp;currently&nbsp;support&nbsp;the&nbsp;Channel.Flow&nbsp;message&nbsp;from&nbsp;an&nbsp;AMQP&nbsp;broker&nbsp;-&nbsp;which&nbsp;means&nbsp;when&nbsp;the&nbsp;server&nbsp;tries&nbsp;to&nbsp;prevent&nbsp;a&nbsp;producing&nbsp;client&nbsp;app&nbsp;from&nbsp;overloading&nbsp;the&nbsp;system,&nbsp;the&nbsp;client&nbsp;ignores&nbsp;the&nbsp;message&nbsp;and&nbsp;continues&nbsp;sending. &nbsp;Since&nbsp;RabbitMQ&nbsp;will&nbsp;continue&nbsp;to&nbsp;process&nbsp;until&nbsp;it&nbsp;allocates&nbsp;all&nbsp;of&nbsp;its&nbsp;memory,&nbsp;it&nbsp;dies&nbsp;a&nbsp;horrible&nbsp;death&nbsp;and&nbsp;all&nbsp;of&nbsp;the&nbsp;messages&nbsp;in&nbsp;the&nbsp;broker&nbsp;are&nbsp;lost&nbsp;(reproduction&nbsp;steps&nbsp;below).&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;Two&nbsp;basic&nbsp;questions:&lt;br&gt;1)&nbsp;What&nbsp;are&nbsp;my&nbsp;alternatives&nbsp;here&nbsp;from&nbsp;a&nbsp;python&nbsp;client&nbsp;side? &nbsp;I&nbsp;have&nbsp;periodically&nbsp;checked&nbsp;into&nbsp;this&nbsp;with&nbsp;Barry&nbsp;for&nbsp;the&nbsp;py-amqplib,&nbsp;but&nbsp;it&nbsp;appears&nbsp;to&nbsp;involve&nbsp;a&nbsp;pretty&nbsp;significant&nbsp;code&nbsp;restructuring&nbsp;(if&nbsp;I&nbsp;remember&nbsp;correctly,&nbsp;it&nbsp;had&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;synchronous&nbsp;processing&nbsp;of&nbsp;messages). &nbsp;We&nbsp;need&nbsp;a&nbsp;fully&nbsp;baked&nbsp;client,&nbsp;and&nbsp;Barry&amp;#39;s&nbsp;client&nbsp;works&nbsp;well&nbsp;in&nbsp;normal&nbsp;situations&nbsp;-&nbsp;we&nbsp;just&nbsp;need&nbsp;it&nbsp;to&nbsp;be&nbsp;more&nbsp;fault-tolerant&nbsp;in&nbsp;the&nbsp;heavy&nbsp;saturation&nbsp;cases&nbsp;to&nbsp;prevent&nbsp;production&nbsp;failures.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;2)&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;viable&nbsp;options&nbsp;from&nbsp;a&nbsp;python&nbsp;client&nbsp;right&nbsp;now,&nbsp;what&nbsp;prevents&nbsp;you&nbsp;guys&nbsp;from&nbsp;adding&nbsp;some&nbsp;code&nbsp;to&nbsp;the&nbsp;rabbitmq&nbsp;broker&nbsp;from&nbsp;simply&nbsp;failing&nbsp;a&nbsp;connection&nbsp;that&nbsp;refuses&nbsp;to&nbsp;honor&nbsp;the&nbsp;Channel.Flow&nbsp;message&nbsp;when&nbsp;it&nbsp;has&nbsp;been&nbsp;broadcast? &nbsp;I&nbsp;asked&nbsp;this&nbsp;back&nbsp;in&nbsp;1.5.0&nbsp;(or&nbsp;around&nbsp;there),&nbsp;and&nbsp;think&nbsp;this&nbsp;would&nbsp;be&nbsp;a&nbsp;great&nbsp;safety&nbsp;mechanism&nbsp;to&nbsp;prevent&nbsp;a&nbsp;single&nbsp;rogue&nbsp;client&nbsp;from&nbsp;bringing&nbsp;down&nbsp;a&nbsp;broker.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;Any&nbsp;help&nbsp;here&nbsp;would&nbsp;be&nbsp;greatly&nbsp;appreciated. &nbsp;This&nbsp;has&nbsp;bitten&nbsp;us&nbsp;a&nbsp;few&nbsp;times&nbsp;in&nbsp;the&nbsp;past&nbsp;and&nbsp;is&nbsp;the&nbsp;weakest&nbsp;part&nbsp;of&nbsp;our&nbsp;pipeline&nbsp;right&nbsp;now. &nbsp;We&nbsp;are&nbsp;able&nbsp;to&nbsp;buffer&nbsp;our&nbsp;messages&nbsp;on&nbsp;disk&nbsp;on&nbsp;the&nbsp;producer&nbsp;side,&nbsp;so&nbsp;any&nbsp;stoppage&nbsp;at&nbsp;the&nbsp;rabbitmq&nbsp;side&nbsp;would&nbsp;simply&nbsp;cause&nbsp;our&nbsp;producer&nbsp;app&nbsp;to&nbsp;retry&nbsp;a&nbsp;connection&nbsp;and&nbsp;resume&nbsp;transmission.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;I&nbsp;don&amp;#39;t&nbsp;read&nbsp;this&nbsp;list&nbsp;as&nbsp;actively&nbsp;as&nbsp;I&nbsp;would&nbsp;like,&nbsp;but&nbsp;I&nbsp;didn&amp;#39;t&nbsp;find&nbsp;any&nbsp;recent&nbsp;posts&nbsp;on&nbsp;this&nbsp;from&nbsp;any&nbsp;searches&nbsp;I&nbsp;was&nbsp;able&nbsp;to&nbsp;come&nbsp;up&nbsp;with. &nbsp;Hopefully&nbsp;the&nbsp;answer&nbsp;is&nbsp;out&nbsp;there&nbsp;and&nbsp;I&nbsp;have&nbsp;just&nbsp;missed&nbsp;it. &nbsp;Please&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;I&nbsp;need&nbsp;to&nbsp;give&nbsp;more&nbsp;info&nbsp;here&nbsp;to&nbsp;help&nbsp;drive&nbsp;the&nbsp;discussion.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;Thanks,&lt;br&gt;Brian&lt;br&gt;&lt;br&gt;====&nbsp;Reproduction&nbsp;steps&nbsp;====&lt;br&gt;&lt;br&gt;Attached&nbsp;is&nbsp;my&nbsp;failure&nbsp;case&nbsp;test&nbsp;script. &nbsp;In&nbsp;a&nbsp;nutshell,&nbsp;the&nbsp;test&nbsp;is&nbsp;as&nbsp;follows:&lt;br&gt;-&nbsp;Create&nbsp;non-auto-delete&nbsp;queue,&nbsp;bound&nbsp;to&nbsp;a&nbsp;topic&lt;br&gt;-<br>
Spam&nbsp;that&nbsp;topic&nbsp;using&nbsp;the&nbsp;attached&nbsp;script&nbsp;until&nbsp;it&nbsp;maxes&nbsp;out&nbsp;the&nbsp;memory<br>
on&nbsp;the&nbsp;machine&nbsp;(luckily,&nbsp;my&nbsp;test&nbsp;box&nbsp;is&nbsp;only&nbsp;2GB&nbsp;so&nbsp;this&nbsp;does&nbsp;not&nbsp;take<br>
too&nbsp;long)&lt;br&gt;<br>
-&nbsp;You&nbsp;can&nbsp;see&nbsp;the&nbsp;alerts&nbsp;fire&nbsp;in&nbsp;the&nbsp;/var/log/rabbitmq/rabbit.log&nbsp;file,<br>
but&nbsp;no&nbsp;active&nbsp;flag&nbsp;is&nbsp;set&nbsp;on&nbsp;the&nbsp;Channel&nbsp;object&nbsp;on&nbsp;the&nbsp;Python&nbsp;client<br>
side.&lt;br&gt;-<br>
One&nbsp;note&nbsp;is&nbsp;that&nbsp;I&nbsp;am&nbsp;talking&nbsp;to&nbsp;a&nbsp;1.5.3&nbsp;broker,&nbsp;but&nbsp;the&nbsp;Channel.Flow<br>
should&nbsp;be&nbsp;working&nbsp;fine&nbsp;in&nbsp;that&nbsp;version,&nbsp;this&nbsp;is&nbsp;the&nbsp;client&amp;#39;s&nbsp;handling<br>
that&nbsp;I&nbsp;am&nbsp;focusing&nbsp;on.&lt;br&gt;&lt;br&gt;&lt;br&gt;<br>

</tt>
