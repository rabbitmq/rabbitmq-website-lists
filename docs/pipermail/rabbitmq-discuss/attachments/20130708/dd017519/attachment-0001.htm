<tt>
&lt;br/&gt;&lt;br/&gt;On&nbsp;Monday&nbsp;8&nbsp;July&nbsp;2013&nbsp;at&nbsp;17:49,&nbsp;Matthias&nbsp;Radestock-3&nbsp;[via&nbsp;RabbitMQ]&nbsp;wrote:<br>
&lt;br/&gt;&lt;div&nbsp;class='shrinkable-quote'&gt;&lt;br/&gt;&amp;gt;&nbsp;Carl,&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;thanks&nbsp;for&nbsp;the&nbsp;answers.&nbsp;A&nbsp;few&nbsp;follow-up&nbsp;questions...&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;On&nbsp;08/07/13&nbsp;16:23,&nbsp;Carl&nbsp;HÃ¶rberg&nbsp;wrote:&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;On&nbsp;Monday&nbsp;8&nbsp;July&nbsp;2013&nbsp;at&nbsp;12:19,&nbsp;Matthias&nbsp;Radestock&nbsp;wrote:&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;-&nbsp;what&nbsp;entities&nbsp;do&nbsp;you&nbsp;want&nbsp;to&nbsp;monitor?&nbsp;You&nbsp;mention&nbsp;channels,&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;consumers&nbsp;and&nbsp;declarations&nbsp;(presumably&nbsp;by&nbsp;that&nbsp;you&nbsp;mean&nbsp;exchanges,&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;queues,&nbsp;and&nbsp;bindings).&nbsp;Any&nbsp;others?&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;That,&nbsp;plus&nbsp;connection&nbsp;count.&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;Connection&nbsp;count&nbsp;is&nbsp;bounded&nbsp;by&nbsp;the&nbsp;available&nbsp;file&nbsp;descriptors,&nbsp;for&nbsp;which&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;you&nbsp;can&nbsp;tune&nbsp;the&nbsp;limit&nbsp;in&nbsp;the&nbsp;O/S.&nbsp;I&nbsp;would&nbsp;have&nbsp;thought&nbsp;that&nbsp;is&nbsp;sufficient.<br>
&lt;/div&gt;&lt;br/&gt;You're&nbsp;right,&nbsp;the&nbsp;global&nbsp;limit,&nbsp;but&nbsp;we&nbsp;monitor&nbsp;and&nbsp;limit&nbsp;individual&nbsp;vhost&nbsp;connections&nbsp;too.&nbsp;The&nbsp;only&nbsp;problem&nbsp;is&nbsp;if&nbsp;a&nbsp;user&nbsp;creates&nbsp;a&nbsp;lot&nbsp;of&nbsp;connections&nbsp;within&nbsp;5&nbsp;seconds,&nbsp;then&nbsp;we&nbsp;can't&nbsp;block&nbsp;new&nbsp;connections&nbsp;fast&nbsp;enough.&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&lt;br/&gt;And&nbsp;the&nbsp;way&nbsp;we&nbsp;block&nbsp;is&nbsp;suboptimal&nbsp;too,&nbsp;today&nbsp;we&nbsp;remove&nbsp;the&nbsp;password&nbsp;(or&nbsp;remove&nbsp;the&nbsp;vhost&nbsp;permission),&nbsp;but&nbsp;then&nbsp;they&nbsp;can't&nbsp;access&nbsp;the&nbsp;mgmt&nbsp;interface&nbsp;either,&nbsp;which&nbsp;confuses&nbsp;a&nbsp;lot&nbsp;of&nbsp;users.&nbsp;&amp;nbsp;<br>
&lt;div&nbsp;class='shrinkable-quote'&gt;&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;A&nbsp;global&nbsp;limit&nbsp;would&nbsp;be&nbsp;sufficient&nbsp;for&nbsp;the&nbsp;time&nbsp;being,&nbsp;just&nbsp;for&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;protection,&nbsp;so&nbsp;that&nbsp;the&nbsp;cluster&nbsp;doesn't&nbsp;dies&nbsp;before&nbsp;we&nbsp;can&nbsp;see&nbsp;who&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;has&nbsp;done&nbsp;what.&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;So&nbsp;say&nbsp;rabbit&nbsp;enforced&nbsp;global&nbsp;limits&nbsp;for&nbsp;the&nbsp;numbers&nbsp;of&nbsp;channels,&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;consumers,&nbsp;exchanges,&nbsp;queues&nbsp;and&nbsp;bindings.&nbsp;How&nbsp;would&nbsp;you&nbsp;go&nbsp;about&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;picking&nbsp;the&nbsp;limits?&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;There&nbsp;is&nbsp;nothing&nbsp;wrong&nbsp;with&nbsp;having&nbsp;lots&nbsp;of&nbsp;channels,&nbsp;or&nbsp;lots&nbsp;of&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;consumers,&nbsp;or&nbsp;lots&nbsp;of&nbsp;exchanges,&nbsp;etc,&nbsp;etc.&nbsp;But&nbsp;if&nbsp;you&nbsp;set&nbsp;upper&nbsp;bounds&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;on&nbsp;what&nbsp;rabbit&nbsp;can&nbsp;sustain&nbsp;for&nbsp;each&nbsp;one&nbsp;of&nbsp;them,&nbsp;then&nbsp;a&nbsp;rabbit&nbsp;which&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;encounters&nbsp;mixed&nbsp;usage&nbsp;could&nbsp;still&nbsp;run&nbsp;out&nbsp;of&nbsp;memory.<br>
&lt;/div&gt;&lt;br/&gt;True..&nbsp;Most&nbsp;often&nbsp;it's&nbsp;not&nbsp;that&nbsp;complicated&nbsp;though.&nbsp;Often&nbsp;we&nbsp;can&nbsp;see&nbsp;that&nbsp;user&nbsp;uses&nbsp;a&nbsp;lot&nbsp;of&nbsp;resources,&nbsp;and&nbsp;then&nbsp;we&nbsp;contact&nbsp;that&nbsp;user&nbsp;and&nbsp;make&nbsp;sure&nbsp;that&nbsp;he's&nbsp;doing&nbsp;the&nbsp;right&nbsp;thing.&nbsp;Again,&nbsp;the&nbsp;problem&nbsp;we&nbsp;have&nbsp;is&nbsp;when&nbsp;customers&nbsp;by&nbsp;bugs&nbsp;or&nbsp;by&nbsp;other&nbsp;means&nbsp;creates&nbsp;a&nbsp;lot&nbsp;of&nbsp;something&nbsp;very&nbsp;very&nbsp;fast,&nbsp;faster&nbsp;than&nbsp;we&nbsp;can&nbsp;monitor.&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;Furthermore,&nbsp;as&nbsp;you&nbsp;know,&nbsp;in&nbsp;the&nbsp;default&nbsp;configuration&nbsp;messages&nbsp;take&nbsp;up&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;some&nbsp;residual&nbsp;memory&nbsp;even&nbsp;when&nbsp;paged&nbsp;to&nbsp;disk,&nbsp;which&nbsp;means&nbsp;there&nbsp;is&nbsp;less&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;memory&nbsp;available&nbsp;for&nbsp;everything.&nbsp;This&nbsp;too&nbsp;makes&nbsp;it&nbsp;hard&nbsp;to&nbsp;choose&nbsp;any&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;bounds&nbsp;which&nbsp;have&nbsp;a&nbsp;reasonable&nbsp;chance&nbsp;of&nbsp;working&nbsp;w/o&nbsp;being&nbsp;silly&nbsp;low.&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;True,&nbsp;i've&nbsp;seen&nbsp;the&nbsp;message&nbsp;index&nbsp;grow&nbsp;to&nbsp;many&nbsp;gigabytes,&nbsp;which&nbsp;is&nbsp;way&nbsp;we&nbsp;now&nbsp;monitor&nbsp;queue&nbsp;length&nbsp;too,&nbsp;but&nbsp;&amp;quot;fortunately&amp;quot;&nbsp;message&nbsp;queues&nbsp;can&nbsp;only&nbsp;grow&nbsp;with&nbsp;a&nbsp;couple&nbsp;of&nbsp;thousands&nbsp;messages&nbsp;per&nbsp;second,&nbsp;not&nbsp;millions,&nbsp;which&nbsp;is&nbsp;required&nbsp;to&nbsp;build&nbsp;a&nbsp;huge&nbsp;index.&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;Since&nbsp;your&nbsp;main&nbsp;concern&nbsp;is&nbsp;memory&nbsp;exhaustion&nbsp;-&nbsp;and&nbsp;by&nbsp;that&nbsp;presumably&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;you&nbsp;mean&nbsp;rabbit&nbsp;crashing&nbsp;because&nbsp;it&nbsp;cannot&nbsp;allocate&nbsp;any&nbsp;more&nbsp;memory,&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;rather&nbsp;than&nbsp;just&nbsp;hitting&nbsp;the&nbsp;memory&nbsp;alarm&nbsp;and&nbsp;blocking&nbsp;publisher&nbsp;-&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;perhaps&nbsp;a&nbsp;better&nbsp;-&nbsp;simpler&nbsp;and&nbsp;more&nbsp;versatile&nbsp;-&nbsp;behaviour&nbsp;would&nbsp;be&nbsp;for&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;rabbit&nbsp;to&nbsp;block&nbsp;all&nbsp;channel,&nbsp;consumer&nbsp;and&nbsp;resource&nbsp;declarations&nbsp;when&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;memory&nbsp;gets&nbsp;*really*&nbsp;tight.<br>
&lt;br/&gt;&lt;br/&gt;That&nbsp;would&nbsp;be&nbsp;a&nbsp;great&nbsp;solution!&nbsp;Or&nbsp;somehow&nbsp;&amp;quot;slow&nbsp;things&nbsp;down&amp;quot;,&nbsp;so&nbsp;we&nbsp;have&nbsp;the&nbsp;chance&nbsp;to&nbsp;use&nbsp;the&nbsp;mgmt&nbsp;api&nbsp;and&nbsp;read&nbsp;the&nbsp;values&nbsp;before&nbsp;it's&nbsp;too&nbsp;late.&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;<br>
&lt;div&nbsp;class='shrinkable-quote'&gt;&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;Regards,&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;Matthias.&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;_______________________________________________&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;rabbitmq-discuss&nbsp;mailing&nbsp;list&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;[hidden&nbsp;email]&nbsp;(/user/SendEmail.jtp?type=node&amp;amp;node=27904&amp;amp;i=0)&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_top&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;&amp;nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;If&nbsp;you&nbsp;reply&nbsp;to&nbsp;this&nbsp;email,&nbsp;your&nbsp;message&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;the&nbsp;discussion&nbsp;below:&nbsp;&lt;a&nbsp;href=&quot;http://rabbitmq.1065348.n5.nabble.com/DOS-protection-tp27876p27904.html&quot;&nbsp;target=&quot;_top&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&gt;http://rabbitmq.1065348.n5.nabble.com/DOS-protection-tp27876p27904.html&lt;/a&gt;&amp;nbsp;&nbsp;<br>
&lt;br/&gt;&amp;gt;&nbsp;To&nbsp;unsubscribe&nbsp;from&nbsp;DOS&nbsp;protection,&nbsp;click&nbsp;here&nbsp;(&lt;a&nbsp;href=&quot;&quot;&nbsp;target=&quot;_top&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&gt;<br>
&lt;br/&gt;&amp;gt;&nbsp;NAML&nbsp;(&lt;a&nbsp;href=&quot;http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&amp;id=instant_html%21nabble%3Aemail.naml&amp;base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&amp;breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml&quot;&nbsp;target=&quot;_top&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&gt;http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&amp;amp;id=instant_html%21nabble%3Aemail.naml&amp;amp;base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&amp;amp;breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml&lt;/a&gt;)&nbsp;&amp;nbsp;<br>
&lt;/div&gt;&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;<br>
<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br>
&lt;br/&gt;&lt;hr&nbsp;align=&quot;left&quot;&nbsp;width=&quot;300&quot;&nbsp;/&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://rabbitmq.1065348.n5.nabble.com/DOS-protection-tp27876p27906.html&quot;&gt;Re:&nbsp;DOS&nbsp;protection&lt;/a&gt;&lt;br/&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;&lt;a&nbsp;href=&quot;http://rabbitmq.1065348.n5.nabble.com/&quot;&gt;RabbitMQ&nbsp;mailing&nbsp;list&nbsp;archive&lt;/a&gt;&nbsp;at&nbsp;Nabble.com.&lt;br/&gt;
</tt>
