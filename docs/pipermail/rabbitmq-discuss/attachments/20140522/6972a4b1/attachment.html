<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;It&nbsp;seems&nbsp;that&nbsp;one&nbsp;of&nbsp;your&nbsp;assumptions&nbsp;is&nbsp;that&nbsp;a&nbsp;cluster&nbsp;would&nbsp;operate&nbsp;across&nbsp;data&nbsp;centers.&nbsp;This&nbsp;is&nbsp;not&nbsp;recommended&nbsp;for&nbsp;RabbitMQ&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;use&nbsp;it&nbsp;that&nbsp;way&nbsp;-&nbsp;we&nbsp;use&nbsp;shovels&nbsp;between&nbsp;clusters&nbsp;since&nbsp;we,&nbsp;like&nbsp;you,&nbsp;can&nbsp;deal&nbsp;with&nbsp;eventual&nbsp;consistency.&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Our&nbsp;clusters&nbsp;are&nbsp;similar&nbsp;to&nbsp;what&nbsp;you&nbsp;describe.&nbsp;For&nbsp;us,&nbsp;(almost)&nbsp;all&nbsp;queues&nbsp;are&nbsp;persistent&nbsp;and&nbsp;mirrored&nbsp;because&nbsp;we&nbsp;can&#39;t&nbsp;tolerate&nbsp;message&nbsp;loss.&nbsp;We&nbsp;have&nbsp;seen&nbsp;significant&nbsp;sensitivity&nbsp;to&nbsp;partitioning&nbsp;in&nbsp;Windows&nbsp;OS-based&nbsp;clusters&nbsp;under&nbsp;very&nbsp;heavy&nbsp;load;&nbsp;we&nbsp;do&nbsp;not&nbsp;see&nbsp;this&nbsp;on&nbsp;Linux&nbsp;and&nbsp;can&nbsp;run&nbsp;at&nbsp;least&nbsp;twice&nbsp;the&nbsp;load&nbsp;as&nbsp;well. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;is&nbsp;an&nbsp;F5&nbsp;in&nbsp;front&nbsp;of&nbsp;the&nbsp;cluster,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;do&nbsp;load&nbsp;balancing&nbsp;but&nbsp;just&nbsp;acts&nbsp;as&nbsp;a&nbsp;persistent&nbsp;router.&nbsp;We&#39;ve&nbsp;found&nbsp;that&nbsp;by&nbsp;directing&nbsp;all&nbsp;traffic&nbsp;to&nbsp;one&nbsp;node&nbsp;and&nbsp;letting&nbsp;it&nbsp;replicate&nbsp;to&nbsp;other&nbsp;nodes&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;deal&nbsp;with&nbsp;issues&nbsp;if&nbsp;a&nbsp;network&nbsp;partition&nbsp;occurs,&nbsp;and&nbsp;they&nbsp;*do*&nbsp;occur&nbsp;(earlier&nbsp;this&nbsp;week&nbsp;one&nbsp;of&nbsp;the&nbsp;virtual&nbsp;NICs&nbsp;stopped&nbsp;on&nbsp;one&nbsp;of&nbsp;the&nbsp;Rabbit&nbsp;nodes,&nbsp;for&nbsp;example).&nbsp;The&nbsp;F5&nbsp;will&nbsp;detect&nbsp;this&nbsp;very&nbsp;quickly&nbsp;and&nbsp;divert&nbsp;traffic&nbsp;to&nbsp;another&nbsp;node&nbsp;if&nbsp;necessary.&nbsp;(Note&nbsp;to&nbsp;others&nbsp;-&nbsp;we&#39;ve&nbsp;found&nbsp;that&nbsp;this&nbsp;arrangement&nbsp;scales&nbsp;significantly&nbsp;better&nbsp;than&nbsp;round&nbsp;robin&nbsp;load&nbsp;balancing&nbsp;for&nbsp;mirrored&nbsp;persistent&nbsp;queues).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;have&nbsp;clusters&nbsp;in&nbsp;each&nbsp;data&nbsp;center;&nbsp;for&nbsp;clusters&nbsp;that&nbsp;need&nbsp;to&nbsp;replicate&nbsp;to&nbsp;a&nbsp;different&nbsp;data&nbsp;center&nbsp;there&nbsp;is&nbsp;the&nbsp;shovel.&nbsp;However,&nbsp;there&nbsp;is&nbsp;a&nbsp;chance&nbsp;of&nbsp;message&nbsp;loss&nbsp;if&nbsp;the&nbsp;application&nbsp;sends&nbsp;the&nbsp;message&nbsp;to&nbsp;the&nbsp;cluster&nbsp;in&nbsp;one&nbsp;DC&nbsp;and&nbsp;that&nbsp;entire&nbsp;DC&nbsp;is&nbsp;hit&nbsp;by&nbsp;a&nbsp;meteor&nbsp;before&nbsp;the&nbsp;message&nbsp;can&nbsp;be&nbsp;delivered&nbsp;to&nbsp;the&nbsp;other&nbsp;data&nbsp;center.&nbsp;For&nbsp;most&nbsp;scenarios,&nbsp;however,&nbsp;the&nbsp;messages&nbsp;will&nbsp;be&nbsp;eventually&nbsp;delivered&nbsp;when&nbsp;the&nbsp;DC&nbsp;comes&nbsp;back&nbsp;up.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hope&nbsp;that&nbsp;helps&nbsp;a&nbsp;little...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-ronc&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;May&nbsp;22,&nbsp;2014&nbsp;at&nbsp;12:04&nbsp;PM,&nbsp;Steffen&nbsp;Daniel&nbsp;Jensen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:steffen.daniel.jensen@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;steffen.daniel.jensen@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Simon,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;reply.&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
We&nbsp;have&nbsp;two&nbsp;data&nbsp;centers&nbsp;connected&nbsp;closely&nbsp;by&nbsp;LAN.&lt;br&gt;<br>
We&nbsp;are&nbsp;interested&nbsp;in&nbsp;a&nbsp;*reliable&nbsp;cluster*&nbsp;setup.&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;cluster&lt;br&gt;<br>
because&nbsp;we&nbsp;want&nbsp;clients&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;connect&nbsp;to&nbsp;each&nbsp;node&lt;br&gt;<br>
transparently.&nbsp;Federation&nbsp;is&nbsp;not&nbsp;an&nbsp;option.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
I&nbsp;hope&nbsp;you&nbsp;realise&nbsp;that&nbsp;you&nbsp;are&nbsp;asking&nbsp;for&nbsp;a&nbsp;lot&nbsp;here!&nbsp;You&nbsp;should&nbsp;read&nbsp;up&nbsp;on&nbsp;the&nbsp;CAP&nbsp;theorem&nbsp;if&nbsp;you&nbsp;have&nbsp;not&nbsp;already&nbsp;done&nbsp;so.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Yes,&nbsp;I&nbsp;know.&nbsp;But&nbsp;I&nbsp;am&nbsp;not&nbsp;asking&nbsp;an&nbsp;unreasonably&nbsp;lot,&nbsp;IMO&nbsp;:-)&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;I&nbsp;am&nbsp;aware&nbsp;of&nbsp;the&nbsp;CAP&nbsp;theorem,&nbsp;but&nbsp;I&nbsp;don&#39;t&nbsp;see&nbsp;how&nbsp;it&nbsp;is&nbsp;in&nbsp;violation.&nbsp;I&nbsp;am&nbsp;willing&nbsp;to&nbsp;live&nbsp;with&nbsp;eventual&nbsp;consistency.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;1.&nbsp;It&nbsp;happens&nbsp;that&nbsp;the&nbsp;firewall/switch&nbsp;is&nbsp;restarted,&nbsp;and&nbsp;maybe&nbsp;a&nbsp;few&lt;br&gt;<br>
<br>
<br>
<br>
ping&nbsp;messages&nbsp;are&nbsp;lost.&lt;br&gt;<br>
2.&nbsp;The&nbsp;setup&nbsp;should&nbsp;survive&nbsp;data&nbsp;center&nbsp;crash&lt;br&gt;<br>
3.&nbsp;All&nbsp;queues&nbsp;are&nbsp;durable&nbsp;and&nbsp;mirrored,&nbsp;all&nbsp;messages&nbsp;are&nbsp;persisted,&nbsp;all&lt;br&gt;<br>
publishes&nbsp;are&nbsp;confirmed&lt;br&gt;<br>
There&nbsp;are&nbsp;3&nbsp;cluster-recovery&nbsp;settings&lt;br&gt;<br>
a)&nbsp;ignore:&nbsp;A&nbsp;cross&nbsp;data&nbsp;center&nbsp;network&nbsp;break-down&nbsp;would&nbsp;cause&nbsp;message&lt;br&gt;<br>
loss&nbsp;on&nbsp;the&nbsp;node&nbsp;that&nbsp;is&nbsp;restarted&nbsp;In&nbsp;order&nbsp;to&nbsp;rejoin.&lt;br&gt;<br>
b)&nbsp;pause_minority:&nbsp;If&nbsp;we&nbsp;choose&nbsp;the&nbsp;same&nbsp;number&nbsp;of&nbsp;nodes&nbsp;in&nbsp;each&nbsp;data&lt;br&gt;<br>
center,&nbsp;the&nbsp;whole&nbsp;cluster&nbsp;will&nbsp;pause.&nbsp;If&nbsp;we&nbsp;don&#39;t,&nbsp;only&nbsp;the&nbsp;data&nbsp;center&lt;br&gt;<br>
with&nbsp;the&nbsp;most&nbsp;nodes&nbsp;can&nbsp;survive.&lt;br&gt;<br>
c)&nbsp;auto_heal:&nbsp;If&nbsp;the&nbsp;cluster&nbsp;decides&nbsp;network&nbsp;partitioning,&nbsp;there&nbsp;is&nbsp;a&lt;br&gt;<br>
potential&nbsp;of&nbsp;message&nbsp;loss,&nbsp;when&nbsp;joining.&lt;br&gt;<br>
[I&nbsp;would&nbsp;really&nbsp;like&nbsp;a&nbsp;resync-setting&nbsp;similar&nbsp;to&nbsp;the&nbsp;one&nbsp;described&nbsp;below]&lt;br&gt;<br>
Question&nbsp;1:&nbsp;Is&nbsp;it&nbsp;even&nbsp;possible&nbsp;to&nbsp;have&nbsp;a&nbsp;fully&nbsp;reliable&nbsp;setup&nbsp;in&nbsp;such&nbsp;a&lt;br&gt;<br>
setting?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Depends&nbsp;how&nbsp;you&nbsp;define&nbsp;&quot;fully&nbsp;reliable&quot;.&nbsp;If&nbsp;you&nbsp;want&nbsp;Consistency&nbsp;(i.e.&nbsp;mirrored&nbsp;queues),&nbsp;Availability&nbsp;(i.e.&nbsp;neither&nbsp;data&nbsp;centre&nbsp;pauses)&nbsp;and&nbsp;Partition&nbsp;tolerance&nbsp;(no&nbsp;loss&nbsp;of&nbsp;data&nbsp;from&nbsp;either&nbsp;side&nbsp;if&nbsp;the&nbsp;network&nbsp;goes&nbsp;down&nbsp;between&nbsp;them)&nbsp;then&nbsp;I&#39;m&nbsp;afraid&nbsp;you&nbsp;can&#39;t.&lt;br&gt;<br>
<br>
<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;I&nbsp;mean&nbsp;when&nbsp;I&nbsp;say&nbsp;&quot;reliable&quot;&nbsp;is:&nbsp;All&nbsp;subscribers&nbsp;at&nbsp;the&nbsp;time&nbsp;of&nbsp;publish&nbsp;will&nbsp;eventually&nbsp;get&nbsp;the&nbsp;message.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;should&nbsp;be&nbsp;possible,&nbsp;assuming&nbsp;that&nbsp;all&nbsp;live&nbsp;inconsistent&nbsp;nodes&nbsp;will&nbsp;eventually&nbsp;rejoin&nbsp;(without&nbsp;dumping&nbsp;messages).&nbsp;I&nbsp;know&nbsp;this&nbsp;is&nbsp;not&nbsp;the&nbsp;case&nbsp;in&nbsp;rabbitmq,&nbsp;but&nbsp;it&nbsp;is&nbsp;definitely&nbsp;theoretically&nbsp;possible.&nbsp;I&nbsp;guess&nbsp;this&nbsp;is&nbsp;what&nbsp;is&nbsp;usually&nbsp;referred&nbsp;to&nbsp;as&nbsp;eventual&nbsp;consistency.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;<br>
<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
<br>
In&nbsp;reality&nbsp;we&nbsp;probably&nbsp;won&#39;t&nbsp;have&nbsp;actual&nbsp;network&nbsp;partitions,&nbsp;and&nbsp;it&nbsp;will&lt;br&gt;<br>
most&nbsp;probably&nbsp;only&nbsp;be&nbsp;a&nbsp;very&nbsp;short&nbsp;network&nbsp;downtime.&lt;br&gt;<br>
Question&nbsp;2:&nbsp;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;adjust&nbsp;how&nbsp;long&nbsp;it&nbsp;takes&nbsp;rabbitmq&nbsp;to&lt;br&gt;<br>
decide&nbsp;&quot;node&nbsp;down&quot;?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Yes,&nbsp;see&nbsp;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/nettick.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.rabbitmq.com/&lt;u&gt;&lt;/u&gt;nettick.html&lt;/a&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you!&nbsp;(!)&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;been&nbsp;looking&nbsp;for&nbsp;that&nbsp;one.&nbsp;But&nbsp;I&nbsp;am&nbsp;surprised&nbsp;to&nbsp;see&nbsp;that&nbsp;it&nbsp;is&nbsp;actually&nbsp;60sec.&nbsp;Then&nbsp;I&nbsp;really&nbsp;don&#39;t&nbsp;understand&nbsp;how&nbsp;I&nbsp;could&nbsp;have&nbsp;seen&nbsp;so&nbsp;many&nbsp;clusters&nbsp;ending&nbsp;up&nbsp;partitioned.&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Do&nbsp;you&nbsp;know&nbsp;what&nbsp;the&nbsp;consequence&nbsp;of&nbsp;doubling&nbsp;it&nbsp;might&nbsp;be?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;RabbitMq&nbsp;writes:&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(85,85,85);font-family:Verdana,sans-serif;font-size:13px;line-height:18px&quot;&gt;Increasing&nbsp;the &lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);font-family:&#39;Courier&nbsp;New&#39;,Courier,monospace;font-size:13px;white-space:nowrap;line-height:18px&quot;&gt;net_ticktime&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(85,85,85);font-family:Verdana,sans-serif;font-size:13px;line-height:18px&quot;&gt; across&nbsp;all&nbsp;nodes&nbsp;in&nbsp;a&nbsp;cluster&nbsp;will&nbsp;make&nbsp;the&nbsp;cluster&nbsp;more&nbsp;resilient&nbsp;to&nbsp;short&nbsp;network&nbsp;outtages,&nbsp;but&nbsp;it&nbsp;will&nbsp;take&nbsp;longer&nbsp;for&nbsp;remaing&nbsp;nodes&nbsp;to&nbsp;detect&nbsp;crashed&nbsp;nodes.&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;More&nbsp;specifically&nbsp;I&nbsp;wonder&nbsp;what&nbsp;happens&nbsp;in&nbsp;the&nbsp;time&nbsp;a&nbsp;node&nbsp;is&nbsp;actually&nbsp;in&nbsp;its&nbsp;own&nbsp;network,&nbsp;but&nbsp;before&nbsp;it&nbsp;finds&nbsp;out.&nbsp;In&nbsp;our&nbsp;setup&nbsp;all&nbsp;publishes&nbsp;have&nbsp;all-HA&nbsp;subscriber&nbsp;queues,&nbsp;with&nbsp;publisher&nbsp;confirm.&nbsp;So&nbsp;I&nbsp;will&nbsp;expect&nbsp;a&nbsp;distributed&nbsp;agreement&nbsp;that&nbsp;the&nbsp;msg&nbsp;has&nbsp;been&nbsp;persisted.&nbsp;Will&nbsp;a&nbsp;publisher&nbsp;confirm&nbsp;then&nbsp;block&nbsp;until&nbsp;the&nbsp;node&nbsp;decides&nbsp;that&nbsp;other&nbsp;nodes&nbsp;are&nbsp;down,&nbsp;and&nbsp;then&nbsp;succeed?&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
<br>
It&nbsp;is&nbsp;much&nbsp;better&nbsp;to&nbsp;have&nbsp;a&nbsp;halted&nbsp;rabbitmq&nbsp;for&nbsp;some&nbsp;seconds&nbsp;than&nbsp;to&lt;br&gt;<br>
have&nbsp;message&nbsp;loss.&lt;br&gt;<br>
Question&nbsp;3:&nbsp;Assume&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;the&nbsp;ignore&nbsp;setting,&nbsp;and&nbsp;that&nbsp;we&lt;br&gt;<br>
have&nbsp;only&nbsp;two&nbsp;nodes&nbsp;in&nbsp;the&nbsp;cluster.&nbsp;Would&nbsp;the&nbsp;following&nbsp;be&nbsp;a&nbsp;full&lt;br&gt;<br>
recovery&nbsp;with&nbsp;zero&nbsp;message&nbsp;loss?&lt;br&gt;<br>
0.&nbsp;Decide&nbsp;which&nbsp;node&nbsp;survives,&nbsp;Ns,&nbsp;and&nbsp;which&nbsp;should&nbsp;be&nbsp;restarted,&nbsp;Nr.&lt;br&gt;<br>
1.&nbsp;Refuse&nbsp;all&nbsp;connections&nbsp;to&nbsp;Nr&nbsp;except&nbsp;from&nbsp;a&nbsp;special&nbsp;recovery&lt;br&gt;<br>
application.&nbsp;(One&nbsp;could&nbsp;change&nbsp;the&nbsp;ip,&nbsp;so&nbsp;all&nbsp;running&nbsp;services&nbsp;can&#39;t&lt;br&gt;<br>
connect&nbsp;or&nbsp;similar)&lt;br&gt;<br>
2.&nbsp;Consume&nbsp;and&nbsp;republish&nbsp;all&nbsp;message&nbsp;from&nbsp;Nr&nbsp;to&nbsp;Ns.&lt;br&gt;<br>
3.&nbsp;Restart&nbsp;Nr&lt;br&gt;<br>
Then&nbsp;the&nbsp;cluster&nbsp;should&nbsp;be&nbsp;up-and-running&nbsp;again.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
That&nbsp;sounds&nbsp;like&nbsp;it&nbsp;would&nbsp;work.&nbsp;You&#39;re&nbsp;losing&nbsp;some&nbsp;availability&nbsp;and&nbsp;consistency,&nbsp;and&nbsp;your&nbsp;message&nbsp;ordering&nbsp;will&nbsp;change.&nbsp;You&nbsp;have&nbsp;a&nbsp;pretty&nbsp;good&nbsp;chance&nbsp;of&nbsp;duplicating&nbsp;lots&nbsp;of&nbsp;messages&nbsp;too&nbsp;(any&nbsp;that&nbsp;were&nbsp;in&nbsp;the&nbsp;queues&nbsp;when&nbsp;the&nbsp;partition&nbsp;happened).&nbsp;Assuming&nbsp;you&#39;re&nbsp;happy&nbsp;with&nbsp;that&nbsp;it&nbsp;sounds&nbsp;reasonable.&lt;br&gt;<br>
<br>
<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;duplication&nbsp;is&nbsp;ok&nbsp;--&nbsp;but&nbsp;assuming&nbsp;that&nbsp;rabbit&nbsp;is&nbsp;usually&nbsp;empty,&nbsp;it&nbsp;won&#39;t&nbsp;really&nbsp;happen,&nbsp;I&nbsp;think. &lt;/div&gt;&lt;div&gt;But&nbsp;--&nbsp;I&nbsp;am&nbsp;sure&nbsp;that&nbsp;rabbit&nbsp;does&nbsp;not&nbsp;guarantee&nbsp;exactly&nbsp;once&nbsp;delivery&nbsp;anyway.&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt;For&nbsp;that&nbsp;reason,&nbsp;we&nbsp;will&nbsp;build&nbsp;in&nbsp;idempotency&nbsp;for&nbsp;critical&nbsp;messages.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ordering&nbsp;can&nbsp;always&nbsp;get&nbsp;scrambled&nbsp;when&nbsp;nacking&nbsp;consuming&nbsp;messages,&nbsp;so&nbsp;we&nbsp;are&nbsp;not&nbsp;assuming&nbsp;ordering&nbsp;either.&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;About&nbsp;the&nbsp;CAP&nbsp;theorem&nbsp;in&nbsp;relation&nbsp;to&nbsp;rabbit.&lt;/div&gt;&lt;div&gt;Reliable&nbsp;messaging&nbsp;(zero&nbsp;message&nbsp;loss),&nbsp;is&nbsp;often&nbsp;preferred&nbsp;in&nbsp;SOA-settings.&nbsp;I&nbsp;wonder&nbsp;why&nbsp;vmware/pivotal/...&nbsp;chose&nbsp;not&nbsp;to&nbsp;prioritize&nbsp;this&nbsp;guarantee.&nbsp;It&nbsp;is&nbsp;aimed&nbsp;by&nbsp;the&nbsp;federation&nbsp;setup,&nbsp;but&nbsp;it&nbsp;is&nbsp;a&nbsp;little&nbsp;to&nbsp;weak&nbsp;in&nbsp;its&nbsp;synchronization.&nbsp;It&nbsp;would&nbsp;be&nbsp;preferred&nbsp;if&nbsp;it&nbsp;had&nbsp;a&nbsp;possibility&nbsp;of&nbsp;communicating&nbsp;consumption&nbsp;of&nbsp;messages.&nbsp;Then&nbsp;one&nbsp;could&nbsp;mirror&nbsp;queues&nbsp;between&nbsp;up/down-stream&nbsp;exchanges,&nbsp;and&nbsp;have&nbsp;even&nbsp;more&nbsp;&quot;availability&quot;.&nbsp;One&nbsp;would&nbsp;definitely&nbsp;give&nbsp;up&nbsp;consistency&nbsp;a&nbsp;little&nbsp;further,&nbsp;but&nbsp;it&nbsp;would&nbsp;be&nbsp;possible&nbsp;to&nbsp;have&nbsp;the&nbsp;setup&nbsp;above,&nbsp;I&nbsp;think.&nbsp;I&nbsp;know&nbsp;it&nbsp;definitely&nbsp;doesn&#39;t&nbsp;come&nbsp;out-of-the-box,&nbsp;and&nbsp;it&nbsp;is&nbsp;not&nbsp;a&nbsp;part&nbsp;of&nbsp;AMQP,&nbsp;AFAIK,&nbsp;but&nbsp;it&nbsp;seems&nbsp;possible.&lt;br&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you,&nbsp;Simon!&lt;/div&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&nbsp;S&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
