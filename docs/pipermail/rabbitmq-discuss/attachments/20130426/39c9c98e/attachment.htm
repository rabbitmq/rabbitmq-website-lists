<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;So&nbsp;to&nbsp;confirm&nbsp;my&nbsp;understanding&nbsp;here.&nbsp; Message&nbsp;1&nbsp;was&nbsp;synched&nbsp;to&nbsp;both&nbsp;queues&nbsp;before&nbsp;I&nbsp;stopped&nbsp;the&nbsp;disc&nbsp;node.&nbsp; So&nbsp;when&nbsp;I&nbsp;shut&nbsp;down&nbsp;the&nbsp;disc&nbsp;node,&nbsp;the&nbsp;ram&nbsp;node&nbsp;become&nbsp;the&nbsp;&amp;quot;master&amp;quot;.&nbsp; As&nbsp;such,&nbsp;it&nbsp;should&nbsp;have&nbsp;had&nbsp;message&nbsp;1&nbsp;and&nbsp;2.&nbsp; When&nbsp;I&nbsp;brought&nbsp;up&nbsp;the&nbsp;disc&nbsp;node&nbsp;it&nbsp;is&nbsp;a&nbsp;slave&nbsp;and&nbsp;had&nbsp;it&amp;#39;s&nbsp;messages&nbsp;essentially&nbsp;reset.&nbsp; Per&nbsp;the&nbsp;docs:&nbsp;&amp;quot;&lt;span&nbsp;style=&quot;color:rgb(85,85,85);font-family:Verdana,sans-serif;font-size:13px;line-height:18px&quot;&gt;As&nbsp;such,&nbsp;when&nbsp;a&nbsp;slave&nbsp;rejoins&nbsp;a&nbsp;mirrored-queue,&nbsp;it&nbsp;throws&nbsp;away&nbsp;any&nbsp;durable&nbsp;local&nbsp;contents&nbsp;it&nbsp;already&nbsp;has&nbsp;and&nbsp;starts&nbsp;empty.&amp;quot;. &lt;/span&gt; So&nbsp;when&nbsp;I&nbsp;now&nbsp;publish&nbsp;message&nbsp;2,&nbsp;that&nbsp;goes&nbsp;to&nbsp;the&nbsp;ram&nbsp;node,&nbsp;which&nbsp;is&nbsp;now&nbsp;the&nbsp;master,&nbsp;and&nbsp;we&nbsp;have&nbsp;2&nbsp;messages&nbsp;total&nbsp;(disc&nbsp;node&nbsp;still&nbsp;off).&nbsp; &lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;The&nbsp;question&nbsp;becomes&nbsp;then&nbsp;-&nbsp;is&nbsp;there&nbsp;any&nbsp;way&nbsp;to&nbsp;recover&nbsp;the&nbsp;messages&nbsp;the&nbsp;RAM&nbsp;node&nbsp;had&nbsp;if&nbsp;the&nbsp;disc&nbsp;node&nbsp;comes&nbsp;back&nbsp;and&nbsp;the&nbsp;ram&nbsp;node&nbsp;subsequently&nbsp;failed?&nbsp; Granted&nbsp;this&nbsp;is&nbsp;an&nbsp;unlikely&nbsp;situation,&nbsp;but&nbsp;I&amp;#39;m&nbsp;trying&nbsp;to&nbsp;plan&nbsp;for&nbsp;recover&nbsp;scenarios&nbsp;here&nbsp;:)&nbsp; Do&nbsp;I&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;HA&nbsp;policy,&nbsp;then&nbsp;bring&nbsp;up&nbsp;the&nbsp;RAM&nbsp;node&nbsp;to&nbsp;get&nbsp;the&nbsp;RAM&nbsp;node&nbsp;messages&nbsp;(since&nbsp;it&nbsp;was&nbsp;master&nbsp;prior&nbsp;to&nbsp;it&amp;#39;s&nbsp;restart)?&nbsp; Since&nbsp;I&nbsp;can&amp;#39;t&nbsp;shut&nbsp;off&nbsp;the&nbsp;disc&nbsp;node&nbsp;in&nbsp;this&nbsp;case,&nbsp;just&nbsp;trying&nbsp;to&nbsp;figure&nbsp;out&nbsp;how&nbsp;to&nbsp;recover.&nbsp; I&nbsp;can&nbsp;see&nbsp;taking&nbsp;this&nbsp;a&nbsp;step&nbsp;further&nbsp;-&nbsp;if&nbsp;I&nbsp;had&nbsp;3&nbsp;nodes&nbsp;in&nbsp;a&nbsp;cluster,&nbsp;and&nbsp;1&nbsp;node&nbsp;went&nbsp;down,&nbsp;but&nbsp;the&nbsp;other&nbsp;2&nbsp;nodes&nbsp;each&nbsp;got&nbsp;an&nbsp;even&nbsp;distribution&nbsp;of&nbsp;the&nbsp;queues...&nbsp;hrmm,&nbsp;would&nbsp;make&nbsp;it&nbsp;somewhat&nbsp;interesting&nbsp;to&nbsp;recover.&nbsp; I&amp;#39;d&nbsp;almost&nbsp;have&nbsp;to&nbsp;shutdown&nbsp;yet&nbsp;one&nbsp;more&nbsp;node,&nbsp;start&nbsp;up&nbsp;the&nbsp;original&nbsp;node,&nbsp;make&nbsp;sure&nbsp;that&nbsp;messages&nbsp;get&nbsp;consumed,&nbsp;then&nbsp;start&nbsp;the&nbsp;third&nbsp;node&nbsp;it&nbsp;sounds&nbsp;like.&nbsp; &lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&amp;#39;ve&nbsp;started&nbsp;testing&nbsp;on&nbsp;the&nbsp;new&nbsp;3.1&nbsp;nightly&nbsp; -&nbsp;I&amp;#39;m&nbsp;hoping&nbsp;it&nbsp;makes&nbsp;this&nbsp;a&nbsp;lot&nbsp;cleaner!&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Thanks!&lt;br&gt;Jason&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;Fri,&nbsp;Apr&nbsp;26,&nbsp;2013&nbsp;at&nbsp;3:44&nbsp;AM,&nbsp;Emile&nbsp;Joubert&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:emile@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;emile@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Hi&nbsp;Jason,&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
On&nbsp;25/04/13&nbsp;21:09,&nbsp;Jason&nbsp;McIntosh&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;have&nbsp;2&nbsp;nodes&nbsp;in&nbsp;an&nbsp;rabbit&nbsp;cluster,&nbsp;one&nbsp;disc,&nbsp;one&nbsp;ram&nbsp;node.&nbsp; I&amp;#39;m&nbsp;seeing&lt;br&gt;<br>
&amp;gt;&nbsp;messages&nbsp;get&nbsp;lost&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;The&nbsp;explanation&nbsp;can&nbsp;be&nbsp;found&nbsp;here:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/ha.html#behaviour&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.rabbitmq.com/ha.html#behaviour&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
 &amp;quot;should&nbsp;there&nbsp;be&nbsp;no&nbsp;slave&nbsp;that&nbsp;is&nbsp;synchronised&nbsp;with&nbsp;the&nbsp;master,&lt;br&gt;<br>
 &nbsp;messages&nbsp;that&nbsp;only&nbsp;the&nbsp;master&nbsp;held&nbsp;will&nbsp;be&nbsp;lost.&amp;quot;&lt;br&gt;<br>
&lt;br&gt;<br>
Messages&nbsp;can&nbsp;get&nbsp;lost&nbsp;if&nbsp;you&nbsp;recycle&nbsp;nodes&nbsp;in&nbsp;the&nbsp;cluster&nbsp;faster&nbsp;than&nbsp;it&lt;br&gt;<br>
takes&nbsp;for&nbsp;the&nbsp;queue&nbsp;contents&nbsp;to&nbsp;be&nbsp;replaced&nbsp;entirely&nbsp;with&nbsp;new&nbsp;messages.&lt;br&gt;<br>
The&nbsp;solution&nbsp;is&nbsp;to&nbsp;wait&nbsp;for&nbsp;slaves&nbsp;to&nbsp;become&nbsp;synchronised&nbsp;before&lt;br&gt;<br>
restarting&nbsp;each&nbsp;node.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;next&nbsp;version&nbsp;of&nbsp;RabbitMQ&nbsp;will&nbsp;feature&nbsp;manual&nbsp;eager&nbsp;synchronisation&lt;br&gt;<br>
which&nbsp;will&nbsp;allow&nbsp;slaves&nbsp;to&nbsp;catch&nbsp;up&nbsp;on&nbsp;old&nbsp;messages&nbsp;held&nbsp;only&nbsp;on&nbsp;the&lt;br&gt;<br>
master&nbsp;node.&nbsp;You&nbsp;can&nbsp;obtain&nbsp;this&nbsp;feature&nbsp;now&nbsp;by&nbsp;installing&nbsp;a&nbsp;nightly&lt;br&gt;<br>
build&nbsp;of&nbsp;the&nbsp;broker,&nbsp;or&nbsp;wait&nbsp;for&nbsp;the&nbsp;next&nbsp;release.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
-Emile&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Jason&nbsp;McIntosh&lt;br&gt;&lt;a&nbsp;href=&quot;http://mcintosh.poetshome.com/blog/&quot;&gt;http://mcintosh.poetshome.com/blog/&lt;/a&gt;&lt;br&gt;573-424-7612<br>
&lt;/div&gt;<br>

</tt>
