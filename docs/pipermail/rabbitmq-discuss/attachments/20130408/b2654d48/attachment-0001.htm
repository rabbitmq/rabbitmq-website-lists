<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hello&nbsp;RabbitMQ&nbsp;Devs,&lt;br&gt;&lt;br&gt;&lt;/div&gt;In&nbsp;recent&nbsp;days,&nbsp;I&amp;#39;ve&nbsp;been&nbsp;experimenting&nbsp;with&nbsp;RabbitMQ&amp;#39;s&nbsp;HA&nbsp;mechanism&nbsp;to&nbsp;get&nbsp;messages&nbsp;mirrored&nbsp;to&nbsp;different&nbsp;nodes.&nbsp;I&nbsp;am&nbsp;concerned&nbsp;mainly&nbsp;with&nbsp;fail&nbsp;over&nbsp;scenarios&nbsp;where&nbsp;the&nbsp;message&nbsp;would&nbsp;be&nbsp;lost&nbsp;if&nbsp;all&nbsp;the&nbsp;nodes&nbsp;for&nbsp;Queue&nbsp;X&nbsp;goes&nbsp;down.&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;What&nbsp;I&nbsp;have&nbsp;observed&nbsp;is&nbsp;that&nbsp;as&nbsp;it&nbsp;is&nbsp;right&nbsp;now&nbsp;(3.0.0),&nbsp;the&nbsp;broker&nbsp;doesn&amp;#39;t&nbsp;actively&nbsp;find&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;cluster&nbsp;to&nbsp;mirror&nbsp;the&nbsp;queue&nbsp;whenever&nbsp;a&nbsp;node&nbsp;fails&nbsp;over.*&lt;br&gt;&lt;br&gt;&lt;/div&gt;However,&nbsp;I&nbsp;have&nbsp;find&nbsp;a&nbsp;trick/bug/scheme&nbsp;I&nbsp;can&nbsp;employ&nbsp;to&nbsp;have&nbsp;a&nbsp;node&nbsp;added.&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;What&nbsp;I&nbsp;did&nbsp;was&nbsp;to&nbsp;have&nbsp;the&nbsp;following&nbsp;policies:&nbsp;&lt;br&gt;(In&nbsp;the&nbsp;scenario&nbsp;that&nbsp;I&nbsp;only&nbsp;want&nbsp;to&nbsp;mirror&nbsp;to&nbsp;2&nbsp;other&nbsp;nodes)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;pre&gt;rabbitmqctl&nbsp;set_policy&nbsp;HA-1&nbsp;&amp;quot;^two\.&amp;quot;&nbsp;&amp;#39;{&amp;quot;ha-mode&amp;quot;:&amp;quot;exactly&amp;quot;,&amp;quot;ha-params&amp;quot;:2}&amp;#39;&nbsp;1&lt;br&gt;<br>
<br>
rabbitmqctl&nbsp;set_policy&nbsp;HA-2&nbsp;&amp;quot;^two\.&amp;quot;&nbsp;&amp;#39;{&amp;quot;ha-mode&amp;quot;:&amp;quot;exactly&amp;quot;,&amp;quot;ha-params&amp;quot;:3}&amp;#39;&nbsp;2&lt;br&gt;&lt;/pre&gt;So&nbsp;from&nbsp;the&nbsp;beginning,&nbsp;upon&nbsp;creation, &nbsp;a&nbsp;queue&nbsp;follows&nbsp;the&nbsp;HA-2&nbsp;policy&nbsp;with&nbsp;the&nbsp;highest&nbsp;priority&nbsp;which&nbsp;matched&nbsp;the&nbsp;&amp;quot;pattern&amp;quot;.&nbsp;If&nbsp;that&nbsp;policy&nbsp;is&nbsp;deleted,&nbsp;it&nbsp;will&nbsp;either&nbsp;default&nbsp;to&nbsp;a&nbsp;lower&nbsp;priority&nbsp;policy&nbsp;or&nbsp;none.&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;wouldn&amp;#39;t&nbsp;matter,&nbsp;because&nbsp;there&amp;#39;s&nbsp;a&nbsp;fail&nbsp;over.&nbsp;However,&nbsp;I&nbsp;noticed&nbsp;that&nbsp;if&nbsp;I&nbsp;add&nbsp;a&nbsp;&amp;#39;new&amp;#39;&nbsp;policy&nbsp;right&nbsp;afterwards,&nbsp;the&nbsp;queue&nbsp;will&nbsp;retroactively&nbsp;follow&nbsp;the&nbsp;new&nbsp;policy!&lt;br&gt;<br>
<br>
&lt;br&gt;So&nbsp;what&nbsp;I&nbsp;do&nbsp;is,&nbsp;whenever&nbsp;a&nbsp;node&nbsp;fails&nbsp;over,&nbsp;I&nbsp;immediately&nbsp;delete&nbsp;the&nbsp;HA-2&nbsp;policy&nbsp;and&nbsp;then&nbsp;immediately&nbsp;add&nbsp;the&nbsp;same&nbsp;HA-2&nbsp;policy&nbsp;right&nbsp;back.&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;I&nbsp;know&nbsp;of&nbsp;that&nbsp;allows&nbsp;the&nbsp;queue&nbsp;to&nbsp;pick&nbsp;up&nbsp;a&nbsp;node&nbsp;from&nbsp;my&nbsp;cluster&nbsp;for&nbsp;mirroring.&nbsp;(Without&nbsp;bringing&nbsp;the&nbsp;node&nbsp;back&nbsp;up)&nbsp;Yes,&nbsp;the&nbsp;new&nbsp;node&nbsp;will&nbsp;be&nbsp;unsynchronized&nbsp;but&nbsp;with&nbsp;active&nbsp;synchronization,&nbsp;this&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;problem.&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;*So&nbsp;my&nbsp;question&nbsp;is:&nbsp;Are&nbsp;there&nbsp;other&nbsp;ways&nbsp;for&nbsp;a&nbsp;mirrored&nbsp;queue&nbsp;to&nbsp;actively&nbsp;find&nbsp;node(s)&nbsp;in&nbsp;the&nbsp;cluster&nbsp;to&nbsp;mirror&nbsp;to&nbsp;without&nbsp;some&nbsp;intricate&nbsp;steps&nbsp;like&nbsp;the&nbsp;ones&nbsp;above?&nbsp;Perhaps&nbsp;there&amp;#39;s&nbsp;a&nbsp;plugin&nbsp;in&nbsp;the&nbsp;works&nbsp;or&nbsp;some&nbsp;new&nbsp;feature&nbsp;in&nbsp;a&nbsp;upcoming&nbsp;version&nbsp;relaese?&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;look&nbsp;forward&nbsp;to&nbsp;hearing&nbsp;what&nbsp;interesting&nbsp;plans&nbsp;you&nbsp;guys&nbsp;have&nbsp;in&nbsp;store&nbsp;for&nbsp;RabbitMQ!&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;br&gt;&lt;/div&gt;&lt;div&gt;Lujin&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
