<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello&nbsp;all!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;ve&nbsp;been&nbsp;running&nbsp;some&nbsp;tests&nbsp;locally,&nbsp;trying&nbsp;to&nbsp;determine&nbsp;whether&nbsp;RabbitMQ&nbsp;will&nbsp;meet&nbsp;our&nbsp;performance&nbsp;requirements.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;running&nbsp;the&nbsp;broker&nbsp;(3.1.1)&nbsp;on&nbsp;a&nbsp;Dual&nbsp;Xeon&nbsp;E5&nbsp;(12&nbsp;cores&nbsp;total)&nbsp;with&nbsp;256&nbsp;MB&nbsp;and&nbsp;Windows&nbsp;Server&nbsp;2012,&nbsp;on&nbsp;Erlang&nbsp;R16B&nbsp;(64bit).&nbsp;One&nbsp;of&nbsp;the&nbsp;primary&nbsp;workflows&nbsp;that&nbsp;we&nbsp;want&nbsp;to&nbsp;enable&nbsp;is&nbsp;using&nbsp;a&nbsp;cluster&nbsp; is&nbsp;to&nbsp;have&nbsp;several&nbsp;workers&nbsp;behind&nbsp;the&nbsp;cluster&nbsp;taking&nbsp;messages&nbsp;from&nbsp;multiple&nbsp;clients.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;With&nbsp;a&nbsp;single&nbsp;producer&nbsp;-&amp;gt;&nbsp;direct&nbsp;exchange&nbsp;-&amp;gt;&nbsp;single&nbsp;consumer&nbsp;on&nbsp;a&nbsp;single&nbsp;broker,&nbsp;I&nbsp;can&nbsp;get&nbsp;about&nbsp;38000&nbsp;messages&nbsp;/&nbsp;second.&nbsp;(I&amp;#39;m&nbsp;not&nbsp;sure&nbsp;where&nbsp;the&nbsp;performance&nbsp;limit&nbsp;is&nbsp;here,&nbsp;since&nbsp;I&amp;#39;m&nbsp;not&nbsp;queuing&nbsp;any&nbsp;messages,&nbsp;the&nbsp;consumer&nbsp;is&nbsp;the&nbsp;equivalent&nbsp;of&nbsp;/dev/null,&nbsp;and&nbsp;the&nbsp;CPU&nbsp;on&nbsp;the&nbsp;broker&nbsp;doesn&amp;#39;t&nbsp;go&nbsp;above&nbsp;12%)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;test&nbsp;it,&nbsp;I&nbsp;ran&nbsp;two&nbsp;brokers&nbsp;on&nbsp;the&nbsp;same&nbsp;server,&nbsp;and&nbsp;tried&nbsp;setting&nbsp;up&nbsp;a&nbsp;couple&nbsp;of&nbsp;different&nbsp;exchange/queue&nbsp;layouts:&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;Producers&nbsp;publishing&nbsp;to&nbsp;a&nbsp;single&nbsp;consistent&nbsp;hash&nbsp;exchange,&nbsp;with&nbsp;each&nbsp;consumer&nbsp;connecting&nbsp;to&nbsp;a&nbsp;private&nbsp;queue&nbsp;bound&nbsp;to&nbsp;the&nbsp;exchange&lt;/li&gt;<br>
<br>
&lt;li&gt;Producers&nbsp;publishing&nbsp;to&nbsp;a&nbsp;single&nbsp;exchange&nbsp;/&nbsp;default&nbsp;exchange,&nbsp;with&nbsp;each&nbsp;consumer&nbsp;connecting&nbsp;to&nbsp;a&nbsp;single&nbsp;queue&nbsp;off&nbsp;the&nbsp;exchange&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;In&nbsp;the&nbsp;first&nbsp;scenario&nbsp;above,&nbsp;if&nbsp;I&nbsp;use&nbsp;24&nbsp;consumers&nbsp;(and&nbsp;hence&nbsp;24&nbsp;queues)&nbsp;distributed&nbsp;equally&nbsp;across&nbsp;both&nbsp;brokers,&nbsp;I&nbsp;can&nbsp;barely&nbsp;muster&nbsp;52000&nbsp;messages&nbsp;/&nbsp;second&nbsp;(and&nbsp;going&nbsp;up&nbsp;to&nbsp;30%&nbsp;CPU&nbsp;on&nbsp;each&nbsp;Erlang&nbsp;broker)&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;In&nbsp;the&nbsp;second&nbsp;scenario,&nbsp;I&nbsp;stop&nbsp;at&nbsp;under&nbsp;10000&nbsp;messages&nbsp;/&nbsp;second.&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;This&nbsp;leads&nbsp;me&nbsp;to&nbsp;believe&nbsp;that&nbsp;the&nbsp;former&nbsp;is&nbsp;the&nbsp;better&nbsp;design,&nbsp;but&nbsp;what&nbsp;kind&nbsp;of&nbsp;architecture&nbsp;would&nbsp;give&nbsp;a&nbsp;4&nbsp;fold&nbsp;or&nbsp;10&nbsp;fold&nbsp;increase&nbsp;in&nbsp;throughput?&nbsp;Would&nbsp;we&nbsp;have&nbsp;to&nbsp;hash&nbsp;prior&nbsp;to&nbsp;RabbitMQ?&nbsp;An&nbsp;x-consistent-hash&nbsp;in&nbsp;front&nbsp;of&nbsp;multiple&nbsp;x-consistent-hash&nbsp;exchanges?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Thanks!&lt;/div&gt;&lt;/div&gt;<br>

</tt>
