<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;Hi&nbsp;Matthias,&nbsp;so&nbsp;just&nbsp;to&nbsp;re-iterate:&nbsp;we&nbsp;see&nbsp;this&nbsp;behavior&nbsp;only&nbsp;on&nbsp;one&nbsp;broker,&nbsp;other&nbsp;brokers&nbsp;with&nbsp;similar&nbsp;load&nbsp;don&amp;#39;t&nbsp;exhibit&nbsp;the&nbsp;issue.&nbsp;We&amp;#39;ve&nbsp;never&nbsp;see&nbsp;that&nbsp;much&nbsp;i/o&nbsp;apart&nbsp;from&nbsp;when&nbsp;we&nbsp;hit&nbsp;the&nbsp;issues&nbsp;Matthew&nbsp;fixed&nbsp;for&nbsp;2.4.&nbsp;Trying&nbsp;RabbitMQ&nbsp;2.6&nbsp;will&nbsp;take&nbsp;time&nbsp;as&nbsp;we&nbsp;have&nbsp;custom&nbsp;code&nbsp;and&nbsp;plugin&nbsp;we&nbsp;need&nbsp;to&nbsp;migrate.&nbsp;This&nbsp;issue&nbsp;only&nbsp;appears&nbsp;on&nbsp;production&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;way&nbsp;for&nbsp;us&nbsp;to&nbsp;quickly&nbsp;try&nbsp;it.&lt;div&gt;<br>
<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;is&nbsp;the&nbsp;CPU&nbsp;graph&nbsp;on&nbsp;the&nbsp;broker&nbsp;exhibiting&nbsp;the&nbsp;issue:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;<br>
&lt;div&gt;&lt;img&nbsp;src=&quot;cid:ii_133427722c75c7eb&quot;&nbsp;alt=&quot;cpu_overview.png&quot;&nbsp;title=&quot;cpu_overview.png&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;the&nbsp;load&nbsp;on&nbsp;a&nbsp;broker&nbsp;that&nbsp;does&nbsp;not:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;img&nbsp;src=&quot;cid:ii_13342778042562ea&quot;&nbsp;alt=&quot;cpu_overview2.png&quot;&nbsp;title=&quot;cpu_overview2.png&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;spikes&nbsp;every&nbsp;minute&nbsp;is&nbsp;because&nbsp;we&nbsp;run&nbsp;rabbitmqctl&nbsp;list_queues&nbsp;every&nbsp;minute&nbsp;to&nbsp;monitor&nbsp;the&nbsp;queues.&nbsp;The&nbsp;spikes&nbsp;every&nbsp;4&nbsp;hours&nbsp;is&nbsp;due&nbsp;to&nbsp;a&nbsp;cleanup&nbsp;daemon&nbsp;that&nbsp;cleans&nbsp;up&nbsp;stale&nbsp;queues&nbsp;every&nbsp;4&nbsp;hours.&lt;/div&gt;<br>
<br>
<br>
&lt;div&gt; &lt;/div&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&gt;Raphael.&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Oct&nbsp;26,&nbsp;2011&nbsp;at&nbsp;3:45&nbsp;PM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Raphael,&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;25/10/11&nbsp;17:23,&nbsp;Raphael&nbsp;Simon&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
All&nbsp;the&nbsp;messages&nbsp;are&nbsp;consumed&nbsp;pretty&nbsp;much&nbsp;immediately.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
That&nbsp;is&nbsp;irrelevant.&nbsp;Persistent&nbsp;messages&nbsp;sent&nbsp;to&nbsp;durable&nbsp;queues&nbsp;*always*&nbsp;get&nbsp;written&nbsp;to&nbsp;disk&nbsp;unless&nbsp;they&nbsp;can&nbsp;be&nbsp;sent&nbsp;to&nbsp;an&nbsp;auto-ack&amp;#39;ing&nbsp;consumer&nbsp;immediately.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;next&nbsp;rabbit&nbsp;release&nbsp;contains&nbsp;an&nbsp;optimisation&nbsp;s.t.&nbsp;when&nbsp;messages&nbsp;get&nbsp;ack&amp;#39;ed&nbsp;before&nbsp;they&nbsp;have&nbsp;been&nbsp;written&nbsp;to&nbsp;disk&nbsp;then&nbsp;they&nbsp;won&amp;#39;t&nbsp;be&nbsp;written&nbsp;to&nbsp;disk.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;only&nbsp;thing&nbsp;slightly&nbsp;strange&nbsp;about&nbsp;what&nbsp;you&nbsp;have&nbsp;reported&nbsp;is&nbsp;the&nbsp;high&nbsp;write&nbsp;count.&nbsp;Any&nbsp;chance&nbsp;you&nbsp;could&nbsp;give&nbsp;RabbitMQ&nbsp;2.6.1&nbsp;a&nbsp;try?&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;br&gt;<br>

</tt>
