<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;hello,&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;use&nbsp;dead-letter-exchange&nbsp;to&nbsp;create&nbsp;a&nbsp;'delayed'&nbsp;queue,&lt;br&gt;basically&nbsp;my&nbsp;application&nbsp;takes&nbsp;input&nbsp;from&nbsp;an&nbsp;MQ&nbsp;and&nbsp;then&nbsp;posts&nbsp;the&nbsp;data&nbsp;(using&nbsp;curl)&nbsp;to&nbsp;an&nbsp;external&nbsp;website.&lt;br&gt;If&nbsp;the&nbsp;post&nbsp;operation&nbsp;fails&nbsp;I&nbsp;want&nbsp;it&nbsp;to&nbsp;wait&nbsp;a&nbsp;set&nbsp;amount&nbsp;of&nbsp;time&nbsp;and&nbsp;retry.&lt;br&gt;The&nbsp;idea&nbsp;is&nbsp;to&nbsp;publish&nbsp;these&nbsp;failed&nbsp;tries&nbsp;to&nbsp;a&nbsp;'dead'&nbsp;queue&nbsp;with&nbsp;no&nbsp;consumer&nbsp;but&nbsp;with&nbsp;a&nbsp;timeout&nbsp;set&nbsp;up.&lt;br&gt;On&nbsp;expiry&nbsp;of&nbsp;the&nbsp;timeout,&nbsp;RabbitMQ&nbsp;should&nbsp;transfer&nbsp;these&nbsp;messages&nbsp;to&nbsp;the&nbsp;dead-letter-exchange&nbsp;which&nbsp;would&nbsp;be&nbsp;the&nbsp;original&nbsp;queue.&lt;br&gt;&lt;br&gt;my&nbsp;code&nbsp;is&nbsp;currently&nbsp;here&nbsp;:&lt;br&gt;&lt;br&gt;&amp;nbsp;&nbsp;public&nbsp;function&nbsp;publish_delay($data=false)&nbsp;{&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$connection&nbsp;=&nbsp;new&nbsp;AMQPConnection('localhost',&nbsp;5672,&nbsp;'guest',&nbsp;'guest');&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$channel&nbsp;=&nbsp;$connection-&amp;gt;channel();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$channel-&amp;gt;queue_declare('errorXchange',false,true,false,false,false,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;array(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&quot;x-dead-letter-exchange&quot;&nbsp;=&amp;gt;&nbsp;array(&quot;S&quot;,&nbsp;$this-&amp;gt;channelname),&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&quot;x-message-ttl&quot;&nbsp;=&amp;gt;&nbsp;array(&quot;I&quot;,&nbsp;5000),&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&quot;x-expires&quot;&nbsp;=&amp;gt;&nbsp;array(&quot;I&quot;,&nbsp;6000)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$msg&nbsp;=&nbsp;new&nbsp;AMQPMessage($data);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$channel-&amp;gt;basic_publish($msg,'','errorXchange');&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$channel-&amp;gt;close();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$connection-&amp;gt;close();&lt;br&gt;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;$msg&nbsp;-&amp;gt;&nbsp;is&nbsp;the&nbsp;message&nbsp;I&nbsp;want&nbsp;sent&nbsp;with&nbsp;a&nbsp;delay&lt;br&gt;$this-&amp;gt;channelname&nbsp;would&nbsp;be&nbsp;the&nbsp;channel&nbsp;I&nbsp;want&nbsp;it&nbsp;to&nbsp;go&nbsp;to&nbsp;after&nbsp;the&nbsp;delay&lt;br&gt;'errorXchange'&nbsp;is&nbsp;the&nbsp;dead&nbsp;queue&nbsp;with&nbsp;the&nbsp;ttl&nbsp;&amp;amp;&nbsp;no&nbsp;consumer.&lt;br&gt;&lt;br&gt;Currently&nbsp;nothing&nbsp;is&nbsp;coming&nbsp;through&nbsp;on&nbsp;$this-&amp;gt;channelname&nbsp;(where&nbsp;there&nbsp;is&nbsp;a&nbsp;consumer,&nbsp;of&nbsp;course).&lt;br&gt;I&nbsp;haven't&nbsp;understood&nbsp;how&nbsp;to&nbsp;debug&nbsp;rabbitmq&nbsp;or&nbsp;what&nbsp;is&nbsp;going&nbsp;wrong,&nbsp;and&nbsp;there&nbsp;is&nbsp;precious&nbsp;little&nbsp;documentation!&lt;br&gt;&lt;br&gt;help&nbsp;would&nbsp;be&nbsp;VERY&nbsp;welcome!&lt;br&gt;&lt;br&gt;regards,&lt;br&gt;Dave&nbsp;in&nbsp;Malta.&lt;br&gt;&lt;/div&gt;
</tt>
