<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;tested&nbsp;that,&nbsp;didn&amp;#39;t&nbsp;work.&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;18,&nbsp;2008&nbsp;at&nbsp;11:28&nbsp;AM,&nbsp;Tony&nbsp;Garnock-Jones&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:tonyg@lshift.net&quot;&gt;tonyg@lshift.net&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Hi&nbsp;again,&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Jonatan&nbsp;Kallus&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;As&nbsp;an&nbsp;aside,&nbsp;on&nbsp;re-reading&nbsp;the&nbsp;protocol,&nbsp;I&amp;#39;m&nbsp;wondering&nbsp;if&nbsp;our&nbsp;scan&nbsp;for&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;end&nbsp;of&nbsp;frame&nbsp;is&nbsp;incorrect&nbsp;(or&nbsp;specific&nbsp;to&nbsp;ActiveMQ&amp;#39;s&nbsp;implementation).&nbsp;&amp;nbsp;A&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;frame&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;\x00,&nbsp;and&nbsp;not&nbsp;\x00&nbsp;+&nbsp;\n&nbsp;according&nbsp;to&nbsp;the&nbsp;spec:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;quot;...the&nbsp;null&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;frame.&amp;quot;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
This&nbsp;could&nbsp;well&nbsp;be&nbsp;it.&nbsp;Looking&nbsp;at&nbsp;readFrame&nbsp;from&nbsp;Stomp.php:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;do&nbsp;{&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;$read&nbsp;=&nbsp;fgets($this-&amp;gt;_socket,&nbsp;$rb);&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;if&nbsp;($read&nbsp;===&nbsp;false)&nbsp;{&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;$this-&amp;gt;_reconnect();&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;return&nbsp;$this-&amp;gt;readFrame();&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;$data&nbsp;.=&nbsp;$read;&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;$len&nbsp;=&nbsp;strlen($data);&lt;br&gt;<br>
&nbsp;&amp;nbsp;}&nbsp;while&nbsp;(($len&nbsp;&amp;lt;&nbsp;2&nbsp;||&nbsp;!&nbsp;($data[$len&nbsp;-&nbsp;2]&nbsp;==&nbsp;&amp;quot;\x00&amp;quot;&nbsp;&amp;amp;&amp;amp;&nbsp;$data[$len&nbsp;-&nbsp;1]&nbsp;==&nbsp;&amp;quot;\n&amp;quot;)));&lt;br&gt;<br>
&lt;br&gt;<br>
Did&nbsp;you&nbsp;try&nbsp;changing&nbsp;that&nbsp;last&nbsp;line&nbsp;to&nbsp;something&nbsp;like&lt;br&gt;<br>
&lt;br&gt;<br>
($len&nbsp;&amp;lt;&nbsp;1&nbsp;||&nbsp;$data[$len&nbsp;-&nbsp;1]&nbsp;!=&nbsp;&amp;quot;\x00&amp;quot;);&lt;br&gt;<br>
&lt;br&gt;<br>
?&lt;br&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;br&gt;<br>
Tony&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
