<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;for&nbsp;your&nbsp;answer!&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&gt;Jonatan&nbsp;Kallus&nbsp;wrote:&lt;br&gt;<br>
<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Problem&nbsp;is&nbsp;that&nbsp;the&nbsp;frames&nbsp;sent&nbsp;back&nbsp;from&nbsp;rabbitmq&nbsp;does&nbsp;not&nbsp;seem&nbsp;to&nbsp;be&lt;br&gt;<br>
terminated&nbsp;with&nbsp;a&nbsp;null&nbsp;character.&nbsp;The&nbsp;&amp;#39;CONNECTED&amp;#39;&nbsp;frame&nbsp;ends&nbsp;with&nbsp;an&lt;br&gt;<br>
empty&nbsp;line&nbsp;and&nbsp;the&nbsp;&amp;#39;MESSAGE&amp;#39;&nbsp;frame&nbsp;just&nbsp;ends.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
That&amp;#39;s&nbsp;strange.&nbsp;How&nbsp;have&nbsp;you&nbsp;determined&nbsp;this?&nbsp;The&nbsp;code&nbsp;in&nbsp;stomp_frame.erl&nbsp;always&nbsp;generates&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;for&nbsp;transmission,&nbsp;and&nbsp;other&nbsp;STOMP&nbsp;clients&nbsp;seem&nbsp;to&nbsp;have&nbsp;no&nbsp;trouble.&lt;div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;<br>
The&nbsp;read&nbsp;loop&nbsp;in&nbsp;the&nbsp;php&nbsp;stomp&nbsp;client&nbsp;keeps&nbsp;reading&nbsp;until&nbsp;it&nbsp;finds&nbsp;a&nbsp;null&nbsp;character,&nbsp;and&nbsp;it&nbsp;does&nbsp;not&nbsp;stop&nbsp;until&nbsp;a&nbsp;time&nbsp;out&nbsp;is&nbsp;reached.&nbsp;I&nbsp;tried&nbsp;to&nbsp;tweak&nbsp;this&nbsp;in&nbsp;a&nbsp;few&nbsp;different&nbsp;ways&nbsp;without&nbsp;any&nbsp;positive&nbsp;results.&nbsp;There&nbsp;might&nbsp;be&nbsp;something&nbsp;I&nbsp;am&nbsp;missing&nbsp;in&nbsp;the&nbsp;way&nbsp;php&nbsp;handles&nbsp;socket&nbsp;connections&nbsp;and/or&nbsp;null&nbsp;characters&nbsp;in&nbsp;strings.&nbsp;Either&nbsp;way,&nbsp;the&nbsp;php&nbsp;stomp&nbsp;client&nbsp;doesn&amp;#39;t&nbsp;work&nbsp;with&nbsp;the&nbsp;stomp&nbsp;gateway&nbsp;&amp;#39;out&nbsp;of&nbsp;the&nbsp;box&amp;#39;&nbsp;but&nbsp;it&nbsp;seems&nbsp;like&nbsp;people&nbsp;are&nbsp;using&nbsp;it&nbsp;successfully&nbsp;with&nbsp;ActiveMQ&nbsp;or&nbsp;JMS.&lt;br&gt;<br>
<br>
&lt;br&gt;I&nbsp;am&nbsp;only&nbsp;going&nbsp;to&nbsp;use&nbsp;the&nbsp;php/stomp&nbsp;connection&nbsp;to&nbsp;send&nbsp;messages&nbsp;into&nbsp;the&nbsp;queue,&nbsp;so&nbsp;I&nbsp;hardcoded&nbsp;recognition&nbsp;of&nbsp;CONNECTED&nbsp;and&nbsp;RECEIPT&nbsp;for&nbsp;now,&nbsp;that&nbsp;is&nbsp;propably&nbsp;the&nbsp;only&nbsp;two&nbsp;I&nbsp;will&nbsp;need.&nbsp;(Failing&nbsp;on&nbsp;anything&nbsp;else.)&lt;br&gt;<br>
&lt;br&gt;<br>
Below&nbsp;is&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&nbsp;conversation&nbsp;I&nbsp;had&nbsp;on&nbsp;the&nbsp;mailinglist&nbsp;for&nbsp;php&nbsp;stomp.&nbsp;It&nbsp;suggests&nbsp;that&nbsp;the&nbsp;problem&nbsp;might&nbsp;be&nbsp;that&nbsp;the&nbsp;client&nbsp;is&nbsp;looking&nbsp;for&nbsp;an&nbsp;ActiveMQ&nbsp;specific&nbsp;ending&nbsp;sequence&nbsp;of&nbsp;&amp;#39;NULL-NEWLINE&amp;#39;,&nbsp;but&nbsp;I&nbsp;tried&nbsp;to&nbsp;correct&nbsp;that&nbsp;and&nbsp;I&nbsp;am&nbsp;pretty&nbsp;sure&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;cause:&lt;br&gt;<br>
&lt;br&gt;&lt;blockquote&gt;Michael&nbsp;Caplan&nbsp;wrote:&lt;br&gt;As&nbsp;an&nbsp;aside,&nbsp;on&nbsp;re-reading&nbsp;the&nbsp;protocol,&nbsp;I&amp;#39;m&nbsp;wondering&nbsp;if&nbsp;our&nbsp;scan&nbsp;for&lt;br&gt;end&nbsp;of&nbsp;frame&nbsp;is&nbsp;incorrect&nbsp;(or&nbsp;specific&nbsp;to&nbsp;ActiveMQ&amp;#39;s&nbsp;implementation).&amp;nbsp;&nbsp;A&lt;br&gt;frame&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;\x00,&nbsp;and&nbsp;not&nbsp;\x00&nbsp;+&nbsp;\n&nbsp;according&nbsp;to&nbsp;the&nbsp;spec:&lt;br&gt;<br>
&lt;br&gt;&amp;quot;...the&nbsp;null&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;frame.&amp;quot;&lt;br&gt;&lt;br&gt;Mike&lt;br&gt;&lt;br&gt;Jonatan&nbsp;Kallus&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;Yes,&nbsp;the&nbsp;space&nbsp;between&nbsp;&amp;#39;login:&amp;#39;&nbsp;and&nbsp;&amp;#39;&amp;lt;username&amp;gt;&amp;#39;&nbsp;was&nbsp;interpreted&nbsp;as&lt;br&gt;&amp;gt;&nbsp;part&nbsp;of&nbsp;the&nbsp;username.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;&lt;br&gt;Michael&nbsp;Caplan&nbsp;wrote:&lt;br&gt;Huh.&amp;nbsp;&nbsp;That&amp;#39;s&nbsp;a&nbsp;tricky&nbsp;one.&amp;nbsp;&nbsp;The&nbsp;protocol&nbsp;does&nbsp;not&nbsp;specify&nbsp;a&nbsp;space&lt;br&gt;between&nbsp;the&nbsp;header&nbsp;key:value&nbsp;combinations,&nbsp;but&nbsp;the&nbsp;protocol&nbsp;examples&nbsp;do&lt;br&gt;use&nbsp;a&nbsp;space.&amp;nbsp;&nbsp;I&amp;#39;m&nbsp;hesitant&nbsp;to&nbsp;call&nbsp;this&nbsp;a&nbsp;protocol&nbsp;implementation&nbsp;bug&nbsp;on&lt;br&gt;<br>
the&nbsp;client.&amp;nbsp;&nbsp;I&nbsp;think&nbsp;you&nbsp;should&nbsp;push&nbsp;back&nbsp;on&nbsp;the&nbsp;MQ&nbsp;developers&nbsp;on&nbsp;this&lt;br&gt;one&nbsp;to.&lt;br&gt;&lt;br&gt;Best,&lt;br&gt;&lt;br&gt;Mike&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
