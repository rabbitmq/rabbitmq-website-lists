<tt>
2011/7/21&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
<br>
Given&nbsp;that&nbsp;you&nbsp;can&nbsp;reproduce&nbsp;the&nbsp;problem&nbsp;easily,&nbsp;you&nbsp;may&nbsp;just&nbsp;want&nbsp;to&nbsp;log&nbsp;some&nbsp;details&nbsp;of&nbsp;all&nbsp;the&nbsp;frames&nbsp;-&nbsp;frame&nbsp;type,&nbsp;class&nbsp;id,&nbsp;method&nbsp;id,&nbsp;and&nbsp;for&nbsp;content&nbsp;headers&nbsp;the&nbsp;expected&nbsp;body&nbsp;size,&nbsp;and&nbsp;for&nbsp;content&nbsp;bodies&nbsp;the&nbsp;payload&nbsp;size.&lt;/blockquote&gt;<br>
<br>
&lt;/div&gt;&lt;br&gt;So&nbsp;far&nbsp;I&nbsp;narrowed&nbsp;it&nbsp;down&nbsp;to&nbsp;the&nbsp;&amp;quot;empty&nbsp;messages&amp;quot;&nbsp;problem:&nbsp;whenever&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;message&nbsp;sent&nbsp;by&nbsp;amqp&nbsp;gem&nbsp;master&nbsp;version,&nbsp;RabbitMQ&lt;br&gt;doesn&amp;#39;t&nbsp;consider&nbsp;it&nbsp;a&nbsp;complete&nbsp;message&nbsp;and&nbsp;thus&nbsp;clients&nbsp;do&nbsp;not&nbsp;get&nbsp;anything.&nbsp;With&nbsp;a&nbsp;simple&nbsp;script&nbsp;that&nbsp;terminates&nbsp;as&nbsp;soon&nbsp;as&nbsp;the&nbsp;message&nbsp;is&nbsp;received&lt;br&gt;<br>
<br>
(by&nbsp;the&nbsp;same&nbsp;process),&nbsp;this&nbsp;looks&nbsp;like&nbsp;app&nbsp;is&nbsp;hanging.&nbsp;In&nbsp;the&nbsp;context&nbsp;of&nbsp;a&nbsp;larger&nbsp;application,&nbsp;sometimes&nbsp;there&nbsp;are&nbsp;empty&nbsp;messages&nbsp;transmitted&nbsp;(I&nbsp;am&nbsp;streaming&nbsp;a&nbsp;stdout&nbsp;output).&lt;br&gt;&lt;br&gt;After&nbsp;comparing&nbsp;2&nbsp;clients&nbsp;I&nbsp;see&nbsp;the&nbsp;following&nbsp;picture:&nbsp;the&nbsp;data&nbsp;transmitted&nbsp;is&nbsp;exactly&nbsp;the&nbsp;same,&nbsp;frame&nbsp;order&nbsp;is&nbsp;correct&nbsp;but&nbsp;Wireshark&nbsp;GUI&nbsp;suggests&nbsp;that&lt;br&gt;<br>
<br>
one&nbsp;client&nbsp;transmits&nbsp;3&nbsp;frames&nbsp;as&nbsp;3&nbsp;IP&nbsp;packets.&nbsp;In&nbsp;this&nbsp;case,&nbsp;RabbitMQ&nbsp;is&nbsp;happy.&nbsp;The&nbsp;other&nbsp;transmits&nbsp;them&nbsp;all&nbsp;in&nbsp;a&nbsp;single&nbsp;IP&nbsp;packet&nbsp;and&nbsp;RabbitMQ&nbsp;doesn&amp;#39;t&nbsp;seem&nbsp;to&nbsp;recognize&nbsp;it&nbsp;as&nbsp;a&nbsp;complete&nbsp;message.&lt;br&gt;&lt;br&gt;Here&nbsp;are&nbsp;two&nbsp;Wireshark&nbsp;session&nbsp;exports:&lt;br&gt;<br>
<br>
&lt;a&nbsp;href=&quot;https://gist.github.com/1096404&quot;&gt;https://gist.github.com/1096404&lt;/a&gt;&lt;br&gt;&lt;br&gt;If&nbsp;the&nbsp;[frames]&nbsp;content&nbsp;is&nbsp;the&nbsp;same,&nbsp;what&nbsp;may&nbsp;be&nbsp;going&nbsp;on&nbsp;here?&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;MK&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://github.com/michaelklishin&quot;&nbsp;target=&quot;_blank&quot;&gt;http://github.com/michaelklishin&lt;/a&gt;&lt;br&gt;<br>
<br>
&lt;a&nbsp;href=&quot;http://twitter.com/michaelklishin&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twitter.com/michaelklishin&lt;/a&gt;&lt;br&gt;&lt;br&gt;<br>

</tt>
