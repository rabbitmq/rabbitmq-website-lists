<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;Joe,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;cursory&nbsp;glance&nbsp;indicates&nbsp;that&nbsp;you&nbsp;are&nbsp;using&nbsp;the&nbsp;wrong&nbsp;routing&nbsp;key&nbsp;to&nbsp;publish&nbsp;to&nbsp;the&nbsp;exchange.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;use&nbsp;a.b.c.d&nbsp;instead&nbsp;of&nbsp;a.b.c.*,&nbsp;then&nbsp;when&nbsp;a&nbsp;queue&nbsp;binds&nbsp;itself&nbsp;to&nbsp;a.b.c.*,&nbsp;messages&nbsp;will&nbsp;be&nbsp;delivered&nbsp;to&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hence&nbsp;why&nbsp;you&nbsp;are&nbsp;getting&nbsp;a&nbsp;get_empty.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;just&nbsp;change&nbsp;the&nbsp;routing&nbsp;key&nbsp;in&nbsp;the&amp;nbsp;amqp_async_pub&nbsp;module.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;for&nbsp;the&nbsp;errors&nbsp;you&nbsp;are&nbsp;seeing,&nbsp;the&nbsp;reason&nbsp;is&nbsp;because&nbsp;you&nbsp;are&nbsp;passing&nbsp;in&nbsp;integers&nbsp;as&nbsp;the&nbsp;publish&nbsp;payload.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;API&nbsp;however,&nbsp;expects&nbsp;payload&nbsp;fragments&nbsp;to&nbsp;be&nbsp;opaque&nbsp;binaries&nbsp;rather&nbsp;than&nbsp;any&nbsp;Erlang&nbsp;type.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;to&nbsp;fix&nbsp;this&nbsp;problem,&nbsp;just&nbsp;convert&nbsp;whatever&nbsp;payload&nbsp;fragment&nbsp;you&nbsp;want&nbsp;to&nbsp;send&nbsp;to&nbsp;a&nbsp;binary.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;your&nbsp;case&nbsp;you&nbsp;are&nbsp;sending&nbsp;integers,&nbsp;so&nbsp;you&nbsp;could&nbsp;pass&nbsp;in&nbsp;something&nbsp;like&nbsp;&amp;lt;&amp;lt;MyInteger:32&gt;&gt;&nbsp;instead&nbsp;of&nbsp;MyInteger.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;may&nbsp;be&nbsp;a&nbsp;question&nbsp;for&nbsp;the&nbsp;design&nbsp;of&nbsp;the&nbsp;API.&nbsp;It&nbsp;may&nbsp;well&nbsp;be&nbsp;worthwile&nbsp;performing&nbsp;a&nbsp;guard&nbsp;condition&nbsp;(i.e.&nbsp;is_binary(Payload))&nbsp;on&nbsp;the&nbsp;submission&nbsp;of&nbsp;a&nbsp;message.&nbsp;I'll&nbsp;look&nbsp;into&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;BTW,&nbsp;if&nbsp;you&nbsp;don't&nbsp;supply&nbsp;a&nbsp;host&nbsp;name&nbsp;when&nbsp;starting&nbsp;the&nbsp;connection,&nbsp;the&nbsp;client&nbsp;will&nbsp;start&nbsp;in&nbsp;a&nbsp;direct&nbsp;mode&nbsp;using&nbsp;native&nbsp;Erlang&nbsp;message&nbsp;passing&nbsp;rather&nbsp;than&nbsp;AMQP&nbsp;wire&nbsp;framing.&nbsp;This&nbsp;means&nbsp;that&nbsp;the&nbsp;client&nbsp;and&nbsp;server&nbsp;run&nbsp;in&nbsp;the&nbsp;same&nbsp;interpreter&nbsp;and&nbsp;eliminate&nbsp;the&nbsp;network&nbsp;overhead.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;HTH,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ben&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;html&gt;On&nbsp;14&nbsp;Apr&nbsp;2008,&nbsp;at&nbsp;18:59,&nbsp;Joe&nbsp;Lee&nbsp;wrote:&lt;/html&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Here&nbsp;are&nbsp;the&nbsp;files.&amp;nbsp;&nbsp;I&nbsp;think&nbsp;problem&nbsp;maybe&nbsp;how&nbsp;the&nbsp;Payload&nbsp;in&nbsp;amqp_async_pub&nbsp;is&nbsp;assigned&nbsp;setup.&amp;nbsp;&nbsp;I&nbsp;maybe&nbsp;wrong.&lt;br&gt;&lt;br&gt;Joe&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Apr&nbsp;14,&nbsp;2008&nbsp;at&nbsp;11:39&nbsp;AM,&nbsp;Ben&nbsp;Hood&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:0x6e6562@gmail.com&quot;&gt;0x6e6562@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;style=&quot;&quot;&gt;&lt;div&gt;Hi&nbsp;Joe,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Could&nbsp;you&nbsp;send&nbsp;the&nbsp;complete&nbsp;source&nbsp;code&nbsp;of&nbsp;the&nbsp;test&nbsp;that&nbsp;causes&nbsp;these&nbsp;problems&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;have&nbsp;a&nbsp;look&nbsp;at&nbsp;this,&nbsp;please?&lt;/div&gt;&nbsp;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thx,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ben&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;On&nbsp;14&nbsp;Apr&nbsp;2008,&nbsp;at&nbsp;16:20,&nbsp;Joe&nbsp;Lee&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;I&nbsp;tried&nbsp;to&nbsp;send&nbsp;messages&nbsp;sequentially&nbsp;to&nbsp;a&nbsp;single&nbsp;rabbitmq&nbsp;server&nbsp;running&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1&quot;&nbsp;target=&quot;_blank&quot;&gt;127.0.0.1&lt;/a&gt;.&amp;nbsp;&nbsp;After&nbsp;sending&nbsp;messages&nbsp;around&nbsp;32000,&nbsp;erlang&nbsp;client&nbsp;node&nbsp;publishing&nbsp;the&nbsp;message&nbsp;crashed.&amp;nbsp;&nbsp;When&nbsp;I&nbsp;looked&nbsp;at&nbsp;the&nbsp;crash&nbsp;dump,&nbsp;I&nbsp;see&nbsp;close&nbsp;to&nbsp;32767&nbsp;rabbit_writer:mainloop/1&nbsp;process&nbsp;still&nbsp;in&nbsp;waiting&nbsp;status.&amp;nbsp;&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;why&nbsp;so&nbsp;many&nbsp;rabbit_writer:mainloop&nbsp;processes&nbsp;are&nbsp;still&nbsp;hanging&nbsp;around.&amp;nbsp;&nbsp;Furthermore,&nbsp;I&nbsp;started&nbsp;another&nbsp;node&nbsp;to&nbsp;get&nbsp;published&nbsp;message&nbsp;from&nbsp;rabbitmq&nbsp;server,&nbsp;rabbitmq&nbsp;server&nbsp;sends&nbsp;basic.get_empty.&amp;nbsp;&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;crash_dump.erl&nbsp;says:&nbsp;&lt;br&gt;Maximum&nbsp;number&nbsp;of&nbsp;Erlang&nbsp;Process&nbsp;has&nbsp;reached&nbsp;32768&lt;br&gt;&lt;br&gt;Process&nbsp;status&nbsp;in&nbsp;erlang&nbsp;crash&nbsp;dump:&lt;br&gt;&lt;br&gt;&amp;lt;0.32765.6&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;rabbit_writer:mainloop/1&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Waiting&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;136&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;233&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;0&lt;br&gt;&amp;lt;0.32766.13&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;rabbit_writer:mainloop/1&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Waiting&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;132&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;233&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;0&lt;br&gt;&nbsp;&amp;lt;0.32767.1&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;rabbit_writer:mainloop/1&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Waiting&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;136&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;233&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;0&lt;br&gt;&lt;br&gt;&lt;br&gt;I&nbsp;tried&nbsp;spawning&nbsp;3&nbsp;erlang&nbsp;processes&nbsp;simultaneously&nbsp;to&nbsp;publish&nbsp;message&nbsp;using&nbsp;pmap&nbsp;to&nbsp;a&nbsp;single&nbsp;rabbitmq_server&nbsp;running&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1&quot;&nbsp;target=&quot;_blank&quot;&gt;127.0.0.1&lt;/a&gt;&nbsp;and&nbsp;rabbitmq&nbsp;server&nbsp;throws&nbsp;badarg&nbsp;error.&amp;nbsp;&nbsp;Here&nbsp;is&nbsp;the&nbsp;error&nbsp;below:&lt;br&gt;&nbsp;&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;14-Apr-2008::19:43:23&nbsp;===&lt;br&gt;Error&nbsp;in&nbsp;process&nbsp;&amp;lt;0.68.0&gt;&nbsp;on&nbsp;node&nbsp;'test@home'&nbsp;with&nbsp;exit&nbsp;value:&nbsp;{badarg,[{erlang,size,[1]},{rabbit_binary_generator,build_content_frames,5},{rabbit_binary_generator,build_simple_content_frames,3},{rabbit_writer,assemble_frames,4},{rabbit_writer,internal_send_command_async...&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;14-Apr-2008::19:43:23&nbsp;===&lt;br&gt;Error&nbsp;in&nbsp;process&nbsp;&amp;lt;0.70.0&gt;&nbsp;on&nbsp;node&nbsp;'test@home'&nbsp;with&nbsp;exit&nbsp;value:&nbsp;{badarg,[{erlang,size,[3]},{rabbit_binary_generator,build_content_frames,5},{rabbit_binary_generator,build_simple_content_frames,3},{rabbit_writer,assemble_frames,4},{rabbit_writer,internal_send_command_async...&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;14-Apr-2008::19:43:23&nbsp;===&lt;br&gt;Error&nbsp;in&nbsp;process&nbsp;&amp;lt;0.69.0&gt;&nbsp;on&nbsp;node&nbsp;'test@home'&nbsp;with&nbsp;exit&nbsp;value:&nbsp;{badarg,[{erlang,size,[2]},{rabbit_binary_generator,build_content_frames,5},{rabbit_binary_generator,build_simple_content_frames,3},{rabbit_writer,assemble_frames,4},{rabbit_writer,internal_send_command_async...&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;Have&nbsp;a&nbsp;look&nbsp;into&nbsp;this&nbsp;one:&nbsp;closed&lt;br&gt;Have&nbsp;a&nbsp;look&nbsp;into&nbsp;this&nbsp;one:&nbsp;closed&lt;br&gt;Have&nbsp;a&nbsp;look&nbsp;into&nbsp;this&nbsp;one:&nbsp;closed&lt;br&gt;(test@home)2&gt;&nbsp;&lt;br&gt;&lt;br&gt;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;what&nbsp;these&nbsp;errors&nbsp;mean.&amp;nbsp;&nbsp;Can&nbsp;someone&nbsp;tell&nbsp;me&nbsp;what&nbsp;I&nbsp;am&nbsp;doing&nbsp;wrong?&lt;br&gt;&nbsp;&lt;br&gt;Thank&nbsp;you,&lt;br&gt;Joe&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&nbsp;_______________________________________________&lt;br&gt;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;_______________________________________________&lt;br&gt;&nbsp;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;&nbsp;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&nbsp;&lt;span&gt;&amp;lt;amqp_async_consume.erl&gt;&lt;/span&gt;&lt;span&gt;&amp;lt;amqp_async_pub.erl&gt;&lt;/span&gt;&lt;span&gt;&amp;lt;my_pmap.erl&gt;&lt;/span&gt;&lt;span&gt;&amp;lt;rabbit_test.erl&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
