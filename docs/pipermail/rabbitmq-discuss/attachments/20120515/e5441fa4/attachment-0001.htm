<tt>
&lt;p&nbsp;style=&quot;text-align:&nbsp;center;&nbsp;clear:&nbsp;both;&quot;&nbsp;class=&quot;separator&quot;&gt;&lt;/p&gt;Hello,&lt;br&gt;&lt;br&gt;First&nbsp;of&nbsp;all,&nbsp;english&nbsp;is&nbsp;not&nbsp;my&nbsp;native&nbsp;language,&nbsp;so&nbsp;I&nbsp;may&nbsp;(will)&nbsp;make&nbsp;some&nbsp;mistakes.&nbsp;But&nbsp;I&nbsp;hope&nbsp;everybody&nbsp;will&nbsp;understand&nbsp;me.&lt;br&gt;I&nbsp;am&nbsp;new&nbsp;to&nbsp;this&nbsp;messaging&nbsp;thing&nbsp;so&nbsp;I&nbsp;am&nbsp;looking&nbsp;for&nbsp;any&nbsp;good&nbsp;advice&nbsp;you&nbsp;could&nbsp;give&nbsp;me.&lt;br&gt;&lt;br&gt;I&nbsp;am&nbsp;going&nbsp;to&nbsp;present&nbsp;you&nbsp;a&nbsp;scenario,&nbsp;and&nbsp;I&nbsp;would&nbsp;really&nbsp;appreciate&nbsp;if&nbsp;you&nbsp;could&nbsp;help&nbsp;me,&nbsp;by&nbsp;giving&nbsp;me&nbsp;ideas&nbsp;to&nbsp;implement&nbsp;it.&nbsp;Specifically&nbsp;if&nbsp;there&nbsp;is&nbsp;common&nbsp;design&nbsp;pattern&nbsp;I&nbsp;should&nbsp;use&nbsp;:&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;a&nbsp;server&nbsp;application&nbsp;with&nbsp;autonomous&nbsp;agents.&lt;br&gt;Each&nbsp;agent&nbsp;is&nbsp;on&nbsp;a&nbsp;specific&nbsp;server,&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;agent&nbsp;can&nbsp;quickly&nbsp;increase&nbsp;(today,&nbsp;I&nbsp;have&nbsp;about&nbsp;100&nbsp;agents,&nbsp;in&nbsp;a&nbsp;few&nbsp;months,&nbsp;I&nbsp;could&nbsp;have&nbsp;1000&nbsp;if&nbsp;everything&nbsp;goes&nbsp;as&nbsp;planned).&lt;br&gt;In&nbsp;this&nbsp;scenario,&nbsp;the&nbsp;number&nbsp;of&nbsp;messages&nbsp;per&nbsp;second,&nbsp;for&nbsp;each&nbsp;agent,&nbsp;is&nbsp;quite&nbsp;limited&nbsp;:&nbsp;juste&nbsp;a&nbsp;few&nbsp;messages&nbsp;/&nbsp;second&nbsp;/&nbsp;agent.&lt;br&gt;&lt;br&gt;The&nbsp;dialog&nbsp;between&nbsp;the&nbsp;server&nbsp;application&nbsp;and&nbsp;an&nbsp;agent&nbsp;contains&nbsp;different&nbsp;kind&nbsp;of&nbsp;messages&nbsp;that&nbsp;I&nbsp;began&nbsp;to&nbsp;represent&nbsp;with&nbsp;the&nbsp;&quot;topic&nbsp;exchange&quot;&nbsp;kind&nbsp;of&nbsp;thing&nbsp;:&lt;br&gt;&lt;br&gt;//&nbsp;Messages&nbsp;received&nbsp;for&nbsp;a&nbsp;watchdog&nbsp;installed&nbsp;on&nbsp;the&nbsp;agent1&nbsp;:&lt;br&gt;agent1.watchdog.critical&nbsp;&lt;br&gt;agent1.watchdog.warning&lt;br&gt;&lt;br&gt;//&nbsp;Messages&nbsp;containing&nbsp;commands&nbsp;that&nbsp;sould&nbsp;be&nbsp;executed&nbsp;my&nbsp;the&nbsp;agent&lt;br&gt;agent1.cmd.immediate&lt;br&gt;agent1.cmd.delay&lt;br&gt;&lt;br&gt;//&nbsp;Messages&nbsp;organizing&nbsp;file&nbsp;transfer&nbsp;between&nbsp;two&nbsp;components&nbsp;of&nbsp;my&nbsp;architecture&lt;br&gt;agent1.fileTransfer.historyFile1.send&lt;br&gt;agent1.fileTransfer.historyFile1.loaded&lt;br&gt;agent1.fileTransfer.historyFile1.failure&lt;br&gt;agent1.fileTransfer.historyFile2.send&lt;br&gt;agent1.fileTransfer.historyFile2.loaded&lt;br&gt;agent1.fileTransfer.historyFile2.failure&lt;br&gt;&lt;br&gt;With&nbsp;this&nbsp;pattern,&nbsp;I&nbsp;will&nbsp;have&nbsp;about&nbsp;10&nbsp;to&nbsp;20&nbsp;queues&nbsp;for&nbsp;each&nbsp;agent&nbsp;(20&nbsp;to&nbsp;40&nbsp;if&nbsp;I&nbsp;have&nbsp;a&nbsp;queue&nbsp;for&nbsp;agent&nbsp;to&nbsp;server&nbsp;dialog&nbsp;and&nbsp;another&nbsp;one&nbsp;for&nbsp;server&nbsp;to&nbsp;agent&nbsp;dialog).&lt;br&gt;&lt;br&gt;My&nbsp;initial&nbsp;questions&nbsp;are&nbsp;:&lt;br&gt;-&nbsp;Will&nbsp;there&nbsp;be&nbsp;a&nbsp;problem&nbsp;with&nbsp;this&nbsp;number&nbsp;of&nbsp;queues&nbsp;in&nbsp;my&nbsp;architecture&nbsp;?&nbsp;(100&nbsp;agent&nbsp;--&amp;gt;&nbsp;more&nbsp;than&nbsp;2000&nbsp;queues)&nbsp;and&nbsp;what&nbsp;should&nbsp;be&nbsp;the&nbsp;size&nbsp;of&nbsp;my&nbsp;server&nbsp;hosting&nbsp;the&nbsp;broker&nbsp;?&lt;br&gt;-&nbsp;Is&nbsp;there&nbsp;a&nbsp;pattern&nbsp;that&nbsp;could&nbsp;help&nbsp;me&nbsp;?&lt;br&gt;-&nbsp;Is&nbsp;it&nbsp;better&nbsp;to&nbsp;use&nbsp;messages&nbsp;headers&nbsp;to&nbsp;identify&nbsp;each&nbsp;message,&nbsp;instead&nbsp;of&nbsp;topic&nbsp;exchange&nbsp;?&lt;br&gt;-&nbsp;Is&nbsp;it&nbsp;better&nbsp;to&nbsp;differentiate&nbsp;server&nbsp;to&nbsp;agent&nbsp;queue&nbsp;and&nbsp;agent&nbsp;to&nbsp;server&nbsp;queue,&nbsp;or&nbsp;is&nbsp;it&nbsp;ok&nbsp;if&nbsp;both&nbsp;read&nbsp;and&nbsp;write&nbsp;in&nbsp;the&nbsp;same&nbsp;queue&nbsp;?&lt;br&gt;&lt;br&gt;Note&nbsp;:&nbsp;Because&nbsp;my&nbsp;history&nbsp;files,&nbsp;that&nbsp;have&nbsp;to&nbsp;be&nbsp;transfered&nbsp;between&nbsp;the&nbsp;agent&nbsp;and&nbsp;the&nbsp;server,&nbsp;can&nbsp;size&nbsp;several&nbsp;Mo,&nbsp;I&nbsp;don't&nbsp;intend&nbsp;to&nbsp;send&nbsp;them&nbsp;via&nbsp;amqp&nbsp;protocol&nbsp;(except&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;significant&nbsp;performance&nbsp;decrease&nbsp;by&nbsp;doing&nbsp;that&nbsp;?)&lt;br&gt;&lt;br&gt;To&nbsp;be&nbsp;honest,&nbsp;I&nbsp;read&nbsp;this&nbsp;article&nbsp;:&lt;br&gt;http://blog.springsource.com/2011/04/01/routing-topologies-for-performance-and-scalability-with-rabbitmq/&lt;br&gt;&lt;br&gt;And&nbsp;i&nbsp;decided&nbsp;to&nbsp;inspire&nbsp;myself&nbsp;from&nbsp;the&nbsp;&quot;Exchange-to-Exchange&nbsp;Scalable&nbsp;Use&nbsp;Case&quot;.&nbsp;But&nbsp;I&nbsp;use&nbsp;the&nbsp;perl&nbsp;library&nbsp;Net::RabbitMQ,&nbsp;which&nbsp;does&nbsp;not&nbsp;implement&nbsp;exchange&nbsp;to&nbsp;exchange&nbsp;bindings,&nbsp;so&nbsp;I&nbsp;have&nbsp;to&nbsp;modifiy&nbsp;it&nbsp;a&nbsp;little&nbsp;:&lt;br&gt;&lt;br&gt;So&nbsp;I&nbsp;came&nbsp;with&nbsp;this&nbsp;architecture&nbsp;(see&nbsp;Image&nbsp;below)&lt;br&gt;&lt;br&gt;I&nbsp;explain&nbsp;a&nbsp;little&nbsp;:&lt;br&gt;-&nbsp;the&nbsp;server&nbsp;application&nbsp;don't&nbsp;know&nbsp;when&nbsp;an&nbsp;agent&nbsp;will&nbsp;be&nbsp;&quot;awake&quot;&nbsp;and&nbsp;will&nbsp;start&nbsp;to&nbsp;talk.&nbsp;So&nbsp;i&nbsp;was&nbsp;thinking&nbsp;of&nbsp;using&nbsp;some&nbsp;kind&nbsp;of&nbsp;authentication&nbsp;thing&nbsp;:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;-&nbsp;Each&nbsp;agent,&nbsp;at&nbsp;first&nbsp;start,&nbsp;will&nbsp;begin&nbsp;to&nbsp;talk&nbsp;in&nbsp;a&nbsp;guest&nbsp;exchange,&nbsp;declaring&nbsp;and&nbsp;authenticating&nbsp;itself.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;-&nbsp;When&nbsp;the&nbsp;server&nbsp;application&nbsp;authenticates&nbsp;the&nbsp;agent,&nbsp;it&nbsp;will&nbsp;automatically&nbsp;bind&nbsp;a&nbsp;new&nbsp;queue&nbsp;to&nbsp;the&nbsp;&quot;client&nbsp;exchange&nbsp;authenticated&quot;.&nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;-&nbsp;When&nbsp;the&nbsp;agent&nbsp;receive&nbsp;a&nbsp;confirmation&nbsp;of&nbsp;the&nbsp;authentication,&nbsp;it&nbsp;will&nbsp;bind&nbsp;about&nbsp;10&nbsp;queues&nbsp;to&nbsp;the&nbsp;&quot;server&nbsp;to&nbsp;client&nbsp;authenticated&nbsp;exchange&quot;&nbsp;(with&nbsp;the&nbsp;topic&nbsp;exchange&nbsp;described&nbsp;before)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;Regarding&nbsp;this&nbsp;scenario,&nbsp;what&nbsp;advice&nbsp;could&nbsp;you&nbsp;give&nbsp;me&nbsp;?&lt;br&gt;&lt;br&gt;Thanks&nbsp;in&nbsp;advance&nbsp;for&nbsp;any&nbsp;information&nbsp;/&nbsp;advice.&lt;br&gt;&lt;br&gt;Kilian&lt;br&gt;&lt;br&gt;The&nbsp;architecture&nbsp;:&nbsp;&lt;br&gt;&lt;p&nbsp;style=&quot;text-align:&nbsp;center;&nbsp;clear:&nbsp;both;&quot;&nbsp;class=&quot;separator&quot;&gt;&lt;a&nbsp;style=&quot;clear:&nbsp;left;&nbsp;margin-bottom:&nbsp;1em;&nbsp;float:&nbsp;left;&nbsp;margin-right:&nbsp;1em;&quot;&nbsp;href=&quot;https://lh4.googleusercontent.com/-4fdI32Uo8cQ/T7IdEM_FehI/AAAAAAAAAHo/6l74h0meAEc/s1600/RabbitMQ+Implementation.jpg&quot;&nbsp;imageanchor=&quot;1&quot;&gt;&lt;img&nbsp;src=&quot;https://lh4.googleusercontent.com/-4fdI32Uo8cQ/T7IdEM_FehI/AAAAAAAAAHo/6l74h0meAEc/s320/RabbitMQ+Implementation.jpg&quot;&nbsp;style=&quot;&quot;&nbsp;border=&quot;0&quot;&nbsp;height=&quot;223&quot;&nbsp;width=&quot;320&quot;&gt;&lt;/a&gt;&lt;/p&gt;
</tt>
