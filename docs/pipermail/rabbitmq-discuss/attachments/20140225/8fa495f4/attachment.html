<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Rabbit&nbsp;3.2.1&lt;/div&gt;.Net&nbsp;Client&lt;div&gt;F5&nbsp;Load&nbsp;balancer&lt;/div&gt;&lt;div&gt;2&nbsp;node&nbsp;cluster&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;debug&nbsp;an&nbsp;issue&nbsp;with&nbsp;our&nbsp;dequeueing&nbsp;code&nbsp;and&nbsp;a&nbsp;cluster.&nbsp;We&nbsp;have&nbsp;a&nbsp;Windows&nbsp;service&nbsp;that&nbsp;starts&nbsp;up&nbsp;with&nbsp;three&nbsp;threads&nbsp;each&nbsp;maintaining&nbsp;its&nbsp;own&nbsp;instance&nbsp;of&nbsp;IModel.&nbsp;That&nbsp;Model&nbsp;is&nbsp;reused&nbsp;each&nbsp;time&nbsp;the&nbsp;thread&nbsp;loops&nbsp;around&nbsp;to&nbsp;Dequeue&nbsp;a&nbsp;message.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;testing&nbsp;how&nbsp;well&nbsp;our&nbsp;Windows&nbsp;service&nbsp;stands&nbsp;up&nbsp;to&nbsp;a&nbsp;node&nbsp;going&nbsp;down.&nbsp;I&nbsp;do&nbsp;this&nbsp;by&nbsp;simply&nbsp;stopping&nbsp;the&nbsp;Rabbit&nbsp;MQ&nbsp;service&nbsp;on&nbsp;the&nbsp;Master&nbsp;node.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;our&nbsp;Windows&nbsp;Service&nbsp;I&nbsp;catch&nbsp;the&nbsp;OperationInterruptedException&nbsp;and&nbsp;AlreadyClosedException&nbsp;exceptions.&nbsp;When&nbsp;caught&nbsp;I&nbsp;set&nbsp;that&nbsp;thread&#39;s&nbsp;Model&nbsp;to&nbsp;null&nbsp;and&nbsp;it&nbsp;will&nbsp;be&nbsp;recreated&nbsp;the&nbsp;next&nbsp;time&nbsp;around&nbsp;the&nbsp;Dequeue&nbsp;loop.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;approach&nbsp;works&nbsp;fine&nbsp;when&nbsp;the&nbsp;Queues&nbsp;are&nbsp;empty&nbsp;and&nbsp;the&nbsp;loop&nbsp;time&nbsp;is&nbsp;infrequent.However&nbsp;when&nbsp;I&nbsp;take&nbsp;the&nbsp;node&nbsp;down&nbsp;and&nbsp;our&nbsp;Windows&nbsp;service&nbsp;is&nbsp;dequeuing&nbsp;and\or&nbsp;Acking&nbsp;messages&nbsp;I&nbsp;hit&nbsp;a&nbsp;problem&nbsp;on&nbsp;one&nbsp;of&nbsp;the&nbsp;threads.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;an&nbsp;example&nbsp;threads&nbsp;1&nbsp;and&nbsp;2&nbsp;will&nbsp;both&nbsp;catch&nbsp;separate&nbsp;instances&nbsp;of&nbsp;AlreadyClosedException&nbsp;and&nbsp;reset&nbsp;their&nbsp;IModel.&nbsp;Next&nbsp;time&nbsp;around&nbsp;Thread&nbsp;1&nbsp;will&nbsp;reconnect&nbsp;its&nbsp;Model&nbsp;and&nbsp;start&nbsp;dequeueing&nbsp;but&nbsp;Thread&nbsp;2&nbsp;will&nbsp;get&nbsp;a BrokerUnreachableException.&nbsp;I&nbsp;have&nbsp;tried&nbsp;retrying&nbsp;that&nbsp;reconnect&nbsp;with&nbsp;some&nbsp;Thread.Sleep&nbsp;delays&nbsp;and&nbsp;it&nbsp;does&nbsp;not&nbsp;help.&nbsp;Once&nbsp;&quot;broken&quot;&nbsp;that&nbsp;thread&nbsp;gets&nbsp;BrokerUnreachableException&nbsp;every&nbsp;time.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;ideas&nbsp;as&nbsp;to&nbsp;why&nbsp;this&nbsp;might&nbsp;be?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Patrick&nbsp;Long&nbsp;-&nbsp;Munkiisoft&nbsp;Ltd<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
