<tt>
&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,sans-serif&quot;&gt;Hi&nbsp;dns,&nbsp;I&amp;#39;ll&nbsp;try&nbsp;to&nbsp;bring&nbsp;my&nbsp;own&nbsp;experience&nbsp;on&nbsp;the&nbsp;subject. &lt;/font&gt;&lt;span&nbsp;style=&quot;font-family:&amp;#39;trebuchet&nbsp;ms&amp;#39;,sans-serif&quot;&gt;When&nbsp;you&nbsp;federate&nbsp;exchanges&nbsp;between&nbsp;brokers&nbsp;you&nbsp;are&nbsp;in&nbsp;the&nbsp;loose&nbsp;sense&nbsp;having&nbsp;the&nbsp;downstream&nbsp;exchange&nbsp;acting&nbsp;as&nbsp;a&nbsp;consumer&nbsp;for&nbsp;the&nbsp;upstream&nbsp;exchange.&nbsp;I&nbsp;may&nbsp;have&nbsp;misunderstood&nbsp;you&nbsp;but&nbsp;I&nbsp;think&nbsp;that&nbsp;having&nbsp;8000&nbsp;brokers&nbsp;rather&nbsp;8000&nbsp;remote&nbsp;consumers&nbsp;on&nbsp;the&nbsp;central&nbsp;broker&nbsp;doesn&amp;#39;t&nbsp;solve&nbsp;the&nbsp;consistency&nbsp;problem&nbsp;you&nbsp;are&nbsp;describing.&lt;/span&gt;&lt;div&gt;<br>
<br>
&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,sans-serif&quot;&gt;Let&amp;#39;s&nbsp;make&nbsp;an&nbsp;example&nbsp;with&nbsp;federated&nbsp;brokers&nbsp;on&nbsp;the&nbsp;happy&nbsp;path:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;font-family:&amp;#39;trebuchet&nbsp;ms&amp;#39;,sans-serif&quot;&gt;One&nbsp;message&nbsp;is&nbsp;published&nbsp;on&nbsp;the&nbsp;upstream&nbsp;exchange&nbsp;and&nbsp;reaches&nbsp;the&nbsp;downstream&nbsp;exchange,&nbsp;and&nbsp;in&nbsp;turn&nbsp;the&nbsp;queue&nbsp;and&nbsp;then&nbsp;the&nbsp;consumer&nbsp;on&nbsp;the&nbsp;downstream&nbsp;broker&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;span&nbsp;style=&quot;font-family:&amp;#39;trebuchet&nbsp;ms&amp;#39;,sans-serif&quot;&gt;The&nbsp;downstream&nbsp;broker&nbsp;confirms&nbsp;the&nbsp;message&nbsp;to&nbsp;the&nbsp;upstream&nbsp;broker&nbsp;so&nbsp;the&nbsp;upstream&nbsp;broker&nbsp;can&nbsp;forget&nbsp;about&nbsp;it&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;font-family:&amp;#39;trebuchet&nbsp;ms&amp;#39;,sans-serif&quot;&gt;The&nbsp;connection&nbsp;between&nbsp;the&nbsp;brokers&nbsp;goes&nbsp;down&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;span&nbsp;style=&quot;font-family:&amp;#39;trebuchet&nbsp;ms&amp;#39;,sans-serif&quot;&gt;The&nbsp;consumer&nbsp;on&nbsp;the&nbsp;downstream&nbsp;broker&nbsp;processes&nbsp;the&nbsp;message,&nbsp;acknowledges&nbsp;it&nbsp;and&nbsp;everyone&amp;#39;s&nbsp;happy&lt;/span&gt;&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;Here&amp;#39;s&nbsp;the&nbsp;sad&nbsp;path&nbsp;with&nbsp;federated&nbsp;brokers:&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;ol&gt;&lt;li&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;same&nbsp;as&nbsp;above&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;The&nbsp;connection&nbsp;between&nbsp;the&nbsp;brokers&nbsp;is&nbsp;lost&nbsp;before&nbsp;the&nbsp;downstream&nbsp;can&nbsp;confirm&nbsp;the&nbsp;message&nbsp;to&nbsp;the&nbsp;upstream&nbsp;(unlikely,&nbsp;but&nbsp;can&nbsp;definitely&nbsp;happen)&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;The&nbsp;consumer&nbsp;on&nbsp;the&nbsp;downstream&nbsp;broker&nbsp;processes&nbsp;the&nbsp;message&nbsp;and&nbsp;acknowledges&nbsp;it&nbsp;to&nbsp;its&nbsp;local&nbsp;broker&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;The&nbsp;connection&nbsp;between&nbsp;the&nbsp;two&nbsp;brokers&nbsp;is&nbsp;restored,&nbsp;and&nbsp;thus&nbsp;the&nbsp;upstream&nbsp;will&nbsp;resend&nbsp;the&nbsp;unconfirmed&nbsp;messages&nbsp;once&nbsp;again&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;The&nbsp;consumer&nbsp;on&nbsp;the&nbsp;downstream&nbsp;will&nbsp;receive&nbsp;the&nbsp;same&nbsp;message&nbsp;it&nbsp;has&nbsp;already&nbsp;consumed,&nbsp;therefore&nbsp;it&nbsp;will&nbsp;need&nbsp;a&nbsp;way&nbsp;to&nbsp;deduplicate&nbsp;it&lt;/font&gt;&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;Now&nbsp;the&nbsp;safe&nbsp;path&nbsp;with&nbsp;just&nbsp;the&nbsp;central&nbsp;broker:&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;One&nbsp;message&nbsp;is&nbsp;published&nbsp;on&nbsp;the&nbsp;central&nbsp;broker&nbsp;and&nbsp;reaches&nbsp;a&nbsp;remote&nbsp;consumers&lt;/font&gt;&lt;/li&gt;&lt;li&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;The&nbsp;consumer&nbsp;processes&nbsp;the&nbsp;message&nbsp;but&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;central&nbsp;broker&nbsp;will&nbsp;go&nbsp;down&nbsp;before&nbsp;it&nbsp;can&nbsp;ack&nbsp;the&nbsp;message&lt;/font&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;Once&nbsp;the&nbsp;connection&nbsp;is&nbsp;restored&nbsp;the&nbsp;consumer&nbsp;will&nbsp;receive&nbsp;the&nbsp;unacked&nbsp;message&nbsp;again,&nbsp;so&nbsp;also&nbsp;in&nbsp;this&nbsp;case&nbsp;it&nbsp;will&nbsp;need&nbsp;to&nbsp;deduplicate&nbsp;it&lt;/font&gt;&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;Some&nbsp;observations:&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;font-family:&amp;#39;trebuchet&nbsp;ms&amp;#39;,sans-serif&quot;&gt;in&nbsp;any&nbsp;case&nbsp;your&nbsp;consumer&nbsp;will&nbsp;need&nbsp;to&nbsp;be&nbsp;somewhat&nbsp;aware&nbsp;of&nbsp;the&nbsp;fact&nbsp;that&nbsp;it&nbsp;is&nbsp;quite&nbsp;distant&nbsp;from&nbsp;the&nbsp;original&nbsp;broker&nbsp;and&nbsp;cope&nbsp;with&nbsp;what&nbsp;this&nbsp;implies&nbsp;in&nbsp;some&nbsp;way&nbsp;(message&nbsp;duplication,&nbsp;for&nbsp;one)&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;span&nbsp;style=&quot;font-family:&amp;#39;trebuchet&nbsp;ms&amp;#39;,sans-serif&quot;&gt;with&nbsp;the&nbsp;central&nbsp;broker&nbsp;the&nbsp;remote&nbsp;consumers&nbsp;will&nbsp;have&nbsp;to&nbsp;handle&nbsp;connection&nbsp;failures&nbsp;themselves,&nbsp;something&nbsp;which&nbsp;is&nbsp;less&nbsp;likely&nbsp;to&nbsp;happen&nbsp;with&nbsp;a&nbsp;local&nbsp;broker,&nbsp;although&nbsp;not&nbsp;impossible&nbsp;of&nbsp;course.&nbsp;This&nbsp;is&nbsp;handled&nbsp;by&nbsp;the&nbsp;federation&nbsp;plugin&nbsp;in&nbsp;case&nbsp;of&nbsp;federated&nbsp;brokers&nbsp;instead&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;span&nbsp;style=&quot;font-family:&amp;#39;trebuchet&nbsp;ms&amp;#39;,sans-serif&quot;&gt;Having&nbsp;8000&nbsp;brokers&nbsp;rather&nbsp;than&nbsp;8000&nbsp;consumers&nbsp;is&nbsp;going&nbsp;to&nbsp;require&nbsp;quite&nbsp;some&nbsp;maintenance,&nbsp;and&nbsp;I&amp;#39;m&nbsp;not&nbsp;sure&nbsp;how&nbsp;well&nbsp;the&nbsp;federation&nbsp;plugin&nbsp;RabbitMQ&nbsp;can&nbsp;handle&nbsp;that,&nbsp;I&nbsp;am&nbsp;under&nbsp;the&nbsp;impression&nbsp;that&nbsp;it&nbsp;was&nbsp;not&nbsp;designed&nbsp;for&nbsp;this&nbsp;many&nbsp;federated&nbsp;exchanges,&nbsp;but&nbsp;I&nbsp;may&nbsp;be&nbsp;wrong&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;span&nbsp;style=&quot;font-family:&amp;#39;trebuchet&nbsp;ms&amp;#39;,sans-serif&quot;&gt;You&nbsp;mention&nbsp;synchronicity&nbsp;between&nbsp;the&nbsp;central&nbsp;location&nbsp;and&nbsp;the&nbsp;remote&nbsp;consumers.&nbsp;Consider&nbsp;that&nbsp;even&nbsp;if&nbsp;you&nbsp;federate&nbsp;brokers&nbsp;and&nbsp;you&nbsp;see&nbsp;all&nbsp;messages&nbsp;delivered&nbsp;and&nbsp;acked&nbsp;on&nbsp;the&nbsp;federation&nbsp;queues,&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;tell&nbsp;you&nbsp;anything&nbsp;about&nbsp;whether&nbsp;the&nbsp;remote&nbsp;consumers&nbsp;have&nbsp;processed&nbsp;the&nbsp;messages&nbsp;or&nbsp;not&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;23,&nbsp;2012&nbsp;at&nbsp;19:54,&nbsp;dnsplus&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:developer@dnsplus.net&quot;&gt;developer@dnsplus.net&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Jerry&nbsp;Kuch&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Hi,&nbsp;dnsplus:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Could&nbsp;you&nbsp;perhaps&nbsp;clarify&nbsp;a&nbsp;bit&nbsp;what&nbsp;you&nbsp;mean&nbsp;by&nbsp;&amp;quot;remote?&amp;quot;&nbsp; Are&nbsp;you&lt;br&gt;<br>
&amp;gt;&nbsp;talking&nbsp;about&nbsp;systems&nbsp;that&nbsp;are&nbsp;geographically&nbsp;separated&nbsp;from&nbsp;your&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;quot;central&nbsp;broker&amp;quot;&nbsp;for&nbsp;some&nbsp;reason&nbsp;external&nbsp;to&nbsp;your&nbsp;application?&nbsp; Or&lt;br&gt;<br>
&amp;gt;&nbsp;are&nbsp;you&nbsp;just&nbsp;talking&nbsp;about&nbsp;having&nbsp;8,000&nbsp;consumers?&nbsp; The&nbsp;latter&lt;br&gt;<br>
&amp;gt;&nbsp;shouldn&amp;#39;t&nbsp;be&nbsp;a&nbsp;daunting&nbsp;number&nbsp;at&nbsp;all&nbsp;for&nbsp;even&nbsp;fairly&nbsp;modest&nbsp;Rabbit&lt;br&gt;<br>
&amp;gt;&nbsp;deployments.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Best&nbsp;regards,&lt;br&gt;<br>
&amp;gt;&nbsp;Jerry&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Its&nbsp;a&nbsp;little&nbsp;complicated,&nbsp;but&nbsp;I&amp;#39;ll&nbsp;give&nbsp;it&nbsp;my&nbsp;best&nbsp;shot:&lt;br&gt;<br>
&lt;br&gt;<br>
Jerry,&nbsp;for&nbsp;you&nbsp;...&nbsp;Definition&nbsp;of&nbsp;a&nbsp;Site:&nbsp; A&nbsp;retail&nbsp;store&nbsp;location,&nbsp;from&nbsp;1&nbsp;to&lt;br&gt;<br>
~1800&nbsp;miles&nbsp;away&nbsp;from&nbsp;the&nbsp;data&nbsp;center&nbsp;where&nbsp;the&nbsp;Central&nbsp;Broker&nbsp;runs).&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;working&nbsp;with&nbsp;a&nbsp;large&nbsp;environment&nbsp;which&nbsp;has&nbsp;no&nbsp;guarantee&nbsp;of&nbsp;a&nbsp;stable&lt;br&gt;<br>
network,&nbsp;or&nbsp;guaranteed&nbsp;bandwidth&nbsp;to&nbsp;the&nbsp;remote&nbsp;sites.&nbsp;The&nbsp;typical&nbsp;CIR&nbsp;is&lt;br&gt;<br>
384Kbps,&nbsp;with&nbsp;a&nbsp;1.544Mbps&nbsp;MAX&nbsp;(yep,&nbsp;fractional&nbsp;T1s).&nbsp;To&nbsp;mitigate&nbsp;the&lt;br&gt;<br>
possibility&nbsp;that&nbsp;network&nbsp;connectivity&nbsp;to&nbsp;a&nbsp;site,&nbsp;or&nbsp;region,&nbsp;can&nbsp;be&lt;br&gt;<br>
unavailable&nbsp;for&nbsp;an&nbsp;undetermined&nbsp;period&nbsp;of&nbsp;time,&nbsp;at&nbsp;any&nbsp;time,&nbsp;and&nbsp;for&nbsp;any&lt;br&gt;<br>
reason&nbsp;...&nbsp;we&nbsp;think&nbsp;guaranteed&nbsp;message&nbsp;delivery&nbsp;with&nbsp;RabbitMQ&nbsp;is&nbsp;the&lt;br&gt;<br>
foundation&nbsp;we&nbsp;need&nbsp;for&nbsp;this&nbsp;&amp;#39;application&amp;#39;&nbsp;to&nbsp;work.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;message&nbsp;payload&nbsp;for&nbsp;this&nbsp;application&nbsp;will&nbsp;be&nbsp;well&nbsp;formatted&nbsp;XML&nbsp;which&lt;br&gt;<br>
contains&nbsp;instructions&nbsp;that&nbsp;will&nbsp;be&nbsp;parsed,&nbsp;interpreted,&nbsp;and&nbsp;executed&nbsp;via&nbsp;a&lt;br&gt;<br>
consumer&nbsp;at&nbsp;each&nbsp;client&nbsp;site,&nbsp;implemented&nbsp;in&nbsp;PERL.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;...&nbsp;should&nbsp;I&nbsp;be&nbsp;using&nbsp;a&nbsp;Central&nbsp;Broker,&nbsp;which&nbsp;forwards&nbsp;a&nbsp;message&nbsp;to&nbsp;a&lt;br&gt;<br>
queue&nbsp;at&nbsp;a&nbsp;remote&nbsp;broker,&nbsp;which&nbsp;is&nbsp;consumed&nbsp;by&nbsp;the&nbsp;client&nbsp;process?&lt;br&gt;<br>
&lt;br&gt;<br>
Or,&nbsp;do&nbsp;I&nbsp;leverage&nbsp;the&nbsp;Central&nbsp;Broker&nbsp;with&nbsp;a&nbsp;Queue&nbsp;for&nbsp;each&nbsp;remote&nbsp;site,&nbsp;and&lt;br&gt;<br>
configure&nbsp;the&nbsp;consumers&nbsp;to&nbsp;talk&nbsp;to&nbsp;the&nbsp;Central&nbsp;Broker&nbsp;for&nbsp;message&nbsp;collection&lt;br&gt;<br>
and&nbsp;processing.&lt;br&gt;<br>
&lt;br&gt;<br>

</tt>
