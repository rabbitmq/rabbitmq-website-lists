<tt>
&lt;html&gt;&lt;head&gt;&lt;style&nbsp;type=&quot;text/css&quot;&gt;&lt;!--&nbsp;DIV&nbsp;{margin:0px;}&nbsp;--&gt;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;font-family:times&nbsp;new&nbsp;roman,new&nbsp;york,times,serif;font-size:10pt&quot;&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;times&nbsp;new&nbsp;roman,new&nbsp;york,times,serif;&nbsp;font-size:&nbsp;10pt;&quot;&gt;Hi&nbsp;Matthew,&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;investigating&nbsp;this&nbsp;problem!&nbsp;I&nbsp;tried&nbsp;rabbitmq-server&nbsp;from&nbsp;hg&nbsp;tip,&nbsp;but&nbsp;it&nbsp;still&nbsp;crashed&nbsp;when&nbsp;the&nbsp;message&nbsp;consuming&nbsp;rate&nbsp;reached&nbsp;300&nbsp;MB/sec.&amp;nbsp;&nbsp;When&nbsp;you&nbsp;ran&nbsp;the&nbsp;test,&nbsp;did&nbsp;you&nbsp;load&nbsp;at&nbsp;least&nbsp;60&nbsp;GB&nbsp;messages&nbsp;to&nbsp;1000&nbsp;queues?&amp;nbsp;&nbsp;each&nbsp;message&nbsp;is&nbsp;20&nbsp;KB&nbsp;in&nbsp;size.&lt;br&gt;&lt;br&gt;My&nbsp;machine&nbsp;is&nbsp;RAID-10&nbsp;with&nbsp;4&nbsp;SSD&nbsp;disks:&amp;nbsp;&nbsp;&lt;br&gt;480GB&nbsp;(1%)&nbsp;RAID-10/2&nbsp;==&nbsp;4&nbsp;x&nbsp;240GB&nbsp;SSD&nbsp;SATA/300&lt;br&gt;Maybe&nbsp;your&nbsp;test&nbsp;machine&nbsp;has&nbsp;only&nbsp;1&nbsp;SSD&nbsp;disk&nbsp;so&nbsp;the&nbsp;consuming&nbsp;rate&nbsp;could&nbsp;not&nbsp;reach&nbsp;300&nbsp;MB/sec?&lt;br&gt;&lt;br&gt;Thanks.&lt;br&gt;&lt;br&gt;-alex&lt;br&gt;&lt;br&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;arial,helvetica,sans-serif;&nbsp;font-size:&nbsp;13px;&quot;&gt;&lt;font&nbsp;face=&quot;Tahoma&quot;&nbsp;size=&quot;2&quot;&gt;&lt;hr&nbsp;size=&quot;1&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;From:&lt;/span&gt;&lt;/b&gt;&nbsp;Matthew&nbsp;Sackman<br>
&nbsp;&amp;lt;matthew@rabbitmq.com&amp;gt;&lt;br&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;To:&lt;/span&gt;&lt;/b&gt;&nbsp;rabbitmq-discuss@lists.rabbitmq.com&lt;br&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;Sent:&lt;/span&gt;&lt;/b&gt;&nbsp;Wed,&nbsp;March&nbsp;16,&nbsp;2011&nbsp;3:49:57&nbsp;AM&lt;br&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;Subject:&lt;/span&gt;&lt;/b&gt;&nbsp;Re:&nbsp;[rabbitmq-discuss]&nbsp;server&nbsp;crashes&nbsp;with&nbsp;very&nbsp;fast&nbsp;consumers&lt;br&gt;&lt;/font&gt;&lt;br&gt;<br>
Hi&nbsp;Alex,&lt;br&gt;&lt;br&gt;On&nbsp;Thu,&nbsp;Mar&nbsp;10,&nbsp;2011&nbsp;at&nbsp;09:48:08PM&nbsp;-0800,&nbsp;alex&nbsp;chen&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;I&nbsp;am&nbsp;testing&nbsp;rabbit&nbsp;server&nbsp;with&nbsp;SSD.&amp;nbsp;&nbsp;The&nbsp;broker&nbsp;process&nbsp;would&nbsp;crash&nbsp;when&nbsp;many&nbsp;&lt;br&gt;&amp;gt;&nbsp;consumers&nbsp;start&nbsp;to&nbsp;consume&nbsp;backed&nbsp;up&nbsp;messages.&amp;nbsp;&nbsp;Because&nbsp;SSD&nbsp;if&nbsp;very&nbsp;fast,&nbsp;the&nbsp;&lt;br&gt;&amp;gt;&nbsp;consuming&nbsp;rate&nbsp;reached&nbsp;more&nbsp;than&nbsp;200&nbsp;MB/sec.&amp;nbsp;&nbsp;After&nbsp;several&nbsp;minutes,&nbsp;the&nbsp;broker&nbsp;&lt;br&gt;&amp;gt;&nbsp;process&nbsp;would&nbsp;use&nbsp;all&nbsp;cpu&nbsp;resources&nbsp;(800%&nbsp;on&nbsp;8&nbsp;cores)&nbsp;and&nbsp;crash.&lt;br&gt;&lt;br&gt;I&nbsp;test&nbsp;all&nbsp;the&nbsp;time&nbsp;on&nbsp;an&nbsp;Intel&nbsp;G2&nbsp;drive.&nbsp;I've&nbsp;never&nbsp;seen&nbsp;it&nbsp;cause&nbsp;a&lt;br&gt;crash,&nbsp;even&nbsp;in&nbsp;scenarios&nbsp;such&nbsp;as&nbsp;yours.&nbsp;Furthermore,&nbsp;I&nbsp;find&nbsp;it&nbsp;somewhat&lt;br&gt;unlikely&nbsp;that&nbsp;if&nbsp;the&nbsp;server&nbsp;process&nbsp;did&nbsp;die,&nbsp;it&nbsp;didn't&nbsp;spit&nbsp;out&nbsp;any&nbsp;sort&lt;br&gt;of&nbsp;error&nbsp;on&nbsp;its&nbsp;way&nbsp;out.&nbsp;There&nbsp;must&nbsp;be&nbsp;/something/&nbsp;somewhere&nbsp;that&lt;br&gt;suggests&nbsp;a&nbsp;bit&nbsp;more&nbsp;as&nbsp;to&nbsp;what&nbsp;went&nbsp;wrong,&nbsp;whether&nbsp;it's&nbsp;in&nbsp;syslog,&nbsp;or&lt;br&gt;dmesg,&nbsp;or&nbsp;rabbit's&nbsp;various&nbsp;logs.&lt;br&gt;&lt;br&gt;I&nbsp;did&nbsp;however&nbsp;yesterday&nbsp;find&nbsp;and&nbsp;fix&nbsp;a&nbsp;bug&nbsp;where&nbsp;inexplicably&nbsp;a&nbsp;function&lt;br&gt;that&nbsp;normally&nbsp;takes&nbsp;about&nbsp;0.5s&nbsp;ended&nbsp;up&nbsp;in&nbsp;some&nbsp;very<br>
&nbsp;strange&nbsp;cases&lt;br&gt;taking&nbsp;&amp;gt;&nbsp;80s.&nbsp;After&nbsp;a&nbsp;lot&nbsp;of&nbsp;head&nbsp;scratching&nbsp;and&nbsp;debugging,&nbsp;I&nbsp;never&lt;br&gt;understood&nbsp;why&nbsp;this&nbsp;variance&nbsp;existed.&nbsp;However,&nbsp;I&nbsp;rewrote&nbsp;the&nbsp;function&lt;br&gt;and&nbsp;it's&nbsp;now&nbsp;much&nbsp;faster&nbsp;all&nbsp;the&nbsp;time.&nbsp;This&nbsp;particular&nbsp;bug&nbsp;has&nbsp;been&lt;br&gt;through&nbsp;QA&nbsp;and&nbsp;is&nbsp;now&nbsp;on&nbsp;default&nbsp;and&nbsp;should&nbsp;be&nbsp;in&nbsp;the&nbsp;next&nbsp;release,&nbsp;thus&lt;br&gt;if&nbsp;you&nbsp;want&nbsp;to&nbsp;try&nbsp;compiling&nbsp;from&nbsp;default&nbsp;and&nbsp;repeating&nbsp;your&nbsp;test,&nbsp;we'd&lt;br&gt;be&nbsp;interested&nbsp;in&nbsp;knowing&nbsp;whether&nbsp;you&nbsp;see&nbsp;any&nbsp;change.&lt;br&gt;&lt;br&gt;Matthew&lt;br&gt;_______________________________________________&lt;br&gt;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;ymailto=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;br&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;&lt;/html&gt;
</tt>
