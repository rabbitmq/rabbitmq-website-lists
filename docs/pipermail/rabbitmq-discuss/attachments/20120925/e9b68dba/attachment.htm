<tt>
&lt;div&gt;Hi&nbsp;RabbitMQ&nbsp;Team,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;&lt;u&gt;My&nbsp;RabbitMQ&lt;/u&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Version&nbsp;:&nbsp;2.8.6&lt;/div&gt;&lt;div&gt;Cluster&nbsp;Environment&nbsp;:&nbsp;Yes,&nbsp;All&nbsp;Nodes&nbsp;in&nbsp;Disk&nbsp;Mode&lt;/div&gt;&lt;/div&gt;&lt;div&gt;waitForConfirmsOrDie:&nbsp;Yes, 10000&lt;/div&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Recently&nbsp;I&nbsp;found&nbsp;that&nbsp;my&nbsp;program often failed&nbsp;to&nbsp;produce&nbsp;messages&nbsp;to&nbsp;the&nbsp;RabbitMQ&nbsp;server&nbsp;due&nbsp;to&nbsp;following&nbsp;exception:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;u&gt;EXCEPTION&nbsp;LOG&lt;/u&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt;2012-09-24&nbsp;11:53:19,665&nbsp;WARN&nbsp;[INMSG-6]&nbsp;RabbitMQQueueSession&nbsp;-&nbsp;Failed&nbsp;to&nbsp;produce&nbsp;message&nbsp;{&amp;quot;creationDate&amp;quot;:1348458796689,&amp;quot;lastModified&amp;quot;:1348458796689,&amp;quot;queueMessage&amp;quot;:{&amp;quot;id&amp;quot;:44519977,&amp;quot;creationDate&amp;quot;:1348458796688,&amp;quot;shortCode&amp;quot;:28933,&amp;quot;serviceId&amp;quot;:602,&amp;quot;lastModified&amp;quot;:1348458796688,&amp;quot;operatorCode&amp;quot;:13,&amp;quot;mcc&amp;quot;:502,&amp;quot;msgId&amp;quot;:&amp;quot;6e04.7dc9180b350b.00000195&amp;quot;,&amp;quot;class&amp;quot;:&amp;quot;nplay.json.data.SnsInMessageValue&amp;quot;,&amp;quot;scheduledTime&amp;quot;:1348458796688,&amp;quot;dataValue&amp;quot;:{&amp;quot;message&amp;quot;:&amp;quot;@ohhAzirahAzid:&nbsp;start&nbsp;matrik&nbsp;aku&nbsp;suka&nbsp;duduk&nbsp;kat&nbsp;library&amp;quot;,&amp;quot;creationDate&amp;quot;:1348458796688,&amp;quot;shortCode&amp;quot;:28933,&amp;quot;lastModified&amp;quot;:1348458796688,&amp;quot;mcc&amp;quot;:502,&amp;quot;operatorCode&amp;quot;:13,&amp;quot;msisdn&amp;quot;:60134406223,&amp;quot;class&amp;quot;:&amp;quot;nplay.json.data.SmsOutMessageValue&amp;quot;,&amp;quot;scheduledTime&amp;quot;:1348458796688}}}&nbsp;:&nbsp;priority&nbsp;4&nbsp;to&nbsp;QUEUE_SMS_IN_4&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt;com.rabbitmq.client.ShutdownSignalException:&nbsp;clean&nbsp;channel&nbsp;shutdown;&nbsp;reason:&nbsp;#method&amp;lt;channel.close&amp;gt;(reply-code=406,&nbsp;reply-text=TIMEOUT&nbsp;WAITING&nbsp;FOR&nbsp;ACK,&nbsp;class-id=0,&nbsp;method-id=0)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.waitForConfirms(ChannelN.java:182)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.waitForConfirmsOrDie(ChannelN.java:217)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.json.rabbitmq.client.RabbitMQQueueSession.produceTextMessage(RabbitMQQueueSession.java:124)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.common.mq.AQueueClient.produceTextMessage(AQueueClient.java:111)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.json.rabbitmq.client.QueueJsonRabbitMQClient.produceTextMessage(QueueJsonRabbitMQClient.java:289)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.common.mq.AQueueClient.send(AQueueClient.java:185)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.common.mq.AQueueClient.send(AQueueClient.java:275)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.endpoint.json.smpp.SnsInHandler.sendQueueMessage(SnsInHandler.java:21)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.endpoint.json.smpp.SnsInHandler.sendQueueMessage(SnsInHandler.java:11)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.endpoint.json.smpp.AIncomingMessageHandler.update(AIncomingMessageHandler.java:60)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.endpoint.json.AJsonHandler.update(AJsonHandler.java:25)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;java.util.Observable.notifyObservers(Observable.java:142)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.endpoint.common.ASpringEventSource.process(ASpringEventSource.java:202)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.endpoint.common.ASpringEventSource.run(ASpringEventSource.java:157)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;java.lang.Thread.run(Thread.java:619)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;nplay.common.util.ThreadManager$ManagableThread.run(ThreadManager.java:52)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt;Caused&nbsp;by:&nbsp;com.rabbitmq.client.ShutdownSignalException:&nbsp;clean&nbsp;channel&nbsp;shutdown;&nbsp;reason:&nbsp;#method&amp;lt;channel.close&amp;gt;(reply-code=406,&nbsp;reply-text=TIMEOUT&nbsp;WAITING&nbsp;FOR&nbsp;ACK,&nbsp;class-id=0,&nbsp;method-id=0)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:521)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.close(ChannelN.java:480)&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.waitForConfirmsOrDie(ChannelN.java:222)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,153)&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;...&nbsp;14&nbsp;more&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Based&nbsp;on&nbsp;the&nbsp;log,&nbsp;the&nbsp;problem&nbsp;seems&nbsp;like&nbsp;related&nbsp;to&nbsp;&amp;quot;&lt;b&gt;NACKS&nbsp;Received&lt;/b&gt;&amp;quot;&nbsp;and&nbsp;&amp;quot;&lt;b&gt;ChannelN&lt;/b&gt;&amp;quot;&nbsp;code&nbsp;throw&nbsp;the&nbsp;TimeoutException&nbsp;with&nbsp;reply-code&nbsp;&lt;b&gt;406&nbsp;&lt;/b&gt;(PRECONDITION_FAILED). &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;check&nbsp;all&nbsp;RabbitMQ&nbsp;servers&nbsp;are&nbsp;still&nbsp;working&nbsp;fine&nbsp;and&nbsp;I&nbsp;believe&nbsp;the&nbsp;time&nbsp;I&nbsp;set&nbsp;for &lt;b&gt;waitForConfirmsOrDie&nbsp;&lt;/b&gt;(10000)&nbsp;should&nbsp;be&nbsp;sufficient&nbsp;enough.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Can&nbsp;you&nbsp;advise&nbsp;me&nbsp;on&nbsp;the&nbsp;problem?&nbsp;How&nbsp;to&nbsp;solve&nbsp;it?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;&amp;amp;&nbsp;Regards,&lt;/div&gt;&lt;div&gt;Wong&lt;/div&gt;<br>

</tt>
