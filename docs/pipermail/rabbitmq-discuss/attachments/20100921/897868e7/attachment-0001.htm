<tt>
Hi,&lt;br&gt;&lt;br&gt;I&amp;#39;ve&nbsp;ran&nbsp;tcpdump&nbsp;on&nbsp;the&nbsp;consumer&nbsp;machine&nbsp;when&nbsp;the&nbsp;problem&nbsp;is&nbsp;occurring.&nbsp;The&nbsp;Java&nbsp;process&nbsp;running&nbsp;the&nbsp;consumer&nbsp;has&nbsp;definitely&nbsp;gone.&nbsp;list_connections&nbsp;on&nbsp;the&nbsp;broker&nbsp;shows&nbsp;there&nbsp;is&nbsp;still&nbsp;a&nbsp;connection:&lt;br&gt;&lt;br&gt;The&nbsp;output&nbsp;of&nbsp;tcpdump:&lt;br&gt;<br>
&lt;br&gt;11:55:15.277607&nbsp;IP&nbsp;192.168.2.64.59061&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;1777345129:1777345331,&nbsp;ack&nbsp;955208465,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609354052&nbsp;ecr&nbsp;6381321],&nbsp;length&nbsp;202&lt;br&gt;<br>
11:55:30.103223&nbsp;IP&nbsp;192.168.2.64.59048&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;3156241994:3156242015,&nbsp;ack&nbsp;938385998,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609354200&nbsp;ecr&nbsp;6382341],&nbsp;length&nbsp;21&lt;br&gt;<br>
11:56:19.384882&nbsp;IP&nbsp;192.168.2.64.59061&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;0:202,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609354692&nbsp;ecr&nbsp;6381321],&nbsp;length&nbsp;202&lt;br&gt;11:56:34.208833&nbsp;IP&nbsp;192.168.2.64.59048&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;0:21,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609354840&nbsp;ecr&nbsp;6382341],&nbsp;length&nbsp;21&lt;br&gt;<br>
11:57:23.489908&nbsp;IP&nbsp;192.168.2.64.59061&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;0:202,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609355332&nbsp;ecr&nbsp;6381321],&nbsp;length&nbsp;202&lt;br&gt;11:57:38.313950&nbsp;IP&nbsp;192.168.2.64.59048&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;0:21,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609355480&nbsp;ecr&nbsp;6382341],&nbsp;length&nbsp;21&lt;br&gt;<br>
11:58:27.594809&nbsp;IP&nbsp;192.168.2.64.59061&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;0:202,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609355972&nbsp;ecr&nbsp;6381321],&nbsp;length&nbsp;202&lt;br&gt;11:58:42.417220&nbsp;IP&nbsp;192.168.2.64.59048&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;0:21,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609356120&nbsp;ecr&nbsp;6382341],&nbsp;length&nbsp;21&lt;br&gt;<br>
11:59:31.693171&nbsp;IP&nbsp;192.168.2.64.59061&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;0:202,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609356612&nbsp;ecr&nbsp;6381321],&nbsp;length&nbsp;202&lt;br&gt;11:59:46.516762&nbsp;IP&nbsp;192.168.2.64.59048&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;0:21,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609356760&nbsp;ecr&nbsp;6382341],&nbsp;length&nbsp;21&lt;br&gt;<br>
12:00:35.791504&nbsp;IP&nbsp;192.168.2.64.59061&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[R.],&nbsp;seq&nbsp;203,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;length&nbsp;0&lt;br&gt;12:00:50.614290&nbsp;IP&nbsp;192.168.2.64.59048&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[FP.],&nbsp;seq&nbsp;0:21,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;609357400&nbsp;ecr&nbsp;6382341],&nbsp;length&nbsp;21&lt;br&gt;<br>
12:01:54.714736&nbsp;IP&nbsp;192.168.2.64.59048&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[R.],&nbsp;seq&nbsp;22,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;33304,&nbsp;length&nbsp;0&lt;br&gt;12:20:38.475816&nbsp;IP&nbsp;192.168.2.56.51686&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;1037575082:1037575118,&nbsp;ack&nbsp;26733943,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115719776&nbsp;ecr&nbsp;11565352],&nbsp;length&nbsp;36&lt;br&gt;<br>
12:20:38.475824&nbsp;IP&nbsp;192.168.2.56.51686&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;36:252,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115719776&nbsp;ecr&nbsp;11565352],&nbsp;length&nbsp;216&lt;br&gt;12:20:38.476098&nbsp;IP&nbsp;192.168.2.56.51686&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;252:288,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115719776&nbsp;ecr&nbsp;11565352],&nbsp;length&nbsp;36&lt;br&gt;<br>
12:20:38.476112&nbsp;IP&nbsp;192.168.2.56.51686&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;288:543,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115719776&nbsp;ecr&nbsp;11565352],&nbsp;length&nbsp;255&lt;br&gt;12:20:38.494336&nbsp;IP&nbsp;192.168.2.56.51683&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[.],&nbsp;ack&nbsp;14626648,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115719776&nbsp;ecr&nbsp;14886791],&nbsp;length&nbsp;0&lt;br&gt;<br>
12:20:38.494473&nbsp;IP&nbsp;192.168.2.56.51683&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[.],&nbsp;ack&nbsp;332,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115719776&nbsp;ecr&nbsp;14886791],&nbsp;length&nbsp;0&lt;br&gt;12:20:38.597240&nbsp;IP&nbsp;192.168.2.56.51683&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;0:21,&nbsp;ack&nbsp;332,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115719777&nbsp;ecr&nbsp;14886791],&nbsp;length&nbsp;21&lt;br&gt;<br>
12:20:38.665082&nbsp;IP&nbsp;192.168.2.56.51683&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;21:42,&nbsp;ack&nbsp;332,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115719777&nbsp;ecr&nbsp;14886911],&nbsp;length&nbsp;21&lt;br&gt;12:22:11.371665&nbsp;IP&nbsp;192.168.2.56.51686&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;543:579,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115720704&nbsp;ecr&nbsp;14886791],&nbsp;length&nbsp;36&lt;br&gt;<br>
12:22:11.371673&nbsp;IP&nbsp;192.168.2.56.51686&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;579:834,&nbsp;ack&nbsp;1,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115720704&nbsp;ecr&nbsp;14886791],&nbsp;length&nbsp;255&lt;br&gt;12:22:11.388416&nbsp;IP&nbsp;192.168.2.56.51683&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[.],&nbsp;ack&nbsp;663,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115720704&nbsp;ecr&nbsp;14979686],&nbsp;length&nbsp;0&lt;br&gt;<br>
12:22:11.486539&nbsp;IP&nbsp;192.168.2.56.51683&nbsp;&amp;gt;&nbsp;ec2-79-125-24-245.eu-west-1.compute.amazonaws.com.amqp:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;42:63,&nbsp;ack&nbsp;663,&nbsp;win&nbsp;65535,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;115720705&nbsp;ecr&nbsp;14979686],&nbsp;length&nbsp;21&lt;br&gt;&lt;br&gt;The&nbsp;consumer&nbsp;was&nbsp;shutdown&nbsp;at&nbsp;approx&nbsp;11.50.&nbsp;More&nbsp;than&nbsp;an&nbsp;hour&nbsp;later&nbsp;I&nbsp;am&nbsp;still&nbsp;seeing&nbsp;the&nbsp;connection&nbsp;on&nbsp;the&nbsp;broker.&lt;br&gt;<br>
&lt;br&gt;Thanks,&lt;br&gt;Michael&nbsp;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Sep&nbsp;18,&nbsp;2010&nbsp;at&nbsp;11:34&nbsp;PM,&nbsp;Matthew&nbsp;Sackman&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthew@rabbitmq.com&quot;&gt;matthew@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;16,&nbsp;2010&nbsp;at&nbsp;09:01:17AM&nbsp;+0100,&nbsp;Michael&nbsp;Burns&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;ve&nbsp;noticed&nbsp;sometimes&nbsp;that&nbsp;there&nbsp;are&nbsp;extra&nbsp;connections&nbsp;hanging&nbsp;about&nbsp;on&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;RabbitMQ&nbsp;broker&nbsp;(using&nbsp;rabbitmqctl&nbsp; list_connections).&lt;br&gt;<br>
&amp;gt;&nbsp;It&amp;#39;s&nbsp;possible&nbsp;sometimes&nbsp;in&nbsp;our&nbsp;consumers&nbsp;that&nbsp;we&nbsp;are&nbsp;not&nbsp;always&nbsp;closing&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;connection&nbsp;cleanly&nbsp;(sometimes&nbsp;people&nbsp;are&nbsp;simply&nbsp;killing&nbsp;their&nbsp;app&nbsp;rather&lt;br&gt;<br>
&amp;gt;&nbsp;than&nbsp;shutting&nbsp;down&nbsp;cleanly).&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Could&nbsp;this&nbsp;somehow&nbsp;explain&nbsp;why&nbsp;we&nbsp;experience&nbsp;these&nbsp;delays?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Yes.&nbsp;If&nbsp;the&nbsp;TCP&nbsp;socket&nbsp;is&nbsp;still&nbsp;alive&nbsp;then&nbsp;Rabbit&nbsp;will&nbsp;not&nbsp;believe&nbsp;the&lt;br&gt;<br>
connection&nbsp;has&nbsp;died,&nbsp;and&nbsp;so&nbsp;will&nbsp;not&nbsp;make&nbsp;unacknowledged&nbsp;messages&lt;br&gt;<br>
available&nbsp;to&nbsp;other&nbsp;consumers.&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;would&nbsp;seem&nbsp;that&nbsp;this&nbsp;is&nbsp;your&nbsp;problem.&nbsp;To&nbsp;ensure&nbsp;that&nbsp;the&nbsp;connection&lt;br&gt;<br>
is&nbsp;promptly&nbsp;detected&nbsp;to&nbsp;be&nbsp;detached,&nbsp;you&nbsp;could&nbsp;either&nbsp;turn&nbsp;on&nbsp;AMQP&lt;br&gt;<br>
heartbeats&nbsp;or&nbsp;TCP&nbsp;KeepAlive.&nbsp;Either&nbsp;should&nbsp;suffice.&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
Matthew&lt;br&gt;<br>
&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
