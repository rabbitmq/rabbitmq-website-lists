<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;style&gt;Hello,&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;We&nbsp;experience&nbsp;a&nbsp;problem&nbsp;with&nbsp;rabbitMQ&nbsp;connection&nbsp;closed&nbsp;by&nbsp;client&nbsp;by&nbsp;timeout.&nbsp;I&nbsp;cannot&nbsp;find&nbsp;any&nbsp;solution&nbsp;so&nbsp;I&nbsp;would&nbsp;very&nbsp;appreciate&nbsp;any&nbsp;help.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
<br>
Our&nbsp;setup&nbsp;is&nbsp;following:&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;R14B04&nbsp;erlang&nbsp;with&nbsp;hipe&lt;/div&gt;&lt;div&nbsp;style&gt;rabbitmq&nbsp;is&nbsp;hipe&nbsp;compiled&lt;/div&gt;&lt;div&nbsp;style&gt;2&nbsp;RabbitMQ&nbsp;3.0.4&nbsp;(3.0.0&nbsp;earlier&nbsp;with&nbsp;the&nbsp;same&nbsp;problem)&nbsp;clustered&nbsp;nodes&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
<br>
durable&nbsp;queue&nbsp;is&nbsp;mirrored&nbsp;between&nbsp;nodes&lt;/div&gt;&lt;div&nbsp;style&gt;from&nbsp;400&nbsp;to&nbsp;600&nbsp;messages&nbsp;per&nbsp;seconds&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;color:rgb(72,72,72);font-family:Verdana,sans-serif;font-size:12px;line-height:17px&quot;&gt;rabbitmq-c&nbsp;clients&nbsp;with&nbsp;200&nbsp;ms&nbsp;timeout&lt;/span&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;color:rgb(72,72,72);font-family:Verdana,sans-serif;font-size:12px;line-height:17px&quot;&gt;clients&nbsp;use&nbsp;non&nbsp;persistent&nbsp;connections&nbsp;(&nbsp;sender&nbsp;opens&nbsp;connection,&nbsp;publish&nbsp;message,&nbsp;closes&nbsp;connection.&nbsp;consumer&nbsp;opens&nbsp;connection,&nbsp;gets&nbsp;N&nbsp;messages,&nbsp;closes&nbsp;connection,&nbsp;restarts&nbsp;)&lt;/span&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;color:rgb(72,72,72);font-family:Verdana,sans-serif;font-size:12px;line-height:17px&quot;&gt;tcp_listener&nbsp;keepalive&nbsp;is&nbsp;enabled&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;color:rgb(72,72,72);font-family:Verdana,sans-serif;font-size:12px;line-height:17px&quot;&gt;&lt;br&gt;<br>
<br>
&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;color:rgb(72,72,72);font-family:Verdana,sans-serif;font-size:12px;line-height:17px&quot;&gt;Initially&nbsp;everything&nbsp;goes&nbsp;fine.&nbsp;But&nbsp;some&nbsp;connection&nbsp;are&nbsp;closed&nbsp;by&nbsp;client&nbsp;by&nbsp;timeout.&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
<br>
&lt;span&nbsp;style=&quot;color:rgb(72,72,72);font-family:Verdana,sans-serif;font-size:12px;line-height:17px&quot;&gt;It&nbsp;seems&nbsp;to&nbsp;me&nbsp;that&nbsp;these&nbsp;connection&nbsp;are&nbsp;not&nbsp;closed&nbsp;inside&nbsp;of&nbsp;RabbitMQ&nbsp;so&nbsp;connection&nbsp;time&nbsp;steadily&nbsp;grows&nbsp;and&nbsp;after&nbsp;approx&nbsp;1&nbsp;day&nbsp;cluster&nbsp;average&nbsp;connect&nbsp;time&nbsp;become&nbsp;above&nbsp;200&nbsp;ms.&lt;/span&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;color:rgb(72,72,72);font-family:Verdana,sans-serif;font-size:12px;line-height:17px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;font&nbsp;color=&quot;#484848&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px;line-height:17px&quot;&gt;rabbitmqctl&nbsp;stop_app&nbsp;&amp;amp;&amp;amp;&nbsp;rabbitmqctl&nbsp;start_app&nbsp;resolves&nbsp;problem&nbsp;for&nbsp;one&nbsp;more&nbsp;day.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;&lt;font&nbsp;color=&quot;#484848&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px;line-height:17px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;font&nbsp;color=&quot;#484848&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px;line-height:17px&quot;&gt;tcpdump&nbsp;shows&nbsp;that&nbsp;client&nbsp;connection&nbsp;timeout&nbsp;occures&nbsp;before&nbsp;server&nbsp;sends&nbsp;capabilities&nbsp;package.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;&lt;font&nbsp;color=&quot;#484848&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px;line-height:17px&quot;&gt;after&nbsp;10&nbsp;seconds&nbsp;in&nbsp;rabbit&nbsp;error&nbsp;log&nbsp;appears&nbsp;handshake_timeout&nbsp;exception.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;font&nbsp;color=&quot;#484848&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px;line-height:17px&quot;&gt;&lt;br&gt;<br>
<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;font&nbsp;color=&quot;#484848&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px;line-height:17px&quot;&gt;Initially&nbsp;(netstat&nbsp;-nt&nbsp;|&nbsp;wc&nbsp;-l)&nbsp;and&nbsp;(rabbitmqctl&nbsp;list_connections&nbsp;|&nbsp;wc&nbsp;-l&lt;/span&gt;&lt;/font&gt;&lt;span&nbsp;style=&quot;font-size:12px;line-height:17px;color:rgb(72,72,72);font-family:Verdana,sans-serif&quot;&gt;)&nbsp;shows&nbsp;very&nbsp;close&nbsp;counts&lt;/span&gt;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;font-size:12px;line-height:17px;color:rgb(72,72,72);font-family:Verdana,sans-serif&quot;&gt;When&nbsp;everything&nbsp;goes&nbsp;bad &lt;/span&gt;&lt;font&nbsp;color=&quot;#484848&quot;&nbsp;face=&quot;Verdana,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px;line-height:17px&quot;&gt; (rabbitmqctl&nbsp;list_connections&nbsp;|&nbsp;wc&nbsp;-l&lt;/span&gt;&lt;/font&gt;&lt;span&nbsp;style=&quot;font-size:12px;line-height:17px;color:rgb(72,72,72);font-family:Verdana,sans-serif&quot;&gt;)&nbsp;twice&nbsp;as&nbsp;much&nbsp;connections&nbsp;than &lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(72,72,72);font-family:Verdana,sans-serif;font-size:12px;line-height:17px&quot;&gt;(netstat&nbsp;-nt&nbsp;|&nbsp;wc&nbsp;-l)&lt;/span&gt;&lt;/div&gt;<br>
<br>
&lt;/div&gt;<br>

</tt>
