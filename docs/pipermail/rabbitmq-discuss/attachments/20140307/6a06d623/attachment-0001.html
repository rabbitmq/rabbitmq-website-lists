<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;As&nbsp;I&nbsp;recall,&nbsp;the&nbsp;memory&nbsp;limit&nbsp;doesn&#39;t&nbsp;prevent&nbsp;rabbit&nbsp;from&nbsp;using&nbsp;more&nbsp;memory,&nbsp;it&#39;s&nbsp;the&nbsp;point&nbsp;at&nbsp;which&nbsp;it&nbsp;stops&nbsp;accepting&nbsp;new&nbsp;connections.&nbsp; It&nbsp;would&nbsp;still&nbsp;allow&nbsp;existing&nbsp;connections&nbsp;to&nbsp;flood&nbsp;the&nbsp;system:&lt;div&gt;<br>
&lt;h2&nbsp;class=&quot;&quot;&nbsp;style=&quot;font-family:Helvetica,Arial,sans-serif;margin:20px&nbsp;0px&nbsp;0.5em;padding:0px;color:rgb(255,102,0);font-size:1.7em;line-height:18px&quot;&gt;Memory-Based&nbsp;Flow&nbsp;Control&lt;/h2&gt;&lt;p&nbsp;style=&quot;clear:left;color:rgb(85,85,85);font-family:Verdana,sans-serif;font-size:13px;line-height:18px&quot;&gt;<br>
The&nbsp;RabbitMQ&nbsp;server&nbsp;detects&nbsp;the&nbsp;total&nbsp;amount&nbsp;of&nbsp;RAM&nbsp;installed&nbsp;in&nbsp;the&nbsp;computer&nbsp;on&nbsp;startup&nbsp;and&nbsp;when &lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;color:rgb(51,51,51);font-family:&#39;Courier&nbsp;New&#39;,Courier,monospace;font-size:small;white-space:nowrap&quot;&gt;rabbitmqctl&nbsp;set_vm_memory_high_watermark &lt;em&gt;fraction&lt;/em&gt;&lt;/span&gt; is&nbsp;executed.&nbsp;By&nbsp;default,&nbsp;when&nbsp;the&nbsp;RabbitMQ&nbsp;server&nbsp;uses&nbsp;above&nbsp;40%&nbsp;of&nbsp;the&nbsp;installed&nbsp;RAM,&nbsp;it&nbsp;raises&nbsp;a&nbsp;memory&nbsp;alarm&nbsp;and&nbsp;&lt;b&gt;&lt;u&gt;blocks&nbsp;all&nbsp;connections.&nbsp;&lt;/u&gt;&lt;/b&gt;Once&nbsp;the&nbsp;memory&nbsp;alarm&nbsp;has&nbsp;cleared&nbsp;(e.g.&nbsp;due&nbsp;to&nbsp;the&nbsp;server&nbsp;paging&nbsp;messages&nbsp;to&nbsp;disk&nbsp;or&nbsp;delivering&nbsp;them&nbsp;to&nbsp;clients)&nbsp;normal&nbsp;service&nbsp;resumes.&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;clear:left;color:rgb(85,85,85);font-family:Verdana,sans-serif;font-size:13px;line-height:18px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;clear:left;color:rgb(85,85,85);font-family:Verdana,sans-serif;font-size:13px;line-height:18px&quot;&gt;No&nbsp;clue&nbsp;about&nbsp;the&nbsp;plugins&nbsp;memory.&lt;/p&gt;<br>
&lt;div&gt;Jason&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Mar&nbsp;7,&nbsp;2014&nbsp;at&nbsp;11:16&nbsp;AM,&nbsp;Dmitry&nbsp;Andrianov&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:dmitry.andrianov@alertme.com&quot;&nbsp;target=&quot;_blank&quot;&gt;dmitry.andrianov@alertme.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hello.&lt;br&gt;<br>
We&nbsp;are&nbsp;trying&nbsp;to&nbsp;load-test&nbsp;RabbitMQ&nbsp;server&nbsp;in&nbsp;different&nbsp;configurations&nbsp;on&nbsp;Amazon&nbsp;EC2&nbsp;node.&lt;br&gt;<br>
Most&nbsp;of&nbsp;our&nbsp;tests&nbsp;end&nbsp;with&nbsp;Linux&nbsp;OOM&nbsp;killer&nbsp;intervening&nbsp;and&nbsp;killing&nbsp;Rabbit.&lt;br&gt;<br>
That&nbsp;is&nbsp;something&nbsp;I&nbsp;cannot&nbsp;really&nbsp;understand&nbsp;especially&nbsp;given&nbsp;that&nbsp;it&nbsp;is&nbsp;reproducible&nbsp;even&nbsp;with&nbsp;vm_memory_high_watermark&nbsp;set&nbsp;to&nbsp;0.2&nbsp;and&nbsp;no&nbsp;other&nbsp;processes&nbsp;running&nbsp;on&nbsp;that&nbsp;box.&lt;br&gt;<br>
So&nbsp;if&nbsp;someone&nbsp;could&nbsp;shed&nbsp;some&nbsp;light&nbsp;onto&nbsp;that&nbsp;issue&nbsp;it&nbsp;would&nbsp;help&nbsp;a&nbsp;lot.&lt;br&gt;<br>
&lt;br&gt;<br>
Below&nbsp;the&nbsp;status&nbsp;response&nbsp;not&nbsp;long&nbsp;before&nbsp;the&nbsp;process&nbsp;was&nbsp;killed:&lt;br&gt;<br>
&lt;br&gt;<br>
 {os,{unix,linux}},&lt;br&gt;<br>
 {erlang_version,&lt;br&gt;<br>
 &nbsp; &nbsp; &quot;Erlang&nbsp;R15B01&nbsp;(erts-5.9.1)&nbsp;[source]&nbsp;[64-bit]&nbsp;[async-threads:30]&nbsp;[kernel-poll:true]\n&quot;},&lt;br&gt;<br>
 {memory,&lt;br&gt;<br>
 &nbsp; &nbsp; [{total,1984625336},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{connection_procs,1235761240},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{queue_procs,142935728},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{plugins,-44730984},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{other_proc,34065132},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{mnesia,32001976},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{mgmt_db,233149752},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{msg_index,13545296},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{other_ets,49861192},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{binary,148478688},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{code,20404184},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{atom,793505},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{other_system,118359627}]},&lt;br&gt;<br>
 {vm_memory_high_watermark,0.2}&lt;u&gt;&lt;/u&gt;,&lt;br&gt;<br>
 {vm_memory_limit,804643635},&lt;br&gt;<br>
 {disk_free_limit,50000000},&lt;br&gt;<br>
 {disk_free,1843380224},&lt;br&gt;<br>
 {file_descriptors,&lt;br&gt;<br>
 &nbsp; &nbsp; [{total_limit,64900},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{total_used,11681},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{sockets_limit,58408},&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{sockets_used,11677}]},&lt;br&gt;<br>
 {processes,[{limit,1048576},{&lt;u&gt;&lt;/u&gt;used,198557}]},&lt;br&gt;<br>
 {run_queue,6},&lt;br&gt;<br>
 {uptime,575}]&lt;br&gt;<br>
&lt;br&gt;<br>
Couple&nbsp;of&nbsp;strange&nbsp;things&nbsp;there&nbsp;are:&lt;br&gt;<br>
&lt;br&gt;<br>
1.&nbsp;{vm_memory_limit,804643635}&nbsp;but&nbsp;still&nbsp;memory&nbsp;{total,1984625336}.&nbsp;How&nbsp;is&nbsp;that&nbsp;possible?&nbsp;&lt;a&nbsp;href=&quot;https://www.rabbitmq.com/memory.html&quot;&nbsp;target=&quot;_blank&quot;&gt;https://www.rabbitmq.com/&lt;u&gt;&lt;/u&gt;memory.html&lt;/a&gt;&nbsp;says&nbsp;that&nbsp;erlang&nbsp;process&nbsp;can&nbsp;take&nbsp;twice&nbsp;the&nbsp;configured&nbsp;size&nbsp;so&nbsp;I&nbsp;expected&nbsp;that&nbsp;but&nbsp;it&nbsp;is&nbsp;definitely&nbsp;more&nbsp;than&nbsp;twice.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
2.&nbsp;{plugins,-44730984}&nbsp;-&nbsp;how&nbsp;this&nbsp;one&nbsp;is&nbsp;possible?&lt;br&gt;<br>
&lt;br&gt;<br>
And&nbsp;just&nbsp;in&nbsp;cast&nbsp;it&nbsp;is&nbsp;needed,&nbsp;below&nbsp;is&nbsp;/proc/X/status&lt;br&gt;<br>
&lt;br&gt;<br>
VmPeak:&nbsp; &nbsp; &nbsp;2267580&nbsp;kB&lt;br&gt;<br>
VmSize:&nbsp; &nbsp; &nbsp;2110952&nbsp;kB&lt;br&gt;<br>
VmLck:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;kB&lt;br&gt;<br>
VmHWM:&nbsp; &nbsp; &nbsp;2096276&nbsp;kB&lt;br&gt;<br>
VmRSS:&nbsp; &nbsp; &nbsp;2020848&nbsp;kB&lt;br&gt;<br>
VmData:&nbsp; &nbsp; &nbsp;2075168&nbsp;kB&lt;br&gt;<br>
VmStk:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 88&nbsp;kB&lt;br&gt;<br>
VmExe:&nbsp; &nbsp; &nbsp; &nbsp; 1604&nbsp;kB&lt;br&gt;<br>
VmLib:&nbsp; &nbsp; &nbsp; &nbsp; 4848&nbsp;kB&lt;br&gt;<br>
VmPTE:&nbsp; &nbsp; &nbsp; &nbsp; 4304&nbsp;kB&lt;br&gt;<br>
Threads:&nbsp; &nbsp; 31&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;in&nbsp;advance!&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;email&nbsp;is&nbsp;for&nbsp;the&nbsp;use&nbsp;of&nbsp;the&nbsp;intended&nbsp;recipient(s)&nbsp;only.&lt;br&gt;<br>
If&nbsp;you&nbsp;have&nbsp;received&nbsp;this&nbsp;email&nbsp;in&nbsp;error,&nbsp;please&nbsp;notify&nbsp;the&nbsp;sender&nbsp;immediately&nbsp;and&nbsp;then&nbsp;delete&nbsp;it.&lt;br&gt;<br>
If&nbsp;you&nbsp;are&nbsp;not&nbsp;the&nbsp;intended&nbsp;recipient,&nbsp;you&nbsp;must&nbsp;not&nbsp;use,&nbsp;disclose&nbsp;or&nbsp;distribute&nbsp;this&nbsp;email&nbsp;without&nbsp;the&lt;br&gt;<br>
author&#39;s&nbsp;prior&nbsp;permission.&nbsp;AlertMe.com&nbsp;Ltd.&nbsp;is&nbsp;not&nbsp;responsible&nbsp;for&nbsp;any&nbsp;personal&nbsp;views&nbsp;expressed&lt;br&gt;<br>
in&nbsp;this&nbsp;message&nbsp;or&nbsp;any&nbsp;attachments&nbsp;that&nbsp;are&nbsp;those&nbsp;of&nbsp;the&nbsp;individual&nbsp;sender.&lt;br&gt;<br>
&lt;br&gt;<br>
AlertMe.com&nbsp;Ltd,&nbsp;30&nbsp;Station&nbsp;Road,&nbsp;Cambridge,&nbsp;CB1&nbsp;2RE,&nbsp;UK.&lt;br&gt;<br>
Registered&nbsp;in&nbsp;England,&nbsp;Company&nbsp;number&nbsp;578&nbsp;2908,&nbsp;VAT&nbsp;registration&nbsp;number&nbsp;GB&nbsp;895&nbsp;9914&nbsp;42.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.&lt;u&gt;&lt;/u&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;u&gt;&lt;/u&gt;cgi-bin/mailman/listinfo/&lt;u&gt;&lt;/u&gt;rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Jason&nbsp;McIntosh&lt;br&gt;&lt;a&nbsp;href=&quot;https://github.com/jasonmcintosh/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/jasonmcintosh/&lt;/a&gt;&lt;br&gt;573-424-7612&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
