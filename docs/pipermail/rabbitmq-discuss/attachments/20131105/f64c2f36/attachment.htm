<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;(sorry&nbsp;if&nbsp;this&nbsp;gets&nbsp;posted&nbsp;twice..&nbsp;first&nbsp;email&nbsp;never&nbsp;seemed&nbsp;to&nbsp;make&nbsp;it&nbsp;to&nbsp;the&nbsp;list)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Hey...&nbsp;I&nbsp;had&nbsp;a&nbsp;pretty&nbsp;rough&nbsp;time&nbsp;today&nbsp;with&nbsp;a&nbsp;3-node&nbsp;RabbitMQ&nbsp;3.1.3&nbsp;cluster&nbsp;thats&nbsp;under&nbsp;pretty&nbsp;heavy&nbsp;use&nbsp;(6-7&nbsp;million&nbsp;messages&nbsp;per&nbsp;day&nbsp;--&nbsp;100MB&nbsp;peak&nbsp;bandwidth&nbsp;per&nbsp;node).&nbsp;I&nbsp;want&nbsp;to&nbsp;pose&nbsp;a&nbsp;few&nbsp;questions&nbsp;here.&nbsp;First&nbsp;off,&nbsp;here&amp;#39;s&nbsp;the&nbsp;basic&nbsp;configuration&nbsp;though.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Configuration:&lt;/div&gt;&lt;div&gt; &nbsp;serverA,&nbsp;serverB&nbsp;and&nbsp;serverC&nbsp;are&nbsp;all&nbsp;configured&nbsp;with&nbsp;RabbitMQ&nbsp;3.1.3.&nbsp;They&nbsp;each&nbsp;are&nbsp;configured&nbsp;via&nbsp;Puppet&nbsp;...&nbsp;and&nbsp;Puppet&nbsp;uses&nbsp;a&nbsp;dynamic&nbsp;node&nbsp;discovery&nbsp;plugin&nbsp;(zookeeper)&nbsp;to&nbsp;find&nbsp;the&nbsp;nodes.&nbsp;The&nbsp;node&nbsp;lists&nbsp;are&nbsp;hard-coded&nbsp;into&nbsp;the&nbsp;rabbitmq.config&nbsp;file.&nbsp;A&nbsp;dynamic&nbsp;server&nbsp;list&nbsp;generator&nbsp;supplies&nbsp;Puppet&nbsp;with&nbsp;this&nbsp;list&nbsp;of&nbsp;servers&nbsp;(and&nbsp;is&nbsp;not&nbsp;really&nbsp;necessary&nbsp;to&nbsp;describe&nbsp;here&nbsp;in&nbsp;this&nbsp;email).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Scenario:&lt;/div&gt;&lt;div&gt; &nbsp;A&nbsp;momentary&nbsp;configuration&nbsp;blip&nbsp;caused&nbsp;serverA&nbsp;and&nbsp;serverB&nbsp;to&nbsp;begin&nbsp;reconfiguring&nbsp;their&nbsp;rabbitmq.config&nbsp;files...&nbsp;when&nbsp;they&nbsp;did&nbsp;this,&nbsp;they&nbsp;also&nbsp;both&nbsp;issued&nbsp;a&nbsp;&amp;#39;service&nbsp;rabbitmq&nbsp;restart&amp;#39;&nbsp;command.&nbsp;This&nbsp;command&nbsp;took&nbsp;40+minutes&nbsp;and&nbsp;ultimately&nbsp;failed.&nbsp;During&nbsp;this&nbsp;failure,&nbsp;RabbitMQ&nbsp;was&nbsp;technically&nbsp;running&nbsp;and&nbsp;accepting&nbsp;connections&nbsp;to&nbsp;the&nbsp;TCP&nbsp;ports&nbsp;...&nbsp;but&nbsp;it&nbsp;would&nbsp;not&nbsp;actually&nbsp;answer&nbsp;any&nbsp;queries.&nbsp;Commands&nbsp;like&nbsp;list_queues&nbsp;would&nbsp;hang&nbsp;indefinitely.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Questions:&lt;/div&gt;&lt;div&gt; &nbsp;1.&nbsp;We&nbsp;only&nbsp;had&nbsp;~2500&nbsp;messages&nbsp;in&nbsp;the&nbsp;queues&nbsp;(they&nbsp;are&nbsp;HA&amp;#39;d&nbsp;and&nbsp;durable).&nbsp;The&nbsp;policy&nbsp;is&nbsp;{&nbsp;&amp;#39;ha-mode&amp;#39;:&nbsp;&amp;#39;all&amp;#39;&nbsp;}.&nbsp;When&nbsp;serverA&nbsp;and&nbsp;serverB&nbsp;restarted,&nbsp;why&nbsp;did&nbsp;they&nbsp;never&nbsp;come&nbsp;up?&nbsp;Unfortunately&nbsp;in&nbsp;the&nbsp;restart&nbsp;process,&nbsp;they&nbsp;blew&nbsp;away&nbsp;their&nbsp;log&nbsp;files&nbsp;as&nbsp;well&nbsp;which&nbsp;makes&nbsp;this&nbsp;really&nbsp;tough&nbsp;to&nbsp;troubleshoot.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;2.&nbsp;I&nbsp;know&nbsp;that&nbsp;restarting&nbsp;serverA&nbsp;and&nbsp;serverB&nbsp;at&nbsp;nearly&nbsp;the&nbsp;same&nbsp;time&nbsp;is&nbsp;obviously&nbsp;a&nbsp;bad&nbsp;idea&nbsp;--&nbsp;we&amp;#39;ll&nbsp;be&nbsp;implementing&nbsp;some&nbsp;changes&nbsp;so&nbsp;this&nbsp;doesn&amp;#39;t&nbsp;happen&nbsp;again&nbsp;--&nbsp;but&nbsp;could&nbsp;this&nbsp;have&nbsp;lead&nbsp;to&nbsp;data&nbsp;corruption?&nbsp;Once&nbsp;the&nbsp;entire&nbsp;RabbitMQ&nbsp;farm&nbsp;was&nbsp;shut&nbsp;down,&nbsp;we&nbsp;actually&nbsp;were&nbsp;forced&nbsp;to&nbsp;move&nbsp;the&nbsp;rabbitmq&nbsp;data&nbsp;directory&nbsp;out&nbsp;of&nbsp;the&nbsp;way&nbsp;and&nbsp;start&nbsp;up&nbsp;the&nbsp;farm&nbsp;completely&nbsp;with&nbsp;blank&nbsp;databases.&nbsp;It&nbsp;seemed&nbsp;that&nbsp;RabbitMQ&nbsp;3.1.3&nbsp;really&nbsp;did&nbsp;not&nbsp;want&nbsp;to&nbsp;recover&nbsp;from&nbsp;this&nbsp;failure.&nbsp;Any&nbsp;thoughts?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;3.&nbsp;Lastly&nbsp;..&nbsp;in&nbsp;the&nbsp;event&nbsp;of&nbsp;future&nbsp;failures,&nbsp;what&nbsp;tools&nbsp;are&nbsp;there&nbsp;for&nbsp;recovering&nbsp;our&nbsp;Mnesia&nbsp;databases?&nbsp;Is&nbsp;there&nbsp;any&nbsp;way&nbsp;we&nbsp;can&nbsp;dump&nbsp;out&nbsp;the&nbsp;data&nbsp;into&nbsp;some&nbsp;raw&nbsp;form,&nbsp;and&nbsp;then&nbsp;import&nbsp;it&nbsp;back&nbsp;into&nbsp;a&nbsp;new&nbsp;fresh&nbsp;cluster?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Matt&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
