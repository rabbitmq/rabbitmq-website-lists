<tt>
Hi,&nbsp;thanks&nbsp;for&nbsp;the&nbsp;response. &nbsp;Unfortunately,&nbsp;I&nbsp;haven&amp;#39;t&nbsp;really&nbsp;found&nbsp;an&nbsp;answer.&lt;br&gt;&lt;br&gt;We&nbsp;upgraded&nbsp;RabbitMQ&nbsp;to&nbsp;2.4.1,&nbsp;after&nbsp;which&nbsp;Net::RabbitMQ&nbsp;no&nbsp;longer&nbsp;hangs&nbsp;when&nbsp;the&nbsp;remote&nbsp;server&nbsp;is&nbsp;up&nbsp;but&nbsp;the&nbsp;remote&nbsp;app&nbsp;is&nbsp;down.&lt;br&gt;<br>
&lt;br&gt;However,&nbsp;Net::RabbitMQ&nbsp;still&nbsp;returns&nbsp;a&nbsp;false&nbsp;success&nbsp;when&nbsp;the&nbsp;remote&nbsp;server&nbsp;or&nbsp;app&nbsp;goes&nbsp;down&nbsp;after&nbsp;the&nbsp;publisher&nbsp;connects&nbsp;to&nbsp;the&nbsp;local&nbsp;node. &nbsp;(The&nbsp;queue&nbsp;is&nbsp;located&nbsp;on&nbsp;the&nbsp;remote&nbsp;app.)&lt;br&gt;&lt;br&gt;For&nbsp;now,&nbsp;we&amp;#39;ve&nbsp;switched&nbsp;to&nbsp;having&nbsp;a&nbsp;single&nbsp;node. &nbsp;This&nbsp;decreases&nbsp;our&nbsp;throughput&nbsp;slightly,&nbsp;but&nbsp;at&nbsp;least&nbsp;we&nbsp;don&amp;#39;t&nbsp;risk&nbsp;dropping&nbsp;messages.&lt;br&gt;<br>
&lt;br&gt;I&nbsp;think&nbsp;we&nbsp;must&nbsp;be&nbsp;doing&nbsp;something&nbsp;wrong,&nbsp;but&nbsp;I&nbsp;don&amp;#39;t&nbsp;know&nbsp;what...&lt;br&gt;&lt;br&gt;Ronald&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;May&nbsp;31,&nbsp;2011&nbsp;at&nbsp;7:41&nbsp;AM,&nbsp;Alexis&nbsp;Richardson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:alexis@rabbitmq.com&quot;&gt;alexis@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Ronald&lt;br&gt;<br>
&lt;br&gt;<br>
Were&nbsp;you&nbsp;able&nbsp;to&nbsp;find&nbsp;an&nbsp;answer&nbsp;to&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
alexis&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Thu,&nbsp;May&nbsp;19,&nbsp;2011&nbsp;at&nbsp;9:44&nbsp;PM,&nbsp;Ronald&nbsp;J&nbsp;Kimball&lt;br&gt;<br>
&amp;lt;&lt;a&nbsp;href=&quot;mailto:rkimball@pangeamedia.com&quot;&gt;rkimball@pangeamedia.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;m&nbsp;trying&nbsp;to&nbsp;understand&nbsp;how&nbsp;RabbitMQ&nbsp;behaves&nbsp;under&nbsp;failure&nbsp;conditions,&lt;br&gt;<br>
&amp;gt;&nbsp;specifically&nbsp;when&nbsp;using&nbsp;the&nbsp;Net::RabbitMQ&nbsp;Perl&nbsp;module.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;We&nbsp;have&nbsp;RabbitMQ&nbsp;set&nbsp;up&nbsp;with&nbsp;three&nbsp;nodes,&nbsp;one&nbsp;on&nbsp;the&nbsp;backend,&nbsp;which&nbsp;holds&lt;br&gt;<br>
&amp;gt;&nbsp;the&nbsp;actual&nbsp;queues,&nbsp;and&nbsp;two&nbsp;on&nbsp;the&nbsp;frontend,&nbsp;which&nbsp;receive&nbsp;publish&nbsp;requests.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;RabbitMQ&nbsp;2.2.0&lt;br&gt;<br>
&amp;gt;&nbsp;Net::RabbitMQ&nbsp;0.1.8&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Below&nbsp;is&nbsp;the&nbsp;chart&nbsp;of&nbsp;behaviors&nbsp;that&nbsp;I&nbsp;have&nbsp;observed.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;quot;+&amp;quot;&nbsp;means&nbsp;the&nbsp;behavior&nbsp;is&nbsp;as&nbsp;I&nbsp;expected:&nbsp;either&nbsp;the&nbsp;message&nbsp;is&nbsp;successfully&lt;br&gt;<br>
&amp;gt;&nbsp;queued,&nbsp;or&nbsp;an&nbsp;error&nbsp;is&nbsp;thrown.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;quot;-&amp;quot;&nbsp;means&nbsp;the&nbsp;behavior&nbsp;is&nbsp;not&nbsp;as&nbsp;I&nbsp;expected,&nbsp;but&nbsp;can&nbsp;be&nbsp;managed:&lt;br&gt;<br>
&amp;gt;&nbsp;specifically,&nbsp;the&nbsp;process&nbsp;receives&nbsp;a&nbsp;SIGPIPE,&nbsp;which&nbsp;I&nbsp;can&nbsp;trap&nbsp;and&nbsp;recover&lt;br&gt;<br>
&amp;gt;&nbsp;from.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;quot;!&amp;quot;&nbsp;means&nbsp;the&nbsp;behavior&nbsp;is&nbsp;not&nbsp;as&nbsp;I&nbsp;expected,&nbsp;and&nbsp;cannot&nbsp;be&nbsp;managed:&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;message&nbsp;is&nbsp;not&nbsp;queued&nbsp;but&nbsp;no&nbsp;error&nbsp;is&nbsp;thrown&nbsp;and/or&nbsp;the&nbsp;process&nbsp;hangs.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;quot;App&nbsp;down&amp;quot;&nbsp;means&nbsp;I&nbsp;ran&nbsp;`rabbitmqctl&nbsp;stop_app`. &nbsp;&amp;quot;Daemon&nbsp;down&amp;quot;&nbsp;means&nbsp;I&nbsp;ran&lt;br&gt;<br>
&amp;gt;&nbsp;`rabbitmqctl&nbsp;stop`.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp;As&nbsp;publishing&nbsp;process&nbsp;starts&nbsp;up:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Remote&nbsp;daemon&nbsp;up,&nbsp;app&nbsp;up&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;+&nbsp;Everything&nbsp;okay&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Remote&nbsp;daemon&nbsp;up,&nbsp;app&nbsp;down&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;!&nbsp;Net::RabbitMQ&nbsp;hangs&nbsp;when&nbsp;declaring&nbsp;queue&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Remote&nbsp;daemon&nbsp;down&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;+&nbsp;Net::RabbitMQ&nbsp;throws&nbsp;error&nbsp;when&nbsp;declaring&nbsp;queue&lt;br&gt;<br>
&amp;gt;&nbsp;       &nbsp;&amp;quot;Declaring&nbsp;queue:&nbsp;server&nbsp;channel&nbsp;error&nbsp;404,&nbsp;message:&nbsp;NOT_FOUND&nbsp;-&nbsp;no&lt;br&gt;<br>
&amp;gt;&nbsp;queue&nbsp;&amp;#39;test&amp;#39;&nbsp;in&nbsp;vhost&nbsp;&amp;#39;/&amp;#39;&amp;quot;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Local&nbsp;daemon&nbsp;up,&nbsp;app&nbsp;down&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;+&nbsp;Net::RabbitMQ&nbsp;throws&nbsp;error&nbsp;when&nbsp;connecting&lt;br&gt;<br>
&amp;gt;&nbsp;       &nbsp;&amp;quot;Opening&nbsp;socket:&nbsp;Connection&nbsp;refused&amp;quot;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Local&nbsp;daemon&nbsp;down&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;+&nbsp;Net::RabbitMQ&nbsp;throws&nbsp;error&nbsp;when&nbsp;connecting&lt;br&gt;<br>
&amp;gt;&nbsp;       &nbsp;&amp;quot;Opening&nbsp;socket:&nbsp;Connection&nbsp;refused&amp;quot;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp;After&nbsp;publishing&nbsp;process&nbsp;starts&nbsp;up:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Local&nbsp;app&nbsp;goes&nbsp;down&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;-&nbsp;Process&nbsp;receives&nbsp;SIGPIPE&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Local&nbsp;daemon&nbsp;goes&nbsp;down&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;-&nbsp;Process&nbsp;receives&nbsp;SIGPIPE&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Remote&nbsp;app&nbsp;goes&nbsp;down&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;!&nbsp;Net::RabbitMQ&nbsp;falsely&nbsp;indicates&nbsp;success&nbsp;when&nbsp;publishing,&nbsp;then&nbsp;hangs&lt;br&gt;<br>
&amp;gt;&nbsp;(in&nbsp;DESTROY?)&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Remote&nbsp;daemon&nbsp;goes&nbsp;down&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;!&nbsp;Net::RabbitMQ&nbsp;falsely&nbsp;indicates&nbsp;success&nbsp;when&nbsp;publishing&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Local&nbsp;app&nbsp;goes&nbsp;down,&nbsp;comes&nbsp;back&nbsp;up&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;-&nbsp;Process&nbsp;receives&nbsp;SIGPIPE&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Local&nbsp;daemon&nbsp;goes&nbsp;down,&nbsp;comes&nbsp;back&nbsp;up&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;-&nbsp;Process&nbsp;receives&nbsp;SIGPIPE&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Remote&nbsp;app&nbsp;goes&nbsp;down,&nbsp;comes&nbsp;back&nbsp;up&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;+&nbsp;Everything&nbsp;okay&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;   &nbsp;Remote&nbsp;daemon&nbsp;goes&nbsp;down,&nbsp;comes&nbsp;back&nbsp;up&lt;br&gt;<br>
&amp;gt;&nbsp;     &nbsp;+&nbsp;Everything&nbsp;okay&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Have&nbsp;other&nbsp;people&nbsp;had&nbsp;these&nbsp;problems&nbsp;with&nbsp;Net::RabbitMQ? &nbsp;Can&nbsp;we&nbsp;resolve&lt;br&gt;<br>
&amp;gt;&nbsp;these&nbsp;issues&nbsp;by&nbsp;changing&nbsp;something&nbsp;in&nbsp;our&nbsp;RabbitMQ&nbsp;configuration?&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;thanks,&lt;br&gt;<br>
&amp;gt;&nbsp;Ronald&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;P.S.&nbsp;Here&amp;#39;s&nbsp;my&nbsp;script.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;#!/usr/local/bin/perl&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;use&nbsp;strict;&lt;br&gt;<br>
&amp;gt;&nbsp;use&nbsp;warnings;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;use&nbsp;Net::RabbitMQ;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;$|&nbsp;=&nbsp;1;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;$SIG{&amp;#39;PIPE&amp;#39;}&nbsp;=&nbsp;sub&nbsp;{&nbsp;die&nbsp;&amp;quot;SIGPIPE\n&amp;quot;&nbsp;};&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;my&nbsp;$mq&nbsp;=&nbsp;Net::RabbitMQ-&amp;gt;new();&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;alarm(10);&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;print&nbsp;&amp;quot;Connecting\n&amp;quot;;&lt;br&gt;<br>
&amp;gt;&nbsp;$mq-&amp;gt;connect(&amp;#39;localhost&amp;#39;,&nbsp;{&nbsp;user&nbsp;=&amp;gt;&nbsp;&amp;#39;engagement&amp;#39;,&nbsp;password&nbsp;=&amp;gt;&nbsp;&amp;#39;********&amp;#39;&nbsp;})&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp;or&nbsp;die&nbsp;&amp;quot;Can&amp;#39;t&nbsp;connect&nbsp;to&nbsp;RabbitMQ\n&amp;quot;;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;print&nbsp;&amp;quot;Opening&nbsp;channel\n&amp;quot;;&lt;br&gt;<br>
&amp;gt;&nbsp;$mq-&amp;gt;channel_open(1);&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;print&nbsp;&amp;quot;Declaring&nbsp;exchange\n&amp;quot;;&lt;br&gt;<br>
&amp;gt;&nbsp;$mq-&amp;gt;exchange_declare(1,&nbsp;&amp;#39;ee_exchange&amp;#39;,&nbsp;{&nbsp;durable&nbsp;=&amp;gt;&nbsp;1&nbsp;});&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;print&nbsp;&amp;quot;Declaring&nbsp;queue\n&amp;quot;;&lt;br&gt;<br>
&amp;gt;&nbsp;$mq-&amp;gt;queue_declare(1,&nbsp;&amp;#39;test&amp;#39;,&nbsp;{&nbsp;durable&nbsp;=&amp;gt;&nbsp;1&nbsp;});&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;print&nbsp;&amp;quot;Binding&nbsp;queue\n&amp;quot;;&lt;br&gt;<br>
&amp;gt;&nbsp;$mq-&amp;gt;queue_bind(1,&nbsp;&amp;#39;test&amp;#39;,&nbsp;&amp;#39;ee_exchange&amp;#39;,&nbsp;&amp;#39;ee_test&amp;#39;);&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;alarm(0);&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;print&nbsp;&amp;quot;&amp;gt;&nbsp;&amp;quot;;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;lt;&amp;gt;;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;alarm(10);&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;print&nbsp;&amp;quot;Publishing&nbsp;message\n&amp;quot;;&lt;br&gt;<br>
&amp;gt;&nbsp;my&nbsp;$rc&nbsp;=&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp;$mq-&amp;gt;publish(1,&nbsp;&amp;#39;ee_test&amp;#39;,&nbsp;&amp;#39;hello&nbsp;world!&amp;#39;,&lt;br&gt;<br>
&amp;gt;&nbsp;              &nbsp;{&nbsp;exchange&nbsp;=&amp;gt;&nbsp;&amp;#39;ee_exchange&amp;#39;,&nbsp;mandatory&nbsp;=&amp;gt;&nbsp;1,&nbsp;immediate&nbsp;=&amp;gt;&nbsp;0&lt;br&gt;<br>
&amp;gt;&nbsp;},&lt;br&gt;<br>
&amp;gt;&nbsp;              &nbsp;{&nbsp;delivery_mode&nbsp;=&amp;gt;&nbsp;2&nbsp;});&lt;br&gt;<br>
&amp;gt;&nbsp;print&nbsp;&amp;quot;Result:&nbsp;$rc\n&amp;quot;;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;__END__&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&amp;gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&amp;gt;&nbsp;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
