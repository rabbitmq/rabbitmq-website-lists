<tt>
&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;Hi,&lt;/span&gt;&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;I&amp;#39;m&nbsp;using&nbsp;JAVA&nbsp;client&nbsp;for&nbsp;RabbitMQ&nbsp;(com.rabbitmq:amqp-client:2.8.1)&nbsp;to&nbsp;write&nbsp;a&nbsp;&amp;quot;jar&nbsp;component&amp;quot;&nbsp;capable&nbsp;of&nbsp;sending&nbsp;messages&nbsp;for&nbsp;some&nbsp;legacy&nbsp;system.&nbsp;The&nbsp;idea&nbsp;is&nbsp;to&nbsp;wrap&nbsp;all&nbsp;code&nbsp;that&nbsp;maintain&nbsp;the&nbsp;connection&nbsp;inside&nbsp;my&nbsp;component.&nbsp;This&nbsp;way,&nbsp;the&nbsp;client&nbsp;software&nbsp;deals&nbsp;only&nbsp;with&nbsp;very&nbsp;simple&nbsp;methods&nbsp;like&nbsp;&amp;quot;post&amp;quot;&nbsp;and&nbsp;is&nbsp;not&nbsp;aware&nbsp;of&nbsp;any&nbsp;connection&nbsp;handling.&nbsp;The&nbsp;connect/reconnect&nbsp;code&nbsp;is&nbsp;written&nbsp;and&nbsp;hidden&nbsp;from&nbsp;the&nbsp;legacy&nbsp;system.&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;<br>
The&nbsp;problem&nbsp;I&nbsp;have&nbsp;faced&nbsp;is&nbsp;that&nbsp;Java&nbsp;client&nbsp;creates&nbsp;&amp;quot;behind&nbsp;the&nbsp;scene&amp;quot;&nbsp;some&nbsp;threads&nbsp;to&nbsp;manage&nbsp;connection&nbsp;-&nbsp;like:&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;<br>
 &nbsp; &nbsp; &nbsp;   lines&nbsp;299-301&nbsp;of AMQConnection&nbsp;class.&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;<br>
&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;start&nbsp;the&nbsp;main&nbsp;loop&nbsp;going&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;new&nbsp;MainLoop(&amp;quot;AMQP&nbsp;Connection&nbsp;&amp;quot;&nbsp;+&nbsp;getHostAddress()&nbsp;+&nbsp;&amp;quot;:&amp;quot;&nbsp;+&nbsp;getPort()).start();&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;after&nbsp;this&nbsp;point&nbsp;clear-up&nbsp;of&nbsp;MainLoop&nbsp;is&nbsp;triggered&nbsp;by&nbsp;closing&nbsp;the&nbsp;frameHandler.&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;Unfortunatelly,&nbsp;those&nbsp;threads&nbsp;aren&amp;#39;t&nbsp;&amp;quot;daemon&amp;quot;&nbsp;threads.&nbsp;So,&nbsp;when&nbsp;main&nbsp;application&nbsp;ends&nbsp;and appropriate connection&nbsp;closing&nbsp;not&nbsp;occurs,&nbsp;the&nbsp;VM&nbsp;won&amp;#39;t&nbsp;terminate.&nbsp;My approach was&nbsp;to&nbsp;add&nbsp;some&nbsp;shutdown&nbsp;hook&nbsp;to&nbsp;close&nbsp;RabbitMQ&nbsp;connections&nbsp;if&nbsp;it&nbsp;is&nbsp;live&nbsp;inside&nbsp;my&nbsp;&amp;quot;jar&nbsp;component&amp;quot;.&nbsp;But,&nbsp;due&nbsp;to&nbsp;those&nbsp;non-daemon&nbsp;threads,&nbsp;VM&nbsp;is&nbsp;not&nbsp;going&nbsp;ever&nbsp;to&nbsp;be&nbsp;terminated&nbsp;and&nbsp;shutdown&nbsp;hooks&nbsp;fired.&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;<br>
It&nbsp;is&nbsp;a&nbsp;question&nbsp;to&nbsp;RabbitMQ&nbsp;driver&nbsp;developers,&nbsp;if&nbsp;the&nbsp;internal&nbsp;threads&nbsp;could&nbsp;be&nbsp;fired&nbsp;as&nbsp;daemon&nbsp;threads,&nbsp;could&nbsp;it&nbsp;be&nbsp;done&nbsp;in&nbsp;future&nbsp;releases?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
