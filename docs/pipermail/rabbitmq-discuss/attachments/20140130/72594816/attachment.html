<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi&nbsp;All,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;working&nbsp;on&nbsp;RabbitMQ&nbsp;HA&nbsp;cluster&nbsp;.&nbsp; I&nbsp;want&nbsp;my&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;slave&nbsp;node&nbsp;when&nbsp;the&nbsp;master&nbsp;node&nbsp;goes&nbsp;down. &lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;achieve&nbsp;this&nbsp;using&nbsp;consumer&nbsp;cancel&nbsp;notification.&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;am&nbsp;using&nbsp;python&nbsp;amqp&nbsp;1.4.2&nbsp;library&nbsp;.&nbsp;I&nbsp;have&nbsp;set&nbsp;the&nbsp;capability&nbsp;&#39;consumer_cancel_notify&#39;&nbsp;as&nbsp;True&nbsp;in&nbsp;client_properties.&lt;/div&gt;&lt;div&gt;In&nbsp;basic_consume()&nbsp;I&nbsp;have&nbsp;passed&nbsp;a&nbsp;callback&nbsp;function&nbsp;to&nbsp;on_cancel&nbsp;parameter.&nbsp;But&nbsp;this&nbsp;callback&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;master&nbsp;goes&nbsp;down.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Can&nbsp;someone&nbsp;tell&nbsp;where&nbsp;I&nbsp;am&nbsp;going&nbsp;wrong.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Akhil &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Following&nbsp;is&nbsp;my&nbsp;code&nbsp;:&nbsp;  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;import&nbsp;amqp&lt;/div&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;this&nbsp;is&nbsp;the&nbsp;callback&nbsp;function&nbsp;to&nbsp;receive&nbsp;the&nbsp;messages&nbsp;published&nbsp;to&nbsp;the&nbsp;queue &lt;/div&gt;&lt;div&gt;def&nbsp;myCallback(message):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;print&nbsp;&quot;messsage&nbsp;received&quot;,message.body&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;this&nbsp;is&nbsp;the&nbsp; callback&nbsp;Function&nbsp;for&nbsp;consumer&nbsp;cancel&nbsp;notification&lt;/div&gt;<br>
&lt;div&gt;def&nbsp;cancelCallback():&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;print&nbsp;&quot;cancelCallback&nbsp;called&quot;&nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp;  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cpDict&nbsp;=&nbsp;{&quot;capabilities&quot;:{&quot;consumer_cancel_notify&quot;:&nbsp;True,&nbsp;},}&lt;/div&gt;&lt;div&gt;con&nbsp;=&nbsp;amqp.Connection(host&nbsp;=&quot;localhost:5672&quot;,userid&nbsp;=&quot;guest&quot;,password=&quot;guest&quot;,client_properties=cpDict)&lt;/div&gt;<br>
&lt;div&gt;channel&nbsp;=&nbsp;con.channel() &lt;/div&gt;&lt;div&gt;channel.exchange_declare(exchange=&quot;exchange1&quot;,type=&#39;direct&#39;,&nbsp;durable=True,&nbsp;auto_delete=False)&lt;/div&gt;&lt;div&gt;channel.queue_declare(queue=&quot;bm2_execQ&quot;,&nbsp;durable=True,exclusive=True,&nbsp;auto_delete=False)&lt;/div&gt;<br>
&lt;div&gt;channel.queue_bind(queue=&quot;bm2_execQ&quot;,exchange=&quot;exchange1&quot;,&nbsp;routing_key=&quot;bm2_execQ&quot;) &lt;/div&gt;&lt;div&gt;channel.basic_consume(queue=&quot;bm2_execQ&quot;,callback=myCallback,&nbsp;consumer_tag=&quot;bm2_tag&quot;,on_cancel=cancelCallback)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;msg&nbsp;=&nbsp;amqp.Message(&quot;hi&quot;)&lt;/div&gt;&lt;div&gt;msg.properties[&quot;content_type&quot;]&nbsp;=&nbsp;&quot;text/plain&quot;&lt;/div&gt;&lt;div&gt;msg.properties[&quot;delivery_mode&quot;]&nbsp;=&nbsp;2&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;channel.basic_publish(msg,&quot;exchange1&quot;,&quot;bm2_execQ&quot;)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;while&nbsp;True&nbsp;:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;channel.wait()&lt;/div&gt;&lt;/div&gt;<br>

</tt>
