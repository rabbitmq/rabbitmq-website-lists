<tt>
&lt;div&gt;&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;Hi,&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;write&nbsp;a&nbsp;custom&nbsp;exchange&nbsp;type&nbsp;in&nbsp;which&nbsp;when&nbsp;bound&nbsp;to&nbsp;another&nbsp;exchange,&nbsp;it&nbsp;will&nbsp;change&nbsp;the&nbsp;message&nbsp;so&nbsp;that&nbsp;the&nbsp;final&nbsp;queue&nbsp;will&nbsp;also&nbsp;know&nbsp;which&nbsp;path&nbsp;the&nbsp;message&nbsp;were&nbsp;routes&nbsp;to.&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;For&nbsp;example,&nbsp;A&nbsp;is&nbsp;bound&nbsp;to&nbsp;B&nbsp;so&nbsp;that&nbsp;message&nbsp;published&nbsp;to&nbsp;A&nbsp;will&nbsp;be&nbsp;routed&nbsp;to&nbsp;B&nbsp;and&nbsp;come&nbsp;to&nbsp;any&nbsp;queue&nbsp;bound&nbsp;to&nbsp;B.&nbsp;But&nbsp;when&nbsp;it&amp;#39;s&nbsp;turn&nbsp;for&nbsp;B&nbsp;to&nbsp;route&nbsp;to&nbsp;its&nbsp;queue,&nbsp;it&nbsp;will&nbsp;either&nbsp;change&nbsp;the&nbsp;exchange_name&nbsp;of&nbsp;the&nbsp;#basic_message,&nbsp;or&nbsp;add&nbsp;B&nbsp;to&nbsp;a&nbsp;path&nbsp;tuple&nbsp;in&nbsp;the&nbsp;headers.&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;However,&nbsp;I&nbsp;failed&nbsp;to&nbsp;do&nbsp;such&nbsp;a&nbsp;thing.&nbsp;My&nbsp;custom&nbsp;exchange&nbsp;has&nbsp;the&nbsp;route/2&nbsp;as&nbsp;following:&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;&lt;br&gt;<br>
<br>
&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;&lt;div&gt;route(X=#exchange{&nbsp;name&nbsp;=&nbsp;XName},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;D=#delivery{&nbsp;message&nbsp;=&nbsp;#basic_message{exchange_name&nbsp;=&nbsp;XName }})&nbsp;-&amp;gt;&lt;/div&gt;&lt;div&gt; &nbsp;  Exchange&nbsp;=&nbsp;exchange_type(X),&nbsp;%&nbsp;a&nbsp;helper&nbsp;to&nbsp;detect&nbsp;the&nbsp;actual&nbsp;exchange&nbsp;type,&nbsp;default&nbsp;to&nbsp;topic&lt;/div&gt;<br>
<br>
&lt;/font&gt;&lt;/font&gt;&lt;div&gt; &nbsp; &nbsp;Exchange:route(X,&nbsp;D);&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;route(X=#exchange{&nbsp;name&nbsp;=&nbsp;XName},&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;D=#delivery{&nbsp;msg_seq_no&nbsp;=&nbsp;MsgSeqNo,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;message&nbsp;=&nbsp;BasicMsg&nbsp;=&nbsp;#basic_message{ &lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exchange_name&nbsp;=&nbsp;Followee,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;routing_keys&nbsp;=&nbsp;[Key],&nbsp;content&nbsp;=&nbsp;Content&nbsp;}})&nbsp;-&amp;gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;%&nbsp;Change&nbsp;the&nbsp;delivery&nbsp;here&nbsp;to&nbsp;NewDelivery&lt;/div&gt;&lt;div&gt; &nbsp;  Exchange&nbsp;=&nbsp;exchange_type(X),&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp;Exchange:route(X,&nbsp;NewDelivery).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;thought&nbsp;that&nbsp;when&nbsp;the&nbsp;message&nbsp;is&nbsp;published&nbsp;to&nbsp;the&nbsp;first&nbsp;exchange,&nbsp;it&nbsp;will&nbsp;find&nbsp;all&nbsp;the&nbsp;bound&nbsp;destinations,&nbsp;including&nbsp;the&nbsp;bound&nbsp;exchange,&nbsp;and&nbsp;route&nbsp;message&nbsp;there.&nbsp;When&nbsp;I&nbsp;debug&nbsp;it,&nbsp;I&nbsp;see&nbsp;that&nbsp;the&nbsp;second&nbsp;route/2&nbsp;function&nbsp;clause&nbsp;is&nbsp;also&nbsp;called,&nbsp;so&nbsp;the&nbsp;message&nbsp;should&nbsp;be&nbsp;routed&nbsp;and&nbsp;delivered&nbsp;to&nbsp;any&nbsp;bound&nbsp;queues/exchanges&nbsp;of&nbsp;the&nbsp;second&nbsp;exchange.&nbsp;I&nbsp;also&nbsp;make&nbsp;sure&nbsp;to&nbsp;change&nbsp;the&nbsp;message&nbsp;id,&nbsp;message&nbsp;sequence&nbsp;number&nbsp;to&nbsp;make&nbsp;sure&nbsp;I&nbsp;have&nbsp;a&nbsp;total&nbsp;different&nbsp;message.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;the&nbsp;queue&nbsp;bound&nbsp;to&nbsp;the&nbsp;second&nbsp;exchange&nbsp;only&nbsp;receives&nbsp;one&nbsp;message&nbsp;from&nbsp;the&nbsp;first&nbsp;exchange.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Can&nbsp;anybody&nbsp;help&nbsp;me&nbsp;with&nbsp;this?&lt;/div&gt;&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;&lt;div&gt;<br>
<br>
&lt;font&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;/font&gt;&lt;/font&gt;Sincerely,&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;Son&nbsp;Tran-Nguyen&lt;/div&gt;&lt;br&gt;<br>

</tt>
