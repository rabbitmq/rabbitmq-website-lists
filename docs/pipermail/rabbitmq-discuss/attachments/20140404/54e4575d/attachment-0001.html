<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;have&nbsp;an&nbsp;application&nbsp;that&nbsp;acts&nbsp;as,&nbsp;essentially,&nbsp;a&nbsp;rest&nbsp;wrapper&nbsp;around&nbsp;rabbitmq.&nbsp;(There&nbsp;is&nbsp;obviously&nbsp;some&nbsp;special&nbsp;logic&nbsp;that&nbsp;makes&nbsp;it&nbsp;necessary&nbsp;to&nbsp;build&nbsp;our&nbsp;own).&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Some&nbsp;background:&nbsp;We&nbsp;have&nbsp;been&nbsp;using&nbsp;this&nbsp;application&nbsp;(current&nbsp;code&nbsp;available&nbsp;at &lt;a&nbsp;href=&quot;https://github.com/PearsonEducation/subpub&quot;&gt;https://github.com/PearsonEducation/subpub&lt;/a&gt;)&nbsp;as&nbsp;an&nbsp;internal&nbsp;pub/sub&nbsp;for&nbsp;several&nbsp;years&nbsp;now.&nbsp;It&nbsp;has&nbsp;now&nbsp;grown&nbsp;dramatically&nbsp;in&nbsp;importance&nbsp;to&nbsp;our&nbsp;vision&nbsp;and&nbsp;we&nbsp;are&nbsp;beginning&nbsp;to&nbsp;get&nbsp;inundated&nbsp;with&nbsp;requests&nbsp;for&nbsp;features&nbsp;and&nbsp;enhancements.&nbsp;One&nbsp;of&nbsp;those&nbsp;enhancements&nbsp;is&nbsp;to&nbsp;allow&nbsp;publishers&nbsp;to&nbsp;specify&nbsp;with&nbsp;a&nbsp;header&nbsp;whether&nbsp;they&nbsp;want&nbsp;the&nbsp;application&nbsp;to&nbsp;require&nbsp;confirmed&nbsp;publishing&nbsp;to&nbsp;rabbit.&nbsp;We&nbsp;had&nbsp;begun&nbsp;this&nbsp;process&nbsp;by&nbsp;checking&nbsp;for&nbsp;the&nbsp;header&nbsp;value&nbsp;and&nbsp;passing&nbsp;down&nbsp;the&nbsp;chain.&nbsp;However,&nbsp;we&nbsp;are&nbsp;not&nbsp;currently&nbsp;setting-up&nbsp;a&nbsp;channel&nbsp;that&nbsp;is&nbsp;set&nbsp;for&nbsp;publish&nbsp;confirms.&nbsp;Anyway,&nbsp;TMI...&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;state&nbsp;I&#39;m&nbsp;in&nbsp;now&nbsp;is&nbsp;that,&nbsp;on&nbsp;startup,&nbsp;we&nbsp;create&nbsp;connections&nbsp;to&nbsp;each&nbsp;of&nbsp;our&nbsp;brokers.&nbsp;In&nbsp;this&nbsp;process&nbsp;we&nbsp;create&nbsp;a&nbsp;channel&nbsp;and&nbsp;save&nbsp;it&nbsp;in&nbsp;state.&nbsp;I&nbsp;have&nbsp;now&nbsp;added&nbsp;logic&nbsp;to&nbsp;create&nbsp;a&nbsp;second&nbsp;channel&nbsp;on&nbsp;that&nbsp;connection&nbsp;that&nbsp;sets:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;p&nbsp;class=&quot;&quot;&gt; #&#39;confirm.select_ok&#39;{}&nbsp;=&nbsp;amqp_channel:call(ConfirmedChannel,&nbsp;#&#39;confirm.select&#39;{}),&lt;/p&gt;&lt;p&nbsp;class=&quot;&quot;&gt;And&nbsp;saves&nbsp;it&nbsp;to&nbsp;state.&nbsp;Then&nbsp;on&nbsp;publish,&nbsp;I&nbsp;select&nbsp;which&nbsp;one&nbsp;to&nbsp;use&nbsp;based&nbsp;on&nbsp;the&nbsp;values&nbsp;passed-down&nbsp;the&nbsp;stack&nbsp;from&nbsp;message&nbsp;intake.&nbsp;Set&nbsp;self()&nbsp;as&nbsp;the&nbsp;confirm&nbsp;handler&nbsp;and&nbsp;respond&nbsp;with&nbsp;a&nbsp;wait&nbsp;so&nbsp;that&nbsp;up&nbsp;the&nbsp;stack&nbsp;I&nbsp;can&nbsp;initiate&nbsp;a&nbsp;receive&nbsp;loop&nbsp;in&nbsp;the&nbsp;message&nbsp;intake&nbsp;which&nbsp;is&nbsp;not&nbsp;a&nbsp;gen_server.&nbsp;I&nbsp;have&nbsp;debug&nbsp;messages&nbsp;throughout&nbsp;and&nbsp;it&nbsp;appears&nbsp;that&nbsp;everything&nbsp;is&nbsp;happening&nbsp;as&nbsp;expected.&nbsp;I&nbsp;trace&nbsp;the&nbsp;message&nbsp;through&nbsp;the&nbsp;publish&nbsp;path.&nbsp;To&nbsp;being&nbsp;published&nbsp;and&nbsp;passing&nbsp;the&nbsp;wait&nbsp;back&nbsp;up&nbsp;to&nbsp;the&nbsp;receiver.&nbsp;I&nbsp;also&nbsp;see&nbsp;where&nbsp;the&nbsp;basic.ack&nbsp;is&nbsp;received&nbsp;and&nbsp;the&nbsp;publish_confirm&nbsp;acknowledgement&nbsp;passed&nbsp;all&nbsp;the&nbsp;way&nbsp;up&nbsp;to&nbsp;the&nbsp;receive&nbsp;loop.&nbsp;However,&nbsp;then&nbsp;things&nbsp;go&nbsp;awry.&nbsp;I&nbsp;get&nbsp;the&nbsp;attached&nbsp;dump.&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;&quot;&gt;My&nbsp;take-away,&nbsp;although&nbsp;likely&nbsp;I&nbsp;am&nbsp;wrong,&nbsp;is&nbsp;that&nbsp;somewhere,&nbsp;apparently&nbsp;in&nbsp;amqp_balanced_publisher,&nbsp;a&nbsp;gen_server&nbsp;call&nbsp;is&nbsp;timing-out&nbsp;while&nbsp;waiting&nbsp;for&nbsp;a&nbsp;response.&nbsp;But,&nbsp;I&nbsp;seem&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;trace&nbsp;the&nbsp;responses&nbsp;through&nbsp;the&nbsp;whole&nbsp;stack&nbsp;so&nbsp;I&nbsp;am&nbsp;thoroughly&nbsp;confused.&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;&quot;&gt;I&nbsp;realize&nbsp;this&nbsp;is&nbsp;vague&nbsp;and&nbsp;additional&nbsp;details/code&nbsp;are&nbsp;likely&nbsp;still&nbsp;needed.&nbsp;Please&nbsp;let&nbsp;me&nbsp;know.&nbsp;I&#39;ve&nbsp;spent&nbsp;way&nbsp;too&nbsp;much&nbsp;time&nbsp;on&nbsp;this&nbsp;already&nbsp;and&nbsp;it&#39;s&nbsp;getting&nbsp;quite&nbsp;frustrating.&nbsp;And&nbsp;I&nbsp;know&nbsp;I&nbsp;am&nbsp;likely&nbsp;missing&nbsp;something&nbsp;obvious&nbsp;but&nbsp;am&nbsp;finding&nbsp;supporting&nbsp;documentation&nbsp;for&nbsp;erlang&nbsp;lacking.&nbsp;But&nbsp;I&#39;m&nbsp;probably&nbsp;just&nbsp;looking&nbsp;in&nbsp;the&nbsp;right&nbsp;places.&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;&quot;&gt;Best&nbsp;regards,&lt;/p&gt;&lt;p&nbsp;class=&quot;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;&quot;&gt;Ryan&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
