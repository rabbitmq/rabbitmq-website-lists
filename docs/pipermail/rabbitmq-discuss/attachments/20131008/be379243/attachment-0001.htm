<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;style='border-left:2px&nbsp;solid&nbsp;#CCCCCC;padding:0&nbsp;1em'&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&amp;gt;&nbsp;If&nbsp;&amp;quot;_socket&amp;quot;&nbsp;field&nbsp;is&nbsp;not&nbsp;private&nbsp;in&nbsp;SocketFrameHandler&nbsp;I&nbsp;could&nbsp;try&nbsp;overriding&nbsp;&amp;quot;close&amp;quot;&nbsp;method&nbsp;and&nbsp;invoke&nbsp;just&nbsp;_socket.close()&nbsp;-&nbsp;maybe&nbsp;that&nbsp;would&nbsp;help.&nbsp;But&nbsp;the&nbsp;field&nbsp;is&nbsp;private&nbsp;(maybe&nbsp;we&nbsp;can&nbsp;copy/paste&nbsp;the&nbsp;class&nbsp;and&nbsp;instantiate&nbsp;our&nbsp;new&nbsp;one&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;look&nbsp;good&nbsp;-&nbsp;it&nbsp;would&nbsp;be&nbsp;better&nbsp;to&nbsp;just&nbsp;enhance&nbsp;existing&nbsp;functionality&nbsp;not&nbsp;to&nbsp;replace&nbsp;-&nbsp;there&nbsp;could&nbsp;be&nbsp;some&nbsp;problems&nbsp;with&nbsp;compatibility&nbsp;with&nbsp;newer&nbsp;versions&nbsp;of&nbsp;RabbitMQ&nbsp;client&nbsp;lib,&nbsp;RabbitMQ&nbsp;tests&nbsp;should&nbsp;be&nbsp;run&nbsp;regularly&nbsp;as&nbsp;our&nbsp;own&nbsp;tests,&nbsp;etc).<br>
&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;I&nbsp;understand&nbsp;the&nbsp;desire&nbsp;to&nbsp;avoid&nbsp;deploying&nbsp;a&nbsp;fork.&nbsp;However,&nbsp;it&amp;#39;s&nbsp;already&nbsp;clear&nbsp;that&nbsp;the&nbsp;client<br>
&lt;br&gt;needs&nbsp;to&nbsp;be&nbsp;modified&nbsp;somehow&nbsp;and&nbsp;you&nbsp;have&nbsp;a&nbsp;way&nbsp;to&nbsp;reliably&nbsp;reproduce&nbsp;the&nbsp;problem&nbsp;(is&nbsp;this&nbsp;correct?)<br>
&lt;br&gt;&lt;br&gt;Perhaps&nbsp;the&nbsp;fastest&nbsp;turnaround&nbsp;time&nbsp;would&nbsp;be&nbsp;for&nbsp;you&nbsp;to&nbsp;make&nbsp;some&nbsp;changes&nbsp;and&nbsp;try&nbsp;them&nbsp;out.<br>
&lt;br&gt;Once&nbsp;a&nbsp;solution&nbsp;that&nbsp;works&nbsp;is&nbsp;found,&nbsp;we&nbsp;will&nbsp;see&nbsp;if&nbsp;it&nbsp;can&nbsp;be&nbsp;incorporated&nbsp;into&nbsp;the&nbsp;mainline.<br>
&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Reproducing&nbsp;is&nbsp;not&nbsp;too&nbsp;hard&nbsp;-&nbsp;we&nbsp;have&nbsp;2&nbsp;virtual&nbsp;machines&nbsp;and&nbsp;just&nbsp;turn&nbsp;network&nbsp;off&nbsp;on&nbsp;the&nbsp;one&nbsp;machine&nbsp;when&nbsp;needed&nbsp;(maybe&nbsp;there&nbsp;is&nbsp;a&nbsp;better&nbsp;way&nbsp;but&nbsp;that&nbsp;was&nbsp;pretty&nbsp;enough).&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;There&nbsp;is&nbsp;also&nbsp;possibility&nbsp;to&nbsp;not&nbsp;make&nbsp;copy/paste&nbsp;of&nbsp;SocketFrameHandler&nbsp;-&nbsp;we&nbsp;managed&nbsp;to&nbsp;get&nbsp;Socket&nbsp;object&nbsp;through&nbsp;the&nbsp;reflection&nbsp;and&nbsp;invoking&nbsp;socket.close()&nbsp;really&nbsp;caused&nbsp;the&nbsp;&amp;quot;socketWrite&amp;quot;&nbsp;method&nbsp;to&nbsp;throw&nbsp;an&nbsp;Exception&nbsp;-&nbsp;what&nbsp;was&nbsp;desired.&nbsp;The&nbsp;last&nbsp;thing&nbsp;to&nbsp;do&nbsp;is&nbsp;registering&nbsp;write&nbsp;start&nbsp;time&nbsp;and&nbsp;whether&nbsp;write&nbsp;is&nbsp;occurring&nbsp;right&nbsp;now&nbsp;-&nbsp;and&nbsp;separate&nbsp;thread&nbsp;can&nbsp;successfully&nbsp;close&nbsp;socket&nbsp;when&nbsp;timeout&nbsp;expires.&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;also&nbsp;have&nbsp;another&nbsp;specific&nbsp;solution&nbsp;-&nbsp;actually&nbsp;the&nbsp;problem&nbsp;appeared&nbsp;in&nbsp;our&nbsp;HA&nbsp;configuration&nbsp;and&nbsp;components&nbsp;connected&nbsp;always&nbsp;to&nbsp;the&nbsp;&amp;quot;primary&amp;quot;&nbsp;RabbitMQ&nbsp;host&nbsp;(with&nbsp;possibility&nbsp;to&nbsp;switch&nbsp;to&nbsp;backup&nbsp;and&nbsp;vice&nbsp;versa).&nbsp;When&nbsp;primary&nbsp;host&nbsp;is&nbsp;shutdowned&nbsp;we&nbsp;observe&nbsp;this&nbsp;behavior.&nbsp;So&nbsp;now&nbsp;we&nbsp;want&nbsp;to&nbsp;try&nbsp;to&nbsp;connect&nbsp;to&nbsp;&amp;quot;localhost&amp;quot;&nbsp;RabbitMQ&nbsp;first,&nbsp;we&nbsp;have&nbsp;an&nbsp;HA&nbsp;configuration&nbsp;between&nbsp;RabbitMQ&nbsp;servers&nbsp;though&nbsp;we&nbsp;didn&amp;#39;t&nbsp;do&nbsp;much&nbsp;tests&nbsp;with&nbsp;it&nbsp;but&nbsp;we&nbsp;hope&nbsp;that&nbsp;solution&nbsp;can&nbsp;solve&nbsp;the&nbsp;problem&nbsp;for&nbsp;the&nbsp;majority&nbsp;of&nbsp;the&nbsp;cases.&nbsp;But&nbsp;still&nbsp;blocked&nbsp;write&nbsp;can&nbsp;arise&nbsp;in&nbsp;some&nbsp;cases.&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;we&nbsp;keep&nbsp;first&nbsp;solution&nbsp;in&nbsp;mind&nbsp;but&nbsp;for&nbsp;now&nbsp;it&amp;#39;s&nbsp;unknown&nbsp;if&nbsp;we&nbsp;will&nbsp;make&nbsp;fix.&nbsp;If&nbsp;we&nbsp;do&nbsp;we&nbsp;will&nbsp;share&nbsp;it&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;help&nbsp;faster&nbsp;incorporating&nbsp;into&nbsp;the&nbsp;library.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Â &lt;/div&gt;&lt;blockquote&nbsp;style='border-left:2px&nbsp;solid&nbsp;#CCCCCC;padding:0&nbsp;1em'&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;/div&gt;&amp;gt;&nbsp;Both&nbsp;workarounds&nbsp;require&nbsp;careful&nbsp;testing&nbsp;and&nbsp;time,&nbsp;we&nbsp;will&nbsp;think&nbsp;about&nbsp;it.&nbsp;But&nbsp;I&amp;#39;m&nbsp;hoping&nbsp;RabbitMQ&nbsp;library&nbsp;will&nbsp;provide&nbsp;functionality&nbsp;to&nbsp;set&nbsp;socket&nbsp;write&nbsp;timeout&nbsp;in&nbsp;the&nbsp;future.<br>
&lt;br&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;You&nbsp;can&nbsp;help&nbsp;with&nbsp;that.&nbsp;Contributing&nbsp;does&nbsp;involve&nbsp;submitting&nbsp;a&nbsp;CLA&nbsp;but&nbsp;digital&nbsp;ones<br>
&lt;br&gt;are&nbsp;accepted.<br>
&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&amp;gt;&nbsp;Could&nbsp;you&nbsp;provide&nbsp;some&nbsp;ticket&nbsp;link&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;monitor&nbsp;its&nbsp;status?<br>
&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;rabbitmq&nbsp;bug&nbsp;tracker&nbsp;is&nbsp;not&nbsp;public&nbsp;but&nbsp;we&nbsp;accept&nbsp;issues&nbsp;that&nbsp;are&nbsp;filed&nbsp;on&nbsp;github,&nbsp;so&nbsp;I&nbsp;filed<br>
&lt;br&gt;one&nbsp;you&nbsp;can&nbsp;watch:<br>
&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;https://github.com/rabbitmq/rabbitmq-java-client/issues/11&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;link=&quot;external&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/rabbitmq/rabbitmq-java-client/issues/11&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;MK<br>
&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;very&nbsp;much&nbsp;for&nbsp;all&nbsp;your&nbsp;help,&lt;br&gt;Oleg&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
<br>
<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br>
&lt;br/&gt;&lt;hr&nbsp;align=&quot;left&quot;&nbsp;width=&quot;300&quot;&nbsp;/&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://rabbitmq.1065348.n5.nabble.com/Long-timeout-if-server-host-becomes-unreachable-tp30275p30344.html&quot;&gt;Re:&nbsp;Long&nbsp;timeout&nbsp;if&nbsp;server&nbsp;host&nbsp;becomes&nbsp;unreachable&lt;/a&gt;&lt;br/&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;&lt;a&nbsp;href=&quot;http://rabbitmq.1065348.n5.nabble.com/&quot;&gt;RabbitMQ&nbsp;mailing&nbsp;list&nbsp;archive&lt;/a&gt;&nbsp;at&nbsp;Nabble.com.&lt;br/&gt;
</tt>
