<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;Bala,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;few&nbsp;things....&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;the&nbsp;verify_fun&nbsp;is&nbsp;an&nbsp;option&nbsp;that&nbsp;Erlang's&nbsp;SSL&nbsp;application&nbsp;takes,&nbsp;not&nbsp;a&nbsp;rabbit&nbsp;specific&nbsp;item&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;8&nbsp;Oct&nbsp;2013,&nbsp;at&nbsp;01:23,&nbsp;Balachandher&nbsp;Srinivasan&nbsp;wrote:&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;1.&amp;nbsp;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;Erlang&nbsp;adopted&nbsp;a&nbsp;more&nbsp;elegant&nbsp;way&nbsp;to&nbsp;express&nbsp;higher&nbsp;order&nbsp;functions&nbsp;(funs),&nbsp;based&nbsp;on&amp;nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://www.erlang.org/eeps/eep-0023.html&quot;&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;http://www.erlang.org/eeps/eep-0023.html&lt;/a&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;.&nbsp;&amp;nbsp;So,&nbsp;{Module,&nbsp;Function}&nbsp;would&nbsp;be&nbsp;typically&nbsp;represented&nbsp;as&nbsp;Module:Function/Arity&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;can't&nbsp;always&nbsp;do&nbsp;that&nbsp;in&nbsp;a&nbsp;config&nbsp;file&nbsp;-&nbsp;it&nbsp;depends&nbsp;on&nbsp;whether&nbsp;you&nbsp;have&nbsp;literals&nbsp;or&nbsp;are&nbsp;trying&nbsp;to&nbsp;use&nbsp;bound&nbsp;variables&nbsp;(where&nbsp;no&nbsp;binding&nbsp;exists).&nbsp;See&amp;nbsp;&lt;a&nbsp;href=&quot;http://www.erlang.org/doc/man/config.html&quot;&gt;http://www.erlang.org/doc/man/config.html&lt;/a&gt;&nbsp;for&nbsp;details,&nbsp;but&nbsp;basically&nbsp;the&nbsp;file&nbsp;needs&nbsp;to&nbsp;conform&nbsp;to&nbsp;the&nbsp;same&nbsp;specification&nbsp;that&nbsp;file:consult/1&nbsp;uses&nbsp;-&nbsp;see&amp;nbsp;&lt;a&nbsp;href=&quot;http://www.erlang.org/doc/man/file.html#consult-1&quot;&gt;http://www.erlang.org/doc/man/file.html#consult-1&lt;/a&gt;&nbsp;for&nbsp;more&nbsp;details.&nbsp;If&nbsp;you&nbsp;can't&nbsp;execute&nbsp;`file:consult(&quot;/path/to/your/rabbit/config&quot;)'&nbsp;then&nbsp;the&nbsp;config&nbsp;file&nbsp;isn't&nbsp;valid.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;2.&nbsp;Based&nbsp;on&nbsp;the&nbsp;EEP&nbsp;mentioned&nbsp;above&nbsp;and&nbsp;the&nbsp;SSL&nbsp;documentation,&nbsp;I&nbsp;was&nbsp;able&nbsp;to&nbsp;write&nbsp;a&nbsp;test&nbsp;program&nbsp;and&nbsp;validate&nbsp;CRL&nbsp;successfully&nbsp;by&nbsp;referring&nbsp;a&nbsp;function&nbsp;either&nbsp;internally&nbsp;within&nbsp;the&nbsp;same&nbsp;module&nbsp;or&nbsp;from&nbsp;an&nbsp;external&nbsp;module.&nbsp;For&nbsp;internal&nbsp;module's&nbsp;function,&nbsp;I&nbsp;used&nbsp;the&nbsp;form,&nbsp;{verify_fun,&nbsp;{fun&nbsp;validate/3,&nbsp;[]}};&nbsp;for&nbsp;external&nbsp;module's&nbsp;function,&nbsp;I&nbsp;used&nbsp;the&nbsp;form&nbsp;{verify_fun,&nbsp;{fun&nbsp;cert_util:validate/3,&nbsp;[]}}.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;won't&nbsp;work&nbsp;in&nbsp;a&nbsp;config&nbsp;file.&nbsp;To&nbsp;test&nbsp;this&nbsp;for&nbsp;yourself,&nbsp;create&nbsp;a&nbsp;text&nbsp;file&nbsp;containing&nbsp;just&nbsp;that&nbsp;term:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$&nbsp;echo&nbsp;'[{verify_fun,&nbsp;{fun&nbsp;lists:foldl/3,&nbsp;[]}}].'&nbsp;&amp;gt;&amp;gt;&nbsp;foo.config&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;try&nbsp;to&nbsp;parse&nbsp;it&nbsp;in&nbsp;the&nbsp;shell:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Eshell&nbsp;V5.10.2&nbsp;&amp;nbsp;(abort&nbsp;with&nbsp;^G)&lt;/div&gt;&lt;div&gt;1&amp;gt;&nbsp;file:consult(&quot;foo.config&quot;).&lt;/div&gt;&lt;div&gt;{error,{1,erl_parse,&quot;bad&nbsp;term&quot;}}&amp;nbsp;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;3.&nbsp;After&nbsp;successfully&nbsp;writing&nbsp;a&nbsp;test&nbsp;program,&nbsp;I&nbsp;tried&nbsp;to&nbsp;apply&nbsp;the&nbsp;same&nbsp;in&nbsp;rabbitmq;&nbsp;however,&nbsp;rabbitmq&nbsp;was&nbsp;unable&nbsp;to&nbsp;start&nbsp;and&nbsp;I&nbsp;witnessed&nbsp;the&nbsp;following&nbsp;in&nbsp;the&nbsp;logs,&lt;/span&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;b&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;/var/log/rabbitmq/startup_log&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;{&quot;could&nbsp;not&nbsp;start&nbsp;kernel&nbsp;pid&quot;,application_controller,&quot;error&nbsp;in&nbsp;config&nbsp;file&nbsp;\&quot;/etc/rabbitmq/rabbitmq.config\&quot;&nbsp;(1):&nbsp;bad&nbsp;term&quot;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;&lt;b&gt;/var/log/rabbitmq/startup_err&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;&lt;div&gt;Crash&nbsp;dump&nbsp;was&nbsp;written&nbsp;to:&nbsp;erl_crash.dump&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;&lt;div&gt;could&nbsp;not&nbsp;start&nbsp;kernel&nbsp;pid&nbsp;(application_controller)&nbsp;(error&nbsp;in&nbsp;config&nbsp;file&nbsp;&quot;/etc/rabbitmq/rabbitmq.config&quot;&nbsp;(1):&nbsp;bad&nbsp;term)&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;indicates&nbsp;that&nbsp;the&nbsp;config&nbsp;file&nbsp;contains&nbsp;invalid&nbsp;syntax.&nbsp;As&nbsp;I&nbsp;said,&nbsp;the&nbsp;`fun&nbsp;Mod:Func/Arity'&nbsp;syntax&nbsp;isn't&nbsp;valid&nbsp;in&nbsp;a&nbsp;system&nbsp;configuration&nbsp;file.&amp;nbsp;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;4.&nbsp;It&nbsp;was&nbsp;clear&nbsp;from&nbsp;the&nbsp;above&nbsp;that&nbsp;rabbitmq&nbsp;was&nbsp;unable&nbsp;to&nbsp;take&nbsp;the&nbsp;EEP-23&nbsp;form&nbsp;for&nbsp;verify_fun;&nbsp;so&nbsp;I&nbsp;tried&nbsp;reverting&nbsp;back&nbsp;the&nbsp;funs&nbsp;to&nbsp;old&nbsp;type&nbsp;of&nbsp;the&nbsp;form&nbsp;{Module,&nbsp;Function}.&nbsp;&amp;nbsp;&nbsp;When&nbsp;I&nbsp;tried&nbsp;restarting,&nbsp;while&nbsp;it&nbsp;gave&nbsp;no&nbsp;errors&nbsp;and&nbsp;started&nbsp;successfully,&nbsp;my&nbsp;CRL&nbsp;validation&nbsp;function&nbsp;was&nbsp;never&nbsp;called.&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Looking&nbsp;at&amp;nbsp;&lt;a&nbsp;href=&quot;https://github.com/erlang/otp/blob/master/lib/ssl/src/ssl_handshake.erl#L359&quot;&gt;https://github.com/erlang/otp/blob/master/lib/ssl/src/ssl_handshake.erl#L359&lt;/a&gt;,&nbsp;it&nbsp;seems&nbsp;likely&nbsp;that&nbsp;the&nbsp;user&nbsp;fun&nbsp;isn't&nbsp;called&nbsp;since&nbsp;as&nbsp;the&nbsp;documentation&nbsp;states:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&quot;The&nbsp;verify&nbsp;fun&nbsp;will&nbsp;be&nbsp;called&nbsp;during&nbsp;the&nbsp;X509-path&nbsp;validation&nbsp;when&nbsp;an&amp;nbsp;error&nbsp;or&nbsp;an&nbsp;extension&nbsp;unknown&nbsp;to&nbsp;the&nbsp;ssl&nbsp;application&nbsp;is&nbsp;encountered.&amp;nbsp;Additionally&nbsp;it&nbsp;will&nbsp;be&nbsp;called&nbsp;when&nbsp;a&nbsp;certificate&nbsp;is&nbsp;considered&nbsp;valid&nbsp;by&nbsp;the&amp;nbsp;path&nbsp;validation&nbsp;to&nbsp;allow&nbsp;access&nbsp;to&nbsp;each&nbsp;certificate&nbsp;in&nbsp;the&nbsp;path&nbsp;to&nbsp;the&nbsp;user&amp;nbsp;application.&quot;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;5.&nbsp;RabbitMQ&nbsp;site&nbsp;suggests&nbsp;that&nbsp;in&nbsp;order&nbsp;to&nbsp;use&nbsp;SSL&nbsp;reliably&nbsp;use&nbsp;R14B(erts&nbsp;4.0.1)&nbsp;as&nbsp;the&nbsp;minimum&nbsp;version.&nbsp;&amp;nbsp;I&nbsp;tried&nbsp;using&nbsp;R16B&nbsp;(erts-5.10.1)&nbsp;on&nbsp;64-bit&nbsp;Cent&nbsp;OS,&nbsp;which&nbsp;internally&nbsp;uses&nbsp;ssl-5.2.1.&nbsp;&amp;nbsp;Also,&nbsp;I&nbsp;tried&nbsp;R16B01(erts-5.10.2)&nbsp;on&nbsp;64-bit&nbsp;Windows&nbsp;7,&nbsp;which&nbsp;internally&nbsp;uses&nbsp;ssl-5.3.1.&nbsp;&amp;nbsp;Between&nbsp;these&nbsp;versions,&nbsp;there&nbsp;are&nbsp;lot&nbsp;of&nbsp;bugs&nbsp;fixed&nbsp;and&nbsp;enhancements&nbsp;applied&nbsp;in&nbsp;SSL&nbsp;application&amp;nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://www.erlang.org/doc/apps/ssl/notes.html&quot;&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;http://www.erlang.org/doc/apps/ssl/notes.html&lt;/a&gt;.&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;summarize,&nbsp;though&nbsp;RabbitMQ&nbsp;states&nbsp;R14B&nbsp;as&nbsp;the&nbsp;minimum&nbsp;version&nbsp;for&nbsp;reliable&nbsp;SSL,&nbsp;I&nbsp;wonder&nbsp;whether&nbsp;it&nbsp;is&nbsp;compatible&nbsp;with&nbsp;the&nbsp;latest&nbsp;SSL&nbsp;available&nbsp;in&nbsp;the&nbsp;recent&nbsp;Erlang&nbsp;distributions.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don't&nbsp;see&nbsp;any&nbsp;incompatibility&nbsp;-&nbsp;Rabbit&nbsp;does&nbsp;little&nbsp;more&nbsp;than&nbsp;forward&nbsp;the&nbsp;options&nbsp;you've&nbsp;provided&nbsp;to&nbsp;the&nbsp;SSL&nbsp;application.&nbsp;It&nbsp;looks&nbsp;to&nbsp;me&nbsp;like&nbsp;this&nbsp;problem&nbsp;has&nbsp;more&nbsp;to&nbsp;do&nbsp;with&nbsp;how&nbsp;the&nbsp;SSL&nbsp;application&nbsp;handles&nbsp;the&nbsp;validate_fun.&nbsp;I'd&nbsp;suggest&nbsp;asking&nbsp;on&nbsp;the&nbsp;erlang-questions&nbsp;mailing&nbsp;list&nbsp;to&nbsp;see&nbsp;if&nbsp;you&nbsp;can&nbsp;get&nbsp;some&nbsp;more&nbsp;guidance&nbsp;there&nbsp;-&nbsp;unless&nbsp;someone&nbsp;else&nbsp;on&nbsp;rabbit-discuss&nbsp;has&nbsp;come&nbsp;across&nbsp;this&nbsp;before&nbsp;and&nbsp;can&nbsp;say&nbsp;more&nbsp;about&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If/when&nbsp;you&nbsp;find&nbsp;out&nbsp;the&nbsp;cause,&nbsp;please&nbsp;share&nbsp;the&nbsp;outcome&nbsp;with&nbsp;us!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Tim&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
