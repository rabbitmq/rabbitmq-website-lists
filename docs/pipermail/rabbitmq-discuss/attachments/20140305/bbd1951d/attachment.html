<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Dear&nbsp;RabbitMQ&nbsp;Community,&lt;br&gt;&lt;br&gt;I&#39;m&nbsp;having&nbsp;some&nbsp;problems&nbsp;with&nbsp;the&nbsp;{cluster_partition_handling,&nbsp;pause_minority}&nbsp;option&nbsp;and&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;share&nbsp;with&nbsp;you&nbsp;my&nbsp;doubts.&lt;br&gt;&lt;br&gt;First,&nbsp;the&nbsp;architecture.&nbsp;I&#39;m&nbsp;running&nbsp;RabbitMQ&nbsp;3.2.4&nbsp;(Erlang&nbsp;R14A)&nbsp;on&nbsp;3&nbsp;nodes&nbsp;(rabbitmq@rabbitmq-test01,&nbsp;rabbitmq@rabbitmq-test02&nbsp;and&nbsp;rabbitmq@rabbitmq-test03)&nbsp;on&nbsp;a&nbsp;virtualized&nbsp;platform&nbsp;-&nbsp;quite&nbsp;similar&nbsp;to&nbsp;EC2.&nbsp;&nbsp;And&nbsp;because&nbsp;of&nbsp;that&nbsp;I&nbsp;have,&nbsp;from&nbsp;time&nbsp;to&nbsp;time,&nbsp;connectivity&nbsp;issues&nbsp;&ndash;&nbsp;I&nbsp;know,&nbsp;that&#39;s&nbsp;bad&nbsp;;)&lt;br&gt;<br>
&lt;br&gt;Digging&nbsp;into&nbsp;the&nbsp;doc&nbsp;I&nbsp;have&nbsp;found&nbsp;that&nbsp;the&nbsp;best&nbsp;way&nbsp;to&nbsp;handle&nbsp;the&nbsp;problem&nbsp;is&nbsp;using&nbsp;the&nbsp;pause_minority&nbsp;option&nbsp;-&nbsp;&lt;a&nbsp;href=&quot;https://www.rabbitmq.com/partitions.html&quot;&gt;https://www.rabbitmq.com/partitions.html&lt;/a&gt;.&lt;br&gt;&lt;br&gt;But&nbsp;from&nbsp;time&nbsp;to&nbsp;time&nbsp;my&nbsp;nodes&nbsp;get&nbsp;disconnected&nbsp;from&nbsp;each&nbsp;other&nbsp;and&nbsp;do&nbsp;not&nbsp;recover&nbsp;automatically.&nbsp;Hopefully&nbsp;I&nbsp;have&nbsp;managed&nbsp;to&nbsp;reproduce&nbsp;the&nbsp;problem.&nbsp;Here&nbsp;are&nbsp;the&nbsp;steps.&lt;br&gt;<br>
&lt;br&gt;THE&nbsp;CONFIGURATION&nbsp;FILE&lt;br&gt;***********************************************************&lt;br&gt;&lt;br&gt;My&nbsp;configuration&nbsp;file&nbsp;is&nbsp;quite&nbsp;simple:&lt;br&gt;&lt;br&gt;%%&nbsp;-*-&nbsp;mode:&nbsp;erlang&nbsp;-*-&lt;br&gt;[&lt;br&gt;&nbsp;{rabbit,&lt;br&gt;&nbsp;&nbsp;[&lt;br&gt;&nbsp;&nbsp;&nbsp;{auth_mechanisms,&nbsp;[&#39;PLAIN&#39;,&nbsp;&#39;AMQPLAIN&#39;]},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;{default_vhost,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&quot;/&quot;&gt;&gt;},&lt;br&gt;&nbsp;&nbsp;&nbsp;{default_user,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&quot;admin&quot;&gt;&gt;},&lt;br&gt;&nbsp;&nbsp;&nbsp;{default_pass,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;&lt;&quot;admin&quot;&gt;&gt;},&lt;br&gt;&nbsp;&nbsp;&nbsp;{default_permissions,&nbsp;[&lt;&lt;&quot;.*&quot;&gt;&gt;,&nbsp;&lt;&lt;&quot;.*&quot;&gt;&gt;,&nbsp;&lt;&lt;&quot;.*&quot;&gt;&gt;]},&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;{default_user_tags,&nbsp;[administrator]},&lt;br&gt;&nbsp;&nbsp;&nbsp;{cluster_partition_handling,&nbsp;pause_minority},&lt;br&gt;&nbsp;&nbsp;&nbsp;{cluster_nodes,&nbsp;{[&#39;rabbitmq@rabbitmq-test01&#39;,&nbsp;&#39;rabbitmq@rabbitmq-test02&#39;,&nbsp;&#39;rabbitmq@rabbitmq-test03&#39;],&nbsp;disc}}&lt;br&gt;<br>
&nbsp;&nbsp;]},&lt;br&gt;&nbsp;{kernel,&nbsp;[]},&lt;br&gt;&nbsp;{rabbitmq_management,&nbsp;[]},&lt;br&gt;&nbsp;{rabbitmq_management_agent,&nbsp;[]},&lt;br&gt;&nbsp;{rabbitmq_shovel,&lt;br&gt;&nbsp;&nbsp;[{shovels,&nbsp;[]}&lt;br&gt;&nbsp;&nbsp;]},&lt;br&gt;&nbsp;{rabbitmq_stomp,&nbsp;[]},&lt;br&gt;&nbsp;{rabbitmq_mqtt,&nbsp;[]},&lt;br&gt;&nbsp;{rabbitmq_amqp1_0,&nbsp;[]},&lt;br&gt;<br>
&nbsp;{rabbitmq_auth_backend_ldap,&nbsp;[]}&lt;br&gt;].&lt;br&gt;&lt;br&gt;Has&nbsp;you&nbsp;can&nbsp;see,&nbsp;the&nbsp;{cluster_partition_handling,&nbsp;pause_minority}&nbsp;option&nbsp;is&nbsp;there.&lt;br&gt;&lt;br&gt;PAUSE_MINORITY&nbsp;WORKING&lt;br&gt;***********************************************************&lt;br&gt;<br>
&lt;br&gt;When&nbsp;the&nbsp;network&nbsp;outage&nbsp;is&nbsp;long&nbsp;enough,&nbsp;the&nbsp;option&nbsp;works&nbsp;perfectly.&lt;br&gt;&lt;br&gt;To&nbsp;simulate&nbsp;a&nbsp;connection&nbsp;problem&nbsp;on&nbsp;rabbitmq-test03&nbsp;I&nbsp;run:&lt;br&gt;&lt;br&gt;iptables&nbsp;-A&nbsp;INPUT&nbsp;-s&nbsp;rabbitmq-test01&nbsp;-j&nbsp;DROP;&nbsp;iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-d&nbsp;rabbitmq-test01&nbsp;-j&nbsp;DROP&lt;br&gt;<br>
iptables&nbsp;-A&nbsp;INPUT&nbsp;-s&nbsp;rabbitmq-test02&nbsp;-j&nbsp;DROP;&nbsp;iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-d&nbsp;rabbitmq-test02&nbsp;-j&nbsp;DROP&lt;br&gt;&lt;br&gt;Then&nbsp;wait&nbsp;long&nbsp;enough&nbsp;for&nbsp;the&nbsp;following&nbsp;messages&nbsp;to&nbsp;appear&nbsp;in&nbsp;the&nbsp;logs&nbsp;of&nbsp;rabbitmq-test03&nbsp;(approximately&nbsp;180&nbsp;seconds):&lt;br&gt;<br>
&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;5-Mar-2014::16:51:02&nbsp;===&lt;br&gt;**&nbsp;Node&nbsp;&#39;rabbitmq@rabbitmq-test02&#39;&nbsp;not&nbsp;responding&nbsp;**&lt;br&gt;**&nbsp;Removing&nbsp;(timedout)&nbsp;connection&nbsp;**&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;5-Mar-2014::16:51:02&nbsp;===&lt;br&gt;**&nbsp;Node&nbsp;&#39;rabbitmq@rabbitmq-test01&#39;&nbsp;not&nbsp;responding&nbsp;**&lt;br&gt;<br>
**&nbsp;Removing&nbsp;(timedout)&nbsp;connection&nbsp;**&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:51:02&nbsp;===&lt;br&gt;rabbit&nbsp;on&nbsp;node&nbsp;&#39;rabbitmq@rabbitmq-test02&#39;&nbsp;down&lt;br&gt;=WARNING&nbsp;REPORT====&nbsp;5-Mar-2014::16:51:30&nbsp;===&lt;br&gt;Cluster&nbsp;minority&nbsp;status&nbsp;detected&nbsp;-&nbsp;awaiting&nbsp;recovery&lt;br&gt;<br>
=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:51:30&nbsp;===&lt;br&gt;rabbit&nbsp;on&nbsp;node&nbsp;&#39;rabbitmq@rabbitmq-test01&#39;&nbsp;down&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:51:30&nbsp;===&lt;br&gt;Stopping&nbsp;RabbitMQ&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:51:30&nbsp;===&lt;br&gt;stopped&nbsp;TCP&nbsp;Listener&nbsp;on&nbsp;[::]:5672&lt;br&gt;<br>
=WARNING&nbsp;REPORT====&nbsp;5-Mar-2014::16:51:58&nbsp;===&lt;br&gt;Cluster&nbsp;minority&nbsp;status&nbsp;detected&nbsp;-&nbsp;awaiting&nbsp;recovery&lt;br&gt;&lt;br&gt;When&nbsp;flushing&nbsp;the&nbsp;rules&nbsp;(iptables&nbsp;-F)&nbsp;the&nbsp;connectivity&nbsp;is&nbsp;reestablished&nbsp;and&nbsp;the&nbsp;cluster&nbsp;works&nbsp;perfectly.&lt;br&gt;&lt;br&gt;In&nbsp;the&nbsp;logs:&lt;br&gt;<br>
&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:52:58&nbsp;===&lt;br&gt;started&nbsp;TCP&nbsp;Listener&nbsp;on&nbsp;[::]:5672&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:52:58&nbsp;===&lt;br&gt;rabbit&nbsp;on&nbsp;node&nbsp;&#39;rabbitmq@rabbitmq-test01&#39;&nbsp;up&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:52:58&nbsp;===&lt;br&gt;<br>
rabbit&nbsp;on&nbsp;node&nbsp;&#39;rabbitmq@rabbitmq-test02&#39;&nbsp;up&lt;br&gt;&lt;br&gt;Finally&nbsp;the&nbsp;cluster&nbsp;status&nbsp;:&lt;br&gt;&lt;br&gt;Cluster&nbsp;status&nbsp;of&nbsp;node&nbsp;&#39;rabbitmq@rabbitmq-test03&#39;&nbsp;...&lt;br&gt;[{nodes,[{disc,[&#39;rabbitmq@rabbitmq-test01&#39;,&#39;rabbitmq@rabbitmq-test02&#39;,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;rabbitmq@rabbitmq-test03&#39;]}]},&lt;br&gt;&nbsp;{running_nodes,[&#39;rabbitmq@rabbitmq-test01&#39;,&#39;rabbitmq@rabbitmq-test02&#39;,&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;rabbitmq@rabbitmq-test03&#39;]},&lt;br&gt;&nbsp;{partitions,[]}]&lt;br&gt;<br>
...done.&lt;br&gt;&lt;br&gt;So&nbsp;far,&nbsp;so&nbsp;good.&nbsp;The&nbsp;option&nbsp;works&nbsp;flawlessly.&lt;br&gt;&lt;br&gt;PAUSE_MINORITY&nbsp;NOT&nbsp;WORKING&lt;br&gt;***********************************************************&lt;br&gt;&lt;br&gt;Life&nbsp;is&nbsp;not&nbsp;so&nbsp;bright&nbsp;when&nbsp;the&nbsp;network&nbsp;partition&nbsp;is&nbsp;not&nbsp;long&nbsp;enough.&lt;br&gt;<br>
&nbsp;&lt;br&gt;On&nbsp;rabbitmq-test03&nbsp;I&nbsp;will&nbsp;run&nbsp;my&nbsp;iptables&nbsp;commands&nbsp;again:&lt;br&gt;&lt;br&gt;iptables&nbsp;-A&nbsp;INPUT&nbsp;-s&nbsp;rabbitmq-test01&nbsp;-j&nbsp;DROP;&nbsp;iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-d&nbsp;rabbitmq-test01&nbsp;-j&nbsp;DROP&lt;br&gt;iptables&nbsp;-A&nbsp;INPUT&nbsp;-s&nbsp;rabbitmq-test02&nbsp;-j&nbsp;DROP;&nbsp;iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-d&nbsp;rabbitmq-test02&nbsp;-j&nbsp;DROP&lt;br&gt;<br>
&lt;br&gt;However&nbsp;this&nbsp;time&nbsp;I&#39;ll&nbsp;only&nbsp;wait&nbsp;60&nbsp;seconds&nbsp;before&nbsp;flushing&nbsp;my&nbsp;rules&nbsp;with&nbsp;iptables&nbsp;-F.&lt;br&gt;&lt;br&gt;And&nbsp;that&#39;s&nbsp;the&nbsp;result&nbsp;in&nbsp;rabbitmq-test03&nbsp;logs:&lt;br&gt;&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:55:00&nbsp;===&lt;br&gt;rabbit&nbsp;on&nbsp;node&nbsp;&#39;rabbitmq@rabbitmq-test02&#39;&nbsp;down&lt;br&gt;<br>
=ERROR&nbsp;REPORT====&nbsp;5-Mar-2014::16:55:00&nbsp;===&lt;br&gt;Mnesia(&#39;rabbitmq@rabbitmq-test03&#39;):&nbsp;**&nbsp;ERROR&nbsp;**&nbsp;mnesia_event&nbsp;got&nbsp;{inconsistent_database,&nbsp;running_partitioned_network,&nbsp;&#39;rabbitmq@rabbitmq-test02&#39;}&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:55:00&nbsp;===&lt;br&gt;<br>
rabbit&nbsp;on&nbsp;node&nbsp;&#39;rabbitmq@rabbitmq-test01&#39;&nbsp;down&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:55:00&nbsp;===&lt;br&gt;Statistics&nbsp;database&nbsp;started.&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:55:00&nbsp;===&lt;br&gt;Statistics&nbsp;database&nbsp;started.&lt;br&gt;&lt;br&gt;Again,&nbsp;the&nbsp;result&nbsp;is&nbsp;quiet&nbsp;ugly&nbsp;on&nbsp;rabbitmq-test01:&lt;br&gt;<br>
&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;5-Mar-2014::16:55:00&nbsp;===&lt;br&gt;**&nbsp;Node&nbsp;&#39;rabbitmq@rabbitmq-test03&#39;&nbsp;not&nbsp;responding&nbsp;**&lt;br&gt;**&nbsp;Removing&nbsp;(timedout)&nbsp;connection&nbsp;**&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:55:00&nbsp;===&lt;br&gt;rabbit&nbsp;on&nbsp;node&nbsp;&#39;rabbitmq@rabbitmq-test03&#39;&nbsp;down&lt;br&gt;<br>
=INFO&nbsp;REPORT====&nbsp;5-Mar-2014::16:55:01&nbsp;===&lt;br&gt;global:&nbsp;Name&nbsp;conflict&nbsp;terminating&nbsp;{rabbit_mgmt_db,&lt;2669.1582.0&gt;}&lt;br&gt;&lt;br&gt;Finally&nbsp;my&nbsp;cluster&nbsp;status:&lt;br&gt;&lt;br&gt;Cluster&nbsp;status&nbsp;of&nbsp;node&nbsp;&#39;rabbitmq@rabbitmq-test03&#39;&nbsp;...&lt;br&gt;<br>
[{nodes,[{disc,[&#39;rabbitmq@rabbitmq-test01&#39;,&#39;rabbitmq@rabbitmq-test02&#39;,&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;rabbitmq@rabbitmq-test03&#39;]}]},&lt;br&gt;&nbsp;{running_nodes,[&#39;rabbitmq@rabbitmq-test03&#39;]},&lt;br&gt;&nbsp;{partitions,[{&#39;rabbitmq@rabbitmq-test03&#39;,[&#39;rabbitmq@rabbitmq-test02&#39;]}]}]&lt;br&gt;<br>
...done.&lt;br&gt;&lt;br&gt;That&#39;s&nbsp;it.&nbsp;Even&nbsp;with&nbsp;the&nbsp;pause_minority&nbsp;option&nbsp;my&nbsp;cluster&nbsp;was&nbsp;disintegrated.&lt;br&gt;&lt;br&gt;SYNOPSIS&lt;br&gt;***********************************************************&lt;br&gt;&lt;br&gt;In&nbsp;short,&nbsp;if&nbsp;the&nbsp;network&nbsp;outage&nbsp;is&nbsp;long&nbsp;enough&nbsp;everything&nbsp;goes&nbsp;according&nbsp;to&nbsp;the&nbsp;plan&nbsp;and&nbsp;the&nbsp;cluster&nbsp;works&nbsp;perfectly&nbsp;once&nbsp;the&nbsp;connectivity&nbsp;is&nbsp;reestablished.&nbsp;However&nbsp;if&nbsp;the&nbsp;network&nbsp;outage&nbsp;has&nbsp;a&nbsp;intermediate&nbsp;duration&nbsp;(not&nbsp;too&nbsp;short,&nbsp;not&nbsp;too&nbsp;long)&nbsp;the&nbsp;pause_minority&nbsp;option&nbsp;seems&nbsp;not&nbsp;to&nbsp;work.&lt;br&gt;<br>
&lt;br&gt;Are&nbsp;you&nbsp;aware&nbsp;of&nbsp;this&nbsp;problem?&nbsp;Is&nbsp;there&nbsp;any&nbsp;solution&nbsp;to&nbsp;cope&nbsp;with&nbsp;this&nbsp;particular&nbsp;situation?&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;David&lt;br&gt;&lt;/div&gt;<br>

</tt>
