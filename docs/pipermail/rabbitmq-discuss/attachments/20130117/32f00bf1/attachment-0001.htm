<tt>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hey&nbsp;Simon,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&nbsp;style=&quot;color:&nbsp;#A0A0A8;&quot;&gt;On&nbsp;Thursday,&nbsp;17&nbsp;January&nbsp;2013&nbsp;at&nbsp;11:20,&nbsp;Simon&nbsp;MacMullen&nbsp;wrote:&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;border-left-style:solid;border-width:1px;margin-left:0px;padding-left:10px;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;&lt;div&gt;Yes,&nbsp;but&nbsp;that&nbsp;shouldn't&nbsp;be&nbsp;too&nbsp;problematic&nbsp;-&nbsp;while&nbsp;all&nbsp;our&nbsp;auth&nbsp;&lt;/div&gt;&lt;div&gt;mechanisms&nbsp;invoke&nbsp;rabbit_access_control:check_user_pass_login/2&nbsp;or&nbsp;&lt;/div&gt;&lt;div&gt;similar&nbsp;(which&nbsp;ends&nbsp;up&nbsp;looking&nbsp;up&nbsp;and&nbsp;driving&nbsp;auth&nbsp;backends),&nbsp;you&nbsp;could&nbsp;&lt;/div&gt;&lt;div&gt;write&nbsp;an&nbsp;auth&nbsp;mechanism&nbsp;which&nbsp;either&nbsp;drives&nbsp;an&nbsp;auth&nbsp;backend&nbsp;directly,&nbsp;or&nbsp;&lt;/div&gt;&lt;div&gt;contains&nbsp;its&nbsp;own&nbsp;auth&nbsp;backend.&nbsp;Then&nbsp;it&nbsp;can&nbsp;do&nbsp;whatever&nbsp;it&nbsp;wants&nbsp;-&nbsp;the&nbsp;&lt;/div&gt;&lt;div&gt;contract&nbsp;of&nbsp;an&nbsp;auth&nbsp;mechanism&nbsp;is&nbsp;to&nbsp;reject&nbsp;login&nbsp;or&nbsp;provide&nbsp;a&nbsp;user.&lt;/div&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;div&gt;Since&nbsp;I&nbsp;posted&nbsp;a&nbsp;number&nbsp;of&nbsp;times&nbsp;into&nbsp;this&nbsp;thread,&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;which&nbsp;question&nbsp;you&nbsp;are&nbsp;answering&nbsp;here.&nbsp;My&nbsp;latest&nbsp;question&nbsp;was&nbsp;about&nbsp;the&nbsp;fact&nbsp;that&nbsp;I&nbsp;could&nbsp;encode&nbsp;the&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;username;&lt;/li&gt;&lt;li&gt;password;&lt;/li&gt;&lt;li&gt;vhost;&lt;/li&gt;&lt;li&gt;(optional)&nbsp;radius&nbsp;token,&nbsp;depending&nbsp;on&nbsp;whether&nbsp;the&nbsp;specified&nbsp;vhost&nbsp;is&nbsp;subject&nbsp;to&nbsp;a&nbsp;extra&nbsp;token&nbsp;verification&nbsp;or&nbsp;not;&lt;/li&gt;&lt;/ul&gt;into&nbsp;the&nbsp;SASL&nbsp;payload&nbsp;and&nbsp;my&nbsp;custom&nbsp;rabbit_auth_mechanism&nbsp;would&nbsp;decode&nbsp;this,&nbsp;and&nbsp;decide&nbsp;based&nbsp;on&nbsp;the&nbsp;vhost&nbsp;supplied&nbsp;whether&nbsp;to&nbsp;perform&nbsp;a&nbsp;lookup&nbsp;on&nbsp;the&nbsp;token.&nbsp;All&nbsp;of&nbsp;this&nbsp;is&nbsp;up&nbsp;to&nbsp;this&nbsp;custom&nbsp;implementation.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;I&nbsp;don't&nbsp;understand&nbsp;about&nbsp;your&nbsp;observation&nbsp;may&nbsp;stem&nbsp;from&nbsp;my&nbsp;misunderstanding&nbsp;the&nbsp;flow&nbsp;of&nbsp;the&nbsp;handshake&nbsp;during&nbsp;AMQP&nbsp;connection&nbsp;establishment.&nbsp;I&nbsp;was&nbsp;assuming&nbsp;that&nbsp;due&nbsp;to&nbsp;the&nbsp;sequence&nbsp;of&nbsp;AMQP&nbsp;frames&nbsp;defined&nbsp;in&nbsp;the&nbsp;protocol,&nbsp;Rabbit&nbsp;would&nbsp;initially&nbsp;delegate&nbsp;the&nbsp;authentication&nbsp;to&nbsp;my&nbsp;custom&amp;nbsp;rabbit_auth_mechanism,&nbsp;which&nbsp;could&nbsp;present&nbsp;vhost&nbsp;X.&nbsp;Once&nbsp;this&nbsp;callback&nbsp;has&nbsp;successfully&nbsp;done&nbsp;everything&nbsp;it&nbsp;needs&nbsp;to&nbsp;do&nbsp;and&nbsp;returns&nbsp;a&nbsp;user&nbsp;back&nbsp;to&nbsp;Rabbit,&nbsp;then&nbsp;the&nbsp;client&nbsp;would&nbsp;be&nbsp;able&nbsp;to&nbsp;send&nbsp;a&nbsp;connection.open&nbsp;frame.&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;client&nbsp;could&nbsp;potentially&nbsp;encode&nbsp;vhost&nbsp;Y&nbsp;into&nbsp;that&nbsp;frame,&nbsp;and&nbsp;hence&nbsp;effectively&nbsp;by-pass&nbsp;the&nbsp;logic&nbsp;of&nbsp;the&amp;nbsp;custom&nbsp;rabbit_auth_mechanism.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Maybe&nbsp;I'm&nbsp;missing&nbsp;the&nbsp;point&nbsp;here.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Having&nbsp;said&nbsp;all&nbsp;of&nbsp;this,&nbsp;in&nbsp;the&nbsp;meantime&nbsp;I've&nbsp;come&nbsp;up&nbsp;with&nbsp;an&nbsp;alternative&nbsp;solution&nbsp;-&nbsp;just&nbsp;run&nbsp;separate&nbsp;Rabbit&nbsp;instances&nbsp;for&nbsp;each&nbsp;vhost.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ben&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</tt>
