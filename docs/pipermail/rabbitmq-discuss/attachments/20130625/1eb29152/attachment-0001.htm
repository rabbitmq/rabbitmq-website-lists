<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;Thomas,&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;25&nbsp;Jun&nbsp;2013,&nbsp;at&nbsp;07:28,&nbsp;thomas&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;I&nbsp;have&nbsp;set&nbsp;up&nbsp;3&nbsp;cluster&nbsp;nodes&nbsp;namely&nbsp;rabbit@A,&nbsp;rabbit@B,&nbsp;rabbit@C&nbsp;all&nbsp;running&lt;br&gt;on&nbsp;erlang&nbsp;16B&nbsp;and&nbsp;rabbitmq&nbsp;3.1.1.&nbsp;I&nbsp;set&nbsp;net_ticktime&nbsp;to&nbsp;2&nbsp;so&nbsp;as&nbsp;to&nbsp;detect&lt;br&gt;node&nbsp;failure&nbsp;faster.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That's&nbsp;a&nbsp;bit&nbsp;excessive&nbsp;I&nbsp;think.&nbsp;Let&nbsp;me&nbsp;quote&nbsp;Erlang's&nbsp;net_kernel&nbsp;man&nbsp;page&nbsp;for&nbsp;a&nbsp;moment:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;lt;quote&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;dt&gt;&lt;strong&gt;&lt;span&nbsp;class=&quot;code&quot;&gt;net_ticktime&nbsp;=&nbsp;TickTime&lt;/span&gt;&lt;/strong&gt;&lt;/dt&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;dd&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;name=&quot;net_ticktime&quot;&gt;&lt;/a&gt;&lt;p&gt;Specifies&nbsp;the&nbsp;&lt;span&nbsp;class=&quot;code&quot;&gt;net_kernel&lt;/span&gt;&nbsp;tick&nbsp;time.&nbsp;&lt;span&nbsp;class=&quot;code&quot;&gt;TickTime&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;given&nbsp;in&nbsp;seconds.&nbsp;Once&nbsp;every&nbsp;&lt;span&nbsp;class=&quot;code&quot;&gt;TickTime/4&lt;/span&gt;&nbsp;second,&nbsp;all<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connected&nbsp;nodes&nbsp;are&nbsp;ticked&nbsp;(if&nbsp;anything&nbsp;else&nbsp;has&nbsp;been&nbsp;written<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;a&nbsp;node)&nbsp;and&nbsp;if&nbsp;nothing&nbsp;has&nbsp;been&nbsp;received&nbsp;from&nbsp;another&nbsp;node<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;within&nbsp;the&nbsp;last&nbsp;four&nbsp;(4)&nbsp;tick&nbsp;times&nbsp;that&nbsp;node&nbsp;is&nbsp;considered<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;be&nbsp;down.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;nodes&nbsp;which&nbsp;are&nbsp;not&nbsp;responding,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;reasons&nbsp;such&nbsp;as&nbsp;hardware&nbsp;errors,&nbsp;are&nbsp;considered&nbsp;to&nbsp;be<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;down.&lt;/p&gt;&lt;p&gt;The&nbsp;time&nbsp;&lt;span&nbsp;class=&quot;code&quot;&gt;T&lt;/span&gt;,&nbsp;in&nbsp;which&nbsp;a&nbsp;node&nbsp;that&nbsp;is&nbsp;not&nbsp;responding&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;detected,&nbsp;is&nbsp;calculated&nbsp;as:&nbsp;&lt;span&nbsp;class=&quot;code&quot;&gt;MinT&nbsp;&amp;lt;&nbsp;T&nbsp;&amp;lt;&nbsp;MaxT&lt;/span&gt;&nbsp;where:&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;example&quot;&gt;&lt;pre&gt;MinT&nbsp;=&nbsp;TickTime&nbsp;-&nbsp;TickTime&nbsp;/&nbsp;4<br>
MaxT&nbsp;=&nbsp;TickTime&nbsp;+&nbsp;TickTime&nbsp;/&nbsp;4&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;span&nbsp;class=&quot;code&quot;&gt;TickTime&lt;/span&gt;&nbsp;is&nbsp;by&nbsp;default&nbsp;60&nbsp;(seconds).&nbsp;Thus,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;code&quot;&gt;45&nbsp;&amp;lt;&nbsp;T&nbsp;&amp;lt;&nbsp;75&lt;/span&gt;&nbsp;seconds.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;&nbsp;All&nbsp;communicating&nbsp;nodes&nbsp;should&nbsp;have&nbsp;the&nbsp;same&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;code&quot;&gt;TickTime&lt;/span&gt;&nbsp;value&nbsp;specified.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;&nbsp;Normally,&nbsp;a&nbsp;terminating&nbsp;node&nbsp;is&nbsp;detected<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;immediately.&lt;/p&gt;&lt;/dd&gt;&lt;/div&gt;&amp;lt;/quote&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;you're&nbsp;increasing&nbsp;the&nbsp;requirement&nbsp;for&nbsp;nodes&nbsp;to&nbsp;ping&nbsp;one&nbsp;another&nbsp;every&nbsp;2&nbsp;/&nbsp;4&nbsp;seconds,&nbsp;i.e.,&nbsp;every&nbsp;500&nbsp;milliseconds.&nbsp;You're&nbsp;also&nbsp;sending&nbsp;200k&nbsp;messages&nbsp;to&nbsp;a&nbsp;node&nbsp;and&nbsp;expecting&nbsp;HA&nbsp;to&nbsp;distribute&nbsp;those&nbsp;messages&nbsp;across&nbsp;all&nbsp;your&nbsp;nodes,&nbsp;which&nbsp;happens&nbsp;over&nbsp;the&nbsp;same&nbsp;distribution&nbsp;channel&nbsp;as&nbsp;that&nbsp;TickTime&nbsp;message.&nbsp;So&nbsp;I&nbsp;suspect&nbsp;you're&nbsp;not&nbsp;doing&nbsp;yourself&nbsp;any&nbsp;favours&nbsp;here.&nbsp;I'd&nbsp;suggest&nbsp;that&nbsp;*if&nbsp;you&nbsp;must*&nbsp;change&nbsp;net_ticktime&nbsp;(and&nbsp;personally&nbsp;I&nbsp;would&nbsp;leave&nbsp;it&nbsp;alone&nbsp;if&nbsp;I&nbsp;were&nbsp;you)&nbsp;then&nbsp;you&nbsp;should&nbsp;set&nbsp;it&nbsp;to&nbsp;maybe&nbsp;45&nbsp;seconds,&nbsp;but&nbsp;not&nbsp;to&nbsp;2&nbsp;seconds&nbsp;-&nbsp;that's&nbsp;almost&nbsp;guaranteed&nbsp;to&nbsp;end&nbsp;up&nbsp;in&nbsp;weird&nbsp;behaviour.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;2)For&nbsp;my&nbsp;2nd&nbsp;test,&nbsp;it&nbsp;is&nbsp;almost&nbsp;identical&nbsp;to&nbsp;the&nbsp;1st&nbsp;test&nbsp;except&nbsp;that&nbsp;i&nbsp;am&lt;br&gt;using&nbsp;mirroring&nbsp;using&nbsp;the&nbsp;following&nbsp;command:&lt;br&gt;&lt;br&gt;rabbitmqctl&nbsp;set_policy&nbsp;HA&nbsp;'^(?!amq\.).*'&nbsp;'{&quot;ha-mode&quot;:&nbsp;&quot;all&quot;}'&quot;&lt;br&gt;&lt;br&gt;The&nbsp;observation&nbsp;is&nbsp;different&nbsp;from&nbsp;that&nbsp;of&nbsp;the&nbsp;1st&nbsp;test.&nbsp;Shortly&nbsp;after&nbsp;I&nbsp;cut&lt;br&gt;off&nbsp;the&nbsp;network&nbsp;connection&nbsp;from&nbsp;rabbit@B,&nbsp;rabbit@A&nbsp;which&nbsp;is&nbsp;the&nbsp;master&lt;br&gt;handling&nbsp;the&nbsp;client's&nbsp;messages&nbsp;comes&nbsp;to&nbsp;a&nbsp;pause&nbsp;for&nbsp;over&nbsp;15&nbsp;seconds&nbsp;and&nbsp;the&lt;br&gt;pause&nbsp;is&nbsp;consistent&nbsp;for&nbsp;10&nbsp;tries.&nbsp;The&nbsp;client&nbsp;gets&nbsp;stuck&nbsp;in&nbsp;basic&nbsp;publish&lt;br&gt;when&nbsp;rabbit@A&nbsp;comes&nbsp;to&nbsp;a&nbsp;pause.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;I&nbsp;am&nbsp;quite&nbsp;puzzled&nbsp;about&nbsp;this&nbsp;behavior&nbsp;and&nbsp;would&nbsp;like&nbsp;to&nbsp;find&nbsp;out&nbsp;if&nbsp;that&nbsp;is&lt;br&gt;the&nbsp;intended&nbsp;behavior&nbsp;for&nbsp;rabbit's&nbsp;mirroring&nbsp;feature?&nbsp;Does&nbsp;anyone&nbsp;else&lt;br&gt;encounter&nbsp;such&nbsp;behavior&nbsp;when&nbsp;using&nbsp;mirroring?&nbsp;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;version&nbsp;of&nbsp;rabbit&nbsp;are&nbsp;you&nbsp;using?&nbsp;Do&nbsp;you&nbsp;have&nbsp;a&nbsp;cluster&nbsp;auto-recovery&nbsp;(i.e.,&nbsp;autoheal)&nbsp;set&nbsp;up,&nbsp;and&nbsp;if&nbsp;so,&nbsp;which&nbsp;mode&nbsp;are&nbsp;you&nbsp;using?&nbsp;Some&nbsp;delay&nbsp;(which&nbsp;blocks&nbsp;publishers&nbsp;temporarily)&nbsp;is&nbsp;possible&nbsp;during&nbsp;failover,&nbsp;but&nbsp;also&nbsp;if&nbsp;you've&nbsp;got&nbsp;autoheal&nbsp;set&nbsp;up,&nbsp;then&nbsp;node&nbsp;can&nbsp;be&nbsp;restarted&nbsp;and&nbsp;waiting&nbsp;(for&nbsp;node&nbsp;restarts)&nbsp;can&nbsp;occur.&amp;nbsp;Remember&nbsp;that&nbsp;a&nbsp;cluster&nbsp;partition&nbsp;is&nbsp;a&amp;nbsp;serious&nbsp;problem,&nbsp;which&nbsp;rabbitmq&nbsp;clusters&nbsp;are&nbsp;/not/&nbsp;tolerant&nbsp;of.&nbsp;If&nbsp;you're&nbsp;expecting&nbsp;partitions,&nbsp;you&nbsp;should&nbsp;consider&nbsp;using&nbsp;the&nbsp;federation&nbsp;or&nbsp;shovel&nbsp;plugins&nbsp;instead.&nbsp;Automatic&nbsp;cluster&nbsp;partition&nbsp;recovery&nbsp;is&nbsp;there&nbsp;to&nbsp;help,&nbsp;but&nbsp;isn't&nbsp;a&nbsp;panacea.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Tim&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
