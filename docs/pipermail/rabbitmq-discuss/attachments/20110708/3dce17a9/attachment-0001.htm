<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Jul&nbsp;7,&nbsp;2011&nbsp;at&nbsp;6:34&nbsp;AM,&nbsp;Rob&nbsp;Harrop&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:rob@rabbitmq.com&quot;&gt;rob@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
&lt;div&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;Well,&nbsp;it&amp;#39;s&nbsp;quite&nbsp;subtle.&nbsp;If&nbsp;the&nbsp;message&nbsp;was&nbsp;routed&nbsp;when&nbsp;the&nbsp;queue&nbsp;was&nbsp;up,&nbsp;a&nbsp;back&nbsp;is&nbsp;sent&nbsp;if&nbsp;the&nbsp;queue&nbsp;goes&nbsp;down&nbsp;before&nbsp;the&nbsp;message&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;disk.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;the&nbsp;binding&nbsp;has&nbsp;been&nbsp;removed&nbsp;due&nbsp;to&nbsp;queue&nbsp;down&nbsp;then&nbsp;no&nbsp;nack&nbsp;will&nbsp;be&nbsp;sent.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Are&nbsp;you&nbsp;trying&nbsp;to&nbsp;ensure&nbsp;that&nbsp;a&nbsp;given&nbsp;message&nbsp;reaches&nbsp;a&nbsp;known&nbsp;set&nbsp;of&nbsp;queues?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes&nbsp;and&nbsp;no.&nbsp; As&nbsp;I&nbsp;said,&nbsp;for&nbsp;any&nbsp;one&nbsp;message&nbsp;there&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;be&nbsp;binding&nbsp;matching&nbsp;the&nbsp;message&nbsp;to&nbsp;the&nbsp;durable&nbsp;queue.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;is&nbsp;as&nbsp;follows:&nbsp; We&nbsp;have&nbsp;a&nbsp;system&nbsp;that&nbsp;generates&nbsp;events.&nbsp; We&nbsp;have&nbsp;a&nbsp;set&nbsp;of&nbsp;users&nbsp;that&nbsp;may&nbsp;be&nbsp;interested&nbsp;in&nbsp;some&nbsp;subset&nbsp;of&nbsp;those&nbsp;events.&nbsp; What&nbsp;events&nbsp;the&nbsp;users&nbsp;are&nbsp;interested&nbsp;in&nbsp;changes&nbsp;dynamically.&nbsp; We&nbsp;have&nbsp;an&nbsp;agent&nbsp;subscribed&nbsp;to&nbsp;a&nbsp;durable&nbsp;queue&nbsp;that&nbsp;will&nbsp;receive&nbsp;the&nbsp;events&nbsp;of&nbsp;interest&nbsp;and&nbsp;process&nbsp;them&nbsp;on&nbsp;behalf&nbsp;of&nbsp;the&nbsp;users.&nbsp; The&nbsp;bindings&nbsp;on&nbsp;the&nbsp;topic&nbsp;exchange&nbsp;that&nbsp;match&nbsp;the&nbsp;events&nbsp;to&nbsp;the&nbsp;queue&nbsp;change&nbsp;dynamically&nbsp;with&nbsp;the&nbsp;user&amp;#39;s&nbsp;interests.&nbsp; I&nbsp;need&nbsp;to&nbsp;know&nbsp;that&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;binding&nbsp;for&nbsp;the&nbsp;event,&nbsp;that&nbsp;it&nbsp;was&nbsp;successfully&nbsp;persisted&nbsp;to&nbsp;the&nbsp;queue.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;want&nbsp;to&nbsp;ensure&nbsp;that,&nbsp;if&nbsp;the&nbsp;queue&nbsp;is&nbsp;reachable&nbsp;and&nbsp;there&nbsp;is&nbsp;a&nbsp;binding&nbsp;that&nbsp;matches&nbsp;the&nbsp;message&nbsp;to&nbsp;the&nbsp;queue,&nbsp;or&nbsp;the&nbsp;queue&nbsp;is&nbsp;reachable&nbsp;and&nbsp;there&nbsp;is&nbsp;no&nbsp;binding&nbsp;that&nbsp;matches&nbsp;the&nbsp;message&nbsp;to&nbsp;the&nbsp;queue,&nbsp;(i.e.&nbsp;that&nbsp;the&nbsp;cluster&nbsp;is&nbsp;working&nbsp;properly)&nbsp;that&nbsp;the&nbsp;producer&nbsp;will&nbsp;get&nbsp;an&nbsp;ack.&nbsp; Publisher&nbsp;confirm&nbsp;gives&nbsp;us&nbsp;this.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;want&nbsp;to&nbsp;ensure&nbsp;that,&nbsp;if&nbsp;the&nbsp;queue&nbsp;is&nbsp;not&nbsp;reachable&nbsp;and&nbsp;there&nbsp;is&nbsp;a&nbsp;binding&nbsp;that&nbsp;matches&nbsp;the&nbsp;message&nbsp;to&nbsp;the&nbsp;queue,&nbsp;or&nbsp;the&nbsp;queue&nbsp;is&nbsp;not&nbsp;reachable&nbsp;and&nbsp;there&nbsp;is&nbsp;no&nbsp;binding&nbsp;that&nbsp;matches&nbsp;the&nbsp;message&nbsp;to&nbsp;the&nbsp;queue,&nbsp;(i.e.&nbsp;that&nbsp;the&nbsp;cluster&nbsp;has&nbsp;lost&nbsp;the&nbsp;node&nbsp;to&nbsp;which&nbsp;the&nbsp;queue&nbsp;is&nbsp;attached&nbsp;or&nbsp;the&nbsp;queue&nbsp;was&nbsp;deleted),&nbsp;that&nbsp;the&nbsp;producer&nbsp;will&nbsp;get&nbsp;a&nbsp;nack.&nbsp; Publisher&nbsp;confirm&nbsp;fails&nbsp;here.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Publisher&nbsp;confirm&nbsp;fails&nbsp;the&nbsp;second&nbsp;requirement&nbsp;because&nbsp;if&nbsp;the&nbsp;cluster&nbsp;is&nbsp;partitioned,&nbsp;it&nbsp;will&nbsp;forget&nbsp;the&nbsp;bindings&nbsp;to&nbsp;the&nbsp;queue&nbsp;on&nbsp;the&nbsp;other&nbsp;node.&nbsp; It&nbsp;will&nbsp;response&nbsp;with&nbsp;an&nbsp;ack,&nbsp;rather&nbsp;than&nbsp;a&nbsp;nack.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;is&nbsp;needed&nbsp;is&nbsp;a&nbsp;way&nbsp;to&nbsp;define&nbsp;a&nbsp;binding&nbsp;as&nbsp;durable,&nbsp;so&nbsp;that&nbsp;it&nbsp;won&amp;#39;t&nbsp;be&nbsp;forgotten&nbsp;if&nbsp;the&nbsp;queue&nbsp;is&nbsp;references&nbsp;goes&nbsp;away&nbsp;because&nbsp;of&nbsp;a&nbsp;cluster&nbsp;partition&nbsp;or&nbsp;the&nbsp;queue&nbsp;is&nbsp;deleted.&nbsp; It&nbsp;gives&nbsp;the&nbsp;system&nbsp;a&nbsp;hint&nbsp;that&nbsp;the&nbsp;queue&nbsp;in&nbsp;question&nbsp;should&nbsp;exist,&nbsp;but&nbsp;does&nbsp;not.&nbsp; Alternatively,&nbsp;the&nbsp;system&nbsp;should&nbsp;not&nbsp;forget&nbsp;a&nbsp;durable&nbsp;queue&nbsp;just&nbsp;because&nbsp;the&nbsp;node&nbsp;it&nbsp;was&nbsp;attached&nbsp;goes&nbsp;away.&nbsp; A&nbsp;durable&nbsp;queue&nbsp;should&nbsp;only&nbsp;be&nbsp;forgotten&nbsp;if&nbsp;it&nbsp;is&nbsp;actively&nbsp;deleted.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;HA&nbsp;queue&nbsp;alleviate&nbsp;the&nbsp;problem,&nbsp;as&nbsp;the&nbsp;queue&nbsp;will&nbsp;exist&nbsp;in&nbsp;more&nbsp;nodes&nbsp;and&nbsp;more&nbsp;nodes&nbsp;would&nbsp;have&nbsp;to&nbsp;disappear&nbsp;for&nbsp;it&nbsp;to&nbsp;be&nbsp;forgotten,&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;solve&nbsp;the&nbsp;problem,&nbsp;unless&nbsp;the&nbsp;queue&nbsp;is&nbsp;configured&nbsp;to&nbsp;exist&nbsp;on&nbsp;all&nbsp;nodes.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Savvy?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Elias&nbsp;Levy&lt;/div&gt;&lt;/div&gt;<br>

</tt>
