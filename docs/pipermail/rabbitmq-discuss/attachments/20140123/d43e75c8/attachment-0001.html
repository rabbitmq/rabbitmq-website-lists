<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;for&nbsp;the&nbsp;info!&nbsp;I&nbsp;read&nbsp;the&nbsp;article,&nbsp;but&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;implementation&nbsp;since&nbsp;it&nbsp;seems&nbsp;to&nbsp;be&nbsp;kind&nbsp;of&nbsp;experimental&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;mantain&nbsp;the&nbsp;app&nbsp;as&nbsp;stable&nbsp;as&nbsp;possible,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regarding&nbsp;the&nbsp;prefetch&nbsp;count,&nbsp;I&#39;m&nbsp;not&nbsp;really&nbsp;sure&nbsp;about&nbsp;how&nbsp;it&nbsp;works&nbsp;in&nbsp;the&nbsp;.net&nbsp;version.&nbsp;I&#39;ve&nbsp;tried&nbsp;with&nbsp;this&nbsp;code&nbsp;_channel.BasicQos(0,&nbsp;50,&nbsp;false)&nbsp;and&nbsp;the&nbsp;only&nbsp;difference&nbsp;I&nbsp;see&nbsp;is&nbsp;that&nbsp;unacked&nbsp;messages&nbsp;ratio&nbsp;keep&nbsp;constant.&nbsp;But&nbsp;there&#39;s&nbsp;no&nbsp;performance&nbsp;improvement.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&#39;re&nbsp;using: &lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;RabbitMQ&nbsp;3.2.2, &lt;/span&gt;&lt;acronym&nbsp;class=&quot;&quot;&nbsp;title=&quot;Erlang&nbsp;R16B03&nbsp;(erts-5.10.4)&nbsp;[64-bit]&nbsp;[smp:4:4]&nbsp;[async-threads:30]&quot;&nbsp;style=&quot;background-image:none;color:rgb(68,68,68);padding:0px;border-top-left-radius:2px;border-top-right-radius:2px;border-bottom-right-radius:2px;border-bottom-left-radius:2px;border-style:none&nbsp;none&nbsp;dotted;border-bottom-width:1px;font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;Erlang&nbsp;R16B03&lt;/acronym&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Setting&nbsp;prefetch&nbsp;count&nbsp;before&nbsp;consuming&nbsp;data:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Deliver&nbsp;24/s&lt;/div&gt;&lt;div&gt;Ack&nbsp;20~24/s&lt;/div&gt;&lt;div&gt;Published&nbsp;1600/s&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Without&nbsp;prefetch&nbsp;count:&lt;/b&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;Deliver&nbsp;10~30/s&lt;/div&gt;&lt;div&gt;Ack&nbsp;20~30/s&lt;/div&gt;&lt;div&gt;Published&nbsp;1600/s&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;we&nbsp;decreased&nbsp;the&nbsp;publish&nbsp;ratio&nbsp;(by&nbsp;adding&nbsp;sleep&nbsp;after&nbsp;sending&nbsp;each&nbsp;message)&nbsp;we&nbsp;could&nbsp;increase&nbsp;the&nbsp;deliver&nbsp;ratio&nbsp;up&nbsp;to&nbsp;90/s,&nbsp;but&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;messages&nbsp;within&nbsp;ready&nbsp;state&nbsp;start&nbsp;growing,&nbsp;the&nbsp;deliver&nbsp;ratio&nbsp;decreases&nbsp;to&nbsp;20/s&nbsp;again.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!!!&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;Anni..&lt;/div&gt;<br>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2014/1/22&nbsp;Alvaro&nbsp;Videla&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:videlalvaro@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;videlalvaro@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
Have&nbsp;you&nbsp;considered&nbsp;the&nbsp;approaches&nbsp;explained&nbsp;here:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/&lt;/a&gt;&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
Also&nbsp;I&nbsp;think&nbsp;people&nbsp;could&nbsp;help&nbsp;you&nbsp;a&nbsp;bit&nbsp;more&nbsp;if&nbsp;you&nbsp;shared&nbsp;some&lt;br&gt;<br>
numbers&nbsp;about&nbsp;number&nbsp;of&nbsp;messages,&nbsp;consumers,&nbsp;RabbitMQ&nbsp;and&nbsp;Erlang&lt;br&gt;<br>
versions,&nbsp;and&nbsp;so&nbsp;on.&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;<br>
&lt;br&gt;<br>
Alvaro&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Wed,&nbsp;Jan&nbsp;22,&nbsp;2014&nbsp;at&nbsp;9:51&nbsp;PM,&nbsp;Anahi&nbsp;Hojnadel&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;mailto:anahi.hojnadel@gmail.com&quot;&gt;anahi.hojnadel@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;guys!&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;We&nbsp;have&nbsp;an&nbsp;application&nbsp;that&nbsp;has&nbsp;a&nbsp;publisher&nbsp;which&nbsp;sends&nbsp;messages&nbsp;to&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;consumer&nbsp;which&nbsp;process&nbsp;those&nbsp;messages&nbsp;and&nbsp;then&nbsp;stores&nbsp;them&nbsp;in&nbsp;the&nbsp;DB.&lt;br&gt;<br>
&gt;&nbsp;Everything&nbsp;is&nbsp;working&nbsp;fine&nbsp;up&nbsp;to&nbsp;now,&nbsp;but&nbsp;the&nbsp;number&nbsp;of&nbsp;messages&nbsp;we&#39;re&lt;br&gt;<br>
&gt;&nbsp;receiving&nbsp;is&nbsp;getting&nbsp;bigger&nbsp;and&nbsp;performance&nbsp;is&nbsp;quite&nbsp;bad.&nbsp;We&nbsp;started&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;analize&nbsp;where&nbsp;the&nbsp;bottleneck&nbsp;was&nbsp;and&nbsp;it&nbsp;seems&nbsp;to&nbsp;be&nbsp;in&nbsp;rabbit&nbsp;queues.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;ve&nbsp;been&nbsp;reading&nbsp;many&nbsp;posts&nbsp;in&nbsp;Rabbit&#39;s&nbsp;blog&nbsp;about&nbsp;optimization&nbsp;but&nbsp;I&lt;br&gt;<br>
&gt;&nbsp;couldn&#39;t&nbsp;find&nbsp;how&nbsp;to&nbsp;solve&nbsp;the&nbsp;problem.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;main&nbsp;problem&nbsp;is&nbsp;that&nbsp;we&#39;re&nbsp;publishing&nbsp;messages&nbsp;faster&nbsp;than&nbsp;we&nbsp;can&lt;br&gt;<br>
&gt;&nbsp;consume&nbsp;them.&nbsp;When&nbsp;the&nbsp;number&nbsp;of&nbsp;messages&nbsp;in&nbsp;ready&nbsp;state&nbsp;(or&nbsp;in&nbsp;unacked&lt;br&gt;<br>
&gt;&nbsp;state)&nbsp;increases,&nbsp;the&nbsp;deliver&nbsp;ratio&nbsp;decrease&nbsp;considerably.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;ve&nbsp;tried&nbsp;adding&nbsp;more&nbsp;consumers,&nbsp;sending&nbsp;messages&nbsp;more&nbsp;slowly&nbsp;(with&nbsp;time&lt;br&gt;<br>
&gt;&nbsp;sleep)...&nbsp;without&nbsp;luck.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&#39;ve&nbsp;seen&nbsp;that&nbsp;sending&nbsp;an&nbsp;ack&nbsp;for&nbsp;each&nbsp;message&nbsp;make&nbsp;things&nbsp;slower&nbsp;but&nbsp;we&lt;br&gt;<br>
&gt;&nbsp;actually&nbsp;need&nbsp;to&nbsp;ensure&nbsp;they&#39;re&nbsp;delivered.&nbsp;Our&nbsp;current&nbsp;ack&nbsp;ratio&nbsp;is&nbsp;too&nbsp;low,&lt;br&gt;<br>
&gt;&nbsp;so&nbsp;every&nbsp;time&nbsp;the&nbsp;number&nbsp;of&nbsp;unacked&nbsp;messages&nbsp;increases,&nbsp;the&nbsp;deliver&nbsp;ratio&lt;br&gt;<br>
&gt;&nbsp;decreases.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Do&nbsp;you&nbsp;have&nbsp;any&nbsp;ideas&nbsp;of&nbsp;what&nbsp;could&nbsp;I&nbsp;try&nbsp;to&nbsp;improve&nbsp;our&nbsp;process&lt;br&gt;<br>
&gt;&nbsp;performance?&nbsp;Or&nbsp;should&nbsp;I&nbsp;just&nbsp;make&nbsp;sure&nbsp;not&nbsp;to&nbsp;send&nbsp;more&nbsp;messages&nbsp;than&nbsp;my&lt;br&gt;<br>
&gt;&nbsp;current&nbsp;ack&nbsp;ratio?&nbsp;Is&nbsp;stacking&nbsp;acks&nbsp;and&nbsp;sending&nbsp;them&nbsp;in&nbsp;batches&nbsp;a&nbsp;safe&lt;br&gt;<br>
&gt;&nbsp;strategy&nbsp;to&nbsp;try&nbsp;out?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Adding&nbsp;more&nbsp;queues&nbsp;is&nbsp;not&nbsp;an&nbsp;option&nbsp;since&nbsp;it&nbsp;will&nbsp;add&nbsp;too&nbsp;much&nbsp;complexity&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;our&nbsp;app.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Thanks!!&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
--&lt;br&gt;<br>
You&nbsp;received&nbsp;this&nbsp;message&nbsp;because&nbsp;you&nbsp;are&nbsp;subscribed&nbsp;to&nbsp;a&nbsp;topic&nbsp;in&nbsp;the&nbsp;Google&nbsp;Groups&nbsp;&quot;rabbitmq-discuss&quot;&nbsp;group.&lt;br&gt;<br>
To&nbsp;unsubscribe&nbsp;from&nbsp;this&nbsp;topic,&nbsp;visit&nbsp;&lt;a&nbsp;href=&quot;https://groups.google.com/d/topic/rabbitmq-discuss/BW62Tn9sQkE/unsubscribe&quot;&nbsp;target=&quot;_blank&quot;&gt;https://groups.google.com/d/topic/rabbitmq-discuss/BW62Tn9sQkE/unsubscribe&lt;/a&gt;.&lt;br&gt;<br>
<br>
<br>
To&nbsp;unsubscribe&nbsp;from&nbsp;this&nbsp;group&nbsp;and&nbsp;all&nbsp;its&nbsp;topics,&nbsp;send&nbsp;an&nbsp;email&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss%2Bunsubscribe@googlegroups.com&quot;&gt;rabbitmq-discuss+unsubscribe@googlegroups.com&lt;/a&gt;.&lt;br&gt;<br>
To&nbsp;post&nbsp;to&nbsp;this&nbsp;group,&nbsp;send&nbsp;email&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@googlegroups.com&quot;&gt;rabbitmq-discuss@googlegroups.com&lt;/a&gt;.&lt;br&gt;<br>
Visit&nbsp;this&nbsp;group&nbsp;at&nbsp;&lt;a&nbsp;href=&quot;http://groups.google.com/group/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;http://groups.google.com/group/rabbitmq-discuss&lt;/a&gt;.&lt;br&gt;<br>
For&nbsp;more&nbsp;options,&nbsp;visit&nbsp;&lt;a&nbsp;href=&quot;https://groups.google.com/groups/opt_out&quot;&nbsp;target=&quot;_blank&quot;&gt;https://groups.google.com/groups/opt_out&lt;/a&gt;.&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
