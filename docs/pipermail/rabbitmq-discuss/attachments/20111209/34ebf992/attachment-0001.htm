<tt>
&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#676767&quot;&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Below&nbsp;is&nbsp;a&nbsp;code&nbsp;snippet&nbsp;of&nbsp;my&nbsp;receiving&nbsp;code&lt;/font&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#676767&quot;&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#676767&quot;&gt;&lt;blockquote&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt; &lt;/font&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;arial&nbsp;narrow&amp;#39;,&nbsp;sans-serif&quot;&gt;&nbsp; &nbsp; &nbsp;amqp_frame_t&nbsp;frame;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;amqp_maybe_release_buffers(myConnection);&lt;br&gt; &nbsp; &nbsp; &nbsp;int&nbsp;result&nbsp;=&nbsp;amqp_simple_wait_frame(myConnection,&nbsp;&amp;amp;frame);&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp; &lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;if&nbsp;(result&nbsp;&amp;lt;&nbsp;0)&lt;br&gt; &nbsp; &nbsp; &nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;-1;&lt;br&gt; &nbsp; &nbsp; &nbsp;}&lt;br&gt; &nbsp; &nbsp; &nbsp;if&nbsp;(frame.frame_type&nbsp;!=&nbsp;AMQP_FRAME_METHOD)&lt;br&gt; &nbsp; &nbsp; &nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;0;&lt;br&gt; &nbsp; &nbsp; &nbsp;}&lt;br&gt; &nbsp; &nbsp; &nbsp;if&nbsp;(&lt;a&nbsp;href=&quot;http://frame.payload.method.id&quot;&gt;frame.payload.method.id&lt;/a&gt;&nbsp;!=&nbsp;AMQP_BASIC_DELIVER_METHOD)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;0;&lt;br&gt; &nbsp; &nbsp; &nbsp;}&lt;br&gt; &nbsp; &nbsp; &nbsp;result&nbsp;=&nbsp;amqp_simple_wait_frame(myConnection,&nbsp;&amp;amp;frame);&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;br&gt;&lt;/span&gt; &nbsp; &nbsp; &nbsp;if&nbsp;(result&nbsp;&amp;lt;&nbsp;0)&lt;br&gt; &nbsp; &nbsp; &nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;-1;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;}&lt;br&gt; &nbsp; &nbsp; &nbsp;if&nbsp;(frame.frame_type&nbsp;!=&nbsp;AMQP_FRAME_HEADER)&lt;br&gt; &nbsp; &nbsp; &nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;abort();&lt;br&gt; &nbsp; &nbsp; &nbsp;}&lt;br&gt; &nbsp; &nbsp; &nbsp;uint64_t&nbsp;target&nbsp;=&nbsp;frame.payload.properties.body_size;&lt;br&gt; &nbsp; &nbsp; &nbsp;uint64_t&nbsp;received&nbsp;=&nbsp;0;&lt;br&gt; &nbsp; &nbsp; &nbsp;while&nbsp;(received&nbsp;&amp;lt;&nbsp;target)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;result&nbsp;=&nbsp;amqp_simple_wait_frame(myConnection,&nbsp;&amp;amp;frame);&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(result&nbsp;&amp;lt;&nbsp;0)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;-1;&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(frame.frame_type&nbsp;!=&nbsp;AMQP_FRAME_BODY)&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;abort();&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;received&nbsp;+=&nbsp;frame.payload.body_fragment.len;&lt;br&gt; &nbsp; &nbsp; &nbsp;}&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;  &lt;br&gt; &nbsp; &nbsp; &nbsp; char*&nbsp;recvBuffer&nbsp;=new&nbsp;char[RABBIT_BUFFER_SIZE];&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; memcpy(recvBuffer,&nbsp;frame.payload.body_fragment.bytes,&nbsp;frame.payload.body_fragment.len);&lt;br&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&nbsp;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;int&nbsp;framesize&nbsp;=frame.payload.body_fragment.len;&lt;/font&gt;&lt;br&gt;&lt;br&gt;<br>
&lt;br&gt;This&nbsp;code&nbsp;is&nbsp;adapted&nbsp;from&nbsp;the&nbsp;C&nbsp;client&nbsp;example&nbsp;and&nbsp;it&nbsp;is&nbsp;running&nbsp;mostly&nbsp;fine.&nbsp;However&nbsp;after&nbsp;running&nbsp;it&nbsp;on&nbsp;my&nbsp;server&nbsp;for&nbsp;19&nbsp;hours,&nbsp;it&nbsp;crashes.&nbsp;After&nbsp;tracing.&nbsp;it&nbsp;shows&nbsp;that &lt;/blockquote&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;&nbsp;&quot;&gt;<br>
&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;&amp;#39;arial&nbsp;narrow&amp;#39;,&nbsp;sans-serif;&nbsp;&quot;&gt;frame.payload.body_fragment.len&nbsp;is&nbsp;only&nbsp;23&nbsp;while&nbsp;received&nbsp;is&nbsp;over&nbsp;10k.&nbsp;Am&nbsp;I&nbsp;doing&nbsp;something&nbsp;wrong?&nbsp;The&nbsp;assumption&nbsp;that&nbsp;I&nbsp;made&nbsp;after&nbsp;looking&nbsp;at&nbsp;the&nbsp;code&nbsp;is&nbsp;that&nbsp;frame&nbsp;is&nbsp;==&nbsp;message.&nbsp;If&nbsp;it&nbsp;is&nbsp;not&nbsp;,&nbsp;how&nbsp;could&nbsp;I&nbsp;received&nbsp;the&nbsp;entire&nbsp;message&nbsp;before&nbsp;processing?&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;&amp;#39;arial&nbsp;narrow&amp;#39;,&nbsp;sans-serif;&nbsp;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;&amp;#39;arial&nbsp;narrow&amp;#39;,&nbsp;sans-serif;&nbsp;&quot;&gt;Regards,&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;&amp;#39;arial&nbsp;narrow&amp;#39;,&nbsp;sans-serif;&nbsp;&quot;&gt;QX &lt;/span&gt;&lt;/div&gt;&lt;/font&gt;&lt;/div&gt;<br>

</tt>
