<tt>
Jiri&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;makes&nbsp;some&nbsp;sense,&nbsp;but&nbsp;you&nbsp;*will*&nbsp;need&nbsp;to&nbsp;migrate&nbsp;resources,&nbsp;or&nbsp;recreate&nbsp;them,&nbsp;to&nbsp;continue&nbsp;working&nbsp;on&nbsp;the&nbsp;secondary.&nbsp; You&nbsp;will&nbsp;not&nbsp;need&nbsp;to&nbsp;migrate&nbsp;messages,&nbsp;but&nbsp;there&nbsp;is&nbsp;other&nbsp;broker&nbsp;state&nbsp;that&nbsp;you&nbsp;will&nbsp;need:&nbsp;for&nbsp;example&nbsp;a&nbsp;consumer&amp;#39;s&nbsp;exclusive&nbsp;queue&nbsp;on&nbsp;the&nbsp;primary,&nbsp;will&nbsp;need&nbsp;to&nbsp;exist&nbsp;on&nbsp;the&nbsp;secondary,&nbsp;with&nbsp;the&nbsp;correct&nbsp;bindings,&nbsp;connection,&nbsp;etc.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;my&nbsp;question&nbsp;is:&nbsp;do&nbsp;you&nbsp;plan&nbsp;to&nbsp;create&nbsp;that&nbsp;queue&nbsp;(etc)&nbsp;on&nbsp;the&nbsp;secondary&nbsp;after&nbsp;the&nbsp;primary&nbsp;fails?&nbsp; If&nbsp;&amp;quot;yes&amp;quot;&nbsp;then&nbsp;a&nbsp;potential&nbsp;issue&nbsp;is&nbsp;managing&nbsp;the&nbsp;failover&nbsp;window&nbsp;size&nbsp;and&nbsp;(possible,&nbsp;but&nbsp;less&nbsp;likely)&nbsp;resource&nbsp;limits&nbsp;on&nbsp;the&nbsp;secondary.&nbsp; If&nbsp;&amp;quot;no&amp;quot;&nbsp;then&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;&amp;#39;pre&nbsp;build&amp;#39;&nbsp;the&nbsp;spare&nbsp;resources&nbsp;somehow.&nbsp; &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;These&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;difficult&nbsp;issues&nbsp;to&nbsp;solve&nbsp;in&nbsp;any&nbsp;particular&nbsp;instance,&nbsp;however&nbsp;I&nbsp;am&nbsp;highlighting&nbsp;them&nbsp;in&nbsp;response&nbsp;to&nbsp;your&nbsp;request&nbsp;for&nbsp;feedback.&nbsp; These&nbsp;issues&nbsp;do&nbsp;become&nbsp;deeper&nbsp;when&nbsp;you&nbsp;try&nbsp;to&nbsp;generalise&nbsp;to&nbsp;multiple&nbsp;different&nbsp;failure&nbsp;scenarios,&nbsp;of&nbsp;course.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;alexis&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Sep&nbsp;3,&nbsp;2010&nbsp;at&nbsp;8:40&nbsp;AM,&nbsp;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jiri@krutil.com&quot;&gt;jiri@krutil.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
Alexis&lt;br&gt;<br>
&lt;br&gt;<br>
Our&nbsp;plan&nbsp;is&nbsp;to&nbsp;have&nbsp;two&nbsp;brokers&nbsp;with&nbsp;the&nbsp;same&nbsp;setup,&nbsp;both&nbsp;being&nbsp;actively&nbsp;used&nbsp;at&nbsp;the&nbsp;same&nbsp;time,&nbsp;but&nbsp;each&nbsp;broker&nbsp;serving&nbsp;a&nbsp;different&nbsp;set&nbsp;of&nbsp;clients.&lt;br&gt;<br>
&lt;br&gt;<br>
Our&nbsp;back-end&nbsp;service&nbsp;will&nbsp;be&nbsp;connected&nbsp;to&nbsp;and&nbsp;process&nbsp;requests&nbsp;from&nbsp;both&nbsp;brokers&nbsp;at&nbsp;the&nbsp;same&nbsp;time.&lt;br&gt;<br>
&lt;br&gt;<br>
When&nbsp;one&nbsp;broker&nbsp;fails,&nbsp;the&nbsp;clients&nbsp;will&nbsp;loose&nbsp;connection&nbsp;and&nbsp;will&nbsp;have&nbsp;to&nbsp;reconnect,&nbsp;ending&nbsp;up&nbsp;on&nbsp;the&nbsp;other&nbsp;broker.&nbsp;Messages&nbsp;that&nbsp;were&nbsp;on&nbsp;the&nbsp;dead&nbsp;broker&nbsp;will&nbsp;be&nbsp;lost.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;we&nbsp;don&amp;#39;t&nbsp;need&nbsp;migration&nbsp;of&nbsp;resources&nbsp;between&nbsp;brokers&nbsp;in&nbsp;case&nbsp;of&nbsp;failure,&nbsp;we&nbsp;only&nbsp;need&nbsp;the&nbsp;clients&nbsp;to&nbsp;move&nbsp;their&nbsp;connections&nbsp;to&nbsp;the&nbsp;other&nbsp;broker.&lt;br&gt;<br>
&lt;br&gt;<br>
Hope&nbsp;that&nbsp;makes&nbsp;sense...&lt;br&gt;<br>
&lt;br&gt;<br>
Jiri&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Jiri&lt;br&gt;<br>
&lt;br&gt;<br>
Cool.&nbsp; So&nbsp;yes&nbsp;messages&nbsp;will&nbsp;then&nbsp;only&nbsp;arrive&nbsp;out&nbsp;of&nbsp;order&nbsp;in&nbsp;the&nbsp;case&lt;br&gt;<br>
where&nbsp;some&nbsp;arrive&nbsp;from&nbsp;the&nbsp;secondary&nbsp;before&nbsp;&amp;#39;delayed&amp;#39;&nbsp;messages&nbsp;from&lt;br&gt;<br>
the&nbsp;failed&nbsp;primary;&nbsp;and&nbsp;then,&nbsp;for&nbsp;reordering&nbsp;them,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;know&lt;br&gt;<br>
which&nbsp;broker&nbsp;they&nbsp;came&nbsp;from.&nbsp; (In&nbsp;the&nbsp;absence&nbsp;of&nbsp;failure,&nbsp;TCP&nbsp;should&lt;br&gt;<br>
take&nbsp;care&nbsp;of&nbsp;reordering).&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;the&nbsp;issues&nbsp;will&nbsp;be:&lt;br&gt;<br>
&lt;br&gt;<br>
1.&nbsp;Deciding&nbsp;when&nbsp;to&nbsp;stop&nbsp;listening&nbsp;to&nbsp;a&nbsp;primary.&nbsp; Given&nbsp;consumers&lt;br&gt;<br>
don&amp;#39;t&nbsp;care&nbsp;about&nbsp;message&nbsp;loss,&nbsp;I&nbsp;would&nbsp;suggest&nbsp;&amp;quot;as&nbsp;soon&nbsp;as&nbsp;consumers&lt;br&gt;<br>
are&nbsp;aware&nbsp;of&nbsp;primary&nbsp;failure,&nbsp;then&nbsp;they&nbsp;should&nbsp;ignore&nbsp;further&nbsp;messages&lt;br&gt;<br>
from&nbsp;the&nbsp;primary&amp;quot;&lt;br&gt;<br>
&lt;br&gt;<br>
2.&nbsp;Failover&nbsp;time.&nbsp; AIUI&nbsp;you&nbsp;want&nbsp;to&nbsp;minimise&nbsp;this&nbsp;by&nbsp;having&nbsp;a&nbsp;copy&nbsp;of&lt;br&gt;<br>
the&nbsp;whole&nbsp;queue/exchange/binding&nbsp;set-up&nbsp;on&nbsp;both&nbsp;brokers.&nbsp; But&nbsp;how&lt;br&gt;<br>
exactly&nbsp;do&nbsp;you&nbsp;plan&nbsp;to&nbsp;do&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
alexis&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Fri,&nbsp;Sep&nbsp;3,&nbsp;2010&nbsp;at&nbsp;8:12&nbsp;AM,&nbsp; &amp;lt;&lt;a&nbsp;href=&quot;mailto:jiri@krutil.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jiri@krutil.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Alexis&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;answer&nbsp;is&nbsp;no&nbsp;-&nbsp;a&nbsp;client&nbsp;can&nbsp;send&nbsp;requests&nbsp;to&nbsp;only&nbsp;one&nbsp;broker&nbsp;at&nbsp;any&lt;br&gt;<br>
given&nbsp;moment.&nbsp;The&nbsp;client&nbsp;connects&nbsp;via&nbsp;load&nbsp;balancer&nbsp;to&nbsp;one&nbsp;of&nbsp;the&nbsp;brokers&lt;br&gt;<br>
and&nbsp;stays&nbsp;connected&nbsp;all&nbsp;the&nbsp;time.&nbsp;The&nbsp;client&nbsp;does&nbsp;not&nbsp;even&nbsp;know&nbsp;that&nbsp;there&lt;br&gt;<br>
are&nbsp;two&nbsp;brokers&nbsp;(it&nbsp;only&nbsp;sees&nbsp;one&nbsp;IP&nbsp;address).&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;requests&nbsp;may&nbsp;be&nbsp;delivered&nbsp;out&nbsp;of&nbsp;order&nbsp;only&nbsp;if&nbsp;a&nbsp;client&nbsp;fails&nbsp;over&lt;br&gt;<br>
to&nbsp;another&nbsp;broker.&nbsp;Then&nbsp;messages&nbsp;send&nbsp;to&nbsp;one&nbsp;broker&nbsp;can&nbsp;get&nbsp;mixed&nbsp;up&nbsp;with&lt;br&gt;<br>
messages&nbsp;sent&nbsp;to&nbsp;the&nbsp;other.&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;concern&nbsp;was:&nbsp;are&nbsp;there&nbsp;any&nbsp;other&nbsp;issues&nbsp;with&nbsp;this&nbsp;kind&nbsp;of&nbsp;setup&nbsp;that&nbsp;I&lt;br&gt;<br>
might&nbsp;have&nbsp;missed?&nbsp;Does&nbsp;anyone&nbsp;have&nbsp;experience&nbsp;with&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;a&nbsp;lot&nbsp;for&nbsp;your&nbsp;help&lt;br&gt;<br>
Jiri&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Jiri&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;say&nbsp;that&nbsp;&amp;quot;Some&nbsp;clients&nbsp;send&nbsp;requests&nbsp;to&nbsp;one&nbsp;broker,&nbsp;some&nbsp;to&nbsp;the&lt;br&gt;<br>
other&amp;quot;.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Does&nbsp;this&nbsp;mean&nbsp;that&nbsp;one&nbsp;client&nbsp;publisher&nbsp;can&nbsp;send&nbsp;messages&nbsp;(requests)&nbsp;to&lt;br&gt;<br>
both&nbsp;brokers,&nbsp;in&nbsp;such&nbsp;a&nbsp;way&nbsp;that&nbsp;a&nbsp;pair&nbsp;of&nbsp;messages&nbsp;may&nbsp;arrive&nbsp;out&nbsp;of&lt;br&gt;<br>
order&lt;br&gt;<br>
if&nbsp;one&nbsp;is&nbsp;sent&nbsp;to&nbsp;each&nbsp;broker?&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;the&nbsp;answer&nbsp;is&nbsp;no,&nbsp;then&nbsp;I&nbsp;think&nbsp;my&nbsp;answer&nbsp;stands,&nbsp;because&nbsp;causal&nbsp;order&lt;br&gt;<br>
will&nbsp;be&nbsp;preserved&nbsp;even&nbsp;if&nbsp;messages&nbsp;are&nbsp;lost.&nbsp; That&nbsp;is:&nbsp;messages&nbsp;that&lt;br&gt;<br>
arrive&lt;br&gt;<br>
successfully,&nbsp;will&nbsp;not&nbsp;be&nbsp;out&nbsp;of&nbsp;order&nbsp;with&nbsp;each&nbsp;other.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;the&nbsp;answer&nbsp;is&nbsp;yes,&nbsp;then&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;how&nbsp;you&nbsp;can&nbsp;recover&nbsp;global&lt;br&gt;<br>
ordering&lt;br&gt;<br>
without&nbsp;imposing&nbsp;it&nbsp;at&nbsp;the&nbsp;publisher&nbsp;using&nbsp;sequence&nbsp;numbers&nbsp;at&nbsp;the&nbsp;app&lt;br&gt;<br>
level.&lt;br&gt;<br>
&lt;br&gt;<br>
Does&nbsp;this&nbsp;make&nbsp;sense?&lt;br&gt;<br>
&lt;br&gt;<br>
alexis&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Thu,&nbsp;Sep&nbsp;2,&nbsp;2010&nbsp;at&nbsp;9:46&nbsp;PM,&nbsp;Jiri&nbsp;Krutil&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jiri@krutil.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jiri@krutil.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Alexis&lt;br&gt;<br>
&lt;br&gt;<br>
Sorry&nbsp;I&nbsp;probably&nbsp;didn&amp;#39;t&nbsp;express&nbsp;myself&nbsp;well.&lt;br&gt;<br>
&lt;br&gt;<br>
We&nbsp;don&amp;#39;t&nbsp;plan&nbsp;a&nbsp;primary&nbsp;and&nbsp;secondary&nbsp;broker,&nbsp;but&nbsp;a&nbsp;pair&nbsp;of&nbsp;brokers&nbsp;that&lt;br&gt;<br>
are&nbsp;both&nbsp;active&nbsp;at&nbsp;the&nbsp;same&nbsp;time.&nbsp;A&nbsp;load&nbsp;balancer&nbsp;divides&nbsp;client&lt;br&gt;<br>
connections&lt;br&gt;<br>
to&nbsp;these&nbsp;brokers.&nbsp;A&nbsp;request&nbsp;queue&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;exists&nbsp;on&nbsp;both&lt;br&gt;<br>
brokers,&lt;br&gt;<br>
but&nbsp;with&nbsp;different&nbsp;contents.&nbsp;Some&nbsp;clients&nbsp;send&nbsp;requests&nbsp;to&nbsp;one&nbsp;broker,&lt;br&gt;<br>
some&lt;br&gt;<br>
to&nbsp;the&nbsp;other.&nbsp;Our&nbsp;back-end&nbsp;server&nbsp;listens&nbsp;to&nbsp;both&nbsp;queues,&nbsp;processes&lt;br&gt;<br>
requests&lt;br&gt;<br>
and&nbsp;sends&nbsp;each&nbsp;response&nbsp;to&nbsp;an&nbsp;exclusive&nbsp;client&nbsp;queue&nbsp;on&nbsp;the&nbsp;broker&nbsp;from&lt;br&gt;<br>
where&nbsp;the&nbsp;request&nbsp;came.&lt;br&gt;<br>
&lt;br&gt;<br>
Ideally&nbsp;this&nbsp;would&nbsp;be&nbsp;transparent&nbsp;to&nbsp;the&nbsp;clients,&nbsp;because&nbsp;the&nbsp;brokers&lt;br&gt;<br>
would&lt;br&gt;<br>
be&nbsp;hidden&nbsp;by&nbsp;a&nbsp;virtual&nbsp;IP&nbsp;address.&nbsp;Of&nbsp;course&nbsp;it&nbsp;can&amp;#39;t&nbsp;be&nbsp;transparent&nbsp;to&lt;br&gt;<br>
the&lt;br&gt;<br>
back-end&nbsp;server,&nbsp;which&nbsp;needs&nbsp;to&nbsp;talk&nbsp;to&nbsp;both&nbsp;brokers&nbsp;at&nbsp;the&nbsp;same&nbsp;time.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;(a)&nbsp;is&nbsp;correct,&nbsp;but&nbsp;(b)&nbsp;not.&lt;br&gt;<br>
&lt;br&gt;<br>
Hope&nbsp;that&nbsp;makes&nbsp;it&nbsp;a&nbsp;bit&nbsp;clearer...&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers&lt;br&gt;<br>
Jiri&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
 Jiri&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
That&nbsp;answered&nbsp;my&nbsp;questions.&nbsp; Now,&nbsp;as&nbsp;I&nbsp;understood&nbsp;your&nbsp;example:&lt;br&gt;<br>
&lt;br&gt;<br>
a.&nbsp;you&nbsp;don&amp;#39;t&nbsp;mind&nbsp;messages&nbsp;being&nbsp;lost&lt;br&gt;<br>
*and*&lt;br&gt;<br>
b.&nbsp;you&nbsp;don&amp;#39;t&nbsp;use&nbsp;the&nbsp;secondary&nbsp;until&nbsp;after&nbsp;the&nbsp;primary&nbsp;has&nbsp;failed.&lt;br&gt;<br>
&lt;br&gt;<br>
Note&nbsp;that&nbsp;if&nbsp;consumption&nbsp;is&nbsp;completely&nbsp;&amp;#39;fire&nbsp;and&nbsp;forget&amp;#39;&nbsp;then&nbsp;it&nbsp;is&lt;br&gt;<br>
possible&nbsp;that&nbsp;a&nbsp;message&nbsp;from&nbsp;the&nbsp;primary&nbsp;may&nbsp;*arrive*&nbsp;after&nbsp;a&nbsp;message&lt;br&gt;<br>
from&lt;br&gt;<br>
the&nbsp;secondary.&nbsp; But&nbsp;this&nbsp;can&nbsp;happen&nbsp;whether&nbsp;you&nbsp;use&nbsp;sequence&nbsp;numbers&nbsp;or&lt;br&gt;<br>
not.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;if&nbsp;the&nbsp;primary&nbsp;broker&nbsp;fails,&nbsp;why&nbsp;not&nbsp;just&nbsp;forget&nbsp;all&nbsp;undelivered&lt;br&gt;<br>
messages?&nbsp; Consumers&nbsp;will&nbsp;know&nbsp;that&nbsp;any&nbsp;message&nbsp;consumed&nbsp;from&nbsp;the&lt;br&gt;<br>
secondary&lt;br&gt;<br>
must&nbsp;be&nbsp;later&nbsp;in&nbsp;*all*&nbsp;orderings&nbsp;than&nbsp;any&nbsp;message&nbsp;consumed&nbsp;from&nbsp;the&lt;br&gt;<br>
primary.&lt;br&gt;<br>
 So,&nbsp;additional&nbsp;sequence&nbsp;numbering&nbsp;is&nbsp;not&nbsp;necessary.&lt;br&gt;<br>
&lt;br&gt;<br>
alexis&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
