<tt>
&lt;html&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;color:#000;&nbsp;background-color:#fff;&nbsp;font-family:HelveticaNeue,&nbsp;Helvetica&nbsp;Neue,&nbsp;Helvetica,&nbsp;Arial,&nbsp;Lucida&nbsp;Grande,&nbsp;sans-serif;font-size:12pt&quot;&gt;&lt;div&gt;&lt;span&gt;Running&nbsp;this&nbsp;now:&nbsp;&amp;nbsp;netstat&nbsp;-t&nbsp;-n&nbsp;|&nbsp;grep&nbsp;:5672&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;16px;&nbsp;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;background-color:&nbsp;transparent;&nbsp;font-style:&nbsp;normal;&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;16px;&nbsp;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;background-color:&nbsp;transparent;&nbsp;font-style:&nbsp;normal;&quot;&gt;&lt;span&gt;As&nbsp;far&nbsp;as&nbsp;the&nbsp;prefetch&nbsp;goes,&nbsp;we&nbsp;are&nbsp;using&nbsp;a&nbsp;value&nbsp;of&nbsp;500.&nbsp;When&nbsp;using&nbsp;a&nbsp;value&nbsp;like&nbsp;1,&nbsp;we&nbsp;saw&nbsp;pretty&nbsp;bad&nbsp;performance.&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;16px;&nbsp;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;background-color:&nbsp;transparent;&nbsp;font-style:<br>
&nbsp;normal;&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;16px;&nbsp;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;background-color:&nbsp;transparent;&nbsp;font-style:&nbsp;normal;&quot;&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;p1&quot;&gt;My&nbsp;understanding&nbsp;of&nbsp;pre-fetch&nbsp;was&nbsp;the&nbsp;consumer&nbsp;asks&nbsp;for&nbsp;that&nbsp;number&nbsp;of&nbsp;messages&nbsp;and&nbsp;then&nbsp;has&nbsp;to&nbsp;send&nbsp;an&nbsp;acknowledge&nbsp;before&nbsp;more&nbsp;messages&nbsp;are&nbsp;sent&nbsp;to&nbsp;it.&nbsp;If&nbsp;we&nbsp;have&nbsp;memory&nbsp;issues&nbsp;when&nbsp;there&nbsp;are&nbsp;almost&nbsp;no&nbsp;messages&nbsp;then&nbsp;our&nbsp;pre-fetch&nbsp;values&nbsp;seems&nbsp;an&nbsp;unlikely&nbsp;cause.&lt;/div&gt;&lt;div&nbsp;class=&quot;p1&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;p1&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;16px;&nbsp;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;background-color:&nbsp;transparent;&nbsp;font-style:&nbsp;normal;&quot;&gt;<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;p1&quot;&gt;If&nbsp;we&nbsp;set&nbsp;prefetch&nbsp;really&nbsp;low,&nbsp;I&nbsp;could&nbsp;see&nbsp;us&nbsp;having&nbsp;a&nbsp;lot&nbsp;of&nbsp;messages&nbsp;in&nbsp;the&nbsp;queue.&nbsp;Setting&nbsp;it&nbsp;high&nbsp;or&nbsp;unlimited&nbsp;should&nbsp;actually&nbsp;be&nbsp;better&nbsp;for&nbsp;the&nbsp;server.&lt;/div&gt;&lt;div&nbsp;class=&quot;p1&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;p1&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;16px;&nbsp;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;background-color:&nbsp;transparent;&nbsp;font-style:&nbsp;normal;&quot;&gt;Nonetheless,&nbsp;I'll&nbsp;try&nbsp;it&nbsp;after&nbsp;this&nbsp;current&nbsp;batch&nbsp;with&nbsp;netstat&nbsp;runs&nbsp;to&nbsp;explosion.&lt;/div&gt;&lt;div&nbsp;class=&quot;p1&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;16px;&nbsp;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;background-color:&nbsp;transparent;&nbsp;font-style:&nbsp;normal;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;p1&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;16px;&nbsp;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;background-color:&nbsp;transparent;&nbsp;font-style:&nbsp;normal;&quot;&gt;Still&nbsp;no&nbsp;luck&nbsp;reproducing&nbsp;the&nbsp;issue&nbsp;with&nbsp;a<br>
&nbsp;simple&nbsp;test&nbsp;program...&lt;/div&gt;&lt;div&nbsp;class=&quot;yahoo_quoted&quot;&nbsp;style=&quot;display:&nbsp;block;&quot;&gt;&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&lt;div&nbsp;style=&quot;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&quot;&gt;&nbsp;&lt;div&nbsp;style=&quot;font-family:&nbsp;HelveticaNeue,&nbsp;'Helvetica&nbsp;Neue',&nbsp;Helvetica,&nbsp;Arial,&nbsp;'Lucida&nbsp;Grande',&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&quot;&gt;&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&lt;font&nbsp;size=&quot;2&quot;&nbsp;face=&quot;Arial&quot;&gt;&nbsp;On&nbsp;Tuesday,&nbsp;October&nbsp;22,&nbsp;2013&nbsp;7:31&nbsp;AM,&nbsp;Emile&nbsp;Joubert&nbsp;&amp;lt;emile@rabbitmq.com&amp;gt;&nbsp;wrote:&lt;br&gt;&nbsp;&lt;/font&gt;&nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;y_msg_container&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;Hi&nbsp;Brian,&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;On&nbsp;21/10/13&nbsp;19:50,&nbsp;Brian&nbsp;Hammond&nbsp;wrote:&lt;br&nbsp;clear=&quot;none&quot;&gt;&amp;gt;&nbsp;Do&nbsp;you&nbsp;have&nbsp;a&nbsp;specific&nbsp;set&nbsp;of&nbsp;arguments&nbsp;in&nbsp;mind&nbsp;for&nbsp;netstat?&nbsp;If&nbsp;not&nbsp;I'll&lt;br&nbsp;clear=&quot;none&quot;&gt;&amp;gt;&nbsp;go&nbsp;look&nbsp;at&nbsp;the&nbsp;man&nbsp;page.&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;netstat&nbsp;shows&nbsp;this&nbsp;information&nbsp;by&nbsp;default.&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&amp;gt;&nbsp;I'll&nbsp;provide&nbsp;more&nbsp;information&nbsp;as&nbsp;my&nbsp;tests&nbsp;progress.&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br<br>
&nbsp;clear=&quot;none&quot;&gt;From&nbsp;the&nbsp;reports&nbsp;it&nbsp;appears&nbsp;that&nbsp;all&nbsp;consumers&nbsp;are&nbsp;either&nbsp;using&lt;br&nbsp;clear=&quot;none&quot;&gt;unlimited&nbsp;prefetch&nbsp;or&nbsp;a&nbsp;value&nbsp;of&nbsp;500.&nbsp;It&nbsp;is&nbsp;likely&nbsp;that&nbsp;the&nbsp;broker&lt;br&nbsp;clear=&quot;none&quot;&gt;memory&nbsp;use&nbsp;will&nbsp;be&nbsp;reduced&nbsp;if&nbsp;consumers&nbsp;use&nbsp;a&nbsp;much&nbsp;lower&nbsp;prefetch&nbsp;count,&lt;br&nbsp;clear=&quot;none&quot;&gt;say&nbsp;1.&nbsp;Would&nbsp;it&nbsp;be&nbsp;possible&nbsp;for&nbsp;you&nbsp;to&nbsp;try&nbsp;that?&nbsp;The&nbsp;reason&nbsp;why&nbsp;it&nbsp;might&lt;br&nbsp;clear=&quot;none&quot;&gt;help&nbsp;in&nbsp;your&nbsp;particular&nbsp;case&nbsp;is&nbsp;most&nbsp;of&nbsp;the&nbsp;memory&nbsp;is&nbsp;being&nbsp;consumed&nbsp;by&lt;br&nbsp;clear=&quot;none&quot;&gt;the&nbsp;Erlang&nbsp;processes&nbsp;that&nbsp;write&nbsp;to&nbsp;the&nbsp;network.&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;I&nbsp;realise&nbsp;that&nbsp;it&nbsp;might&nbsp;be&nbsp;difficult&nbsp;for&nbsp;you&nbsp;to&nbsp;make&nbsp;this&nbsp;change&nbsp;to&nbsp;all&lt;br&nbsp;clear=&quot;none&quot;&gt;consumers.&nbsp;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;this&nbsp;is&nbsp;too&nbsp;onerous&nbsp;so&nbsp;we&nbsp;can&nbsp;discuss&lt;br&nbsp;clear=&quot;none&quot;&gt;alternatives.&lt;div&nbsp;class=&quot;yqt0809069702&quot;&nbsp;id=&quot;yqtfd32512&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;-Emile&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;&lt;/div&gt;&nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
