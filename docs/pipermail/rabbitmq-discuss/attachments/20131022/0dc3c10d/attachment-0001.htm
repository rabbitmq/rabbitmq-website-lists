<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;Michael.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;line:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;quot;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-family:arial,sans-serif;font-size:13px&quot;&gt;Erlang&nbsp;R15B01&nbsp;(erts-5.9.1)&nbsp;[source]&nbsp;[64-bit]&nbsp;[smp:4:4]&nbsp;[async-threads:0]&nbsp;[kernel-poll:false]&amp;quot;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-family:arial,sans-serif;font-size:13px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-family:arial,sans-serif;font-size:13px&quot;&gt;is&nbsp;from&nbsp;running&nbsp;&amp;quot;erl&amp;quot;&nbsp;on&nbsp;the&nbsp;same&nbsp;VM&nbsp;as&nbsp;the&nbsp;broker.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-family:arial,sans-serif;font-size:13px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#500050&quot;&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Regarding&nbsp;the&nbsp;suggestion&nbsp;of&nbsp;&amp;quot;&lt;/font&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:13px&quot;&gt;RABBITMQ_ALLOW_INPUT=true&amp;quot;,&nbsp;this&nbsp;is&nbsp;a&nbsp;bit&nbsp;tricky&nbsp;for&nbsp;me&nbsp;to&nbsp;run.&nbsp;For&nbsp;starters,&nbsp;this&nbsp;is&nbsp;a&nbsp;Rabbit&nbsp;instance&nbsp;running&nbsp;in&nbsp;a&nbsp;production&nbsp;environment&nbsp;so&nbsp;I&nbsp;can&amp;#39;t&nbsp;easily&nbsp;restart&nbsp;it.&nbsp;And&nbsp;even&nbsp;if&nbsp;I&nbsp;could,&nbsp;the&nbsp;way&nbsp;we&nbsp;start&nbsp;RabbitMQ&nbsp;is&nbsp;a&nbsp;bit&nbsp;quirky&nbsp;(long&nbsp;story).&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:13px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:13px&quot;&gt;Is&nbsp;there&nbsp;some&nbsp;way&nbsp;to&nbsp;get&nbsp;the&nbsp;aysnc-threads&nbsp;value&nbsp;from&nbsp;a&nbsp;&amp;quot;rabbitmqctl&nbsp;eval...&amp;quot;&nbsp;or&nbsp;from&nbsp;the&nbsp;logs?&nbsp;I&nbsp;do&nbsp;have&nbsp;ready&nbsp;access&nbsp;to&nbsp;those.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:13px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;A&nbsp;few&nbsp;of&nbsp;the&nbsp;messages&nbsp;are&nbsp;persistent,&nbsp;but&nbsp;the&nbsp;vast&nbsp;majority&nbsp;of&nbsp;them&nbsp;are&nbsp;non-persistent.&nbsp;Our&nbsp;disk&nbsp;I/O&nbsp;on&nbsp;the&nbsp;box&nbsp;looks&nbsp;relatively&nbsp;low.&nbsp;Many&nbsp;intervals&nbsp;of&nbsp;0&nbsp;reads/writes&nbsp;with&nbsp;occasional&nbsp;blips&nbsp;up,&nbsp;but&nbsp;noting&nbsp;particularly&nbsp;heavy.&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Also,&nbsp;we&nbsp;are&nbsp;running&nbsp;this&nbsp;in&nbsp;a&nbsp;cluster&nbsp;with&nbsp;another&nbsp;box,&nbsp;with&nbsp;all&nbsp;queues&nbsp;in&nbsp;HA&nbsp;mode.&nbsp;I&nbsp;imagine&nbsp;that&nbsp;would&nbsp;have&nbsp;some&nbsp;overall&nbsp;CPU&nbsp;impact,&nbsp;but&nbsp;don&amp;#39;t&nbsp;see&nbsp;why&nbsp;it&nbsp;would&nbsp;concentrate&nbsp;everything&nbsp;on&nbsp;one&nbsp;core.&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Thanks&nbsp;again,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Matt&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif;font-size:13px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Oct&nbsp;22,&nbsp;2013&nbsp;at&nbsp;2:46&nbsp;PM,&nbsp;Michael&nbsp;Klishin&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mklishin@gopivotal.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mklishin@gopivotal.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;23&nbsp;Oct&nbsp;2013,&nbsp;at&nbsp;01:31,&nbsp;Matt&nbsp;Pietrek&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mpietrek@skytap.com&quot;&gt;mpietrek@skytap.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;Thanks&nbsp;Zhibo.&nbsp;We&nbsp;actually&nbsp;have&nbsp;hundreds&nbsp;of&nbsp;queues.&nbsp;Two&nbsp;of&nbsp;them&nbsp;are&nbsp;processing&nbsp;several&nbsp;hundred&nbsp;messages/second.&nbsp;The&nbsp;remaining&nbsp;queues&nbsp;are&nbsp;processing&nbsp;1&nbsp;or&nbsp;2&nbsp;messages&nbsp;second.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Then&nbsp;you&nbsp;should&nbsp;see&nbsp;at&nbsp;least&nbsp;two&nbsp;cores&nbsp;being&nbsp;moderately&nbsp;used.&lt;br&gt;<br>
&lt;br&gt;<br>
As&nbsp;you&nbsp;have&nbsp;correctly&nbsp;identified,&lt;br&gt;<br>
Erlang&nbsp;VM&nbsp;detects&nbsp;4&nbsp;cores&nbsp;available&nbsp;to&nbsp;it.&nbsp;What&nbsp;is&nbsp;odd&nbsp;is&nbsp;that&nbsp;you&nbsp;have&nbsp;async-threads:0,&lt;br&gt;<br>
which&nbsp;means&nbsp;disk&nbsp;I/O&nbsp;will&nbsp;block&nbsp;Erlang&nbsp;VM&nbsp;schedulers.&lt;br&gt;<br>
&lt;br&gt;<br>
Does&nbsp;the&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
Erlang&nbsp;R15B01&nbsp;(erts-5.9.1)&nbsp;[source]&nbsp;[64-bit]&nbsp;[smp:4:4]&nbsp;[async-threads:0]&nbsp;[kernel-poll:false]&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;line&nbsp;come&nbsp;from&nbsp;RabbitMQ&nbsp;or&nbsp;just&nbsp;`erl`&nbsp;executed&nbsp;on&nbsp;the&nbsp;same&nbsp;machine?&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;run&nbsp;rabbitmq&nbsp;with&nbsp;RABBITMQ_ALLOW_INPUT=true&nbsp;in&nbsp;the&nbsp;foreground&nbsp;and&nbsp;hit&nbsp;Enter,&lt;br&gt;<br>
you&nbsp;should&nbsp;see&nbsp;how&nbsp;many&nbsp;async-threads&nbsp;it&nbsp;has&nbsp;configured.&lt;br&gt;<br>
For&nbsp;me&nbsp;it&amp;#39;s&nbsp;30&nbsp;vs&nbsp;10&nbsp;for&nbsp;a&nbsp;new&nbsp;Erlang&nbsp;shell.&lt;br&gt;<br>
&lt;br&gt;<br>
I&amp;#39;d&nbsp;also&nbsp;recommend&nbsp;using&nbsp;vmstat&nbsp;and&nbsp;similar&nbsp;tools&nbsp;to&nbsp;see&nbsp;how&nbsp;many&nbsp;threads&nbsp;wait&nbsp;on&nbsp;disk&nbsp;I/O.&lt;br&gt;<br>
By&nbsp;the&nbsp;way,&nbsp;do&nbsp;you&nbsp;publish&nbsp;messages&nbsp;as&nbsp;persistent?&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
MK&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
