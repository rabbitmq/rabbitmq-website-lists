<tt>
﻿&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;http-equiv=Content-Type&gt;<br>
&lt;META&nbsp;name=GENERATOR&nbsp;content=&quot;MSHTML&nbsp;10.00.9200.16921&quot;&gt;<br>
&lt;STYLE&gt;@font-face&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&nbsp;宋体;<br>
}<br>
@font-face&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&nbsp;Verdana;<br>
}<br>
@font-face&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&nbsp;@宋体;<br>
}<br>
@page&nbsp;Section1&nbsp;{size:&nbsp;595.3pt&nbsp;841.9pt;&nbsp;margin:&nbsp;72.0pt&nbsp;90.0pt&nbsp;72.0pt&nbsp;90.0pt;&nbsp;layout-grid:&nbsp;15.6pt;&nbsp;}<br>
P.MsoNormal&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FONT-SIZE:&nbsp;10.5pt;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;;&nbsp;TEXT-ALIGN:&nbsp;justify;&nbsp;MARGIN:&nbsp;0cm&nbsp;0cm&nbsp;0pt;&nbsp;TEXT-JUSTIFY:&nbsp;inter-ideograph<br>
}<br>
LI.MsoNormal&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FONT-SIZE:&nbsp;10.5pt;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;;&nbsp;TEXT-ALIGN:&nbsp;justify;&nbsp;MARGIN:&nbsp;0cm&nbsp;0cm&nbsp;0pt;&nbsp;TEXT-JUSTIFY:&nbsp;inter-ideograph<br>
}<br>
DIV.MsoNormal&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FONT-SIZE:&nbsp;10.5pt;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;;&nbsp;TEXT-ALIGN:&nbsp;justify;&nbsp;MARGIN:&nbsp;0cm&nbsp;0cm&nbsp;0pt;&nbsp;TEXT-JUSTIFY:&nbsp;inter-ideograph<br>
}<br>
A:link&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLOR:&nbsp;blue;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
SPAN.MsoHyperlink&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLOR:&nbsp;blue;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
A:visited&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLOR:&nbsp;purple;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
SPAN.MsoHyperlinkFollowed&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLOR:&nbsp;purple;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
SPAN.EmailStyle17&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FONT-FAMILY:&nbsp;Verdana;&nbsp;FONT-WEIGHT:&nbsp;normal;&nbsp;COLOR:&nbsp;windowtext;&nbsp;FONT-STYLE:&nbsp;normal;&nbsp;TEXT-DECORATION:&nbsp;none;&nbsp;mso-style-type:&nbsp;personal-compose<br>
}<br>
DIV.Section1&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;page:&nbsp;Section1<br>
}<br>
UNKNOWN&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FONT-SIZE:&nbsp;10pt<br>
}<br>
BLOCKQUOTE&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARGIN-BOTTOM:&nbsp;0px;&nbsp;MARGIN-LEFT:&nbsp;2em;&nbsp;MARGIN-TOP:&nbsp;0px<br>
}<br>
OL&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARGIN-BOTTOM:&nbsp;0px;&nbsp;MARGIN-TOP:&nbsp;0px<br>
}<br>
UL&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARGIN-BOTTOM:&nbsp;0px;&nbsp;MARGIN-TOP:&nbsp;0px<br>
}<br>
&lt;/STYLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;verdana;&nbsp;MARGIN:&nbsp;10px&quot;&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&nbsp;size=2&nbsp;face=Verdana&gt;1,The&nbsp;architecture&nbsp;of&nbsp;my&nbsp;<br>
application&nbsp;is:&nbsp;stomp&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#000080&nbsp;size=2&nbsp;<br>
face=Verdana&gt;clients(more&nbsp;than&nbsp;one&nbsp;thousand)&nbsp;+&nbsp;Java&nbsp;amqp&nbsp;<br>
servers(several)---haproxy---rabbitmq(cluster&nbsp;of&nbsp;two&nbsp;nodes)&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&gt;&lt;/FONT&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&nbsp;size=2&nbsp;face=Verdana&gt;2,The&nbsp;performace&nbsp;of&nbsp;rabbitmq&nbsp;<br>
dropped&nbsp;a&nbsp;lot&nbsp;when&nbsp;the&nbsp;client_timeout&nbsp;crash&nbsp;errors&nbsp;report&nbsp;<br>
frequently&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&gt;&lt;/FONT&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&nbsp;size=2&nbsp;face=Verdana&gt;3,The&nbsp;stomp&nbsp;client&nbsp;creates&nbsp;a&nbsp;<br>
connection&nbsp;to&nbsp;rabbitmq&nbsp;long&nbsp;term&nbsp;at&nbsp;boot&nbsp;time,&nbsp;and&nbsp;it&nbsp;sends&nbsp;hearbeat&nbsp;frame&nbsp;<br>
per&nbsp;10&nbsp;seconds&nbsp;when&nbsp;no&nbsp;task&nbsp;of&nbsp;rpc,&nbsp;and&nbsp;it&nbsp;<br>
does&nbsp;not&nbsp;closing&nbsp;the&nbsp;connection&nbsp;explicitly&nbsp;when&nbsp;abort&nbsp;or&nbsp;<br>
exit.&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&gt;&lt;/FONT&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&nbsp;size=2&nbsp;face=Verdana&gt;4,The&nbsp;client&nbsp;timeout&nbsp;param&nbsp;of&nbsp;<br>
haproxy&nbsp;set&nbsp;to&nbsp;120&nbsp;seconds,&nbsp;and&nbsp;the&nbsp;heartbeat&nbsp;param&nbsp;of&nbsp;rabbitmq&nbsp;set&nbsp;&nbsp;<br>
to&nbsp;580&nbsp;seconds.&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&nbsp;size=2&nbsp;face=Verdana&gt;&lt;/FONT&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&nbsp;size=2&nbsp;<br>
face=Verdana&gt;How&nbsp;can&nbsp;I&nbsp;solve&nbsp;this&nbsp;problem?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&nbsp;size=2&nbsp;face=Verdana&gt;&lt;/FONT&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#c0c0c0&nbsp;size=2&nbsp;<br>
face=Verdana&gt;2014-06-18&nbsp;09:11:28&lt;/FONT&gt;&lt;/DIV&gt;&lt;FONT&nbsp;color=#000080&nbsp;size=2&nbsp;<br>
face=Verdana&gt;<br>
&lt;HR&nbsp;style=&quot;WIDTH:&nbsp;100px&quot;&nbsp;align=left&nbsp;color=#b5c4df&nbsp;SIZE=1&gt;<br>
&lt;/FONT&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#c0c0c0&nbsp;size=2&nbsp;face=Verdana&gt;youpingl&lt;/DIV&gt;<br>
&lt;DIV&gt;<br>
&lt;DIV&gt;&lt;/FONT&gt;&nbsp;&lt;/DIV&gt;&lt;/DIV&gt;<br>
&lt;HR&nbsp;color=#b5c4df&nbsp;SIZE=1&gt;<br>
<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Verdana&gt;&lt;STRONG&gt;发件人：&lt;/STRONG&gt;&nbsp;Michael&nbsp;Klishin&nbsp;<br>
&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Verdana&gt;&lt;STRONG&gt;发送时间：&lt;/STRONG&gt;&nbsp;2014-06-17&nbsp;&nbsp;17:28:29&nbsp;<br>
&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Verdana&gt;&lt;STRONG&gt;收件人：&lt;/STRONG&gt;&nbsp;youpingl;&nbsp;Discussions&nbsp;about&nbsp;<br>
RabbitMQ&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Verdana&gt;&lt;STRONG&gt;抄送：&lt;/STRONG&gt;&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Verdana&gt;&lt;STRONG&gt;主题：&lt;/STRONG&gt;&nbsp;Re:&nbsp;[rabbitmq-discuss]&nbsp;<br>
client_timeout&nbsp;errors&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Verdana&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&nbsp;face=Verdana&gt;<br>
&lt;DIV&gt;On&nbsp;17&nbsp;June&nbsp;2014&nbsp;at&nbsp;13:14:01,&nbsp;youpingl&nbsp;(youpingl@sina.com)&nbsp;wrote:&lt;/DIV&gt;<br>
&lt;DIV&gt;&gt;&nbsp;&gt;&nbsp;I&nbsp;used&nbsp;the&nbsp;delphi&nbsp;stomp&nbsp;client(v1.7)&nbsp;to&nbsp;connect&nbsp;the&nbsp;Rabbitmq&nbsp;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&gt;&nbsp;server(v3.3.2)&nbsp;for&nbsp;RPC.&nbsp;But&nbsp;the&nbsp;Rabbitmq&nbsp;server&nbsp;appears&nbsp;errors&nbsp;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&gt;&nbsp;report&nbsp;list&nbsp;below&nbsp;occasionally,&nbsp;what&nbsp;happens?&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;This&nbsp;means&nbsp;a&nbsp;STOMP&nbsp;client&nbsp;missed&nbsp;a&nbsp;heartbeat.&nbsp;Mind&nbsp;you,&nbsp;we&nbsp;should&nbsp;log&lt;/DIV&gt;<br>
&lt;DIV&gt;something&nbsp;more&nbsp;sensible&nbsp;here&nbsp;but&nbsp;ultimately&nbsp;it&nbsp;is&nbsp;a&nbsp;network&nbsp;connectivity&lt;/DIV&gt;<br>
&lt;DIV&gt;issue&nbsp;between&nbsp;your&nbsp;client&nbsp;and&nbsp;RabbitMQ&nbsp;node&nbsp;it&nbsp;connects&nbsp;to.&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;--&nbsp;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;MK&nbsp;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;Software&nbsp;Engineer,&nbsp;Pivotal/RabbitMQ&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
