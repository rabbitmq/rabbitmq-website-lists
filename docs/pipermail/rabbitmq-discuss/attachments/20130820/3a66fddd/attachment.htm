<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;in&nbsp;the&nbsp;process&nbsp;using&nbsp;amqpc&nbsp;but&nbsp;in&nbsp;the&nbsp;mean&nbsp;time&nbsp;I&nbsp;thought&nbsp;to&nbsp;ask&nbsp;on&nbsp;my&nbsp;queries.&lt;/div&gt;&lt;div&gt;I&nbsp;did&nbsp;not&nbsp;particularly&nbsp;thought&nbsp;of&nbsp;just&nbsp;saturating&nbsp;the&nbsp;link&nbsp;but&nbsp;after&nbsp;checking&nbsp;most&nbsp;of&nbsp;my&nbsp;traces&nbsp;I&nbsp;found&nbsp;no&nbsp;packing&nbsp;so&nbsp;just&nbsp;asked&nbsp;about&nbsp;it.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;will&nbsp;write&nbsp;back&nbsp;once&nbsp;I&nbsp;do&nbsp;my&nbsp;analysis. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;again&nbsp;for&nbsp;writing&nbsp;back.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//P&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Aug&nbsp;20,&nbsp;2013&nbsp;at&nbsp;1:16&nbsp;PM,&nbsp;Michael&nbsp;Klishin&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mklishin@gopivotal.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mklishin@gopivotal.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Priyanki&nbsp;Vashi:&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;1)&nbsp;As&nbsp;I&nbsp;learnt&nbsp;now&nbsp;Pika,&nbsp;Erlang&nbsp;,&nbsp;Java&nbsp;and&nbsp;.net&nbsp;clients&nbsp;all&nbsp;set&nbsp;TCP_NODELAY&nbsp;flag,&nbsp;which&nbsp;means&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;intelligence&nbsp;within&nbsp;this&nbsp;clients&nbsp;to&nbsp;pack&nbsp;bytes&nbsp;together&nbsp;to&nbsp;make&nbsp;almost&nbsp;equal&nbsp;to&nbsp;MTU.&nbsp;Is&nbsp;it&nbsp;correct&nbsp;?&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
&lt;/div&gt;Setting&nbsp;TCP_NODELAY&nbsp;on&nbsp;a&nbsp;socket&nbsp;disables&nbsp;Nagle&amp;#39;s&nbsp;algorithm.&nbsp;See&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://boundary.com/blog/2012/05/02/know-a-delay-nagles-algorithm-and-you/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://boundary.com/blog/2012/05/02/know-a-delay-nagles-algorithm-and-you/&lt;/a&gt;&lt;br&gt;<br>
and&nbsp;&lt;a&nbsp;href=&quot;http://tools.ietf.org/html/rfc896&quot;&nbsp;target=&quot;_blank&quot;&gt;http://tools.ietf.org/html/rfc896&lt;/a&gt;.&lt;br&gt;<br>
&lt;br&gt;<br>
Clients&nbsp;simply&nbsp;write&nbsp;data&nbsp;to&nbsp;a&nbsp;socket&nbsp;and&nbsp;are&nbsp;not&nbsp;aware&nbsp;of&nbsp;Ethernet&nbsp;framing.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;2)&nbsp;And&nbsp;then&nbsp;in&nbsp;case&nbsp;of&nbsp;some&nbsp;clients&nbsp;like&nbsp;Erlang,&nbsp;Java&nbsp;and&nbsp;.net,&nbsp;the&nbsp;aggregation&nbsp;happens&nbsp;in&nbsp;buffer&nbsp;prior&nbsp;to&nbsp;hitting&nbsp;the&nbsp;O/S&nbsp;network&nbsp;layer&nbsp;so&nbsp;then&nbsp;why&nbsp;it&amp;#39;s&nbsp;not&nbsp;the&nbsp;behaviour&nbsp;in&nbsp;pika-clients&nbsp;?&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;My&nbsp;MTU&nbsp;size&nbsp;is&nbsp;set&nbsp;to&nbsp;1500&nbsp;bytes&nbsp;but&nbsp;I&nbsp;don&amp;#39;t&nbsp;see&nbsp;that&nbsp;such&nbsp;agreegation&nbsp;happening.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&amp;quot;aggregation&nbsp;in&nbsp;a&nbsp;buffer&amp;quot;&nbsp;basically&nbsp;means&nbsp;that&nbsp;when&nbsp;you&nbsp;need&nbsp;to&nbsp;write&nbsp;3&nbsp;frames&nbsp;like&nbsp;this&lt;br&gt;<br>
&lt;br&gt;<br>
[basic.publish&nbsp;frame]&nbsp;[content&nbsp;header&nbsp;frame]&nbsp;[message&nbsp;payload&nbsp;frame]&lt;br&gt;<br>
&lt;br&gt;<br>
you&nbsp;serialize&nbsp;and&nbsp;concatenate&nbsp;them&nbsp;all&nbsp;in&nbsp;a&nbsp;buffer&nbsp;(or&nbsp;similar)&nbsp;and&nbsp;call&nbsp;socket.write&lt;br&gt;<br>
(or&nbsp;similar)&nbsp;once&nbsp;instead&nbsp;of&nbsp;3&nbsp;times.&nbsp;This&nbsp;*may*&nbsp;help&nbsp;achieve&nbsp;the&nbsp;kind&nbsp;of&nbsp;framing&nbsp;you&nbsp;want&nbsp;but&nbsp;there&nbsp;are&lt;br&gt;<br>
no&nbsp;guarantees&nbsp;and&nbsp;clients&nbsp;do&nbsp;not&nbsp;control&nbsp;that,&nbsp;the&nbsp;OS&nbsp;does.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;3)&nbsp;I&nbsp;can&nbsp;see&nbsp;that&nbsp;server&nbsp;does&nbsp;such&nbsp;packing&nbsp;while&nbsp;sending&nbsp;to&nbsp;consumer&nbsp;but&nbsp;still&nbsp;it&nbsp;does&nbsp;not&nbsp;fill&nbsp;till&nbsp;MTU&nbsp;limit.&nbsp;In&nbsp;my&nbsp;case&nbsp;I&nbsp;see&nbsp;it&amp;#39;s&nbsp;just&nbsp;fill&nbsp;maximum&nbsp;of&nbsp;204&nbsp;bytes&nbsp;from&nbsp;server&nbsp;to&nbsp;consumer&nbsp;(&nbsp;showing&nbsp;basic-deliver,&nbsp;content-body&nbsp;and&nbsp;content-header)&lt;br&gt;<br>
<br>
&amp;gt;&nbsp;Is&nbsp;this&nbsp;the&nbsp;expected&nbsp;behavior&nbsp;of&nbsp;rabbit&nbsp;server&nbsp;?&lt;br&gt;<br>
&amp;gt;&nbsp;4)&nbsp;But&nbsp;I&nbsp;always&nbsp;see&nbsp;only&nbsp;individual&nbsp;frames&nbsp;(of&nbsp;individual&nbsp;methods)&nbsp;from&nbsp;client&nbsp;to&nbsp;server.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;I&nbsp;will&nbsp;assume&nbsp;this&nbsp;discussion&nbsp;is&nbsp;a&nbsp;continuation&nbsp;to&nbsp;your&nbsp;earlier&nbsp;emails&nbsp;about&nbsp;trying&nbsp;to&nbsp;saturate&lt;br&gt;<br>
a&nbsp;link&nbsp;with&nbsp;Pika&nbsp;and&nbsp;RabbitMQ.&lt;br&gt;<br>
&lt;br&gt;<br>
Have&nbsp;you&nbsp;tried&nbsp;using&nbsp;MulticastMain,&nbsp;amqpc&nbsp;or&nbsp;a&nbsp;custom&nbsp;Java&nbsp;program&nbsp;after&nbsp;all&nbsp;to&nbsp;see&lt;br&gt;<br>
if&nbsp;it&amp;#39;s&nbsp;any&nbsp;different?&nbsp;With&nbsp;the&nbsp;Java&nbsp;client,&nbsp;it&nbsp;is&nbsp;possible&nbsp;to&nbsp;tweak&nbsp;TCP_NODELAY&lt;br&gt;<br>
setting&nbsp;and&nbsp;see&nbsp;if&nbsp;it&nbsp;produces&nbsp;any&nbsp;results.&lt;br&gt;<br>
&lt;br&gt;<br>
Also,&nbsp;if&nbsp;your&nbsp;link&nbsp;is&nbsp;not&nbsp;saturated,&nbsp;trying&nbsp;to&nbsp;pack&nbsp;multiple&nbsp;TCP&nbsp;segments&lt;br&gt;<br>
into&nbsp;a&nbsp;single&nbsp;Ethernet&nbsp;frame&nbsp;won&amp;#39;t&nbsp;make&nbsp;it&nbsp;saturated.&lt;br&gt;<br>
--&lt;br&gt;<br>
MK&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
