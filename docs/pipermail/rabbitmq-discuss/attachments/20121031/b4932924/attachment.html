<tt>
&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;publish-subscribe&nbsp;use&nbsp;case&nbsp;where&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;block&nbsp;on&nbsp;the&nbsp;publish&nbsp;side&nbsp;until&nbsp;each&nbsp;of&nbsp;the&nbsp;subscribers&nbsp;confirm&nbsp;that&nbsp;they&nbsp;have&nbsp;completed&nbsp;handling&nbsp;the&nbsp;message&nbsp;sent&nbsp;by&nbsp;the&nbsp;publisher.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;(incorrectly?)&nbsp;assumed&nbsp;that&nbsp;I&nbsp;could&nbsp;use&nbsp;RabbitMQ&nbsp;and&nbsp;its&nbsp;Java&nbsp;amqp-client&amp;#39;s&nbsp;Channel.waitForConfirmsOrDie&nbsp;method&nbsp;as&nbsp;part&nbsp;of&nbsp;my&nbsp;solution.&nbsp;The&nbsp;issue&nbsp;is&nbsp;that&nbsp;I&nbsp;haven&amp;#39;t&nbsp;found&nbsp;a&nbsp;case&nbsp;in&nbsp;which&nbsp;waitForConfirmsOrDie&nbsp;will&nbsp;actually&nbsp;block.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;According&nbsp;to&nbsp;the&nbsp;javadocs&nbsp;(&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/javadoc/com/rabbitmq/client/Channel.html#waitForConfirmsOrDie()&quot;&gt;http://www.rabbitmq.com/javadoc/com/rabbitmq/client/Channel.html#waitForConfirmsOrDie()&lt;/a&gt;),&nbsp;waitForConfirmsOrDie&nbsp;is&nbsp;supposed&nbsp;to:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&nbsp;Wait&nbsp;until&nbsp;all&nbsp;messages&nbsp;published&nbsp;since&nbsp;the&nbsp;last&nbsp;call&nbsp;have&nbsp;been&nbsp;either&nbsp;ack&amp;#39;d&nbsp;or&nbsp;nack&amp;#39;d&nbsp;by&nbsp;the&nbsp;broker.&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;messages&nbsp;were&nbsp;nack&amp;#39;d,&nbsp;waitForConfirmsOrDie&nbsp;will&nbsp;throw&nbsp;an&nbsp;IOException.&nbsp;When&nbsp;called&nbsp;on&nbsp;a&nbsp;non-Confirm&nbsp;channel,&nbsp;it&nbsp;will&nbsp;return&nbsp;immediately.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;order&nbsp;to&nbsp;test&nbsp;that&nbsp;this&nbsp;method&nbsp;really&nbsp;works,&nbsp;I&nbsp;started&nbsp;with&nbsp;example&nbsp;code&nbsp;from&nbsp;the&nbsp;RabbitMQ&nbsp;website&nbsp;(&lt;a&nbsp;href=&quot;http://hg.rabbitmq.com/rabbitmq-java-client/raw-file/da241e35951b/test/src/com/rabbitmq/examples/ConfirmDontLoseMessages.java&quot;&gt;http://hg.rabbitmq.com/rabbitmq-java-client/raw-file/da241e35951b/test/src/com/rabbitmq/examples/ConfirmDontLoseMessages.java&lt;/a&gt;).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;example&nbsp;code&nbsp;creates&nbsp;a&nbsp;publisher&nbsp;and&nbsp;a&nbsp;consumer,&nbsp;each&nbsp;on&nbsp;its&nbsp;own&nbsp;separate&nbsp;thread.&nbsp;Then&nbsp;the&nbsp;publisher&nbsp;sends&nbsp;messages&nbsp;to&nbsp;the&nbsp;exchange&nbsp;while&nbsp;the&nbsp;consumer&nbsp;consumes&nbsp;the&nbsp;messages.&nbsp;It&nbsp;seems&nbsp;to&nbsp;me&nbsp;that&nbsp;the&nbsp;publisher&nbsp;is&nbsp;supposed&nbsp;to&nbsp;block&nbsp;until&nbsp;all&nbsp;of&nbsp;the&nbsp;messages&nbsp;are&nbsp;ack&amp;#39;d&nbsp;via&nbsp;its&nbsp;call&nbsp;to&nbsp;waitForConfirmsOrDie().&nbsp;Is&nbsp;this&nbsp;what&nbsp;this&nbsp;is&nbsp;really&nbsp;supposed&nbsp;to&nbsp;do?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;example&nbsp;code&nbsp;seemed&nbsp;like&nbsp;it&nbsp;matched&nbsp;up&nbsp;perfectly&nbsp;with&nbsp;what&nbsp;I&nbsp;was&nbsp;trying&nbsp;to&nbsp;do.&nbsp;But,&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;seem&nbsp;to&nbsp;work&nbsp;the&nbsp;way&nbsp;I&nbsp;thought&nbsp;it&nbsp;did.&nbsp;In&nbsp;fact,&nbsp;if,&nbsp;in&nbsp;the&nbsp;consumer&nbsp;thread,&nbsp;I&nbsp;turn&nbsp;off&nbsp;auto-acking&nbsp;messages,&nbsp;then&nbsp;waitForConfirmsOrDie()&nbsp;still&nbsp;returns&nbsp;immediately.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;turned&nbsp;off&nbsp;auto&nbsp;ack&nbsp;by&nbsp;just&nbsp;changing&nbsp;one&nbsp;false&nbsp;to&nbsp;true: &lt;/div&gt;&lt;div&gt;ch.queueDeclare(QUEUE_NAME,&nbsp;false,&nbsp;false,&nbsp;false,&nbsp;null); &lt;/div&gt;&lt;div&gt;becomes &lt;/div&gt;&lt;div&gt;ch.queueDeclare(QUEUE_NAME,&nbsp;true,&nbsp;false,&nbsp;false,&nbsp;null);&nbsp;(2nd&nbsp;arg&nbsp;false&nbsp;instead&nbsp;of&nbsp;true). &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;believe&nbsp;this&nbsp;means&nbsp;that&nbsp;acks&nbsp;should&nbsp;no&nbsp;longer&nbsp;be&nbsp;sent&nbsp;by&nbsp;the&nbsp;consumer.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;what&nbsp;does&nbsp;waitForConfirmsOrDie()&nbsp;actually&nbsp;do?&nbsp;When&nbsp;would&nbsp;it&nbsp;block?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;waitForConfirmsOrDie&nbsp;doesn&amp;#39;t&nbsp;do&nbsp;what&nbsp;I&nbsp;want,&nbsp;is&nbsp;there&nbsp;a&nbsp;way&nbsp;to&nbsp;make&nbsp;a&nbsp;publisher&nbsp;wait&nbsp;until&nbsp;all&nbsp;subscribers&nbsp;ack&nbsp;a&nbsp;message&nbsp;before&nbsp;proceeding?&lt;/div&gt;<br>

</tt>
