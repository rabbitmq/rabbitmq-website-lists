<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Because&nbsp;thats&nbsp;not&nbsp;quite&nbsp;how&nbsp;AMQP&nbsp;heartbeats&nbsp;work&nbsp;(I&amp;#39;m&nbsp;sorry&nbsp;if&nbsp;some&nbsp;code&nbsp;I&nbsp;posted&nbsp;earlier&nbsp;lead&nbsp;you&nbsp;astray).&nbsp;Heartbeats&nbsp;in&nbsp;AMQP&nbsp;work&nbsp;by&nbsp;having&nbsp;each&nbsp;peer&nbsp;(the&nbsp;broker,&nbsp;and&nbsp;the&nbsp;client)&nbsp;have&nbsp;a&nbsp;timer&nbsp;for&nbsp;receiving&nbsp;something&nbsp;from&nbsp;the&nbsp;other&nbsp;host&nbsp;(something&nbsp;could&nbsp;be&nbsp;useful&nbsp;communication&nbsp;like&nbsp;message&nbsp;delivery&nbsp;or&nbsp;publishing,&nbsp;or&nbsp;in&nbsp;the&nbsp;case&nbsp;that&nbsp;a&nbsp;peer&nbsp;has&nbsp;nothing&nbsp;useful&nbsp;to&nbsp;send,&nbsp;it&nbsp;can&nbsp;send&nbsp;a&nbsp;heartbeat).&nbsp;If&nbsp;the&nbsp;timer&nbsp;reaches&nbsp;0&nbsp;at&nbsp;either&nbsp;end,&nbsp;that&nbsp;peer&nbsp;is&nbsp;supposed&nbsp;to&nbsp;close&nbsp;the&nbsp;socket&nbsp;immediately.&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;From&nbsp;an&nbsp;implementation&nbsp;point&nbsp;of&nbsp;view&nbsp;you&nbsp;need&nbsp;to&nbsp;have&nbsp;2&nbsp;timers:&nbsp;one&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;when&nbsp;the&nbsp;last&nbsp;time&nbsp;you&nbsp;received&nbsp;data,&nbsp;if&nbsp;this&nbsp;timer&nbsp;expires&nbsp;you&nbsp;know&nbsp;that&nbsp;your&nbsp;connection&nbsp;to&nbsp;the&nbsp;broker&nbsp;is&nbsp;dead&nbsp;and&nbsp;you&nbsp;need&nbsp;to&nbsp;close&nbsp;the&nbsp;socket.&nbsp;A&nbsp;second&nbsp;timer&nbsp;is&nbsp;needed&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;the&nbsp;last&nbsp;time&nbsp;you&nbsp;sent&nbsp;data,&nbsp;when&nbsp;this&nbsp;timer&nbsp;expires&nbsp;a&nbsp;heartbeat&nbsp;frame&nbsp;needs&nbsp;to&nbsp;be&nbsp;sent.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;current&nbsp;design&nbsp;of&nbsp;rabbitmq-c&nbsp;single-threaded&nbsp;event-driven,&nbsp;meaning&nbsp;the&nbsp;library&nbsp;itself&nbsp;doesn&amp;#39;t&nbsp;do&nbsp;anything&nbsp;when&nbsp;you&amp;#39;re&nbsp;not&nbsp;calling&nbsp;into&nbsp;the&nbsp;library,&nbsp;and&nbsp;has&nbsp;no&nbsp;thread&nbsp;behind&nbsp;the&nbsp;scenes&nbsp;dealing&nbsp;with&nbsp;these&nbsp;timers.&nbsp;So&nbsp;lets&nbsp;say&nbsp;you&nbsp;received&nbsp;a&nbsp;message,&nbsp;then&nbsp;spent&nbsp;more&nbsp;than&nbsp;2&nbsp;*&nbsp;heartbeat&nbsp;interval&nbsp;processing&nbsp;the&nbsp;message&nbsp;without&nbsp;calling&nbsp;into&nbsp;rabbitmq-c,&nbsp;the&nbsp;connection&nbsp;would&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;broker.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Using&nbsp;the&nbsp;current&nbsp;single-threaded&nbsp;event-driven&nbsp;model&nbsp;of&nbsp;the&nbsp;library&nbsp;I&nbsp;have&nbsp;not&nbsp;been&nbsp;able&nbsp;to&nbsp;come&nbsp;up&nbsp;with&nbsp;a&nbsp;good&nbsp;way&nbsp;to&nbsp;implement&nbsp;heartbeating&nbsp;that&nbsp;is&nbsp;totally&nbsp;internal&nbsp;to&nbsp;the&nbsp;library&nbsp;(it&nbsp;also&nbsp;needs&nbsp;to&nbsp;be&nbsp;cross&nbsp;platform&nbsp;and&nbsp;not&nbsp;rely&nbsp;on&nbsp;a&nbsp;non-sharable&nbsp;global&nbsp;resource&nbsp;like&nbsp;setitimer()/SIGALARM).&nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;The&nbsp;best&nbsp;way&nbsp;to&nbsp;fully&nbsp;implement&nbsp;heartbeats&nbsp;in&nbsp;rabbitmq-c&nbsp;is&nbsp;to&nbsp;add&nbsp;a&nbsp;thread&nbsp;behind&nbsp;the&nbsp;scenes&nbsp;that&nbsp;deals&nbsp;with&nbsp;these&nbsp;timers,&nbsp;a&nbsp;second&nbsp;alternative&nbsp;that&nbsp;could&nbsp;be&nbsp;provided&nbsp;by&nbsp;those&nbsp;who&nbsp;don&amp;#39;t&nbsp;want&nbsp;the&nbsp;overhead&nbsp;of&nbsp;a&nbsp;separate&nbsp;behind-the-scenes&nbsp;thread&nbsp;would&nbsp;be&nbsp;to&nbsp;provide&nbsp;functions&nbsp;that&nbsp;could&nbsp;be&nbsp;plugged&nbsp;into&nbsp;an&nbsp;event&nbsp;loop.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;HTH&lt;/div&gt;&lt;div&nbsp;style&gt;-Alan&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Apr&nbsp;5,&nbsp;2013&nbsp;at&nbsp;11:48&nbsp;AM,&nbsp;Moebius&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:cmorris@voicerite.com&quot;&nbsp;target=&quot;_blank&quot;&gt;cmorris@voicerite.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;I&nbsp;am&nbsp;new&nbsp;to&nbsp;all&nbsp;this,&nbsp;but&nbsp;wanted&nbsp;to&nbsp;ask&nbsp;a&nbsp;couple&nbsp;of&nbsp;questions.&nbsp; If&nbsp;the&lt;br&gt;<br>
library&nbsp;sees&nbsp;a&nbsp;heartbeat&nbsp;come&nbsp;in,&nbsp;why&nbsp;can&amp;#39;t&nbsp;it&nbsp;just&nbsp;send&nbsp;one&nbsp;back&nbsp;in&lt;br&gt;<br>
response?&nbsp; Why&nbsp;would&nbsp;there&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;message&nbsp;queue&nbsp;involved?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Alan&nbsp;Antonuk&nbsp;wrote&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&amp;gt;&nbsp;While&nbsp;I&nbsp;cannot&nbsp;comment&nbsp;on&nbsp;what&nbsp;Dawn&nbsp;ended&nbsp;up&nbsp;doing,&nbsp;I&nbsp;can&nbsp;say&nbsp;a&nbsp;few&nbsp;words&lt;br&gt;<br>
&amp;gt;&nbsp;about&nbsp;the&nbsp;rabbitmq-c&nbsp;library.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Currently&nbsp;the&nbsp;rabbitmq-c&nbsp;only&nbsp;has&nbsp;partial&nbsp;support&nbsp;for&nbsp;AMQP&nbsp;heartbeats:&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;library&nbsp;understands&nbsp;AMQP&nbsp;hearbeats&nbsp;at&nbsp;a&nbsp;protocol&nbsp;level,&nbsp;the&nbsp;library&lt;br&gt;<br>
&amp;gt;&nbsp;provides&nbsp;an&nbsp;interface&nbsp;for&nbsp;sending&nbsp;and&nbsp;receiving&nbsp;frames&nbsp;that&nbsp;allows&lt;br&gt;<br>
&amp;gt;&nbsp;heartbeat&nbsp;frames&nbsp;to&nbsp;be&nbsp;sent,&nbsp;however&nbsp;the&nbsp;library&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;event&lt;br&gt;<br>
&amp;gt;&nbsp;loop&nbsp;that&nbsp;will&nbsp;automatically&nbsp;handle&nbsp;heartbeats&nbsp;for&nbsp;you.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;To&nbsp;use&nbsp;heartbeats&nbsp;with&nbsp;rabbitmq-c&nbsp;you&nbsp;would&nbsp;need&nbsp;to&nbsp;provide&nbsp;your&nbsp;own&nbsp;event&lt;br&gt;<br>
&amp;gt;&nbsp;loop/logic&nbsp;to&nbsp;send&nbsp;and&nbsp;receive&nbsp;heartbeat&nbsp;frames.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;HTH&lt;br&gt;<br>
&amp;gt;&nbsp;-Alan&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;--&lt;br&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://rabbitmq.1065348.n5.nabble.com/Is-heartbeat-option-working-in-C-client-tp23785p25909.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://rabbitmq.1065348.n5.nabble.com/Is-heartbeat-option-working-in-C-client-tp23785p25909.html&lt;/a&gt;&lt;br&gt;<br>
<br>
Sent&nbsp;from&nbsp;the&nbsp;RabbitMQ&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
