<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;6.5.7652.24&quot;&gt;<br>
&lt;TITLE&gt;RE:&nbsp;[rabbitmq-discuss]&nbsp;High&nbsp;cpu&nbsp;usage&nbsp;for&nbsp;Java&nbsp;RabbitMQ&nbsp;client?&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(solved,&nbsp;my&nbsp;fault)&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;!--&nbsp;Converted&nbsp;from&nbsp;text/plain&nbsp;format&nbsp;--&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Matthias,&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;gt;&nbsp;The&nbsp;instructions&nbsp;do&nbsp;indeed&nbsp;need&nbsp;fixing.&nbsp;We&nbsp;are&nbsp;aware&nbsp;of&nbsp;that,&nbsp;but&nbsp;just&lt;BR&gt;<br>
&amp;gt;&nbsp;haven't&nbsp;found&nbsp;the&nbsp;time&nbsp;to&nbsp;do&nbsp;it&nbsp;yet.&lt;BR&gt;<br>
&lt;BR&gt;<br>
There's&nbsp;never&nbsp;enough&nbsp;time&nbsp;for&nbsp;documentation&nbsp;:)&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;Also,&nbsp;I&nbsp;have&nbsp;looked&nbsp;through&nbsp;the&nbsp;AMQP&nbsp;lists&nbsp;a&nbsp;little&nbsp;bit&nbsp;and&nbsp;saw&nbsp;some&lt;BR&gt;<br>
&amp;gt;&nbsp;&amp;gt;&amp;nbsp;&nbsp;discussion&nbsp;of&nbsp;a&nbsp;compressed&nbsp;or&nbsp;binary&nbsp;wire&nbsp;format,&nbsp;specifically&lt;BR&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;relating&nbsp;to&nbsp;market&nbsp;quotes.&amp;nbsp;&nbsp;It&nbsp;looks&nbsp;like&nbsp;this&nbsp;is&nbsp;slated&nbsp;for&nbsp;1.0,&nbsp;but&lt;BR&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;that&nbsp;would&nbsp;be&nbsp;ideal&nbsp;for&nbsp;me&nbsp;(since&nbsp;AMQP&nbsp;overhead&nbsp;is&nbsp;~30-50%&nbsp;of&nbsp;my&lt;BR&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;message&nbsp;size&nbsp;now).&amp;nbsp;&nbsp;Is&nbsp;there&nbsp;a&nbsp;roadmap&nbsp;to&nbsp;adoption?&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;You&nbsp;are&nbsp;the&nbsp;first&nbsp;person&nbsp;to&nbsp;ask&nbsp;about&nbsp;this&nbsp;:)&nbsp;We&nbsp;have&nbsp;thought&nbsp;about&nbsp;more&lt;BR&gt;<br>
&amp;gt;&nbsp;compact&nbsp;encodings&nbsp;for&nbsp;messaging&nbsp;than&nbsp;present&nbsp;in&nbsp;AMQP.&nbsp;See,&nbsp;for&nbsp;example&lt;BR&gt;<br>
&amp;gt;&nbsp;Tony's&nbsp;&amp;quot;Streamlining&nbsp;HTTP&amp;quot;&nbsp;post&lt;BR&gt;<br>
&amp;gt;&nbsp;(&lt;A&nbsp;HREF=&quot;http://www.lshift.net/blog/2009/02/27/streamlining-http&quot;&gt;http://www.lshift.net/blog/2009/02/27/streamlining-http&lt;/A&gt;),&nbsp;but&nbsp;we&nbsp;have&lt;BR&gt;<br>
&amp;gt;&nbsp;no&nbsp;concrete&nbsp;plans&nbsp;for&nbsp;implementation&nbsp;yet.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Have&nbsp;you&nbsp;thought&nbsp;about&nbsp;approaching&nbsp;the&nbsp;AMQP&nbsp;spec&nbsp;with&nbsp;Thrift&nbsp;or&nbsp;ProtocolBuffers&nbsp;encoding?&amp;nbsp;&nbsp;Tony's&nbsp;post&nbsp;is&nbsp;very&nbsp;much&nbsp;inline&nbsp;with&nbsp;what&nbsp;I've&nbsp;found,&nbsp;we&nbsp;have&nbsp;a&nbsp;few&nbsp;messages&nbsp;that&nbsp;are&nbsp;very&nbsp;small&nbsp;(24&nbsp;bytes)&nbsp;and&nbsp;some&nbsp;that&nbsp;are&nbsp;larger&nbsp;(~500&nbsp;bytes)&nbsp;so&nbsp;the&nbsp;AMQP&nbsp;overhead&nbsp;is&nbsp;very&nbsp;noticeable.&amp;nbsp;&nbsp;Disabling&nbsp;positive-ack&nbsp;from&nbsp;the&nbsp;queues&nbsp;helped&nbsp;alleviate&nbsp;some&nbsp;of&nbsp;the&nbsp;traffic,&nbsp;but&nbsp;not&nbsp;enough&nbsp;to&nbsp;matter.&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;gt;&nbsp;Does&nbsp;the&nbsp;overhead&nbsp;really&nbsp;cause&nbsp;problems&nbsp;in&nbsp;your&nbsp;setup?&nbsp;Do&nbsp;you&nbsp;end&nbsp;up&lt;BR&gt;<br>
&amp;gt;&nbsp;saturating&nbsp;the&nbsp;network?&lt;BR&gt;<br>
&lt;BR&gt;<br>
Well,&nbsp;our&nbsp;current&nbsp;system&nbsp;has&nbsp;about&nbsp;50&nbsp;clients&nbsp;each&nbsp;consuming&nbsp;a&nbsp;3Mbps&nbsp;stream.&amp;nbsp;&nbsp;I&nbsp;was&nbsp;hoping&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;swap&nbsp;out&nbsp;the&nbsp;backend&nbsp;to&nbsp;AMQP&nbsp;and&nbsp;then&nbsp;perform&nbsp;optimizations&nbsp;using&nbsp;the&nbsp;routing&nbsp;keys.&amp;nbsp;&nbsp;However,&nbsp;the&nbsp;AMQP&nbsp;&amp;quot;stream&amp;quot;&nbsp;would&nbsp;at&nbsp;that&nbsp;point&nbsp;bump&nbsp;to&nbsp;5-6Mbps.&amp;nbsp;&nbsp;That's&nbsp;not&nbsp;too&nbsp;practical&nbsp;over&nbsp;our&nbsp;WAN&nbsp;links.&amp;nbsp;&nbsp;This&nbsp;just&nbsp;adds&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;effort&nbsp;to&nbsp;switch&nbsp;to&nbsp;AMQP,&nbsp;by&nbsp;reworking&nbsp;the&nbsp;client&nbsp;to&nbsp;query&nbsp;the&nbsp;more&nbsp;static&nbsp;data&nbsp;from&nbsp;a&nbsp;DB&nbsp;instead&nbsp;of&nbsp;streaming&nbsp;it&nbsp;over&nbsp;and&nbsp;over&nbsp;(so&nbsp;the&nbsp;discussions&nbsp;I've&nbsp;seen&nbsp;about&nbsp;last&nbsp;quote&nbsp;caching&nbsp;would&nbsp;be&nbsp;a&nbsp;nice&nbsp;feature).&amp;nbsp;&nbsp;The&nbsp;eventual&nbsp;goal&nbsp;is&nbsp;to&nbsp;have&nbsp;clustered&nbsp;brokers&nbsp;that&nbsp;do&nbsp;the&nbsp;traffic&nbsp;management&nbsp;between&nbsp;the&nbsp;remote&nbsp;nodes&nbsp;that&nbsp;generate&nbsp;messages,&nbsp;so&nbsp;that&nbsp;the&nbsp;data&nbsp;that&nbsp;needs&nbsp;to&nbsp;be&nbsp;routed&nbsp;across&nbsp;our&nbsp;WAN&nbsp;links&nbsp;is,&nbsp;but&nbsp;the&nbsp;majority&nbsp;of&nbsp;the&nbsp;data&nbsp;will&nbsp;stay&nbsp;local&nbsp;to&nbsp;the&nbsp;producers&nbsp;for&nbsp;archiving.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Thanks,&lt;BR&gt;<br>
Rob&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;
</tt>
