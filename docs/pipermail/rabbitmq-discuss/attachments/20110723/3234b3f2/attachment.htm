<tt>
&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,sans-serif&quot;&gt;Hi,&nbsp;I&amp;#39;m&nbsp;stuck&nbsp;with&nbsp;trying&nbsp;to&nbsp;find&nbsp;a&nbsp;way&nbsp;to&nbsp;implement&nbsp;generic&nbsp;asynchronous&nbsp;request-reply&nbsp;which&nbsp;works&nbsp;well&nbsp;across&nbsp;shovels.&nbsp;It&nbsp;is&nbsp;going&nbsp;to&nbsp;be&nbsp;somewhat&nbsp;contrived&nbsp;since&nbsp;I&amp;#39;m&nbsp;building&nbsp;a&nbsp;generic&nbsp;bus&nbsp;int&nbsp;.NET&nbsp;using&nbsp;RabbitMQ&nbsp;as&nbsp;the&nbsp;transport,&nbsp;so&nbsp;please&nbsp;bear&nbsp;with&nbsp;me.&lt;/font&gt;&lt;div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;So&nbsp;far&nbsp;it&nbsp;used&nbsp;to&nbsp;work&nbsp;like&nbsp;this:&nbsp;when&nbsp;performing&nbsp;a&nbsp;request&nbsp;I&nbsp;created&nbsp;a&nbsp;temporary&nbsp;queue&nbsp;and&nbsp;sent&nbsp;its&nbsp;name&nbsp;in&nbsp;the&nbsp;ReplyTo&nbsp;field,&nbsp;then&nbsp;the&nbsp;receiver&nbsp;of&nbsp;the&nbsp;request&nbsp;sent&nbsp;its&nbsp;reply&nbsp;on&nbsp;the&nbsp;default&nbsp;exchange&nbsp;using&nbsp;this queue&nbsp;name as&nbsp;the&nbsp;routing&nbsp;key.&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;Now&nbsp;what&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;do&nbsp;it&nbsp;make&nbsp;it&nbsp;work&nbsp;across&nbsp;shovels,&nbsp;but&nbsp;my&nbsp;implementation&nbsp;(the&nbsp;way&nbsp;I&nbsp;would&nbsp;like&nbsp;it&nbsp;to&nbsp;be)&nbsp;ideally&nbsp;imposes&nbsp;some&nbsp;decoupling&nbsp;between&nbsp;the&nbsp;request&nbsp;message&nbsp;and&nbsp;the&nbsp;reply&nbsp;message&nbsp;which&nbsp;prevents&nbsp;me&nbsp;from&nbsp;being&nbsp;able&nbsp;to&nbsp;achieve&nbsp;this&nbsp;result.&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;To&nbsp;explain,&nbsp;the&nbsp;request&nbsp;message&nbsp;and&nbsp;the&nbsp;reply&nbsp;message&nbsp;are&nbsp;supposed&nbsp;to&nbsp;be&nbsp;published&nbsp;to&nbsp;different&nbsp;exchanges&nbsp;to&nbsp;make&nbsp;it&nbsp;work&nbsp;across&nbsp;a&nbsp;shovel.&nbsp;This&nbsp;is&nbsp;because,&nbsp;supposing&nbsp;I&nbsp;have&nbsp;two&nbsp;servers,&nbsp;the&nbsp;request&nbsp;has&nbsp;to&nbsp;be&nbsp;published&nbsp;to&nbsp;an&nbsp;exchange&nbsp;that&nbsp;is&nbsp;&amp;quot;shoveled&amp;quot;&nbsp;from&nbsp;server1&nbsp;to&nbsp;server2,&nbsp;while&nbsp;the&nbsp;reply&nbsp;in&nbsp;order&nbsp;to&nbsp;come&nbsp;back&nbsp;to&nbsp;the&nbsp;requestor&nbsp;needs&nbsp;to&nbsp;be&nbsp;published&nbsp;to&nbsp;an&nbsp;exchange&nbsp;shoveled&nbsp;from&nbsp;server2&nbsp;to&nbsp;server1.&nbsp;I&nbsp;hope&nbsp;it&nbsp;makes&nbsp;sense&nbsp;so&nbsp;far.&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;What&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;do&nbsp;is&nbsp;avoiding,&nbsp;when&nbsp;performing&nbsp;the&nbsp;request,&nbsp;to&nbsp;know&nbsp;what&nbsp;exchange&nbsp;the&nbsp;reply&nbsp;will&nbsp;be&nbsp;published&nbsp;to,&nbsp;as&nbsp;I&nbsp;don&amp;#39;t&nbsp;even&nbsp;want&nbsp;to&nbsp;let&nbsp;the&nbsp;requestor&nbsp;be&nbsp;aware&nbsp;of&nbsp;what&nbsp;kind&nbsp;of&nbsp;reply&nbsp;the&nbsp;application&nbsp;is&nbsp;going&nbsp;to&nbsp;receive;&nbsp;it&nbsp;could&nbsp;be&nbsp;a&nbsp;RequestSuccessfulMessage&nbsp;or&nbsp;a&nbsp;RequestFailedMessage&nbsp;for&nbsp;instance.&nbsp;Of&nbsp;course&nbsp;my&nbsp;application&nbsp;will&nbsp;have&nbsp;&amp;quot;handlers&amp;quot;&nbsp;for&nbsp;both&nbsp;of&nbsp;them,&nbsp;but&nbsp;the&nbsp;requestor&nbsp;needen&amp;#39;t&nbsp;know&nbsp;about&nbsp;that. &lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;As&nbsp;an&nbsp;additional&nbsp;detail, in&nbsp;the&nbsp;system&nbsp;I&nbsp;am&nbsp;setting&nbsp;up&nbsp;the&nbsp;channel&nbsp;that&nbsp;dispatches&nbsp;messages&nbsp;is&nbsp;already&nbsp;subscribing&nbsp;to&nbsp;the&nbsp;response&nbsp;exchange&nbsp;because,&nbsp;by&nbsp;convention,&nbsp;I&nbsp;am&nbsp;subscribing&nbsp;to&nbsp;all&nbsp;message&nbsp;types&nbsp;for&nbsp;whom&nbsp;there&nbsp;is&nbsp;a&nbsp;suitable&nbsp;consumer&nbsp;in&nbsp;the&nbsp;application&nbsp;by&nbsp;using&nbsp;their&nbsp;exposed&nbsp;exchange&nbsp;name&nbsp;(I&nbsp;decorate&nbsp;every&nbsp;message&nbsp;type&nbsp;with&nbsp;an&nbsp;attribute&nbsp;containing&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;exchange&nbsp;that&nbsp;message&nbsp;type&nbsp;is&nbsp;published&nbsp;to)&nbsp;and&nbsp;a&nbsp;string&nbsp;representation&nbsp;of&nbsp;message&nbsp;type&nbsp;as&nbsp;the&nbsp;binding&nbsp;key,&nbsp;but&nbsp;in&nbsp;a&nbsp;request/reply&nbsp;scenario&nbsp;I&nbsp;don&amp;#39;t&nbsp;want&nbsp;every&nbsp;instance&nbsp;of&nbsp;my&nbsp;application&nbsp;to&nbsp;receive&nbsp;the&nbsp;reply&nbsp;message,&nbsp;just&nbsp;the&nbsp;one&nbsp;which&nbsp;sent&nbsp;the&nbsp;request,&nbsp;therefore&nbsp;the&nbsp;reply&nbsp;has&nbsp;to&nbsp;come&nbsp;through&nbsp;a&nbsp;different&nbsp;combination&nbsp;of&nbsp;exchange/routing&nbsp;key.&lt;/font&gt;&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;&amp;#39;trebuchet&nbsp;ms&amp;#39;,&nbsp;sans-serif&quot;&gt;Any&nbsp;advice&nbsp;is&nbsp;welcome,&nbsp;you&nbsp;can&nbsp;look&nbsp;at&nbsp;the&nbsp;code&nbsp;&lt;a&nbsp;href=&quot;http://code.google.com/p/mexexp/source/checkout&quot;&gt;here&lt;/a&gt;. There&nbsp;is&nbsp;a&nbsp;failing&nbsp;test&nbsp;in RabbitMQ\Tests.Integration\Bus\RequestReply\Request_and_reply.cs&nbsp;which&nbsp;exposes&nbsp;the&nbsp;problem.&nbsp;The&nbsp;tests&nbsp;are&nbsp;self&nbsp;contained&nbsp;except&nbsp;that&nbsp;they&nbsp;expect&nbsp;a&nbsp;rabbitmq&nbsp;server&nbsp;to&nbsp;be&nbsp;running&nbsp;on&nbsp;localhost&nbsp;(there&nbsp;is&nbsp;one&nbsp;embedded&nbsp;in&nbsp;the&nbsp;repo&nbsp;in&nbsp;folder&nbsp;RabbitMQServer,&nbsp;you&nbsp;can&nbsp;start&nbsp;that&nbsp;one&nbsp;directly)&lt;/font&gt;&lt;/div&gt;<br>
<br>

</tt>
