<tt>
&lt;div&gt;I&nbsp;am&nbsp;testing&nbsp;the&nbsp;durability&nbsp;of&nbsp;my&nbsp;message&nbsp;app&nbsp;and&nbsp;noticed&nbsp;messages&nbsp;being&nbsp;dropped&nbsp;if&nbsp;I&nbsp;restart&nbsp;the&nbsp;broker.&nbsp;I&amp;#39;m&nbsp;running&nbsp;the&nbsp;broker&nbsp;directly&nbsp;in&nbsp;a&nbsp;console&nbsp;using &lt;/div&gt;&lt;div&gt;rabbitmq_server-2.1.1\sbin\rabbitmq-server.bat&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;then&nbsp;publish&nbsp;10,000&nbsp;messages&nbsp;and&nbsp;I&amp;#39;ve&nbsp;set&nbsp;the&nbsp;exchange&nbsp;to&nbsp;durable,&nbsp;the&nbsp;queue&nbsp;to&nbsp;durable,&nbsp;and&nbsp;the&nbsp;message&nbsp;delivery&nbsp;to&nbsp;&amp;quot;2&amp;quot;&nbsp;-&nbsp;as&nbsp;I&nbsp;understand&nbsp;this&nbsp;to&nbsp;be&nbsp;the&nbsp;configuration&nbsp;for&nbsp;messages&nbsp;to&nbsp;be&nbsp;durable.&nbsp;I&nbsp;then&nbsp;use&nbsp;the&nbsp;rabbitmqctl&nbsp;list_queues&nbsp;to&nbsp;show&nbsp;the&nbsp;10,000&nbsp;messages.&nbsp;I&nbsp;close&nbsp;the&nbsp;broker&nbsp;window,&nbsp;to&nbsp;mimic&nbsp;a&nbsp;hard&nbsp;shutdown&nbsp;of&nbsp;a&nbsp;server.&nbsp;When&nbsp;I&nbsp;start&nbsp;the&nbsp;broker&nbsp;back&nbsp;up&nbsp;and&nbsp;list&nbsp;the&nbsp;queues&nbsp;I&nbsp;see&nbsp;8,428&nbsp;messages. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Do&nbsp;you&nbsp;know&nbsp;why&nbsp;I&nbsp;would&nbsp;lose&nbsp;messages?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My environment is:&nbsp;Windows&nbsp;7&nbsp;64bit&nbsp;and&nbsp;am running&nbsp;RabbitMQ&nbsp;2.1.1&nbsp;(disk&nbsp;node)&nbsp;on&nbsp;top&nbsp;of&nbsp;Erlang&nbsp;8.1.1.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;publisher&nbsp;code&nbsp;looks&nbsp;like:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;webkit-indent-blockquote&quot;&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;/blockquote&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;var&nbsp;connectionFactory&nbsp;=&nbsp;new&nbsp;ConnectionFactory();&lt;/font&gt;&lt;div&gt;<br>
&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;connectionFactory.Address&nbsp;=&nbsp;&amp;quot;localhost&amp;quot;;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;using&nbsp;(IConnection&nbsp;connection&nbsp;=&nbsp;connectionFactory.CreateConnection())&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;using&nbsp;(IModel&nbsp;model&nbsp;=&nbsp;connection.CreateModel())&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;model.ExchangeDeclare(&amp;quot;ug.message&amp;quot;,&nbsp;ExchangeType.Topic,&nbsp;true);&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;model.QueueDeclare(&amp;quot;ug.message.rtls&amp;quot;,&nbsp;true);&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;model.QueueBind(&amp;quot;ug.message.rtls&amp;quot;,&nbsp;&amp;quot;ug.message&amp;quot;,&nbsp;&amp;quot;#&amp;quot;,&nbsp;false,&nbsp;null);&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&amp;lt;&nbsp;10000;&nbsp;i++)&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;IBasicProperties&nbsp;messageProperties&nbsp;=&nbsp;model.CreateBasicProperties();&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;messageProperties.DeliveryMode&nbsp;=&nbsp;2;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;byte[]&nbsp;message&nbsp;=&nbsp;System.Text.Encoding.UTF8.GetBytes(&amp;quot;Yo&nbsp;Mama&nbsp;soo&nbsp;fat...&amp;quot;&nbsp;+&nbsp;i);&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;model.BasicPublish(&amp;quot;ug.message&amp;quot;,&nbsp;&amp;quot;ug.message.rtls.move&amp;quot;,&nbsp;messageProperties,&nbsp;message);&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;System.Console.WriteLine(&amp;quot;Published&nbsp;message&nbsp;&amp;quot;&nbsp;+&nbsp;i);&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/font&gt;&lt;/span&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;}&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;help&nbsp;would&nbsp;be&nbsp;greatly appreciated.&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;Thank&nbsp;you,&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000099&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;&quot;&gt;Dave&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>

</tt>
