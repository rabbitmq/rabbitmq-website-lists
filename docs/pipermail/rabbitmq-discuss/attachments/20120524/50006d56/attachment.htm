<tt>
I&nbsp;couldn't&nbsp;find&nbsp;a&nbsp;bug&nbsp;tracker,&nbsp;so&nbsp;I'm&nbsp;reporting&nbsp;this&nbsp;here.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;was&nbsp;stracing&nbsp;a&nbsp;java&nbsp;process&nbsp;that&nbsp;uses&nbsp;the&nbsp;2.8.2&nbsp;java&nbsp;amqp&nbsp;client&nbsp;and&nbsp;I&nbsp;noticed&nbsp;that&nbsp;every&nbsp;basicPublish&nbsp;is&nbsp;resulting&nbsp;in&nbsp;3&nbsp;sendto&nbsp;syscalls:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;3026&nbsp;&amp;nbsp;00:06:51.269104&nbsp;sendto(27,&nbsp;&quot;\1\0\1\0\0\0\17\0&amp;lt;\0(\0\0\6hose04\0\0\316&quot;,&nbsp;23,&nbsp;0,&nbsp;NULL,&nbsp;0&nbsp;&amp;lt;unfinished&nbsp;...&amp;gt;&lt;/div&gt;&lt;div&gt;3027&nbsp;&amp;nbsp;00:06:51.269127&nbsp;&amp;lt;...&nbsp;futex&nbsp;resumed&amp;gt;&nbsp;)&nbsp;=&nbsp;0&nbsp;&amp;lt;0.000030&amp;gt;&lt;/div&gt;&lt;div&gt;3026&nbsp;&amp;nbsp;00:06:51.269142&nbsp;&amp;lt;...&nbsp;sendto&nbsp;resumed&amp;gt;&nbsp;)&nbsp;=&nbsp;23&nbsp;&amp;lt;0.000019&amp;gt;&lt;/div&gt;&lt;div&gt;3025&nbsp;&amp;nbsp;00:06:51.269160&nbsp;sendto(24,&nbsp;&quot;\1\0\1\0\0\0\17\0&amp;lt;\0(\0\0\6hose03\0\0\316&quot;,&nbsp;23,&nbsp;0,&nbsp;NULL,&nbsp;0&nbsp;&amp;lt;unfinished&nbsp;...&amp;gt;&lt;/div&gt;&lt;div&gt;3027&nbsp;&amp;nbsp;00:06:51.269189&nbsp;futex(0x7f8e5c442b54,&nbsp;FUTEX_WAIT_PRIVATE,&nbsp;10202495,&nbsp;NULL&nbsp;&amp;lt;unfinished&nbsp;...&amp;gt;&lt;/div&gt;&lt;div&gt;3026&nbsp;&amp;nbsp;00:06:51.269211&nbsp;sendto(27,&nbsp;&quot;\2\0\1\0\0\0&nbsp;\0&amp;lt;\0\0\0\0\0\0\0\0\7\302\220\0\20application/json\1\316&quot;,&nbsp;40,&nbsp;0,&nbsp;NULL,&nbsp;0&nbsp;&amp;lt;unfinished&nbsp;...&amp;gt;&lt;/div&gt;&lt;div&gt;3025&nbsp;&amp;nbsp;00:06:51.269237&nbsp;&amp;lt;...&nbsp;sendto&nbsp;resumed&amp;gt;&nbsp;)&nbsp;=&nbsp;23&nbsp;&amp;lt;0.000058&amp;gt;&lt;/div&gt;&lt;div&gt;3026&nbsp;&amp;nbsp;00:06:51.269258&nbsp;&amp;lt;...&nbsp;sendto&nbsp;resumed&amp;gt;&nbsp;)&nbsp;=&nbsp;40&nbsp;&amp;lt;0.000024&amp;gt;&lt;/div&gt;&lt;div&gt;3025&nbsp;&amp;nbsp;00:06:51.269279&nbsp;sendto(24,&nbsp;&quot;\2\0\1\0\0\0&nbsp;\0&amp;lt;\0\0\0\0\0\0\0\0\10\206\220\0\20application/json\1\316&quot;,&nbsp;40,&nbsp;0,&nbsp;NULL,&nbsp;0&nbsp;&amp;lt;unfinished&nbsp;...&amp;gt;&lt;/div&gt;&lt;div&gt;3026&nbsp;&amp;nbsp;00:06:51.269314&nbsp;sendto(27,&nbsp;&quot;\3\0\1\0\0\7\302&quot;...,&nbsp;1994,&nbsp;0,&nbsp;NULL,&nbsp;0&nbsp;&amp;lt;unfinished&nbsp;...&amp;gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;3025&nbsp;&amp;nbsp;00:06:51.269444&nbsp;&amp;lt;...&nbsp;sendto&nbsp;resumed&amp;gt;&nbsp;)&nbsp;=&nbsp;40&nbsp;&amp;lt;0.000138&amp;gt;&lt;/div&gt;&lt;div&gt;3026&nbsp;&amp;nbsp;00:06:51.269463&nbsp;&amp;lt;...&nbsp;sendto&nbsp;resumed&amp;gt;&nbsp;)&nbsp;=&nbsp;1994&nbsp;&amp;lt;0.000025&amp;gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;believe&nbsp;these&nbsp;3&nbsp;sendto&nbsp;syscalls&nbsp;per&nbsp;basicPublish&nbsp;is&nbsp;a&nbsp;performance&nbsp;bottleneck&nbsp;and&nbsp;I&nbsp;went&nbsp;looking&nbsp;for&nbsp;a&nbsp;way&nbsp;to&nbsp;make&nbsp;it&nbsp;a&nbsp;single&nbsp;sendto&nbsp;call&nbsp;with&nbsp;all&nbsp;3&nbsp;frames&nbsp;included.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;fairly&nbsp;new&nbsp;to&nbsp;Java&nbsp;and&nbsp;AMQP,&nbsp;so&nbsp;bare&nbsp;with&nbsp;me.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;client&nbsp;is&nbsp;using&nbsp;BufferedOutputStream&nbsp;to&nbsp;wrap&nbsp;socket&nbsp;io&nbsp;in:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http://hg.rabbitmq.com/rabbitmq-java-client/file/b643c5c8ec23/src/com/rabbitmq/client/impl/SocketFrameHandler.java&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;BufferedOutputStream&nbsp;has&nbsp;a&nbsp;default&nbsp;buffer&nbsp;size&nbsp;of&nbsp;512&nbsp;bytes&nbsp;which&nbsp;suggests&nbsp;to&nbsp;me&nbsp;that&nbsp;flush()&nbsp;must&nbsp;be&nbsp;called&nbsp;in&nbsp;order&nbsp;to&nbsp;produce&nbsp;these&nbsp;small&nbsp;23&nbsp;and&nbsp;40&nbsp;byte&nbsp;sendto&nbsp;calls.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;AMQPCommand::transmit&nbsp;seems&nbsp;to&nbsp;be&nbsp;where&nbsp;the&nbsp;real&nbsp;action&nbsp;happens,&nbsp;and&nbsp;I&nbsp;see&nbsp;a&nbsp;connection.flush()&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;function:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http://hg.rabbitmq.com/rabbitmq-java-client/file/b643c5c8ec23/src/com/rabbitmq/client/impl/AMQCommand.java&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However&nbsp;I'm&nbsp;still&nbsp;a&nbsp;bit&nbsp;confused&nbsp;because&nbsp;I&nbsp;think&nbsp;a&nbsp;basicPublish&nbsp;should&nbsp;only&nbsp;result&nbsp;in&nbsp;one&nbsp;transmit()&nbsp;and&nbsp;thus&nbsp;one&nbsp;flush()&nbsp;and&nbsp;one&nbsp;sendto().&nbsp;This&nbsp;is&nbsp;where&nbsp;I'm&nbsp;stuck.&lt;/div&gt;
</tt>
