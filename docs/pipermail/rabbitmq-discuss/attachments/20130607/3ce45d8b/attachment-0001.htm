<tt>
Hey&nbsp;Tim,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sounds&nbsp;good.&nbsp;Thanks&nbsp;for&nbsp;the&nbsp;info.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;jonathan&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Jun&nbsp;7,&nbsp;2013&nbsp;at&nbsp;1:57&nbsp;AM,&nbsp;Tim&nbsp;Watson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:tim@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;tim@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi&nbsp;Jonathan,&lt;br&gt;<br>
&lt;br&gt;<br>
Ok,&nbsp;you&nbsp;can&nbsp;safely&nbsp;ignore&nbsp;what&nbsp;I&amp;#39;ve&nbsp;written&nbsp;below.&nbsp;What&amp;#39;s&nbsp;actually&nbsp;going&nbsp;on&nbsp;(thanks&nbsp;to&nbsp;Matthias&nbsp;for&nbsp;pointing&nbsp;it&nbsp;out)&nbsp;is&nbsp;that&nbsp;the&nbsp;ShutdownListener&nbsp;callbacks&nbsp;run&nbsp;in&nbsp;the&nbsp;connection&amp;#39;s&nbsp;thread,&nbsp;so&nbsp;the&nbsp;call&nbsp;to&nbsp;createChannel&nbsp;causes&nbsp;a&nbsp;deadlock&nbsp;since&nbsp;it&nbsp;blocks&nbsp;waiting&nbsp;for&nbsp;a&nbsp;response&nbsp;(whilst&nbsp;the&nbsp;connection&amp;#39;s&nbsp;thread&nbsp;is&nbsp;stuck&nbsp;executing&nbsp;the&nbsp;listener).&nbsp;I&amp;#39;m&nbsp;going&nbsp;to&nbsp;add&nbsp;some&nbsp;notes&nbsp;to&nbsp;the&nbsp;API&nbsp;documentation&nbsp;explaining&nbsp;that,&nbsp;so&nbsp;future&nbsp;users&nbsp;don&amp;#39;t&nbsp;get&nbsp;caught&nbsp;out&nbsp;in&nbsp;the&nbsp;same&nbsp;way.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
The&nbsp;canonical&nbsp;approach&nbsp;to&nbsp;dealing&nbsp;with&nbsp;this&nbsp;is&nbsp;to&nbsp;have&nbsp;the&nbsp;shutdown&nbsp;listener&nbsp;callback&nbsp;signal&nbsp;your&nbsp;own&nbsp;(application)&nbsp;thread,&nbsp;from&nbsp;which&nbsp;you&nbsp;can&nbsp;manage&nbsp;recovery&nbsp;without&nbsp;risking&nbsp;deadlock&nbsp;in&nbsp;this&nbsp;fashion.&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
Tim&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
On&nbsp;7&nbsp;Jun&nbsp;2013,&nbsp;at&nbsp;09:38,&nbsp;Tim&nbsp;Watson&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;Hi&nbsp;Jonathan,&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;On&nbsp;6&nbsp;Jun&nbsp;2013,&nbsp;at&nbsp;23:42,&nbsp;Jonathan&nbsp;Halterman&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&amp;gt;&nbsp;I&nbsp;hit&nbsp;on&nbsp;a&nbsp;scenario&nbsp;where&nbsp;connection.createChannel()&nbsp;may&nbsp;hang&nbsp;forever.&nbsp;The&nbsp;scenario:&nbsp;obtain&nbsp;a&nbsp;channel&nbsp;and&nbsp;attempt&nbsp;to&nbsp;publish&nbsp;to&nbsp;a&nbsp;non-existent&nbsp;exchange.&nbsp;The&nbsp;channel&nbsp;will&nbsp;be&nbsp;shutdown.&nbsp;Attempt&nbsp;to&nbsp;establish&nbsp;a&nbsp;new&nbsp;(replacement)&nbsp;channel&nbsp;via&nbsp;Connection.createChannel(),&nbsp;which&nbsp;hangs&nbsp;forever.&nbsp;A&nbsp;simple&nbsp;version&nbsp;of&nbsp;this&nbsp;scenario:&lt;br&gt;<br>
<br>
&amp;gt;&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;This&nbsp;should&nbsp;not&nbsp;be&nbsp;happening.&nbsp;Are&nbsp;you&nbsp;absolutely&nbsp;sure&nbsp;you&amp;#39;re&nbsp;using&nbsp;version&nbsp;3.1.1&nbsp;of&nbsp;the&nbsp;java&nbsp;client&nbsp;library,&nbsp;since&nbsp;a&nbsp;similar&nbsp;bug&nbsp;(involving&nbsp;accidentally&nbsp;re-used&nbsp;channel&nbsp;ids)&nbsp;was&nbsp;fixed&nbsp;in&nbsp;a&nbsp;previous&nbsp;release:&nbsp;&lt;a&nbsp;href=&quot;http://hg.rabbitmq.com/rabbitmq-java-client/rev/ea7d68c2154d&quot;&nbsp;target=&quot;_blank&quot;&gt;http://hg.rabbitmq.com/rabbitmq-java-client/rev/ea7d68c2154d&lt;/a&gt;&lt;br&gt;<br>
<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&amp;gt;&nbsp;From&nbsp;Tracer:&lt;br&gt;<br>
&amp;gt;&amp;gt;&lt;br&gt;<br>
&amp;gt;&amp;gt;&nbsp;1370554962786:&nbsp;&amp;lt;Tracer-0&amp;gt;&nbsp;ch#1&nbsp;&amp;lt;-&nbsp;{#method&amp;lt;channel.close&amp;gt;(reply-code=404,&nbsp;reply-text=NOT_FOUND&nbsp;-&nbsp;no&nbsp;exchange&nbsp;&amp;#39;foo&amp;#39;&nbsp;in&nbsp;vhost&nbsp;&amp;#39;/&amp;#39;,&nbsp;class-id=60,&nbsp;method-id=40),&nbsp;null,&nbsp;&amp;quot;&amp;quot;}&lt;br&gt;<br>
<br>
&amp;gt;&amp;gt;&nbsp;1370554962788:&nbsp;&amp;lt;Tracer-0&amp;gt;&nbsp;ch#1&nbsp;-&amp;gt;&nbsp;{#method&amp;lt;channel.close-ok&amp;gt;(),&nbsp;null,&nbsp;&amp;quot;&amp;quot;}&lt;br&gt;<br>
&amp;gt;&amp;gt;&nbsp;1370554974891:&nbsp;&amp;lt;Tracer-0&amp;gt;&nbsp;ch#1&nbsp;-&amp;gt;&nbsp;{#method&amp;lt;channel.open&amp;gt;(out-of-band=),&nbsp;null,&nbsp;&amp;quot;&amp;quot;}&lt;br&gt;<br>
&amp;gt;&amp;gt;&nbsp;1370554974970:&nbsp;&amp;lt;Tracer-0&amp;gt;&nbsp;ch#1&nbsp;&amp;lt;-&nbsp;{#method&amp;lt;channel.open-ok&amp;gt;(channel-id=),&nbsp;null,&nbsp;&amp;quot;&amp;quot;}&lt;br&gt;<br>
&amp;gt;&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;That&nbsp;last&nbsp;line&nbsp;seems&nbsp;very&nbsp;odd&nbsp;-&nbsp;I&nbsp;would&amp;#39;ve&nbsp;expected&nbsp;to&nbsp;a&nbsp;see&nbsp;a&nbsp;channel&nbsp;id&nbsp;in&nbsp;there,&nbsp;though&nbsp;truth&nbsp;be&nbsp;told&nbsp;I&amp;#39;m&nbsp;not&nbsp;overly&nbsp;familiar&nbsp;with&nbsp;the&nbsp;Tracer&nbsp;tool&nbsp;in&nbsp;the&nbsp;java&nbsp;client.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&amp;gt;&nbsp;Any&nbsp;ideas&nbsp;why&nbsp;things&nbsp;are&nbsp;hanging?&lt;br&gt;<br>
&amp;gt;&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;According&nbsp;to&nbsp;the&nbsp;last&nbsp;line&nbsp;of&nbsp;the&nbsp;trace&nbsp;you&amp;#39;ve&nbsp;supplied,&nbsp;a&nbsp;new&nbsp;channel&nbsp;was&nbsp;opened&nbsp;successfully,&nbsp;though&nbsp;there&amp;#39;s&nbsp;no&nbsp;channel&nbsp;id&nbsp;present&nbsp;which&nbsp;is&nbsp;worrying.&nbsp;Please&nbsp;confirm&nbsp;that&nbsp;you&nbsp;are&nbsp;definitely&nbsp;using&nbsp;the&nbsp;right&nbsp;version&nbsp;(i.e.,&nbsp;where&nbsp;did&nbsp;you&nbsp;obtain&nbsp;the&nbsp;amqp-client&nbsp;binary&nbsp;from)&nbsp;and&nbsp;we&amp;#39;ll&nbsp;take&nbsp;a&nbsp;closer&nbsp;look.&lt;br&gt;<br>
<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Cheers,&lt;br&gt;<br>
&amp;gt;&nbsp;Tim&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&amp;gt;&nbsp;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
