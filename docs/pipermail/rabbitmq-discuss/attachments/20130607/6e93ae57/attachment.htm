<tt>
Hi&nbsp;guys,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;following&nbsp;a&nbsp;discussion&nbsp;on&nbsp;the&nbsp;kafka&nbsp;user&nbsp;mailing&nbsp;list&nbsp;in&nbsp;which&nbsp;Alexis&nbsp;Richardson&nbsp;replied,&nbsp;I&nbsp;realized&nbsp;I&nbsp;might&nbsp;have&nbsp;been&nbsp;wrong&nbsp;about&nbsp;what&nbsp;I&nbsp;assumed&nbsp;for&nbsp;the&nbsp;messages&nbsp;storage&nbsp;in&nbsp;RabbitMQ.&nbsp;It&nbsp;won't&nbsp;change&nbsp;the&nbsp;decision&nbsp;I&nbsp;made&nbsp;to&nbsp;use&nbsp;Kafka&nbsp;but&nbsp;I'd&nbsp;like&nbsp;to&nbsp;set&nbsp;my&nbsp;own&nbsp;mind&nbsp;right&nbsp;in&nbsp;my&nbsp;conception&nbsp;of&nbsp;how&nbsp;RabbitMQ&nbsp;stores&nbsp;messages.&nbsp;I&nbsp;want&nbsp;to&nbsp;use&nbsp;Rabbit&nbsp;in&nbsp;other&nbsp;projects&nbsp;as&nbsp;well&nbsp;so&nbsp;I&nbsp;want&nbsp;to&nbsp;have&nbsp;the&nbsp;right&nbsp;picture&nbsp;in&nbsp;my&nbsp;mind.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;setup&nbsp;I&nbsp;used&nbsp;was&nbsp;based&nbsp;on&nbsp;what&nbsp;is&nbsp;described&nbsp;in&amp;nbsp;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/tutorials/tutorial-four-python.html&quot;&gt;http://www.rabbitmq.com/tutorials/tutorial-four-python.html&lt;/a&gt;.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;RabbitMQ&lt;/div&gt;&lt;div&gt;-&nbsp;RabbitMQ&nbsp;3.0.x&nbsp;(not&nbsp;exactly&nbsp;sure&nbsp;what&nbsp;x&nbsp;was)&lt;/div&gt;&lt;div&gt;-&nbsp;5&nbsp;brokers&nbsp;(behind&nbsp;HA&nbsp;proxy)&lt;/div&gt;&lt;div&gt;-&nbsp;Messages&nbsp;posted&nbsp;to&nbsp;multiple&nbsp;topics&nbsp;(called&nbsp;it&nbsp;A,&nbsp;B,&nbsp;C)&nbsp;where&nbsp;the&nbsp;topic&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;routing&nbsp;key&nbsp;by&nbsp;the&nbsp;exchange&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;Queues&nbsp;and&nbsp;messages&nbsp;are&nbsp;persistent&nbsp;(+&nbsp;replicated)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Consumers&lt;/div&gt;&lt;div&gt;-&nbsp;Consumer&nbsp;1&nbsp;subscribes&nbsp;to&nbsp;Topic&nbsp;A&nbsp;(near&nbsp;real-time)&nbsp;-&nbsp;Queue&nbsp;1&lt;/div&gt;&lt;div&gt;-&nbsp;Consumer&nbsp;2&nbsp;subscribes&nbsp;to&nbsp;Topic&nbsp;B&amp;nbsp;(near&nbsp;real-time)&amp;nbsp;&amp;nbsp;-&nbsp;Queue&nbsp;2&lt;/div&gt;&lt;div&gt;-&nbsp;Consumer&nbsp;3&nbsp;subscribes&nbsp;to&nbsp;A,&nbsp;B&nbsp;and&nbsp;C&nbsp;(offline,&nbsp;BI)&amp;nbsp;-&nbsp;Queue&nbsp;3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Published&nbsp;10M&nbsp;messages&nbsp;(size&nbsp;varying&nbsp;between&nbsp;500b&nbsp;to&nbsp;2k)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;From&nbsp;what&nbsp;I&nbsp;(believe&nbsp;I)&nbsp;saw&nbsp;and&nbsp;read,&nbsp;I&nbsp;really&nbsp;expected&nbsp;Rabbit&nbsp;to&nbsp;route&nbsp;messages&nbsp;and&nbsp;physically&nbsp;save&nbsp;them&nbsp;to&nbsp;disk&nbsp;for&nbsp;each&nbsp;of&nbsp;the&nbsp;consumers&nbsp;to&nbsp;read&nbsp;(1&nbsp;queue/consumer,&nbsp;1msg&nbsp;copy/queue).&nbsp;The&nbsp;reason&nbsp;I&nbsp;expected&nbsp;that&nbsp;is&nbsp;because&nbsp;if&nbsp;messages&nbsp;are&nbsp;ack'ed&nbsp;by&nbsp;consumers&nbsp;1&nbsp;and&nbsp;2,&nbsp;I&nbsp;expected&nbsp;their&nbsp;queue&nbsp;to&nbsp;be&nbsp;free&nbsp;of&nbsp;their&nbsp;messages&nbsp;while&nbsp;consumer&nbsp;3&nbsp;would&nbsp;still&nbsp;need&nbsp;them&nbsp;to&nbsp;be&nbsp;persisted&nbsp;until&nbsp;it&nbsp;has&nbsp;read&nbsp;them.&nbsp;That&nbsp;was&nbsp;possible&nbsp;a&nbsp;false&nbsp;assumption&nbsp;I&nbsp;should&nbsp;have&nbsp;verified&nbsp;with&nbsp;you&nbsp;guys.&nbsp;It&nbsp;would&nbsp;indeed&nbsp;be&nbsp;more&nbsp;optimal&nbsp;to&nbsp;store&nbsp;a&nbsp;single&nbsp;copy&nbsp;of&nbsp;the&nbsp;messages&nbsp;and&nbsp;only&nbsp;keep&nbsp;the&nbsp;metadata.&nbsp;&lt;b&gt;Is&nbsp;this&nbsp;correct?&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;during&nbsp;a&nbsp;test&nbsp;where&nbsp;I&nbsp;continuously&nbsp;sent&nbsp;(a&nbsp;lot)&nbsp;of&nbsp;messages&nbsp;while&nbsp;my&nbsp;big&nbsp;consumer&nbsp;3&nbsp;was&nbsp;offline.&nbsp;The&nbsp;observation&nbsp;I&nbsp;made&nbsp;then&nbsp;is&nbsp;that&nbsp;&lt;u&gt;obviously:&lt;/u&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;data&nbsp;was&nbsp;accumulating&nbsp;on&nbsp;disk&lt;/div&gt;&lt;div&gt;-&nbsp;memory&nbsp;usage&nbsp;on&nbsp;all&nbsp;nodes&nbsp;went&nbsp;up.&nbsp;to&nbsp;the&nbsp;point&nbsp;where&nbsp;it&nbsp;eventually&nbsp;choked&nbsp;the&nbsp;brokers&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;assumed&nbsp;then&nbsp;that&nbsp;the&nbsp;increasing&nbsp;memory&nbsp;usage&nbsp;was&nbsp;because&nbsp;the&nbsp;queue&nbsp;and&nbsp;msg&nbsp;metadata&nbsp;was&nbsp;increasing&nbsp;in&nbsp;Mnesia.&nbsp;This&nbsp;was&nbsp;a&nbsp;decisive&nbsp;factor&nbsp;to&nbsp;me&nbsp;because&nbsp;I&nbsp;didn't&nbsp;want&nbsp;to&nbsp;be&nbsp;in&nbsp;a&nbsp;situation&nbsp;where&nbsp;my&nbsp;realtime&nbsp;consumers&nbsp;would&nbsp;be&nbsp;affected&nbsp;by&nbsp;a&nbsp;slow&nbsp;moving&nbsp;elephant.&nbsp;Is&nbsp;there&nbsp;way&nbsp;I&nbsp;could&nbsp;have&nbsp;avoided&nbsp;that&nbsp;situation&nbsp;I&nbsp;didn't&nbsp;see?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;
</tt>
