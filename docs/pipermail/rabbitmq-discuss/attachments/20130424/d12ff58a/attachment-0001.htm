<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;word-wrap:break-word;color:rgb(0,0,0);font-family:Arial,&amp;#39;Liberation&nbsp;Sans&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&amp;#39;,sans-serif;line-height:18px&quot;&gt;<br>
Recently&nbsp;I&nbsp;begin&nbsp;to&nbsp;use&nbsp;rabbitMQ,&nbsp;but&nbsp;encounter&nbsp;a&nbsp;strange&nbsp;problem.&nbsp;I&nbsp;use&nbsp;the&nbsp;method&nbsp;newConnection(Address[]&nbsp;addrs)&nbsp;of&nbsp;class&nbsp;ConnectionFactory&nbsp;when&nbsp;I&nbsp;initial&nbsp;the&nbsp;connection,&nbsp;because&nbsp;the&nbsp;document&nbsp;said&nbsp;that&nbsp;this&nbsp;method&nbsp;will&nbsp;pick&nbsp;up&nbsp;one&nbsp;available&nbsp;address&nbsp;automatically.&nbsp;The&nbsp;code&nbsp;looks&nbsp;like&nbsp;below&nbsp;in&nbsp;function&nbsp;setup():&lt;/p&gt;<br>
&lt;pre&nbsp;style=&quot;margin-top:0px;margin-bottom:10px;padding:5px;border:0px;font-size:14px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&amp;#39;Lucida&nbsp;Console&amp;#39;,&amp;#39;Liberation&nbsp;Mono&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&nbsp;Mono&amp;#39;,&amp;#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&amp;#39;,&amp;#39;Courier&nbsp;New&amp;#39;,monospace,serif;overflow:auto;width:auto;max-height:600px;color:rgb(0,0,0);line-height:18px&quot;&gt;<br>
&lt;code&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;font-family:Consolas,Menlo,Monaco,&amp;#39;Lucida&nbsp;Console&amp;#39;,&amp;#39;Liberation&nbsp;Mono&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&nbsp;Mono&amp;#39;,&amp;#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&amp;#39;,&amp;#39;Courier&nbsp;New&amp;#39;,monospace,serif&quot;&gt;String[]&nbsp;mqAddrArr&nbsp;=&nbsp;new&nbsp;String[]&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;quot;node1:5672&amp;quot;,&nbsp;&amp;quot;node2:5672&amp;quot;<br>
};<br>
connection&nbsp;=&nbsp;connectionFactory.newConnection(mqAddrArr);<br>
&lt;/code&gt;&lt;/pre&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;word-wrap:break-word;color:rgb(0,0,0);font-family:Arial,&amp;#39;Liberation&nbsp;Sans&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&amp;#39;,sans-serif;line-height:18px&quot;&gt;<br>
In&nbsp;my&nbsp;code,&nbsp;if&nbsp;encounter&nbsp;a&nbsp;ShutdownSignalException,&nbsp;I&nbsp;will&nbsp;catch&nbsp;it&nbsp;and&nbsp;re-connect(using&nbsp;the&nbsp;same&nbsp;setup()&nbsp;method).&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;word-wrap:break-word;color:rgb(0,0,0);font-family:Arial,&amp;#39;Liberation&nbsp;Sans&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&amp;#39;,sans-serif;line-height:18px&quot;&gt;<br>
When&nbsp;I&nbsp;start&nbsp;the&nbsp;application,&nbsp;this&nbsp;newConnection(mqAddrArr)&nbsp;run&nbsp;normally.&nbsp;As&nbsp;I&nbsp;run&nbsp;&amp;quot;rabbitmqctl&nbsp;stop&amp;quot;&nbsp;on&nbsp;node1,&nbsp;the&nbsp;program&nbsp;can&nbsp;catch&nbsp;the&nbsp;ShutdownSignalException&nbsp;rightly&nbsp;and&nbsp;run&nbsp;setup()&nbsp;to&nbsp;re-connect.&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;word-wrap:break-word;color:rgb(0,0,0);font-family:Arial,&amp;#39;Liberation&nbsp;Sans&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&amp;#39;,sans-serif;line-height:18px&quot;&gt;<br>
But&nbsp;this&nbsp;time,&nbsp;the&nbsp;newConnection(mqAddrArr)&nbsp;is&nbsp;very&nbsp;slow,&nbsp;maybe&nbsp;about&nbsp;2-3&nbsp;minutes&nbsp;to&nbsp;re-connect&nbsp;succeed.&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;word-wrap:break-word;color:rgb(0,0,0);font-family:Arial,&amp;#39;Liberation&nbsp;Sans&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&amp;#39;,sans-serif;line-height:18px&quot;&gt;<br>
I&amp;#39;m&nbsp;wondering&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;right&nbsp;performance&nbsp;of&nbsp;method&nbsp;newConnection(Address[]&nbsp;addrs),&nbsp;or&nbsp;maybe&nbsp;there&nbsp;is&nbsp;some&nbsp;parameter&nbsp;I&nbsp;can&nbsp;set&nbsp;to&nbsp;control&nbsp;the&nbsp;re-connect&nbsp;time?&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;word-wrap:break-word;color:rgb(0,0,0);font-family:Arial,&amp;#39;Liberation&nbsp;Sans&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&amp;#39;,sans-serif;line-height:18px&quot;&gt;<br>
When&nbsp;the&nbsp;newConnection&nbsp;method&nbsp;halt,&nbsp;I&nbsp;get&nbsp;some&nbsp;jstack&nbsp;information&nbsp;in&nbsp;the&nbsp;last,&nbsp;maybe&nbsp;helpful.&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;word-wrap:break-word;color:rgb(0,0,0);font-family:Arial,&amp;#39;Liberation&nbsp;Sans&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&amp;#39;,sans-serif;line-height:18px&quot;&gt;<br>
Thanks.&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;word-wrap:break-word;color:rgb(0,0,0);font-family:Arial,&amp;#39;Liberation&nbsp;Sans&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&amp;#39;,sans-serif;line-height:18px&quot;&gt;<br>
&lt;/p&gt;&lt;pre&nbsp;style=&quot;margin-top:0px;margin-bottom:10px;padding:5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&amp;#39;Lucida&nbsp;Console&amp;#39;,&amp;#39;Liberation&nbsp;Mono&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&nbsp;Mono&amp;#39;,&amp;#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&amp;#39;,&amp;#39;Courier&nbsp;New&amp;#39;,monospace,serif;overflow:auto;width:auto;max-height:600px&quot;&gt;<br>
&lt;code&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;font-family:Consolas,Menlo,Monaco,&amp;#39;Lucida&nbsp;Console&amp;#39;,&amp;#39;Liberation&nbsp;Mono&amp;#39;,&amp;#39;DejaVu&nbsp;Sans&nbsp;Mono&amp;#39;,&amp;#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&amp;#39;,&amp;#39;Courier&nbsp;New&amp;#39;,monospace,serif&quot;&gt;&amp;quot;Finalizer&amp;quot;&nbsp;daemon&nbsp;prio=10&nbsp;tid=0x09f44400&nbsp;nid=0x3e70&nbsp;in&nbsp;Object.wait()&nbsp;[0x7c51c000]<br>
&nbsp;&nbsp;&nbsp;java.lang.Thread.State:&nbsp;WAITING&nbsp;(on&nbsp;object&nbsp;monitor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.lang.Object.wait(Native&nbsp;Method)<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;waiting&nbsp;on&nbsp;&amp;lt;0xa522f340&amp;gt;&nbsp;(a&nbsp;java.lang.ref.ReferenceQueue$Lock)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:133)<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;locked&nbsp;&amp;lt;0xa522f340&amp;gt;&nbsp;(a&nbsp;java.lang.ref.ReferenceQueue$Lock)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:149)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:177)<br>
<br>
&amp;quot;Reference&nbsp;Handler&amp;quot;&nbsp;daemon&nbsp;prio=10&nbsp;tid=0x09f3f800&nbsp;nid=0x3e6f&nbsp;in&nbsp;Object.wait()&nbsp;[0x7c56d000]<br>
&nbsp;&nbsp;&nbsp;java.lang.Thread.State:&nbsp;WAITING&nbsp;(on&nbsp;object&nbsp;monitor)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.lang.Object.wait(Native&nbsp;Method)<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;waiting&nbsp;on&nbsp;&amp;lt;0xa522ef10&amp;gt;&nbsp;(a&nbsp;java.lang.ref.Reference$Lock)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.lang.Object.wait(Object.java:502)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;locked&nbsp;&amp;lt;0xa522ef10&amp;gt;&nbsp;(a&nbsp;java.lang.ref.Reference$Lock)<br>
<br>
&amp;quot;main&amp;quot;&nbsp;prio=10&nbsp;tid=0x09e94000&nbsp;nid=0x3e68&nbsp;runnable&nbsp;[0xb776a000]<br>
&nbsp;&nbsp;&nbsp;java.lang.Thread.State:&nbsp;RUNNABLE<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.net.PlainSocketImpl.socketConnect(Native&nbsp;Method)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:327)<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;locked&nbsp;&amp;lt;0xa470f390&amp;gt;&nbsp;(a&nbsp;java.net.SocksSocketImpl)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:193)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:180)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.net.SocksSocketImpl.connect(SocksSocketImpl.java:384)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.net.Socket.connect(Socket.java:546)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:445)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:504)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:488)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.wandoujia.storage.rabbitmq.RabbitMQReceiver.setup(RabbitMQReceiver.java:114)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.wandoujia.storage.rabbitmq.RabbitMQReceiver.reconnect(RabbitMQReceiver.java:105)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.wandoujia.storage.rabbitmq.RabbitMQReceiver.ack(RabbitMQReceiver.java:141)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.wandoujia.storage.rabbitmq.testMQReceiver.test(testMQReceiver.java:21)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;sun.reflect.NativeMethodAccessorImpl.invoke0(Native&nbsp;Method)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.lang.reflect.Method.invoke(Method.java:616)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.BlockJUnit4ClassRunner.runNotIgnored(BlockJUnit4ClassRunner.java:79)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:71)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:49)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.junit.runners.ParentRunner.run(ParentRunner.java:236)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)<br>
&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;<br>

</tt>
