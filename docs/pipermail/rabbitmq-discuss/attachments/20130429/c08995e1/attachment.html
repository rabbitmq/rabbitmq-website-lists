<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;The&nbsp;code&nbsp;for &lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;register_shutdown_function&nbsp;is&nbsp;used&nbsp;to&nbsp;call&nbsp;a&nbsp;function&nbsp;when&nbsp;PHP&nbsp;is&nbsp;shutting&nbsp;down.&nbsp;For&nbsp;example&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;do&nbsp;some&nbsp;resources&nbsp;clean&nbsp;up&nbsp;(like&nbsp;closing&nbsp;database&nbsp;connections&nbsp;and&nbsp;so&nbsp;on),&nbsp;you&nbsp;could&nbsp;do&nbsp;it&nbsp;there.&nbsp;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;If&nbsp;inside&nbsp;that&nbsp;shutdown&nbsp;function&nbsp;you&nbsp;need&nbsp;to&nbsp;call&nbsp;methods&nbsp;in&nbsp;the&nbsp;controller,&nbsp;that&nbsp;is,&nbsp;your&nbsp;$this&nbsp;object,&nbsp;then&nbsp;you&nbsp;need&nbsp;to&nbsp;pass&nbsp;it&nbsp;as&nbsp;an&nbsp;extra&nbsp;argument,&nbsp;as&nbsp;explained&nbsp;here:&nbsp;&lt;a&nbsp;href=&quot;http://php.net/manual/en/function.register-shutdown-function.php&quot;&gt;http://php.net/manual/en/function.register-shutdown-function.php&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;On&nbsp;the&nbsp;other&nbsp;hand&nbsp;if&nbsp;you&nbsp;need&nbsp;to&nbsp;pass&nbsp;more&nbsp;arguments&nbsp;to&nbsp;the&nbsp;RabbitMQ&nbsp;callback,&nbsp;the&nbsp;one&nbsp;that&nbsp;you&nbsp;use&nbsp;in&nbsp;your&nbsp;basic_consume&nbsp;function,&nbsp;the&nbsp;you&nbsp;need&nbsp;to&nbsp;pass&nbsp;them&nbsp;to&nbsp;the&nbsp;callback&nbsp;function&nbsp;there,&nbsp;for&nbsp;example&nbsp;by&nbsp;using&nbsp;the&nbsp;&amp;#39;use&amp;#39;&nbsp;keyword&nbsp;as&nbsp;explained&nbsp;here: &lt;a&nbsp;href=&quot;http://php.net/manual/en/functions.anonymous.php&quot;&gt;http://php.net/manual/en/functions.anonymous.php&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Besides&nbsp;that&nbsp;I recommend you&nbsp;to&nbsp;refactor&nbsp;that&nbsp;consumer&nbsp;code&nbsp;out&nbsp;of&nbsp;the&nbsp;controller&nbsp;into&nbsp;a&nbsp;consumer&nbsp;class&nbsp;or&nbsp;something&nbsp;similar.&nbsp;Keep&nbsp;in&nbsp;mind&nbsp;to&nbsp;always&nbsp;keep&nbsp;thin&nbsp;controllers.&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;Also&nbsp;if&nbsp;your&nbsp;consumer&nbsp;callbacks&nbsp;need&nbsp;to&nbsp;use&nbsp;a&nbsp;lot&nbsp;of&nbsp;extra&nbsp;arguments,&nbsp;maybe&nbsp;is&nbsp;better&nbsp;to&nbsp;create&nbsp;a&nbsp;class&nbsp;for&nbsp;them, instantiate an&nbsp;object&nbsp;and&nbsp;pass&nbsp;the&nbsp;data&nbsp;inside&nbsp;via&nbsp;the&nbsp;constructor&nbsp;for&nbsp;example.&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Regarding&nbsp;MySQL&nbsp;going&nbsp;away,&nbsp;you&nbsp;probably&nbsp;need&nbsp;to&nbsp;search&nbsp;in&nbsp;a&nbsp;php-mysql&nbsp;forum&nbsp;to&nbsp;see&nbsp;how&nbsp;to&nbsp;solve&nbsp;that&nbsp;MySQL timeout.&nbsp;You&nbsp;could&nbsp;either&nbsp;increase&nbsp;the&nbsp;timeout&nbsp;value&nbsp;in&nbsp;the&nbsp;server&nbsp;conf,&nbsp;issue&nbsp;a&nbsp;simple&nbsp;query&nbsp;every&nbsp;now&nbsp;and&nbsp;then&nbsp;to&nbsp;keep&nbsp;the&nbsp;connection&nbsp;alive&nbsp;or&nbsp;implement&nbsp;a reconnection strategy,&nbsp;for&nbsp;example&nbsp;by&nbsp;catching&nbsp;an&nbsp;exception.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Regards,&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Alvaro&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Apr&nbsp;25,&nbsp;2013&nbsp;at&nbsp;8:30&nbsp;AM,&nbsp;Seshachalam&nbsp;Malisetti&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:abbiya@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;abbiya@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;p&gt;I&nbsp;developed&nbsp;an&nbsp;android&nbsp;app&nbsp;where&nbsp;it&nbsp;subscribes&nbsp;to&nbsp;a&nbsp;queue&nbsp;and&nbsp;also&nbsp;<br>
publishes&nbsp;to&nbsp;other&nbsp;queues.&nbsp;At&nbsp;a&nbsp;time&nbsp;it&nbsp;publishes&nbsp;the&nbsp;same&nbsp;message&nbsp;to&nbsp;<br>
two&nbsp;different&nbsp;queues,&nbsp;one&nbsp;of&nbsp;them&nbsp;is&nbsp;a&nbsp;queue&nbsp;named&nbsp;&amp;quot;Queue&amp;quot;&nbsp;and&nbsp;now&nbsp;from&nbsp;a<br>
&nbsp;appfog&nbsp;instance&nbsp;i&nbsp;need&nbsp;to&nbsp;subscribe&nbsp;to&nbsp;the&nbsp;&amp;quot;Queue&amp;quot;&nbsp;and&nbsp;consume&nbsp;messages<br>
&nbsp;and&nbsp;insert&nbsp;them&nbsp;in&nbsp;a&nbsp;mysql&nbsp;db.&lt;/p&gt;<br>
<br>
&lt;p&gt;I&nbsp;created&nbsp;a&nbsp;php&nbsp;standalone&nbsp;app&nbsp;for&nbsp;the&nbsp;above&nbsp;purpose&nbsp;with&nbsp;<br>
codeigniter.&nbsp;By&nbsp;some&nbsp;reason&nbsp;the&nbsp;worker&nbsp;app&nbsp;loses&nbsp;its&nbsp;connection&nbsp;to&nbsp;<br>
rabbitmq.&nbsp;i&nbsp;would&nbsp;like&nbsp;to&nbsp;know&nbsp;the&nbsp;best&nbsp;way&nbsp;to&nbsp;do&nbsp;this.&nbsp;How&nbsp;can&nbsp;a&nbsp;worker<br>
&nbsp;app&nbsp;on&nbsp;appfog&nbsp;can&nbsp;sustain&nbsp;the&nbsp;application&nbsp;restarts.&lt;/p&gt;<br>
<br>
&lt;p&gt;what&nbsp;of&nbsp;kind&nbsp;of&nbsp;thing&nbsp;i&nbsp;need&nbsp;to&nbsp;use&nbsp;to&nbsp;solve&nbsp;the&nbsp;above&nbsp;problem.&lt;/p&gt;<br>
<br>
&lt;p&gt;I&nbsp;figured&nbsp;that&nbsp;the&nbsp;problem&nbsp;is&nbsp;not&nbsp;with&nbsp;rabbitmq&nbsp;connection.&nbsp;it&nbsp;is&nbsp;<br>
with&nbsp;the&nbsp;code&nbsp;related&nbsp;to&nbsp;mysql&nbsp;inserts.&nbsp;i&nbsp;checked&nbsp;the&nbsp;crash&nbsp;logs&nbsp;of&nbsp;my&nbsp;<br>
app&nbsp;and&nbsp;the&nbsp;error&nbsp;is&nbsp;&amp;quot;Mysql&nbsp;gone&nbsp;away&amp;quot;.&nbsp;an&nbsp;example&nbsp;of&nbsp;php&nbsp;rabbitmq&nbsp;<br>
consumer&nbsp;has&nbsp;call&nbsp;backs&nbsp;for&nbsp;receive&nbsp;message&nbsp;and&nbsp;register_shutdown.&nbsp;in&nbsp;<br>
receive&nbsp;call&nbsp;back&nbsp;i&nbsp;can&nbsp;not&nbsp;use&nbsp;$this&nbsp;of&nbsp;code&nbsp;igniter&nbsp;because&nbsp;its&nbsp;out&nbsp;of<br>
&nbsp;scope&nbsp;and&nbsp;i&nbsp;was&nbsp;using&nbsp;get_instance().&nbsp;i&nbsp;am&nbsp;not&nbsp;sure&nbsp;how&nbsp;to&nbsp;call&nbsp;a&nbsp;<br>
method&nbsp;from&nbsp;rabbitmq&nbsp;client&nbsp;receive&nbsp;call&nbsp;back&nbsp;function&lt;/p&gt;<br>
<br>
&lt;p&gt;The&nbsp;controller&nbsp;is&nbsp;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;&amp;lt;?&lt;/span&gt;&lt;span&gt;php<br>
<br>
&lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;(!&lt;/span&gt;&lt;span&gt;defined&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;&amp;#39;BASEPATH&amp;#39;&lt;/span&gt;&lt;span&gt;))&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;exit&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;&amp;#39;No&nbsp;direct&nbsp;script&nbsp;access&nbsp;allowed&amp;#39;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
<br>
include&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;__DIR__&nbsp;&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;&amp;#39;/php-amqplib/config.php&amp;#39;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
<br>
&lt;/span&gt;&lt;span&gt;use&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;PhpAmqpLib&lt;/span&gt;&lt;span&gt;\Connection\A&lt;/span&gt;&lt;span&gt;MQPConnection&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;<br>
<br>
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;Welcome&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;extends&lt;/span&gt;&lt;span&gt;&nbsp;CI_Controller&nbsp;&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;<br>
<br>
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;&nbsp;__construct&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;parent&lt;/span&gt;&lt;span&gt;::&lt;/span&gt;&lt;span&gt;__construct&lt;/span&gt;&lt;span&gt;();&lt;/span&gt;&lt;span&gt;<br>
&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;span&gt;<br>
<br>
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;&nbsp;index&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;//connect&nbsp;to&nbsp;rabbitmq&nbsp;and&nbsp;consume&nbsp;messages&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;//insert&nbsp;messages&nbsp;to&nbsp;mysql&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;//$this-&amp;gt;messages&nbsp;=&nbsp;array();&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;$exchange&nbsp;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;&amp;quot;router&amp;quot;&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;$queue&nbsp;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;&amp;quot;abbiya&amp;quot;&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;$conn&nbsp;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;new&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;AMQPConnection&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;HOST&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;PORT&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;USER&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;PASS&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;VHOST&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;$ch&nbsp;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt;&nbsp;$conn&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;channel&lt;/span&gt;&lt;span&gt;();&lt;/span&gt;&lt;span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;/*<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;$queue<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;passive:&nbsp;false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;durable:&nbsp;true&nbsp;//&nbsp;the&nbsp;queue&nbsp;will&nbsp;survive&nbsp;server&nbsp;restarts<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exclusive:&nbsp;false&nbsp;//&nbsp;the&nbsp;queue&nbsp;can&nbsp;be&nbsp;accessed&nbsp;in&nbsp;other&nbsp;channels<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto_delete:&nbsp;false&nbsp;//the&nbsp;queue&nbsp;won&amp;#39;t&nbsp;be&nbsp;deleted&nbsp;once&nbsp;the&nbsp;channel&nbsp;is&nbsp;closed.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;$ch&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;queue_declare&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$queue&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;$ch&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;queue_bind&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$queue&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;$exchange&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;$queue&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;/*<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queue:&nbsp;Queue&nbsp;from&nbsp;where&nbsp;to&nbsp;get&nbsp;the&nbsp;messages<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consumer_tag:&nbsp;Consumer&nbsp;identifier<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_local:&nbsp;Don&amp;#39;t&nbsp;receive&nbsp;messages&nbsp;published&nbsp;by&nbsp;this&nbsp;consumer.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_ack:&nbsp;Tells&nbsp;the&nbsp;server&nbsp;if&nbsp;the&nbsp;consumer&nbsp;will&nbsp;acknowledge&nbsp;the&nbsp;messages.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exclusive:&nbsp;Request&nbsp;exclusive&nbsp;consumer&nbsp;access,&nbsp;meaning&nbsp;only&nbsp;this&nbsp;consumer&nbsp;can&nbsp;access&nbsp;the&nbsp;queue<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nowait:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callback:&nbsp;A&nbsp;PHP&nbsp;Callback<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;$consumer_tag&nbsp;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;&amp;quot;abbiya&amp;quot;&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;$ch&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;basic_recover&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;$ch&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;basic_consume&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$queue&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;$consumer_tag&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$msg&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$message_body&nbsp;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt;&nbsp;json_decode&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$msg&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;body&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$msg&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;delivery_info&lt;/span&gt;&lt;span&gt;[&lt;/span&gt;&lt;span&gt;&amp;#39;channel&amp;#39;&lt;/span&gt;&lt;span&gt;]-&amp;gt;&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_ack&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$msg&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;delivery_info&lt;/span&gt;&lt;span&gt;[&lt;/span&gt;&lt;span&gt;&amp;#39;delivery_tag&amp;#39;&lt;/span&gt;&lt;span&gt;]);&lt;/span&gt;&lt;span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;//&nbsp;Send&nbsp;a&nbsp;message&nbsp;with&nbsp;the&nbsp;string&nbsp;&amp;quot;quit&amp;quot;&nbsp;to&nbsp;cancel&nbsp;the&nbsp;consumer.&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$msg&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;body&nbsp;&lt;/span&gt;&lt;span&gt;===&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;&amp;#39;quit&amp;#39;&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$msg&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;delivery_info&lt;/span&gt;&lt;span&gt;[&lt;/span&gt;&lt;span&gt;&amp;#39;channel&amp;#39;&lt;/span&gt;&lt;span&gt;]-&amp;gt;&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;basic_cancel&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$msg&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;delivery_info&lt;/span&gt;&lt;span&gt;[&lt;/span&gt;&lt;span&gt;&amp;#39;consumer_tag&amp;#39;&lt;/span&gt;&lt;span&gt;]);&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt;&nbsp;array&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;&amp;#39;sender_id&amp;#39;&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;=&amp;gt;&lt;/span&gt;&lt;span&gt;&nbsp;$message_body&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;r&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;&amp;#39;receiver_id&amp;#39;&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;=&amp;gt;&lt;/span&gt;&lt;span&gt;&nbsp;$message_body&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;s&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;&amp;#39;message_content&amp;#39;&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;=&amp;gt;&lt;/span&gt;&lt;span&gt;&nbsp;$message_body&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;m&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;//&nbsp;&amp;#39;sent_time&amp;#39;&nbsp;=&amp;gt;&nbsp;$message_body-&amp;gt;t,&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;&amp;#39;status&amp;#39;&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;=&amp;gt;&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ci&nbsp;&lt;/span&gt;&lt;span&gt;=&amp;amp;&lt;/span&gt;&lt;span&gt;&nbsp;get_instance&lt;/span&gt;&lt;span&gt;();&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ci&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;Message_model&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;newMessage&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$data&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;//&nbsp;Loop&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;channel&nbsp;has&nbsp;callbacks&nbsp;registered&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;while&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;count&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$ch&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;callbacks&lt;/span&gt;&lt;span&gt;))&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ch&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;wait&lt;/span&gt;&lt;span&gt;();&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;register_shutdown_function&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;use&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;$ch&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&lt;span&gt;&nbsp;$conn&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;&nbsp;&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ch&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;close&lt;/span&gt;&lt;span&gt;();&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conn&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;close&lt;/span&gt;&lt;span&gt;();&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this&lt;/span&gt;&lt;span&gt;-&amp;gt;&lt;/span&gt;&lt;span&gt;index&lt;/span&gt;&lt;span&gt;();&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;&lt;span&gt;<br>
&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;span&gt;<br>
<br>
&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;span&gt;<br>
<br>
&lt;/span&gt;&lt;span&gt;/*&nbsp;End&nbsp;of&nbsp;file&nbsp;welcome.php&nbsp;*/&lt;/span&gt;&lt;span&gt;<br>
&lt;/span&gt;&lt;span&gt;/*&nbsp;Location:&nbsp;./application/controllers/welcome.php&nbsp;*/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
