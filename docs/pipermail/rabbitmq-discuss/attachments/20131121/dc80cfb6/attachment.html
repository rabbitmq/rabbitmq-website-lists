<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;&lt;meta&nbsp;name=&quot;Generator&quot;&nbsp;content=&quot;Microsoft&nbsp;Word&nbsp;14&nbsp;(filtered&nbsp;medium)&quot;&gt;&lt;style&gt;&lt;!--<br>
/*&nbsp;Font&nbsp;Definitions&nbsp;*/<br>
@font-face<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{font-family:Calibri;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppanose-1:2&nbsp;15&nbsp;5&nbsp;2&nbsp;2&nbsp;2&nbsp;4&nbsp;3&nbsp;2&nbsp;4;}<br>
/*&nbsp;Style&nbsp;Definitions&nbsp;*/<br>
p.MsoNormal,&nbsp;li.MsoNormal,&nbsp;div.MsoNormal<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{margin:0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-bottom:.0001pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-size:11.0pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;}<br>
a:link,&nbsp;span.MsoHyperlink<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-priority:99;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcolor:blue;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptext-decoration:underline;}<br>
a:visited,&nbsp;span.MsoHyperlinkFollowed<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-priority:99;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcolor:purple;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptext-decoration:underline;}<br>
span.EmailStyle17<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-type:personal-compose;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Courier&nbsp;New&quot;;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcolor:windowtext;}<br>
.MsoChpDefault<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-type:export-only;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;}<br>
@page&nbsp;WordSection1<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{size:8.5in&nbsp;11.0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin:1.0in&nbsp;1.0in&nbsp;1.0in&nbsp;1.0in;}<br>
div.WordSection1<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{page:WordSection1;}<br>
--&gt;&lt;/style&gt;&lt;/head&gt;&lt;body&nbsp;lang=&quot;EN-US&quot;&nbsp;link=&quot;blue&quot;&nbsp;vlink=&quot;purple&quot;&gt;&lt;div&nbsp;class=&quot;WordSection1&quot;&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;Hi,&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;I&nbsp;have&nbsp;a&nbsp;receiver&nbsp;that&nbsp;is&nbsp;waiting&nbsp;on&nbsp;an&nbsp;topic&nbsp;exchange&nbsp;and&nbsp;I&nbsp;can&nbsp;publish&nbsp;MQTT&nbsp;messages&nbsp;with&nbsp;Mosquitto&nbsp;with&nbsp;QOS=0&nbsp;just&nbsp;fine&nbsp;from&nbsp;multiple&nbsp;clients,&nbsp;1000s&nbsp;of&nbsp;messages.&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;When&nbsp;I&nbsp;publish&nbsp;with&nbsp;QOS=1&nbsp;however,&nbsp;the&nbsp;client&nbsp;appears&nbsp;successful&nbsp;in&nbsp;publishing,&nbsp;but&nbsp;the&nbsp;receiver&nbsp;always&nbsp;stops&nbsp;at&nbsp;20&nbsp;messages. &nbsp;I&nbsp;can&nbsp;kick&nbsp;off&nbsp;another&nbsp;client&nbsp;without&nbsp;stopping&nbsp;the&nbsp;receiver&nbsp;and&nbsp;it&nbsp;will&nbsp;also&nbsp;do&nbsp;the&nbsp;same&nbsp;thing,&nbsp;the&nbsp;receiver&nbsp;will&nbsp;show&nbsp;20&nbsp;messages&nbsp;and&nbsp;nothing&nbsp;more.&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;Ideas?&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;Adrian&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;Receive_json.py&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;------------------&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;#!/usr/bin/env&nbsp;python&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;import&nbsp;pika,&nbsp;traceback&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;import&nbsp;json&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;prev_id&nbsp;=&nbsp;0&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;def&nbsp;callback(ch,&nbsp;method,&nbsp;properties,&nbsp;body):&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;global&nbsp;prev_id&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;ch.basic_ack(delivery_tag=method.delivery_tag)&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;msgBody&nbsp;=&nbsp;json.loads(body)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;print&nbsp;&amp;quot;&nbsp;[x]&nbsp;%r:%r&amp;quot;&nbsp;%&nbsp;(method.routing_key,msgBody,)&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;if&nbsp;prev_id&nbsp;+&nbsp;1&nbsp;!=&nbsp;int(msgBody[&amp;#39;id&amp;#39;]):&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;print&nbsp;&amp;quot;Missing&nbsp;%d&amp;quot;&nbsp;%&nbsp;(prev_id&nbsp;+&nbsp;1)&nbsp;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;    prev_id&nbsp;=&nbsp;msgBody[&amp;#39;id&amp;#39;]&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;return&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;while&nbsp;True:&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;try:&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;connection&nbsp;=&nbsp;pika.BlockingConnection(pika.ConnectionParameters(&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;               &nbsp;host=&amp;#39;localhost&amp;#39;))&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;channel&nbsp;=&nbsp;connection.channel()&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;channel.exchange_declare(exchange=&amp;#39;mqtt.topic&amp;#39;,&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;                                &nbsp;type=&amp;#39;topic&amp;#39;)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;result&nbsp;=&nbsp;channel.queue_declare(&amp;quot;mqtt-json-queue&amp;quot;)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;queue_name&nbsp;=&nbsp;result.method.queue&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;#&nbsp;topic&nbsp;here&nbsp;is&nbsp;what&nbsp;the&nbsp;mqtt&nbsp;plugin&nbsp;posts&nbsp;to&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;channel.queue_bind(exchange=&amp;#39;mqtt.topic&amp;#39;,&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;                          &nbsp;queue=queue_name,&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;                          &nbsp;routing_key=&amp;quot;json_routing_key&amp;quot;)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;print&nbsp;&amp;#39;&nbsp;[*]&nbsp;Waiting&nbsp;for&nbsp;logs.&nbsp;To&nbsp;exit&nbsp;press&nbsp;CTRL+C&amp;#39;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;channel.basic_consume(callback,&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;                             &nbsp;queue=queue_name&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;                             &nbsp;)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;           &nbsp;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;        channel.start_consuming()&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;    except&nbsp;Exception,&nbsp;e:&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;traceback.print_exc()&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;Client&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;------&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;import&nbsp;mosquitto&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;import&nbsp;sys&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;import&nbsp;time&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;import&nbsp;random&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;import&nbsp;json&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;def&nbsp;on_connect(self,&nbsp;mosq,&nbsp;obj,&nbsp;rc):&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;if&nbsp;rc&nbsp;==&nbsp;0:&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;print(&amp;quot;Connected&nbsp;successfully.&amp;quot;)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;if&nbsp;len(sys.argv)&nbsp;!=&nbsp;4:&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;print&nbsp;&amp;quot;Usage:&nbsp;cnt&nbsp;sleep_s&nbsp;qos&amp;quot;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;exit(-1)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;cnt&nbsp;=&nbsp;int(sys.argv[1])&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;sleep_s&nbsp;=&nbsp;float(sys.argv[2])&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;qos&nbsp;=&nbsp;int(sys.argv[3])&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;client&nbsp;=&nbsp;mosquitto.Mosquitto(&amp;quot;test-client%d&amp;quot;&nbsp;%&nbsp;random.randint(1,100))&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;print&nbsp;client._client_id&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;client.connect(&amp;quot;localhost&amp;quot;,port=1884)&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;i&nbsp;=&nbsp;1&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;while&nbsp;i&nbsp;&amp;lt;= &nbsp;cnt:&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;print&nbsp;&amp;quot;Sending&nbsp;JSON&nbsp;msg&nbsp;%d&nbsp;via&nbsp;MQTT&amp;quot;&nbsp;%&nbsp;i&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;msg&nbsp;=&nbsp;{}&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;msg[&amp;quot;id&amp;quot;]&nbsp;=&nbsp;i&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;    try&nbsp;:&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;client.publish(&amp;quot;json_routing_key&amp;quot;,json.dumps(msg),qos=qos)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;except&nbsp;:&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;print&nbsp;&amp;quot;Unexpected&nbsp;publish&nbsp;error:&nbsp;&amp;quot;,sys.exc_info()[0]&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;i&nbsp;=&nbsp;i&nbsp;+&nbsp;1&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;       &nbsp;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;    time.sleep(sleep_s)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt; &lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;time.sleep(2)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;try:&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;client.disconnect()&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;except:&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&amp;quot;Courier&nbsp;New&amp;quot;&quot;&gt;   &nbsp;print&nbsp;&amp;quot;Unexpected&nbsp;disconnect&nbsp;error:&nbsp;&amp;quot;,sys.exc_info()[0]&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt; &lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;<br>

</tt>
