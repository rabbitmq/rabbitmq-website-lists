<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;To&nbsp;clarify&nbsp;on&nbsp;the&nbsp;setup,&nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;&quot;&gt;we&nbsp;removed&nbsp;federated&nbsp;setup&nbsp;to&nbsp;narrow&nbsp;down&nbsp;the&nbsp;cluster&nbsp;issue.&nbsp;&amp;nbsp;The&nbsp;federated&nbsp;setup&nbsp;is&nbsp;between&nbsp;two&nbsp;sets&nbsp;of&nbsp;clusters,&nbsp;each&nbsp;with&nbsp;two&nbsp;nodes&nbsp;on&nbsp;either&nbsp;side&nbsp;of&nbsp;the&nbsp;WAN.&nbsp;&amp;nbsp;So,&nbsp;when&nbsp;I&nbsp;took&nbsp;the&nbsp;tcp&nbsp;dump&nbsp;it&nbsp;was&nbsp;only&nbsp;with&nbsp;the&nbsp;cluster&nbsp;setup&nbsp;and&nbsp;no&nbsp;federatd&nbsp;setup.&nbsp;&amp;nbsp;I&nbsp;was&nbsp;filtering&nbsp;out&nbsp;packets&nbsp;based&nbsp;on&nbsp;the&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;other&nbsp;cluster&nbsp;hosts,&nbsp;not&nbsp;just&nbsp;by&nbsp;the&nbsp;port&nbsp;and&nbsp;analyzing&nbsp;the&nbsp;packets.&nbsp;&amp;nbsp;&nbsp;We&nbsp;were&nbsp;able&nbsp;to&nbsp;successfully&nbsp;configure&nbsp;the&nbsp;federated&nbsp;using&nbsp;AMQPS&nbsp;so&nbsp;we&nbsp;removed&nbsp;the&nbsp;federation&nbsp;configuration.&nbsp;&amp;nbsp;Also,&nbsp;the&nbsp;federation&nbsp;would&nbsp;not&nbsp;be&nbsp;between&nbsp;the&nbsp;two&nbsp;hosts&nbsp;that&nbsp;I&nbsp;am&nbsp;analyzing.&lt;/span&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;-Venkat&lt;br&gt;&lt;/font&gt;&lt;br&gt;On&nbsp;Tuesday,&nbsp;August&nbsp;13,&nbsp;2013&nbsp;12:00:57&nbsp;PM&nbsp;UTC-4,&nbsp;ramvi...@gmail.com&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;We&nbsp;are&nbsp;setting&nbsp;up&nbsp;a&nbsp;RabbitMQ&nbsp;env&nbsp;with&nbsp;clustering&nbsp;on&nbsp;the&nbsp;LAN&nbsp;and&nbsp;federated&nbsp;on&nbsp;the&nbsp;WAN.&nbsp;&amp;nbsp;We&nbsp;also&nbsp;intend&nbsp;to&nbsp;use&nbsp;consistent&nbsp;hash&nbsp;on&nbsp;the&nbsp;receiver&nbsp;side.&nbsp;&amp;nbsp;We&nbsp;were&nbsp;able&nbsp;to&nbsp;successfully&nbsp;setup&nbsp;a&nbsp;federated&nbsp;configuration&nbsp;with&nbsp;ssl&nbsp;enabled.&nbsp;&amp;nbsp;But&nbsp;we&nbsp;are&nbsp;having&nbsp;issues&nbsp;trying&nbsp;to&nbsp;setup&nbsp;ssl&nbsp;with&nbsp;clusters.&nbsp;&amp;nbsp;We&nbsp;are&nbsp;using&nbsp;RabbitMQ&nbsp;3.1.3&nbsp;with&nbsp;erlang&nbsp;version&amp;nbsp;&amp;nbsp;5.9.3.1.&nbsp;&amp;nbsp;We&nbsp;have&nbsp;setup&nbsp;the&nbsp;erlang&nbsp;config&nbsp;based&nbsp;on&amp;nbsp;&lt;a&nbsp;href=&quot;http://www.erlang.org/doc/apps/ssl/ssl_distribution.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.erlang.org/doc/&lt;wbr&gt;apps/ssl/ssl_distribution.html&lt;/a&gt;&lt;wbr&gt;.&nbsp;&amp;nbsp;&nbsp;I&nbsp;am&nbsp;able&nbsp;connect&nbsp;tru&nbsp;an&nbsp;erlang&nbsp;client&nbsp;server&nbsp;program&nbsp;to&nbsp;send&nbsp;data&nbsp;back&nbsp;and&nbsp;forth&nbsp;and&nbsp;so&nbsp;I&nbsp;know&nbsp;the&nbsp;ssl&nbsp;with&nbsp;erlang&nbsp;works.&nbsp;&amp;nbsp;But&nbsp;when&nbsp;I&nbsp;bring&nbsp;RabbitMQ&nbsp;with&nbsp;clusters&nbsp;and&nbsp;take&nbsp;a&nbsp;TCP&nbsp;dump&nbsp;of&nbsp;the&nbsp;packets,&nbsp;the&nbsp;data&nbsp;transfer&nbsp;seem&nbsp;to&nbsp;be&nbsp;clear&nbsp;text.&nbsp;&amp;nbsp;Is&nbsp;there&nbsp;a&nbsp;way&nbsp;to&nbsp;check&nbsp;if&nbsp;the&nbsp;clusters&nbsp;are&nbsp;configured&nbsp;for&nbsp;ssl&nbsp;by&nbsp;any&nbsp;other&nbsp;means.&nbsp;&amp;nbsp;Also,&nbsp;would&nbsp;appreciate&nbsp;if&nbsp;someone&nbsp;can&nbsp;point&nbsp;out&nbsp;what&nbsp;am&nbsp;I&nbsp;doing&nbsp;wrong&nbsp;here.&nbsp;&amp;nbsp;Here&nbsp;is&nbsp;the&nbsp;env&nbsp;file&nbsp;(rabbitmq-env.conf)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;-boot&nbsp;/usr/lib64/erlang/releases/&lt;wbr&gt;R15B03/start_ssl&nbsp;-proto_dist&nbsp;inet_tls&quot;&lt;/div&gt;&lt;div&gt;#SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-pa&nbsp;/usr/lib64/erlang/lib/ssl-5.1.&lt;wbr&gt;2/ebin&quot;&lt;/div&gt;&lt;div&gt;#SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;/usr/lib64/erlang/lib/asn1-1.&lt;wbr&gt;8/ebin&quot;&lt;/div&gt;&lt;div&gt;#SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_portprogram_dir&nbsp;/usr/lib64/erlang/lib/ssl-5.1.&lt;wbr&gt;2/ebin&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;server_cacertfile&nbsp;/etc/openssl/all_cacerts.pem&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;server_certfile&nbsp;/etc/openssl/nn-vmrh5/cert.&lt;wbr&gt;pem&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;server_keyfile&nbsp;/etc/openssl/nn-vmrh5/key.pem&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;server_verify&nbsp;1&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;server_fail_if_no_peer_cert&nbsp;true&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;server_secure_renegotiate&nbsp;true&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;client_cacertfile&nbsp;/etc/openssl/all_cacerts.pem&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;client_certfile&nbsp;/etc/openssl/nn-vmrh5/cert.&lt;wbr&gt;pem&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;client_keyfile&nbsp;/etc/openssl/nn-vmrh5/key.pem&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;client_verify&nbsp;1&quot;&lt;/div&gt;&lt;div&gt;SERVER_START_ARGS=&quot;${SERVER_&lt;wbr&gt;START_ARGS}&nbsp;-ssl_dist_opt&nbsp;client_secure_renegotiate&nbsp;true&quot;&lt;/div&gt;&lt;div&gt;#echo&nbsp;SERVER_START_ARGS:&nbsp;${SERVER_START_ARGS}&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;is&nbsp;the&nbsp;rabbitmq.config&nbsp;for&nbsp;clustering&nbsp;and&nbsp;ssl&nbsp;option&nbsp;set&nbsp;for&nbsp;other&nbsp;modes.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[nn-vmrh5:&nbsp;/etc/rabbitmq]vi&nbsp;rabbitmq.config&lt;/div&gt;&lt;div&gt;[&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{rabbit,&nbsp;[&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{default_vhost,&nbsp;&amp;lt;&amp;lt;&quot;alert&quot;&amp;gt;&amp;gt;},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{tcp_listeners,&nbsp;[5672]},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{ssl_listeners,&nbsp;[5671]},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{rabbitmq_tracing,&nbsp;[{username,&nbsp;&quot;guest&quot;}]},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{cluster_nodes,&nbsp;['rabbit@nn-vmrh5','rabbit@nn-&lt;wbr&gt;vmrh5g']},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{ssl_options,&nbsp;[{cacertfile,&quot;/etc/openssl/&lt;wbr&gt;all_cacerts.pem&quot;},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;{certfile,&quot;/etc/openssl/nn-&lt;wbr&gt;vmrh5/cert.pem&quot;},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;{keyfile,&quot;/etc/openssl/nn-&lt;wbr&gt;vmrh5/key.pem&quot;},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;{verify,verify_peer},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;{fail_if_no_peer_cert,true}]&nbsp;},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{auth_mechanisms,&nbsp;['PLAIN',&nbsp;'AMQPLAIN',&nbsp;'EXTERNAL']},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{ssl_cert_login_from,&nbsp;common_name},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{log_levels,&nbsp;[{connection,&nbsp;info}]}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;]&nbsp;}&lt;/div&gt;&lt;div&gt;].&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;Would&nbsp;really&nbsp;appreciate&nbsp;any&nbsp;help&nbsp;on&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;/div&gt;&lt;div&gt;Venkat&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
