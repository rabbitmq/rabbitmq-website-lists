<tt>
I&nbsp;am&nbsp;trying&nbsp;to&nbsp;setup&nbsp;a&nbsp;dead-letter&nbsp;queue,&nbsp;but&nbsp;when&nbsp;I&nbsp;reject&nbsp;a&nbsp;message&nbsp;it's&nbsp;not&nbsp;passed&nbsp;to&nbsp;the&nbsp;dead-letter&nbsp;queue.&amp;nbsp;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Code&nbsp;I&nbsp;use:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;pre&nbsp;style=&quot;font-family:&nbsp;Consolas;&nbsp;color:&nbsp;black;&nbsp;background-position:&nbsp;initial&nbsp;initial;&nbsp;background-repeat:&nbsp;initial&nbsp;initial;&quot;&gt;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;static&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;void&lt;/span&gt;&amp;nbsp;Main(&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;[]&amp;nbsp;args)<br>
{<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;deadLetterExchangeName&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;DeadLetterExchange&quot;&lt;/span&gt;;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;deadLetterQueueName&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;DeadLetterQueue&quot;&lt;/span&gt;;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;deadLetterRoutingKey&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;MessageQueue&quot;&lt;/span&gt;;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;defaultExchangeName&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;MessagesExchange&quot;&lt;/span&gt;;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;const&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;defaultQueueName&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;MessageQueue&quot;&lt;/span&gt;;<br>
&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;ConnectionFactory&lt;/span&gt;&amp;nbsp;connectionFactory&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;ConnectionFactory&lt;/span&gt;();<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;connectionFactory.HostName&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;10.5.0.184&quot;&lt;/span&gt;;<br>
&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;IConnection&lt;/span&gt;&amp;nbsp;connection&amp;nbsp;=&amp;nbsp;connectionFactory.CreateConnection();<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;IModel&lt;/span&gt;&amp;nbsp;channel&amp;nbsp;=&amp;nbsp;connection.CreateModel();<br>
&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:green;&quot;&gt;//Declare&amp;nbsp;dead-letter&amp;nbsp;exchange&lt;/span&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.ExchangeDeclare(deadLetterExchangeName,&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;ExchangeType&lt;/span&gt;.Direct);<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.QueueDeclare(deadLetterQueueName,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;true&lt;/span&gt;,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;null&lt;/span&gt;);<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.QueueBind(deadLetterQueueName,&amp;nbsp;deadLetterExchangeName,&amp;nbsp;deadLetterRoutingKey,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;null&lt;/span&gt;);<br>
&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:green;&quot;&gt;//Declare&amp;nbsp;default&amp;nbsp;exchange&lt;/span&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.ExchangeDeclare(defaultExchangeName,&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;ExchangeType&lt;/span&gt;.Direct);<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.QueueDeclare(defaultQueueName,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;true&lt;/span&gt;,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;null&lt;/span&gt;);<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;Hashtable&lt;/span&gt;&amp;nbsp;arguments&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;Hashtable&lt;/span&gt;()<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;x-dead-letter-exchange&quot;&lt;/span&gt;,&amp;nbsp;&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;DeadLetterExchange&quot;&lt;/span&gt;},<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;x-dead-letter-routing-key&quot;&lt;/span&gt;,&amp;nbsp;deadLetterRoutingKey}<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;};<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.QueueBind(defaultQueueName,&amp;nbsp;defaultExchangeName,&amp;nbsp;defaultQueueName,&amp;nbsp;arguments);<br>
&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:green;&quot;&gt;//Queue&amp;nbsp;message&lt;/span&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;byte&lt;/span&gt;[]&amp;nbsp;messageBody;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;MyMessage&lt;/span&gt;&amp;nbsp;message&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;MyMessage&lt;/span&gt;(&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;ID-1&quot;&lt;/span&gt;);<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;DataContractJsonSerializer&lt;/span&gt;&amp;nbsp;serializer&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;DataContractJsonSerializer&lt;/span&gt;(&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;typeof&lt;/span&gt;(&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;MyMessage&lt;/span&gt;));<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;using&lt;/span&gt;&amp;nbsp;(&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;MemoryStream&lt;/span&gt;&amp;nbsp;memoryStream&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;new&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;MemoryStream&lt;/span&gt;())<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;serializer.WriteObject(memoryStream,&amp;nbsp;message);<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;messageBody&amp;nbsp;=&amp;nbsp;memoryStream.ToArray();<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}<br>
&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;IBasicProperties&lt;/span&gt;&amp;nbsp;basicProperties&amp;nbsp;=&amp;nbsp;channel.CreateBasicProperties();<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;basicProperties.ContentType&amp;nbsp;=&amp;nbsp;&lt;span&nbsp;style=&quot;color:#a31515;&quot;&gt;&quot;application/json&quot;&lt;/span&gt;;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;basicProperties.DeliveryMode&amp;nbsp;=&amp;nbsp;2;<br>
&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.BasicPublish(defaultExchangeName,&amp;nbsp;defaultQueueName,&amp;nbsp;basicProperties,&amp;nbsp;messageBody);<br>
&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:green;&quot;&gt;//DeQueue&lt;/span&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;BasicGetResult&lt;/span&gt;&amp;nbsp;result&amp;nbsp;=&amp;nbsp;channel.BasicGet(defaultQueueName,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);<br>
&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&nbsp;style=&quot;color:green;&quot;&gt;//Negative&amp;nbsp;Acknowledge&lt;/span&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.BasicNack(result.DeliveryTag,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;,&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;false&lt;/span&gt;);<br>
}<br>
}<br>
&nbsp;<br>
[&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;DataContract&lt;/span&gt;]<br>
&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;class&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;MyMessage&lt;/span&gt;<br>
{<br>
&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;MyMessage(&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;messageId)<br>
{<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;MessageId&amp;nbsp;=&amp;nbsp;messageId;<br>
}<br>
&nbsp;<br>
[&lt;span&nbsp;style=&quot;color:#2b91af;&quot;&gt;DataMember&lt;/span&gt;]<br>
&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;public&lt;/span&gt;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;string&lt;/span&gt;&amp;nbsp;MessageId&amp;nbsp;{&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;get&lt;/span&gt;;&amp;nbsp;&lt;span&nbsp;style=&quot;color:blue;&quot;&gt;set&lt;/span&gt;;&amp;nbsp;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
}&lt;/pre&gt;&lt;pre&nbsp;style=&quot;font-family:&nbsp;Consolas;&nbsp;color:&nbsp;black;&nbsp;background-position:&nbsp;initial&nbsp;initial;&nbsp;background-repeat:&nbsp;initial&nbsp;initial;&quot;&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre&nbsp;style=&quot;font-family:&nbsp;Consolas;&nbsp;color:&nbsp;black;&nbsp;background-position:&nbsp;initial&nbsp;initial;&nbsp;background-repeat:&nbsp;initial&nbsp;initial;&quot;&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;Consolas&quot;&gt;Any&nbsp;ideas?&lt;br&gt;&lt;/font&gt;&lt;/pre&gt;&lt;/div&gt;
</tt>
