<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;found&nbsp;this&nbsp;thread&nbsp;interesting&nbsp;but...&nbsp;we&nbsp;just&nbsp;pull&nbsp;the&nbsp;cable&nbsp;and&nbsp;let&nbsp;a&nbsp;peer&nbsp;take&nbsp;over&nbsp;:)&nbsp;ml&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Apr&nbsp;3,&nbsp;2014&nbsp;at&nbsp;12:47&nbsp;PM,&nbsp;Simon&nbsp;MacMullen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;03/04/14&nbsp;17:28,&nbsp;Bertrand&nbsp;Guay-Paquet&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;tested&nbsp;this&nbsp;on&nbsp;RabbitMQ&nbsp;3.2.4&nbsp;and&nbsp;calling&nbsp;basicCancel&nbsp;for&nbsp;a&nbsp;consumer&lt;br&gt;<br>
tag&nbsp;does&nbsp;not&nbsp;interfere&nbsp;with&nbsp;the&nbsp;ability&nbsp;to&nbsp;basicAck&nbsp;a&nbsp;message&nbsp;currently&lt;br&gt;<br>
being&nbsp;processed&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
That&nbsp;is&nbsp;correct.&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
(I&nbsp;used&nbsp;Thread.sleep()&nbsp;in&nbsp;the&nbsp;consumer&nbsp;to&nbsp;ensure&nbsp;the&lt;br&gt;<br>
operation&nbsp;order).&nbsp;The&nbsp;handleCancelOk()&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;after&nbsp;the&lt;br&gt;<br>
handleDelivery()&nbsp;method&nbsp;returns.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
That&nbsp;is&nbsp;also&nbsp;correct.&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Â From&nbsp;what&nbsp;I&nbsp;could&nbsp;piece&nbsp;together,&nbsp;calling&nbsp;basicCancel&nbsp;queues&nbsp;the&lt;br&gt;<br>
channel&nbsp;rpc&nbsp;command&nbsp;for&nbsp;execution&nbsp;after&nbsp;whatever&nbsp;is&nbsp;already&nbsp;queued.&nbsp;The&lt;br&gt;<br>
consumer&nbsp;even&nbsp;consumes&nbsp;its&nbsp;buffered&nbsp;messages&nbsp;(basicQos&nbsp;&gt;&nbsp;1)&nbsp;before&lt;br&gt;<br>
processing&nbsp;the&nbsp;cancel&nbsp;command.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
So&nbsp;there&nbsp;has&nbsp;been&nbsp;a&nbsp;certain&nbsp;lack&nbsp;of&nbsp;clarity&nbsp;in&nbsp;this&nbsp;thread.&nbsp;Two&nbsp;key&nbsp;points:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;It&nbsp;is&nbsp;absolutely&nbsp;fine&nbsp;and&nbsp;normal&nbsp;to&nbsp;acknowledge&nbsp;a&nbsp;message&nbsp;after&nbsp;its&nbsp;consumer&nbsp;has&nbsp;been&nbsp;cancelled.&nbsp;The&nbsp;message&nbsp;remains&nbsp;acknowledgeable&nbsp;until&nbsp;the&nbsp;channel&nbsp;it&nbsp;was&nbsp;delivered&nbsp;on&nbsp;closes.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Once&nbsp;you&nbsp;have&nbsp;received&nbsp;basic.cancel-ok,&nbsp;you&nbsp;will&nbsp;not&nbsp;receive&nbsp;any&nbsp;more&nbsp;deliveries&nbsp;for&nbsp;that&nbsp;consumer.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;the&nbsp;way&nbsp;to&nbsp;cleanly[0]&nbsp;shut&nbsp;down&nbsp;a&nbsp;consumer&nbsp;in&nbsp;the&nbsp;Java&nbsp;client&nbsp;is:&lt;br&gt;<br>
&lt;br&gt;<br>
1)&nbsp;Invoke&nbsp;basicCancel()&lt;br&gt;<br>
2)&nbsp;Process&nbsp;and&nbsp;acknowledge&nbsp;messages&nbsp;as&nbsp;usual&lt;br&gt;<br>
3)&nbsp;When&nbsp;handleCancelOk()&nbsp;gets&nbsp;called&nbsp;and&nbsp;you&nbsp;have&nbsp;acknowledged&nbsp;all&nbsp;messages&nbsp;you&nbsp;received&nbsp;before&nbsp;it,&nbsp;you&nbsp;can&nbsp;then&nbsp;consider&nbsp;yourself&nbsp;done,&nbsp;close&nbsp;channels&nbsp;and&nbsp;connections&nbsp;as&nbsp;appropriate.&lt;br&gt;<br>
&lt;br&gt;<br>
[0]&nbsp;I&nbsp;am&nbsp;assuming&nbsp;&quot;cleanly&quot;&nbsp;here&nbsp;means&nbsp;without&nbsp;causing&nbsp;messages&nbsp;to&nbsp;be&nbsp;redelivered.&nbsp;Otherwise&nbsp;you&nbsp;can&nbsp;just&nbsp;pull&nbsp;the&nbsp;network&nbsp;cable&nbsp;:-)&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&nbsp;Simon&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Simon&nbsp;MacMullen&lt;br&gt;<br>
RabbitMQ,&nbsp;Pivotal&lt;/font&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.&lt;u&gt;&lt;/u&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;u&gt;&lt;/u&gt;cgi-bin/mailman/listinfo/&lt;u&gt;&lt;/u&gt;rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
