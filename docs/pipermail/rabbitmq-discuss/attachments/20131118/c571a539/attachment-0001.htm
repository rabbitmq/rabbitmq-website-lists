<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;have&nbsp;a&nbsp;rabbitmq&nbsp;server&nbsp;running&nbsp;on&nbsp;my&nbsp;debian&nbsp;linux&nbsp;machine.&nbsp;I&nbsp;have&nbsp;a&nbsp;BGP&nbsp;process&nbsp;running&nbsp;and&nbsp;it&nbsp;prepared&nbsp;a&nbsp;Route&nbsp;Message&nbsp;using&nbsp;google&nbsp;protocol&nbsp;buffers.&nbsp;The&nbsp;protocol&nbsp;buffer&nbsp;returns&nbsp;a&nbsp;binary&nbsp;data&nbsp;buffer.&lt;br&gt;&lt;br&gt;Then&nbsp;I&nbsp;have&nbsp;below&nbsp;code&nbsp;to&nbsp;send&nbsp;this&nbsp;data&nbsp;to&nbsp;rabbitmq&nbsp;server.&nbsp;When&nbsp;I&nbsp;execute&nbsp;this,&nbsp;the&nbsp;process&nbsp;crashes&nbsp;on&nbsp;amqp_basic_publish&nbsp;call.&nbsp;&lt;br&gt;&lt;br&gt;Any&nbsp;thoughts&nbsp;on&nbsp;this&nbsp;?&nbsp;Am&nbsp;I&nbsp;missing&nbsp;some&nbsp;thing&nbsp;here&nbsp;?&lt;br&gt;&lt;br&gt;&lt;br&gt;int&nbsp;bgp_mq_send(char&nbsp;const*&nbsp;rt_msg,&nbsp;int&nbsp;size)&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;static&nbsp;int&nbsp;init_done&nbsp;=&nbsp;0;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;status;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;amqp_socket_t&nbsp;*socket&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;amqp_connection_state_t&nbsp;conn&nbsp;=&nbsp;NULL;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;amqp_rpc_reply_t&nbsp;reply;&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(init_done&nbsp;==&nbsp;0)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;conn&nbsp;=&nbsp;amqp_new_connection();&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;socket&nbsp;=&nbsp;amqp_tcp_socket_new(conn);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(!socket)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;\n&nbsp;socket&nbsp;creation&nbsp;failed\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;1;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;status&nbsp;=&nbsp;amqp_socket_open(socket,&nbsp;&quot;localhost&quot;,&nbsp;5672);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(status)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;\n&nbsp;socket&nbsp;open&nbsp;failed\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;1;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reply&nbsp;=&nbsp;amqp_login(conn,&nbsp;&quot;/&quot;,&nbsp;0,&nbsp;131072,&nbsp;0,&nbsp;&lt;font&nbsp;size=&quot;1&quot;&gt;AMQP_SASL_METHOD_PLAIN&lt;/font&gt;,&nbsp;&quot;guest&quot;,&nbsp;&quot;guest&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(reply.reply_type)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;\n&nbsp;Login&nbsp;is&nbsp;failed\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;amqp_channel_open(conn,&nbsp;1);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reply&nbsp;=&nbsp;amqp_get_rpc_reply(conn);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(reply.reply_type)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;\n&nbsp;get_reply&nbsp;failed\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;init_done&nbsp;=&nbsp;1;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;amqp_basic_properties_t&nbsp;props;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;props._flags&nbsp;=&nbsp;&lt;font&nbsp;size=&quot;1&quot;&gt;AMQP_BASIC_CONTENT_TYPE_FLAG&nbsp;|&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;AMQP_BASIC_DELIVERY_MODE_FLAG&lt;/font&gt;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;props.content_type&nbsp;=&nbsp;amqp_cstring_bytes(&quot;gpb&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;props.content_encoding&nbsp;=&nbsp;amqp_cstring_bytes(&quot;binary&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;props.delivery_mode&nbsp;=&nbsp;2;&nbsp;/*&nbsp;persistent&nbsp;delivery&nbsp;mode&nbsp;*/&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;amqp_bytes_t&nbsp;str2;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;str2.len&nbsp;=&nbsp;size;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;str2.bytes&nbsp;=&nbsp;rt_msg;&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;status&nbsp;=&nbsp;amqp_basic_publish(conn,&nbsp;1,&nbsp;amqp_cstring_bytes(&quot;amq.fanout&quot;),&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;amqp_cstring_bytes(&quot;#&quot;),&nbsp;0,&nbsp;0,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;amp;props,&nbsp;str2);&amp;nbsp;&nbsp;&lt;b&gt;&amp;lt;&amp;lt;&amp;lt;-----------&nbsp;It&nbsp;crashes&nbsp;right&nbsp;here.&lt;/b&gt;&nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(status&nbsp;&amp;lt;&nbsp;0)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;\n&nbsp;publish&nbsp;failed\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;\n&nbsp;Publish&nbsp;success\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reply&nbsp;=&nbsp;amqp_channel_close(conn,&nbsp;1,&nbsp;AMQP_REPLY_SUCCESS);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(reply.reply_type)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;\n&nbsp;chan&nbsp;close&nbsp;failed\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;reply&nbsp;=&nbsp;amqp_connection_close(conn,&nbsp;AMQP_REPLY_SUCCESS);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(reply.reply_type)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;\n&nbsp;conn&nbsp;close&nbsp;failed\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;status&nbsp;=&nbsp;amqp_destroy_connection(conn);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(status&nbsp;&amp;lt;&nbsp;0)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;\n&nbsp;Destroy&nbsp;failed\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;\n&nbsp;All&nbsp;Done\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;0;&lt;br&gt;}&lt;br&gt;&lt;br&gt;any&nbsp;help&nbsp;in&nbsp;moving&nbsp;forward&nbsp;would&nbsp;be&nbsp;great.&lt;br&gt;&lt;br&gt;Thanks,&lt;br&gt;Kiran.&lt;br&gt;&lt;/div&gt;
</tt>
