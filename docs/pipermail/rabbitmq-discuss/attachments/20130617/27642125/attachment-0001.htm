<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Simon,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Thanks&nbsp;for&nbsp;getting&nbsp;back&nbsp;to&nbsp;me.&nbsp;I&amp;#39;ll&nbsp;need&nbsp;to&nbsp;restart&nbsp;our&nbsp;monitor&nbsp;and&nbsp;give&nbsp;it&nbsp;some&nbsp;time&nbsp;to&nbsp;leak&nbsp;the&nbsp;memory.&nbsp;I&amp;#39;ll&nbsp;let&nbsp;you&nbsp;know&nbsp;the&nbsp;results&nbsp;sometime&nbsp;later&nbsp;today.&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;One&nbsp;thing&nbsp;I&nbsp;failed&nbsp;to&nbsp;mention&nbsp;in&nbsp;my&nbsp;initial&nbsp;report:&nbsp;whenever&nbsp;we&nbsp;restarted&nbsp;one&nbsp;of&nbsp;our&nbsp;services,&nbsp;the&nbsp;queues&nbsp;they&nbsp;were&nbsp;using&nbsp;would&nbsp;get&nbsp;cleaned&nbsp;up&nbsp;(we&nbsp;have&nbsp;them&nbsp;set&nbsp;to&nbsp;auto-delete)&nbsp;and&nbsp;redeclared.&nbsp;Whenever&nbsp;we&nbsp;did&nbsp;that,&nbsp;we&nbsp;would&nbsp;see&nbsp;the&nbsp;memory&nbsp;consumption&nbsp;of&nbsp;the&nbsp;management&nbsp;DB&nbsp;fall&nbsp;off&nbsp;sharply&nbsp;before&nbsp;starting&nbsp;to&nbsp;rise&nbsp;again.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;you&amp;#39;d&nbsp;like&nbsp;any&nbsp;further&nbsp;information&nbsp;in&nbsp;the&nbsp;meantime.&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Best,&nbsp;Travis&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;Mon,&nbsp;Jun&nbsp;17,&nbsp;2013&nbsp;at&nbsp;6:39&nbsp;AM,&nbsp;Simon&nbsp;MacMullen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hi.&nbsp;Thanks&nbsp;for&nbsp;the&nbsp;report.&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;first&nbsp;guess&nbsp;is&nbsp;that&nbsp;garbage&nbsp;collection&nbsp;for&nbsp;the&nbsp;management&nbsp;DB&nbsp;process&nbsp;is&nbsp;happening&nbsp;too&nbsp;slowly.&nbsp;Can&nbsp;you&nbsp;invoke:&lt;br&gt;<br>
&lt;br&gt;<br>
$&nbsp;rabbitmqctl&nbsp;eval&nbsp;&amp;#39;P=global:whereis_name(rabbit_&lt;u&gt;&lt;/u&gt;mgmt_db),M1=process_info(P,&nbsp;memory),garbage_collect(P),M2=&lt;u&gt;&lt;/u&gt;process_info(P,&nbsp;memory),{M1,M2,rabbit_vm:&lt;u&gt;&lt;/u&gt;memory()}.&amp;#39;&lt;br&gt;<br>
&lt;br&gt;<br>
and&nbsp;post&nbsp;the&nbsp;results?&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&nbsp;Simon&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;15/06/13&nbsp;03:09,&nbsp;Travis&nbsp;Mehlinger&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
We&nbsp;recently&nbsp;upgraded&nbsp;RabbitMQ&nbsp;from&nbsp;3.0.4&nbsp;to&nbsp;3.1.1&nbsp;after&nbsp;noticing&nbsp;two&nbsp;bug&lt;br&gt;<br>
fixes&nbsp;in&nbsp;3.1.0&nbsp;related&nbsp;to&nbsp;our&nbsp;RabbitMQ&nbsp;deployment:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;*&nbsp;25524&nbsp;fix&nbsp;memory&nbsp;leak&nbsp;in&nbsp;mirror&nbsp;queue&nbsp;slave&nbsp;with&nbsp;many&nbsp;short-lived&lt;br&gt;<br>
 &nbsp; &nbsp;publishing&nbsp;channel&lt;br&gt;<br>
 &nbsp;*&nbsp;25290&nbsp;fix&nbsp;per-queue&nbsp;memory&nbsp;leak&nbsp;recording&nbsp;stats&nbsp;for&nbsp;mirror&nbsp;queue&nbsp;slaves&lt;br&gt;<br>
&lt;br&gt;<br>
However,&nbsp;in&nbsp;our&nbsp;case,&nbsp;it&nbsp;seems&nbsp;that&nbsp;the&nbsp;management&nbsp;plugin&nbsp;may&nbsp;still&nbsp;have&lt;br&gt;<br>
a&nbsp;memory&nbsp;leak.&nbsp;We&nbsp;have&nbsp;a&nbsp;monitoring&nbsp;agent&nbsp;that&nbsp;hits&nbsp;the&nbsp;REST&nbsp;API&nbsp;to&lt;br&gt;<br>
gather&nbsp;information&nbsp;about&nbsp;the&nbsp;broker&nbsp;(number&nbsp;of&nbsp;queues,&nbsp;queue&nbsp;depth,&lt;br&gt;<br>
etc.).&nbsp;With&nbsp;the&nbsp;monitoring&nbsp;agent&nbsp;running&nbsp;and&nbsp;making&nbsp;requests&nbsp;against&nbsp;the&lt;br&gt;<br>
API,&nbsp;memory&nbsp;consumption&nbsp;steadily&nbsp;increased;&nbsp;when&nbsp;we&nbsp;stopped&nbsp;the&nbsp;agent,&lt;br&gt;<br>
memory&nbsp;consumption&nbsp;in&nbsp;the&nbsp;management&nbsp;plugin&nbsp;leveled&nbsp;off.&lt;br&gt;<br>
&lt;br&gt;<br>
Here&nbsp;a&nbsp;couple&nbsp;graphs&nbsp;detailing&nbsp;memory&nbsp;consumption&nbsp;in&nbsp;the&nbsp;broker&nbsp;(the&lt;br&gt;<br>
figures&nbsp;are&nbsp;parsed&nbsp;from&nbsp;rabbitmqctl&nbsp;report).&nbsp;The&nbsp;first&nbsp;graph&nbsp;shows&nbsp;the&lt;br&gt;<br>
ebb&nbsp;and&nbsp;flow&nbsp;of&nbsp;memory&nbsp;consumption&nbsp;in&nbsp;a&nbsp;number&nbsp;of&nbsp;components&nbsp;and&nbsp;the&lt;br&gt;<br>
second&nbsp;shows&nbsp;just&nbsp;consumption&nbsp;by&nbsp;the&nbsp;management&nbsp;plugin.&nbsp;You&nbsp;can&nbsp;see&lt;br&gt;<br>
pretty&nbsp;clearly&nbsp;where&nbsp;we&nbsp;stopped&nbsp;the&nbsp;monitoring&nbsp;agent&nbsp;at&nbsp;1:20.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png&quot;&nbsp;target=&quot;_blank&quot;&gt;https://dl.dropboxusercontent.&lt;u&gt;&lt;/u&gt;com/u/7022167/Screenshots/n-&lt;u&gt;&lt;/u&gt;np6obt-m9f.png&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png&quot;&nbsp;target=&quot;_blank&quot;&gt;https://dl.dropboxusercontent.&lt;u&gt;&lt;/u&gt;com/u/7022167/Screenshots/&lt;u&gt;&lt;/u&gt;an6dpup33xvx.png&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
We&nbsp;have&nbsp;two&nbsp;clustered&nbsp;brokers,&nbsp;both&nbsp;running&nbsp;RabbitMQ&nbsp;3.1.1&nbsp;on&nbsp;Erlang&lt;br&gt;<br>
R14B-04.1.&nbsp;There&nbsp;are&nbsp;typically&nbsp;around&nbsp;200&nbsp;queues,&nbsp;about&nbsp;20&nbsp;of&nbsp;which&nbsp;are&lt;br&gt;<br>
mirrored.&nbsp;There&nbsp;are&nbsp;generally&nbsp;about&nbsp;200&nbsp;consumers.&nbsp;Messages&nbsp;are&nbsp;rarely&lt;br&gt;<br>
queued&nbsp;and&nbsp;most&nbsp;queues&nbsp;typically&nbsp;sit&nbsp;idle.&lt;br&gt;<br>
&lt;br&gt;<br>
I&amp;#39;ll&nbsp;be&nbsp;happy&nbsp;to&nbsp;provide&nbsp;any&nbsp;further&nbsp;diagnostic&nbsp;information.&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks!&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.&lt;u&gt;&lt;/u&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;u&gt;&lt;/u&gt;cgi-bin/mailman/listinfo/&lt;u&gt;&lt;/u&gt;rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Simon&nbsp;MacMullen&lt;br&gt;<br>
RabbitMQ,&nbsp;Pivotal&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
