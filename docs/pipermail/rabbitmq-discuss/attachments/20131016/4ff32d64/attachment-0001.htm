<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;An&nbsp;interesting&nbsp;update.&nbsp;In&nbsp;re-reading&nbsp;the&nbsp;x-consistent-hash&nbsp;type&nbsp;exchange&nbsp;documentation,&nbsp;the&nbsp;following&nbsp;passage:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&amp;quot;The&nbsp;more&nbsp;points&nbsp;in&nbsp;the&nbsp;hash&nbsp;space&nbsp;each&nbsp;binding&nbsp;has,&nbsp;the&nbsp;closer&nbsp;the&nbsp;actual&nbsp;distribution&nbsp;will&nbsp;be&nbsp;to&nbsp;the&nbsp;desired&nbsp;distribution&nbsp;(as&nbsp;indicated&nbsp;by&nbsp;the&nbsp;ratio&nbsp;of&nbsp;points&nbsp;by&nbsp;binding).&nbsp;However,&nbsp;large&nbsp;numbers&nbsp;of&nbsp;points&nbsp;(many&nbsp;thousands)&nbsp;will&nbsp;substantially&nbsp;decrease&nbsp;performance&nbsp;of&nbsp;the&nbsp;exchange&nbsp;type.&amp;quot;&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;It&nbsp;appears&nbsp;that&nbsp;my&nbsp;initial&nbsp;understanding&nbsp;of&nbsp;the&nbsp;integer&nbsp;used&nbsp;to&nbsp;bind&nbsp;queues&nbsp;to&nbsp;the&nbsp;x-consistent-hash&nbsp;exchange&nbsp;as&nbsp;a&nbsp;&amp;quot;weight&amp;quot;&nbsp;was&nbsp;incorrect,&nbsp;but&nbsp;rather&nbsp;it&nbsp;represents&nbsp;the&nbsp;number&nbsp;of&nbsp;points&nbsp;along&nbsp;the&nbsp;overall&nbsp;hash&nbsp;continuum&nbsp;where&nbsp;that&nbsp;particular&nbsp;queue&nbsp;is&nbsp;represented,&nbsp;with&nbsp;the&nbsp;points&nbsp;being&nbsp;(seemingly)&nbsp;pseudorandomly&nbsp;distributed&nbsp;across&nbsp;the&nbsp;overall&nbsp;hash&nbsp;space.&nbsp;So&nbsp;I&nbsp;updated&nbsp;the&nbsp;bindings&nbsp;on&nbsp;each&nbsp;of&nbsp;the&nbsp;queues&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;and&nbsp;re-ran&nbsp;my&nbsp;tests&nbsp;with&nbsp;50K&nbsp;messages&nbsp;this&nbsp;time&nbsp;(in&nbsp;the&nbsp;interests&nbsp;of&nbsp;expediency).&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;The&nbsp;results&nbsp;are&nbsp;as&nbsp;follows:&lt;br&gt;&lt;br&gt;**FIRST&nbsp;TEST&nbsp;(Using&nbsp;UUID&nbsp;as&nbsp;the&nbsp;Hash&nbsp;Header)**&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Queue&nbsp;Name,Message&nbsp;Count,Percent&nbsp;of&nbsp;Total,Percent&nbsp;of&nbsp;Equality&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error01,3505,7.01%,89.16%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error02,2919,5.84%,107.06%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error03,3418,6.84%,91.43%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error04,2912,5.82%,107.31%&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error05,2945,5.89%,106.11%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error06,3146,6.29%,99.33%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error07,3057,6.11%,102.22%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error08,2868,5.74%,108.96%&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error09,2968,5.94%,105.29%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error10,2866,5.73%,109.04%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error11,3513,7.03%,88.96%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error12,4077,8.15%,76.65%&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error13,3054,6.11%,102.32%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error14,2648,5.30%,118.01%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error15,2718,5.44%,114.97%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error16,3386,6.77%,92.29%&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;ALL,50000,100.00%,N/A&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;**SECOND&nbsp;TEST&nbsp;(Using&nbsp;Random&nbsp;Int&nbsp;Between&nbsp;1&nbsp;and&nbsp;1000000000&nbsp;as&nbsp;the&nbsp;Hash&nbsp;Header)**&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Queue&nbsp;Name,Message&nbsp;Count,Percent&nbsp;of&nbsp;Total,Percent&nbsp;of&nbsp;Equality&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error01,3313,6.63%,94.33%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error02,3255,6.51%,96.01%&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error03,3077,6.15%,101.56%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error04,3048,6.10%,102.53%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error05,2384,4.77%,131.08%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error06,2954,5.91%,105.79%&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error07,3586,7.17%,87.14%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error08,3055,6.11%,102.29%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error09,3030,6.06%,103.14%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error10,3517,7.03%,88.85%&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error11,2954,5.91%,105.79%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error12,2921,5.84%,106.98%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error13,3046,6.09%,102.59%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error14,3710,7.42%,84.23%&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error15,3024,6.05%,103.34%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;error16,3126,6.25%,99.97%&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;ALL,50000,100.00%,N/A&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;<br>
<br>
So&nbsp;we&nbsp;now&nbsp;have&nbsp;a&nbsp;much&nbsp;more&nbsp;even&nbsp;distribution.&nbsp;I&nbsp;then&nbsp;changed&nbsp;the&nbsp;bindings&nbsp;of&nbsp;the&nbsp;queues&nbsp;from&nbsp;100&nbsp;to&nbsp;1000&nbsp;and&nbsp;reran&nbsp;the&nbsp;test.&nbsp;I&nbsp;saw&nbsp;significant&nbsp;increase&nbsp;in&nbsp;CPU&nbsp;usage&nbsp;and&nbsp;flow-control&nbsp;started&nbsp;kicking&nbsp;in&nbsp;(running&nbsp;this&nbsp;VM&nbsp;on&nbsp;a&nbsp;single&nbsp;core&nbsp;on&nbsp;my&nbsp;laptop&nbsp;so&nbsp;not&nbsp;unexpected).&nbsp;This&nbsp;is&nbsp;in&nbsp;line&nbsp;with&nbsp;the&nbsp;warning&nbsp;in&nbsp;the&nbsp;excerpt&nbsp;above&nbsp;and&nbsp;makes&nbsp;sense.&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;This&nbsp;leaves&nbsp;me&nbsp;with&nbsp;the&nbsp;following&nbsp;questions:&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;1)&nbsp;Is&nbsp;it&nbsp;true&nbsp;to&nbsp;say&nbsp;that&nbsp;it&nbsp;is&nbsp;now&nbsp;just&nbsp;a&nbsp;matter&nbsp;of&nbsp;choosing&nbsp;what&nbsp;tradeoff&nbsp;we&nbsp;want&nbsp;to&nbsp;make&nbsp;in&nbsp;terms&nbsp;of&nbsp;performance&nbsp;vs.&nbsp;uniformity&nbsp;of&nbsp;distribution?&lt;/div&gt;<br>
<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;2)&nbsp;Can&nbsp;anyone&nbsp;comment&nbsp;on&nbsp;Michael&amp;#39;s&nbsp;previous&nbsp;comment&nbsp;on&nbsp;how&nbsp;using&nbsp;a&nbsp;UUID&nbsp;would&nbsp;be&nbsp;handled&nbsp;as&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;hashed&nbsp;header?&nbsp;The&nbsp;numbers&nbsp;above&nbsp;don&amp;#39;t&nbsp;seem&nbsp;to&nbsp;show&nbsp;a&nbsp;large&nbsp;difference&nbsp;between&nbsp;using&nbsp;a&nbsp;random&nbsp;integer&nbsp;and&nbsp;a&nbsp;UUID.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Regards,&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;Richard&nbsp;Raseley&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;Wed,&nbsp;Oct&nbsp;16,&nbsp;2013&nbsp;at&nbsp;3:34&nbsp;PM,&nbsp;Michael&nbsp;Klishin&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mklishin@gopivotal.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mklishin@gopivotal.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;br&gt;<br>
On&nbsp;oct&nbsp;17,&nbsp;2013,&nbsp;at&nbsp;2:33&nbsp;a.m.,&nbsp;Richard&nbsp;Raseley&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:richard@raseley.com&quot;&nbsp;target=&quot;_blank&quot;&gt;richard@raseley.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;Do&nbsp;you&nbsp;mean&nbsp;to&nbsp;say&nbsp;that&nbsp;those&nbsp;&amp;quot;voided&amp;quot;&nbsp;messages&nbsp;didn&amp;#39;t&nbsp;make&nbsp;it&nbsp;to&nbsp;a&nbsp;queue&nbsp;or&nbsp;weren&amp;#39;t&nbsp;hashed&nbsp;but&nbsp;simply&nbsp;put&nbsp;to&nbsp;an&nbsp;arbitrary&nbsp;queue?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;The&nbsp;former&nbsp;but&nbsp;it&nbsp;was&nbsp;just&nbsp;a&nbsp;guess.&lt;br&gt;<br>
--&lt;br&gt;<br>
MK&lt;br&gt;<br>
&lt;br&gt;<br>
Software&nbsp;Engineer,&nbsp;Pivotal/RabbitMQ&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
