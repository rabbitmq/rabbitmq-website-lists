<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;We&nbsp;have&nbsp;encountered&nbsp;some&nbsp;unexpected&nbsp;behavior&nbsp;when&nbsp;using&nbsp;the&nbsp;&amp;quot;x-consistent-hash&amp;quot;&nbsp;exchange&nbsp;type&nbsp;that&nbsp;I&nbsp;am&nbsp;hoping&nbsp;someone&nbsp;on&nbsp;the&nbsp;list&nbsp;can&nbsp;help&nbsp;us&nbsp;understand. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;At&nbsp;a&nbsp;high&nbsp;level,&nbsp;the&nbsp;issue&nbsp;we&amp;#39;re&nbsp;experiencing&nbsp;is&nbsp;that&nbsp;in&nbsp;our&nbsp;testing&nbsp;of&nbsp;the&nbsp;&amp;quot;x-consistent-hash&amp;quot;&nbsp;exchange&nbsp;we&nbsp;aren&amp;#39;t&nbsp;able&nbsp;to&nbsp;get&nbsp;even&nbsp;(or&nbsp;roughly&nbsp;even)&nbsp;distribution&nbsp;of&nbsp;messages&nbsp;between&nbsp;the&nbsp;queues&nbsp;bound&nbsp;to&nbsp;the&nbsp;exchange.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;is&nbsp;a&nbsp;link&nbsp;to&nbsp;the&nbsp;full&nbsp;broker&nbsp;configuration&nbsp;export&nbsp;(&nbsp;&lt;a&nbsp;href=&quot;http://pastebin.com/nkcXskpY&quot;&gt;http://pastebin.com/nkcXskpY&lt;/a&gt;&nbsp;)&nbsp;but&nbsp;at&nbsp;a&nbsp;high&nbsp;level&nbsp;we&nbsp;are&nbsp;doing&nbsp;the&nbsp;following:&lt;br&gt;&lt;br&gt;1)&nbsp;Topic&nbsp;exchange&nbsp;named&nbsp;&amp;quot;logging.topic&amp;quot;&nbsp;is&nbsp;bound&nbsp;to&nbsp;hash&nbsp;exchange&nbsp;&amp;quot;error.hash&amp;quot;&nbsp;with&nbsp;routing&nbsp;key&nbsp;&amp;quot;error.#&amp;quot;&nbsp;(our&nbsp;eventual&nbsp;goal&nbsp;is&nbsp;to&nbsp;have&nbsp;several&nbsp;of&nbsp;these).&lt;/div&gt;<br>
&lt;div&gt;2)&nbsp;Hash&nbsp;exchange&nbsp;&amp;quot;error.hash&amp;quot;&nbsp;is&nbsp;configured&nbsp;with&nbsp;parameters&nbsp;&amp;quot;hash-header:&nbsp;message-distribution-hash&amp;quot;.&lt;/div&gt;&lt;div&gt;3)&nbsp;Queues&nbsp;named&nbsp;&amp;quot;error01&amp;quot;&nbsp;through&nbsp;&amp;quot;error16&amp;quot;&nbsp;are&nbsp;bound&nbsp;to&nbsp;the&nbsp;&amp;quot;error.hash&amp;quot;&nbsp;exchange&nbsp;each&nbsp;with&nbsp;routing&nbsp;key&nbsp;of&nbsp;&amp;quot;1&amp;quot;&nbsp;(to&nbsp;ensure&nbsp;they&nbsp;each&nbsp;get&nbsp;an&nbsp;equal&nbsp;slice&nbsp;of&nbsp;the&nbsp;hash&nbsp;range).&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;executing&nbsp;a&nbsp;simple&nbsp;test&nbsp;script&nbsp;(&nbsp;&lt;a&nbsp;href=&quot;http://pastebin.com/e7EjZ1TD&quot;&gt;http://pastebin.com/e7EjZ1TD&lt;/a&gt;&nbsp;),&nbsp;which&nbsp;sends&nbsp;500K&nbsp;messages&nbsp;to&nbsp;the&nbsp;&amp;quot;logging.topic&amp;quot;&nbsp;with&nbsp;a&nbsp;&amp;quot;message-distribution-hash&amp;quot;&nbsp;header&nbsp;that&nbsp;a&nbsp;value&nbsp;that&nbsp;is&nbsp;a&nbsp;UUID&nbsp;converted&nbsp;to&nbsp;a&nbsp;string,&nbsp;I&nbsp;see&nbsp;quite&nbsp;unequal&nbsp;distribution&nbsp;of&nbsp;the&nbsp;messages&nbsp;across&nbsp;the&nbsp;queues.&nbsp;I&nbsp;ran&nbsp;three&nbsp;tests&nbsp;of&nbsp;500K&nbsp;messages&nbsp;(resetting&nbsp;and&nbsp;reloading&nbsp;the&nbsp;broker&nbsp;configuration&nbsp;between&nbsp;each&nbsp;test)&nbsp;and&nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;results:&lt;br&gt;<br>
&lt;br&gt;&lt;div&gt;**FIRST&nbsp;TEST**&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;Queue&nbsp;Name,Message&nbsp;Count&lt;/div&gt;&lt;div&gt;error01,73616&lt;/div&gt;&lt;div&gt;error02,65789&lt;/div&gt;&lt;div&gt;error03,12986&lt;/div&gt;&lt;div&gt;error04,15029&lt;/div&gt;&lt;div&gt;error05,12026&lt;/div&gt;&lt;div&gt;error06,51006&lt;/div&gt;&lt;div&gt;<br>
error07,465&lt;/div&gt;&lt;div&gt;error08,95926&lt;/div&gt;&lt;div&gt;error09,34857&lt;/div&gt;&lt;div&gt;error10,16858&lt;/div&gt;&lt;div&gt;error11,19075&lt;/div&gt;&lt;div&gt;error12,25155&lt;/div&gt;&lt;div&gt;error13,25002&lt;/div&gt;&lt;div&gt;error14,14994&lt;/div&gt;&lt;div&gt;error15,8878&lt;/div&gt;&lt;div&gt;error16,28338&lt;/div&gt;<br>
&lt;div&gt;TOTAL,500000&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;**SECOND&nbsp;TEST**&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;Queue&nbsp;Name,Message&nbsp;Count&lt;/div&gt;&lt;div&gt;error01,23124&lt;/div&gt;&lt;div&gt;error02,5122&lt;/div&gt;&lt;div&gt;error03,29047&lt;/div&gt;&lt;div&gt;error04,24405&lt;/div&gt;&lt;div&gt;error05,1467&lt;/div&gt;<br>
&lt;div&gt;error06,1312&lt;/div&gt;&lt;div&gt;error07,28045&lt;/div&gt;&lt;div&gt;error08,35258&lt;/div&gt;&lt;div&gt;error09,164437&lt;/div&gt;&lt;div&gt;error10,25851&lt;/div&gt;&lt;div&gt;error11,40669&lt;/div&gt;&lt;div&gt;error12,24821&lt;/div&gt;&lt;div&gt;error13,17316&lt;/div&gt;&lt;div&gt;error14,18611&lt;/div&gt;&lt;div&gt;<br>
error15,41183&lt;/div&gt;&lt;div&gt;error16,19332&lt;/div&gt;&lt;div&gt;TOTAL,500000&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;**THIRD&nbsp;TEST**&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;Queue&nbsp;Name,Message&nbsp;Count&lt;/div&gt;&lt;div&gt;error01,26655&lt;/div&gt;&lt;div&gt;error02,77116&lt;/div&gt;&lt;div&gt;error03,405&lt;/div&gt;&lt;div&gt;<br>
error04,24106&lt;/div&gt;&lt;div&gt;error05,10543&lt;/div&gt;&lt;div&gt;error06,7734&lt;/div&gt;&lt;div&gt;error07,37476&lt;/div&gt;&lt;div&gt;error08,25048&lt;/div&gt;&lt;div&gt;error09,32156&lt;/div&gt;&lt;div&gt;error10,43750&lt;/div&gt;&lt;div&gt;error11,92675&lt;/div&gt;&lt;div&gt;error12,14325&lt;/div&gt;&lt;div&gt;error13,50265&lt;/div&gt;<br>
&lt;div&gt;error14,18449&lt;/div&gt;&lt;div&gt;error15,2665&lt;/div&gt;&lt;div&gt;error16,36632&lt;/div&gt;&lt;div&gt;TOTAL,500000&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;you&nbsp;can&nbsp;see,&nbsp;some&nbsp;queues&nbsp;get&nbsp;*many*&nbsp;more&nbsp;messages&nbsp;than&nbsp;other&nbsp;queues&nbsp;for&nbsp;example&nbsp;in&nbsp;the&nbsp;third&nbsp;test&nbsp;we&nbsp;see&nbsp;that&nbsp;one&nbsp;queue&nbsp;(error03)&nbsp;received&nbsp;only&nbsp;405&nbsp;messages&nbsp;(0.081%&nbsp;of&nbsp;the&nbsp;total)&nbsp;while&nbsp;another&nbsp;(error11)&nbsp;received&nbsp;92675&nbsp;(18.53%&nbsp;of&nbsp;the&nbsp;total).&nbsp;With&nbsp;all&nbsp;this&nbsp;in&nbsp;mind,&nbsp;my&nbsp;questions&nbsp;are&nbsp;as&nbsp;follows:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1)&nbsp;Why&nbsp;am&nbsp;I&nbsp;seeing&nbsp;such&nbsp;uneven&nbsp;distribution&nbsp;of&nbsp;messages&nbsp;between&nbsp;the&nbsp;queues&nbsp;bound&nbsp;to&nbsp;the&nbsp;x-consistent-hash&nbsp;exchange?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2)&nbsp;What&nbsp;can&nbsp;I&nbsp;do&nbsp;to&nbsp;ensure&nbsp;the&nbsp;most&nbsp;even&nbsp;distribution&nbsp;of&nbsp;messages&nbsp;as&nbsp;possible&nbsp;across&nbsp;the&nbsp;queues&nbsp;bound&nbsp;to&nbsp;the&nbsp;x-consistent-has&nbsp;exchange?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Richard&nbsp;Raseley&lt;/div&gt;&lt;/div&gt;<br>

</tt>
