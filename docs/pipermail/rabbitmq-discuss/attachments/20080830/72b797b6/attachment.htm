<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;With&nbsp;regards&nbsp;to&nbsp;RabbitMQ&nbsp;performance&nbsp;and&nbsp;my&nbsp;previous&nbsp;post,&nbsp;I&nbsp;found&nbsp;some&nbsp;C&nbsp;code&nbsp;from&nbsp;Linux&nbsp;Journal&nbsp;that&nbsp;sets&nbsp;the&nbsp;processor&nbsp;affinity&nbsp;mask&nbsp;for&nbsp;an&nbsp;already&nbsp;running&nbsp;Linux&nbsp;OS&nbsp;process&nbsp;from&nbsp;the&nbsp;command&nbsp;line.&nbsp;I&nbsp;modified&nbsp;the&nbsp;code&nbsp;a&nbsp;bit&nbsp;to&nbsp;work&nbsp;with&nbsp;the&nbsp;most&nbsp;recent&nbsp;Linux&nbsp;APIs&nbsp;and&nbsp;to&nbsp;have&nbsp;a&nbsp;slightly&nbsp;more&nbsp;intuitive&nbsp;user&nbsp;interface.&nbsp;&lt;br&gt;<br>
<br>
&lt;br&gt;Link&nbsp;to&nbsp;unmodified&nbsp;code:&nbsp;&lt;a&nbsp;href=&quot;http://www.linuxjournal.com/files/linuxjournal.com/linuxjournal/articles/067/6799/6799l1.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.linuxjournal.com/files/linuxjournal.com/linuxjournal/articles/067/6799/6799l1.html&lt;/a&gt;&lt;br&gt;<br>
<br>
&lt;br&gt;Example:&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;efine@ender:~/linux$&nbsp;./bindcpu&nbsp;6609&nbsp;1000&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;New&nbsp;mask&nbsp;to&nbsp;be&nbsp;applied:&nbsp;1000&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;pid&nbsp;6609&amp;#39;s&nbsp;old&nbsp;affinity:&nbsp;1111&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;pid&nbsp;6609&amp;#39;s&nbsp;new&nbsp;affinity:&nbsp;1000&lt;/span&gt;&lt;br&gt;<br>
<br>
&lt;br&gt;In&nbsp;the&nbsp;above&nbsp;example,&nbsp;I&nbsp;modified&nbsp;the&nbsp;affinity&nbsp;of&nbsp;an&nbsp;Erlang&nbsp;process&nbsp;that&nbsp;was&nbsp;started&nbsp;with&nbsp;+S&nbsp;1.&nbsp;The&nbsp;old&nbsp;affinity&nbsp;allowed&nbsp;it&nbsp;to&nbsp;run&nbsp;on&nbsp;any&nbsp;of&nbsp;the&nbsp;4&nbsp;CPUs&nbsp;on&nbsp;my&nbsp;system.&nbsp;The&nbsp;new&nbsp;one&nbsp;allows&nbsp;it&nbsp;to&nbsp;run&nbsp;only&nbsp;on&nbsp;CPU&nbsp;3.&nbsp;The&nbsp;mask&nbsp;is&nbsp;a&nbsp;bit&nbsp;string&nbsp;that&nbsp;lets&nbsp;you&nbsp;specify&nbsp;the&nbsp;affinity&nbsp;for&nbsp;up&nbsp;to&nbsp;1024&nbsp;processors&nbsp;by&nbsp;specifying&nbsp;a&nbsp;&amp;#39;1&amp;#39;&nbsp;in&nbsp;the&nbsp;corresponding&nbsp;bit&nbsp;position.&nbsp;Bit&nbsp;0&nbsp;is&nbsp;the&nbsp;rightmost&nbsp;position&nbsp;in&nbsp;the&nbsp;string.&nbsp;I&nbsp;verified&nbsp;using&nbsp;&amp;#39;top&amp;#39;&nbsp;that&nbsp;I&nbsp;could&nbsp;change&nbsp;the&nbsp;CPU&nbsp;on&nbsp;which&nbsp;the&nbsp;beam&nbsp;VM&nbsp;ran,&nbsp;even&nbsp;while&nbsp;it&nbsp;was&nbsp;executing&nbsp;code.&lt;br&gt;<br>
<br>
&lt;br&gt;On&nbsp;an&nbsp;8-core&nbsp;system,&nbsp;one&nbsp;could&nbsp;conceivably&nbsp;leave&nbsp;processor&nbsp;0&nbsp;for&nbsp;the&nbsp;OS,&nbsp;and&nbsp;perhaps&nbsp;reserve&nbsp;processors&nbsp;1&nbsp;through&nbsp;4&nbsp;for&nbsp;clustered&nbsp;RabbitMQ&nbsp;Erlang&nbsp;VMs&nbsp;and&nbsp;the&nbsp;rest&nbsp;for&nbsp;other&nbsp;apps.&nbsp;One&nbsp;additional&nbsp;trick&nbsp;that&nbsp;one&nbsp;can&nbsp;use&nbsp;(disclaimer:&nbsp;VERY&nbsp;carefully!&nbsp;I&nbsp;haven&amp;#39;t&nbsp;tried&nbsp;it&nbsp;with&nbsp;Erlang&nbsp;and&nbsp;one&nbsp;could&nbsp;really&nbsp;mess&nbsp;up&nbsp;one&amp;#39;s&nbsp;system)&nbsp;is&nbsp;to&nbsp;raise&nbsp;the&nbsp;priority&nbsp;of&nbsp;the&nbsp;Erlang&nbsp;VM&nbsp;Linux&nbsp;(OS)&nbsp;processes&nbsp;so&nbsp;that&nbsp;they&nbsp;preempt&nbsp;less&nbsp;important&nbsp;processes&nbsp;and&nbsp;therefore&nbsp;effectively&nbsp;&amp;quot;reserve&amp;quot;&nbsp;the&nbsp;affinitied&nbsp;CPUs&nbsp;for&nbsp;themselves.&nbsp;I&amp;#39;ve&nbsp;seen&nbsp;this&nbsp;approach&nbsp;used&nbsp;in&nbsp;a&nbsp;major&nbsp;US&nbsp;telecomms&nbsp;IT&nbsp;department&nbsp;to&nbsp;maximize&nbsp;database&nbsp;performance,&nbsp;but&nbsp;the&nbsp;database&nbsp;processes&nbsp;were&nbsp;designed&nbsp;to&nbsp;be&nbsp;used&nbsp;like&nbsp;that,&nbsp;hence&nbsp;my&nbsp;caution.&lt;br&gt;<br>
<br>
&lt;br&gt;Anyone&nbsp;interested&nbsp;in&nbsp;seeing&nbsp;if&nbsp;there&nbsp;are&nbsp;RabbitMQ&nbsp;performance&nbsp;improvements&nbsp;by&nbsp;doing&nbsp;this?&nbsp;I&amp;#39;d&nbsp;be&nbsp;happy&nbsp;to&nbsp;post&nbsp;the&nbsp;code&nbsp;(which&nbsp;is&nbsp;very&nbsp;short,&nbsp;125&nbsp;lines&nbsp;of&nbsp;C).&nbsp;Otherwise&nbsp;I&nbsp;will&nbsp;play&nbsp;around&nbsp;with&nbsp;it&nbsp;on&nbsp;non-RabbitMQ&nbsp;code&nbsp;as&nbsp;time&nbsp;permits.&lt;br&gt;<br>
<br>
&lt;br&gt;Regards,&lt;br&gt;Edwin&nbsp;Fine&lt;br&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
