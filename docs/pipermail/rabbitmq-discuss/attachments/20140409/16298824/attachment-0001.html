<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt; &nbsp;I&#39;ve&nbsp;tried&nbsp;to&nbsp;upgrade&nbsp;my&nbsp;cluster&nbsp;to&nbsp;3.3.0.&lt;br&gt;<br>
<br>
<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
&lt;snip&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;As&nbsp;I&#39;ve&nbsp;wrote&nbsp;before,&nbsp;I&nbsp;did&nbsp;a&nbsp;clean&nbsp;install,&nbsp;to&nbsp;drop&nbsp;the&nbsp;inherited&nbsp;possibly&nbsp;damaged&nbsp;mnesia&nbsp;files,&nbsp;so&nbsp;the&nbsp;previous&nbsp;installation&nbsp;can&nbsp;not&nbsp;be&nbsp;tested.&nbsp;But&nbsp;of&nbsp;course&nbsp;I&#39;ve&nbsp;got&nbsp;all&nbsp;the&nbsp;logs.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;<br>
This&nbsp;is&nbsp;quite&nbsp;weird.&nbsp;The&nbsp;diagnostics&nbsp;indicate&nbsp;that&nbsp;there&nbsp;actually&nbsp;is&nbsp;some&nbsp;process&nbsp;up,&nbsp;registered&nbsp;with&nbsp;epmd&nbsp;and&nbsp;listening&nbsp;on&nbsp;the&nbsp;Erlang&nbsp;distribution&nbsp;port&nbsp;for&nbsp;both&nbsp;node2&nbsp;and&nbsp;node3.&lt;/blockquote&gt;&lt;div&gt;I&#39;ve&nbsp;seen&nbsp;this&nbsp;quite&nbsp;a&nbsp;few&nbsp;times.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Just&nbsp;starting&nbsp;and&nbsp;stopping&nbsp;rabbitmq-server&nbsp;leaves&nbsp;one&nbsp;running&nbsp;epmd&nbsp;process&nbsp;in&nbsp;memory!&nbsp;I&#39;ve&nbsp;noticed&nbsp;it&nbsp;before,&nbsp;but&nbsp;it&nbsp;looks&nbsp;like&nbsp;it&#39;s&nbsp;intended.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;example&nbsp;(after&nbsp;the&nbsp;fresh&nbsp;rabbit&nbsp;install):&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;petros@node3:~$&nbsp;ps&nbsp;aux|grep&nbsp;rabbitmq&lt;/div&gt;&lt;div&gt;rabbitmq&nbsp; 1223&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;7496&nbsp; &nbsp;320&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; S&nbsp; &nbsp; 00:41&nbsp; &nbsp;0:00&nbsp;/usr/lib/erlang/erts-5.10.2/bin/epmd&nbsp;-daemon&lt;/div&gt;&lt;div&gt;rabbitmq&nbsp; 2228&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;4440&nbsp; &nbsp;624&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; S&nbsp; &nbsp; 00:42&nbsp; &nbsp;0:00&nbsp;/bin/sh&nbsp;/usr/sbin/rabbitmq-server&lt;/div&gt;<br>
<br>
&lt;div&gt;rabbitmq&nbsp; 2268&nbsp; 2.1&nbsp; 0.6&nbsp;1002616&nbsp;51564&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp;Sl&nbsp; &nbsp;00:42&nbsp; &nbsp;0:13&nbsp;/usr/lib/erlang/erts-5.10.2/bin/beam.smp&nbsp;-W&nbsp;w&nbsp;-K&nbsp;true&nbsp;-A30&nbsp;-P&nbsp;1048576&nbsp;--&nbsp;-root&nbsp;/usr/lib/erlang&nbsp;-progname&nbsp;erl&nbsp;--&nbsp;-home&nbsp;/var/lib/rabbitmq&nbsp;--&nbsp;-pa&nbsp;/usr/lib/rabbitmq/lib/rabbitmq_server-3.3.0/sbin/../ebin&nbsp;-noshell&nbsp;-noinput&nbsp;-s&nbsp;rabbit&nbsp;boot&nbsp;-sname&nbsp;rabbit@node3&nbsp;-boot&nbsp;start_sasl&nbsp;-config&nbsp;/etc/rabbitmq/rabbitmq&nbsp;-kernel&nbsp;inet_default_connect_options&nbsp;[{nodelay,true}]&nbsp;-sasl&nbsp;errlog_type&nbsp;error&nbsp;-sasl&nbsp;sasl_error_logger&nbsp;false&nbsp;-rabbit&nbsp;error_logger&nbsp;{file,&quot;/var/log/rabbitmq/rabbit@node3.log&quot;}&nbsp;-rabbit&nbsp;sasl_error_logger&nbsp;{file,&quot;/var/log/rabbitmq/rabbit@node3-sasl.log&quot;}&nbsp;-rabbit&nbsp;enabled_plugins_file&nbsp;&quot;/etc/rabbitmq/enabled_plugins&quot;&nbsp;-rabbit&nbsp;plugins_dir&nbsp;&quot;/usr/lib/rabbitmq/lib/rabbitmq_server-3.3.0/sbin/../plugins&quot;&nbsp;-rabbit&nbsp;plugins_expand_dir&nbsp;&quot;/var/lib/rabbitmq/mnesia/rabbit@node3-plugins-expand&quot;&nbsp;-os_mon&nbsp;start_cpu_sup&nbsp;false&nbsp;-os_mon&nbsp;start_disksup&nbsp;false&nbsp;-os_mon&nbsp;start_memsup&nbsp;false&nbsp;-mnesia&nbsp;dir&nbsp;&quot;/var/lib/rabbitmq/mnesia/rabbit@node3&quot;&nbsp;-kernel&nbsp;inet_dist_listen_min&nbsp;25672&nbsp;-kernel&nbsp;inet_dist_listen_max&nbsp;25672&lt;/div&gt;<br>
<br>
&lt;div&gt;rabbitmq&nbsp; 2368&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;7460&nbsp; &nbsp;428&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; Ss&nbsp; &nbsp;00:42&nbsp; &nbsp;0:00&nbsp;inet_gethost&nbsp;4&lt;/div&gt;&lt;div&gt;rabbitmq&nbsp; 2369&nbsp; 0.0&nbsp; 0.0&nbsp; 13788&nbsp; &nbsp;832&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; S&nbsp; &nbsp; 00:42&nbsp; &nbsp;0:00&nbsp;inet_gethost&nbsp;4&lt;/div&gt;&lt;div&gt;petros&nbsp; &nbsp; 5381&nbsp; 0.0&nbsp; 0.0&nbsp; 11196&nbsp; &nbsp;948&nbsp;pts/0&nbsp; &nbsp; S+&nbsp; &nbsp;00:52&nbsp; &nbsp;0:00&nbsp;grep&nbsp;--color=auto&nbsp;rabbitmq&lt;/div&gt;<br>
<br>
&lt;div&gt;petros@node3:~$&nbsp;sudo&nbsp;service&nbsp;rabbitmq-server&nbsp;stop&lt;/div&gt;&lt;div&gt; *&nbsp;Stopping&nbsp;message&nbsp;broker&nbsp;rabbitmq-server&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [&nbsp;OK&nbsp;] &lt;/div&gt;<br>
<br>
&lt;div&gt;petros@node3:~$&nbsp;ps&nbsp;aux|grep&nbsp;rabbitmq&lt;/div&gt;&lt;div&gt;rabbitmq&nbsp; 1223&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;7496&nbsp; &nbsp;320&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; S&nbsp; &nbsp; 00:41&nbsp; &nbsp;0:00&nbsp;/usr/lib/erlang/erts-5.10.2/bin/epmd&nbsp;-daemon&lt;/div&gt;&lt;div&gt;petros&nbsp; &nbsp; 5505&nbsp; 0.0&nbsp; 0.0&nbsp; 11196&nbsp; &nbsp;944&nbsp;pts/0&nbsp; &nbsp; S+&nbsp; &nbsp;00:53&nbsp; &nbsp;0:00&nbsp;grep&nbsp;--color=auto&nbsp;rabbitmq&lt;/div&gt;<br>
<br>
&lt;div&gt;petros@node3:~$ &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;after&nbsp;stopping,&nbsp;one&nbsp;erlang&nbsp;process&nbsp;still&nbsp;runs,&nbsp;who&nbsp;knows&nbsp;why.&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;petros@node3:~$&nbsp;sudo&nbsp;lsof&nbsp;|grep&nbsp;epmd&lt;/div&gt;&lt;div&gt;epmd&nbsp; &nbsp; &nbsp; 1223&nbsp; &nbsp; &nbsp; &nbsp; rabbitmq&nbsp; cwd&nbsp; &nbsp; &nbsp; &nbsp;DIR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8,1&nbsp; &nbsp; &nbsp;4096&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp;/&lt;/div&gt;<br>
<br>
&lt;div&gt;epmd&nbsp; &nbsp; &nbsp; 1223&nbsp; &nbsp; &nbsp; &nbsp; rabbitmq&nbsp; rtd&nbsp; &nbsp; &nbsp; &nbsp;DIR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8,1&nbsp; &nbsp; &nbsp;4096&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp;/&lt;/div&gt;&lt;div&gt;epmd&nbsp; &nbsp; &nbsp; 1223&nbsp; &nbsp; &nbsp; &nbsp; rabbitmq&nbsp; txt&nbsp; &nbsp; &nbsp; &nbsp;REG&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8,1&nbsp; &nbsp; 51856&nbsp; &nbsp; &nbsp;936647&nbsp;/usr/lib/erlang/erts-5.10.2/bin/epmd&lt;/div&gt;<br>
<br>
&lt;div&gt;epmd&nbsp; &nbsp; &nbsp; 1223&nbsp; &nbsp; &nbsp; &nbsp; rabbitmq&nbsp; mem&nbsp; &nbsp; &nbsp; &nbsp;REG&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8,1&nbsp; 1853400&nbsp; &nbsp; &nbsp;394057&nbsp;/lib/x86_64-linux-gnu/&lt;a&nbsp;href=&quot;http://libc-2.17.so&quot;&gt;libc-2.17.so&lt;/a&gt;&lt;/div&gt;&lt;div&gt;epmd&nbsp; &nbsp; &nbsp; 1223&nbsp; &nbsp; &nbsp; &nbsp; rabbitmq&nbsp; mem&nbsp; &nbsp; &nbsp; &nbsp;REG&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8,1&nbsp; 1063328&nbsp; &nbsp; &nbsp;394030&nbsp;/lib/x86_64-linux-gnu/&lt;a&nbsp;href=&quot;http://libm-2.17.so&quot;&gt;libm-2.17.so&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;epmd&nbsp; &nbsp; &nbsp; 1223&nbsp; &nbsp; &nbsp; &nbsp; rabbitmq&nbsp; mem&nbsp; &nbsp; &nbsp; &nbsp;REG&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8,1&nbsp; &nbsp;149312&nbsp; &nbsp; &nbsp;394033&nbsp;/lib/x86_64-linux-gnu/&lt;a&nbsp;href=&quot;http://ld-2.17.so&quot;&gt;ld-2.17.so&lt;/a&gt;&lt;/div&gt;&lt;div&gt;epmd&nbsp; &nbsp; &nbsp; 1223&nbsp; &nbsp; &nbsp; &nbsp; rabbitmq&nbsp; &nbsp; 0r&nbsp; &nbsp; &nbsp; CHR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1,3&nbsp; &nbsp; &nbsp; 0t0&nbsp; &nbsp; &nbsp; &nbsp;1029&nbsp;/dev/null&lt;/div&gt;<br>
<br>
&lt;div&gt;epmd&nbsp; &nbsp; &nbsp; 1223&nbsp; &nbsp; &nbsp; &nbsp; rabbitmq&nbsp; &nbsp; 1w&nbsp; &nbsp; &nbsp; CHR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1,3&nbsp; &nbsp; &nbsp; 0t0&nbsp; &nbsp; &nbsp; &nbsp;1029&nbsp;/dev/null&lt;/div&gt;&lt;div&gt;epmd&nbsp; &nbsp; &nbsp; 1223&nbsp; &nbsp; &nbsp; &nbsp; rabbitmq&nbsp; &nbsp; 2w&nbsp; &nbsp; &nbsp; CHR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1,3&nbsp; &nbsp; &nbsp; 0t0&nbsp; &nbsp; &nbsp; &nbsp;1029&nbsp;/dev/null&lt;/div&gt;&lt;div&gt;epmd&nbsp; &nbsp; &nbsp; 1223&nbsp; &nbsp; &nbsp; &nbsp; rabbitmq&nbsp; &nbsp; 3u&nbsp; &nbsp; &nbsp;IPv4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10155&nbsp; &nbsp; &nbsp; 0t0&nbsp; &nbsp; &nbsp; &nbsp; TCP&nbsp;*:epmd&nbsp;(LISTEN)&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;and&nbsp;it&#39;s&nbsp;listening&nbsp;too...&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
WHY&nbsp;is&nbsp;it&nbsp;waiting&nbsp;for&nbsp;node2,&nbsp;node3,&nbsp;if&nbsp;node1&nbsp;was&nbsp;the&nbsp;last&nbsp;to&nbsp;stop,&nbsp;and&lt;br&gt;<br>
it&nbsp;should&nbsp;come&nbsp;online&nbsp;in&nbsp;itself&nbsp;without&nbsp;them?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Very&nbsp;good&nbsp;question.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;was&nbsp;able&nbsp;to&nbsp;reproduce&nbsp;this&nbsp;precise&nbsp;error&nbsp;message&nbsp;by&nbsp;doing&nbsp;the&nbsp;equivalent&nbsp;of:&lt;br&gt;<br>
&lt;br&gt;<br>
(stop&nbsp;node1)&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;node2&nbsp;stop_app&lt;br&gt;<br>
rabbitmqctl&nbsp;-n&nbsp;node3&nbsp;stop_app&lt;br&gt;<br>
(start&nbsp;node1)&lt;br&gt;<br>
&lt;br&gt;<br>
i./e.&nbsp;leaving&nbsp;the&nbsp;Erlang&nbsp;VM&nbsp;running&nbsp;but&nbsp;stopping&nbsp;RabbitMQ&nbsp;(and&nbsp;Mnesia)&nbsp;on&nbsp;node2&nbsp;and&nbsp;node3.&lt;br&gt;<br>
&lt;br&gt;<br>
Is&nbsp;there&nbsp;any&nbsp;possibility&nbsp;at&nbsp;all&nbsp;you&nbsp;could&nbsp;have&nbsp;done&nbsp;something&nbsp;like&nbsp;this?&nbsp;Is&nbsp;there&nbsp;a&nbsp;beam.smp&nbsp;process&nbsp;running&nbsp;on&nbsp;those&nbsp;nodes?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;I&nbsp;don&#39;t&nbsp;run&nbsp;rabbitmqctl&nbsp;stop_app&nbsp;commands&nbsp;by&nbsp;hand,&nbsp;I&#39;ve&nbsp;got&nbsp;these&nbsp;things&nbsp;(creating&nbsp;a&nbsp;cluster,&nbsp;changing&nbsp;nodetype)&nbsp;scripted,&nbsp;so&nbsp;no,&nbsp;that&#39;s&nbsp;not&nbsp;the&nbsp;case.&nbsp;Even&nbsp;if&nbsp;I&nbsp;run&nbsp;something&nbsp;that&nbsp;needs&nbsp;stop_app,&nbsp;there&nbsp;was&nbsp;a&nbsp;start_app&nbsp;in&nbsp;a&nbsp;second.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;am&nbsp;especially&nbsp;puzzled&nbsp;since&nbsp;the&nbsp;nodes&nbsp;have&nbsp;registered&nbsp;25672&nbsp;as&nbsp;a&nbsp;distribution&nbsp;port&nbsp;-&nbsp;prior&nbsp;to&nbsp;3.3.0&nbsp;the&nbsp;distribution&nbsp;port&nbsp;would&nbsp;be&nbsp;chosen&nbsp;at&nbsp;random,&nbsp;or&nbsp;you&nbsp;could&nbsp;configure&nbsp;it.&nbsp;So&nbsp;the&nbsp;presence&nbsp;of&nbsp;25672&nbsp;strongly&nbsp;indicates&nbsp;that&nbsp;those&nbsp;nodes&nbsp;have&nbsp;been&nbsp;upgraded&nbsp;to&nbsp;3.3.0&nbsp;and&nbsp;are&nbsp;running&nbsp;an&nbsp;Erlang&nbsp;VM&nbsp;-&nbsp;with&nbsp;RabbitMQ&nbsp;stopped?&lt;/blockquote&gt;<br>
<br>
&lt;div&gt;I&nbsp;think&nbsp;that&nbsp;the&nbsp;standard&nbsp;apt-get&nbsp;process&nbsp;is&nbsp;doing&nbsp;something&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&gt;service&nbsp;rabbitmq-server&nbsp;stop&lt;/div&gt;&lt;div&gt;upgrade&lt;/div&gt;&lt;div&gt;service&nbsp;rabbitmq-server&nbsp;start&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;but&nbsp;as&nbsp;we&#39;ve&nbsp;already&nbsp;identified&nbsp;rabbitmq-server&nbsp;stop&nbsp;does&nbsp;leave&nbsp;an&nbsp;epmd&nbsp;running,&nbsp;as&nbsp;it&nbsp;did&nbsp;with&nbsp;3.1.3,&nbsp;3.2.2,&nbsp;3.2.3,&nbsp;3.2.4,&nbsp;3.3.0 &lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;so&nbsp;after&nbsp;upgradeing&nbsp;the&nbsp;epmd&nbsp;isn&#39;t&nbsp;fresh,&nbsp;it&nbsp;may&nbsp;have&nbsp;previous&nbsp;settings,&nbsp;apps&nbsp;running.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
The&nbsp;cookie&nbsp;is&nbsp;the&nbsp;same,&nbsp;the&nbsp;hostnames&nbsp;are&nbsp;correct.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
If&nbsp;I&nbsp;am&nbsp;correct&nbsp;about&nbsp;the&nbsp;diagnosis&nbsp;above&nbsp;then&nbsp;the&nbsp;diagnostics&nbsp;don&#39;t&nbsp;currently&nbsp;handle&nbsp;this&nbsp;situation&nbsp;well;&nbsp;they&nbsp;don&#39;t&nbsp;check&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;Erlang&nbsp;is&nbsp;running&nbsp;but&nbsp;RabbitMQ&nbsp;isn&#39;t.&nbsp;This&nbsp;will&nbsp;get&nbsp;fixed&nbsp;in&nbsp;the&nbsp;next&nbsp;release.&lt;/blockquote&gt;<br>
<br>
&lt;div&gt;Intensive&nbsp;logging&nbsp;would&nbsp;help&nbsp;too. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt; &nbsp;I&#39;m&nbsp;trying&nbsp;to&nbsp;start&nbsp;node2&nbsp;and&nbsp;node3&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;running&nbsp;but&lt;br&gt;<br>
<br>
they&nbsp;always&nbsp;fail,&nbsp;even&nbsp;if&nbsp;I&nbsp;copied&nbsp;back&nbsp;the&nbsp;previous&nbsp;disk&nbsp;state,&nbsp;and&lt;br&gt;upgraded&nbsp;again...&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;How&nbsp;do&nbsp;they&nbsp;fail?&nbsp;Because&nbsp;it&nbsp;sounds&nbsp;like&nbsp;something&nbsp;is&nbsp;running.&lt;/blockquote&gt;&lt;div&gt; Node2&nbsp;and&nbsp;node3&nbsp;always&nbsp;exited&nbsp;with&nbsp;the&nbsp;message&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;the&nbsp;one&nbsp;stopped&nbsp;the&nbsp;last,&nbsp;and&nbsp;if&nbsp;I&nbsp;removed&nbsp;the&nbsp;locks&nbsp;they&nbsp;tried&nbsp;to&nbsp;connect&nbsp;to&nbsp;each&nbsp;other&nbsp;-&nbsp;while&nbsp;repairing&nbsp;the&nbsp;mnesia&nbsp;db,&nbsp;and&nbsp;as&nbsp;the&nbsp;network&nbsp;connect&nbsp;failed&nbsp;(as&nbsp;they&nbsp;were&nbsp;not&nbsp;accepting&nbsp;connections&nbsp;probably&nbsp;because&nbsp;the&nbsp;db&nbsp;repair&nbsp;was&nbsp;on),&nbsp;they&nbsp;quit,&nbsp;leaving&nbsp;the&nbsp;repair&nbsp;in&nbsp;half.&nbsp;So&nbsp;the&nbsp;nodes&nbsp;were&nbsp;not&nbsp;able&nbsp;to&nbsp;communicate&nbsp;because&nbsp;of&nbsp;the&nbsp;db&nbsp;repair&nbsp;(this&nbsp;is&nbsp;a&nbsp;theory&nbsp;only),&nbsp;and&nbsp;as&nbsp;the&nbsp;timeout&nbsp;arrived&nbsp;they&nbsp;quit&nbsp;before&nbsp;the&nbsp;repair&nbsp;would&nbsp;finish.&nbsp;(It&nbsp;would&nbsp;be&nbsp;nice&nbsp;to&nbsp;have&nbsp;a&nbsp;message&nbsp;like&nbsp;&quot;starting&nbsp;repair&quot;&nbsp;and&nbsp;&quot;repair&nbsp;finished&quot;,&nbsp;as&nbsp;the&nbsp;log&nbsp;message&nbsp;currently&nbsp;is&nbsp;not&nbsp;clear&nbsp;about&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;repair,&nbsp;I&#39;m&nbsp;not&nbsp;sure&nbsp;that&nbsp;if&nbsp;the&nbsp;repair&nbsp;ends&nbsp;I&#39;ll&nbsp;get&nbsp;a&nbsp;logitem.)&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;====&nbsp;cut&nbsp;here&nbsp;====&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;At&nbsp;this&nbsp;very&nbsp;moment&nbsp;I&nbsp;have&nbsp;the&nbsp;following&nbsp;situation&nbsp;(after&nbsp;the&nbsp;clean&nbsp;3.3.0&nbsp;install&nbsp;on&nbsp;all&nbsp;nodes,&nbsp;and&nbsp;cluster&nbsp;rebuilt):&lt;/div&gt;&lt;div&gt;node1,node2,node3&nbsp;is&nbsp;after&nbsp;an&nbsp;apt-get&nbsp;upgrade,&nbsp;and&nbsp;needs&nbsp;restarting&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node1&nbsp;restart&nbsp;done,&nbsp;fine.&lt;/div&gt;&lt;div&gt;node3&nbsp;restart&nbsp;done,&nbsp;fine.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node2:&nbsp;sudo&nbsp;reboot,&nbsp;and&nbsp;it&#39;s&nbsp;just&nbsp;waiting&nbsp;forever&nbsp;(without&nbsp;the&nbsp;usual&nbsp;conneciton&nbsp;closed&nbsp;by&nbsp;foreign&nbsp;host)&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;root@node2:~#&nbsp;rabbitmqctl&nbsp;status&lt;/div&gt;&lt;div&gt;Status&nbsp;of&nbsp;node&nbsp;rabbit@node2&nbsp;...&lt;/div&gt;&lt;div&gt;Error:&nbsp;unable&nbsp;to&nbsp;connect&nbsp;to&nbsp;node&nbsp;rabbit@node2:&nbsp;nodedown&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;DIAGNOSTICS&lt;/div&gt;&lt;div&gt;===========&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;attempted&nbsp;to&nbsp;contact:&nbsp;[rabbit@node2]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;rabbit@node2:&lt;/div&gt;&lt;div&gt; &nbsp;*&nbsp;rabbit&nbsp;seems&nbsp;not&nbsp;to&nbsp;be&nbsp;running&nbsp;at&nbsp;all&lt;/div&gt;&lt;div&gt; &nbsp;*&nbsp;other&nbsp;nodes&nbsp;on&nbsp;node2:&nbsp;[rabbitmqctl13579]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
current&nbsp;node&nbsp;details:&lt;/div&gt;&lt;div&gt;-&nbsp;node&nbsp;name:&nbsp;rabbitmqctl14147@node2&lt;/div&gt;&lt;div&gt;-&nbsp;home&nbsp;dir:&nbsp;/var/lib/rabbitmq&lt;/div&gt;&lt;div&gt;-&nbsp;cookie&nbsp;hash:&nbsp;XSquoZCiCPIfZlTilwy1Dg==&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;....&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;root@node2:~#&nbsp;ps&nbsp;aux|grep&nbsp;rabbit&lt;/div&gt;<br>
<br>
&lt;div&gt;rabbitmq&nbsp; 1221&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;9416&nbsp; 2372&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; S&nbsp; &nbsp; Apr02&nbsp; &nbsp;0:10&nbsp;/usr/lib/erlang/erts-5.10.2/bin/epmd&nbsp;-daemon&lt;/div&gt;&lt;div&gt;rabbitmq&nbsp; 2189&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;4440&nbsp; &nbsp;624&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; S&nbsp; &nbsp; Apr02&nbsp; &nbsp;0:00&nbsp;/bin/sh&nbsp;/usr/sbin/rabbitmq-server&lt;/div&gt;<br>
<br>
&lt;div&gt;rabbitmq&nbsp; 2236&nbsp; 2.3&nbsp; 0.6&nbsp;995960&nbsp;53324&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; Sl&nbsp; &nbsp;Apr02&nbsp;211:08&nbsp;/usr/lib/erlang/erts-5.10.2/bin/beam.smp&nbsp;-W&nbsp;w&nbsp;-K&nbsp;true&nbsp;-A30&nbsp;-P&nbsp;1048576&nbsp;--&nbsp;-root&nbsp;/usr/lib/erlang&nbsp;-progname&nbsp;erl&nbsp;--&nbsp;-home&nbsp;/var/lib/rabbitmq&nbsp;--&nbsp;-pa&nbsp;/usr/lib/rabbitmq/lib/rabbitmq_server-3.3.0/sbin/../ebin&nbsp;-noshell&nbsp;-noinput&nbsp;-s&nbsp;rabbit&nbsp;boot&nbsp;-sname&nbsp;rabbit@node2&nbsp;-boot&nbsp;start_sasl&nbsp;-config&nbsp;/etc/rabbitmq/rabbitmq&nbsp;-kernel&nbsp;inet_default_connect_options&nbsp;[{nodelay,true}]&nbsp;-sasl&nbsp;errlog_type&nbsp;error&nbsp;-sasl&nbsp;sasl_error_logger&nbsp;false&nbsp;-rabbit&nbsp;error_logger&nbsp;{file,&quot;/var/log/rabbitmq/rabbit@node2.log&quot;}&nbsp;-rabbit&nbsp;sasl_error_logger&nbsp;{file,&quot;/var/log/rabbitmq/rabbit@node2-sasl.log&quot;}&nbsp;-rabbit&nbsp;enabled_plugins_file&nbsp;&quot;/etc/rabbitmq/enabled_plugins&quot;&nbsp;-rabbit&nbsp;plugins_dir&nbsp;&quot;/usr/lib/rabbitmq/lib/rabbitmq_server-3.3.0/sbin/../plugins&quot;&nbsp;-rabbit&nbsp;plugins_expand_dir&nbsp;&quot;/var/lib/rabbitmq/mnesia/rabbit@node2-plugins-expand&quot;&nbsp;-os_mon&nbsp;start_cpu_sup&nbsp;false&nbsp;-os_mon&nbsp;start_disksup&nbsp;false&nbsp;-os_mon&nbsp;start_memsup&nbsp;false&nbsp;-mnesia&nbsp;dir&nbsp;&quot;/var/lib/rabbitmq/mnesia/rabbit@node2&quot;&nbsp;-kernel&nbsp;inet_dist_listen_min&nbsp;25672&nbsp;-kernel&nbsp;inet_dist_listen_max&nbsp;25672&lt;/div&gt;<br>
<br>
&lt;div&gt;root&nbsp; &nbsp; &nbsp;13513&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;4440&nbsp; &nbsp;776&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; S&nbsp; &nbsp; 00:42&nbsp; &nbsp;0:00&nbsp;/bin/sh&nbsp;/etc/rc6.d/K20rabbitmq-server&nbsp;stop&lt;/div&gt;&lt;div&gt;root&nbsp; &nbsp; &nbsp;13568&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;4440&nbsp; &nbsp;680&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; S&nbsp; &nbsp; 00:42&nbsp; &nbsp;0:00&nbsp;/bin/sh&nbsp;/usr/sbin/rabbitmqctl&nbsp;stop&nbsp;/var/run/rabbitmq/pid&lt;/div&gt;<br>
<br>
&lt;div&gt;root&nbsp; &nbsp; &nbsp;13577&nbsp; 0.0&nbsp; 0.0&nbsp; 53204&nbsp; 1652&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; S&nbsp; &nbsp; 00:42&nbsp; &nbsp;0:00&nbsp;su&nbsp;rabbitmq&nbsp;-s&nbsp;/bin/sh&nbsp;-c&nbsp;/usr/lib/rabbitmq/bin/rabbitmqctl&nbsp; &quot;stop&quot;&nbsp;&quot;/var/run/rabbitmq/pid&quot;&lt;/div&gt;&lt;div&gt;rabbitmq&nbsp;13578&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;4440&nbsp; &nbsp;624&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; Ss&nbsp; &nbsp;00:42&nbsp; &nbsp;0:00&nbsp;sh&nbsp;-c&nbsp;/usr/lib/rabbitmq/bin/rabbitmqctl&nbsp; &quot;stop&quot;&nbsp;&quot;/var/run/rabbitmq/pid&quot;&lt;/div&gt;<br>
<br>
&lt;div&gt;rabbitmq&nbsp;13579&nbsp; 0.1&nbsp; 0.1&nbsp;437204&nbsp;14676&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; Sl&nbsp; &nbsp;00:42&nbsp; &nbsp;0:01&nbsp;/usr/lib/erlang/erts-5.10.2/bin/beam.smp&nbsp;--&nbsp;-root&nbsp;/usr/lib/erlang&nbsp;-progname&nbsp;erl&nbsp;--&nbsp;-home&nbsp;/var/lib/rabbitmq&nbsp;--&nbsp;-pa&nbsp;/usr/lib/rabbitmq/lib/rabbitmq_server-3.3.0/sbin/../ebin&nbsp;-noshell&nbsp;-noinput&nbsp;-hidden&nbsp;-sname&nbsp;rabbitmqctl13579&nbsp;-boot&nbsp;start_clean&nbsp;-s&nbsp;rabbit_control_main&nbsp;-nodename&nbsp;rabbit@node2&nbsp;-extra&nbsp;stop&nbsp;/var/run/rabbitmq/pid&lt;/div&gt;<br>
<br>
&lt;div&gt;rabbitmq&nbsp;13611&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;7460&nbsp; &nbsp;432&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; Ss&nbsp; &nbsp;00:42&nbsp; &nbsp;0:00&nbsp;inet_gethost&nbsp;4&lt;/div&gt;&lt;div&gt;rabbitmq&nbsp;13612&nbsp; 0.0&nbsp; 0.0&nbsp; &nbsp;9560&nbsp; &nbsp;636&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; S&nbsp; &nbsp; 00:42&nbsp; &nbsp;0:00&nbsp;inet_gethost&nbsp;4&lt;/div&gt;&lt;div&gt;root&nbsp; &nbsp; &nbsp;14958&nbsp; 0.0&nbsp; 0.0&nbsp; 11196&nbsp; &nbsp;948&nbsp;pts/0&nbsp; &nbsp; S+&nbsp; &nbsp;01:00&nbsp; &nbsp;0:00&nbsp;grep&nbsp;--color=auto&nbsp;rabbit&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;NOTE&nbsp;that,&nbsp;we&nbsp;have&nbsp;the&nbsp;&quot;K20rabbitmq-server&nbsp;stop&quot;&nbsp; running,&nbsp;we&nbsp;have&nbsp;the&nbsp;rabbitmq&nbsp;processes&nbsp;too,&nbsp;but&nbsp;currently&nbsp;neither&nbsp;rabbitmqctl&nbsp;nor&nbsp;management&nbsp;plugin&nbsp;is&nbsp;accessible,&nbsp;and&nbsp;the&nbsp;reboot&nbsp;process&nbsp;hung.&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;was&nbsp;the&nbsp;very&nbsp;reason&nbsp;about&nbsp;month&nbsp;ago,&nbsp;we&nbsp;first&nbsp;killed&nbsp;the&nbsp;rabbitmq&nbsp;processes.&nbsp;After&nbsp;that&nbsp;we&nbsp;thought&nbsp;&quot;maybe&nbsp;we&nbsp;corrupted&nbsp;mnesia&nbsp;with&nbsp;the&nbsp;kill,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;know&nbsp;why&nbsp;it&nbsp;hang&nbsp;for&nbsp;the&nbsp;first&nbsp;time&quot;.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Unfortunately&nbsp;as&nbsp;the&nbsp;computer&nbsp;is&nbsp;in&nbsp;a&nbsp;&quot;going&nbsp;down&nbsp;to&nbsp;reboot&quot;&nbsp;state,&nbsp;my&nbsp;only&nbsp;shell&nbsp;is&nbsp;the&nbsp;logged&nbsp;in&nbsp;one&nbsp;(one&nbsp;can&#39;t&nbsp;get&nbsp;a&nbsp;new&nbsp;connection&nbsp;while&nbsp;the&nbsp;system&nbsp;is&nbsp;going&nbsp;down)....&nbsp;but&nbsp;by&nbsp;starting&nbsp;sshd&nbsp;manually&nbsp;I&nbsp;can&nbsp;have&nbsp;this&nbsp;node&nbsp;powered&nbsp;up&nbsp;for&nbsp;a&nbsp;while.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Log&nbsp;files:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;the&nbsp;sasl&nbsp;log&nbsp;on&nbsp;node2&nbsp;is&nbsp;empty&nbsp;(yeeah)&lt;/div&gt;&lt;div&gt;shutdown_err&nbsp;and&nbsp;startup_err&nbsp;is&nbsp;empty&nbsp;(whoa)&lt;/div&gt;&lt;div&gt;startup_log&nbsp;is&nbsp;normal&lt;/div&gt;&lt;div&gt;shutdown_log &lt;/div&gt;&lt;div&gt;&quot;Stopping&nbsp;and&nbsp;halting&nbsp;node&nbsp;rabbit@node2&nbsp;...&lt;/div&gt;<br>
<br>
&lt;div&gt;&quot;&lt;/div&gt;&lt;div&gt;and&nbsp;it&nbsp;has&nbsp;the&nbsp;timestamp&nbsp;of&nbsp;the&nbsp;reboot&nbsp;command&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;node2.log:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&quot;=INFO&nbsp;REPORT====&nbsp;9-Apr-2014::00:42:31&nbsp;===&lt;/div&gt;&lt;div&gt;Stopping&nbsp;RabbitMQ&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;=INFO&nbsp;REPORT====&nbsp;9-Apr-2014::00:42:31&nbsp;===&lt;/div&gt;&lt;div&gt;stopped&nbsp;TCP&nbsp;Listener&nbsp;on&nbsp;[::]:5672&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;....a&nbsp;few&nbsp;closed&nbsp;connections....&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;=INFO&nbsp;REPORT====&nbsp;9-Apr-2014::00:42:32&nbsp;===&lt;/div&gt;<br>
<br>
&lt;div&gt;Halting&nbsp;Erlang&nbsp;VM&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&quot;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; so&nbsp;it&nbsp;looks&nbsp;like,&nbsp;that&nbsp;rabbitmq&nbsp;really&nbsp;exited&nbsp;25&nbsp;minutes&nbsp;ago,&nbsp;but&nbsp;the&nbsp;stop&nbsp;script&nbsp;won&#39;t&nbsp;exit,&nbsp;as&nbsp;the&nbsp;processes&nbsp;still&nbsp;running.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; Could&nbsp;the&nbsp;problem&nbsp;be&nbsp;the&nbsp;inet_gethost&nbsp;process?&nbsp;Unfortunately&nbsp;I&#39;ve&nbsp;seen&nbsp;dns&nbsp;problems&nbsp;in&nbsp;our&nbsp;networks,&nbsp;so&nbsp;that&nbsp;could&nbsp;be&nbsp;a&nbsp;problem,&nbsp;but&nbsp;that&nbsp;should&nbsp;not&nbsp;hang&nbsp;the&nbsp;shutdown.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt; The&nbsp;running&nbsp;rabbit&nbsp;processes&nbsp;and&nbsp;their&nbsp;open&nbsp;files&nbsp;are&nbsp;here:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &lt;a&nbsp;href=&quot;http://pastebin.com/mLKf5mEu&quot;&gt;http://pastebin.com/mLKf5mEu&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
&lt;div&gt;root@node2:~#&nbsp;pstree&lt;/div&gt;&lt;div&gt;init─┬─dbus-daemon&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; ├─epmd&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; ├─rabbitmq-server───beam.smp───38*[{beam.smp}]&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; ├─rc───K20rabbitmq-ser───rabbitmqctl───su───sh───beam.smp─┬─inet_gethost───inet_gethost&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; │&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;└─18*[{beam.smp}]&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;I&#39;m&nbsp;looking&nbsp;to&nbsp;find&nbsp;the&nbsp;hangup&nbsp;process...&nbsp;straceing&nbsp;and&nbsp;killing&nbsp;them.&lt;/div&gt;&lt;div&gt;The&nbsp;first&nbsp;try&nbsp;is&nbsp;the&nbsp;gethosts:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;root@node2:~#&nbsp;strace&nbsp;-p&nbsp;13612&lt;/div&gt;&lt;div&gt;Process&nbsp;13612&nbsp;attached&lt;/div&gt;&lt;div&gt;read(0, &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;....&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;^CProcess&nbsp;13612&nbsp;detached&lt;/div&gt;&lt;div&gt; &lt;detached&nbsp;...&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;root@node2:~#&nbsp;strace&nbsp;-p&nbsp;13611&lt;/div&gt;&lt;div&gt;Process&nbsp;13611&nbsp;attached&lt;/div&gt;&lt;div&gt;select(4,&nbsp;[0&nbsp;3],&nbsp;NULL,&nbsp;NULL,&nbsp;NULL&lt;/div&gt;&lt;div&gt;....&lt;/div&gt;&lt;div&gt;^CProcess&nbsp;13611&nbsp;detached&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;detached&nbsp;...&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;<br>
<br>
root@node2:~#&nbsp;kill&nbsp;13612&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;root@node2:~#&nbsp;kill&nbsp;13611&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;weee,&nbsp;after&nbsp;this&nbsp;second&nbsp;kill&nbsp;we&#39;ve&nbsp;got&nbsp;the&nbsp;inet_gethost&nbsp;respawned,&nbsp;so&nbsp;the&nbsp;beam.smp&nbsp;(pid&nbsp;13579)&nbsp;still&nbsp;works&nbsp;(but&nbsp;it&nbsp;should&nbsp;have&nbsp;already&nbsp;quit&nbsp;:)&nbsp;)&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;know&nbsp;that&nbsp;some&nbsp;from&nbsp;these&nbsp;are&nbsp;waiting:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;├─rc(13415)───K20rabbitmq-ser(13513)───rabbitmqctl(13568)───su(13577)───sh(13578)───beam.smp(13579)─┬─inet_gethost(16346)&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;│&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;├─{beam.smp}(13591)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;│&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;├─{beam.smp}(13592)&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;│&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;├─{beam.smp}(13593)&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; │&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;└─{beam.smp}(13608)&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; Any&nbsp;ideas?&nbsp;How&nbsp;can&nbsp;I&nbsp;debug&nbsp;this? &lt;/div&gt;&lt;div&gt; Specific&nbsp;questions? &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; I&nbsp;will&nbsp;leave&nbsp;this&nbsp;system&nbsp;in&nbsp;this&nbsp;state&nbsp;for&nbsp;now,&nbsp;to&nbsp;allow&nbsp;us&nbsp;to&nbsp;diagnose&nbsp;the&nbsp;situation.&nbsp;Unfortunately&nbsp;I&nbsp;don&#39;t&nbsp;know&nbsp;erlang,&nbsp;but&nbsp;I&nbsp;can&nbsp;try&nbsp;anything&nbsp;if&nbsp;I&nbsp;can&nbsp;help&nbsp;solve&nbsp;these&nbsp;hangups.&nbsp;As&nbsp;I&#39;ve&nbsp;said&nbsp;this&nbsp;is&nbsp;the&nbsp;same&nbsp;behaviour&nbsp;as&nbsp;3.1.3,&nbsp;3.2.2,&nbsp;3.2.3&nbsp;and&nbsp;so&nbsp;on&nbsp;worked,&nbsp;they&nbsp;sometimes&nbsp;just&nbsp;hung,&nbsp;then&nbsp;we&nbsp;killed&nbsp;them&nbsp;and&nbsp;had&nbsp;that&nbsp;bad&nbsp;feeling&nbsp;in&nbsp;our&nbsp;hearts,&nbsp;that&nbsp;we&nbsp;may&nbsp;broke&nbsp;the&nbsp;db.&nbsp;I&nbsp;won&#39;t&nbsp;kill&nbsp;this&nbsp;time.&nbsp;:)&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; If&nbsp;you&nbsp;can&nbsp;&quot;remote&nbsp;control&quot;&nbsp;me,&nbsp;I&nbsp;may&nbsp;even&nbsp;try&nbsp;to&nbsp;erlang&nbsp;debug&nbsp;the&nbsp;processes,&nbsp;to&nbsp;guess&nbsp;what&nbsp;they&#39;re&nbsp;waiting&nbsp;for.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;help,&nbsp;I&nbsp;hope&nbsp;these&nbsp;hangups&nbsp;could&nbsp;get&nbsp;eliminated. &lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; Have&nbsp;a&nbsp;nice&nbsp;day,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; Peter&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
