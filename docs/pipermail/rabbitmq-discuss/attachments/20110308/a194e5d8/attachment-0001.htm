<tt>
&lt;table&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&nbsp;border=&quot;0&quot;&nbsp;&gt;&lt;tr&gt;&lt;td&nbsp;valign=&quot;top&quot;&nbsp;style=&quot;font:&nbsp;inherit;&quot;&gt;&lt;DIV&gt;Good&nbsp;evening.&lt;/DIV&gt;<br>
&lt;DIV&gt;After&nbsp;consuming&nbsp;few&nbsp;published&nbsp;messages,&nbsp;if&nbsp;I&nbsp;bring&nbsp;down&nbsp;the&nbsp;RabbitMQ&nbsp;broker&nbsp;(hard&nbsp;failure)&nbsp;and&nbsp;bring&nbsp;it&nbsp;back,&nbsp;the&nbsp;number&nbsp;of&nbsp;messages&nbsp;saved&nbsp;to&nbsp;queue&nbsp;is&nbsp;incorrect.&lt;/DIV&gt;<br>
&lt;DIV&gt;For&nbsp;example,&nbsp;I&nbsp;publish&nbsp;100&nbsp;messages.&nbsp;After&nbsp;consuming&nbsp;10&nbsp;messages,&nbsp;I&nbsp;bring&nbsp;down&nbsp;the&nbsp;broker&nbsp;and&nbsp;bring&nbsp;it&nbsp;back.&nbsp;Run:&nbsp;rabbitmqctl&nbsp;list_queues&nbsp;messages_ready,&nbsp;I&nbsp;see&nbsp;the&nbsp;count&nbsp;of&nbsp;messages_ready&nbsp;as&nbsp;100&nbsp;instead&nbsp;of&nbsp;90.&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;Could&nbsp;you&nbsp;please&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;there&nbsp;is&amp;nbsp;anything&nbsp;wrong&nbsp;with&nbsp;the&nbsp;following&nbsp;Producer&nbsp;and&nbsp;consumer&nbsp;code:&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;Thanks&lt;/DIV&gt;<br>
&lt;DIV&gt;Venkat&lt;/DIV&gt;<br>
&lt;DIV&gt;===========================&lt;/DIV&gt;<br>
&lt;DIV&gt;TestProducer.java&lt;/DIV&gt;<br>
&lt;DIV&gt;-------------------------&lt;/DIV&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;<br>
&lt;P&nbsp;align=left&gt;public&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;class&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;TestProducer&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;public&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;static&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;void&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;main(String[]&nbsp;args)&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;for&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;(&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;int&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;i=0;&nbsp;i&nbsp;&amp;lt;&nbsp;100;&nbsp;i++)&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;String&nbsp;msg&nbsp;=&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;M&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;+&nbsp;i;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;try&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;RabbitMQProducer.&lt;/FONT&gt;&lt;I&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;INSTANCE&lt;/I&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;.run(msg);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;catch&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;(Exception&nbsp;e)&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;System.&lt;/FONT&gt;&lt;I&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;out&lt;/I&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;.println(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;exception&nbsp;occurred&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;break&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;=============================================================&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;RabbitMQProducer.java:&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;--------------------------------&lt;/DIV&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;<br>
&lt;P&nbsp;align=left&gt;public&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;class&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;RabbitMQProducer&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;public&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;static&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;final&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;RabbitMQProducer&nbsp;&lt;/FONT&gt;&lt;I&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;INSTANCE&lt;/I&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;=&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;new&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;RabbitMQProducer();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;private&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;RabbitMQProducer()&nbsp;{}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;public&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;void&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;run(String&nbsp;msg)&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;String&nbsp;hostName&nbsp;=&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;localhost&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;String&nbsp;port&nbsp;=&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;5672&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;int&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;portNumber&nbsp;=&nbsp;Integer.&lt;I&gt;valueOf&lt;/I&gt;(port);;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;Connection&nbsp;conn&nbsp;=&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;null&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;try&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;ConnectionFactory&nbsp;cf&nbsp;=&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;new&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;ConnectionFactory();&nbsp;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;cf.setHost(hostName);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;cf.setPort(portNumber);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;cf.setUsername(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;guest&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;cf.setPassword(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;guest&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;conn&nbsp;=&nbsp;cf.newConnection();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;Channel&nbsp;ch&nbsp;=&nbsp;conn.createChannel();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;ch.exchangeDeclare(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;mdb.testq.exchange&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;topic&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;true&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;ch.queueDeclare(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;mdb.testq.queue&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;true&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;false&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;false&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;null&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;ch.txSelect();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;ch.basicPublish(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;mdb.testq.exchange&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;mdb.testq.queue&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;MessageProperties.&lt;/FONT&gt;&lt;I&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;PERSISTENT_BASIC&lt;/I&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;msg.getBytes());&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;ch.txCommit();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;ch.close();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;conn.close();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;catch&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;(IOException&nbsp;e)&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;e.printStackTrace();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;=================================================================&lt;/DIV&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;<br>
&lt;P&nbsp;align=left&gt;public&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;class&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;RabbitConsumer&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;private&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;int&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;count&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;=&nbsp;0;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;private&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;void&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;runConsumer()&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;Connection&nbsp;conn&nbsp;=&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;null&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;try&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;String&nbsp;hostName&nbsp;=&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;localhost&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;String&nbsp;port&nbsp;=&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;5672&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;int&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;portNumber&nbsp;=&nbsp;Integer.&lt;I&gt;valueOf&lt;/I&gt;(port);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;ConnectionFactory&nbsp;cf&nbsp;=&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;new&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;ConnectionFactory();&nbsp;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;cf.setHost(hostName);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;cf.setPort(portNumber);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;cf.setUsername(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;guest&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;cf.setPassword(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;guest&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;conn&nbsp;=&nbsp;cf.newConnection();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;Channel&nbsp;channel&nbsp;=&nbsp;conn.createChannel();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;channel.exchangeDeclare(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;mdb.testq.exchange&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;topic&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;true&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;channel.queueBind(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;mdb.testq.queue&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;mdb.testq.exchange&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;#&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;Consumer&nbsp;consumer&nbsp;=&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;new&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;QueueingConsumer(channel);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;channel.basicQos(1);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;channel.basicConsume(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;mdb.testq.queue&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;false&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;,&nbsp;consumer);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;boolean&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;running&nbsp;=&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;true&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;while&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;(running)&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;QueueingConsumer.Delivery&nbsp;delivery;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;try&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;delivery&nbsp;=&nbsp;((QueueingConsumer)&nbsp;consumer).nextDelivery();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;U&gt;Thread.&lt;I&gt;currentThread&lt;/I&gt;().&lt;I&gt;sleep&lt;/I&gt;(500)&lt;/U&gt;;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;count&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;++;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;System.&lt;/FONT&gt;&lt;I&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;out&lt;/I&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;.println(&lt;/FONT&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&lt;FONT&nbsp;color=#2a00ff&nbsp;size=2&gt;&quot;count:&nbsp;&quot;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;+&lt;/FONT&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;&lt;FONT&nbsp;color=#0000c0&nbsp;size=2&gt;count&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;channel.basicAck(delivery.getEnvelope().getDeliveryTag(),&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;false&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;);&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;catch&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;(Exception&nbsp;e)&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;e.printStackTrace();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;break&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&nbsp;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;catch&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;(IOException&nbsp;e)&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;e.printStackTrace();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;public&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;static&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;void&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;main(String[]&nbsp;args)&nbsp;{&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;RabbitConsumer&nbsp;rc&nbsp;=&nbsp;&lt;/FONT&gt;&lt;B&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;&lt;FONT&nbsp;color=#7f0055&nbsp;size=2&gt;new&lt;/B&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;size=2&gt;&nbsp;RabbitConsumer();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;rc.runConsumer();&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;<br>
&lt;P&nbsp;align=left&gt;}&lt;/DIV&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;br&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</tt>
