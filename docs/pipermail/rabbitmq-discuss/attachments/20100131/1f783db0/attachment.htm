<tt>
Hi,&lt;br&gt;&lt;br&gt;I&nbsp;am&nbsp;curious&nbsp;if&nbsp;anyone&nbsp;on&nbsp;the&nbsp;rabbitmq&nbsp;team&nbsp;can&nbsp;confirm/clarify&nbsp;what&nbsp;we&nbsp;are&nbsp;seeing&nbsp;with&nbsp;respect&nbsp;to&nbsp;some&nbsp;throughput&nbsp;issues&nbsp;on&nbsp;our&nbsp;RMQ&nbsp;cluster.&lt;br&gt;&lt;br&gt;The&nbsp;config:&lt;br&gt;-&nbsp;2-node&nbsp;RMQ&nbsp;cluster,&nbsp;running&nbsp;a&nbsp;topic-based&nbsp;exchange&lt;br&gt;<br>
<br>
<br>
-&nbsp;8&nbsp;publishers,&nbsp;running&nbsp;on&nbsp;different&nbsp;hosts&lt;br&gt;-&nbsp;dozens&nbsp;of&nbsp;consumers,&nbsp;~75&nbsp;wildcard&nbsp;topic&nbsp;bindings,&nbsp;mostly&nbsp;running&nbsp;on&nbsp;different&nbsp;hosts&nbsp;(there&nbsp;are&nbsp;a&nbsp;couple&nbsp;running&nbsp;on&nbsp;the&nbsp;RMQ&nbsp;hosts&nbsp;for&nbsp;stats,&nbsp;etc)&lt;br&gt;&lt;br&gt;The&nbsp;issue:&lt;br&gt;When&nbsp;we&nbsp;publish&nbsp;at&nbsp;a&nbsp;higher&nbsp;rate&nbsp;than&nbsp;normal,&nbsp;there&nbsp;appears&nbsp;to&nbsp;be&nbsp;a&nbsp;significant&nbsp;delay&nbsp;in&nbsp;the&nbsp;pipeline&nbsp;between&nbsp;when&nbsp;we&nbsp;publish&nbsp;the&nbsp;messages&nbsp;and&nbsp;when&nbsp;we&nbsp;receive&nbsp;them&nbsp;on&nbsp;the&nbsp;consuming&nbsp;side. &nbsp;Since&nbsp;publishing&nbsp;is&nbsp;asynchronous,&nbsp;the&nbsp;publisher&nbsp;applications&nbsp;send&nbsp;as&nbsp;fast&nbsp;as&nbsp;they&nbsp;can,&nbsp;meanwhile&nbsp;we&nbsp;see&nbsp;an&nbsp;increasing&nbsp;delay&nbsp;in&nbsp;when&nbsp;we&nbsp;see&nbsp;those&nbsp;same&nbsp;messages&nbsp;come&nbsp;out&nbsp;on&nbsp;the&nbsp;other&nbsp;side. &nbsp;My&nbsp;guess&nbsp;(gathered&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/faq.html#node-per-CPU-core&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.rabbitmq.com/faq.html#node-per-CPU-core&lt;/a&gt;)&nbsp;is&nbsp;that&nbsp;there&nbsp;is&nbsp;either&nbsp;a&nbsp;single&nbsp;routing&nbsp;thread&nbsp;per&nbsp;publisher&nbsp;(channel),&nbsp;or&nbsp;even&nbsp;worse&nbsp;a&nbsp;single&nbsp;routing&nbsp;bottleneck&nbsp;per&nbsp;node. &nbsp;Either&nbsp;way,&nbsp;this&nbsp;thread&nbsp;cannot&nbsp;route&nbsp;fast&nbsp;enough&nbsp;in&nbsp;a&nbsp;topic&nbsp;exchange&nbsp;(we&nbsp;have&nbsp;about&nbsp;75&nbsp;bindings,&nbsp;using&nbsp;wildcards)&nbsp;and&nbsp;there&nbsp;is&nbsp;a&nbsp;backup&nbsp;of&nbsp;messages&nbsp;to&nbsp;be&nbsp;routed.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;This&nbsp;is&nbsp;dangerous&nbsp;and&nbsp;hard&nbsp;to&nbsp;control,&nbsp;since&nbsp;we&nbsp;have&nbsp;seen&nbsp;memory&nbsp;grow&nbsp;in&nbsp;such&nbsp;a&nbsp;way&nbsp;that&nbsp;we&nbsp;have&nbsp;a&nbsp;hard&nbsp;time&nbsp;stopping&nbsp;it. &nbsp;In&nbsp;certain&nbsp;failure&nbsp;modes,&nbsp;when&nbsp;the&nbsp;publisher&nbsp;disconnects,&nbsp;all&nbsp;of&nbsp;the&nbsp;messages&nbsp;pending&nbsp;to&nbsp;be&nbsp;routed&nbsp;are&nbsp;discarded&nbsp;-&nbsp;possibly&nbsp;hours&nbsp;of&nbsp;data&nbsp;in&nbsp;our&nbsp;environment. &nbsp;It&nbsp;also&nbsp;limits&nbsp;the&nbsp;scaling&nbsp;we&amp;#39;ve&nbsp;been&nbsp;able&nbsp;to&nbsp;do,&nbsp;since&nbsp;if&nbsp;we&nbsp;fire&nbsp;up&nbsp;all&nbsp;8&nbsp;publishers&nbsp;at&nbsp;high&nbsp;volume,&nbsp;this&nbsp;backup&nbsp;problem&nbsp;spreads&nbsp;across&nbsp;all&nbsp;streams.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;The&nbsp;question:&lt;br&gt;Can&nbsp;you&nbsp;please&nbsp;elaborate&nbsp;on&nbsp;where&nbsp;the&nbsp;routing&nbsp;backup&nbsp;could&nbsp;be&nbsp;occurring,&nbsp;and&nbsp;what&nbsp;steps&nbsp;might&nbsp;be&nbsp;best&nbsp;to&nbsp;prevent&nbsp;this&nbsp;from&nbsp;happening? &nbsp;It&nbsp;appears&nbsp;from&nbsp;the&nbsp;fact&nbsp;that&nbsp;I&nbsp;am&nbsp;waiting&nbsp;on&nbsp;the&nbsp;routing&nbsp;to&nbsp;happen&nbsp;that&nbsp;using&nbsp;flags&nbsp;like&nbsp;&amp;quot;mandatory&amp;quot;&nbsp;on&nbsp;messages&nbsp;is&nbsp;not&nbsp;going&nbsp;to&nbsp;help&nbsp;me&nbsp;here&nbsp;(though&nbsp;I&nbsp;have&nbsp;not&nbsp;tested&nbsp;this).&lt;br&gt;<br>
<br>
&lt;br&gt;One&nbsp;idea:&lt;br&gt;If&nbsp;it&nbsp;is&nbsp;truly&nbsp;the&nbsp;case&nbsp;that&nbsp;a&nbsp;single&nbsp;thread&nbsp;per&nbsp;node&nbsp;might&nbsp;be&nbsp;causing&nbsp;this&nbsp;problem,&nbsp;then&nbsp;perhaps&nbsp;we&nbsp;can&nbsp;run&nbsp;a&nbsp;small&nbsp;rabbitmq&nbsp;node&nbsp;on&nbsp;each&nbsp;publisher&nbsp;(joined&nbsp;to&nbsp;the&nbsp;cluster),&nbsp;with&nbsp;the&nbsp;sole&nbsp;purpose&nbsp;of&nbsp;doing&nbsp;the&nbsp;routing&nbsp;load? &nbsp;If&nbsp;we&nbsp;publish&nbsp;locally,&nbsp;all&nbsp;it&nbsp;would&nbsp;need&nbsp;to&nbsp;do&nbsp;is&nbsp;keep&nbsp;up&nbsp;with&nbsp;it&amp;#39;s&nbsp;own&nbsp;routing&nbsp;load,&nbsp;not&nbsp;the&nbsp;combine&nbsp;routing&nbsp;load&nbsp;of&nbsp;3&nbsp;other&nbsp;publishers. &nbsp;It&nbsp;doesn&amp;#39;t&nbsp;really&nbsp;prevent&nbsp;the&nbsp;problem&nbsp;from&nbsp;happening&nbsp;though,&nbsp;if&nbsp;I&nbsp;can&nbsp;produce&nbsp;messages&nbsp;faster&nbsp;in&nbsp;a&nbsp;single&nbsp;thread&nbsp;than&nbsp;even&nbsp;a&nbsp;dedicated&nbsp;node&nbsp;can&nbsp;route. &nbsp;Would&nbsp;this&nbsp;even&nbsp;help?&lt;br&gt;<br>
<br>
&lt;br&gt;Thanks,&lt;br&gt;Brian&lt;br&gt;&lt;br&gt;<br>

</tt>
