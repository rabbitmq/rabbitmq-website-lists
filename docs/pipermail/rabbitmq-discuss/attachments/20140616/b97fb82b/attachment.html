<tt>
&lt;html&gt;&lt;head&gt;&lt;style&gt;body{font-family:Helvetica,Arial;font-size:13px}&lt;/style&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;I’ve&nbsp;been&nbsp;running&nbsp;into&nbsp;a&nbsp;weird&nbsp;issue&nbsp;with&nbsp;the&nbsp;pgsql_listen_exchange&nbsp;plugin&nbsp;code&nbsp;that&nbsp;I’ve&nbsp;been&nbsp;trying&nbsp;to&nbsp;fix.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;start&nbsp;a&nbsp;fresh&nbsp;RabbitMQ&nbsp;install&nbsp;with&nbsp;an&nbsp;empty&nbsp;database&nbsp;and&nbsp;the&nbsp;plugin&nbsp;enabled,&nbsp;it&nbsp;will&nbsp;exit&nbsp;due&nbsp;to&nbsp;a&nbsp;no_such_vhost&nbsp;error&nbsp;for&nbsp;&lt;&lt;“/“&gt;&gt;&nbsp;in&nbsp;the&nbsp;rabbit_error_log&nbsp;module&nbsp;start/0.&nbsp;Logs:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://gist.github.com/gmr/b29e672db7d4423defd1&quot;&gt;https://gist.github.com/gmr/b29e672db7d4423defd1&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;is&nbsp;odd&nbsp;about&nbsp;it,&nbsp;is&nbsp;if&nbsp;the&nbsp;database&nbsp;is&nbsp;not&nbsp;empty,&nbsp;that&nbsp;is&nbsp;rabbitmq&nbsp;is&nbsp;started&nbsp;before&nbsp;enabling&nbsp;the&nbsp;plugin,&nbsp;everything&nbsp;works&nbsp;just&nbsp;fine.&nbsp;This&nbsp;seems&nbsp;to&nbsp;be&nbsp;consistent&nbsp;with&nbsp;the&nbsp;default&nbsp;branch&nbsp;as&nbsp;well&nbsp;as&nbsp;with&nbsp;3.3.0+.&nbsp;I’ve&nbsp;not&nbsp;tried&nbsp;earlier&nbsp;versions&nbsp;of&nbsp;RabbitMQ.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;seems&nbsp;it&nbsp;probably&nbsp;has&nbsp;something&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;rabbit_boot_step&nbsp;ordering&nbsp;of&nbsp;my&nbsp;plugin&nbsp;combined&nbsp;with&nbsp;some&nbsp;logging&nbsp;somewhere&nbsp;in&nbsp;combination&nbsp;to&nbsp;the&nbsp;initial&nbsp;creation&nbsp;of&nbsp;the&nbsp;rabbitmq&nbsp;mnesia&nbsp;database,&nbsp;but&nbsp;I’m&nbsp;at&nbsp;a&nbsp;loss&nbsp;as&nbsp;to&nbsp;what’s&nbsp;going&nbsp;on&nbsp;beyond&nbsp;that.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;I&nbsp;change&nbsp;the&nbsp;plugin&nbsp;to&nbsp;run&nbsp;later&nbsp;in&nbsp;the&nbsp;boot&nbsp;step&nbsp;ordering&nbsp;(i.e.&nbsp;have&nbsp;in&nbsp;come&nbsp;in&nbsp;after&nbsp;recover),&nbsp;it&nbsp;works&nbsp;fine&nbsp;for&nbsp;the&nbsp;initial&nbsp;load,&nbsp;but&nbsp;then&nbsp;if&nbsp;I&nbsp;declare&nbsp;an&nbsp;exchange,&nbsp;it&nbsp;is&nbsp;not&nbsp;loaded&nbsp;soon&nbsp;enough&nbsp;to&nbsp;be&nbsp;there&nbsp;for&nbsp;the&nbsp;exchange&nbsp;to&nbsp;be&nbsp;recovered&nbsp;on&nbsp;boot.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;From&nbsp;digging&nbsp;through&nbsp;pretty&nbsp;much&nbsp;everything&nbsp;I&nbsp;could&nbsp;find&nbsp;with&nbsp;boot&nbsp;steps,&nbsp;it&nbsp;seems&nbsp;that&nbsp;I&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;require&nbsp;rabbit_registry&nbsp;and&nbsp;enable&nbsp;recover&nbsp;for&nbsp;the&nbsp;proper&nbsp;behavior.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;also&nbsp;have&nbsp;two&nbsp;other&nbsp;modules&nbsp;with&nbsp;boot&nbsp;steps,&nbsp;one&nbsp;is&nbsp;a&nbsp;mirrored_supervisor&nbsp;that&nbsp;enables&nbsp;the&nbsp;exchange&nbsp;and&nbsp;requires&nbsp;kernel_ready&nbsp;and&nbsp;the&nbsp;other&nbsp;is&nbsp;a&nbsp;rabbit_policy_validator&nbsp;that&nbsp;requires&nbsp;rabbit_registry&nbsp;and&nbsp;enables&nbsp;recovery.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;pointers&nbsp;on&nbsp;how&nbsp;I&nbsp;can&nbsp;debug&nbsp;what&nbsp;condition&nbsp;my&nbsp;plugin&nbsp;is&nbsp;creating&nbsp;to&nbsp;cause&nbsp;this&nbsp;failure&nbsp;would&nbsp;be&nbsp;greatly&nbsp;appreciated.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Gavin&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
