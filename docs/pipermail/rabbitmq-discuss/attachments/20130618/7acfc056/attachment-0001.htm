<tt>
Hi,&amp;nbsp;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;just&nbsp;wanted&nbsp;to&nbsp;mention&nbsp;that&nbsp;we&nbsp;are&nbsp;seeing&nbsp;the&nbsp;same&nbsp;behavior,&nbsp;but&nbsp;we&nbsp;don't&nbsp;have&nbsp;any&nbsp;mirrored&nbsp;queues.&nbsp;We&nbsp;have&nbsp;had&nbsp;to&nbsp;disable&nbsp;the&nbsp;management&nbsp;interface&nbsp;and&nbsp;the&nbsp;memory&nbsp;usage&nbsp;gradually&nbsp;dropped.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;are&nbsp;using&nbsp;3.1.1&nbsp;on&nbsp;R13B04&nbsp;on&nbsp;some&nbsp;machines,&nbsp;and&nbsp;a&nbsp;few&nbsp;others&nbsp;with&nbsp;Erlang&nbsp;R16B.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;looked&nbsp;into&nbsp;the&nbsp;code,&nbsp;and&nbsp;it&nbsp;creates&nbsp;some&nbsp;ets&nbsp;tables&nbsp;in&nbsp;the&nbsp;rabbit_mgmt_db&nbsp;module.&nbsp;The&nbsp;first&nbsp;snippet&nbsp;is&nbsp;memory&nbsp;usage&nbsp;with&nbsp;the&nbsp;management&nbsp;plugin:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp;{memory,&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;[{total,1417822136},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{connection_procs,37788152},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{queue_procs,6659896},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{plugins,686592},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{other_proc,11236576},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{mnesia,855184},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{mgmt_db,935311000},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{msg_index,7976224},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{other_ets,70559680},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{binary,13529704},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{code,19001963},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{atom,1601817},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{other_system,312615348}]},&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;second&nbsp;snippet&nbsp;is&nbsp;after&nbsp;disabling&nbsp;the&nbsp;management&nbsp;plugin&nbsp;and&nbsp;restarting&nbsp;one&nbsp;of&nbsp;the&nbsp;nodes:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;[{total,190412936},&lt;/blockquote&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&nbsp;{memory,&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{connection_procs,34512200},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{queue_procs,8970352},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{plugins,0},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{other_proc,9246776},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mnesia,794776},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mgmt_db,0},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{msg_index,1650736},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{other_ets,6406656},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{binary,63363448},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{code,16232973},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{atom,594537},&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{other_system,48640482}]}&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You'll&nbsp;notice&nbsp;that&nbsp;the&nbsp;memory&nbsp;used&nbsp;by&nbsp;mgmt_db&nbsp;is&nbsp;not&nbsp;0&nbsp;and&nbsp;other_system&nbsp;is&nbsp;around&nbsp;48MB,&nbsp;while&nbsp;before&nbsp;mgmt_db&nbsp;was&nbsp;over&nbsp;935MB,&nbsp;and&nbsp;other_system&nbsp;over&nbsp;300MB.&nbsp;Unfortunately,&nbsp;I&nbsp;don't&nbsp;have&nbsp;any&nbsp;growth&nbsp;trends&nbsp;for&nbsp;the&nbsp;DB&nbsp;size&nbsp;as&nbsp;we&nbsp;have&nbsp;had&nbsp;to&nbsp;disable&nbsp;management&nbsp;on&nbsp;all&nbsp;nodes&nbsp;and&nbsp;we&nbsp;weren't&nbsp;tracking&nbsp;this&nbsp;memory&nbsp;usage.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;not&nbsp;very&nbsp;familiar&nbsp;with&nbsp;RabbitMQ,&nbsp;but&nbsp;if&nbsp;I&nbsp;have&nbsp;some&nbsp;time&nbsp;I&nbsp;will&nbsp;try&nbsp;and&nbsp;dig&nbsp;more&nbsp;deeply&nbsp;into&nbsp;it&nbsp;and&nbsp;run&nbsp;some&nbsp;tests.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;Joe&lt;/div&gt;&lt;div&gt;&lt;br&gt;On&nbsp;Saturday,&nbsp;June&nbsp;15,&nbsp;2013&nbsp;10:09:21&nbsp;AM&nbsp;UTC+8,&nbsp;Travis&nbsp;Mehlinger&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;We&nbsp;recently&nbsp;upgraded&nbsp;RabbitMQ&nbsp;from&nbsp;3.0.4&nbsp;to&nbsp;3.1.1&nbsp;after&nbsp;noticing&nbsp;two&nbsp;bug&nbsp;fixes&nbsp;in&nbsp;3.1.0&nbsp;related&nbsp;to&nbsp;our&nbsp;RabbitMQ&nbsp;deployment:&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);white-space:pre-wrap&quot;&gt;25524&nbsp;fix&nbsp;memory&nbsp;leak&nbsp;in&nbsp;mirror&nbsp;queue&nbsp;slave&nbsp;with&nbsp;many&nbsp;short-lived&nbsp;publishing&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);white-space:pre-wrap&quot;&gt;channel&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal;white-space:pre-wrap;color:rgb(0,0,0)&quot;&gt;25290&nbsp;fix&nbsp;per-queue&nbsp;memory&nbsp;leak&nbsp;recording&nbsp;stats&nbsp;for&nbsp;mirror&nbsp;queue&nbsp;slaves&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;However,&nbsp;in&nbsp;our&nbsp;case,&nbsp;it&nbsp;seems&nbsp;that&nbsp;the&nbsp;management&nbsp;plugin&nbsp;may&nbsp;still&nbsp;have&nbsp;a&nbsp;memory&nbsp;leak.&nbsp;We&nbsp;have&nbsp;a&nbsp;monitoring&nbsp;agent&nbsp;that&nbsp;hits&nbsp;the&nbsp;REST&nbsp;API&nbsp;to&nbsp;gather&nbsp;information&nbsp;about&nbsp;the&nbsp;broker&nbsp;(number&nbsp;of&nbsp;queues,&nbsp;queue&nbsp;depth,&nbsp;etc.).&nbsp;With&nbsp;the&nbsp;monitoring&nbsp;agent&nbsp;running&nbsp;and&nbsp;making&nbsp;requests&nbsp;against&nbsp;the&nbsp;API,&nbsp;memory&nbsp;consumption&nbsp;steadily&nbsp;increased;&nbsp;when&nbsp;we&nbsp;stopped&nbsp;the&nbsp;agent,&nbsp;memory&nbsp;consumption&nbsp;in&nbsp;the&nbsp;management&nbsp;plugin&nbsp;leveled&nbsp;off.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;a&nbsp;couple&nbsp;graphs&nbsp;detailing&nbsp;memory&nbsp;consumption&nbsp;in&nbsp;the&nbsp;broker&nbsp;(the&nbsp;figures&nbsp;are&nbsp;parsed&nbsp;from&nbsp;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;rabbitmqctl&nbsp;report&lt;/font&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;).&nbsp;The&nbsp;first&nbsp;graph&nbsp;shows&nbsp;the&nbsp;ebb&nbsp;and&nbsp;flow&nbsp;of&nbsp;memory&nbsp;consumption&nbsp;in&nbsp;a&nbsp;number&nbsp;of&nbsp;components&nbsp;and&nbsp;the&nbsp;second&nbsp;shows&nbsp;just&nbsp;consumption&nbsp;by&nbsp;the&nbsp;management&nbsp;plugin.&nbsp;You&nbsp;can&nbsp;see&nbsp;pretty&nbsp;clearly&nbsp;where&nbsp;we&nbsp;stopped&nbsp;the&nbsp;monitoring&nbsp;agent&nbsp;at&nbsp;1:20.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;a&nbsp;href=&quot;https://dl.dropboxusercontent.com/u/7022167/Screenshots/n-np6obt-m9f.png&quot;&nbsp;target=&quot;_blank&quot;&gt;https://dl.dropboxusercontent.&lt;wbr&gt;com/u/7022167/Screenshots/n-&lt;wbr&gt;np6obt-m9f.png&lt;/a&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;a&nbsp;href=&quot;https://dl.dropboxusercontent.com/u/7022167/Screenshots/an6dpup33xvx.png&quot;&nbsp;target=&quot;_blank&quot;&gt;https://dl.dropboxusercontent.&lt;wbr&gt;com/u/7022167/Screenshots/&lt;wbr&gt;an6dpup33xvx.png&lt;/a&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;We&nbsp;have&nbsp;two&nbsp;clustered&nbsp;brokers,&nbsp;both&nbsp;running&nbsp;RabbitMQ&nbsp;3.1.1&nbsp;on&nbsp;Erlang&nbsp;R14B-04.1.&nbsp;There&nbsp;are&nbsp;typically&nbsp;around&nbsp;200&nbsp;queues,&nbsp;about&nbsp;20&nbsp;of&nbsp;which&nbsp;are&nbsp;mirrored.&nbsp;There&nbsp;are&nbsp;generally&nbsp;about&nbsp;200&nbsp;consumers.&nbsp;Messages&nbsp;are&nbsp;rarely&nbsp;queued&nbsp;and&nbsp;most&nbsp;queues&nbsp;typically&nbsp;sit&nbsp;idle.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;I'll&nbsp;be&nbsp;happy&nbsp;to&nbsp;provide&nbsp;any&nbsp;further&nbsp;diagnostic&nbsp;information.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Thanks!&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;
</tt>
