<tt>
&lt;div&gt;We&nbsp;run&nbsp;an&nbsp;API&nbsp;where&nbsp;each&nbsp;API&nbsp;call&nbsp;ends&nbsp;in&nbsp;RabbitMQ.&nbsp;Each&nbsp;project&nbsp;has&nbsp;its&nbsp;own&nbsp;queue&nbsp;with&nbsp;the&nbsp;idea&nbsp;that&nbsp;some&nbsp;customers&nbsp;are&nbsp;much&nbsp;bigger&nbsp;than&nbsp;others&nbsp;so&nbsp;&amp;nbsp;we&nbsp;can&nbsp;eventually&nbsp;have&nbsp;more&nbsp;workers&nbsp;dequeuing&nbsp;the&nbsp;queues&nbsp;of&nbsp;the&nbsp;largest&nbsp;customers.&nbsp;The&nbsp;end&nbsp;result&nbsp;is&nbsp;that&nbsp;we&nbsp;have&nbsp;4,500&nbsp;queues,&nbsp;where&nbsp;the&nbsp;majority&nbsp;are&nbsp;inactive&nbsp;while&nbsp;about&nbsp;a&nbsp;thousand&nbsp;are&nbsp;active&nbsp;and&nbsp;about&nbsp;20&nbsp;are&nbsp;very&nbsp;heavily&nbsp;used.&amp;nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We're&nbsp;using&nbsp;the&nbsp;node.js&nbsp;client&nbsp;node-amqp,&nbsp;and&nbsp;it&nbsp;currently&nbsp;creates&nbsp;a&nbsp;channel&nbsp;per&nbsp;queue&nbsp;(so&nbsp;a&nbsp;channel&nbsp;per&nbsp;subscription).&nbsp;That&nbsp;means&nbsp;each&nbsp;ingestion&nbsp;worker&nbsp;subscribes&nbsp;to&nbsp;4.5k&nbsp;queues,&nbsp;and&nbsp;the&nbsp;RabbitMQ&nbsp;server&nbsp;has&nbsp;to&nbsp;handle&nbsp;17k&nbsp;channels&nbsp;and&nbsp;subscriptions.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Because&nbsp;of&nbsp;node-amqp,&nbsp;an&nbsp;issue&nbsp;is&nbsp;that&nbsp;we&nbsp;can't&nbsp;use&nbsp;prefetchCount&nbsp;since&nbsp;its&nbsp;on&nbsp;a&nbsp;subscription&nbsp;level&nbsp;rather&nbsp;on&nbsp;a&nbsp;worker&nbsp;level.&nbsp;The&nbsp;other&nbsp;issue&nbsp;is&nbsp;we're&nbsp;seeing&nbsp;a&nbsp;very&nbsp;high&nbsp;memory&nbsp;use&nbsp;on&nbsp;the&nbsp;server,&nbsp;even&nbsp;when&nbsp;all&nbsp;messages&nbsp;are&nbsp;happily&nbsp;going&nbsp;through&nbsp;the&nbsp;queues&nbsp;and&nbsp;being&nbsp;ack'd:&nbsp;5GB&nbsp;memory&nbsp;without&nbsp;any&nbsp;active&nbsp;messages.&nbsp;It&nbsp;looks&nbsp;like&nbsp;having&nbsp;so&nbsp;many&nbsp;channels&nbsp;and&nbsp;queues&nbsp;are&nbsp;eating&nbsp;up&nbsp;all&nbsp;the&nbsp;memory:&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;few&nbsp;questions:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;What&nbsp;is&nbsp;a&nbsp;recommended&nbsp;amount&nbsp;of&nbsp;subscriptions&nbsp;per&nbsp;channel?&lt;/div&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;Should&nbsp;we&nbsp;avoid&nbsp;having&nbsp;so&nbsp;many&nbsp;queues?&nbsp;(one&nbsp;queue&nbsp;per&nbsp;project&nbsp;design)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;
</tt>
