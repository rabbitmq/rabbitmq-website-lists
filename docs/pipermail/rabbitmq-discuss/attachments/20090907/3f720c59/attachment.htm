<tt>
I&nbsp;almost&nbsp;feel&nbsp;as&nbsp;though&nbsp;rabbitmq&nbsp;can&amp;#39;t&nbsp;push&nbsp;items&nbsp;to&nbsp;my&nbsp;consumer&nbsp;fast&nbsp;enough,&nbsp;I&nbsp;had&nbsp;a&nbsp;backed&nbsp;up&nbsp;queue&nbsp;with&nbsp;20&nbsp;consumers&nbsp;and&nbsp;spawned&nbsp;another&nbsp;watching&nbsp;the&nbsp;items&nbsp;get&nbsp;processed&nbsp;and&nbsp;it&nbsp;just&nbsp;seemed&nbsp;so&nbsp;slow,&nbsp;saw&nbsp;numerous&nbsp;pauses&nbsp;between&nbsp;item&nbsp;processing&nbsp;and&nbsp;I&nbsp;don&amp;#39;t&nbsp;believe&nbsp;it&nbsp;is&nbsp;the&nbsp;consumer&amp;#39;s&nbsp;fault.&lt;div&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;using&nbsp;the&nbsp;Python&nbsp;library&nbsp;for&nbsp;the&nbsp;consumer&nbsp;part.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Suhail&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Sep&nbsp;7,&nbsp;2009&nbsp;at&nbsp;8:23&nbsp;AM,&nbsp;Chuck&nbsp;Remes&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:cremes.devlist@mac.com&quot;&gt;cremes.devlist@mac.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
On&nbsp;Sep&nbsp;7,&nbsp;2009,&nbsp;at&nbsp;1:07&nbsp;AM,&nbsp;aisha&nbsp;fenton&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;Hi,&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;m&nbsp;sure&nbsp;I&amp;#39;m&nbsp;doing&nbsp;something&nbsp;wrong&nbsp;since&nbsp;I&nbsp;can&amp;#39;t&nbsp;find&nbsp;reference&nbsp;to&lt;br&gt;<br>
&amp;gt;&nbsp;this&nbsp;anywhere&nbsp;else.&nbsp;What&nbsp;I&amp;#39;m&nbsp;seeing&nbsp;is&nbsp;that&nbsp;the&nbsp;performance&nbsp;of&lt;br&gt;<br>
&amp;gt;&nbsp;draining&nbsp;a&nbsp;queue&nbsp;gets&nbsp;slower&nbsp;as&nbsp;the&nbsp;queue&nbsp;size&nbsp;increases.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;m&nbsp;aware&nbsp;of&nbsp;the&nbsp;issue&nbsp;in&nbsp;RabbitMQ&nbsp;1.6&nbsp;that&nbsp;means&nbsp;that&nbsp;when&nbsp;it&nbsp;runs&lt;br&gt;<br>
&amp;gt;&nbsp;out&nbsp;of&nbsp;physical&nbsp;memory&nbsp;that&nbsp;it&amp;#39;s&nbsp;performance&nbsp;degrades&nbsp;because&nbsp;it&lt;br&gt;<br>
&amp;gt;&nbsp;starts&nbsp;swapping&nbsp;out.&nbsp;But&nbsp;I&amp;#39;m&nbsp;not&nbsp;anywhere&nbsp;close&nbsp;to&nbsp;running&nbsp;out&nbsp;of&lt;br&gt;<br>
&amp;gt;&nbsp;memory&nbsp;yet,&nbsp;and&nbsp;the&nbsp;degradation&nbsp;starts&nbsp;almost&nbsp;immediately&nbsp;and&lt;br&gt;<br>
&amp;gt;&nbsp;increases&nbsp;linearly&nbsp;as&nbsp;the&nbsp;queue&nbsp;depth&nbsp;grows.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;am&nbsp;publishing&nbsp;500mps&nbsp;to&nbsp;an&nbsp;exchange.&nbsp;Each&nbsp;message&nbsp;is&nbsp;about&nbsp;1KB.&nbsp;I&lt;br&gt;<br>
&amp;gt;&nbsp;have&nbsp;a&nbsp;single&nbsp;fanout&nbsp;queue&nbsp;bound&nbsp;to&nbsp;the&nbsp;exchange.&nbsp;A&nbsp;single&nbsp;consumer&nbsp;is&lt;br&gt;<br>
&amp;gt;&nbsp;popping&nbsp;messages&nbsp;off&nbsp;the&nbsp;queue.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;When&nbsp;the&nbsp;queue&nbsp;is&nbsp;less&nbsp;than&nbsp;20,000&nbsp;messages&nbsp;I&nbsp;can&nbsp;pop&nbsp;300mps&nbsp;off&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;queue.&nbsp;When&nbsp;the&nbsp;queue&nbsp;is&nbsp;200,000&nbsp;messages&nbsp;the&nbsp;performance&nbsp;drop&nbsp;to&lt;br&gt;<br>
&amp;gt;&nbsp;40-80mps.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;m&nbsp;running&nbsp;RabbitMQ&nbsp;1.6.0.&nbsp;And&nbsp;nether&nbsp;rabbitmq,&nbsp;the&nbsp;consumer,&nbsp;or&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;publisher&nbsp;are&nbsp;using&nbsp;more&nbsp;than&nbsp;40%&nbsp;CPU.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;assume&nbsp;I&nbsp;shouldn&amp;#39;t&nbsp;be&nbsp;seeing&nbsp;this?&nbsp;Any&nbsp;help&nbsp;much&nbsp;appreciated.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;You&nbsp;didn&amp;#39;t&nbsp;include&nbsp;any&nbsp;code,&nbsp;but&nbsp;I&amp;#39;m&nbsp;going&nbsp;to&nbsp;take&nbsp;a&nbsp;stab&nbsp;in&nbsp;the&nbsp;dark&lt;br&gt;<br>
anyway.&nbsp;If&nbsp;you&nbsp;are&nbsp;using&nbsp;the&nbsp;ruby&nbsp;amqp&nbsp;gem&nbsp;you&nbsp;might&nbsp;be&nbsp;doing&lt;br&gt;<br>
something&nbsp;like&nbsp;this:&lt;br&gt;<br>
&lt;br&gt;<br>
def&nbsp;next_message&lt;br&gt;<br>
&nbsp; &nbsp;exchange&nbsp;=&nbsp;MQ.fanout&nbsp;&amp;#39;foo&amp;#39;&lt;br&gt;<br>
&nbsp; &nbsp;queue&nbsp;=&nbsp;MQ.queue&nbsp;&amp;#39;bar&amp;#39;&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp;queue.bind&nbsp;exchange&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp;newest_message&nbsp;=&nbsp;queue.pop&lt;br&gt;<br>
end&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;the&nbsp;code&nbsp;above&nbsp;the&nbsp;call&nbsp;to&nbsp;MQ.&amp;lt;whatever&amp;gt;&nbsp;is&nbsp;opening&nbsp;a&nbsp;new&nbsp;channel&lt;br&gt;<br>
to&nbsp;rabbitmq&nbsp;each&nbsp;time&nbsp;the&nbsp;method&nbsp;is&nbsp;called.&nbsp;You&nbsp;are&nbsp;essentially&lt;br&gt;<br>
leaking&nbsp;channels&nbsp;all&nbsp;over&nbsp;the&nbsp;place&nbsp;every&nbsp;time&nbsp;you&nbsp;try&nbsp;to&nbsp;pop&nbsp;a&nbsp;new&lt;br&gt;<br>
message.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;aren&amp;#39;t&nbsp;using&nbsp;the&nbsp;ruby&nbsp;amqp&nbsp;stuff,&nbsp;I&nbsp;still&nbsp;recommend&nbsp;checking&lt;br&gt;<br>
your&nbsp;code&nbsp;for&nbsp;whatever&nbsp;library&nbsp;you&nbsp;chose.&nbsp;You&nbsp;only&nbsp;need&nbsp;to&nbsp;allocate&nbsp;a&lt;br&gt;<br>
few&nbsp;channels&nbsp;and&nbsp;reuse&nbsp;them.&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
cr&lt;br&gt;<br>
&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;a&nbsp;href=&quot;http://mixpanel.com&quot;&gt;http://mixpanel.com&lt;/a&gt;&lt;br&gt;Blog:&nbsp;&lt;a&nbsp;href=&quot;http://blog.mixpanel.com&quot;&gt;http://blog.mixpanel.com&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>

</tt>
