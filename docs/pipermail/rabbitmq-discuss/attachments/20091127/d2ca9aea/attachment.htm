<tt>
Hi&nbsp;Matthew&nbsp;--&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;the&nbsp;feedback.&nbsp;Comments&nbsp;below.&lt;br&gt;&lt;br&gt;cheers,&lt;br&gt;Scott&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Nov&nbsp;26,&nbsp;2009&nbsp;at&nbsp;2:10&nbsp;AM,&nbsp;Matthew&nbsp;Sackman&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthew@lshift.net&quot;&gt;matthew@lshift.net&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Hi&nbsp;Scott,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;must&nbsp;admit&nbsp;I&amp;#39;m&nbsp;a&nbsp;little&nbsp;confused&nbsp;by&nbsp;your&nbsp;description&nbsp;as&nbsp;it&nbsp;would&lt;br&gt;<br>
appear&nbsp;somewhat&nbsp;complex&nbsp;to&nbsp;me.&nbsp;However,&nbsp;am&nbsp;I&nbsp;correct&nbsp;in&nbsp;the&nbsp;following?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Not&nbsp;quite.&nbsp;Let&nbsp;me&nbsp;clarify.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&lt;br&gt;<br>
1.&nbsp;You&nbsp;have&nbsp;1&nbsp;queue,&nbsp;which&nbsp;is&nbsp;being&nbsp;published&nbsp;to&nbsp;by&nbsp;50&nbsp;threads.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Yes&nbsp;although&nbsp;for&nbsp;the&nbsp;purposes&nbsp;of&nbsp;this&nbsp;discussion&nbsp;the&nbsp;publishing&nbsp;side&nbsp;is&nbsp;not&nbsp;important.&nbsp;You&nbsp;can&nbsp;just&nbsp;assume&nbsp;the&nbsp;queue&nbsp;is&nbsp;filled&nbsp;up&nbsp;with&nbsp;thousands&nbsp;of&nbsp;messages.&lt;br&gt;<br>
 &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
2.&nbsp;You&nbsp;have&nbsp;25&nbsp;consumers&nbsp;on&nbsp;that&nbsp;queue.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;2a.&nbsp;50&nbsp;threads&nbsp;calling&nbsp;the&nbsp;equivalent&nbsp;of&nbsp;queue.pop()&lt;br&gt;&lt;br&gt;2b.&nbsp;Within&nbsp;the&nbsp;queue,&nbsp;I&nbsp;have&nbsp;25&nbsp;QueueConsumers&nbsp;and&nbsp;25&nbsp;channel&nbsp;(each&nbsp;QueueConsumer&nbsp;takes&nbsp;in&nbsp;1&nbsp;channel&nbsp;in&nbsp;its&nbsp;constructor&nbsp;and&nbsp;there&nbsp;is&nbsp;a&nbsp;1-1&nbsp;mapping&nbsp;between&nbsp;QueueConsumer&nbsp;and&nbsp;channel)&lt;br&gt;<br>
 &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
3.&nbsp;To&nbsp;receive,&nbsp;you&nbsp;randomly&nbsp;select&nbsp;a&nbsp;consumer,&nbsp;and&nbsp;get&nbsp;that&nbsp;consumer&nbsp;to&lt;br&gt;<br>
consume&nbsp;a&nbsp;message.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Right&nbsp;so&nbsp;one&nbsp;of&nbsp;50&nbsp;threads&nbsp;will&nbsp;call&nbsp;queue.pop(),&nbsp;and&nbsp;internally&nbsp;picks&nbsp;a&nbsp;random&nbsp;channel,&nbsp;synchronizes&nbsp;on&nbsp;that&nbsp;channel,&nbsp;and&nbsp;then&nbsp;calls&nbsp;consume&nbsp;on&nbsp;the&nbsp;QueueConsumer&nbsp;that&nbsp;maps&nbsp;1-1&nbsp;with&nbsp;that&nbsp;channel.&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;br&gt;<br>
If&nbsp;that&amp;#39;s&nbsp;correct,&nbsp;I&amp;#39;m&nbsp;not&nbsp;surprised&nbsp;by&nbsp;your&nbsp;findings.&nbsp;Consumers&nbsp;on&nbsp;a&lt;br&gt;<br>
queue&nbsp;are&nbsp;round-robin&amp;#39;d&nbsp;by&nbsp;the&nbsp;broker.&nbsp;Thus&nbsp;each&nbsp;of&nbsp;your&nbsp;25&nbsp;consumers&lt;br&gt;<br>
will&nbsp;receive&nbsp;one&nbsp;25th&nbsp;of&nbsp;the&nbsp;messages.&nbsp;Thus&nbsp;if&nbsp;you&nbsp;randomly&nbsp;select&nbsp;a&lt;br&gt;<br>
consumer&nbsp;then&nbsp;it&nbsp;may&nbsp;well&nbsp;have&nbsp;nothing&nbsp;waiting&nbsp;on&nbsp;it&nbsp;as&nbsp;messages&nbsp;have&lt;br&gt;<br>
been&nbsp;sent&nbsp;to&nbsp;the&nbsp;other&nbsp;consumers.&nbsp;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;This&nbsp;would&nbsp;definitely&nbsp;be&nbsp;true&nbsp;if&nbsp;there&nbsp;was&nbsp;only&nbsp;a&nbsp;single&nbsp;thread.&nbsp;In&nbsp;the&nbsp;case&nbsp;where&nbsp;there&nbsp;are&nbsp;50&nbsp;threads&nbsp;and&nbsp;25&nbsp;queue&nbsp;consumers/channels,&nbsp;then&nbsp;on&nbsp;average&nbsp;there&nbsp;will&nbsp;be&nbsp;2&nbsp;threads&nbsp;working&nbsp;on&nbsp;any&nbsp;individual&nbsp;queue&nbsp;consumer/channel.&nbsp;When&nbsp;the&nbsp;queue&nbsp;starts&nbsp;to&nbsp;drain&nbsp;out,&nbsp;i.e.&nbsp;is&nbsp;almost&nbsp;empty,&nbsp;the&nbsp;impl&nbsp;as&nbsp;I&nbsp;have&nbsp;it&nbsp;can&nbsp;be&nbsp;sub&nbsp;optimal&nbsp;since&nbsp;some&nbsp;threads&nbsp;may&nbsp;be&nbsp;asking&nbsp;to&nbsp;work&nbsp;on&nbsp;queue&nbsp;consumers&nbsp;that&nbsp;are&nbsp;empty&nbsp;when&nbsp;there&nbsp;are&nbsp;other&nbsp;queue&nbsp;consumers&nbsp;that&nbsp;have&nbsp;work&nbsp;to&nbsp;do&nbsp;(something&nbsp;I&nbsp;need&nbsp;to&nbsp;fix)&nbsp;but&nbsp;when&nbsp;the&nbsp;queue&nbsp;isn&amp;#39;t&nbsp;close&nbsp;to&nbsp;draining&nbsp;out,&nbsp;I&nbsp;don&amp;#39;t&nbsp;think&nbsp;there&nbsp;should&nbsp;be&nbsp;the&nbsp;problem&nbsp;you&nbsp;describe.&nbsp;I&nbsp;do&nbsp;see&nbsp;the&nbsp;read&nbsp;throughput&nbsp;go&nbsp;down&nbsp;as&nbsp;it&nbsp;starts&nbsp;to&nbsp;drain&nbsp;out&nbsp;but&nbsp;the&nbsp;50&nbsp;reads&nbsp;/&nbsp;sec&nbsp;I&nbsp;was&nbsp;describing&nbsp;is&nbsp;before&nbsp;it&nbsp;starts&nbsp;to&nbsp;drain.&lt;br&gt;<br>
&lt;br&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Thus&nbsp;you&nbsp;will&nbsp;have&nbsp;to&nbsp;wait&nbsp;for&nbsp;up&nbsp;to&lt;br&gt;<br>
25&nbsp;publishes&nbsp;before&nbsp;that&nbsp;consumer&nbsp;gets&nbsp;a&nbsp;message.&lt;br&gt;<br>
&lt;br&gt;<br>
Why&nbsp;are&nbsp;you&nbsp;using&nbsp;so&nbsp;many&nbsp;threads&nbsp;and&nbsp;consumers?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;I&nbsp;started&nbsp;with&nbsp;one&nbsp;thread&nbsp;and&nbsp;one&nbsp;consumer&nbsp;and&nbsp;was&nbsp;seeing&nbsp;unacceptable&nbsp;read&nbsp;throughput&nbsp;(well&nbsp;under&nbsp;10&nbsp;reads/sec)&nbsp;so&nbsp;I&nbsp;decided&nbsp;to&nbsp;make&nbsp;the&nbsp;#&nbsp;channels&nbsp;of&nbsp;and&nbsp;threads&nbsp;parameterizable.&nbsp;After&nbsp;trying&nbsp;various&nbsp;permutations,&nbsp;I&nbsp;found&nbsp;50&nbsp;threads&nbsp;and&nbsp;25&nbsp;channels&nbsp;to&nbsp;work&nbsp;better&nbsp;than&nbsp;other&nbsp;choices&nbsp;although&nbsp;it&nbsp;wasn&amp;#39;t&nbsp;as&nbsp;scientific&nbsp;as&nbsp;it&nbsp;could&nbsp;be.&lt;br&gt;<br>
&lt;br&gt;The&nbsp;documentation&nbsp;says&nbsp;you&nbsp;can&nbsp;not&nbsp;have&nbsp;multiple&nbsp;threads&nbsp;going&nbsp;against&nbsp;a&nbsp;single&nbsp;channel&nbsp;so&nbsp;my&nbsp;assumption&nbsp;was&nbsp;that&nbsp;if&nbsp;I&nbsp;need&nbsp;to&nbsp;bump&nbsp;up&nbsp;performance&nbsp;with&nbsp;multiple&nbsp;threads&nbsp;I&nbsp;would&nbsp;need&nbsp;multiple&nbsp;channels&nbsp;and&nbsp;hence&nbsp;multiple&nbsp;queue&nbsp;consumers&nbsp;(since&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;appear&nbsp;you&nbsp;can&nbsp;have&nbsp;a&nbsp;single&nbsp;queue&nbsp;consumer&nbsp;going&nbsp;against&nbsp;multiple&nbsp;channels)t.&nbsp;Please&nbsp;correct&nbsp;me&nbsp;if&nbsp;I&nbsp;am&nbsp;wrong.&nbsp;Or&nbsp;even&nbsp;better&nbsp;if&nbsp;you&nbsp;have&nbsp;some&nbsp;consumer&nbsp;side&nbsp;java&nbsp;code&nbsp;you&nbsp;can&nbsp;share&nbsp;that&nbsp;you&nbsp;know&nbsp;gives&nbsp;high&nbsp;read&nbsp;throughput,&nbsp;if&nbsp;you&nbsp;wouldn&amp;#39;t&nbsp;mind&nbsp;sharing&nbsp;that&nbsp;would&nbsp;be&nbsp;very&nbsp;much&nbsp;appreciated.&lt;br&gt;<br>
&lt;br&gt;thanks,&lt;br&gt;Scott&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
