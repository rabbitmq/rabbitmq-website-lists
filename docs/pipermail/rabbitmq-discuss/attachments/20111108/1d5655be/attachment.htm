<tt>
&lt;div&gt;After&nbsp;reading&nbsp;some&nbsp;posts&nbsp;on&nbsp;the&nbsp;list&nbsp;it&nbsp;seems&nbsp;like&nbsp;many&nbsp;problems&nbsp;with&nbsp;performance&nbsp;is&nbsp;nothing&nbsp;new.&nbsp;We&nbsp;are&nbsp;currently&nbsp;reorganizing&nbsp;a&nbsp;cluster&nbsp;consisting&nbsp;of&nbsp;a myriad&nbsp;of&nbsp;jetty&nbsp;instances&nbsp;to&nbsp;a&nbsp;rabbitmq&nbsp;and&nbsp;a&nbsp;message&nbsp;driven&nbsp;system.&nbsp;The&nbsp;current&nbsp;component&nbsp;we&nbsp;are&nbsp;moving&nbsp;is&nbsp;shortly&nbsp;a&nbsp;staging&nbsp;system&nbsp;for&nbsp;a&nbsp;relative&nbsp;slow consumer&nbsp;process.. &lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; Our use-case:.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;We&nbsp;have&nbsp;currently&nbsp;a&nbsp;small&nbsp;stream&nbsp;of&nbsp;relatively&nbsp;large&nbsp;messages,&nbsp;that&nbsp;varies&nbsp;in&nbsp;size.&nbsp;(1600&nbsp;bytes&nbsp;-&amp;gt;&nbsp;5000&nbsp;bytes&nbsp;)&lt;/div&gt;&lt;div&gt;2.&nbsp;The&nbsp;incoming&nbsp;rate&nbsp;varies&nbsp;form&nbsp;0&nbsp;-&amp;gt;&nbsp;58&nbsp;per/s&nbsp;in&nbsp;our&nbsp;current&nbsp;test&nbsp;queues.&nbsp; &lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;3.&nbsp;We&nbsp;have&nbsp;currently&nbsp;two&nbsp;brokers&nbsp;in&nbsp;a&nbsp;cluster &lt;/div&gt;&lt;div&gt;4.&nbsp;The&nbsp;queues&nbsp;are&nbsp;set&nbsp;up&nbsp;in&nbsp;mirrored&nbsp;(We&nbsp;can&nbsp;not&nbsp;lose&nbsp;any&nbsp;messages),&nbsp;durable&nbsp;and&nbsp;non-exclusive.&lt;/div&gt;&lt;div&gt;5.&nbsp;We&nbsp;use&nbsp;Publisher&nbsp;Confirms/Consumer Cancellation&nbsp;in&nbsp;the&nbsp;client&nbsp;implementations&nbsp;in&nbsp;Java&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;6.&nbsp;We&nbsp;use&nbsp;prefetch-count&nbsp;as&nbsp;a&nbsp;basic&nbsp;QOS&nbsp;parameter.&nbsp;We&nbsp;have&nbsp; tested&nbsp;with:&nbsp;1,&nbsp;10&nbsp;,&nbsp;15,&nbsp;25&lt;/div&gt;&lt;div&gt;7.&nbsp;We&nbsp;ack&nbsp;per&nbsp;(deliveryTag&nbsp;%&nbsp;prefetch-count&nbsp;==&nbsp;0)&nbsp; to&nbsp;minimize&nbsp;acking.&lt;/div&gt;&lt;div&gt;8.&nbsp;The&nbsp;client&nbsp;can&nbsp;nack&nbsp;a&nbsp;message&nbsp;but&nbsp;it&nbsp;is&nbsp;seldom&nbsp;happening&nbsp;(every&nbsp;1&nbsp;million&nbsp;message&nbsp;maybe)&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Problem:&lt;/div&gt;&lt;div&gt;Over&nbsp;time&nbsp;we&nbsp;see&nbsp;a&nbsp;larger&nbsp;performance&nbsp;decrease&nbsp;in&nbsp;consuming&nbsp;the&nbsp;messages&nbsp;from&nbsp;the&nbsp;broker.&nbsp;The&nbsp;consumer&nbsp;is&nbsp;deadly&nbsp;fast&nbsp;in&nbsp;the&nbsp;start.&nbsp;1-2&nbsp;ms&nbsp;per&nbsp;message.&nbsp;Then&nbsp;the&nbsp;retrieval&nbsp;gradually&nbsp;decreases&nbsp;to&nbsp;25-26&nbsp;ms&nbsp;per&nbsp;message.&nbsp;The&nbsp;velocity&nbsp;of&nbsp;the&nbsp;speed&nbsp;decrease&nbsp;is&nbsp;varying&nbsp;by&nbsp;the&nbsp;prefetch&nbsp;size.&nbsp;When&nbsp;increasing&nbsp;the&nbsp;prefetch&nbsp;count&nbsp;to&nbsp;the&nbsp;time&nbsp;before&nbsp;it&nbsp;reaches&nbsp;25ms&nbsp;is&nbsp;exponentially&nbsp;increasing.&nbsp;Up&nbsp;to&nbsp;12&nbsp;hours.&nbsp;If&nbsp;we re-initiate the connection&nbsp;it&nbsp;seem&nbsp;to&nbsp;recover&nbsp;and&nbsp;everything&nbsp;seem&nbsp;OK.&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Versions: &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Java&nbsp;client:&nbsp;2.5.1&lt;/div&gt;&lt;div&gt;Broker:&nbsp;2.5.1&nbsp;(ubuntu&nbsp;build)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Tarjei&nbsp;Romtveit&lt;br&gt;Data&nbsp;Management&nbsp;Director&lt;br&gt;<br>
Integrasco&nbsp;A/S&lt;br&gt;Mobile:&nbsp;&lt;a&nbsp;href=&quot;tel:%2B47%20990%2020%20074&quot;&nbsp;value=&quot;+4799020074&quot;&nbsp;target=&quot;_blank&quot;&gt;+47&nbsp;990&nbsp;20&nbsp;074&lt;/a&gt;&lt;br&gt;<br>
<br>
<br>
Address:&nbsp;Hasseldalen&nbsp;3,&nbsp;N-4878&nbsp;Grimstad,&nbsp;Norway&lt;br&gt;&lt;a&nbsp;href=&quot;http://www.integrasco.com&quot;&nbsp;target=&quot;_blank&quot;&gt;www.integrasco.com&lt;/a&gt;&nbsp;//&nbsp;&lt;a&nbsp;href=&quot;http://twitter.com/integrasco&quot;&nbsp;target=&quot;_blank&quot;&gt;twitter.com/integrasco&lt;/a&gt;&nbsp;//&nbsp;&lt;a&nbsp;href=&quot;http://facebook.com/integrasco&quot;&nbsp;target=&quot;_blank&quot;&gt;facebook.com/integrasco&lt;/a&gt;&lt;br&gt;<br>
<br>
<br>
<br>
<br>
<br>

</tt>
