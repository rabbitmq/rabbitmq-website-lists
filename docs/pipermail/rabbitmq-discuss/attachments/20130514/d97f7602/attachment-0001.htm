<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
Meaning&nbsp;that&nbsp;messages&nbsp;published&nbsp;in&nbsp;London&nbsp;and&nbsp;Moscow&nbsp;can&nbsp;be&nbsp;consumed&nbsp;in&nbsp;Cloud.&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes&nbsp;but&nbsp;I&nbsp;want&nbsp;it&nbsp;biodirectional,&nbsp;I&nbsp;tried&nbsp;to&nbsp;simplify&nbsp;the&nbsp;example,&nbsp;but&nbsp;I&nbsp;guess&nbsp;that&nbsp;wasn&amp;#39;t&nbsp;helpful.&nbsp;What&nbsp;I&nbsp;want&nbsp;is:&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;&lt;ol&nbsp;style&gt;&lt;li&nbsp;style&gt;Cloud&nbsp;posts&nbsp;to&nbsp;local&nbsp;topic&nbsp;exchange&nbsp;&amp;quot;oracle.london&amp;quot;&nbsp;-&nbsp;this&nbsp;message&nbsp;is&nbsp;consumed&nbsp;by&nbsp;the&nbsp;London&nbsp;server.&lt;br&gt;&lt;/li&gt;&lt;li&nbsp;style&gt;London&nbsp;posts&nbsp;to&nbsp;a local&nbsp;topic&nbsp;exchange&nbsp; &amp;quot;oracle.london&amp;quot;&nbsp;-&nbsp;this&nbsp;message&nbsp;is&nbsp;consumed&nbsp;by&nbsp;the&nbsp;Cloud&nbsp;server.&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style&gt;Moscow&nbsp;posts&nbsp;to&nbsp;a local&nbsp;topic&nbsp;exchange&nbsp;&amp;quot;oracle.moscow&amp;quot;&nbsp;-&nbsp;this&nbsp;message&nbsp;is&nbsp;consumed&nbsp;by&nbsp;the&nbsp;Cloud&nbsp;server.&lt;/li&gt;&lt;li&nbsp;style&gt;etc.&lt;/li&gt;&lt;/ol&gt;&lt;div&nbsp;style&gt;So&nbsp;Cloud&nbsp;consumes&nbsp;everything&nbsp;and&nbsp;the&nbsp;Local&nbsp;servers&nbsp;consume&nbsp;messages&nbsp;sent&nbsp;to&nbsp;them&nbsp;by&nbsp;the&nbsp;Cloud&nbsp;-&nbsp;messages&nbsp;are&nbsp;not&nbsp;sent&nbsp;between&nbsp;servers&nbsp;otherwise. So&nbsp;Cloud&nbsp;-&amp;gt;&nbsp;Local&nbsp;Servers&nbsp;and&nbsp;Local&nbsp;Servers&nbsp;-&amp;gt;&nbsp;Cloud&nbsp;(but&nbsp;not&nbsp;Local&nbsp;Server&nbsp;-&amp;gt;&nbsp;Local&nbsp;Server).&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;Did&nbsp;you&nbsp;do&nbsp;that&nbsp;on&nbsp;the&nbsp;Cloud&nbsp;machine?&nbsp;It&nbsp;sounds&nbsp;like&nbsp;you&nbsp;did&nbsp;-&nbsp;but&nbsp;here&nbsp;you&amp;#39;re&nbsp;telling&nbsp;it&nbsp;to&nbsp;connect&nbsp;to&nbsp;itself?&lt;br&gt;<br>
<br>
&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;No,&nbsp;the&nbsp;cloud&nbsp;is&nbsp;not&nbsp;connecting&nbsp;to&nbsp;itself,&nbsp;the&nbsp;Cloud&nbsp;is&nbsp;connecting&nbsp;to&nbsp;each&nbsp;&amp;quot;Local&amp;quot;&nbsp;server&nbsp;(London&nbsp;and&nbsp;Moscow)&nbsp;and&nbsp;the&nbsp;&amp;quot;Local&amp;quot;&nbsp;servers&nbsp;connect&nbsp;to&nbsp;the&nbsp;cloud.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;div&gt;Here&nbsp;are&nbsp;more&nbsp;details&nbsp;as&nbsp;to&nbsp;what&nbsp;I&nbsp;did&nbsp;(just&nbsp;with&nbsp;different&nbsp;usernames/passwords)&nbsp;-&nbsp;I&nbsp;have&nbsp;3&nbsp;physical&nbsp;machines&nbsp;on&nbsp;the&nbsp;same&nbsp;VPN:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cloud:&nbsp;10.9.0.1&lt;/div&gt;&lt;div&gt;London:&nbsp;10.9.0.2&lt;/div&gt;<br>
<br>
&lt;div&gt;Moscow:&nbsp;10.9.0.3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;They&nbsp;each&nbsp;have&nbsp;a&nbsp;RabbitMQ&nbsp;instance,&nbsp;on&nbsp;each&nbsp;one&nbsp;I&nbsp;do:&lt;/div&gt;&lt;div&gt;&lt;ol&nbsp;style&gt;&lt;li&nbsp;style&gt;Create&nbsp;vhost:&nbsp;oracle&lt;br&gt;&lt;/li&gt;&lt;li&nbsp;style&gt;Create&nbsp;new&nbsp;users:&nbsp;moscow:password,&nbsp;london:password,&nbsp;cloud:password&lt;br&gt;<br>
<br>
&lt;/li&gt;&lt;li&nbsp;style&gt;Set&nbsp;permissions&nbsp;for&nbsp;all&nbsp;users&nbsp;for&nbsp;the&nbsp;oracle&nbsp;vhost:&nbsp;.*&nbsp;.*&nbsp;.*&lt;br&gt;&lt;/li&gt;&lt;li&nbsp;style&gt;Set&nbsp;local&nbsp;username&nbsp;and&nbsp;nodename&lt;/li&gt;&lt;ol&nbsp;style&gt;&lt;li&nbsp;style&gt;Cloud:&nbsp;rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_parameter&nbsp;federation&nbsp;local-username&nbsp;&amp;#39;&amp;quot;Cloud&amp;quot;&amp;#39;&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style&gt;London:&nbsp;rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_parameter&nbsp;federation&nbsp;local-nodename&nbsp;&amp;#39;&amp;quot;London&amp;quot;&amp;#39;&lt;/li&gt;&lt;li&nbsp;style&gt;Moscow:&nbsp;rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_parameter&nbsp;federation&nbsp;local-nodename&nbsp;&amp;#39;&amp;quot;Moscow&amp;quot;&amp;#39;&lt;/li&gt;<br>
<br>
&lt;/ol&gt;&lt;li&nbsp;style&gt;Create&nbsp;a&nbsp;federation&nbsp;upstream&lt;/li&gt;&lt;ol&nbsp;style&gt;&lt;li&nbsp;style&gt;Cloud&nbsp;-&nbsp;set&nbsp;London&nbsp;and&nbsp;Moscow&nbsp;as&nbsp;upstreams&nbsp;(with&nbsp;the&nbsp;appropriate&nbsp;user/pass)&lt;/li&gt;&lt;ol&nbsp;style&gt;&lt;li&nbsp;style&gt;rabbitmqctl&nbsp;set_parameter&nbsp;federation-upstream&nbsp;London&nbsp;&amp;#39;{&amp;quot;uri&amp;quot;:&amp;quot;amqp://&lt;a&nbsp;href=&quot;http://london:password@10.9.0.2/oracle&quot;&gt;london:password@10.9.0.2/oracle&lt;/a&gt;&amp;quot;}&amp;#39;&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style&gt;rabbitmqctl&nbsp;set_parameter&nbsp;federation-upstream&nbsp;Moscow &amp;#39;{&amp;quot;uri&amp;quot;:&amp;quot;amqp://&lt;a&nbsp;href=&quot;http://moscow:password@10.9.0.3/oracle&quot;&gt;moscow:password@10.9.0.3/oracle&lt;/a&gt;&amp;quot;}&amp;#39;&lt;/li&gt;&lt;/ol&gt;&lt;li&nbsp;style&gt;Local&nbsp;Servers&nbsp;-&nbsp;Set&nbsp;Cloud&nbsp;as&nbsp;the&nbsp;upstream&nbsp;with&nbsp;unique&nbsp;user/pass&lt;/li&gt;<br>
<br>
&lt;ol&nbsp;style&gt;&lt;li&nbsp;style&gt;London:&nbsp;rabbitmqctl&nbsp;set_parameter&nbsp;federation-upstream&nbsp;Cloud&nbsp;&amp;#39;{&amp;quot;uri&amp;quot;:&amp;quot;amqp://&lt;a&nbsp;href=&quot;http://london:password@10.9.0.1/oracle&quot;&gt;london:password@10.9.0.1/oracle&lt;/a&gt;&amp;quot;}&amp;#39;&lt;/li&gt;&lt;li&nbsp;style&gt;<br>
<br>
Moscow:&nbsp;rabbitmqctl&nbsp;set_parameter&nbsp;federation-upstream&nbsp;Cloud&nbsp;&amp;#39;{&amp;quot;uri&amp;quot;:&amp;quot;amqp://&lt;a&nbsp;href=&quot;http://moscow:password@10.9.0.1/oracle&quot;&gt;moscow:password@10.9.0.1/oracle&lt;/a&gt;&amp;quot;}&amp;#39;&lt;/li&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;li&nbsp;style&gt;Create&nbsp;a&nbsp;federation&nbsp;upstream&nbsp;set&lt;/li&gt;<br>
<br>
&lt;ol&nbsp;style&gt;&lt;li&nbsp;style&gt;Cloud:&lt;/li&gt;&lt;ol&nbsp;style&gt;&lt;li&nbsp;style&gt;rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_parameter&nbsp;federation-upstream-set&nbsp;London&nbsp;&amp;#39;[{&amp;quot;upstream&amp;quot;:&nbsp;&amp;quot;London&amp;quot;}]&amp;#39;&lt;/li&gt;&lt;li&nbsp;style&gt;rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_parameter&nbsp;federation-upstream-set&nbsp;Moscow&nbsp;&amp;#39;[{&amp;quot;upstream&amp;quot;:&nbsp;&amp;quot;Moscow&amp;quot;}]&amp;#39;&lt;/li&gt;<br>
<br>
&lt;/ol&gt;&lt;li&nbsp;style&gt;London: rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_parameter&nbsp;federation-upstream-set&nbsp;Cloud&nbsp;&amp;#39;[{&amp;quot;upstream&amp;quot;:&nbsp;&amp;quot;Cloud&amp;quot;}]&amp;#39;&lt;/li&gt;&lt;li&nbsp;style&gt;Moscow: rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_parameter&nbsp;federation-upstream-set&nbsp;Cloud&nbsp;&amp;#39;[{&amp;quot;upstream&amp;quot;:&nbsp;&amp;quot;Cloud&amp;quot;}]&amp;#39;&lt;/li&gt;<br>
<br>
&lt;/ol&gt;&lt;li&nbsp;style&gt;Create&nbsp;a&nbsp;federation&nbsp;policy&lt;/li&gt;&lt;ol&nbsp;style&gt;&lt;li&nbsp;style&gt;Cloud:&lt;/li&gt;&lt;ol&nbsp;style&gt;&lt;li&nbsp;style&gt;rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_policy&nbsp;London&nbsp;&amp;quot;^oracle.london&amp;quot;&nbsp;&amp;#39;{&amp;quot;federation-upstream-set&amp;quot;:&nbsp;&amp;quot;London&amp;quot;}&amp;#39;&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style&gt;rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_policy&nbsp;Moscow &amp;quot;^oracle.moscow&amp;quot;&nbsp;&amp;#39;{&amp;quot;federation-upstream-set&amp;quot;:&nbsp;&amp;quot;Moscow&amp;quot;}&amp;#39;&lt;/li&gt;&lt;/ol&gt;&lt;li&nbsp;style&gt;London: rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_policy&nbsp;London&nbsp;&amp;quot;^oracle.london&amp;quot;&nbsp;&amp;#39;{&amp;quot;federation-upstream-set&amp;quot;:&nbsp;&amp;quot;Cloud&amp;quot;}&amp;#39;&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style&gt;Moscow: rabbitmqctl&nbsp;-p&nbsp;oracle&nbsp;set_policy&nbsp;Moscow&nbsp;&amp;quot;^oracle.moscow&amp;quot;&nbsp;&amp;#39;{&amp;quot;federation-upstream-set&amp;quot;:&nbsp;&amp;quot;Cloud&amp;quot;}&amp;#39;&lt;/li&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Now&nbsp;the&nbsp;problem&nbsp;comes&nbsp;when&nbsp;I&nbsp;set&nbsp;a&nbsp;federation&nbsp;upstream&nbsp;on&nbsp;the&nbsp;&amp;quot;Local&amp;quot;&nbsp;servers&nbsp;(London&nbsp;and&nbsp;Moscow),&nbsp;I&nbsp;want&nbsp;to&nbsp;have&nbsp;a&nbsp;different&nbsp;username/password&nbsp;on&nbsp;each.&nbsp;But&nbsp;it&nbsp;seems&nbsp;the&nbsp;&amp;quot;Cloud&amp;quot;&nbsp;upstream&nbsp;must&nbsp;always&nbsp;have&nbsp;the&nbsp;same&nbsp;username/password?&nbsp;-&nbsp;Unless&nbsp;I&nbsp;am&nbsp;misunderstanding&nbsp;something?&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;what&nbsp;you&nbsp;want&nbsp;to&nbsp;do&nbsp;is:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Create&nbsp;the&nbsp;London&nbsp;/&nbsp;Moscow&nbsp;users&nbsp;on&nbsp;the&nbsp;London&nbsp;/&nbsp;Moscow&nbsp;boxes&lt;br&gt;<br>
*&nbsp;Add&nbsp;upstreams&nbsp;for&nbsp;London&nbsp;/&nbsp;Moscow&nbsp;on&nbsp;Cloud,&nbsp;pointing&nbsp;to&nbsp;the&nbsp;London&nbsp;/&nbsp;Moscow&nbsp;machines&lt;br&gt;<br>
*&nbsp;Set&nbsp;the&nbsp;federation&nbsp;policy&nbsp;on&nbsp;Cloud&lt;br&gt;<br>
*&nbsp;If&nbsp;you&nbsp;have&nbsp;deleted&nbsp;/&nbsp;restricted&nbsp;the&nbsp;&amp;quot;guest&amp;quot;&nbsp;account&nbsp;on&nbsp;Cloud,&nbsp;then&nbsp;set&nbsp;&amp;quot;local-username&amp;quot;&nbsp;to&nbsp;another&nbsp;account&nbsp;that&nbsp;is&nbsp;able&nbsp;to&nbsp;publish&nbsp;messages&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Yes,&nbsp;I&nbsp;did&nbsp;all&nbsp;that,&nbsp;but&nbsp;I&nbsp;want&nbsp;to&nbsp;federate&nbsp;in&nbsp;both&nbsp;directions.&nbsp;If&nbsp;I&nbsp;do&nbsp;the&nbsp;above,&nbsp;all&nbsp;messages&nbsp;I&nbsp;write&nbsp;to&nbsp;the&nbsp;Local&nbsp;servers&nbsp;(London,&nbsp;Moscow)&nbsp;I&nbsp;can&nbsp;consume&nbsp;on&nbsp;the&nbsp;Cloud&nbsp;server,&nbsp;however&nbsp;if&nbsp;I&nbsp;write&nbsp;from&nbsp;the&nbsp;Cloud&nbsp;server,&nbsp;I&nbsp;cannot&nbsp;consume&nbsp;the&nbsp;messages&nbsp;on&nbsp;the&nbsp;Local&nbsp;servers.&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;To&nbsp;do&nbsp;that,&nbsp;I&nbsp;need&nbsp;to&nbsp;add&nbsp;federation&nbsp;upstreams&nbsp;on&nbsp;the&nbsp;local&nbsp;servers:&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;rabbitmqctl&nbsp;set_parameter&nbsp;federation-upstream&nbsp;Cloud&nbsp;&amp;#39;{&amp;quot;uri&amp;quot;:&amp;quot;amqp://&lt;a&nbsp;href=&quot;http://london:password@10.9.0.1/oracle&quot;&gt;london:password@10.9.0.1/oracle&lt;/a&gt;&amp;quot;}&amp;#39;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&nbsp;style&gt;rabbitmqctl&nbsp;set_parameter&nbsp;federation-upstream&nbsp;Cloud&nbsp;&amp;#39;{&amp;quot;uri&amp;quot;:&amp;quot;amqp://&lt;a&nbsp;href=&quot;http://moscow:password@10.9.0.1/oracle&quot;&gt;moscow:password@10.9.0.1/oracle&lt;/a&gt;&amp;quot;}&amp;#39;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;But&nbsp;I&nbsp;cannot&nbsp;do&nbsp;that&nbsp;because&nbsp;RabbitMQ&nbsp;only&nbsp;accepts&nbsp;a&nbsp;single&nbsp;local-username&nbsp;:(&nbsp;-&nbsp;Am&nbsp;I&nbsp;missing&nbsp;something?&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&nbsp;Simon&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Simon&nbsp;MacMullen&lt;br&gt;<br>
RabbitMQ,&nbsp;Pivotal&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
