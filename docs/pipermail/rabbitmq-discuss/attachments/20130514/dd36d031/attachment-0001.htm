<tt>
&lt;div&gt;Hello.&nbsp;I&nbsp;have&nbsp;a&nbsp;question&nbsp;about&nbsp;rabbitmq&nbsp;http&nbsp;api&nbsp;basic&nbsp;auth.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;use&nbsp;rabbitmq&nbsp;v3.1.0&nbsp;and&nbsp;my&nbsp;code&nbsp;is&nbsp;below.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&gt;package&nbsp;com.foo.bar.controller;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;import&nbsp;java.io.BufferedReader;&lt;/div&gt;&lt;div&gt;import&nbsp;java.io.IOException;&lt;/div&gt;&lt;div&gt;import&nbsp;java.io.InputStreamReader;&lt;/div&gt;&lt;div&gt;import&nbsp;java.net.URLEncoder;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;import&nbsp;javax.servlet.http.HttpServletRequest;&lt;/div&gt;&lt;div&gt;import&nbsp;javax.servlet.http.HttpServletResponse;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.commons.logging.Log;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.commons.logging.LogFactory;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.HttpHost;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.HttpResponse;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.auth.AuthScope;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.auth.UsernamePasswordCredentials;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.client.AuthCache;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.client.methods.HttpPut;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.client.protocol.ClientContext;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.impl.auth.BasicScheme;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.impl.client.BasicAuthCache;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.impl.client.DefaultHttpClient;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.protocol.BasicHttpContext;&lt;/div&gt;&lt;div&gt;import&nbsp;org.apache.http.protocol.HTTP;&lt;/div&gt;&lt;div&gt;import&nbsp;org.springframework.stereotype.Controller;&lt;/div&gt;&lt;div&gt;import&nbsp;org.springframework.web.bind.annotation.RequestMapping;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;@Controller&lt;/div&gt;&lt;div&gt;public&nbsp;class&nbsp;HealthCheckController&nbsp;{&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;private&nbsp;Log&nbsp;log&nbsp;=&nbsp;LogFactory.getLog(HealthCheckController.class);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:&nbsp;pre;&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;private&nbsp;final&nbsp;String&nbsp;IP&nbsp;=&nbsp;&quot;000.000.000.000&quot;;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;private&nbsp;final&nbsp;String&nbsp;OK&nbsp;=&nbsp;&quot;ok&quot;;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;private&nbsp;String&nbsp;ID&nbsp;=&nbsp;&quot;account&quot;;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;private&nbsp;String&nbsp;PW&nbsp;=&nbsp;&quot;passwd&quot;;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;@RequestMapping({&quot;/monitor/check&quot;})&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;public&nbsp;void&nbsp;check(HttpServletRequest&nbsp;request,&nbsp;HttpServletResponse&nbsp;response)&nbsp;throws&nbsp;IOException&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;DefaultHttpClient&nbsp;httpclient&nbsp;=&nbsp;new&nbsp;DefaultHttpClient();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;HttpHost&nbsp;targetHost&nbsp;=&nbsp;new&nbsp;HttpHost(IP,&nbsp;15672,&nbsp;&quot;http&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;HttpPut&nbsp;rq&nbsp;=&nbsp;new&nbsp;HttpPut(&quot;/api/aliveness-test/%2ffoo%2fbar&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;try&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;httpclient.getCredentialsProvider().setCredentials(&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;new&nbsp;AuthScope(targetHost.getHostName(),&nbsp;targetHost.getPort()),&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;new&nbsp;UsernamePasswordCredentials(ID,&nbsp;URLEncoder.encode(PW,&nbsp;HTTP.UTF_8)));&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;AuthCache&nbsp;authCache&nbsp;=&nbsp;new&nbsp;BasicAuthCache();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;BasicScheme&nbsp;basicAuth&nbsp;=&nbsp;new&nbsp;BasicScheme();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;authCache.put(targetHost,&nbsp;basicAuth);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;BasicHttpContext&nbsp;localcontext&nbsp;=&nbsp;new&nbsp;BasicHttpContext();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;localcontext.setAttribute(ClientContext.AUTH_CACHE,&nbsp;authCache);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;HttpResponse&nbsp;rp&nbsp;=&nbsp;httpclient.execute(targetHost,&nbsp;rq,&nbsp;localcontext);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;log.info(&quot;===================&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;log.info(rp);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;BufferedReader&nbsp;rd&nbsp;=&nbsp;new&nbsp;BufferedReader(new&nbsp;InputStreamReader(rp.getEntity().getContent()));&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;String&nbsp;line&nbsp;=&nbsp;&quot;&quot;;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;while&nbsp;((line&nbsp;=&nbsp;rd.readLine())&nbsp;!=&nbsp;null)&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;log.info(line);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;}&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;log.info(&quot;===================&quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;}&nbsp;finally&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;httpclient.getConnectionManager().shutdown();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;}&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;call&nbsp;'/monitor/check'&nbsp;from&nbsp;web&nbsp;browser.&lt;/div&gt;&lt;div&gt;but...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;11:21:08&nbsp;[WARN&nbsp;](DefaultRequestDirector.java:1095)&nbsp;Authentication&nbsp;error:&nbsp;basic&nbsp;authorization&nbsp;challenge&nbsp;expected,&nbsp;but&nbsp;not&nbsp;found&lt;/div&gt;&lt;div&gt;11:21:08&nbsp;[INFO&nbsp;](HealthCheckController.java:103)&nbsp;===================&lt;/div&gt;&lt;div&gt;11:21:08&nbsp;[INFO&nbsp;](HealthCheckController.java:104)&nbsp;HTTP/1.1&nbsp;401&nbsp;Unauthorized&nbsp;[Server:&nbsp;MochiWeb/1.1&nbsp;WebMachine/1.9.0&nbsp;(someone&nbsp;had&nbsp;painted&nbsp;it&nbsp;blue),&nbsp;Date:&nbsp;Wed,&nbsp;15&nbsp;May&nbsp;2013&nbsp;02:21:08&nbsp;GMT&lt;/div&gt;&lt;div&gt;,&nbsp;Content-Length:&nbsp;50]&lt;/div&gt;&lt;div&gt;11:21:08&nbsp;[INFO&nbsp;](HealthCheckController.java:108)&nbsp;{&quot;error&quot;:&quot;not_authorised&quot;,&quot;reason&quot;:&quot;Login&nbsp;failed&quot;}&lt;/div&gt;&lt;div&gt;11:21:08&nbsp;[INFO&nbsp;](HealthCheckController.java:110)&nbsp;===================&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;account,&nbsp;password,&nbsp;ip&nbsp;and&nbsp;api&nbsp;are&nbsp;all&nbsp;correct.&nbsp;but&nbsp;I&nbsp;cannot&nbsp;authorized.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What's&nbsp;wrong&nbsp;in&nbsp;my&nbsp;code?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you.&lt;/div&gt;
</tt>
