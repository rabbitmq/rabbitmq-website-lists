<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi&nbsp;there,&nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp;Since&nbsp;our&nbsp;production&nbsp;application&nbsp;tier&nbsp;uses&nbsp;php,&nbsp;publisher&nbsp;connections&nbsp;can&#39;t&nbsp;be&nbsp;long&nbsp;lived.&nbsp;A&nbsp;typical&nbsp;use&nbsp;case&nbsp;is&nbsp;that&nbsp;a&nbsp;publisher&nbsp;will&nbsp;establish&nbsp;a&nbsp;connection,&nbsp;publish&nbsp;a&nbsp;message&nbsp;and&nbsp;close&nbsp;the&nbsp;connection.&nbsp;Normally,&nbsp;we&nbsp;have&nbsp;about&nbsp;~1000&nbsp;connections&nbsp;open&nbsp;with&nbsp;one&nbsp;or&nbsp;two&nbsp;hundred&nbsp;messages&nbsp;in&nbsp;the&nbsp;queues&nbsp;and&nbsp;with&nbsp;a&nbsp;publish&nbsp;rate&nbsp;of&nbsp;~800&nbsp;msgs/sec.&nbsp;We&nbsp;faced&nbsp;a&nbsp;situation&nbsp;where&nbsp;consumers&nbsp;weren&#39;t&nbsp;consuming&nbsp;for&nbsp;approx&nbsp;2&nbsp;mins&nbsp;which&nbsp;caused&nbsp;the&nbsp;cluster&nbsp;to&nbsp;become&nbsp;slow&nbsp;(probably&nbsp;too&nbsp;many&nbsp;publishers&nbsp;and&nbsp;no&nbsp;consumers).&nbsp;BTW,&nbsp;I&nbsp;am&nbsp;working&nbsp;on&nbsp;fixing&nbsp;the&nbsp;consumer&nbsp;issue&nbsp;separately.&nbsp;I&nbsp;noticed&nbsp;the&nbsp;connections&nbsp;started&nbsp;to&nbsp;pile&nbsp;up&nbsp;from&nbsp;the&nbsp;application&nbsp;tier&nbsp;and&nbsp;at&nbsp;one&nbsp;point&nbsp;we&nbsp;had&nbsp;~11,000&nbsp;open&nbsp;connections&nbsp;with&nbsp;~70,000&nbsp;msgs&nbsp;in&nbsp;the&nbsp;queues.&nbsp;As&nbsp;a&nbsp;result,&nbsp;cluster&nbsp;wasn&#39;t&nbsp;in&nbsp;a&nbsp;usable&nbsp;condition.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; What&nbsp;bothers&nbsp;me&nbsp;most&nbsp;about&nbsp;this&nbsp;situation&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;connections.&nbsp;Total&nbsp;messages&nbsp;seem&nbsp;to&nbsp;be&nbsp;non&nbsp;significant&nbsp;compared&nbsp;to&nbsp;what&nbsp;Rabbit&nbsp;cluster&nbsp;can&nbsp;handle.&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;improve&nbsp;this&nbsp;situation&nbsp;by&nbsp;creating&nbsp;a&nbsp;service&nbsp;layer&nbsp;on&nbsp;top&nbsp;of&nbsp;RabbitMQ&nbsp;cluster&nbsp;with&nbsp;long&nbsp;lived&nbsp;connections&nbsp;(probably&nbsp;a&nbsp;java&nbsp;service)&nbsp;to&nbsp;avoid&nbsp;creating&nbsp;a&nbsp;connection&nbsp;on&nbsp;the&nbsp;fly&nbsp;and&nbsp;tearing&nbsp;it&nbsp;down.&nbsp;I&nbsp;am&nbsp;willing&nbsp;to&nbsp;take&nbsp;the&nbsp;performance&nbsp;hit&nbsp;on&nbsp;each&nbsp;requests&nbsp;for&nbsp;.&nbsp;Does&nbsp;this&nbsp;sound&nbsp;reasonable?&nbsp;Is&nbsp;there&nbsp;a&nbsp;best&nbsp;practice&nbsp;for&nbsp;a&nbsp;situation&nbsp;like&nbsp;this?&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Shri&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
