<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Well&nbsp;I&nbsp;should&nbsp;add&nbsp;that&nbsp;I&amp;#39;m&nbsp;using&nbsp;PHP&nbsp;and&nbsp;the&nbsp;PECL&nbsp;bindings&nbsp;for&nbsp;the&nbsp;rabbitmq-c&nbsp;library.&nbsp; So&nbsp;I&amp;#39;ve&nbsp;been&nbsp;able&nbsp;to&nbsp;determine&nbsp;the&nbsp;exact&nbsp;repro&nbsp;steps.&lt;div&nbsp;style&gt;1.&nbsp;get&nbsp;(no_ack&nbsp;off)&lt;/div&gt;&lt;div&nbsp;style&gt;2.&nbsp;ack&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;3.&nbsp;get&nbsp;again,&nbsp;the&nbsp;connection&nbsp;drops,&nbsp;the&nbsp;message&nbsp;gets&nbsp;redelivered&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;The&nbsp;exact&nbsp;same&nbsp;code&nbsp;connecting&nbsp;to&nbsp;rabbitmq&nbsp;3.0.4&nbsp;does&nbsp;not&nbsp;have&nbsp;this&nbsp;problem&nbsp;so&nbsp;I&amp;#39;m&nbsp;guessing&nbsp;something&nbsp;broke&nbsp;with&nbsp;the&nbsp;PHP&nbsp;bindings&nbsp;or&nbsp;rabbitmq-c&nbsp;between&nbsp;versions.&nbsp; I&nbsp;leave&nbsp;room&nbsp;for&nbsp;a&nbsp;misconfiguration&nbsp;of&nbsp;rabbitmq&nbsp;on&nbsp;my&nbsp;part&nbsp;but&nbsp;other&nbsp;than&nbsp;setting&nbsp;up&nbsp;a&nbsp;user/password&nbsp;and&nbsp;giving&nbsp;it&nbsp;full&nbsp;access&nbsp;to&nbsp;the&nbsp;/&nbsp;vhost&nbsp;I&nbsp;didn&amp;#39;t&nbsp;do&nbsp;much&nbsp;configuration&nbsp;on&nbsp;either.&nbsp; Here&nbsp;is&nbsp;the&nbsp;code&nbsp;I&amp;#39;m&nbsp;using:&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Producer:&lt;br&gt;&lt;div&gt;&amp;lt;?php&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$co&nbsp;=&nbsp;new&nbsp;AMQPConnection();&lt;/div&gt;&lt;div&gt;$co-&amp;gt;setLogin(&amp;#39;user&amp;#39;);&lt;/div&gt;&lt;div&gt;$co-&amp;gt;setPassword(&amp;#39;password&amp;#39;);&lt;/div&gt;&lt;div&gt;$co-&amp;gt;setTimeout(60);&lt;/div&gt;<br>
&lt;div&gt;$co-&amp;gt;connect();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ch&nbsp;=&nbsp;new&nbsp;AMQPChannel($co);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ex_name&nbsp;=&nbsp;&amp;#39;test_exchange&amp;#39;;&lt;/div&gt;&lt;div&gt;$ex&nbsp;=&nbsp;new&nbsp;AMQPExchange($ch);&lt;/div&gt;&lt;div&gt;$ex-&amp;gt;setName($ex_name);&lt;/div&gt;&lt;div&gt;<br>
$ex-&amp;gt;setType(AMQP_EX_TYPE_DIRECT);&lt;/div&gt;&lt;div&gt;$ex-&amp;gt;declare();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$q_name&nbsp;=&nbsp;&amp;#39;test_queue&amp;#39;;&lt;/div&gt;&lt;div&gt;$q&nbsp;=&nbsp;new&nbsp;AMQPQueue($ch);&lt;/div&gt;&lt;div&gt;$q-&amp;gt;setName($q_name);&lt;/div&gt;&lt;div&gt;$q-&amp;gt;setFlags(AMQP_DURABLE);&lt;/div&gt;<br>
&lt;div&gt;$q-&amp;gt;declare();&lt;/div&gt;&lt;div&gt;$q-&amp;gt;bind($ex_name,&nbsp;$q_name);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ex-&amp;gt;publish(&amp;#39;test_message&amp;#39;.microtime(true),&nbsp;$q_name);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Consumer:&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;div&gt;&amp;lt;?php&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$co&nbsp;=&nbsp;new&nbsp;AMQPConnection();&lt;/div&gt;&lt;div&gt;$co-&amp;gt;setLogin(&amp;#39;user&amp;#39;);&lt;/div&gt;&lt;div&gt;$co-&amp;gt;setPassword(&amp;#39;password&amp;#39;);&lt;/div&gt;&lt;div&gt;$co-&amp;gt;setTimeout(0);&lt;/div&gt;&lt;div&gt;$co-&amp;gt;connect();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;$ch&nbsp;=&nbsp;new&nbsp;AMQPChannel($co);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$ex_name&nbsp;=&nbsp;&amp;#39;test_exchange&amp;#39;;&lt;/div&gt;&lt;div&gt;$ex&nbsp;=&nbsp;new&nbsp;AMQPExchange($ch);&lt;/div&gt;&lt;div&gt;$ex-&amp;gt;setName($ex_name);&lt;/div&gt;&lt;div&gt;$ex-&amp;gt;setType(AMQP_EX_TYPE_DIRECT);&lt;/div&gt;<br>
&lt;div&gt;$ex-&amp;gt;declare();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$q_name&nbsp;=&nbsp;&amp;#39;test_queue&amp;#39;;&lt;/div&gt;&lt;div&gt;$q&nbsp;=&nbsp;new&nbsp;AMQPQueue($ch);&lt;/div&gt;&lt;div&gt;$q-&amp;gt;setName($q_name);&lt;/div&gt;&lt;div&gt;$q-&amp;gt;setFlags(AMQP_DURABLE);&lt;/div&gt;&lt;div&gt;$q-&amp;gt;declare();&lt;/div&gt;<br>
&lt;div&gt;$q-&amp;gt;bind($ex_name,&nbsp;$q_name);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;while&nbsp;(true)&nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp;//$envelope&nbsp;=&nbsp;$q-&amp;gt;get(AMQP_AUTOACK);&lt;/div&gt;&lt;div&gt; &nbsp;$envelope&nbsp;=&nbsp;$q-&amp;gt;get();&lt;/div&gt;&lt;div&gt; &nbsp;if&nbsp;($envelope)&nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;echo&nbsp;$envelope-&amp;gt;getBody()&nbsp;.&amp;quot;\n&amp;quot;;&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;$q-&amp;gt;ack($envelope-&amp;gt;getDeliveryTag());&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;$envelope&nbsp;=&nbsp;false;&lt;/div&gt;&lt;div&gt; &nbsp;}&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;May&nbsp;16,&nbsp;2013&nbsp;at&nbsp;9:48&nbsp;AM,&nbsp;Michael&nbsp;Klishin&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:michael.s.klishin@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;michael.s.klishin@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2013/5/16&nbsp;Billy&nbsp;Hand&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:billythethird@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;billythethird@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
I&amp;#39;m&nbsp;using&nbsp;a&nbsp;short&nbsp;program&nbsp;I&nbsp;wrote&nbsp;that&nbsp;generates&nbsp;exactly&nbsp;one&nbsp;message.&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;Can&nbsp;you&nbsp;post&nbsp;the&nbsp;code&nbsp;(of&nbsp;both&nbsp;the&nbsp;producer&nbsp;and&nbsp;consumers)?&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;MK&lt;br&gt;<br>
&lt;br&gt;&lt;a&nbsp;href=&quot;http://github.com/michaelklishin&quot;&nbsp;target=&quot;_blank&quot;&gt;http://github.com/michaelklishin&lt;/a&gt;&lt;br&gt;<br>
<br>
&lt;a&nbsp;href=&quot;http://twitter.com/michaelklishin&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twitter.com/michaelklishin&lt;/a&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
