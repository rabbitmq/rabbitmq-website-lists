<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;What&nbsp;client&nbsp;are&nbsp;you&nbsp;using&nbsp;to&nbsp;publish&nbsp;the&nbsp;messages?&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;I&amp;#39;m&nbsp;using&nbsp;Aman&amp;#39;s&nbsp;ruby&nbsp;library&nbsp;[1],&nbsp;and&nbsp;a&nbsp;simple&nbsp;publisher&nbsp;client.&nbsp;[2]&nbsp;&lt;br&gt;&lt;br&gt;[1]&nbsp;&lt;a&nbsp;href=&quot;http://github.com/tmm1/amqp&quot;&gt;http://github.com/tmm1/amqp&lt;/a&gt;&lt;br&gt;[2]&nbsp;&lt;a&nbsp;href=&quot;http://pastie.org/315607&quot;&gt;http://pastie.org/315607&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;Rabbit&nbsp;seems&nbsp;to&nbsp;become&nbsp;unstable&nbsp;once&nbsp;the&nbsp;persister.LOG&nbsp;crosses&nbsp;the&nbsp;1GB&nbsp;limit.&nbsp;Disk&nbsp;syncs&nbsp;are&nbsp;taking&nbsp;longer&nbsp;and&nbsp;longer&nbsp;(for&nbsp;obvious&nbsp;reasons),&nbsp;and&nbsp;memory&nbsp;starts&nbsp;to&nbsp;fluctuate&nbsp;all&nbsp;over&nbsp;the&nbsp;map&nbsp;-&nbsp;from&nbsp;2GB&nbsp;to&nbsp;7GB&nbsp;(I&nbsp;am&nbsp;seeing&nbsp;high&nbsp;memory&nbsp;watermark&nbsp;warnings).&nbsp;Then,&nbsp;without&nbsp;any&nbsp;warnings&nbsp;in&nbsp;the&nbsp;log&nbsp;file,&nbsp;the&nbsp;process&nbsp;falls&nbsp;over&nbsp;and&nbsp;everyone&nbsp;gets&nbsp;disconnected.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;&lt;/div&gt;<br>
Persistent&nbsp;messages&nbsp;still&nbsp;have&nbsp;copies&nbsp;in&nbsp;memory,&nbsp;so&nbsp;if&nbsp;you&nbsp;have&nbsp;no&nbsp;consumers&nbsp;or&nbsp;the&nbsp;rate&nbsp;of&nbsp;consumption&nbsp;is&nbsp;lower&nbsp;than&nbsp;the&nbsp;publishing&nbsp;rate&nbsp;eventually&nbsp;rabbit&nbsp;will&nbsp;run&nbsp;out&nbsp;of&nbsp;memory.&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;<br>
&amp;nbsp;&lt;br&gt;So&nbsp;the&nbsp;messages&nbsp;don&amp;#39;t&nbsp;get&nbsp;flushed&nbsp;out&nbsp;to&nbsp;disk&nbsp;at&nbsp;all?&nbsp;Right&nbsp;now,&nbsp;I&amp;#39;m&nbsp;running&nbsp;two&nbsp;publishers&nbsp;and&nbsp;no&nbsp;consumers..&nbsp;I&nbsp;would&nbsp;expect&nbsp;RabbitMQ&nbsp;to&nbsp;keep&nbsp;a&nbsp;stack&nbsp;of&nbsp;messages&nbsp;in&nbsp;memory&nbsp;and&nbsp;overflow&nbsp;to&nbsp;disk&nbsp;-&nbsp;is&nbsp;this&nbsp;wrong?&nbsp;Hmm,&nbsp;now&nbsp;that&nbsp;I&nbsp;think&nbsp;about&nbsp;it,&nbsp;this&nbsp;would&nbsp;explain&nbsp;the&nbsp;log&nbsp;rollover&nbsp;pattern&nbsp;I&amp;#39;m&nbsp;seeing:&nbsp;.previous&nbsp;is&nbsp;removed&nbsp;from&nbsp;disk,&nbsp;and&nbsp;full&nbsp;log&nbsp;file&nbsp;is&nbsp;dumped&nbsp;from&nbsp;memory.&nbsp;I&nbsp;was&nbsp;surprised&nbsp;by&nbsp;this&nbsp;pattern,&nbsp;but&nbsp;if&nbsp;it&amp;#39;s&nbsp;always&nbsp;doing&nbsp;a&nbsp;full&nbsp;memory&nbsp;flush,&nbsp;that&nbsp;would&nbsp;make&nbsp;sense.&nbsp;&lt;br&gt;<br>
&lt;br&gt;-&nbsp;That&nbsp;would&nbsp;also&nbsp;mean&nbsp;that&nbsp;the&nbsp;number&nbsp;of&nbsp;messages&nbsp;we&nbsp;can&nbsp;queue&nbsp;is&nbsp;essentially&nbsp;limited&nbsp;by&nbsp;the&nbsp;amount&nbsp;of&nbsp;available&nbsp;RAM?&lt;br&gt;-&nbsp;Is&nbsp;there&nbsp;any&nbsp;way&nbsp;to&nbsp;do&nbsp;an&nbsp;incremental&nbsp;append&nbsp;to&nbsp;the&nbsp;logfile,&nbsp;instead&nbsp;of&nbsp;a&nbsp;full&nbsp;flush?&nbsp;&lt;br&gt;-&nbsp;I&amp;#39;ve&nbsp;seen&nbsp;a&nbsp;few&nbsp;mentions&nbsp;of&nbsp;RDBMS&nbsp;hooks&nbsp;for&nbsp;persistence,&nbsp;how&nbsp;far&nbsp;away&nbsp;are&nbsp;we&nbsp;from&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;P.S.&nbsp;Running&nbsp;latest&nbsp;version&nbsp;of&nbsp;RabbitMQ&nbsp;from&nbsp;trunk&nbsp;(as&nbsp;of&nbsp;Nov&nbsp;14th),&nbsp;&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;&lt;/div&gt;<br>
The&nbsp;flow&nbsp;control&nbsp;in&nbsp;that&nbsp;version&nbsp;should&nbsp;tell&nbsp;the&nbsp;producers&nbsp;to&nbsp;stop&nbsp;sending&nbsp;messages&nbsp;when&nbsp;memory&nbsp;becomes&nbsp;critical.&nbsp;However,&nbsp;it&nbsp;does&nbsp;require&nbsp;a&nbsp;cooperating&nbsp;client.&nbsp;Hence&nbsp;my&nbsp;question&nbsp;above&nbsp;about&nbsp;what&nbsp;client&nbsp;you&nbsp;are&nbsp;using.&nbsp;At&nbsp;present&nbsp;the&nbsp;trunk&nbsp;version&nbsp;of&nbsp;the&nbsp;Java&nbsp;client&nbsp;is&nbsp;the&nbsp;only&nbsp;one&nbsp;that&nbsp;handles&nbsp;flow&nbsp;control&nbsp;correctly.&lt;br&gt;<br>
<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Ah,&nbsp;interesting,&nbsp;I&amp;#39;ll&nbsp;ping&nbsp;Aman&nbsp;on&nbsp;that.&nbsp;&lt;br&gt;&amp;nbsp;&lt;/div&gt;&lt;/div&gt;Cheers,&lt;br&gt;Ilya&lt;br&gt;<br>

</tt>
