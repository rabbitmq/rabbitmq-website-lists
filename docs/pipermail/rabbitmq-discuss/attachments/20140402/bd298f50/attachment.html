<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Internally,&nbsp;in&nbsp;essence,&nbsp;the&nbsp;listener&nbsp;container&nbsp;tells&nbsp;each&nbsp;consumer&nbsp;to&nbsp;issue&nbsp;a&nbsp;basicCancel&nbsp;for&nbsp;its&nbsp;consumer&nbsp;tag(s)&nbsp;(one&nbsp;per&nbsp;queue)&nbsp;and&nbsp;waits&nbsp;for&nbsp;all&nbsp;the&nbsp;cancelOKs&nbsp;and&nbsp;close&nbsp;its&nbsp;channel.&nbsp;When&nbsp;all&nbsp;the&nbsp;consumer&nbsp;instances&nbsp;have&nbsp;stopped,&nbsp;the&nbsp;container&nbsp;stops.&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;architecture&nbsp;is&nbsp;such&nbsp;that&nbsp;we&nbsp;allow&nbsp;any&nbsp;pre-fetched&nbsp;messages&nbsp;that&nbsp;have&nbsp;already&nbsp;been&nbsp;passed&nbsp;to&nbsp;the&nbsp;container&nbsp;to&nbsp;process&nbsp;before&nbsp;the&nbsp;cancel&nbsp;is&nbsp;issued,&nbsp;while&nbsp;preventing&nbsp;any&nbsp;new&nbsp;deliveries.&nbsp;Hence,&nbsp;any&nbsp;prefetched&nbsp;messages&nbsp;in&nbsp;the&nbsp;container&nbsp;complete&nbsp;processing,&nbsp;while&nbsp;those&nbsp;still&nbsp;in&nbsp;the&nbsp;rabbit&nbsp;client,&nbsp;and&nbsp;not&nbsp;yet&nbsp;handed&nbsp;over&nbsp;to&nbsp;the&nbsp;container&nbsp;will&nbsp;be&nbsp;un-acked&nbsp;and&nbsp;redelivered&nbsp;later.&lt;/div&gt;<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Apr&nbsp;2,&nbsp;2014&nbsp;at&nbsp;4:35&nbsp;PM,&nbsp;Jason&nbsp;McIntosh&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:mcintoshj@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mcintoshj@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Real&nbsp;quick&nbsp;sample&nbsp;code&nbsp;from&nbsp;the&nbsp;Spring&nbsp;AMQP&nbsp;site:&lt;br&gt;&lt;br&gt;&lt;pre&gt;&lt;code&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;ConnectionFactory&lt;/span&gt;&nbsp;&lt;span&gt;cf&lt;/span&gt;&nbsp;&lt;span&gt;=&lt;/span&gt;&nbsp;&lt;span&gt;new&lt;/span&gt;&nbsp;&lt;span&gt;CachingConnectionFactory&lt;/span&gt;&lt;span&gt;();&lt;/span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;//&nbsp;set&nbsp;up&nbsp;the&nbsp;queue,&nbsp;exchange,&nbsp;binding&nbsp;on&nbsp;the&nbsp;broker&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;RabbitAdmin&lt;/span&gt;&nbsp;&lt;span&gt;admin&lt;/span&gt;&nbsp;&lt;span&gt;=&lt;/span&gt;&nbsp;&lt;span&gt;new&lt;/span&gt;&nbsp;&lt;span&gt;RabbitAdmin&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;cf&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;Queue&lt;/span&gt;&nbsp;&lt;span&gt;queue&lt;/span&gt;&nbsp;&lt;span&gt;=&lt;/span&gt;&nbsp;&lt;span&gt;new&lt;/span&gt;&nbsp;&lt;span&gt;Queue&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;&quot;myQueue&quot;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;admin&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;declareQueue&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;queue&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;TopicExchange&lt;/span&gt;&nbsp;&lt;span&gt;exchange&lt;/span&gt;&nbsp;&lt;span&gt;=&lt;/span&gt;&nbsp;&lt;span&gt;new&lt;/span&gt;&nbsp;&lt;span&gt;TopicExchange&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;&quot;myExchange&quot;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;admin&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;declareExchange&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;exchange&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;admin&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;declareBinding&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;BindingBuilder&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;bind&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;queue&lt;/span&gt;&lt;span&gt;).&lt;/span&gt;&lt;span&gt;to&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;exchange&lt;/span&gt;&lt;span&gt;).&lt;/span&gt;&lt;span&gt;with&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;&quot;foo.*&quot;&lt;/span&gt;&lt;span&gt;));&lt;/span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;//&nbsp;set&nbsp;up&nbsp;the&nbsp;listener&nbsp;and&nbsp;container&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;SimpleMessageListenerContainer&lt;/span&gt;&nbsp;&lt;span&gt;container&lt;/span&gt;&nbsp;&lt;span&gt;=&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;new&lt;/span&gt;&nbsp;&lt;span&gt;SimpleMessageListenerContainer&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;cf&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;Object&lt;/span&gt;&nbsp;&lt;span&gt;listener&lt;/span&gt;&nbsp;&lt;span&gt;=&lt;/span&gt;&nbsp;&lt;span&gt;new&lt;/span&gt;&nbsp;&lt;span&gt;Object&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&nbsp;&lt;span&gt;{&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;public&lt;/span&gt;&nbsp;&lt;span&gt;void&lt;/span&gt;&nbsp;&lt;span&gt;handleMessage&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;String&lt;/span&gt;&nbsp;&lt;span&gt;foo&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&nbsp;&lt;span&gt;{&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;System&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;println&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;foo&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;}&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;};&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;MessageListenerAdapter&lt;/span&gt;&nbsp;&lt;span&gt;adapter&lt;/span&gt;&nbsp;&lt;span&gt;=&lt;/span&gt;&nbsp;&lt;span&gt;new&lt;/span&gt;&nbsp;&lt;span&gt;MessageListenerAdapter&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;listener&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;container&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;setMessageListener&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;adapter&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;container&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;setQueueNames&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;&quot;myQueue&quot;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;container&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;start&lt;/span&gt;&lt;span&gt;();&lt;/span&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;//&nbsp;send&nbsp;something&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;RabbitTemplate&lt;/span&gt;&nbsp;&lt;span&gt;template&lt;/span&gt;&nbsp;&lt;span&gt;=&lt;/span&gt;&nbsp;&lt;span&gt;new&lt;/span&gt;&nbsp;&lt;span&gt;RabbitTemplate&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;cf&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;template&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;convertAndSend&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;&quot;myExchange&quot;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&nbsp;&lt;span&gt;&quot;foo.bar&quot;&lt;/span&gt;&lt;span&gt;,&lt;/span&gt;&nbsp;&lt;span&gt;&quot;Hello,&nbsp;world!&quot;&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;Thread&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;sleep&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;1000&lt;/span&gt;&lt;span&gt;);&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;container&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;stop&lt;/span&gt;&lt;span&gt;();&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;ON&nbsp;a&nbsp;war,&nbsp;you&nbsp;add&nbsp;shutdown&nbsp;hooks&nbsp;to&nbsp;the&nbsp;web.xml&nbsp;file.&nbsp;&nbsp;In&nbsp;a&nbsp;non-web&nbsp;environment,&nbsp;there&nbsp;are&nbsp;shutdown&nbsp;hooks&nbsp;through&nbsp;the&nbsp;Runtime:&lt;br&gt;<br>
<br>
&lt;a&nbsp;href=&quot;http://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html&lt;/a&gt;&lt;br&gt;&lt;br&gt;In&nbsp;the&nbsp;end,&nbsp;they&nbsp;all&nbsp;call&nbsp;container.shutdown:&lt;br&gt;&lt;a&nbsp;href=&quot;http://docs.spring.io/spring-amqp/docs/1.2.1.RELEASE/api/org/springframework/amqp/rabbit/listener/SimpleMessageListenerContainer.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://docs.spring.io/spring-amqp/docs/1.2.1.RELEASE/api/org/springframework/amqp/rabbit/listener/SimpleMessageListenerContainer.html&lt;/a&gt;&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;Code&nbsp;for&nbsp;that&nbsp;I&nbsp;found&nbsp;here:&lt;br&gt;&lt;a&nbsp;href=&quot;http://grepcode.com/file/repo1.maven.org/maven2/org.springframework.amqp/spring-rabbit/1.0.0.RELEASE/org/springframework/amqp/rabbit/listener/SimpleMessageListenerContainer.java&quot;&nbsp;target=&quot;_blank&quot;&gt;http://grepcode.com/file/repo1.maven.org/maven2/org.springframework.amqp/spring-rabbit/1.0.0.RELEASE/org/springframework/amqp/rabbit/listener/SimpleMessageListenerContainer.java&lt;/a&gt;&lt;br&gt;<br>
<br>
&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;The&nbsp;spring&nbsp;libraries&nbsp;are&nbsp;fantastic&nbsp;for&nbsp;RabbitMQ&nbsp;work&nbsp;(though&nbsp;sometimes&nbsp;there&nbsp;are&nbsp;some&nbsp;headaches&nbsp;on&nbsp;&quot;Which&nbsp;factory&nbsp;is&nbsp;this?&nbsp;Which&nbsp;MessageProperties&nbsp;do&nbsp;I&nbsp;use?&quot;&nbsp;kinda&nbsp;stuff,&nbsp;but&nbsp;overall&nbsp;they&#39;re&nbsp;not&nbsp;bad&nbsp;and&nbsp;they&#39;re&nbsp;getting&nbsp;better.&nbsp;&nbsp;I&nbsp;tend&nbsp;to&nbsp;be&nbsp;very&nbsp;careful&nbsp;on&nbsp;how&nbsp;much&nbsp;abstraction&nbsp;I&nbsp;add&nbsp;to&nbsp;my&nbsp;systems&nbsp;(hence&nbsp;why&nbsp;Groovy&nbsp;drives&nbsp;me&nbsp;nuts),&nbsp;but&nbsp;overall&nbsp;spring&nbsp;is&nbsp;has&nbsp;been&nbsp;very&nbsp;clean&nbsp;implementation&nbsp;wise.&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
<br>
&lt;/font&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;pre&gt;&lt;code&gt;&lt;span&gt;Jason&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Apr&nbsp;2,&nbsp;2014&nbsp;at&nbsp;3:17&nbsp;PM,&nbsp;Bertrand&nbsp;Guay-Paquet&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:bernie@step.polymtl.ca&quot;&nbsp;target=&quot;_blank&quot;&gt;bernie@step.polymtl.ca&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&lt;div&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi&nbsp;Jason,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks&nbsp;for&nbsp;the&nbsp;hint,&nbsp;but&nbsp;I&#39;m&nbsp;unfortunately&nbsp;not&nbsp;using&nbsp;Spring&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;this.&nbsp;Do&nbsp;you&nbsp;know&nbsp;how&nbsp;Spring&nbsp;achieves&nbsp;this&nbsp;&quot;shutdown&quot;&nbsp;command?&nbsp;I<br>
&nbsp;&nbsp;&nbsp;&nbsp;don&#39;t&nbsp;know&nbsp;Spring&nbsp;at&nbsp;all&nbsp;but&nbsp;I&#39;ll&nbsp;have&nbsp;a&nbsp;look&nbsp;at&nbsp;their&nbsp;doc.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Regards,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Bertrand&lt;div&gt;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;On&nbsp;02/04/2014&nbsp;4:10&nbsp;PM,&nbsp;Jason&nbsp;McIntosh<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;We&nbsp;use&nbsp;consumers&nbsp;here&nbsp;with&nbsp;the&nbsp;spring&nbsp;libraries. &nbsp;If&nbsp;you<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use&nbsp;them,&nbsp;there&#39;s&nbsp;a&nbsp;&quot;Shutdown&quot;&nbsp;command&nbsp;you&nbsp;can&nbsp;call&nbsp;as<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;needed. &nbsp;We&#39;ve&nbsp;had&nbsp;pretty&nbsp;good&nbsp;luck&nbsp;with&nbsp;it&nbsp;so&nbsp;far. &nbsp;The<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spring&nbsp;consumer&nbsp;stuff&nbsp;manages&nbsp;how&nbsp;many&nbsp;consumers&nbsp;are&nbsp;running,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection&nbsp;threading,&nbsp;etc.&nbsp;-&nbsp;and&nbsp;it&nbsp;has&nbsp;very&nbsp;good&nbsp;shutdown<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hooks.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jason&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Apr&nbsp;2,&nbsp;2014&nbsp;at&nbsp;3:02&nbsp;PM,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Bertrand&nbsp;Guay-Paquet&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:bernie@step.polymtl.ca&quot;&nbsp;target=&quot;_blank&quot;&gt;bernie@step.polymtl.ca&lt;/a&gt;&gt;&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hello,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&#39;m&nbsp;using&nbsp;the&nbsp;RabbitMQ&nbsp;Java&nbsp;client&nbsp;API&nbsp;and&nbsp;need&nbsp;some<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;guidance&nbsp;on&nbsp;the&nbsp;proper&nbsp;application&nbsp;shutdown&nbsp;procedure.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&#39;s&nbsp;how&nbsp;I&nbsp;start&nbsp;the&nbsp;application:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1-Create&nbsp;a&nbsp;Connection&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2-Create&nbsp;different&nbsp;types&nbsp;of&nbsp;consumers,&nbsp;each&nbsp;with&nbsp;its&nbsp;own<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel,&nbsp;and&nbsp;call&nbsp;channel.basicConsume(&quot;queue&quot;,&nbsp;false,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consumer)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3-Let&nbsp;it&nbsp;all&nbsp;run&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;works&nbsp;great,&nbsp;but&nbsp;I&nbsp;can&#39;t&nbsp;figure&nbsp;out&nbsp;how&nbsp;to&nbsp;cleanly<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shutdown&nbsp;the&nbsp;application.&nbsp;If&nbsp;I&nbsp;simply&nbsp;close&nbsp;the&nbsp;Connection,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;each&nbsp;created&nbsp;channel&nbsp;immediately&nbsp;(or&nbsp;soon&nbsp;enough)&nbsp;becomes<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;and&nbsp;any&nbsp;Consumer&nbsp;currently&nbsp;doing&nbsp;some&nbsp;work&nbsp;fails<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;when&nbsp;trying&nbsp;to&nbsp;ack&nbsp;their&nbsp;current&nbsp;message&nbsp;or&nbsp;perform&nbsp;any<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;other&nbsp;action&nbsp;on&nbsp;the&nbsp;channel.&nbsp;I&#39;d&nbsp;like&nbsp;to&nbsp;let&nbsp;the&nbsp;consumers<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finish&nbsp;whatever&nbsp;message&nbsp;they&#39;re&nbsp;processing&nbsp;and&nbsp;then&nbsp;close<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;everything&nbsp;down.&nbsp;I&nbsp;guess&nbsp;I&nbsp;need&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;the&nbsp;created<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Consumers&nbsp;and&nbsp;somehow&nbsp;signal&nbsp;them&nbsp;to&nbsp;stop&nbsp;accepting&nbsp;new<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messages&nbsp;and&nbsp;after&nbsp;they&#39;re&nbsp;all&nbsp;done&nbsp;with&nbsp;their&nbsp;current&nbsp;job,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close&nbsp;the&nbsp;connection?&nbsp;Is&nbsp;that&nbsp;possible&nbsp;or&nbsp;is&nbsp;there&nbsp;another<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;way?&nbsp;I&nbsp;haven&#39;t&nbsp;found&nbsp;any&nbsp;management&nbsp;methods&nbsp;for&nbsp;the&nbsp;consumer<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classes&nbsp;to&nbsp;control&nbsp;or&nbsp;query&nbsp;their&nbsp;status.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;information&nbsp;I&nbsp;found&nbsp;so&nbsp;far&nbsp;is&nbsp;related&nbsp;to&nbsp;manually<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;created&nbsp;threads&nbsp;that&nbsp;poll&nbsp;the&nbsp;queues&nbsp;to&nbsp;process&nbsp;messages.&nbsp;In<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;case,&nbsp;it&#39;s&nbsp;really&nbsp;easy&nbsp;because&nbsp;I&nbsp;can&nbsp;just&nbsp;set&nbsp;a&nbsp;flag&nbsp;on<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;each&nbsp;runnable&nbsp;to&nbsp;exit&nbsp;after&nbsp;processing&nbsp;their&nbsp;current&nbsp;message<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;join&nbsp;on&nbsp;all&nbsp;the&nbsp;threads&nbsp;before&nbsp;closing&nbsp;the&nbsp;underlying<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection.&nbsp;So&nbsp;this&nbsp;leads&nbsp;me&nbsp;to&nbsp;ask,&nbsp;as&nbsp;a&nbsp;side&nbsp;note:&nbsp;are<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Consumers&nbsp;the&nbsp;way&nbsp;to&nbsp;go&nbsp;to&nbsp;use&nbsp;RabbitMQ&nbsp;in&nbsp;real-world<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scenarios&nbsp;or&nbsp;should&nbsp;I&nbsp;poll&nbsp;on&nbsp;the&nbsp;queues?&nbsp;It&nbsp;seems&nbsp;to&nbsp;me<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;Consumers&nbsp;would&nbsp;be&nbsp;the&nbsp;better&nbsp;choice&nbsp;(polling&nbsp;is&nbsp;bad),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;if&nbsp;they&#39;re&nbsp;less&nbsp;powerful,&nbsp;perhaps&nbsp;they&#39;re&nbsp;not&nbsp;a&nbsp;silver<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bullet&nbsp;in&nbsp;my&nbsp;case.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thank&nbsp;you,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Bertrand&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_______________________________________________&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&nbsp;clear=&quot;all&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Jason&nbsp;McIntosh&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;https://github.com/jasonmcintosh/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/jasonmcintosh/&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;tel:573-424-7612&quot;&nbsp;value=&quot;+15734247612&quot;&nbsp;target=&quot;_blank&quot;&gt;573-424-7612&lt;/a&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;fieldset&gt;&lt;/fieldset&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&gt;_______________________________________________<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Jason&nbsp;McIntosh&lt;br&gt;&lt;a&nbsp;href=&quot;https://github.com/jasonmcintosh/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/jasonmcintosh/&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;tel:573-424-7612&quot;&nbsp;value=&quot;+15734247612&quot;&nbsp;target=&quot;_blank&quot;&gt;573-424-7612&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
