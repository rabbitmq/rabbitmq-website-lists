<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=Windows-1252&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;14px;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&nbsp;&quot;&gt;<br>
&lt;div&gt;Hello,&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;We've&nbsp;been&nbsp;trying&nbsp;to&nbsp;run&nbsp;RabbitMQ&nbsp;as&nbsp;a&nbsp;cluster&nbsp;on&nbsp;Windows&nbsp;Server&nbsp;2008&nbsp;R2&nbsp;for&nbsp;some&nbsp;time&nbsp;now&nbsp;and&nbsp;are&nbsp;having&nbsp;stability&nbsp;issues&nbsp;–&nbsp;namely&nbsp;the&nbsp;cluster&nbsp;will&nbsp;partition&nbsp;spontaneously.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;The&nbsp;cluster&nbsp;originally&nbsp;consists&nbsp;of&nbsp;5&nbsp;RabbitMQ&nbsp;&amp;quot;nodes&amp;quot;,&nbsp;each&nbsp;running&nbsp;on&nbsp;a&nbsp;separate&nbsp;VMWare&nbsp;ESX&nbsp;server.&amp;nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Each&nbsp;instance&nbsp;is&nbsp;separated&nbsp;from&nbsp;another&nbsp;instance&nbsp;by&nbsp;at&nbsp;most&nbsp;two&nbsp;switch&nbsp;hops&nbsp;and&nbsp;no&nbsp;routers&nbsp;in&nbsp;the&nbsp;same&nbsp;cage&nbsp;in&nbsp;the&nbsp;data&nbsp;center.&nbsp;So&nbsp;while&nbsp;each&nbsp;instance&nbsp;is&nbsp;on&nbsp;a&nbsp;separate&nbsp;ESX&nbsp;physical&nbsp;host&nbsp;and&nbsp;in&nbsp;separate&nbsp;racks/power/etc,&nbsp;the&nbsp;network&nbsp;is&nbsp;such&nbsp;that&nbsp;there&nbsp;is<br>
&nbsp;no&nbsp;routing&nbsp;between&nbsp;Rabbit&nbsp;cluster&nbsp;nodes&nbsp;and&nbsp;all&nbsp;nodes&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;VLAN.&nbsp;The&nbsp;racks&nbsp;are&nbsp;physically&nbsp;next&nbsp;to&nbsp;each&nbsp;other.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;The&nbsp;cluster&nbsp;itself&nbsp;is&nbsp;behind&nbsp;an&nbsp;F5&nbsp;load&nbsp;balancer&nbsp;which&nbsp;provides&nbsp;a&nbsp;VIP&nbsp;to&nbsp;the&nbsp;application&nbsp;servers.&nbsp;The&nbsp;F5&nbsp;round&nbsp;robbins&nbsp;to&nbsp;the&nbsp;Rabbit&nbsp;nodes&nbsp;in&nbsp;the&nbsp;cluster.&nbsp;The&nbsp;F5&nbsp;attempts&nbsp;to&nbsp;connect&nbsp;to&nbsp;each&nbsp;node&nbsp;in&nbsp;the&nbsp;cluster&nbsp;to&nbsp;determine&nbsp;if&nbsp;the&nbsp;node&nbsp;is&nbsp;up&nbsp;and&nbsp;adds/removes<br>
&nbsp;from&nbsp;the&nbsp;load&nbsp;balancing&nbsp;pool&nbsp;automatically.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;All&nbsp;of&nbsp;the&nbsp;queues&nbsp;on&nbsp;this&nbsp;cluster&nbsp;are&nbsp;on&nbsp;the&nbsp;same&nbsp;vHost,&nbsp;and&nbsp;most&nbsp;of&nbsp;the&nbsp;queues&nbsp;are&nbsp;mirrored/HA&nbsp;queues.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;The&nbsp;version&nbsp;of&nbsp;Rabbit&nbsp;is&nbsp;3.1.5&nbsp;and&nbsp;Erlang&nbsp;16B01,&nbsp;64&nbsp;bit&nbsp;Windows.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;On&nbsp;every&nbsp;environment&nbsp;from&nbsp;PERFORMANCE,&nbsp;STAGE,&nbsp;INTEGRATION&nbsp;and&nbsp;PRODUCTION&nbsp;we&nbsp;see&nbsp;the&nbsp;cluster&nbsp;partition.&nbsp;It&nbsp;can&nbsp;happen&nbsp;15&nbsp;minutes&nbsp;after&nbsp;starting&nbsp;the&nbsp;cluster&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;days.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Network&nbsp;latency&nbsp;is&nbsp;sub-millisecond&nbsp;between&nbsp;cluster&nbsp;nodes.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;We&nbsp;have&nbsp;dropped&nbsp;the&nbsp;cluster&nbsp;size&nbsp;down&nbsp;to&nbsp;3,&nbsp;then&nbsp;2.&lt;/div&gt;<br>
&lt;div&gt;We&nbsp;have&nbsp;moved&nbsp;all&nbsp;nodes&nbsp;on&nbsp;the&nbsp;cluster&nbsp;to&nbsp;the&nbsp;same&nbsp;VMWare&nbsp;ESX&nbsp;server,&nbsp;which&nbsp;removes&nbsp;all&nbsp;of&nbsp;the&nbsp;physical&nbsp;networking.&lt;/div&gt;<br>
&lt;div&gt;We&nbsp;have&nbsp;upgraded&nbsp;from&nbsp;ESX&nbsp;4.5.x&nbsp;to&nbsp;ESX&nbsp;5.1.&lt;/div&gt;<br>
&lt;div&gt;We've&nbsp;tried&nbsp;every&nbsp;configuration&nbsp;we&nbsp;can&nbsp;think&nbsp;of&nbsp;but&nbsp;still&nbsp;see&nbsp;the&nbsp;cluster&nbsp;partition&nbsp;after&nbsp;some&nbsp;time.&lt;/div&gt;<br>
&lt;div&gt;We&nbsp;have&nbsp;one&nbsp;environment&nbsp;up&nbsp;and&nbsp;running&nbsp;for&nbsp;18&nbsp;days,&nbsp;another&nbsp;for&nbsp;12&nbsp;days,&nbsp;the&nbsp;rest&nbsp;have&nbsp;reached,&nbsp;at&nbsp;most,&nbsp;2-3&nbsp;days.&lt;/div&gt;<br>
&lt;div&gt;Network&nbsp;monitors&nbsp;show&nbsp;no&nbsp;disruptions&nbsp;or&nbsp;latency&nbsp;in&nbsp;network&nbsp;traffic.&lt;/div&gt;<br>
&lt;div&gt;It&nbsp;doesn't&nbsp;matter&nbsp;if&nbsp;the&nbsp;application&nbsp;is&nbsp;running&nbsp;against&nbsp;the&nbsp;cluster&nbsp;or&nbsp;not.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;And&nbsp;yet&nbsp;we&nbsp;continue&nbsp;to&nbsp;experience&nbsp;these&nbsp;network&nbsp;partitions.&amp;nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Unfortunately&nbsp;I'm&nbsp;not&nbsp;able&nbsp;to&nbsp;test&nbsp;on&nbsp;a&nbsp;set&nbsp;of&nbsp;Linux&nbsp;machines&nbsp;in&nbsp;this&nbsp;environment.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;I've&nbsp;sent&nbsp;logs&nbsp;in&nbsp;previous&nbsp;posts&nbsp;and&nbsp;Simon&nbsp;has&nbsp;said&nbsp;that&nbsp;we&nbsp;have&nbsp;to&nbsp;fix&nbsp;our&nbsp;network&nbsp;partition&nbsp;problem,&nbsp;but&nbsp;as&nbsp;far&nbsp;as&nbsp;we&nbsp;can&nbsp;tell&nbsp;we&nbsp;don't&nbsp;have&nbsp;one.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;My&nbsp;questions&nbsp;are:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;is&nbsp;this&nbsp;expected&nbsp;behavior?&lt;/li&gt;&lt;li&gt;Is&nbsp;this&nbsp;a&nbsp;Erlang&nbsp;on&nbsp;Windows&nbsp;problem?&nbsp;Is&nbsp;anyone&nbsp;running&nbsp;an&nbsp;HA&nbsp;cluster&nbsp;of&nbsp;similar&nbsp;configuration&nbsp;successfully&nbsp;on&nbsp;the&nbsp;equivalent&nbsp;Rabbit/Erlang&nbsp;versions?&lt;/li&gt;&lt;li&gt;Is&nbsp;there&nbsp;anything&nbsp;that&nbsp;I&nbsp;should&nbsp;be&nbsp;checking&nbsp;that&nbsp;we&nbsp;might&nbsp;have&nbsp;missed?&lt;/li&gt;&lt;/ul&gt;<br>
&lt;div&gt;All&nbsp;ideas&nbsp;are&nbsp;welcome!&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Cheers,&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Ron&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
