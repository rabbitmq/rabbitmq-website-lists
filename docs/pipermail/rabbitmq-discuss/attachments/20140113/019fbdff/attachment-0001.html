<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;Simon!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;not&nbsp;sure&nbsp;how&nbsp;I&nbsp;manage&nbsp;to&nbsp;misconfigure&nbsp;my&nbsp;federation&nbsp;to&nbsp;include&nbsp;the&nbsp;internal&nbsp;queues.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;it&nbsp;helps,&nbsp;here&#39;s&nbsp;what&nbsp;my&nbsp;Policies&nbsp;page&nbsp;shows&nbsp;for&nbsp;the&nbsp;federation:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;table&nbsp;class=&quot;&quot;&nbsp;style=&quot;border-collapse:collapse;border-width:1px;border-bottom-style:solid;border-bottom-color:rgb(204,204,204);margin-bottom:0px;font-family:Verdana,sans-serif&quot;&gt;&lt;tbody&gt;&lt;tr&nbsp;class=&quot;&quot;&gt;&lt;td&nbsp;style=&quot;font-size:12px;line-height:17px;font-family:Verdana,sans-serif;padding:4px;vertical-align:top;min-width:5em;width:auto;border-left-width:1px;border-left-style:solid;border-left-color:rgb(204,204,204);border-right-width:1px;border-right-style:solid;border-right-color:rgb(204,204,204);background-image:-webkit-gradient(linear,0%&nbsp;0%,0%&nbsp;100%,from(rgb(248,248,248)),to(rgb(255,255,255)))&quot;&gt;<br>
&lt;a&nbsp;href=&quot;http://tuk5r1mqvip1.mgt.integ.skytap.com:15672/#/policies/%2F/skytap-federation&quot;&nbsp;style=&quot;display:block;width:119px;color:black;font-weight:bold;text-decoration:none&quot;&gt;skytap-federation&lt;/a&gt;&lt;/td&gt;&lt;td&nbsp;style=&quot;font-size:12px;line-height:17px;font-family:Verdana,sans-serif;padding:4px;vertical-align:top;min-width:5em;width:auto;border-left-width:1px;border-left-style:solid;border-left-color:rgb(204,204,204);border-right-width:1px;border-right-style:solid;border-right-color:rgb(204,204,204);background-image:-webkit-gradient(linear,0%&nbsp;0%,0%&nbsp;100%,from(rgb(248,248,248)),to(rgb(255,255,255)))&quot;&gt;<br>
skytap&lt;/td&gt;&lt;td&nbsp;style=&quot;font-size:12px;line-height:17px;font-family:Verdana,sans-serif;padding:4px;vertical-align:top;min-width:5em;width:auto;border-left-width:1px;border-left-style:solid;border-left-color:rgb(204,204,204);border-right-width:1px;border-right-style:solid;border-right-color:rgb(204,204,204);background-image:-webkit-gradient(linear,0%&nbsp;0%,0%&nbsp;100%,from(rgb(248,248,248)),to(rgb(255,255,255)))&quot;&gt;<br>
all&lt;/td&gt;&lt;td&nbsp;style=&quot;font-size:12px;line-height:17px;font-family:Verdana,sans-serif;padding:4px;vertical-align:top;min-width:5em;width:auto;border-left-width:1px;border-left-style:solid;border-left-color:rgb(204,204,204);border-right-width:1px;border-right-style:solid;border-right-color:rgb(204,204,204);background-image:-webkit-gradient(linear,0%&nbsp;0%,0%&nbsp;100%,from(rgb(248,248,248)),to(rgb(255,255,255)))&quot;&gt;<br>
&lt;table&nbsp;class=&quot;&quot;&nbsp;style=&quot;border-collapse:collapse&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th&nbsp;style=&quot;font-weight:normal;color:black;padding:0px&nbsp;2px&nbsp;2px;vertical-align:top;min-width:5em;width:auto;border:none;text-align:right&quot;&gt;federation-upstream-set:&lt;/th&gt;<br>
&lt;td&nbsp;style=&quot;font-family:Verdana,sans-serif;padding:0px&nbsp;2px&nbsp;2px;vertical-align:top;min-width:5em;width:auto;border:none&quot;&gt;&lt;acronym&nbsp;class=&quot;&quot;&nbsp;title=&quot;string&quot;&nbsp;style=&quot;background-image:none;color:inherit;padding:0px;border-top-left-radius:2px;border-top-right-radius:2px;border-bottom-right-radius:2px;border-bottom-left-radius:2px;border-style:none&nbsp;none&nbsp;dotted;border-bottom-width:1px;border-bottom-color:rgb(221,221,221)&quot;&gt;all&lt;/acronym&gt;&lt;/td&gt;<br>
&lt;/tr&gt;&lt;tr&gt;&lt;th&nbsp;style=&quot;font-weight:normal;color:black;padding:0px&nbsp;2px&nbsp;2px;vertical-align:top;min-width:5em;width:auto;border:none;text-align:right&quot;&gt;ha-mode:&lt;/th&gt;&lt;td&nbsp;style=&quot;font-family:Verdana,sans-serif;padding:0px&nbsp;2px&nbsp;2px;vertical-align:top;min-width:5em;width:auto;border:none&quot;&gt;<br>
&lt;acronym&nbsp;class=&quot;&quot;&nbsp;title=&quot;string&quot;&nbsp;style=&quot;background-image:none;color:inherit;padding:0px;border-top-left-radius:2px;border-top-right-radius:2px;border-bottom-right-radius:2px;border-bottom-left-radius:2px;border-style:none&nbsp;none&nbsp;dotted;border-bottom-width:1px;border-bottom-color:rgb(221,221,221)&quot;&gt;all&lt;/acronym&gt;&lt;/td&gt;<br>
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/td&gt;&lt;td&nbsp;style=&quot;font-size:12px;line-height:17px;font-family:Verdana,sans-serif;padding:4px;vertical-align:top;min-width:5em;width:auto;border-left-width:1px;border-left-style:solid;border-left-color:rgb(204,204,204);border-right-width:1px;border-right-style:solid;border-right-color:rgb(204,204,204);background-image:-webkit-gradient(linear,0%&nbsp;0%,0%&nbsp;100%,from(rgb(248,248,248)),to(rgb(255,255,255)))&quot;&gt;<br>
0&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;her&nbsp;are&nbsp;the&nbsp;snippets&nbsp;of&nbsp;python&nbsp;code&nbsp;I&nbsp;use&nbsp;to&nbsp;set&nbsp;up&nbsp;federation:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;rabbitmq_invoke_http_api(broker_host,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;PUT&#39;,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;/api/parameters/federation-upstream/%%2f/upstream-%s&#39;&nbsp;%&nbsp;(quote_plus(federated_broker)),&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;{&quot;value&quot;:{&quot;uri&quot;:&quot;amqp://%(username)s:%(password)s@%(host)s:%(port)s&quot;}}&#39;&nbsp;%&nbsp;(federated_settings))&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;then,&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;div&gt;rabbitmq_invoke_http_api(broker_host,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;PUT&#39;,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;/api/policies/%2f/skytap-federation&#39;,&lt;/div&gt;&lt;div&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;{&quot;pattern&quot;:&quot;skytap&quot;,&nbsp;&quot;definition&quot;:{&quot;federation-upstream-set&quot;:&quot;all&quot;,&quot;ha-mode&quot;:&quot;all&quot;}}&#39;)&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;again,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Matt&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;13,&nbsp;2014&nbsp;at&nbsp;10:21&nbsp;AM,&nbsp;Simon&nbsp;MacMullen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi&nbsp;Matt.&lt;br&gt;<br>
&lt;br&gt;<br>
Federated&nbsp;exchanges&nbsp;declare&nbsp;queues&nbsp;for&nbsp;internal&nbsp;use.&nbsp;These&nbsp;are&nbsp;the&nbsp;queues&nbsp;with&nbsp;names&nbsp;beginning&nbsp;&quot;federation:&nbsp;&quot;&nbsp;which&nbsp;you&nbsp;have&nbsp;probably&nbsp;already&nbsp;seen.&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;looks&nbsp;like&nbsp;in&nbsp;your&nbsp;case&nbsp;those&nbsp;internal&nbsp;queues&nbsp;are&nbsp;themselves&nbsp;becoming&nbsp;federated.&nbsp;This&nbsp;is&nbsp;unlikely&nbsp;to&nbsp;be&nbsp;a&nbsp;useful&nbsp;thing.&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;should&nbsp;review&nbsp;your&nbsp;federation&nbsp;policies&nbsp;and&nbsp;make&nbsp;sure&nbsp;those&nbsp;queues&nbsp;are&nbsp;not&nbsp;included&nbsp;in&nbsp;them.&nbsp;If&nbsp;you&nbsp;don&#39;t&nbsp;intend&nbsp;to&nbsp;federate&nbsp;queues&nbsp;at&nbsp;all&nbsp;then&nbsp;the&nbsp;easiest&nbsp;way&nbsp;is&nbsp;to&nbsp;set&nbsp;the&nbsp;federation&nbsp;policy&nbsp;to&nbsp;only&nbsp;apply&nbsp;to&nbsp;exchanges.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
I&#39;ll&nbsp;also&nbsp;file&nbsp;a&nbsp;bug&nbsp;to&nbsp;prevent&nbsp;those&nbsp;queues&nbsp;from&nbsp;ever&nbsp;federating,&nbsp;regardless&nbsp;of&nbsp;policy...&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&nbsp;Simon&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;13/01/2014&nbsp;18:08,&nbsp;Matt&nbsp;Pietrek&nbsp;wrote:&lt;br&gt;<br>
&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
We&nbsp;have&nbsp;a&nbsp;bi-directional&nbsp;federation&nbsp;setup&nbsp;between&nbsp;three&nbsp;nodes&nbsp;like&nbsp;this&lt;br&gt;<br>
on&nbsp;RabbitMQ&nbsp;3.2.2:&lt;br&gt;<br>
&lt;br&gt;<br>
mq_integ/sea&nbsp;&lt;===&gt;&nbsp;mq_integ&nbsp;&lt;===&gt;&nbsp;mq_integ/tuk&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
All&nbsp;three&nbsp;nodes&nbsp;use&nbsp;a&nbsp;&quot;skytap&quot;&nbsp;exchange&nbsp;and&nbsp;the&nbsp;mq_integ/sea&lt;br&gt;&lt;/div&gt;<br>
and&nbsp;mq_integ/tuk&nbsp;are&nbsp;*_not_*&nbsp;federated&nbsp;with&nbsp;each&nbsp;other&lt;br&gt;<br>
&lt;br&gt;<br>
Here&#39;s&nbsp;what&#39;s&nbsp;interesting.&nbsp;In&nbsp;the&nbsp;*mq_integ/sea*&nbsp;broker,&nbsp;the&nbsp;&quot;Federation&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
Upstreams&quot;&nbsp;page&nbsp;is&nbsp;what&nbsp;I&#39;d&nbsp;expect&nbsp;it&nbsp;to&nbsp;be,&nbsp;that&nbsp;is,&nbsp;a&nbsp;connection&nbsp;to&lt;br&gt;<br>
mq_integ:&lt;br&gt;<br>
Name&nbsp; &nbsp; URI&nbsp; &nbsp; &nbsp;Expiry&nbsp; Message&nbsp;TTL&nbsp; &nbsp; &nbsp;Max&nbsp;Hops&nbsp; &nbsp; &nbsp; &nbsp; Prefetch&nbsp;Count&nbsp; Reconnect&nbsp;Delay&lt;br&gt;<br>
Ack&nbsp;mode&nbsp; &nbsp; &nbsp; &nbsp; Trust&nbsp;User-ID&lt;br&gt;<br>
upstream-integ&lt;br&gt;&lt;/div&gt;<br>
&lt;&lt;a&nbsp;href=&quot;http://tuk5r1mq1.mgt.integ.skytap.com:15672/#/federation-upstreams/%2F/upstream-integ&quot;&nbsp;target=&quot;_blank&quot;&gt;http://tuk5r1mq1.mgt.integ.&lt;u&gt;&lt;/u&gt;skytap.com:15672/#/federation-&lt;u&gt;&lt;/u&gt;upstreams/%2F/upstream-integ&lt;/a&gt;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&lt;br&gt;<br>
amqp://foo:bar@sea_m2:5672&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ?&nbsp; &nbsp; &nbsp; &nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
However,&nbsp;in&nbsp;the&nbsp;&quot;Federation&nbsp;Status&quot;&nbsp;page&nbsp;for&nbsp;*mq_integ/sea*&nbsp;looks&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
strange&nbsp;(see&nbsp;below).&nbsp;In&nbsp;particular,&nbsp;I&nbsp;see&nbsp;four&nbsp;entries,&nbsp;whereas&nbsp;in&lt;br&gt;<br>
RabbitMQ&nbsp;3.0.2&nbsp;I&nbsp;only&nbsp;saw&nbsp;one&nbsp;line.&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;addition,&nbsp;the&nbsp;third&nbsp;entry&nbsp;references&nbsp;the&nbsp;mq_integ/tuk&nbsp;broker,&nbsp;even&lt;br&gt;<br>
though&nbsp;I&nbsp;haven&#39;t&nbsp;configured&nbsp;mq_integ/sea&nbsp;to&nbsp;know&nbsp;anything&nbsp;about&lt;br&gt;<br>
mq_integ/tuk:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Connection&nbsp; &nbsp; &nbsp; URI&nbsp; &nbsp; &nbsp;Exchange&nbsp;/&nbsp;Queue&nbsp; &nbsp; &nbsp; &nbsp; Node&nbsp; &nbsp; State&nbsp; &nbsp;Inbound&nbsp;message&nbsp;rate&nbsp; &nbsp; Last&lt;br&gt;<br>
changed&lt;br&gt;&lt;/div&gt;<br>
upstream-integ&nbsp; amqp://sea_m2:5672&nbsp; &nbsp; &nbsp; federation:&nbsp;skytap&nbsp;-&gt;&nbsp;mq_integ_queue&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
rabbit@sea_r2&nbsp; &nbsp;&lt;br&gt;<br>
running&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2014-01-11&nbsp;1:35:28&lt;br&gt;<br>
upstream-integ&nbsp; amqp://sea5_m2:5672&nbsp; &nbsp; &nbsp;federation:&nbsp;skytap&nbsp;-&gt;&lt;br&gt;&lt;/div&gt;<br>
mq_integ/sea_queue&nbsp; &nbsp; &nbsp; rabbit@sea_r2&nbsp; &nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
running&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2014-01-11&nbsp;1:35:28&lt;br&gt;<br>
upstream-integ&nbsp; amqp://sea_m2:5672&nbsp; &nbsp; &nbsp; federation:&nbsp;skytap&nbsp;-&gt;&lt;br&gt;&lt;/div&gt;<br>
mq_integ/tuk_queue&nbsp; &nbsp; &nbsp; rabbit@sea_r2&nbsp; &nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
running&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2014-01-11&nbsp;1:35:29&lt;br&gt;&lt;/div&gt;<br>
upstream-integ&nbsp; amqp://sea_m2:5672&nbsp; &nbsp; &nbsp; skytap_exchange&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rabbit@sea_r2&nbsp; &nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
running&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;0.00/s&nbsp; 2014-01-11&nbsp;1:35:29&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Is&nbsp;this&nbsp;what&nbsp;you&#39;d&nbsp;expect&nbsp;to&nbsp;see?&nbsp;Am&nbsp;I&nbsp;not&nbsp;understanding&nbsp;something?&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
&lt;br&gt;<br>
Matt&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.&lt;u&gt;&lt;/u&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;u&gt;&lt;/u&gt;cgi-bin/mailman/listinfo/&lt;u&gt;&lt;/u&gt;rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
