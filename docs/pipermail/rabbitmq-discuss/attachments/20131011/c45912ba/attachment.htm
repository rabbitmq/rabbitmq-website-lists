<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;You&nbsp;are&nbsp;using&nbsp;R16B01.&nbsp;Upgrade&nbsp;to&nbsp;R16B02&nbsp;at&nbsp;once!&nbsp;R16B01&nbsp;has&nbsp;a&nbsp;bug&nbsp;which&nbsp;means&nbsp;that&nbsp;async&nbsp;worker&nbsp;processes&nbsp;are&nbsp;not&nbsp;getting&nbsp;used&nbsp;correctly&nbsp;(too&nbsp;many&nbsp;processes&nbsp;are&nbsp;hashed&nbsp;to&nbsp;the&nbsp;wrong&nbsp;async&nbsp;worker,&nbsp;more&nbsp;or&nbsp;less).&nbsp;This&nbsp;severely&nbsp;hits&nbsp;disk&nbsp;I/O&nbsp;on&nbsp;a&nbsp;busy&nbsp;machine.&lt;div&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;are&nbsp;other&nbsp;problems&nbsp;with&nbsp;R16B01.&nbsp;It&nbsp;should&nbsp;be&nbsp;avoided&nbsp;if&nbsp;possible.&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Oct&nbsp;11,&nbsp;2013&nbsp;at&nbsp;1:29&nbsp;PM,&nbsp;Simon&nbsp;MacMullen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;OK,&nbsp;so&nbsp;your&nbsp;screenshot&nbsp;shows&nbsp;750&nbsp;queues&nbsp;and&nbsp;753&nbsp;connections.&nbsp;Was&nbsp;this&nbsp;from&nbsp;the&nbsp;same&nbsp;time&nbsp;as&nbsp;you&nbsp;had&nbsp;~10k&nbsp;file&nbsp;descriptors&nbsp;in&nbsp;use?&nbsp;That&nbsp;sounds&nbsp;wrong.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;your&nbsp;publishing&nbsp;connections&nbsp;are&nbsp;going&nbsp;into&nbsp;flow&nbsp;control&nbsp;because&nbsp;there&amp;#39;s&nbsp;a&nbsp;squeeze&nbsp;on&nbsp;file&nbsp;descriptors,&nbsp;which&nbsp;is&nbsp;causing&nbsp;the&nbsp;queues&nbsp;to&nbsp;have&nbsp;to&nbsp;share&nbsp;a&nbsp;small&nbsp;number&nbsp;of&nbsp;file&nbsp;descriptors&nbsp;between&nbsp;them&nbsp;-&nbsp;thus&nbsp;slowing&nbsp;them&nbsp;down.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;do&nbsp;have&nbsp;far&nbsp;more&nbsp;file&nbsp;descriptors&nbsp;in&nbsp;use&nbsp;than&nbsp;queues&nbsp;+&nbsp;connections,&nbsp;do&nbsp;you&nbsp;have&nbsp;any&nbsp;exotic&nbsp;plugins&nbsp;in&nbsp;use?&nbsp;What&nbsp;does&nbsp;&amp;quot;lsof&nbsp;-lnp&nbsp;&amp;lt;pid&nbsp;of&nbsp;server&nbsp;process&amp;gt;&amp;quot;&nbsp;say?&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&nbsp;Simon&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;11/10/2013&nbsp;3:22AM,&nbsp;Choo&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hi&nbsp;Simon,&lt;br&gt;<br>
&lt;br&gt;<br>
As&nbsp;memory&nbsp;is&nbsp;plenty,&nbsp;I&nbsp;found&nbsp;that&nbsp;file&nbsp;descriptors&nbsp;hit&nbsp;the&nbsp;default&nbsp;limit,&lt;br&gt;<br>
so,&nbsp;I&nbsp;bumped&nbsp;the&nbsp;limit&nbsp;up&nbsp;to&nbsp;5,120,&nbsp;and&nbsp;finally&nbsp;to&nbsp;10,240&nbsp;on&nbsp;each&nbsp;nodes.&nbsp; It&lt;br&gt;<br>
turned&nbsp;out&nbsp;that&nbsp;the&nbsp;file&nbsp;descriptors&nbsp;also&nbsp;touched&nbsp;the&nbsp;limit&nbsp;(around&nbsp;10,086),&lt;br&gt;<br>
and&nbsp;things&nbsp;started&nbsp;to&nbsp;go&nbsp;downhill.&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;lt;&lt;a&nbsp;href=&quot;http://rabbitmq.1065348.n5.nabble.com/file/n30402/ScreenShot.jpg&quot;&nbsp;target=&quot;_blank&quot;&gt;http://rabbitmq.1065348.n5.&lt;u&gt;&lt;/u&gt;nabble.com/file/n30402/&lt;u&gt;&lt;/u&gt;ScreenShot.jpg&lt;/a&gt;&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;started&nbsp;processes&nbsp;in&nbsp;reverse&nbsp;order,&nbsp;by&nbsp;starting&nbsp;subscriber-side&nbsp;first&lt;br&gt;<br>
(1:42),&nbsp;then&nbsp;the&nbsp;bigger&nbsp;publishers&nbsp;later&nbsp;(1:45).&nbsp; The&nbsp;number&nbsp;of&nbsp;published&lt;br&gt;<br>
messages&nbsp;bounced&nbsp;up&amp;amp;down,&nbsp;then&nbsp;just&nbsp;after&nbsp;1:48,&nbsp;the&nbsp;most&nbsp;of&nbsp;the&nbsp;publishers&lt;br&gt;<br>
were&nbsp;blocked.&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;are&nbsp;more&nbsp;than&nbsp;350&nbsp;of&nbsp;blocked&nbsp;connections&nbsp;like&nbsp;below&nbsp;now&nbsp;(and&nbsp;file&lt;br&gt;<br>
descriptors&nbsp;are&nbsp;running&nbsp;at&nbsp;7,558&nbsp;+&nbsp;4,647&nbsp;on&nbsp;2&nbsp;nodes):&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33751&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33751&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1261.558817&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33752&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33752&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1326.324919&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33753&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33753&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1326.45322&nbsp; &nbsp; &nbsp; flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33754&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33754&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1278.581221&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33755&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33755&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1312.584426&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33756&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33756&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1279.623625&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33757&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33757&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1294.492535&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33758&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33758&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1276.134377&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33759&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33759&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1292.862081&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33760&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33760&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1290.695249&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33761&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33761&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1255.599642&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://10.95.212.11:33762&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.11:33762&lt;/a&gt;&nbsp;-&amp;gt;&nbsp;&lt;a&nbsp;href=&quot;http://10.95.212.13:5672&quot;&nbsp;target=&quot;_blank&quot;&gt;10.95.212.13:5672&lt;/a&gt;&nbsp;blocked&nbsp;1284.984752&nbsp; &nbsp; &nbsp;flow&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;kindly&nbsp;suggest.&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you&nbsp;and&nbsp;Best&nbsp;Regards,&lt;br&gt;<br>
Choo&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://rabbitmq.1065348.n5.nabble.com/Connection-blocked-by-flow-for-more-than-600-seconds-tp30349p30402.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://rabbitmq.1065348.n5.&lt;u&gt;&lt;/u&gt;nabble.com/Connection-blocked-&lt;u&gt;&lt;/u&gt;by-flow-for-more-than-600-&lt;u&gt;&lt;/u&gt;seconds-tp30349p30402.html&lt;/a&gt;&lt;br&gt;<br>
<br>
<br>
Sent&nbsp;from&nbsp;the&nbsp;RabbitMQ&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.&lt;u&gt;&lt;/u&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;u&gt;&lt;/u&gt;cgi-bin/mailman/listinfo/&lt;u&gt;&lt;/u&gt;rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
--&nbsp;&lt;br&gt;<br>
Simon&nbsp;MacMullen&lt;br&gt;<br>
RabbitMQ,&nbsp;Pivotal&lt;/font&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.&lt;u&gt;&lt;/u&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;u&gt;&lt;/u&gt;cgi-bin/mailman/listinfo/&lt;u&gt;&lt;/u&gt;rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;J.<br>
&lt;/div&gt;<br>

</tt>
