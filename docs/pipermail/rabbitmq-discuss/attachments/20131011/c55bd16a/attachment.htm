<tt>
&lt;html&nbsp;xmlns:v=&quot;urn:schemas-microsoft-com:vml&quot;&nbsp;xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;&nbsp;xmlns:w=&quot;urn:schemas-microsoft-com:office:word&quot;&nbsp;xmlns:m=&quot;http://schemas.microsoft.com/office/2004/12/omml&quot;&nbsp;xmlns=&quot;http://www.w3.org/TR/REC-html40&quot;&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;meta&nbsp;name=&quot;Generator&quot;&nbsp;content=&quot;Microsoft&nbsp;Word&nbsp;14&nbsp;(filtered&nbsp;medium)&quot;&gt;<br>
&lt;style&gt;&lt;!--<br>
/*&nbsp;Font&nbsp;Definitions&nbsp;*/<br>
@font-face<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{font-family:Calibri;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppanose-1:2&nbsp;15&nbsp;5&nbsp;2&nbsp;2&nbsp;2&nbsp;4&nbsp;3&nbsp;2&nbsp;4;}<br>
/*&nbsp;Style&nbsp;Definitions&nbsp;*/<br>
p.MsoNormal,&nbsp;li.MsoNormal,&nbsp;div.MsoNormal<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{margin:0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin-bottom:.0001pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-size:11.0pt;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;}<br>
a:link,&nbsp;span.MsoHyperlink<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-priority:99;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcolor:blue;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptext-decoration:underline;}<br>
a:visited,&nbsp;span.MsoHyperlinkFollowed<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-priority:99;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcolor:purple;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptext-decoration:underline;}<br>
span.EmailStyle17<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-type:personal-compose;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcolor:windowtext;}<br>
.MsoChpDefault<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{mso-style-type:export-only;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;}<br>
@page&nbsp;WordSection1<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{size:8.5in&nbsp;11.0in;<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmargin:1.0in&nbsp;1.0in&nbsp;1.0in&nbsp;1.0in;}<br>
div.WordSection1<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{page:WordSection1;}<br>
--&gt;&lt;/style&gt;&lt;!--[if&nbsp;gte&nbsp;mso&nbsp;9]&gt;&lt;xml&gt;<br>
&lt;o:shapedefaults&nbsp;v:ext=&quot;edit&quot;&nbsp;spidmax=&quot;1026&quot;&nbsp;/&gt;<br>
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if&nbsp;gte&nbsp;mso&nbsp;9]&gt;&lt;xml&gt;<br>
&lt;o:shapelayout&nbsp;v:ext=&quot;edit&quot;&gt;<br>
&lt;o:idmap&nbsp;v:ext=&quot;edit&quot;&nbsp;data=&quot;1&quot;&nbsp;/&gt;<br>
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;lang=&quot;EN-US&quot;&nbsp;link=&quot;blue&quot;&nbsp;vlink=&quot;purple&quot;&gt;<br>
&lt;div&nbsp;class=&quot;WordSection1&quot;&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;Hey&nbsp;all,&nbsp;I&nbsp;was&nbsp;hoping&nbsp;I&nbsp;could&nbsp;get&nbsp;some&nbsp;direction&nbsp;here&nbsp;that&nbsp;might&nbsp;help&nbsp;us&nbsp;out.&amp;nbsp;&nbsp;We&amp;#8217;ve&nbsp;got&nbsp;a&nbsp;RabbitMQ&nbsp;production&nbsp;cluster&nbsp;up,&nbsp;and&nbsp;for&nbsp;the&nbsp;majority&nbsp;of&nbsp;our&nbsp;environments&nbsp;it&nbsp;works&nbsp;great.&amp;nbsp;&nbsp;However,&nbsp;we&nbsp;have&nbsp;a&nbsp;protected&nbsp;set&nbsp;of&nbsp;environments&nbsp;that&nbsp;from<br>
&nbsp;within&nbsp;it&nbsp;the&nbsp;connections&nbsp;keep&nbsp;dying.&amp;nbsp;&nbsp;If&nbsp;we&nbsp;go&nbsp;to&nbsp;the&nbsp;load&nbsp;balanced&nbsp;VIP,&nbsp;about&nbsp;25&nbsp;packets&nbsp;or&nbsp;so&nbsp;get&nbsp;exchanged,&nbsp;then&nbsp;there&amp;#8217;s&nbsp;a&nbsp;200ms&nbsp;lull&nbsp;to&nbsp;acknowledge&nbsp;a&nbsp;packet&nbsp;from&nbsp;Rabbit,&nbsp;a&nbsp;quick&nbsp;resend/reack,&nbsp;and&nbsp;then&nbsp;nothing&nbsp;until&nbsp;the&nbsp;connection&nbsp;dies&nbsp;five&nbsp;minutes&nbsp;later.&amp;nbsp;<br>
&nbsp;If&nbsp;we&nbsp;try&nbsp;to&nbsp;go&nbsp;past&nbsp;the&nbsp;VIP&nbsp;straight&nbsp;to&nbsp;a&nbsp;node,&nbsp;it&nbsp;fails&nbsp;outright&nbsp;(we&nbsp;did&nbsp;update&nbsp;the&nbsp;firewall&nbsp;rules&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;single&nbsp;node).&amp;nbsp;&nbsp;We&amp;#8217;ve&nbsp;pulled&nbsp;the&nbsp;app&nbsp;out&nbsp;of&nbsp;this&nbsp;environment&nbsp;and&nbsp;it&nbsp;works&nbsp;fine&nbsp;outside,&nbsp;but&nbsp;within&nbsp;it&nbsp;seems&nbsp;to&nbsp;always&nbsp;exhibit&nbsp;this&nbsp;behavior.&amp;nbsp;<br>
&nbsp;I&nbsp;got&nbsp;one&nbsp;of&nbsp;our&nbsp;network&nbsp;guys&nbsp;to&nbsp;break&nbsp;down&nbsp;the&nbsp;route&nbsp;the&nbsp;packets&nbsp;have&nbsp;to&nbsp;take:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&amp;#8220;Client&nbsp;Service&nbsp;is&nbsp;behind&nbsp;2&nbsp;stateful&nbsp;Cisco&nbsp;ASA&nbsp;firewalls.&amp;nbsp;&nbsp;They&nbsp;connect&nbsp;to&nbsp;a&nbsp;F5&nbsp;LBed&nbsp;Rabbit&nbsp;MQ&nbsp;server&nbsp;that&nbsp;works&nbsp;fine&nbsp;when&nbsp;not&nbsp;connecting&nbsp;form&nbsp;the&nbsp;behind&nbsp;the&nbsp;FW.&amp;nbsp;&nbsp;Firewall&nbsp;ports&nbsp;open&nbsp;are&nbsp;TCP&nbsp;5672-5673&nbsp;and&nbsp;15672.&amp;nbsp;&nbsp;Issue&nbsp;we&nbsp;having&nbsp;is&nbsp;related<br>
&nbsp;to&nbsp;the&nbsp;connection&nbsp;on&nbsp;TCP&nbsp;5672.&amp;nbsp;&nbsp;Under&nbsp;working&nbsp;conditions,&nbsp;the&nbsp;client&nbsp;spins&nbsp;up&nbsp;3&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;on&nbsp;5672.&amp;nbsp;&nbsp;On&nbsp;the&nbsp;problem&nbsp;client,&nbsp;it&nbsp;spins&nbsp;up&nbsp;an&nbsp;initial&nbsp;3&nbsp;and&nbsp;immediately&nbsp;spins&nbsp;up&nbsp;additional&nbsp;connections.&amp;nbsp;&nbsp;Upon&nbsp;spinning&nbsp;up&nbsp;the&nbsp;additional&nbsp;connections<br>
&nbsp;it&nbsp;leaves&nbsp;the&nbsp;previous&nbsp;connections&nbsp;open,&nbsp;which&nbsp;are&nbsp;eventually&nbsp;reset&nbsp;after&nbsp;5&nbsp;min.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;Thus&nbsp;the&nbsp;main&nbsp;issue&nbsp;is&nbsp;what&nbsp;is&nbsp;the&nbsp;client&nbsp;seeing&nbsp;that&nbsp;causing&nbsp;it&nbsp;to&nbsp;restart&nbsp;the&nbsp;connection.&amp;nbsp;&nbsp;The&nbsp;failed&nbsp;connections&nbsp;are&nbsp;very&nbsp;repeatable,&nbsp;it&nbsp;gets&nbsp;about&nbsp;14&nbsp;packets&nbsp;per&nbsp;side.&amp;nbsp;&nbsp;With&nbsp;the&nbsp;last&nbsp;packets&nbsp;being&nbsp;a&nbsp;ctag&nbsp;###&nbsp;from&nbsp;the&nbsp;server,&nbsp;followed<br>
&nbsp;by&nbsp;a&nbsp;delayed&nbsp;ack&nbsp;from&nbsp;the&nbsp;client.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;Did&nbsp;try&nbsp;adding&nbsp;some&nbsp;overrides&nbsp;for&nbsp;the&nbsp;protocol&nbsp;on&nbsp;the&nbsp;FWs&nbsp;that&nbsp;inline.&amp;nbsp;&nbsp;Added&nbsp;the&nbsp;below.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;class-map&nbsp;RabbitMQ&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;description&nbsp;Disable&nbsp;connection&nbsp;timeouts&nbsp;and&nbsp;other&nbsp;for&nbsp;RabbitMQ&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;match&nbsp;port&nbsp;tcp&nbsp;eq&nbsp;5672&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;policy-map&nbsp;global_policy&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;class&nbsp;RabbitMQ&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&amp;nbsp;&nbsp;set&nbsp;connection&nbsp;random-sequence-number&nbsp;disable&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&amp;nbsp;&nbsp;set&nbsp;connection&nbsp;timeout&nbsp;embryonic&nbsp;0:00:20&nbsp;tcp&nbsp;0:00:00&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&amp;#8220;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;Any&nbsp;ideas&nbsp;on&nbsp;what&nbsp;in&nbsp;that&nbsp;sequence&nbsp;could&nbsp;be&nbsp;hosing&nbsp;us&nbsp;up?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;Thanks,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&gt;Kale&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;<br>
&lt;/div&gt;<br>
&lt;p&gt;This&nbsp;communication&nbsp;contains&nbsp;information&nbsp;that&nbsp;is&nbsp;confidential,&lt;br&gt;<br>
proprietary&nbsp;in&nbsp;nature,&nbsp;and&nbsp;may&nbsp;also&nbsp;be&nbsp;attorney-client&nbsp;privileged&lt;br&gt;<br>
and/or&nbsp;work&nbsp;product&nbsp;privileged.&nbsp;It&nbsp;is&nbsp;for&nbsp;the&nbsp;exclusive&nbsp;use&nbsp;of&nbsp;the&lt;br&gt;<br>
intended&nbsp;recipient(s).&nbsp;If&nbsp;you&nbsp;are&nbsp;not&nbsp;the&nbsp;intended&nbsp;recipient(s)&nbsp;or&lt;br&gt;<br>
the&nbsp;person&nbsp;responsible&nbsp;for&nbsp;delivering&nbsp;it&nbsp;to&nbsp;the&nbsp;intended&lt;br&gt;<br>
recipient(s),&nbsp;please&nbsp;note&nbsp;that&nbsp;any&nbsp;form&nbsp;of&nbsp;dissemination,&lt;br&gt;<br>
distribution&nbsp;or&nbsp;copying&nbsp;of&nbsp;this&nbsp;communication&nbsp;is&nbsp;strictly&lt;br&gt;<br>
prohibited&nbsp;and&nbsp;may&nbsp;be&nbsp;unlawful.&nbsp;If&nbsp;you&nbsp;have&nbsp;received&nbsp;this&lt;br&gt;<br>
communication&nbsp;in&nbsp;error,&nbsp;please&nbsp;immediately&nbsp;notify&nbsp;the&nbsp;sender&nbsp;by&nbsp;replying&lt;br&gt;<br>
to&nbsp;this&nbsp;message&nbsp;and&nbsp;delete&nbsp;this&nbsp;email&nbsp;immediately.&nbsp;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;cooperation.&nbsp;&lt;/p&gt;<br>
<br>
&lt;p&gt;Please&nbsp;be&nbsp;advised&nbsp;that&nbsp;neither&nbsp;Altegrity,&nbsp;its&nbsp;affiliates,&nbsp;its&nbsp;employees&lt;br&gt;<br>
or&nbsp;agents&nbsp;accept&nbsp;liability&nbsp;for&nbsp;any&nbsp;errors,&nbsp;omissions&nbsp;or&nbsp;damages&lt;br&gt;<br>
caused&nbsp;by&nbsp;delays&nbsp;of&nbsp;receipt&nbsp;or&nbsp;by&nbsp;any&nbsp;virus&nbsp;infection&nbsp;in&nbsp;this&lt;br&gt;<br>
message&nbsp;or&nbsp;its&nbsp;attachments,&nbsp;or&nbsp;which&nbsp;may&nbsp;otherwise&nbsp;arise&nbsp;as&nbsp;a&lt;br&gt;<br>
result&nbsp;of&nbsp;this&nbsp;e-mail&nbsp;transmission.&lt;/p&gt;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
