<tt>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;From:&nbsp;Matthew&nbsp;Sackman&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthew@rabbitmq.com&quot;&gt;matthew@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Yeah,&nbsp;this&nbsp;is&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;problem.&nbsp;Essentially,&nbsp;yes,&nbsp;there&nbsp;is&nbsp;a&nbsp;timeout,&lt;br&gt;<br>
after&nbsp;which&nbsp;Rabbit&nbsp;will&nbsp;just&nbsp;give&nbsp;up&nbsp;trying&nbsp;to&nbsp;start.&nbsp;There&nbsp;are&lt;br&gt;<br>
definitely&nbsp;ways&nbsp;in&nbsp;which&nbsp;we&nbsp;could&nbsp;embue&nbsp;rabbitmqctl&nbsp;with&nbsp;the&nbsp;means&nbsp;to&lt;br&gt;<br>
tell&nbsp;rabbit&nbsp;to&nbsp;abandon&nbsp;all&nbsp;hope&nbsp;of&nbsp;some&nbsp;remote&nbsp;node&nbsp;ever&nbsp;rejoining&nbsp;(and&lt;br&gt;<br>
indeed,&nbsp;even&nbsp;ways&nbsp;to&nbsp;do&nbsp;this&nbsp;without&nbsp;the&nbsp;local&nbsp;rabbit&nbsp;coming&nbsp;up,&nbsp;which&lt;br&gt;<br>
is&nbsp;essential&nbsp;in&nbsp;this&nbsp;case),&nbsp;but&nbsp;we&amp;#39;ve&nbsp;not&nbsp;yet&nbsp;written&nbsp;this.&nbsp;There&nbsp;is&nbsp;a&lt;br&gt;<br>
bug&nbsp;open&nbsp;for&nbsp;this.&lt;br&gt;<br>
&lt;br&gt;<br>
After&nbsp;that,&nbsp;the&nbsp;various&nbsp;local&nbsp;mnesia&nbsp;databases&nbsp;will&nbsp;try&nbsp;to&nbsp;merge&lt;br&gt;<br>
themselves&nbsp;back&nbsp;together,&nbsp;but&nbsp;if&nbsp;two&nbsp;nodes&nbsp;disagree&nbsp;about&nbsp;various&lt;br&gt;<br>
details&nbsp;and&nbsp;they&nbsp;can&amp;#39;t&nbsp;delegate&nbsp;to&nbsp;a&nbsp;common&nbsp;node&nbsp;that&nbsp;was&nbsp;alive&nbsp;at&nbsp;the&lt;br&gt;<br>
point&nbsp;they&nbsp;failed,&nbsp;then&nbsp;mnesia&nbsp;will&nbsp;give&nbsp;up&nbsp;with&nbsp;an&nbsp;&amp;quot;unable&nbsp;to&nbsp;merge&lt;br&gt;<br>
schema&amp;quot;&nbsp;error,&nbsp;and&nbsp;there&amp;#39;ll&nbsp;really&nbsp;be&nbsp;no&nbsp;hope&nbsp;at&nbsp;getting&nbsp;them&nbsp;both&nbsp;to&lt;br&gt;<br>
merge&nbsp;back&nbsp;together&nbsp;without&nbsp;resetting&nbsp;one&nbsp;of&nbsp;those&nbsp;nodes.&lt;br&gt;<br>
&lt;br&gt;<br>
Erm&nbsp;possibly.&nbsp;Much&nbsp;of&nbsp;this&nbsp;ordering&nbsp;stuff&nbsp;comes&nbsp;from&nbsp;mnesia&nbsp;rather&nbsp;than&lt;br&gt;<br>
Rabbit.&nbsp;If&nbsp;the&nbsp;node&amp;#39;s&nbsp;mnesia&nbsp;is&nbsp;happy&nbsp;to&nbsp;start&nbsp;up&nbsp;then&nbsp;Rabbit&nbsp;will&nbsp;then&lt;br&gt;<br>
restore&nbsp;queues&nbsp;without&nbsp;further&nbsp;delay.&nbsp;That&nbsp;may&nbsp;include&nbsp;the&nbsp;promotion&nbsp;of&lt;br&gt;<br>
slaves&nbsp;to&nbsp;master.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Matthew,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;your&nbsp;help&nbsp;understanding&nbsp;the&nbsp;failure&nbsp;modes.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;summarize,&nbsp;if&nbsp;I&nbsp;understand&nbsp;correctly,&nbsp;in&nbsp;the&nbsp;event&nbsp;of&nbsp;a&nbsp;cluster&nbsp;failure,&nbsp;if&nbsp;the&nbsp;master&nbsp;of&nbsp;a&nbsp;mirrored&nbsp;queue&nbsp;fails&nbsp;to&nbsp;recover,&nbsp;after&nbsp;some&nbsp;timeout&nbsp;the&nbsp;remaining&nbsp;slaves&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;choose&nbsp;a&nbsp;new&nbsp;master&nbsp;and&nbsp;recover.&nbsp; Whether&nbsp;they&nbsp;do&nbsp;so&nbsp;will&nbsp;depend&nbsp;on&nbsp;whether&nbsp;the&nbsp;underlaying&nbsp;Mnesia&nbsp;tables&nbsp;converge&nbsp;or&nbsp;not.&nbsp; And&nbsp;if&nbsp;they&nbsp;do&nbsp;not&nbsp;converge,&nbsp;you&nbsp;may&nbsp;well&nbsp;have&nbsp;to&nbsp;reset&nbsp;one&nbsp;or&nbsp;more&nbsp;nodes,&nbsp;thus&nbsp;discarding&nbsp;any&nbsp;persisted&nbsp;messages&nbsp;in&nbsp;them.&nbsp; In&nbsp;that&nbsp;case,&nbsp;you&nbsp;better&nbsp;choose&nbsp;wisely,&nbsp;and&nbsp;reset&nbsp;the&nbsp;nodes&nbsp;most&nbsp;out&nbsp;of&nbsp;sync&nbsp;with&nbsp;the&nbsp;lost&nbsp;master.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;is&nbsp;also&nbsp;currently&nbsp;no&nbsp;way&nbsp;to&nbsp;tell&nbsp;the&nbsp;cluster&nbsp;a&nbsp;node&nbsp;will&nbsp;not&nbsp;be&nbsp;rejoining,&nbsp;and&nbsp;thus&nbsp;avoiding&nbsp;waiting&nbsp;for&nbsp;the&nbsp;timeout,&nbsp;but&nbsp;there&nbsp;is&nbsp;an&nbsp;open&nbsp;ticket&nbsp;for&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;BTW,&nbsp;how&nbsp;long&nbsp;is&nbsp;this&nbsp;timeout?&nbsp; Is&nbsp;it&nbsp;configurable?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;would&nbsp;it&nbsp;be&nbsp;fair&nbsp;to&nbsp;say&nbsp;that&nbsp;mirrored&nbsp;queues&nbsp;are&nbsp;fault&nbsp;tolerant&nbsp;to&nbsp;node&nbsp;loss,&nbsp;but&nbsp;not&nbsp;necessarily&nbsp;to&nbsp;cluster&nbsp;loss?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Elias&nbsp;Levy&lt;/div&gt;&lt;/div&gt;<br>

</tt>
