<tt>
&lt;table&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&nbsp;border=&quot;0&quot;&nbsp;&gt;&lt;tr&gt;&lt;td&nbsp;valign=&quot;top&quot;&nbsp;style=&quot;font:&nbsp;inherit;&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;post-text&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Hello&nbsp;list,&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;Our&nbsp;team&nbsp;is&nbsp;in&nbsp;a&nbsp;spike&nbsp;sprint&nbsp;to&nbsp;choose&nbsp;between&nbsp;ActiveMQ&nbsp;or&nbsp;RabbitMQ.<br>
&nbsp;We&nbsp;made&nbsp;2&nbsp;little&nbsp;producer/consumer&nbsp;spikes&nbsp;sending&nbsp;an&nbsp;object&nbsp;message&nbsp;<br>
with&nbsp;an&nbsp;array&nbsp;of&nbsp;16&nbsp;strings,&nbsp;a&nbsp;timestamp,&nbsp;and&nbsp;2&nbsp;integers.&nbsp;The&nbsp;spikes&nbsp;are<br>
&nbsp;ok&nbsp;on&nbsp;our&nbsp;devs&nbsp;machines&nbsp;(messages&nbsp;are&nbsp;well&nbsp;consumed).&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Then&nbsp;came&nbsp;the&nbsp;benchs.&nbsp;We&nbsp;first&nbsp;noticed&nbsp;that&nbsp;somtimes,&nbsp;on&nbsp;our&nbsp;<br>
machines,&nbsp;when&nbsp;we&nbsp;were&nbsp;sending&nbsp;a&nbsp;lot&nbsp;of&nbsp;messages&nbsp;the&nbsp;consumer&nbsp;was&nbsp;<br>
sometimes&nbsp;hanging.&nbsp;It&nbsp;was&nbsp;there,&nbsp;but&nbsp;the&nbsp;messsages&nbsp;were&nbsp;accumulating&nbsp;in&nbsp;<br>
the&nbsp;queue.&lt;/p&gt;<br>
<br>
&lt;p&gt;When&nbsp;we&nbsp;went&nbsp;on&nbsp;the&nbsp;bench&nbsp;plateform&nbsp;:&lt;/p&gt;<br>
<br>
&lt;ul&gt;&lt;li&gt;cluster&nbsp;of&nbsp;2&nbsp;rabbitmq&nbsp;machines&nbsp;4&nbsp;cores/3.2Ghz,&nbsp;4Gb&nbsp;RAM,&nbsp;load&nbsp;<br>
balanced&nbsp;by&nbsp;a&nbsp;VIP&lt;/li&gt;&lt;li&gt;one&nbsp;to&nbsp;6&nbsp;consumers&nbsp;running&nbsp;on&nbsp;the&nbsp;rabbitmq&nbsp;machines,&nbsp;saving&nbsp;the&nbsp;<br>
messages&nbsp;in&nbsp;a&nbsp;mysql&nbsp;DB&nbsp;(same&nbsp;type&nbsp;of&nbsp;machine&nbsp;for&nbsp;the&nbsp;DB)&lt;/li&gt;&lt;li&gt;12&nbsp;producers&nbsp;running&nbsp;on&nbsp;12&nbsp;AS&nbsp;machines&nbsp;(tomcat),&nbsp;attacked&nbsp;with&nbsp;<br>
jmeter&nbsp;running&nbsp;on&nbsp;another&nbsp;machine.&nbsp;The&nbsp;load&nbsp;is&nbsp;about&nbsp;600&nbsp;to&nbsp;700&nbsp;http&nbsp;<br>
request&nbsp;per&nbsp;second,&nbsp;on&nbsp;the&nbsp;servlets&nbsp;that&nbsp;produces&nbsp;the&nbsp;same&nbsp;load&nbsp;of&nbsp;<br>
RabbitMQ&nbsp;messages.&lt;/li&gt;&lt;/ul&gt;<br>
<br>
&lt;p&gt;We&nbsp;noticed&nbsp;that&nbsp;&lt;i&gt;&lt;b&gt;sometimes&lt;/b&gt;&lt;/i&gt;,&nbsp;consumers&nbsp;hang&nbsp;(well,&nbsp;they&nbsp;<br>
are&nbsp;not&nbsp;blocked,&nbsp;but&nbsp;they&nbsp;dont&nbsp;consume&nbsp;messages&nbsp;anymore).&nbsp;We&nbsp;can&nbsp;see&nbsp;<br>
that&nbsp;because&nbsp;each&nbsp;consumer&nbsp;save&nbsp;around&nbsp;100&nbsp;msg/sec&nbsp;in&nbsp;database,&nbsp;so&nbsp;when&nbsp;<br>
one&nbsp;is&nbsp;stopping&nbsp;consumming,&nbsp;the&nbsp;overall&nbsp;messages&nbsp;saved&nbsp;per&nbsp;seconds&nbsp;in&nbsp;DB<br>
&nbsp;fall&nbsp;down&nbsp;with&nbsp;the&nbsp;same&nbsp;ratio&nbsp;(if&nbsp;let&nbsp;say&nbsp;3&nbsp;consumers&nbsp;stop,&nbsp;we&nbsp;fall&nbsp;<br>
around&nbsp;600&nbsp;msg/sec&nbsp;to&nbsp;300&nbsp;msg/sec).&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;During&nbsp;that&nbsp;time,&nbsp;the&nbsp;producers&nbsp;are&nbsp;ok,&nbsp;and&nbsp;still&nbsp;produce&nbsp;at&nbsp;the&nbsp;<br>
jmeter&nbsp;rate&nbsp;(around&nbsp;600&nbsp;msg/sec).&nbsp;The&nbsp;messages&nbsp;are&nbsp;in&nbsp;the&nbsp;queues&nbsp;and&nbsp;<br>
taken&nbsp;by&nbsp;the&nbsp;consumers&nbsp;still&nbsp;&quot;alive&quot;.&nbsp;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;We&nbsp;load&nbsp;all&nbsp;the&nbsp;servlets&nbsp;with&nbsp;the&nbsp;producers&nbsp;first,&nbsp;then&nbsp;launch&nbsp;all&nbsp;<br>
the&nbsp;consumers&nbsp;one&nbsp;by&nbsp;one,&nbsp;checking&nbsp;if&nbsp;the&nbsp;connexions&nbsp;are&nbsp;ok,&nbsp;then&nbsp;run&nbsp;<br>
jmeter.&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;We&nbsp;are&nbsp;sending&nbsp;messages&nbsp;to&nbsp;one&nbsp;direct&nbsp;exchange.&nbsp;All&nbsp;consumers&nbsp;are&nbsp;<br>
listening&nbsp;to&nbsp;one&nbsp;persistent&nbsp;queue&nbsp;bounded&nbsp;to&nbsp;the&nbsp;exchange.&nbsp;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;That&nbsp;point&nbsp;is&nbsp;major&nbsp;for&nbsp;our&nbsp;choice.&nbsp;Have&nbsp;you&nbsp;seen&nbsp;this&nbsp;with&nbsp;rabbitmq,<br>
&nbsp;do&nbsp;you&nbsp;have&nbsp;an&nbsp;idea&nbsp;of&nbsp;what&nbsp;is&nbsp;going&nbsp;on&nbsp;?&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;FYI&nbsp;there&nbsp;has&nbsp;been&nbsp;a&nbsp;similar&nbsp;issue&nbsp;here,&nbsp;but&nbsp;it&nbsp;wasn't&nbsp;resolved&nbsp;:&nbsp;http://old.nabble.com/Consumer-stop-to-receive-messages-but-continue-listening-queue-problem.-td27872888.html&lt;br&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;answers.&lt;/p&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;br&gt;Florence.&lt;br&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;br&gt;<br>
<br>
<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</tt>
