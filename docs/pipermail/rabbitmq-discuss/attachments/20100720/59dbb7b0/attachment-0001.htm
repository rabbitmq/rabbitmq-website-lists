<tt>
&lt;table&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&nbsp;border=&quot;0&quot;&nbsp;&gt;&lt;tr&gt;&lt;td&nbsp;valign=&quot;top&quot;&nbsp;style=&quot;font:&nbsp;inherit;&quot;&gt;&lt;br&gt;Hi&nbsp;Simon&nbsp;(sorry&nbsp;for&nbsp;answering&nbsp;twice),&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;your&nbsp;reply.&nbsp;We&nbsp;didn't&nbsp;find&nbsp;how&nbsp;to&nbsp;configure&nbsp;<br>
the&nbsp;basic.qos&nbsp;in&nbsp;the&nbsp;java&nbsp;API.&nbsp;Here&nbsp;is&nbsp;our&nbsp;spike&nbsp;code&nbsp;:&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
private&nbsp;void&nbsp;consommeEvenements()&nbsp;throws&nbsp;IOException&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
Channel&nbsp;channel&nbsp;=&nbsp;acteurRabbitMQ.chaines.get(QUEUE_PRINCIPALE);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;QueueingConsumer&nbsp;consumer&nbsp;=&nbsp;new&nbsp;QueueingConsumer(channel);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;channel.basicConsume(QUEUE_PRINCIPALE.name(),&nbsp;consumer);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
while&nbsp;(channel.isOpen())&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;QueueingConsumer.Delivery&nbsp;<br>
evenementBrut&nbsp;=&nbsp;null;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;EvenementStat&nbsp;evenementRecu&nbsp;=&nbsp;null;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;try<br>
&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;evenementBrut&nbsp;=&nbsp;consumer.nextDelivery();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;evenementRecu&nbsp;=&nbsp;decode(evenementBrut);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
logger.info(&quot;evenement&nbsp;recu&nbsp;:&nbsp;&quot;&nbsp;+&nbsp;evenementRecu);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
simuleErreurBaseDeDonnees(evenementRecu);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&nbsp;catch&nbsp;<br>
(IOException&nbsp;e)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;logger.fatal(&quot;Soucis&nbsp;de&nbsp;<br>
deserialize&quot;,&nbsp;e);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;logger.error(&quot;Soucis&nbsp;d'écriture&nbsp;en&nbsp;base&quot;,&nbsp;e);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(evenementRecu.estReinjectable())&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
logger.info(&quot;--&amp;gt;&nbsp;renvoi&nbsp;de&nbsp;&quot;&nbsp;+&nbsp;evenementRecu);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&nbsp;programmeRepublication(evenementRecu);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&nbsp;else&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;logger.info(&quot;--&amp;gt;&nbsp;DEAD&nbsp;LETTER&nbsp;&quot;&nbsp;+&nbsp;evenementRecu);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;acteurRabbitMQ.publie(evenementRecu,&nbsp;<br>
QUEUE_DEAD_LETTER);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&nbsp;boolean<br>
&nbsp;ackMultiple&nbsp;=&nbsp;false;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;final&nbsp;long&nbsp;deliveryTag&nbsp;=&nbsp;<br>
evenementBrut.getEnvelope().getDeliveryTag();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
logger.info(&quot;ACK&nbsp;&quot;&nbsp;+&nbsp;deliveryTag);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
channel.basicAck(deliveryTag,&nbsp;ackMultiple);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
acteurRabbitMQ.ferme();&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;br&gt;&lt;br&gt;Yet,&nbsp;I'm&nbsp;not&nbsp;sure&nbsp;the&nbsp;basic.qos&nbsp;<br>
is&nbsp;the&nbsp;issue&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;6&nbsp;consumers&nbsp;sometimes&nbsp;keep&nbsp;consuming&nbsp;the&nbsp;<br>
messages&nbsp;during&nbsp;the&nbsp;10&nbsp;minutes&nbsp;bench,&nbsp;and&nbsp;sometimes&nbsp;not.&nbsp;&lt;br&gt;&lt;br&gt;When&nbsp;<br>
the&nbsp;problem&nbsp;occurs,&nbsp;the&nbsp;list_queues&nbsp;option&nbsp;displays&nbsp;that&nbsp;the&nbsp;queue&nbsp;<br>
starts&nbsp;growing&nbsp;because&nbsp;the&nbsp;&quot;active&quot;&nbsp;(the&nbsp;ones&nbsp;that&nbsp;keep&nbsp;on&nbsp;consuming)&nbsp;<br>
consumers&nbsp;cannot&nbsp;insert&nbsp;in&nbsp;DB&nbsp;the&nbsp;overall&nbsp;messages&nbsp;load&nbsp;fast&nbsp;enough.&lt;br&gt;&lt;br&gt;Cheers,<br>
&nbsp;&lt;br&gt;Florence.&lt;br&gt;&lt;br&gt;&lt;br&gt;---&nbsp;En&nbsp;date&nbsp;de&amp;nbsp;:&nbsp;&lt;b&gt;Mar&nbsp;20.7.10,&nbsp;Florence&nbsp;Chabanois&nbsp;&lt;i&gt;&amp;lt;flocha2000-agile@yahoo.fr&amp;gt;&lt;/i&gt;&lt;/b&gt;&nbsp;a&nbsp;écrit&amp;nbsp;:&lt;br&gt;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;2px&nbsp;solid&nbsp;rgb(16,&nbsp;16,&nbsp;255);&nbsp;margin-left:&nbsp;5px;&nbsp;padding-left:&nbsp;5px;&quot;&gt;&lt;div&nbsp;id=&quot;yiv1505816307&quot;&gt;&lt;table&nbsp;border=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&nbsp;cellspacing=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&nbsp;style=&quot;font:&nbsp;inherit;&quot;&nbsp;valign=&quot;top&quot;&gt;&lt;blockquote&nbsp;style=&quot;border-left:&nbsp;2px&nbsp;solid&nbsp;rgb(16,&nbsp;16,&nbsp;255);&nbsp;margin-left:&nbsp;5px;&nbsp;padding-left:&nbsp;5px;&quot;&gt;&lt;br&gt;&lt;br&gt;De:&nbsp;Simon&nbsp;MacMullen&nbsp;&amp;lt;simon@rabbitmq.com&amp;gt;&lt;br&gt;Objet:&nbsp;Re:&nbsp;[rabbitmq-discuss]&nbsp;Consumers&nbsp;stopped&nbsp;consuming&nbsp;messages&lt;br&gt;À:&nbsp;rabbitmq-discuss@lists.rabbitmq.com&lt;br&gt;Date:&nbsp;Mardi&nbsp;20&nbsp;juillet&nbsp;2010,&nbsp;11h26&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;plainMail&quot;&gt;On&nbsp;20/07/10&nbsp;09:55,&nbsp;Florence&nbsp;Chabanois&nbsp;wrote:&lt;br&gt;&amp;lt;snip&amp;gt;&lt;br&gt;&amp;gt;&nbsp;We&nbsp;noticed&nbsp;that&nbsp;/*sometimes*/,&nbsp;consumers&nbsp;hang&nbsp;(well,&nbsp;they&nbsp;are&nbsp;not&lt;br&gt;&amp;gt;&nbsp;blocked,&nbsp;but&nbsp;they&nbsp;dont&nbsp;consume&nbsp;messages&nbsp;anymore).&nbsp;We&nbsp;can&nbsp;see&nbsp;that&lt;br&gt;&amp;gt;&nbsp;because&nbsp;each&nbsp;consumer&nbsp;save&nbsp;around&nbsp;100&nbsp;msg/sec<br>
&nbsp;in&nbsp;database,&nbsp;so&nbsp;when&nbsp;one&lt;br&gt;&amp;gt;&nbsp;is&nbsp;stopping&nbsp;consumming,&nbsp;the&nbsp;overall&nbsp;messages&nbsp;saved&nbsp;per&nbsp;seconds&nbsp;in&nbsp;DB&lt;br&gt;&amp;gt;&nbsp;fall&nbsp;down&nbsp;with&nbsp;the&nbsp;same&nbsp;ratio&nbsp;(if&nbsp;let&nbsp;say&nbsp;3&nbsp;consumers&nbsp;stop,&nbsp;we&nbsp;fall&lt;br&gt;&amp;gt;&nbsp;around&nbsp;600&nbsp;msg/sec&nbsp;to&nbsp;300&nbsp;msg/sec).&lt;br&gt;&amp;lt;snip&amp;gt;&lt;br&gt;&amp;gt;&nbsp;FYI&nbsp;there&nbsp;has&nbsp;been&nbsp;a&nbsp;similar&nbsp;issue&nbsp;here,&nbsp;but&nbsp;it&nbsp;wasn't&nbsp;resolved<br>
&nbsp;:&lt;br&gt;&amp;gt;&nbsp;&lt;a&nbsp;rel=&quot;nofollow&quot;&nbsp;target=&quot;_blank&quot;&nbsp;href=&quot;http://old.nabble.com/Consumer-stop-to-receive-messages-but-continue-listening-queue-problem.-td27872888.html&quot;&gt;http://old.nabble.com/Consumer-stop-to-receive-messages-but-continue-listening-queue-problem.-td27872888.html&lt;/a&gt;&lt;br&gt;&lt;br&gt;Hi&nbsp;Florence.&nbsp;One&nbsp;possibility&nbsp;that&nbsp;was&nbsp;considered&nbsp;in&nbsp;the&nbsp;linked&nbsp;thread&nbsp;was&nbsp;that&nbsp;all&nbsp;the&nbsp;messages&nbsp;were&nbsp;being&nbsp;sent&nbsp;to&nbsp;some&nbsp;consumers&nbsp;due&nbsp;to&nbsp;basic.qos&nbsp;not&nbsp;being&nbsp;set&nbsp;(in&nbsp;the&nbsp;absence&nbsp;of&nbsp;basic.qos,&nbsp;Rabbit&nbsp;is&nbsp;allowed&nbsp;to&nbsp;do&nbsp;that).&lt;br&gt;&lt;br&gt;So:&lt;br&gt;&lt;br&gt;*&nbsp;Are&nbsp;you&nbsp;setting&nbsp;the&nbsp;basic.qos&nbsp;prefetch&nbsp;count?&lt;br&gt;*&nbsp;What&nbsp;does&nbsp;rabbitmqctl&nbsp;lists_queues&nbsp;say&nbsp;about&nbsp;he&nbsp;queue&nbsp;when&nbsp;the&nbsp;system&nbsp;is&nbsp;in&nbsp;this&nbsp;state?&lt;br&gt;*&nbsp;Are&nbsp;you&nbsp;able&nbsp;to&nbsp;post&nbsp;your&nbsp;spike&nbsp;code&nbsp;anywhere?&lt;br&gt;&lt;br&gt;Cheers,&nbsp;Simon&lt;br&gt;&lt;br&gt;--&nbsp;Simon&nbsp;MacMullen&lt;br&gt;Staff&nbsp;Engineer,&nbsp;RabbitMQ&lt;br&gt;SpringSource,&nbsp;a&nbsp;division&nbsp;of&nbsp;VMware&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a<br>
&nbsp;rel=&quot;nofollow&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;rel=&quot;nofollow&quot;&nbsp;target=&quot;_blank&quot;&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;br&gt;<br>
<br>
<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/blockquote&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;br&gt;<br>
<br>
<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</tt>
