<tt>
Hi,&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;a&nbsp;simple&nbsp;cluster&nbsp;setup&nbsp;consisting&nbsp;of&nbsp;2&nbsp;nodes.&nbsp;Call&nbsp;them&nbsp;A&nbsp;and&nbsp;B&nbsp;going&nbsp;forward.&nbsp;&lt;br&gt;&lt;br&gt;Status&nbsp;of&nbsp;node&nbsp;rabbit@B...&lt;br&gt;[{running_applications,[{rabbit,&amp;quot;RabbitMQ&amp;quot;,&amp;quot;1.7.0&amp;quot;},&lt;br&gt;                       &nbsp;{mnesia,&amp;quot;MNESIA &nbsp;CXC&nbsp;138&nbsp;12&amp;quot;,&amp;quot;4.4.7&amp;quot;},&lt;br&gt;<br>
<br>
<br>
                       &nbsp;{os_mon,&amp;quot;CPO &nbsp;CXC&nbsp;138&nbsp;46&amp;quot;,&amp;quot;2.1.8&amp;quot;},&lt;br&gt;                       &nbsp;{sasl,&amp;quot;SASL &nbsp;CXC&nbsp;138&nbsp;11&amp;quot;,&amp;quot;2.1.5.4&amp;quot;},&lt;br&gt;                       &nbsp;{stdlib,&amp;quot;ERTS &nbsp;CXC&nbsp;138&nbsp;10&amp;quot;,&amp;quot;1.15.5&amp;quot;},&lt;br&gt;<br>
<br>
<br>
                       &nbsp;{kernel,&amp;quot;ERTS &nbsp;CXC&nbsp;138&nbsp;10&amp;quot;,&amp;quot;2.12.5&amp;quot;}]},&lt;br&gt; {nodes,[rabbit@A,rabbit@B]},&lt;br&gt; {running_nodes,[rabbit@A,rabbit@B]}]&lt;br&gt;...done.&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;a&nbsp;simple&nbsp;consumer&nbsp;that&nbsp;connect&nbsp;to&nbsp;B&nbsp;and&nbsp;a&nbsp;simple&nbsp;producer&nbsp;that&nbsp;connects&nbsp;to&nbsp;B&nbsp;and&nbsp;produces&nbsp;messages.&nbsp;This&nbsp;is&nbsp;working&nbsp;fine&nbsp;and&nbsp;I&nbsp;connect&nbsp;to&nbsp;the&nbsp;cluster&nbsp;via&nbsp;the&nbsp;newConnection&nbsp;method&nbsp;that&nbsp;takes&nbsp;an&nbsp;array&nbsp;of&nbsp;Addresses.&lt;br&gt;<br>
&lt;br&gt;ConnectionParameters&nbsp;params&nbsp;=&nbsp;new&nbsp;ConnectionParameters();&lt;br&gt;params.setUsername(&amp;quot;guest&amp;quot;);&lt;br&gt;params.setPassword(&amp;quot;guest&amp;quot;);&lt;br&gt;params.setVirtualHost(&amp;quot;/&amp;quot;);&lt;br&gt;params.setRequestedHeartbeat(0);&lt;br&gt;<br>
&lt;br&gt;ConnectionFactory&nbsp;factory&nbsp;=&nbsp;new&nbsp;ConnectionFactory(params);&lt;br&gt; Address[]&nbsp;addresses&nbsp;=&nbsp;{new&nbsp;Address(&amp;quot;192.168.44.1&amp;quot;,&nbsp;5672),&nbsp;&lt;br&gt;               &nbsp;new&nbsp;Address(&amp;quot;192.168.44.129&amp;quot;,&nbsp;5672)};&lt;br&gt;&lt;br&gt;Connection&nbsp;conn&nbsp;=&nbsp;factory.newConnection(addresses,&nbsp;1);&lt;br&gt;<br>
Channel&nbsp;channel&nbsp;=&nbsp;conn.createChannel();&lt;br&gt;&lt;br&gt;...&lt;br&gt;&lt;br&gt;The&nbsp;problem&nbsp;comes&nbsp;if&nbsp;I&nbsp;stop&nbsp;node&nbsp;B&nbsp;via&nbsp;the&nbsp;stop_app&nbsp;command&nbsp;&lt;br&gt;&lt;br&gt;$&nbsp;sudo&nbsp;rabbitmqctl&nbsp;stop_app&lt;br&gt;Stopping&nbsp;node&nbsp;rabbit@B&nbsp;...&lt;br&gt;...done.&lt;br&gt;&lt;br&gt;$&nbsp;sudo&nbsp;rabbitmqctl&nbsp;status&lt;br&gt;<br>
&lt;br&gt;Status&nbsp;of&nbsp;node&nbsp;rabbit@B&nbsp;...&lt;br&gt;[{running_applications,[{sasl,&amp;quot;SASL &nbsp;CXC&nbsp;138&nbsp;11&amp;quot;,&amp;quot;2.1.6&amp;quot;},&lt;br&gt;                       &nbsp;{stdlib,&amp;quot;ERTS &nbsp;CXC&nbsp;138&nbsp;10&amp;quot;,&amp;quot;1.16.2&amp;quot;},&lt;br&gt;                       &nbsp;{kernel,&amp;quot;ERTS &nbsp;CXC&nbsp;138&nbsp;10&amp;quot;,&amp;quot;2.13.2&amp;quot;}]},&lt;br&gt;<br>
 {nodes,[rabbit@B,rabbit@A]},&lt;br&gt; {running_nodes,[rabbit@A]}]&lt;br&gt;...done.&lt;br&gt;&lt;br&gt;and&nbsp;start&nbsp;my&nbsp;consumer&nbsp;again&nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;exception&lt;br&gt;&lt;br&gt;Exception&nbsp;in&nbsp;thread&nbsp;&amp;quot;main&amp;quot;&nbsp;java.io.IOException&lt;br&gt;   &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)&lt;br&gt;<br>
   &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:618)&lt;br&gt;   &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:582)&lt;br&gt;   &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.basicConsume(ChannelN.java:574)&lt;br&gt;<br>
   &nbsp;at&nbsp;RabbitMQConsumer.main(RabbitMQConsumer.java:38)&lt;br&gt;   &nbsp;at&nbsp;sun.reflect.NativeMethodAccessorImpl.invoke0(Native&nbsp;Method)&lt;br&gt;   &nbsp;at&nbsp;sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br&gt;   &nbsp;at&nbsp;sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br&gt;<br>
   &nbsp;at&nbsp;java.lang.reflect.Method.invoke(Method.java:597)&lt;br&gt;   &nbsp;at&nbsp;com.intellij.rt.execution.application.AppMain.main(AppMain.java:90)&lt;br&gt;Caused&nbsp;by:&nbsp;com.rabbitmq.client.ShutdownSignalException:&nbsp;channel&nbsp;error;&nbsp;reason:&nbsp;{#method&amp;lt;channel.close&amp;gt;(reply-code=404,reply-text=NOT_FOUND&nbsp;-&nbsp;no&nbsp;queue&nbsp;&amp;#39;myQueue&amp;#39;&nbsp;in&nbsp;vhost&nbsp;&amp;#39;/&amp;#39;,class-id=60,method-id=20),null,&amp;quot;&amp;quot;}&lt;br&gt;<br>
   &nbsp;at&nbsp;com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:191)&lt;br&gt;   &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:159)&lt;br&gt;   &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:110)&lt;br&gt;<br>
   &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:449)&lt;br&gt;&lt;br&gt;Can&nbsp;anyone&nbsp;shed&nbsp;some&nbsp;light&nbsp;on&nbsp;what&nbsp;I&nbsp;am&nbsp;doing&nbsp;wrong?&nbsp;I&nbsp;thought&nbsp;that&nbsp;the&nbsp;queue&nbsp;would&nbsp;be&nbsp;re-created&nbsp;since&nbsp;I&nbsp;am&nbsp;using&nbsp;the&nbsp;declare&nbsp;statement.&nbsp;Snippet&nbsp;from&nbsp;consumer&lt;br&gt;<br>
&lt;br&gt;channel.exchangeDeclare(exchangeName,&nbsp;&amp;quot;direct&amp;quot;,&nbsp;durable);&lt;br&gt;channel.queueDeclare(queueName,&nbsp;durable);&lt;br&gt;channel.queueBind(queueName,&nbsp;exchangeName,&nbsp;routingKey);&lt;br&gt;&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;attached&nbsp;the&nbsp;consumer&nbsp;and&nbsp;producer&nbsp;code.&nbsp;&lt;br&gt;<br>
&lt;br&gt;thanks!&lt;br&gt;&lt;br&gt;dave&lt;br&gt;<br>
<br>

</tt>
