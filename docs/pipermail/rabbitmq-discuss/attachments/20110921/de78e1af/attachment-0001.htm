<tt>
Hi&nbsp;everyone,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&amp;#39;m&nbsp;running&nbsp;the&nbsp;demo_receive&nbsp;/&nbsp;demo_send&nbsp;example&nbsp;with&nbsp;pika&nbsp;from&nbsp;the&nbsp;master&nbsp;branch&nbsp;(pre0.9.6&nbsp;i&nbsp;think),&nbsp;I&amp;#39;m&nbsp;getting&nbsp;a&nbsp;strange&nbsp;behaviour.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;seems&nbsp;that&nbsp;demo_send&nbsp;sends&nbsp;its&nbsp;10&nbsp;messages&nbsp;before&nbsp;demo_receive&nbsp;actually&nbsp;receive&nbsp;everything&nbsp;in&nbsp;one&nbsp;shot.&nbsp;It&nbsp;results&nbsp;in&nbsp;a&nbsp;tcp&nbsp;backpressure&nbsp;problem.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;pika&nbsp;0.9.5&nbsp;example,&nbsp;demo_receive&nbsp;consumes&nbsp;a&nbsp;message&nbsp;1&nbsp;by&nbsp;1,&nbsp;as&nbsp;it&nbsp;arrives,&nbsp;and&nbsp;acks&nbsp;it,&nbsp;this&nbsp;is&nbsp;what&nbsp;I&nbsp;expect.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&amp;#39;s&nbsp;the&nbsp;output&nbsp;from&nbsp;both&nbsp;scripts&nbsp;(I&nbsp;added&nbsp;a&nbsp;0.5sec&nbsp;sleep&nbsp;after&nbsp;sending&nbsp;a&nbsp;message&nbsp;to&nbsp;see&nbsp;what&amp;#39;s&nbsp;happening)&nbsp;:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;webkit-indent-blockquote&quot;&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
demo_receive:&lt;br&gt;demo_receive:&nbsp;Connected&nbsp;to&nbsp;RabbitMQ&lt;br&gt;demo_receive:&nbsp;Received&nbsp;our&nbsp;Channel&lt;br&gt;demo_receive:&nbsp;Queue&nbsp;Declared&lt;br&gt;Basic.Deliver&nbsp;text/plain&nbsp;delivery-tag&nbsp;1:&nbsp;Hello&nbsp;World&nbsp;#0:&nbsp;1316597081.62437701&lt;br&gt;Basic.Deliver&nbsp;text/plain&nbsp;delivery-tag&nbsp;2:&nbsp;Hello&nbsp;World&nbsp;#1:&nbsp;1316597082.62570310&lt;br&gt;<br>
Basic.Deliver&nbsp;text/plain&nbsp;delivery-tag&nbsp;3:&nbsp;Hello&nbsp;World&nbsp;#2:&nbsp;1316597083.62713790&lt;br&gt;Basic.Deliver&nbsp;text/plain&nbsp;delivery-tag&nbsp;4:&nbsp;Hello&nbsp;World&nbsp;#3:&nbsp;1316597084.62860394&lt;br&gt;Basic.Deliver&nbsp;text/plain&nbsp;delivery-tag&nbsp;5:&nbsp;Hello&nbsp;World&nbsp;#4:&nbsp;1316597085.63100100&lt;br&gt;<br>
Basic.Deliver&nbsp;text/plain&nbsp;delivery-tag&nbsp;6:&nbsp;Hello&nbsp;World&nbsp;#5:&nbsp;1316597086.63265109&lt;br&gt;Basic.Deliver&nbsp;text/plain&nbsp;delivery-tag&nbsp;7:&nbsp;Hello&nbsp;World&nbsp;#6:&nbsp;1316597087.63385701&lt;br&gt;Basic.Deliver&nbsp;text/plain&nbsp;delivery-tag&nbsp;8:&nbsp;Hello&nbsp;World&nbsp;#7:&nbsp;1316597088.63560796&lt;br&gt;<br>
Basic.Deliver&nbsp;text/plain&nbsp;delivery-tag&nbsp;9:&nbsp;Hello&nbsp;World&nbsp;#8:&nbsp;1316597089.63728094&lt;br&gt;Basic.Deliver&nbsp;text/plain&nbsp;delivery-tag&nbsp;10:&nbsp;Hello&nbsp;World&nbsp;#9:&nbsp;1316597090.63895893&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
 &lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0.8ex;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-left-color:&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;border-left-style:&nbsp;solid;&nbsp;padding-left:&nbsp;1ex;&nbsp;&quot;&gt;<br>
demo_send:&lt;br&gt;INFO:pika:Connecting&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1:5672&quot;&gt;127.0.0.1:5672&lt;/a&gt;&lt;br&gt;demo_send:&nbsp;Connected&nbsp;to&nbsp;RabbitMQ&lt;br&gt;demo_send:&nbsp;Received&nbsp;our&nbsp;Channel&lt;br&gt;demo_send:&nbsp;Queue&nbsp;Declared&lt;br&gt;demo_send:&nbsp;Sent&nbsp;Hello&nbsp;World&nbsp;#0:&nbsp;1316597081.62437701&lt;br&gt;<br>
demo_send:&nbsp;Sent&nbsp;Hello&nbsp;World&nbsp;#1:&nbsp;1316597082.62570310&lt;br&gt;demo_send:&nbsp;Sent&nbsp;Hello&nbsp;World&nbsp;#2:&nbsp;1316597083.62713790&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;500&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;10&nbsp;frames&nbsp;behind&lt;br&gt;<br>
 &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;demo_send:&nbsp;Sent&nbsp;Hello&nbsp;World&nbsp;#3:&nbsp;1316597084.62860394&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;521&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;11&nbsp;frames&nbsp;behind&lt;br&gt;<br>
 &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;582&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;12&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;<br>
../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;625&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;13&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;demo_send:&nbsp;Sent&nbsp;Hello&nbsp;World&nbsp;#4:&nbsp;1316597085.63100100&lt;br&gt;<br>
../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;646&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;14&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;707&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;15&nbsp;frames&nbsp;behind&lt;br&gt;<br>
 &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;750&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;16&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;<br>
demo_send:&nbsp;Sent&nbsp;Hello&nbsp;World&nbsp;#5:&nbsp;1316597086.63265109&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;771&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;17&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;<br>
../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;832&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;18&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;875&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;19&nbsp;frames&nbsp;behind&lt;br&gt;<br>
 &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;demo_send:&nbsp;Sent&nbsp;Hello&nbsp;World&nbsp;#6:&nbsp;1316597087.63385701&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;896&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;20&nbsp;frames&nbsp;behind&lt;br&gt;<br>
 &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;957&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;21&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;<br>
../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;1000&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;22&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;demo_send:&nbsp;Sent&nbsp;Hello&nbsp;World&nbsp;#7:&nbsp;1316597088.63560796&lt;br&gt;<br>
../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;1021&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;23&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;1082&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;24&nbsp;frames&nbsp;behind&lt;br&gt;<br>
 &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;1125&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;25&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;<br>
demo_send:&nbsp;Sent&nbsp;Hello&nbsp;World&nbsp;#8:&nbsp;1316597089.63728094&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;1146&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;26&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;<br>
../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;1207&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;27&nbsp;frames&nbsp;behind&lt;br&gt; &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;1250&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;28&nbsp;frames&nbsp;behind&lt;br&gt;<br>
 &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;demo_send:&nbsp;Sent&nbsp;Hello&nbsp;World&nbsp;#9:&nbsp;1316597090.63895893&lt;br&gt;demo_send:&nbsp;Closing&lt;br&gt;INFO:pika:Closing&nbsp;connection:&nbsp;200&nbsp;-&nbsp;Normal&nbsp;shutdown&lt;br&gt;../pika/connection.py:756:&nbsp;UserWarning:&nbsp;Pika:&nbsp;Write&nbsp;buffer&nbsp;exceeded&nbsp;warning&nbsp;threshold&nbsp;at&nbsp;1284&nbsp;bytes&nbsp;and&nbsp;an&nbsp;estimated&nbsp;29&nbsp;frames&nbsp;behind&lt;br&gt;<br>
 &nbsp;warn(message&nbsp;%&nbsp;(self.outbound_buffer.size,&nbsp;est_frames_behind))&lt;br&gt;INFO:pika:Disconnected&nbsp;from&nbsp;RabbitMQ&nbsp;at&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1:5672&quot;&gt;127.0.0.1:5672&lt;/a&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;question&nbsp;is&nbsp;:&nbsp; why&nbsp;all&nbsp;10&nbsp;messages&nbsp;arrive&nbsp;in&nbsp;one&nbsp;shot&nbsp;?&lt;/div&gt;<br>

</tt>
