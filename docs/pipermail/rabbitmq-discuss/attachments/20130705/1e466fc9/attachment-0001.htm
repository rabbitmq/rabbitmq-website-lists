<tt>
Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;encounter&nbsp;a&nbsp;bad&nbsp;performance&nbsp;issue&nbsp;about&nbsp;pika,&nbsp;yesterday&nbsp;it&nbsp;works&nbsp;fine,&nbsp;but&nbsp;today&nbsp;performance&nbsp;of&nbsp;basci_publish&nbsp;got&nbsp;bad,&nbsp;it&nbsp;cost&nbsp;2&nbsp;or&nbsp;3&nbsp;second&nbsp;to&nbsp;finish&nbsp;one&nbsp;message,&nbsp;sometimes&nbsp;down&nbsp;to&nbsp;7&nbsp;seconds.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Pika&nbsp;is&nbsp;0.9.13&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(68,&nbsp;68,&nbsp;68);&nbsp;font-size:&nbsp;12px;&nbsp;text-align:&nbsp;right;&quot;&gt;RabbitMQ&nbsp;3.1.0,&amp;nbsp;&lt;/span&gt;&lt;acronym&nbsp;title=&quot;Erlang&nbsp;R14B04&nbsp;(erts-5.8.5)&nbsp;[source]&nbsp;[64-bit]&nbsp;[smp:2:2]&nbsp;[rq:2]&nbsp;[async-threads:30]&nbsp;[kernel-poll:true]&quot;&nbsp;style=&quot;border-bottom-width:&nbsp;1px;&nbsp;border-style:&nbsp;none&nbsp;none&nbsp;dotted;&nbsp;background-image:&nbsp;none;&nbsp;color:&nbsp;rgb(68,&nbsp;68,&nbsp;68);&nbsp;border-top-left-radius:&nbsp;2px;&nbsp;border-top-right-radius:&nbsp;2px;&nbsp;border-bottom-right-radius:&nbsp;2px;&nbsp;border-bottom-left-radius:&nbsp;2px;&nbsp;font-size:&nbsp;12px;&nbsp;text-align:&nbsp;right;&quot;&gt;Erlang&nbsp;R14B04&nbsp;&amp;nbsp;&nbsp;Queue&nbsp;is&nbsp;Durable&lt;/acronym&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;acronym&nbsp;title=&quot;Erlang&nbsp;R14B04&nbsp;(erts-5.8.5)&nbsp;[source]&nbsp;[64-bit]&nbsp;[smp:2:2]&nbsp;[rq:2]&nbsp;[async-threads:30]&nbsp;[kernel-poll:true]&quot;&nbsp;style=&quot;border-bottom-width:&nbsp;1px;&nbsp;border-style:&nbsp;none&nbsp;none&nbsp;dotted;&nbsp;background-image:&nbsp;none;&nbsp;color:&nbsp;rgb(68,&nbsp;68,&nbsp;68);&nbsp;border-top-left-radius:&nbsp;2px;&nbsp;border-top-right-radius:&nbsp;2px;&nbsp;border-bottom-right-radius:&nbsp;2px;&nbsp;border-bottom-left-radius:&nbsp;2px;&nbsp;font-size:&nbsp;12px;&nbsp;text-align:&nbsp;right;&quot;&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Python:&nbsp;2.6&lt;/font&gt;&lt;/acronym&gt;&lt;/div&gt;&lt;div&gt;&lt;acronym&nbsp;title=&quot;Erlang&nbsp;R14B04&nbsp;(erts-5.8.5)&nbsp;[source]&nbsp;[64-bit]&nbsp;[smp:2:2]&nbsp;[rq:2]&nbsp;[async-threads:30]&nbsp;[kernel-poll:true]&quot;&nbsp;style=&quot;border-bottom-width:&nbsp;1px;&nbsp;border-style:&nbsp;none&nbsp;none&nbsp;dotted;&nbsp;background-image:&nbsp;none;&nbsp;color:&nbsp;rgb(68,&nbsp;68,&nbsp;68);&nbsp;border-top-left-radius:&nbsp;2px;&nbsp;border-top-right-radius:&nbsp;2px;&nbsp;border-bottom-right-radius:&nbsp;2px;&nbsp;border-bottom-left-radius:&nbsp;2px;&nbsp;font-size:&nbsp;12px;&nbsp;text-align:&nbsp;right;&quot;&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Platform:&amp;nbsp;&lt;/font&gt;&lt;/acronym&gt;&lt;font&nbsp;color=&quot;#444444&quot;&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&quot;&gt;CentOS&nbsp;release&nbsp;6.3&nbsp;(Final)&nbsp;X64&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#444444&quot;&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;acronym&nbsp;title=&quot;Erlang&nbsp;R14B04&nbsp;(erts-5.8.5)&nbsp;[source]&nbsp;[64-bit]&nbsp;[smp:2:2]&nbsp;[rq:2]&nbsp;[async-threads:30]&nbsp;[kernel-poll:true]&quot;&nbsp;style=&quot;border-bottom-width:&nbsp;1px;&nbsp;border-style:&nbsp;none&nbsp;none&nbsp;dotted;&nbsp;background-image:&nbsp;none;&nbsp;color:&nbsp;rgb(68,&nbsp;68,&nbsp;68);&nbsp;border-top-left-radius:&nbsp;2px;&nbsp;border-top-right-radius:&nbsp;2px;&nbsp;border-bottom-right-radius:&nbsp;2px;&nbsp;border-bottom-left-radius:&nbsp;2px;&nbsp;font-size:&nbsp;12px;&nbsp;text-align:&nbsp;right;&quot;&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;My&nbsp;application&nbsp;deployed&nbsp;by&nbsp;django&nbsp;+&nbsp;uwsgi,&nbsp;django&nbsp;receiver&nbsp;the&nbsp;request&nbsp;and&nbsp;publish&nbsp;the&nbsp;request&nbsp;to&nbsp;rabbitmq.&lt;/font&gt;&lt;/acronym&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Simple&nbsp;Pika&nbsp;Client&nbsp;wrapper&nbsp;class&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;import&nbsp;time&lt;/div&gt;&lt;div&gt;import&nbsp;logging&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;import&nbsp;pika&lt;/div&gt;&lt;div&gt;from&nbsp;pika&nbsp;import&nbsp;exceptions&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;logger&nbsp;=&nbsp;logging.getLogger('error')&lt;/div&gt;&lt;div&gt;logger.setLevel(logging.DEBUG)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;RabbitMQ:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;host,&nbsp;&amp;nbsp;port,&nbsp;&amp;nbsp;username,&nbsp;&amp;nbsp;password):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;cred&nbsp;=&nbsp;pika.PlainCredentials(&lt;wbr&gt;username,&nbsp;password)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._args&nbsp;=&nbsp;dict(host=host,&nbsp;port=port,&nbsp;credentials=cred,&nbsp;heartbeat_interval=25)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;try:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.reconnect()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;except&nbsp;exceptions.&lt;wbr&gt;AMQPConnectionError,&nbsp;e:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;logger.error(&quot;Connection&nbsp;to&nbsp;MQ&nbsp;error&quot;)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._conn&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;raise&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;close(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;getattr(self,&nbsp;'_channel',&nbsp;None)&nbsp;is&nbsp;not&nbsp;None:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel.close()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;getattr(self,&nbsp;'_conn',&nbsp;None)&nbsp;is&nbsp;not&nbsp;None:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._conn.close()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._conn&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;close_channel(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;getattr(self,&nbsp;'_conn',&nbsp;None)&nbsp;is&nbsp;not&nbsp;None:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel.close()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;reconnect(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;logger.error(&quot;reconnect&nbsp;to&nbsp;MQ&nbsp;&quot;)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.close()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._conn&nbsp;=&nbsp;pika.BlockingConnection(pika.&lt;wbr&gt;ConnectionParameters(**self._&lt;wbr&gt;args))&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel&nbsp;=&nbsp;self._conn.channel()&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;connect_isopen(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;self._conn&nbsp;and&nbsp;self._conn.is_open&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;channel_isopen(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;self._channel&nbsp;and&nbsp;self._channel.is_open&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;ensure_channel(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;not&nbsp;self.connect_isopen&nbsp;or&nbsp;not&nbsp;self.channel_isopen():&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.reconnect()&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;exchange_declare(self,&nbsp;name,&nbsp;&amp;nbsp;ex_type):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.ensure_channel()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel.exchange_&lt;wbr&gt;declare(exchange=name,&nbsp;exchange_type=ex_type)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;bind(self,&nbsp;ex,&nbsp;&amp;nbsp;queue,&nbsp;&amp;nbsp;routing_key):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.ensure_channel()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel.queue_bind(&lt;wbr&gt;exchange=ex,&nbsp;queue=queue,&nbsp;routing_key=routing_key)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;declare_queue(self,&nbsp;queue_name,&nbsp;&amp;nbsp;durable=True,&nbsp;exclusive=False,&nbsp;auto_delete=False,&nbsp;arguments=None):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.ensure_channel()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel.queue_declare(&lt;wbr&gt;queue=queue_name,&nbsp;durable=durable,&nbsp;exclusive=exclusive,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;auto_delete=auto_delete,&nbsp;arguments=arguments)&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;confirm_delivery(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.ensure_channel()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel.confirm_&lt;wbr&gt;delivery()&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;force_data(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.ensure_channel()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel.force_data_&lt;wbr&gt;events(True)&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;publish_setup(self,&nbsp;ex_name,&nbsp;ex_type,&nbsp;queue_name,&nbsp;routing_key,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;durable,&nbsp;exclusive,&nbsp;auto_delete,&nbsp;arguments):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;try:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.exchange_declare(ex_name,&nbsp;ex_type)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.declare_queue(queue_name,&nbsp;durable,&nbsp;exclusive,&nbsp;auto_delete,&nbsp;arguments)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.bind(ex_name,&nbsp;queue_name,&nbsp;routing_key)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.force_data()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.confirm_delivery()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;except&nbsp;Exception,&nbsp;e:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;logger.exception(&quot;Setup&nbsp;error&nbsp;%s&quot;&nbsp;%str(e))&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;raise&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;_publish(self,&nbsp;exchange,&nbsp;routing_key,&nbsp;body,&nbsp;delivery_mode=2):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;start&nbsp;=&nbsp;time.time()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.ensure_channel()&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#&nbsp;Send&nbsp;a&nbsp;message&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;self._channel.basic_publish(&lt;wbr&gt;exchange=exchange,&nbsp;&amp;nbsp;&nbsp;#pika.exceptions.&lt;wbr&gt;ConnectionClosed:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;routing_key=routing_key,&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;body=body,&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;properties=pika.&lt;wbr&gt;BasicProperties(content_type='&lt;wbr&gt;text/plain',&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;delivery_mode=delivery_mode))&lt;wbr&gt;:&nbsp;&amp;nbsp;#durable=True&nbsp;and&nbsp;delivery_mode=2&nbsp;is&nbsp;persistent&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;end&nbsp;=&nbsp;time.time()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&lt;a&nbsp;href=&quot;http://logger.info/&quot;&nbsp;target=&quot;_blank&quot;&nbsp;style=&quot;cursor:&nbsp;pointer;&quot;&gt;logger.info&lt;/a&gt;('cost&nbsp;time&nbsp;%f'&nbsp;%&nbsp;(end-start))&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;0&nbsp;#'Message&nbsp;publish&nbsp;was&nbsp;confirmed'&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;else:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&lt;a&nbsp;href=&quot;http://logger.info/&quot;&nbsp;target=&quot;_blank&quot;&nbsp;style=&quot;cursor:&nbsp;pointer;&quot;&gt;logger.info&lt;/a&gt;('publish&nbsp;error')&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;-1&nbsp;#&nbsp;'Message&nbsp;publish&nbsp;was&nbsp;not&nbsp;confirmed'&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;publish(self,&nbsp;exchange,&nbsp;routing_key,&nbsp;body):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;try:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;self._publish(exchange,&nbsp;routing_key,&nbsp;body)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;except&nbsp;Exception,e:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;logger.exception(&quot;Publish&nbsp;error&nbsp;%s&quot;&nbsp;%&nbsp;str(e))&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;raise&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;setup_consume(self,&nbsp;callback,&nbsp;queue_name):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.ensure_channel()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel.basic_consume(&lt;wbr&gt;callback,&nbsp;queue_name)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;start_consume(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.ensure_channel()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel.start_consuming(&lt;wbr&gt;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;stop_consume(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.ensure_channel()&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self._channel.stop_consuming()&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;def&nbsp;__del__(self):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.close()&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Django&nbsp;code&nbsp;here&nbsp;is&nbsp;:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;queue_args&nbsp;=&nbsp;{&quot;x-ha-policy&quot;&nbsp;:&nbsp;&quot;all&quot;&nbsp;}&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;global&nbsp;g_mq&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt;&lt;div&gt;try:&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;g_mq&nbsp;=&nbsp;RabbitMQ(host=cf['host'],&nbsp;port=cf['port'],&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;username=cf['username'],&nbsp;password=cf['password'])&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;g_mq.publish_setup(ex_name=cf[&lt;wbr&gt;'exchange'],&nbsp;ex_type=cf['ex_type'],&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;queue_name=cf['queue'],&nbsp;routing_key=cf['route_key'],&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;durable=True,&nbsp;exclusive=False,&nbsp;auto_delete=False,&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;arguments=queue_args)&lt;/div&gt;&lt;div&gt;except&nbsp;Exception,e:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;ERR_LOG.info(cf['exchange'])&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;ERR_LOG.exception(&quot;Setup&nbsp;rabbitmq&nbsp;error&nbsp;%s&quot;&nbsp;%&nbsp;str(e))&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;g_mq&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;return&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;try:&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;g_mq.publish(ex_name,&nbsp;route_key,msg)&lt;/div&gt;&lt;div&gt;except&nbsp;Exception,e:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;ERR_LOG.exception(&quot;Publish&nbsp;rabbitmq&nbsp;error&nbsp;%s&quot;&nbsp;%&nbsp;str(e))&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;g_mq&nbsp;=&nbsp;None&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;I&nbsp;enable&nbsp;the&nbsp;uwsgi&nbsp;profiler,&nbsp;saw&nbsp;some&nbsp;information:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[uWSGI&nbsp;Python&nbsp;profiler&nbsp;10124]&nbsp;CALL:&nbsp;build/bdist.linux-x86_64/egg/&lt;wbr&gt;pika/adapters/blocking_&lt;wbr&gt;connection.py&nbsp;(line&nbsp;344)&nbsp;-&amp;gt;&nbsp;_flush_outbound&nbsp;1&nbsp;args,&nbsp;stacksize&nbsp;5&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;solution&nbsp;about&nbsp;the&nbsp;issue?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks.&lt;/div&gt;
</tt>
