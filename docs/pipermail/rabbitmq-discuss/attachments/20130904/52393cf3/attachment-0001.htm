<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;As&nbsp;I&nbsp;said&nbsp;to&nbsp;Tyson,&nbsp;if&nbsp;you&nbsp;ant&nbsp;more&nbsp;specific&nbsp;guidance&nbsp;then&nbsp;you'll&nbsp;need&nbsp;to&nbsp;provide&nbsp;further&nbsp;information&nbsp;about&nbsp;how&nbsp;you&nbsp;are&nbsp;consuming,&nbsp;what&nbsp;your&nbsp;topology&nbsp;looks&nbsp;like&nbsp;and&nbsp;so&nbsp;on.&nbsp;It's&nbsp;great&nbsp;that&nbsp;the&nbsp;cluster&nbsp;topology,&nbsp;environment&nbsp;details&nbsp;and&nbsp;use&nbsp;of&nbsp;HA&nbsp;and&nbsp;durability&nbsp;are&nbsp;specified,&nbsp;but&nbsp;how&nbsp;many&nbsp;queues&nbsp;are&nbsp;we&nbsp;talking&nbsp;about,&nbsp;how&nbsp;many&nbsp;consumers&nbsp;per&nbsp;queue,&nbsp;how&nbsp;are&nbsp;consumers&nbsp;configured,&nbsp;etc&nbsp;etc?&nbsp;Feel&nbsp;free&nbsp;to&nbsp;post&nbsp;that&nbsp;info&nbsp;and&nbsp;we&nbsp;can&nbsp;try&nbsp;to&nbsp;point&nbsp;out&nbsp;what&nbsp;might&nbsp;be&nbsp;causing&nbsp;this&nbsp;kind&nbsp;of&nbsp;behaviour.&nbsp;For&nbsp;just&nbsp;one&nbsp;example,&nbsp;if&nbsp;a&nbsp;network&nbsp;connection&nbsp;to&nbsp;one&nbsp;of&nbsp;the&nbsp;consumers&nbsp;is&nbsp;slow,&nbsp;or&nbsp;a&nbsp;consumer&nbsp;is&nbsp;slow&nbsp;to&nbsp;respond,&nbsp;and&nbsp;you&nbsp;have&nbsp;prefect-count&nbsp;set&nbsp;to&nbsp;1,&nbsp;then&nbsp;*all*&nbsp;the&nbsp;consumers&nbsp;will&nbsp;be&nbsp;affected.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Tim&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;4&nbsp;Sep&nbsp;2013,&nbsp;at&nbsp;19:21,&nbsp;&lt;a&nbsp;href=&quot;mailto:sergey@openbridge.com&quot;&gt;sergey@openbridge.com&lt;/a&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;would&nbsp;also&nbsp;like&nbsp;to&nbsp;hear&nbsp;the&nbsp;answer&nbsp;to&nbsp;this&nbsp;question,&nbsp;because&nbsp;my&nbsp;situation&nbsp;is&nbsp;almost&nbsp;identical.&nbsp;And&nbsp;we&nbsp;thought&nbsp;it's&nbsp;a&nbsp;network&nbsp;problem,&nbsp;and&nbsp;about&nbsp;to&nbsp;move&nbsp;to&nbsp;the&nbsp;bigger&nbsp;instance&nbsp;type,&nbsp;just&nbsp;for&nbsp;the&nbsp;test.&lt;br&gt;&lt;br&gt;On&nbsp;Saturday,&nbsp;August&nbsp;31,&nbsp;2013&nbsp;7:30:24&nbsp;PM&nbsp;UTC-4,&nbsp;Tyson&nbsp;Stewart&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello&nbsp;everyone!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We've&nbsp;been&nbsp;experiencing&nbsp;some&nbsp;behavior&nbsp;that&nbsp;I&nbsp;don't&nbsp;understand,&nbsp;and&nbsp;none&nbsp;of&nbsp;my&nbsp;searching&nbsp;or&nbsp;documentation-reading&nbsp;has&nbsp;been&nbsp;fruitful,&nbsp;so&nbsp;I'm&nbsp;here&nbsp;to&nbsp;ask&nbsp;you&nbsp;all&nbsp;for&nbsp;expert&nbsp;knowledge.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Broadly,&nbsp;we're&nbsp;seeing&nbsp;a&nbsp;lower&nbsp;delivery&nbsp;rate&nbsp;than&nbsp;publish&nbsp;rate.&nbsp;I've&nbsp;attached&nbsp;an&nbsp;image&nbsp;to&nbsp;this&nbsp;message&nbsp;that&nbsp;shows&nbsp;how&nbsp;we're&nbsp;able&nbsp;to&nbsp;keep&nbsp;up&nbsp;when&nbsp;the&nbsp;publish&nbsp;rate&nbsp;is&nbsp;less&nbsp;than&nbsp;600&nbsp;messages/second,&nbsp;but&nbsp;above&nbsp;that,&nbsp;consumption&nbsp;falls&nbsp;behind&nbsp;publication.&nbsp;Around&nbsp;16:00&nbsp;on&nbsp;that&nbsp;chart,&nbsp;we&nbsp;doubled&nbsp;the&nbsp;number&nbsp;of&nbsp;consumers,&nbsp;and&nbsp;it&nbsp;made&nbsp;no&nbsp;difference&nbsp;that&nbsp;we&nbsp;could&nbsp;tell.&nbsp;The&nbsp;erratic&nbsp;behavior&nbsp;of&nbsp;the&nbsp;publish&nbsp;rate&nbsp;is&nbsp;us&nbsp;turning&nbsp;off&nbsp;publishes&nbsp;of&nbsp;the&nbsp;most&nbsp;active&nbsp;queue&nbsp;because&nbsp;we&nbsp;were&nbsp;falling&nbsp;far&nbsp;enough&nbsp;behind&nbsp;that&nbsp;we&nbsp;became&nbsp;worried.&nbsp;When&nbsp;the&nbsp;backlog&nbsp;would&nbsp;get&nbsp;low&nbsp;enough,&nbsp;we&nbsp;would&nbsp;turn&nbsp;it&nbsp;back&nbsp;on,&nbsp;and&nbsp;we&nbsp;did&nbsp;that&nbsp;a&nbsp;few&nbsp;times.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;are&nbsp;some&nbsp;vitals&nbsp;to&nbsp;our&nbsp;cluster:&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;2&nbsp;nodes&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;Each&nbsp;node&nbsp;is&nbsp;a&nbsp;m1.xlarge&nbsp;instance&nbsp;hosted&nbsp;in&nbsp;EC2&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;We&nbsp;have&nbsp;133&nbsp;queues&nbsp;in&nbsp;the&nbsp;cluster&nbsp;(see&nbsp;note&nbsp;below)&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;All&nbsp;queues&nbsp;are&nbsp;mirrored&nbsp;(they&nbsp;all&nbsp;use&nbsp;a&nbsp;policy&nbsp;that&nbsp;makes&nbsp;them&nbsp;highly&nbsp;available)&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;All&nbsp;queues&nbsp;are&nbsp;durable;&nbsp;we&nbsp;use&nbsp;AWS&nbsp;provisioned&nbsp;IOPS&nbsp;to&nbsp;guarantee&nbsp;enough&nbsp;throughput&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;We&nbsp;only&nbsp;use&nbsp;the&nbsp;direct&nbsp;exchange&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;Regarding&nbsp;the&nbsp;number&nbsp;of&nbsp;queues,&nbsp;there&nbsp;are&nbsp;four&nbsp;kinds:&nbsp;the&nbsp;&quot;main&quot;&nbsp;queues,&nbsp;retry-a&nbsp;queues,&nbsp;retry-b&nbsp;queues,&nbsp;and&nbsp;poison&nbsp;queues.&nbsp;Messages&nbsp;that&nbsp;fail&nbsp;for&nbsp;whatever&nbsp;reason&nbsp;during&nbsp;consumption&nbsp;will&nbsp;get&nbsp;put&nbsp;into&nbsp;the&nbsp;retry&nbsp;queues,&nbsp;and&nbsp;if&nbsp;they&nbsp;fail&nbsp;long&nbsp;enough,&nbsp;they'll&nbsp;wind&nbsp;up&nbsp;in&nbsp;the&nbsp;poison&nbsp;queue&nbsp;where&nbsp;they&nbsp;will&nbsp;stay&nbsp;until&nbsp;we&nbsp;do&nbsp;something&nbsp;with&nbsp;them&nbsp;manually&nbsp;much&nbsp;later.&nbsp;The&nbsp;main&nbsp;queues&nbsp;then&nbsp;see&nbsp;the&nbsp;majority&nbsp;of&nbsp;activity.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;average&nbsp;message&nbsp;size&nbsp;is&nbsp;less&nbsp;than&nbsp;1MB.&nbsp;At&nbsp;nearly&nbsp;one&nbsp;million&nbsp;messages,&nbsp;we&nbsp;were&nbsp;still&nbsp;under&nbsp;1GB&nbsp;of&nbsp;memory&nbsp;usage,&nbsp;and&nbsp;our&nbsp;high&nbsp;watermark&nbsp;is&nbsp;5.9GB.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Disk&nbsp;IOPS&nbsp;don't&nbsp;appear&nbsp;to&nbsp;be&nbsp;the&nbsp;problem.&nbsp;Metrics&nbsp;indicated&nbsp;we&nbsp;still&nbsp;had&nbsp;plenty&nbsp;of&nbsp;headroom.&nbsp;Furthermore,&nbsp;if&nbsp;IOPS&nbsp;were&nbsp;the&nbsp;limitation,&nbsp;I&nbsp;would&nbsp;have&nbsp;expected&nbsp;the&nbsp;delivery&nbsp;rate&nbsp;to&nbsp;increase&nbsp;as&nbsp;the&nbsp;publish&nbsp;rate&nbsp;decreased&nbsp;while&nbsp;the&nbsp;consumers&nbsp;worked&nbsp;through&nbsp;the&nbsp;queue.&nbsp;It&nbsp;did&nbsp;not,&nbsp;however,&nbsp;as&nbsp;shown&nbsp;on&nbsp;the&nbsp;chart.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;question&nbsp;primarily&nbsp;is:&nbsp;&lt;b&gt;What&nbsp;do&nbsp;you&nbsp;think&nbsp;is&nbsp;limiting&nbsp;our&nbsp;consumption&nbsp;rate?&lt;/b&gt;&amp;nbsp;I'm&nbsp;curious&nbsp;about&nbsp;what&nbsp;affects&nbsp;consumption&nbsp;rate&nbsp;in&nbsp;general,&nbsp;though.&nbsp;Any&nbsp;advice&nbsp;would&nbsp;be&nbsp;appreciated&nbsp;at&nbsp;this&nbsp;point.&nbsp;Questions&nbsp;for&nbsp;clarification&nbsp;are&nbsp;also&nbsp;welcome!&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;_______________________________________________&lt;br&gt;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
