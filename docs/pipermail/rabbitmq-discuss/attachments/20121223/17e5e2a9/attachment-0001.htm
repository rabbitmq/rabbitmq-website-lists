<tt>
Hey&nbsp;all,&lt;br&gt;&lt;br&gt;I've&nbsp;scoured&nbsp;the&nbsp;internet&nbsp;and&nbsp;this&nbsp;mailing&nbsp;list&nbsp;for&nbsp;Unicorn&nbsp;+&nbsp;Amqp&nbsp;examples&nbsp;and&nbsp;can't&nbsp;seem&nbsp;to&nbsp;find&nbsp;anything&nbsp;that&nbsp;works&nbsp;for&nbsp;my&nbsp;use&nbsp;case,&nbsp;which&nbsp;is&nbsp;presumably&nbsp;a&nbsp;very&nbsp;common&nbsp;one.&amp;nbsp;&nbsp;Basically,&nbsp;based&nbsp;on&nbsp;user&nbsp;web&nbsp;requests&nbsp;I&nbsp;want&nbsp;to&nbsp;publish&nbsp;messages&nbsp;to&nbsp;a&nbsp;queue,&nbsp;have&nbsp;them&nbsp;processed&nbsp;on&nbsp;another&nbsp;server,&nbsp;and&nbsp;then&nbsp;show&nbsp;the&nbsp;results&nbsp;to&nbsp;the&nbsp;user.&amp;nbsp;&nbsp;I&nbsp;would&nbsp;be&nbsp;extremely&nbsp;grateful&nbsp;is&nbsp;someone&nbsp;could&nbsp;provide&nbsp;any&nbsp;insight&nbsp;here.&lt;br&gt;&lt;br&gt;So&nbsp;my&nbsp;current&nbsp;design&nbsp;(based&nbsp;mostly&nbsp;on&nbsp;the&nbsp;Amqp&nbsp;gem&nbsp;examples&nbsp;and&nbsp;this&nbsp;gist:&nbsp;&lt;a&nbsp;href=&quot;https://gist.github.com/2692861&quot;&gt;https://gist.github.com/2692861&lt;/a&gt;)&nbsp;waits&nbsp;for&nbsp;a&nbsp;unicorn&nbsp;worker&nbsp;to&nbsp;fork,&nbsp;runs&nbsp;the&nbsp;EM&nbsp;in&nbsp;another&nbsp;thread,&nbsp;and&nbsp;then&nbsp;does&nbsp;a&nbsp;next_tick&nbsp;that&nbsp;creates&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.&amp;nbsp;&nbsp;Two&nbsp;issues:&lt;br&gt;&lt;br&gt;1.&nbsp;From&nbsp;my&nbsp;controllers,&nbsp;what&nbsp;is&nbsp;the&nbsp;best&nbsp;way&nbsp;to&nbsp;publish&nbsp;messages?&amp;nbsp;&nbsp;That&nbsp;gist&nbsp;has&nbsp;the&nbsp;controllers&nbsp;calling&nbsp;&quot;EventLoopHelper.run&quot;&nbsp;and&nbsp;then&nbsp;publishing,&nbsp;but&nbsp;shouldn't&nbsp;the&nbsp;EM&nbsp;already&nbsp;be&nbsp;running&nbsp;in&nbsp;another&nbsp;thread?&amp;nbsp;&nbsp;It&nbsp;seems&nbsp;like&nbsp;I&nbsp;should&nbsp;be&nbsp;calling&nbsp;next_tick&nbsp;with&nbsp;a&nbsp;block&nbsp;that&nbsp;publishes&nbsp;a&nbsp;message,&nbsp;that&nbsp;way&nbsp;on&nbsp;the&nbsp;next&nbsp;reactor&nbsp;tick&nbsp;the&nbsp;message&nbsp;will&nbsp;get&nbsp;published.&amp;nbsp;&nbsp;But&nbsp;when&nbsp;I&nbsp;use&nbsp;next_tick,&nbsp;the&nbsp;messages&nbsp;get&nbsp;publishes&nbsp;sometimes&nbsp;and&nbsp;other&nbsp;times&nbsp;nothing&nbsp;happens.&amp;nbsp;&nbsp;That&nbsp;is,&nbsp;someones&nbsp;the&nbsp;message&nbsp;isn't&nbsp;published&nbsp;and&nbsp;other&nbsp;times&nbsp;a&nbsp;bunch&nbsp;of&nbsp;messages&nbsp;are&nbsp;published.&amp;nbsp;&nbsp;Is&nbsp;this&nbsp;a&nbsp;thread&nbsp;safety&nbsp;issue&nbsp;or&nbsp;am&nbsp;I&nbsp;just&nbsp;completely&nbsp;missing&nbsp;something?&amp;nbsp;&nbsp;I&nbsp;haven't&nbsp;event&nbsp;attempted&nbsp;to&nbsp;add&nbsp;subscribe&nbsp;functionality&nbsp;into&nbsp;the&nbsp;reactor&nbsp;yet,&nbsp;so&nbsp;nothing&nbsp;should&nbsp;be&nbsp;blocking&nbsp;the&nbsp;reactor.&lt;br&gt;&lt;br&gt;2.&nbsp;I&nbsp;also&nbsp;want&nbsp;my&nbsp;unicorn&nbsp;rails&nbsp;app&nbsp;to&nbsp;subscribe&nbsp;to&nbsp;a&nbsp;queue&nbsp;that&nbsp;has&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;long-running&nbsp;jobs&nbsp;that&nbsp;occur&nbsp;on&nbsp;another&nbsp;server.&amp;nbsp;&nbsp;If&nbsp;I&nbsp;call&nbsp;subscribe&nbsp;in&nbsp;the&nbsp;reactor&nbsp;event&nbsp;loop,&nbsp;will&nbsp;that&nbsp;block&nbsp;the&nbsp;reactor&nbsp;from&nbsp;publishing&nbsp;messages&nbsp;submitted&nbsp;by&nbsp;the&nbsp;controllers?&lt;br&gt;&lt;br&gt;Any&nbsp;help&nbsp;would&nbsp;be&nbsp;much&nbsp;appreciated!&lt;br&gt;&lt;br&gt;-Milo&lt;br&gt;&lt;br&gt;
</tt>
