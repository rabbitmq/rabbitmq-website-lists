<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=gb2312&quot;&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;6.00.6000.20591&quot;&nbsp;name=GENERATOR&gt;<br>
&lt;STYLE&gt;@font-face&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&nbsp;宋体;<br>
}<br>
@font-face&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&nbsp;Verdana;<br>
}<br>
@font-face&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfont-family:&nbsp;@宋体;<br>
}<br>
@page&nbsp;Section1&nbsp;{size:&nbsp;595.3pt&nbsp;841.9pt;&nbsp;margin:&nbsp;72.0pt&nbsp;90.0pt&nbsp;72.0pt&nbsp;90.0pt;&nbsp;layout-grid:&nbsp;15.6pt;&nbsp;}<br>
P.MsoNormal&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTEXT-JUSTIFY:&nbsp;inter-ideograph;&nbsp;FONT-SIZE:&nbsp;10.5pt;&nbsp;MARGIN:&nbsp;0cm&nbsp;0cm&nbsp;0pt;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;;&nbsp;TEXT-ALIGN:&nbsp;justify<br>
}<br>
LI.MsoNormal&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTEXT-JUSTIFY:&nbsp;inter-ideograph;&nbsp;FONT-SIZE:&nbsp;10.5pt;&nbsp;MARGIN:&nbsp;0cm&nbsp;0cm&nbsp;0pt;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;;&nbsp;TEXT-ALIGN:&nbsp;justify<br>
}<br>
DIV.MsoNormal&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTEXT-JUSTIFY:&nbsp;inter-ideograph;&nbsp;FONT-SIZE:&nbsp;10.5pt;&nbsp;MARGIN:&nbsp;0cm&nbsp;0cm&nbsp;0pt;&nbsp;FONT-FAMILY:&nbsp;&quot;Times&nbsp;New&nbsp;Roman&quot;;&nbsp;TEXT-ALIGN:&nbsp;justify<br>
}<br>
A:link&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCOLOR:&nbsp;blue;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
SPAN.MsoHyperlink&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCOLOR:&nbsp;blue;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
A:visited&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCOLOR:&nbsp;purple;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
SPAN.MsoHyperlinkFollowed&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCOLOR:&nbsp;purple;&nbsp;TEXT-DECORATION:&nbsp;underline<br>
}<br>
SPAN.EmailStyle17&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-WEIGHT:&nbsp;normal;&nbsp;COLOR:&nbsp;windowtext;&nbsp;FONT-STYLE:&nbsp;normal;&nbsp;FONT-FAMILY:&nbsp;Verdana;&nbsp;TEXT-DECORATION:&nbsp;none;&nbsp;mso-style-type:&nbsp;personal-compose<br>
}<br>
DIV.Section1&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppage:&nbsp;Section1<br>
}<br>
UNKNOWN&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFONT-SIZE:&nbsp;10pt<br>
}<br>
BLOCKQUOTE&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspMARGIN-TOP:&nbsp;0px;&nbsp;MARGIN-BOTTOM:&nbsp;0px;&nbsp;MARGIN-LEFT:&nbsp;2em<br>
}<br>
OL&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspMARGIN-TOP:&nbsp;0px;&nbsp;MARGIN-BOTTOM:&nbsp;0px<br>
}<br>
UL&nbsp;{<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspMARGIN-TOP:&nbsp;0px;&nbsp;MARGIN-BOTTOM:&nbsp;0px<br>
}<br>
&lt;/STYLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;MARGIN:&nbsp;10px;&nbsp;FONT-FAMILY:&nbsp;verdana&quot;&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;color=#000080&nbsp;size=2&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;color=#000080&nbsp;size=2&gt;Hi&nbsp;Emile&nbsp;：&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&gt;&amp;nbsp;&amp;nbsp;&nbsp;Thanks&nbsp;a&nbsp;lot&nbsp;for&nbsp;your&nbsp;help。&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#000080&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;The&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;<br>
color=#000000&gt;new&amp;nbsp;persister&quot;&nbsp;may&nbsp;be&nbsp;the&nbsp;solution&amp;nbsp;,&nbsp;I&nbsp;will&nbsp;follow&nbsp;it.&nbsp;<br>
Thanks!&amp;nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;color=#000080&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;color=#000080&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&nbsp;&lt;FONT&nbsp;<br>
color=#000000&gt;Regards.&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;color=#000080&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;color=#000080&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;color=#c0c0c0&nbsp;size=2&gt;2010-07-07&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;&lt;FONT&nbsp;<br>
face=Verdana&nbsp;color=#000080&nbsp;size=2&gt;<br>
&lt;HR&nbsp;style=&quot;WIDTH:&nbsp;100px&quot;&nbsp;align=left&nbsp;color=#b5c4df&nbsp;SIZE=1&gt;<br>
&lt;/FONT&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;color=#c0c0c0&nbsp;size=2&gt;&lt;SPAN&gt;张明涛&lt;/SPAN&gt;&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;HR&nbsp;color=#b5c4df&nbsp;SIZE=1&gt;<br>
<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;size=2&gt;&lt;STRONG&gt;发件人：&lt;/STRONG&gt;&nbsp;Emile&nbsp;Joubert&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;size=2&gt;&lt;STRONG&gt;发送时间：&lt;/STRONG&gt;&nbsp;2010-07-06&amp;nbsp;&nbsp;19:44:43&nbsp;<br>
&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;size=2&gt;&lt;STRONG&gt;收件人：&lt;/STRONG&gt;&nbsp;张明涛;&nbsp;RabbitMQ&nbsp;Discuss&nbsp;<br>
&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;size=2&gt;&lt;STRONG&gt;抄送：&lt;/STRONG&gt;&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;size=2&gt;&lt;STRONG&gt;主题：&lt;/STRONG&gt;&nbsp;Re:&nbsp;[rabbitmq-discuss]&nbsp;<br>
rabbit&nbsp;is&nbsp;out&nbsp;of&nbsp;service&nbsp;in&nbsp;disk&nbsp;mode.&nbsp;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;size=2&gt;&lt;/FONT&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&nbsp;size=2&gt;<br>
&lt;DIV&gt;Hi&amp;nbsp;张明涛,&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;Regardless&amp;nbsp;of&amp;nbsp;whether&amp;nbsp;messages&amp;nbsp;are&amp;nbsp;published&amp;nbsp;as&amp;nbsp;persistent,&amp;nbsp;all&amp;nbsp;messages&lt;/DIV&gt;<br>
&lt;DIV&gt;are&amp;nbsp;held&amp;nbsp;in&amp;nbsp;RAM.&amp;nbsp;If&amp;nbsp;you&amp;nbsp;publish&amp;nbsp;messages&amp;nbsp;without&amp;nbsp;consuming&amp;nbsp;them&amp;nbsp;them&amp;nbsp;you&lt;/DIV&gt;<br>
&lt;DIV&gt;will&amp;nbsp;eventually&amp;nbsp;run&amp;nbsp;out&amp;nbsp;of&amp;nbsp;RAM.&amp;nbsp;Your&amp;nbsp;server&amp;nbsp;seems&amp;nbsp;to&amp;nbsp;have&amp;nbsp;enough&amp;nbsp;memory&lt;/DIV&gt;<br>
&lt;DIV&gt;for&amp;nbsp;9000&amp;nbsp;messages.&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;You&amp;nbsp;will&amp;nbsp;not&amp;nbsp;be&amp;nbsp;able&amp;nbsp;to&amp;nbsp;open&amp;nbsp;any&amp;nbsp;new&amp;nbsp;channels&amp;nbsp;to&amp;nbsp;the&amp;nbsp;broker&amp;nbsp;after&amp;nbsp;the&lt;/DIV&gt;<br>
&lt;DIV&gt;memory&amp;nbsp;limit&amp;nbsp;has&amp;nbsp;been&amp;nbsp;reached,&amp;nbsp;but&amp;nbsp;existing&amp;nbsp;consumers&amp;nbsp;may&amp;nbsp;continue&amp;nbsp;to&lt;/DIV&gt;<br>
&lt;DIV&gt;consume&amp;nbsp;messages.&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;The&amp;nbsp;source&amp;nbsp;repository&amp;nbsp;currently&amp;nbsp;contains&amp;nbsp;a&amp;nbsp;new&amp;nbsp;persister&amp;nbsp;in&amp;nbsp;branch&lt;/DIV&gt;<br>
&lt;DIV&gt;(bug21673)&amp;nbsp;which&amp;nbsp;will&amp;nbsp;solve&amp;nbsp;your&amp;nbsp;problem.&amp;nbsp;This&amp;nbsp;feature&amp;nbsp;is&amp;nbsp;currently&lt;/DIV&gt;<br>
&lt;DIV&gt;undergoing&amp;nbsp;QA.&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;The&amp;nbsp;memory&amp;nbsp;high-watermark&amp;nbsp;is&amp;nbsp;somewhat&amp;nbsp;relevant&amp;nbsp;to&amp;nbsp;your&amp;nbsp;situation.&amp;nbsp;This&lt;/DIV&gt;<br>
&lt;DIV&gt;can&amp;nbsp;be&amp;nbsp;set&amp;nbsp;in&amp;nbsp;the&amp;nbsp;config&amp;nbsp;file&amp;nbsp;(see&lt;/DIV&gt;<br>
&lt;DIV&gt;http://www.rabbitmq.com/install.html).&amp;nbsp;The&amp;nbsp;default&amp;nbsp;of&amp;nbsp;40%&amp;nbsp;is&amp;nbsp;recommended.&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;Regards&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;Emile&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;On&amp;nbsp;06/07/10&amp;nbsp;09:39,&amp;nbsp;张明涛&amp;nbsp;wrote:&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;I&amp;nbsp;send&amp;nbsp;messages(size:10kB)&amp;nbsp;to&amp;nbsp;a&amp;nbsp;queue&amp;nbsp;on&amp;nbsp;single&amp;nbsp;node,but&amp;nbsp;with&amp;nbsp;no&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;consumers.&amp;nbsp;Here&amp;nbsp;is&amp;nbsp;my&amp;nbsp;java&amp;nbsp;code:&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.exchangeDeclare(exec,&amp;nbsp;&quot;direct&quot;,&amp;nbsp;true,&amp;nbsp;false,&amp;nbsp;null);&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.queueDeclare(&quot;FirstQueue&quot;,&amp;nbsp;true,&amp;nbsp;false,&amp;nbsp;false,&amp;nbsp;null);&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.queueBind(queueName,&amp;nbsp;exec,&amp;nbsp;routingKey);&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;BasicProperties&amp;nbsp;bp&amp;nbsp;=&amp;nbsp;new&amp;nbsp;BasicProperties();&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;bp.setDeliveryMode(2);&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;channel.basicPublish(exec,&amp;nbsp;routingKey,&amp;nbsp;bp,&amp;nbsp;messageBodyBytes);&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;When&amp;nbsp;9000&amp;nbsp;message&amp;nbsp;sent,&amp;nbsp;the&amp;nbsp;producer&amp;nbsp;was&amp;nbsp;blocked,&amp;nbsp;I&amp;nbsp;got&amp;nbsp;a&amp;nbsp;message&amp;nbsp;in&amp;nbsp;log&amp;nbsp;:&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;vm_memory_high_watermark&amp;nbsp;set.&amp;nbsp;Memory&amp;nbsp;used:288650128&amp;nbsp;allowed:211065241&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;alarm_handler:&amp;nbsp;{set,{vm_memory_high_watermark,[]}}&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Then&amp;nbsp;I&amp;nbsp;stop&amp;nbsp;the&amp;nbsp;rabbit,restart&amp;nbsp;it,&amp;nbsp;but&amp;nbsp;I&amp;nbsp;got&amp;nbsp;same&amp;nbsp;messages&amp;nbsp;in&amp;nbsp;log&amp;nbsp;.&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;If&amp;nbsp;I&amp;nbsp;start&amp;nbsp;a&amp;nbsp;consumer,it&amp;nbsp;receives&amp;nbsp;no&amp;nbsp;messages&amp;nbsp;either。&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Anyone&amp;nbsp;knows&amp;nbsp;how&amp;nbsp;many&amp;nbsp;messages&amp;nbsp;can&amp;nbsp;a&amp;nbsp;queue&amp;nbsp;persist?&amp;nbsp;just&amp;nbsp;9000&amp;nbsp;?&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;I&amp;nbsp;want&amp;nbsp;to&amp;nbsp;persist&amp;nbsp;all&amp;nbsp;the&amp;nbsp;messages,&amp;nbsp;is&amp;nbsp;it&amp;nbsp;possible?&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Anyone&amp;nbsp;give&amp;nbsp;me&amp;nbsp;some&amp;nbsp;advice?&amp;nbsp;Thks&amp;nbsp;.&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
