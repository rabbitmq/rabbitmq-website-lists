<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello&nbsp;there,&lt;div&gt; &nbsp; &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; I&nbsp;am&nbsp;facing&nbsp;a&nbsp;memory&nbsp;leak&nbsp;situation&nbsp;with&nbsp;our&nbsp;production&nbsp;cluster&nbsp;with&nbsp;Rabbit&nbsp;version&nbsp;3.0.2.&nbsp;We&nbsp;have&nbsp;one&nbsp;high&nbsp;volume&nbsp;queue&nbsp;(out&nbsp;of&nbsp;other&nbsp;45&nbsp;queues)&nbsp;causing&nbsp;this&nbsp;issue.&nbsp;The&nbsp;cluster&nbsp;has&nbsp;2&nbsp;nodes&nbsp;and&nbsp;the&nbsp;memory&nbsp;leak&nbsp;happens&nbsp;only&nbsp;on&nbsp;the&nbsp;slave&nbsp;node&nbsp;for&nbsp;that&nbsp;queue.&nbsp;I&nbsp;am&nbsp;attaching&nbsp;two&nbsp;screenshots&nbsp;to&nbsp;show&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;ol&gt;&lt;li&gt;memory&nbsp;on&nbsp;the&nbsp;slave&nbsp;builds&nbsp;up&nbsp;over&nbsp;time&nbsp;compared&nbsp;to&nbsp;the&nbsp;master&nbsp;which&nbsp;stays&nbsp;consistently&nbsp;around&nbsp;400&nbsp;MB.&lt;/li&gt;&lt;li&gt;memory&nbsp;doubles&nbsp;every&nbsp;few&nbsp;seconds&nbsp;for&nbsp;the&nbsp;slave&nbsp;node.&lt;br&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Original&nbsp;memory&nbsp;usage&nbsp;(&nbsp;which&nbsp;is&nbsp;so&nbsp;high&nbsp;compared&nbsp;to&nbsp;the&nbsp;second&nbsp;node&nbsp;which&nbsp;is&nbsp;the&nbsp;master&nbsp;for&nbsp;that&nbsp;queue)&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;img&nbsp;src=&quot;cid:ii_14334f0d4dfcad82&quot;&nbsp;alt=&quot;Inline&nbsp;image&nbsp;2&quot;&nbsp;width=&quot;582&quot;&nbsp;height=&quot;112&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Doubled&nbsp;memory&nbsp;on&nbsp;slave&lt;/div&gt;&lt;div&gt;&lt;img&nbsp;src=&quot;cid:ii_14334f176c3510d2&quot;&nbsp;alt=&quot;Inline&nbsp;image&nbsp;3&quot;&nbsp;width=&quot;582&quot;&nbsp;height=&quot;116&quot;&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;This&nbsp;queue&nbsp;processes&nbsp;300-350&nbsp;messages&nbsp;a&nbsp;sec&nbsp;and&nbsp;we&nbsp;have&nbsp;around&nbsp;0&nbsp;to&nbsp;20&nbsp;messages&nbsp;in&nbsp;the&nbsp;queue&nbsp;coz&nbsp;of&nbsp;traffic&nbsp;spikiness.&nbsp;Here&nbsp;is&nbsp;how&nbsp;producers&nbsp;and&nbsp;consumers&nbsp;are&nbsp;using&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Producers:&lt;/div&gt;&lt;div&gt;<br>
<br>
 &nbsp; &nbsp;Application&nbsp;(php,&nbsp;web&nbsp;servers)&nbsp;will&nbsp;establish&nbsp;a&nbsp;connection,&nbsp;publish&nbsp;a&nbsp;message,&nbsp;close&nbsp;the&nbsp;connection.&nbsp;We&nbsp;have&nbsp;approx&nbsp;250&nbsp;app&nbsp;servers&nbsp;publishing&nbsp;messages&nbsp;for&nbsp;this&nbsp;queue.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Consumers:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
 &nbsp; &nbsp;Worker&nbsp;will&nbsp;establish&nbsp;a&nbsp;connection,&nbsp;consume&nbsp;messages&nbsp;using&nbsp;get&nbsp;with&nbsp;autoack&nbsp;for&nbsp;2&nbsp;mins,&nbsp;worker&nbsp;will&nbsp;close&nbsp;the&nbsp;connection&nbsp;and&nbsp;dies.&nbsp;448&nbsp;workers&nbsp;are&nbsp;consuming&nbsp;messages&nbsp;for&nbsp;this&nbsp;queue. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Note:&nbsp;we&nbsp;use&nbsp;php&nbsp;amqplib&nbsp;0.2.2&nbsp;(which&nbsp;is&nbsp;really&nbsp;old&nbsp;and&nbsp;due&nbsp;for&nbsp;an&nbsp;upgrade)&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;know&nbsp;the&nbsp;quick&nbsp;answer&nbsp;is&nbsp;&quot;upgrade&quot;&nbsp;but&nbsp;is&nbsp;there&nbsp;a&nbsp;short&nbsp;term&nbsp;solution&nbsp;to&nbsp;fix&nbsp;this&nbsp;before&nbsp;we&nbsp;upgrade?&nbsp;I&nbsp;usually&nbsp;delete&nbsp;the&nbsp;queue&nbsp;(since&nbsp;application&nbsp;creates&nbsp;it&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;exist)&nbsp;and&nbsp;take&nbsp;it&nbsp;to&nbsp;stable&nbsp;state&nbsp;before&nbsp;the&nbsp;memory&nbsp;builds&nbsp;up&nbsp;for&nbsp;3&nbsp;days&nbsp;to&nbsp;hit&nbsp;the&nbsp;watermark. &lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Shri&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
