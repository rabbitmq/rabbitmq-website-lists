<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Reading&nbsp;through&nbsp;&lt;a<br>
href=&quot;http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/ConnectingToTheBroker.textile&quot;&gt;http://rubydoc.info/github/ruby-amqp/amqp/master/file/docs/ConnectingToTheBroker.textile&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;I&nbsp;noticed&nbsp;when&nbsp;using&nbsp;the&nbsp;AMQP&nbsp;gem&nbsp;with&nbsp;Unicorn&nbsp;you&nbsp;must:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;i&gt;&quot;start&nbsp;the&nbsp;EventMachine&nbsp;reactor&nbsp;and&nbsp;AMQP&nbsp;connection&nbsp;after&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;master&nbsp;process&nbsp;forks&nbsp;workers&quot;&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;We've&nbsp;been&nbsp;using&nbsp;Unicorn&nbsp;for&nbsp;some&nbsp;time&nbsp;now&nbsp;so&nbsp;I'm&nbsp;aware&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;reestablishing&nbsp;connections&nbsp;after&nbsp;Unicorn&nbsp;forks,&nbsp;however&nbsp;I&nbsp;have&nbsp;some<br>
&nbsp;&nbsp;&nbsp;&nbsp;questions&nbsp;in&nbsp;regards&nbsp;to&nbsp;AMQP.&nbsp;Do&nbsp;I&nbsp;simply&nbsp;need&nbsp;to&nbsp;start&nbsp;up&nbsp;AMQP&nbsp;in&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;separate&nbsp;thread&nbsp;as&nbsp;in&nbsp;the&nbsp;example:&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;code&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;monospace;&nbsp;display:&nbsp;block;&nbsp;padding-top:&nbsp;5px;&nbsp;padding-right:&nbsp;12px;&nbsp;padding-bottom:&nbsp;5px;&nbsp;padding-left:&nbsp;12px;&nbsp;margin-top:&nbsp;4px;&nbsp;border-top-width:&nbsp;1px;&nbsp;border-right-width:&nbsp;1px;&nbsp;border-bottom-width:&nbsp;1px;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-top-style:&nbsp;solid;&nbsp;border-right-style:&nbsp;solid;&nbsp;border-bottom-style:&nbsp;solid;&nbsp;border-left-style:&nbsp;solid;&nbsp;border-top-color:&nbsp;rgb(238,&nbsp;238,&nbsp;255);&nbsp;border-right-color:&nbsp;rgb(238,&nbsp;238,&nbsp;255);&nbsp;border-bottom-color:&nbsp;rgb(238,&nbsp;238,&nbsp;255);&nbsp;border-left-color:&nbsp;rgb(238,&nbsp;238,&nbsp;255);&nbsp;border-image:&nbsp;initial;&nbsp;background-image:&nbsp;initial;&nbsp;background-attachment:&nbsp;initial;&nbsp;background-origin:&nbsp;initial;&nbsp;background-clip:&nbsp;initial;&nbsp;background-color:&nbsp;rgb(245,&nbsp;245,&nbsp;255);&nbsp;font-size:&nbsp;13px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;2;&nbsp;text-align:&nbsp;-webkit-auto;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;widows:&nbsp;2;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-w<br>
ebkit-text-stroke-width:&nbsp;0px;&nbsp;background-position:&nbsp;initial&nbsp;initial;&nbsp;background-repeat:&nbsp;initial&nbsp;initial;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;const&quot;&nbsp;style=&quot;color:&nbsp;rgb(88,&nbsp;92,&nbsp;246);&nbsp;&quot;&gt;Thread&lt;/span&gt;&lt;span&nbsp;class=&quot;period&quot;&gt;.&lt;/span&gt;&lt;span&nbsp;class=&quot;id&nbsp;identifier&nbsp;rubyid_new&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;133,&nbsp;255);&nbsp;&quot;&gt;new&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;lbrace&quot;&gt;{&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;const&quot;&nbsp;style=&quot;color:&nbsp;rgb(88,&nbsp;92,&nbsp;246);&nbsp;&quot;&gt;AMQP&lt;/span&gt;&lt;span&nbsp;class=&quot;period&quot;&gt;.&lt;/span&gt;&lt;span&nbsp;class=&quot;id&nbsp;identifier&nbsp;rubyid_start&quot;&gt;start&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;rbrace&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Then&nbsp;in&nbsp;my&nbsp;controllers&nbsp;I&nbsp;would&nbsp;need&nbsp;to&nbsp;do&nbsp;everything&nbsp;inside&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;next_tick&nbsp;block?&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;charset=&quot;utf-8&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;code&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;monospace;&nbsp;display:&nbsp;block;&nbsp;padding-top:&nbsp;5px;&nbsp;padding-right:&nbsp;12px;&nbsp;padding-bottom:&nbsp;5px;&nbsp;padding-left:&nbsp;12px;&nbsp;margin-top:&nbsp;4px;&nbsp;border-top-width:&nbsp;1px;&nbsp;border-right-width:&nbsp;1px;&nbsp;border-bottom-width:&nbsp;1px;&nbsp;border-left-width:&nbsp;1px;&nbsp;border-top-style:&nbsp;solid;&nbsp;border-right-style:&nbsp;solid;&nbsp;border-bottom-style:&nbsp;solid;&nbsp;border-left-style:&nbsp;solid;&nbsp;border-top-color:&nbsp;rgb(238,&nbsp;238,&nbsp;255);&nbsp;border-right-color:&nbsp;rgb(238,&nbsp;238,&nbsp;255);&nbsp;border-bottom-color:&nbsp;rgb(238,&nbsp;238,&nbsp;255);&nbsp;border-left-color:&nbsp;rgb(238,&nbsp;238,&nbsp;255);&nbsp;border-image:&nbsp;initial;&nbsp;background-image:&nbsp;initial;&nbsp;background-attachment:&nbsp;initial;&nbsp;background-origin:&nbsp;initial;&nbsp;background-clip:&nbsp;initial;&nbsp;background-color:&nbsp;rgb(245,&nbsp;245,&nbsp;255);&nbsp;font-size:&nbsp;13px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;2;&nbsp;text-align:&nbsp;-webkit-auto;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;widows:&nbsp;2;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-w<br>
ebkit-text-stroke-width:&nbsp;0px;&nbsp;background-position:&nbsp;initial&nbsp;initial;&nbsp;background-repeat:&nbsp;initial&nbsp;initial;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;const&quot;&nbsp;style=&quot;color:&nbsp;rgb(88,&nbsp;92,&nbsp;246);&nbsp;&quot;&gt;EventMachine&lt;/span&gt;&lt;span&nbsp;class=&quot;period&quot;&gt;.&lt;/span&gt;&lt;span&nbsp;class=&quot;id&nbsp;identifier&nbsp;rubyid_next_tick&quot;&gt;next_tick&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;kw&quot;&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;255);&nbsp;&quot;&gt;do<br>
...<br>
end<br>
&lt;/span&gt;&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Is&nbsp;this&nbsp;all&nbsp;that&nbsp;is&nbsp;required?&nbsp;How&nbsp;come&nbsp;in&nbsp;the&nbsp;example&nbsp;we&nbsp;are<br>
&nbsp;&nbsp;&nbsp;&nbsp;connecting&nbsp;to&nbsp;a&nbsp;channel/queue&nbsp;in&nbsp;the&nbsp;after_fork&nbsp;hook?&nbsp;Is&nbsp;this&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;debugging&nbsp;purposes?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;also&nbsp;have&nbsp;one&nbsp;other&nbsp;question&nbsp;regarding&nbsp;EventMachine#next_tick.<br>
&nbsp;&nbsp;&nbsp;&nbsp;I've&nbsp;read&nbsp;that:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;i&gt;&quot;Everything&nbsp;scheduled&nbsp;using&nbsp;EM#next_tick&nbsp;will&nbsp;happen<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;synchronously&nbsp;in&nbsp;the&nbsp;main&nbsp;thread.&amp;nbsp;&nbsp;Any&nbsp;long&nbsp;running&nbsp;tasks&nbsp;inside<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;an&nbsp;EM#next_tick&nbsp;block&nbsp;will&nbsp;cause&nbsp;the&nbsp;entire&nbsp;program&nbsp;to&nbsp;block&nbsp;until<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;complete.&nbsp;Typically&nbsp;a&nbsp;bad&nbsp;thing.&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;Does&nbsp;this&nbsp;mean&nbsp;we&nbsp;don't&nbsp;gain&nbsp;anything&nbsp;by&nbsp;using&nbsp;EM&nbsp;in&nbsp;this<br>
&nbsp;&nbsp;&nbsp;&nbsp;fashion..&nbsp;ie&nbsp;our&nbsp;attempt&nbsp;to&nbsp;use&nbsp;AMQP&nbsp;asynchronously&nbsp;is&nbsp;actually<br>
&nbsp;&nbsp;&nbsp;&nbsp;synchronous?&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks&nbsp;for&nbsp;the&nbsp;clarification!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;M&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
