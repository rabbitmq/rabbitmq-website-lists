<tt>
Responses&nbsp;inlined&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;16,&nbsp;2012&nbsp;at&nbsp;5:02&nbsp;AM,&nbsp;TZHA&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:sophiewenxizhang@googlemail.com&quot;&gt;sophiewenxizhang@googlemail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
i&nbsp;am&nbsp;working&nbsp;with&nbsp;rabbitmq-c&nbsp;(downloaded&nbsp;from&nbsp;github/newest&nbsp;version&nbsp;-&lt;br&gt;<br>
cmake/VS2010&nbsp;rebuild&nbsp;under&nbsp;windows)&nbsp;and&nbsp;would&nbsp;like&nbsp;to&nbsp;prepare&nbsp;a&lt;br&gt;<br>
rabbitmq/c/c++&nbsp;based&nbsp;solution&nbsp;for&nbsp;a&nbsp;production&nbsp;environment.&lt;br&gt;<br>
&lt;br&gt;<br>
However&nbsp;for&nbsp;a&nbsp;real&nbsp;application,&nbsp;we&nbsp;still&nbsp;have&nbsp;some&nbsp;reliability&lt;br&gt;<br>
requirements&nbsp;that&nbsp;are&nbsp;apparently&nbsp;not&nbsp;yet&nbsp;supported&nbsp;by&nbsp;rabbitmq-c.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;first&nbsp;requirement&nbsp;is&nbsp;to&nbsp;get&nbsp;“cancellation&nbsp;notification”&nbsp;in&nbsp;case,&lt;br&gt;<br>
e.g.&nbsp;whenever&nbsp;a&nbsp;queue&nbsp;is&nbsp;down&nbsp;–&nbsp;so&nbsp;that&nbsp;the&nbsp;client/consumer&nbsp;can&lt;br&gt;<br>
reconnect&nbsp;to&nbsp;the&nbsp;broker.&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;this&nbsp;purpose&nbsp;–&nbsp;as&nbsp;I&nbsp;understood,&nbsp;the&nbsp;client&nbsp;has&nbsp;to&nbsp;send&nbsp; the&lt;br&gt;<br>
“client-capabilities”&nbsp;with&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; &nbsp;...&lt;br&gt;<br>
&nbsp; &nbsp;consumer_cancel_notify&nbsp;=&nbsp;true,&lt;br&gt;<br>
&nbsp; &nbsp;publisher_confirms&nbsp;=&nbsp;true&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;For&nbsp;the&nbsp;consumer_cancel_notify&nbsp;-&nbsp;the&nbsp;client&nbsp;does&nbsp;need&nbsp;to&nbsp;tell&nbsp;the&nbsp;broker&nbsp;that&nbsp;it&nbsp;wants&nbsp;to&nbsp;turn&nbsp;this&nbsp;on.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;the&nbsp;publisher_confirms&nbsp;-&nbsp;the&nbsp;client&nbsp;is&nbsp;not&nbsp;required&nbsp;to&nbsp;tell&nbsp;the&nbsp;broker&nbsp;to&nbsp;enable&nbsp;this.&nbsp; To&nbsp;enabled&nbsp;it&nbsp;on&nbsp;a&nbsp;channel&nbsp;you&nbsp;should&nbsp;send&nbsp;send&nbsp;a&nbsp;confirm.select&nbsp;to&nbsp;enable&nbsp;publisher_confirms&nbsp;for&nbsp;a&nbsp;channel.&nbsp;You&nbsp;can&nbsp;send&nbsp;the&nbsp;client&nbsp;capabilities&nbsp;to&nbsp;query&nbsp;the&nbsp;broker&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;supports&nbsp;this&nbsp;extension&nbsp;before&nbsp;continuing&nbsp;connecting&nbsp;to&nbsp;a&nbsp;broker.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;some&nbsp;more&nbsp;info&nbsp;how&nbsp;rabbit&nbsp;supports&nbsp;these&nbsp;extensions: &lt;a&nbsp;href=&quot;http://www.rabbitmq.com/extensions.html&quot;&gt;http://www.rabbitmq.com/extensions.html&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
for&nbsp;the&nbsp;connection&nbsp;setup.&nbsp;In&nbsp; case&nbsp;of&nbsp;of&nbsp;rabbitmq-c,&nbsp;I&nbsp;saw&nbsp;that&nbsp;one&lt;br&gt;<br>
shall&nbsp;set&nbsp;the&nbsp;capabilities&nbsp;in&nbsp;amqp_login&nbsp;(amqp_socket.c)&nbsp; method.&lt;br&gt;<br>
Current&nbsp;this&nbsp;is&nbsp;set&nbsp;to&nbsp;NULL.&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp; amqp_connection_open_t&nbsp;s&lt;br&gt;<br>
&nbsp; s.capabilities.len&nbsp;=&nbsp;0;&lt;br&gt;<br>
&nbsp; s.capabilities.bytes&nbsp;=&nbsp;NULL;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;format&nbsp;of&nbsp;that&nbsp;field&nbsp;is&nbsp;I&nbsp;believe&nbsp;a&nbsp;shortstr.&nbsp; However that&amp;#39;s not&nbsp;where&nbsp;you&nbsp;want&nbsp;to&nbsp;send&nbsp;capabilities.&nbsp; When&nbsp;you&nbsp;get&nbsp;the&nbsp;connection.start&nbsp;method&nbsp;from&nbsp;the&nbsp;broker,&nbsp;you&nbsp;need&nbsp;to&nbsp;examine&nbsp;the&nbsp;server-properties&nbsp;(which&nbsp;is&nbsp;a&nbsp;table)&nbsp;parameter&nbsp;to&nbsp;see&nbsp;if&nbsp;the&nbsp;broker&nbsp;supports&nbsp;the&nbsp;extensions&nbsp;you&nbsp;want.&nbsp; When&nbsp;you&nbsp;respond&nbsp;with&nbsp;a&nbsp;connection.start-ok,&nbsp;you&nbsp;need&nbsp;to&nbsp;put&nbsp;the&nbsp;extensions&nbsp;you&nbsp;want&nbsp;to&nbsp;enable&nbsp;in&nbsp;the&nbsp;client-properties&nbsp;parameter,&nbsp;which&nbsp;is&nbsp;also&nbsp;a&nbsp;table.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
Can&nbsp;some&nbsp;expert&nbsp;tell&nbsp;me&nbsp;what&nbsp;kind&nbsp;of&nbsp;syntax&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;the&lt;br&gt;<br>
s.capabilities.bytes&nbsp;field?&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;next&nbsp;requirement&nbsp;is&nbsp;to&nbsp;receive&nbsp;publisher_confirms.&nbsp;I&nbsp;guess&nbsp;that&lt;br&gt;<br>
the&nbsp;client-capabilities&nbsp;is&nbsp;also&nbsp;a&nbsp;pre-condition,&nbsp;and&nbsp;I&nbsp;have&nbsp;to&nbsp;set&nbsp;the&lt;br&gt;<br>
“mandatory”&nbsp;parameter&nbsp;for&nbsp;the&nbsp;amqp_basic_publish&nbsp;method&nbsp;to&nbsp;1.&nbsp;Is&nbsp;there&lt;br&gt;<br>
anything&nbsp;else&nbsp;I&nbsp;have&nbsp;to&nbsp;set?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;order&nbsp;to&nbsp;enable&nbsp;publisher&nbsp;confirms, &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;need&nbsp;to&nbsp;do&nbsp;the&nbsp;confirm.select&nbsp;(amqp_confirm_select(...)&nbsp;)&nbsp;method&nbsp;on&nbsp;the&nbsp;channel&nbsp;you&nbsp;want&nbsp;to&nbsp;enable&nbsp;publisher&nbsp;confirms&nbsp;on.&nbsp; &lt;/div&gt;<br>
&lt;div&gt;After&nbsp;which&nbsp;anytime&nbsp;you&nbsp;do&nbsp;a&nbsp;basic.publish,&nbsp;(amqp_basic_publish(...))&nbsp;you&nbsp;will&nbsp;eventually&nbsp;get&nbsp;a&nbsp;basic.ack&nbsp;back&nbsp;from&nbsp;the&nbsp;broker&nbsp;once&nbsp;the&nbsp;message&nbsp;has&nbsp;been&nbsp;processed*.&lt;/div&gt;&lt;div&gt;*&nbsp;Note:&nbsp;processed&nbsp;does&nbsp;not&nbsp;mean&nbsp;delivered,&nbsp;it&nbsp;just&nbsp;means&nbsp;that&nbsp;the&nbsp;broker&nbsp;received&nbsp;it&nbsp;and&nbsp;did&nbsp;something&nbsp;with&nbsp;it&nbsp;(routed&nbsp;to&nbsp;a&nbsp;queue,&nbsp;returned&nbsp;it,&nbsp;dropped&nbsp;it&nbsp;etc).&nbsp; If&nbsp;you&nbsp;want&nbsp;ensure&nbsp;that&nbsp;the&nbsp;message&nbsp;got&nbsp;routed&nbsp;a&nbsp;queue&nbsp;-&nbsp;send&nbsp;the&nbsp;mandatory&nbsp;flag.&nbsp; If&nbsp;the&nbsp;message&nbsp;isn&amp;#39;t&nbsp;routed&nbsp;to&nbsp;a&nbsp;queue&nbsp;the&nbsp;message&nbsp;will&nbsp;returned&nbsp;to&nbsp;the&nbsp;client&nbsp;with&nbsp;a&nbsp;basic.return,&nbsp;then&nbsp;you&nbsp;will&nbsp;be&nbsp;a&nbsp;basic.ack. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;More&nbsp;information&nbsp;on&nbsp;publisher&nbsp;confirms: &lt;a&nbsp;href=&quot;http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.confirm&quot;&gt;http://www.rabbitmq.com/amqp-0-9-1-reference.html#class.confirm&lt;/a&gt;&lt;/div&gt;&lt;div&gt;More&nbsp;information&nbsp;on&nbsp;the&nbsp;basic&nbsp;publish&nbsp;fields: &lt;a&nbsp;href=&quot;http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish&quot;&gt;http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&gt;Finally&nbsp;an&nbsp;example&nbsp;client&nbsp;that&nbsp;leverages&nbsp;rabbitmq-c&nbsp;and&nbsp;uses&nbsp;publisher&nbsp;confirms: &lt;a&nbsp;href=&quot;https://github.com/alanxz/SimpleAmqpClient/blob/master/src/Channel.cpp#L282&quot;&gt;https://github.com/alanxz/SimpleAmqpClient/blob/master/src/Channel.cpp#L282&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;in&nbsp;advance&nbsp;for&nbsp;any&nbsp;advices.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
