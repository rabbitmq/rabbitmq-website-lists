<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;Hi&nbsp;Chunk.&lt;/div&gt;&lt;div&gt;I&nbsp;don't&nbsp;know&nbsp;Suhail.&nbsp;And&nbsp;his&nbsp;problem&nbsp;may&nbsp;be&nbsp;different&nbsp;from&nbsp;mine.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;To&nbsp;isolate&nbsp;the&nbsp;problem,&nbsp;I've&nbsp;reduce&nbsp;what&nbsp;I'm&nbsp;doing&nbsp;down&nbsp;to&nbsp;the&nbsp;attached&nbsp;code&nbsp;files.&nbsp;One&nbsp;pushes&nbsp;messages,&nbsp;the&nbsp;other&nbsp;pops&nbsp;them.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;see&nbsp;the&nbsp;problem&nbsp;even&nbsp;when&nbsp;only&nbsp;test_push.rb&nbsp;is&nbsp;running&nbsp;(as&nbsp;long&nbsp;as&nbsp;the&nbsp;queue&nbsp;is&nbsp;sufficiently&nbsp;pre-populated).&nbsp;Nothing&nbsp;else&nbsp;is&nbsp;using&nbsp;rabbitmq&nbsp;when&nbsp;I'm&nbsp;doing&nbsp;the&nbsp;test.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;getting&nbsp;the&nbsp;same&nbsp;problem&nbsp;on&nbsp;several&nbsp;different&nbsp;machines&nbsp;here&nbsp;--&nbsp;my&nbsp;local&nbsp;MacOSX&nbsp;box&nbsp;and&nbsp;a&nbsp;server&nbsp;class&nbsp;Debian&nbsp;box.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;exchange&nbsp;-&nbsp;durable&nbsp;or&nbsp;not?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;not&nbsp;durable&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;exchange&nbsp;-&nbsp;type?&nbsp;(Looks&nbsp;like&nbsp;&quot;fanout&quot;&nbsp;from&nbsp;the&nbsp;original&nbsp;post)&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;fanout&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;number&nbsp;of&nbsp;bindings&nbsp;per&nbsp;exchange&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;1&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;queue&nbsp;&amp;nbsp;-&nbsp;durable?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;not&nbsp;durable&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;publishing&nbsp;settings&nbsp;-&nbsp;require&nbsp;ack?&nbsp;persistent?&nbsp;immediate?&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;no&nbsp;ack,&nbsp;non&nbsp;persistent,&nbsp;and&nbsp;non&nbsp;immediate.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;message&nbsp;size?&nbsp;1K&nbsp;according&nbsp;to&nbsp;the&nbsp;original&nbsp;post&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;lt;&nbsp;1K&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;test_push.rb&amp;nbsp;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;---&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;i&gt;require&nbsp;&quot;rubygems&quot;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;require&nbsp;&quot;bunny&quot;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;EXCHANGE&nbsp;=&nbsp;&quot;raw_telemetry&quot;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;QUEUE&nbsp;=&nbsp;&quot;process_telemetry&quot;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;count&nbsp;||=&nbsp;0&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;prev_time&nbsp;||=&nbsp;Time.now&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;msg_server&nbsp;=&nbsp;Bunny.new(:spec&nbsp;=&amp;gt;&nbsp;'08')&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;msg_server.start&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;msg_server.exchange(EXCHANGE,&nbsp;:type&nbsp;&amp;nbsp;=&amp;gt;&nbsp;:fanout)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;msg_server.queue(QUEUE).bind(EXCHANGE)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;loop&nbsp;do&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;msg_server.exchange(EXCHANGE).publish(&quot;This&nbsp;is&nbsp;my&nbsp;msg&quot;)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;count&nbsp;+=&nbsp;1&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;if&nbsp;count&nbsp;&amp;gt;&nbsp;100&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;t&nbsp;=&nbsp;Time.now&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;puts(&quot;msgs&nbsp;pushes&nbsp;per&nbsp;sec:&nbsp;#{count&nbsp;/&nbsp;(t&nbsp;-&nbsp;prev_time)}&quot;)&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;prev_time&nbsp;=&nbsp;t&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;count&nbsp;=&nbsp;0&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;end&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;end&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-style:&nbsp;normal;&nbsp;&quot;&gt;&lt;div&gt;&lt;b&gt;test_pop.rb&amp;nbsp;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;---&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-style:&nbsp;normal;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/i&gt;&lt;/div&gt;&lt;/span&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;&lt;div&gt;require&nbsp;&quot;rubygems&quot;&lt;/div&gt;&lt;div&gt;require&nbsp;&quot;bunny&quot;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;@msg_server&nbsp;=&nbsp;Bunny.new(:spec&nbsp;=&amp;gt;&nbsp;'08')&lt;/div&gt;&lt;div&gt;@msg_server.start&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;start&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;count&nbsp;||=&nbsp;0&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;prev_time&nbsp;||=&nbsp;Time.now&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;queue&nbsp;=&nbsp;@msg_server.queue(&quot;process_telemetry&quot;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;loop&nbsp;do&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;result&nbsp;=&nbsp;queue.pop&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;next&nbsp;if&nbsp;result&nbsp;==&nbsp;:queue_empty&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;count&nbsp;+=&nbsp;1&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;if&nbsp;count&nbsp;&amp;gt;&nbsp;100&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;t&nbsp;=&nbsp;Time.now&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;puts(&quot;msgs&nbsp;pops&nbsp;per&nbsp;sec:&nbsp;#{count&nbsp;/&nbsp;(t&nbsp;-&nbsp;prev_time)}&quot;)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;prev_time&nbsp;=&nbsp;t&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;count&nbsp;=&nbsp;0&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;end&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;end&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;end&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;begin&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;start()&lt;/div&gt;&lt;div&gt;ensure&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;puts&nbsp;&quot;stopping&quot;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;@msg_server.stop&lt;/div&gt;&lt;div&gt;end&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-style:&nbsp;normal;&quot;&gt;&lt;i&gt;&lt;br&gt;&lt;/i&gt;&lt;/span&gt;&lt;/div&gt;&lt;/i&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;8/09/2009,&nbsp;at&nbsp;6:38&nbsp;AM,&nbsp;Chuck&nbsp;Remes&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;Are&nbsp;you&nbsp;running&nbsp;the&nbsp;same&nbsp;code&nbsp;as&nbsp;Aisha?&nbsp;Are&nbsp;you&nbsp;the&nbsp;same&nbsp;person&nbsp;or&nbsp;work&nbsp;together?&nbsp;I'm&nbsp;getting&nbsp;a&nbsp;bit&nbsp;confused&nbsp;in&nbsp;this&nbsp;thread.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And,&nbsp;someone&nbsp;needs&nbsp;to&nbsp;start&nbsp;showing&nbsp;some&nbsp;code.&nbsp;I'm&nbsp;able&nbsp;to&nbsp;push&nbsp;hundreds&nbsp;of&nbsp;messages&nbsp;per&nbsp;second&nbsp;and&nbsp;never&nbsp;see&nbsp;a&nbsp;drop&nbsp;off&nbsp;in&nbsp;delivery&nbsp;performance&nbsp;regardless&nbsp;of&nbsp;the&nbsp;queue&nbsp;size&nbsp;(until&nbsp;I&nbsp;run&nbsp;out&nbsp;of&nbsp;memory).&nbsp;I&nbsp;don't&nbsp;think&nbsp;it&nbsp;is&nbsp;fair&nbsp;to&nbsp;blame&nbsp;rabbit&nbsp;until&nbsp;we&nbsp;can&nbsp;see&nbsp;your&nbsp;code&nbsp;and&nbsp;understand&nbsp;what&nbsp;you&nbsp;are&nbsp;doing.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;please&nbsp;specify&nbsp;the&nbsp;following&nbsp;things:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;exchange&nbsp;-&nbsp;durable&nbsp;or&nbsp;not?&lt;/div&gt;&lt;div&gt;exchange&nbsp;-&nbsp;type?&nbsp;(Looks&nbsp;like&nbsp;&quot;fanout&quot;&nbsp;from&nbsp;the&nbsp;original&nbsp;post)&lt;/div&gt;&lt;div&gt;number&nbsp;of&nbsp;bindings&nbsp;per&nbsp;exchange&lt;/div&gt;&lt;div&gt;queue&nbsp;&amp;nbsp;-&nbsp;durable?&lt;/div&gt;&lt;div&gt;publishing&nbsp;settings&nbsp;-&nbsp;require&nbsp;ack?&nbsp;persistent?&nbsp;immediate?&lt;/div&gt;&lt;div&gt;message&nbsp;size?&nbsp;1K&nbsp;according&nbsp;to&nbsp;the&nbsp;original&nbsp;post&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;your&nbsp;test&nbsp;machine&nbsp;paging&nbsp;or&nbsp;swapping?&nbsp;What&nbsp;is&nbsp;the&nbsp;'top'&nbsp;output&nbsp;for&nbsp;your&nbsp;process&nbsp;and&nbsp;for&nbsp;rabbit&nbsp;at&nbsp;various&nbsp;points&nbsp;of&nbsp;the&nbsp;run&nbsp;cycle?&nbsp;Is&nbsp;it&nbsp;lower&nbsp;or&nbsp;higher&nbsp;when&nbsp;you&nbsp;are&nbsp;getting&nbsp;300&nbsp;msg/s&nbsp;than&nbsp;when&nbsp;you&nbsp;are&nbsp;getting&nbsp;80&nbsp;msg/s?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;is&nbsp;your&nbsp;subscriber&nbsp;doing&nbsp;with&nbsp;the&nbsp;data&nbsp;it&nbsp;receives?&nbsp;If&nbsp;you&nbsp;make&nbsp;that&nbsp;process&nbsp;a&nbsp;&quot;no&nbsp;op&quot;&nbsp;how&nbsp;many&nbsp;messages&nbsp;per&nbsp;second&nbsp;can&nbsp;you&nbsp;handle?&nbsp;Does&nbsp;it&nbsp;ever&nbsp;drop&nbsp;off&nbsp;related&nbsp;to&nbsp;queue&nbsp;size?&nbsp;Why&nbsp;are&nbsp;you&nbsp;&quot;popping&quot;&nbsp;messages&nbsp;from&nbsp;the&nbsp;queue&nbsp;isn't&nbsp;of&nbsp;having&nbsp;them&nbsp;pushed&nbsp;automatically?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;thread&nbsp;has&nbsp;been&nbsp;really&nbsp;frustrating&nbsp;because&nbsp;there&nbsp;has&nbsp;NOT&nbsp;been&nbsp;very&nbsp;much&nbsp;information&nbsp;shared.&nbsp;All&nbsp;I&nbsp;see&nbsp;is&nbsp;&quot;it's&nbsp;slow.&quot;&nbsp;Give&nbsp;us&nbsp;more&nbsp;information.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cr&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Sep&nbsp;7,&nbsp;2009,&nbsp;at&nbsp;11:34&nbsp;AM,&nbsp;Suhail&nbsp;Doshi&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;2009-09-07&nbsp;16:33:10,822&nbsp;INFO&nbsp;[id:&nbsp;95705166]&nbsp;Processing&nbsp;complete,&nbsp;acknowledged.&lt;/div&gt;&lt;div&gt;2009-09-07&nbsp;16:33:10,826&nbsp;INFO&nbsp;[id:&nbsp;95705166]&nbsp;Received&nbsp;queue&nbsp;item,&nbsp;processing...&lt;/div&gt;&lt;div&gt;2009-09-07&nbsp;16:33:10,878&nbsp;INFO&nbsp;[id:&nbsp;95705166]&nbsp;Processing&nbsp;complete,&nbsp;acknowledged.&lt;/div&gt;&nbsp;&lt;div&gt;2009-09-07&nbsp;16:33:10,882&nbsp;INFO&nbsp;[id:&nbsp;95705166]&nbsp;Received&nbsp;queue&nbsp;item,&nbsp;processing...&lt;/div&gt;&lt;div&gt;2009-09-07&nbsp;16:33:12,839&nbsp;INFO&nbsp;[id:&nbsp;95705166]&nbsp;Processing&nbsp;complete,&nbsp;acknowledged.&lt;/div&gt;&lt;div&gt;2009-09-07&nbsp;16:33:12,839&nbsp;INFO&nbsp;[id:&nbsp;95705166]&nbsp;Received&nbsp;queue&nbsp;item,&nbsp;processing...&lt;/div&gt;&nbsp;&lt;div&gt;2009-09-07&nbsp;16:33:13,531&nbsp;INFO&nbsp;[id:&nbsp;95705166]&nbsp;Processing&nbsp;complete,&nbsp;acknowledged.&lt;/div&gt;&lt;div&gt;2009-09-07&nbsp;16:33:13,531&nbsp;INFO&nbsp;[id:&nbsp;95705166]&nbsp;Received&nbsp;queue&nbsp;item,&nbsp;processing...&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;see&nbsp;there's&nbsp;like&nbsp;a&nbsp;pause&nbsp;for&nbsp;a&nbsp;second&nbsp;between&nbsp;10&nbsp;and&nbsp;12,&nbsp;an&nbsp;item&nbsp;gets&nbsp;processed&nbsp;pretty&nbsp;fast&nbsp;as&nbsp;you&nbsp;can&nbsp;see.&nbsp;Odd&nbsp;isn't&nbsp;it?&lt;/div&gt;&nbsp;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Suhail&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Sep&nbsp;7,&nbsp;2009&nbsp;at&nbsp;9:32&nbsp;AM,&nbsp;Suhail&nbsp;Doshi&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:digitalwarfare@gmail.com&quot;&gt;digitalwarfare@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&nbsp;I&nbsp;almost&nbsp;feel&nbsp;as&nbsp;though&nbsp;rabbitmq&nbsp;can't&nbsp;push&nbsp;items&nbsp;to&nbsp;my&nbsp;consumer&nbsp;fast&nbsp;enough,&nbsp;I&nbsp;had&nbsp;a&nbsp;backed&nbsp;up&nbsp;queue&nbsp;with&nbsp;20&nbsp;consumers&nbsp;and&nbsp;spawned&nbsp;another&nbsp;watching&nbsp;the&nbsp;items&nbsp;get&nbsp;processed&nbsp;and&nbsp;it&nbsp;just&nbsp;seemed&nbsp;so&nbsp;slow,&nbsp;saw&nbsp;numerous&nbsp;pauses&nbsp;between&nbsp;item&nbsp;processing&nbsp;and&nbsp;I&nbsp;don't&nbsp;believe&nbsp;it&nbsp;is&nbsp;the&nbsp;consumer's&nbsp;fault.&lt;div&gt;&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;using&nbsp;the&nbsp;Python&nbsp;library&nbsp;for&nbsp;the&nbsp;consumer&nbsp;part.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;Suhail&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Sep&nbsp;7,&nbsp;2009&nbsp;at&nbsp;8:23&nbsp;AM,&nbsp;Chuck&nbsp;Remes&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:cremes.devlist@mac.com&quot;&nbsp;target=&quot;_blank&quot;&gt;cremes.devlist@mac.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;br&gt;&nbsp;On&nbsp;Sep&nbsp;7,&nbsp;2009,&nbsp;at&nbsp;1:07&nbsp;AM,&nbsp;aisha&nbsp;fenton&nbsp;wrote:&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&amp;gt;&nbsp;Hi,&lt;br&gt;&nbsp;&amp;gt;&nbsp;I'm&nbsp;sure&nbsp;I'm&nbsp;doing&nbsp;something&nbsp;wrong&nbsp;since&nbsp;I&nbsp;can't&nbsp;find&nbsp;reference&nbsp;to&lt;br&gt;&nbsp;&amp;gt;&nbsp;this&nbsp;anywhere&nbsp;else.&nbsp;What&nbsp;I'm&nbsp;seeing&nbsp;is&nbsp;that&nbsp;the&nbsp;performance&nbsp;of&lt;br&gt;&nbsp;&amp;gt;&nbsp;draining&nbsp;a&nbsp;queue&nbsp;gets&nbsp;slower&nbsp;as&nbsp;the&nbsp;queue&nbsp;size&nbsp;increases.&lt;br&gt;&nbsp;&amp;gt;&lt;br&gt;&nbsp;&amp;gt;&nbsp;I'm&nbsp;aware&nbsp;of&nbsp;the&nbsp;issue&nbsp;in&nbsp;RabbitMQ&nbsp;1.6&nbsp;that&nbsp;means&nbsp;that&nbsp;when&nbsp;it&nbsp;runs&lt;br&gt;&nbsp;&amp;gt;&nbsp;out&nbsp;of&nbsp;physical&nbsp;memory&nbsp;that&nbsp;it's&nbsp;performance&nbsp;degrades&nbsp;because&nbsp;it&lt;br&gt;&nbsp;&amp;gt;&nbsp;starts&nbsp;swapping&nbsp;out.&nbsp;But&nbsp;I'm&nbsp;not&nbsp;anywhere&nbsp;close&nbsp;to&nbsp;running&nbsp;out&nbsp;of&lt;br&gt;&nbsp;&amp;gt;&nbsp;memory&nbsp;yet,&nbsp;and&nbsp;the&nbsp;degradation&nbsp;starts&nbsp;almost&nbsp;immediately&nbsp;and&lt;br&gt;&nbsp;&amp;gt;&nbsp;increases&nbsp;linearly&nbsp;as&nbsp;the&nbsp;queue&nbsp;depth&nbsp;grows.&lt;br&gt;&nbsp;&amp;gt;&lt;br&gt;&nbsp;&amp;gt;&nbsp;I&nbsp;am&nbsp;publishing&nbsp;500mps&nbsp;to&nbsp;an&nbsp;exchange.&nbsp;Each&nbsp;message&nbsp;is&nbsp;about&nbsp;1KB.&nbsp;I&lt;br&gt;&nbsp;&amp;gt;&nbsp;have&nbsp;a&nbsp;single&nbsp;fanout&nbsp;queue&nbsp;bound&nbsp;to&nbsp;the&nbsp;exchange.&nbsp;A&nbsp;single&nbsp;consumer&nbsp;is&lt;br&gt;&nbsp;&amp;gt;&nbsp;popping&nbsp;messages&nbsp;off&nbsp;the&nbsp;queue.&lt;br&gt;&nbsp;&amp;gt;&lt;br&gt;&nbsp;&amp;gt;&nbsp;When&nbsp;the&nbsp;queue&nbsp;is&nbsp;less&nbsp;than&nbsp;20,000&nbsp;messages&nbsp;I&nbsp;can&nbsp;pop&nbsp;300mps&nbsp;off&nbsp;the&lt;br&gt;&nbsp;&amp;gt;&nbsp;queue.&nbsp;When&nbsp;the&nbsp;queue&nbsp;is&nbsp;200,000&nbsp;messages&nbsp;the&nbsp;performance&nbsp;drop&nbsp;to&lt;br&gt;&nbsp;&amp;gt;&nbsp;40-80mps.&lt;br&gt;&nbsp;&amp;gt;&lt;br&gt;&nbsp;&amp;gt;&nbsp;I'm&nbsp;running&nbsp;RabbitMQ&nbsp;1.6.0.&nbsp;And&nbsp;nether&nbsp;rabbitmq,&nbsp;the&nbsp;consumer,&nbsp;or&nbsp;the&lt;br&gt;&nbsp;&amp;gt;&nbsp;publisher&nbsp;are&nbsp;using&nbsp;more&nbsp;than&nbsp;40%&nbsp;CPU.&lt;br&gt;&nbsp;&amp;gt;&lt;br&gt;&nbsp;&amp;gt;&nbsp;I&nbsp;assume&nbsp;I&nbsp;shouldn't&nbsp;be&nbsp;seeing&nbsp;this?&nbsp;Any&nbsp;help&nbsp;much&nbsp;appreciated.&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&lt;/div&gt;You&nbsp;didn't&nbsp;include&nbsp;any&nbsp;code,&nbsp;but&nbsp;I'm&nbsp;going&nbsp;to&nbsp;take&nbsp;a&nbsp;stab&nbsp;in&nbsp;the&nbsp;dark&lt;br&gt;&nbsp;anyway.&nbsp;If&nbsp;you&nbsp;are&nbsp;using&nbsp;the&nbsp;ruby&nbsp;amqp&nbsp;gem&nbsp;you&nbsp;might&nbsp;be&nbsp;doing&lt;br&gt;&nbsp;something&nbsp;like&nbsp;this:&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;def&nbsp;next_message&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;exchange&nbsp;=&nbsp;MQ.fanout&nbsp;'foo'&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;queue&nbsp;=&nbsp;MQ.queue&nbsp;'bar'&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;queue.bind&nbsp;exchange&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&amp;nbsp;&nbsp;newest_message&nbsp;=&nbsp;queue.pop&lt;br&gt;&nbsp;end&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;In&nbsp;the&nbsp;code&nbsp;above&nbsp;the&nbsp;call&nbsp;to&nbsp;MQ.&amp;lt;whatever&amp;gt;&nbsp;is&nbsp;opening&nbsp;a&nbsp;new&nbsp;channel&lt;br&gt;&nbsp;to&nbsp;rabbitmq&nbsp;each&nbsp;time&nbsp;the&nbsp;method&nbsp;is&nbsp;called.&nbsp;You&nbsp;are&nbsp;essentially&lt;br&gt;&nbsp;leaking&nbsp;channels&nbsp;all&nbsp;over&nbsp;the&nbsp;place&nbsp;every&nbsp;time&nbsp;you&nbsp;try&nbsp;to&nbsp;pop&nbsp;a&nbsp;new&lt;br&gt;&nbsp;message.&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;If&nbsp;you&nbsp;aren't&nbsp;using&nbsp;the&nbsp;ruby&nbsp;amqp&nbsp;stuff,&nbsp;I&nbsp;still&nbsp;recommend&nbsp;checking&lt;br&gt;&nbsp;your&nbsp;code&nbsp;for&nbsp;whatever&nbsp;library&nbsp;you&nbsp;chose.&nbsp;You&nbsp;only&nbsp;need&nbsp;to&nbsp;allocate&nbsp;a&lt;br&gt;&nbsp;few&nbsp;channels&nbsp;and&nbsp;reuse&nbsp;them.&lt;br&gt;&nbsp;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;&nbsp;cr&lt;br&gt;&nbsp;&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;_______________________________________________&lt;br&gt;&nbsp;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;--&nbsp;&lt;br&gt;&lt;a&nbsp;href=&quot;http://mixpanel.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://mixpanel.com&lt;/a&gt;&lt;br&gt;Blog:&nbsp;&lt;a&nbsp;href=&quot;http://blog.mixpanel.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://blog.mixpanel.com&lt;/a&gt;&lt;br&gt;&nbsp;&lt;/div&gt;&lt;/div&gt;&nbsp;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;a&nbsp;href=&quot;http://mixpanel.com/&quot;&gt;http://mixpanel.com&lt;/a&gt;&lt;br&gt;Blog:&nbsp;&lt;a&nbsp;href=&quot;http://blog.mixpanel.com/&quot;&gt;http://blog.mixpanel.com&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
