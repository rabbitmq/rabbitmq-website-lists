<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Matthias,&lt;br&gt;&lt;br&gt;&amp;gt;&nbsp;src/rabbit_amqqueue.erl&lt;br&gt;<br>
<br>
&amp;gt;&nbsp;src/rabbit_channel.erl&lt;br&gt;&amp;gt;&nbsp;These&nbsp;should&nbsp;not&nbsp;be&nbsp;required&nbsp;since&nbsp;they&nbsp;are&nbsp;only&nbsp;used&nbsp;by&nbsp;the&nbsp;direct&nbsp;client.&lt;br&gt;&lt;ul&gt;&lt;li&gt;As&nbsp;the&nbsp;most&nbsp;up&nbsp;to&nbsp;date&nbsp;client&nbsp;code&nbsp;currently&nbsp;stands,&nbsp;amqp_channel&nbsp;calls&nbsp;rabbit_amqqueue&nbsp;in&nbsp;a&nbsp;handle_info&nbsp;function.&nbsp;Although&nbsp;this&nbsp;handle_info&nbsp;function&nbsp;is&nbsp;used&nbsp;only&nbsp;by&nbsp;the&nbsp;direct&nbsp;client,&nbsp;I&nbsp;am&nbsp;uncomfortable&nbsp;with&nbsp;having&nbsp;server-specific&nbsp;code&nbsp;mixed&nbsp;in&nbsp;with&nbsp;pure&nbsp;client&nbsp;code.&nbsp;There&nbsp;should&nbsp;be&nbsp;a&nbsp;clean&nbsp;separation&nbsp;of&nbsp;concerns&nbsp;and&nbsp;all&nbsp;&amp;quot;direct&amp;quot;&nbsp;code,&nbsp;which&nbsp;calls&nbsp;into&nbsp;the&nbsp;server-specific&nbsp;code,&nbsp;should&nbsp;be&nbsp;in&nbsp;one&nbsp;module,&nbsp;and&nbsp;the&nbsp;network-only&nbsp;code&nbsp;in&nbsp;another.&lt;/li&gt;<br>
&lt;/ul&gt;&lt;ul&gt;&lt;li&gt;amqp_network_driver&nbsp;calls&nbsp;rabbit_framing_channel,&nbsp;which&nbsp;in&nbsp;turn&nbsp;calls&nbsp;rabbit_channel.&nbsp;So&nbsp;indirectly,&nbsp;the&nbsp;network&nbsp;client&nbsp;uses&nbsp;rabbit_channel&nbsp;and&nbsp;needs&nbsp;it&nbsp;in&nbsp;the&nbsp;common&nbsp;distribution.&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;/span&gt;I&nbsp;wrote&nbsp;a&nbsp;small&nbsp;program&nbsp;that&nbsp;uses&nbsp;xref&nbsp;to&nbsp;compute&nbsp;all&nbsp;the&nbsp;dependencies&nbsp;(transitive&nbsp;closure,&nbsp;I&nbsp;think)&nbsp;of&nbsp;the&nbsp;network&nbsp;client&nbsp;code,&nbsp;after&nbsp;commenting&nbsp;out&nbsp;all&nbsp;code&nbsp;(that&nbsp;I&nbsp;could&nbsp;find,&nbsp;anyway)&nbsp;used&nbsp;for&nbsp;or&nbsp;by&nbsp;the&nbsp;direct&nbsp;driver.&nbsp;This&nbsp;commented-out&nbsp;code&nbsp;needs&nbsp;to&nbsp;be&nbsp;separated&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;network&nbsp;client,&nbsp;an&nbsp;orthogonal&nbsp;direct&nbsp;client,&nbsp;and&nbsp;functions&nbsp;in&nbsp;a&nbsp;common&nbsp;app&nbsp;that&nbsp;is&nbsp;used&nbsp;both&nbsp;by&nbsp;clients&nbsp;and&nbsp;the&nbsp;server.&nbsp;I&nbsp;will&nbsp;look&nbsp;into&nbsp;how&nbsp;this&nbsp;can&nbsp;be&nbsp;done&nbsp;cleanly.&lt;br&gt;<br>
&lt;br&gt;The&nbsp;output&nbsp;is&nbsp;as&nbsp;follows&nbsp;(I&nbsp;removed&nbsp;dependencies&nbsp;of&nbsp;test&nbsp;code&nbsp;and&nbsp;direct&nbsp;code&nbsp;modules):&lt;br&gt;&lt;br&gt;[&amp;#39;$M_EXPR&amp;#39;,amqp_channel,amqp_connection,amqp_network_driver,&lt;br&gt;&amp;nbsp;amqp_rpc_client,amqp_rpc_handler,amqp_rpc_util,amqp_util,&lt;br&gt;<br>
&amp;nbsp;dict,gen_event,gen_server,gen_tcp,hessian,io,lists,&lt;br&gt;&amp;nbsp;prim_inet,queue,rabbit_binary_generator,rabbit_framing,&lt;br&gt;&amp;nbsp;rabbit_framing_channel,rabbit_heartbeat,rabbit_misc,&lt;br&gt;&amp;nbsp;rabbit_reader,rabbit_writer]&lt;br&gt;&lt;br&gt;So,&nbsp;ignoring&nbsp;modules&nbsp;provided&nbsp;by&nbsp;Erlang/OTP,&nbsp;and&nbsp;the&nbsp;network&nbsp;client&nbsp;modules&nbsp;themselves,&nbsp;the&nbsp;following&nbsp;modules&nbsp;are&nbsp;needed&nbsp;by&nbsp;the&nbsp;network&nbsp;client:&lt;br&gt;<br>
&lt;br&gt;hessian&lt;br&gt;rabbit_binary_generator&lt;br&gt;rabbit_framing&lt;br&gt;rabbit_framing_channel&lt;br&gt;rabbit_heartbeat&lt;br&gt;rabbit_misc&lt;br&gt;rabbit_reader&lt;br&gt;rabbit_writer&lt;br&gt;&lt;br&gt;I&amp;#39;d&nbsp;say&nbsp;that&nbsp;would&nbsp;be&nbsp;the&nbsp;basis&nbsp;of&nbsp;a&nbsp;common&nbsp;app.&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;<br>
Edwin&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Sep&nbsp;7,&nbsp;2008&nbsp;at&nbsp;4:51&nbsp;AM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@lshift.net&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@lshift.net&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
Edwin,&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Edwin&nbsp;Fine&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
A&nbsp;network&nbsp;client&nbsp;should&nbsp;not&nbsp;require&nbsp;server&nbsp;code&nbsp;to&nbsp;be&nbsp;installed&nbsp;on&nbsp;the&nbsp;same&nbsp;node.&nbsp;This&nbsp;is&nbsp;certainly&nbsp;true&nbsp;of&nbsp;other&nbsp;clients&nbsp;I&nbsp;have&nbsp;used.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Bear&nbsp;in&nbsp;mind&nbsp;that&nbsp;the&nbsp;Erlang&nbsp;client&nbsp;code&nbsp;base&nbsp;can&nbsp;operate&nbsp;in&nbsp;both&nbsp;direct&nbsp;and&nbsp;networked&nbsp;mode.&nbsp;For&nbsp;the&nbsp;former&nbsp;you&nbsp;definitely&nbsp;need&nbsp;a&nbsp;server.&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
I&nbsp;respectfully&nbsp;suggest&nbsp;that&nbsp;the&nbsp;above&nbsp;RabbitMQ&nbsp;server&nbsp;modules,&nbsp;and&nbsp;their&nbsp;dependencies,&nbsp;be&nbsp;bundled&nbsp;with&nbsp;the&nbsp;Erlang&nbsp;client.&nbsp;Ideally,&nbsp;I&nbsp;would&nbsp;think&nbsp;it&nbsp;would&nbsp;be&nbsp;best&nbsp;perhaps&nbsp;to&nbsp;put&nbsp;them&nbsp;a&nbsp;separate&nbsp;Erlang&nbsp;library&nbsp;application&nbsp;(maybe&nbsp;&amp;quot;rabbitmq_common&amp;quot;)&nbsp;that&nbsp;is&nbsp;used&nbsp;both&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;the&nbsp;Erlang&nbsp;client.&lt;br&gt;<br>
<br>
<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
The&nbsp;above&nbsp;is&nbsp;on&nbsp;our&nbsp;todo&nbsp;list.&nbsp;Refactoring&nbsp;the&nbsp;code&nbsp;is&nbsp;the&nbsp;easy&nbsp;part.&nbsp;The&nbsp;challenges&nbsp;are&nbsp;in:&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;updating&nbsp;the&nbsp;module&nbsp;structure&nbsp;of&nbsp;the&nbsp;VCS&nbsp;-&nbsp;is&nbsp;rabbitmq_common&nbsp;going&nbsp;to&nbsp;be&nbsp;a&nbsp;separate&nbsp;HG&nbsp;module?&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;figuring&nbsp;out&nbsp;how&nbsp;rabbitmq_common&nbsp;will&nbsp;be&nbsp;distributed.&nbsp;This&nbsp;can&nbsp;be&nbsp;a&nbsp;combination&nbsp;of&nbsp;all&nbsp;of&nbsp;the&nbsp;following:&nbsp;a)&nbsp;separately,&nbsp;b)&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;Erlang&nbsp;client&nbsp;and&nbsp;server&nbsp;source&nbsp;packages,&nbsp;c)&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;Erlang&nbsp;client&nbsp;and&nbsp;server&nbsp;binary&nbsp;packages.&nbsp;Then&nbsp;there&nbsp;also&nbsp;the&nbsp;Debian&nbsp;and&nbsp;RPM&nbsp;packages&nbsp;to&nbsp;consider&nbsp;-&nbsp;are&nbsp;we&nbsp;going&nbsp;to&nbsp;have&nbsp;a&nbsp;separate&nbsp;packages&nbsp;for&nbsp;rabbitmq_common&nbsp;or&nbsp;will&nbsp;it&nbsp;be&nbsp;bundled&nbsp;with&nbsp;the&nbsp;existing&nbsp;packages?&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;<br>
Depending&nbsp;on&nbsp;the&nbsp;above&nbsp;choices&nbsp;a&nbsp;significant&nbsp;amount&nbsp;of&nbsp;work&nbsp;needs&nbsp;to&nbsp;be&nbsp;put&nbsp;into&nbsp;revising&nbsp;the&nbsp;build&nbsp;system,&nbsp;the&nbsp;packaging&nbsp;system,&nbsp;our&nbsp;automated&nbsp;deployment&nbsp;system,&nbsp;the&nbsp;documentation,&nbsp;and&nbsp;parts&nbsp;of&nbsp;the&nbsp;web&nbsp;site.&lt;br&gt;<br>
&lt;br&gt;<br>
That&amp;#39;s&nbsp;why&nbsp;it&nbsp;hasn&amp;#39;t&nbsp;happened&nbsp;yet.&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
Further&nbsp;to&nbsp;my&nbsp;previous&nbsp;email,&nbsp;a&nbsp;minimal&nbsp;list&nbsp;of&nbsp;required&nbsp;modules&nbsp;for&lt;br&gt;<br>
the&nbsp;proposed&nbsp;&amp;quot;rabbit_common&amp;quot;&nbsp;application&nbsp;are&nbsp;listed&nbsp;below&nbsp;(these&nbsp;are&lt;br&gt;<br>
the&nbsp;ones&nbsp;I&nbsp;needed&nbsp;to&nbsp;get&nbsp;things&nbsp;up&nbsp;and&nbsp;running).&nbsp;I&nbsp;am&nbsp;going&nbsp;to&nbsp;make&lt;br&gt;<br>
my&nbsp;own&nbsp;rabbit_common&nbsp;OTP&nbsp;application,&nbsp;and&nbsp;change&nbsp;the&nbsp;Erlang&nbsp;client&nbsp;to&lt;br&gt;<br>
depend&nbsp;on&nbsp;it&nbsp;rather&nbsp;than&nbsp;the&nbsp;server.&nbsp;I&nbsp;will&nbsp;also&nbsp;see&nbsp;what&nbsp;it&nbsp;takes&nbsp;to&lt;br&gt;<br>
change&nbsp;the&nbsp;rabbit&nbsp;1.4.0&nbsp;server&nbsp;itself&nbsp;to&nbsp;factor&nbsp;out&nbsp;the&nbsp;common&nbsp;code&lt;br&gt;<br>
and&nbsp;to&nbsp;use&nbsp;this&nbsp;rabbit_common&nbsp;application.&nbsp;Perhaps&nbsp;I&nbsp;can&nbsp;use&nbsp;Dialyzer&lt;br&gt;<br>
to&nbsp;ensure&nbsp;that&nbsp;I&nbsp;get&nbsp;all&nbsp;dependencies.&nbsp;If&nbsp;this&nbsp;would&nbsp;be&nbsp;of&nbsp;interest&nbsp;I&lt;br&gt;<br>
would&nbsp;be&nbsp;glad&nbsp;to&nbsp;share&nbsp;it.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
We&nbsp;definitely&nbsp;appreciate&nbsp;your&nbsp;help&nbsp;in&nbsp;this.&nbsp;Please&nbsp;give&nbsp;the&nbsp;above&nbsp;points&nbsp;some&nbsp;thought.&nbsp;Also,&nbsp;rather&nbsp;than&nbsp;basing&nbsp;your&nbsp;work&nbsp;on&nbsp;1.4.0,&nbsp;I&amp;#39;d&nbsp;suggest&nbsp;working&nbsp;off&nbsp;the&nbsp;current&nbsp;&amp;#39;default&amp;#39;&nbsp;branches&nbsp;in&nbsp;hg.&lt;br&gt;<br>
&lt;br&gt;<br>
Some&nbsp;comments&nbsp;on&nbsp;the&nbsp;list&nbsp;of&nbsp;files&nbsp;you&nbsp;came&nbsp;up&nbsp;with:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
src/rabbit_misc.erl&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
This&nbsp;should&nbsp;probably&nbsp;be&nbsp;split&nbsp;into&nbsp;the&nbsp;truly&nbsp;common&nbsp;part,&nbsp;the&nbsp;server&nbsp;part&nbsp;and&nbsp;the&nbsp;client&nbsp;part.&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;include/rabbit.hrl&lt;br&gt;<br>
&lt;br&gt;<br>
Ditto,&nbsp;though&nbsp;this&nbsp;is&nbsp;less&nbsp;important.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
src/rabbit_amqqueue.erl&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&amp;gt;&nbsp;src/rabbit_channel.erl&lt;br&gt;<br>
&lt;br&gt;<br>
These&nbsp;should&nbsp;not&nbsp;be&nbsp;required&nbsp;since&nbsp;they&nbsp;are&nbsp;only&nbsp;used&nbsp;by&nbsp;the&nbsp;direct&nbsp;client.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
