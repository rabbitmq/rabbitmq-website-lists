<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Ok,&nbsp;I&nbsp;can&nbsp;see&nbsp;an&nbsp;issue&nbsp;here.&nbsp;There&amp;#39;s&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;Catch-22&nbsp;where&nbsp;the&nbsp;IntialState&nbsp;is&nbsp;obtained&nbsp;from&nbsp;the&nbsp;driver,&nbsp;but&nbsp;we&nbsp;don&amp;#39;t&nbsp;know&nbsp;which&nbsp;driver&nbsp;to&nbsp;get&nbsp;it&nbsp;from&nbsp;because&nbsp;the&nbsp;drive&nbsp;name&nbsp;has&nbsp;to&nbsp;be&nbsp;in&nbsp;the&nbsp;state&nbsp;:).&lt;br&gt;<br>
&lt;br&gt;So&nbsp;I&nbsp;have&nbsp;another&nbsp;suggestion.&nbsp;By&nbsp;the&nbsp;principle&nbsp;of&nbsp;convention&nbsp;over&nbsp;configuration,&nbsp;I&nbsp;present&nbsp;some&nbsp;code,&nbsp;unfortunately&nbsp;a&nbsp;bit&nbsp;long&nbsp;winded&nbsp;but&nbsp;necessary.&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;%%&nbsp;Starts&nbsp;a&nbsp;direct&nbsp;connection&nbsp;to&nbsp;the&nbsp;Rabbit&nbsp;AMQP&nbsp;server,&nbsp;assuming&nbsp;that&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;%%&nbsp;the&nbsp;server&nbsp;is&nbsp;running&nbsp;in&nbsp;the&nbsp;same&nbsp;process&nbsp;space.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;start(User,Password,ProcLink)&nbsp;when&nbsp;is_boolean(ProcLink)&nbsp;-&amp;gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;InitialState&nbsp;=&nbsp;#connection_state{username&nbsp;=&nbsp;User,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;password&nbsp;=&nbsp;Password,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;vhostpath&nbsp;=&nbsp;&amp;lt;&amp;lt;&amp;quot;/&amp;quot;&amp;gt;&amp;gt;},&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{ok,&nbsp;Pid}&nbsp;=&nbsp;start_internal(InitialState,&nbsp;&amp;quot;direct&amp;quot;,&nbsp;ProcLink),&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;/b&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{Pid,&nbsp;direct};&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;%%&nbsp;Starts&nbsp;a&nbsp;networked&nbsp;conection&nbsp;to&nbsp;a&nbsp;remote&nbsp;AMQP&nbsp;server.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;start(User,Password,Host,VHost,ProcLink)&nbsp;-&amp;gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;InitialState&nbsp;=&nbsp;#connection_state{username&nbsp;=&nbsp;User,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;password&nbsp;=&nbsp;Password,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;serverhost&nbsp;=&nbsp;Host,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;vhostpath&nbsp;=&nbsp;VHost},&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;b&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{ok,&nbsp;Pid}&nbsp;=&nbsp;start_internal(InitialState,&nbsp;&amp;quot;network&amp;quot;,&nbsp;ProcLink),&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;/b&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{Pid,&nbsp;network}.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;start_internal(InitialState,&nbsp;DriverType,&nbsp;ProcLink)&nbsp;when&nbsp;is_list(DriverType)&nbsp;-&amp;gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;DriverSpec&nbsp;=&nbsp;build_driver_spec(DriverType),&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;case&nbsp;ProcLink&nbsp;of&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;true&nbsp;-&amp;gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;gen_server:start_link(?MODULE,&nbsp;[InitialState,&nbsp;DriverSpec],&nbsp;[]);&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;false&nbsp;-&amp;gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;gen_server:start(?MODULE,&nbsp;[InitialState,&nbsp;DriverSpec],&nbsp;[])&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;end.&lt;/span&gt;&lt;br&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;init([InitialState,&nbsp;{M,&nbsp;F}])&nbsp;-&amp;gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;State&nbsp;=&nbsp;apply(M,&nbsp;F,&nbsp;[InitialState]),&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{ok,&nbsp;State#driver_module&nbsp;=&nbsp;M}.&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;%&nbsp;or&nbsp;if&nbsp;we&nbsp;can&amp;#39;t&nbsp;modify&nbsp;the&nbsp;driver&nbsp;state&nbsp;record&nbsp;format,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;%&nbsp;we&nbsp;could&nbsp;piggyback&nbsp;it,&nbsp;e.g.&nbsp;#mystate{drv_state&nbsp;=&nbsp;State,&nbsp;drv_module&nbsp;=&nbsp;Module}&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;br&gt;<br>
l2a(L)&nbsp;-&amp;gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;case&nbsp;catch&nbsp;list_to_existing_atom(L)&nbsp;of&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;A&nbsp;when&nbsp;is_atom(A)&nbsp;-&amp;gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;A;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;_&nbsp;-&amp;gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;list_to_atom(L)&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;end.&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;build_driver_spec(DriverType)&nbsp;-&amp;gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;DriverModule&nbsp;=&nbsp;l2a(&amp;quot;amqp_&amp;quot;&nbsp;++&nbsp;DriverType&nbsp;++&nbsp;&amp;quot;_driver&amp;quot;),&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;DriverFn&nbsp;=&nbsp;handshake,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{DriverModule,&nbsp;DriverFn}.&lt;br&gt;<br>
<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;%&nbsp;or&nbsp;maybe&nbsp;just&nbsp;return&nbsp;a&nbsp;fun(X)&nbsp;-&amp;gt;&nbsp;DriverModule:handshake/1,&nbsp;but&nbsp;is&nbsp;that&nbsp;legal?&lt;br&gt;<br>
&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;/span&gt;&lt;br&gt;The&nbsp;rest&nbsp;follows&nbsp;as&nbsp;before.&lt;br&gt;&lt;br&gt;Thoughts?&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Sep&nbsp;7,&nbsp;2008&nbsp;at&nbsp;8:13&nbsp;PM,&nbsp;Edwin&nbsp;Fine&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss_efine@usa.net&quot;&gt;rabbitmq-discuss_efine@usa.net&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hm,&nbsp;I&nbsp;made&nbsp;a&nbsp;mistake&nbsp;in&nbsp;my&nbsp;excitement&nbsp;:)&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{ok,&nbsp;Module}&nbsp;=&nbsp;proplists:get_value(Flavor,&nbsp;State#state.flavor_module),&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;should&nbsp;be&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Module&nbsp;=&nbsp;proplists:get_value(Flavor,&nbsp;State#state.flavor_modules),&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;/span&gt;&lt;br&gt;where&nbsp;flavor_modules&nbsp;would&nbsp;contain&nbsp;something&nbsp;like&nbsp;[{direct,&nbsp;amqp_direct_driver},&nbsp;{network,&nbsp;amqp_network_driver},&nbsp;{whatever,&nbsp;amqp_whatever_driver}].&lt;div&gt;&lt;div&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
On&nbsp;Sun,&nbsp;Sep&nbsp;7,&nbsp;2008&nbsp;at&nbsp;8:06&nbsp;PM,&nbsp;Edwin&nbsp;Fine&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss_efine@usa.net&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss_efine@usa.net&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Let&nbsp;me&nbsp;make&nbsp;a&nbsp;constructive&nbsp;suggestion.&nbsp;By&nbsp;using&nbsp;the&nbsp;configuration,&nbsp;we&nbsp;could&nbsp;avoid&nbsp;the&nbsp;compile-time&nbsp;dependency&nbsp;on&nbsp;either&nbsp;of&nbsp;those&nbsp;modules,&nbsp;and&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;we&nbsp;could&nbsp;make&nbsp;amqp_connection&nbsp;more&nbsp;flexible.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;%%&nbsp;Starts&nbsp;a&nbsp;new&nbsp;channel.&nbsp;Flavor&nbsp;is&nbsp;direct&nbsp;or&nbsp;network.&nbsp;flavor_module&nbsp;is&nbsp;set&nbsp;up&nbsp;to&nbsp;be&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;%%&nbsp;one&nbsp;of&nbsp;amqp_direct_driver&nbsp;or&nbsp;amqp_network_driver&nbsp;(or,&nbsp;some&nbsp;other&nbsp;driver&nbsp;-&nbsp;e.g.&nbsp;future&nbsp;amqp_wmq_driver)&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;handle_call({Flavor,&nbsp;ChannelNumber,&nbsp;OutOfBand},&nbsp;From,&nbsp;State)&nbsp;-&amp;gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{ok,&nbsp;Module}&nbsp;=&nbsp;proplists:get_value(Flavor,&nbsp;State#state.flavor_module),&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;handle_start({ChannelNumber,&nbsp;OutOfBand},&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;fun&nbsp;Module:open_channel/3,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;fun&nbsp;Module:close_channel/1,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;fun&nbsp;Module:do/2,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
<br>
<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;fun&nbsp;Module:do/3,&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;State);&lt;/span&gt;&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;What&nbsp;do&nbsp;you&nbsp;think?&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;Edwin&lt;br&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
