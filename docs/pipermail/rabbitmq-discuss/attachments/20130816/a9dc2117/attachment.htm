<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Simon&nbsp;-&nbsp;Thanks&nbsp;for&nbsp;comparitive&nbsp;values&nbsp;and&nbsp;some&nbsp;more&nbsp;insight&nbsp;into&nbsp;my&nbsp;questions.&nbsp;The&nbsp;discussion&nbsp;is&nbsp;going&nbsp;in&nbsp;a&nbsp;direction&nbsp;to&nbsp;understand &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1)&nbsp;how&nbsp;good&nbsp;or&nbsp;bad&nbsp;my&nbsp;pika&nbsp;clients&nbsp;efficiciency&nbsp;is&nbsp;and&nbsp;then&nbsp;how&nbsp;exactly&nbsp;my&nbsp;system&nbsp;resources&nbsp;are&nbsp;used&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;rabbit&nbsp;server.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;far&nbsp;I&nbsp;can&nbsp;only&nbsp;see&nbsp;that&nbsp;if&nbsp;I&nbsp;send&nbsp;100&nbsp;byes&nbsp;of&nbsp;payload,&nbsp;maximum&nbsp;throughput&nbsp;I&nbsp;get&nbsp;is&nbsp;around&nbsp;30,000&nbsp;msg/sec&nbsp;and&nbsp;maximum&nbsp;bandwidth&nbsp;usage&nbsp;is&nbsp;160-170&nbsp;mbps.&nbsp;Trying&nbsp;to&nbsp;understand&nbsp;what&nbsp;is&nbsp;happening&nbsp;in&nbsp;system&nbsp;with&nbsp;RAM,&nbsp;memory&nbsp;etc.&nbsp;etc.... &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;you&nbsp;mentioned&nbsp;I&nbsp;see&nbsp;comapritively&nbsp;better&nbsp;bandwidth&nbsp;usage&nbsp;with&nbsp;500&nbsp;bytes&nbsp;and&nbsp;1000&nbsp;bytes&nbsp;and&nbsp;they&nbsp;are&nbsp;in&nbsp;range&nbsp;of&nbsp;350&nbsp;Mbps&nbsp;and&nbsp;580&nbsp;Mpbs.&nbsp;Which&nbsp;I&nbsp;don&amp;#39;t&nbsp;know&nbsp;is&nbsp;appropriate&nbsp;or&nbsp;not.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;Do&nbsp;you&nbsp;know&nbsp;if&nbsp;one&nbsp;can&nbsp;saturate&nbsp;8Gbps&nbsp;link&nbsp;with&nbsp;Rabbit&nbsp;? &lt;/div&gt;&lt;div&gt;I&nbsp;mean&nbsp;does&nbsp;the&nbsp;other&nbsp;fastest&nbsp;client&nbsp;could&nbsp;really&nbsp;show&nbsp;bandwidth&nbsp;usage&nbsp;like&nbsp;2,&nbsp;3&nbsp;or&nbsp;5&nbsp;Gbps,&nbsp;given&nbsp;there&nbsp;are&nbsp;20&nbsp;cores&nbsp;of&nbsp;CPU&nbsp;and&nbsp;10GB&nbsp;of&nbsp;RAM&nbsp;exclusively&nbsp;given&nbsp;to&nbsp;rabbit&nbsp;or&nbsp;even&nbsp;higher&nbsp;RAM. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;goal&nbsp;is&nbsp;to&nbsp;understand&nbsp;and&nbsp;hopefully&nbsp;to&nbsp;pin&nbsp;point&nbsp;what&nbsp;could&nbsp;be&nbsp;the&nbsp;bottleneck&nbsp;in&nbsp;the&nbsp;environment&nbsp;I&nbsp;am&nbsp;currently&nbsp;running. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;the&nbsp;earlier&nbsp;question&nbsp;of&nbsp;Micheal&nbsp;on&nbsp;number&nbsp;of&nbsp;cores,&nbsp;here&nbsp;is&nbsp;some&nbsp;more&nbsp;info. &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;10&nbsp;physical&nbsp;cores&nbsp;and&nbsp;they&nbsp;are&nbsp;hyperthreaded&nbsp;so&nbsp;that&amp;#39;s&nbsp;how&nbsp;I&nbsp;have&nbsp;20&nbsp;cores.&nbsp;I&nbsp;have&nbsp;such&nbsp;two&nbsp;machines.&nbsp;So&nbsp;then,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Machine-1&nbsp;with&nbsp;20&nbsp;cores&nbsp;running&nbsp;exclusively&nbsp;my&nbsp;Producer&nbsp;&amp;amp;&nbsp;Receiver&nbsp;based&nbsp;on&nbsp;pika&lt;/div&gt;<br>
&lt;div&gt;Machine-2,&nbsp;again&nbsp;with&nbsp;20&nbsp;cores&nbsp;running&nbsp;exclusively&nbsp;RABBITMQ&nbsp;server&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;us&nbsp;KVM&nbsp;hypervisor&nbsp;and&nbsp;create&nbsp;virtual&nbsp;machine&nbsp;and&nbsp;through&nbsp;this&nbsp;control&nbsp;both&nbsp;cores,&nbsp;RAM&nbsp;and&nbsp;DISK&nbsp;resources&nbsp;for&nbsp;both&nbsp;client&nbsp;and&nbsp;rabbit&nbsp;server.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;had&nbsp;noticed&nbsp;one&nbsp;more&nbsp;thing,&nbsp;may&nbsp;be&nbsp;worth&nbsp;mentioning.&nbsp;When&nbsp;I&nbsp;run &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;dstat&nbsp;--top-latency&nbsp;(&nbsp;which&nbsp;I&nbsp;understand&nbsp;will&nbsp;show&nbsp;me&nbsp;a&nbsp;process&nbsp;with&nbsp;highest&nbsp;latency)&nbsp;it&nbsp;most&nbsp;of&nbsp;the&nbsp;time&nbsp;display&nbsp;&amp;#39;rcu_sched&amp;#39;&nbsp;process.&nbsp;After&nbsp;some&nbsp;googling,&nbsp;I&nbsp;learnt&nbsp;that&nbsp;it&amp;#39;s&nbsp;Read,Copy&nbsp;update&nbsp;scheduling&nbsp;available&nbsp;with&nbsp;linux&nbsp;kernel&nbsp;&amp;gt;&nbsp;2.6.x&nbsp;(I&nbsp;guess).&nbsp;This&nbsp;is&nbsp;a&nbsp;kind&nbsp;of&nbsp;improvement,&nbsp;which&nbsp;allow&nbsp;to&nbsp;read&nbsp;memory&nbsp;while&nbsp;it&amp;#39;s&nbsp;being&nbsp;updated.&nbsp;I&nbsp;don&amp;#39;t&nbsp;know&nbsp;much&nbsp;of&nbsp;it.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;again&nbsp;!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best&nbsp;Regards,&lt;/div&gt;&lt;div&gt;Priyanki.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Aug&nbsp;16,&nbsp;2013&nbsp;at&nbsp;6:10&nbsp;PM,&nbsp;Simon&nbsp;MacMullen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;I&amp;#39;m&nbsp;not&nbsp;completely&nbsp;sure&nbsp;where&nbsp;this&nbsp;discussion&nbsp;is&nbsp;going&nbsp;:-)&nbsp;but&nbsp;I&amp;#39;ll&nbsp;pitch&nbsp;in&nbsp;anyway...&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;16/08/13&nbsp;10:33,&nbsp;Priyanki&nbsp;Vashi&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
In&nbsp;my&nbsp;wireshark&nbsp;traces,&nbsp;I&nbsp;see&nbsp;following&nbsp;frames&nbsp;for&nbsp;every&nbsp;message&nbsp;I&nbsp;send.&lt;br&gt;<br>
I&nbsp;have&nbsp;publisher&nbsp;confirm&nbsp;and&nbsp;consumer&nbsp;ack&nbsp;enabled&nbsp;with&nbsp;prefetch_count&lt;br&gt;<br>
not&nbsp;set.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Of&nbsp;course&nbsp;publisher&nbsp;confirm&nbsp;is&nbsp;optional.&nbsp;Also&nbsp;if&nbsp;the&nbsp;broker&nbsp;is&nbsp;busy&nbsp;enough&nbsp;it&nbsp;can&nbsp;start&nbsp;to&nbsp;issue&nbsp;acks&nbsp;with&nbsp;multiple=true.&nbsp;So&nbsp;you&nbsp;don&amp;#39;t&nbsp;have&nbsp;to&nbsp;pay&nbsp;the&nbsp;cost&nbsp;of&nbsp;an&nbsp;ack&nbsp;for&nbsp;every&nbsp;message&nbsp;published.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
content&nbsp;header&nbsp;=&nbsp;88&nbsp;bytes&nbsp;(&nbsp;does&nbsp;not&nbsp;show&nbsp;any&nbsp;direct&nbsp;info&nbsp;so&nbsp;not&nbsp;sure)&lt;br&gt;<br>
basic.publish&nbsp;frame&nbsp;=&nbsp;85&nbsp;bytes&nbsp;(&nbsp;shows&nbsp;details&nbsp;of&nbsp;queue,&nbsp;exchange,&lt;br&gt;<br>
routing&nbsp;key&nbsp;etc)&lt;br&gt;<br>
content&nbsp;body&nbsp;=&nbsp;137&nbsp;bytes&nbsp;(&nbsp;in&nbsp;this&nbsp;my&nbsp;payload&nbsp;is&nbsp;100&nbsp;bytes&nbsp;of&nbsp;string&nbsp;+&lt;br&gt;<br>
37&nbsp;bytes&nbsp;might&nbsp;be&nbsp;checksum&nbsp;etc.)&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
I&nbsp;don&amp;#39;t&nbsp;see&nbsp;this&nbsp;much.&nbsp;Publishing&nbsp;with:&lt;br&gt;<br>
&lt;br&gt;<br>
$&nbsp;runjava.sh&nbsp;com.rabbitmq.examples.&lt;u&gt;&lt;/u&gt;MulticastMain&nbsp;-C&nbsp;1&nbsp;-y0&nbsp;-s&nbsp;100&lt;br&gt;<br>
&lt;br&gt;<br>
(i.e.&nbsp;publish&nbsp;1&nbsp;message&nbsp;of&nbsp;100&nbsp;bytes,&nbsp;don&amp;#39;t&nbsp;consume&nbsp;anything,&nbsp;then&nbsp;stop)&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;get&nbsp;a&nbsp;255&nbsp;byte&nbsp;(Ethernet)&nbsp;frame&nbsp;sent&nbsp;for&nbsp;the&nbsp;publish:&lt;br&gt;<br>
&lt;br&gt;<br>
14&nbsp;bytes&nbsp;Ethernet&nbsp;II&nbsp;header&lt;br&gt;<br>
20&nbsp;bytes&nbsp;IPv4&nbsp;header&lt;br&gt;<br>
32&nbsp;bytes&nbsp;TCP&nbsp;header&lt;br&gt;<br>
59&nbsp;bytes&nbsp;AMQP&nbsp;basic.publish&nbsp;method&nbsp;(variable&nbsp;size,&nbsp;including&nbsp;exchange&nbsp;name&nbsp;and&nbsp;routing&nbsp;key)&lt;br&gt;<br>
22&nbsp;bytes&nbsp;content&nbsp;header&nbsp;(i.e.&nbsp;minimal&nbsp;basic.properties)&lt;br&gt;<br>
108&nbsp;bytes&nbsp;content&nbsp;(100&nbsp;bytes&nbsp;payload)&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;I&nbsp;suspect&nbsp;there&amp;#39;s&nbsp;something&nbsp;different&nbsp;with&nbsp;your&nbsp;client&nbsp;and&nbsp;/&nbsp;or&nbsp;test&nbsp;app.&nbsp;Note&nbsp;that&nbsp;things&nbsp;like&nbsp;whether&nbsp;you&nbsp;set&nbsp;anything&nbsp;in&nbsp;basic.properties&nbsp;can&nbsp;make&nbsp;quite&nbsp;a&nbsp;difference&nbsp;here,&nbsp;the&nbsp;AMQP&nbsp;encoding&nbsp;is&nbsp;designed&nbsp;to&nbsp;be&nbsp;shorter&nbsp;in&nbsp;the&nbsp;common&nbsp;case.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
For&nbsp;most&nbsp;people&nbsp;the&nbsp;framing&nbsp;costs&nbsp;per&nbsp;message&nbsp;are&nbsp;not&nbsp;excessive.&nbsp;I&nbsp;don&amp;#39;t&nbsp;think&nbsp;there&nbsp;is&nbsp;any&nbsp;particular&nbsp;waste&nbsp;there.&nbsp;If&nbsp;the&nbsp;costs&nbsp;are&nbsp;excessive&nbsp;for&nbsp;you,&nbsp;then&nbsp;MQTT&nbsp;would&nbsp;offer&nbsp;lower&nbsp;(but&nbsp;still&nbsp;present)&nbsp;per-message&nbsp;framing&nbsp;costs.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
But&nbsp;you&nbsp;can&amp;#39;t&nbsp;expect&nbsp;to&nbsp;send&nbsp;tiny&nbsp;messages&nbsp;and&nbsp;fill&nbsp;your&nbsp;network&nbsp;bandwidth&nbsp;anyway.&nbsp;Each&nbsp;message&amp;#39;s&nbsp;framing&nbsp;has&nbsp;a&nbsp;fixed&nbsp;cost&nbsp;to&nbsp;decode,&nbsp;and&nbsp;then&nbsp;each&nbsp;message&nbsp;has&nbsp;a&nbsp;fixed&nbsp;cost&nbsp;for&nbsp;routing&nbsp;logic&nbsp;as&nbsp;well.&nbsp;(Even&nbsp;with&nbsp;fanout&nbsp;exchanges&nbsp;we&nbsp;still&nbsp;have&nbsp;to&nbsp;look&nbsp;up&nbsp;bindings&nbsp;after&nbsp;all.)&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
tl;dr:&nbsp;you&amp;#39;ll&nbsp;notice&nbsp;much&nbsp;higher&nbsp;bandwidth&nbsp;utilisation&nbsp;if&nbsp;you&nbsp;start&nbsp;sending&nbsp;longer&nbsp;messages.&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&nbsp;Simon&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Simon&nbsp;MacMullen&lt;br&gt;<br>
RabbitMQ,&nbsp;Pivotal&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
