<tt>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;TITLE&gt;Re:&nbsp;[rabbitmq-discuss]&nbsp;Librabbitmq&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:11pt'&gt;Hey&nbsp;David,&lt;BR&gt;<br>
&lt;BR&gt;<br>
Thanks&nbsp;for&nbsp;the&nbsp;tips.&nbsp;As&nbsp;you&nbsp;could&nbsp;probably&nbsp;tell,&nbsp;I&nbsp;have&nbsp;little&nbsp;knowledge&nbsp;in&nbsp;this&nbsp;area.&nbsp;I&nbsp;will&nbsp;go&nbsp;with&nbsp;option&nbsp;#3&nbsp;in&nbsp;this&nbsp;case&nbsp;and&nbsp;let&nbsp;you&nbsp;guys&nbsp;know&nbsp;how&nbsp;it&nbsp;work&nbsp;out.&lt;BR&gt;<br>
&lt;BR&gt;<br>
Pieter&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
On&nbsp;5/27/10&nbsp;7:47&nbsp;AM,&nbsp;&amp;quot;David&nbsp;Wragg&amp;quot;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;david@rabbitmq.com&quot;&gt;david@rabbitmq.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:11pt'&gt;Hi&nbsp;Pieter,&lt;BR&gt;<br>
&lt;BR&gt;<br>
Pieter&nbsp;de&nbsp;Zwart&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;pdezwart@rubiconproject.com&quot;&gt;pdezwart@rubiconproject.com&lt;/a&gt;&amp;gt;&nbsp;writes:&lt;BR&gt;<br>
&amp;gt;&nbsp;I&nbsp;am&nbsp;having&nbsp;some&nbsp;trouble&nbsp;with&nbsp;the&nbsp;librabbitmq&nbsp;library,&nbsp;and&nbsp;I&nbsp;am&nbsp;hoping&nbsp;you&lt;BR&gt;<br>
&amp;gt;&nbsp;can&nbsp;help&nbsp;me&nbsp;out.&nbsp;We&nbsp;have&nbsp;managed&nbsp;to&nbsp;created&nbsp;a&nbsp;situation&nbsp;whereby&nbsp;a&nbsp;connection&lt;BR&gt;<br>
&amp;gt;&nbsp;gets&nbsp;closed&nbsp;down,&nbsp;but&nbsp;the&nbsp;PHP&nbsp;client&nbsp;does&nbsp;not&nbsp;know&nbsp;about&nbsp;it&nbsp;yet.&nbsp;As&nbsp;a&lt;BR&gt;<br>
&amp;gt;&nbsp;result,&nbsp;when&nbsp;it&nbsp;tries&nbsp;to&nbsp;clean&nbsp;itself&nbsp;up&nbsp;with&nbsp;amqp_channel_close(),&nbsp;a&lt;BR&gt;<br>
&amp;gt;&nbsp;SIGPIPE&nbsp;is&nbsp;thrown&nbsp;and&nbsp;PHP&nbsp;gets&nbsp;all&nbsp;kinds&nbsp;of&nbsp;pissed&nbsp;off.&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;I&nbsp;was&nbsp;wondering&nbsp;if&nbsp;you&nbsp;could&nbsp;help&nbsp;me&nbsp;either:&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;1.&nbsp;catch&nbsp;SIGPIPE&nbsp;in&nbsp;the&nbsp;PHP&nbsp;C&nbsp;client&nbsp;somehow.&nbsp;(I&nbsp;am&nbsp;a&nbsp;n00b.)&lt;BR&gt;<br>
&amp;gt;&lt;BR&gt;<br>
&amp;gt;&nbsp;2.&nbsp;pass&nbsp;some&nbsp;sort&nbsp;of&nbsp;flag&nbsp;to&nbsp;the&nbsp;connection&nbsp;to&nbsp;ignore&nbsp;SIGPIPE&nbsp;and&nbsp;return&lt;BR&gt;<br>
&amp;gt;&nbsp;false&nbsp;instead.&nbsp;In&nbsp;case&nbsp;you&nbsp;are&nbsp;as&nbsp;clueless&nbsp;as&nbsp;I&nbsp;am&nbsp;(I&nbsp;am&nbsp;sure&nbsp;you&nbsp;are&nbsp;not,&lt;BR&gt;<br>
&amp;gt;&nbsp;but&nbsp;just&nbsp;in&nbsp;case)&nbsp;I&nbsp;found&nbsp;this:&lt;BR&gt;<br>
&amp;gt;&nbsp;setsockopt(sd,&nbsp;SOL_SOCKET,&nbsp;SO_NOSIGPIPE,&nbsp;(void&nbsp;*)&amp;amp;set,&nbsp;sizeof(int));&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;haven't&nbsp;heard&nbsp;of&nbsp;SO_NOSIGPIPE&nbsp;before&nbsp;-&nbsp;it&nbsp;seems&nbsp;to&nbsp;be&nbsp;only&nbsp;available&lt;BR&gt;<br>
on&nbsp;OS&nbsp;X.&lt;BR&gt;<br>
&lt;BR&gt;<br>
There&nbsp;are&nbsp;a&nbsp;couple&nbsp;of&nbsp;other&nbsp;options:&lt;BR&gt;<br>
&lt;BR&gt;<br>
3.&nbsp;If&nbsp;the&nbsp;process&nbsp;sets&nbsp;the&nbsp;handler&nbsp;for&nbsp;SIGPIPE&nbsp;to&nbsp;SIG_IGN,&nbsp;then&nbsp;SIGPIPE&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;will&nbsp;not&nbsp;be&nbsp;raised,&nbsp;and&nbsp;the&nbsp;offending&nbsp;write&nbsp;call&nbsp;will&nbsp;fail&nbsp;with&nbsp;EPIPE.&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;A&nbsp;lot&nbsp;of&nbsp;UNIX&nbsp;processes&nbsp;do&nbsp;this,&nbsp;I&nbsp;believe;&nbsp;SIGPIPE&nbsp;is&nbsp;often&nbsp;more&nbsp;of&nbsp;a&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;nuisance&nbsp;than&nbsp;a&nbsp;feature.&nbsp;&amp;nbsp;librabbitmq&nbsp;will&nbsp;propagate&nbsp;EPIPE,&nbsp;I&nbsp;expect.&lt;BR&gt;<br>
&lt;BR&gt;<br>
4.&nbsp;If,&nbsp;instead&nbsp;of&nbsp;using&nbsp;write(2),&nbsp;we&nbsp;use&nbsp;send(2)&nbsp;and&nbsp;specify&nbsp;the&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;MSG_NOSIGNAL&nbsp;flag,&nbsp;then&nbsp;SIGPIPE&nbsp;will&nbsp;not&nbsp;be&nbsp;raised,&nbsp;and&nbsp;the&nbsp;send&nbsp;call&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;will&nbsp;fail&nbsp;with&nbsp;EPIPE.&nbsp;&amp;nbsp;It&nbsp;sounds&nbsp;like&nbsp;modifying&nbsp;amqp_channel_close&nbsp;to&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;do&nbsp;this&nbsp;might&nbsp;make&nbsp;sense:&nbsp;There's&nbsp;little&nbsp;value&nbsp;in&nbsp;a&nbsp;SIGPIPE&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;when&nbsp;we&nbsp;are&nbsp;trying&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;anyway.&nbsp;Unfortunately,&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;MSG_NOSIGNAL&nbsp;is&nbsp;only&nbsp;supported&nbsp;by&nbsp;some&nbsp;OSes.&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;suspect&nbsp;that&nbsp;(3)&nbsp;might&nbsp;be&nbsp;your&nbsp;best&nbsp;option,&nbsp;at&nbsp;least&nbsp;for&nbsp;now.&nbsp;&amp;nbsp;It's&lt;BR&gt;<br>
process&nbsp;wide,&nbsp;but&nbsp;if&nbsp;PHP&nbsp;isn't&nbsp;happy&nbsp;about&nbsp;getting&nbsp;SIGPIPE,&nbsp;that&nbsp;is&lt;BR&gt;<br>
probably&nbsp;quite&nbsp;reasonable.&lt;BR&gt;<br>
&lt;BR&gt;<br>
David&lt;BR&gt;<br>
&lt;BR&gt;<br>
--&lt;BR&gt;<br>
David&nbsp;Wragg&lt;BR&gt;<br>
Staff&nbsp;Engineer,&nbsp;RabbitMQ&lt;BR&gt;<br>
SpringSource,&nbsp;a&nbsp;division&nbsp;of&nbsp;VMware&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/BLOCKQUOTE&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:11pt'&gt;&lt;BR&gt;<br>
--&nbsp;&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#343434&quot;&gt;&lt;FONT&nbsp;SIZE=&quot;4&quot;&gt;&lt;FONT&nbsp;FACE=&quot;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:14pt'&gt;the&nbsp;rubicon&nbsp;project&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;FACE=&quot;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;FONT&nbsp;COLOR=&quot;#BA0022&quot;&gt;&lt;FONT&nbsp;SIZE=&quot;1&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:9pt'&gt;&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;SPAN&nbsp;STYLE='font-size:7pt'&gt;PIETER&nbsp;DE&nbsp;ZWART&nbsp;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;SIZE=&quot;1&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:7pt'&gt;&lt;FONT&nbsp;COLOR=&quot;#404040&quot;&gt;|&nbsp;INTERFACES&nbsp;ENGINEER&lt;BR&gt;<br>
&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#AC0021&quot;&gt;&lt;BR&gt;<br>
&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#BB001E&quot;&gt;&amp;#8226;&amp;#8226;&amp;#8226;&nbsp;P&nbsp;310&nbsp;207&nbsp;0272&nbsp;|&nbsp;x224&lt;BR&gt;<br>
&amp;#8226;&amp;#8226;&amp;#8226;&nbsp;F&nbsp;323&nbsp;466&nbsp;7119&lt;BR&gt;<br>
&lt;/FONT&gt;&lt;BR&gt;<br>
&lt;FONT&nbsp;COLOR=&quot;#3C3C3C&quot;&gt;&lt;BR&gt;<br>
1925&nbsp;S.&nbsp;BUNDY&nbsp;&amp;nbsp;DRIVE&lt;BR&gt;<br>
LOS&nbsp;ANGELES,&nbsp;CALIFORNIA&nbsp;90025&lt;BR&gt;<br>
&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#B60F1D&quot;&gt;&lt;BR&gt;<br>
&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#0000FF&quot;&gt;WWW.RUBICONPROJECT.COM&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#B60F1D&quot;&gt;&nbsp;&amp;lt;&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#0000FF&quot;&gt;&lt;U&gt;&lt;a&nbsp;href=&quot;http://&quot;&gt;http://&lt;/a&gt;www.rubiconproject.com/&lt;/U&gt;&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#B60F1D&quot;&gt;&amp;gt;&nbsp;&lt;BR&gt;<br>
&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:11pt'&gt;&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#2F2F2F&quot;&gt;&lt;FONT&nbsp;SIZE=&quot;4&quot;&gt;&lt;FONT&nbsp;FACE=&quot;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:13pt'&gt;&lt;IMG&nbsp;src=&quot;cid:3357794251_6331661&quot;&nbsp;&gt;&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;FACE=&quot;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;FONT&nbsp;COLOR=&quot;#787878&quot;&gt;&lt;FONT&nbsp;SIZE=&quot;1&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:7pt'&gt;&amp;#8220;COMPANY&nbsp;OF&nbsp;THE&nbsp;YEAR&amp;#8221;&nbsp;ALWAYSON&nbsp;ONMEDIA&nbsp;2009&lt;BR&gt;<br>
#24&nbsp;ON&nbsp;FAST&nbsp;COMPANY&nbsp;FAST&nbsp;50&nbsp;READER&nbsp;FAVORITES&lt;BR&gt;<br>
2008&nbsp;&amp;nbsp;ALWAYSON&nbsp;250&nbsp;GLOBAL&nbsp;WINNER&lt;BR&gt;<br>
2008&nbsp;ALWAYSON&nbsp;ONMEDIA&nbsp;100&nbsp;WINNER&lt;BR&gt;<br>
TWIISTUP3&nbsp;&amp;nbsp;BEST&nbsp;IN&nbsp;SHOW&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;SIZE=&quot;1&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:7pt'&gt;&lt;FONT&nbsp;COLOR=&quot;#777777&quot;&gt;PRICEWATERHOUSECOOPERS&nbsp;&amp;#8211;&nbsp;ENTRETECH&nbsp;&amp;nbsp;BEST&nbsp;STARTUP&lt;BR&gt;<br>
&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#787878&quot;&gt;AMERICAN&nbsp;BUSINESS&nbsp;AWARDS&nbsp;-&nbsp;STEVIES&nbsp;&amp;nbsp;&amp;#8216;08&nbsp;FINALIST&nbsp;BEST&nbsp;NEW&nbsp;COMPANY&lt;BR&gt;<br>
&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#777777&quot;&gt;AMERICAN&nbsp;BUSINESS&nbsp;&amp;nbsp;AWARDS&nbsp;-&nbsp;STEVIES&nbsp;&amp;#8216;08&nbsp;FINALIST&nbsp;MOST&nbsp;INNOVATIVE&nbsp;COMPANY&lt;BR&gt;<br>
AMERICAN&nbsp;BUSINESS&nbsp;&amp;nbsp;AWARDS&nbsp;-&nbsp;STEVIES&nbsp;&amp;#8216;08&nbsp;FINALIST&nbsp;NEW&nbsp;PRODUCT&nbsp;OR&nbsp;SERVICE&nbsp;-&nbsp;&amp;nbsp;SERVICES&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;COLOR=&quot;#198000&quot;&gt;&lt;FONT&nbsp;SIZE=&quot;6&quot;&gt;&lt;FONT&nbsp;FACE=&quot;Webdings&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:24pt'&gt;P&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;SIZE=&quot;1&quot;&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:7pt'&gt;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/SPAN&gt;&lt;/FONT&gt;&lt;FONT&nbsp;FACE=&quot;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:8pt'&gt;Please&nbsp;consider&nbsp;the&nbsp;environment&nbsp;before&nbsp;printing&nbsp;this&nbsp;e-mail&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;FONT&nbsp;FACE=&quot;Calibri,&nbsp;Verdana,&nbsp;Helvetica,&nbsp;Arial&quot;&gt;&lt;SPAN&nbsp;STYLE='font-size:11pt'&gt;&lt;BR&gt;<br>
&lt;/SPAN&gt;&lt;/FONT&gt;<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>
<br>

</tt>
