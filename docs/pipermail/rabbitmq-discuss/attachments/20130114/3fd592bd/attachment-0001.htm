<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;Putting&nbsp;the&nbsp;list&nbsp;back&nbsp;on&nbsp;CC&nbsp;-&nbsp;I&nbsp;didn't&nbsp;realise&nbsp;I&nbsp;hadn't&nbsp;hit&nbsp;reply-all.&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;Begin&nbsp;forwarded&nbsp;message:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:'Helvetica';&nbsp;font-size:medium;&nbsp;color:rgba(0,&nbsp;0,&nbsp;0,&nbsp;1.0);&quot;&gt;&lt;b&gt;From:&nbsp;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:'Helvetica';&nbsp;font-size:medium;&quot;&gt;&quot;Ryan&nbsp;R.&quot;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:ryan.rajkomar@gmail.com&quot;&gt;ryan.rajkomar@gmail.com&lt;/a&gt;&amp;gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:'Helvetica';&nbsp;font-size:medium;&nbsp;color:rgba(0,&nbsp;0,&nbsp;0,&nbsp;1.0);&quot;&gt;&lt;b&gt;Subject:&nbsp;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:'Helvetica';&nbsp;font-size:medium;&quot;&gt;&lt;b&gt;Re:&nbsp;[rabbitmq-discuss]&nbsp;One&nbsp;Producer,&nbsp;X&nbsp;Consumers&nbsp;where&nbsp;X&nbsp;can&nbsp;change&lt;/b&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:'Helvetica';&nbsp;font-size:medium;&nbsp;color:rgba(0,&nbsp;0,&nbsp;0,&nbsp;1.0);&quot;&gt;&lt;b&gt;Date:&nbsp;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:'Helvetica';&nbsp;font-size:medium;&quot;&gt;14&nbsp;January&nbsp;2013&nbsp;10:21:48&nbsp;GMT&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;margin-top:&nbsp;0px;&nbsp;margin-right:&nbsp;0px;&nbsp;margin-bottom:&nbsp;0px;&nbsp;margin-left:&nbsp;0px;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:'Helvetica';&nbsp;font-size:medium;&nbsp;color:rgba(0,&nbsp;0,&nbsp;0,&nbsp;1.0);&quot;&gt;&lt;b&gt;To:&nbsp;&lt;/b&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:'Helvetica';&nbsp;font-size:medium;&quot;&gt;Tim&nbsp;Watson&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:tim@rabbitmq.com&quot;&gt;tim@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;First&nbsp;of&nbsp;all&nbsp;thanks&nbsp;for&nbsp;the&nbsp;quick&nbsp;reply,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;I'm&nbsp;well&nbsp;aware&nbsp;that&nbsp;trying&nbsp;to&nbsp;use&nbsp;such&nbsp;solution&nbsp;as&nbsp;many&nbsp;issues&nbsp;(mostly&nbsp;the&nbsp;data&nbsp;integrity&nbsp;should&nbsp;a&nbsp;error&nbsp;arise&nbsp;somewhere&nbsp;along&nbsp;the&nbsp;process)&nbsp;and&nbsp;that&nbsp;is&nbsp;indeed&nbsp;problematic.&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;I&nbsp;was&nbsp;actually&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;potential&nbsp;way&nbsp;of&nbsp;doing&nbsp;what&nbsp;I&nbsp;need&nbsp;:&nbsp;I&nbsp;have&nbsp;one&nbsp;(or&nbsp;more)&nbsp;webservices&nbsp;whose&nbsp;objects&nbsp;might&nbsp;contains&nbsp;references&nbsp;to&nbsp;objects&nbsp;of&nbsp;another&nbsp;webservice&nbsp;(ideally&nbsp;each&nbsp;WS&nbsp;has&nbsp;its&nbsp;own&nbsp;DB&nbsp;on&nbsp;a&nbsp;different&nbsp;server)&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;The&nbsp;issue&nbsp;here&nbsp;is&nbsp;how&nbsp;to&nbsp;keep&nbsp;data&nbsp;integrity&nbsp;when&nbsp;trying&nbsp;to&nbsp;delete&nbsp;the&nbsp;referenced&nbsp;element&nbsp;:&nbsp;if&nbsp;one&nbsp;of&nbsp;the&nbsp;references&nbsp;can't&nbsp;be&nbsp;deleted&nbsp;(for&nbsp;any&nbsp;reason)&nbsp;nothing&nbsp;should&nbsp;be&nbsp;deleted.&nbsp;However&nbsp;here,&nbsp;since&nbsp;data&nbsp;on&nbsp;on&nbsp;different&nbsp;database/webservices/server,&nbsp;I&nbsp;can't&nbsp;do&nbsp;a&nbsp;simple&nbsp;DB&nbsp;transaction.&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Initially&nbsp;I&nbsp;did&nbsp;not&nbsp;really&nbsp;intend&nbsp;to&nbsp;use&nbsp;rabbitMQ&nbsp;for&nbsp;this&nbsp;but&nbsp;only&nbsp;for&nbsp;a&nbsp;notifications&nbsp;system.&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;I&nbsp;figured,&nbsp;since&nbsp;having&nbsp;a&nbsp;delay&nbsp;in&nbsp;my&nbsp;deletion&nbsp;process&nbsp;between&nbsp;the&nbsp;request&nbsp;and&nbsp;the&nbsp;actual&nbsp;deletion&nbsp;wasn't&nbsp;an&nbsp;issue,&nbsp;maybe&nbsp;I&nbsp;might&nbsp;be&nbsp;able&nbsp;to&nbsp;find&nbsp;a&nbsp;solution&nbsp;there.&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Finally,&nbsp;and&nbsp;this&nbsp;has&nbsp;nothing&nbsp;to&nbsp;do&nbsp;with&nbsp;my&nbsp;research,&nbsp;for&nbsp;some&nbsp;reason&nbsp;I&nbsp;do&nbsp;not&nbsp;see&nbsp;your&nbsp;post&nbsp;in&nbsp;google&nbsp;groups.&nbsp;How&nbsp;come?&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;again,&lt;br&gt;Cheers.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2013/1/14&nbsp;Tim&nbsp;Watson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:tim@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;tim@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;&lt;div&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi,&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;01/14/2013&nbsp;08:34&nbsp;AM,&nbsp;Shadowalker&nbsp;wrote:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Hi&nbsp;again,&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Been&nbsp;doing&nbsp;a&nbsp;lot&nbsp;of&nbsp;googling&nbsp;on&nbsp;the&nbsp;queue/topic/listening&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consumed&nbsp;messages&nbsp;count&nbsp;an&nbsp;found&nbsp;this&nbsp;on&nbsp;activemq&nbsp;:&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://activemq.apache.org/cms/handling-advisory-messages.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://activemq.apache.org/&lt;u&gt;&lt;/u&gt;cms/handling-advisory-&lt;u&gt;&lt;/u&gt;messages.html&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;allows&nbsp;one&nbsp;to&nbsp;check&nbsp;the&nbsp;count&nbsp;of&nbsp;currently&nbsp;listening&nbsp;consumer&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queue/topic.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;would&nbsp;not&nbsp;recommend&nbsp;an&nbsp;architecture&nbsp;for&nbsp;distributed&nbsp;resource<br>
&nbsp;&nbsp;&nbsp;&nbsp;tracking&nbsp;based&nbsp;on&nbsp;that.&nbsp;What&nbsp;happens&nbsp;if&nbsp;a&nbsp;consumer&nbsp;is&nbsp;temporarily<br>
&nbsp;&nbsp;&nbsp;&nbsp;disconnected&nbsp;when&nbsp;you&nbsp;go&nbsp;into&nbsp;the&nbsp;check,&nbsp;but&nbsp;reconnects&nbsp;after&nbsp;(or<br>
&nbsp;&nbsp;&nbsp;&nbsp;whilst)&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;participants&nbsp;are&nbsp;being&nbsp;updated?&nbsp;You've<br>
&nbsp;&nbsp;&nbsp;&nbsp;introduced&nbsp;even&nbsp;more&nbsp;possibilities&nbsp;for&nbsp;race&nbsp;conditions&nbsp;than&nbsp;before.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;What&nbsp;I&nbsp;would&nbsp;suggest&nbsp;is&nbsp;that&nbsp;you&nbsp;carefully&nbsp;consider&nbsp;whether&nbsp;you<br>
&nbsp;&nbsp;&nbsp;&nbsp;actually&nbsp;need&nbsp;synchronous&nbsp;communications&nbsp;here,&nbsp;as&nbsp;messaging&nbsp;based<br>
&nbsp;&nbsp;&nbsp;&nbsp;architectures&nbsp;inherently&nbsp;de-couple&nbsp;producers&nbsp;from&nbsp;consumers,&nbsp;yet<br>
&nbsp;&nbsp;&nbsp;&nbsp;you've&nbsp;repeatedly&nbsp;attempted&nbsp;to&nbsp;force&nbsp;some&nbsp;'awareness'&nbsp;of&nbsp;consumers<br>
&nbsp;&nbsp;&nbsp;&nbsp;into&nbsp;the&nbsp;producer&nbsp;whilst&nbsp;discussing&nbsp;this&nbsp;design.&nbsp;I&nbsp;would&nbsp;like&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;posit&nbsp;that&nbsp;this&nbsp;reveals&nbsp;an&nbsp;'impedance&nbsp;mismatch'&nbsp;between&nbsp;your<br>
&nbsp;&nbsp;&nbsp;&nbsp;requirements&nbsp;and&nbsp;the&nbsp;inherently&nbsp;disconnected&nbsp;nature&nbsp;of&nbsp;a&nbsp;queue&nbsp;based<br>
&nbsp;&nbsp;&nbsp;&nbsp;solution.&nbsp;Of&nbsp;course&nbsp;distributed&nbsp;locking&nbsp;is&nbsp;often&nbsp;implemented&nbsp;using<br>
&nbsp;&nbsp;&nbsp;&nbsp;asynchronous&nbsp;communication&nbsp;protocols,&nbsp;but&nbsp;this&nbsp;is&nbsp;usually&nbsp;done&nbsp;at&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;*much&nbsp;lower&nbsp;protocol&nbsp;level*&nbsp;-&nbsp;I'd&nbsp;suggest&nbsp;researching&nbsp;Paxos&nbsp;or<br>
&nbsp;&nbsp;&nbsp;&nbsp;similar&nbsp;distributed&nbsp;consensus&nbsp;algorithms&nbsp;to&nbsp;get&nbsp;an&nbsp;idea&nbsp;of&nbsp;what's<br>
&nbsp;&nbsp;&nbsp;&nbsp;involved&nbsp;in&nbsp;designing&nbsp;a&nbsp;reliable&nbsp;solution&nbsp;to&nbsp;this&nbsp;kind&nbsp;of&nbsp;problem.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Is&nbsp;there&nbsp;anything&nbsp;like&nbsp;this&nbsp;in&nbsp;rabbit&nbsp;mq&nbsp;?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Not&nbsp;that&nbsp;I&nbsp;know&nbsp;of,&nbsp;although&nbsp;it's&nbsp;possible&nbsp;to&nbsp;use&nbsp;the&nbsp;HTTP&nbsp;APIs&nbsp;in<br>
&nbsp;&nbsp;&nbsp;&nbsp;order&nbsp;to&nbsp;track&nbsp;consumers&nbsp;but&nbsp;that&nbsp;is,&nbsp;as&nbsp;I&nbsp;mentioned&nbsp;above,&nbsp;subject<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;lots&nbsp;of&nbsp;*nasty*&nbsp;race&nbsp;conditions.&nbsp;You&nbsp;*could*&nbsp;look&nbsp;at&nbsp;using&nbsp;Tony<br>
&nbsp;&nbsp;&nbsp;&nbsp;G's&nbsp;presence&nbsp;exchange&nbsp;(&lt;a&nbsp;href=&quot;https://github.com/tonyg/presence-exchange&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/tonyg/presence-exchange&lt;/a&gt;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;track&nbsp;bindings&nbsp;-&nbsp;although&nbsp;this&nbsp;would&nbsp;complicate&nbsp;your&nbsp;topology<br>
&nbsp;&nbsp;&nbsp;&nbsp;quite&nbsp;a&nbsp;lot,&nbsp;it&nbsp;might&nbsp;make&nbsp;tracking&nbsp;the&nbsp;various&nbsp;participants<br>
&nbsp;&nbsp;&nbsp;&nbsp;plausibly&nbsp;useful,&nbsp;providing&nbsp;you&nbsp;use&nbsp;a&nbsp;known&nbsp;set&nbsp;of&nbsp;binding&nbsp;keys.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;This&nbsp;might&nbsp;allow&nbsp;me&nbsp;to&nbsp;create&nbsp;a&nbsp;listener&nbsp;that&nbsp;would<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;only&nbsp;send&nbsp;a&nbsp;message&nbsp;to&nbsp;notify&nbsp;the&nbsp;first&nbsp;manager&nbsp;that&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;references&nbsp;were&nbsp;removed.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I'm&nbsp;not&nbsp;clear&nbsp;on&nbsp;how&nbsp;that&nbsp;helps!?&nbsp;I&nbsp;did&nbsp;have&nbsp;a&nbsp;bit&nbsp;of&nbsp;an&nbsp;early&nbsp;start<br>
&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;morning&nbsp;though...&nbsp;;)&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Another&nbsp;could&nbsp;be&nbsp;to&nbsp;define&nbsp;the&nbsp;&quot;delete&nbsp;referenrences&quot;&nbsp;message&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;live&nbsp;for&nbsp;x&nbsp;consumptions&nbsp;(x&nbsp;being&nbsp;the&nbsp;number&nbsp;of&nbsp;listener&nbsp;on&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;delete&nbsp;references&quot;&nbsp;queue)&nbsp;and&nbsp;add&nbsp;an&nbsp;advisory&nbsp;listener&nbsp;on&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deletion&nbsp;of&nbsp;the&nbsp;message&nbsp;from&nbsp;the&nbsp;queue&nbsp;to&nbsp;process&nbsp;deletion&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;data.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;doesn't&nbsp;help&nbsp;at&nbsp;all&nbsp;unless&nbsp;you've&nbsp;actually&nbsp;tracked&nbsp;the&nbsp;number<br>
&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;acquired&nbsp;messages&nbsp;in&nbsp;the&nbsp;first&nbsp;place.&nbsp;Plus&nbsp;you&nbsp;*can*&nbsp;do&nbsp;that<br>
&nbsp;&nbsp;&nbsp;&nbsp;without&nbsp;'detecting'&nbsp;the&nbsp;number&nbsp;of&nbsp;consumers.&nbsp;You&nbsp;just&nbsp;insist&nbsp;on<br>
&nbsp;&nbsp;&nbsp;&nbsp;getting&nbsp;a&nbsp;'make-ref'&nbsp;message&nbsp;from&nbsp;the&nbsp;consumer&nbsp;(with&nbsp;some&nbsp;unique&nbsp;id)<br>
&nbsp;&nbsp;&nbsp;&nbsp;before&nbsp;incrementing&nbsp;the&nbsp;reference&nbsp;count.&nbsp;There's&nbsp;no&nbsp;real&nbsp;difference<br>
&nbsp;&nbsp;&nbsp;&nbsp;between&nbsp;*detecting*&nbsp;the&nbsp;consumer's&nbsp;connection/channel&nbsp;and&nbsp;providing<br>
&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;ref/lock&nbsp;acquisition&nbsp;queue,&nbsp;except&nbsp;that&nbsp;the&nbsp;latter&nbsp;is&nbsp;probably<br>
&nbsp;&nbsp;&nbsp;&nbsp;more&nbsp;structured,&nbsp;architecturally&nbsp;clearer&nbsp;and&nbsp;quite&nbsp;likely&nbsp;to&nbsp;be&nbsp;more<br>
&nbsp;&nbsp;&nbsp;&nbsp;reliable.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Even&nbsp;if&nbsp;you&nbsp;used&nbsp;ActiveMQ's&nbsp;detection&nbsp;functionality&nbsp;or&nbsp;RabbitMQ's<br>
&nbsp;&nbsp;&nbsp;&nbsp;management&nbsp;HTTP&nbsp;APIs,&nbsp;the&nbsp;fundamental&nbsp;problem&nbsp;of&nbsp;race&nbsp;conditions<br>
&nbsp;&nbsp;&nbsp;&nbsp;wouldn't&nbsp;go&nbsp;away.&nbsp;Before&nbsp;we&nbsp;go&nbsp;much&nbsp;further&nbsp;discussing&nbsp;various&nbsp;ways<br>
&nbsp;&nbsp;&nbsp;&nbsp;you&nbsp;can&nbsp;design&nbsp;a&nbsp;solution&nbsp;-&nbsp;and&nbsp;I&nbsp;*am*&nbsp;interested&nbsp;in&nbsp;this&nbsp;discussion<br>
&nbsp;&nbsp;&nbsp;&nbsp;BTW&nbsp;-&nbsp;please&nbsp;read<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://en.wikipedia.org/wiki/Byzantine_fault_tolerance#Byzantine_failures&quot;&nbsp;target=&quot;_blank&quot;&gt;http://en.wikipedia.org/wiki/Byzantine_fault_tolerance#Byzantine_failures&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;make&nbsp;sure&nbsp;you've&nbsp;understood&nbsp;the&nbsp;consequences&nbsp;of&nbsp;nodes&nbsp;*just<br>
&nbsp;&nbsp;&nbsp;&nbsp;disappearing*&nbsp;and&nbsp;then&nbsp;*maybe*&nbsp;coming&nbsp;back&nbsp;later&nbsp;on.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;You've&nbsp;also&nbsp;still&nbsp;not&nbsp;explained&nbsp;what&nbsp;the&nbsp;consequences&nbsp;of&nbsp;loosing<br>
&nbsp;&nbsp;&nbsp;&nbsp;track&nbsp;of&nbsp;resources&nbsp;actually&nbsp;are.&nbsp;If&nbsp;one&nbsp;of&nbsp;your&nbsp;nodes&nbsp;dies,&nbsp;when&nbsp;it<br>
&nbsp;&nbsp;&nbsp;&nbsp;comes&nbsp;back&nbsp;to&nbsp;life&nbsp;has&nbsp;any&nbsp;state&nbsp;been&nbsp;persisted&nbsp;and&nbsp;will&nbsp;that&nbsp;state<br>
&nbsp;&nbsp;&nbsp;&nbsp;thus&nbsp;be&nbsp;used&nbsp;to&nbsp;try&nbsp;and&nbsp;re-acquire&nbsp;or&nbsp;release&nbsp;the&nbsp;'lock&nbsp;count'&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;resource?&nbsp;What&nbsp;happens&nbsp;if&nbsp;your&nbsp;node&nbsp;sends&nbsp;an&nbsp;'acquire'&nbsp;request<br>
&nbsp;&nbsp;&nbsp;&nbsp;asynchronously,&nbsp;then&nbsp;starts&nbsp;to&nbsp;write&nbsp;the&nbsp;resource/lock&nbsp;state&nbsp;to&nbsp;its<br>
&nbsp;&nbsp;&nbsp;&nbsp;own&nbsp;local&nbsp;database&nbsp;and&nbsp;dies&nbsp;(e.g.,&nbsp;the&nbsp;machine&nbsp;crashes)&nbsp;before<br>
&nbsp;&nbsp;&nbsp;&nbsp;committing&nbsp;the&nbsp;transaction?&nbsp;Because&nbsp;the&nbsp;'acquire'&nbsp;request&nbsp;was&nbsp;not<br>
&nbsp;&nbsp;&nbsp;&nbsp;synchronous,&nbsp;the&nbsp;master&nbsp;now&nbsp;thinks&nbsp;that&nbsp;your&nbsp;node&nbsp;holds&nbsp;the&nbsp;lock,<br>
&nbsp;&nbsp;&nbsp;&nbsp;whilst&nbsp;the&nbsp;node&nbsp;does&nbsp;*not*&nbsp;think&nbsp;the&nbsp;same.&nbsp;If&nbsp;you&nbsp;bring&nbsp;the&nbsp;node<br>
&nbsp;&nbsp;&nbsp;&nbsp;back&nbsp;online&nbsp;and&nbsp;then&nbsp;start&nbsp;asking&nbsp;for&nbsp;the&nbsp;resource&nbsp;lock,&nbsp;you're<br>
&nbsp;&nbsp;&nbsp;&nbsp;breaking&nbsp;the&nbsp;contract&nbsp;for&nbsp;lock&nbsp;acquisition&nbsp;on&nbsp;that&nbsp;node&nbsp;unless<br>
&nbsp;&nbsp;&nbsp;&nbsp;you're&nbsp;willing&nbsp;to&nbsp;make&nbsp;'acquire'&nbsp;idempotent,&nbsp;which&nbsp;has&nbsp;its&nbsp;own<br>
&nbsp;&nbsp;&nbsp;&nbsp;pitfalls.&nbsp;If&nbsp;you&nbsp;don't&nbsp;make&nbsp;'acquire'&nbsp;idempotent,&nbsp;then&nbsp;acquisition<br>
&nbsp;&nbsp;&nbsp;&nbsp;will&nbsp;fail.&nbsp;If&nbsp;you&nbsp;try&nbsp;to&nbsp;handle&nbsp;this&nbsp;by&nbsp;making&nbsp;'acquire'&nbsp;re-entrant<br>
&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;then&nbsp;try&nbsp;to&nbsp;release&nbsp;the&nbsp;node's&nbsp;locl,&nbsp;the&nbsp;master&nbsp;will&nbsp;be&nbsp;confused<br>
&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;it&nbsp;thinks&nbsp;you&nbsp;hold&nbsp;the&nbsp;lock&nbsp;twice&nbsp;and&nbsp;the&nbsp;*lost&nbsp;lock&nbsp;acquisition*<br>
&nbsp;&nbsp;&nbsp;&nbsp;will&nbsp;never&nbsp;be&nbsp;released.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tldr;&nbsp;this&nbsp;is&nbsp;not&nbsp;a&nbsp;simple&nbsp;problem.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Cheers,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Tim&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/div&gt;<br>
<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
