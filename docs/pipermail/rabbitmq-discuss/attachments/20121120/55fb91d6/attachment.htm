<tt>
Hi&nbsp;RabbitMQ&nbsp;community. &nbsp;This&nbsp;is&nbsp;my&nbsp;first&nbsp;post. &nbsp;I&nbsp;have&nbsp;been&nbsp;discussing&nbsp;a&nbsp;cluster&nbsp;serialization&nbsp;problem&nbsp;with&nbsp;OpenStack&nbsp;RPC&amp;#39;s&nbsp;usage&nbsp;of&nbsp;RabbitMQ&nbsp;on&nbsp;the&nbsp;OpenStack&nbsp;developers&nbsp;mailing&nbsp;list&nbsp;with&nbsp;the&nbsp;generic&nbsp;subject&nbsp;line&nbsp;of&nbsp;&amp;quot;RabbitMQ&nbsp;Scaling&amp;quot;.&lt;br&gt;<br>
&lt;br&gt;The&nbsp;relevant&nbsp;code&nbsp;versions&nbsp;I&amp;#39;m&nbsp;using&nbsp;are:&lt;br&gt;rabbitmq-server&nbsp;:&nbsp;2.7.1.Oubuntu4&lt;br&gt;python-amqplib&nbsp;:&nbsp;1.0.0+ds-1&lt;br&gt;python-kombu&nbsp;:&nbsp;1.4.3-1&lt;br&gt;&lt;br&gt;I&nbsp;read&nbsp;somewhere&nbsp;that&nbsp;Kombu&nbsp;only&nbsp;uses&nbsp;the&nbsp;0-8&nbsp;level&nbsp;protocol,&nbsp;but&nbsp;I&amp;#39;m&nbsp;not&nbsp;sure&nbsp;how&nbsp;to&nbsp;confirm&nbsp;that.&lt;br&gt;<br>
&lt;br&gt;The&nbsp;OpenStack&nbsp;RPC&nbsp;usage&nbsp;pattern&nbsp;and&nbsp;the&nbsp;problem&nbsp;are&nbsp;shown&nbsp;in&nbsp;the&nbsp;following&nbsp;table:&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;No&nbsp;cluster &nbsp;Cluster&nbsp;of&nbsp;3  &nbsp;AMQP&nbsp;Action&lt;br&gt;(in&nbsp;ms)    &nbsp;(in&nbsp;ms)&lt;br&gt;0.647      &nbsp;1.704         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Channel&nbsp;(20)&nbsp;Method:&nbsp;Open&nbsp;(10)&lt;br&gt;<br>
0.451      &nbsp;0.468         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Channel&nbsp;(20)&nbsp;Method:&nbsp;Open-Ok&nbsp;(11)&lt;br&gt;<br>
1.484      &nbsp;1.459         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Exchange&nbsp;<br>
(40)&nbsp;Method:&nbsp;Declare&nbsp;(10)&nbsp;Exchange:&nbsp;XXXXXXXXXX&nbsp;Type:&nbsp;direct&nbsp;&lt;br&gt;0.431      &nbsp;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,102)&quot;&gt;&lt;b&gt;2.612&lt;/b&gt;&lt;/span&gt;         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Exchange&nbsp;(40)&nbsp;Method:&nbsp;Declare-Ok&nbsp;(11)&lt;br&gt;<br>
<br>
0.612      &nbsp;0.612         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Queue&nbsp;(50)&nbsp;Method:&nbsp;Declare&nbsp;(10)&nbsp;Queue:&nbsp;XXXXXXXXXX&lt;br&gt;0.86       &nbsp;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,102)&quot;&gt;&lt;b&gt;4.369&lt;/b&gt;&lt;/span&gt;         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Queue&nbsp;(50)&nbsp;Method:&nbsp;Declare-Ok&nbsp;(11)&nbsp;Queue:&nbsp;XXXXXXXXXX&lt;br&gt;<br>
<br>
0.64       &nbsp;0.723         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Queue&nbsp;(50)<br>
&nbsp;Method:&nbsp;Bind&nbsp;(20)&nbsp;Queue:&nbsp;XXXXXXXXXX&nbsp;Exchange:&nbsp;XXXXXXXXXX&nbsp;Routing-Key:&nbsp;<br>
XXXXXXXXXX&lt;br&gt;0.622      &nbsp;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,102)&quot;&gt;&lt;b&gt;3.34&lt;/b&gt;&lt;/span&gt;         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Queue&nbsp;(50)&nbsp;Method:&nbsp;Bind-Ok&nbsp;(21)&lt;br&gt;<br>
0.758      &nbsp;0.731         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Exchange&nbsp;(40)&nbsp;Method:&nbsp;Declare&nbsp;(10)&nbsp;Exchange:&nbsp;nova&nbsp;Type:&nbsp;topic&lt;br&gt;0.193      &nbsp;0.194         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Exchange&nbsp;(40)&nbsp;Method:&nbsp;Declare-Ok&nbsp;(11)&lt;br&gt;<br>
<br>
0.864      &nbsp;0.886         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Basic&nbsp;(60)<br>
&nbsp;Method:&nbsp;Publish&nbsp;(40)&nbsp;Exchange:&nbsp;nova&nbsp;Routing-Key:&nbsp;perfsvc1&lt;br&gt;0.029      &nbsp;0.034         &nbsp;Type:&nbsp;Content&nbsp;header&nbsp;(2)&nbsp;Channel:&nbsp;1&lt;br&gt;0.067      &nbsp;0.068         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Basic&nbsp;(60)&nbsp;Method:&nbsp;Consume&nbsp;(20)&nbsp;Queue:&nbsp;XXXXXXXXXX&lt;br&gt;<br>
<br>
0.607      &nbsp;1.186         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Basic&nbsp;(60)&nbsp;Method:&nbsp;Consume-Ok&nbsp;(21)&lt;br&gt;8.408      &nbsp;9.461         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Channel&nbsp;(20)&nbsp;Method:&nbsp;Close&nbsp;(40)&lt;br&gt;1.8        &nbsp;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,102)&quot;&gt;&lt;b&gt;10.47&lt;/b&gt;&lt;/span&gt;         &nbsp;Type:&nbsp;Method&nbsp;(1)&nbsp;Channel:&nbsp;1&nbsp;Class:&nbsp;Channel&nbsp;(20)&nbsp;Method:&nbsp;Close-Ok&nbsp;(41)&lt;br&gt;<br>
&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;The&nbsp;numbers&nbsp;in&nbsp;the&nbsp;first&nbsp;and&nbsp;second&nbsp;columns&nbsp;are&nbsp;for&nbsp;the&nbsp;time&nbsp;between&nbsp;the&nbsp;prior&nbsp;action&nbsp;and&nbsp;the&nbsp;start&nbsp;of&nbsp;<br>
the&nbsp;action&nbsp;listed&nbsp;on&nbsp;that&nbsp;row&nbsp;and&nbsp;rows&nbsp;are&nbsp;listed&nbsp;in&nbsp;real&nbsp;order&nbsp;of&nbsp;occurrence. &nbsp;The&nbsp;<br>
&amp;quot;declares&amp;quot;,&nbsp;bind&nbsp;and&nbsp;close&nbsp;are&nbsp;all&nbsp;significantly&nbsp;longer. &nbsp;The&nbsp;queues&nbsp;and&nbsp;exchanges&nbsp;are&nbsp;auto&nbsp;delete,&nbsp;so&nbsp;the&nbsp;close&nbsp;results&nbsp;in&nbsp;the&nbsp;deletion&nbsp;of&nbsp;the&nbsp;queue&nbsp;and&nbsp;exchange.&lt;br&gt;&lt;br&gt;This&nbsp;is&nbsp;from&nbsp;a<br>
&nbsp;wireshark&nbsp;trace&nbsp;of&nbsp;a&nbsp;single&nbsp;producer&nbsp;and&nbsp;a&nbsp;single&nbsp;consumer&nbsp;from&nbsp;the&nbsp;<br>
RabbbitMQ&nbsp;server. &nbsp;&lt;span&nbsp;class=&quot;il&quot;&gt;RabbitMQ&lt;/span&gt;&nbsp;is&nbsp;taking&nbsp;<br>
significantly&nbsp;longer&nbsp;to&nbsp;do&nbsp;something&nbsp;in&nbsp;the&nbsp;clustered&nbsp;case&nbsp;and&nbsp;it&nbsp;seems&nbsp;<br>
likely&nbsp;that&nbsp;&amp;quot;the&nbsp;something&amp;quot;&nbsp;is&nbsp;most&nbsp;likely&nbsp;the&nbsp;replication&nbsp;of&nbsp;the&nbsp;<br>
creation&nbsp;and&nbsp;destruction&nbsp;of&nbsp;the&nbsp;queue&nbsp;and&nbsp;exchange.&lt;br&gt;&lt;br&gt;Is&nbsp;it&nbsp;known&nbsp;that&nbsp;the&nbsp;dynamic&nbsp;creation&nbsp;and&nbsp;deletion&nbsp;of&nbsp;queues&nbsp;and&nbsp;exchanges&nbsp;is&nbsp;costly&nbsp;in&nbsp;a&nbsp;clustered&nbsp;environment? &nbsp;Is&nbsp;it&nbsp;known&nbsp;that&nbsp;the&nbsp;replication&nbsp;of&nbsp;queues&nbsp;and&nbsp;exchanges&nbsp;in&nbsp;a&nbsp;cluster&nbsp;environment&nbsp;is&nbsp;a&nbsp;serialization&nbsp;point&nbsp;that&nbsp;bottlenecks&nbsp;RabbitMQ&nbsp;scalability&nbsp;for&nbsp;this&nbsp;dynamic&nbsp;queue/exchange&nbsp;use&nbsp;pattern?&lt;br&gt;<br>
&lt;br&gt;Ray&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/span&gt;<br>

</tt>
