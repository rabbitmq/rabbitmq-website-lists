<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;for&nbsp;the&nbsp;response&nbsp;Tim.&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Sep&nbsp;18,&nbsp;2013&nbsp;at&nbsp;2:59&nbsp;AM,&nbsp;Tim&nbsp;Watson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:tim@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;tim@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;Hi&nbsp;Jonathan,&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;On&nbsp;17&nbsp;Sep&nbsp;2013,&nbsp;at&nbsp;19:34,&nbsp;Jonathan&nbsp;Halterman&nbsp;wrote:&lt;/div&gt;<br>
<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Why&nbsp;are&nbsp;the&nbsp;shutdown&nbsp;listeners&nbsp;for&nbsp;only&nbsp;some&nbsp;of&nbsp;my&nbsp;channels/connections&nbsp;called&nbsp;when&nbsp;a&nbsp;rabbit&nbsp;server&nbsp;shuts&nbsp;down?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;All&nbsp;connection/channel&nbsp;shutdown&nbsp;listeners&nbsp;are&nbsp;triggered&nbsp;when&nbsp;the&nbsp;client&nbsp;detects&nbsp;the&nbsp;shutdown.&nbsp;When&nbsp;the&nbsp;shutdown&nbsp;originates&nbsp;at&nbsp;the&nbsp;server,&nbsp;this&nbsp;activity&nbsp;is mediated on&nbsp;the&nbsp;client&nbsp;side&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;ways,&nbsp;either&nbsp;(a)&nbsp;the&nbsp;client&nbsp;received&nbsp;a&nbsp;`connection.close&amp;#39;&nbsp;AMQP&nbsp;method&nbsp;from&nbsp;the&nbsp;broker,&nbsp;or&nbsp;(b)&nbsp;the&nbsp;OS&nbsp;networking&nbsp;layer&nbsp;signals&nbsp;to&nbsp;the&nbsp;JVM&nbsp;that&nbsp;the&nbsp;socket&nbsp;has&nbsp;closed,&nbsp;at&nbsp;which&nbsp;point&nbsp;the&nbsp;listening/reading&nbsp;thread&nbsp;handles&nbsp;the&nbsp;relevant&nbsp;exception,&nbsp;tears&nbsp;down&nbsp;any&nbsp;associated&nbsp;local&nbsp;resources&nbsp;and&nbsp;fires&nbsp;the&nbsp;shutdown&nbsp;listeners.&nbsp;In&nbsp;the&nbsp;latter&nbsp;case,&nbsp;there&nbsp;can&nbsp;be&nbsp;a&nbsp;significant&nbsp;time&nbsp;delay&nbsp;before&nbsp;the&nbsp;operating&nbsp;system&nbsp;&amp;quot;notices&amp;quot;&nbsp;that&nbsp;the&nbsp;peer&nbsp;socket&nbsp;has&nbsp;closed/disappeared.&nbsp;Having&nbsp;said&nbsp;all&nbsp;that....&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;On&nbsp;Mon,&nbsp;Sep&nbsp;16,&nbsp;2013&nbsp;at&nbsp;5:13&nbsp;PM,&nbsp;Jonathan&nbsp;Halterman&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jhalterman@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jhalterman@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
<br>
I&amp;#39;ve&nbsp;been&nbsp;experimenting&nbsp;with&nbsp;various&nbsp;sorts&nbsp;of&nbsp;RabbitMQ&nbsp;failures&nbsp;that&nbsp;result&nbsp;in&nbsp;connections&nbsp;and&nbsp;channels&nbsp;being&nbsp;shutdown&nbsp;with&nbsp;the&nbsp;goal&nbsp;of&nbsp;being&nbsp;able&nbsp;to&nbsp;re-establish&nbsp;connections,&nbsp;channels,&nbsp;and&nbsp;consumers&nbsp;whenever&nbsp;a&nbsp;failure&nbsp;occurs.&nbsp;In&nbsp;particular,&nbsp;I&amp;#39;ve&nbsp;been&nbsp;forcing&nbsp;network&nbsp;partitions&nbsp;on&nbsp;a&nbsp;pause_minority&nbsp;configured&nbsp;cluster&nbsp;with&nbsp;a&nbsp;client&nbsp;connected&nbsp;to&nbsp;what&nbsp;will&nbsp;become&nbsp;the&nbsp;minority&nbsp;node,&nbsp;to&nbsp;see&nbsp;how&nbsp;things&nbsp;behave,&nbsp;and&nbsp;the&nbsp;results&nbsp;are&nbsp;a&nbsp;bit&nbsp;inconsistent.&lt;div&gt;<br>
<br>
<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;How&nbsp;exactly&nbsp;are&nbsp;you&nbsp;forcing&nbsp;network&nbsp;partitions?&nbsp;Are&nbsp;you&nbsp;causing&nbsp;packet&nbsp;loss&nbsp;(using&nbsp;pf&nbsp;or&nbsp;iptables)&nbsp;or&nbsp;doing&nbsp;something&nbsp;else?&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iptables&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;For&nbsp;a&nbsp;simple&nbsp;test,&nbsp;I&nbsp;created&nbsp;2&nbsp;connections&nbsp;and&nbsp;6&nbsp;channels&nbsp;then&nbsp;partitioned&nbsp;the&nbsp;cluster.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;How&nbsp;did&nbsp;you&nbsp;partition&nbsp;the&nbsp;cluster?&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Tweaking&nbsp;iptables&nbsp;to&nbsp;drop&nbsp;traffic&nbsp;to/from&nbsp;other&nbsp;nodes&nbsp;in&nbsp;the&nbsp;cluster.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&nbsp;Within&nbsp;a&nbsp;minute&nbsp;or&nbsp;so&nbsp;the&nbsp;minority&nbsp;node&nbsp;(to&nbsp;which&nbsp;my&nbsp;client&nbsp;is&nbsp;connected&nbsp;connected)&nbsp;shuts&nbsp;itself&nbsp;down.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;a&nbsp;RabbitMQ&nbsp;node&nbsp;decides&nbsp;to&nbsp;undertake&nbsp;an&nbsp;orderly&nbsp;shutdown,&nbsp;then&nbsp;all&nbsp;AMQP&nbsp;connections&nbsp;should&nbsp;be&nbsp;explicitly&nbsp;closed&nbsp;(as&nbsp;per&nbsp;method&nbsp;&amp;quot;a&amp;quot;&nbsp;listed&nbsp;above)&nbsp;before&nbsp;the&nbsp;network&nbsp;connection&nbsp;is&nbsp;severed.&nbsp;Where&nbsp;this&nbsp;might&nbsp;not&nbsp;work&nbsp;as&nbsp;expected,&nbsp;is&nbsp;if&nbsp;the&nbsp;network&nbsp;connection&nbsp;between&nbsp;client&nbsp;and&nbsp;server&nbsp;is&nbsp;unavailable&nbsp;and/or&nbsp;subject&nbsp;to&nbsp;packet&nbsp;loss.&nbsp;If&nbsp;the&nbsp;`connection.close&amp;#39;&nbsp;signal&nbsp;the&nbsp;broker&nbsp;sends&nbsp;doesn&amp;#39;t&nbsp;make&nbsp;it&nbsp;to&nbsp;the&nbsp;client,&nbsp;then&nbsp;the&nbsp;shutdown&nbsp;listeners&nbsp;won&amp;#39;t&nbsp;fire&nbsp;until&nbsp;the&nbsp;client&amp;#39;s&nbsp;(OS)&nbsp;network&nbsp;stack&nbsp;detects&nbsp;the&nbsp;problem,&nbsp;which&nbsp;can&nbsp;take&nbsp;up&nbsp;to&nbsp;30&nbsp;mins&nbsp;depending&nbsp;on&nbsp;environment&nbsp;configuration.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;What&nbsp;happens&nbsp;next&nbsp;varies&nbsp;a&nbsp;bit&nbsp;which&nbsp;each&nbsp;test&nbsp;run:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Outcome&nbsp;1:&nbsp;Immediately&nbsp;the&nbsp;shutdown&nbsp;listeners&nbsp;for&nbsp;my&nbsp;2&nbsp;connections&nbsp;and&nbsp;all&nbsp;6&nbsp;channels&nbsp;are&nbsp;called.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;is&nbsp;what&nbsp;I&amp;#39;d&nbsp;expect&nbsp;to&nbsp;happen&nbsp;if:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;both&nbsp;connections&nbsp;are&nbsp;between&nbsp;the&nbsp;client&nbsp;and&nbsp;the&nbsp;broker&nbsp;that&nbsp;is&nbsp;shutting&nbsp;down&lt;/div&gt;&lt;div&gt;2.&nbsp;the&nbsp;network&nbsp;link&nbsp;between&nbsp;the&nbsp;broker&nbsp;that&nbsp;is&nbsp;shutting&nbsp;down&nbsp;and&nbsp;the&nbsp;client&nbsp;is&nbsp;in&nbsp;good&nbsp;condition&nbsp;(no&nbsp;packet&nbsp;loss,&nbsp;etc)&nbsp;such&nbsp;that&nbsp;the&nbsp;connection.close&nbsp;from&nbsp;the&nbsp;broker&nbsp;arrives&nbsp;at&nbsp;the&nbsp;client&nbsp;as&nbsp;expected &lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Outcome&nbsp;2: Immediately&nbsp;2&nbsp;of&nbsp;my&nbsp;6&nbsp;channels&amp;#39;&nbsp;shutdown&nbsp;listeners&nbsp;are&nbsp;called.&nbsp;None&nbsp;of&nbsp;the&nbsp;connection&nbsp;shutdown&nbsp;listeners&nbsp;are&nbsp;called.&nbsp;After&nbsp;waiting&nbsp;a&nbsp;few&nbsp;minutes&nbsp;I&nbsp;heal&nbsp;the&nbsp;partition&nbsp;and&nbsp;the&nbsp;shutdown&nbsp;listeners&nbsp;for&nbsp;the&nbsp;2&nbsp;connections&nbsp;and&nbsp;the&nbsp;remaining&nbsp;4&nbsp;channels&nbsp;are&nbsp;immediately&nbsp;called.&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;doesn&amp;#39;t&nbsp;sound&nbsp;right.&nbsp;If&nbsp;both&nbsp;connections&nbsp;are&nbsp;between&nbsp;the&nbsp;client&nbsp;and&nbsp;the&nbsp;server&nbsp;that&nbsp;is&nbsp;shutting&nbsp;down,&nbsp;and&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;shutdown&nbsp;listener&nbsp;handling&nbsp;code,&nbsp;then&nbsp;this&nbsp;problem&nbsp;would&nbsp;be&nbsp;showing&nbsp;up&nbsp;all&nbsp;the&nbsp;time&nbsp;(and&nbsp;we&amp;#39;d&nbsp;have&nbsp;fixed&nbsp;it).&nbsp;It&nbsp;is&nbsp;also&nbsp;unnecessary&nbsp;to&nbsp;consider&nbsp;clustering/partitions&nbsp;is&nbsp;the&nbsp;behaviour&nbsp;you&nbsp;describe&nbsp;is&nbsp;happening&nbsp;for&nbsp;two&nbsp;connection&nbsp;between&nbsp;one&nbsp;client&nbsp;and&nbsp;one&nbsp;broker.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Can&nbsp;you&nbsp;share&nbsp;a&nbsp;minimal&nbsp;example&nbsp;of&nbsp;the&nbsp;code&nbsp;you&amp;#39;re&nbsp;using&nbsp;please.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Outcome&nbsp;3:&nbsp;Immediate&nbsp;2&nbsp;of&nbsp;my&nbsp;6&nbsp;channels&amp;#39;&nbsp;shutdown&nbsp;listeners&nbsp;are&nbsp;called.&nbsp;None&nbsp;of&nbsp;the&nbsp;connection&nbsp;shutdown&nbsp;listeners&nbsp;are&nbsp;called.&nbsp;After&nbsp;about&nbsp;30&nbsp;seconds,&nbsp;with&nbsp;the&nbsp;cluster&nbsp;still&nbsp;partitioned, the&nbsp;shutdown&nbsp;listeners&nbsp;for&nbsp;the&nbsp;2&nbsp;connections&nbsp;and&nbsp;the&nbsp;remaining&nbsp;4&nbsp;channels&nbsp;are&nbsp;immediately&nbsp;called.&lt;br&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;are&nbsp;no&nbsp;timing&nbsp;guarantees&nbsp;about&nbsp;when&nbsp;shutdown&nbsp;listeners&nbsp;will&nbsp;fire.&nbsp;As&nbsp;I&nbsp;mentioned,&nbsp;these&nbsp;events&nbsp;are&nbsp;only&nbsp;triggered&nbsp;when&nbsp;either&nbsp;the&nbsp;client&nbsp;&amp;quot;sees&amp;quot;&nbsp;a&nbsp;`connection.close&amp;#39;&nbsp;from&nbsp;the&nbsp;broker&nbsp;or&nbsp;detects&nbsp;a&nbsp;network&nbsp;failure&nbsp;whilst&nbsp;listening/sending.&nbsp;Since&nbsp;both&nbsp;of&nbsp;these&nbsp;factors&nbsp;are&nbsp;entirely&nbsp;dependent&nbsp;on&nbsp;the&nbsp;network&nbsp;between&nbsp;client&nbsp;and&nbsp;server,&nbsp;and&nbsp;on&nbsp;the&nbsp;networking&nbsp;layers&nbsp;of&nbsp;the&nbsp;various&nbsp;participating&nbsp;operating&nbsp;systems,&nbsp;the&nbsp;`connection.close&amp;#39;&nbsp;and/or&nbsp;socket&nbsp;closed&nbsp;exception&nbsp;will&nbsp;be&nbsp;detected&nbsp;when&nbsp;the&nbsp;client&amp;#39;s&nbsp;OS&nbsp;delivers&nbsp;the&nbsp;relevant&nbsp;signal&nbsp;to&nbsp;the&nbsp;JVM&nbsp;and&nbsp;up&nbsp;into&nbsp;the&nbsp;client&nbsp;library&amp;#39;s&nbsp;application&nbsp;code,&nbsp;at&nbsp;which&nbsp;point&nbsp;it&nbsp;is&nbsp;handled&nbsp;immediately.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;both&nbsp;these&nbsp;two&nbsp;cases,&nbsp;if&nbsp;some&nbsp;channels&nbsp;are&nbsp;being&nbsp;used&nbsp;to&nbsp;`send&amp;#39;&nbsp;data,&nbsp;and&nbsp;the&nbsp;disconnection&nbsp;between&nbsp;client&nbsp;and&nbsp;server&nbsp;involves&nbsp;loss&nbsp;of&nbsp;network&nbsp;connectivity,&nbsp;then&nbsp;the&nbsp;&amp;quot;sending&amp;quot;&nbsp;channels&nbsp;are&nbsp;most&nbsp;likely&nbsp;to&nbsp;&amp;quot;see&amp;quot;&nbsp;IOExceptions&nbsp;before&nbsp;the&nbsp;&amp;quot;listening&amp;quot;&nbsp;channels.&nbsp;Modern&nbsp;OS&nbsp;networking&nbsp;stacks&nbsp;are&nbsp;often&nbsp;configured&nbsp;with&nbsp;lower&nbsp;retry&nbsp;thresholds&nbsp;for&nbsp;sending&nbsp;than&nbsp;they&nbsp;are&nbsp;for&nbsp;receiving,&nbsp;thus&nbsp;detection&nbsp;of&nbsp;network&nbsp;failures&nbsp;will&nbsp;likely&nbsp;vary&nbsp;considerably&nbsp;depending&nbsp;on&nbsp;what&nbsp;you&amp;#39;re&nbsp;doing&nbsp;in&nbsp;a&nbsp;particular&nbsp;channel&nbsp;over&nbsp;a&nbsp;particular&nbsp;connection.&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;you&amp;#39;ve&nbsp;basically&nbsp;hit&nbsp;on&nbsp;what&nbsp;I&amp;#39;m&nbsp;experiencing.&nbsp;The&nbsp;client&nbsp;in&nbsp;question&nbsp;is&nbsp;serving&nbsp;as&nbsp;a&nbsp;consumer&nbsp;only. &lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;I&amp;#39;m&nbsp;interested&nbsp;to&nbsp;learn&nbsp;more&nbsp;about&nbsp;when&nbsp;and&nbsp;why&nbsp;certain&nbsp;shutdown&nbsp;listeners&nbsp;might&nbsp;or&nbsp;might&nbsp;not&nbsp;be&nbsp;invoked&nbsp;so&nbsp;I&nbsp;can&nbsp;do&nbsp;a&nbsp;better&nbsp;job&nbsp;of&nbsp;re-establishing&nbsp;resources&nbsp;after&nbsp;a&nbsp;failure.&nbsp;Any&nbsp;input&nbsp;is&nbsp;appreciated.&lt;/div&gt;<br>
<br>
<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;can&nbsp;share&nbsp;an&nbsp;example&nbsp;of&nbsp;your&nbsp;client&nbsp;code,&nbsp;boiled&nbsp;down&nbsp;to&nbsp;the&nbsp;minimal&nbsp;details,&nbsp;that&nbsp;would&nbsp;help.&nbsp;Please&nbsp;also&nbsp;confirm&nbsp;exactly&nbsp;what&nbsp;your&nbsp;setup&nbsp;looks&nbsp;like,&nbsp;viz &lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;wrote&nbsp;a&nbsp;test&nbsp;attempting&nbsp;to&nbsp;reproduce&nbsp;what&nbsp;my&nbsp;actual&nbsp;client&nbsp;is&nbsp;experiencing,&nbsp;but&nbsp;I&nbsp;was&nbsp;only&nbsp;able&nbsp;to&nbsp;come&nbsp;close&nbsp;to&nbsp;reproducing&nbsp;my&nbsp;client&amp;#39;s&nbsp;results&nbsp;when&nbsp;pushing&nbsp;a&nbsp;lot&nbsp;of&nbsp;volume&nbsp;down&nbsp;to&nbsp;the&nbsp;consumers,&nbsp;and&nbsp;even&nbsp;then&nbsp;it&nbsp;was&nbsp;not&nbsp;consistent&nbsp;enough&nbsp;to&nbsp;draw&nbsp;any&nbsp;conclusions.&nbsp;At&nbsp;this&nbsp;point&nbsp;I&amp;#39;m&nbsp;satisfied&nbsp;to&nbsp;simply&nbsp;tweak&nbsp;my&nbsp;client&nbsp;to&nbsp;account&nbsp;for&nbsp;potential&nbsp;delays&nbsp;in&nbsp;ShutdownListener&nbsp;calls&nbsp;and&nbsp;move&nbsp;on.&nbsp;I&nbsp;just&nbsp;wanted&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;mechanisms&nbsp;introduced&nbsp;by&nbsp;amqp-client&nbsp;which&nbsp;could&nbsp;be&nbsp;causing&nbsp;any&nbsp;additional&nbsp;ShutdownListener&nbsp;delays,&nbsp;and&nbsp;it&nbsp;sounds&nbsp;like&nbsp;there&nbsp;are&nbsp;not.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Jonathan&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;are&nbsp;both&nbsp;connections&nbsp;made&nbsp;between&nbsp;the&nbsp;client&nbsp;and&nbsp;exactly&nbsp;one&nbsp;server&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;2.&nbsp;how&nbsp;are&nbsp;you&nbsp;&amp;quot;partitioning&amp;quot;&nbsp;the&nbsp;server&nbsp;from&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;cluster&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;3.&nbsp;are&nbsp;you&nbsp;sending&nbsp;or&nbsp;receiving&nbsp;on&nbsp;the&nbsp;various&nbsp;channels&nbsp;that&nbsp;we&amp;#39;re&nbsp;talking&nbsp;about&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;span&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Tim&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
