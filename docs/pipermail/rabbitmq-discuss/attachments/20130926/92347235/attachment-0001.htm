<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;ok,&nbsp;I&nbsp;got&nbsp;keepalived&nbsp;above&nbsp;the&nbsp;cluster.&nbsp;And&nbsp;is&nbsp;balancing&nbsp;61613&nbsp;and&nbsp;5672&lt;div&gt;could&nbsp;be&nbsp;keepalived&nbsp;opening&nbsp;and&nbsp;not&nbsp;closing&nbsp;something&nbsp;properly?&lt;/div&gt;&lt;div&gt;I&nbsp;undertstand&nbsp;the&nbsp;connections&nbsp;are&nbsp;being&nbsp;close&nbsp;well,&nbsp;but&nbsp;..&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;26,&nbsp;2013&nbsp;at&nbsp;4:18&nbsp;PM,&nbsp;Santi&nbsp;Nuñez-Cacho&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:brian.santiago@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;brian.santiago@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;yes,&nbsp;I&nbsp;do&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;=INFO&nbsp;REPORT====&nbsp;26-Sep-2013::16:12:46&nbsp;===&lt;/div&gt;&lt;div&gt;accepting&nbsp;STOMP&nbsp;connection&nbsp;&amp;lt;0.19254.0&amp;gt;&nbsp;(XX:49217&nbsp;-&amp;gt;&nbsp;YY:61613)&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;=INFO&nbsp;REPORT====&nbsp;26-Sep-2013::16:12:46&nbsp;===&lt;/div&gt;<br>
&lt;div&gt;closing&nbsp;STOMP&nbsp;connection&nbsp;&amp;lt;0.19254.0&amp;gt;&nbsp;(XX:49217&nbsp;-&amp;gt;&nbsp;YY:61613)&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;26,&nbsp;2013&nbsp;at&nbsp;4:07&nbsp;PM,&nbsp;Simon&nbsp;MacMullen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hmm.&nbsp;Something&nbsp;must&nbsp;be&nbsp;establishing&nbsp;short-lived&nbsp;stomp&nbsp;connections&nbsp;though,&nbsp;do&nbsp;you&nbsp;see&nbsp;lines&nbsp;like:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;=INFO&nbsp;REPORT====&nbsp;26-Sep-2013::15:06:39&nbsp;===&lt;br&gt;<br>
 &nbsp;accepting&nbsp;STOMP&nbsp;connection&nbsp;&amp;lt;0.376.0&amp;gt;&nbsp;([::1]:56780&nbsp;-&amp;gt;&nbsp;[::1]:61613)&lt;br&gt;<br>
&lt;br&gt;<br>
in&nbsp;the&nbsp;log?&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&nbsp;Simon&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;26/09/2013&nbsp;2:07PM,&nbsp;Santi&nbsp;Nuñez-Cacho&nbsp;wrote:&lt;br&gt;<br>
&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;<br>
It&nbsp;was&nbsp;the&nbsp;connetion&nbsp;to&nbsp;the&nbsp;mcollective&nbsp;rabbitmq&nbsp;middleware.&nbsp;(&nbsp;we&nbsp;&amp;#39;ve&lt;br&gt;<br>
got&nbsp;all&nbsp;the&nbsp;machines&nbsp;connected&nbsp;to&nbsp;mcollective&nbsp;)&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;removed&nbsp;the&nbsp;mcollective&nbsp;conection.&nbsp;Disabling&nbsp;it.&nbsp;And&nbsp;restarting&nbsp;the&lt;br&gt;<br>
rabbitmq-server.&lt;br&gt;<br>
&lt;br&gt;<br>
That&amp;#39;s&nbsp;we&nbsp;got&nbsp;now&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
[root@rabbit03.bcn&nbsp;rabbitmq]#&nbsp;lsof&nbsp;-i&nbsp;:61613&lt;br&gt;<br>
COMMAND&nbsp; &nbsp; PID&nbsp; &nbsp; &nbsp;USER&nbsp; &nbsp;FD&nbsp; &nbsp;TYPE&nbsp; DEVICE&nbsp;SIZE/OFF&nbsp;NODE&nbsp;NAME&lt;br&gt;<br>
beam.smp&nbsp;17472&nbsp;rabbitmq&nbsp; &nbsp;21u&nbsp; IPv6&nbsp;4652854&nbsp; &nbsp; &nbsp; 0t0&nbsp; TCP&nbsp;*:61613&nbsp;(LISTEN)&lt;br&gt;<br>
[root@rabbit03.bcn&nbsp;rabbitmq]#&nbsp; rabbitmqctl&nbsp;eval&lt;br&gt;<br>
&amp;#39;length(supervisor:which_&lt;u&gt;&lt;/u&gt;children(rabbit_stomp_client_&lt;u&gt;&lt;/u&gt;sup_sup)).&amp;#39;&lt;br&gt;<br>
50&lt;br&gt;<br>
...done.&lt;br&gt;<br>
[root@rabbit03.bcn&nbsp;rabbitmq]#&lt;br&gt;<br>
&lt;br&gt;<br>
And&nbsp;the&nbsp;process&nbsp;growing...&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Thu,&nbsp;Sep&nbsp;26,&nbsp;2013&nbsp;at&nbsp;2:57&nbsp;PM,&nbsp;Simon&nbsp;MacMullen&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;mailto:&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&amp;gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;On&nbsp;26/09/2013&nbsp;1:51PM,&nbsp;Santi&nbsp;Nuñez-Cacho&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;I&nbsp;expect&nbsp;0&nbsp;stomp&nbsp;connetions.&nbsp;The&nbsp;unique&nbsp;one&nbsp;connection&nbsp;on&nbsp;61613&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;should&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;be&nbsp;the&nbsp;cluster&nbsp;one.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;Port&nbsp;61613&nbsp;is&nbsp;not&nbsp;used&nbsp;for&nbsp;clustering,&nbsp;it&amp;#39;s&nbsp;just&nbsp;stomp.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;[root@rabbit03.bcn&nbsp;~]#&nbsp; rabbitmqctl&nbsp;eval&lt;br&gt;&lt;/div&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;length(supervisor:which___&lt;u&gt;&lt;/u&gt;children(rabbit_stomp_client__&lt;u&gt;&lt;/u&gt;_sup_sup)).&amp;#39;&lt;div&gt;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;3802&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;...done.&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;[root@rabbit03.bcn&nbsp;~]#&nbsp;lsof&nbsp;-i&nbsp;:61613&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;COMMAND&nbsp; &nbsp; PID&nbsp; &nbsp; &nbsp;USER&nbsp; &nbsp;FD&nbsp; &nbsp;TYPE&nbsp; DEVICE&nbsp;SIZE/OFF&nbsp;NODE&nbsp;NAME&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;ruby&nbsp; &nbsp; &nbsp; 5638&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; 6u&nbsp; IPv4&nbsp; &nbsp;25097&nbsp; &nbsp; &nbsp; 0t0&nbsp; TCP&lt;br&gt;&lt;/div&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;rabbit03.bcn.softonic.lan:__&lt;u&gt;&lt;/u&gt;59851-&amp;gt;rabbit:61613&nbsp;(ESTABLISHED)&lt;div&gt;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;beam.smp&nbsp;27183&nbsp;rabbitmq&nbsp; &nbsp;21u&nbsp; IPv6&nbsp;4521334&nbsp; &nbsp; &nbsp; 0t0&nbsp; TCP&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;*:61613&nbsp;(LISTEN)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;Ah.&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;So&nbsp;you&nbsp;have&nbsp;one&nbsp;connection,&nbsp;from&nbsp;some&nbsp;ruby&nbsp;script.&nbsp;But&nbsp;3802&lt;br&gt;<br>
 &nbsp; &nbsp;connection&nbsp;processes.&nbsp;So&nbsp;something&nbsp;is&nbsp;somehow&nbsp;leaking.&nbsp;Thank&nbsp;you&nbsp;for&lt;br&gt;<br>
 &nbsp; &nbsp;reporting&nbsp;this&nbsp;bug.&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;But&nbsp;to&nbsp;help&nbsp;get&nbsp;to&nbsp;the&nbsp;bottom&nbsp;of&nbsp;it&nbsp;-&nbsp;what&nbsp;is&nbsp;that&nbsp;ruby&nbsp;script&nbsp;doing?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;Cheers,&nbsp;Simon&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;--&lt;br&gt;<br>
 &nbsp; &nbsp;Simon&nbsp;MacMullen&lt;br&gt;<br>
 &nbsp; &nbsp;RabbitMQ,&nbsp;Pivotal&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;div&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Simon&nbsp;MacMullen&lt;br&gt;<br>
RabbitMQ,&nbsp;Pivotal&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
