<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;26&nbsp;September&nbsp;2013&nbsp;14:10,&nbsp;Michael&nbsp;Klishin&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:michael@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;michael@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;br&gt;<br>
On&nbsp;sep&nbsp;26,&nbsp;2013,&nbsp;at&nbsp;1:50&nbsp;p.m.,&nbsp;josh&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:martin.rogan.inc@gmail.com&quot;&gt;martin.rogan.inc@gmail.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;Let&nbsp;me&nbsp;restate&nbsp;that...&nbsp;With&nbsp;30K+30K&nbsp;channels&nbsp;the&nbsp;first&nbsp;100&nbsp;each&nbsp;take&nbsp;10&nbsp;seconds&nbsp;to&nbsp;close&nbsp;using&nbsp;100&nbsp;simultaneous&nbsp;threads.&nbsp;The&nbsp;remaining&nbsp;59,900&nbsp;each&nbsp;take&nbsp;less&nbsp;than&nbsp;0.5&nbsp;seconds.&nbsp;My&nbsp;feeling&nbsp;is&nbsp;that&nbsp;there&amp;#39;s&nbsp;some&nbsp;funky&nbsp;connection-wide&nbsp;synchronization/continuation&nbsp;going&nbsp;on&nbsp;here.&nbsp;Hit&nbsp;the&nbsp;connection&nbsp;up&nbsp;with&nbsp;100&nbsp;channel-close&nbsp;requests&nbsp;on&nbsp;100&nbsp;threads&nbsp;simultaneously&nbsp;and&nbsp;it&nbsp;baulks.&nbsp;Whatever&nbsp;causes&nbsp;that&nbsp;initial&nbsp;spasm&nbsp;doesn&amp;#39;t&nbsp;seem&nbsp;to&nbsp;affect&nbsp;subsequent&nbsp;close&nbsp;operations&nbsp;and&nbsp;everything&nbsp;swims&nbsp;along&nbsp;nicely.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;correct.&nbsp;Closing&nbsp;either&nbsp;a&nbsp;channel&nbsp;or&nbsp;connection&nbsp;involves&nbsp;waiting&nbsp;for&nbsp;a&nbsp;reply&nbsp;from&nbsp;RabbitMQ.&lt;br&gt;<br>
Iit&nbsp;would&nbsp;be&nbsp;interested&nbsp;to&nbsp;see&nbsp;thread&nbsp;dumps&nbsp;and&nbsp;as&nbsp;much&nbsp;information&nbsp;about&nbsp;lock&nbsp;contention&nbsp;you&nbsp;can&nbsp;provide.&nbsp;My&nbsp;guess&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;_channelMap&nbsp;but&nbsp;I&amp;#39;m&nbsp;not&nbsp;a&nbsp;very&nbsp;reliable&nbsp;prediction&nbsp;machine.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;In&nbsp;tag&nbsp;3.1.5&nbsp;I&nbsp;can&nbsp;point&nbsp;to&nbsp;the&nbsp;close(...)&nbsp;method&nbsp;in&nbsp;ChannelN.java&nbsp;at&nbsp;line&nbsp;569:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;Now&nbsp;that&nbsp;we&amp;#39;re&nbsp;in&nbsp;quiescing&nbsp;state,&nbsp;channel.close&nbsp;was&nbsp;sent&nbsp;and&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;we&nbsp;wait&nbsp;for&nbsp;the&nbsp;reply.&nbsp;We&nbsp;ignore&nbsp;the&nbsp;result.&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;(It&amp;#39;s&nbsp;NOT&nbsp;always&nbsp;close-ok.)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;notify&nbsp;=&nbsp;true;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;k.getReply(-1);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
Here&nbsp;k.getReply(-1)&nbsp;does&nbsp;the&nbsp;waiting.&nbsp;In&nbsp;my&nbsp;dodgy&nbsp;mod&nbsp;I&nbsp;skipped&nbsp;these&nbsp;two&nbsp;lines&nbsp;and&nbsp;also&nbsp;the&nbsp;finally&nbsp;block&nbsp;(notify==false):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp;finally&nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(abort&nbsp;||&nbsp;notify)&nbsp;{&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;Now&nbsp;we&nbsp;know&nbsp;everything&amp;#39;s&nbsp;been&nbsp;cleaned&nbsp;up&nbsp;and&nbsp;there&nbsp;should&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;be&nbsp;no&nbsp;more&nbsp;surprises&nbsp;arriving&nbsp;on&nbsp;the&nbsp;wire.&nbsp;Release&nbsp;the&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;channel&nbsp;number,&nbsp;and&nbsp;dissociate&nbsp;this&nbsp;ChannelN&nbsp;instance&nbsp;from&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;our&nbsp;connection&nbsp;so&nbsp;that&nbsp;any&nbsp;further&nbsp;frames&nbsp;inbound&nbsp;on&nbsp;this&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;channel&nbsp;can&nbsp;be&nbsp;caught&nbsp;as&nbsp;the&nbsp;errors&nbsp;they&nbsp;are.&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;releaseChannel();&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;notifyListeners();&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hence&nbsp;the&nbsp;channel&nbsp;resource&nbsp;leak&nbsp;and&nbsp;subsequent&nbsp;OOM.&nbsp;Although&nbsp;the&nbsp;delay&nbsp;disappeared&nbsp;and&nbsp;the&nbsp;channels&nbsp;were&nbsp;closed&nbsp;on&nbsp;the&nbsp;server&nbsp;it&nbsp;doesn&amp;#39;t&nbsp;reveal&nbsp;where&nbsp;the&nbsp;delay&nbsp;was&nbsp;incurred.&nbsp;The&nbsp;client&nbsp;may&nbsp;have&nbsp;just&nbsp;been&nbsp;waiting&nbsp;for&nbsp;replies&nbsp;to&nbsp;come&nbsp;in&nbsp;after&nbsp;other&nbsp;data&nbsp;on&nbsp;the&nbsp;connection,&nbsp;with&nbsp;no&nbsp;lock&nbsp;contention,&nbsp;but&nbsp;on&nbsp;the&nbsp;other&nbsp;hand&nbsp;how&nbsp;do&nbsp;the&nbsp;subsequent&nbsp;closures&nbsp;get&nbsp;processed&nbsp;so&nbsp;much&nbsp;quicker?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;ve&nbsp;tried&nbsp;ramping&nbsp;up&nbsp;the&nbsp;number&nbsp;of&nbsp;connections&nbsp;to&nbsp;relieve&nbsp;the&nbsp;pressure.&nbsp;This&nbsp;certainly&nbsp;works&nbsp;with&nbsp;predictable&nbsp;results.&nbsp;With&nbsp;30K+30K&nbsp;connections&nbsp;spread&nbsp;evenly&nbsp;over&nbsp;2&nbsp;connections&nbsp;the&nbsp;initial&nbsp;100&nbsp;channel-close&nbsp;delays&nbsp;are&nbsp;halved&nbsp;from&nbsp;10&nbsp;seconds&nbsp;to&nbsp;5&nbsp;seconds.&nbsp;Use&nbsp;10&nbsp;connections&nbsp;and&nbsp;the&nbsp;delay&nbsp;is&nbsp;imperceptible&nbsp;when&nbsp;compared&nbsp;to&nbsp;the&nbsp;subsequent&nbsp;59,900&nbsp;channel&nbsp;closures.&nbsp;Jump&nbsp;to&nbsp;50K+50K&nbsp;channels&nbsp;(we&nbsp;can&nbsp;do&nbsp;this&nbsp;with&nbsp;10&nbsp;connections&nbsp;but&nbsp;not&nbsp;1&nbsp;connection&nbsp;due&nbsp;to&nbsp;channel-max)&nbsp;and&nbsp;the&nbsp;delays&nbsp;start&nbsp;to&nbsp;creep&nbsp;back&nbsp;in&nbsp;again.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
Again,&nbsp;hard&nbsp;to&nbsp;tell&nbsp;what&nbsp;the&nbsp;contention&nbsp;point&nbsp;is&nbsp;without&nbsp;runtime&nbsp;data.&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;My&nbsp;concerns&nbsp;with&nbsp;this&nbsp;approach&nbsp;are&nbsp;that&nbsp;1)&nbsp;multiple&nbsp;connections&nbsp;are&nbsp;discouraged&nbsp;in&nbsp;the&nbsp;documentation&nbsp;due&nbsp;to&nbsp;i/o&nbsp;resource&nbsp;overhead&nbsp;and&nbsp;that&nbsp;2)&nbsp;it&amp;#39;s&nbsp;not&nbsp;clear&nbsp;for&nbsp;my&nbsp;application&nbsp;how&nbsp;to&nbsp;sensibly&nbsp;predict&nbsp;the&nbsp;optimum&nbsp;number&nbsp;of&nbsp;channels&nbsp;per&nbsp;connection.&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;soft&nbsp;limit&nbsp;to&nbsp;the&nbsp;number&nbsp;of&nbsp;channels&nbsp;per&nbsp;connection&nbsp;why&nbsp;is&nbsp;it&nbsp;not&nbsp;documented&nbsp;or&nbsp;made&nbsp;available&nbsp;in&nbsp;the&nbsp;api?&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
See&nbsp;ConnectionFactory.DEFAULT_CHANNEL_MAX&nbsp;and&nbsp;ConnectionFactory#setRequestedChannelMax.&lt;br&gt;<br>
&lt;br&gt;<br>
Note&nbsp;that&nbsp;some&nbsp;clients&nbsp;have&nbsp;a&nbsp;different&nbsp;default&nbsp;(like&nbsp;65536&nbsp;channels).&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;my&nbsp;3.1.5&nbsp;client ConnectionFactory.DEFAULT_CHANNEL_MAX==0&nbsp;and&nbsp;connection.getChannelMax()==65,536.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;ve&nbsp;tried&nbsp;my&nbsp;hand&nbsp;at&nbsp;modifying&nbsp;the&nbsp;client&nbsp;library&nbsp;by&nbsp;not&nbsp;waiting&nbsp;for&nbsp;channel-close&nbsp;acknowledgements&nbsp;from&nbsp;the&nbsp;RabbitMQ&nbsp;server.&nbsp;This&nbsp;worked&nbsp;like&nbsp;a&nbsp;charm.&nbsp;Channels&nbsp;were&nbsp;closed&nbsp;instantly&nbsp;with&nbsp;no&nbsp;delay&nbsp;in&nbsp;the&nbsp;client&nbsp;and&nbsp;confirmed&nbsp;as&nbsp;closed&nbsp;on&nbsp;the&nbsp;server.&nbsp;Eight&nbsp;hours&nbsp;later&nbsp;though&nbsp;and&nbsp;I&nbsp;was&nbsp;out&nbsp;of&nbsp;heap&nbsp;space&nbsp;as&nbsp;the&nbsp;channel&nbsp;resources&nbsp;internal&nbsp;to&nbsp;the&nbsp;client&nbsp;library&nbsp;were&nbsp;not&nbsp;being&nbsp;released.&nbsp;I&nbsp;haven&amp;#39;t&nbsp;managed&nbsp;to&nbsp;isolate&nbsp;the&nbsp;source&nbsp;of&nbsp;the&nbsp;delay&nbsp;either...&nbsp;is&nbsp;it&nbsp;in&nbsp;the&nbsp;client&nbsp;library&nbsp;or&nbsp;the&nbsp;server&nbsp;itself?&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
You&nbsp;need&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;ChannelManager#disconnectChannel&nbsp;is&nbsp;used.&nbsp;VisualVM&nbsp;should&lt;br&gt;<br>
pretty&nbsp;quickly&nbsp;show&nbsp;what&nbsp;objects&nbsp;use&nbsp;most&nbsp;heap&nbsp;space.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;revealed&nbsp;by&nbsp;YourKit&nbsp;mountains&nbsp;of&nbsp;Channels&nbsp;were&nbsp;not&nbsp;cleared&nbsp;up&nbsp;by&nbsp;my&nbsp;dodgy&nbsp;mod&nbsp;skipping&nbsp;disconnectChannel().&nbsp;But&nbsp;I&nbsp;figured&nbsp;it&nbsp;was&nbsp;unsafe&nbsp;to&nbsp;invoke&nbsp;as&nbsp;it&nbsp;we&nbsp;don&amp;#39;t&nbsp;know&nbsp;&amp;quot;everything&amp;#39;s&nbsp;been&nbsp;cleaned&nbsp;up&nbsp;and&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;more&nbsp;surprises&nbsp;arriving&nbsp;on&nbsp;the&nbsp;wire.&amp;quot;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt; &lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Questions:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Before&nbsp;making&nbsp;application&nbsp;changes&nbsp;I&amp;#39;d&nbsp;like&nbsp;to&nbsp;know&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;known&nbsp;issue&nbsp;with&nbsp;the&nbsp;Java&nbsp;client?&lt;br&gt;<br>
&lt;br&gt;<br>
I&amp;#39;ve&nbsp;seen&nbsp;this&nbsp;before&nbsp;with&nbsp;2&nbsp;other&nbsp;clients.&nbsp;In&nbsp;one&nbsp;case&nbsp;the&nbsp;problem&nbsp;was&nbsp;different&nbsp;and&nbsp;mostly&nbsp;solved&lt;br&gt;<br>
(I&nbsp;have&nbsp;not&nbsp;tried&nbsp;60K&nbsp;channels&nbsp;but&nbsp;for&nbsp;6-8K&nbsp;it&nbsp;worked&nbsp;reasonably&nbsp;well).&nbsp;Another&nbsp;client&nbsp;is&nbsp;built&nbsp;on&nbsp;the&lt;br&gt;<br>
Java&nbsp;one.&nbsp;So,&nbsp;it&amp;#39;s&nbsp;a&nbsp;known&nbsp;problem&nbsp;that&nbsp;few&nbsp;people&nbsp;run&nbsp;into.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;few&nbsp;seconds&nbsp;here&nbsp;and&nbsp;there&nbsp;is&nbsp;not&nbsp;so&nbsp;problematic&nbsp;really.&nbsp;RabbitMQ&nbsp;is&nbsp;so&nbsp;critical&nbsp;to&nbsp;our&nbsp;application&nbsp;though&nbsp;that&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;we&amp;#39;re&nbsp;not&nbsp;falling&nbsp;off&nbsp;any&nbsp;edges.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
&amp;gt;&nbsp;Are&nbsp;there&nbsp;better&nbsp;workarounds&nbsp;than&nbsp;multiple&nbsp;connections&nbsp;and&nbsp;application-level&nbsp;channel&nbsp;management?&nbsp;In&nbsp;practise&nbsp;my&nbsp;actual&nbsp;application&nbsp;uses&nbsp;around&nbsp;20K&nbsp;channels&nbsp;per&nbsp;process,&nbsp;which&nbsp;I&nbsp;don&amp;#39;t&nbsp;feel&nbsp;is&nbsp;excessive,&nbsp;and&nbsp;message&nbsp;throughput&nbsp;is&nbsp;actually&nbsp;pretty&nbsp;light&nbsp;as&nbsp;I&amp;#39;m&nbsp;leveraging&nbsp;RabbitMQ&nbsp;more&nbsp;for&nbsp;it&amp;#39;s&nbsp;routing&nbsp;capabilities.&nbsp;if&nbsp;you&nbsp;think&nbsp;the&nbsp;number&nbsp;of&nbsp;channels&nbsp;is&nbsp;a&nbsp;problem&nbsp;in&nbsp;itself&nbsp;then&nbsp;please&nbsp;say&nbsp;so!&nbsp;I&nbsp;could&nbsp;refactor&nbsp;to&nbsp;use&nbsp;less&nbsp;channels&nbsp;but&nbsp;then&nbsp;I&amp;#39;d&nbsp;be&nbsp;sharing&nbsp;channels&nbsp;and&nbsp;would&nbsp;either&nbsp;have&nbsp;to&nbsp;synchronize&nbsp;their&nbsp;usage&nbsp;or&nbsp;ignore&nbsp;documentation&nbsp;guidelines.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;something&nbsp;that&nbsp;should&nbsp;be&nbsp;improved&nbsp;in&nbsp;the&nbsp;Java&nbsp;client,&nbsp;but&nbsp;in&nbsp;the&nbsp;meantime&nbsp;you&nbsp;may&nbsp;need&lt;br&gt;<br>
to&nbsp;use&nbsp;a&nbsp;pool&nbsp;of&nbsp;connections&nbsp;that&nbsp;will&nbsp;open&nbsp;channels&nbsp;using&nbsp;round&nbsp;robin&nbsp;or&nbsp;similar.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&amp;gt;&nbsp;The&nbsp;error&nbsp;handling&nbsp;paradigm&nbsp;makes&nbsp;this&nbsp;cumbersome&nbsp;though;&nbsp;any&nbsp;channel&nbsp;error&nbsp;results&nbsp;in&nbsp;it&amp;#39;s&nbsp;termination&nbsp;so&nbsp;it&amp;#39;s&nbsp;difficult&nbsp;to&nbsp;isolate&nbsp;errors,&nbsp;prevent&nbsp;them&nbsp;from&nbsp;permeating&nbsp;across&nbsp;unrelated&nbsp;publishers/consumers&nbsp;and&nbsp;recover&nbsp;in&nbsp;a&nbsp;robust&nbsp;manner.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;in&nbsp;part&nbsp;why&nbsp;having&nbsp;one&nbsp;channel&nbsp;per&nbsp;thread&nbsp;is&nbsp;a&nbsp;very&nbsp;good&nbsp;idea.&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;summarize:&nbsp;yes,&nbsp;this&nbsp;is&nbsp;a&nbsp;known&nbsp;but&nbsp;rare&nbsp;problem.&nbsp;If&nbsp;you&nbsp;can&nbsp;provide&nbsp;profiling&nbsp;and&nbsp;thread&nbsp;dump&lt;br&gt;<br>
information&nbsp;that&nbsp;will&nbsp;help&nbsp;isolating&nbsp;the&nbsp;contention&nbsp;point,&nbsp;I&nbsp;think&nbsp;the&nbsp;issue&nbsp;can&nbsp;be&nbsp;resolved&nbsp;or&nbsp;largely&lt;br&gt;<br>
mitigated&nbsp;in&nbsp;a&nbsp;future&nbsp;version.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks.&nbsp;Will&nbsp;do.&nbsp;Would&nbsp;you&nbsp;prefer&nbsp;a&nbsp;plain&nbsp;old&nbsp;Java&nbsp;app&nbsp;that&nbsp;you&nbsp;can&nbsp;profile&nbsp;yourself?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
MK&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
