require 'rubygems'
require 'sinatra'
require 'json'

set :port, 55673

INFO = %w( name durable auto_delete arguments messages_ready messages_unacknowledged messages memory )
get '/api/queues' do
  rabbitmqctl = `rabbitmqctl list_queues #{INFO.join(' ')}`
  queues = []
  rabbitmqctl.each_line do |line|
    row = line.split(/\t/)
    queue = {}
    INFO.each { |info| queue[info] = row.shift }
    queues << queue
  end
  content_type 'text/json'
  queues.to_json
end