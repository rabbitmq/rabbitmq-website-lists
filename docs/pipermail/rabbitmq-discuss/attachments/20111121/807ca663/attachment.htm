<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;style&gt;&lt;!--<br>
.hmmessage&nbsp;P<br>
{<br>
margin:0px;<br>
padding:0px<br>
}<br>
body.hmmessage<br>
{<br>
font-size:&nbsp;10pt;<br>
font-family:Tahoma<br>
}<br>
--&gt;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;class='hmmessage'&gt;&lt;div&nbsp;dir='ltr'&gt;<br>
Hello&nbsp;Cameron:&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;resolve&nbsp;any&nbsp;confusion,&nbsp;let&nbsp;me&nbsp;make&nbsp;a&nbsp;table&nbsp;to&nbsp;clarify.&nbsp;I&nbsp;DO&nbsp;have&nbsp;&quot;x-ha-policy&quot;&nbsp;set&nbsp;to&nbsp;&quot;all&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;nbsp;&nbsp;Steps&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;|&amp;nbsp;&amp;nbsp;&nbsp;vm1&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;|&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;vm2&lt;br&gt;<br>
&amp;nbsp;&nbsp;------------------------------------------------------------------------------&lt;br&gt;<br>
&amp;nbsp;&nbsp;1.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;|&amp;nbsp;&nbsp;started&nbsp;(10&nbsp;msg,&nbsp;disk,&nbsp;master)&nbsp;&amp;nbsp;&nbsp;|&amp;nbsp;&nbsp;started&nbsp;(10&nbsp;msg,&nbsp;disk)&lt;br&gt;<br>
&amp;nbsp;&nbsp;2.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;|&amp;nbsp;&nbsp;stop&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;|&amp;nbsp;&nbsp;started&nbsp;(10&nbsp;msg,&nbsp;disk,&nbsp;became&nbsp;master)&lt;br&gt;<br>
&amp;nbsp;&nbsp;3.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;|&amp;nbsp;&nbsp;started&nbsp;(10&nbsp;msg,&nbsp;disk,&nbsp;slave)&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;|&amp;nbsp;&nbsp;started&nbsp;(10&nbsp;msg,&nbsp;disk,&nbsp;master)&lt;br&gt;<br>
&amp;nbsp;&nbsp;4.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;|&amp;nbsp;&nbsp;started&nbsp;(0&nbsp;msg,&nbsp;disk,&nbsp;master)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;|&nbsp;stop&lt;br&gt;<br>
&lt;br&gt;<br>
Noticed&nbsp;that&nbsp;in&nbsp;my&nbsp;step&nbsp;4,&nbsp;when&nbsp;I&nbsp;stop&nbsp;my&nbsp;VM2,&nbsp;the&nbsp;message&nbsp;in&nbsp;VM1&nbsp;<br>
immediately&nbsp;disappear.&nbsp;You&nbsp;are&nbsp;right,&nbsp;each&nbsp;step&nbsp;has&nbsp;interval&nbsp;of&nbsp;about&nbsp;10<br>
&nbsp;seconds,&nbsp;I&nbsp;didn't&nbsp;wait&nbsp;very&nbsp;long&nbsp;to&nbsp;stop&nbsp;the&nbsp;new&nbsp;master.&nbsp;You&nbsp;mentioned&nbsp;<br>
that&nbsp;I&nbsp;have&nbsp;to&nbsp;I&nbsp;have&nbsp;to&nbsp;wait&nbsp;until&nbsp;the&nbsp;queues&nbsp;are&nbsp;synchronized.&nbsp;How&nbsp;<br>
long&nbsp;is&nbsp;that&nbsp;waiting?&nbsp;Is&nbsp;there&nbsp;a&nbsp;command&nbsp;that&nbsp;I&nbsp;could&nbsp;find&nbsp;out&nbsp;if&nbsp;they&nbsp;<br>
finished&nbsp;the&nbsp;synchronization?&nbsp;Like&nbsp;rabbitmqctl&nbsp;command&nbsp;or&nbsp;anything?&nbsp;Or&nbsp;<br>
any&nbsp;way&nbsp;to&nbsp;force&nbsp;synchronize&nbsp;right&nbsp;now.&nbsp;I&nbsp;am&nbsp;only&nbsp;testing&nbsp;10&nbsp;messages,&nbsp;<br>
it&nbsp;shouldn't&nbsp;take&nbsp;that&nbsp;long.&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;for&nbsp;your&nbsp;help.&lt;br&gt;<br>
&lt;br&gt;<br>
Jeffrey.&lt;br&gt;&lt;br&gt;&lt;div&gt;&amp;gt;&nbsp;From:&nbsp;cameron.davison@gmail.com&lt;br&gt;&amp;gt;&nbsp;Date:&nbsp;Mon,&nbsp;21&nbsp;Nov&nbsp;2011&nbsp;23:46:24&nbsp;-0600&lt;br&gt;&amp;gt;&nbsp;Subject:&nbsp;Re:&nbsp;[rabbitmq-discuss]&nbsp;active/active&nbsp;message&nbsp;persistence&nbsp;problem&lt;br&gt;&amp;gt;&nbsp;To:&nbsp;cpthk@hotmail.com&lt;br&gt;&amp;gt;&nbsp;CC:&nbsp;rabbitmq-discuss@lists.rabbitmq.com&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;What&nbsp;order&nbsp;are&nbsp;you&nbsp;restarting&nbsp;the&nbsp;nodes?&nbsp;Any&nbsp;rabbitmq&nbsp;server&nbsp;that&lt;br&gt;&amp;gt;&nbsp;connects&nbsp;to&nbsp;a&nbsp;cluster&nbsp;will&nbsp;start&nbsp;its&nbsp;queue&nbsp;fresh&nbsp;and&nbsp;begin&nbsp;replicating&lt;br&gt;&amp;gt;&nbsp;from&nbsp;the&nbsp;master.&nbsp;You&nbsp;should&nbsp;wait&nbsp;and&nbsp;make&nbsp;sure&nbsp;that&nbsp;all&nbsp;the&nbsp;queues&nbsp;are&lt;br&gt;&amp;gt;&nbsp;synchronized&nbsp;before&nbsp;you&nbsp;shut&nbsp;down&nbsp;the&nbsp;master,&nbsp;or&nbsp;new&nbsp;master.&nbsp;Old&lt;br&gt;&amp;gt;&nbsp;messages&nbsp;are&nbsp;not&nbsp;read&nbsp;from&nbsp;nodes&nbsp;that&nbsp;connect&nbsp;to&nbsp;the&nbsp;cluster&nbsp;because&lt;br&gt;&amp;gt;&nbsp;the&nbsp;assumption&nbsp;is&nbsp;that&nbsp;the&nbsp;queue&nbsp;will&nbsp;go&nbsp;to&nbsp;0&nbsp;soon&nbsp;and&nbsp;then&nbsp;the&nbsp;old&lt;br&gt;&amp;gt;&nbsp;messages&nbsp;will&nbsp;not&nbsp;matter&nbsp;so&nbsp;only&nbsp;the&nbsp;new&nbsp;messages&nbsp;will&nbsp;be&nbsp;important.&lt;br&gt;&amp;gt;&nbsp;Also,&nbsp;you&nbsp;should&nbsp;make&nbsp;sure&nbsp;that&nbsp;the&nbsp;&quot;x-ha-policy&quot;&nbsp;is&nbsp;set&nbsp;to&nbsp;&quot;all&quot;&nbsp;or&lt;br&gt;&amp;gt;&nbsp;to&nbsp;the&nbsp;&quot;nodes&quot;&nbsp;that&nbsp;you&nbsp;would&nbsp;like&nbsp;the&nbsp;queue&nbsp;to&nbsp;be&nbsp;mirrored&nbsp;to.&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;Cameron&lt;br&gt;&amp;gt;&nbsp;&lt;br&gt;&amp;gt;&nbsp;On&nbsp;Mon,&nbsp;Nov&nbsp;21,&nbsp;2011&nbsp;at&nbsp;7:14&nbsp;PM,&nbsp;Jeffrey&nbsp;Chen&nbsp;&amp;lt;cpthk@hotmail.com&amp;gt;&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;Hi&nbsp;RabbitMQ&nbsp;community:&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;I&nbsp;am&nbsp;encounter&nbsp;this&nbsp;problem&nbsp;about&nbsp;message&nbsp;persistence.&nbsp;Here&nbsp;is&nbsp;my&nbsp;case,&nbsp;I&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;have&nbsp;2&nbsp;server&nbsp;nodes&nbsp;with&nbsp;active/active&nbsp;setup,&nbsp;both&nbsp;are&nbsp;persisted&nbsp;to&nbsp;DISK.&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;The&nbsp;queue&nbsp;declarations&nbsp;are&nbsp;defined&nbsp;as&nbsp;durable.&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;This&nbsp;is&nbsp;what&nbsp;I&nbsp;got&nbsp;when&nbsp;doing:&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;#&nbsp;rabbitmqctl&nbsp;cluster_status&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;Cluster&nbsp;status&nbsp;of&nbsp;node&nbsp;'rabbit@aaron-vm177'&nbsp;...&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;[{nodes,[{disc,['rabbit@vm1','rabbit@vm2']}]},&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;nbsp;{running_nodes,['rabbit@vm1','rabbit@vm2']}]&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;...done.&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;#&nbsp;rabbitmqctl&nbsp;list_queues&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;Listing&nbsp;queues&nbsp;...&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;test&nbsp;&amp;nbsp;&amp;nbsp;&nbsp;10&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;...done.&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;My&nbsp;vm1&nbsp;is&nbsp;currently&nbsp;master&nbsp;node.&nbsp;When&nbsp;I&nbsp;stop&nbsp;RabbitMQ&nbsp;service&nbsp;in&nbsp;vm1,&nbsp;and&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;start&nbsp;it&nbsp;back&nbsp;up.&nbsp;I&nbsp;check&nbsp;my&nbsp;messages&nbsp;in&nbsp;the&nbsp;queue,&nbsp;the&nbsp;messages&nbsp;are&nbsp;still&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;there.&nbsp;This&nbsp;time&nbsp;when&nbsp;I&nbsp;stop&nbsp;RabbitMQ&nbsp;service&nbsp;in&nbsp;vm2.&nbsp;The&nbsp;messages&nbsp;will&nbsp;be&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;gone.&nbsp;It&nbsp;seems&nbsp;like&nbsp;when&nbsp;I&nbsp;restart&nbsp;both&nbsp;server&nbsp;nodes,&nbsp;the&nbsp;data&nbsp;will&nbsp;be&nbsp;lost.&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;Does&nbsp;anyone&nbsp;know&nbsp;the&nbsp;reason?&nbsp;Is&nbsp;there&nbsp;any&nbsp;way&nbsp;to&nbsp;work&nbsp;around&nbsp;this?&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;My&nbsp;goal&nbsp;is&nbsp;that&nbsp;any&nbsp;server&nbsp;nodes&nbsp;down,&nbsp;and&nbsp;when&nbsp;I&nbsp;bring&nbsp;it&nbsp;back&nbsp;up,&nbsp;no&nbsp;data&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;will&nbsp;be&nbsp;lost.&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;Jeffrey.&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;_______________________________________________&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;rabbitmq-discuss@lists.rabbitmq.com&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;&amp;gt;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;<br>
&lt;/html&gt;
</tt>
