<tt>
Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;using&nbsp;the&nbsp;rabbit&nbsp;java&nbsp;client&nbsp;and&nbsp;rabbitmq&nbsp;server&nbsp;for&nbsp;some&nbsp;simple&nbsp;messaging&nbsp;and&nbsp;I&nbsp;can&amp;#39;t&nbsp;seem&nbsp;to&nbsp;get&nbsp;the&nbsp;shutdown&nbsp;listener&nbsp;to&nbsp;work&nbsp;as&nbsp;expected.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Basically,&nbsp;I&amp;#39;m&nbsp;attaching&nbsp;a&nbsp;shutdownlistener&nbsp;to&nbsp;the&nbsp;connection&nbsp;and&nbsp;then&nbsp;start&nbsp;sending&nbsp;messages&nbsp;every&nbsp;second.&nbsp;If&nbsp;I&nbsp;shutdown&nbsp;the&nbsp;server&nbsp;I&nbsp;would&nbsp;expect&nbsp;the&nbsp;shutdownlistener&nbsp;to&nbsp;be&nbsp;invoked&nbsp;at&nbsp;some&nbsp;point&nbsp;on&nbsp;the&nbsp;client&nbsp;but&nbsp;this&nbsp;never&nbsp;occurs.&nbsp;I&nbsp;only&nbsp;get&nbsp;an&amp;nbsp;AlreadyClosedException&nbsp;when&nbsp;calling&nbsp;basicPublish&nbsp;on&nbsp;the&nbsp;channel.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Test&nbsp;case:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;package&nbsp;foobar;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;import&nbsp;com.rabbitmq.client.*;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;import&nbsp;java.io.IOException;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
public&nbsp;class&nbsp;TestRabbitShutdownListener&nbsp;implements&nbsp;ShutdownListener,&nbsp;Runnable&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;private&nbsp;Connection&nbsp;connection;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;private&nbsp;Channel&nbsp;channel;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;private&nbsp;String&nbsp;exchange;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;private&nbsp;int&nbsp;ticket;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;throws&nbsp;IOException,&nbsp;InterruptedException&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;ConnectionParameters&nbsp;cp&nbsp;=&nbsp;new&nbsp;ConnectionParameters();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;cp.setUsername(&amp;quot;guest&amp;quot;);&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;cp.setPassword(&amp;quot;guest&amp;quot;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;ConnectionFactory&nbsp;cf&nbsp;=&nbsp;new&nbsp;ConnectionFactory(cp);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;TestRabbitShutdownListener&nbsp;trsl&nbsp;=&nbsp;new&nbsp;TestRabbitShutdownListener(&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;cf,&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;quot;foobar&amp;quot;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Thread&nbsp;t&nbsp;=&nbsp;new&nbsp;Thread(trsl);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;t.start();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;t.join();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Thread.sleep(5000);&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;TestRabbitShutdownListener(ConnectionFactory&nbsp;connectionFactory,&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;String&nbsp;exchange)&nbsp;throws&nbsp;IOException&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;this.exchange&nbsp;=&nbsp;exchange;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;this.connection&nbsp;=&nbsp;connectionFactory.newConnection(&amp;quot;localhost&amp;quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;this.connection.addShutdownListener(this);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;setupChannel();&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;private&nbsp;void&nbsp;setupChannel()&nbsp;throws&nbsp;IOException&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;this.channel&nbsp;=&nbsp;connection.createChannel();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;this.ticket&nbsp;=&nbsp;channel.accessRequest(&amp;quot;/data&amp;quot;);&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;channel.exchangeDeclare(&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;ticket,&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;exchange,&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;quot;fanout&amp;quot;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;void&nbsp;run()&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;while&nbsp;(true)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;try&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;System.out.println(&amp;quot;Sending&nbsp;msg..&amp;quot;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;channel.basicPublish(ticket,&nbsp;exchange,&nbsp;&amp;quot;&amp;quot;,&nbsp;MessageProperties.BASIC,&nbsp;new&nbsp;byte[]{});&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;Thread.sleep(1000);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;catch&nbsp;(IOException&nbsp;e)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;e.printStackTrace();&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;return;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;catch&nbsp;(InterruptedException&nbsp;e)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;System.out.println(&amp;quot;thread&nbsp;interrupted&amp;quot;);&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;return;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;public&nbsp;void&nbsp;shutdownCompleted(ShutdownSignalException&nbsp;e)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;System.out.println(&amp;quot;shutdownCompleted:&nbsp;&amp;quot;&nbsp;+&nbsp;e.getMessage());&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;e.printStackTrace();&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;--&nbsp;&lt;br&gt;.henric.larsson.&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
