<tt>
I&nbsp;think&nbsp;I've&nbsp;found&nbsp;a&nbsp;somewhat&nbsp;serious&nbsp;bug&nbsp;in&nbsp;the&nbsp;STOMP&nbsp;adapter:&nbsp;after&nbsp;a&nbsp;burst&nbsp;of&nbsp;incoming&nbsp;messages,&nbsp;the&nbsp;last&nbsp;one&nbsp;remains&nbsp;buffered&nbsp;somewhere&nbsp;indefinitely&nbsp;and&nbsp;is&nbsp;not&nbsp;added&nbsp;to&nbsp;the&nbsp;queue&nbsp;until&nbsp;another&nbsp;message&nbsp;is&nbsp;received&nbsp;from&nbsp;the&nbsp;same&nbsp;connection&nbsp;(same&nbsp;with&nbsp;topics).&nbsp;This&nbsp;cause&nbsp;and&nbsp;excessive&nbsp;delay&nbsp;to&nbsp;deliver&nbsp;the&nbsp;message&nbsp;to&nbsp;consumers,&nbsp;if&nbsp;it&nbsp;is&nbsp;ever&nbsp;delivered.&nbsp;Besides&nbsp;that,&nbsp;that&nbsp;last&nbsp;message&nbsp;is&nbsp;lost&nbsp;if&nbsp;the&nbsp;connection&nbsp;is&nbsp;not&nbsp;properly&nbsp;closed.&lt;br&gt;&lt;br&gt;I've&nbsp;attached&nbsp;a&nbsp;simple&nbsp;script&nbsp;which&nbsp;replicates&nbsp;the&nbsp;bug.&nbsp;It&nbsp;sends&nbsp;burst&nbsp;of&nbsp;100&nbsp;small&nbsp;messages&nbsp;to&nbsp;a&nbsp;queue&nbsp;every&nbsp;10&nbsp;seconds.&nbsp;Using&nbsp;the&nbsp;management&nbsp;console,&nbsp;we&nbsp;can&nbsp;inspect&nbsp;the&nbsp;count&nbsp;of&nbsp;Ready&nbsp;messages.&nbsp;The&nbsp;expected&nbsp;progression&nbsp;is&nbsp;100&nbsp;...&nbsp;200&nbsp;...&nbsp;300&nbsp;...&nbsp;400&nbsp;...&nbsp;500,&nbsp;but&nbsp;very&nbsp;frequently&nbsp;(not&nbsp;always)&nbsp;we&nbsp;get&nbsp;99&nbsp;...&nbsp;199&nbsp;...&nbsp;299&nbsp;...&nbsp;399&nbsp;...&nbsp;499,&nbsp;as&nbsp;the&nbsp;last&nbsp;message&nbsp;is&nbsp;not&nbsp;queued.&lt;br&gt;&lt;br&gt;Could&nbsp;be&nbsp;that&nbsp;the&nbsp;STOMP&nbsp;parser&nbsp;gets&nbsp;confused&nbsp;after&nbsp;an&nbsp;incomplete&nbsp;frame&nbsp;was&nbsp;read&nbsp;from&nbsp;tcp&nbsp;buffer?&nbsp;Any&nbsp;ideas?&lt;br&gt;&lt;br&gt;Regards,&lt;br&gt;Jos√©&lt;br&gt;
</tt>
