<tt>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Style-Type&quot;&nbsp;content=&quot;text/css&quot;&gt;<br>
&lt;title&gt;&lt;/title&gt;<br>
&lt;meta&nbsp;name=&quot;Generator&quot;&nbsp;content=&quot;Cocoa&nbsp;HTML&nbsp;Writer&quot;&gt;<br>
&lt;meta&nbsp;name=&quot;CocoaVersion&quot;&nbsp;content=&quot;1138.47&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&gt;<br>
p.p1&nbsp;{margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;12.0px&nbsp;Helvetica}<br>
p.p2&nbsp;{margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;12.0px&nbsp;Helvetica;&nbsp;min-height:&nbsp;14.0px}<br>
p.p3&nbsp;{margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;11.0px&nbsp;Monaco;&nbsp;color:&nbsp;#f9f9f9}<br>
p.p4&nbsp;{margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;11.0px&nbsp;Monaco;&nbsp;min-height:&nbsp;15.0px}<br>
p.p5&nbsp;{margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;11.0px&nbsp;Monaco;&nbsp;color:&nbsp;#726d73}<br>
p.p6&nbsp;{margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;11.0px&nbsp;Monaco;&nbsp;color:&nbsp;#ac8257}<br>
p.p7&nbsp;{margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;11.0px&nbsp;Monaco;&nbsp;color:&nbsp;#f9f9f9;&nbsp;min-height:&nbsp;15.0px}<br>
p.p8&nbsp;{margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;11.0px&nbsp;Monaco;&nbsp;color:&nbsp;#a0ab82}<br>
p.p9&nbsp;{margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;11.0px&nbsp;Monaco}<br>
p.p10&nbsp;{margin:&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px&nbsp;0.0px;&nbsp;font:&nbsp;11.0px&nbsp;Monaco;&nbsp;color:&nbsp;#d7b583}<br>
span.s1&nbsp;{color:&nbsp;#d7b583}<br>
span.s2&nbsp;{color:&nbsp;#a0ab82}<br>
span.s3&nbsp;{color:&nbsp;#f9f9f9}<br>
span.s4&nbsp;{color:&nbsp;#ac8257}<br>
span.s5&nbsp;{color:&nbsp;#da7e64}<br>
span.s6&nbsp;{text-decoration:&nbsp;underline}<br>
span.s7&nbsp;{color:&nbsp;#726d73}<br>
&lt;/style&gt;<br>
<br>
<br>
&lt;p&nbsp;class=&quot;p1&quot;&gt;I&nbsp;am&nbsp;writing&nbsp;a&nbsp;consumer&nbsp;(and&nbsp;producer)&nbsp;using&nbsp;Pika. &nbsp;I&nbsp;want&nbsp;to&nbsp;write&nbsp;asynchronous&nbsp;code,&nbsp;but&nbsp;I&amp;#39;m&nbsp;having&nbsp;trouble&nbsp;getting&nbsp;everything&nbsp;working. &nbsp;I&nbsp;started&nbsp;with&nbsp;regular&nbsp;I&nbsp;pulled&nbsp;off&nbsp;the&nbsp;Pika&nbsp;docs,&nbsp;then&nbsp;made&nbsp;it&nbsp;work&nbsp;with&nbsp;multiple&nbsp;queues. &nbsp;To&nbsp;get&nbsp;it&nbsp;working&nbsp;with&nbsp;multiple&nbsp;queues&nbsp;I&nbsp;had&nbsp;to&nbsp;add&nbsp;some&nbsp;checks&nbsp;that&nbsp;make&nbsp;sure&nbsp;all&nbsp;the&nbsp;queues&nbsp;are&nbsp;declared&nbsp;and&nbsp;bound&nbsp;before&nbsp;trying&nbsp;to&nbsp;publish&nbsp;any&nbsp;messages. &nbsp;That&nbsp;worked&nbsp;very&nbsp;well.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p2&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p1&quot;&gt;Our&nbsp;code&nbsp;also&nbsp;performs&nbsp;some&nbsp;time&nbsp;consuming&nbsp;logic,&nbsp;and&nbsp;we&nbsp;want&nbsp;our&nbsp;consumer&nbsp;to&nbsp;publish&nbsp;to&nbsp;another&nbsp;queue&nbsp;that&nbsp;will&nbsp;go&nbsp;to&nbsp;some&nbsp;logger. &nbsp;I&nbsp;tried&nbsp;to&nbsp;add&nbsp;this&nbsp;on&nbsp;the&nbsp;same&nbsp;channel&nbsp;that&nbsp;was&nbsp;consuming&nbsp;code,&nbsp;but&nbsp;that&nbsp;did&nbsp;not&nbsp;work. &nbsp;I&nbsp;wasn&amp;#39;t&nbsp;sure&nbsp;if&nbsp;I&nbsp;needed&nbsp;a&nbsp;separate&nbsp;channel,&nbsp;so&nbsp;I&nbsp;tried&nbsp;using&nbsp;2&nbsp;channels&nbsp;on&nbsp;the&nbsp;same&nbsp;connections&nbsp;-&nbsp;1&nbsp;channel&nbsp;to&nbsp;consume,&nbsp;and&nbsp;1&nbsp;channel&nbsp;to&nbsp;produce,&nbsp;but&nbsp;that&nbsp;is&nbsp;not&nbsp;working. &nbsp;I&nbsp;notice&nbsp;when&nbsp;the&nbsp;code&nbsp;is&nbsp;trying&nbsp;to&nbsp;publish&nbsp;the&nbsp;2nd&nbsp;log&nbsp;message&nbsp;that&nbsp;everything&nbsp;seems&nbsp;to&nbsp;stop. &nbsp;Can&nbsp;anyone&nbsp;give&nbsp;me&nbsp;any&nbsp;insight&nbsp;into&nbsp;what&amp;#39;s&nbsp;going&nbsp;on?&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p2&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p1&quot;&gt;Attached&nbsp;are&nbsp;sections&nbsp;of&nbsp;my&nbsp;code:&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p2&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p1&quot;&gt;This&nbsp;code&nbsp;is&nbsp;setup&nbsp;so&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;multiple&nbsp;queue&nbsp;setup&nbsp;is&nbsp;handled&nbsp;without&nbsp;duplicating&nbsp;any&nbsp;code:&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;from&lt;/span&gt;&nbsp;pika&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;import&lt;/span&gt;&nbsp;spec&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;EXCHANGE&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;customers&amp;#39;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;EXCHANGEACK&nbsp;=&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;logs&amp;#39;&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;#keep&nbsp;this&nbsp;seperate&nbsp;for&nbsp;now&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p6&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;class&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;ChannelContainer&lt;span&nbsp;class=&quot;s3&quot;&gt;(object):&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;__init__&lt;/span&gt;(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;channel,&nbsp;exchange,&nbsp;append,&nbsp;queue_list,&nbsp;callback):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel&nbsp;=&nbsp;channel&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.exchange&nbsp;=&nbsp;exchange&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.append_str&nbsp;=&nbsp;append&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.queue_list&nbsp;=&nbsp;queue_list&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.goodQueues&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s5&quot;&gt;0&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channelReady&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;False&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.try_to_continue&nbsp;=&nbsp;callback&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p6&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;exchange_declare&lt;span&nbsp;class=&quot;s3&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;):&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel.exchange_declare(exchange=&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.exchange,&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;type=&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;direct&amp;#39;&lt;/span&gt;,&nbsp;\&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;callback=&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.on_exchange_declare)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Step&nbsp;#4&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p6&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;on_exchange_declare&lt;span&nbsp;class=&quot;s3&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;,&nbsp;frame):&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Called&nbsp;when&nbsp;our&nbsp;exchange&nbsp;has&nbsp;been&nbsp;created&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;for&lt;/span&gt;&nbsp;queue_name&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;in&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.queue_list:&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;full_queue_name&nbsp;=&nbsp;queue_name&nbsp;+&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.append_str&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel.queue_declare(queue=full_queue_name,&nbsp;durable=&lt;span&nbsp;class=&quot;s1&quot;&gt;True&lt;/span&gt;,&nbsp;\&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exclusive=&lt;span&nbsp;class=&quot;s1&quot;&gt;False&lt;/span&gt;,&nbsp;auto_delete=&lt;span&nbsp;class=&quot;s1&quot;&gt;False&lt;/span&gt;,&nbsp;\&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;callback=&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.on_queue_declared)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Step&nbsp;#5&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p6&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;on_queue_declared&lt;span&nbsp;class=&quot;s3&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;,&nbsp;frame):&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Bind&nbsp;the&nbsp;queues&nbsp;to&nbsp;the&nbsp;channel&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;if&lt;/span&gt;&nbsp;type(frame.method)&nbsp;==&nbsp;spec.Queue.DeclareOk:&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Get&nbsp;the&nbsp;queue&nbsp;name&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;queue_name&nbsp;=&nbsp;frame.method.queue&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;print&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.append_str,&nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;binding&amp;quot;&lt;/span&gt;,&nbsp;queue_name&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel.queue_bind(exchange=&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.exchange,&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;queue=queue_name,&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;routing_key=queue_name, &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;callback=&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.on_queue_bound)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Step&nbsp;#6&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;on_queue_bound&lt;/span&gt;(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;frame):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Called&nbsp;when&nbsp;RabbitMQ&nbsp;has&nbsp;told&nbsp;us&nbsp;our&nbsp;Queue&nbsp;has&nbsp;been&nbsp;declared,&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;frame&nbsp;is&nbsp;the&nbsp;response&nbsp;from&nbsp;RabbitMQ&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;print&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;&amp;quot;bound&nbsp;queue&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.goodQueues&nbsp;+=&nbsp;&lt;span&nbsp;class=&quot;s5&quot;&gt;1&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;if&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.goodQueues&nbsp;==&nbsp;len(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.queue_list):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channelReady&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;True&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#tell&nbsp;owner&nbsp;to&nbsp;try&nbsp;to&nbsp;continue&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.try_to_continue()&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;class&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;TxChannel&lt;/span&gt;(ChannelContainer):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;__init__&lt;/span&gt;(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;channel,&nbsp;exchange,&nbsp;append,&nbsp;queue_list,&nbsp;callback):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;ChannelContainer.__init__(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;channel,&nbsp;exchange,&nbsp;append,&nbsp;queue_list,&nbsp;callback)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;acknowledge&lt;/span&gt;(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;queue_name,&nbsp;body):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Send&nbsp;the&nbsp;action&nbsp;and&nbsp;object&nbsp;to&nbsp;the&nbsp;acknowledgement&nbsp;queue.&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;full_queue_name&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;%s--ack&amp;#39;&lt;/span&gt;&nbsp;%&nbsp;queue_name&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;print&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;sending&nbsp;ack&amp;quot;&lt;/span&gt;,&nbsp;full_queue_name&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel.basic_publish(exchange=&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.exchange,&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;routing_key=full_queue_name,&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;body=body)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;class&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;RxChannel&lt;/span&gt;(ChannelContainer):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;__init__&lt;/span&gt;(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;channel,&nbsp;exchange,&nbsp;append,&nbsp;queue_list,&nbsp;callback):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;ChannelContainer.__init__(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;channel,&nbsp;exchange,&nbsp;append,&nbsp;queue_list,&nbsp;callback)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Step&nbsp;#6&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;consume&lt;/span&gt;(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;callback):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Called&nbsp;when&nbsp;RabbitMQ&nbsp;has&nbsp;told&nbsp;us&nbsp;our&nbsp;Queue&nbsp;has&nbsp;been&nbsp;declared,&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;frame&nbsp;is&nbsp;the&nbsp;response&nbsp;from&nbsp;RabbitMQ&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#consume&nbsp;on&nbsp;all&nbsp;queues&nbsp;now&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;for&lt;/span&gt;&nbsp;queue_name&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;in&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.queue_list:&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel.basic_consume(callback,&nbsp;queue=queue_name)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;  &nbsp; &lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p9&quot;&gt;Here&nbsp;is&nbsp;the&nbsp;consumer&nbsp;code.&nbsp; I&nbsp;tried&nbsp;to&nbsp;take&nbsp;out&nbsp;everything&nbsp;irrelevant:&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p10&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;import&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;pika&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;from&lt;/span&gt;&nbsp;pika.adapters&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;import&lt;/span&gt;&nbsp;SelectConnection&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;from&lt;/span&gt;&nbsp;ChannelContainer&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;import&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s6&quot;&gt;RxChannel&lt;/span&gt;,&nbsp;&lt;span&nbsp;class=&quot;s6&quot;&gt;TxChannel&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;EXCHANGE&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;customers&amp;#39;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;EXCHANGEACK&nbsp;=&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;logs&amp;#39;&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;#keep&nbsp;this&nbsp;seperate&nbsp;for&nbsp;now&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p6&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;class&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;RabbitConsumer&lt;span&nbsp;class=&quot;s3&quot;&gt;(object):&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p6&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;__init__&lt;span&nbsp;class=&quot;s3&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;):&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#initialize&nbsp;some&nbsp;variables&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.queue_list&nbsp;=&nbsp;[]&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.goodQueues&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s5&quot;&gt;0&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_rx&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;None&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_tx&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;None&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.connection&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;None&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.parse_config()&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#get&nbsp;the&nbsp;queue_list&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.gather_queue_names()&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;Functions&nbsp;to&nbsp;parse&nbsp;data&nbsp;and&nbsp;load&nbsp;config&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p6&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;parse_config&lt;span&nbsp;class=&quot;s3&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;):&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Parse&nbsp;the&nbsp;variables&nbsp;in&nbsp;the&nbsp;config&nbsp;file&nbsp;into&nbsp;the&nbsp;instance.&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.rabbitmq_host&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p6&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;gather_queue_names&lt;span&nbsp;class=&quot;s3&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;):&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Gather&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;queues.&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#These&nbsp;are&nbsp;just&nbsp;for&nbsp;testing&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.queue_list&nbsp;=&nbsp;[&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;1a&amp;#39;&lt;/span&gt;,&nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;2b&amp;#39;&lt;/span&gt;,&nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;3c-4d-5e-6f-7g&amp;#39;&lt;/span&gt;]&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;Functions&nbsp;to&nbsp;connect&nbsp;to&nbsp;RabbitMQ&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Step&nbsp;#2&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;on_connected&lt;/span&gt;(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;connection):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Called&nbsp;when&nbsp;we&nbsp;are&nbsp;fully&nbsp;connected&nbsp;to&nbsp;RabbitMQ&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Open&nbsp;a&nbsp;channel&nbsp;for&nbsp;tx&nbsp;and&nbsp;rx&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.connection.channel(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.on_channel_open)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.connection.channel(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.on_channel_open)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Step&nbsp;#3&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;on_channel_open&lt;/span&gt;(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;new_channel):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Called&nbsp;when&nbsp;our&nbsp;channel&nbsp;has&nbsp;opened&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;if&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_rx&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;is&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;None&lt;/span&gt;:&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s7&quot;&gt;#rx&nbsp;channel&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_rx&nbsp;=&nbsp;RxChannel(new_channel,&nbsp;EXCHANGE, &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;&amp;#39;&lt;/span&gt;,&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.queue_list,&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.start_listening)&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_rx.exchange_declare()&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;else&lt;/span&gt;:&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_tx&nbsp;=&nbsp;TxChannel(new_channel,&nbsp;EXCHANGEACK, &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;--ack&amp;#39;&lt;/span&gt;,&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.queue_list,&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.start_listening)&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_tx.exchange_declare()&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Step&nbsp;#7&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p6&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;start_listening&lt;span&nbsp;class=&quot;s3&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;):&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;Called&nbsp;when&nbsp;all&nbsp;queues&nbsp;for&nbsp;a&nbsp;channel&nbsp;are&nbsp;declared&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;quot;&amp;quot;&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;print&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;&amp;quot;test_allset&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;if&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_rx.channelReady&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;and&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_tx.channelReady:&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#both&nbsp;channels&nbsp;are&nbsp;ready,&nbsp;try&nbsp;to&nbsp;continue&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_rx.consume(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.handle_consume)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;s4&quot;&gt;handle_consume&lt;/span&gt;(&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;,&nbsp;channel,&nbsp;method,&nbsp;properties,&nbsp;body):&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p8&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;print&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;&amp;quot;received&nbsp;message&amp;quot;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;queue_name&nbsp;=&nbsp;method.routing_key&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Insert&nbsp;some&nbsp;long&nbsp;and&nbsp;complicated&nbsp;code&nbsp;goes&nbsp;here&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;result&nbsp;=&nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;I&nbsp;finished!&amp;#39;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#have&nbsp;the&nbsp;tx&nbsp;channel&nbsp;send&nbsp;an&nbsp;ack&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.channel_tx.acknowledge(queue_name,&nbsp;result)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Step&nbsp;#1&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p6&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;def&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;&nbsp;&lt;/span&gt;start_consumer&lt;span&nbsp;class=&quot;s3&quot;&gt;(&lt;/span&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt;):&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Step&nbsp;#1:&nbsp;Connect&nbsp;to&nbsp;RabbitMQ&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.connection&nbsp;=&nbsp;SelectConnection(pika.ConnectionParameters(\&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;host=&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.rabbitmq_host),&nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.on_connected)&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p7&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;  &nbsp; &nbsp; &nbsp; &lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;try&lt;/span&gt;:&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Loop&nbsp;so&nbsp;we&nbsp;can&nbsp;communicate&nbsp;with&nbsp;RabbitMQ&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.connection.ioloop.start()&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;except&lt;/span&gt;&nbsp;KeyboardInterrupt:&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Gracefully&nbsp;close&nbsp;the&nbsp;connection&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.connection.close()&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p5&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s3&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;Loop&nbsp;until&nbsp;we&amp;#39;re&nbsp;fully&nbsp;closed,&nbsp;will&nbsp;stop&nbsp;on&nbsp;its&nbsp;own&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&nbsp;class=&quot;s1&quot;&gt;self&lt;/span&gt;.connection.ioloop.start()&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p4&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;class=&quot;s1&quot;&gt;if&lt;/span&gt;&nbsp;__name__&nbsp;==&nbsp;&lt;span&nbsp;class=&quot;s2&quot;&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;:&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;consumer&nbsp;=&nbsp;RabbitConsumer()&lt;/font&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;p3&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#000000&quot;&gt; &nbsp; &nbsp;consumer.start_consumer()&lt;/font&gt;&lt;/p&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:Helvetica,Arial,sans-serif;font-size:14px;line-height:16px&quot;&gt;Charles&nbsp;Law&lt;/span&gt;&lt;div&gt;<br>
Watch&nbsp;how&nbsp;we&nbsp;make&nbsp;online&nbsp;advertising&nbsp;simple: &lt;a&nbsp;href=&quot;http://bit.ly/Ent_vid&quot;&nbsp;style=&quot;color:rgb(0,114,188);text-decoration:none&quot;&nbsp;target=&quot;_blank&quot;&gt;http://bit.ly/Ent_vid&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://www.openx.org/&quot;&nbsp;style=&quot;color:rgb(0,114,188);text-decoration:none&quot;&nbsp;target=&quot;_blank&quot;&gt;www.openx.com&lt;/a&gt;   |   follow&nbsp;us&nbsp;on:   &lt;a&nbsp;href=&quot;http://twitter.com/openx&quot;&nbsp;style=&quot;color:rgb(0,114,188);text-decoration:none&quot;&nbsp;target=&quot;_blank&quot;&gt;Twitter&lt;/a&gt;   &lt;a&nbsp;href=&quot;http://www.facebook.com/OpenX&quot;&nbsp;style=&quot;color:rgb(0,114,188);text-decoration:none&quot;&nbsp;target=&quot;_blank&quot;&gt;Facebook&lt;/a&gt;    &lt;a&nbsp;href=&quot;http://www.linkedin.com/company/openx/products&quot;&nbsp;style=&quot;color:rgb(0,114,188);text-decoration:none&quot;&nbsp;target=&quot;_blank&quot;&gt;LinkedIn&lt;/a&gt;<br>
&lt;/div&gt;&lt;br&gt;<br>

</tt>
