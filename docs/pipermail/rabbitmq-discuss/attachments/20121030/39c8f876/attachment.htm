<tt>
&lt;br&gt;&lt;div&gt;Hi&nbsp;Simon,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;sorry&nbsp;that&nbsp;my&nbsp;post&nbsp;appears&nbsp;all&nbsp;over&nbsp;the&nbsp;place.&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;work&nbsp;out&nbsp;a&nbsp;clear&nbsp;understanding&nbsp;of&nbsp;a&nbsp;cluster&nbsp;to&nbsp;advise&nbsp;what&nbsp;not&nbsp;do&nbsp;do&nbsp;to&nbsp;avoid&nbsp;data&nbsp;loss.&nbsp;It&nbsp;is&nbsp;becoming&nbsp;clear&nbsp;that&nbsp;server&nbsp;maintenance&nbsp;must&nbsp;account&nbsp;for&nbsp;the&nbsp;status&nbsp;of&nbsp;the&nbsp;queues&nbsp;in&nbsp;the&nbsp;cluster&nbsp;and&nbsp;great&nbsp;care&nbsp;must&nbsp;be&nbsp;applied&nbsp;to&nbsp;maintain&nbsp;the&nbsp;cluster.&nbsp;I&nbsp;have&nbsp;read&nbsp;the&nbsp;unsynchronised-saves&nbsp;section&nbsp;and&nbsp;basically&nbsp;the&nbsp;cluster&nbsp;buster&nbsp;testing&nbsp;is&nbsp;to&amp;nbsp;purposely&amp;nbsp;break&nbsp;the&nbsp;cluster&nbsp;in&nbsp;the&nbsp;way&nbsp;that&nbsp;the&nbsp;queue&amp;nbsp;synchronization&amp;nbsp;is&nbsp;documented&nbsp;to&nbsp;not&nbsp;handle.&nbsp;By&nbsp;doing&nbsp;this&nbsp;I&nbsp;am&nbsp;learning&nbsp;in&nbsp;more&nbsp;detail&nbsp;about&nbsp;how&nbsp;the&nbsp;cluster&nbsp;actually&nbsp;works.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After&nbsp;looking&nbsp;at&nbsp;the&nbsp;section&nbsp;again&nbsp;this&nbsp;statement&nbsp;stands&nbsp;out&nbsp;&quot;...&nbsp;ensure&nbsp;that&nbsp;your&nbsp;use&nbsp;of&nbsp;messaging&nbsp;generally&nbsp;results&nbsp;in&nbsp;very&nbsp;short&nbsp;or&nbsp;empty&nbsp;queues&nbsp;that&nbsp;rapidly&nbsp;drain.&quot;&nbsp;&amp;nbsp;When&nbsp;dealing&nbsp;with&nbsp;the&nbsp;cluster&nbsp;buster&nbsp;test&nbsp;scenarios&nbsp;I&nbsp;have&nbsp;been&nbsp;using&nbsp;a&nbsp;scenario&nbsp;that&nbsp;a&nbsp;queue&nbsp;is&nbsp;not&nbsp;empty&nbsp;and&nbsp;is&nbsp;not&nbsp;rapidly&nbsp;drained.&nbsp;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;has&nbsp;us&nbsp;nervous&nbsp;that&nbsp;if&nbsp;each&nbsp;node&nbsp;in&nbsp;the&nbsp;cluster&nbsp;is&nbsp;restarted&nbsp;one&nbsp;at&nbsp;a&nbsp;time&nbsp;and&nbsp;allowed&nbsp;to&nbsp;rejoin&nbsp;the&nbsp;cluster&nbsp;then&nbsp;all&nbsp;data&nbsp;in&nbsp;the&nbsp;idle&nbsp;persistent&nbsp;queues&nbsp;would&nbsp;be&nbsp;lost.&nbsp;Performing&nbsp;Windows&nbsp;updates&nbsp;might&nbsp;be&nbsp;fatal&nbsp;to&nbsp;idle&nbsp;queued&nbsp;data!&nbsp;&amp;nbsp;To&nbsp;clarify&nbsp;the&nbsp;messages&nbsp;are&nbsp;published&nbsp;with&amp;nbsp;persistent&amp;nbsp;on.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Back&nbsp;to&nbsp;the&nbsp;cluster&nbsp;test&nbsp;scenario....&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;guess&nbsp;the&nbsp;conclusion&nbsp;is&nbsp;the&nbsp;cluster&nbsp;performed&nbsp;as&amp;nbsp;designed&amp;nbsp;and&nbsp;it&nbsp;did&nbsp;require&nbsp;all&nbsp;nodes&nbsp;in&nbsp;the&nbsp;cluster&nbsp;to&nbsp;be&nbsp;started&nbsp;under&nbsp;the&nbsp;30&nbsp;second&nbsp;timeout.&nbsp;&amp;nbsp;Although,&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;if&nbsp;the&nbsp;erl_crash.dump&nbsp;is&nbsp;expected.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;all&nbsp;3&nbsp;servers&nbsp;were&nbsp;booted&nbsp;things&nbsp;went&nbsp;as&nbsp;expected&nbsp;but&nbsp;with&nbsp;an&nbsp;erl_crash.dump.&nbsp;&amp;nbsp;Each&nbsp;server&nbsp;performed&nbsp;the&nbsp;30&nbsp;second&nbsp;search&nbsp;and&nbsp;then&nbsp;shutdown&nbsp;+&nbsp;crash.dump.&nbsp;&amp;nbsp;After&nbsp;I&nbsp;noticed&nbsp;all&nbsp;3&nbsp;services&nbsp;were&nbsp;not&nbsp;running&nbsp;I&nbsp;quickly&nbsp;started&nbsp;each&nbsp;service&nbsp;under&nbsp;the&nbsp;30&nbsp;seconds&nbsp;and&nbsp;the&nbsp;cluster&nbsp;came&nbsp;up&nbsp;plus&nbsp;no&nbsp;queue&nbsp;data&nbsp;was&nbsp;lost.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Each&nbsp;server&nbsp;had&nbsp;its&nbsp;relative&nbsp;log&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;=INFO&nbsp;REPORT====&nbsp;30-Oct-2012::08:36:36&nbsp;===&lt;/div&gt;&lt;div&gt;Limiting&nbsp;to&nbsp;approx&nbsp;924&nbsp;file&nbsp;handles&nbsp;(829&nbsp;sockets)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;=ERROR&nbsp;REPORT====&nbsp;30-Oct-2012::08:37:13&nbsp;===&lt;/div&gt;&lt;div&gt;Timeout&nbsp;contacting&nbsp;cluster&nbsp;nodes.&nbsp;Since&nbsp;RabbitMQ&nbsp;was&nbsp;shut&nbsp;down&nbsp;forcefully&lt;/div&gt;&lt;div&gt;it&nbsp;cannot&nbsp;determine&nbsp;which&nbsp;nodes&nbsp;are&nbsp;timing&nbsp;out.&nbsp;Details&nbsp;on&nbsp;all&nbsp;nodes&nbsp;will&lt;/div&gt;&lt;div&gt;follow.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;DIAGNOSTICS&lt;/div&gt;&lt;div&gt;===========&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;nodes&nbsp;in&nbsp;question:&nbsp;['rabbit@RIOBARON-1','rabbit@CUST1-MASTER']&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;hosts,&nbsp;their&nbsp;running&nbsp;nodes&nbsp;and&nbsp;ports:&lt;/div&gt;&lt;div&gt;-&nbsp;CUST1-MASTER:&nbsp;[{rabbit,55021}]&lt;/div&gt;&lt;div&gt;-&nbsp;RIOBARON-1:&nbsp;[]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;current&nbsp;node&nbsp;details:&lt;/div&gt;&lt;div&gt;-&nbsp;node&nbsp;name:&nbsp;'rabbit@RIOOVERLORD-1'&lt;/div&gt;&lt;div&gt;-&nbsp;home&nbsp;dir:&nbsp;C:\Windows&lt;/div&gt;&lt;div&gt;-&nbsp;cookie&nbsp;hash:&nbsp;MXZdkdzg76BGNNu+ev94Ow==&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;=INFO&nbsp;REPORT====&nbsp;30-Oct-2012::08:37:14&nbsp;===&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;application:&nbsp;rabbit&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;exited:&nbsp;{bad_return,{{rabbit,start,[normal,[]]},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;{'EXIT',{rabbit,failure_during_boot}}}}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;type:&nbsp;permanent&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Then,&nbsp;in&nbsp;the&nbsp;-sasl.log&nbsp;there&nbsp;is&nbsp;the&nbsp;following&nbsp;entry&nbsp;+&nbsp;the&nbsp;&quot;erl_crash.dump&quot;&nbsp;file.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;=CRASH&nbsp;REPORT====&nbsp;30-Oct-2012::08:35:40&nbsp;===&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;crasher:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;initial&nbsp;call:&nbsp;application_master:init/4&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;pid:&nbsp;&amp;lt;0.133.0&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;registered_name:&nbsp;[]&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;exception&nbsp;exit:&nbsp;{bad_return,{{rabbit,start,[normal,[]]},&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;{'EXIT',{rabbit,failure_during_boot}}}}&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;in&nbsp;function&nbsp;&amp;nbsp;application_master:init/4&nbsp;(application_master.erl,&nbsp;line&nbsp;138)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;ancestors:&nbsp;[&amp;lt;0.132.0&amp;gt;]&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;messages:&nbsp;[{'EXIT',&amp;lt;0.134.0&amp;gt;,normal}]&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;links:&nbsp;[&amp;lt;0.132.0&amp;gt;,&amp;lt;0.7.0&amp;gt;]&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;dictionary:&nbsp;[]&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;trap_exit:&nbsp;true&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;status:&nbsp;running&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;heap_size:&nbsp;1597&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;stack_size:&nbsp;24&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;reductions:&nbsp;132&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;neighbours:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;do&nbsp;not&nbsp;know&nbsp;if&nbsp;the&nbsp;sasl.log&nbsp;entry&nbsp;has&nbsp;anything&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;crash.dump&nbsp;file&nbsp;output&nbsp;but&nbsp;I&nbsp;have&nbsp;one.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;=erl_crash_dump:0.1&lt;/div&gt;&lt;div&gt;Tue&nbsp;Oct&nbsp;30&nbsp;08:37:17&nbsp;2012&lt;/div&gt;&lt;div&gt;Slogan:&nbsp;Kernel&nbsp;pid&nbsp;terminated&nbsp;(application_controller)&nbsp;({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})&lt;/div&gt;&lt;div&gt;System&nbsp;version:&nbsp;Erlang&nbsp;R15B02&nbsp;(erts-5.9.2)&nbsp;[async-threads:30]&lt;/div&gt;&lt;div&gt;Compiled:&nbsp;Mon&nbsp;Sep&nbsp;&amp;nbsp;3&nbsp;11:00:33&nbsp;2012&lt;/div&gt;&lt;div&gt;Taints:&amp;nbsp;&lt;/div&gt;&lt;div&gt;Atoms:&nbsp;21679&lt;/div&gt;&lt;div&gt;=memory&lt;/div&gt;&lt;div&gt;total:&nbsp;16514240&lt;/div&gt;&lt;div&gt;processes:&nbsp;4423098&lt;/div&gt;&lt;div&gt;processes_used:&nbsp;4423098&lt;/div&gt;&lt;div&gt;system:&nbsp;12091142&lt;/div&gt;&lt;div&gt;atom:&nbsp;495069&lt;/div&gt;&lt;div&gt;atom_used:&nbsp;481297&lt;/div&gt;&lt;div&gt;binary:&nbsp;21864&lt;/div&gt;&lt;div&gt;code:&nbsp;9403948&lt;/div&gt;&lt;div&gt;ets:&nbsp;27188&lt;/div&gt;&lt;div&gt;=hash_table:atom_tab&lt;/div&gt;&lt;div&gt;size:&nbsp;19289&lt;/div&gt;&lt;div&gt;used:&nbsp;13066&lt;/div&gt;&lt;div&gt;objs:&nbsp;21679&lt;/div&gt;&lt;div&gt;depth:&nbsp;8&lt;/div&gt;&lt;div&gt;............................&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;Tue,&nbsp;Oct&nbsp;30,&nbsp;2012&nbsp;at&nbsp;11:49&nbsp;AM,&nbsp;Simon&nbsp;MacMullen&nbsp;&amp;lt;simon@rabbitmq.com&amp;gt;&nbsp;wrote:&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;quite&nbsp;what&nbsp;you&nbsp;are&nbsp;saying.&nbsp;You&nbsp;say&nbsp;that&nbsp;when&nbsp;you&nbsp;started&nbsp;the&nbsp;nodes&nbsp;again,&nbsp;none&nbsp;of&nbsp;them&nbsp;successfully&nbsp;started?&nbsp;And&nbsp;there&nbsp;was&nbsp;&quot;an&nbsp;error&quot;.&nbsp;But&nbsp;then&nbsp;you&nbsp;started&nbsp;them&nbsp;&quot;quickly&quot;&nbsp;and&nbsp;that&nbsp;worked?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;each&nbsp;node&nbsp;is&nbsp;started&nbsp;it&nbsp;decides&nbsp;whether&nbsp;it&nbsp;thinks&nbsp;there&nbsp;are&nbsp;any&nbsp;other&nbsp;nodes&nbsp;which&nbsp;were&nbsp;running&nbsp;when&nbsp;it&nbsp;was&nbsp;killed.&nbsp;If&nbsp;so&nbsp;it&nbsp;waits&nbsp;30&nbsp;seconds&nbsp;for&nbsp;them&nbsp;to&nbsp;become&nbsp;available&nbsp;and&nbsp;if&nbsp;nothing&nbsp;appears&nbsp;gives&nbsp;an&nbsp;error&nbsp;about&nbsp;&quot;timeout&nbsp;waiting&nbsp;for&nbsp;tables&quot;,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Was&nbsp;this&nbsp;the&nbsp;error&nbsp;you&nbsp;saw?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;might&nbsp;make&nbsp;this&nbsp;30&nbsp;seconds&nbsp;configurable&nbsp;in&nbsp;future,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;think&nbsp;of&nbsp;the&nbsp;other&nbsp;case&nbsp;(where&nbsp;people&nbsp;start&nbsp;one&nbsp;node&nbsp;and&nbsp;not&nbsp;the&nbsp;other,&nbsp;and&nbsp;don't&nbsp;realise&nbsp;anything&nbsp;is&nbsp;wrong&nbsp;until&nbsp;the&nbsp;timeout).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;should&nbsp;also&nbsp;read:&lt;/div&gt;&lt;div&gt;http://www.rabbitmq.com/ha.html#unsynchronised-slaves&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&nbsp;Simon&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;Tuesday,&nbsp;October&nbsp;30,&nbsp;2012&nbsp;9:45:21&nbsp;AM&nbsp;UTC-5,&nbsp;Mark&nbsp;Ward&nbsp;wrote:&lt;/div&gt;
</tt>
