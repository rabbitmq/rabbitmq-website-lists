<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Fri,&nbsp;Sep&nbsp;17,&nbsp;2010&nbsp;at&nbsp;4:13&nbsp;PM,&nbsp;Vlad&nbsp;Alexandru&nbsp;Ionescu&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:vlad@rabbitmq.com&quot;&gt;vlad@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
<br>
<br>
<br>
&nbsp;&nbsp;<br>
<br>
&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&lt;br&gt;<br>
Michael,&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;I&nbsp;understand&nbsp;that&nbsp;it&nbsp;is&nbsp;the&nbsp;consumer&amp;#39;s&nbsp;connection&nbsp;that&nbsp;was&nbsp;hanging<br>
in&nbsp;there.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;tried&nbsp;to&nbsp;reproduce&nbsp;your&nbsp;problem&nbsp;yesterday&nbsp;(killing&nbsp;off&nbsp;both&nbsp;consumer<br>
and&nbsp;producer&nbsp;apps),&nbsp;with&nbsp;no&nbsp;success.&lt;br&gt;<br>
What&nbsp;version&nbsp;of&nbsp;Java&nbsp;are&nbsp;you&nbsp;using?&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;We&amp;#39;re&nbsp;using&nbsp;Java&nbsp;1.6.0_15.&nbsp;Our&nbsp;consumers&nbsp;are&nbsp;running&nbsp;on&nbsp;OS&nbsp;X&nbsp;10.6.2&lt;br&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&lt;br&gt;<br>
By&nbsp;not&nbsp;having&nbsp;been&nbsp;shutdown&nbsp;cleanly...&nbsp;could&nbsp;it&nbsp;be&nbsp;possible,&nbsp;in&nbsp;your<br>
case,&nbsp;that&nbsp;the&nbsp;client&nbsp;has&nbsp;been&nbsp;disconnected&nbsp;from&nbsp;the&nbsp;network&nbsp;abruptly,<br>
in&nbsp;some&nbsp;way?&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Dont&nbsp;think&nbsp;so&nbsp;-&nbsp;the&nbsp;main&nbsp;cause&nbsp;of&nbsp;the&nbsp;app&nbsp;not&nbsp;shutting&nbsp;cleanly&nbsp;is&nbsp;a&nbsp;deployment&nbsp;script&nbsp;we&nbsp;have&nbsp;for&nbsp;our&nbsp;dev&nbsp;environments&nbsp;which&nbsp;kills&nbsp;our&nbsp;JVM&nbsp;if&nbsp;it&nbsp;doesnt&nbsp;shutdown&nbsp;within&nbsp;a&nbsp;specified&nbsp;time&nbsp;period&nbsp;(because&nbsp;we&nbsp;are&nbsp;running&nbsp;in&nbsp;a&nbsp;web&nbsp;container&nbsp;with&nbsp;multiple&nbsp;web&nbsp;apps&nbsp;sometimes&nbsp;it&nbsp;can&nbsp;take&nbsp;a&nbsp;couple&nbsp;of&nbsp;seconds&nbsp;to&nbsp;successfully&nbsp;shutdown).&nbsp;Also&nbsp;it&nbsp;may&nbsp;be&nbsp;worth&nbsp;mentioning&nbsp;that&nbsp;our&nbsp;consumer&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;network&nbsp;to&nbsp;the&nbsp;RabbitMQ&nbsp;broker&nbsp;-&nbsp;the&nbsp;broker&nbsp;is&nbsp;running&nbsp;at&nbsp;amazon&nbsp;on&nbsp;an&nbsp;EC2&nbsp;instance,&nbsp;while&nbsp;the&nbsp;consumer&nbsp;runs&nbsp;on&nbsp;our&nbsp;internal&nbsp;network.&lt;br&gt;<br>
 &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&lt;br&gt;<br>
The&nbsp;only&nbsp;situation&nbsp;I&nbsp;can&nbsp;think&nbsp;of&nbsp;when&nbsp;you&nbsp;can&nbsp;have&nbsp;stray&nbsp;connections<br>
(and&nbsp;would&nbsp;not&nbsp;be&nbsp;a&nbsp;bug)&nbsp;would&nbsp;be&nbsp;the&nbsp;case&nbsp;when&nbsp;the&nbsp;socket&nbsp;has&nbsp;been<br>
broken&nbsp;in&nbsp;some&nbsp;way&nbsp;without&nbsp;doing&nbsp;a&nbsp;TCP&nbsp;FIN.&nbsp;If&nbsp;the&nbsp;app&nbsp;is&nbsp;killed,&nbsp;the<br>
underlying&nbsp;OS&nbsp;takes&nbsp;care&nbsp;of&nbsp;closing&nbsp;all&nbsp;its&nbsp;FDs,&nbsp;including&nbsp;all&nbsp;sockets<br>
that&nbsp;were&nbsp;held&nbsp;by&nbsp;the&nbsp;app&nbsp;-&nbsp;so&nbsp;that&nbsp;shouldn&amp;#39;t&nbsp;cause&nbsp;stray&nbsp;connections.<br>
But,&nbsp;for&nbsp;example,&nbsp;if&nbsp;the&nbsp;client&nbsp;machine&nbsp;is&nbsp;physically&nbsp;disconnected&nbsp;from<br>
the&nbsp;network,&nbsp;the&nbsp;broker&nbsp;has&nbsp;no&nbsp;way&nbsp;of&nbsp;knowing&nbsp;that&nbsp;and&nbsp;expects&nbsp;the<br>
client&nbsp;to&nbsp;continue&nbsp;consuming&nbsp;(but&nbsp;it&nbsp;doesn&amp;#39;t).&nbsp;Until&nbsp;the&nbsp;TCP&nbsp;socket<br>
times&nbsp;out&nbsp;(could&nbsp;take&nbsp;15&nbsp;mins),&nbsp;the&nbsp;message&nbsp;would&nbsp;remain&nbsp;blocked&nbsp;in&nbsp;the<br>
queue,&nbsp;as&nbsp;it&nbsp;is&nbsp;reserved&nbsp;for&nbsp;the&nbsp;disconnected&nbsp;client&nbsp;(which&nbsp;didn&amp;#39;t<br>
receive&nbsp;the&nbsp;message&nbsp;entirely&nbsp;and/or&nbsp;didn&amp;#39;t&nbsp;get&nbsp;to&nbsp;ack).&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Yes&nbsp;this&nbsp;make&nbsp;sense&nbsp;-&nbsp;if&nbsp;I&nbsp;see&nbsp;it&nbsp;happening&nbsp;again&nbsp;I&amp;#39;ll&nbsp;try&nbsp;and&nbsp;wait&nbsp;to&nbsp;see&nbsp;if&nbsp;the&nbsp;connection&nbsp;eventually&nbsp;times&nbsp;out.&lt;br&gt;&lt;br&gt;Thanks&lt;br&gt;<br>
Michael&lt;br&gt;&lt;br&gt;&lt;br&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Rgds,&lt;br&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
Vlad.&lt;/font&gt;&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;09/17/2010&nbsp;03:56&nbsp;PM,&nbsp;Michael&nbsp;Burns&nbsp;wrote:<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Hi,&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Just&nbsp;to&nbsp;add&nbsp;that&nbsp;I&nbsp;experienced&nbsp;the&nbsp;delay&nbsp;problem&nbsp;again&nbsp;-&nbsp;this&nbsp;time&nbsp;I<br>
checked&nbsp;the&nbsp;number&nbsp;of&nbsp;connections&nbsp;that&nbsp;were&nbsp;open&nbsp;and&nbsp;saw&nbsp;a&nbsp;stray<br>
connection&nbsp;was&nbsp;still&nbsp;hanging&nbsp;about.&nbsp;Upon&nbsp;manually&nbsp;killing&nbsp;this<br>
connection&nbsp;my&nbsp;message&nbsp;then&nbsp;came&nbsp;through.&lt;br&gt;<br>
Any&nbsp;thoughts?&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
(Again&nbsp;just&nbsp;to&nbsp;add&nbsp;that&nbsp;I&amp;#39;m&nbsp;not&nbsp;100%&nbsp;sure&nbsp;our&nbsp;consumer&nbsp;app&nbsp;shutdown<br>
cleanly,&nbsp;it&nbsp;may&nbsp;have&nbsp;been&nbsp;killed&nbsp;before&nbsp;the&nbsp;connection&nbsp;could&nbsp;be&nbsp;closed<br>
our&nbsp;side)&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
Michael&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;16,&nbsp;2010&nbsp;at&nbsp;1:39&nbsp;PM,&nbsp;Michael<br>
Burns&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:michaelburns1@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;michaelburns1@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;<br>
wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Hi<br>
Vlad,&lt;br&gt;<br>
We&amp;#39;re&nbsp;using&nbsp;the&nbsp;Java&nbsp;client&nbsp;1.8.1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;font&nbsp;color=&quot;#888888&quot;&gt;Michael&lt;/font&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;16,&nbsp;2010&nbsp;at&nbsp;1:37&nbsp;PM,&nbsp;Vlad<br>
Alexandru&nbsp;Ionescu&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:vlad@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;vlad@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;<br>
wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
I&amp;#39;ve&nbsp;noticed&nbsp;sometimes&nbsp;that&nbsp;there&nbsp;are&nbsp;extra&nbsp;connections&nbsp;hanging&nbsp;about<br>
on&nbsp;the&nbsp;RabbitMQ&nbsp;broker&nbsp;(using&nbsp;rabbitmqctl&nbsp; list_connections).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
Michael,&nbsp;can&nbsp;you&nbsp;tell&nbsp;us&nbsp;which&nbsp;client(s)&nbsp;are&nbsp;you&nbsp;using?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;font&nbsp;color=&quot;#888888&quot;&gt;Vlad.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
