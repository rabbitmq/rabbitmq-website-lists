<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&lt;br&gt;<br>
Michael,&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;I&nbsp;understand&nbsp;that&nbsp;it&nbsp;is&nbsp;the&nbsp;consumer's&nbsp;connection&nbsp;that&nbsp;was&nbsp;hanging<br>
in&nbsp;there.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;tried&nbsp;to&nbsp;reproduce&nbsp;your&nbsp;problem&nbsp;yesterday&nbsp;(killing&nbsp;off&nbsp;both&nbsp;consumer<br>
and&nbsp;producer&nbsp;apps),&nbsp;with&nbsp;no&nbsp;success.&lt;br&gt;<br>
What&nbsp;version&nbsp;of&nbsp;Java&nbsp;are&nbsp;you&nbsp;using?&lt;br&gt;<br>
&lt;br&gt;<br>
By&nbsp;not&nbsp;having&nbsp;been&nbsp;shutdown&nbsp;cleanly...&nbsp;could&nbsp;it&nbsp;be&nbsp;possible,&nbsp;in&nbsp;your<br>
case,&nbsp;that&nbsp;the&nbsp;client&nbsp;has&nbsp;been&nbsp;disconnected&nbsp;from&nbsp;the&nbsp;network&nbsp;abruptly,<br>
in&nbsp;some&nbsp;way?&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;only&nbsp;situation&nbsp;I&nbsp;can&nbsp;think&nbsp;of&nbsp;when&nbsp;you&nbsp;can&nbsp;have&nbsp;stray&nbsp;connections<br>
(and&nbsp;would&nbsp;not&nbsp;be&nbsp;a&nbsp;bug)&nbsp;would&nbsp;be&nbsp;the&nbsp;case&nbsp;when&nbsp;the&nbsp;socket&nbsp;has&nbsp;been<br>
broken&nbsp;in&nbsp;some&nbsp;way&nbsp;without&nbsp;doing&nbsp;a&nbsp;TCP&nbsp;FIN.&nbsp;If&nbsp;the&nbsp;app&nbsp;is&nbsp;killed,&nbsp;the<br>
underlying&nbsp;OS&nbsp;takes&nbsp;care&nbsp;of&nbsp;closing&nbsp;all&nbsp;its&nbsp;FDs,&nbsp;including&nbsp;all&nbsp;sockets<br>
that&nbsp;were&nbsp;held&nbsp;by&nbsp;the&nbsp;app&nbsp;-&nbsp;so&nbsp;that&nbsp;shouldn't&nbsp;cause&nbsp;stray&nbsp;connections.<br>
But,&nbsp;for&nbsp;example,&nbsp;if&nbsp;the&nbsp;client&nbsp;machine&nbsp;is&nbsp;physically&nbsp;disconnected&nbsp;from<br>
the&nbsp;network,&nbsp;the&nbsp;broker&nbsp;has&nbsp;no&nbsp;way&nbsp;of&nbsp;knowing&nbsp;that&nbsp;and&nbsp;expects&nbsp;the<br>
client&nbsp;to&nbsp;continue&nbsp;consuming&nbsp;(but&nbsp;it&nbsp;doesn't).&nbsp;Until&nbsp;the&nbsp;TCP&nbsp;socket<br>
times&nbsp;out&nbsp;(could&nbsp;take&nbsp;15&nbsp;mins),&nbsp;the&nbsp;message&nbsp;would&nbsp;remain&nbsp;blocked&nbsp;in&nbsp;the<br>
queue,&nbsp;as&nbsp;it&nbsp;is&nbsp;reserved&nbsp;for&nbsp;the&nbsp;disconnected&nbsp;client&nbsp;(which&nbsp;didn't<br>
receive&nbsp;the&nbsp;message&nbsp;entirely&nbsp;and/or&nbsp;didn't&nbsp;get&nbsp;to&nbsp;ack).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Rgds,&lt;br&gt;<br>
Vlad.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;09/17/2010&nbsp;03:56&nbsp;PM,&nbsp;Michael&nbsp;Burns&nbsp;wrote:<br>
&lt;blockquote<br>
&nbsp;cite=&quot;mid:AANLkTinC_Yf7K1TB_67dxXRGnsMH-3MQk9LMP_3_CGoN@mail.gmail.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;Hi,&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Just&nbsp;to&nbsp;add&nbsp;that&nbsp;I&nbsp;experienced&nbsp;the&nbsp;delay&nbsp;problem&nbsp;again&nbsp;-&nbsp;this&nbsp;time&nbsp;I<br>
checked&nbsp;the&nbsp;number&nbsp;of&nbsp;connections&nbsp;that&nbsp;were&nbsp;open&nbsp;and&nbsp;saw&nbsp;a&nbsp;stray<br>
connection&nbsp;was&nbsp;still&nbsp;hanging&nbsp;about.&nbsp;Upon&nbsp;manually&nbsp;killing&nbsp;this<br>
connection&nbsp;my&nbsp;message&nbsp;then&nbsp;came&nbsp;through.&lt;br&gt;<br>
Any&nbsp;thoughts?&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
(Again&nbsp;just&nbsp;to&nbsp;add&nbsp;that&nbsp;I'm&nbsp;not&nbsp;100%&nbsp;sure&nbsp;our&nbsp;consumer&nbsp;app&nbsp;shutdown<br>
cleanly,&nbsp;it&nbsp;may&nbsp;have&nbsp;been&nbsp;killed&nbsp;before&nbsp;the&nbsp;connection&nbsp;could&nbsp;be&nbsp;closed<br>
our&nbsp;side)&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
Michael&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;16,&nbsp;2010&nbsp;at&nbsp;1:39&nbsp;PM,&nbsp;Michael<br>
Burns&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;href=&quot;mailto:michaelburns1@gmail.com&quot;&gt;michaelburns1@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;<br>
wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;<br>
&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Hi<br>
Vlad,&lt;br&gt;<br>
We're&nbsp;using&nbsp;the&nbsp;Java&nbsp;client&nbsp;1.8.1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;font&nbsp;color=&quot;#888888&quot;&gt;Michael&lt;/font&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;16,&nbsp;2010&nbsp;at&nbsp;1:37&nbsp;PM,&nbsp;Vlad<br>
Alexandru&nbsp;Ionescu&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;moz-do-not-send=&quot;true&quot;<br>
&nbsp;href=&quot;mailto:vlad@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;vlad@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;<br>
wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;<br>
&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;<br>
&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
I've&nbsp;noticed&nbsp;sometimes&nbsp;that&nbsp;there&nbsp;are&nbsp;extra&nbsp;connections&nbsp;hanging&nbsp;about<br>
on&nbsp;the&nbsp;RabbitMQ&nbsp;broker&nbsp;(using&nbsp;rabbitmqctl&nbsp;Â list_connections).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
Michael,&nbsp;can&nbsp;you&nbsp;tell&nbsp;us&nbsp;which&nbsp;client(s)&nbsp;are&nbsp;you&nbsp;using?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;font&nbsp;color=&quot;#888888&quot;&gt;Vlad.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
