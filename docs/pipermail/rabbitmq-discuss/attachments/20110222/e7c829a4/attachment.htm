<tt>
Hi&nbsp;Matthias,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;you&nbsp;help,&nbsp;that&amp;#39;s&nbsp;cleared&nbsp;a&nbsp;few&nbsp;things&nbsp;up&nbsp;for&nbsp;me. &nbsp;I&nbsp;had&nbsp;mistakenly&nbsp;assumed&nbsp;that&nbsp;sending&nbsp;basic.cancel&nbsp;meant&nbsp;you&nbsp;couldn&amp;#39;t&nbsp;ack&nbsp;or&nbsp;reject&nbsp;messages&nbsp;after&nbsp;sending&nbsp;the&nbsp;cancel.&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;--Robin&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sun,&nbsp;Feb&nbsp;20,&nbsp;2011&nbsp;at&nbsp;6:44&nbsp;PM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Robin,&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Robin&nbsp;Harvey&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
What&nbsp;is&nbsp;the&nbsp;recommended&nbsp;course&nbsp;of&nbsp;action&nbsp;for&nbsp;dealing&nbsp;with&nbsp;unwanted&nbsp;messages&nbsp;in&nbsp;consumers?&nbsp; If&nbsp;a&nbsp;consumer&nbsp;sends&nbsp;basic.cancel&nbsp;there&amp;#39;s&nbsp;a&nbsp;possibility&nbsp;that&nbsp;there&nbsp;will&nbsp;be&nbsp;one&nbsp;or&nbsp;more&nbsp;&amp;quot;undelivered&amp;quot;&nbsp;messages&nbsp;(depending&nbsp;on&nbsp;the&nbsp;prefetch-count&nbsp;parameters),&nbsp;is&nbsp;it&nbsp;best&nbsp;to&nbsp;basic.reject&nbsp;these&nbsp;before&nbsp;or&nbsp;after&nbsp;sending&nbsp;basic.cancel?&lt;br&gt;<br>
<br>
<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
You&nbsp;could&nbsp;get&nbsp;the&nbsp;client&nbsp;send&nbsp;a&nbsp;basic.cancel&nbsp;and&nbsp;then&nbsp;basic.reject&nbsp;all&nbsp;messages&nbsp;received&nbsp;already&nbsp;and&nbsp;until&nbsp;the&nbsp;basic.cancel-ok&nbsp;arrives.&lt;br&gt;<br>
&lt;br&gt;<br>
However,&nbsp;since&nbsp;you&nbsp;mention&nbsp;&amp;quot;unwanted&amp;quot;&nbsp;messages,&nbsp;why&nbsp;would&nbsp;you&nbsp;cancel&nbsp;the&nbsp;consumer?&nbsp;Wouldn&amp;#39;t&nbsp;you&nbsp;just&nbsp;want&nbsp;to&nbsp;reject&nbsp;individual&nbsp;messages&nbsp;but&nbsp;continue&nbsp;consuming?&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
A&nbsp;connected&nbsp;issue&nbsp;here&nbsp;is&nbsp;that&nbsp;sending&nbsp;basic.cancel&nbsp;alters&nbsp;the&nbsp;sequence&nbsp;of&nbsp;messages&nbsp;on&nbsp;the&nbsp;target&nbsp;queue,&nbsp;the&nbsp;undelivered&nbsp;message&nbsp;gets&nbsp;requeued&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;queue.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
basic.cancel&nbsp;does&nbsp;not&nbsp;result&nbsp;in&nbsp;any&nbsp;requeueing&nbsp;of&nbsp;messages.&nbsp;It&nbsp;simply&nbsp;tells&nbsp;the&nbsp;server&nbsp;to&nbsp;stop&nbsp;sending&nbsp;messages&nbsp;to&nbsp;the&nbsp;consumer.&lt;br&gt;<br>
&lt;br&gt;<br>
However,&nbsp;basic.reject,&nbsp;recover,&nbsp;and&nbsp;nack,&nbsp;and&nbsp;channel/connection&nbsp;termination&nbsp;do&nbsp;all&nbsp;cause&nbsp;requeuing.&nbsp;And&nbsp;yes,&nbsp;those&nbsp;messages&nbsp;go&nbsp;to&nbsp;the&nbsp;back&nbsp;of&nbsp;the&nbsp;queue.&lt;br&gt;<br>
&lt;br&gt;<br>
However,&nbsp;since&nbsp;the&nbsp;subject&nbsp;of&nbsp;this&nbsp;email&nbsp;mentioned&nbsp;&amp;quot;unwanted&amp;quot;&nbsp;messages,&nbsp;why&nbsp;do&nbsp;you&nbsp;want&nbsp;them&nbsp;requeued&nbsp;at&nbsp;all?&lt;div&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
is&nbsp;there&nbsp;anything&nbsp;I&nbsp;can&nbsp;do&nbsp;to&nbsp;prevent&nbsp;this&nbsp;re-ordering?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
No.&nbsp;In&nbsp;theory&nbsp;rabbit&nbsp;could&nbsp;preserve&nbsp;the&nbsp;order&nbsp;when&nbsp;requeuing&nbsp;and&nbsp;there&nbsp;is&nbsp;just&nbsp;a&nbsp;single&nbsp;consumer.&nbsp;But&nbsp;a)&nbsp;that&nbsp;would&nbsp;be&nbsp;going&nbsp;beyond&nbsp;the&nbsp;guarantees&nbsp;provided&nbsp;by&nbsp;the&nbsp;AMQP&nbsp;spec,&nbsp;and&nbsp;b)&nbsp;as&nbsp;soon&nbsp;as&nbsp;there&nbsp;is&nbsp;more&nbsp;than&nbsp;one&nbsp;consumer&nbsp;there&nbsp;is&nbsp;no&nbsp;sensible&nbsp;way&nbsp;to&nbsp;preserve&nbsp;the&nbsp;order.&lt;div&gt;<br>
<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
I&nbsp;suppose&nbsp;that&nbsp;using&nbsp;basic.get&nbsp;instead&nbsp;would&nbsp;probably&nbsp;do&nbsp;the&nbsp;trick&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Requeuing&nbsp;of&nbsp;a&nbsp;message&nbsp;fetched&nbsp;with&nbsp;basic.get&nbsp;behaves&nbsp;no&nbsp;different&nbsp;from&nbsp;that&nbsp;of&nbsp;a&nbsp;message&nbsp;received&nbsp;as&nbsp;a&nbsp;result&nbsp;of&nbsp;a&nbsp;basic.consume.&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
