<tt>
I&nbsp;just&nbsp;shut&nbsp;down&nbsp;the&nbsp;profiler&nbsp;in&nbsp;our&nbsp;production&nbsp;environment&nbsp;after&nbsp;running&nbsp;for&nbsp;a&nbsp;few&nbsp;hours. &nbsp;I&nbsp;can&nbsp;confirm&nbsp;that&nbsp;removing&nbsp;this&nbsp;line&nbsp;does&nbsp;in&nbsp;fact&nbsp;resolve&nbsp;our&nbsp;memory&nbsp;leak.&lt;br&gt;&lt;br&gt;Bryan&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Mar&nbsp;18,&nbsp;2010&nbsp;at&nbsp;1:19&nbsp;PM,&nbsp;Bryan&nbsp;Murphy&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:bmurphy1976@gmail.com&quot;&gt;bmurphy1976@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Sometime&nbsp;between&nbsp;1.7.0&nbsp;and&nbsp;1.7.1&nbsp;(revision&nbsp;262)&nbsp;the&nbsp;following&nbsp;line&nbsp;was&nbsp;added&nbsp;to&nbsp;ConnectionBase.MainLoop&nbsp;in&nbsp;the&nbsp;RabbitMQ&nbsp;.NET&nbsp;driver:&lt;br&gt;<br>
&lt;br&gt; &nbsp;Thread.GetDomain().DomainUnload&nbsp;+=&nbsp;new&nbsp;EventHandler(HandleDomainUnload);&lt;br&gt;&lt;br&gt;<br>
I&amp;#39;ve&nbsp;found&nbsp;no&nbsp;place&nbsp;in&nbsp;the&nbsp;code&nbsp;where&nbsp;this&nbsp;event&nbsp;is&nbsp;unregistered,&nbsp;leading&nbsp;to&nbsp;a&nbsp;memory&nbsp;leak&nbsp;every&nbsp;time&nbsp;a&nbsp;connection&nbsp;is&nbsp;disposed. &nbsp;The&nbsp;following&nbsp;reference&nbsp;chain&nbsp;compounds&nbsp;this&nbsp;problem&nbsp;if&nbsp;you&nbsp;send&nbsp;large&nbsp;messages&nbsp;and&nbsp;create/dispose&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;connections:&lt;br&gt;<br>
<br>
&lt;br&gt; &nbsp;DomainUnload&nbsp;-&amp;gt;&nbsp;Connection&nbsp;-&amp;gt;&nbsp;SocketFrameHandler&nbsp;-&amp;gt;&nbsp;NetworkBinaryReader/Writer&nbsp;-&amp;gt;&nbsp;BufferedStream&lt;br&gt;&lt;br&gt;We&amp;#39;re&nbsp;currently&nbsp;seeing&nbsp;the&nbsp;symptoms&nbsp;of&nbsp;this&nbsp;in&nbsp;our&nbsp;production&nbsp;environment&nbsp;where&nbsp;one&nbsp;of&nbsp;our&nbsp;processes&nbsp;(which&nbsp;usually&nbsp;settles&nbsp;in&nbsp;around&nbsp;300mb)&nbsp;grows&nbsp;upwards&nbsp;of&nbsp;4gig&nbsp;over&nbsp;a&nbsp;12&nbsp;to&nbsp;18&nbsp;hour&nbsp;period.&lt;br&gt;<br>
<br>
&lt;br&gt;I&nbsp;believe&nbsp;you&nbsp;can&nbsp;work&nbsp;around&nbsp;this&nbsp;by&nbsp;either&nbsp;rolling&nbsp;back&nbsp;to&nbsp;the&nbsp;1.7.0&nbsp;driver,&nbsp;or&nbsp;commenting&nbsp;out&nbsp;that&nbsp;line&nbsp;of&nbsp;code. &nbsp;We&amp;#39;re&nbsp;currently&nbsp;pushing&nbsp;out&nbsp;a&nbsp;custom&nbsp;build&nbsp;of&nbsp;the&nbsp;driver&nbsp;to&nbsp;verify&nbsp;this&nbsp;fix,&nbsp;but&nbsp;it&nbsp;will&nbsp;be&nbsp;a&nbsp;few&nbsp;hours&nbsp;until&nbsp;I&nbsp;know&nbsp;for&nbsp;sure.&lt;br&gt;<br>
<br>
&lt;br&gt;Thanks,&lt;br&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;Bryan&lt;br&gt;<br>
&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
