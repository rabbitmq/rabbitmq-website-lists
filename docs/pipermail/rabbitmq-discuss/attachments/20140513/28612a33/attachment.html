<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;also&nbsp;posted&nbsp;this&nbsp;to&nbsp;StackOverflow.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
We&nbsp;run&nbsp;several&nbsp;production&nbsp;rabbit&nbsp;clusters&nbsp;(two&nbsp;nodes&nbsp;each),&nbsp;and&nbsp;transfer&nbsp;messages&nbsp;between&nbsp;them&nbsp;using&nbsp;federation.&nbsp;In&nbsp;development/testing,&nbsp;we&nbsp;only&nbsp;have&nbsp;one&nbsp;cluster&nbsp;due&nbsp;to&nbsp;hardware/resource&nbsp;limitations.&nbsp;In&nbsp;order&nbsp;to&nbsp;(poorly,&nbsp;but&nbsp;still&nbsp;better&nbsp;than&nbsp;nothing)&nbsp;test&nbsp;federation,&nbsp;we&nbsp;create&nbsp;federation&nbsp;links &lt;em&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;between&nbsp;two&nbsp;virtual&nbsp;hosts&nbsp;on&nbsp;the&nbsp;same&nbsp;cluster&lt;/em&gt;.&nbsp;This&nbsp;is&nbsp;sketchy,&nbsp;I&nbsp;know,&nbsp;but&nbsp;it&nbsp;worked&nbsp;for&nbsp;us&nbsp;when&nbsp;using&nbsp;RabbitMQ&nbsp;2.8.5,&nbsp;and&nbsp;usually&nbsp;works&nbsp;for&nbsp;us&nbsp;on&nbsp;3.2.4&nbsp;(see&nbsp;the&nbsp;issue&nbsp;below).&nbsp;Someday&nbsp;we&nbsp;may&nbsp;succeed&nbsp;in&nbsp;making&nbsp;the&nbsp;case&nbsp;that&nbsp;we&nbsp;need&nbsp;a&nbsp;second&nbsp;development&nbsp;Rabbit&nbsp;cluster,&nbsp;but&nbsp;today&nbsp;is&nbsp;not&nbsp;that&nbsp;day.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
&lt;strong&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;How&nbsp;I&nbsp;setup&nbsp;intra-cluster&nbsp;federation:&lt;/strong&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
Once&nbsp;the&nbsp;cluster&nbsp;is&nbsp;configured&nbsp;and&nbsp;all&nbsp;nodes&nbsp;report&nbsp;ready,&nbsp;I&nbsp;run&nbsp;a&nbsp;test&nbsp;that&nbsp;does&nbsp;the&nbsp;following.&nbsp;It&nbsp;always&nbsp;talks&nbsp;to&nbsp;one&nbsp;node&nbsp;in&nbsp;the&nbsp;cluster;&nbsp;it&nbsp;doesn&#39;t&nbsp;load-balance&nbsp;yet&nbsp;(once&nbsp;the&nbsp;test&nbsp;becomes&nbsp;stable,&nbsp;we&nbsp;will&nbsp;use&nbsp;a&nbsp;DNS&nbsp;load&nbsp;balancer&nbsp;across&nbsp;both&nbsp;cluster&nbsp;nodes).&lt;/p&gt;<br>
<br>
&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
Frst,&nbsp;it&nbsp;sets&nbsp;up&nbsp;its&nbsp;environment.&nbsp;It&nbsp;creates&nbsp;a&nbsp;test&nbsp;user&nbsp;and&nbsp;a&nbsp;pair&nbsp;of&nbsp;testing&nbsp;virtual&nbsp;hosts,&nbsp;granting&nbsp;the&nbsp;appropriate&nbsp;permissions,&nbsp;and&nbsp;ensuring&nbsp;that&nbsp;it&nbsp;can&nbsp;access&nbsp;both&nbsp;vhosts&nbsp;via&nbsp;AMQP&nbsp;and&nbsp;the&nbsp;API&nbsp;as&nbsp;that&nbsp;user.&nbsp;Then,&nbsp;it&nbsp;sets&nbsp;up&nbsp;the&nbsp;federation&nbsp;links&nbsp;by&nbsp;creating&nbsp;an&nbsp;upstream&nbsp;on&nbsp;the&nbsp;first&nbsp;vhost&nbsp;(call&nbsp;it&nbsp;A)&nbsp;pointing&nbsp;to&nbsp;the&nbsp;second&nbsp;vhost&nbsp;on&nbsp;the&nbsp;same&nbsp;cluster&nbsp;(call&nbsp;it&nbsp;vhost&nbsp;B).&nbsp;Then,&nbsp;it&nbsp;creates&nbsp;a&nbsp;policy&nbsp;which&nbsp;applies&nbsp;the&nbsp;upstream&nbsp;(directly;&nbsp;we&nbsp;only&nbsp;use&nbsp;one,&nbsp;so&nbsp;I&nbsp;don&#39;t&nbsp;create&nbsp;any&nbsp;upstream&nbsp;sets,&nbsp;though&nbsp;I&nbsp;could&nbsp;if&nbsp;need&nbsp;be)&nbsp;to&nbsp;an&nbsp;exchange.&nbsp;It&nbsp;then&nbsp;polls&nbsp;the&nbsp;federation&nbsp;link&nbsp;via&nbsp;the&nbsp;API&nbsp;until&nbsp;it&nbsp;reports&nbsp;a&nbsp;status&nbsp;of&nbsp;&quot;running&quot;.&nbsp;I&nbsp;could&nbsp;also&nbsp;poll&nbsp;the&nbsp;exchange&nbsp;for&nbsp;existence&nbsp;on&nbsp;the&nbsp;upstream&nbsp;Vhost,&nbsp;but&nbsp;I&nbsp;haven&#39;t&nbsp;seen&nbsp;a&nbsp;need&nbsp;to&nbsp;do&nbsp;so.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
Then,&nbsp;to&nbsp;make&nbsp;sure&nbsp;federation&nbsp;is&nbsp;actually&nbsp;usable,&nbsp;I&nbsp;publish&nbsp;AMQP&nbsp;messages&nbsp;into&nbsp;the&nbsp;federated&nbsp;exchange&nbsp;on&nbsp;B,&nbsp;and&nbsp;make&nbsp;sure&nbsp;they&nbsp;are&nbsp;received&nbsp;on&nbsp;A.&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
This&nbsp;test&nbsp;usually&nbsp;works.&nbsp;We&nbsp;did&nbsp;something&nbsp;similar&nbsp;on&nbsp;RabbitMQ&nbsp;2.8.5,&nbsp;and&nbsp;it&nbsp;worked&nbsp;flawlessly&nbsp;(without&nbsp;the&nbsp;policies;&nbsp;using&nbsp;federation&nbsp;upstreams&nbsp;etc.&nbsp;configured&nbsp;in&nbsp;the&nbsp;file).&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
&lt;strong&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;The&nbsp;problem:&lt;/strong&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
This&nbsp;test &lt;em&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;usually&lt;/em&gt; works.&nbsp;However,&nbsp;sometimes&nbsp;(about&nbsp;20%&nbsp;of&nbsp;the&nbsp;time,&nbsp;by&nbsp;my&nbsp;estimate)&nbsp;it&nbsp;breaks&nbsp;the&nbsp;cluster.&nbsp;Occasionally,&nbsp;between&nbsp;1&nbsp;and&nbsp;5&nbsp;minutes&nbsp;after&nbsp;running&nbsp;the&nbsp;test,&nbsp;the&nbsp;cluster&nbsp;stops&nbsp;being&nbsp;fully&nbsp;responsive.&nbsp;A&nbsp;full&nbsp;description&nbsp;of&nbsp;the&nbsp;symptoms&nbsp;follows:&lt;/p&gt;<br>
<br>
&lt;ul&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em&nbsp;30px;padding:0px;border:0px;font-size:14px;vertical-align:baseline;list-style-position:initial;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;When&nbsp;the&nbsp;cluster&nbsp;is&nbsp;in&nbsp;this&nbsp;state,&nbsp;I&nbsp;can&nbsp;open&nbsp;AMQP&nbsp;connections&nbsp;(authentication,&nbsp;tuning,&nbsp;etc&nbsp;all&nbsp;complete&nbsp;successfully),&nbsp;but&nbsp;I&nbsp;get&nbsp;no&nbsp;RPC&nbsp;replies&nbsp;for&nbsp;any&nbsp;subsequent&nbsp;AMQP&nbsp;methods&nbsp;(declare*,&nbsp;consume,&nbsp;etc).&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;The&nbsp;management&nbsp;API&nbsp;will&nbsp;not&nbsp;load&nbsp;the&nbsp;&quot;Admin&quot;&nbsp;section,&nbsp;doing&nbsp;nothing&nbsp;in&nbsp;GUI&nbsp;mode,&nbsp;and&nbsp;returning &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;[]&lt;/code&gt; in&nbsp;JSON&nbsp;mode.&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;Attempting&nbsp;to&nbsp;publish&nbsp;a&nbsp;message&nbsp;via&nbsp;the&nbsp;management&nbsp;UI&nbsp;results&nbsp;in&nbsp;the&nbsp;entire&nbsp;API&nbsp;becoming&nbsp;permanently&nbsp;inaccessible&nbsp;(pages&nbsp;only&nbsp;render&nbsp;the&nbsp;RabbitMQ&nbsp;logo&nbsp;and&nbsp;no&nbsp;other&nbsp;components,&nbsp;and&nbsp;JSON&nbsp;requests&nbsp;time&nbsp;out).&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;Nothing&nbsp;is&nbsp;written&nbsp;to&nbsp;the&nbsp;log&nbsp;(main&nbsp;file&nbsp;or&nbsp;SASL)&nbsp;after&nbsp;a&nbsp;few&nbsp;seconds&nbsp;before&nbsp;the&nbsp;outage&nbsp;starts.&nbsp;The&nbsp;last&nbsp;log&nbsp;entry&nbsp;is&nbsp;unpredictable;&nbsp;sometimes&nbsp;it&nbsp;is&nbsp;a&nbsp;record&nbsp;of&nbsp;the&nbsp;test&nbsp;user&nbsp;created&nbsp;for&nbsp;federation&nbsp;having&nbsp;its&nbsp;password&nbsp;change,&nbsp;sometimes&nbsp;it&nbsp;is&nbsp;a&nbsp;record&nbsp;of&nbsp;test&nbsp;Vhost&nbsp;being&nbsp;automatically&nbsp;deleted&nbsp;after&nbsp;the&nbsp;test,&nbsp;sometimes&nbsp;it&nbsp;is&nbsp;a&nbsp;record&nbsp;of&nbsp;an&nbsp;AMQP&nbsp;connection&nbsp;being&nbsp;accepted.&nbsp;All&nbsp;subsequent&nbsp;events&nbsp;are&nbsp;not&nbsp;logged&nbsp;(even&nbsp;successful&nbsp;AMQP&nbsp;connections,&nbsp;though,&nbsp;as&nbsp;detailed&nbsp;above,&nbsp;I&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;via&nbsp;RPC&nbsp;once&nbsp;connected).&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;Both&nbsp;the&nbsp;Beam&nbsp;and&nbsp;rabbitmq-server&nbsp;processes&nbsp;on&nbsp;both&nbsp;nodes&nbsp;consume&nbsp;minimal&nbsp;resources&nbsp;while&nbsp;hung;&nbsp;running &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;strace&lt;/code&gt; on &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;rabbitmq-server&lt;/code&gt;, &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;beam&lt;/code&gt;,&nbsp;and&nbsp;the&nbsp;Erlang&nbsp;helper &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;inet_gethost&lt;/code&gt;processes&nbsp;just&nbsp;shows&nbsp;a&nbsp;lot&nbsp;of&nbsp;system &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;select&lt;/code&gt; calls&nbsp;either&nbsp;sticking&nbsp;indefinitely&nbsp;or&nbsp;timing&nbsp;out&nbsp;and&nbsp;being&nbsp;immediately&nbsp;retried.&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;Checking&nbsp;the&nbsp;open&nbsp;sockets&nbsp;for&nbsp;processes&nbsp;owned&nbsp;by&nbsp;the&nbsp;rabbitmq&nbsp;user&nbsp;shows&nbsp;that&nbsp;there&nbsp;are&nbsp;two&nbsp;(bidirectional,&nbsp;two&nbsp;sockets&nbsp;each)&nbsp;IPV4&nbsp;links&nbsp;from&nbsp;the&nbsp;master&nbsp;node&nbsp;of&nbsp;the&nbsp;cluster&nbsp;to&nbsp;itself&nbsp;(presumably&nbsp;those&nbsp;are&nbsp;the&nbsp;federation&nbsp;links,&nbsp;or&nbsp;some&nbsp;other&nbsp;manager&nbsp;process).&nbsp;It&nbsp;also&nbsp;shows&nbsp;every&nbsp;API&nbsp;HTTP&nbsp;connection&nbsp;initiated&nbsp;since&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;outage&nbsp;in &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;CLOSE_WAIT&lt;/code&gt; status.&lt;/li&gt;<br>
<br>
&lt;/ul&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
Some&nbsp;interesting&nbsp;things&nbsp;happen&nbsp;when&nbsp;I&nbsp;try&nbsp;to&nbsp;shut&nbsp;down&nbsp;the&nbsp;cluster:&lt;/p&gt;&lt;ul&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em&nbsp;30px;padding:0px;border:0px;font-size:14px;vertical-align:baseline;list-style-position:initial;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;Attempting&nbsp;to&nbsp;shut&nbsp;down&nbsp;either&nbsp;node&nbsp;of&nbsp;the&nbsp;cluster&nbsp;via&nbsp;the&nbsp;init&nbsp;scripts&nbsp;or &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;rabbitmqctl&lt;/code&gt; hangs&nbsp;indefinitely.&nbsp;Nothing&nbsp;is&nbsp;written&nbsp;to &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;shutdown_err&lt;/code&gt; unless&nbsp;I&nbsp;interrupt&nbsp;the&nbsp;hung&nbsp;shutdown,&nbsp;in&nbsp;which&nbsp;case&nbsp;a&nbsp;notification&nbsp;of&nbsp;the&nbsp;interrupt&nbsp;is&nbsp;logged.&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;After&nbsp;an&nbsp;attempted&nbsp;shutdown&nbsp;the&nbsp;management&nbsp;API/UI&nbsp;becomes&nbsp;inaccessible,&nbsp;and&nbsp;any&nbsp;hung&nbsp;connections&nbsp;that&nbsp;were&nbsp;in &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;CLOSE_WAIT&lt;/code&gt; status&nbsp;dissapear.&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;All&nbsp;RabbitMQ&nbsp;processes&nbsp;that&nbsp;were&nbsp;visible&nbsp;before&nbsp;the&nbsp;shutdown&nbsp;attempt&nbsp;remain&nbsp;visible.&nbsp;AMQP&nbsp;operations&nbsp;are&nbsp;still&nbsp;impossible.&lt;/li&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;Killing&nbsp;the&nbsp;RabbitMQ&nbsp;processes&nbsp;(via &lt;code&nbsp;style=&quot;margin:0px;padding:1px&nbsp;5px;border:0px;vertical-align:baseline;background-color:rgb(238,238,238);font-family:Consolas,Menlo,Monaco,&#39;Lucida&nbsp;Console&#39;,&#39;Liberation&nbsp;Mono&#39;,&#39;DejaVu&nbsp;Sans&nbsp;Mono&#39;,&#39;Bitstream&nbsp;Vera&nbsp;Sans&nbsp;Mono&#39;,&#39;Courier&nbsp;New&#39;,monospace,serif;white-space:pre-wrap&quot;&gt;SIGTERM&lt;/code&gt;)&nbsp;and&nbsp;then&nbsp;restarting&nbsp;the&nbsp;master&nbsp;node&nbsp;in&nbsp;the&nbsp;cluster&nbsp;resolves&nbsp;the&nbsp;issue.&nbsp;Rabbit&nbsp;starts&nbsp;back&nbsp;up,&nbsp;and&nbsp;all&nbsp;objects,&nbsp;federation&nbsp;links,&nbsp;etc.&nbsp;created&nbsp;before&nbsp;the&nbsp;outage&nbsp;are&nbsp;available&nbsp;and&nbsp;working.&lt;/li&gt;<br>
<br>
&lt;/ul&gt;&lt;p&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em;padding:0px;border:0px;font-size:14px;vertical-align:baseline;clear:both;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
&lt;strong&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;Questions:&lt;/strong&gt;&lt;/p&gt;&lt;ol&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;1em&nbsp;30px;padding:0px;border:0px;font-size:14px;vertical-align:baseline;list-style-position:initial;color:rgb(0,0,0);font-family:Arial,&#39;Liberation&nbsp;Sans&#39;,&#39;DejaVu&nbsp;Sans&#39;,sans-serif;line-height:17.804800033569336px&quot;&gt;<br>
<br>
&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;Why&nbsp;is&nbsp;this&nbsp;happening?&lt;/li&gt;&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;<br>
<br>
Is&nbsp;this&nbsp;only&nbsp;happening&nbsp;because&nbsp;of&nbsp;the&nbsp;strange&nbsp;intra-cluster&nbsp;federation&nbsp;setup&nbsp;I&nbsp;have,&nbsp;or&nbsp;is&nbsp;there&nbsp;another&nbsp;cause?&lt;/li&gt;&lt;li&nbsp;style=&quot;margin:0px;padding:0px;border:0px;vertical-align:baseline;background-color:transparent&quot;&gt;How&nbsp;do&nbsp;I&nbsp;resolve&nbsp;it?&lt;/li&gt;<br>
<br>
&lt;/ol&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
