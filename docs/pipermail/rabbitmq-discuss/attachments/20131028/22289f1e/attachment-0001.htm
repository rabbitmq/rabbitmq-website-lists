<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Oct&nbsp;28,&nbsp;2013&nbsp;at&nbsp;2:04&nbsp;PM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;28/10/13&nbsp;20:40,&nbsp;Graeme&nbsp;N&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Well,&nbsp;if&nbsp;you&amp;#39;ve&nbsp;got&nbsp;my&nbsp;script&nbsp;bundle&nbsp;from&nbsp;earlier&nbsp;in&nbsp;the&nbsp;thread,&nbsp;just&lt;br&gt;<br>
update&nbsp;with&nbsp;this&nbsp;script.&nbsp;Use&nbsp;them&nbsp;to&nbsp;build&nbsp;a&nbsp;test&nbsp;cluster,&nbsp;populate&nbsp;100&lt;br&gt;<br>
queues&nbsp;with&nbsp;1000&nbsp;messages&nbsp;each.&nbsp;Then&nbsp;run&nbsp;this&nbsp;script&nbsp;to&nbsp;delete&nbsp;and&lt;br&gt;<br>
recreate&nbsp;all&nbsp;the&nbsp;queues.&nbsp;This&nbsp;always&nbsp;produces&nbsp;new&nbsp;queues&nbsp;for&nbsp;me&nbsp;that&lt;br&gt;<br>
contain&nbsp;old&nbsp;messages.&nbsp;;)&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Publishing&nbsp;is&nbsp;asynchronous.&nbsp;AFAICT&nbsp;the&nbsp;test&nbsp;node&nbsp;does&nbsp;not&nbsp;guarantee&nbsp;that&nbsp;all&nbsp;published&nbsp;messages&nbsp;have&nbsp;made&nbsp;it&nbsp;to&nbsp;the&nbsp;queues&nbsp;by&nbsp;the&nbsp;time&nbsp;populate_queues&nbsp;terminates.&nbsp;Some&nbsp;messages&nbsp;could&nbsp;still&nbsp;sit&nbsp;in&nbsp;various&nbsp;network&nbsp;or&nbsp;internal&nbsp;(pre-routing)&nbsp;buffers.&nbsp;If&nbsp;you&nbsp;then,&nbsp;concurrently,&nbsp;delete&nbsp;the&nbsp;queues&nbsp;and&nbsp;recreate&nbsp;them,&nbsp;the&nbsp;buffered&nbsp;messages&nbsp;will&nbsp;get&nbsp;routed&nbsp;to&nbsp;the&nbsp;newly&nbsp;created&nbsp;queues.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yeah,&nbsp;I&nbsp;typically&nbsp;wait&nbsp;until&nbsp;the&nbsp;management&nbsp;console&nbsp;reports&nbsp;all&nbsp;messages&nbsp;delivered&nbsp;to&nbsp;all&nbsp;queues,&nbsp;so&nbsp;I&amp;#39;m&nbsp;not&nbsp;just&nbsp;automating&nbsp;running&nbsp;these&nbsp;scripts&nbsp;in&nbsp;a&nbsp;row.&nbsp;I&amp;#39;ve&nbsp;been&nbsp;assuming&nbsp;that&nbsp;if&nbsp;the&nbsp;management&nbsp;console&nbsp;reports&nbsp;messages&nbsp;are&nbsp;delivered,&nbsp;then&nbsp;this&nbsp;scenario&nbsp;doesn&amp;#39;t&nbsp;apply.&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
That&amp;#39;s&nbsp;one&nbsp;explanation.&nbsp;The&nbsp;other&nbsp;possibility&nbsp;is&nbsp;that&nbsp;one&nbsp;of&nbsp;the&nbsp;other&nbsp;issues&nbsp;you&nbsp;reported&nbsp;is&nbsp;somehow&nbsp;causing&nbsp;this.&nbsp;Obviously&nbsp;if&nbsp;rabbit&nbsp;internals&nbsp;are&nbsp;exploding&nbsp;in&nbsp;various&nbsp;interesting&nbsp;ways&nbsp;(indicated&nbsp;by&nbsp;errors&nbsp;getting&nbsp;written&nbsp;to&nbsp;the&nbsp;SASL&nbsp;logs),&nbsp;as&nbsp;is&nbsp;happening&nbsp;in&nbsp;your&nbsp;tests,&nbsp;then&nbsp;all&nbsp;bets&nbsp;are&nbsp;off.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Well,&nbsp;when&nbsp;I&amp;#39;ve&nbsp;been&nbsp;running&nbsp;this,&nbsp;I&nbsp;updated&nbsp;my&nbsp;scripts&nbsp;to&nbsp;do&nbsp;queue&nbsp;deletion&nbsp;linearly&nbsp;(without&nbsp;any&nbsp;shell&nbsp;level&nbsp;parallelism),&nbsp;as&nbsp;should&nbsp;be&nbsp;seen&nbsp;in&nbsp;the&nbsp;updated&nbsp;setup&nbsp;script.&nbsp;In&nbsp;this&nbsp;situation,&nbsp;I&amp;#39;m&nbsp;not&nbsp;seeing&nbsp;it&nbsp;throw&nbsp;a&nbsp;bunch&nbsp;of&nbsp;obvious&nbsp;errors,&nbsp;but&nbsp;when&nbsp;I&nbsp;go&nbsp;to&nbsp;create&nbsp;the&nbsp;new&nbsp;message&nbsp;queues, &nbsp;they&nbsp;show&nbsp;up&nbsp;with&nbsp;some&nbsp;subset&nbsp;of&nbsp;the&nbsp;original&nbsp;messages&nbsp;in&nbsp;them.&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Graeme&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
