<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Ran&nbsp;into&nbsp;another&nbsp;interesting&nbsp;issue&nbsp;which&nbsp;I&amp;#39;m&nbsp;not&nbsp;gonna&nbsp;create&nbsp;a&nbsp;full&nbsp;test&nbsp;case&nbsp;for&nbsp;right&nbsp;now,&nbsp;as&nbsp;I&amp;#39;m&nbsp;trying&nbsp;to&nbsp;focus&nbsp;on&nbsp;clustering&nbsp;problems,&nbsp;but&nbsp;I&nbsp;thought&nbsp;it&nbsp;was&nbsp;worth&nbsp;mentioning.&lt;br&gt;&lt;br&gt;It&nbsp;looks&nbsp;like&nbsp;if&nbsp;you&nbsp;have&nbsp;a&nbsp;bunch&nbsp;of&nbsp;persistent&nbsp;queues&nbsp;full&nbsp;of&nbsp;messages&nbsp;(~10k&nbsp;each&nbsp;in&nbsp;this&nbsp;case),&nbsp;and&nbsp;you&nbsp;delete&nbsp;them&nbsp;via&nbsp;the&nbsp;API&nbsp;and&nbsp;then&nbsp;recreate&nbsp;them&nbsp;immediately,&nbsp;Rabbit&nbsp;won&amp;#39;t&nbsp;have&nbsp;finished&nbsp;deleting&nbsp;messages&nbsp;out&nbsp;of&nbsp;mnesia&nbsp;/&nbsp;disk,&nbsp;and&nbsp;so&nbsp;they&amp;#39;ll&nbsp;reappear&nbsp;with&nbsp;some&nbsp;subset&nbsp;of&nbsp;the&nbsp;messages&nbsp;that&nbsp;were&nbsp;present&nbsp;before&nbsp;queue&nbsp;deletion.&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;This&nbsp;is&nbsp;definitely&nbsp;not&nbsp;the&nbsp;behaviour&nbsp;I&amp;#39;d&nbsp;expect,&nbsp;although&nbsp;it&nbsp;makes&nbsp;sense&nbsp;if&nbsp;queue&nbsp;deletion&nbsp;happens&nbsp;asynchronously.&nbsp;Even&nbsp;so,&nbsp;might&nbsp;be&nbsp;worth&nbsp;revisiting&nbsp;the&nbsp;behaviour&nbsp;and&nbsp;making&nbsp;sure&nbsp;old&nbsp;messages&nbsp;are&nbsp;purged&nbsp;on&nbsp;queue&nbsp;deletion&nbsp;before&nbsp;letting&nbsp;a&nbsp;&amp;quot;new&amp;quot;&nbsp;queue&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;be&nbsp;created.&lt;br&gt;<br>
&lt;br&gt;Graeme&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Oct&nbsp;28,&nbsp;2013&nbsp;at&nbsp;1:22&nbsp;PM,&nbsp;Michael&nbsp;Klishin&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:michael@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;michael@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;29&nbsp;Oct&nbsp;2013,&nbsp;at&nbsp;00:14,&nbsp;Graeme&nbsp;N&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:graeme@sudo.ca&quot;&gt;graeme@sudo.ca&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;m&nbsp;going&nbsp;a&nbsp;different&nbsp;direction&nbsp;now&nbsp;anyway,&nbsp;the&nbsp;go&nbsp;amqp&nbsp;libs&nbsp;are&nbsp;easy&nbsp;to&nbsp;use&nbsp;and&nbsp;seem&nbsp;performant,&nbsp;so&nbsp;I&amp;#39;m&nbsp;just&nbsp;whipping&nbsp;up&nbsp;a&nbsp;little&nbsp;populator&nbsp;in&nbsp;go.&nbsp;Seems&nbsp;to&nbsp;be&nbsp;doing&nbsp;the&nbsp;job,&nbsp;so&nbsp;I&nbsp;think&nbsp;I&amp;#39;m&nbsp;gonna&nbsp;forget&nbsp;about&nbsp;PerfTest&nbsp;for&nbsp;now.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
&lt;/div&gt;Take&nbsp;a&nbsp;look&nbsp;at&nbsp;&lt;a&nbsp;href=&quot;https://github.com/gocardless/amqpc&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/gocardless/amqpc&lt;/a&gt;,&nbsp;too.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
MK&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
