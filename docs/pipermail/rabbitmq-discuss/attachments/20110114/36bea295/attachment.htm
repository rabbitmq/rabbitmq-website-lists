<tt>
On&nbsp;Fri,&nbsp;Jan&nbsp;14,&nbsp;2011&nbsp;at&nbsp;9:08&nbsp;AM,&nbsp;Matthew&nbsp;Sackman&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthew@rabbitmq.com&quot;&gt;matthew@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;Entirely&nbsp;up&nbsp;to&nbsp;you&nbsp;-&nbsp;resources&nbsp;are&nbsp;visible&nbsp;throughout&nbsp;the&nbsp;cluster&nbsp;and&nbsp;so&lt;/div&gt;<br>
any&nbsp;sane&nbsp;load&nbsp;balancing&nbsp;should&nbsp;be&nbsp;just&nbsp;fine.&nbsp;If&nbsp;they&nbsp;all&nbsp;connect&nbsp;to&nbsp;the&lt;br&gt;<br>
same&nbsp;node&nbsp;then&nbsp;you&amp;#39;ll&nbsp;likely&nbsp;find&nbsp;that&nbsp;all&nbsp;resources&nbsp;exist&nbsp;solely&nbsp;on&lt;br&gt;<br>
that&nbsp;node&nbsp;and&nbsp;thus&nbsp;the&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;being&nbsp;used&nbsp;at&nbsp;all.&nbsp;Thus&lt;br&gt;<br>
really,&nbsp;you&nbsp;want&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;the&nbsp;clients&nbsp;which&nbsp;create&nbsp;resources&lt;br&gt;<br>
(queues&nbsp;in&nbsp;particular)&nbsp;are&nbsp;connected&nbsp;across&nbsp;all&nbsp;the&nbsp;nodes.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;other&nbsp;thing&nbsp;to&nbsp;consider&nbsp;is&nbsp;the&nbsp;inter-node&nbsp;hops&nbsp;required&nbsp;to&nbsp;route&lt;br&gt;<br>
messages.&nbsp;Thus&nbsp;you&nbsp;may&nbsp;wish&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;if&nbsp;client&nbsp;1&nbsp;is&lt;br&gt;<br>
predominantly&nbsp;sending&nbsp;messages&nbsp;to&nbsp;or&nbsp;consuming&nbsp;messages&nbsp;from&nbsp;queue&nbsp;1,&lt;br&gt;<br>
that&nbsp;client&nbsp;1&nbsp;is&nbsp;connected&nbsp;to&nbsp;the&nbsp;same&nbsp;node&nbsp;on&nbsp;which&nbsp;queue&nbsp;1&nbsp;resides.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hum.&nbsp; There&amp;#39;s&nbsp;always&nbsp;trade-offs.&nbsp; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;top&nbsp;concern&nbsp;is&nbsp;that&nbsp;a&nbsp;producer&nbsp;(and&nbsp;consumer)&nbsp;can&nbsp;connect&nbsp;to&nbsp;a&nbsp;node.&nbsp; What&nbsp;looks&nbsp;like&nbsp;a&nbsp;good&nbsp;choice&nbsp;is&nbsp;HAProxy&nbsp;in&nbsp;front&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;RabbitMQ&nbsp;nodes.&nbsp; And&nbsp;maybe&nbsp;a&nbsp;pair&nbsp;of&nbsp;HAProxy&nbsp;machines&nbsp;with&nbsp;Heartbeat&nbsp;to&nbsp;avoid&nbsp;the&nbsp;single&nbsp;point&nbsp;of&nbsp;failure.&nbsp; Configuration&nbsp;is&nbsp;easier&nbsp;because&nbsp;workers&nbsp;just&nbsp;talk&nbsp;to&nbsp;one&nbsp;HAProxy.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But,&nbsp;then&nbsp;there&amp;#39;s&nbsp;no&nbsp;control&nbsp;over&nbsp;which&nbsp;node&nbsp;a&nbsp;producer&nbsp;or&nbsp;consumer&nbsp;connects&nbsp;to.&nbsp; So,&nbsp;then&nbsp;there&amp;#39;s&nbsp;going&nbsp;to&nbsp;be&nbsp;be&nbsp;some&nbsp;(probably&nbsp;half)&nbsp;cross-node&nbsp;messages.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Perhaps&nbsp;if&nbsp;the&nbsp;point&nbsp;of&nbsp;the&nbsp;second&nbsp;node&nbsp;is&nbsp;for&nbsp;HA&nbsp;then&nbsp;should&nbsp;just&nbsp;configure&nbsp;HAProxy&nbsp;to&nbsp;only&nbsp;use&nbsp;the&nbsp;second&nbsp;node&nbsp;as&nbsp;a&nbsp;hot-backup&nbsp;and&nbsp;make&nbsp;both&nbsp;nodes&nbsp;disk&nbsp;nodes.&nbsp; The&nbsp;nature&nbsp;of&nbsp;a&nbsp;backup&nbsp;is&nbsp;that&nbsp;it&nbsp;must&nbsp;be&nbsp;able&nbsp;to&nbsp;handle&nbsp;all&nbsp;traffic,&nbsp;anyway.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;we&nbsp;design&nbsp;with&nbsp;the&nbsp;idea&nbsp;messages&nbsp;might&nbsp;get&nbsp;dropped,&nbsp;and&nbsp;always&nbsp;declare&nbsp;exchanges,&nbsp;queues,&nbsp;and&nbsp;bindings&nbsp;on&nbsp;every&nbsp;connection&nbsp;then&nbsp;maybe&nbsp;there&amp;#39;s&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;cluster&nbsp;or&nbsp;using&nbsp;the&nbsp;Pacemaker&nbsp;HA&nbsp;example&nbsp;and&nbsp;just&nbsp;run&nbsp;independent&nbsp;RabbitMQ&nbsp;instances&nbsp;with&nbsp;a&nbsp;method&nbsp;of&nbsp;fail-over.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;very&nbsp;much&nbsp;for&nbsp;the&nbsp;help,&nbsp;Matthew.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Would&nbsp;I&nbsp;be&nbsp;wrong&nbsp;to&nbsp;assume&nbsp;that&nbsp;these&nbsp;configuration&nbsp;issues&nbsp;have&nbsp;been&nbsp;solved&nbsp;by&nbsp;many&nbsp;people&nbsp;already?&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;Bill&nbsp;Moseley&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:moseley@hank.org&quot;&nbsp;target=&quot;_blank&quot;&gt;moseley@hank.org&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>

</tt>
