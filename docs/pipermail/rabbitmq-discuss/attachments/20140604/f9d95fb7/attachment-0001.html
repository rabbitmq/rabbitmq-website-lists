<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&#39;m&nbsp;doing&nbsp;some&nbsp;testing&nbsp;with&nbsp;rabbitmq 3.1.5&nbsp;.&lt;/div&gt;&lt;div&nbsp;style&gt;I&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;I&nbsp;am&nbsp;doing&nbsp;something&nbsp;wrong&nbsp;or&nbsp;it&nbsp;is&nbsp;the&nbsp;normal&nbsp;behabiour,&nbsp;but,&nbsp;when&nbsp;I&nbsp;setup&nbsp;a&nbsp;2&nbsp;nodes&nbsp;cluster,&nbsp;both&nbsp;to&nbsp;disk&nbsp;and&nbsp;everytghing&nbsp;persistent,&nbsp;and&nbsp;withe&nbsp;the&nbsp;policy:&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;rabbitmqctl&nbsp;set_policy&nbsp; ha-all&nbsp;&quot;^ha_&quot;&nbsp;&#39;{&quot;ha-mode&quot;:&quot;all&quot;}&#39;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;The&nbsp;system&nbsp;does&nbsp;something&nbsp;I&nbsp;don&#39;t&nbsp;understand.&lt;/div&gt;&lt;div&nbsp;style&gt;If&nbsp;I&nbsp;create&nbsp;and&nbsp;send&nbsp;messages&nbsp;to&nbsp;a&nbsp;&quot;ha_helloworld&quot;&nbsp;queue&nbsp;those&nbsp;messages&nbsp;are&nbsp;sent&nbsp;to&nbsp;both&nbsp;nodes,&nbsp;and&nbsp;I&nbsp;can&nbsp;see&nbsp;how&nbsp;both&nbsp;nodes&nbsp;save&nbsp;those&nbsp;messages&nbsp;to&nbsp;disc&nbsp;as&nbsp;I&nbsp;can&nbsp;see&nbsp;how&nbsp;the&nbsp;&quot;mnesia&quot;&nbsp;directory&nbsp;grows.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;If&nbsp;I&nbsp;stop&nbsp;one&nbsp;of&nbsp;the&nbsp;nodes&nbsp;the&nbsp;space&nbsp;of&nbsp;&quot;mnesia&quot;&nbsp;in&nbsp;that&nbsp;node&nbsp;increase&nbsp;(?¿),&nbsp;but&nbsp;when&nbsp;I&nbsp;start&nbsp;it&nbsp;again&nbsp;it&nbsp;will&nbsp;just&nbsp;decrease&nbsp;and&nbsp;lose&nbsp;all&nbsp;messages.&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Now,&nbsp;If&nbsp;I&nbsp;were&nbsp;to&nbsp;do&nbsp;the&nbsp;same&nbsp;with&nbsp;the&nbsp;second&nbsp;node,&nbsp;with&nbsp;the&nbsp;first&nbsp;node&nbsp;already&nbsp;restarted,&nbsp;the&nbsp;second&nbsp;node&nbsp;will&nbsp;just&nbsp;loose&nbsp;all&nbsp;messages&nbsp;to,&nbsp;so&nbsp;I&nbsp;will&nbsp;be&nbsp;losing&nbsp;all&nbsp;messages&nbsp;from&nbsp;the&nbsp;cluster.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&#39;ll&nbsp;show&nbsp;the&nbsp;process&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;mail.&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;normal&nbsp;behabiour.&nbsp;I&nbsp;thougt&nbsp;that&nbsp;it&nbsp;is,&nbsp;as&nbsp;maybe&nbsp;it&nbsp;would&nbsp;be&nbsp;difficult&nbsp;to&nbsp;the&nbsp;server&nbsp;on&nbsp;the&nbsp;restarted&nbsp;node&nbsp;to&nbsp;know&nbsp;which&nbsp;messages&nbsp;has&nbsp;been&nbsp;already&nbsp;consumed&nbsp;while&nbsp;it&nbsp;was&nbsp;down.&nbsp;But&nbsp;if&nbsp;it&nbsp;is&nbsp;the&nbsp;case,&nbsp;why&nbsp;would&nbsp;anyone&nbsp;has&nbsp;a&nbsp;mirrored&nbsp;queue&nbsp;write&nbsp;to&nbsp;disk&nbsp;if&nbsp;all&nbsp;data&nbsp;can&nbsp;be&nbsp;lost&nbsp;anyway?&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&nbsp;already&nbsp;tryed&nbsp;to&nbsp;find&nbsp;info&nbsp;about&nbsp;this&nbsp;fact&nbsp;but&nbsp;without&nbsp;success...&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Here&nbsp;the&nbsp;process&nbsp;of&nbsp;both&nbsp;nodes:&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
----------------------------------------------------------------------------------&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;div&gt;NODE&nbsp;1&lt;/div&gt;&lt;div&gt;[root@ip-10-0-11-105&nbsp;rabbitmq]#&nbsp;pwd&lt;/div&gt;&lt;div&gt;/var/lib/rabbitmq&lt;/div&gt;&lt;div&gt;[root@ip-10-0-11-105&nbsp;rabbitmq]#&nbsp;du&nbsp;-hs&nbsp;*&lt;/div&gt;<br>
&lt;div&gt;1.4M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;erl_crash.dump&lt;/div&gt;&lt;div&gt;2.3M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;mnesia&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;(send&nbsp;some&nbsp;messages)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@ip-10-0-11-105&nbsp;rabbitmq]#&nbsp;rabbitmqctl&nbsp;list_queues&lt;/div&gt;<br>
&lt;div&gt;Listing&nbsp;queues&nbsp;...&lt;/div&gt;&lt;div&gt;ha_hello&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;10000&lt;/div&gt;&lt;div&gt;...done.&lt;/div&gt;&lt;div&gt;[root@ip-10-0-11-105&nbsp;rabbitmq]#&nbsp;du&nbsp;-hs&nbsp;*&lt;/div&gt;&lt;div&gt;1.4M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;erl_crash.dump&lt;/div&gt;<br>
&lt;div&gt;4.6M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;mnesia&lt;/div&gt;&lt;div&gt;[root@ip-10-0-11-105&nbsp;rabbitmq]#&nbsp;/etc/init.d/rabbitmq-server&nbsp;stop&lt;/div&gt;&lt;div&gt;Stopping&nbsp;rabbitmq-server:&nbsp;rabbitmq-server.&lt;/div&gt;&lt;div&gt;[root@ip-10-0-11-105&nbsp;rabbitmq]#&nbsp;du&nbsp;-hs&nbsp;*&lt;/div&gt;<br>
&lt;div&gt;1.4M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;erl_crash.dump&lt;/div&gt;&lt;div&gt;5.2M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;mnesia&lt;/div&gt;&lt;div&gt;[root@ip-10-0-11-105&nbsp;rabbitmq]#&nbsp;/etc/init.d/rabbitmq-server&nbsp;start&lt;/div&gt;&lt;div&gt;<br>
Starting&nbsp;rabbitmq-server:&nbsp;SUCCESS&lt;/div&gt;&lt;div&gt;rabbitmq-server.&lt;/div&gt;&lt;div&gt;[root@ip-10-0-11-105&nbsp;rabbitmq]#&nbsp;du&nbsp;-hs&nbsp;*&lt;/div&gt;&lt;div&gt;1.4M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;erl_crash.dump&lt;/div&gt;&lt;div&gt;2.3M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;mnesia&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;(restart&nbsp;seccond&nbsp;node)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@ip-10-0-11-105&nbsp;rabbitmq]#&nbsp; rabbitmqctl&nbsp;list_queues&lt;/div&gt;&lt;div&gt;Listing&nbsp;queues&nbsp;...&lt;/div&gt;&lt;div&gt;ha_hello&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;0&lt;/div&gt;<br>
&lt;div&gt;...done.&lt;/div&gt;&lt;div&gt;[root@ip-10-0-11-105&nbsp;rabbitmq]#&nbsp;du&nbsp;-hs&nbsp;*&lt;/div&gt;&lt;div&gt;1.4M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;erl_crash.dump&lt;/div&gt;&lt;div&gt;2.3M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;mnesia&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;----------------------------------------------------------------------------------&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;NODE&nbsp;2&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;pwd &lt;/div&gt;&lt;div&gt;<br>
/var/lib/rabbitmq&lt;/div&gt;&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;du&nbsp;-hs&nbsp;*&lt;/div&gt;&lt;div&gt;1.2M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;erl_crash.dump&lt;/div&gt;&lt;div&gt;2.3M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;mnesia&lt;/div&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;(send&nbsp;some&nbsp;messages)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;rabbitmqctl&nbsp;list_queues&lt;/div&gt;&lt;div&gt;Listing&nbsp;queues&nbsp;...&lt;/div&gt;&lt;div&gt;ha_hello&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&lt;/span&gt;10000&lt;/div&gt;<br>
&lt;div&gt;...done.&lt;/div&gt;&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;du&nbsp;-hs&nbsp;*&lt;/div&gt;&lt;div&gt;1.2M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;erl_crash.dump&lt;/div&gt;&lt;div&gt;4.6M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;mnesia&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;(stop&nbsp;other&nbsp;node)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;rabbitmqctl&nbsp;list_queues&lt;/div&gt;&lt;div&gt;Listing&nbsp;queues&nbsp;...&lt;/div&gt;&lt;div&gt;ha_hello&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;10000&lt;/div&gt;&lt;div&gt;...done.&lt;/div&gt;<br>
&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;du&nbsp;-hs&nbsp;*&lt;/div&gt;&lt;div&gt;1.2M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;erl_crash.dump&lt;/div&gt;&lt;div&gt;4.6M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;mnesia&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;/etc/init.d/rabbitmq-server&nbsp;stop&lt;/div&gt;<br>
&lt;div&gt;Stopping&nbsp;rabbitmq-server:&nbsp;rabbitmq-server.&lt;/div&gt;&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;du&nbsp;-hs&nbsp;*&lt;/div&gt;&lt;div&gt;1.2M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;erl_crash.dump&lt;/div&gt;&lt;div&gt;5.2M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;mnesia&lt;/div&gt;<br>
&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;/etc/init.d/rabbitmq-server&nbsp;start&lt;/div&gt;&lt;div&gt;Starting&nbsp;rabbitmq-server:&nbsp;SUCCESS&lt;/div&gt;&lt;div&gt;rabbitmq-server.&lt;/div&gt;&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;rabbitmqctl&nbsp;list_queues&lt;/div&gt;&lt;div&gt;Listing&nbsp;queues&nbsp;...&lt;/div&gt;<br>
&lt;div&gt;ha_hello&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;0&lt;/div&gt;&lt;div&gt;...done.&lt;/div&gt;&lt;div&gt;[root@ip-10-0-10-175&nbsp;rabbitmq]#&nbsp;du&nbsp;-hs&nbsp;*&lt;/div&gt;&lt;div&gt;1.2M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;erl_crash.dump&lt;/div&gt;&lt;div&gt;2.3M&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;mnesia&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;----------------------------------------------------------------------------------&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Thanks!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
