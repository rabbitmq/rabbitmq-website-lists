<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;17&nbsp;October&nbsp;2013&nbsp;01:29,&nbsp;Tim&nbsp;Watson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:tim@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;tim@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
Hello&nbsp;David!&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hey&nbsp;Tim,&nbsp;thanks&nbsp;for&nbsp;replying&nbsp;so&nbsp;quickly!&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
On&nbsp;16&nbsp;Oct&nbsp;2013,&nbsp;at&nbsp;15:14,&nbsp;David&nbsp;Harrison&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;Hoping&nbsp;someone&nbsp;can&nbsp;help&nbsp;me&nbsp;out.&nbsp; We&nbsp;recently&nbsp;experienced&nbsp;2&nbsp;crashes&nbsp;with&nbsp;our&nbsp;RabbitMQ&nbsp;cluster.&nbsp; After&nbsp;the&nbsp;first&nbsp;crash,&nbsp;we&nbsp;moved&nbsp;the&nbsp;Mnesia&nbsp;directories&nbsp;elsewhere,&nbsp;and&nbsp;started&nbsp;RabbitMQ&nbsp;again.&nbsp; This&nbsp;got&nbsp;us&nbsp;up&nbsp;and&nbsp;running.&nbsp; Second&nbsp;time&nbsp;it&nbsp;happened,&nbsp;we&nbsp;had&nbsp;the&nbsp;original&nbsp;nodes&nbsp;plus&nbsp;an&nbsp;additional&nbsp;5&nbsp;nodes&nbsp;we&nbsp;had&nbsp;added&nbsp;to&nbsp;the&nbsp;cluster&nbsp;that&nbsp;we&nbsp;were&nbsp;planning&nbsp;to&nbsp;leave&nbsp;in&nbsp;place&nbsp;while&nbsp;shutting&nbsp;the&nbsp;old&nbsp;nodes&nbsp;down.&lt;br&gt;<br>
<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;What&nbsp;version&nbsp;of&nbsp;rabbit&nbsp;are&nbsp;you&nbsp;running,&nbsp;and&nbsp;how&nbsp;was&nbsp;it&nbsp;installed?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.1.5,&nbsp;running&nbsp;on&nbsp;Ubuntu&nbsp;Precise,&nbsp;installed&nbsp;via&nbsp;deb&nbsp;package.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;During&nbsp;the&nbsp;crash&nbsp;symptoms&nbsp;were&nbsp;as&nbsp;follows:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;-&nbsp;Escalating&nbsp;(and&nbsp;sudden)&nbsp;CPU&nbsp;utilisation&nbsp;on&nbsp;some&nbsp;(but&nbsp;not&nbsp;all)&nbsp;nodes&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;We&amp;#39;ve&nbsp;fixed&nbsp;at&nbsp;least&nbsp;one&nbsp;bug&nbsp;with&nbsp;that&nbsp;symptom&nbsp;in&nbsp;recent&nbsp;releases.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;3.1.5&nbsp;is&nbsp;the&nbsp;latest&nbsp;stable&nbsp;??&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;-&nbsp;Increasing&nbsp;time&nbsp;to&nbsp;publish&nbsp;on&nbsp;queues&nbsp;(and&nbsp;specifically&nbsp;on&nbsp;a&nbsp;test&nbsp;queue&nbsp;we&nbsp;have&nbsp;setup&nbsp;that&nbsp;exists&nbsp;only&nbsp;to&nbsp;test&nbsp;publishing&nbsp;and&nbsp;consuming&nbsp;from&nbsp;the&nbsp;cluster&nbsp;hosts)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Are&nbsp;there&nbsp;multiple&nbsp;publishers&nbsp;on&nbsp;the&nbsp;same&nbsp;connection/channel&nbsp;when&nbsp;this&nbsp;happens?&nbsp;It&nbsp;wouldn&amp;#39;t&nbsp;be&nbsp;unusual,&nbsp;if&nbsp;the&nbsp;server&nbsp;was&nbsp;struggling,&nbsp;to&nbsp;see&nbsp;flow&nbsp;control&nbsp;kick&nbsp;in&nbsp;and&nbsp;affect&nbsp;publishers&nbsp;in&nbsp;this&nbsp;fashion.&lt;br&gt;&lt;/blockquote&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes&nbsp;in&nbsp;some&nbsp;cases&nbsp;there&nbsp;would&nbsp;be,&nbsp;for&nbsp;our&nbsp;test&nbsp;queue&nbsp;there&nbsp;wouldn&amp;#39;t&nbsp;be&nbsp;--&nbsp;we&nbsp;saw&nbsp;up&nbsp;to&nbsp;10s&nbsp;on&nbsp;the&nbsp;test&nbsp;queue&nbsp;though&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;-&nbsp;Running&nbsp;`rabbitmqctl&nbsp;cluster&nbsp;status`&nbsp;gets&nbsp;increasingly&nbsp;slow&nbsp;(some&nbsp;nodes&nbsp;eventually&nbsp;taking&nbsp;up&nbsp;to&nbsp;10m&nbsp;to&nbsp;return&nbsp;with&nbsp;the&nbsp;response&nbsp;data&nbsp;-&nbsp;some&nbsp;were&nbsp;fast&nbsp;and&nbsp;took&nbsp;5s)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Wow,&nbsp;10m&nbsp;is&nbsp;amazingly&nbsp;slow.&nbsp;Can&nbsp;you&nbsp;provide&nbsp;log&nbsp;files&nbsp;for&nbsp;this&nbsp;period&nbsp;of&nbsp;activity&nbsp;and&nbsp;problems?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;ll&nbsp;take&nbsp;a&nbsp;look,&nbsp;we&nbsp;saw&nbsp;a&nbsp;few&nbsp;&amp;quot;too&nbsp;many&nbsp;processes&amp;quot;&nbsp;messages,&lt;/div&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;quot;&lt;span&nbsp;class=&quot;&quot;&gt;Generic&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;server&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;net_kernel&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;terminating&amp;quot;&nbsp;followed&nbsp;by&nbsp;:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt;<br>
**&nbsp;Reason&nbsp;for&nbsp;termination&nbsp;==&lt;/div&gt;&lt;div&gt;**&nbsp;{system_limit,[{erlang,spawn_opt,&lt;/div&gt;&lt;div&gt;[inet_tcp_dist,do_setup,&lt;/div&gt;&lt;div&gt;[&amp;lt;0.19.0&amp;gt;,&amp;#39;rabbit@b02.internal&amp;#39;,normal,&lt;/div&gt;&lt;div&gt;&amp;#39;rabbit@b00.internal&amp;#39;,longnames,7000],&lt;/div&gt;<br>
&lt;div&gt;[link,{priority,max}]]},&lt;/div&gt;&lt;div&gt;{net_kernel,setup,4},&lt;/div&gt;&lt;div&gt;{net_kernel,handle_call,3},&lt;/div&gt;&lt;div&gt;{gen_server,handle_msg,5},&lt;/div&gt;&lt;div&gt;{proc_lib,init_p_do_apply,3}]}&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;&lt;pre&gt;&lt;div&nbsp;id=&quot;LC402&quot;&nbsp;class=&quot;&quot;&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;=&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;ERROR&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;REPORT&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;====&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;15&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;-&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;Oct&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;-&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;2013&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;::&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;16&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;:&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;07&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;:&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;10&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;===&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;LC403&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;**&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;gen_event&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;handler&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;rabbit_error_logger&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;crashed&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;.&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;LC404&quot;&nbsp;class=&quot;&quot;&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;**&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;Was&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;installed&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;in&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;error_logger&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;LC405&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;**&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;Last&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;event&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;was&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;:&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;{&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;error&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;0&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;.&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;8&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;.&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;0&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,{&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;emulator&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;~s~n&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,[&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;quot;Too&nbsp;many&nbsp;processes&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;\n&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;]}}&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;LC406&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;**&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;When&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;handler&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;state&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;==&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;{&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;resource&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;exchange&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;quot;amq.rabbitmq.log&amp;quot;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;LC407&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;**&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;Reason&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;==&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;{&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;aborted&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;LC408&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;{&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;no_exists&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;LC409&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;[&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;rabbit_topic_trie_edge&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;LC410&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;{&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;trie_edge&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;LC411&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;{&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;resource&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;exchange&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;quot;amq.rabbitmq.log&amp;quot;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;},&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;LC412&quot;&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;class=&quot;&quot;&gt;root&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;,&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&amp;quot;error&amp;quot;&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;}]}}&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;LC412&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;LC412&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;LC412&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;=ERROR&nbsp;REPORT====&nbsp;15-Oct-2013::16:07:10&nbsp;===<br>
Mnesia(nonode@nohost):&nbsp;**&nbsp;ERROR&nbsp;**&nbsp;mnesia_controller&nbsp;got&nbsp;unexpected&nbsp;info:&nbsp;{&amp;#39;EXIT&amp;#39;,<br>
&amp;lt;0.97.0&amp;gt;,<br>
shutdown}&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;LC412&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;LC412&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;=ERROR&nbsp;REPORT====&nbsp;15-Oct-2013::16:11:38&nbsp;===<br>
Mnesia(&amp;#39;rabbit@b00.internal&amp;#39;):&nbsp;**&nbsp;ERROR&nbsp;**&nbsp;mnesia_event&nbsp;got&nbsp;{inconsistent_database,&nbsp;starting_partitioned_network,&nbsp;&amp;#39;rabbit@b01.internal&amp;#39;}&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;-&nbsp;When&nbsp;trying&nbsp;to&nbsp;shut&nbsp;down&nbsp;a&nbsp;node,&nbsp;running&nbsp;`rabbitmqctl&nbsp;stop_app`&nbsp;appears&nbsp;to&nbsp;block&nbsp;on&nbsp;epmd&nbsp;and&nbsp;doesn&amp;#39;t&nbsp;return&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Again,&nbsp;we&amp;#39;ve&nbsp;fixed&nbsp;bugs&nbsp;in&nbsp;that&nbsp;area&nbsp;in&nbsp;recent&nbsp;releases.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;---&nbsp;When&nbsp;that&nbsp;doesn&amp;#39;t&nbsp;return&nbsp;we&nbsp;eventually&nbsp;have&nbsp;to&nbsp;ctrl-c&nbsp;the&nbsp;command&lt;br&gt;<br>
&amp;gt;&nbsp;---&nbsp;We&nbsp;have&nbsp;to&nbsp;issue&nbsp;a&nbsp;kill&nbsp;signal&nbsp;to&nbsp;rabbit&nbsp;to&nbsp;stop&nbsp;it&lt;br&gt;<br>
&amp;gt;&nbsp;---&nbsp;Do&nbsp;the&nbsp;same&nbsp;to&nbsp;the&nbsp;epmd&nbsp;process&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Even&nbsp;if&nbsp;you&nbsp;have&nbsp;to&nbsp;`kill&nbsp;-9&amp;#39;&nbsp;a&nbsp;rabbit&nbsp;node,&nbsp;you&nbsp;shouldn&amp;#39;t&nbsp;need&nbsp;to&nbsp;kill&nbsp;epmd.&nbsp;In&nbsp;theory&nbsp;at&nbsp;least.&nbsp;If&nbsp;that&nbsp;was&nbsp;necessary&nbsp;to&nbsp;fix&nbsp;the&nbsp;&amp;quot;state&nbsp;of&nbsp;the&nbsp;world&amp;quot;,&nbsp;it&nbsp;would&nbsp;be&nbsp;indicative&nbsp;of&nbsp;a&nbsp;problem&nbsp;related&nbsp;to&nbsp;the&nbsp;erlang&nbsp;distribution&nbsp;mechanism,&nbsp;but&nbsp;I&nbsp;very&nbsp;much&nbsp;doubt&nbsp;that&amp;#39;s&nbsp;the&nbsp;case&nbsp;here.&lt;br&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Config&nbsp;/&nbsp;details&nbsp;as&nbsp;follows&nbsp;(we&nbsp;use&nbsp;mirrored&nbsp;queues&nbsp;--&nbsp;5&nbsp;hosts,&nbsp;all&nbsp;disc&nbsp;nodes,&nbsp;with&nbsp;a&nbsp;global&nbsp;policy&nbsp;that&nbsp;all&nbsp;queues&nbsp;are&nbsp;mirrored&nbsp;&amp;quot;ha-mode:all&amp;quot;),&nbsp;running&nbsp;on&nbsp;Linux&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;How&nbsp;many&nbsp;queues&nbsp;are&nbsp;we&nbsp;talking&nbsp;about&nbsp;here?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;~30&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;[&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{rabbit,&nbsp;[&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{cluster_nodes,&nbsp;{[&amp;#39;rabbit@b05.internal&amp;#39;,&nbsp;&amp;#39;rabbit@b06.internal&amp;#39;,&amp;#39;rabbit@b07.internal&amp;#39;,&amp;#39;rabbit@b08.internal&amp;#39;,&amp;#39;rabbit@b09.internal&amp;#39;],&nbsp;disc}},&lt;br&gt;<br>
&amp;gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{cluster_partition_handling,&nbsp;pause_minority}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Are&nbsp;you&nbsp;sure&nbsp;that&nbsp;what&nbsp;you&amp;#39;re&nbsp;seeing&nbsp;is&nbsp;not&nbsp;caused&nbsp;by&nbsp;a&nbsp;network&nbsp;partition?&nbsp;If&nbsp;it&nbsp;were,&nbsp;any&nbsp;nodes&nbsp;in&nbsp;a&nbsp;minority&nbsp;island&nbsp;would&nbsp;&amp;quot;pause&amp;quot;,&nbsp;which&nbsp;would&nbsp;certainly&nbsp;lead&nbsp;to&nbsp;the&nbsp;kind&nbsp;of&nbsp;symptoms&nbsp;you&amp;#39;ve&nbsp;mentioned&nbsp;here,&nbsp;viz&nbsp;rabbitmqctl&nbsp;calls&nbsp;not&nbsp;returning&nbsp;and&nbsp;so&nbsp;on.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;was&nbsp;definitely&nbsp;a&nbsp;network&nbsp;partition,&nbsp;but&nbsp;the&nbsp;whole&nbsp;cluster&nbsp;nose&nbsp;dived&nbsp;during&nbsp;the&nbsp;crash&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;The&nbsp;erl_crash.dump&nbsp;slogan&nbsp;error&nbsp;was&nbsp;:&nbsp;eheap_alloc:&nbsp;Cannot&nbsp;allocate&nbsp;2850821240&nbsp;bytes&nbsp;of&nbsp;memory&nbsp;(of&nbsp;type&nbsp;&amp;quot;old_heap&amp;quot;).&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;That&amp;#39;s&nbsp;a&nbsp;plain&nbsp;old&nbsp;OOM&nbsp;failure.&nbsp;Rabbit&nbsp;ought&nbsp;to&nbsp;start&nbsp;deliberately&nbsp;paging&nbsp;messages&nbsp;to&nbsp;disk&nbsp;well&nbsp;before&nbsp;that&nbsp;happens,&nbsp;which&nbsp;might&nbsp;also&nbsp;explain&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;slow/unresponsive-ness.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;These&nbsp;hosts&nbsp;aren&amp;#39;t&nbsp;running&nbsp;swap,&nbsp;we&nbsp;give&nbsp;them&nbsp;a&nbsp;fair&nbsp;bit&nbsp;of&nbsp;RAM&nbsp;(gave&nbsp;them&nbsp;even&nbsp;more&nbsp;now&nbsp;as&nbsp;part&nbsp;of&nbsp;a&nbsp;possible&nbsp;stop&nbsp;gap) &lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;System&nbsp;version&nbsp;:&nbsp;Erlang&nbsp;R14B04&nbsp;(erts-5.8.5)&nbsp;[source]&nbsp;[64-bit]&nbsp;[smp:2:2]&nbsp;[rq:2]&nbsp;[async-threads:0]&nbsp;[kernel-poll:false]&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;I&amp;#39;d&nbsp;strongly&nbsp;suggest&nbsp;upgrading&nbsp;to&nbsp;R16B02&nbsp;if&nbsp;you&nbsp;can.&nbsp;R14&nbsp;is&nbsp;pretty&nbsp;ancient&nbsp;and&nbsp;a&nbsp;*lot*&nbsp;of&nbsp;bug&nbsp;fixes&nbsp;have&nbsp;appeared&nbsp;in&nbsp;erts&nbsp;+&nbsp;OTP&nbsp;since&nbsp;then.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;ok&nbsp;good&nbsp;advice,&nbsp;we&amp;#39;ll&nbsp;do&nbsp;that&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&amp;gt;&nbsp;When&nbsp;I&nbsp;look&nbsp;at&nbsp;the&nbsp;Process&nbsp;Information&nbsp;it&nbsp;seems&nbsp;there&amp;#39;s&nbsp;a&nbsp;small&nbsp;number&nbsp;with&nbsp;ALOT&nbsp;of&nbsp;messages&nbsp;queued,&nbsp;and&nbsp;the&nbsp;rest&nbsp;are&nbsp;an&nbsp;order&nbsp;of&nbsp;magnitude&nbsp;lower:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;That&amp;#39;s&nbsp;not&nbsp;unusual.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;when&nbsp;I&nbsp;view&nbsp;the&nbsp;second&nbsp;process&nbsp;(first&nbsp;one&nbsp;crashes&nbsp;erlang&nbsp;on&nbsp;me),&nbsp;I&nbsp;see&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;sender_death&nbsp;events&nbsp;(not&nbsp;sure&nbsp;if&nbsp;these&nbsp;are&nbsp;common&nbsp;or&nbsp;highly&nbsp;unusual&nbsp;?)&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;{&amp;#39;$gen_cast&amp;#39;,{gm,{sender_death,&amp;lt;2710.20649.64&amp;gt;}}}&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Interesting&nbsp;-&nbsp;will&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;that.&nbsp;If&nbsp;you&nbsp;could&nbsp;provide&nbsp;logs&nbsp;for&nbsp;the&nbsp;participating&nbsp;nodes&nbsp;during&nbsp;this&nbsp;whole&nbsp;time&nbsp;period,&nbsp;that&nbsp;would&nbsp;help&nbsp;a&nbsp;lot.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;mixed&nbsp;in&nbsp;with&nbsp;other&nbsp;more&nbsp;regular&nbsp;events:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Actually,&nbsp;sender_death&nbsp;messages&nbsp;are&nbsp;not&nbsp;&amp;quot;irregular&amp;quot;&nbsp;as&nbsp;such.&nbsp;They&amp;#39;re&nbsp;just&nbsp;notifying&nbsp;the&nbsp;GM&nbsp;group&nbsp;members&nbsp;that&nbsp;another&nbsp;member&nbsp;(on&nbsp;another&nbsp;node)&nbsp;has&nbsp;died.&nbsp;This&nbsp;is&nbsp;quite&nbsp;normal&nbsp;with&nbsp;mirrored&nbsp;queues,&nbsp;when&nbsp;nodes&nbsp;get&nbsp;partitioned&nbsp;or&nbsp;stopped&nbsp;due&nbsp;to&nbsp;cluster&nbsp;recovery&nbsp;modes.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
Tim&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
