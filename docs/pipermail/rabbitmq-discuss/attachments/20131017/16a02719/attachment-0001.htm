<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi&nbsp;there,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hoping&nbsp;someone&nbsp;can&nbsp;help&nbsp;me&nbsp;out.&nbsp; We&nbsp;recently&nbsp;experienced&nbsp;2&nbsp;crashes&nbsp;with&nbsp;our&nbsp;RabbitMQ&nbsp;cluster.&nbsp; After&nbsp;the&nbsp;first&nbsp;crash,&nbsp;we&nbsp;moved&nbsp;the&nbsp;Mnesia&nbsp;directories&nbsp;elsewhere,&nbsp;and&nbsp;started&nbsp;RabbitMQ&nbsp;again.&nbsp; This&nbsp;got&nbsp;us&nbsp;up&nbsp;and&nbsp;running.&nbsp; Second&nbsp;time&nbsp;it&nbsp;happened,&nbsp;we&nbsp;had&nbsp;the&nbsp;original&nbsp;nodes&nbsp;plus&nbsp;an&nbsp;additional&nbsp;5&nbsp;nodes&nbsp;we&nbsp;had&nbsp;added&nbsp;to&nbsp;the&nbsp;cluster&nbsp;that&nbsp;we&nbsp;were&nbsp;planning&nbsp;to&nbsp;leave&nbsp;in&nbsp;place&nbsp;while&nbsp;shutting&nbsp;the&nbsp;old&nbsp;nodes&nbsp;down.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;During&nbsp;the&nbsp;crash&nbsp;symptoms&nbsp;were&nbsp;as&nbsp;follows:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;Escalating&nbsp;(and&nbsp;sudden)&nbsp;CPU&nbsp;utilisation&nbsp;on&nbsp;some&nbsp;(but&nbsp;not&nbsp;all)&nbsp;nodes&lt;/div&gt;&lt;div&gt;-&nbsp;Escalation&nbsp;memory&nbsp;usage&nbsp;(not&nbsp;necessarily&nbsp;aligned&nbsp;to&nbsp;the&nbsp;spiking&nbsp;CPU)&lt;/div&gt;<br>
<br>
&lt;div&gt;-&nbsp;Increasing&nbsp;time&nbsp;to&nbsp;publish&nbsp;on&nbsp;queues&nbsp;(and&nbsp;specifically&nbsp;on&nbsp;a&nbsp;test&nbsp;queue&nbsp;we&nbsp;have&nbsp;setup&nbsp;that&nbsp;exists&nbsp;only&nbsp;to&nbsp;test&nbsp;publishing&nbsp;and&nbsp;consuming&nbsp;from&nbsp;the&nbsp;cluster&nbsp;hosts)&lt;/div&gt;&lt;div&gt;-&nbsp;Running&nbsp;`rabbitmqctl&nbsp;cluster&nbsp;status`&nbsp;gets&nbsp;increasingly&nbsp;slow&nbsp;(some&nbsp;nodes&nbsp;eventually&nbsp;taking&nbsp;up&nbsp;to&nbsp;10m&nbsp;to&nbsp;return&nbsp;with&nbsp;the&nbsp;response&nbsp;data&nbsp;-&nbsp;some&nbsp;were&nbsp;fast&nbsp;and&nbsp;took&nbsp;5s)&lt;/div&gt;<br>
<br>
&lt;div&gt;-&nbsp;Management&nbsp;plugin&nbsp;stops&nbsp;responding&nbsp;/&nbsp;or&nbsp;responding&nbsp;so&nbsp;slowly&nbsp;it&amp;#39;s&nbsp;no&nbsp;longer&nbsp;loading&nbsp;any&nbsp;data&nbsp;at&nbsp;all&nbsp;(probably&nbsp;same&nbsp;thing&nbsp;that&nbsp;causes&nbsp;the&nbsp;preceeding&nbsp;item)&lt;/div&gt;&lt;div&gt;-&nbsp;Can&amp;#39;t&nbsp;force&nbsp;nodes&nbsp;to&nbsp;forget&nbsp;other&nbsp;nodes&nbsp;(calling&nbsp;`rabbitmqctl&nbsp;forget_cluster_node`&nbsp;doesn&amp;#39;t&nbsp;return)&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;When&nbsp;trying&nbsp;to&nbsp;shut&nbsp;down&nbsp;a&nbsp;node,&nbsp;running&nbsp;`rabbitmqctl&nbsp;stop_app`&nbsp;appears&nbsp;to&nbsp;block&nbsp;on&nbsp;epmd&nbsp;and&nbsp;doesn&amp;#39;t&nbsp;return&lt;/div&gt;&lt;div&gt;---&nbsp;When&nbsp;that&nbsp;doesn&amp;#39;t&nbsp;return&nbsp;we&nbsp;eventually&nbsp;have&nbsp;to&nbsp;ctrl-c&nbsp;the&nbsp;command&lt;/div&gt;<br>
<br>
&lt;div&gt;---&nbsp;We&nbsp;have&nbsp;to&nbsp;issue&nbsp;a&nbsp;kill&nbsp;signal&nbsp;to&nbsp;rabbit&nbsp;to&nbsp;stop&nbsp;it&lt;/div&gt;&lt;div&gt;---&nbsp;Do&nbsp;the&nbsp;same&nbsp;to&nbsp;the&nbsp;epmd&nbsp;process&lt;/div&gt;&lt;div&gt;---&nbsp;However&nbsp;the&nbsp;other&nbsp;nodes&nbsp;all&nbsp;still&nbsp;think&nbsp;that&nbsp;the&nbsp;killed&nbsp;node&nbsp;is&nbsp;active&nbsp;(based&nbsp;on&nbsp;`rabbitmqctl&nbsp;cluster&nbsp;status`&nbsp;--&nbsp;both&nbsp;nodes&nbsp;slow&nbsp;to&nbsp;run&nbsp;this,&nbsp;and&nbsp;fast&nbsp;to&nbsp;run&nbsp;it&nbsp;saw&nbsp;the&nbsp;same&nbsp;view&nbsp;of&nbsp;the&nbsp;cluster&nbsp;that&nbsp;included&nbsp;the&nbsp;dead&nbsp;node)&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Config&nbsp;/&nbsp;details&nbsp;as&nbsp;follows&nbsp;(we&nbsp;use&nbsp;mirrored&nbsp;queues&nbsp;--&nbsp;5&nbsp;hosts,&nbsp;all&nbsp;disc&nbsp;nodes,&nbsp;with&nbsp;a&nbsp;global&nbsp;policy&nbsp;that&nbsp;all&nbsp;queues&nbsp;are&nbsp;mirrored&nbsp;&amp;quot;ha-mode:all&amp;quot;),&nbsp;running&nbsp;on&nbsp;Linux&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;[&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;{rabbit,&nbsp;[&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{cluster_nodes,&nbsp;{[&amp;#39;rabbit@b05.internal&amp;#39;,&nbsp;&amp;#39;rabbit@b06.internal&amp;#39;,&amp;#39;rabbit@b07.internal&amp;#39;,&amp;#39;rabbit@b08.internal&amp;#39;,&amp;#39;rabbit@b09.internal&amp;#39;],&nbsp;disc}},&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{cluster_partition_handling,&nbsp;pause_minority}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;]}&lt;/div&gt;&lt;div&gt;]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;the&nbsp;env:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;NODENAME=&amp;quot;rabbit@b09.internal&amp;quot;&lt;/div&gt;&lt;div&gt;SERVER_ERL_ARGS=&amp;quot;-kernel&nbsp;inet_dist_listen_min&nbsp;27248&nbsp;-kernel&nbsp;inet_dist_listen_max&nbsp;27248&amp;quot;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;erl_crash.dump&nbsp;slogan&nbsp;error&nbsp;was&nbsp;:&nbsp;eheap_alloc:&nbsp;Cannot&nbsp;allocate&nbsp;2850821240&nbsp;bytes&nbsp;of&nbsp;memory&nbsp;(of&nbsp;type&nbsp;&amp;quot;old_heap&amp;quot;).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;System&nbsp;version&nbsp;:&nbsp;Erlang&nbsp;R14B04&nbsp;(erts-5.8.5)&nbsp;[source]&nbsp;[64-bit]&nbsp;[smp:2:2]&nbsp;[rq:2]&nbsp;[async-threads:0]&nbsp;[kernel-poll:false]&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Compiled&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Fri&nbsp;Dec&nbsp;16&nbsp;03:22:15&nbsp;2011&lt;/div&gt;&lt;div&gt;Taints&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;(none)&lt;/div&gt;&lt;div&gt;Memory&nbsp;allocated&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;6821368760&nbsp;bytes&lt;/div&gt;<br>
<br>
&lt;div&gt;Atoms&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;22440&lt;/div&gt;&lt;div&gt;Processes&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;4899&lt;/div&gt;&lt;div&gt;ETS&nbsp;tables&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;80&lt;/div&gt;&lt;div&gt;Timers&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;23&lt;/div&gt;<br>
<br>
&lt;div&gt;Funs&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;3994&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;look&nbsp;at&nbsp;the&nbsp;Process&nbsp;Information&nbsp;it&nbsp;seems&nbsp;there&amp;#39;s&nbsp;a&nbsp;small&nbsp;number&nbsp;with&nbsp;ALOT&nbsp;of&nbsp;messages&nbsp;queued,&nbsp;and&nbsp;the&nbsp;rest&nbsp;are&nbsp;an&nbsp;order&nbsp;of&nbsp;magnitude&nbsp;lower:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Pid&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Name/Spawned&nbsp;as&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;State&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Reductions&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Stack+heap&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp;MsgQ&nbsp;Length&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;lt;0.400.0&amp;gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;proc_lib:init_p/5&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Scheduled&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;146860259&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp;59786060&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;37148&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;lt;0.373.0&amp;gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;proc_lib:init_p/5&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Scheduled&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;734287949&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp;1346269&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;23360&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;lt;0.366.0&amp;gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;proc_lib:init_p/5&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Waiting&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;114695635&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp;5135590&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;19744&lt;/div&gt;<br>
<br>
&lt;div&gt;&amp;lt;0.444.0&amp;gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;proc_lib:init_p/5&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;Waiting&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;154538610&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp;832040&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;&nbsp;3326&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;when&nbsp;I&nbsp;view&nbsp;the&nbsp;second&nbsp;process&nbsp;(first&nbsp;one&nbsp;crashes&nbsp;erlang&nbsp;on&nbsp;me),&nbsp;I&nbsp;see&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;sender_death&nbsp;events&nbsp;(not&nbsp;sure&nbsp;if&nbsp;these&nbsp;are&nbsp;common&nbsp;or&nbsp;highly&nbsp;unusual&nbsp;?)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;{&amp;#39;$gen_cast&amp;#39;,{gm,{sender_death,&amp;lt;2710.20649.64&amp;gt;}}}&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mixed&nbsp;in&nbsp;with&nbsp;other&nbsp;more&nbsp;regular&nbsp;events:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;{&amp;#39;$gen_cast&amp;#39;,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{gm,{publish,&amp;lt;2708.20321.59&amp;gt;,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{message_properties,undefined,false},&lt;/div&gt;<br>
<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{basic_message,&lt;/div&gt;&lt;div&gt;&amp;lt;..&nbsp;snip..&amp;gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
