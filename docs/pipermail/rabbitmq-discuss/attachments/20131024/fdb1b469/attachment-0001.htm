<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hello&nbsp;list,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;It&nbsp;appears&nbsp;that&nbsp;flow&nbsp;control&nbsp;can&nbsp;cause&nbsp;the&nbsp;Java&nbsp;API&nbsp;to&nbsp;block&nbsp;indefinitely&nbsp;on&nbsp;the&nbsp;call&nbsp;to&nbsp;Channel.waitForConfirmsOrDie(long&nbsp;timeout),&nbsp;regardless&nbsp;of&nbsp;the&nbsp;timeout&nbsp;value.&lt;div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;this&nbsp;intentional?&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;tested&nbsp;this&nbsp;with&nbsp;RabbitMQ&nbsp;3.2.0&nbsp;and&nbsp;the&nbsp;official&nbsp;Java&nbsp;client&nbsp;3.2.0.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Steps&nbsp;to&nbsp;reproduce:&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;Start&nbsp;a&nbsp;RabbitMQ&nbsp;broker&lt;br&gt;<br>
<br>
<br>
&lt;/li&gt;&lt;li&gt;Connect&nbsp;with&nbsp;the&nbsp;Java&nbsp;client&lt;br&gt;&lt;/li&gt;&lt;li&gt;Create&nbsp;a&nbsp;Channel&nbsp;and&nbsp;call&nbsp;`confirmSelect`&lt;/li&gt;&lt;li&gt;Run&nbsp;`rabbitmqctl&nbsp;set_vm_memory_high_watermark&nbsp;0.0`&lt;br&gt;&lt;/li&gt;&lt;li&gt;Call&nbsp;`basicPublish`&nbsp;to&nbsp;publish&nbsp;a&nbsp;message&lt;/li&gt;&lt;li&gt;Call&nbsp;`Channel.waitForConfirmsOrDie(1000L)`&lt;/li&gt;<br>
<br>
<br>
&lt;li&gt;Wait&nbsp;for&nbsp;more&nbsp;than&nbsp;1&nbsp;second:&nbsp;no&nbsp;exception&lt;/li&gt;&lt;li&gt;RunÂ `rabbitmqctl&nbsp;set_vm_memory_high_watermark&nbsp;0.4`&lt;/li&gt;&lt;li&gt;TimeoutException&nbsp;is&nbsp;thrown&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;I&nbsp;think&nbsp;this&nbsp;is&nbsp;because&nbsp;ChannelN.waitForConfirmsOrDie(long&nbsp;timeout)&nbsp;catches&nbsp;TimeoutException&nbsp;and&nbsp;calls:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;40px;border:none;padding:0px&quot;&gt;close(AMQP.PRECONDITION_FAILED,&nbsp;&amp;quot;TIMEOUT&nbsp;WAITING&nbsp;FOR&nbsp;ACK&amp;quot;);&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;call&nbsp;to&nbsp;`close`&nbsp;blocks&nbsp;indefinitely&nbsp;because&nbsp;the&nbsp;RabbitMQ&nbsp;connection&nbsp;is&nbsp;blocked.&nbsp;The&nbsp;TimeoutException&nbsp;does&nbsp;not&nbsp;get&nbsp;thrown&nbsp;until&nbsp;after&nbsp;the&nbsp;connection&nbsp;is&nbsp;unblocked.&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;a&nbsp;workaround,&nbsp;I&nbsp;am&nbsp;calling&nbsp;`Channel.waitForConfirms(long&nbsp;timeout)`&nbsp;and&nbsp;throwing&nbsp;an&nbsp;exception&nbsp;if&nbsp;returns&nbsp;false.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Stuart&nbsp;Sierra&lt;/div&gt;&lt;div&gt;Cognitect,&nbsp;Inc.&lt;/div&gt;&lt;/div&gt;<br>

</tt>
