<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Awesome&nbsp;guys!&nbsp;Thanks&nbsp;for&nbsp;the&nbsp;fix:&lt;div&gt;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/release-notes/README-3.2.4.txt&quot;&gt;http://www.rabbitmq.com/release-notes/README-3.2.4.txt&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://hg.rabbitmq.com/rabbitmq-dotnet-client/rev/49cfdfd34e15&quot;&gt;http://hg.rabbitmq.com/rabbitmq-dotnet-client/rev/49cfdfd34e15&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;On&nbsp;Sunday,&nbsp;February&nbsp;16,&nbsp;2014&nbsp;11:33:13&nbsp;AM&nbsp;UTC-7,&nbsp;Jonathan&nbsp;Oliver&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;During&nbsp;periods&nbsp;of&nbsp;degraded&nbsp;WAN&nbsp;performance&nbsp;and&nbsp;availability,&nbsp;e.g.&nbsp;lost&nbsp;packets,&nbsp;increased&nbsp;latency,&nbsp;etc.&nbsp;the&nbsp;.NET&nbsp;RabbitMQ&nbsp;connection&nbsp;is&nbsp;destroyed&nbsp;according&nbsp;to&nbsp;the&nbsp;requested&nbsp;heartbeat&nbsp;and&nbsp;works&nbsp;as&nbsp;intended.&nbsp;&nbsp;Our&nbsp;client&nbsp;is&nbsp;observes&nbsp;this&nbsp;and&nbsp;then&nbsp;attempts&nbsp;to&nbsp;reconnect&nbsp;periodically&nbsp;until&nbsp;a&nbsp;connection&nbsp;is&nbsp;re-established&nbsp;with&nbsp;the&nbsp;broker.&nbsp;&nbsp;We've&nbsp;noticed&nbsp;however,&nbsp;that&nbsp;sometimes&nbsp;these&nbsp;reconnection&nbsp;attempts&nbsp;hang&nbsp;&lt;b&gt;indefinitely/forever&lt;/b&gt;&nbsp;despite&nbsp;a&nbsp;configured&nbsp;RequestedConnectionTimeout&nbsp;value&nbsp;of&nbsp;30&nbsp;seconds.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After&nbsp;months&nbsp;of&nbsp;seeing&nbsp;this&nbsp;problem&nbsp;every&nbsp;few&nbsp;weeks&nbsp;because&nbsp;of&nbsp;various&nbsp;network&nbsp;hiccups,&nbsp;we&nbsp;were&nbsp;finally&nbsp;able&nbsp;to&nbsp;capture&nbsp;a&nbsp;snapshot&nbsp;and&nbsp;then&nbsp;perform&nbsp;an&nbsp;inspection&nbsp;of&nbsp;the&nbsp;memory&nbsp;dump&nbsp;using&nbsp;WinDbg.&nbsp;&nbsp;Here's&nbsp;the&nbsp;stack&nbsp;trace&nbsp;(which&nbsp;uses&nbsp;the&nbsp;production&nbsp;RabbitMQ&nbsp;.NET&nbsp;client&nbsp;v3.2.1):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;000000001adde530&nbsp;000007fef77ad01a&nbsp;System.Net.Sockets.Socket.&lt;wbr&gt;Receive(Byte[],&nbsp;Int32,&nbsp;Int32,&nbsp;System.Net.Sockets.&lt;wbr&gt;SocketFlags,&nbsp;System.Net.Sockets.SocketError&nbsp;ByRef)&lt;/div&gt;&lt;div&gt;000000001adde5d0&nbsp;000007fef77ace88&nbsp;System.Net.Sockets.&lt;wbr&gt;NetworkStream.Read(Byte[],&nbsp;Int32,&nbsp;Int32)&lt;/div&gt;&lt;div&gt;000000001adde650&nbsp;000007fef777294c&nbsp;System.Net.FixedSizeReader.&lt;wbr&gt;ReadPacket(Byte[],&nbsp;Int32,&nbsp;Int32)&lt;/div&gt;&lt;div&gt;000000001adde6a0&nbsp;000007fef77d3803&nbsp;System.Net.Security.SslState.&lt;wbr&gt;StartReceiveBlob(Byte[],&nbsp;System.Net.&lt;wbr&gt;AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde6e0&nbsp;000007fef77d1f09&nbsp;System.Net.Security.SslState.&lt;wbr&gt;StartSendBlob(Byte[],&nbsp;Int32,&nbsp;System.Net.&lt;wbr&gt;AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde760&nbsp;000007fef77d3d26&nbsp;System.Net.Security.SslState.&lt;wbr&gt;ProcessReceivedBlob(Byte[],&nbsp;Int32,&nbsp;System.Net.&lt;wbr&gt;AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde7d0&nbsp;000007fef77d3816&nbsp;System.Net.Security.SslState.&lt;wbr&gt;StartReceiveBlob(Byte[],&nbsp;System.Net.&lt;wbr&gt;AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde810&nbsp;000007fef77d1f09&nbsp;System.Net.Security.SslState.&lt;wbr&gt;StartSendBlob(Byte[],&nbsp;Int32,&nbsp;System.Net.&lt;wbr&gt;AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde890&nbsp;000007fef77d1b85&nbsp;System.Net.Security.SslState.&lt;wbr&gt;ForceAuthentication(Boolean,&nbsp;Byte[],&nbsp;System.Net.&lt;wbr&gt;AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde900&nbsp;000007fef77d1856&nbsp;System.Net.Security.SslState.&lt;wbr&gt;ProcessAuthentication(System.&lt;wbr&gt;Net.LazyAsyncResult)&lt;/div&gt;&lt;div&gt;&lt;b&gt;RabbitMQ.Client.Impl.&lt;wbr&gt;SocketFrameHandler_0_9..ctor(&lt;wbr&gt;RabbitMQ.Client.&lt;wbr&gt;AmqpTcpEndpoint,&nbsp;ObtainSocket,&nbsp;Int32)&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;000000001addea00&nbsp;000007fe9a28c5e1&nbsp;RabbitMQ.Client.Framing.Impl.&lt;wbr&gt;v0_9_1.ProtocolBase.&lt;wbr&gt;CreateFrameHandler(RabbitMQ.&lt;wbr&gt;Client.AmqpTcpEndpoint,&nbsp;ObtainSocket,&nbsp;Int32)&lt;/div&gt;&lt;div&gt;000000001addea50&nbsp;000007fe9a28c245&nbsp;RabbitMQ.Client.&lt;wbr&gt;ConnectionFactory.&lt;wbr&gt;FollowRedirectChain(Int32,&nbsp;System.Collections.Generic.&lt;wbr&gt;IDictionary`2&lt;RabbitMQ.Client.&lt;wbr&gt;AmqpTcpEndpoint,Int32&gt;,&nbsp;System.Collections.Generic.&lt;wbr&gt;IDictionary`2&lt;RabbitMQ.Client.&lt;wbr&gt;AmqpTcpEndpoint,System.&lt;wbr&gt;Exception&gt;,&nbsp;RabbitMQ.Client.&lt;wbr&gt;AmqpTcpEndpoint[]&nbsp;ByRef,&nbsp;RabbitMQ.Client.&lt;wbr&gt;AmqpTcpEndpoint)&lt;/div&gt;&lt;div&gt;000000001addeb50&nbsp;000007fe9a28c05f&nbsp;RabbitMQ.Client.&lt;wbr&gt;ConnectionFactory.&lt;wbr&gt;CreateConnection(Int32,&nbsp;System.Collections.Generic.&lt;wbr&gt;IDictionary`2&lt;RabbitMQ.Client.&lt;wbr&gt;AmqpTcpEndpoint,Int32&gt;,&nbsp;System.Collections.Generic.&lt;wbr&gt;IDictionary`2&lt;RabbitMQ.Client.&lt;wbr&gt;AmqpTcpEndpoint,System.&lt;wbr&gt;Exception&gt;,&nbsp;RabbitMQ.Client.&lt;wbr&gt;AmqpTcpEndpoint[])&lt;/div&gt;&lt;div&gt;000000001addebe0&nbsp;000007fe9a28bf51&nbsp;RabbitMQ.Client.&lt;wbr&gt;ConnectionFactory.&lt;wbr&gt;CreateConnection(Int32)&lt;/div&gt;&lt;div&gt;000000001addec70&nbsp;000007fe9a28bd6f&nbsp;***&nbsp;ERROR:&nbsp;Module&nbsp;load&nbsp;completed&nbsp;but&nbsp;symbols&nbsp;could&nbsp;not&nbsp;be&nbsp;loaded&nbsp;for&nbsp;Accounting.UsageHost.dll&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;follow&nbsp;the&nbsp;stack&nbsp;trace&nbsp;through&nbsp;the&nbsp;.NET&nbsp;client&nbsp;source&nbsp;code,&nbsp;you'll&nbsp;notice&nbsp;that&nbsp;a&nbsp;few&nbsp;of&nbsp;the&nbsp;methods&nbsp;are&nbsp;missing.&nbsp;&nbsp;These&nbsp;have&nbsp;been&nbsp;optimized&nbsp;away&nbsp;by&nbsp;the&nbsp;compiler&nbsp;when&nbsp;using&nbsp;a&nbsp;&quot;Release&quot;&nbsp;build.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;highlighted&nbsp;exactly&nbsp;where&nbsp;the&nbsp;problem&nbsp;is&nbsp;above&nbsp;and&nbsp;if&nbsp;you&nbsp;follow&nbsp;the&nbsp;source&nbsp;code,&nbsp;you'll&nbsp;find&nbsp;the&nbsp;problem&nbsp;right&nbsp;here:&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;a&nbsp;href=&quot;http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/e399c21792d7/projects/client/RabbitMQ.Client/src/client/api/SslHelper.cs#l97&quot;&nbsp;target=&quot;_blank&quot;&nbsp;onmousedown=&quot;this.href='http://www.google.com/url?q\75http%3A%2F%2Fhg.rabbitmq.com%2Frabbitmq-dotnet-client%2Ffile%2Fe399c21792d7%2Fprojects%2Fclient%2FRabbitMQ.Client%2Fsrc%2Fclient%2Fapi%2FSslHelper.cs%23l97\46sa\75D\46sntz\0751\46usg\75AFQjCNEibxI1M93CksT-L45_oZsSZRL11Q';return&nbsp;true;&quot;&nbsp;onclick=&quot;this.href='http://www.google.com/url?q\75http%3A%2F%2Fhg.rabbitmq.com%2Frabbitmq-dotnet-client%2Ffile%2Fe399c21792d7%2Fprojects%2Fclient%2FRabbitMQ.Client%2Fsrc%2Fclient%2Fapi%2FSslHelper.cs%23l97\46sa\75D\46sntz\0751\46usg\75AFQjCNEibxI1M93CksT-L45_oZsSZRL11Q';return&nbsp;true;&quot;&gt;http://hg.rabbitmq.com/&lt;wbr&gt;rabbitmq-dotnet-client/file/&lt;wbr&gt;e399c21792d7/projects/client/&lt;wbr&gt;RabbitMQ.Client/src/client/&lt;wbr&gt;api/SslHelper.cs#l97&lt;/a&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;there&nbsp;is&nbsp;&lt;b&gt;no&nbsp;timeout&lt;/b&gt;&nbsp;value&nbsp;configured&nbsp;for&nbsp;SSL&nbsp;connections.&nbsp;&nbsp;This&nbsp;means&nbsp;that&nbsp;the&nbsp;SSL&nbsp;connection&nbsp;attempt&nbsp;will&nbsp;hang&nbsp;indefinitely.&nbsp;&nbsp;And&nbsp;since&nbsp;the&nbsp;connection&nbsp;doesn't&nbsp;exist&nbsp;yet,&nbsp;there's&nbsp;no&nbsp;way&nbsp;for&nbsp;any&nbsp;kind&nbsp;of&nbsp;heartbeat&nbsp;thread&nbsp;to&nbsp;tear&nbsp;things&nbsp;down.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;.NET&nbsp;docs&nbsp;also&nbsp;state&nbsp;that&nbsp;the&nbsp;default&nbsp;read/write&nbsp;timeout&nbsp;is&nbsp;&lt;a&nbsp;href=&quot;http://msdn.microsoft.com/en-us/library/system.net.security.sslstream.readtimeout(v=vs.110).aspx&quot;&nbsp;target=&quot;_blank&quot;&nbsp;onmousedown=&quot;this.href='http://www.google.com/url?q\75http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fsystem.net.security.sslstream.readtimeout(v%3Dvs.110).aspx\46sa\75D\46sntz\0751\46usg\75AFQjCNEw2HRiijYJ4eA4gCiL9T2oCi2JCg';return&nbsp;true;&quot;&nbsp;onclick=&quot;this.href='http://www.google.com/url?q\75http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fsystem.net.security.sslstream.readtimeout(v%3Dvs.110).aspx\46sa\75D\46sntz\0751\46usg\75AFQjCNEw2HRiijYJ4eA4gCiL9T2oCi2JCg';return&nbsp;true;&quot;&gt;set&nbsp;to&nbsp;Infinite&nbsp;by&nbsp;default&lt;/a&gt;.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;simple&nbsp;fix&nbsp;is&nbsp;as&nbsp;follows:&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);font-family:Helvetica,arial,freesans,clean,sans-serif;font-size:14px;line-height:23.799999237060547px&quot;&gt;sslStream.ReadTimeout&nbsp;=&nbsp;connectionTimeout;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);font-family:Helvetica,arial,freesans,clean,sans-serif;font-size:14px;line-height:23.799999237060547px&quot;&gt;sslStream.WriteTimeout=&lt;wbr&gt;connectionTimout;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);font-family:Helvetica,arial,freesans,clean,sans-serif;font-size:14px;line-height:23.799999237060547px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);font-family:Helvetica,arial,freesans,clean,sans-serif;font-size:14px;line-height:23.799999237060547px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);font-family:Helvetica,arial,freesans,clean,sans-serif;font-size:14px;line-height:23.799999237060547px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
