<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi&nbsp;all,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I'm&nbsp;testing&nbsp;RabbitMQ&nbsp;AMQP&nbsp;with&nbsp;amqp-ruby&nbsp;library&nbsp;client.&nbsp;The<br>
&nbsp;&nbsp;&nbsp;&nbsp;scenario&nbsp;is&nbsp;1&nbsp;or&nbsp;2&nbsp;producers&nbsp;sending&nbsp;little&nbsp;messages&nbsp;from&nbsp;about&nbsp;50<br>
&nbsp;&nbsp;&nbsp;&nbsp;KB&nbsp;to&nbsp;one&nbsp;queue&nbsp;(the&nbsp;idea&nbsp;is&nbsp;increase&nbsp;this&nbsp;amount&nbsp;of&nbsp;KB)&amp;nbsp;&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;various&nbsp;consumers.&amp;nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;problem&nbsp;comes&nbsp;when&nbsp;there's&nbsp;no&nbsp;delay&nbsp;when&nbsp;producer&nbsp;is&nbsp;enqueuing<br>
&nbsp;&nbsp;&nbsp;&nbsp;messages,&nbsp;this&nbsp;is&nbsp;the&nbsp;basic&nbsp;code&nbsp;(where&nbsp;variable&nbsp;&lt;i&gt;productor_time&lt;/i&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;the&nbsp;time&nbsp;between&nbsp;enqueuing&nbsp;messages):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[...]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;small&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;EventMachine.add_periodic_timer(&nbsp;productor_time<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;do&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;exchange.publish&nbsp;message,&nbsp;:routing_key&nbsp;=&amp;gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;queue0&quot;,&nbsp;:persistent&nbsp;=&amp;gt;&nbsp;(true)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;progress(1)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;end&lt;/small&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[...]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;When&nbsp;&lt;i&gt;productor_time&lt;/i&gt;&nbsp;is&nbsp;0,&nbsp;it&nbsp;seems&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;collapse<br>
&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;a&nbsp;moment,&nbsp;and&nbsp;publishers&nbsp;are&nbsp;enqueuing&nbsp;messages&nbsp;but&nbsp;consumers<br>
&nbsp;&nbsp;&nbsp;&nbsp;don't&nbsp;dequeue&nbsp;message&nbsp;and&nbsp;so&nbsp;the&nbsp;RAM&nbsp;memory&nbsp;and&nbsp;SWAP&nbsp;memory&nbsp;increase<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;crash&nbsp;of&nbsp;the&nbsp;machine.&nbsp;If&nbsp;&lt;i&gt;productor_time&lt;/i&gt;&nbsp;is&nbsp;more&nbsp;than<br>
&nbsp;&nbsp;&nbsp;&nbsp;0,&nbsp;for&nbsp;example&nbsp;0.1,&nbsp;there's&nbsp;no&nbsp;problem&nbsp;and&nbsp;consumers&nbsp;dequeue<br>
&nbsp;&nbsp;&nbsp;&nbsp;messages&nbsp;normally.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;code&nbsp;for&nbsp;consumer:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;small&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;queue.subscribe(:ack&nbsp;=&amp;gt;&nbsp;true)&nbsp;do&nbsp;|header,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message|&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;messages&nbsp;&amp;lt;&amp;lt;&nbsp;message&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;header.ack&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;progress(1)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;end&lt;/small&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;I&nbsp;try&nbsp;with&nbsp;ruby-STOMP&nbsp;interface&nbsp;this&nbsp;problem&nbsp;is&nbsp;not&nbsp;present.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Do&nbsp;you&nbsp;know&nbsp;what&nbsp;is&nbsp;happening&nbsp;here?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Cheers,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Pablo&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
