<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;&lt;div&gt;Oops&nbsp;-&nbsp;sent&nbsp;this&nbsp;to&nbsp;that&nbsp;pesky&nbsp;google&nbsp;group&nbsp;by&nbsp;mistake.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Begin&nbsp;forwarded&nbsp;message:&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;Tim&nbsp;Watson&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:watson.timothy@gmail.com&quot;&gt;watson.timothy@gmail.com&lt;/a&gt;&amp;gt;&lt;br&gt;&lt;b&gt;Date:&lt;/b&gt;&nbsp;26&nbsp;June&nbsp;2012&nbsp;09:45:37&nbsp;GMT+01:00&lt;br&gt;&lt;b&gt;To:&lt;/b&gt;&nbsp;Ed&nbsp;Levin&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:ed@cloudservicesdepot.com&quot;&gt;ed@cloudservicesdepot.com&lt;/a&gt;&amp;gt;&lt;br&gt;&lt;b&gt;Cc:&lt;/b&gt;&nbsp;&quot;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@googlegroups.com&quot;&gt;rabbitmq-discuss@googlegroups.com&lt;/a&gt;&quot;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@googlegroups.com&quot;&gt;rabbitmq-discuss@googlegroups.com&lt;/a&gt;&amp;gt;&lt;br&gt;&lt;b&gt;Subject:&lt;/b&gt;&nbsp;&lt;b&gt;Re:&nbsp;[rabbitmq-discuss]&nbsp;Sequential&nbsp;processing&nbsp;for&nbsp;groups&nbsp;of&nbsp;messages&nbsp;with&nbsp;a&nbsp;multi-consumer&nbsp;setup&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;span&gt;You&nbsp;might&nbsp;want&nbsp;to&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;Matthew&nbsp;Sackman's&nbsp;consistent&nbsp;hash&nbsp;exchange.&nbsp;Providing&nbsp;you&nbsp;use&nbsp;the&nbsp;ticket&nbsp;ID&nbsp;as&nbsp;the&nbsp;routing&nbsp;key,&nbsp;this&nbsp;can&nbsp;ensure&nbsp;that&nbsp;all&nbsp;messages&nbsp;with&nbsp;the&nbsp;same&nbsp;routing&nbsp;key&nbsp;will&nbsp;end&nbsp;up&nbsp;on&nbsp;the&nbsp;same&nbsp;exchange.&nbsp;You&nbsp;could&nbsp;then&nbsp;create&nbsp;a&nbsp;queue&nbsp;and&nbsp;bind&nbsp;it&nbsp;to&nbsp;the&nbsp;exchange,&nbsp;adding&nbsp;a&nbsp;single&nbsp;consumer.&nbsp;If&nbsp;only&nbsp;one&nbsp;message&nbsp;per&nbsp;unique&nbsp;ticket&nbsp;ID&nbsp;is&nbsp;allowed&nbsp;to&nbsp;proceed&nbsp;at&nbsp;any&nbsp;given&nbsp;time,&nbsp;you'll&nbsp;ensure&nbsp;the&nbsp;semantics&nbsp;that&nbsp;way,&nbsp;but&nbsp;of&nbsp;course&nbsp;if&nbsp;processing&nbsp;takes&nbsp;a&nbsp;long&nbsp;time,&nbsp;you&nbsp;could&nbsp;end&nbsp;up&nbsp;with&nbsp;a&nbsp;backlog&nbsp;on&nbsp;the&nbsp;queue&nbsp;reducing&nbsp;performance.&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;Another&nbsp;approach&nbsp;would&nbsp;be&nbsp;to&nbsp;have&nbsp;the&nbsp;single&nbsp;consumer&nbsp;drain&nbsp;the&nbsp;queue&nbsp;continuously&nbsp;an&nbsp;hand&nbsp;off&nbsp;messages&nbsp;immediately&nbsp;to&nbsp;a&nbsp;worker&nbsp;in&nbsp;your&nbsp;application.&nbsp;Protect&nbsp;that&nbsp;worker&nbsp;with&nbsp;a&nbsp;blocking&nbsp;queue&nbsp;(or&nbsp;whatever&nbsp;barrier&nbsp;technique&nbsp;your&nbsp;chosen&nbsp;platform&nbsp;supports)&nbsp;and&nbsp;it'll&nbsp;process&nbsp;tasks&nbsp;sequentially,&nbsp;but&nbsp;the&nbsp;consumption&nbsp;of&nbsp;messages&nbsp;from&nbsp;the&nbsp;rabbit&nbsp;queue&nbsp;won't&nbsp;be&nbsp;held&nbsp;up.&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;You&nbsp;assert&nbsp;below&nbsp;that&nbsp;having&nbsp;a&nbsp;single&nbsp;consumer&nbsp;per&nbsp;queue&nbsp;doesn't&nbsp;scale,&nbsp;but&nbsp;AFAICT&nbsp;no&nbsp;matter&nbsp;how&nbsp;much&nbsp;acrobatics&nbsp;you&nbsp;perform,&nbsp;you&nbsp;can't&nbsp;get&nbsp;away&nbsp;from&nbsp;the&nbsp;fact&nbsp;that&nbsp;each&nbsp;ticket&nbsp;ID&nbsp;has&nbsp;to&nbsp;be&nbsp;handled&nbsp;sequentially.&nbsp;The&nbsp;parallelism&nbsp;you&nbsp;want&nbsp;therefore,&nbsp;lies&nbsp;in&nbsp;consuming&nbsp;messages&nbsp;as&nbsp;they&nbsp;arrive&nbsp;without&nbsp;blocking&nbsp;delivery&nbsp;of&nbsp;new&nbsp;ones.&nbsp;A&nbsp;consumer&nbsp;per&nbsp;ticket&nbsp;ID&nbsp;makes&nbsp;sense&nbsp;in&nbsp;that&nbsp;situation&nbsp;(I&nbsp;would've&nbsp;thought)&nbsp;and&nbsp;&amp;nbsp;pairing&nbsp;the&nbsp;consumer&nbsp;thread&nbsp;with&nbsp;a&nbsp;worker&nbsp;(thread)&nbsp;means&nbsp;you&nbsp;don't&nbsp;have&nbsp;to&nbsp;block&nbsp;incoming&nbsp;messages.&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;In&nbsp;that&nbsp;scenario,&nbsp;you're&nbsp;using&nbsp;rabbit's&nbsp;consistent&nbsp;hash&nbsp;exchange&nbsp;to&nbsp;make&nbsp;sure&nbsp;you&nbsp;know&nbsp;where&nbsp;a&nbsp;particular&nbsp;ticket&nbsp;ID&nbsp;will&nbsp;end&nbsp;up,&nbsp;using&nbsp;temporary&nbsp;queues&nbsp;(bound&nbsp;to&nbsp;the&nbsp;exchange)&nbsp;to&nbsp;allow&nbsp;a&nbsp;consumer&nbsp;per&nbsp;ticket&nbsp;ID&nbsp;and&nbsp;handing&nbsp;the&nbsp;concurrency&nbsp;issue&nbsp;where&nbsp;it&nbsp;belongs&nbsp;-&nbsp;in&nbsp;the&nbsp;application&nbsp;logic.&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;With&nbsp;this&nbsp;kind&nbsp;of&nbsp;design,&nbsp;you&nbsp;would&nbsp;of&nbsp;course&nbsp;have&nbsp;to&nbsp;deal&nbsp;with&nbsp;creating&nbsp;new&nbsp;exchanges&nbsp;and&nbsp;binding&nbsp;them&nbsp;to&nbsp;ticket&nbsp;IDs&nbsp;whenever&nbsp;you&nbsp;do&nbsp;not&nbsp;have&nbsp;an&nbsp;existing&nbsp;binding&nbsp;in&nbsp;place&nbsp;for&nbsp;them&nbsp;already.&nbsp;This&nbsp;will&nbsp;require&nbsp;a&nbsp;control&nbsp;channel,&nbsp;which&nbsp;could&nbsp;take&nbsp;advantage&nbsp;of&nbsp;a&nbsp;default&nbsp;exchange.&nbsp;You&nbsp;might&nbsp;also&nbsp;want&nbsp;to&nbsp;think&nbsp;about&nbsp;housekeeping&nbsp;for&nbsp;ticket&nbsp;IDs&nbsp;that&nbsp;are&nbsp;no&nbsp;longer&nbsp;active&nbsp;(perhaps&nbsp;after&nbsp;some&nbsp;period&nbsp;of&nbsp;time).&nbsp;You'll&nbsp;potentially&nbsp;want&nbsp;to&nbsp;shut&nbsp;down&nbsp;consumers&nbsp;once&nbsp;they've&nbsp;been&nbsp;inactive&nbsp;for&nbsp;some&nbsp;period&nbsp;of&nbsp;time,&nbsp;closing&nbsp;the&nbsp;queue&nbsp;and&nbsp;removing&nbsp;the&nbsp;exchange.&nbsp;The&nbsp;consumer&nbsp;is&nbsp;really&nbsp;in&nbsp;the&nbsp;best&nbsp;position&nbsp;to&nbsp;handle&nbsp;this,&nbsp;as&nbsp;it&nbsp;can&nbsp;easily&nbsp;keep&nbsp;a&nbsp;timer&nbsp;or&nbsp;do&nbsp;non&nbsp;blocking&nbsp;reads.&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;The&nbsp;advantage&nbsp;of&nbsp;the&nbsp;consistent&nbsp;hash&nbsp;exchange&nbsp;in&nbsp;this&nbsp;architecture,&nbsp;is&nbsp;that&nbsp;it&nbsp;will&nbsp;cope&nbsp;with&nbsp;the&nbsp;changing&nbsp;schematics&nbsp;of&nbsp;exchanges&nbsp;and&nbsp;bindings&nbsp;without&nbsp;requiring&nbsp;explicit&nbsp;reconfiguration&nbsp;all&nbsp;the&nbsp;time,&nbsp;although&nbsp;there&nbsp;may&nbsp;be&nbsp;some&nbsp;scenarios&nbsp;in&nbsp;which&nbsp;explicit&nbsp;application&nbsp;intervention&nbsp;would&nbsp;make&nbsp;sense.&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;HTH.&nbsp;&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;Tim&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;On&nbsp;26&nbsp;Jun&nbsp;2012,&nbsp;at&nbsp;03:30,&nbsp;Ed&nbsp;Levin&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:ed@cloudservicesdepot.com&quot;&gt;ed@cloudservicesdepot.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;Hi,&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;I&nbsp;am&nbsp;considering&nbsp;RabbitMQ&nbsp;for&nbsp;a&nbsp;project&nbsp;with&nbsp;the&nbsp;following&nbsp;requirement&nbsp;and&nbsp;wanted&nbsp;to&nbsp;get&nbsp;some&nbsp;feedback&nbsp;since&nbsp;I&nbsp;am&nbsp;relatively&nbsp;new&nbsp;to&nbsp;message&nbsp;queuing:&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;To&nbsp;start,&nbsp;I&nbsp;have&nbsp;a&nbsp;queue&nbsp;with&nbsp;a&nbsp;number&nbsp;of&nbsp;consumers&nbsp;assigned&nbsp;for&nbsp;concurrent&nbsp;processing.&nbsp;The&nbsp;messages&nbsp;published&nbsp;to&nbsp;a&nbsp;queue&nbsp;will&nbsp;represent&nbsp;tickets&nbsp;coming&nbsp;from&nbsp;a&nbsp;ticketing&nbsp;system&nbsp;and&nbsp;some&nbsp;may&nbsp;be&nbsp;associated&nbsp;with&nbsp;the&nbsp;same&nbsp;ticket&nbsp;(e.g.&nbsp;same&nbsp;ticket&nbsp;number&nbsp;on&nbsp;different&nbsp;messages&nbsp;in&nbsp;the&nbsp;queue).&nbsp;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;I&nbsp;can&nbsp;only&nbsp;consume&nbsp;(work&nbsp;on)&nbsp;a&nbsp;single&nbsp;message&nbsp;belonging&nbsp;to&nbsp;a&nbsp;given&nbsp;ticket&nbsp;at&nbsp;a&nbsp;time&nbsp;to&nbsp;avoid&nbsp;external&nbsp;concurrency&nbsp;issues.&nbsp;In&nbsp;other&nbsp;words,&nbsp;if&nbsp;consumer&nbsp;A&nbsp;is&nbsp;working&nbsp;on&nbsp;a&nbsp;message&nbsp;representing&nbsp;ticket&nbsp;1&nbsp;and,&nbsp;at&nbsp;the&nbsp;same&nbsp;time,&nbsp;consumer&nbsp;B&nbsp;is&nbsp;available&nbsp;and&nbsp;is&nbsp;assigned&nbsp;the&nbsp;next&nbsp;message&nbsp;from&nbsp;the&nbsp;queue&nbsp;that&nbsp;also&nbsp;represents&nbsp;ticket&nbsp;1,&nbsp;we&nbsp;have&nbsp;a&nbsp;problem.&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;So&nbsp;far&nbsp;I&nbsp;am&nbsp;considering&nbsp;two&nbsp;possible&nbsp;options:&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;1.&nbsp;Dynamically&nbsp;create&nbsp;a&nbsp;temp&nbsp;queue&nbsp;per&nbsp;new&nbsp;unique&nbsp;ticket&nbsp;that&nbsp;arrives,&nbsp;and&nbsp;in&nbsp;effect&nbsp;sort&nbsp;messages&nbsp;into&nbsp;their&nbsp;own&nbsp;queues&nbsp;by&nbsp;ticket&nbsp;number.&nbsp;The&nbsp;problem&nbsp;with&nbsp;this&nbsp;(if&nbsp;even&nbsp;possible)&nbsp;is&nbsp;how&nbsp;to&nbsp;manage&nbsp;consumers&nbsp;for&nbsp;the&nbsp;temp&nbsp;queues.&nbsp;If&nbsp;I&nbsp;assign&nbsp;a&nbsp;single&nbsp;consumer&nbsp;to&nbsp;each&nbsp;queue,&nbsp;the&nbsp;system&nbsp;does&nbsp;not&nbsp;scale,&nbsp;if&nbsp;I&nbsp;assign&nbsp;a&nbsp;consumer&nbsp;to&nbsp;multiple&nbsp;queues&nbsp;I&nbsp;am&nbsp;back&nbsp;to&nbsp;the&nbsp;original&nbsp;problem.&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;2.Keep&nbsp;a&nbsp;single&nbsp;queue&nbsp;with&nbsp;multiple&nbsp;consumers&nbsp;assigned&nbsp;and&nbsp;implement&nbsp;a&nbsp;cache&nbsp;to&nbsp;track&nbsp;ticket&nbsp;numbers&nbsp;currently&nbsp;being&nbsp;processed.&nbsp;When&nbsp;a&nbsp;consumer&nbsp;receives&nbsp;a&nbsp;new&nbsp;message,&nbsp;it&nbsp;first&nbsp;checks&nbsp;the&nbsp;cache&nbsp;to&nbsp;see&nbsp;if&nbsp;a&nbsp;given&nbsp;ticket&nbsp;is&nbsp;already&nbsp;being&nbsp;processed.&nbsp;If&nbsp;so,&nbsp;re-queue&nbsp;the&nbsp;message,&nbsp;otherwise&nbsp;add&nbsp;to&nbsp;cache.&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;I&nbsp;am&nbsp;leaning&nbsp;towards&nbsp;option&nbsp;2&nbsp;but&nbsp;appreciate&nbsp;any&nbsp;feedback&nbsp;and&nbsp;wisdom&nbsp;from&nbsp;the&nbsp;community&nbsp;(perhaps&nbsp;I&nbsp;am&nbsp;missing&nbsp;something&nbsp;obvious).&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;Thank&nbsp;you,&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;-Ed&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;_______________________________________________&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
