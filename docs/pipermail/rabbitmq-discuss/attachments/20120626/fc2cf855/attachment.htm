<tt>
Hi&nbsp;Max,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;you&nbsp;have&nbsp;only&nbsp;*one*&nbsp;queue.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&quot;Fanout&quot;&nbsp;not&nbsp;telling&nbsp;an&nbsp;exchange&nbsp;to&nbsp;distribute&nbsp;messages&nbsp;to&nbsp;different&nbsp;consumers,&nbsp;but&nbsp;to&nbsp;different&nbsp;queues.&nbsp;So,&nbsp;you&nbsp;need&nbsp;at&nbsp;least&nbsp;two&nbsp;queues&nbsp;binding&nbsp;to&nbsp;a&nbsp;&quot;fanout&quot;&nbsp;exchange.&nbsp;Then&nbsp;let&nbsp;your&nbsp;two&nbsp;consumers&nbsp;get&nbsp;message&nbsp;from&nbsp;those&nbsp;two&nbsp;queues,&nbsp;one&nbsp;consumer&nbsp;to&nbsp;one&nbsp;queue.&lt;br&gt;&lt;br&gt;On&nbsp;Sunday,&nbsp;June&nbsp;17,&nbsp;2012&nbsp;4:27:15&nbsp;PM&nbsp;UTC+8,&nbsp;Max&nbsp;Beutel&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;I&nbsp;am&nbsp;using&nbsp;the&nbsp;AMQP&nbsp;pecl&nbsp;extension&nbsp;(&lt;a&nbsp;href=&quot;http://pecl.php.net/package/amqp&quot;&nbsp;target=&quot;_blank&quot;&gt;http://pecl.php.net/package/&lt;wbr&gt;amqp&lt;/a&gt;)&nbsp;for&nbsp;connecting&nbsp;to&nbsp;rabbitMQ&nbsp;from&nbsp;my&nbsp;PHP&nbsp;app.&nbsp;I&nbsp;have&nbsp;the&nbsp;following&nbsp;scripts:&lt;br&gt;&lt;br&gt;producer.php:&lt;br&gt;&lt;br&gt;$cnn&nbsp;=&nbsp;new&nbsp;AMQPConnection();&lt;br&gt;$cnn-&amp;gt;connect();&lt;br&gt;&lt;br&gt;$ch&nbsp;=&nbsp;new&nbsp;AMQPChannel($cnn);&lt;br&gt;&lt;br&gt;$ex&nbsp;=&nbsp;new&nbsp;AMQPExchange($ch);&lt;br&gt;$ex-&amp;gt;setName('ex2');&lt;br&gt;$ex-&amp;gt;setType(AMQP_EX_TYPE_&lt;wbr&gt;FANOUT);&lt;br&gt;$ex-&amp;gt;declare();&lt;br&gt;&lt;br&gt;$q&nbsp;=&nbsp;new&nbsp;AMQPQueue($ch);&lt;br&gt;$q-&amp;gt;setName('test1243');&lt;br&gt;$q-&amp;gt;setFlags(AMQP_DURABLE);&lt;br&gt;$q-&amp;gt;declare();&lt;br&gt;$q-&amp;gt;bind('ex2',&nbsp;'routing.key');&lt;br&gt;&lt;br&gt;for&nbsp;($i&nbsp;=&nbsp;0;&nbsp;$i&nbsp;&amp;lt;&nbsp;100;&nbsp;$i++)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$ex-&amp;gt;publish('msg&nbsp;'&nbsp;.&nbsp;($i&nbsp;+1),&nbsp;'routing.key');&lt;br&gt;}&lt;br&gt;&lt;br&gt;The&nbsp;producer&nbsp;publishes&nbsp;100&nbsp;messages.&nbsp;&lt;br&gt;&lt;br&gt;Then&nbsp;I&nbsp;have&nbsp;a&nbsp;consumer.php:&lt;br&gt;&lt;br&gt;$cnn&nbsp;=&nbsp;new&nbsp;AMQPConnection();&lt;br&gt;$cnn-&amp;gt;connect();&lt;br&gt;&lt;br&gt;//&nbsp;Create&nbsp;a&nbsp;channel&lt;br&gt;$ch&nbsp;=&nbsp;new&nbsp;AMQPChannel($cnn);&lt;br&gt;&lt;br&gt;$q&nbsp;=&nbsp;new&nbsp;AMQPQueue($ch);&lt;br&gt;$q-&amp;gt;setName('test1243');&lt;br&gt;$q-&amp;gt;setFlags(AMQP_DURABLE);&lt;br&gt;$q-&amp;gt;declare();&lt;br&gt;$q-&amp;gt;bind('ex2',&nbsp;'routing.key');&lt;br&gt;&lt;br&gt;$ex&nbsp;=&nbsp;new&nbsp;AMQPExchange($ch);&lt;br&gt;$ex-&amp;gt;setName('ex2');&lt;br&gt;$ex-&amp;gt;setType(AMQP_EX_TYPE_&lt;wbr&gt;FANOUT);&lt;br&gt;$ex-&amp;gt;declare();&lt;br&gt;&lt;br&gt;function&nbsp;processMessage($envelope,&nbsp;$queue)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;echo&nbsp;&quot;Message&nbsp;$i:&nbsp;&quot;&nbsp;.&nbsp;$envelope-&amp;gt;getBody()&nbsp;.&nbsp;&quot;\n&quot;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$queue-&amp;gt;ack($envelope-&amp;gt;&lt;wbr&gt;getDeliveryTag());&lt;br&gt;}&lt;br&gt;&lt;br&gt;$q-&amp;gt;consume(&quot;processMessage&quot;);&lt;br&gt;&lt;br&gt;The&nbsp;consumer&nbsp;just&nbsp;writes&nbsp;the&nbsp;messages&nbsp;to&nbsp;stdout&nbsp;and&nbsp;ack´s&nbsp;them.&nbsp;&lt;br&gt;&lt;br&gt;I&nbsp;used&nbsp;the&nbsp;exchange&nbsp;type&nbsp;fanout,&nbsp;because&nbsp;I&nbsp;want&nbsp;each&nbsp;message&nbsp;from&nbsp;the&nbsp;producer&nbsp;delivered&nbsp;to&nbsp;each&nbsp;consumer.&nbsp;&lt;br&gt;&lt;br&gt;But&nbsp;if&nbsp;I&nbsp;start&nbsp;2&nbsp;consumers&nbsp;the&nbsp;output&nbsp;looks&nbsp;like&nbsp;this:&lt;br&gt;&lt;br&gt;output&nbsp;consumer1:&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;1&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;3&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;5&lt;br&gt;...&lt;br&gt;&lt;br&gt;output&nbsp;consumer2:&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;2&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;4&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;6&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;8&lt;br&gt;...&lt;br&gt;&lt;br&gt;It&nbsp;looks&nbsp;like&nbsp;the&nbsp;messages&nbsp;are&nbsp;distributed&nbsp;using&nbsp;round&nbsp;robin&nbsp;or&nbsp;the&nbsp;like,&nbsp;consumer&nbsp;1&nbsp;gets&nbsp;message&nbsp;1,&nbsp;consumer&nbsp;2&nbsp;gets&nbsp;message&nbsp;2&nbsp;etc.&nbsp;&lt;br&gt;&lt;br&gt;Is&nbsp;fanout&nbsp;the&nbsp;wrong&nbsp;exchange&nbsp;for&nbsp;this?&nbsp;Or&nbsp;is&nbsp;something&nbsp;wrong&nbsp;in&nbsp;my&nbsp;setup&nbsp;code?&lt;br&gt;Defining&nbsp;the&nbsp;routing&nbsp;key&nbsp;is&nbsp;probably&nbsp;usesless&nbsp;as&nbsp;this&nbsp;is&nbsp;ignored&nbsp;in&nbsp;fanout&nbsp;anway,&nbsp;right?&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;On&nbsp;Sunday,&nbsp;June&nbsp;17,&nbsp;2012&nbsp;4:27:15&nbsp;PM&nbsp;UTC+8,&nbsp;Max&nbsp;Beutel&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;I&nbsp;am&nbsp;using&nbsp;the&nbsp;AMQP&nbsp;pecl&nbsp;extension&nbsp;(&lt;a&nbsp;href=&quot;http://pecl.php.net/package/amqp&quot;&nbsp;target=&quot;_blank&quot;&gt;http://pecl.php.net/package/&lt;wbr&gt;amqp&lt;/a&gt;)&nbsp;for&nbsp;connecting&nbsp;to&nbsp;rabbitMQ&nbsp;from&nbsp;my&nbsp;PHP&nbsp;app.&nbsp;I&nbsp;have&nbsp;the&nbsp;following&nbsp;scripts:&lt;br&gt;&lt;br&gt;producer.php:&lt;br&gt;&lt;br&gt;$cnn&nbsp;=&nbsp;new&nbsp;AMQPConnection();&lt;br&gt;$cnn-&amp;gt;connect();&lt;br&gt;&lt;br&gt;$ch&nbsp;=&nbsp;new&nbsp;AMQPChannel($cnn);&lt;br&gt;&lt;br&gt;$ex&nbsp;=&nbsp;new&nbsp;AMQPExchange($ch);&lt;br&gt;$ex-&amp;gt;setName('ex2');&lt;br&gt;$ex-&amp;gt;setType(AMQP_EX_TYPE_&lt;wbr&gt;FANOUT);&lt;br&gt;$ex-&amp;gt;declare();&lt;br&gt;&lt;br&gt;$q&nbsp;=&nbsp;new&nbsp;AMQPQueue($ch);&lt;br&gt;$q-&amp;gt;setName('test1243');&lt;br&gt;$q-&amp;gt;setFlags(AMQP_DURABLE);&lt;br&gt;$q-&amp;gt;declare();&lt;br&gt;$q-&amp;gt;bind('ex2',&nbsp;'routing.key');&lt;br&gt;&lt;br&gt;for&nbsp;($i&nbsp;=&nbsp;0;&nbsp;$i&nbsp;&amp;lt;&nbsp;100;&nbsp;$i++)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$ex-&amp;gt;publish('msg&nbsp;'&nbsp;.&nbsp;($i&nbsp;+1),&nbsp;'routing.key');&lt;br&gt;}&lt;br&gt;&lt;br&gt;The&nbsp;producer&nbsp;publishes&nbsp;100&nbsp;messages.&nbsp;&lt;br&gt;&lt;br&gt;Then&nbsp;I&nbsp;have&nbsp;a&nbsp;consumer.php:&lt;br&gt;&lt;br&gt;$cnn&nbsp;=&nbsp;new&nbsp;AMQPConnection();&lt;br&gt;$cnn-&amp;gt;connect();&lt;br&gt;&lt;br&gt;//&nbsp;Create&nbsp;a&nbsp;channel&lt;br&gt;$ch&nbsp;=&nbsp;new&nbsp;AMQPChannel($cnn);&lt;br&gt;&lt;br&gt;$q&nbsp;=&nbsp;new&nbsp;AMQPQueue($ch);&lt;br&gt;$q-&amp;gt;setName('test1243');&lt;br&gt;$q-&amp;gt;setFlags(AMQP_DURABLE);&lt;br&gt;$q-&amp;gt;declare();&lt;br&gt;$q-&amp;gt;bind('ex2',&nbsp;'routing.key');&lt;br&gt;&lt;br&gt;$ex&nbsp;=&nbsp;new&nbsp;AMQPExchange($ch);&lt;br&gt;$ex-&amp;gt;setName('ex2');&lt;br&gt;$ex-&amp;gt;setType(AMQP_EX_TYPE_&lt;wbr&gt;FANOUT);&lt;br&gt;$ex-&amp;gt;declare();&lt;br&gt;&lt;br&gt;function&nbsp;processMessage($envelope,&nbsp;$queue)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;echo&nbsp;&quot;Message&nbsp;$i:&nbsp;&quot;&nbsp;.&nbsp;$envelope-&amp;gt;getBody()&nbsp;.&nbsp;&quot;\n&quot;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$queue-&amp;gt;ack($envelope-&amp;gt;&lt;wbr&gt;getDeliveryTag());&lt;br&gt;}&lt;br&gt;&lt;br&gt;$q-&amp;gt;consume(&quot;processMessage&quot;);&lt;br&gt;&lt;br&gt;The&nbsp;consumer&nbsp;just&nbsp;writes&nbsp;the&nbsp;messages&nbsp;to&nbsp;stdout&nbsp;and&nbsp;ack´s&nbsp;them.&nbsp;&lt;br&gt;&lt;br&gt;I&nbsp;used&nbsp;the&nbsp;exchange&nbsp;type&nbsp;fanout,&nbsp;because&nbsp;I&nbsp;want&nbsp;each&nbsp;message&nbsp;from&nbsp;the&nbsp;producer&nbsp;delivered&nbsp;to&nbsp;each&nbsp;consumer.&nbsp;&lt;br&gt;&lt;br&gt;But&nbsp;if&nbsp;I&nbsp;start&nbsp;2&nbsp;consumers&nbsp;the&nbsp;output&nbsp;looks&nbsp;like&nbsp;this:&lt;br&gt;&lt;br&gt;output&nbsp;consumer1:&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;1&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;3&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;5&lt;br&gt;...&lt;br&gt;&lt;br&gt;output&nbsp;consumer2:&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;2&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;4&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;6&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;8&lt;br&gt;...&lt;br&gt;&lt;br&gt;It&nbsp;looks&nbsp;like&nbsp;the&nbsp;messages&nbsp;are&nbsp;distributed&nbsp;using&nbsp;round&nbsp;robin&nbsp;or&nbsp;the&nbsp;like,&nbsp;consumer&nbsp;1&nbsp;gets&nbsp;message&nbsp;1,&nbsp;consumer&nbsp;2&nbsp;gets&nbsp;message&nbsp;2&nbsp;etc.&nbsp;&lt;br&gt;&lt;br&gt;Is&nbsp;fanout&nbsp;the&nbsp;wrong&nbsp;exchange&nbsp;for&nbsp;this?&nbsp;Or&nbsp;is&nbsp;something&nbsp;wrong&nbsp;in&nbsp;my&nbsp;setup&nbsp;code?&lt;br&gt;Defining&nbsp;the&nbsp;routing&nbsp;key&nbsp;is&nbsp;probably&nbsp;usesless&nbsp;as&nbsp;this&nbsp;is&nbsp;ignored&nbsp;in&nbsp;fanout&nbsp;anway,&nbsp;right?&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;On&nbsp;Sunday,&nbsp;June&nbsp;17,&nbsp;2012&nbsp;4:27:15&nbsp;PM&nbsp;UTC+8,&nbsp;Max&nbsp;Beutel&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;I&nbsp;am&nbsp;using&nbsp;the&nbsp;AMQP&nbsp;pecl&nbsp;extension&nbsp;(&lt;a&nbsp;href=&quot;http://pecl.php.net/package/amqp&quot;&nbsp;target=&quot;_blank&quot;&gt;http://pecl.php.net/package/&lt;wbr&gt;amqp&lt;/a&gt;)&nbsp;for&nbsp;connecting&nbsp;to&nbsp;rabbitMQ&nbsp;from&nbsp;my&nbsp;PHP&nbsp;app.&nbsp;I&nbsp;have&nbsp;the&nbsp;following&nbsp;scripts:&lt;br&gt;&lt;br&gt;producer.php:&lt;br&gt;&lt;br&gt;$cnn&nbsp;=&nbsp;new&nbsp;AMQPConnection();&lt;br&gt;$cnn-&amp;gt;connect();&lt;br&gt;&lt;br&gt;$ch&nbsp;=&nbsp;new&nbsp;AMQPChannel($cnn);&lt;br&gt;&lt;br&gt;$ex&nbsp;=&nbsp;new&nbsp;AMQPExchange($ch);&lt;br&gt;$ex-&amp;gt;setName('ex2');&lt;br&gt;$ex-&amp;gt;setType(AMQP_EX_TYPE_&lt;wbr&gt;FANOUT);&lt;br&gt;$ex-&amp;gt;declare();&lt;br&gt;&lt;br&gt;$q&nbsp;=&nbsp;new&nbsp;AMQPQueue($ch);&lt;br&gt;$q-&amp;gt;setName('test1243');&lt;br&gt;$q-&amp;gt;setFlags(AMQP_DURABLE);&lt;br&gt;$q-&amp;gt;declare();&lt;br&gt;$q-&amp;gt;bind('ex2',&nbsp;'routing.key');&lt;br&gt;&lt;br&gt;for&nbsp;($i&nbsp;=&nbsp;0;&nbsp;$i&nbsp;&amp;lt;&nbsp;100;&nbsp;$i++)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$ex-&amp;gt;publish('msg&nbsp;'&nbsp;.&nbsp;($i&nbsp;+1),&nbsp;'routing.key');&lt;br&gt;}&lt;br&gt;&lt;br&gt;The&nbsp;producer&nbsp;publishes&nbsp;100&nbsp;messages.&nbsp;&lt;br&gt;&lt;br&gt;Then&nbsp;I&nbsp;have&nbsp;a&nbsp;consumer.php:&lt;br&gt;&lt;br&gt;$cnn&nbsp;=&nbsp;new&nbsp;AMQPConnection();&lt;br&gt;$cnn-&amp;gt;connect();&lt;br&gt;&lt;br&gt;//&nbsp;Create&nbsp;a&nbsp;channel&lt;br&gt;$ch&nbsp;=&nbsp;new&nbsp;AMQPChannel($cnn);&lt;br&gt;&lt;br&gt;$q&nbsp;=&nbsp;new&nbsp;AMQPQueue($ch);&lt;br&gt;$q-&amp;gt;setName('test1243');&lt;br&gt;$q-&amp;gt;setFlags(AMQP_DURABLE);&lt;br&gt;$q-&amp;gt;declare();&lt;br&gt;$q-&amp;gt;bind('ex2',&nbsp;'routing.key');&lt;br&gt;&lt;br&gt;$ex&nbsp;=&nbsp;new&nbsp;AMQPExchange($ch);&lt;br&gt;$ex-&amp;gt;setName('ex2');&lt;br&gt;$ex-&amp;gt;setType(AMQP_EX_TYPE_&lt;wbr&gt;FANOUT);&lt;br&gt;$ex-&amp;gt;declare();&lt;br&gt;&lt;br&gt;function&nbsp;processMessage($envelope,&nbsp;$queue)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;echo&nbsp;&quot;Message&nbsp;$i:&nbsp;&quot;&nbsp;.&nbsp;$envelope-&amp;gt;getBody()&nbsp;.&nbsp;&quot;\n&quot;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$queue-&amp;gt;ack($envelope-&amp;gt;&lt;wbr&gt;getDeliveryTag());&lt;br&gt;}&lt;br&gt;&lt;br&gt;$q-&amp;gt;consume(&quot;processMessage&quot;);&lt;br&gt;&lt;br&gt;The&nbsp;consumer&nbsp;just&nbsp;writes&nbsp;the&nbsp;messages&nbsp;to&nbsp;stdout&nbsp;and&nbsp;ack´s&nbsp;them.&nbsp;&lt;br&gt;&lt;br&gt;I&nbsp;used&nbsp;the&nbsp;exchange&nbsp;type&nbsp;fanout,&nbsp;because&nbsp;I&nbsp;want&nbsp;each&nbsp;message&nbsp;from&nbsp;the&nbsp;producer&nbsp;delivered&nbsp;to&nbsp;each&nbsp;consumer.&nbsp;&lt;br&gt;&lt;br&gt;But&nbsp;if&nbsp;I&nbsp;start&nbsp;2&nbsp;consumers&nbsp;the&nbsp;output&nbsp;looks&nbsp;like&nbsp;this:&lt;br&gt;&lt;br&gt;output&nbsp;consumer1:&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;1&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;3&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;5&lt;br&gt;...&lt;br&gt;&lt;br&gt;output&nbsp;consumer2:&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;2&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;4&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;6&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;8&lt;br&gt;...&lt;br&gt;&lt;br&gt;It&nbsp;looks&nbsp;like&nbsp;the&nbsp;messages&nbsp;are&nbsp;distributed&nbsp;using&nbsp;round&nbsp;robin&nbsp;or&nbsp;the&nbsp;like,&nbsp;consumer&nbsp;1&nbsp;gets&nbsp;message&nbsp;1,&nbsp;consumer&nbsp;2&nbsp;gets&nbsp;message&nbsp;2&nbsp;etc.&nbsp;&lt;br&gt;&lt;br&gt;Is&nbsp;fanout&nbsp;the&nbsp;wrong&nbsp;exchange&nbsp;for&nbsp;this?&nbsp;Or&nbsp;is&nbsp;something&nbsp;wrong&nbsp;in&nbsp;my&nbsp;setup&nbsp;code?&lt;br&gt;Defining&nbsp;the&nbsp;routing&nbsp;key&nbsp;is&nbsp;probably&nbsp;usesless&nbsp;as&nbsp;this&nbsp;is&nbsp;ignored&nbsp;in&nbsp;fanout&nbsp;anway,&nbsp;right?&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;On&nbsp;Sunday,&nbsp;June&nbsp;17,&nbsp;2012&nbsp;4:27:15&nbsp;PM&nbsp;UTC+8,&nbsp;Max&nbsp;Beutel&nbsp;wrote:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;I&nbsp;am&nbsp;using&nbsp;the&nbsp;AMQP&nbsp;pecl&nbsp;extension&nbsp;(&lt;a&nbsp;href=&quot;http://pecl.php.net/package/amqp&quot;&nbsp;target=&quot;_blank&quot;&gt;http://pecl.php.net/package/&lt;wbr&gt;amqp&lt;/a&gt;)&nbsp;for&nbsp;connecting&nbsp;to&nbsp;rabbitMQ&nbsp;from&nbsp;my&nbsp;PHP&nbsp;app.&nbsp;I&nbsp;have&nbsp;the&nbsp;following&nbsp;scripts:&lt;br&gt;&lt;br&gt;producer.php:&lt;br&gt;&lt;br&gt;$cnn&nbsp;=&nbsp;new&nbsp;AMQPConnection();&lt;br&gt;$cnn-&amp;gt;connect();&lt;br&gt;&lt;br&gt;$ch&nbsp;=&nbsp;new&nbsp;AMQPChannel($cnn);&lt;br&gt;&lt;br&gt;$ex&nbsp;=&nbsp;new&nbsp;AMQPExchange($ch);&lt;br&gt;$ex-&amp;gt;setName('ex2');&lt;br&gt;$ex-&amp;gt;setType(AMQP_EX_TYPE_&lt;wbr&gt;FANOUT);&lt;br&gt;$ex-&amp;gt;declare();&lt;br&gt;&lt;br&gt;$q&nbsp;=&nbsp;new&nbsp;AMQPQueue($ch);&lt;br&gt;$q-&amp;gt;setName('test1243');&lt;br&gt;$q-&amp;gt;setFlags(AMQP_DURABLE);&lt;br&gt;$q-&amp;gt;declare();&lt;br&gt;$q-&amp;gt;bind('ex2',&nbsp;'routing.key');&lt;br&gt;&lt;br&gt;for&nbsp;($i&nbsp;=&nbsp;0;&nbsp;$i&nbsp;&amp;lt;&nbsp;100;&nbsp;$i++)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$ex-&amp;gt;publish('msg&nbsp;'&nbsp;.&nbsp;($i&nbsp;+1),&nbsp;'routing.key');&lt;br&gt;}&lt;br&gt;&lt;br&gt;The&nbsp;producer&nbsp;publishes&nbsp;100&nbsp;messages.&nbsp;&lt;br&gt;&lt;br&gt;Then&nbsp;I&nbsp;have&nbsp;a&nbsp;consumer.php:&lt;br&gt;&lt;br&gt;$cnn&nbsp;=&nbsp;new&nbsp;AMQPConnection();&lt;br&gt;$cnn-&amp;gt;connect();&lt;br&gt;&lt;br&gt;//&nbsp;Create&nbsp;a&nbsp;channel&lt;br&gt;$ch&nbsp;=&nbsp;new&nbsp;AMQPChannel($cnn);&lt;br&gt;&lt;br&gt;$q&nbsp;=&nbsp;new&nbsp;AMQPQueue($ch);&lt;br&gt;$q-&amp;gt;setName('test1243');&lt;br&gt;$q-&amp;gt;setFlags(AMQP_DURABLE);&lt;br&gt;$q-&amp;gt;declare();&lt;br&gt;$q-&amp;gt;bind('ex2',&nbsp;'routing.key');&lt;br&gt;&lt;br&gt;$ex&nbsp;=&nbsp;new&nbsp;AMQPExchange($ch);&lt;br&gt;$ex-&amp;gt;setName('ex2');&lt;br&gt;$ex-&amp;gt;setType(AMQP_EX_TYPE_&lt;wbr&gt;FANOUT);&lt;br&gt;$ex-&amp;gt;declare();&lt;br&gt;&lt;br&gt;function&nbsp;processMessage($envelope,&nbsp;$queue)&nbsp;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;echo&nbsp;&quot;Message&nbsp;$i:&nbsp;&quot;&nbsp;.&nbsp;$envelope-&amp;gt;getBody()&nbsp;.&nbsp;&quot;\n&quot;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;$queue-&amp;gt;ack($envelope-&amp;gt;&lt;wbr&gt;getDeliveryTag());&lt;br&gt;}&lt;br&gt;&lt;br&gt;$q-&amp;gt;consume(&quot;processMessage&quot;);&lt;br&gt;&lt;br&gt;The&nbsp;consumer&nbsp;just&nbsp;writes&nbsp;the&nbsp;messages&nbsp;to&nbsp;stdout&nbsp;and&nbsp;ack´s&nbsp;them.&nbsp;&lt;br&gt;&lt;br&gt;I&nbsp;used&nbsp;the&nbsp;exchange&nbsp;type&nbsp;fanout,&nbsp;because&nbsp;I&nbsp;want&nbsp;each&nbsp;message&nbsp;from&nbsp;the&nbsp;producer&nbsp;delivered&nbsp;to&nbsp;each&nbsp;consumer.&nbsp;&lt;br&gt;&lt;br&gt;But&nbsp;if&nbsp;I&nbsp;start&nbsp;2&nbsp;consumers&nbsp;the&nbsp;output&nbsp;looks&nbsp;like&nbsp;this:&lt;br&gt;&lt;br&gt;output&nbsp;consumer1:&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;1&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;3&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;5&lt;br&gt;...&lt;br&gt;&lt;br&gt;output&nbsp;consumer2:&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;2&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;4&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;6&lt;br&gt;Message&nbsp;:&nbsp;msg&nbsp;8&lt;br&gt;...&lt;br&gt;&lt;br&gt;It&nbsp;looks&nbsp;like&nbsp;the&nbsp;messages&nbsp;are&nbsp;distributed&nbsp;using&nbsp;round&nbsp;robin&nbsp;or&nbsp;the&nbsp;like,&nbsp;consumer&nbsp;1&nbsp;gets&nbsp;message&nbsp;1,&nbsp;consumer&nbsp;2&nbsp;gets&nbsp;message&nbsp;2&nbsp;etc.&nbsp;&lt;br&gt;&lt;br&gt;Is&nbsp;fanout&nbsp;the&nbsp;wrong&nbsp;exchange&nbsp;for&nbsp;this?&nbsp;Or&nbsp;is&nbsp;something&nbsp;wrong&nbsp;in&nbsp;my&nbsp;setup&nbsp;code?&lt;br&gt;Defining&nbsp;the&nbsp;routing&nbsp;key&nbsp;is&nbsp;probably&nbsp;usesless&nbsp;as&nbsp;this&nbsp;is&nbsp;ignored&nbsp;in&nbsp;fanout&nbsp;anway,&nbsp;right?&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;
</tt>
