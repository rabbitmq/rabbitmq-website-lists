<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;<br>
&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&lt;font&nbsp;face=&quot;Calibri&quot;&gt;In&nbsp;regards&nbsp;to&nbsp;the&nbsp;once-and-only-once&nbsp;discussion<br>
below:&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;many&nbsp;financial&nbsp;formats,&nbsp;like&nbsp;FIX&nbsp;and&nbsp;others,&nbsp;we&nbsp;utilize&nbsp;message&nbsp;ID's<br>
that&nbsp;help&nbsp;with&nbsp;this&nbsp;behavior&nbsp;a&nbsp;lot.&amp;nbsp;&nbsp;It&nbsp;also&nbsp;prevents&nbsp;from&nbsp;messages<br>
being&nbsp;delivered&nbsp;out&nbsp;of&nbsp;sequence.&amp;nbsp;&nbsp;For&nbsp;example.&lt;br&gt;<br>
&lt;br&gt;<br>
Client&nbsp;logs&nbsp;in&nbsp;-&nbsp;server&nbsp;and&nbsp;client&nbsp;at&nbsp;message&nbsp;ID&nbsp;of&nbsp;0,&lt;br&gt;<br>
every&nbsp;message&nbsp;that&nbsp;the&nbsp;server&nbsp;sends&nbsp;has&nbsp;an&nbsp;incremented&nbsp;ID,&lt;br&gt;<br>
if&nbsp;the&nbsp;client&nbsp;receives&nbsp;an&nbsp;unexpected&nbsp;ID,&nbsp;it&nbsp;can&nbsp;either&nbsp;request&nbsp;a<br>
retransmit&nbsp;from&nbsp;the&nbsp;last&nbsp;known&nbsp;or&nbsp;kill&nbsp;the&nbsp;session,&lt;br&gt;<br>
when&nbsp;a&nbsp;client&nbsp;logs&nbsp;back&nbsp;in,&nbsp;the&nbsp;client&nbsp;logs&nbsp;in&nbsp;with&nbsp;the&nbsp;expected&nbsp;ID,<br>
server&nbsp;&amp;amp;&nbsp;client&nbsp;negotiate&nbsp;and&nbsp;session&nbsp;resumes.&amp;nbsp;&nbsp;&lt;br&gt;<br>
(there&nbsp;are&nbsp;id's&nbsp;for&nbsp;both&nbsp;the&nbsp;client&nbsp;&amp;amp;&nbsp;server&nbsp;messages,&nbsp;both<br>
incremented&nbsp;for&nbsp;each&nbsp;message&nbsp;and&nbsp;the&nbsp;above&nbsp;behavior&nbsp;applies&nbsp;on&nbsp;both<br>
sides&nbsp;of&nbsp;the&nbsp;connection)&lt;br&gt;<br>
&lt;br&gt;<br>
FIX&nbsp;employs&nbsp;an&nbsp;optimistic&nbsp;delivery&nbsp;protocol,&nbsp;i.e.,&nbsp;assume&nbsp;that&nbsp;it&nbsp;was<br>
received.&amp;nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;session&nbsp;level&nbsp;ack.&amp;nbsp;&nbsp;Only&nbsp;an&nbsp;ack&nbsp;at&nbsp;the<br>
application&nbsp;level;&nbsp;and&nbsp;that&nbsp;ack&nbsp;is&nbsp;not&nbsp;mandatory.&amp;nbsp;&nbsp;Use&nbsp;of&nbsp;the&nbsp;message<br>
ID&nbsp;provides&nbsp;the&nbsp;once&nbsp;&amp;amp;&nbsp;only&nbsp;once&nbsp;and&nbsp;in&nbsp;order&nbsp;semantics&nbsp;required<br>
for&nbsp;trading;&nbsp;a&nbsp;behavior&nbsp;that&nbsp;is&nbsp;obviously&nbsp;very&nbsp;useful&nbsp;elsewhere&nbsp;as&nbsp;well.&lt;br&gt;<br>
&lt;br&gt;<br>
Using&nbsp;sequence&nbsp;#'s&nbsp;also&nbsp;allows&nbsp;for&nbsp;advanced&nbsp;concepts&nbsp;such&nbsp;as&nbsp;flow<br>
control&nbsp;-&nbsp;I&nbsp;haven't&nbsp;read&nbsp;enough&nbsp;of&nbsp;the&nbsp;spec&nbsp;yet&nbsp;to&nbsp;see&nbsp;if&nbsp;that's&nbsp;a<br>
feature&nbsp;yet&nbsp;or&nbsp;not.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;do&nbsp;agree,&nbsp;if&nbsp;a&nbsp;message&nbsp;is&nbsp;sent,&nbsp;then&nbsp;an&nbsp;ack&nbsp;is&nbsp;waited&nbsp;for,&nbsp;sending&nbsp;an<br>
ack&nbsp;of&nbsp;ack&nbsp;seems&nbsp;a&nbsp;little&nbsp;over&nbsp;kill&nbsp;to&nbsp;me.&amp;nbsp;&nbsp;Perhaps&nbsp;it's&nbsp;time&nbsp;for&nbsp;me&nbsp;to<br>
read&nbsp;the&nbsp;whole&nbsp;spec&nbsp;again.&lt;br&gt;<br>
&lt;/font&gt;&lt;br&gt;<br>
On&nbsp;5/10/2010&nbsp;8:37&nbsp;AM,&nbsp;Tim&nbsp;Fox&nbsp;wrote:<br>
&lt;blockquote&nbsp;cite=&quot;mid:4BE80C00.3080204@jboss.com&quot;&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;I've&nbsp;spent&nbsp;this&nbsp;morning&nbsp;going&nbsp;through&nbsp;the&nbsp;1.0.&nbsp;PR3&nbsp;spec,&nbsp;firstly,&nbsp;it's&nbsp;<br>
considerably&nbsp;simpler&nbsp;than&nbsp;0.10,&nbsp;which&nbsp;is&nbsp;great&nbsp;news&nbsp;:)<br>
<br>
Here's&nbsp;my&nbsp;2p:<br>
<br>
One&nbsp;thing&nbsp;I&nbsp;find&nbsp;quite&nbsp;strange&nbsp;is&nbsp;that&nbsp;the&nbsp;core&nbsp;spec&nbsp;doesn't&nbsp;actually&nbsp;<br>
seem&nbsp;to&nbsp;mandate&nbsp;any&nbsp;queueing&nbsp;semantics&nbsp;anywhere.&nbsp;I've&nbsp;nothing&nbsp;<br>
particularly&nbsp;against&nbsp;that&nbsp;-&nbsp;in&nbsp;fact,&nbsp;the&nbsp;idea&nbsp;that&nbsp;a&nbsp;node&nbsp;can&nbsp;do&nbsp;<br>
different&nbsp;types&nbsp;of&nbsp;ordering&nbsp;is&nbsp;actually&nbsp;quite&nbsp;nice,&nbsp;however&nbsp;it's&nbsp;not&nbsp;a&nbsp;<br>
queueing&nbsp;protocol.&nbsp;Shouldn't&nbsp;AMQP&nbsp;therefore&nbsp;be&nbsp;renamed&nbsp;to&nbsp;AMTP&nbsp;(Advanced&nbsp;<br>
Message&nbsp;Transfer&nbsp;Protocol)&nbsp;?&nbsp;;)<br>
<br>
On&nbsp;a&nbsp;more&nbsp;serious&nbsp;note,&nbsp;my&nbsp;main&nbsp;concerns&nbsp;are&nbsp;mainly&nbsp;around&nbsp;complexity,&nbsp;<br>
and&nbsp;verbosity&nbsp;of&nbsp;the&nbsp;wire&nbsp;format.&nbsp;The&nbsp;latter&nbsp;I&nbsp;suppose&nbsp;is&nbsp;not&nbsp;completely&nbsp;<br>
independent&nbsp;from&nbsp;the&nbsp;former.<br>
<br>
Regarding&nbsp;complexity.&nbsp;IMO&nbsp;a&nbsp;large&nbsp;part&nbsp;of&nbsp;the&nbsp;complexity&nbsp;in&nbsp;the&nbsp;spec.&nbsp;<br>
seems&nbsp;to&nbsp;come&nbsp;from&nbsp;the&nbsp;way&nbsp;it&nbsp;tries&nbsp;to&nbsp;provide&nbsp;a&nbsp;once&nbsp;and&nbsp;only&nbsp;once&nbsp;<br>
delivery&nbsp;guarantee.&nbsp;AIUI&nbsp;the&nbsp;way&nbsp;the&nbsp;spec.&nbsp;implements&nbsp;this&nbsp;guarantee&nbsp;is&nbsp;<br>
something&nbsp;like&nbsp;the&nbsp;following&nbsp;when&nbsp;transferring&nbsp;a&nbsp;message&nbsp;from&nbsp;A&nbsp;to&nbsp;B:<br>
<br>
a)&nbsp;message&nbsp;to&nbsp;be&nbsp;sent&nbsp;from&nbsp;A--&amp;gt;B<br>
b)&nbsp;ack&nbsp;sent&nbsp;back&nbsp;from&nbsp;B--&amp;gt;A<br>
c)&nbsp;&quot;ack&nbsp;of&nbsp;ack&quot;&nbsp;sent&nbsp;from&nbsp;A--&amp;gt;B&nbsp;-&nbsp;now&nbsp;the&nbsp;delivery&nbsp;tag&nbsp;can&nbsp;be&nbsp;removed&nbsp;<br>
from&nbsp;the&nbsp;senders&nbsp;cache<br>
<br>
This&nbsp;results&nbsp;in&nbsp;a&nbsp;complex&nbsp;set&nbsp;of&nbsp;message&nbsp;states,&nbsp;and&nbsp;puts&nbsp;the&nbsp;burden&nbsp;on&nbsp;<br>
both&nbsp;sides&nbsp;of&nbsp;the&nbsp;link&nbsp;to&nbsp;maintain&nbsp;a&nbsp;map&nbsp;of&nbsp;delivery&nbsp;tags,&nbsp;which&nbsp;would&nbsp;<br>
also&nbsp;have&nbsp;to&nbsp;be&nbsp;persisted&nbsp;in&nbsp;order&nbsp;to&nbsp;provide&nbsp;once&nbsp;and&nbsp;only&nbsp;delivery&nbsp;<br>
guarantee&nbsp;in&nbsp;event&nbsp;of&nbsp;failures&nbsp;of&nbsp;node(s).&nbsp;This&nbsp;will&nbsp;also&nbsp;require&nbsp;<br>
several&nbsp;syncs&nbsp;to&nbsp;storage&nbsp;at&nbsp;each&nbsp;transition&nbsp;(for&nbsp;durable&nbsp;messaging).&nbsp;<br>
I.e.&nbsp;slow<br>
<br>
Perhaps&nbsp;a&nbsp;simpler&nbsp;way&nbsp;of&nbsp;getting&nbsp;the&nbsp;once&nbsp;and&nbsp;only&nbsp;guarantee&nbsp;is&nbsp;to&nbsp;<br>
forget&nbsp;the&nbsp;delivery&nbsp;tag&nbsp;altogether&nbsp;and&nbsp;allow&nbsp;the&nbsp;sender&nbsp;to&nbsp;specify&nbsp;a&nbsp;<br>
de-duplication-id&nbsp;-&nbsp;this&nbsp;is&nbsp;just&nbsp;a&nbsp;user&nbsp;generated&nbsp;id&nbsp;-&nbsp;e.g.&nbsp;a&nbsp;String&nbsp;or&nbsp;<br>
a&nbsp;byte[],&nbsp;(can&nbsp;be&nbsp;generated&nbsp;from&nbsp;user&nbsp;application&nbsp;domain&nbsp;concepts&nbsp;-&nbsp;e.g.&nbsp;<br>
order&nbsp;number).<br>
<br>
When&nbsp;sending&nbsp;a&nbsp;message&nbsp;this&nbsp;id&nbsp;can&nbsp;be&nbsp;specified&nbsp;on&nbsp;the&nbsp;transfer.&nbsp;The&nbsp;<br>
receiving&nbsp;end&nbsp;can&nbsp;then&nbsp;maintain&nbsp;a&nbsp;de-duplication&nbsp;cache.&nbsp;The&nbsp;<br>
de-duplication&nbsp;cache&nbsp;can&nbsp;be&nbsp;implemented&nbsp;as&nbsp;a&nbsp;circular&nbsp;buffer&nbsp;which&nbsp;just&nbsp;<br>
overwrites&nbsp;itself&nbsp;when&nbsp;full&nbsp;(this&nbsp;is&nbsp;what&nbsp;we&nbsp;do&nbsp;in&nbsp;HornetQ&nbsp;for&nbsp;reliable&nbsp;<br>
bridging&nbsp;between&nbsp;nodes),&nbsp;this&nbsp;means&nbsp;the&nbsp;interaction&nbsp;c)&nbsp;is&nbsp;not&nbsp;necessary&nbsp;<br>
or&nbsp;can&nbsp;just&nbsp;be&nbsp;sent&nbsp;intermittently&nbsp;to&nbsp;allow&nbsp;the&nbsp;cache&nbsp;to&nbsp;be&nbsp;cleared.&nbsp;The&nbsp;<br>
de-dup&nbsp;cache&nbsp;still&nbsp;requires&nbsp;syncing&nbsp;to&nbsp;non&nbsp;volatile&nbsp;storage&nbsp;to&nbsp;give&nbsp;the&nbsp;<br>
once&nbsp;and&nbsp;only&nbsp;once&nbsp;(for&nbsp;durable&nbsp;messages),&nbsp;however&nbsp;it&nbsp;requires&nbsp;less&nbsp;<br>
writes&nbsp;than&nbsp;the&nbsp;method&nbsp;described&nbsp;in&nbsp;the&nbsp;spec,&nbsp;and&nbsp;it&nbsp;it&nbsp;has&nbsp;one&nbsp;less&nbsp;<br>
interaction&nbsp;(you&nbsp;can&nbsp;get&nbsp;rid&nbsp;of&nbsp;the&nbsp;&quot;ack&nbsp;of&nbsp;ack&quot;)<br>
<br>
On&nbsp;recovery&nbsp;after&nbsp;system&nbsp;failure,&nbsp;the&nbsp;sender&nbsp;just&nbsp;blindly&nbsp;sends&nbsp;the&nbsp;<br>
messages&nbsp;again,&nbsp;on&nbsp;receipt&nbsp;at&nbsp;the&nbsp;server&nbsp;any&nbsp;messages&nbsp;seen&nbsp;before&nbsp;will&nbsp;<br>
just&nbsp;be&nbsp;rejected.&nbsp;No&nbsp;need&nbsp;for&nbsp;reattaching,&nbsp;sending&nbsp;maps&nbsp;of&nbsp;unsettled&nbsp;<br>
transfers&nbsp;or&nbsp;other&nbsp;complex&nbsp;stuff&nbsp;like&nbsp;that.<br>
<br>
By&nbsp;removing&nbsp;all&nbsp;this&nbsp;delivery&nbsp;tag&nbsp;book-keeping&nbsp;and&nbsp;session&nbsp;re-attachment&nbsp;<br>
stuff,&nbsp;which&nbsp;seems&nbsp;unnecessary&nbsp;to&nbsp;me,&nbsp;would&nbsp;result&nbsp;in&nbsp;a&nbsp;dramatic&nbsp;<br>
simplification.<br>
<br>
Regarding&nbsp;verbosity&nbsp;of&nbsp;the&nbsp;wire&nbsp;format&nbsp;for&nbsp;message&nbsp;transfer;&nbsp;if&nbsp;you're&nbsp;<br>
just&nbsp;passing&nbsp;a&nbsp;12&nbsp;byte&nbsp;message&nbsp;(e.g.&nbsp;stock&nbsp;price&nbsp;-&nbsp;4&nbsp;byte&nbsp;identifier&nbsp;+&nbsp;8&nbsp;<br>
byte&nbsp;price)&nbsp;then&nbsp;the&nbsp;overall&nbsp;encoded&nbsp;size&nbsp;is&nbsp;much&nbsp;higher&nbsp;than&nbsp;12&nbsp;bytes.<br>
<br>
This&nbsp;will&nbsp;kill&nbsp;performance&nbsp;for&nbsp;small&nbsp;messages,&nbsp;making&nbsp;any&nbsp;AMQP&nbsp;compliant&nbsp;<br>
implementation&nbsp;unable&nbsp;to&nbsp;compete&nbsp;in&nbsp;the&nbsp;world&nbsp;of&nbsp;lightweight&nbsp;<br>
publish/subscribe&nbsp;messaging&nbsp;with&nbsp;other,&nbsp;non&nbsp;AMQP&nbsp;implementations&nbsp;which&nbsp;<br>
don't&nbsp;have&nbsp;to&nbsp;conform&nbsp;to&nbsp;the&nbsp;AMQP&nbsp;wire&nbsp;format&nbsp;and&nbsp;can&nbsp;produce&nbsp;much&nbsp;more&nbsp;<br>
lightweight&nbsp;encodings.&nbsp;The&nbsp;key&nbsp;to&nbsp;perf&nbsp;with&nbsp;lightweight&nbsp;pub/sub&nbsp;is&nbsp;to&nbsp;<br>
make&nbsp;the&nbsp;encoded&nbsp;message&nbsp;size&nbsp;as&nbsp;small&nbsp;as&nbsp;possible&nbsp;and&nbsp;cram&nbsp;as&nbsp;many&nbsp;<br>
messages&nbsp;as&nbsp;you&nbsp;can&nbsp;into&nbsp;single&nbsp;socket&nbsp;writes.<br>
<br>
Now,&nbsp;lightweight&nbsp;pub/sub&nbsp;may&nbsp;not&nbsp;be&nbsp;the&nbsp;target&nbsp;domain&nbsp;for&nbsp;AMQP,&nbsp;in&nbsp;which&nbsp;<br>
case&nbsp;it&nbsp;does&nbsp;not&nbsp;need&nbsp;to&nbsp;worry&nbsp;about&nbsp;it,&nbsp;however&nbsp;if&nbsp;a&nbsp;particular&nbsp;<br>
messaging&nbsp;system&nbsp;supports&nbsp;multiple&nbsp;protocols&nbsp;including&nbsp;AMQP,&nbsp;it&nbsp;will&nbsp;not&nbsp;<br>
do&nbsp;much&nbsp;for&nbsp;the&nbsp;adoption&nbsp;of&nbsp;AMQP&nbsp;if&nbsp;the&nbsp;best&nbsp;performance&nbsp;is&nbsp;not&nbsp;<br>
achievable&nbsp;using&nbsp;the&nbsp;AMQP&nbsp;protocol&nbsp;-&nbsp;users&nbsp;will&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;the&nbsp;<br>
proprietary&nbsp;protocol&nbsp;offered&nbsp;by&nbsp;the&nbsp;vendor.<br>
<br>
A&nbsp;short&nbsp;comment&nbsp;on&nbsp;transactions.&nbsp;I&nbsp;have&nbsp;to&nbsp;be&nbsp;honest&nbsp;here,&nbsp;I&nbsp;spent&nbsp;about&nbsp;<br>
30&nbsp;mins&nbsp;reading&nbsp;the&nbsp;chapter&nbsp;on&nbsp;transactions&nbsp;several&nbsp;times.&nbsp;I&nbsp;have&nbsp;to&nbsp;say&nbsp;<br>
at&nbsp;the&nbsp;end&nbsp;of&nbsp;it&nbsp;I&nbsp;am&nbsp;not&nbsp;much&nbsp;further&nbsp;understanding&nbsp;it.&nbsp;:(<br>
<br>
However&nbsp;maybe&nbsp;that&nbsp;is&nbsp;moot&nbsp;-&nbsp;a&nbsp;part&nbsp;of&nbsp;me&nbsp;is&nbsp;thinking&nbsp;that&nbsp;transactions&nbsp;<br>
don't&nbsp;really&nbsp;belong&nbsp;in&nbsp;the&nbsp;core&nbsp;spec.&nbsp;Perhaps&nbsp;the&nbsp;core&nbsp;spec&nbsp;should&nbsp;be&nbsp;<br>
concerned&nbsp;with&nbsp;allowing&nbsp;the&nbsp;reliable&nbsp;movement&nbsp;of&nbsp;messages&nbsp;between&nbsp;nodes.&nbsp;<br>
With&nbsp;that&nbsp;in&nbsp;place,&nbsp;transactions&nbsp;could&nbsp;be&nbsp;layered&nbsp;on&nbsp;top&nbsp;in&nbsp;another&nbsp;spec&nbsp;(?)<br>
<br>
<br>
<br>
<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
