<tt>
Hello,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;trying&nbsp;to&nbsp;set&nbsp;up&nbsp;HA&nbsp;infrastructure&nbsp;for&nbsp;our&nbsp;new&nbsp;project&nbsp;that&nbsp;uses&nbsp;RabbitMQ&nbsp;and&nbsp;MassTransit.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I've&nbsp;read&nbsp;and&nbsp;re-read&nbsp;the&nbsp;articles&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/ha.html&quot;&gt;HA&nbsp;and&nbsp;Mirrored&nbsp;Queues&lt;/a&gt;&nbsp;several&nbsp;times.&nbsp;And&nbsp;I&nbsp;understand&nbsp;the&nbsp;theory&nbsp;behind&nbsp;it.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;I&nbsp;do&nbsp;have&nbsp;a&nbsp;few&nbsp;questions.&nbsp;I&nbsp;hope&nbsp;somebody&nbsp;can&nbsp;kindly&nbsp;answer&nbsp;them&nbsp;for&nbsp;me.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;1.&nbsp;I&nbsp;just&nbsp;set&nbsp;up&nbsp;a&nbsp;cluster&nbsp;with&nbsp;2&nbsp;nodes.&nbsp;When&nbsp;I&nbsp;have&nbsp;a&nbsp;client&nbsp;talk&nbsp;to&nbsp;either&nbsp;of&nbsp;these&nbsp;nodes,&nbsp;the&nbsp;other&nbsp;node&nbsp;reflects&nbsp;those&nbsp;changes&nbsp;almost&nbsp;instantly.&nbsp;For&nbsp;example,&nbsp;if&nbsp;a&nbsp;publisher&nbsp;writes&nbsp;a&nbsp;message&nbsp;to&nbsp;an&nbsp;exchange&nbsp;that&nbsp;ends&nbsp;up&nbsp;in&nbsp;a&nbsp;specific&nbsp;queue&nbsp;bound&nbsp;to&nbsp;that&nbsp;exchange,&nbsp;it&nbsp;immediately&nbsp;shows&nbsp;up&nbsp;in&nbsp;the&nbsp;same&nbsp;queue&nbsp;on&nbsp;the&nbsp;other&nbsp;node.&nbsp;Likewise,&nbsp;if&nbsp;I&nbsp;manually&nbsp;create&nbsp;a&nbsp;queue&nbsp;on&nbsp;one&nbsp;node,&nbsp;it&nbsp;immediately&nbsp;shows&nbsp;up&nbsp;on&nbsp;the&nbsp;other&nbsp;node&nbsp;as&nbsp;well.&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;No&nbsp;special&nbsp;policies&nbsp;have&nbsp;been&nbsp;set&nbsp;up,&nbsp;by&nbsp;the&nbsp;way.&nbsp;This&nbsp;is&nbsp;all&nbsp;just&nbsp;out&nbsp;of&nbsp;the&nbsp;box.&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;And&nbsp;this&nbsp;is&nbsp;expected,&nbsp;I'd&nbsp;assume,&nbsp;since&nbsp;these&nbsp;both&nbsp;nodes&nbsp;are&nbsp;in&nbsp;a&nbsp;cluster.&nbsp;But&nbsp;then&nbsp;why&nbsp;does&nbsp;the&nbsp;article&nbsp;on&nbsp;Mirrored&nbsp;Queues&nbsp;say&nbsp;that&nbsp;&lt;/span&gt;&lt;b&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;you&nbsp;have&nbsp;to&nbsp;explicitly&nbsp;set&nbsp;up&nbsp;mirrored&nbsp;queues&nbsp;by&nbsp;policy&lt;/b&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;?&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;&quot;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(85,&nbsp;85,&nbsp;85);&nbsp;font-family:&nbsp;Verdana,&nbsp;sans-serif;&nbsp;line-height:&nbsp;18px;&quot;&gt;Queues&nbsp;have&nbsp;mirroring&nbsp;enabled&nbsp;via&amp;nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/parameters.html#policies&quot;&nbsp;style=&quot;color:&nbsp;rgb(68,&nbsp;68,&nbsp;68);&nbsp;font-weight:&nbsp;bold;&nbsp;font-family:&nbsp;Verdana,&nbsp;sans-serif;&nbsp;line-height:&nbsp;18px;&quot;&gt;policy&lt;/a&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(85,&nbsp;85,&nbsp;85);&nbsp;font-family:&nbsp;Verdana,&nbsp;sans-serif;&nbsp;line-height:&nbsp;18px;&quot;&gt;.&nbsp;Policies&nbsp;can&nbsp;change&nbsp;at&nbsp;any&nbsp;time;&nbsp;it&nbsp;is&nbsp;valid&nbsp;to&nbsp;create&nbsp;a&nbsp;non-mirrored&nbsp;queue,&nbsp;and&nbsp;then&nbsp;make&nbsp;it&nbsp;mirrored&nbsp;at&nbsp;some&nbsp;later&nbsp;point&nbsp;(and&nbsp;vice&nbsp;versa).&lt;/span&gt;&lt;span&nbsp;style=&quot;line-height:&nbsp;17px;&quot;&gt;&quot;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;Am&nbsp;I&nbsp;missing&nbsp;something&nbsp;obvious&nbsp;here?&amp;nbsp;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;Let's&nbsp;say&nbsp;I&nbsp;have&nbsp;a&nbsp;internal&nbsp;DNS&nbsp;entry&nbsp;that&nbsp;points&nbsp;to&nbsp;a&nbsp;load&nbsp;balancer,&nbsp;which&nbsp;in&nbsp;turn&nbsp;sends&nbsp;traffic&nbsp;to&nbsp;either&nbsp;of&nbsp;these&nbsp;nodes&nbsp;mentioned&nbsp;above&nbsp;(based&nbsp;on&nbsp;round-robin&nbsp;or&nbsp;whatever&nbsp;algorithm),&nbsp;and&nbsp;ask&nbsp;the&nbsp;clients&nbsp;(publishers&nbsp;and&nbsp;consumers)&nbsp;to&nbsp;talk&nbsp;to&nbsp;the&nbsp;DNS&nbsp;entry&nbsp;when&nbsp;it&nbsp;wants&nbsp;to&nbsp;write&nbsp;or&nbsp;read&nbsp;from&nbsp;the&nbsp;queues.&nbsp;So&nbsp;if&nbsp;one&nbsp;node&nbsp;goes&nbsp;down,&nbsp;the&nbsp;load&nbsp;balancer&nbsp;would&nbsp;automatically&nbsp;redirect&nbsp;all&nbsp;the&nbsp;traffic&nbsp;just&nbsp;to&nbsp;the&nbsp;node&nbsp;that&nbsp;is&nbsp;up&nbsp;and&nbsp;running.&nbsp;And&nbsp;the&nbsp;clients&nbsp;will&nbsp;not&nbsp;be&nbsp;affected.&nbsp;Would&nbsp;that&nbsp;work?&nbsp;Is&nbsp;that&nbsp;the&nbsp;recommended&nbsp;approach?&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.&nbsp;Finally,&nbsp;I&nbsp;have&nbsp;a&nbsp;question&nbsp;about&nbsp;DR.&nbsp;Our&nbsp;DR&nbsp;server&nbsp;is&nbsp;on&nbsp;a&nbsp;separate&nbsp;WAN&nbsp;in&nbsp;a&nbsp;different&nbsp;state.&nbsp;I&nbsp;was&nbsp;thinking&nbsp;about&nbsp;using&nbsp;Shoveling&nbsp;technique&nbsp;to&nbsp;push&nbsp;messages&nbsp;from&nbsp;a&nbsp;logical&nbsp;broker&nbsp;sitting&nbsp;on&nbsp;a&nbsp;cluster&nbsp;in&nbsp;our&nbsp;local&nbsp;HA&nbsp;servers&nbsp;to&nbsp;a&nbsp;different&nbsp;logical&nbsp;broker&nbsp;to&nbsp;the&nbsp;DR&nbsp;server.&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;messages&nbsp;will&nbsp;keep&nbsp;getting&nbsp;pumped&nbsp;into&nbsp;the&nbsp;DR&nbsp;with&nbsp;no&nbsp;clients&nbsp;processing&nbsp;it.&nbsp;What&nbsp;will&nbsp;happen&nbsp;to&nbsp;those&nbsp;messages?&nbsp;Should&nbsp;I&nbsp;have&nbsp;a&nbsp;workflow&nbsp;to&nbsp;go&nbsp;purge&nbsp;them&nbsp;every&nbsp;day&nbsp;manually&nbsp;or&nbsp;via&nbsp;a&nbsp;script&nbsp;(after&nbsp;I&nbsp;make&nbsp;sure&nbsp;those&nbsp;messages&nbsp;aren't&nbsp;needed&nbsp;anymore&nbsp;since&nbsp;the&nbsp;clients&nbsp;have&nbsp;already&nbsp;process&nbsp;them&nbsp;from&nbsp;the&nbsp;main&nbsp;HA&nbsp;cluster).&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;the&nbsp;main&nbsp;HA&nbsp;cluster&nbsp;goes&nbsp;down&nbsp;and&nbsp;I&nbsp;have&nbsp;to&nbsp;bring&nbsp;the&nbsp;DR&nbsp;server&nbsp;into&nbsp;action,&nbsp;what&nbsp;happens&nbsp;to&nbsp;the&nbsp;messages&nbsp;that&nbsp;did&nbsp;get&nbsp;processed&nbsp;already&nbsp;by&nbsp;the&nbsp;clients?&nbsp;Should&nbsp;the&nbsp;clients&nbsp;have&nbsp;logic&nbsp;built&nbsp;in&nbsp;to&nbsp;ignore&nbsp;duplicates&nbsp;to&nbsp;handle&nbsp;this&nbsp;specific&nbsp;scenario?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance&nbsp;for&nbsp;your&nbsp;help,&lt;/div&gt;&lt;div&gt;Girish&lt;/div&gt;
</tt>
