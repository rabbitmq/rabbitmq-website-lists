<tt>
Hi&nbsp;Tim,&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;your&nbsp;answers!&lt;br&gt;&lt;br&gt;My&nbsp;original&nbsp;question&nbsp;on&nbsp;the&nbsp;links&nbsp;&amp;amp;&nbsp;supervisors&nbsp;came&nbsp;from&nbsp;my&nbsp;need&nbsp;to&nbsp;know&nbsp;that&nbsp;when&nbsp;my&nbsp;mystery&nbsp;error&nbsp;(cause&nbsp;still&nbsp;unknown&nbsp;but&nbsp;more&nbsp;than&nbsp;likely&nbsp;caused&nbsp;by&nbsp;myself)&nbsp;occurred&nbsp;I&nbsp;got&nbsp;some&nbsp;type&nbsp;of&nbsp;exit&nbsp;or&nbsp;notification&nbsp;so&nbsp;that&nbsp;i&nbsp;could&nbsp;do&nbsp;something&nbsp;about&nbsp;it.&nbsp;I&amp;#39;ve&nbsp;built&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;it&nbsp;now&nbsp;that&nbsp;monitors&nbsp;the&nbsp;connection&nbsp;&amp;amp;&nbsp;channel&nbsp;so&nbsp;can&nbsp;happily&nbsp;forget&nbsp;about&nbsp;meddling&nbsp;with&nbsp;the&nbsp;supervision&nbsp;tree&nbsp;:-)&lt;br&gt;<br>
&lt;br&gt;While&nbsp;doing&nbsp;this&nbsp;I&amp;#39;ve&nbsp;built&nbsp;up&nbsp;more&nbsp;understanding&nbsp;of&nbsp;the&nbsp;library&nbsp;and&nbsp;added&nbsp;the&nbsp;confirmation&nbsp;&amp;amp;&nbsp;retry&nbsp;handling&nbsp;to&nbsp;my&nbsp;wrapper&nbsp;relatively&nbsp;easily.&nbsp;So&nbsp;I&nbsp;just&nbsp;want&nbsp;to&nbsp;say&nbsp;good&nbsp;work&nbsp;on&nbsp;rabbitmq-erlang-client&nbsp;guys!&lt;br&gt;<br>
&lt;br&gt;//TTom.&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Oct&nbsp;16,&nbsp;2012&nbsp;at&nbsp;12:57&nbsp;PM,&nbsp;Tim&nbsp;Watson&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:tim@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;tim@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hi!&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
On&nbsp;15&nbsp;Oct&nbsp;2012,&nbsp;at&nbsp;16:07,&nbsp;tom&nbsp;kelly&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;Hi&nbsp;List,&lt;br&gt;<br>
&amp;gt;&nbsp;New&nbsp;user&nbsp;here,&nbsp;debugging&nbsp;some&nbsp;code&nbsp;I&nbsp;inherited&nbsp;so&nbsp;apologies&nbsp;if&nbsp;my&nbsp;questions&nbsp;below&nbsp;are&nbsp;irrelevant.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;m&nbsp;investigating&nbsp;an&nbsp;amqp&nbsp;crash&nbsp;that&nbsp;I&amp;#39;ve&nbsp;seen&nbsp;in&nbsp;my&nbsp;logs&nbsp;a&nbsp;few&nbsp;times&nbsp;and&nbsp;after&nbsp;a&nbsp;code&nbsp;review&nbsp;of&nbsp;the&nbsp;amqp&nbsp;component&nbsp;I&amp;#39;m&nbsp;a&nbsp;bit&nbsp;concerned&nbsp;that&nbsp;my&nbsp;connections&nbsp;may&nbsp;be&nbsp;dying&nbsp;&amp;amp;&nbsp;silently&nbsp;failing&nbsp;when&nbsp;this&nbsp;crash&nbsp;occurs.&lt;br&gt;<br>
<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Ok,&nbsp;let&amp;#39;s&nbsp;look&nbsp;at&nbsp;that&nbsp;then.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;m&nbsp;using&nbsp;an&nbsp;older&nbsp;version&nbsp;that&nbsp;unlinked&nbsp;from&nbsp;the&nbsp;process&nbsp;that&nbsp;called&nbsp;&amp;quot;start_link&amp;quot;,&nbsp;anyone&nbsp;know&nbsp;why&nbsp;that&nbsp;was?&nbsp;I&amp;#39;m&nbsp;publishing&nbsp;through&nbsp;this&nbsp;channel&nbsp;by&nbsp;calling&nbsp;amqp_channel:cast,&nbsp;so&nbsp;now&nbsp;I&amp;#39;m&nbsp;worried&nbsp;that&nbsp;if&nbsp;the&nbsp;connection&nbsp;&amp;amp;&nbsp;channel&nbsp;were&nbsp;closed&nbsp;down&nbsp;everything&nbsp;that&nbsp;I&nbsp;thought&nbsp;I&nbsp;was&nbsp;publishing&nbsp;after&nbsp;this&nbsp;error&nbsp;just&nbsp;silently&nbsp;failed.&nbsp;And&nbsp;because&nbsp;of&nbsp;the&nbsp;unlink&nbsp;there&amp;#39;s&nbsp;no&nbsp;way&nbsp;the&nbsp;application&nbsp;would&nbsp;have&nbsp;known.&lt;br&gt;<br>
<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;I&amp;#39;m&nbsp;really&nbsp;no&nbsp;too&nbsp;sure&nbsp;about&nbsp;this&nbsp;unlink&nbsp;business,&nbsp;but&nbsp;if&nbsp;you&nbsp;could&nbsp;clarify&nbsp;where&nbsp;that&nbsp;was&nbsp;happening&nbsp;then&nbsp;I&nbsp;can&nbsp;probably&nbsp;look&nbsp;through&nbsp;the&nbsp;hg&nbsp;logs&nbsp;to&nbsp;try&nbsp;and&nbsp;figure&nbsp;out&nbsp;what&nbsp;was&nbsp;going&nbsp;on&nbsp;there.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;plan&nbsp;upgrading&nbsp;to&nbsp;the&nbsp;latest&nbsp;version&nbsp;but&nbsp;I&amp;#39;m&nbsp;not&nbsp;sure&nbsp;that&nbsp;it&nbsp;has&nbsp;all&nbsp;the&nbsp;features&nbsp;to&nbsp;help&nbsp;solve&nbsp;this&nbsp;problem.&nbsp;I&nbsp;see&nbsp;that&nbsp;the&nbsp;unlink&nbsp;is&nbsp;gone&nbsp;and&nbsp;the&nbsp;supervision&nbsp;policy&nbsp;is&nbsp;still:{one_for_all,&nbsp;0,&nbsp;1}&nbsp;So&nbsp;I&nbsp;guess&nbsp;this&nbsp;means&nbsp;I&nbsp;have&nbsp;to&nbsp;trap&nbsp;exits&nbsp;and&nbsp;I&nbsp;have&nbsp;responsibility&nbsp;for&nbsp;reopening&nbsp;the&nbsp;connection&nbsp;&amp;amp;&nbsp;channel&nbsp;if&nbsp;it&nbsp;dies?&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
&lt;/div&gt;My&nbsp;reading&nbsp;of&nbsp;the&nbsp;supervision&nbsp;hierarchy&nbsp;is&nbsp;thus:&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;application&nbsp;has&nbsp;a&nbsp;top&nbsp;level&nbsp;simple_one_for_one&nbsp;supervisor&nbsp;for&nbsp;all&nbsp;connections,&nbsp;which&nbsp;handles&nbsp;the&nbsp;amqp_connection_sup.&nbsp;This&nbsp;just&nbsp;ensures&nbsp;that&nbsp;each&nbsp;connection&nbsp;can&nbsp;actually&nbsp;be&nbsp;started&nbsp;and&nbsp;they&nbsp;connection_sup&nbsp;is&nbsp;temporary,&nbsp;so&nbsp;no&nbsp;restarts&nbsp;will&nbsp;ever&nbsp;take&nbsp;place.&nbsp;This&nbsp;is&nbsp;presumably&nbsp;what&nbsp;you&amp;#39;d&nbsp;expect,&nbsp;as&nbsp;we&amp;#39;re&nbsp;not&nbsp;trying&nbsp;to&nbsp;second&nbsp;guess&nbsp;how&nbsp;long&nbsp;your&nbsp;connections&nbsp;need&nbsp;to&nbsp;live&nbsp;for.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
The&nbsp;actual&nbsp;connection&nbsp;consists&nbsp;of&nbsp;a&nbsp;few&nbsp;processes&nbsp;-&nbsp;the&nbsp;gen_connection,&nbsp;connection_type_sup&nbsp;and&nbsp;channel_sup_sup.&nbsp;This&nbsp;is&nbsp;a&nbsp;one_for_all&nbsp;supervisor&nbsp;and&nbsp;the&nbsp;actual&nbsp;gen_connection&nbsp;process&nbsp;is&nbsp;an&nbsp;&amp;#39;intrinsic&amp;#39;&nbsp;worker,&nbsp;so&nbsp;a&nbsp;non-normal&nbsp;exit&nbsp;will&nbsp;kill&nbsp;the&nbsp;supervisor&nbsp;(and&nbsp;sibling&nbsp;processes),&nbsp;but&nbsp;a&nbsp;normal&nbsp;exit&nbsp;will&nbsp;take&nbsp;everyone&nbsp;else&nbsp;down&nbsp;cleanly.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
Now&nbsp;the&nbsp;channel_sup_sup&nbsp;starts&nbsp;a&nbsp;temporary&nbsp;worker&nbsp;(amqp_channel_sup)&nbsp;and&nbsp;that&nbsp;starts&nbsp;an&nbsp;intrinsic&nbsp;worker.&nbsp; So&nbsp;all&nbsp;in&nbsp;all,&nbsp;it&nbsp;looks&nbsp;to&nbsp;me&nbsp;as&nbsp;if&nbsp;the&nbsp;connection&nbsp;and&nbsp;channel&nbsp;will&nbsp;be&nbsp;properly&nbsp;re-established&nbsp;if&nbsp;a&nbsp;non-normal&nbsp;exit&nbsp;occurs.&lt;br&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;But&nbsp;before&nbsp;I&nbsp;restart&nbsp;it,&nbsp;what&nbsp;happens&nbsp;to&nbsp;any&nbsp;attempts&nbsp;to&nbsp;publish&nbsp;messages?&nbsp;I&nbsp;see&nbsp;there&amp;#39;s&nbsp;new&nbsp;confirmation&nbsp;functionality&nbsp;that&nbsp;sounds&nbsp;like&nbsp;it&nbsp;might&nbsp;do&nbsp;what&amp;#39;s&nbsp;required&nbsp;but&nbsp;from&nbsp;my&nbsp;reading&nbsp;it&nbsp;seems&nbsp;that&nbsp;if&nbsp;amqp_channel&nbsp;is&nbsp;shut&nbsp;down&nbsp;after&nbsp;a&nbsp;crash&nbsp;on&nbsp;the&nbsp;connection&nbsp;then&nbsp;all&nbsp;the&nbsp;confirm&nbsp;info&nbsp;is&nbsp;discarded.&nbsp;Is&nbsp;there&nbsp;no&nbsp;way&nbsp;to&nbsp;keep&nbsp;this&nbsp;process&nbsp;alive&nbsp;and&nbsp;try&nbsp;to&nbsp;re-open&nbsp;the&nbsp;connection&nbsp;immediately&nbsp;on&nbsp;failure?&lt;br&gt;<br>
<br>
&amp;gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;I&amp;#39;m&nbsp;not&nbsp;really&nbsp;sure&nbsp;what&nbsp;you&amp;#39;re&nbsp;asking&nbsp;here,&nbsp;but&nbsp;my&nbsp;reading&nbsp;of&nbsp;the&nbsp;client&nbsp;is&nbsp;that&nbsp;if&nbsp;you&amp;#39;re&nbsp;expecting&nbsp;a&nbsp;confirm&nbsp;and&nbsp;you&amp;#39;ve&nbsp;not&nbsp;seen&nbsp;it,&nbsp;then&nbsp;you&nbsp;can/should&nbsp;assume&nbsp;the&nbsp;message&nbsp;wasn&amp;#39;t&nbsp;accepted&nbsp;by&nbsp;the&nbsp;broker.&nbsp;If&nbsp;you&amp;#39;re&nbsp;asking&nbsp;about&nbsp;tracking&nbsp;the&nbsp;confirms&nbsp;between&nbsp;channel&nbsp;instances,&nbsp;then&nbsp;yes,&nbsp;you&amp;#39;ll&nbsp;need&nbsp;to&nbsp;do&nbsp;that&nbsp;yourself,&nbsp;using&nbsp;whatever&nbsp;mechanism&nbsp;suits&nbsp;your&nbsp;design&nbsp;(shared/stable&nbsp;storage,&nbsp;stateful&nbsp;parent&nbsp;process,&nbsp;etc).&lt;br&gt;<br>
<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;m&nbsp;just&nbsp;about&nbsp;to&nbsp;plug&nbsp;in&nbsp;the&nbsp;new&nbsp;version&nbsp;and&nbsp;play&nbsp;with&nbsp;the&nbsp;confirmations&nbsp;but&nbsp;any&nbsp;explanations&nbsp;of&nbsp;the&nbsp;current&nbsp;design&nbsp;might&nbsp;help&nbsp;enormously,&lt;br&gt;<br>
&amp;gt;&nbsp;Thanks,&lt;br&gt;<br>
&amp;gt;&nbsp;//TTom.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Well&nbsp;I&nbsp;hope&nbsp;my&nbsp;comments&nbsp;have&nbsp;made&nbsp;it&nbsp;a&nbsp;bit&nbsp;clearly&nbsp;and&nbsp;not&nbsp;worse!&nbsp;Please&nbsp;*do*&nbsp;feel&nbsp;free&nbsp;to&nbsp;come&nbsp;back&nbsp;with&nbsp;any&nbsp;questions,&nbsp;or&nbsp;to&nbsp;clear&nbsp;up&nbsp;anything&nbsp;I&amp;#39;ve&nbsp;not&nbsp;explained&nbsp;properly.&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
Tim&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
