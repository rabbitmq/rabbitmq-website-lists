<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;Michael&nbsp;for&nbsp;that&nbsp;super&nbsp;fast&nbsp;reply,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;was&nbsp;what&nbsp;I&nbsp;was&nbsp;actually&nbsp;questioning...&nbsp;across&nbsp;all&nbsp;threads,&nbsp;91%&nbsp;of&nbsp;the&nbsp;time&nbsp;is&nbsp;spent&nbsp;in&nbsp;the&nbsp;connection&nbsp;thread&nbsp;and&nbsp;all&nbsp;of&nbsp;it&nbsp;is&nbsp;in&nbsp;reading&nbsp;the&nbsp;socket&nbsp;which&nbsp;I&nbsp;found&nbsp;somewhat&nbsp;suspicious,&nbsp;knowing&nbsp;how&nbsp;much&nbsp;processing&nbsp;needs&nbsp;to&nbsp;happen&nbsp;per&nbsp;message.&nbsp; The&nbsp;other&nbsp;9%&nbsp;is&nbsp;spent&nbsp;in&nbsp;&amp;quot;my&nbsp;code&amp;quot;.&nbsp; Is&nbsp;it&nbsp;really&nbsp;true&nbsp;that&nbsp;it&nbsp;is&nbsp;so&nbsp;time&nbsp;consuming&nbsp;for&nbsp;the&nbsp;connection&nbsp;thread&nbsp;to&nbsp;need&nbsp;9/10ths&nbsp;of&nbsp;the&nbsp;time?&nbsp; Also&nbsp;-&nbsp;I&amp;#39;m&nbsp;only&nbsp;seeing&nbsp;400msg/s&nbsp;(even&nbsp;when&nbsp;I&nbsp;comment&nbsp;out&nbsp;all&nbsp;my&nbsp;code)&nbsp;from&nbsp;a&nbsp;durable&nbsp;persistent&nbsp;queue&nbsp;with&nbsp;ACK,&nbsp;lending&nbsp;more&nbsp;weight&nbsp;to&nbsp;my&nbsp;suspicions&nbsp;that&nbsp;something&nbsp;is&nbsp;not&nbsp;quite&nbsp;right&nbsp;here&nbsp;(I&nbsp;have&nbsp;basic&nbsp;QoS&nbsp;at&nbsp;100msg&nbsp;and&nbsp;a&nbsp;single&nbsp;thread+channel&nbsp;here).&nbsp; &lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;still&nbsp;think&nbsp;this&nbsp;is&nbsp;correct&nbsp;behavior?&nbsp; &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;Tim&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt; &lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Aug&nbsp;1,&nbsp;2013&nbsp;at&nbsp;5:02&nbsp;PM,&nbsp;Michael&nbsp;Klishin&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:mklishin@gopivotal.com&quot;&nbsp;target=&quot;_blank&quot;&gt;mklishin@gopivotal.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Tim&nbsp;Robertson:&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Does&nbsp;this&nbsp;look&nbsp;suspicious&nbsp;to&nbsp;anyone?&nbsp; Can&nbsp;anyone&nbsp;shed&nbsp;any&nbsp;light&nbsp;on&nbsp;how&nbsp;one&nbsp;might&nbsp;improve&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;Java&nbsp;client&nbsp;uses&nbsp;a&nbsp;separate&nbsp;thread&nbsp;for&nbsp;network&nbsp;activity&nbsp;(called&nbsp;&amp;quot;main&nbsp;loop&amp;quot;),&nbsp;one&nbsp;per&nbsp;connection.&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;in&nbsp;that&nbsp;thread,&nbsp;100%&nbsp;of&nbsp;time&nbsp;is&nbsp;spent&nbsp;reading&nbsp;from&nbsp;the&nbsp;socket.&nbsp;When&nbsp;a&nbsp;delivery&nbsp;arrives,&lt;br&gt;<br>
it&nbsp;is&nbsp;dispatched&nbsp;to&nbsp;a&nbsp;work&nbsp;pool&nbsp;(every&nbsp;channel&nbsp;has&nbsp;its&nbsp;own,&nbsp;AFAIR).&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;profile&nbsp;all&nbsp;methods,&nbsp;it&amp;#39;s&nbsp;certainly&nbsp;very&nbsp;likely&nbsp;that&nbsp;com.rabbitmq.client.impl.AMQConnection$MainLoop.run&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;top&nbsp;of&lt;br&gt;<br>
the&nbsp;overall&nbsp;table.&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;try&nbsp;excluding&nbsp;certain&nbsp;classes/methods/threads&nbsp;from&nbsp;the&nbsp;profiler.&nbsp;That&nbsp;will&lt;br&gt;<br>
give&nbsp;you&nbsp;a&nbsp;more&nbsp;informative&nbsp;insight.&lt;br&gt;<br>
--&lt;br&gt;<br>
MK&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
