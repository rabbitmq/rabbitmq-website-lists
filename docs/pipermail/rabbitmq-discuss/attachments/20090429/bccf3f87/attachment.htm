<tt>
Hello&nbsp;all,&lt;br&gt;&lt;br&gt;I&amp;#39;m&nbsp;investigating&nbsp;using&nbsp;RabbitMQ&nbsp;as&nbsp;a&nbsp;replacement&nbsp;for&nbsp;a&nbsp;few&nbsp;db-backed&nbsp;work&nbsp;queues. &nbsp;Our&nbsp;replication&nbsp;master&nbsp;sees&nbsp;considerable&nbsp;bit&nbsp;of&nbsp;write&nbsp;traffic&nbsp;into&nbsp;these&nbsp;tables,&nbsp;and&nbsp;it&nbsp;would&nbsp;be&nbsp;nice&nbsp;to&nbsp;take&nbsp;that&nbsp;off&nbsp;of&nbsp;their&nbsp;hands. &nbsp;My&nbsp;first&nbsp;attempt&nbsp;will&nbsp;be&nbsp;to&nbsp;replace&nbsp;our&nbsp;dirty&nbsp;users&nbsp;queue&nbsp;--&nbsp;this&nbsp;stores&nbsp;a&nbsp;simple&nbsp;list&nbsp;of&nbsp;user&nbsp;ids,&nbsp;indicating&nbsp;for&nbsp;which&nbsp;users&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;some&nbsp;background&nbsp;processing&nbsp;&amp;amp;&nbsp;push&nbsp;out&nbsp;an&nbsp;updated&nbsp;user&nbsp;profile. &nbsp;We&nbsp;mark&nbsp;many&nbsp;as&nbsp;&amp;#39;dirty&amp;#39;&nbsp;during&nbsp;the&nbsp;course&nbsp;of&nbsp;the&nbsp;day,&nbsp;and&nbsp;run&nbsp;several&nbsp;workers&nbsp;to&nbsp;update&nbsp;the&nbsp;profiles. &nbsp;We&nbsp;usually&nbsp;have&nbsp;several&nbsp;hundred&nbsp;thousand&nbsp;users&nbsp;in&nbsp;the&nbsp;queue&nbsp;at&nbsp;a&nbsp;time.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;This&nbsp;seems&nbsp;like&nbsp;a&nbsp;good&nbsp;fit&nbsp;for&nbsp;RabbitMQ,&nbsp;but&nbsp;I&nbsp;have&nbsp;a&nbsp;few&nbsp;questions/constraints:&lt;br&gt;&lt;br&gt;&lt;ul&gt;&lt;li&gt;Our&nbsp;current&nbsp;system&nbsp;allows&nbsp;us&nbsp;to&nbsp;do&nbsp;a&nbsp;unique&nbsp;constraint&nbsp;on&nbsp;userid&nbsp;--&nbsp;if&nbsp;someone&nbsp;is&nbsp;already&nbsp;in&nbsp;the&nbsp;dirty&nbsp;queue&nbsp;and&nbsp;dirties&nbsp;his&nbsp;or&nbsp;her&nbsp;profile&nbsp;again,&nbsp;we&nbsp;don&amp;#39;t&nbsp;want&nbsp;to&nbsp;update&nbsp;it&nbsp;multiple&nbsp;times.&nbsp;We&nbsp;do&nbsp;an&nbsp;&amp;#39;insert&nbsp;ignore&amp;#39;,&nbsp;leaving&nbsp;us&nbsp;with&nbsp;at&nbsp;most&nbsp;one&nbsp;row&nbsp;per&nbsp;user. &nbsp;Are&nbsp;there&nbsp;any&nbsp;clever&nbsp;ways&nbsp;to&nbsp;emulate&nbsp;this&nbsp;behavior?&lt;br&gt;<br>
<br>
&lt;br&gt;I&nbsp;can&nbsp;think&nbsp;of&nbsp;a&nbsp;few&nbsp;ways&nbsp;to&nbsp;work&nbsp;around&nbsp;this&nbsp;outside&nbsp;of&nbsp;the&nbsp;queueing&nbsp;system,&nbsp;but&nbsp;all&nbsp;involve&nbsp;storing&nbsp;state&nbsp;elsewhere.&nbsp;I&amp;#39;d&nbsp;love&nbsp;a&nbsp;native&nbsp;solution&nbsp;that&nbsp;would&nbsp;allow&nbsp;me&nbsp;to&nbsp;fire&nbsp;as&nbsp;many&nbsp;&amp;quot;this&nbsp;user&nbsp;is&nbsp;dirty&amp;quot;&nbsp;messages&nbsp;into&nbsp;the&nbsp;queue,&nbsp;but&nbsp;guarantee&nbsp;my&nbsp;workers&nbsp;that&nbsp;the&nbsp;message&nbsp;message&nbsp;I&nbsp;read&nbsp;from&nbsp;a&nbsp;queue&nbsp;encapsulates&nbsp;all&nbsp;previous&nbsp;dirtying&nbsp;events. &nbsp;Perhaps&nbsp;this&nbsp;is&nbsp;a&nbsp;pipe&nbsp;dream.&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;&lt;/li&gt;&lt;li&gt;Our&nbsp;workers&nbsp;like&nbsp;to&nbsp;leak&nbsp;memory,&nbsp;so&nbsp;we&nbsp;often&nbsp;find&nbsp;ourselves&nbsp;killing&nbsp;them&nbsp;ungracefully. &nbsp;While&nbsp;missing&nbsp;a&nbsp;few&nbsp;dirty&nbsp;profiles&nbsp;isn&amp;#39;t&nbsp;terrible,&nbsp;it&nbsp;would&nbsp;be&nbsp;nice&nbsp;premature&nbsp;worker&nbsp;death&nbsp;didn&amp;#39;t&nbsp;have&nbsp;to&nbsp;cause&nbsp;this. &nbsp;Along&nbsp;these&nbsp;lines,&nbsp;I&amp;#39;m&nbsp;thinking&nbsp;we&amp;#39;d&nbsp;receive&nbsp;the&nbsp;message,&nbsp;do&nbsp;work,&nbsp;and&nbsp;then&nbsp;ack&nbsp;recieipt&nbsp;of&nbsp;the&nbsp;message. &nbsp;If&nbsp;we&nbsp;die&nbsp;before&nbsp;the&nbsp;ack,&nbsp;the&nbsp;message&nbsp;lives&nbsp;on&nbsp;and&nbsp;someone&nbsp;else&nbsp;will&nbsp;clean&nbsp;that&nbsp;profile&nbsp;later.&lt;br&gt;<br>
<br>
&lt;br&gt;My&nbsp;question&nbsp;is&nbsp;about&nbsp;ack&nbsp;timing:&nbsp;how&nbsp;long&nbsp;does&nbsp;the&nbsp;worker&nbsp;have&nbsp;before&nbsp;the&nbsp;message&nbsp;is&nbsp;requeued?&nbsp;is&nbsp;this&nbsp;time&nbsp;configurable?&nbsp;is&nbsp;it&nbsp;configurable&nbsp;per&nbsp;queue?&lt;/li&gt;&lt;/ul&gt;&lt;br&gt;I&amp;#39;m&nbsp;looking&nbsp;forward&nbsp;to&nbsp;hearing&nbsp;(er,&nbsp;reading)&nbsp;your&nbsp;thoughts.&lt;br&gt;<br>
&lt;br&gt;-Brendan&lt;br&gt;<br>

</tt>
