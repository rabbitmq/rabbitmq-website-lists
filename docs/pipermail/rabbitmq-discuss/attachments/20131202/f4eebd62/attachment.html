<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Then&nbsp;you&nbsp;could&nbsp;add&nbsp;a&nbsp;mutex&nbsp;in&nbsp;addition&nbsp;to&nbsp;rate&nbsp;limiting&nbsp;and&nbsp;prefetch&nbsp;twiddling&nbsp;to&nbsp;insure&nbsp;that&nbsp;batch&nbsp;messages&nbsp;are&nbsp;not&nbsp;processed&nbsp;as&nbsp;long&nbsp;as&nbsp;high&nbsp;priority&nbsp;messages&nbsp;are&nbsp;available&nbsp;for&nbsp;processing.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
Good&nbsp;luck,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Michael&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Dec&nbsp;2,&nbsp;2013&nbsp;at&nbsp;5:25&nbsp;AM,&nbsp;vadlamani&nbsp;maitreya&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:maitreya_vvm@yahoo.co.in&quot;&nbsp;target=&quot;_blank&quot;&gt;maitreya_vvm@yahoo.co.in&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;font-size:12pt;font-family:times&nbsp;new&nbsp;roman,new&nbsp;york,times,serif&quot;&gt;Hi&nbsp;Michael,&lt;br&gt;&lt;br&gt;Thankyou&nbsp;for&nbsp;the&nbsp;response.&nbsp;The&nbsp;application&nbsp;we&nbsp;built&nbsp;infact&nbsp;supports&nbsp;only&nbsp;two&nbsp;priorities,&nbsp;ondemand&nbsp;and&nbsp;batch.&nbsp;The&nbsp;problem&nbsp;here&nbsp;is&nbsp;once&nbsp;the&nbsp;ondemand&nbsp;message&nbsp;is&nbsp;in&nbsp;queue,&nbsp;it&nbsp;must&nbsp;be&nbsp;processed&nbsp;irrespective&nbsp;of&nbsp;any&nbsp;number&nbsp;of&nbsp;batch&nbsp;messages.&nbsp;That&nbsp;is&nbsp;the&nbsp;reason&nbsp;for&nbsp;this&nbsp;weird&nbsp;logic&nbsp;we&nbsp;had&nbsp;to&nbsp;employ.&nbsp;For&nbsp;this&nbsp;usecase,&nbsp;I&nbsp;dont&nbsp;think&nbsp;the&nbsp;rate&nbsp;limiting&nbsp;and&nbsp;prefetch&nbsp;count&nbsp;variations&nbsp;would&nbsp;actual&nbsp;work.&nbsp;But&nbsp;I&nbsp;will&nbsp;try&nbsp;to&nbsp;play&nbsp;with&nbsp;the&nbsp;asynch&nbsp;connections&nbsp;for&nbsp;sure.&lt;br&gt;<br>
&lt;br&gt;regards,&lt;br&gt;Maitreya&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;display:block&quot;&gt;&nbsp;&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;&lt;div&nbsp;style=&quot;font-family:times&nbsp;new&nbsp;roman,new&nbsp;york,times,serif;font-size:12pt&quot;&gt;&nbsp;&lt;div&nbsp;style=&quot;font-family:times&nbsp;new&nbsp;roman,new&nbsp;york,times,serif;font-size:12pt&quot;&gt;<br>
&nbsp;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&nbsp;On&nbsp;Tuesday,&nbsp;26&nbsp;November&nbsp;2013<br>
&nbsp;8:32&nbsp;PM,&nbsp;&quot;Laing,&nbsp;Michael&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:michael.laing@nytimes.com&quot;&nbsp;target=&quot;_blank&quot;&gt;michael.laing@nytimes.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&nbsp;&lt;/font&gt;&nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;You&nbsp;say&nbsp;you&nbsp;want&nbsp;a&nbsp;scalable&nbsp;solution.&nbsp;Therefore&nbsp;with&nbsp;pika&nbsp;you&nbsp;should&nbsp;use&nbsp;a&nbsp;high-performance&nbsp;asynch&nbsp;connector,&nbsp;i.e.&nbsp;tornado&nbsp;in&nbsp;pika&nbsp;9.13.&nbsp;So&nbsp;start&nbsp;there&nbsp;and&nbsp;follow&nbsp;the&nbsp;examples&nbsp;of&nbsp;using&nbsp;asynch&nbsp;connections&nbsp;-&nbsp;forget&nbsp;the&nbsp;blocking&nbsp;connection.&lt;div&gt;<br>
<br>
&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/div&gt;&lt;div&gt;Then&nbsp;you&nbsp;could&nbsp;try&nbsp;this:&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;do&nbsp;a&nbsp;simple&nbsp;priority&nbsp;queue&nbsp;I&nbsp;set&nbsp;up&nbsp;2&nbsp;queues&nbsp;and&nbsp;bind&nbsp;to&nbsp;both.&nbsp;Usually&nbsp;I&nbsp;have&nbsp;one&nbsp;queue&nbsp;that&nbsp;gets&nbsp;big&nbsp;bursts&nbsp;of&nbsp;messages&nbsp;and&nbsp;another,&nbsp;the&nbsp;priority&nbsp;one&nbsp;that&nbsp;only&nbsp;gets&nbsp;a&nbsp;few&nbsp;at&nbsp;a&nbsp;time.&nbsp;In&nbsp;this&nbsp;case&nbsp;I&nbsp;just&nbsp;set&nbsp;prefetch_count&nbsp;to&nbsp;1&nbsp;for&nbsp;both&nbsp;queues&nbsp;and&nbsp;let&nbsp;them&nbsp;interleave.&nbsp;I&nbsp;use&nbsp;acks&nbsp;always.&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;give&nbsp;more&nbsp;&#39;preference&#39;&nbsp;to&nbsp;the&nbsp;priority&nbsp;queue&nbsp;in&nbsp;the&nbsp;above&nbsp;case&nbsp;you&nbsp;can&nbsp;increase&nbsp;its&nbsp;prefetch_count,&nbsp;increasing&nbsp;the&nbsp;likelihood&nbsp;that&nbsp;a&nbsp;priority&nbsp;message&nbsp;will&nbsp;be&nbsp;ready&nbsp;when&nbsp;the&nbsp;event&nbsp;loop&nbsp;rolls&nbsp;around.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;even&nbsp;more&nbsp;preference&nbsp;you&nbsp;can&nbsp;&#39;rate&nbsp;limit&#39;&nbsp;the&nbsp;non-priority&nbsp;queue.&nbsp;I&nbsp;do&nbsp;this&nbsp;by&nbsp;registering&nbsp;a&nbsp;short&nbsp;timeout&nbsp;after&nbsp;processing&nbsp;each&nbsp;non-priority&nbsp;message&nbsp;which&nbsp;does&nbsp;the&nbsp;ack&nbsp;in&nbsp;its&nbsp;callback.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;are&nbsp;much&nbsp;more&nbsp;complicated&nbsp;ways&nbsp;to&nbsp;do&nbsp;this.&nbsp;I&nbsp;prefer&nbsp;simple.&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/div&gt;&lt;div&gt;Good&nbsp;luck,&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/div&gt;&lt;div&gt;Michael&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
&lt;/div&gt;&lt;div&gt;P.S.&nbsp;You&nbsp;can&nbsp;subscribe&nbsp;to&nbsp;a&nbsp;queue&nbsp;that&nbsp;is&nbsp;not&nbsp;currently&nbsp;bound&nbsp;to&nbsp;anything.&nbsp;Once&nbsp;subscribed,&nbsp;you&nbsp;can&nbsp;bind&nbsp;the&nbsp;queue&nbsp;one&nbsp;or&nbsp;more&nbsp;times&nbsp;and&nbsp;catch&nbsp;each&nbsp;bind_ok&nbsp;callback&nbsp;to&nbsp;know&nbsp;you&nbsp;are&nbsp;consuming.&nbsp;I&#39;m&nbsp;not&nbsp;sure&nbsp;this&nbsp;is&nbsp;actually&nbsp;useful&nbsp;in&nbsp;your&nbsp;case.&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;div&gt;On&nbsp;Tue,&nbsp;Nov&nbsp;26,&nbsp;2013&nbsp;at&nbsp;1:25&nbsp;AM,&nbsp;vadlamani&nbsp;maitreya&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;rel=&quot;nofollow&quot;&nbsp;shape=&quot;rect&quot;&nbsp;href=&quot;mailto:maitreya_vvm@yahoo.co.in&quot;&nbsp;target=&quot;_blank&quot;&gt;maitreya_vvm@yahoo.co.in&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
<br>
&lt;blockquote&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;font-size:12pt;font-family:times&nbsp;new&nbsp;roman,new&nbsp;york,times,serif&quot;&gt;Hello&nbsp;Everyone,&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;I&nbsp;have&nbsp;a&nbsp;small&nbsp;problem&nbsp;with&nbsp;RMQ&nbsp;and&nbsp;pika&nbsp;client&nbsp;and&nbsp;would&nbsp;like&nbsp;to&nbsp;ask&nbsp;guyz&nbsp;here&nbsp;for&nbsp;some&nbsp;help.&nbsp;The&nbsp;situation&nbsp;is&nbsp;as&nbsp;below,&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
<br>
&lt;br&nbsp;clear=&quot;none&quot;&gt;I&nbsp;am&nbsp;using&nbsp;RabbitMQ&nbsp;with&nbsp;the&nbsp;pika&nbsp;clients&nbsp;in&nbsp;a&nbsp;scalable&nbsp;solution.&nbsp;The&nbsp;solution&nbsp;requires&nbsp;messaging&nbsp;with&nbsp;two&nbsp;priorities.&nbsp;So&nbsp;every&nbsp;worker&nbsp;(through&nbsp;pika&nbsp;client)&nbsp;gets&nbsp;messages&nbsp;from&nbsp;the&nbsp;HighPriority&nbsp;Queue&nbsp;first&nbsp;and&nbsp;then&nbsp;goes&nbsp;to&nbsp;the&nbsp;Low&nbsp;Priority&nbsp;queue&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;messages&nbsp;left&nbsp;in&nbsp;the&nbsp;HP&nbsp;Queue.&nbsp;I&nbsp;decide&nbsp;to&nbsp;scale&nbsp;the&nbsp;number&nbsp;of&nbsp;workers&nbsp;according&nbsp;to&nbsp;the&nbsp;number&nbsp;of&nbsp;ready&nbsp;messages&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;consumers&nbsp;attached&nbsp;to&nbsp;the&nbsp;queue.&nbsp;So&nbsp;the&nbsp;following&nbsp;is&nbsp;the&nbsp;workflow&nbsp;i&nbsp;follow&nbsp;to&nbsp;achieve&nbsp;the&nbsp;above.&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
<br>
&lt;br&nbsp;clear=&quot;none&quot;&gt;1)&nbsp;Register&nbsp;usingÂ &nbsp;basic_consume&nbsp;on&nbsp;the&nbsp;queue.&lt;br&nbsp;clear=&quot;none&quot;&gt;2)&nbsp;Do&nbsp;basic_get&nbsp;from&nbsp;HP&nbsp;Queue&lt;br&nbsp;clear=&quot;none&quot;&gt;3)If&nbsp;no&nbsp;messages&nbsp;in&nbsp;HP&nbsp;Queue&nbsp;do&nbsp;a&nbsp;basic_get&nbsp;from&nbsp;LP&nbsp;Queue.&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;I&nbsp;donot&nbsp;execute&nbsp;start_consuming()&nbsp;so<br>
&nbsp;the&nbsp;basic_consume&nbsp;is&nbsp;just&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;consumers&nbsp;count&nbsp;in&nbsp;the&nbsp;RMQ&nbsp;server.&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;This&nbsp;logic&nbsp;works&nbsp;perfectly&nbsp;fine&nbsp;with&nbsp;the&nbsp;standard&nbsp;Java&nbsp;Client.&nbsp;But&nbsp;when&nbsp;i&nbsp;try&nbsp;to&nbsp;do&nbsp;the&nbsp;same&nbsp;with&nbsp;the&nbsp;Pika&nbsp;Client,&nbsp;the&nbsp;moment&nbsp;the&nbsp;basic_consume&nbsp;is&nbsp;called&nbsp;the&nbsp;data&nbsp;events&nbsp;are&nbsp;processed&nbsp;and&nbsp;the&nbsp;callback&nbsp;function&nbsp;is&nbsp;executed&nbsp;on&nbsp;the&nbsp;incoming&nbsp;message,&nbsp;eventhough&nbsp;the&nbsp;start_consuming()&nbsp;function&nbsp;is&nbsp;not&nbsp;called.&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
<br>
&lt;br&nbsp;clear=&quot;none&quot;&gt;So,&nbsp;a&nbsp;couple&nbsp;of&nbsp;questions&nbsp;here,&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;1.&nbsp;Is&nbsp;there&nbsp;a&nbsp;way&nbsp;to&nbsp;register&nbsp;as&nbsp;a&nbsp;consumer&nbsp;to&nbsp;a&nbsp;queue&nbsp;without&nbsp;actually&nbsp;starting&nbsp;to&nbsp;consume&nbsp;from&nbsp;the&nbsp;queue&nbsp;(even&nbsp;a&nbsp;hack&nbsp;into&nbsp;the&nbsp;code&nbsp;is&nbsp;fine)&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
2.&nbsp;Is&nbsp;it&nbsp;bug&nbsp;that&nbsp;basic_consume()&nbsp;starts&nbsp;consuming&nbsp;without&nbsp;actually&nbsp;calling&nbsp;start_consuming()&nbsp;(the&nbsp;actual&nbsp;blocking&nbsp;function),&nbsp;and&nbsp;should&nbsp;i&nbsp;raise&nbsp;an&nbsp;issue&nbsp;in&nbsp;github&nbsp;regarding&nbsp;this&nbsp;?&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
&lt;br&nbsp;clear=&quot;none&quot;&gt;Last&nbsp;but&nbsp;not&nbsp;the&nbsp;least,&nbsp;the&nbsp;version&nbsp;of&nbsp;the&nbsp;rabbitMQ&nbsp;server&nbsp;is&nbsp;3.1.2&nbsp;and&nbsp;the&nbsp;pika&nbsp;client,&nbsp;i&nbsp;have&nbsp;tried&nbsp;both&nbsp;0.9.6&nbsp;and&nbsp;0.9.13&nbsp;with&nbsp;the&nbsp;above&nbsp;scenario.&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;Thankyou<br>
&nbsp;everyone,&lt;br&nbsp;clear=&quot;none&quot;&gt;Maitreya&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;_______________________________________________&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
&lt;a&nbsp;rel=&quot;nofollow&quot;&nbsp;shape=&quot;rect&quot;&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
&lt;a&nbsp;rel=&quot;nofollow&quot;&nbsp;shape=&quot;rect&quot;&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;<br>
&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;none&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&nbsp;&nbsp;&lt;/div&gt;&nbsp;&lt;/div&gt;&nbsp;&nbsp;&lt;/div&gt;&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
