<tt>
&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;[Please&nbsp;pardon&nbsp;any&nbsp;duplicates&nbsp;--&nbsp;cancelled&nbsp;an&nbsp;initial&nbsp;reply&nbsp;held&nbsp;for&nbsp;moderation;&nbsp;sending&nbsp;this&nbsp;one&nbsp;as&nbsp;a&nbsp;subscriber].&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;On&nbsp;Wed,&nbsp;Oct&nbsp;17,&nbsp;2012&nbsp;at&nbsp;5:14&nbsp;AM,&nbsp;Emile&nbsp;Joubert&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:emile@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;emile@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
You&nbsp;are&nbsp;correct&nbsp;that&nbsp;AMQP&nbsp;timestamps&nbsp;have&nbsp;1sec&nbsp;resolution,&nbsp;but&nbsp;nothing&lt;br&gt;<br>
prevents&nbsp;publishers&nbsp;from&nbsp;adding&nbsp;a&nbsp;custom&nbsp;header&nbsp;with&nbsp;greater&nbsp;resolution.&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;is&nbsp;a&nbsp;potential&nbsp;for&nbsp;messages&nbsp;to&nbsp;arrive&nbsp;inbetween&nbsp;retrieving&lt;br&gt;<br>
messages&nbsp;from&nbsp;the&nbsp;database&nbsp;and&nbsp;normally&nbsp;consuming&nbsp;messages&nbsp;from&nbsp;the&lt;br&gt;<br>
broker.&nbsp;Make&nbsp;sure&nbsp;you&nbsp;don&amp;#39;t&nbsp;leave&nbsp;the&nbsp;door&nbsp;open&nbsp;for&nbsp;race&nbsp;conditions.&lt;br&gt;&lt;/blockquote&gt;&lt;span&nbsp;style=&quot;font-size:13px;color:rgb(34,34,34);font-family:arial,sans-serif;background-color:rgb(255,255,255)&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-size:13px;color:rgb(34,34,34);font-family:arial,sans-serif;background-color:rgb(255,255,255)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px;color:rgb(34,34,34);font-family:arial,sans-serif;background-color:rgb(255,255,255)&quot;&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;response.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;span&nbsp;style=&quot;font-size:13px;color:rgb(34,34,34);font-family:arial,sans-serif;background-color:rgb(255,255,255)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;I&nbsp;was&nbsp;under&nbsp;the&nbsp;impression,&nbsp;in&nbsp;generating&nbsp;the&nbsp;initial&nbsp;proposal,&nbsp;that&nbsp;the&nbsp;second-resolution&nbsp;timestamp&nbsp;was&nbsp;provided&nbsp;by&nbsp;the&nbsp;AMQP&nbsp;server,&nbsp;not&nbsp;the&nbsp;client&nbsp;--&nbsp;being&nbsp;client-provided,&nbsp;I&nbsp;can&amp;#39;t&nbsp;trust&nbsp;it&nbsp;for&nbsp;the&nbsp;same&nbsp;reason&nbsp;that&nbsp;I&nbsp;can&amp;#39;t&nbsp;trust&nbsp;a&nbsp;milisecond-resolution&nbsp;timestamp&nbsp;in&nbsp;a&nbsp;client-provided&nbsp;header.&nbsp;Consequently,&nbsp;it&amp;#39;s&nbsp;back&nbsp;to&nbsp;the&nbsp;drawing&nbsp;board&nbsp;there.&lt;/span&gt;&lt;div&nbsp;style=&quot;font-size:13px;color:rgb(34,34,34);font-family:arial,sans-serif;background-color:rgb(255,255,255)&quot;&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:13px;color:rgb(34,34,34);font-family:arial,sans-serif;background-color:rgb(255,255,255)&quot;&gt;My&nbsp;current&nbsp;approach&nbsp;assumes&nbsp;that&nbsp;delivery&nbsp;order&nbsp;will&nbsp;be&nbsp;consistent&nbsp;across&nbsp;clients.&nbsp;This&nbsp;seems&nbsp;to&nbsp;be&nbsp;required&nbsp;by&nbsp;the&nbsp;section&nbsp;of&nbsp;the&nbsp;AMQP&nbsp;spec&nbsp;reading&nbsp;&amp;quot;&lt;span&nbsp;style=&quot;line-height:18px;color:rgb(85,85,85);font-family:Verdana,sans-serif&quot;&gt;The&nbsp;server&nbsp;MUST&nbsp;deliver&nbsp;messages&nbsp;of&nbsp;the&nbsp;same&nbsp;priority&nbsp;in&nbsp;order&nbsp;irrespective&nbsp;of&nbsp;their&nbsp;individual&nbsp;persistence&lt;/span&gt;&amp;quot;;&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;case,&nbsp;I&nbsp;can&nbsp;pull&nbsp;the&nbsp;first&nbsp;message&nbsp;off&nbsp;the&nbsp;queue,&nbsp;find&nbsp;it&nbsp;in&nbsp;the&nbsp;database&nbsp;(polling&nbsp;until&nbsp;it&nbsp;exists),&nbsp;and&nbsp;use&nbsp;the&nbsp;database&nbsp;insert&nbsp;ordering&nbsp;(as&nbsp;recorded&nbsp;by&nbsp;an&nbsp;AUTO_INCREMENT&nbsp;key)&nbsp;to&nbsp;manage&nbsp;replay.&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
