<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;setup&nbsp;rabbitmq&nbsp;it&nbsp;can&nbsp;be&nbsp;accessed&nbsp;externally&nbsp;(from&nbsp;non-localhost)&nbsp;through&nbsp;nginx.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;nginx-rabbitmq.conf:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;server&nbsp;{&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5672;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;server_name&nbsp;&nbsp;x.x.x.x;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;/&nbsp;{&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_pass&nbsp;http://localhost:55672/;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;rabbitmq.conf:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[&lt;/div&gt;&lt;div&gt;&nbsp;{rabbit,&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;[&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;{tcp_listeners,&nbsp;[{&quot;127.0.0.1&quot;,&nbsp;55672}]}&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;]&lt;/div&gt;&lt;div&gt;&nbsp;}&lt;/div&gt;&lt;div&gt;]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;By&nbsp;default&nbsp;guest&nbsp;user&nbsp;can&nbsp;only&nbsp;interact&nbsp;from&nbsp;localhost,&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;create&nbsp;another&nbsp;user&nbsp;with&nbsp;required&nbsp;permissions,&nbsp;like&nbsp;so:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;sudo&nbsp;rabbitmqctl&nbsp;add_user&nbsp;my_user&nbsp;my_password&lt;/div&gt;&lt;div&gt;sudo&nbsp;rabbitmqctl&nbsp;set_permissions&nbsp;my_user&nbsp;&quot;.*&quot;&nbsp;&quot;.*&quot;&nbsp;&quot;.*&quot;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;when&nbsp;I&nbsp;attempt&nbsp;a&nbsp;connection&nbsp;to&nbsp;rabbitmq&nbsp;through&nbsp;pika&nbsp;I&nbsp;get&nbsp;ConnectionClosed&nbsp;exception&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;import&nbsp;pika&lt;/div&gt;&lt;div&gt;credentials&nbsp;=&nbsp;pika.credentials.PlainCredentials('my_username',&nbsp;'my_password')&lt;/div&gt;&lt;div&gt;pika.BlockingConnection(&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;pika.ConnectionParameters(host=ip_address,&nbsp;port=55672,&nbsp;credentials=credentials)&lt;/div&gt;&lt;div&gt;)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;if&nbsp;I&nbsp;use&nbsp;the&nbsp;same&nbsp;credentials&nbsp;via&nbsp;localhost&nbsp;and&nbsp;change&nbsp;to&nbsp;port&nbsp;5672&nbsp;then&nbsp;it&nbsp;connects&nbsp;ok:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;opened&nbsp;port&nbsp;5672&nbsp;on&nbsp;the&nbsp;GCE&nbsp;web&nbsp;console,&nbsp;and&nbsp;communication&nbsp;through&nbsp;nginx&nbsp;is&nbsp;happening:&nbsp;nginx&nbsp;access.log&nbsp;file&nbsp;shows&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[30/Apr/2014:22:59:41&nbsp;+0000]&nbsp;&quot;AMQP\x00\x00\x09\x01&quot;&nbsp;400&nbsp;172&nbsp;&quot;-&quot;&nbsp;&quot;-&quot;&nbsp;&quot;-&quot;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Which&nbsp;shows&nbsp;a&nbsp;400&nbsp;status&nbsp;code&nbsp;response&nbsp;(bad&nbsp;request).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;by&nbsp;the&nbsp;looks&nbsp;the&nbsp;request&nbsp;fails&nbsp;when&nbsp;going&nbsp;through&nbsp;nginx,&nbsp;but&nbsp;works&nbsp;when&nbsp;we&nbsp;request&nbsp;rabbitmq&nbsp;directly.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Has&nbsp;anyone&nbsp;else&nbsp;had&nbsp;similar&nbsp;problems/got&nbsp;rabbitmq&nbsp;working&nbsp;for&nbsp;external&nbsp;users&nbsp;through&nbsp;nginx?&nbsp;is&nbsp;there&nbsp;a&nbsp;rabbitmq&nbsp;log&nbsp;file&nbsp;where&nbsp;I&nbsp;can&nbsp;see&nbsp;each&nbsp;request&nbsp;and&nbsp;help&nbsp;further&nbsp;troubleshooting?&lt;/div&gt;&lt;/div&gt;
</tt>
