<tt>
Is&nbsp;the&nbsp;queue&nbsp;set&nbsp;to&nbsp;be&nbsp;durable?&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Aug&nbsp;30,&nbsp;2011&nbsp;at&nbsp;6:50&nbsp;AM,&nbsp;Matthew&nbsp;Sackman&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthew@rabbitmq.com&quot;&gt;matthew@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
Hi&nbsp;Cezary,&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;Thu,&nbsp;Aug&nbsp;25,&nbsp;2011&nbsp;at&nbsp;01:09:47PM&nbsp;+0100,&nbsp;Cezary&nbsp;Siwek&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;m&nbsp;facing&nbsp;an&nbsp;issue&nbsp;with&nbsp;my&nbsp;rabittmq&nbsp;cluster&nbsp;where&nbsp;a&nbsp;queue&lt;br&gt;<br>
&amp;gt;&nbsp;disappears&nbsp;from&nbsp;a&nbsp;node.&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;have&nbsp;2&nbsp;nodes&nbsp;in&nbsp;a&nbsp;cluster&nbsp;working&nbsp;in&nbsp;&amp;quot;disk&nbsp;mode&amp;quot;.&lt;br&gt;<br>
&amp;gt;&nbsp;Node1&nbsp;-&nbsp;only&nbsp;consumes&nbsp;messages&nbsp;from&nbsp;the&nbsp;queue.&lt;br&gt;<br>
&amp;gt;&nbsp;Node2&nbsp;-&nbsp;only&nbsp;publishes&nbsp;messages&nbsp;to&nbsp;the&nbsp;queue.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;The&nbsp;consumer&nbsp;script&nbsp;on&nbsp;Node1&nbsp;creates&nbsp;a&nbsp;durable&nbsp;queue&nbsp;and&nbsp;waits&nbsp;for&lt;br&gt;<br>
&amp;gt;&nbsp;messages.&lt;br&gt;<br>
&amp;gt;&nbsp;Everything&nbsp;works&nbsp;fine&nbsp;until&nbsp;some&nbsp;no-activity&nbsp;time.&nbsp;I&nbsp;can&amp;#39;t&nbsp;say&nbsp;how&lt;br&gt;<br>
&amp;gt;&nbsp;long&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;but&nbsp;usually&nbsp;after&nbsp;more&nbsp;than&nbsp;24h&nbsp;the&nbsp;queue&lt;br&gt;<br>
&amp;gt;&nbsp;disappears&nbsp;from&nbsp;Node2&nbsp;and&nbsp;the&nbsp;consumer&nbsp;stops&nbsp;receiving&nbsp;messages.&nbsp;The&lt;br&gt;<br>
&amp;gt;&nbsp;list_queues&nbsp;command&nbsp;shows&nbsp;the&nbsp;queue&nbsp;exists&nbsp;on&nbsp;Node1&nbsp;but&nbsp;not&nbsp;on&lt;br&gt;<br>
&amp;gt;&nbsp;Node2.&lt;br&gt;<br>
&amp;gt;&nbsp;I&amp;#39;ve&nbsp;done&nbsp;a&nbsp;packet&nbsp;trace&nbsp;when&nbsp;it&nbsp;happened&nbsp;and&nbsp;I&nbsp;can&nbsp;see&nbsp;some&nbsp;packets&lt;br&gt;<br>
&amp;gt;&nbsp;are&nbsp;being&nbsp;exchanged&nbsp;between&nbsp;nodes.&nbsp;Also&nbsp;cluster_status&nbsp;commands&lt;br&gt;<br>
&amp;gt;&nbsp;shows&nbsp;that&nbsp;both&nbsp;nodes&nbsp;are&nbsp;up&nbsp;and&nbsp;running&nbsp;in&nbsp;the&nbsp;cluster.&lt;br&gt;<br>
&amp;gt;&nbsp;When&nbsp;I&nbsp;try&nbsp;to&nbsp;declare_queue&nbsp;on&nbsp;the&nbsp;Node2&nbsp;i&nbsp;get&nbsp;&amp;#39;NOT_FOUND&nbsp;-&nbsp;no&nbsp;queue&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;#39;msgs&amp;#39;&nbsp;in&nbsp;vhost&nbsp;&amp;#39;/vhost1&amp;#39;.&lt;br&gt;<br>
&amp;gt;&nbsp;All&nbsp;I&nbsp;need&nbsp;to&nbsp;do&nbsp;to&nbsp;have&nbsp;the&nbsp;Node2&nbsp;running&nbsp;is&nbsp;to&nbsp;run&nbsp;stop_app&nbsp;and&nbsp;start_app.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Both&nbsp;nodes&nbsp;are&nbsp;sitting&nbsp;behind&nbsp;firewalls&nbsp;(in&nbsp;separate&nbsp;networks)&nbsp;but&lt;br&gt;<br>
&amp;gt;&nbsp;both&nbsp;firewalls&nbsp;have&nbsp;been&nbsp;granted&nbsp;to&nbsp;pass&nbsp;all&nbsp;the&nbsp;traffic&nbsp;between&lt;br&gt;<br>
&amp;gt;&nbsp;these&nbsp;two&nbsp;boxes.&lt;br&gt;<br>
&amp;gt;&nbsp;It&nbsp;happens&nbsp;on&nbsp;my&nbsp;dev&nbsp;platfrom.&nbsp;On&nbsp;production&nbsp;I&nbsp;don&amp;#39;t&nbsp;think&nbsp;I&nbsp;will&lt;br&gt;<br>
&amp;gt;&nbsp;ever&nbsp;have&nbsp;such&nbsp;long&nbsp;quiet&nbsp;periods&nbsp;but&nbsp;I&nbsp;need&nbsp;to&nbsp;find&nbsp;out&nbsp;what&nbsp;is&lt;br&gt;<br>
&amp;gt;&nbsp;causing&nbsp;this.&lt;br&gt;<br>
&lt;br&gt;<br>
Hmm,&nbsp;this&nbsp;is&nbsp;odd.&nbsp;It&nbsp;suggests&nbsp;that&nbsp;the&nbsp;two&nbsp;nodes&nbsp;have&nbsp;lost&nbsp;contact&nbsp;with&lt;br&gt;<br>
each&nbsp;other&nbsp;which&nbsp;is&nbsp;why&nbsp;Node2&nbsp;is&nbsp;responding&nbsp;with&nbsp;the&nbsp;NOT_FOUND&nbsp;when&nbsp;you&lt;br&gt;<br>
try&nbsp;to&nbsp;redeclare&nbsp;the&nbsp;queue.&nbsp;However,&nbsp;if&nbsp;at&nbsp;this&nbsp;point&nbsp;the&nbsp;cluster_status&lt;br&gt;<br>
on&nbsp;both&nbsp;nodes&nbsp;is&nbsp;suggesting&nbsp;everything&nbsp;is&nbsp;clustered&nbsp;and&nbsp;happy,&nbsp;then&nbsp;this&lt;br&gt;<br>
is&nbsp;very&nbsp;odd&nbsp;indeed.&nbsp;Could&nbsp;you&nbsp;check&nbsp;that&nbsp;you&nbsp;can&nbsp;achieve&nbsp;these&nbsp;sets&nbsp;of&lt;br&gt;<br>
circumstances?&lt;br&gt;<br>
&lt;br&gt;<br>
Also,&nbsp;do&nbsp;you&nbsp;have&nbsp;the&nbsp;logs&nbsp;for&nbsp;both&nbsp;nodes&nbsp;during&nbsp;the&nbsp;no-activity&nbsp;time?&lt;br&gt;<br>
I&amp;#39;m&nbsp;curious&nbsp;whether&nbsp;there&nbsp;are&nbsp;entries&nbsp;in&nbsp;there&nbsp;that&nbsp;suggest&nbsp;the&nbsp;cluster&lt;br&gt;<br>
has&nbsp;split&nbsp;apart.&nbsp;If&nbsp;they&amp;#39;re&nbsp;large,&nbsp;then&nbsp;maybe&nbsp;send&nbsp;them&nbsp;to&nbsp;us&nbsp;off-list.&lt;br&gt;<br>
&lt;br&gt;<br>
Matthew&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
