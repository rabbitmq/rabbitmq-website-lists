<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;Sorry,&nbsp;reposting&nbsp;this&nbsp;since&nbsp;the&nbsp;original&nbsp;one&nbsp;was&nbsp;sent&nbsp;using&nbsp;unregistered&nbsp;email&nbsp;address&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;Johanes&lt;/div&gt;<br>
<br>
<br>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;----------&nbsp;Forwarded&nbsp;message&nbsp;----------&lt;br&gt;Date:&nbsp;6&nbsp;February&nbsp;2014&nbsp;09:17&lt;br&gt;Subject:&nbsp;RabbitMQ&nbsp;management&nbsp;down&nbsp;after&nbsp;cluster&nbsp;issue&lt;br&gt;To:&nbsp;&lt;div&nbsp;class=&quot;gmail_default&quot;&nbsp;style=&quot;font-family:courier&nbsp;new,monospace;display:inline&quot;&gt;<br>
<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&nbsp;style=&quot;font-family:courier&nbsp;new,monospace;display:inline&quot;&gt;&lt;/div&gt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
Hi&nbsp;all,&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;We&nbsp;are&nbsp;having&nbsp;problem&nbsp;with&nbsp;our&nbsp;RabbitMQ&nbsp;cluster&nbsp;which&nbsp;we&nbsp;are&nbsp;not&nbsp;quite&nbsp;sure&nbsp;how&nbsp;to&nbsp;debug&nbsp;the&nbsp;root&nbsp;cause.&nbsp;We&nbsp;have&nbsp;2&nbsp;nodes&nbsp;in&nbsp;a&nbsp;cluster&nbsp;and&nbsp;one&nbsp;of&nbsp;the&nbsp;node&nbsp;(MQ1)&nbsp;had&nbsp;its&nbsp;management&nbsp;console&nbsp;down&nbsp;after&nbsp;clustering&nbsp;issue/network&nbsp;partition.&nbsp;(I&nbsp;assume&nbsp;this&nbsp;is&nbsp;what&nbsp;happen&nbsp;because&nbsp;we&nbsp;ping&nbsp;the&nbsp;management&nbsp;console&nbsp;from&nbsp;zabbix&nbsp;every&nbsp;minute)&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;Last&nbsp;month&nbsp;we&nbsp;experience&nbsp;network&nbsp;partition&nbsp;and&nbsp;the&nbsp;same&nbsp;node&#39;s&nbsp;management&nbsp;plugin&nbsp;was&nbsp;down&nbsp;as&nbsp;well.&nbsp;Since&nbsp;then&nbsp;that&nbsp;node&nbsp;had&nbsp;been&nbsp;reinstalled&nbsp;with&nbsp;the&nbsp;same&nbsp;RabbitMQ&nbsp;version&nbsp;and&nbsp;we&nbsp;use&nbsp;&quot;auto-heal&quot;&nbsp;policy&nbsp;when&nbsp;a&nbsp;network&nbsp;partition&nbsp;happen.&lt;br&gt;<br>
<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;Looking&nbsp;at&nbsp;both&nbsp;nodes&#39;&nbsp;log&nbsp;here&nbsp;is&nbsp;some&nbsp;critical&nbsp;information&nbsp;i&nbsp;can&nbsp;gather&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;MQ1&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:49&nbsp;===&lt;br&gt;rabbit&nbsp;on&nbsp;node&nbsp;rabbit@mq2&nbsp;down&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:51&nbsp;===&lt;br&gt;Statistics&nbsp;database&nbsp;started.&lt;br&gt;<br>
<br>
<br>
=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:51&nbsp;===&lt;br&gt;Mirrored-queue&nbsp;(queue&nbsp;&#39;email.out.5&#39;&nbsp;in&nbsp;vhost&nbsp;&#39;/&#39;):&nbsp;Slave&nbsp;&lt;rabbit@mq1.3.10297.0&gt;&nbsp;saw&nbsp;deaths&nbsp;of&nbsp;mirrors&nbsp;&lt;rabbit@mq2.2.&lt;br&gt;289.0&gt;&lt;br&gt;.......&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;<br>
<br>
<br>
Mnesia(rabbit@mq1):&nbsp;**&nbsp;ERROR&nbsp;**&nbsp;mnesia_event&nbsp;got&nbsp;{inconsistent_database,&nbsp;running_partitioned_network,&nbsp;rabbit@mq2}&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;Autoheal&nbsp;request&nbsp;sent&nbsp;to&nbsp;rabbit@mq1&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;<br>
<br>
<br>
Autoheal&nbsp;request&nbsp;received&nbsp;from&nbsp;rabbit@mq1&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;global:&nbsp;Name&nbsp;conflict&nbsp;terminating&nbsp;{rabbit_mgmt_db,&lt;2705.453.0&gt;}&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;**&nbsp;Generic&nbsp;server&nbsp;&lt;0.10360.0&gt;&nbsp;terminating&lt;br&gt;<br>
<br>
<br>
**&nbsp;Last&nbsp;message&nbsp;in&nbsp;was&nbsp;{mnesia_locker,rabbit@mq2,granted}&lt;br&gt;**&nbsp;When&nbsp;Server&nbsp;state&nbsp;==&nbsp;{state,&lt;0.10358.0&gt;,&lt;0.10359.0&gt;,rabbit_mgmt_sup,&lt;br&gt;                           &nbsp;[{rabbit_mgmt_db,&lt;br&gt;                                &nbsp;{rabbit_mgmt_db,start_link,[]},&lt;br&gt;<br>
<br>
<br>
                                &nbsp;permanent,4294967295,worker,&lt;br&gt;                                &nbsp;[rabbit_mgmt_db]}]}&lt;br&gt;**&nbsp;Reason&nbsp;for&nbsp;termination&nbsp;==&nbsp;&lt;br&gt;**&nbsp;{unexpected_info,{mnesia_locker,rabbit@mq2,granted}}&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;<br>
<br>
<br>
Autoheal&nbsp;decision&lt;br&gt; &nbsp;*&nbsp;Partitions:&nbsp;[[rabbit@mq1],[rabbit@mq2]]&lt;br&gt; &nbsp;*&nbsp;Winner:    &nbsp;rabbit@mq1&lt;br&gt; &nbsp;*&nbsp;Losers:    &nbsp;[rabbit@mq2]&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;Autoheal:&nbsp;I&nbsp;am&nbsp;the&nbsp;winner,&nbsp;waiting&nbsp;for&nbsp;[rabbit@mq2]&nbsp;to&nbsp;stop&lt;br&gt;<br>
<br>
<br>
=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:53&nbsp;===&lt;br&gt;rabbit&nbsp;on&nbsp;node&nbsp;rabbit@mq2&nbsp;down&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:58&nbsp;===&lt;br&gt;Autoheal:&nbsp;final&nbsp;node&nbsp;has&nbsp;stopped,&nbsp;starting...&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:16:14&nbsp;===&lt;br&gt;rabbit&nbsp;on&nbsp;node&nbsp;rabbit@mq2&nbsp;up&lt;br&gt;<br>
<br>
<br>
 &lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;MQ2&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:49&nbsp;===&lt;br&gt;**&nbsp;Node&nbsp;rabbit@mq1&nbsp;not&nbsp;responding&nbsp;**&lt;br&gt;**&nbsp;Removing&nbsp;(timedout)&nbsp;connection&nbsp;**&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:49&nbsp;===&lt;br&gt;<br>
<br>
<br>
rabbit&nbsp;on&nbsp;node&nbsp;rabbit@mq1&nbsp;down&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:51&nbsp;===&lt;br&gt;Mirrored-queue&nbsp;(queue&nbsp;&#39;managedAmqpOutboundSms5&#39;&nbsp;in&nbsp;vhost&nbsp;&#39;/&#39;):&nbsp;Master&nbsp;&lt;rabbit@mq2.2.277.0&gt;&nbsp;saw&nbsp;deaths&nbsp;of&nbsp;mirrors&nbsp;&lt;rabbit@mq1.3.10289.0&gt;&nbsp;&lt;br&gt;<br>
<br>
<br>
...&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;Mnesia(rabbit@mq2):&nbsp;**&nbsp;ERROR&nbsp;**&nbsp;mnesia_event&nbsp;got&nbsp;{inconsistent_database,&nbsp;running_partitioned_network,&nbsp;rabbit@mq1}&lt;br&gt;...&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;<br>
<br>
<br>
Statistics&nbsp;database&nbsp;started.&lt;br&gt;=WARNING&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;Autoheal:&nbsp;we&nbsp;were&nbsp;selected&nbsp;to&nbsp;restart;&nbsp;winner&nbsp;is&nbsp;rabbit@mq1&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:52&nbsp;===&lt;br&gt;Stopping&nbsp;RabbitMQ&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:53&nbsp;===&lt;br&gt;<br>
<br>
<br>
stopped&nbsp;TCP&nbsp;Listener&nbsp;on&nbsp;[::]:5672&lt;br&gt;=ERROR&nbsp;REPORT====&nbsp;5-Feb-2014::11:14:59&nbsp;===&lt;br&gt;Mnesia(rabbit@mq2):&nbsp;**&nbsp;ERROR&nbsp;**&nbsp;mnesia_event&nbsp;got&nbsp;{inconsistent_database,&nbsp;starting_partitioned_network,&nbsp;rabbit@mq1}&lt;br&gt;=INFO&nbsp;REPORT====&nbsp;5-Feb-2014::11:15:13&nbsp;===&lt;br&gt;<br>
<br>
<br>
Starting&nbsp;RabbitMQ&nbsp;3.1.5&nbsp;on&nbsp;Erlang&nbsp;R14B04&lt;br&gt;Copyright&nbsp;(C)&nbsp;2007-2013&nbsp;GoPivotal,&nbsp;Inc.&lt;br&gt;Licensed&nbsp;under&nbsp;the&nbsp;MPL. &nbsp;See&nbsp;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.rabbitmq.com/&lt;/a&gt;&lt;br&gt;...&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;Is&nbsp;there&nbsp;some&nbsp;obvious&nbsp;error&nbsp;I&nbsp;should&nbsp;be&nbsp;looking&nbsp;at&nbsp;from&nbsp;RabbitMQ&nbsp;log&nbsp;to&nbsp;find&nbsp;out&nbsp;what&#39;s&nbsp;happening?&nbsp;because&nbsp;the&nbsp;other&nbsp;log&nbsp;files&nbsp;do&nbsp;not&nbsp;seem&nbsp;to&nbsp;provide&nbsp;meaningful&nbsp;information.&lt;br&gt;<br>
<br>
<br>
&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt; &lt;br&gt;&lt;br&gt;Here&#39;s&nbsp;our&nbsp;system&nbsp;setup&nbsp;(in&nbsp;case&nbsp;it&nbsp;may&nbsp;help)&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;-&nbsp;2&nbsp;nodes&nbsp;cluster&nbsp;on&nbsp;Linode&lt;br&gt;<br>
&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;-&nbsp;Ubuntu&nbsp;12.04.3&nbsp;instance&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;-&nbsp;RabbitMQ&nbsp;3.1.5&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
-&nbsp;management&nbsp;plugin&nbsp;enabled&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;-&nbsp;both&nbsp;nodes&nbsp;communicating&nbsp;on&nbsp;private&nbsp;LAN&nbsp;ip&nbsp;address&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
-&nbsp;both&nbsp;nodes&nbsp;is&nbsp;used&nbsp;by&nbsp;our&nbsp;app&nbsp;servers&nbsp;using&nbsp;spring-amqp&nbsp;to&nbsp;communicate&nbsp;(might&nbsp;be&nbsp;unrelated&nbsp;information)&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:courier&nbsp;new,monospace&quot;&gt;<br>
<br>
<br>
Any&nbsp;hints&nbsp;or&nbsp;help&nbsp;to&nbsp;debug&nbsp;the&nbsp;issue&nbsp;will&nbsp;be&nbsp;appreciated.&nbsp;&lt;br&gt;&lt;br&gt;&lt;br&gt;Thanks&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;div&gt;Johanes&lt;/div&gt;<br>
<br>
<br>
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
