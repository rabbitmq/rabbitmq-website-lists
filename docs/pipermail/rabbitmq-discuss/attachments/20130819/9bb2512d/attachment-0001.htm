<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Matthias,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;the&nbsp;response,&nbsp;so&nbsp;the&nbsp;extra&nbsp;process&nbsp;queue&nbsp;during&nbsp;our&nbsp;peak&nbsp;message&nbsp;throughput&nbsp;which&nbsp;in&nbsp;turn&nbsp;causes&nbsp;the&nbsp;load&nbsp;average&nbsp;to&nbsp;be&nbsp;reported&nbsp;much&nbsp;higher&nbsp;is&nbsp;just&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;this?&nbsp; We&nbsp;normally&nbsp;have&nbsp;about&nbsp;600&nbsp;connections&nbsp;(mostly&nbsp;consumers)&nbsp;and&nbsp;our&nbsp;producers&nbsp;all&nbsp;publish&nbsp;to&nbsp;topic&nbsp;exchanges,&nbsp;we&nbsp;have&nbsp;around&nbsp;250&nbsp;queues.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards&lt;/div&gt;&lt;div&gt;Dan&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Aug&nbsp;19,&nbsp;2013&nbsp;at&nbsp;6:52&nbsp;PM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Dan,&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;19/08/13&nbsp;03:58,&nbsp;Dan_b&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
We&nbsp;have&nbsp;recently&nbsp;upgraded&nbsp;from&nbsp;rabbitmq-server&nbsp;2.6.1&nbsp;to&nbsp;3.1.x&nbsp;(we&nbsp;have&nbsp;one&lt;br&gt;<br>
cluster&nbsp;running&nbsp;3.1.5&nbsp;and&nbsp;one&nbsp;running&nbsp;3.1.3).&nbsp; On&nbsp;both&nbsp;servers&nbsp;we&nbsp;have&nbsp;seen&lt;br&gt;<br>
the&nbsp;load&nbsp;average&nbsp;increase&nbsp;significantly,&nbsp;with&nbsp;it&nbsp;peaking&nbsp;up&nbsp;to&nbsp;2x&nbsp;the&nbsp;number&lt;br&gt;<br>
cores.&nbsp; The&nbsp;CPU&nbsp;utilization&nbsp;and&nbsp;IO&nbsp;wait&nbsp;aren&amp;#39;t&nbsp;affected&nbsp;and&nbsp;it&nbsp;seems&nbsp;to&nbsp;be&lt;br&gt;<br>
down&nbsp;to&nbsp;internal&nbsp;locks.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
I&amp;#39;d&nbsp;guess&nbsp;those&nbsp;FUTEXes&nbsp;have&nbsp;something&nbsp;to&nbsp;do&nbsp;with&nbsp;timers.&nbsp;They&nbsp;are&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;fsyncs,&nbsp;which&nbsp;in&nbsp;rabbit&nbsp;are&nbsp;typically&nbsp;triggered&nbsp;by&nbsp;timers.&nbsp;So&nbsp;the&nbsp;sequence&nbsp;you&nbsp;are&nbsp;seeing&nbsp;is&lt;br&gt;<br>
&lt;br&gt;<br>
1.&nbsp;write&nbsp;message&nbsp;to&nbsp;disk&lt;br&gt;<br>
2.&nbsp;wait&nbsp;for&nbsp;timer&nbsp;to&nbsp;expire&lt;br&gt;<br>
3.&nbsp;fsync&lt;br&gt;<br>
&lt;br&gt;<br>
e.g.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
write(27,&lt;br&gt;<br>
&amp;quot;\0\0\0\0\0\3\324=\226(\16\&lt;u&gt;&lt;/u&gt;265\355\200\307\7J\34b\4\240\&amp;quot;&lt;u&gt;&lt;/u&gt;\355)\0\0\0\0\0\0\0\0&amp;quot;...,&lt;br&gt;<br>
48)&nbsp;=&nbsp;48&lt;br&gt;<br>
futex(0x2aaaab594524,&nbsp;FUTEX_WAIT_PRIVATE,&nbsp;235521,&nbsp;NULL)&nbsp;=&nbsp;-1&nbsp;EAGAIN&lt;br&gt;<br>
(Resource&nbsp;temporarily&nbsp;unavailable)&lt;br&gt;<br>
futex(0x2aaaab5944f8,&nbsp;FUTEX_WAKE_PRIVATE,&nbsp;1)&nbsp;=&nbsp;0&lt;br&gt;<br>
fsync(27)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=&nbsp;0&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
So&nbsp;nothing&nbsp;to&nbsp;worry&nbsp;about.&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;style=&quot;font-family:Verdana,Helvetica,Arial,sans-serif;font-size:13px;line-height:16px;text-align:left;background-color:rgb(255,255,255)&quot;&gt;<br>
&lt;b&gt;Dan&nbsp;Bason &lt;/b&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:Verdana,Helvetica,Arial,sans-serif;font-size:13px;line-height:16px;text-align:left;background-color:rgb(255,255,255)&quot;&gt;Infrastructure&nbsp;Engineer&nbsp;–&nbsp;Telogis &lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:Verdana,Helvetica,Arial,sans-serif;font-size:13px;line-height:16px;text-align:left;background-color:rgb(255,255,255)&quot;&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&amp;#39;Open&nbsp;Sans&amp;#39;,sans-serif&quot;&gt;&lt;a&nbsp;href=&quot;http://www.telogis.com&quot;&nbsp;target=&quot;_blank&quot;&gt;www.telogis.com&lt;/a&gt;&nbsp; &lt;a&nbsp;href=&quot;http://www.telogis.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;www.telogis.co.nz&lt;/a&gt; &lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&amp;#39;Open&nbsp;Sans&amp;#39;,sans-serif&quot;&gt;<br>
+1&nbsp;201&nbsp;477-1448&nbsp;(USA)&nbsp; +64&nbsp;3&nbsp;281-8065&nbsp;(NZ) &lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&amp;#39;Open&nbsp;Sans&amp;#39;,sans-serif&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&amp;#39;Open&nbsp;Sans&amp;#39;,sans-serif&quot;&gt;&lt;p&nbsp;style=&quot;font-family:arial,sans-serif;font-size:12.727272033691406px;line-height:normal&quot;&gt;<br>
&lt;/p&gt;&lt;p&nbsp;style=&quot;margin:0px&quot;&gt;&lt;a&nbsp;href=&quot;http://www.google.com/url?q=http%3A%2F%2Fwww.telogis.com%2F&amp;amp;sa=D&amp;amp;sntz=1&amp;amp;usg=AFrqEze6z4qIWKcAMjgXqM25xkuw9JMysQ&quot;&nbsp;style=&quot;font-family:arial;font-size:small;color:rgb(74,146,193)!important&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;img&nbsp;src=&quot;http://www.telogis.com/images/telogis-logo-black-sm.png&quot;&nbsp;style=&quot;border:none;padding:0px&quot;&gt;&lt;/a&gt;&lt;/p&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(0,0,0);font-family:arial;font-size:small&quot;&gt;&lt;i&nbsp;style=&quot;color:rgb(0,0,0);font-family:arial;font-size:small&quot;&gt;One&nbsp;Platform&nbsp;for&nbsp;Location&nbsp;Intelligence&lt;/i&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-family:arial;font-size:small&quot;&gt; &lt;/span&gt;&lt;br&gt;<br>
&lt;p&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
<br>
&lt;br&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;color:gray&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&gt;This&nbsp;e-mail,<br>
and&nbsp;any&nbsp;attachments,&nbsp;is&nbsp;intended&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;addressee(s)&nbsp;named&nbsp;herein<br>
and&nbsp;may&nbsp;contain&nbsp;legally&nbsp;privileged&nbsp;and/or&nbsp;confidential&nbsp;information. &nbsp;It&nbsp;is<br>
the&nbsp;property&nbsp;of&nbsp;Telogis. &nbsp;If&nbsp;you&nbsp;are&nbsp;not&nbsp;the&nbsp;intended&nbsp;recipient&nbsp;of&nbsp;this<br>
e-mail,&nbsp;you&nbsp;are&nbsp;hereby&nbsp;notified&nbsp;that&nbsp;any&nbsp;dissemination,&nbsp;distribution&nbsp;or&nbsp;copying<br>
of&nbsp;this&nbsp;e-mail,&nbsp;any&nbsp;attachments&nbsp;thereto,&nbsp;and&nbsp;use&nbsp;of&nbsp;the&nbsp;information&nbsp;contained,<br>
is&nbsp;strictly&nbsp;prohibited. &nbsp;If&nbsp;you&nbsp;have&nbsp;received&nbsp;this&nbsp;e-mail&nbsp;in&nbsp;error,&nbsp;please<br>
notify&nbsp;the&nbsp;sender&nbsp;and&nbsp;permanently&nbsp;delete&nbsp;the&nbsp;original&nbsp;and&nbsp;any&nbsp;copy&nbsp;thereof.&lt;/font&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:1.3em;font-size:1.3em&quot;&gt;&lt;/span&gt;&lt;/p&gt;
</tt>
