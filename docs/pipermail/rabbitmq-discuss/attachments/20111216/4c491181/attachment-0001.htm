<tt>
This&nbsp;is&nbsp;a&nbsp;really&nbsp;interesting&nbsp;point.&nbsp;Lots&nbsp;of&nbsp;systems&nbsp;have&nbsp;a&nbsp;&amp;quot;vetoable&nbsp;shutdown&nbsp;about&nbsp;to&nbsp;happen&amp;quot;,&nbsp;&amp;quot;non-vetoable&nbsp;shutdown&nbsp;about&nbsp;to&nbsp;happen&amp;quot;,&nbsp;&amp;quot;non-vetoable&nbsp;shutdown&nbsp;imminent&amp;quot;&nbsp;set&nbsp;of&nbsp;events:&lt;br&gt;&lt;ul&gt;<br>
&lt;li&gt;Unix&nbsp;traditionally&nbsp;used&nbsp;wall(1)&lt;/li&gt;&lt;li&gt;Windows&nbsp;and&nbsp;OS&nbsp;X&nbsp;apps&nbsp;ask&nbsp;you&nbsp;&amp;quot;Save&nbsp;this&nbsp;document&nbsp;before&nbsp;quitting?&amp;quot;&lt;/li&gt;&lt;li&gt;OS&nbsp;X&nbsp;on&nbsp;shutdown&nbsp;or&nbsp;restart&nbsp;gives&nbsp;apps&nbsp;a&nbsp;chance&nbsp;to&nbsp;abandon&nbsp;or&nbsp;delay&nbsp;the&nbsp;shutdown&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;<br>
Stepping&nbsp;back&nbsp;from&nbsp;the&nbsp;immediate&nbsp;problem,&nbsp;the&nbsp;&amp;quot;real&amp;quot;&nbsp;solution&nbsp;is&nbsp;to&nbsp;have&nbsp;the&nbsp;JVM&nbsp;and&nbsp;.NET&nbsp;virtual&nbsp;machines&nbsp;grow&nbsp;up&nbsp;and&nbsp;behave&nbsp;like&nbsp;proper&nbsp;systems,&nbsp;complete&nbsp;with&nbsp;lifecycle&nbsp;events.&nbsp;Then,&nbsp;AMQP&nbsp;connections&nbsp;have&nbsp;a&nbsp;chance&nbsp;to&nbsp;clean&nbsp;up&nbsp;and&nbsp;disconnect&nbsp;on&nbsp;their&nbsp;own,&nbsp;without&nbsp;special&nbsp;action&nbsp;on&nbsp;the&nbsp;part&nbsp;of&nbsp;the&nbsp;programmer&nbsp;and&nbsp;without&nbsp;unduly&nbsp;delaying&nbsp;or&nbsp;preventing&nbsp;VM&nbsp;shutdown.&lt;br&gt;<br>
&lt;/p&gt;&lt;p&gt;Thinking&nbsp;on&nbsp;it,&nbsp;lifecycle&nbsp;events&nbsp;like&nbsp;these&nbsp;are&nbsp;probably&nbsp;already&nbsp;present&nbsp;in&nbsp;the&nbsp;.NET&nbsp;world&nbsp;actually.&nbsp;Does&nbsp;anyone&nbsp;know&nbsp;where&nbsp;to&nbsp;look?&lt;/p&gt;&lt;p&gt;Cheers,&lt;br&gt; &nbsp;Tony&lt;br&gt;&lt;/p&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;16&nbsp;December&nbsp;2011&nbsp;08:27,&nbsp;Simon&nbsp;MacMullen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;We&amp;#39;ve&nbsp;had&nbsp;this&nbsp;argument&nbsp;back&nbsp;and&nbsp;forth&nbsp;a&nbsp;bit&nbsp;for&nbsp;both&nbsp;the&nbsp;Java&nbsp;and&nbsp;.NET&nbsp;clients.&nbsp;The&nbsp;reason&nbsp;why&nbsp;we&amp;#39;ve&nbsp;been&nbsp;reluctant&nbsp;to&nbsp;do&nbsp;this&nbsp;is&nbsp;that&nbsp;by&nbsp;making&nbsp;connections&nbsp;use&nbsp;daemon&nbsp;/&nbsp;background&nbsp;threads&nbsp;we&nbsp;encourage&nbsp;a&nbsp;situation&nbsp;where&nbsp;connections&nbsp;don&amp;#39;t&nbsp;get&nbsp;properly&nbsp;closed&nbsp;when&nbsp;your&nbsp;application&nbsp;shuts&nbsp;down.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
So&nbsp;for&nbsp;example&nbsp;if&nbsp;your&nbsp;application&nbsp;publishes&nbsp;a&nbsp;load&nbsp;of&nbsp;messages&nbsp;and&nbsp;then&nbsp;exits,&nbsp;if&nbsp;we&nbsp;used&nbsp;background&nbsp;threads&nbsp;then&nbsp;things&nbsp;would&nbsp;appear&nbsp;to&nbsp;work&nbsp;but&nbsp;there&nbsp;would&nbsp;be&nbsp;no&nbsp;guarantee&nbsp;that&nbsp;all&nbsp;the&nbsp;messages&nbsp;would&nbsp;reach&nbsp;the&nbsp;broker.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
So&nbsp;really&nbsp;the&nbsp;right&nbsp;thing&nbsp;to&nbsp;do&nbsp;is&nbsp;explicitly&nbsp;close&nbsp;connections&nbsp;at&nbsp;shut&nbsp;down&nbsp;-&nbsp;then&nbsp;you&nbsp;know&nbsp;that&nbsp;everything&nbsp;you&nbsp;thought&nbsp;the&nbsp;connections&nbsp;were&nbsp;doing&nbsp;is&nbsp;actually&nbsp;done.&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&nbsp;Simon&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;15/12/11&nbsp;20:53,&nbsp;Eyal&nbsp;Post&nbsp;wrote:&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;<br>
We&nbsp;have&nbsp;an&nbsp;issue&nbsp;with&nbsp;a&nbsp;.net&nbsp;client&nbsp;application&nbsp;that&nbsp;creates&nbsp;a&lt;br&gt;<br>
connection&nbsp;in&nbsp;order&nbsp;to&nbsp;publish&nbsp;message&nbsp;and&nbsp;caches&nbsp;this&nbsp;connection&nbsp;in&nbsp;a&lt;br&gt;<br>
variable.&nbsp;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;when&nbsp;the&nbsp;program&nbsp;exits,&nbsp;it&nbsp;gets&nbsp;stuck&nbsp;in&lt;br&gt;<br>
memory&nbsp;because&nbsp;there&nbsp;is&nbsp;an&nbsp;AMQP&nbsp;thread&nbsp;that&nbsp;doesn’t&nbsp;exit.&lt;br&gt;<br>
&lt;br&gt;<br>
I’m&nbsp;not&nbsp;sure&nbsp;how&nbsp;the&nbsp;RabbitMQ&nbsp;threads&nbsp;are&nbsp;created&nbsp;but&nbsp;in&nbsp;.net&nbsp;there&nbsp;is&lt;br&gt;<br>
an&nbsp;option&nbsp;to&nbsp;set&nbsp;a&nbsp;thread&nbsp;as&nbsp;a&nbsp;background&nbsp;thread&nbsp;and&nbsp;in&nbsp;this&nbsp;case&nbsp;when&lt;br&gt;<br>
the&nbsp;application&nbsp;closes&nbsp;it&nbsp;will&nbsp;not&nbsp;wait&nbsp;for&nbsp;background&nbsp;threads&nbsp;to&nbsp;stop.&lt;br&gt;<br>
Is&nbsp;the&nbsp;.net&nbsp;client&nbsp;setting&nbsp;the&nbsp;background&nbsp;threads&nbsp;it&nbsp;creates&nbsp;background?&lt;br&gt;<br>
If&nbsp;not,&nbsp;can&nbsp;you&nbsp;change&nbsp;that?&lt;br&gt;<br>
&lt;br&gt;<br>
See&nbsp;here&nbsp;for&nbsp;more&nbsp;details:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://msdn.microsoft.com/en-us/library/system.threading.thread.isbackground.aspx&quot;&nbsp;target=&quot;_blank&quot;&gt;http://msdn.microsoft.com/en-&lt;u&gt;&lt;/u&gt;us/library/system.threading.&lt;u&gt;&lt;/u&gt;thread.isbackground.aspx&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Eyal&nbsp;Post&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;______________________________&lt;u&gt;&lt;/u&gt;__________&lt;br&gt;<br>
This&nbsp;email&nbsp;has&nbsp;been&nbsp;scanned&nbsp;by&nbsp;the&nbsp;Symantec&nbsp;Email&nbsp;Security.cloud&nbsp;service.&lt;br&gt;<br>
For&nbsp;more&nbsp;information&nbsp;please&nbsp;visit&nbsp;&lt;a&nbsp;href=&quot;http://www.symanteccloud.com&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.symanteccloud.com&lt;/a&gt;&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;______________________________&lt;u&gt;&lt;/u&gt;__________&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.&lt;u&gt;&lt;/u&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;u&gt;&lt;/u&gt;cgi-bin/mailman/listinfo/&lt;u&gt;&lt;/u&gt;rabbitmq-discuss&lt;/a&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Simon&nbsp;MacMullen&lt;br&gt;<br>
RabbitMQ,&nbsp;VMware&lt;br&gt;<br>
______________________________&lt;u&gt;&lt;/u&gt;_________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.&lt;u&gt;&lt;/u&gt;rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/&lt;u&gt;&lt;/u&gt;cgi-bin/mailman/listinfo/&lt;u&gt;&lt;/u&gt;rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
