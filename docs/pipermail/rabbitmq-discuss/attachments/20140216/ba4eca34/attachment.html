<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;During&nbsp;periods&nbsp;of&nbsp;degraded&nbsp;WAN&nbsp;performance&nbsp;and&nbsp;availability,&nbsp;e.g.&nbsp;lost&nbsp;packets,&nbsp;increased&nbsp;latency,&nbsp;etc.&nbsp;the&nbsp;.NET&nbsp;RabbitMQ&nbsp;connection&nbsp;is&nbsp;destroyed&nbsp;according&nbsp;to&nbsp;the&nbsp;requested&nbsp;heartbeat&nbsp;and&nbsp;works&nbsp;as&nbsp;intended.&nbsp;&nbsp;Our&nbsp;client&nbsp;is&nbsp;observes&nbsp;this&nbsp;and&nbsp;then&nbsp;attempts&nbsp;to&nbsp;reconnect&nbsp;periodically&nbsp;until&nbsp;a&nbsp;connection&nbsp;is&nbsp;re-established&nbsp;with&nbsp;the&nbsp;broker.&nbsp;&nbsp;We've&nbsp;noticed&nbsp;however,&nbsp;that&nbsp;sometimes&nbsp;these&nbsp;reconnection&nbsp;attempts&nbsp;hang&nbsp;&lt;b&gt;indefinitely/forever&lt;/b&gt;&nbsp;despite&nbsp;a&nbsp;configured&nbsp;RequestedConnectionTimeout&nbsp;value&nbsp;of&nbsp;30&nbsp;seconds.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After&nbsp;months&nbsp;of&nbsp;seeing&nbsp;this&nbsp;problem&nbsp;every&nbsp;few&nbsp;weeks&nbsp;because&nbsp;of&nbsp;various&nbsp;network&nbsp;hiccups,&nbsp;we&nbsp;were&nbsp;finally&nbsp;able&nbsp;to&nbsp;capture&nbsp;a&nbsp;snapshot&nbsp;and&nbsp;then&nbsp;perform&nbsp;an&nbsp;inspection&nbsp;of&nbsp;the&nbsp;memory&nbsp;dump&nbsp;using&nbsp;WinDbg.&nbsp;&nbsp;Here's&nbsp;the&nbsp;stack&nbsp;trace&nbsp;(which&nbsp;uses&nbsp;the&nbsp;production&nbsp;RabbitMQ&nbsp;.NET&nbsp;client&nbsp;v3.2.1):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;000000001adde530&nbsp;000007fef77ad01a&nbsp;System.Net.Sockets.Socket.Receive(Byte[],&nbsp;Int32,&nbsp;Int32,&nbsp;System.Net.Sockets.SocketFlags,&nbsp;System.Net.Sockets.SocketError&nbsp;ByRef)&lt;/div&gt;&lt;div&gt;000000001adde5d0&nbsp;000007fef77ace88&nbsp;System.Net.Sockets.NetworkStream.Read(Byte[],&nbsp;Int32,&nbsp;Int32)&lt;/div&gt;&lt;div&gt;000000001adde650&nbsp;000007fef777294c&nbsp;System.Net.FixedSizeReader.ReadPacket(Byte[],&nbsp;Int32,&nbsp;Int32)&lt;/div&gt;&lt;div&gt;000000001adde6a0&nbsp;000007fef77d3803&nbsp;System.Net.Security.SslState.StartReceiveBlob(Byte[],&nbsp;System.Net.AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde6e0&nbsp;000007fef77d1f09&nbsp;System.Net.Security.SslState.StartSendBlob(Byte[],&nbsp;Int32,&nbsp;System.Net.AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde760&nbsp;000007fef77d3d26&nbsp;System.Net.Security.SslState.ProcessReceivedBlob(Byte[],&nbsp;Int32,&nbsp;System.Net.AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde7d0&nbsp;000007fef77d3816&nbsp;System.Net.Security.SslState.StartReceiveBlob(Byte[],&nbsp;System.Net.AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde810&nbsp;000007fef77d1f09&nbsp;System.Net.Security.SslState.StartSendBlob(Byte[],&nbsp;Int32,&nbsp;System.Net.AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde890&nbsp;000007fef77d1b85&nbsp;System.Net.Security.SslState.ForceAuthentication(Boolean,&nbsp;Byte[],&nbsp;System.Net.AsyncProtocolRequest)&lt;/div&gt;&lt;div&gt;000000001adde900&nbsp;000007fef77d1856&nbsp;System.Net.Security.SslState.ProcessAuthentication(System.Net.LazyAsyncResult)&lt;/div&gt;&lt;div&gt;&lt;b&gt;RabbitMQ.Client.Impl.SocketFrameHandler_0_9..ctor(RabbitMQ.Client.AmqpTcpEndpoint,&nbsp;ObtainSocket,&nbsp;Int32)&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;000000001addea00&nbsp;000007fe9a28c5e1&nbsp;RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateFrameHandler(RabbitMQ.Client.AmqpTcpEndpoint,&nbsp;ObtainSocket,&nbsp;Int32)&lt;/div&gt;&lt;div&gt;000000001addea50&nbsp;000007fe9a28c245&nbsp;RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32,&nbsp;System.Collections.Generic.IDictionary`2&lt;RabbitMQ.Client.AmqpTcpEndpoint,Int32&gt;,&nbsp;System.Collections.Generic.IDictionary`2&lt;RabbitMQ.Client.AmqpTcpEndpoint,System.Exception&gt;,&nbsp;RabbitMQ.Client.AmqpTcpEndpoint[]&nbsp;ByRef,&nbsp;RabbitMQ.Client.AmqpTcpEndpoint)&lt;/div&gt;&lt;div&gt;000000001addeb50&nbsp;000007fe9a28c05f&nbsp;RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32,&nbsp;System.Collections.Generic.IDictionary`2&lt;RabbitMQ.Client.AmqpTcpEndpoint,Int32&gt;,&nbsp;System.Collections.Generic.IDictionary`2&lt;RabbitMQ.Client.AmqpTcpEndpoint,System.Exception&gt;,&nbsp;RabbitMQ.Client.AmqpTcpEndpoint[])&lt;/div&gt;&lt;div&gt;000000001addebe0&nbsp;000007fe9a28bf51&nbsp;RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32)&lt;/div&gt;&lt;div&gt;000000001addec70&nbsp;000007fe9a28bd6f&nbsp;***&nbsp;ERROR:&nbsp;Module&nbsp;load&nbsp;completed&nbsp;but&nbsp;symbols&nbsp;could&nbsp;not&nbsp;be&nbsp;loaded&nbsp;for&nbsp;Accounting.UsageHost.dll&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;follow&nbsp;the&nbsp;stack&nbsp;trace&nbsp;through&nbsp;the&nbsp;.NET&nbsp;client&nbsp;source&nbsp;code,&nbsp;you'll&nbsp;notice&nbsp;that&nbsp;a&nbsp;few&nbsp;of&nbsp;the&nbsp;methods&nbsp;are&nbsp;missing.&nbsp;&nbsp;These&nbsp;have&nbsp;been&nbsp;optimized&nbsp;away&nbsp;by&nbsp;the&nbsp;compiler&nbsp;when&nbsp;using&nbsp;a&nbsp;&quot;Release&quot;&nbsp;build.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;highlighted&nbsp;exactly&nbsp;where&nbsp;the&nbsp;problem&nbsp;is&nbsp;above&nbsp;and&nbsp;if&nbsp;you&nbsp;follow&nbsp;the&nbsp;source&nbsp;code,&nbsp;you'll&nbsp;find&nbsp;the&nbsp;problem&nbsp;right&nbsp;here:&lt;/div&gt;&lt;div&gt;&lt;b&gt;http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/e399c21792d7/projects/client/RabbitMQ.Client/src/client/api/SslHelper.cs#l97&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;there&nbsp;is&nbsp;&lt;b&gt;no&nbsp;timeout&lt;/b&gt;&nbsp;value&nbsp;configured&nbsp;for&nbsp;SSL&nbsp;connections.&nbsp;&nbsp;This&nbsp;means&nbsp;that&nbsp;the&nbsp;SSL&nbsp;connection&nbsp;attempt&nbsp;will&nbsp;hang&nbsp;indefinitely.&nbsp;&nbsp;And&nbsp;since&nbsp;the&nbsp;connection&nbsp;doesn't&nbsp;exist&nbsp;yet,&nbsp;there's&nbsp;no&nbsp;way&nbsp;for&nbsp;any&nbsp;kind&nbsp;of&nbsp;heartbeat&nbsp;thread&nbsp;to&nbsp;tear&nbsp;things&nbsp;down.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;.NET&nbsp;docs&nbsp;also&nbsp;state&nbsp;that&nbsp;the&nbsp;default&nbsp;read/write&nbsp;timeout&nbsp;is&nbsp;&lt;a&nbsp;href=&quot;http://msdn.microsoft.com/en-us/library/system.net.security.sslstream.readtimeout(v=vs.110).aspx&quot;&gt;set&nbsp;to&nbsp;Infinite&nbsp;by&nbsp;default&lt;/a&gt;.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;simple&nbsp;fix&nbsp;is&nbsp;as&nbsp;follows:&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Helvetica,&nbsp;arial,&nbsp;freesans,&nbsp;clean,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14px;&nbsp;line-height:&nbsp;23.799999237060547px;&quot;&gt;sslStream.ReadTimeout&nbsp;=&nbsp;connectionTimeout;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Helvetica,&nbsp;arial,&nbsp;freesans,&nbsp;clean,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14px;&nbsp;line-height:&nbsp;23.799999237060547px;&quot;&gt;sslStream.WriteTimeout=connectionTimout;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Helvetica,&nbsp;arial,&nbsp;freesans,&nbsp;clean,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14px;&nbsp;line-height:&nbsp;23.799999237060547px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Helvetica,&nbsp;arial,&nbsp;freesans,&nbsp;clean,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14px;&nbsp;line-height:&nbsp;23.799999237060547px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Helvetica,&nbsp;arial,&nbsp;freesans,&nbsp;clean,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14px;&nbsp;line-height:&nbsp;23.799999237060547px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
