<tt>
Following&nbsp;up&nbsp;on&nbsp;this&nbsp;as&nbsp;we&nbsp;are&nbsp;still&nbsp;having&nbsp;the&nbsp;issue,&nbsp;I&amp;#39;ve&nbsp;pasted&nbsp;the&nbsp;output&nbsp;of&nbsp;etop&nbsp;for&nbsp;a&nbsp;broker&nbsp;in&nbsp;a&nbsp;&amp;#39;good&nbsp;state&amp;#39;&nbsp;[1]&nbsp;vs.&nbsp;one&nbsp;in&nbsp;a&nbsp;&amp;#39;bad&nbsp;state&amp;#39;&nbsp;[2].&nbsp;You&amp;#39;ll&nbsp;notice&nbsp;that&nbsp;broker1-1&nbsp;(the&nbsp;one&nbsp;in&nbsp;&amp;#39;bad&nbsp;state&amp;#39;&nbsp;i.e.&nbsp;using&nbsp;~120%&nbsp;cpu&nbsp;compared&nbsp;to&nbsp;~20%&nbsp;for&nbsp;the&nbsp;one&nbsp;in&nbsp;&amp;#39;good&nbsp;state&amp;#39;)&nbsp;is&nbsp;spending&nbsp;a&nbsp;lot&nbsp;of&nbsp;time&nbsp;in&nbsp;timers&nbsp;and&nbsp;reading&nbsp;from&nbsp;disk.&nbsp;Looking&nbsp;at&nbsp;the&nbsp;timer_server&nbsp;process&nbsp;on&nbsp;1-1&nbsp;shows&nbsp;that&nbsp;it&amp;#39;s&nbsp;mostly&nbsp;running&nbsp;rabbit_amqqueue:sync_timeout,&nbsp;this&nbsp;seems&nbsp;to&nbsp;be&nbsp;the&nbsp;culprit&nbsp;for&nbsp;the&nbsp;high&nbsp;cpu&nbsp;and&nbsp;disk&nbsp;ops.&nbsp;So&nbsp;what&nbsp;is&nbsp;the&nbsp;purpose&nbsp;of&nbsp;this&nbsp;timer?&nbsp;and&nbsp;why&nbsp;would&nbsp;it&nbsp;suddenly&nbsp;trigger&nbsp;more&nbsp;often&nbsp;or&nbsp;at&nbsp;least&nbsp;be&nbsp;more&nbsp;expensive&nbsp;to&nbsp;handle?&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&gt;Raphael.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[1]&nbsp;Broker&nbsp;in&nbsp;&amp;#39;good&nbsp;state&amp;#39;&lt;/div&gt;&lt;div&gt;&lt;div&gt;========================================================================================&lt;/div&gt;<br>
&lt;div&gt; &amp;#39;rabbit@broker1-2&amp;#39;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 21:57:33&lt;/div&gt;&lt;div&gt; Load:&nbsp; cpu&nbsp; &nbsp; &nbsp; &nbsp; 12&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Memory:&nbsp; total&nbsp; &nbsp; &nbsp; 855004&nbsp; &nbsp; binary&nbsp; &nbsp; &nbsp; 39949&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; procs&nbsp; &nbsp;69263&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; processes&nbsp; 724592&nbsp; &nbsp; code&nbsp; &nbsp; &nbsp; &nbsp; 11738&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; runq&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; atom&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3149&nbsp; &nbsp; ets&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;41428&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Pid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Name&nbsp;or&nbsp;Initial&nbsp;Func&nbsp; &nbsp; Time&nbsp; &nbsp; Reds&nbsp; Memory&nbsp; &nbsp; MsgQ&nbsp;Current&nbsp;Function&lt;/div&gt;&lt;div&gt;----------------------------------------------------------------------------------------&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.6.0&amp;gt;&nbsp; &nbsp; &nbsp;error_logger&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;-&amp;#39;&nbsp; 975256&nbsp; 142672&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_event:fetch_msg/&lt;/div&gt;&lt;div&gt;&amp;lt;4385.4844.299&amp;gt;etop_txt:init/1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 959286********&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;etop:update/1&lt;/div&gt;&lt;div&gt;<br>
***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 101715&nbsp; &nbsp; 3000&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 101715&nbsp; &nbsp; 3000&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 101715&nbsp; &nbsp; 3000&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;<br>
&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 101715&nbsp; &nbsp; 3000&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 101715&nbsp; &nbsp; 3000&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 101715&nbsp; &nbsp; 3000&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;<br>
&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 101715&nbsp; &nbsp; 3000&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 101700&nbsp; 142744&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 101700&nbsp; 142744&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;<br>
&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 101700&nbsp; 142744&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;&amp;lt;4385.25667.0&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100267&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.11107.1&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100267&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;&amp;lt;4385.19047.1&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100267&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100267&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;&amp;lt;4385.3996.13&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100267&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;&amp;lt;4385.14391.47&amp;gt;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100267&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;<br>
&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100267&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;&amp;lt;4385.10908.1&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100252&nbsp; 109296&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.25705.1&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100252&nbsp; 109296&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;&amp;lt;4385.28252.1&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100252&nbsp; 109296&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.32119.1&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100252&nbsp; 109296&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;&amp;lt;4385.24583.61&amp;gt;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100252&nbsp; 109296&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;<br>
&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 100252&nbsp; 109296&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp;92046&nbsp; 142744&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;ets:select/1&lt;/div&gt;&lt;div&gt;&amp;lt;4385.186.0&amp;gt;&nbsp; &nbsp;rabbit_memory_monito&nbsp; &nbsp; &nbsp;&amp;#39;-&amp;#39;&nbsp; &nbsp;41961&nbsp; 779760&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.71.0&amp;gt;&nbsp; &nbsp; timer_server&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;-&amp;#39;&nbsp; &nbsp;13240&nbsp;2914432&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server:loop/6&lt;/div&gt;&lt;div&gt;&amp;lt;4385.25604.0&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp;11288&nbsp;1116400&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;<br>
&lt;div&gt;***************erlang:apply/2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;-&amp;#39;&nbsp; &nbsp; 935912342344&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;file_io_server:serve&lt;/div&gt;&lt;div&gt;&amp;lt;4385.191.0&amp;gt;&nbsp; &nbsp;msg_store_persistent&nbsp; &nbsp; &nbsp;&amp;#39;-&amp;#39;&nbsp; &nbsp; 8946&nbsp;2914424&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.4890.299&amp;gt;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; 4164&nbsp; &nbsp;13832&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;&amp;lt;4385.0.0&amp;gt;&nbsp; &nbsp; &nbsp;init&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;-&amp;#39;&nbsp; &nbsp; 2147&nbsp; &nbsp;21488&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;init:loop/1&lt;/div&gt;&lt;div&gt;&amp;lt;4385.4800.299&amp;gt;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; 1892&nbsp; &nbsp;34616&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.4886.299&amp;gt;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; 1774&nbsp; &nbsp;24784&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;rabbit_reader:mainlo&lt;/div&gt;&lt;div&gt;&amp;lt;4385.3005.28&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;637&nbsp; &nbsp;14120&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.1688.28&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;609&nbsp; &nbsp;11176&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen:do_call/4&lt;/div&gt;&lt;div&gt;&amp;lt;4385.2072.28&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;457&nbsp; &nbsp; 3200&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.2163.28&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;449&nbsp; &nbsp;11104&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;&amp;lt;4385.957.28&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;438&nbsp; &nbsp;26896&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.29794.27&amp;gt;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;423&nbsp; &nbsp;10848&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;&amp;lt;4385.31982.27&amp;gt;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;421&nbsp; &nbsp;14120&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;<br>
&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;414&nbsp; &nbsp; 2984&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;&amp;lt;4385.25130.0&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;414&nbsp; &nbsp; 2984&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.25554.0&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;414&nbsp; &nbsp; 2984&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;&amp;lt;4385.25800.0&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;414&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.25976.0&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;414&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;&amp;lt;4385.26169.0&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;414&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.26369.0&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;414&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;&amp;lt;4385.26677.0&amp;gt;&nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; &nbsp; &nbsp;414&nbsp; &nbsp; 3000&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
========================================================================================&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[2]&nbsp;Broker&nbsp;in&nbsp;&amp;#39;bad&nbsp;state&amp;#39;&lt;/div&gt;&lt;div&gt;&lt;div&gt;========================================================================================&lt;/div&gt;<br>
&lt;div&gt; &amp;#39;rabbit@broker1-1&amp;#39;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 21:57:34&lt;/div&gt;&lt;div&gt; Load:&nbsp; cpu&nbsp; &nbsp; &nbsp; &nbsp;102&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Memory:&nbsp; total&nbsp; &nbsp; &nbsp;1047278&nbsp; &nbsp; binary&nbsp; &nbsp; &nbsp; 82002&lt;/div&gt;&lt;div&gt;  &nbsp; &nbsp; &nbsp; procs&nbsp; &nbsp;73585&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; processes&nbsp; 870711&nbsp; &nbsp; code&nbsp; &nbsp; &nbsp; &nbsp; 11738&lt;/div&gt;<br>
&lt;div&gt;  &nbsp; &nbsp; &nbsp; runq&nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; atom&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2750&nbsp; &nbsp; ets&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;45360&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Pid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Name&nbsp;or&nbsp;Initial&nbsp;Func&nbsp; &nbsp; Time&nbsp; &nbsp; Reds&nbsp; Memory&nbsp; &nbsp; MsgQ&nbsp;Current&nbsp;Function&lt;/div&gt;&lt;div&gt;----------------------------------------------------------------------------------------&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.77.0&amp;gt;&nbsp; &nbsp; timer_server&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;-&amp;#39;&nbsp;5994258&nbsp;1801600&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server:loop/6&lt;/div&gt;&lt;div&gt;&amp;lt;4385.6.0&amp;gt;&nbsp; &nbsp; &nbsp;error_logger&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;-&amp;#39;&nbsp;1617319&nbsp; 142672&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_event:fetch_msg/&lt;/div&gt;<br>
&lt;div&gt;***************etop_txt:init/1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp;1104480********&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;etop:update/1&lt;/div&gt;&lt;div&gt;&amp;lt;4385.932.0&amp;gt;&nbsp; &nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 534423&nbsp;1114040&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1181.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 527067&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.1083.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 523629&nbsp;1114040&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1113.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 510615&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.1109.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 505293&nbsp;1114008&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1121.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 504923&nbsp;1114008&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.1142.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 490480&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1107.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 484069&nbsp;1114040&nbsp; &nbsp; &nbsp; &nbsp;2&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 480740&nbsp; &nbsp;75888&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1101.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 479437&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.2678.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 467491&nbsp; &nbsp;88632&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1185.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 460844&nbsp;1114008&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 457993&nbsp; 109304&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1106.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 442674&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.1079.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 433061&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 427045&nbsp; 142784&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1093.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 426558&nbsp;1114008&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.1172.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 425739&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1173.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 424881&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 424511&nbsp; 109336&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1111.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 423289&nbsp;1114008&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;<br>
***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 418404&nbsp; 109304&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1115.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 406488&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.936.0&amp;gt;&nbsp; &nbsp;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 403025&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.1923.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 397771&nbsp; 109304&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.6377.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 393461&nbsp; 122160&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.1082.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 384064&nbsp;1113976&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.3805.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 382381&nbsp; &nbsp;88744&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.6385.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 380755&nbsp; 109416&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 376803&nbsp; 109304&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.1117.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 371288&nbsp;1114008&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.3819.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 358139&nbsp; 122080&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.1145.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 321316&nbsp;1114008&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;prim_file:drv_get_re&lt;/div&gt;&lt;div&gt;&amp;lt;4385.1628.0&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 282420&nbsp; &nbsp;88712&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;prim_file:drv_get_re&lt;/div&gt;<br>
&lt;div&gt;&amp;lt;4385.200.0&amp;gt;&nbsp; &nbsp;rabbit_memory_monito&nbsp; &nbsp; &nbsp;&amp;#39;-&amp;#39;&nbsp; 112557&nbsp;1682368&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 111776&nbsp; &nbsp; 2992&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.185.2916&amp;gt;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 111761&nbsp; 142744&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;gen_server2:process_&lt;/div&gt;&lt;div&gt;&amp;lt;4385.5774.224&amp;gt;proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 110328&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.3548.1&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 110328&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;&amp;lt;4385.4155.1&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 110328&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.4385.1&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 110328&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;&amp;lt;4385.5053.1&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 110328&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;<br>
&amp;lt;4385.6322.1&amp;gt;&nbsp; proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 110328&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 110328&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 110328&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;<br>
&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 110328&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;***************proc_lib:init_p/5&nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;-&amp;#39;&nbsp; 110328&nbsp; &nbsp; 2936&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp;erlang:hibernate/3&lt;/div&gt;&lt;div&gt;========================================================================================&lt;/div&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Apr&nbsp;21,&nbsp;2011&nbsp;at&nbsp;10:38&nbsp;AM,&nbsp;Raphael&nbsp;Simon&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:raphael@rightscale.com&quot;&gt;raphael@rightscale.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex;&quot;&gt;<br>
Hello&nbsp;Matthew,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;set&nbsp;the&nbsp;number&nbsp;of&nbsp;available&nbsp;file&nbsp;descriptors&nbsp;to&nbsp;around&nbsp;32,000&nbsp;and&nbsp;I&nbsp;can&nbsp;see&nbsp;that&nbsp;RabbitMQ&nbsp;is&nbsp;using&nbsp;around&nbsp;14,000&nbsp;(with&nbsp;the&nbsp;rabbitadmin&nbsp;management&nbsp;agent)&nbsp;so&nbsp;there&nbsp;should&nbsp;be&nbsp;a&nbsp;comfortable&nbsp;margin.&nbsp;The&nbsp;number&nbsp;of&nbsp;queues&nbsp;deleted&nbsp;was&nbsp;around&nbsp;2,000&nbsp;(we&nbsp;have&nbsp;a&nbsp;queue&nbsp;gc&nbsp;daemon&nbsp;that&nbsp;will&nbsp;periodically&nbsp;delete&nbsp;queues&nbsp;with&nbsp;no&nbsp;consumers&nbsp;as&nbsp;we&nbsp;can&amp;#39;t guarantee that&nbsp;clients&nbsp;will&nbsp;always&nbsp;leave&nbsp;cleanly).&nbsp;Wrt&nbsp;to&nbsp;messages&nbsp;expiring:&nbsp;the&nbsp;message&nbsp;throughput&nbsp;is&nbsp;fairly&nbsp;uniform&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;messages&nbsp;expiring&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;should&nbsp;remain&nbsp;fairly&nbsp;constant.&nbsp;I&nbsp;guess&nbsp;bursts&nbsp;are&nbsp;possible&nbsp;though,&nbsp;I&nbsp;would&nbsp;estimate&nbsp;the&nbsp;max&nbsp;number&nbsp;of&nbsp;messages&nbsp;expiring&nbsp;all&nbsp;at&nbsp;once&nbsp;to&nbsp;around&nbsp;40k&nbsp;-&nbsp;do&nbsp;you&nbsp;see&nbsp;an&nbsp;issue&nbsp;with&nbsp;this?&nbsp;etop&nbsp;did&nbsp;show&nbsp;the&nbsp;timer&nbsp;process&nbsp;often&nbsp;as&nbsp;the&nbsp;busiest.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;the&nbsp;help!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&lt;/div&gt;&lt;div&gt;Raphael.&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Apr&nbsp;21,&nbsp;2011&nbsp;at&nbsp;3:42&nbsp;AM,&nbsp;Matthew&nbsp;Sackman&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthew@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthew@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi&nbsp;Raphael,&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;for&nbsp;the&nbsp;detailed&nbsp;report.&nbsp;This&nbsp;is&nbsp;an&nbsp;interesting&nbsp;one,&nbsp;and&nbsp;a&nbsp;few&lt;br&gt;<br>
ideas&nbsp;spring&nbsp;to&nbsp;mind.&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;seem&nbsp;to&nbsp;be&nbsp;using&nbsp;the&nbsp;x-message-ttl&nbsp;feature&nbsp;now,&nbsp;with&nbsp;message&nbsp;expiry&lt;br&gt;<br>
around&nbsp;1&nbsp;day.&nbsp;Do&nbsp;these&nbsp;events&nbsp;happen&nbsp;to&nbsp;correspond&nbsp;with&nbsp;the&nbsp;bulk&nbsp;expiry&lt;br&gt;<br>
of&nbsp;a&nbsp;lot&nbsp;of&nbsp;messages?&nbsp;Certainly&nbsp;60,000&nbsp;odd&nbsp;msgs&nbsp;in&nbsp;the&nbsp;broker&nbsp;shouldn&amp;#39;t&lt;br&gt;<br>
cause&nbsp;any&nbsp;problems&nbsp;at&nbsp;all,&nbsp;but&nbsp;just&nbsp;want&nbsp;to&nbsp;check&nbsp;that&nbsp;one.&nbsp;Also,&nbsp;when&lt;br&gt;<br>
you&nbsp;say&nbsp;&amp;quot;many&nbsp;queues&nbsp;get&nbsp;deleted&amp;quot;,&nbsp;how&nbsp;many&nbsp;are&nbsp;we&nbsp;talking&nbsp;about?&nbsp;The&lt;br&gt;<br>
only&nbsp;thing&nbsp;we&nbsp;can&nbsp;think&nbsp;of&nbsp;is&nbsp;if&nbsp;you&amp;#39;re&nbsp;deleting&nbsp;more&nbsp;queues&nbsp;than&nbsp;you&lt;br&gt;<br>
have&nbsp;file&nbsp;descriptors&nbsp;available&nbsp;for&nbsp;the&nbsp;process&nbsp;then&nbsp;you&nbsp;may&nbsp;run&nbsp;into&lt;br&gt;<br>
problems:&nbsp;Rabbit&nbsp;won&amp;#39;t&nbsp;crash,&nbsp;but&nbsp;it&nbsp;might&nbsp;thrash&nbsp;fds&nbsp;between&nbsp;different&lt;br&gt;<br>
queues&nbsp;which&nbsp;can&nbsp;overall&nbsp;result&nbsp;in&nbsp;vastly&nbsp;more&nbsp;disk&nbsp;activity&nbsp;than&lt;br&gt;<br>
necessary.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;normal&nbsp;Linux&nbsp;default&nbsp;fd&nbsp;limit&nbsp;(ulimit&nbsp;-n)&nbsp;is&nbsp;1024,&nbsp;though&nbsp;on&nbsp;OS&nbsp;X,&lt;br&gt;<br>
it&amp;#39;s&nbsp;down&nbsp;at&nbsp;256&nbsp;by&nbsp;default&nbsp;IIRC.&nbsp;If&nbsp;you&amp;#39;re&nbsp;deleting&nbsp;more&nbsp;than&nbsp;about&lt;br&gt;<br>
900&nbsp;queues&nbsp;at&nbsp;any&nbsp;one&nbsp;go,&nbsp;then&nbsp;I&amp;#39;d&nbsp;suggest&nbsp;that&nbsp;you&nbsp;try&nbsp;increasing&nbsp;that&lt;br&gt;<br>
substantially:&nbsp;having&nbsp;about&nbsp;double&nbsp;the&nbsp;number&nbsp;of&nbsp;fds&nbsp;available&nbsp;than&lt;br&gt;<br>
queues&nbsp;should&nbsp;eliminate&nbsp;any&nbsp;thrashing&nbsp;-&nbsp;if&nbsp;indeed&nbsp;this&nbsp;is&nbsp;the&nbsp;problem.&lt;br&gt;<br>
If&nbsp;this&nbsp;is&nbsp;the&nbsp;problem&nbsp;then&nbsp;by&nbsp;strace,&nbsp;you&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;see&nbsp;an&lt;br&gt;<br>
awful&nbsp;lot&nbsp;of&nbsp;open&nbsp;and&nbsp;close&nbsp;calls&nbsp;to&nbsp;various&nbsp;files,&nbsp;whereas&nbsp;if&nbsp;this&lt;br&gt;<br>
problem&nbsp;is&nbsp;solved&nbsp;by&nbsp;higher&nbsp;fd&nbsp;ulimit&nbsp;then&nbsp;you&nbsp;should&nbsp;see&nbsp;files&nbsp;stay&lt;br&gt;<br>
open&nbsp;for&nbsp;much&nbsp;longer.&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;let&nbsp;us&nbsp;know&nbsp;how&nbsp;you&nbsp;get&nbsp;on.&lt;br&gt;<br>
&lt;br&gt;<br>
Matthew&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
