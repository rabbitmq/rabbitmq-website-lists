<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello&nbsp;all,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;would&nbsp;like&nbsp;to&nbsp;see&nbsp;messages&nbsp;in&nbsp;an&nbsp;expired&nbsp;queue&nbsp;published&nbsp;to&nbsp;the&nbsp;dead-letter&nbsp;exchange&nbsp;(if&nbsp;one&nbsp;has&nbsp;been&nbsp;provided)&nbsp;instead&nbsp;of&nbsp;having&nbsp;them&nbsp;lost.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Our&nbsp;use&nbsp;case&nbsp;is&nbsp;somewhat&nbsp;complex&nbsp;to&nbsp;explain,&nbsp;but&nbsp;ultimately,&nbsp;setting&nbsp;TTL&nbsp;on&nbsp;a&nbsp;message&nbsp;is&nbsp;very&nbsp;different&nbsp;from&nbsp;TTL&nbsp;on&nbsp;a&nbsp;queue&nbsp;in&nbsp;that&nbsp;queue&nbsp;expiry&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;presence&nbsp;of&nbsp;a&nbsp;consumer.&nbsp;The&nbsp;utility&nbsp;of&nbsp;having&nbsp;both&nbsp;the&nbsp;queue&nbsp;disposed&nbsp;and&nbsp;messages&nbsp;re-published&nbsp;seems&nbsp;pretty&nbsp;high&nbsp;to&nbsp;me.&nbsp;Let&nbsp;me&nbsp;try&nbsp;an&nbsp;explain&nbsp;our&nbsp;use&nbsp;case.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;common&nbsp;pattern&nbsp;I&#39;ve&nbsp;seen&nbsp;is&nbsp;to&nbsp;have&nbsp;multiple&nbsp;instances&nbsp;of&nbsp;the&nbsp;same&nbsp;service&nbsp;consuming&nbsp;from&nbsp;the&nbsp;same&nbsp;queue.&nbsp;This&nbsp;makes&nbsp;the&nbsp;system&nbsp;resilient&nbsp;to&nbsp;individual&nbsp;service&nbsp;instance&nbsp;failures&nbsp;because&nbsp;remaining&nbsp;instances&nbsp;(or&nbsp;new&nbsp;ones)&nbsp;will&nbsp;continue&nbsp;consuming&nbsp;messages&nbsp;from&nbsp;the&nbsp;queue.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;A&nbsp;problem&nbsp;in&nbsp;this&nbsp;pattern&nbsp;is&nbsp;when&nbsp;common&nbsp;state&nbsp;is&nbsp;being&nbsp;mutated&nbsp;as&nbsp;a&nbsp;result&nbsp;of&nbsp;the&nbsp;messages;&nbsp;you&nbsp;end&nbsp;up&nbsp;with&nbsp;race&nbsp;conditions/last-write-wins&nbsp;style&nbsp;behaviors&nbsp;that&nbsp;can&nbsp;become&nbsp;problematic.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;div&gt;The&nbsp;way&nbsp;we&nbsp;solve&nbsp;for&nbsp;this&nbsp;(within&nbsp;the&nbsp;realm&nbsp;of&nbsp;Rabbit)&nbsp;is&nbsp;to&nbsp;have&nbsp;a&nbsp;consistent-hash&nbsp;exchange&nbsp;that&nbsp;hashes&nbsp;the&nbsp;correlation-id&nbsp;which&nbsp;is&nbsp;set&nbsp;to&nbsp;our&nbsp;aggregate&nbsp;root&nbsp;(parent&nbsp;record&nbsp;id).&nbsp;This&nbsp;allows&nbsp;us&nbsp;to&nbsp;bind&nbsp;a&nbsp;queue-per-service-instance&nbsp;and&nbsp;get&nbsp;the&nbsp;isolation&nbsp;guarantees&nbsp;we&nbsp;like&nbsp;while&nbsp;still&nbsp;allowing&nbsp;us&nbsp;to&nbsp;horizontally&nbsp;scale.&nbsp;The&nbsp;problem&nbsp;with&nbsp;this&nbsp;approach&nbsp;is&nbsp;that&nbsp;in&nbsp;the&nbsp;event&nbsp;that&nbsp;a&nbsp;service&nbsp;loses&nbsp;its&nbsp;connection/falls&nbsp;over,&nbsp;messages&nbsp;in&nbsp;the&nbsp;queue&nbsp;sit&nbsp;and&nbsp;can&nbsp;be&nbsp;&#39;orphaned&#39;.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;we&nbsp;use&nbsp;a&nbsp;queue&nbsp;TTL&nbsp;policy&nbsp;for&nbsp;these&nbsp;kinds&nbsp;of&nbsp;queues,&nbsp;it&nbsp;will&nbsp;allow&nbsp;us&nbsp;to&nbsp;prevent&nbsp;orphaned&nbsp;queues,&nbsp;but&nbsp;presently&nbsp;it&nbsp;does&nbsp;not&nbsp;appear&nbsp;that&nbsp;the&nbsp;messages&nbsp;in&nbsp;the&nbsp;queue&nbsp;are&nbsp;published&nbsp;to&nbsp;the&nbsp;defined&nbsp;dead&nbsp;letter&nbsp;exchange.&nbsp;Since&nbsp;messages&nbsp;with&nbsp;a&nbsp;TLL&nbsp;behave&nbsp;this&nbsp;way,&nbsp;it&nbsp;seems&nbsp;logical&nbsp;that&nbsp;messages&nbsp;within&nbsp;a&nbsp;queue&nbsp;that&nbsp;expires&nbsp;could/should&nbsp;also&nbsp;take&nbsp;advantage&nbsp;of&nbsp;the&nbsp;same&nbsp;behavior.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;believe&nbsp;it&nbsp;would&nbsp;be&nbsp;a&nbsp;real&nbsp;win&nbsp;for&nbsp;users&nbsp;everywhere&nbsp;as&nbsp;it&nbsp;allows&nbsp;for&nbsp;a&nbsp;really&nbsp;clean&nbsp;way&nbsp;to&nbsp;scale&nbsp;horizontally&nbsp;without&nbsp;increasing&nbsp;race-conditions,&nbsp;requiring&nbsp;distributed&nbsp;locking&nbsp;patterns&nbsp;or&nbsp;introducing&nbsp;failure&nbsp;modes&nbsp;that&nbsp;could&nbsp;result&nbsp;in&nbsp;message&nbsp;loss&nbsp;or&nbsp;dramatically&nbsp;increased&nbsp;latency&nbsp;in&nbsp;message&nbsp;processing.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Interested&nbsp;in&nbsp;your&nbsp;thoughts&nbsp;on&nbsp;this.&nbsp;If&nbsp;folks&nbsp;like&nbsp;the&nbsp;idea&nbsp;but&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;great&nbsp;deal&nbsp;of&nbsp;bandwidth,&nbsp;I&#39;d&nbsp;be&nbsp;happy&nbsp;to&nbsp;attempt&nbsp;an&nbsp;initial&nbsp;implementation&nbsp;via&nbsp;PR.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;so&nbsp;much&nbsp;for&nbsp;RabbitMQ,&nbsp;it&#39;s&nbsp;awesome.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Alex&lt;/div&gt;&lt;/div&gt;<br>

</tt>
