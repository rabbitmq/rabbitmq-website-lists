<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;@Alvaro,&nbsp;your&nbsp;solution&nbsp;seems&nbsp;to&nbsp;be&nbsp;quite&nbsp;interesting.&nbsp;I&nbsp;just&nbsp;wonder&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;simpler&nbsp;one.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;similar&nbsp;problem&nbsp;where&nbsp;I&nbsp;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;need&nbsp;to&nbsp;start/stop&nbsp;the&nbsp;RabbitTemplate&nbsp;object&nbsp;on&nbsp;demand.&nbsp;For&nbsp;example&nbsp;to&nbsp;restart&nbsp;the&nbsp;bean&nbsp;in&nbsp;my&nbsp;catch&nbsp;block&nbsp;with&nbsp;sender.stop()&nbsp;and&nbsp;then&nbsp;sender.start()&nbsp;.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;My&nbsp;first&nbsp;idea&nbsp;was&nbsp;to&nbsp;implement&nbsp;SmartLifeCycle&nbsp;interface&nbsp;from&nbsp;Spring&nbsp;and&nbsp;extend&nbsp;RabbitTemplate&nbsp;as&nbsp;follows.:&lt;/span&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new&quot;&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&quot;&gt;@Component&lt;br&gt;public&nbsp;class&nbsp;LifeSender&nbsp;extends&nbsp;RabbitTemplate&nbsp;implements&nbsp;SmartLifecycle&nbsp;{&lt;br&gt;&lt;br&gt;private&nbsp;volatile&nbsp;boolean&nbsp;isRunning&nbsp;=&nbsp;false;&lt;br&gt;&lt;br&gt;@Override&lt;br&gt;public&nbsp;boolean&nbsp;isAutoStartup()&nbsp;{&lt;br&gt;return&nbsp;true;&lt;br&gt;}&lt;br&gt;&lt;br&gt;@Override&lt;br&gt;public&nbsp;void&nbsp;start()&nbsp;{&lt;br&gt;System.out.println(&quot;STARTED!!!&quot;);&lt;br&gt;isRunning&nbsp;=&nbsp;true;&lt;br&gt;}&lt;br&gt;&lt;br&gt;@Override&lt;br&gt;public&nbsp;void&nbsp;stop()&nbsp;{&lt;br&gt;System.out.println(&quot;STOPPED!!!&quot;);&lt;br&gt;isRunning&nbsp;=&nbsp;false;&lt;br&gt;}&lt;/font&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;Here&nbsp;is&nbsp;the&nbsp;Spring&nbsp;AMQP&nbsp;context:&lt;/span&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;i&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;!--&nbsp;RabbitMQ&nbsp;Sender.&nbsp;--&gt;&lt;br&gt;&lt;bean&nbsp;id=&quot;sender&quot;&nbsp;class=&quot;org.springframework.amqp.rabbit.core.Rabbit&nbsp;Template&quot;&nbsp;abstract=&quot;true&quot;&gt;&lt;br&gt;&lt;constructor-arg&nbsp;index=&quot;0&quot;&nbsp;ref=&quot;connectionFactory&quot;&nbsp;/&gt;&lt;br&gt;&lt;property&nbsp;name=&quot;confirmCallback&quot;&nbsp;ref=&quot;premCallback&quot;&nbsp;/&gt;&lt;br&gt;&lt;property&nbsp;name=&quot;exchange&quot;&nbsp;value=&quot;myExchange&quot;&nbsp;/&gt;&lt;br&gt;&lt;/bean&gt;&lt;/i&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;bean&nbsp;id=&quot;lifeSender&quot;&nbsp;class=&quot;com.ucware.ucpo.cti.core.LifeSender&quot;&nbsp;parent=&quot;sender&quot;/&gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;lifeSender&nbsp;does&nbsp;not&nbsp;instatiate&nbsp;the&nbsp;properties&nbsp;and&nbsp;connection&nbsp;factory&nbsp;from&nbsp;the&nbsp;sender.&nbsp;So&nbsp;I&nbsp;created&nbsp;the&nbsp;constructor:&lt;/span&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new&quot;&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&quot;&gt;@Autowired&lt;br&gt;public&nbsp;LifeSender(ConnectionFactory&nbsp;connectionFactory,&nbsp;PremConfirmCallback&nbsp;premCallback)&nbsp;{&lt;br&gt;super();&lt;br&gt;super.setConnectionFactory(connectionFactory);&lt;br&gt;super.setExchange(&quot;cti.main&quot;);&lt;br&gt;super.setConfirmCallback(premCallback);&lt;br&gt;System.out.println(super.getConnectionFactory().to&nbsp;String());&lt;br&gt;}&lt;/font&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;Unfortunately,&nbsp;lifeSender.stop()&nbsp;does&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;just&nbsp;printing&nbsp;&quot;STOPPED&quot;&nbsp;to&nbsp;the&nbsp;log.&nbsp;I&nbsp;am&nbsp;still&nbsp;able&nbsp;to&nbsp;send&nbsp;messages.&lt;/span&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;Second&nbsp;idea&nbsp;was&nbsp;to&nbsp;use&nbsp;controlChannel&nbsp;from&nbsp;Spring&nbsp;Integration.&nbsp;However,&nbsp;a&nbsp;simple&nbsp;test&lt;/span&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new&quot;&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&quot;&gt;@Test&lt;br&gt;public&nbsp;void&nbsp;testTurnOffSender()&nbsp;throws&nbsp;InterruptedException&nbsp;{&lt;br&gt;isBean&nbsp;=&nbsp;controlGateway.isRunning(&nbsp;&quot;@sender.isRunning()&quot;&nbsp;);&lt;br&gt;&lt;br&gt;Assert.isTrue(&nbsp;isBean);&lt;br&gt;controlGateway.send(new&nbsp;GenericMessage&lt;String&gt;(&nbsp;&quot;@sender.stop()&quot;&nbsp;));&lt;br&gt;Thread.sleep(500);&lt;br&gt;isBean&nbsp;=&nbsp;controlGateway.isRunning(&nbsp;&quot;@sender.isRunning()&quot;&nbsp;);&lt;br&gt;Assert.isTrue(&nbsp;isBean&nbsp;==&nbsp;false);&lt;br&gt;&lt;br&gt;}&lt;/font&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;triggers&nbsp;the&nbsp;exception:&lt;/span&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;i&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;org.springframework.expression.EvaluationException&nbsp;:&nbsp;The&nbsp;method&nbsp;'isRunning'&nbsp;is&nbsp;not&nbsp;supported&nbsp;by&nbsp;this&nbsp;command&nbsp;processor.&nbsp;If&nbsp;using&nbsp;the&nbsp;Control&nbsp;Bus,&nbsp;consider&nbsp;adding&nbsp;@ManagedOperation&nbsp;or&nbsp;@ManagedAttribute.&lt;/i&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;Do&nbsp;you&nbsp;think&nbsp;any&nbsp;of&nbsp;suggested&nbsp;solutions&nbsp;make&nbsp;sense?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;Thanks,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;Lukasz&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;44,&nbsp;47);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;Verdana,&nbsp;sans-serif;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
