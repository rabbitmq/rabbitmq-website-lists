<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;As&nbsp;I&nbsp;mentioned&nbsp;on&nbsp;the&nbsp;Spring&nbsp;Forum&nbsp;(&lt;a&nbsp;href=&quot;http://forum.spring.io/forum/spring-projects/integration/amqp/745450-start-stop-rabbittemplate-on-demand&quot;&gt;http://forum.spring.io/forum/spring-projects/integration/amqp/745450-start-stop-rabbittemplate-on-demand&lt;/a&gt;)&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;You&nbsp;need&nbsp;to&nbsp;add&nbsp;isRunning()&nbsp;as&nbsp;a&nbsp;@ManagedOperation&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;access&nbsp;it&nbsp;using&nbsp;the&nbsp;control&nbsp;bus.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;would&nbsp;also&nbsp;need&nbsp;to&nbsp;override&nbsp;the&nbsp;doSend*()&nbsp;methods&nbsp;on&nbsp;your&nbsp;subclass&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;prevent&nbsp;sends&nbsp;on&nbsp;a&nbsp;&quot;stopped&quot;&nbsp;template.&lt;/div&gt;<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Feb&nbsp;24,&nbsp;2014&nbsp;at&nbsp;9:10&nbsp;AM,&nbsp;Lukasz&nbsp;M.&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:lukasz.miroslaw@googlemail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;lukasz.miroslaw@googlemail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;@Alvaro,&nbsp;your&nbsp;solution&nbsp;seems&nbsp;to&nbsp;be&nbsp;quite&nbsp;interesting.&nbsp;I&nbsp;just&nbsp;wonder&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;simpler&nbsp;one.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;similar&nbsp;problem&nbsp;where&nbsp;I &lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;need&nbsp;to&nbsp;start/stop&nbsp;the&nbsp;RabbitTemplate&nbsp;object&nbsp;on&nbsp;demand.&nbsp;For&nbsp;example&nbsp;to&nbsp;restart&nbsp;the&nbsp;bean&nbsp;in&nbsp;my&nbsp;catch&nbsp;block&nbsp;with&nbsp;sender.stop()&nbsp;and&nbsp;then&nbsp;sender.start()&nbsp;.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;My&nbsp;first&nbsp;idea&nbsp;was&nbsp;to&nbsp;implement&nbsp;SmartLifeCycle&nbsp;interface&nbsp;from&nbsp;Spring&nbsp;and&nbsp;extend&nbsp;RabbitTemplate&nbsp;as&nbsp;follows.:&lt;/span&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new&quot;&nbsp;style=&quot;color:rgb(37,44,47)&quot;&gt;@Component&lt;br&gt;public&nbsp;class&nbsp;LifeSender&nbsp;extends&nbsp;RabbitTemplate&nbsp;implements&nbsp;SmartLifecycle&nbsp;{&lt;br&gt;<br>
&lt;br&gt;private&nbsp;volatile&nbsp;boolean&nbsp;isRunning&nbsp;=&nbsp;false;&lt;br&gt;&lt;br&gt;@Override&lt;br&gt;public&nbsp;boolean&nbsp;isAutoStartup()&nbsp;{&lt;br&gt;return&nbsp;true;&lt;br&gt;}&lt;br&gt;&lt;br&gt;@Override&lt;br&gt;public&nbsp;void&nbsp;start()&nbsp;{&lt;br&gt;System.out.println(&quot;STARTED!!!&quot;);&lt;br&gt;isRunning&nbsp;=&nbsp;true;&lt;br&gt;<br>
}&lt;br&gt;&lt;br&gt;@Override&lt;br&gt;public&nbsp;void&nbsp;stop()&nbsp;{&lt;br&gt;System.out.println(&quot;STOPPED!!!&quot;);&lt;br&gt;isRunning&nbsp;=&nbsp;false;&lt;br&gt;}&lt;/font&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;Here&nbsp;is&nbsp;the&nbsp;Spring&nbsp;AMQP&nbsp;context:&lt;/span&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;i&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;!--&nbsp;RabbitMQ&nbsp;Sender.&nbsp;--&gt;&lt;br&gt;&lt;bean&nbsp;id=&quot;sender&quot;&nbsp;class=&quot;org.springframework.amqp.rabbit.core.Rabbit&nbsp;Template&quot;&nbsp;abstract=&quot;true&quot;&gt;&lt;br&gt;<br>
&lt;constructor-arg&nbsp;index=&quot;0&quot;&nbsp;ref=&quot;connectionFactory&quot;&nbsp;/&gt;&lt;br&gt;&lt;property&nbsp;name=&quot;confirmCallback&quot;&nbsp;ref=&quot;premCallback&quot;&nbsp;/&gt;&lt;br&gt;&lt;property&nbsp;name=&quot;exchange&quot;&nbsp;value=&quot;myExchange&quot;&nbsp;/&gt;&lt;br&gt;<br>
&lt;/bean&gt;&lt;/i&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;bean&nbsp;id=&quot;lifeSender&quot;&nbsp;class=&quot;com.ucware.ucpo.cti.core.LifeSender&quot;&nbsp;parent=&quot;sender&quot;/&gt;&lt;/span&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;lifeSender&nbsp;does&nbsp;not&nbsp;instatiate&nbsp;the&nbsp;properties&nbsp;and&nbsp;connection&nbsp;factory&nbsp;from&nbsp;the&nbsp;sender.&nbsp;So&nbsp;I&nbsp;created&nbsp;the&nbsp;constructor:&lt;/span&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new&quot;&nbsp;style=&quot;color:rgb(37,44,47)&quot;&gt;@Autowired&lt;br&gt;public&nbsp;LifeSender(ConnectionFactory&nbsp;connectionFactory,&nbsp;PremConfirmCallback&nbsp;premCallback)&nbsp;{&lt;br&gt;<br>
super();&lt;br&gt;super.setConnectionFactory(connectionFactory);&lt;br&gt;super.setExchange(&quot;cti.main&quot;);&lt;br&gt;super.setConfirmCallback(premCallback);&lt;br&gt;System.out.println(super.getConnectionFactory().to&nbsp;String());&lt;br&gt;}&lt;/font&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;Unfortunately,&nbsp;lifeSender.stop()&nbsp;does&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;just&nbsp;printing&nbsp;&quot;STOPPED&quot;&nbsp;to&nbsp;the&nbsp;log.&nbsp;I&nbsp;am&nbsp;still&nbsp;able&nbsp;to&nbsp;send&nbsp;messages.&lt;/span&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;Second&nbsp;idea&nbsp;was&nbsp;to&nbsp;use&nbsp;controlChannel&nbsp;from&nbsp;Spring&nbsp;Integration.&nbsp;However,&nbsp;a&nbsp;simple&nbsp;test&lt;/span&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new&quot;&nbsp;style=&quot;color:rgb(37,44,47)&quot;&gt;@Test&lt;br&gt;public&nbsp;void&nbsp;testTurnOffSender()&nbsp;throws&nbsp;InterruptedException&nbsp;{&lt;br&gt;isBean&nbsp;=&nbsp;controlGateway.isRunning(&nbsp;&quot;@sender.isRunning()&quot;&nbsp;);&lt;br&gt;<br>
&lt;br&gt;Assert.isTrue(&nbsp;isBean);&lt;br&gt;controlGateway.send(new&nbsp;GenericMessage&lt;String&gt;(&nbsp;&quot;@sender.stop()&quot;&nbsp;));&lt;br&gt;Thread.sleep(500);&lt;br&gt;isBean&nbsp;=&nbsp;controlGateway.isRunning(&nbsp;&quot;@sender.isRunning()&quot;&nbsp;);&lt;br&gt;Assert.isTrue(&nbsp;isBean&nbsp;==&nbsp;false);&lt;br&gt;<br>
&lt;br&gt;}&lt;/font&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;triggers&nbsp;the&nbsp;exception:&lt;/span&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;i&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;org.springframework.expression.EvaluationException&nbsp;:&nbsp;The&nbsp;method&nbsp;&#39;isRunning&#39;&nbsp;is&nbsp;not&nbsp;supported&nbsp;by&nbsp;this&nbsp;command&nbsp;processor.&nbsp;If&nbsp;using&nbsp;the&nbsp;Control&nbsp;Bus,&nbsp;consider&nbsp;adding&nbsp;@ManagedOperation&nbsp;or&nbsp;@ManagedAttribute.&lt;/i&gt;&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;<br>
&lt;br&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;Do&nbsp;you&nbsp;think&nbsp;any&nbsp;of&nbsp;suggested&nbsp;solutions&nbsp;make&nbsp;sense?&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;Thanks,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;Lukasz&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(37,44,47);font-family:Helvetica,Arial,Verdana,sans-serif&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
