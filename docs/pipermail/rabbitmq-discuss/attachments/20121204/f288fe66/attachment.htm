<tt>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;Out&nbsp;of&nbsp;curiosity,&nbsp;which&nbsp;adapter&nbsp;are&nbsp;you&nbsp;using?&nbsp;There's&nbsp;a&nbsp;loop&nbsp;in&nbsp;BlockingConnection&nbsp;which&nbsp;will&nbsp;stop&nbsp;what&nbsp;a&nbsp;producer&nbsp;is&nbsp;doing&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;there&nbsp;are&nbsp;no&nbsp;pending&nbsp;RPC&nbsp;requests&nbsp;from&nbsp;RabbitMQ.&nbsp;For&nbsp;your&nbsp;type&nbsp;of&nbsp;test,&nbsp;I'd&nbsp;make&nbsp;sure&nbsp;you're&nbsp;using&nbsp;one&nbsp;of&nbsp;the&nbsp;async&nbsp;adapters&nbsp;to&nbsp;be&nbsp;100%&nbsp;sure&nbsp;it's&nbsp;not&nbsp;on&nbsp;pika's&nbsp;side.&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&nbsp;style=&quot;color:&nbsp;#A0A0A8;&quot;&gt;On&nbsp;Tuesday,&nbsp;December&nbsp;4,&nbsp;2012&nbsp;at&nbsp;10:11&nbsp;AM,&nbsp;Pierpaolo&nbsp;Baccichet&nbsp;wrote:&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;border-left-style:solid;border-width:1px;margin-left:0px;padding-left:10px;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&gt;&lt;div&gt;&lt;div&gt;Hello&nbsp;Matthias,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;your&nbsp;quick&nbsp;response!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;double&nbsp;checked&nbsp;the&nbsp;code&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;I&nbsp;am&nbsp;not&nbsp;marking&nbsp;messages&nbsp;as&nbsp;persistent&nbsp;and&nbsp;indeed&nbsp;that's&nbsp;the&nbsp;case.&nbsp;The&nbsp;queues&nbsp;and&nbsp;the&nbsp;exchanges&nbsp;are&nbsp;marked&nbsp;as&nbsp;durable&nbsp;but&nbsp;the&nbsp;individual&nbsp;messages&nbsp;I&nbsp;send&nbsp;are&nbsp;not&nbsp;setting&nbsp;the&nbsp;delivery_mode=2.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;a&nbsp;little&nbsp;skeptical&nbsp;the&nbsp;issue&nbsp;here&nbsp;is&nbsp;sync&nbsp;on&nbsp;disk&nbsp;because&nbsp;adding&nbsp;producers&nbsp;does&nbsp;not&nbsp;change&nbsp;the&nbsp;behavior.&nbsp;I&nbsp;ran&nbsp;a&nbsp;test&nbsp;with&nbsp;5&nbsp;producers&nbsp;sending&nbsp;10&nbsp;messages&nbsp;per&nbsp;second&nbsp;each&nbsp;and&nbsp;I&nbsp;am&nbsp;still&nbsp;seeing&nbsp;exactly&nbsp;the&nbsp;same&nbsp;results.&nbsp;Each&nbsp;producer&nbsp;observes&nbsp;latencies&nbsp;that&nbsp;are&nbsp;multiple&nbsp;of&nbsp;31&nbsp;milliseconds&nbsp;(though&nbsp;based&nbsp;on&nbsp;wireshark&nbsp;capture,&nbsp;this&nbsp;latency&nbsp;seems&nbsp;to&nbsp;be&nbsp;dominated&nbsp;by&nbsp;the&nbsp;25&nbsp;milliseconds&nbsp;we&nbsp;see&nbsp;in&nbsp;rabbitMQ&nbsp;side).&nbsp;Example&nbsp;output&nbsp;of&nbsp;what&nbsp;I&nbsp;am&nbsp;seeing&nbsp;on&nbsp;the&nbsp;producer&nbsp;side&nbsp;is&nbsp;below:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;1354633782.0697601&nbsp;-&nbsp;completing&nbsp;send&nbsp;15&nbsp;took&nbsp;63.736915588378906&lt;/div&gt;&lt;div&gt;1354633782.233757&nbsp;-&nbsp;completing&nbsp;send&nbsp;16&nbsp;took&nbsp;63.80009651184082&lt;/div&gt;&lt;div&gt;1354633782.3976469&nbsp;-&nbsp;completing&nbsp;send&nbsp;17&nbsp;took&nbsp;63.717842102050781&lt;/div&gt;<br>
&lt;div&gt;1354633782.5615449&nbsp;-&nbsp;completing&nbsp;send&nbsp;18&nbsp;took&nbsp;63.707828521728516&lt;/div&gt;&lt;div&gt;1354633782.725692&nbsp;-&nbsp;completing&nbsp;send&nbsp;19&nbsp;took&nbsp;63.929080963134766&lt;/div&gt;&lt;div&gt;1354633782.8579049&nbsp;-&nbsp;completing&nbsp;send&nbsp;20&nbsp;took&nbsp;31.997919082641602&lt;/div&gt;<br>
&lt;div&gt;1354633783.0219419&nbsp;-&nbsp;completing&nbsp;send&nbsp;21&nbsp;took&nbsp;63.837051391601562&lt;/div&gt;&lt;div&gt;1354633783.1538589&nbsp;-&nbsp;completing&nbsp;send&nbsp;22&nbsp;took&nbsp;31.718969345092773&lt;/div&gt;&lt;div&gt;1354633783.285862&nbsp;-&nbsp;completing&nbsp;send&nbsp;23&nbsp;took&nbsp;31.77189826965332&lt;/div&gt;&lt;div&gt;<br>
1354633783.4498329&nbsp;-&nbsp;completing&nbsp;send&nbsp;24&nbsp;took&nbsp;63.776016235351562&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;in&nbsp;my&nbsp;previous&nbsp;email&nbsp;I&nbsp;forgot&nbsp;to&nbsp;specify&nbsp;my&nbsp;environment.&nbsp;I&nbsp;am&nbsp;running&nbsp;on&nbsp;rabbitMQ&nbsp;3.0&amp;nbsp;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;Erlang&nbsp;R15B02.&nbsp;Python&nbsp;and&nbsp;pika&nbsp;0.9.8&nbsp;on&nbsp;the&nbsp;client&nbsp;side&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;Pierpaolo&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;On&nbsp;Tue,&nbsp;Dec&nbsp;4,&nbsp;2012&nbsp;at&nbsp;1:22&nbsp;AM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;04/12/12&nbsp;08:55,&nbsp;Matthias&nbsp;Radestock&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;<br>
I&nbsp;am&nbsp;guessing&nbsp;your&nbsp;messages&nbsp;are&nbsp;marked&nbsp;as&nbsp;persistent.&nbsp;The&nbsp;25ms&nbsp;is&nbsp;indeed&lt;br&gt;<br>
an&nbsp;aggregation&nbsp;interval,&nbsp;but&nbsp;for&nbsp;the&nbsp;disk&nbsp;(in&nbsp;particular&nbsp;fsyncs)&nbsp;rather&lt;br&gt;<br>
than&nbsp;the&nbsp;network.&lt;br&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;<br>
However,&nbsp;fsyncs&nbsp;also&nbsp;happen&nbsp;when&nbsp;queues&nbsp;and&nbsp;the&nbsp;storage&nbsp;sub-system&nbsp;go&nbsp;idle,&nbsp;so&nbsp;the&nbsp;interval&nbsp;only&nbsp;kicks&nbsp;in&nbsp;when&nbsp;the&nbsp;system&nbsp;is&nbsp;busy&nbsp;(thus&nbsp;ensuring&nbsp;that&nbsp;fsyncs&nbsp;aren't&nbsp;delayed&nbsp;indefinitely).&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;I&nbsp;am&nbsp;pretty&nbsp;sure&nbsp;what&nbsp;you&nbsp;are&nbsp;seeing&nbsp;is&nbsp;simply&nbsp;the&nbsp;cost&nbsp;of&nbsp;performing&nbsp;an&nbsp;fsync&nbsp;per&nbsp;message.&nbsp;There's&nbsp;nothing&nbsp;that&nbsp;can&nbsp;be&nbsp;done&nbsp;about&nbsp;that&nbsp;except&nbsp;buying&nbsp;faster&nbsp;disks&nbsp;/&nbsp;switching&nbsp;to&nbsp;SSDs.&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;div&gt;_______________________________________________&lt;/div&gt;&lt;div&gt;rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</tt>
