<tt>
Found&nbsp;something&nbsp;interesting.&nbsp;I&nbsp;tried&nbsp;to&nbsp;temporarily&nbsp;disable&nbsp;the&nbsp;policy&nbsp;for&nbsp;mirroring&nbsp;of&nbsp;my&nbsp;test&nbsp;queue&nbsp;and&nbsp;now&nbsp;I&nbsp;am&nbsp;consistently&nbsp;getting&nbsp;7/7.5&nbsp;milliseconds&nbsp;latency.&nbsp;Seems&nbsp;like&nbsp;the&nbsp;issue&nbsp;is&nbsp;triggered&nbsp;by&nbsp;the&nbsp;mirroring&nbsp;of&nbsp;the&nbsp;queue.&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Pier&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Dec&nbsp;4,&nbsp;2012&nbsp;at&nbsp;7:11&nbsp;AM,&nbsp;Pierpaolo&nbsp;Baccichet&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:pierpaolo@dropbox.com&quot;&nbsp;target=&quot;_blank&quot;&gt;pierpaolo@dropbox.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hello&nbsp;Matthias,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;your&nbsp;quick&nbsp;response!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;double&nbsp;checked&nbsp;the&nbsp;code&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;I&nbsp;am&nbsp;not&nbsp;marking&nbsp;messages&nbsp;as&nbsp;persistent&nbsp;and&nbsp;indeed&nbsp;that&amp;#39;s&nbsp;the&nbsp;case.&nbsp;The&nbsp;queues&nbsp;and&nbsp;the&nbsp;exchanges&nbsp;are&nbsp;marked&nbsp;as&nbsp;durable&nbsp;but&nbsp;the&nbsp;individual&nbsp;messages&nbsp;I&nbsp;send&nbsp;are&nbsp;not&nbsp;setting&nbsp;the&nbsp;delivery_mode=2.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;a&nbsp;little&nbsp;skeptical&nbsp;the&nbsp;issue&nbsp;here&nbsp;is&nbsp;sync&nbsp;on&nbsp;disk&nbsp;because&nbsp;adding&nbsp;producers&nbsp;does&nbsp;not&nbsp;change&nbsp;the&nbsp;behavior.&nbsp;I&nbsp;ran&nbsp;a&nbsp;test&nbsp;with&nbsp;5&nbsp;producers&nbsp;sending&nbsp;10&nbsp;messages&nbsp;per&nbsp;second&nbsp;each&nbsp;and&nbsp;I&nbsp;am&nbsp;still&nbsp;seeing&nbsp;exactly&nbsp;the&nbsp;same&nbsp;results.&nbsp;Each&nbsp;producer&nbsp;observes&nbsp;latencies&nbsp;that&nbsp;are&nbsp;multiple&nbsp;of&nbsp;31&nbsp;milliseconds&nbsp;(though&nbsp;based&nbsp;on&nbsp;wireshark&nbsp;capture,&nbsp;this&nbsp;latency&nbsp;seems&nbsp;to&nbsp;be&nbsp;dominated&nbsp;by&nbsp;the&nbsp;25&nbsp;milliseconds&nbsp;we&nbsp;see&nbsp;in&nbsp;rabbitMQ&nbsp;side).&nbsp;Example&nbsp;output&nbsp;of&nbsp;what&nbsp;I&nbsp;am&nbsp;seeing&nbsp;on&nbsp;the&nbsp;producer&nbsp;side&nbsp;is&nbsp;below:&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;1354633782.0697601&nbsp;-&nbsp;completing&nbsp;send&nbsp;15&nbsp;took&nbsp;63.736915588378906&lt;/div&gt;&lt;div&gt;1354633782.233757&nbsp;-&nbsp;completing&nbsp;send&nbsp;16&nbsp;took&nbsp;63.80009651184082&lt;/div&gt;&lt;div&gt;1354633782.3976469&nbsp;-&nbsp;completing&nbsp;send&nbsp;17&nbsp;took&nbsp;63.717842102050781&lt;/div&gt;<br>
<br>
&lt;div&gt;1354633782.5615449&nbsp;-&nbsp;completing&nbsp;send&nbsp;18&nbsp;took&nbsp;63.707828521728516&lt;/div&gt;&lt;div&gt;1354633782.725692&nbsp;-&nbsp;completing&nbsp;send&nbsp;19&nbsp;took&nbsp;63.929080963134766&lt;/div&gt;&lt;div&gt;1354633782.8579049&nbsp;-&nbsp;completing&nbsp;send&nbsp;20&nbsp;took&nbsp;31.997919082641602&lt;/div&gt;<br>
<br>
&lt;div&gt;1354633783.0219419&nbsp;-&nbsp;completing&nbsp;send&nbsp;21&nbsp;took&nbsp;63.837051391601562&lt;/div&gt;&lt;div&gt;1354633783.1538589&nbsp;-&nbsp;completing&nbsp;send&nbsp;22&nbsp;took&nbsp;31.718969345092773&lt;/div&gt;&lt;div&gt;1354633783.285862&nbsp;-&nbsp;completing&nbsp;send&nbsp;23&nbsp;took&nbsp;31.77189826965332&lt;/div&gt;<br>
&lt;div&gt;<br>
1354633783.4498329&nbsp;-&nbsp;completing&nbsp;send&nbsp;24&nbsp;took&nbsp;63.776016235351562&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also,&nbsp;in&nbsp;my&nbsp;previous&nbsp;email&nbsp;I&nbsp;forgot&nbsp;to&nbsp;specify&nbsp;my&nbsp;environment.&nbsp;I&nbsp;am&nbsp;running&nbsp;on&nbsp;rabbitMQ&nbsp;3.0 &lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;Erlang&nbsp;R15B02.&nbsp;Python&nbsp;and&nbsp;pika&nbsp;0.9.8&nbsp;on&nbsp;the&nbsp;client&nbsp;side&lt;/span&gt;&lt;/div&gt;<br>
&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(68,68,68);font-family:Verdana,sans-serif;font-size:12px;text-align:right&quot;&gt;Pierpaolo&lt;/span&gt;&lt;/div&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Dec&nbsp;4,&nbsp;2012&nbsp;at&nbsp;1:22&nbsp;AM,&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;On&nbsp;04/12/12&nbsp;08:55,&nbsp;Matthias&nbsp;Radestock&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;am&nbsp;guessing&nbsp;your&nbsp;messages&nbsp;are&nbsp;marked&nbsp;as&nbsp;persistent.&nbsp;The&nbsp;25ms&nbsp;is&nbsp;indeed&lt;br&gt;<br>
an&nbsp;aggregation&nbsp;interval,&nbsp;but&nbsp;for&nbsp;the&nbsp;disk&nbsp;(in&nbsp;particular&nbsp;fsyncs)&nbsp;rather&lt;br&gt;<br>
than&nbsp;the&nbsp;network.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
However,&nbsp;fsyncs&nbsp;also&nbsp;happen&nbsp;when&nbsp;queues&nbsp;and&nbsp;the&nbsp;storage&nbsp;sub-system&nbsp;go&nbsp;idle,&nbsp;so&nbsp;the&nbsp;interval&nbsp;only&nbsp;kicks&nbsp;in&nbsp;when&nbsp;the&nbsp;system&nbsp;is&nbsp;busy&nbsp;(thus&nbsp;ensuring&nbsp;that&nbsp;fsyncs&nbsp;aren&amp;#39;t&nbsp;delayed&nbsp;indefinitely).&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;I&nbsp;am&nbsp;pretty&nbsp;sure&nbsp;what&nbsp;you&nbsp;are&nbsp;seeing&nbsp;is&nbsp;simply&nbsp;the&nbsp;cost&nbsp;of&nbsp;performing&nbsp;an&nbsp;fsync&nbsp;per&nbsp;message.&nbsp;There&amp;#39;s&nbsp;nothing&nbsp;that&nbsp;can&nbsp;be&nbsp;done&nbsp;about&nbsp;that&nbsp;except&nbsp;buying&nbsp;faster&nbsp;disks&nbsp;/&nbsp;switching&nbsp;to&nbsp;SSDs.&lt;br&gt;<br>
&lt;br&gt;<br>
Regards,&lt;br&gt;<br>
&lt;br&gt;<br>
Matthias.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
