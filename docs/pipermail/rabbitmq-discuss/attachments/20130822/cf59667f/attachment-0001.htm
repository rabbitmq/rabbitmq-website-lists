<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;As&nbsp;a&nbsp;comment&nbsp;to&nbsp;Chris&nbsp;answer:&nbsp;Instagram&nbsp;uses&nbsp;RabbitMQ&nbsp;HA&nbsp;across&nbsp;availability&nbsp;zones:&nbsp;&lt;a&nbsp;href=&quot;https://twitter.com/rbranson/status/310461932618534913&quot;&gt;https://twitter.com/rbranson/status/310461932618534913&lt;/a&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;More&nbsp;details&nbsp;about&nbsp;their&nbsp;setup&nbsp;here:&nbsp;&lt;a&nbsp;href=&quot;http://blogs.vmware.com/vfabric/2013/04/how-instagram-feeds-work-celery-and-rabbitmq.html&quot;&gt;http://blogs.vmware.com/vfabric/2013/04/how-instagram-feeds-work-celery-and-rabbitmq.html&lt;/a&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Aug&nbsp;22,&nbsp;2013&nbsp;at&nbsp;10:20&nbsp;PM,&nbsp;Chris&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:stuff@moesel.net&quot;&nbsp;target=&quot;_blank&quot;&gt;stuff@moesel.net&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Jon,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&amp;#39;m&nbsp;not&nbsp;100%&nbsp;familiar&nbsp;with&nbsp;Amazon&amp;#39;s&nbsp;availability&nbsp;zones&nbsp;and&nbsp;how&nbsp;they&nbsp;work,&nbsp;but...&nbsp;it&nbsp;sounds&nbsp;to&nbsp;me&nbsp;like&nbsp;they&nbsp;are&nbsp;in&nbsp;different&nbsp;locations&nbsp;and&nbsp;different&nbsp;networks?&nbsp; If&nbsp;so,&nbsp;clustering&nbsp;is&nbsp;probably&nbsp;not&nbsp;a&nbsp;good&nbsp;idea&nbsp;in&nbsp;this&nbsp;case.&nbsp; See: &lt;a&nbsp;href=&quot;http://www.rabbitmq.com/partitions.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.rabbitmq.com/partitions.html&lt;/a&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don&amp;#39;t&nbsp;know&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;cause&nbsp;for&nbsp;the&nbsp;issues&nbsp;you&amp;#39;ve&nbsp;seen,&nbsp;but&nbsp;it&nbsp;may&nbsp;be&nbsp;the&nbsp;cause&nbsp;of&nbsp;issues&nbsp;in&nbsp;the&nbsp;future...&nbsp; On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;if&nbsp;I&nbsp;am&nbsp;wrong&nbsp;about&nbsp;availabity&nbsp;zones,&nbsp;then&nbsp;you&nbsp;can&nbsp;safely&nbsp;disregard&nbsp;this&nbsp;message!&nbsp;;-)&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-Chris&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;On&nbsp;Thu,&nbsp;Aug&nbsp;22,&nbsp;2013&nbsp;at&nbsp;3:17&nbsp;PM,&nbsp;Jon&nbsp;Dokulil&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:jondokulil@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jondokulil@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;We&amp;#39;ve&nbsp;seen&nbsp;this&nbsp;happen&nbsp;twice&nbsp;now&nbsp;and&nbsp;each&nbsp;time&nbsp;it&amp;#39;s&nbsp;been&nbsp;a&nbsp;pain&nbsp;to&nbsp;work&nbsp;around&nbsp;(we&nbsp;ended&nbsp;up&nbsp;creating&nbsp;a&nbsp;whole&nbsp;new&nbsp;cluster&nbsp;each&nbsp;time).&nbsp;Here&amp;#39;s&nbsp;the&nbsp;scenario&nbsp;we&nbsp;have&nbsp;seen:&lt;div&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;Our&nbsp;setup:&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;Three&nbsp;RabbitMQ&nbsp;3.1.5&nbsp;nodes&nbsp;running&nbsp;on&nbsp;the&nbsp;Amazon&nbsp;Linux&nbsp;AMI.&nbsp;Each&nbsp;node&nbsp;is&nbsp;in&nbsp;a&nbsp;different&nbsp;availability&nbsp;zone&nbsp;in&nbsp;the&nbsp;US-EAST&nbsp;region&nbsp;on&nbsp;AWS.&nbsp;We&amp;#39;ll&nbsp;call&nbsp;them&nbsp;nodes&nbsp;A,&nbsp;B,&nbsp;and&nbsp;C&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;Each&nbsp;queue&nbsp;is&nbsp;using&nbsp;an&nbsp;HA&nbsp;policy&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;All&nbsp;queues&nbsp;are&nbsp;durable&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;We&nbsp;Basic.Publish&nbsp;with&nbsp;DeliveryMode=2&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;All&nbsp;clients&nbsp;are&nbsp;initially&nbsp;connected&nbsp;to&nbsp;node&nbsp;A&lt;/span&gt;&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;The&nbsp;scenario:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;Node&nbsp;A&nbsp;is&nbsp;shutdown&nbsp;(the&nbsp;last&nbsp;time&nbsp;I&nbsp;did&nbsp;it&nbsp;via&nbsp;&amp;#39;sudo&nbsp;/etc/init.d/rabbitmq-server&nbsp;stop&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;All&nbsp;connected&nbsp;clients&nbsp;see&nbsp;the&nbsp;shutdown&nbsp;and&nbsp;successfully&nbsp;transition&nbsp;to&nbsp;using&nbsp;one&nbsp;of&nbsp;the&nbsp;other&nbsp;nodes.&nbsp;About&nbsp;half&nbsp;connect&nbsp;to&nbsp;node&nbsp;B&nbsp;and&nbsp;the&nbsp;other&nbsp;half&nbsp;connect&nbsp;to&nbsp;node&nbsp;C&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;We&nbsp;notice&nbsp;that&nbsp;a&nbsp;few&nbsp;of&nbsp;the&nbsp;queues&nbsp;still&nbsp;show&nbsp;their&nbsp;&amp;quot;node&amp;quot;&nbsp;as&nbsp;being&nbsp;node&nbsp;A,&nbsp;even&nbsp;though&nbsp;it&nbsp;is&nbsp;not&nbsp;currently&nbsp;running.&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;Node&nbsp;A&nbsp;is&nbsp;brought&nbsp;back&nbsp;online.&nbsp;The&nbsp;RabbitMQ&nbsp;management&nbsp;console&nbsp;(webapp)&nbsp;shows&nbsp;everything&nbsp;is&nbsp;fine&nbsp;on&nbsp;the&nbsp;homepage.&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;When&nbsp;A&nbsp;comes&nbsp;back&nbsp;online,&nbsp;those&nbsp;queues&nbsp;that&nbsp;show&nbsp;A&nbsp;as&nbsp;their&nbsp;&amp;#39;node&amp;#39;&nbsp;now&nbsp;show&nbsp;zero&nbsp;mirrors.&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;li&gt;&lt;span&nbsp;style=&quot;line-height:normal&quot;&gt;I&nbsp;attempt&nbsp;to&nbsp;delete&nbsp;the&nbsp;queue&nbsp;via&nbsp;the&nbsp;management&nbsp;webapp.&nbsp;At&nbsp;that&nbsp;point&nbsp;all&nbsp;three&nbsp;nodes&nbsp;become&nbsp;100%&nbsp;unresponsive.&nbsp;The&nbsp;management&nbsp;webapp&nbsp;fails&nbsp;to&nbsp;respond&nbsp;and&nbsp;all&nbsp;communication&nbsp;in&nbsp;our&nbsp;application&nbsp;stops.&nbsp;CPU&nbsp;fluctuates&nbsp;between&nbsp;10-40%&nbsp;on&nbsp;but&nbsp;memory&nbsp;doesn&amp;#39;t&nbsp;seem&nbsp;to&nbsp;be&nbsp;leaking.&nbsp;It&amp;#39;s&nbsp;difficult&nbsp;to&nbsp;know&nbsp;what&nbsp;is&nbsp;happening&nbsp;because&nbsp;rabbitmqctl&nbsp;is&nbsp;also&nbsp;unresponsive.&nbsp;Attempts&nbsp;to&nbsp;gracefully&nbsp;stop&nbsp;the&nbsp;nodes&nbsp;all&nbsp;hang.&lt;/span&gt;&lt;/li&gt;<br>
<br>
&lt;/ol&gt;&lt;div&gt;Does&nbsp;anybody&nbsp;have&nbsp;experience&nbsp;with&nbsp;this?&nbsp;What&nbsp;additional&nbsp;information&nbsp;should&nbsp;I&nbsp;provide?&nbsp;It&amp;#39;s&nbsp;causing&nbsp;a&nbsp;lot&nbsp;of&nbsp;stress&nbsp;and&nbsp;confuses&nbsp;the&nbsp;heck&nbsp;out&nbsp;of&nbsp;me.&nbsp;Any&nbsp;guidance&nbsp;is&nbsp;much&nbsp;appreciated.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
