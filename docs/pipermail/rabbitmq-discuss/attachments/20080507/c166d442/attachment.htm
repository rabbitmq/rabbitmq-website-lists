<tt>
&lt;html&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;div&gt;BTW&nbsp;Edwin,&nbsp;I&nbsp;reposting&nbsp;this&nbsp;to&nbsp;the&nbsp;list,&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;followed.&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;7&nbsp;May&nbsp;2008,&nbsp;at&nbsp;21:50,&nbsp;Edwin&nbsp;Fine&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Thanks&nbsp;for&nbsp;the&nbsp;response,&nbsp;Ben.&nbsp;I&nbsp;will&nbsp;try&nbsp;to&nbsp;create&nbsp;a&nbsp;standalone&nbsp;program&nbsp;that&nbsp;reproduces&amp;nbsp;&nbsp;the&nbsp;issue.&nbsp;I&nbsp;hope&nbsp;I&nbsp;can&nbsp;do&nbsp;it.&nbsp;The&nbsp;hesitation&nbsp;comes&nbsp;because&nbsp;the&nbsp;circumstances&nbsp;under&nbsp;which&nbsp;this&nbsp;occurred&nbsp;are:&lt;br&gt;&lt;ul&gt;&lt;li&gt;50&nbsp;queues&nbsp;on&nbsp;one&nbsp;&amp;lt;&amp;lt;direct&gt;&gt;&nbsp;exchange&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;div&gt;Shouldn't&nbsp;be&nbsp;an&nbsp;issue.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;ul&gt;&nbsp;&lt;li&gt;A&nbsp;producer&nbsp;that&nbsp;is&nbsp;pushing&nbsp;150&nbsp;messages/second&nbsp;to&nbsp;the&nbsp;queues,&nbsp;evenly&nbsp;across&nbsp;the&nbsp;queue&nbsp;name&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Shouldn't&nbsp;be&nbsp;an&nbsp;issue.&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;ul&gt;&lt;li&gt;Each&nbsp;queue&nbsp;is&nbsp;doing&nbsp;a&nbsp;basic.deliver&nbsp;to&nbsp;one&nbsp;of&nbsp;50&nbsp;Erlang&nbsp;consumer&nbsp;processes&nbsp;(gen_event).&nbsp;The&nbsp;consumer&nbsp;processes&nbsp;all&nbsp;share&nbsp;the&nbsp;same&nbsp;channel&nbsp;(which&nbsp;may&nbsp;not&nbsp;be&nbsp;a&nbsp;good&nbsp;idea,&nbsp;because&nbsp;when&nbsp;the&nbsp;channel&nbsp;crashed,&nbsp;so&nbsp;did&nbsp;all&nbsp;50&nbsp;consumers.&nbsp;I&nbsp;wonder&nbsp;if&nbsp;I&nbsp;should&nbsp;have&nbsp;1&nbsp;channel&nbsp;for&nbsp;each&nbsp;consumer?&nbsp;Too&nbsp;heavy?).&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;div&gt;Good&nbsp;question.&nbsp;The&nbsp;golden&nbsp;answer&nbsp;I&nbsp;guess&nbsp;is&nbsp;not&nbsp;too&nbsp;little,&nbsp;not&nbsp;too&nbsp;much&nbsp;;-)&nbsp;Your&nbsp;mileage&nbsp;will&nbsp;vary.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;there&nbsp;is&nbsp;a&nbsp;bug,&nbsp;however,&nbsp;the&nbsp;channel&nbsp;process&nbsp;will&nbsp;bring&nbsp;all&nbsp;of&nbsp;the&nbsp;consumers&nbsp;that&nbsp;are&nbsp;linked&nbsp;to&nbsp;it.&nbsp;So&nbsp;from&nbsp;a&nbsp;*resiliency*&nbsp;perspective,&nbsp;you&nbsp;might&nbsp;want&nbsp;to&nbsp;have&nbsp;more&nbsp;than&nbsp;one&nbsp;channel&nbsp;process.&nbsp;Having&nbsp;said&nbsp;that,&nbsp;I&nbsp;would&nbsp;prefer&nbsp;to&nbsp;find&nbsp;out&nbsp;what&nbsp;the&nbsp;cause&nbsp;was&nbsp;and&nbsp;identify&nbsp;whether&nbsp;there&nbsp;is&nbsp;a&nbsp;bug&nbsp;that&nbsp;needs&nbsp;to&nbsp;fixed.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;terms&nbsp;of&nbsp;the&nbsp;difference&nbsp;this&nbsp;makes&nbsp;on&nbsp;overall&nbsp;throughput,&nbsp;I&nbsp;think&nbsp;the&nbsp;answer&nbsp;is&nbsp;that&nbsp;it&nbsp;depends.&nbsp;Using&nbsp;the&nbsp;network&nbsp;client&nbsp;you&nbsp;are&nbsp;receiving&nbsp;serially&nbsp;from&nbsp;a&nbsp;single&nbsp;client&nbsp;socket,&nbsp;so&nbsp;it&nbsp;may&nbsp;be&nbsp;6&nbsp;of&nbsp;one&nbsp;and&nbsp;half&nbsp;a&nbsp;dozen&nbsp;of&nbsp;the&nbsp;other.&nbsp;In&nbsp;the&nbsp;direct&nbsp;case,&nbsp;you&nbsp;may&nbsp;see&nbsp;more&nbsp;leverage&nbsp;effect&nbsp;here.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;ul&gt;&nbsp;&lt;li&gt;Because&nbsp;the&nbsp;channel.flow&nbsp;command&nbsp;is&nbsp;not&nbsp;implemented,&nbsp;I&nbsp;am&nbsp;using&nbsp;unsubscribe&nbsp;to&nbsp;try&nbsp;to&nbsp;do&nbsp;flow&nbsp;control,&nbsp;because&nbsp;I&nbsp;am&nbsp;finding&nbsp;that&nbsp;RabbitMQ&nbsp;is&nbsp;dumping&nbsp;all&nbsp;the&nbsp;basic.deliver&nbsp;messages&nbsp;into&nbsp;the&nbsp;Erlang&nbsp;message&nbsp;queue&nbsp;of&nbsp;each&nbsp;consumer&nbsp;gen_event&nbsp;process.&nbsp;This&nbsp;is&nbsp;totally&nbsp;not&nbsp;what&nbsp;I&nbsp;want&nbsp;-&nbsp;I&nbsp;want&nbsp;the&nbsp;messages&nbsp;to&nbsp;stay&nbsp;persisted&nbsp;in&nbsp;Rabbit-land&nbsp;until&nbsp;I&nbsp;can&nbsp;deliver&nbsp;them&nbsp;and&nbsp;tell&nbsp;Rabbit&nbsp;to&nbsp;release&nbsp;them.&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;div&gt;At&nbsp;the&nbsp;moment,&nbsp;Rabbit&nbsp;is&nbsp;designed&nbsp;to&nbsp;deliver&nbsp;a&nbsp;message&nbsp;if&nbsp;it&nbsp;can.&nbsp;Control&nbsp;flow&nbsp;is&nbsp;more&nbsp;of&nbsp;a&nbsp;server&nbsp;implementation&nbsp;issue.&nbsp;Thoughts&nbsp;anyone?&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;ul&gt;&nbsp;&lt;li&gt;The&nbsp;reason&nbsp;I&nbsp;need&nbsp;flow&nbsp;control&nbsp;is&nbsp;because&nbsp;I&nbsp;am&nbsp;delivering&nbsp;messages&nbsp;via&nbsp;HTTP/XML&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;different&nbsp;Web&nbsp;sites.&nbsp;Sometimes&nbsp;a&nbsp;web&nbsp;site&nbsp;may&nbsp;be&nbsp;down,&nbsp;often&nbsp;for&nbsp;hours,&nbsp;and&nbsp;I&nbsp;want&nbsp;to&nbsp;just&nbsp;be&nbsp;able&nbsp;to&nbsp;pause&nbsp;the&nbsp;consumer&nbsp;(and&nbsp;producer)&nbsp;until&nbsp;messages&nbsp;start&nbsp;going&nbsp;through&nbsp;again.&nbsp;Having&nbsp;the&nbsp;Erlang&nbsp;message&nbsp;queues&nbsp;filling&nbsp;up&nbsp;with&nbsp;thousands&nbsp;of&nbsp;messages&nbsp;will&nbsp;eventually&nbsp;crash&nbsp;the&nbsp;VM&nbsp;due&nbsp;to&nbsp;OOM.&nbsp;I&nbsp;know&nbsp;I&nbsp;can&nbsp;poll&nbsp;with&nbsp;basic.get,&nbsp;but&nbsp;the&nbsp;conundrum&nbsp;is&nbsp;that&nbsp;I&nbsp;want&nbsp;high&nbsp;performance&nbsp;while&nbsp;the&nbsp;web&nbsp;sites&nbsp;are&nbsp;accepting&nbsp;input,&nbsp;and&nbsp;shut-off&nbsp;when&nbsp;they&nbsp;are&nbsp;not.&nbsp;Any&nbsp;suggestions?&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;One&nbsp;strategy&nbsp;that&nbsp;springs&nbsp;to&nbsp;mind&nbsp;to&nbsp;turn&nbsp;the&nbsp;no_ack&nbsp;flag&nbsp;when&nbsp;sending&nbsp;the&nbsp;consume&nbsp;command&nbsp;to&nbsp;the&nbsp;broker.&nbsp;I&nbsp;will&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;look&nbsp;to&nbsp;see&nbsp;what&nbsp;the&nbsp;behaviour&nbsp;of&nbsp;this,&nbsp;because&nbsp;I&nbsp;don't&nbsp;know&nbsp;off&nbsp;the&nbsp;top&nbsp;my&nbsp;head.&nbsp;Alternatively&nbsp;if&nbsp;you&nbsp;can&nbsp;detect&nbsp;the&nbsp;failure&nbsp;of&nbsp;a&nbsp;web&nbsp;site,&nbsp;can&nbsp;you&nbsp;actively&nbsp;cancel&nbsp;the&nbsp;subscription?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;ul&gt;&lt;li&gt;&lt;br&gt;&nbsp;&lt;/li&gt;&lt;/ul&gt;So&nbsp;I&nbsp;may&nbsp;have&nbsp;to&nbsp;build&nbsp;a&nbsp;simulated&nbsp;version&nbsp;of&nbsp;the&nbsp;above&nbsp;to&nbsp;get&nbsp;the&nbsp;problem&nbsp;to&nbsp;happen&nbsp;again.&nbsp;That's&nbsp;the&nbsp;hesitation&nbsp;-&nbsp;will&nbsp;it&nbsp;trigger&nbsp;the&nbsp;error?&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Let's&nbsp;hope&nbsp;so.&nbsp;If&nbsp;not,&nbsp;and&nbsp;if&nbsp;you&nbsp;feel&amp;nbsp;comfortable&nbsp;with&nbsp;it,&nbsp;you&nbsp;send&nbsp;you&nbsp;raw&nbsp;code&nbsp;base.&amp;nbsp;&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Anyway,&nbsp;I&nbsp;am&nbsp;probably&nbsp;not&nbsp;doing&nbsp;this&nbsp;the&nbsp;right&nbsp;way,&nbsp;but&nbsp;I&nbsp;have&nbsp;no&nbsp;expertise&nbsp;in&nbsp;AMQP.&nbsp;My&nbsp;knowledge&nbsp;is&nbsp;of&nbsp;MQSeries&nbsp;a&nbsp;few&nbsp;years&nbsp;back.&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;I&nbsp;don't&nbsp;think&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;problem&nbsp;:-)&nbsp;AMQP&nbsp;is&nbsp;not&nbsp;MQ&nbsp;:-)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;HTH,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ben&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
