<tt>
<br>
Hi&nbsp;and&nbsp;thanks&nbsp;for&nbsp;your&nbsp;interest&nbsp;!<br>
<br>
Marek,&nbsp;I&nbsp;checked&nbsp;my&nbsp;code&nbsp;and&nbsp;I&nbsp;had&nbsp;already&nbsp;set&nbsp;the&nbsp;mandatory&nbsp;and&nbsp;immediate&nbsp;flags&nbsp;to&nbsp;false.<br>
Matthias,&nbsp;here&nbsp;is&nbsp;the&nbsp;description&nbsp;of&nbsp;my&nbsp;case&nbsp;:<br>
<br>
the&nbsp;server&nbsp;(2.1.0)&nbsp;is&nbsp;started&nbsp;on&nbsp;linux&nbsp;after&nbsp;a&nbsp;clean.<br>
I&nbsp;start&nbsp;5&nbsp;publishers&nbsp;that&nbsp;sends&nbsp;2000&nbsp;messages&nbsp;of&nbsp;78&nbsp;bytes&nbsp;per&nbsp;second&nbsp;on&nbsp;10&nbsp;exchnages.&nbsp;that&nbsp;is&nbsp;to&nbsp;say&nbsp;:<br>
<br>
-10&nbsp;exchanges&nbsp;(with&nbsp;x-lvc&nbsp;plugin&nbsp;that&nbsp;stores&nbsp;in&nbsp;mnesia&nbsp;database&nbsp;the&nbsp;last&nbsp;value&nbsp;for&nbsp;each&nbsp;message)<br>
-10000&nbsp;different&nbsp;messages&nbsp;@&nbsp;1Hz&nbsp;(=&nbsp;10000&nbsp;different&nbsp;routeId)&nbsp;--&gt;&nbsp;~700Kb/s<br>
-&nbsp;each&nbsp;exchange&nbsp;handles&nbsp;1000&nbsp;msg/s<br>
<br>
&quot;top&quot;&nbsp;shows&nbsp;me&nbsp;a&nbsp;130%&nbsp;CPU&nbsp;load&nbsp;with&nbsp;no&nbsp;subscriber&nbsp;(=&nbsp;no&nbsp;queue)&nbsp;for&nbsp;the&nbsp;moment,&nbsp;just&nbsp;publishing.<br>
Here&nbsp;are&nbsp;the&nbsp;control&nbsp;traces&nbsp;:<br>
<br>
&lt;i&gt;Listing&nbsp;exchanges&nbsp;...<br>
amq.direct&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
amq.topic&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptopic<br>
tm://SAT.DRV7&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx-lvc<br>
tm://SAT.DRV1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx-lvc<br>
amq.rabbitmq.log&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptopic<br>
tm://SAT.DRV6&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx-lvc<br>
tm://SAT.DRV2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx-lvc<br>
tm://SAT.DRV4&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx-lvc<br>
amq.fanout&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfanout<br>
tm://SAT.DRV8&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx-lvc<br>
tm://SAT.DRV3&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx-lvc<br>
tm://SAT.DRV5&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx-lvc<br>
tm://SAT.DRV0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx-lvc<br>
amq.headers&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspheaders<br>
tm://SAT.DRV9&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspx-lvc<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
amq.match&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspheaders<br>
...done.<br>
Listing&nbsp;queues&nbsp;...<br>
...done.<br>
Listing&nbsp;channels&nbsp;...<br>
&lt;rabbit@bigtune.269.0&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfalse&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0<br>
&lt;rabbit@bigtune.282.0&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfalse&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0<br>
&lt;rabbit@bigtune.293.0&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfalse&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0<br>
&lt;rabbit@bigtune.305.0&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfalse&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0<br>
&lt;rabbit@bigtune.321.0&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfalse&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0<br>
...done.<br>
Listing&nbsp;connections&nbsp;...<br>
guest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp140.94.126.54&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2831&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprunning<br>
guest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp140.94.126.54&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2834&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprunning<br>
guest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp140.94.126.54&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2835&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprunning<br>
guest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp140.94.126.54&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2833&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprunning<br>
guest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp140.94.126.54&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2832&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprunning<br>
...done.<br>
Listing&nbsp;bindings&nbsp;...<br>
...done.&lt;/i&gt;<br>
<br>
I&nbsp;made&nbsp;the&nbsp;same&nbsp;test&nbsp;with&nbsp;direct&nbsp;exchanges&nbsp;(without&nbsp;mnesia)&nbsp;:&nbsp;<br>
CPU&nbsp;load&nbsp;:&nbsp;120%<br>
Control&nbsp;traces&nbsp;:<br>
<br>
&lt;i&gt;Listing&nbsp;exchanges&nbsp;...<br>
amq.direct&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
amq.topic&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptopic<br>
tm://SAT.DRV7&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
tm://SAT.DRV1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
amq.rabbitmq.log&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptopic<br>
tm://SAT.DRV6&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
tm://SAT.DRV2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
tm://SAT.DRV4&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
amq.fanout&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfanout<br>
tm://SAT.DRV8&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
tm://SAT.DRV3&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
tm://SAT.DRV5&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
tm://SAT.DRV0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
amq.headers&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspheaders<br>
tm://SAT.DRV9&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdirect<br>
amq.match&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspheaders<br>
...done.<br>
Listing&nbsp;queues&nbsp;...<br>
...done.<br>
Listing&nbsp;channels&nbsp;...<br>
&lt;rabbit@bigtune.373.0&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfalse&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0<br>
&lt;rabbit@bigtune.424.0&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfalse&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0<br>
&lt;rabbit@bigtune.438.0&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfalse&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0<br>
&lt;rabbit@bigtune.452.0&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfalse&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0<br>
&lt;rabbit@bigtune.468.0&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspguest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfalse&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0<br>
...done.<br>
Listing&nbsp;connections&nbsp;...<br>
guest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp140.94.126.54&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2956&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprunning<br>
guest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp140.94.126.54&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2955&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprunning<br>
guest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp140.94.126.54&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2952&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprunning<br>
guest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp140.94.126.54&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2954&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprunning<br>
guest&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp140.94.126.54&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2953&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprunning<br>
...done.<br>
Listing&nbsp;bindings&nbsp;...<br>
...done.&lt;/i&gt;<br>
<br>
<br>
What&nbsp;disturbs&nbsp;me&nbsp;is&nbsp;this&nbsp;high&nbsp;CPU&nbsp;load&nbsp;whereas&nbsp;there&nbsp;is&nbsp;no&nbsp;subscriber.&nbsp;That's&nbsp;the&nbsp;reason&nbsp;why&nbsp;I&nbsp;search&nbsp;a&nbsp;way&nbsp;to&nbsp;&quot;control&nbsp;the&nbsp;message&nbsp;flow&nbsp;sent&nbsp;by&nbsp;publishers&quot;.&nbsp;for&nbsp;instance&nbsp;when&nbsp;listening&nbsp;the&nbsp;bindings&nbsp;on&nbsp;a&nbsp;subscriber.<br>
<br>
Thanks&nbsp;a&nbsp;lot&nbsp;for&nbsp;your&nbsp;help.<br>
Romain<br>
<br>
&lt;blockquote&nbsp;class=&quot;quote&nbsp;light-black&nbsp;dark-border-color&quot;&gt;&lt;div&nbsp;class=&quot;quote&nbsp;light-border-color&quot;&gt;<br>
&lt;div&nbsp;class=&quot;quote-author&quot;&nbsp;style=&quot;font-weight:&nbsp;bold;&quot;&gt;Marek&nbsp;Majkowski&nbsp;wrote:&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;quote-message&quot;&gt;<br>
&gt;&nbsp;I&nbsp;try&nbsp;to&nbsp;find&nbsp;some&nbsp;ways&nbsp;to&nbsp;enhance&nbsp;this.&nbsp;So&nbsp;my&nbsp;question&nbsp;:&nbsp;would&nbsp;it&nbsp;be<br>
&gt;&nbsp;possible&nbsp;to&nbsp;publish&nbsp;essages&nbsp;to&nbsp;the&nbsp;exchange&nbsp;only&nbsp;if&nbsp;there&nbsp;is&nbsp;at&nbsp;least&nbsp;one<br>
&gt;&nbsp;consumer&nbsp;that&nbsp;subscribed&nbsp;this&nbsp;message&nbsp;?&nbsp;In&nbsp;other&nbsp;words,&nbsp;I&nbsp;would&nbsp;like&nbsp;to<br>
&gt;&nbsp;implement&nbsp;a&nbsp;kind&nbsp;of&nbsp;binding&nbsp;listener&nbsp;on&nbsp;exchanges&nbsp;and&nbsp;a&nbsp;way&nbsp;to&nbsp;request&nbsp;the<br>
&gt;&nbsp;list&nbsp;of&nbsp;bindings&nbsp;(in&nbsp;Java).<br>
&gt;<br>
&gt;&nbsp;I&nbsp;searched&nbsp;the&nbsp;api&nbsp;and&nbsp;it&nbsp;doesn't&nbsp;seem&nbsp;to&nbsp;be&nbsp;available.&nbsp;I&nbsp;am&nbsp;also&nbsp;aware&nbsp;that<br>
&gt;&nbsp;this&nbsp;breaks&nbsp;the&nbsp;publisher/subscriber&nbsp;model&nbsp;since&nbsp;the&nbsp;publisher&nbsp;doesn't&nbsp;have<br>
&gt;&nbsp;to&nbsp;carry&nbsp;about&nbsp;diffusion,&nbsp;it&nbsp;just&nbsp;publishes.<br>
<br>
Have&nbsp;you&nbsp;looked&nbsp;at&nbsp;the&nbsp;&quot;immediate&quot;&nbsp;and&nbsp;&quot;mandatory&quot;&nbsp;flags&nbsp;in&nbsp;basic.publish?<br>
<br>
&gt;From&nbsp;http://www.rabbitmq.com/api-guide.html:<br>
&quot;If&nbsp;a&nbsp;message&nbsp;is&nbsp;published&nbsp;with&nbsp;the&nbsp;&quot;mandatory&quot;&nbsp;or&nbsp;&quot;immediate&quot;&nbsp;flags<br>
set,&nbsp;but&nbsp;cannot&nbsp;be&nbsp;delivered,&nbsp;the&nbsp;broker&nbsp;will&nbsp;return&nbsp;it&nbsp;to&nbsp;the&nbsp;sending<br>
client&nbsp;(via&nbsp;a&nbsp;AMQP.Basic.Return&nbsp;command).&quot;<br>
<br>
<br>
Cheers,<br>
&nbsp;&nbsp;Marek<br>
_______________________________________________<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list<br>
rabbitmq-discuss@lists.rabbitmq.com<br>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss<br>
<br>
&lt;/div&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;<br>
<br>
<br>
&lt;br&gt;&lt;hr&nbsp;align=&quot;left&quot;&nbsp;width=&quot;300&quot;&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://old.nabble.com/Publish-messages-only-when-needed---tp29904396p29913525.html&quot;&gt;Re:&nbsp;Publish&nbsp;messages&nbsp;only&nbsp;when&nbsp;needed&nbsp;?&lt;/a&gt;&lt;br&gt;<br>
Sent&nbsp;from&nbsp;the&nbsp;&lt;a&nbsp;href=&quot;http://old.nabble.com/RabbitMQ-f25704.html&quot;&gt;RabbitMQ&nbsp;mailing&nbsp;list&nbsp;archive&lt;/a&gt;&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>

</tt>
