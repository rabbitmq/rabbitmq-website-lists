<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Simon,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;so&nbsp;much&nbsp;for&nbsp;your&nbsp;detailed&nbsp;response&nbsp;-&nbsp;it&nbsp;was&nbsp;very&nbsp;helpful&nbsp;to&nbsp;me&nbsp;and&nbsp;answered&nbsp;all&nbsp;of&nbsp;my&nbsp;questions.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Regards,&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
Richard&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Feb&nbsp;27,&nbsp;2013&nbsp;at&nbsp;8:19&nbsp;AM,&nbsp;Simon&nbsp;MacMullen&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:simon@rabbitmq.com&quot;&nbsp;target=&quot;_blank&quot;&gt;simon@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;26/02/13&nbsp;23:41,&nbsp;Richard&nbsp;Raseley&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;am&nbsp;contemplating&nbsp;the&nbsp;use&nbsp;of&nbsp;topic&nbsp;exchanges&nbsp;along&nbsp;with&nbsp;the&nbsp;federation&lt;br&gt;<br>
plugin&nbsp;to&nbsp;route&nbsp;messages&nbsp;between&nbsp;geographically&nbsp;separated&nbsp;brokers.&lt;br&gt;<br>
&lt;br&gt;<br>
1)&nbsp;Will&nbsp;someone&nbsp;confirm&nbsp;my&nbsp;understanding&nbsp;of&nbsp;the&nbsp;configuration&nbsp;is&nbsp;valid?&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;this&nbsp;situation&nbsp;there&nbsp;would&nbsp;be&nbsp;topic&nbsp;exchange&nbsp;named&nbsp;&amp;quot;B1.TE&amp;quot;&nbsp;&amp;quot;B2.TE&amp;quot;&lt;br&gt;<br>
that&nbsp;would&nbsp;be&nbsp;configured&nbsp;within&nbsp;brokers&nbsp;&amp;quot;B1&amp;quot;&nbsp;and&nbsp;&amp;quot;B2&amp;quot;&nbsp;respectively.&lt;br&gt;<br>
B1.TE&nbsp;would&nbsp;have&nbsp;B2.TE&nbsp;configured&nbsp;as&nbsp;an&nbsp;upstream&nbsp;exchange&nbsp;and&nbsp;B2.TE&lt;br&gt;<br>
would&nbsp;have&nbsp;B1.TE&nbsp;configured&nbsp;as&nbsp;an&nbsp;upstream&nbsp;exchange.&lt;br&gt;<br>
&lt;br&gt;<br>
Broker&nbsp;B1&nbsp;would&nbsp;have&nbsp;queues&nbsp;&amp;quot;B1.Q1&amp;quot;&nbsp;and&nbsp;&amp;quot;B1.Q2&amp;quot;&nbsp;configured&nbsp;and&nbsp;bound&nbsp;to&lt;br&gt;<br>
exchange&nbsp;B1.TE&nbsp;with&nbsp;routing&nbsp;keys&nbsp;&amp;quot;B1.Q1&amp;quot;&nbsp;and&nbsp;&amp;quot;*.Q2&amp;quot;&nbsp;respectively.&lt;br&gt;<br>
&lt;br&gt;<br>
Broker&nbsp;B2&nbsp;would&nbsp;have&nbsp;queues&nbsp;&amp;quot;B2.Q1&amp;quot;&nbsp;and&nbsp;&amp;quot;B2.Q2&amp;quot;&nbsp;configured&nbsp;and&nbsp;bound&nbsp;to&lt;br&gt;<br>
exchange&nbsp;B2.TE&nbsp;with&nbsp;routing&nbsp;keys&nbsp;&amp;quot;B2.Q1&amp;quot;&nbsp;and&nbsp;&amp;quot;*.Q2&amp;quot;&nbsp;respectively.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
It&nbsp;is&nbsp;valid,&nbsp;certainly.&nbsp;Note&nbsp;that&nbsp;the&nbsp;exchanges&nbsp;and&nbsp;queues&nbsp;in&nbsp;B1&nbsp;and&nbsp;B2&nbsp;do&nbsp;not&nbsp;need&nbsp;to&nbsp;have&nbsp;distinct&nbsp;names&nbsp;(but&nbsp;maybe&nbsp;you&nbsp;were&nbsp;just&nbsp;doing&nbsp;that&nbsp;to&nbsp;be&nbsp;clearer?)&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
2)&nbsp;Assuming&nbsp;the&nbsp;answer&nbsp;to&nbsp;question&nbsp;#1&nbsp;above&nbsp;is&nbsp;&amp;quot;yes,&nbsp;it&nbsp;is&nbsp;valid&amp;quot;,&nbsp;would&lt;br&gt;<br>
someone&nbsp;confirm&nbsp;my&nbsp;understanding&nbsp;of&nbsp;how&nbsp;the&nbsp;following&nbsp;messages&nbsp;would&nbsp;be&lt;br&gt;<br>
routed?&lt;br&gt;<br>
&lt;br&gt;<br>
A&nbsp;message&nbsp;sent&nbsp;to&nbsp;exchange&nbsp;B1.TE&nbsp;with&nbsp;routing&nbsp;key&nbsp;&amp;quot;B2.Q1&amp;quot;&nbsp;would&nbsp;be&lt;br&gt;<br>
received,&nbsp;forwarded&nbsp;to&nbsp;exchange&nbsp;B2.TE,&nbsp;placed&nbsp;in&nbsp;queue&nbsp;B2.Q1,&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Yes.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
and&nbsp;then&nbsp;acknowledgement&nbsp;would&nbsp;be&nbsp;sent&nbsp;back&nbsp;to&nbsp;the&nbsp;client.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
No.&lt;br&gt;<br>
&lt;br&gt;<br>
Assuming&nbsp;the&nbsp;client&nbsp;is&nbsp;publishing&nbsp;in&nbsp;confirm&nbsp;mode,&nbsp;the&nbsp;confirm&nbsp;will&nbsp;be&nbsp;sent&nbsp;back&nbsp;as&nbsp;soon&nbsp;as&nbsp;B1&nbsp;has&nbsp;taken&nbsp;responsibility&nbsp;for&nbsp;the&nbsp;message.&nbsp;Confirms&nbsp;mean&nbsp;&amp;quot;the&nbsp;broker&nbsp;you&nbsp;published&nbsp;to&nbsp;took&nbsp;responsibility&nbsp;for&nbsp;the&nbsp;message&amp;quot;.&nbsp;Otherwise&nbsp;as&nbsp;your&nbsp;federation&nbsp;grows&nbsp;larger&nbsp;and&nbsp;less-reliable&nbsp;network&nbsp;links&nbsp;come&nbsp;into&nbsp;play,&nbsp;you&nbsp;could&nbsp;be&nbsp;waiting&nbsp;a&nbsp;long&nbsp;time&nbsp;for&nbsp;those&nbsp;confirms!&lt;div&nbsp;class=&quot;im&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
A&nbsp;message&nbsp;sent&nbsp;to&nbsp;exchange&nbsp;B1.TE&nbsp;with&nbsp;routing&nbsp;key&nbsp;&amp;quot;B1.Q2&amp;quot;&nbsp;would&nbsp;be&lt;br&gt;<br>
received,&nbsp;a&nbsp;copy&nbsp;placed&nbsp;in&nbsp;queue&nbsp;B1.Q2,&nbsp;a&nbsp;copy&nbsp;forwarded&nbsp;to&nbsp;exchange&lt;br&gt;<br>
B2.TE,&nbsp;placed&nbsp;in&nbsp;queue&nbsp;B2.Q2,&nbsp;and&nbsp;then&nbsp;acknowledgement&nbsp;would&nbsp;be&nbsp;sent&lt;br&gt;<br>
back&nbsp;to&nbsp;the&nbsp;client.&lt;br&gt;<br>
&lt;br&gt;<br>
A&nbsp;message&nbsp;sent&nbsp;to&nbsp;exchange&nbsp;B2.TE&nbsp;with&nbsp;routing&nbsp;key&nbsp;&amp;quot;B2.Q2&amp;quot;&nbsp;would&nbsp;be&lt;br&gt;<br>
received,&nbsp;a&nbsp;copy&nbsp;placed&nbsp;in&nbsp;queue&nbsp;B2.Q2,&nbsp;a&nbsp;copy&nbsp;forwarded&nbsp;to&nbsp;exchange&lt;br&gt;<br>
B1.TE,&nbsp;placed&nbsp;in&nbsp;queue&nbsp;B1.Q2,&nbsp;and&nbsp;then&nbsp;acknowledgement&nbsp;would&nbsp;be&nbsp;sent&lt;br&gt;<br>
back&nbsp;to&nbsp;the&nbsp;client.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Again,&nbsp;yes&nbsp;to&nbsp;the&nbsp;routing,&nbsp;no&nbsp;to&nbsp;when&nbsp;confirmation&nbsp;happens.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
3)&nbsp;My&nbsp;understanding&nbsp;is&nbsp;that&nbsp;an&nbsp;exchange&nbsp;has&nbsp;knowledge&nbsp;of&nbsp;the&nbsp;routing&lt;br&gt;<br>
topology&nbsp;of&nbsp;any&nbsp;upstream&nbsp;queues&nbsp;and&nbsp;therefore&nbsp;won&amp;#39;t&nbsp;send&nbsp;a&nbsp;message&lt;br&gt;<br>
upstream&nbsp;that&nbsp;wouldn&amp;#39;t&nbsp;end&nbsp;up&nbsp;in&nbsp;a&nbsp;queue.&nbsp;Firstly,&nbsp;is&nbsp;that&nbsp;understanding&lt;br&gt;<br>
correct?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
I&nbsp;think&nbsp;you&nbsp;mean&nbsp;&amp;quot;downstream&amp;quot;&nbsp;in&nbsp;both&nbsp;cases,&nbsp;but&nbsp;yes.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Secondly&nbsp;(if&nbsp;yes&nbsp;to&nbsp;the&nbsp;previous&nbsp;question),&nbsp;what&nbsp;type&nbsp;of&lt;br&gt;<br>
overhead&nbsp;are&nbsp;we&nbsp;talking&nbsp;about&nbsp;when&nbsp;using&nbsp;this&nbsp;configuration&nbsp;with&nbsp;a&nbsp;topic&lt;br&gt;<br>
exchange?&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Effectively&nbsp;the&nbsp;bindings&nbsp;propagate&nbsp;upstream,&nbsp;so&nbsp;each&nbsp;federated&nbsp;exchange&nbsp;will&nbsp;end&nbsp;up&nbsp;with&nbsp;all&nbsp;the&nbsp;bindings&nbsp;for&nbsp;all&nbsp;of&nbsp;its&nbsp;downstreams.&lt;div&nbsp;class=&quot;im&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
My&nbsp;worry&nbsp;is&nbsp;that&nbsp;the&nbsp;processing&nbsp;power&nbsp;required&nbsp;to&nbsp;deliver&nbsp;each&nbsp;message&lt;br&gt;<br>
will&nbsp;increase&nbsp;exponentially&nbsp;as&nbsp;I&nbsp;add&nbsp;additional&nbsp;brokers&nbsp;in&nbsp;a&nbsp;&amp;quot;mesh&amp;quot;&lt;br&gt;<br>
style&nbsp;federated&nbsp;topology&nbsp;as&nbsp;it&nbsp;seems&nbsp;that&nbsp;the&nbsp;routing&nbsp;table&nbsp;on&nbsp;each&lt;br&gt;<br>
upstream&nbsp;exchange&nbsp;has&nbsp;to&nbsp;be&nbsp;examined&nbsp;for&nbsp;each&nbsp;message&nbsp;delivery.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Well,&nbsp;it&nbsp;won&amp;#39;t&nbsp;be&nbsp;exponential.&nbsp;But&nbsp;the&nbsp;routing&nbsp;table&nbsp;will&nbsp;get&nbsp;larger.&nbsp;Topic&nbsp;routing&nbsp;is&nbsp;approximately&nbsp;O(log&nbsp;n)&nbsp;in&nbsp;the&nbsp;number&nbsp;of&nbsp;bindings.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;federation&nbsp;mechanism&nbsp;doesn&amp;#39;t&nbsp;try&nbsp;to&nbsp;trade&nbsp;routing&nbsp;complexity&nbsp;for&nbsp;unnecessarily-routed&nbsp;messages&nbsp;by&nbsp;amalgamating&nbsp;topic&nbsp;keys&nbsp;since&lt;br&gt;<br>
&lt;br&gt;<br>
 (a)&nbsp;it&nbsp;would&nbsp;have&nbsp;to&nbsp;know&nbsp;about&nbsp;topics&nbsp;for&nbsp;that,&nbsp;it&amp;#39;s&nbsp;supposed&nbsp;to&nbsp;be&nbsp;a&lt;br&gt;<br>
 &nbsp; &nbsp; generic&nbsp;mechanism&lt;br&gt;<br>
&lt;br&gt;<br>
 (b)&nbsp;it&nbsp;can&amp;#39;t&nbsp;know&nbsp;what&nbsp;the&nbsp;distribution&nbsp;of&nbsp;messages&nbsp;across&nbsp;your&lt;br&gt;<br>
 &nbsp; &nbsp; routing&nbsp;key&nbsp;space&nbsp;is&lt;br&gt;<br>
&lt;br&gt;<br>
However,&nbsp;*you*&nbsp;know&nbsp;that&nbsp;distribution.&nbsp;So&nbsp;you&nbsp;could&nbsp;federate&nbsp;topic&nbsp;exchanges&nbsp;and&nbsp;then&nbsp;use&nbsp;e2e&nbsp;bindings&nbsp;from&nbsp;them&nbsp;to&nbsp;local&nbsp;topic&nbsp;exchanges,&nbsp;with&nbsp;relatively&nbsp;&amp;quot;large&amp;quot;&nbsp;routing&nbsp;keys&nbsp;that&nbsp;will&nbsp;cover&nbsp;a&nbsp;decent&nbsp;sized&nbsp;range.&nbsp;Then&nbsp;apps&nbsp;bind&nbsp;queues&nbsp;to&nbsp;the&nbsp;local&nbsp;topics.&nbsp;That&nbsp;does&nbsp;require&nbsp;a&nbsp;bit&nbsp;more&nbsp;up-front&nbsp;setup&nbsp;though&nbsp;-&nbsp;but&nbsp;it&nbsp;kind&nbsp;of&nbsp;has&nbsp;to&nbsp;since&nbsp;it&nbsp;requires&nbsp;knowledge&nbsp;of&nbsp;how&nbsp;your&nbsp;routing&nbsp;keys&nbsp;are&nbsp;distributed.&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
Cheers,&nbsp;Simon&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
Simon&nbsp;MacMullen&lt;br&gt;<br>
RabbitMQ,&nbsp;VMware&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
