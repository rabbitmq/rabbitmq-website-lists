<tt>
Hi,&nbsp;Monish:&lt;br&gt;&lt;br&gt;If&nbsp;you&amp;#39;re&nbsp;using&nbsp;the&nbsp;naked&nbsp;Java&nbsp;client,&nbsp;you&amp;#39;ll&nbsp;have&nbsp;to&nbsp;implement&nbsp;your&nbsp;own&nbsp;reconnection&nbsp;logic. &nbsp;If&nbsp;you&amp;#39;re&nbsp;using&nbsp;Spring&nbsp;AMQP&nbsp;there&amp;#39;s&nbsp;some&nbsp;helper&nbsp;code&nbsp;that&nbsp;wraps&nbsp;your&nbsp;connections&nbsp;with&nbsp;some&nbsp;retry&nbsp;logic&nbsp;for&nbsp;you.&lt;br&gt;<br>
&lt;br&gt;Best&nbsp;regards,&lt;br&gt;Jerry&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Jul&nbsp;10,&nbsp;2012&nbsp;at&nbsp;9:47&nbsp;AM,&nbsp;cogitate&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:monish.unni@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;monish.unni@gmail.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Hi&nbsp;Mathias&nbsp;et&nbsp;al:&lt;br&gt;<br>
&lt;br&gt;<br>
Given:&lt;br&gt;<br>
--&nbsp;java&nbsp;rabbitmq&nbsp;client&nbsp;2.8.2&lt;br&gt;<br>
--&nbsp;rabbitmq&nbsp;broker&nbsp;2.8.2&lt;br&gt;<br>
--&nbsp;wrote&nbsp;an&nbsp;amqp&nbsp;client&nbsp;library&nbsp;(java)&nbsp;that&nbsp;has&nbsp;the&nbsp;following&nbsp;semantics:&lt;br&gt;<br>
[1]&nbsp;setting&nbsp;up&nbsp;connection&nbsp;properties&lt;br&gt;<br>
 [1.1]&nbsp;username,&nbsp;password&nbsp;(authentication)&lt;br&gt;<br>
 [1.2]&nbsp;host,&nbsp;port&nbsp;(&nbsp;endpoint&nbsp;)&lt;br&gt;<br>
 [1.3]&nbsp;#&nbsp;of&nbsp;threads(concurrent&nbsp;users),&nbsp;#&nbsp;of&nbsp;connections(conn.),&nbsp;conn.&lt;br&gt;<br>
timeout,&nbsp;receive&nbsp;timeout&lt;br&gt;<br>
 *&nbsp;#&nbsp;of&nbsp;usable&nbsp;clients&nbsp;effectively&nbsp;=&nbsp;threads&nbsp;x&nbsp;connections&lt;br&gt;<br>
&lt;br&gt;<br>
[2]&nbsp;A&nbsp;manager&nbsp;sets&nbsp;up&nbsp;a&nbsp;pool&nbsp;for&nbsp;fair-sharing&nbsp;of&nbsp;resources&nbsp;per&nbsp;thread.&lt;br&gt;<br>
 [2.1]&nbsp;sets&nbsp;up&nbsp;a&nbsp;connection&nbsp;pool&lt;br&gt;<br>
 [2.2]&nbsp;sets&nbsp;up&nbsp;request/reply&nbsp;channels&lt;br&gt;<br>
 [2.3]&nbsp;sets&nbsp;up&nbsp;re-usable&nbsp;reply-queues&lt;br&gt;<br>
&lt;br&gt;<br>
[3]&nbsp;A&nbsp;client&nbsp;class&nbsp;derived&nbsp;from&nbsp;the&nbsp;manager&lt;br&gt;<br>
 [3.1]&nbsp;this&nbsp;pre-configured&nbsp;(with&nbsp;properties&nbsp;in&nbsp;[2])&lt;br&gt;<br>
 [3.2]&nbsp;specify&nbsp;exchange(context),&nbsp;routing-key(service),&nbsp;payload(a&nbsp;message)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
when&nbsp;a&nbsp;broker&nbsp;is&nbsp;shutdown&nbsp;and&nbsp;restarted,&nbsp;the&nbsp;stack&nbsp;i&nbsp;get&nbsp;is&nbsp;:&lt;br&gt;<br>
[ERROR:clean&nbsp;connection&nbsp;shutdown;&nbsp;reason:&nbsp;Attempt&nbsp;to&nbsp;use&nbsp;closed&nbsp;channel]&lt;br&gt;<br>
com.rabbitmq.client.AlreadyClosedException:&nbsp;clean&nbsp;connection&nbsp;shutdown;&lt;br&gt;<br>
reason:&nbsp;Attempt&nbsp;to&nbsp;use&nbsp;closed&nbsp;channel&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:190)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:223)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:209)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:118)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;at&lt;br&gt;<br>
com.rabbitmq.client.impl.ChannelN.exchangeDeclarePassive(ChannelN.java:660)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;at&lt;br&gt;<br>
com.rabbitmq.client.impl.ChannelN.exchangeDeclarePassive(ChannelN.java:61)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.xx.s2.amqp.AmqpClient.doSend(AmqpClient.java:187)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.xx.s2.amqp.AmqpClient.callService(AmqpClient.java:80)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;at&lt;br&gt;<br>
com.xx.s2.amqp.StaleConnectionTest.callLoopTest(StaleConnectionTest.java:132)&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;at&nbsp;com.xx.s2.amqp.StaleConnectionTest.loopTest(StaleConnectionTest.java:86)&lt;br&gt;<br>
&lt;br&gt;<br>
at&nbsp;this&nbsp;point,&nbsp;i&nbsp;have&nbsp;to&nbsp;shutdown&nbsp;the&nbsp;client&nbsp;using&nbsp;the&nbsp;library&nbsp;and&nbsp;restart&lt;br&gt;<br>
it.&nbsp;is&nbsp;there&nbsp;a&nbsp;way&nbsp;to&nbsp;handle&nbsp;this&nbsp;exception&nbsp;and&nbsp;re-establish&nbsp;the&nbsp;connection?&lt;br&gt;<br>
any&nbsp;utilities&nbsp;that&nbsp;will&nbsp;allow&nbsp;me&nbsp;to&nbsp;do&nbsp;this&nbsp;&amp;quot;automatically&amp;quot;?&lt;br&gt;<br>
&lt;br&gt;<br>
thanks&nbsp;and&nbsp;regards,&lt;br&gt;<br>
-monish&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
View&nbsp;this&nbsp;message&nbsp;in&nbsp;context:&nbsp;&lt;a&nbsp;href=&quot;http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://rabbitmq.1065348.n5.nabble.com/Handle-Stale-Connections-on-Clients-tp20687.html&lt;/a&gt;&lt;br&gt;<br>
<br>
Sent&nbsp;from&nbsp;the&nbsp;RabbitMQ&nbsp;mailing&nbsp;list&nbsp;archive&nbsp;at&nbsp;Nabble.com.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
rabbitmq-discuss&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:rabbitmq-discuss@lists.rabbitmq.com&quot;&gt;rabbitmq-discuss@lists.rabbitmq.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
