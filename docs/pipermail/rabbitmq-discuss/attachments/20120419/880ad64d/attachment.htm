<tt>
We&nbsp;are&nbsp;using&nbsp;RabbitMQ&nbsp;Server&nbsp;(v2.8.1)&nbsp;on&nbsp;Windows&nbsp;Server&nbsp;2008&nbsp;R2&nbsp;x64.&nbsp;And&nbsp;we&nbsp;have&nbsp;a&nbsp;few&nbsp;NET&nbsp;4.0&nbsp;applications&nbsp;using&nbsp;the&nbsp;.NET&nbsp;RabbitMQ&nbsp;client&nbsp;library&nbsp;(v2.8.1).&nbsp;&amp;nbsp;Recently,&nbsp;we&nbsp;encountered&amp;nbsp;an&nbsp;issue&nbsp;that&nbsp;caused&nbsp;the&nbsp;client&nbsp;to&nbsp;hang&nbsp;and&nbsp;run&nbsp;the&nbsp;CPU&nbsp;at&nbsp;100%.&nbsp;&amp;nbsp;Interestingly&nbsp;enough,&nbsp;this&nbsp;issue&nbsp;occurred&nbsp;on&nbsp;two&nbsp;servers&nbsp;that&nbsp;are&nbsp;remote&nbsp;to&nbsp;the&nbsp;RabbitMQ&nbsp;broker&nbsp;server.&nbsp;&amp;nbsp;We&nbsp;had&nbsp;another&nbsp;instance&nbsp;of&nbsp;the&nbsp;application&nbsp;running&nbsp;on&nbsp;the&nbsp;same&nbsp;box&nbsp;as&nbsp;RabbitMQ&nbsp;broker&nbsp;and&nbsp;it&nbsp;was&nbsp;unaffected.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;the&nbsp;two&nbsp;machines&nbsp;that&nbsp;were&nbsp;affected,&nbsp;we&nbsp;took&nbsp;a&nbsp;crash&nbsp;dump&nbsp;of&nbsp;the&amp;nbsp;process&amp;nbsp;and&nbsp;then&nbsp;fired&nbsp;up&nbsp;Windbg&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;misbehaving&nbsp;threads&nbsp;and&nbsp;associated&nbsp;stack&nbsp;traces.&nbsp;&amp;nbsp;The&nbsp;stack&nbsp;traces&nbsp;revealed&nbsp;an&amp;nbsp;unhandled&amp;nbsp;exception&nbsp;within&nbsp;the&nbsp;RabbitMQ&nbsp;client&nbsp;library&nbsp;that&nbsp;was&nbsp;being&nbsp;raised:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Exception&nbsp;type:&nbsp;&amp;nbsp;&nbsp;System.IO.EndOfStreamException&lt;/div&gt;&lt;div&gt;Message:&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;SharedQueue&nbsp;closed&lt;/div&gt;&lt;div&gt;InnerException:&nbsp;&amp;nbsp;&nbsp;&amp;lt;none&amp;gt;&lt;/div&gt;&lt;div&gt;StackTrace&nbsp;(generated):&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;SP&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;IP&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;Function&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;053FF04C&nbsp;00D05C77&nbsp;UNKNOWN!RabbitMQ.Util.SharedQueue.EnsureIsOpen()+0x37&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;053FF054&nbsp;00D05B18&nbsp;UNKNOWN!RabbitMQ.Util.SharedQueue.Dequeue(Int32,&nbsp;System.Object&nbsp;ByRef)+0x78&lt;/div&gt;&lt;div&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;053FF0D0&nbsp;00D05914&nbsp;UNKNOWN!RabbitMQ.Client.MessagePatterns.Subscription.Next(Int32,&nbsp;RabbitMQ.Client.Events.BasicDeliverEventArgs&nbsp;ByRef)+0x44&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Perhaps&nbsp;there&nbsp;was&nbsp;some&nbsp;kind&nbsp;of&nbsp;network&nbsp;hiccup&nbsp;(I'm&nbsp;not&nbsp;sure),&nbsp;but&nbsp;in&nbsp;any&nbsp;case,&nbsp;when&nbsp;the&nbsp;subscription&nbsp;was&nbsp;attempting&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;SharedQueue,&nbsp;it&nbsp;tried&nbsp;to&nbsp;read&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;stream&nbsp;and&nbsp;this&nbsp;caused&nbsp;the&nbsp;above&nbsp;exception&nbsp;which&nbsp;was&nbsp;not&nbsp;handled&nbsp;by&nbsp;the&nbsp;RabbitMQ&nbsp;client&nbsp;library.&nbsp;&amp;nbsp;We're&nbsp;modifying&nbsp;our&nbsp;code&nbsp;slightly&nbsp;to&nbsp;address&nbsp;this&nbsp;issue&nbsp;for&nbsp;now,&nbsp;but&nbsp;you&nbsp;may&nbsp;want&nbsp;to&nbsp;have&nbsp;either&amp;nbsp;Emile&nbsp;Joubert&nbsp;or&amp;nbsp;Alexandru&nbsp;Scvortov&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;the&nbsp;code&nbsp;see&nbsp;what&nbsp;can&nbsp;be&nbsp;done.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;wasn't&nbsp;exactly&nbsp;sure&nbsp;how&nbsp;to&nbsp;file&nbsp;an&nbsp;official&nbsp;bug&nbsp;report,&nbsp;so&nbsp;I&nbsp;thought&nbsp;I'd&nbsp;post&nbsp;the&nbsp;issue&nbsp;here.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;One&nbsp;other&nbsp;&quot;nice&nbsp;to&nbsp;have&quot;&nbsp;that's&nbsp;on&nbsp;a&nbsp;slightly&nbsp;different&nbsp;topic&nbsp;but&nbsp;still&nbsp;related&nbsp;to&nbsp;the&nbsp;.NET&nbsp;client&nbsp;library&nbsp;would&nbsp;be&nbsp;to&nbsp;mark&nbsp;the&nbsp;various&nbsp;methods&nbsp;and&nbsp;properties&nbsp;within&amp;nbsp;RabbitMQ.Client.MessagePatterns.Subscription&nbsp;as&nbsp;virtual&nbsp;such&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;override&nbsp;(mocked)&nbsp;during&nbsp;testing&nbsp;or&nbsp;perhaps&nbsp;an&nbsp;interface&nbsp;created&nbsp;which&nbsp;Subscription&nbsp;implements.&nbsp;This&nbsp;would&nbsp;ease&nbsp;some&nbsp;of&nbsp;our&nbsp;testing&nbsp;because&nbsp;we&nbsp;had&nbsp;to&nbsp;create&nbsp;a&nbsp;wrapper&nbsp;class&nbsp;to&nbsp;make&nbsp;Subscription&nbsp;testable&nbsp;during&nbsp;our&nbsp;development.&lt;/div&gt;
</tt>
