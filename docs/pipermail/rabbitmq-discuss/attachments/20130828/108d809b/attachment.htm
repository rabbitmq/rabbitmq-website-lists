<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;(I&nbsp;know&nbsp;this&nbsp;is&nbsp;Pika,&nbsp;rather&nbsp;than&nbsp;specifically&nbsp;RabbitMQ,&nbsp;but&nbsp;figure&nbsp;there&amp;#39;s&nbsp;a&nbsp;broader&nbsp;audience&nbsp;here.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;In&nbsp;our&nbsp;architecture,&nbsp;I&amp;#39;m&nbsp;investigating&nbsp;moving&nbsp;away&nbsp;from&nbsp;polling&nbsp;with&nbsp;basic_get,&nbsp;and&nbsp;towards&nbsp;using&nbsp;basic_consume.&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;our&nbsp;twist&nbsp;is&nbsp;that&nbsp;our&nbsp;overall&nbsp;design&nbsp;doesn&amp;#39;t&nbsp;just&nbsp;let&nbsp;us&nbsp;call&nbsp;connection.io.loop.start()&nbsp;and&nbsp;handle&nbsp;all&nbsp;our&nbsp;messages&nbsp;inside&nbsp;the&nbsp;registered&nbsp;handler&nbsp;like&nbsp;all&nbsp;the&nbsp;example&nbsp;code&nbsp;does.&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;What&nbsp;I&amp;#39;d&nbsp;like&nbsp;to&nbsp;do&nbsp;is&nbsp;something&nbsp;like&nbsp;the&nbsp;following,&nbsp;but&nbsp;I&nbsp;can&amp;#39;t&nbsp;quite&nbsp;figure&nbsp;out&nbsp;the&nbsp;combination&nbsp;of&nbsp;calls/callbacks&nbsp;to&nbsp;make&nbsp;it&nbsp;work.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Goals:&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;Create&nbsp;a&nbsp;&amp;quot;blocking&amp;quot;&nbsp;routine&nbsp;that&nbsp;either&nbsp;returns&nbsp;a&nbsp;message&nbsp;or&nbsp;&amp;quot;None&amp;quot;&nbsp;if&nbsp;the&nbsp;whole&nbsp;system&nbsp;is&nbsp;shutting&nbsp;down:&lt;br&gt;<br>
&lt;/li&gt;&lt;li&gt;Let&nbsp;the&nbsp;broker&nbsp;push&nbsp;1&nbsp;message/time&nbsp;to&nbsp;us,&nbsp;rather&nbsp;than&nbsp;us&nbsp;polling&nbsp;via&nbsp;basic_get.&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&amp;#39;s&nbsp;my&nbsp;admittedly&nbsp;incomplete&nbsp;thoughts&nbsp;on&nbsp;how&nbsp;this&nbsp;might&nbsp;work:&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;Create&nbsp;a&nbsp;SelectConnection&nbsp;instance&lt;br&gt;<br>
&lt;/li&gt;&lt;li&gt;In&nbsp;the&nbsp;blocking&nbsp;read&nbsp;logic,&nbsp;use&nbsp;basic_consume&nbsp;to&nbsp;tell&nbsp;the&nbsp;broker&nbsp;it&amp;#39;s&nbsp;OK&nbsp;to&nbsp;send&nbsp;a&nbsp;message&nbsp;to&nbsp;us&nbsp;now&nbsp;(prefetch=1).&lt;br&gt;&lt;/li&gt;&lt;li&gt;call&nbsp;connection.ioloop.start()&lt;/li&gt;&lt;li&gt;In&nbsp;the&nbsp;message&nbsp;handler,&nbsp;save&nbsp;off&nbsp;the&nbsp;message,&nbsp;then&nbsp;send&nbsp;a&nbsp;basic_cancel&nbsp;to&nbsp;tell&nbsp;the&nbsp;broker&nbsp;&amp;quot;No&nbsp;more&nbsp;for&nbsp;now,&nbsp;thanks!&amp;quot;&lt;br&gt;<br>
&lt;/li&gt;&lt;li&gt;The&nbsp;connection.ioloop.start()&nbsp;returns&nbsp;to&nbsp;the&nbsp;caller&lt;/li&gt;&lt;li&gt;Return&nbsp;the&nbsp;saved&nbsp;message&nbsp;to&nbsp;the&nbsp;caller.&lt;/li&gt;&lt;li&gt;Wash,&nbsp;rinse,&nbsp;repeat...&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;this&nbsp;sane?&nbsp;Are&nbsp;there&nbsp;examples&nbsp;of&nbsp;how&nbsp;I&nbsp;might&nbsp;do&nbsp;this?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;&lt;br&gt;Matt&lt;/div&gt;&lt;/div&gt;<br>

</tt>
