<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;Elias,&lt;br&gt;&lt;br&gt;Mea&nbsp;Culpa,&lt;br&gt;&lt;br&gt;You&nbsp;are&nbsp;quite&nbsp;right.&nbsp;Your&nbsp;understanding&nbsp;of&nbsp;HA&nbsp;queues&nbsp;is&nbsp;better&nbsp;than&lt;br&gt;mine.&nbsp;However,&nbsp;AFAICS&nbsp;the&nbsp;STOMP&nbsp;adapter&nbsp;doesn't&nbsp;present&lt;br&gt;the&nbsp;consumer_cancel_notify&nbsp;capability&nbsp;to&nbsp;the&nbsp;(Erlang)&nbsp;connection,&nbsp;so&lt;br&gt;will&nbsp;not&nbsp;receive&nbsp;a&nbsp;notification&nbsp;when&nbsp;the&nbsp;consumer&nbsp;is&nbsp;cancelled.&lt;br&gt;&lt;br&gt;The&nbsp;STOMP&nbsp;client&nbsp;will&nbsp;think&nbsp;that&nbsp;the&nbsp;subscription&nbsp;is&nbsp;sound&nbsp;even&nbsp;if&nbsp;the&lt;br&gt;underlying&nbsp;consumer&nbsp;was&nbsp;cancelled.&nbsp;We&nbsp;can&nbsp;probably&nbsp;do&nbsp;better&nbsp;than&nbsp;this.&lt;br&gt;&lt;br&gt;Although&nbsp;the&nbsp;STOMP&nbsp;client&nbsp;will&nbsp;stop&nbsp;receiving&nbsp;messages,&nbsp;I&nbsp;would&nbsp;not&lt;br&gt;characterise&nbsp;this&nbsp;as&nbsp;'dangerous',&nbsp;merely&nbsp;frustrating.&lt;br&gt;&lt;br&gt;Can&nbsp;you&nbsp;say&nbsp;what&nbsp;you&nbsp;think&nbsp;the&nbsp;correct&nbsp;STOMP&nbsp;behaviour&nbsp;ought&nbsp;to&nbsp;be&nbsp;if&nbsp;a&lt;br&gt;subscription's&nbsp;consumer&nbsp;is&nbsp;unilaterally&nbsp;cancelled?&nbsp;I'm&nbsp;tempted&nbsp;to&nbsp;simply&lt;br&gt;send&nbsp;an&nbsp;ERROR&nbsp;frame&nbsp;and&nbsp;simulate&nbsp;an&nbsp;UNSUBSCRIBE,&lt;br&gt;leaving&nbsp;the&nbsp;STOMP&nbsp;client&nbsp;to&nbsp;recover&nbsp;however&nbsp;it&nbsp;thinks&nbsp;fit.&lt;br&gt;&lt;div&gt;&lt;br&nbsp;class=&quot;webkit-block-placeholder&quot;&gt;&lt;/div&gt;&lt;div&gt;<br>
&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;separate;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Helvetica;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;2;&nbsp;text-align:&nbsp;-webkit-auto;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;2;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-border-horizontal-spacing:&nbsp;0px;&nbsp;-webkit-border-vertical-spacing:&nbsp;0px;&nbsp;-webkit-text-decorations-in-effect:&nbsp;none;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;font-size:&nbsp;medium;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;separate;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Helvetica;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;2;&nbsp;text-align:&nbsp;-webkit-auto;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;2;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-border-horizontal-spacing:&nbsp;0px;&nbsp;-webkit-border-vertical-spacing:&nbsp;0px;&nbsp;-webkit-text-decorations-in-effect:&nbsp;none;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;font-size:&nbsp;medium;&nbsp;&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-family:&nbsp;Georgia;&nbsp;&quot;&gt;Steve&nbsp;Powell&lt;/span&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;separate;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-style:&nbsp;normal;&nbsp;font-variant:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;line-height:&nbsp;normal;&nbsp;orphans:&nbsp;2;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;2;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-border-horizontal-spacing:&nbsp;0px;&nbsp;-webkit-border-vertical-spacing:&nbsp;0px;&nbsp;-webkit-text-decorations-in-effect:&nbsp;none;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;font-size:&nbsp;medium;&nbsp;&quot;&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Georgia&quot;&gt;&lt;i&gt;&lt;a&nbsp;href=&quot;mailto:steve@rabbitmq.com&quot;&gt;steve@rabbitmq.com&lt;/a&gt;&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Helvetica;&nbsp;&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;Georgia&quot;&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;10px;&nbsp;&quot;&gt;[&lt;/span&gt;&lt;i&gt;wrk&lt;/i&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;10px;&nbsp;&quot;&gt;:&nbsp;+44-2380-111-528]&nbsp;[&lt;/span&gt;&lt;i&gt;mob&lt;/i&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;font-size:&nbsp;10px;&nbsp;&quot;&gt;:&nbsp;+44-7815-838-558]&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;&quot;&gt;&lt;font&nbsp;class=&quot;Apple-style-span&quot;&nbsp;face=&quot;arial&quot;&nbsp;size=&quot;3&quot;&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;border-collapse:&nbsp;collapse;&nbsp;font-size:&nbsp;13px;&nbsp;&quot;&gt;&lt;i&gt;&lt;/i&gt;&lt;/span&gt;&lt;i&gt;&lt;/i&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;<br>
&lt;/div&gt;<br>
<br>
&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;2&nbsp;Jul&nbsp;2012,&nbsp;at&nbsp;17:21,&nbsp;Elias&nbsp;Levy&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Jul&nbsp;2,&nbsp;2012&nbsp;at&nbsp;8:50&nbsp;AM,&nbsp;Steve&nbsp;Powell&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:spowell@vmware.com&quot;&nbsp;target=&quot;_blank&quot;&gt;spowell@vmware.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
&lt;div&nbsp;style=&quot;word-wrap:break-word&quot;&gt;&lt;div&gt;&lt;div&gt;STOMP&nbsp;doesn't&nbsp;know&nbsp;that&nbsp;a&nbsp;queue&nbsp;is&nbsp;HA&nbsp;and&nbsp;will&nbsp;not&nbsp;mend&nbsp;a&nbsp;broken&lt;/div&gt;&lt;div&gt;subscription;&nbsp;however,&nbsp;the&nbsp;subscription&nbsp;shouldn't&nbsp;be&nbsp;broken&nbsp;unless&nbsp;the&lt;/div&gt;&lt;div&gt;broker&nbsp;connected&nbsp;to&nbsp;goes&nbsp;down,&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;connection&nbsp;will&nbsp;be&lt;/div&gt;<br>
<br>
&lt;div&gt;lost,&nbsp;the&nbsp;STOMP&nbsp;session&nbsp;will&nbsp;fail,&nbsp;and&nbsp;the&nbsp;subscription&nbsp;with&nbsp;it.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Why&nbsp;do&nbsp;you&nbsp;say&nbsp;that&nbsp;the&nbsp;subscription&nbsp;will&nbsp;not&nbsp;be&nbsp;broken&nbsp;unless&nbsp;the&nbsp;broker&nbsp;connected&nbsp;to&nbsp;(I&nbsp;assume&nbsp;by&nbsp;the&nbsp;STOMP&nbsp;client)&nbsp;goes&nbsp;down?&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;understanding&nbsp;is&nbsp;that&nbsp;with&nbsp;a&nbsp;HA&nbsp;queue&nbsp;if&nbsp;the&nbsp;node&nbsp;hosting&nbsp;the&nbsp;HA&nbsp;queue&nbsp;master&nbsp;goes&nbsp;down,&nbsp;the&nbsp;new&nbsp;promoted&nbsp;HA&nbsp;queue&nbsp;master&nbsp;considers&nbsp;all&nbsp;previous&nbsp;subscriptions&nbsp;to&nbsp;have&nbsp;been&nbsp;disconnected,&nbsp;and&nbsp;issues&nbsp;a&nbsp;consumer&nbsp;cancelation&nbsp;to&nbsp;all&nbsp;consumers&nbsp;of&nbsp;those&nbsp;subscriptions&nbsp;that&nbsp;support&nbsp;the&nbsp;feature.&nbsp;&amp;nbsp;Thus,&nbsp;a&nbsp;consumer&nbsp;that&nbsp;does&nbsp;not&nbsp;support&nbsp;consumer&nbsp;cancelation&nbsp;will&nbsp;believe&nbsp;his&nbsp;subscription&nbsp;to&nbsp;the&nbsp;HA&nbsp;queue&nbsp;is&nbsp;still&nbsp;valid&nbsp;and&nbsp;wait&amp;nbsp;indefinitely&amp;nbsp;for&nbsp;messages&nbsp;that&nbsp;will&nbsp;never&nbsp;arrive.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Am&nbsp;I&nbsp;wrong?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;By&nbsp;this&nbsp;logic,&nbsp;if&nbsp;the&nbsp;RMQ&nbsp;STOMP&nbsp;proxy&nbsp;does&nbsp;not&nbsp;handle&nbsp;consumer&nbsp;cancelations,&nbsp;then&nbsp;its&nbsp;rather&nbsp;dangerous&nbsp;to&nbsp;use&nbsp;it&nbsp;to&nbsp;consume&nbsp;from&nbsp;a&nbsp;HA&nbsp;queue.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
Elias&nbsp;Levy&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
