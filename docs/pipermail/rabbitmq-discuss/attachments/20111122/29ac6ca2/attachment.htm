<tt>
&lt;div&gt;Ok,&nbsp;now&nbsp;I&nbsp;understand,&nbsp;thanks.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;I&nbsp;find&nbsp;strange&nbsp;that&nbsp;primitiveCall&nbsp;do&nbsp;not&nbsp;follow&nbsp;the&nbsp;signature&nbsp;of&nbsp;original&nbsp;functions,&nbsp;with&nbsp;exchange&nbsp;and&nbsp;routing&nbsp;key&nbsp;provided&nbsp;along&nbsp;with&nbsp;the&nbsp;message.&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;I am&nbsp;using&nbsp;extensively&nbsp;routing&nbsp;facilities&nbsp;of&nbsp;amqp,&nbsp;and&nbsp;I&nbsp;need&nbsp;to&nbsp;manage&nbsp;thousands&nbsp;of clients,&nbsp;one&nbsp;per&nbsp;routing&nbsp;key&nbsp;(or&nbsp;do&nbsp;you&nbsp;think&nbsp;creating&nbsp;a&nbsp;channel&nbsp;and a&nbsp;private&nbsp;queue&nbsp;is&nbsp;cheap&nbsp;enough&nbsp;to&nbsp;be&nbsp;done&nbsp;tens&nbsp;of&nbsp;time&nbsp;per&nbsp;second?)&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;I&nbsp;guess you&nbsp;designed&nbsp;this&nbsp;RpcClient&nbsp;class&nbsp;more&nbsp;as&nbsp;an&nbsp;example,&nbsp;to&nbsp;be&nbsp;customized?&nbsp;That&amp;#39;s fine&nbsp;but&nbsp;code&nbsp;of&nbsp;RpcClient&nbsp;is&nbsp;not&nbsp;that&nbsp;simple&nbsp;and&nbsp;I&nbsp;would&nbsp;have&nbsp;prefered&nbsp;not&nbsp;to&nbsp;maintain&nbsp;that&nbsp;kind&nbsp;of&nbsp;risky&nbsp;low-level&nbsp;things...&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;Would&nbsp;you&nbsp;consider&nbsp;putting&nbsp;a&nbsp;primitiveCall(String&nbsp;exchange,&nbsp;String&nbsp;routingKey,&nbsp;AMQP.BasicProperties&nbsp;props,&nbsp;byte[]&nbsp;message)&nbsp;in&nbsp;a&nbsp;future&nbsp;release?&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;<br>
&lt;div&gt;John&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt; &lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2011/11/21&nbsp;Matthias&nbsp;Radestock&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:matthias@rabbitmq.com&quot;&gt;matthias@rabbitmq.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;PADDING-LEFT:&nbsp;1ex;&nbsp;MARGIN:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;BORDER-LEFT:&nbsp;#ccc&nbsp;1px&nbsp;solid&quot;&gt;<br>
&lt;div&nbsp;class=&quot;im&quot;&gt;On&nbsp;21/11/11&nbsp;09:11,&nbsp;john&nbsp;doe&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;PADDING-LEFT:&nbsp;1ex;&nbsp;MARGIN:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;BORDER-LEFT:&nbsp;#ccc&nbsp;1px&nbsp;solid&quot;&gt;Thank&nbsp;you&nbsp;Matthias.&lt;br&gt;If&nbsp;this&nbsp;class&nbsp;is&nbsp;known&nbsp;to&nbsp;*not*&nbsp;be&nbsp;threadsafe,&nbsp;why&nbsp;is&nbsp;there&nbsp;a&lt;br&gt;&amp;quot;synchronized&amp;quot;&nbsp;statement&nbsp;in&nbsp;primitiveCall?&nbsp;It&nbsp;somewhat&nbsp;confuses&nbsp;me.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;That&nbsp;synchronisation&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;coordination&nbsp;of&nbsp;the&nbsp;thread&nbsp;issuing&nbsp;a&nbsp;call&nbsp;with&nbsp;the&nbsp;thread&nbsp;on&nbsp;which&nbsp;the&nbsp;reply&nbsp;arrives.&lt;br&gt;&lt;br&gt;The&nbsp;code&nbsp;calls&nbsp;_channel.basicPublish,&nbsp;which&nbsp;is&nbsp;not&nbsp;threadsafe,&nbsp;outside&nbsp;of&nbsp;any&nbsp;synchronisation&nbsp;context.&nbsp;Hence&nbsp;it&nbsp;is&nbsp;not&nbsp;safe&nbsp;to&nbsp;issue&nbsp;calls&nbsp;from&nbsp;multiple&nbsp;threads&nbsp;or&nbsp;use&nbsp;the&nbsp;underlying&nbsp;channel&nbsp;in&nbsp;other&nbsp;threads.&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;Matthias.&lt;br&gt;&lt;/font&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;<br>

</tt>
