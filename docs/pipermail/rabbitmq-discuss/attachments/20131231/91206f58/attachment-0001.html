<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;hope&nbsp;someone&nbsp;can&nbsp;help&nbsp;me&nbsp;out&nbsp;with&nbsp;some&nbsp;advice&nbsp;,&nbsp;cause&nbsp;I&nbsp;am&nbsp;struggling&nbsp;for&nbsp;quite&nbsp;a&nbsp;while&nbsp;now.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;some&nbsp;ad&nbsp;server&nbsp;application&nbsp;running&nbsp;on&nbsp;AWS&nbsp;ec2.&nbsp;The&nbsp;server&nbsp;are&nbsp;tomcats&nbsp;that&nbsp;can&nbsp;scale&nbsp;,&nbsp;with&nbsp;the&nbsp;load&nbsp;right&nbsp;now&nbsp;I&nbsp;have&nbsp;10&nbsp;servers&nbsp;running.&nbsp;The&nbsp;overall&nbsp;load&nbsp;on&nbsp;the&nbsp;servers&nbsp;is&nbsp;something&nbsp;1K&nbsp;rps&nbsp;.&nbsp;It&nbsp;produces&nbsp;twice&nbsp;as&nbsp;much&nbsp;messages&nbsp;that&nbsp;have&nbsp;to&nbsp;be&nbsp;persisted&nbsp;eventually.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Right&nbsp;now&nbsp;the&nbsp;servers&nbsp;send&nbsp;these&nbsp;messages&nbsp;to&nbsp;rabbitmq&nbsp;instances&nbsp;(&nbsp;that&nbsp;are&nbsp;not&nbsp;connected&nbsp;to&nbsp;a&nbsp;cluster&nbsp;)&nbsp;,&nbsp;each&nbsp;tomcat&nbsp;has&nbsp;an&nbsp;open&nbsp;connection&nbsp;to&nbsp;every&nbsp;rabbitmq&nbsp;broker&nbsp;and&nbsp;just&nbsp;picks&nbsp;one&nbsp;randomly&nbsp;to&nbsp;send&nbsp;a&nbsp;message.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;the&nbsp;other&nbsp;side&nbsp;I&nbsp;have&nbsp;a&nbsp;consumer&nbsp;that&nbsp;consumes&nbsp;all&nbsp;the&nbsp;messages&nbsp;from&nbsp;all&nbsp;the&nbsp;brokers.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;brokers&nbsp;are&nbsp;running&nbsp;on&nbsp;a&nbsp;medium&nbsp;instance&nbsp;(&nbsp;thats&nbsp;1&nbsp;cpu&nbsp;and&nbsp;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;3.5&nbsp;GB&nbsp;ram&nbsp;)&nbsp;and&nbsp;the&nbsp;queues&nbsp;are&nbsp;not&nbsp;persistent&nbsp;or&nbsp;mirrored.&nbsp;The&nbsp;issue&nbsp;is&nbsp;that&nbsp;the&nbsp;brokers&nbsp;get&nbsp;to&nbsp;100&nbsp;cpu&nbsp;at&nbsp;speeds&nbsp;reaching&nbsp;700&nbsp;messages/sec.&nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;I&nbsp;guess&nbsp;connecting&nbsp;the&nbsp;brokers&nbsp;to&nbsp;a&nbsp;cluster&nbsp;will&nbsp;only&nbsp;decrease&nbsp;the&nbsp;performance&nbsp;also&nbsp;i&nbsp;will&nbsp;have&nbsp;to&nbsp;configure&nbsp;a&nbsp;tcp&nbsp;load&nbsp;balancer&nbsp;to&nbsp;connect&nbsp;to&nbsp;the&nbsp;cluster&nbsp;from&nbsp;tomcats.&nbsp;Also&nbsp;creating&nbsp;a&nbsp;rabbitmq&nbsp;cluster&nbsp;is&nbsp;not&nbsp;trivial&nbsp;at&nbsp;all&nbsp;,&nbsp;especially&nbsp;if&nbsp;the&nbsp;brokers&nbsp;are&nbsp;on&nbsp;an&nbsp;auto&nbsp;scaling&nbsp;group.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;So&nbsp;for&nbsp;the&nbsp;question&nbsp;:&nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif;&quot;&gt;I&nbsp;read&nbsp;some&nbsp;benchmarks&nbsp;out&nbsp;there&nbsp;and&nbsp;could&nbsp;not&nbsp;understand&nbsp;whether&nbsp;the&nbsp;700m/sec&nbsp;is&nbsp;slow&nbsp;or&nbsp;not.&nbsp;I&nbsp;can&nbsp;use&nbsp;a&nbsp;bigger&nbsp;instance&nbsp;with&nbsp;more&nbsp;CPU&nbsp;,&nbsp;but&nbsp;will&nbsp;the&nbsp;load&nbsp;grow&nbsp;linear&nbsp;?&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif;&quot;&gt;&nbsp;&lt;/span&gt;&lt;/li&gt;&lt;li&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;Do&nbsp;you&nbsp;spot&nbsp;anything&nbsp;wrong&nbsp;in&nbsp;the&nbsp;architecture&nbsp;?&nbsp;Can&nbsp;you&nbsp;think&nbsp;of&nbsp;an&nbsp;overall&nbsp;better&nbsp;approach&nbsp;in&nbsp;the&nbsp;message&nbsp;chain&nbsp;?&lt;/span&gt;&lt;/font&gt;&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;Thanks&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;Roman&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#000000&quot;&nbsp;face=&quot;verdana,&nbsp;arial,&nbsp;helvetica,&nbsp;clean,&nbsp;sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;line-height:&nbsp;18px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
