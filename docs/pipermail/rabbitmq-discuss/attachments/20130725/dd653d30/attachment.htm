<tt>
Managed&nbsp;to&nbsp;get&nbsp;it&nbsp;working:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;passed&nbsp;in&nbsp;my&nbsp;own&nbsp;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;ExecutorService&lt;/font&gt;&nbsp;when&nbsp;creating&nbsp;the&nbsp;connection&nbsp;and&nbsp;stored&nbsp;it&nbsp;in&nbsp;the&nbsp;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;ServletContextListener&lt;/font&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;Used&nbsp;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;Executors.newCachedThreadPool();&lt;/font&gt;&nbsp;-&amp;gt;&nbsp;not&nbsp;necessary,&nbsp;but&nbsp;is&nbsp;good&nbsp;as&nbsp;many&nbsp;short&nbsp;executions,&nbsp;and&nbsp;unused&nbsp;threads&nbsp;die&nbsp;after&nbsp;60s&nbsp;idle&nbsp;time&lt;/div&gt;&lt;div&gt;*&nbsp;Shutdown&nbsp;threads&nbsp;in&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;&amp;nbsp;ServletContextListener.destroyed()&lt;/font&gt;.&nbsp;First&nbsp;thought&nbsp;this&nbsp;didn't&nbsp;work&nbsp;as&nbsp;my&nbsp;breakpoint&nbsp;was&nbsp;not&nbsp;reached,&nbsp;but&nbsp;somehow,&nbsp;breakpoint&nbsp;just&nbsp;seem&nbsp;not&nbsp;to&nbsp;work&nbsp;there&nbsp;(could&nbsp;make&nbsp;sense&nbsp;when&nbsp;I&nbsp;think&nbsp;about&nbsp;it,&nbsp;I'm&nbsp;stopping&nbsp;the&nbsp;process&nbsp;so&nbsp;debugger&nbsp;might&nbsp;already&nbsp;be&nbsp;detached).&nbsp;But&nbsp;logging&nbsp;assures&nbsp;me&nbsp;now&nbsp;my&nbsp;code&nbsp;is&nbsp;executed.&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;ServletContextListener.destroyed()&nbsp;{&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;executorService.shutdown();&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;executorService.awaitTermination(20,&nbsp;TimeUnit.SECONDS);&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;that's&nbsp;it&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Op&nbsp;woensdag&nbsp;24&nbsp;juli&nbsp;2013&nbsp;17:08:32&nbsp;UTC+2&nbsp;schreef&nbsp;steven....@i-develop.be&nbsp;het&nbsp;volgende:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:&nbsp;0;margin-left:&nbsp;0.8ex;border-left:&nbsp;1px&nbsp;#ccc&nbsp;solid;padding-left:&nbsp;1ex;&quot;&gt;I'm&nbsp;trying&nbsp;to&nbsp;setup&nbsp;RabbitMQ&nbsp;RPC&nbsp;in&nbsp;a&nbsp;web&nbsp;project&nbsp;(like&nbsp;suggested&nbsp;in&nbsp;&lt;a&nbsp;href=&quot;http://www.rabbitmq.com/tutorials/tutorial-six-java.html&quot;&nbsp;target=&quot;_blank&quot;&gt;tutorial&nbsp;6&lt;/a&gt;).&nbsp;It&nbsp;works&nbsp;as&nbsp;intended,&nbsp;but&nbsp;when&nbsp;I&nbsp;try&nbsp;to&nbsp;shutdown&nbsp;Tomcat,&nbsp;the&nbsp;shutdown&nbsp;hangs&nbsp;as&nbsp;soon&nbsp;as&nbsp;I&nbsp;have&nbsp;created&nbsp;a&nbsp;consumer&nbsp;listening&nbsp;to&nbsp;the&nbsp;rpc&nbsp;response.&amp;nbsp;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;jstack&nbsp;and&nbsp;some&nbsp;debugging&nbsp;learned&nbsp;me&nbsp;that&nbsp;for&nbsp;each&nbsp;created&nbsp;consumer,&nbsp;a&nbsp;thread&nbsp;is&nbsp;created.&nbsp;And&nbsp;those&nbsp;threads&nbsp;are&nbsp;preventing&nbsp;Tomcat&nbsp;from&nbsp;shutting&nbsp;down&nbsp;(as&nbsp;they&nbsp;are&nbsp;not&nbsp;managed&nbsp;by&nbsp;Tomcat).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Looking&nbsp;at&nbsp;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;ConsumerWorkService&lt;/font&gt;,&nbsp;there&nbsp;is&nbsp;a&nbsp;method&nbsp;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;addWork&lt;/font&gt;,&nbsp;which&nbsp;creates&nbsp;a&nbsp;new&nbsp;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;WorkPoolRunnable&lt;/font&gt;&nbsp;and&nbsp;if&nbsp;I&nbsp;have&nbsp;understood&nbsp;it&nbsp;correctly,&nbsp;those&nbsp;Runnable's&nbsp;are&nbsp;only&nbsp;stopped&nbsp;when&nbsp;the&nbsp;'key',&nbsp;being&nbsp;the&nbsp;channel&nbsp;is&nbsp;stopped.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;find&nbsp;that&nbsp;a&nbsp;bit&nbsp;odd..&nbsp;I&nbsp;would&nbsp;expect&nbsp;that&nbsp;when&nbsp;I&nbsp;call&amp;nbsp;&lt;font&nbsp;face=&quot;courier&nbsp;new,&nbsp;monospace&quot;&gt;stub.channel.basicCancel(&lt;wbr&gt;consumer.getConsumerTag());&nbsp;&lt;/font&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;the&nbsp;runnable&nbsp;for&nbsp;the&nbsp;consumer&nbsp;is&nbsp;removed.&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Or&nbsp;am&nbsp;I&nbsp;completely&amp;nbsp;wrong&nbsp;about&nbsp;my&nbsp;findings&nbsp;and&nbsp;is&nbsp;something&nbsp;else&nbsp;going&nbsp;on?&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;
</tt>
