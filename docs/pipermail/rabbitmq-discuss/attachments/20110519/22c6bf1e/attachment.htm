<tt>
I&amp;#39;m&nbsp;trying&nbsp;to&nbsp;understand&nbsp;how&nbsp;RabbitMQ&nbsp;behaves&nbsp;under&nbsp;failure&nbsp;conditions,&nbsp;specifically&nbsp;when&nbsp;using&nbsp;the&nbsp;Net::RabbitMQ&nbsp;Perl&nbsp;module.&lt;br&gt;&lt;br&gt;We&nbsp;have&nbsp;RabbitMQ&nbsp;set&nbsp;up&nbsp;with&nbsp;three&nbsp;nodes,&nbsp;one&nbsp;on&nbsp;the&nbsp;backend,&nbsp;which&nbsp;holds&nbsp;the&nbsp;actual&nbsp;queues,&nbsp;and&nbsp;two&nbsp;on&nbsp;the&nbsp;frontend,&nbsp;which&nbsp;receive&nbsp;publish&nbsp;requests.&lt;br&gt;<br>
&lt;br&gt;RabbitMQ&nbsp;2.2.0&lt;br&gt;Net::RabbitMQ&nbsp;0.1.8&lt;br&gt;&lt;br&gt;&lt;br&gt;Below&nbsp;is&nbsp;the&nbsp;chart&nbsp;of&nbsp;behaviors&nbsp;that&nbsp;I&nbsp;have&nbsp;observed.&lt;br&gt;&lt;br&gt;&amp;quot;+&amp;quot;&nbsp;means&nbsp;the&nbsp;behavior&nbsp;is&nbsp;as&nbsp;I&nbsp;expected:&nbsp;either&nbsp;the&nbsp;message&nbsp;is&nbsp;successfully&nbsp;queued,&nbsp;or&nbsp;an&nbsp;error&nbsp;is&nbsp;thrown.&lt;br&gt;<br>
&amp;quot;-&amp;quot;&nbsp;means&nbsp;the&nbsp;behavior&nbsp;is&nbsp;not&nbsp;as&nbsp;I&nbsp;expected,&nbsp;but&nbsp;can&nbsp;be&nbsp;managed:&nbsp;specifically,&nbsp;the&nbsp;process&nbsp;receives&nbsp;a&nbsp;SIGPIPE,&nbsp;which&nbsp;I&nbsp;can&nbsp;trap&nbsp;and&nbsp;recover&nbsp;from.&lt;br&gt;&amp;quot;!&amp;quot;&nbsp;means&nbsp;the&nbsp;behavior&nbsp;is&nbsp;not&nbsp;as&nbsp;I&nbsp;expected,&nbsp;and&nbsp;cannot&nbsp;be&nbsp;managed:&nbsp;the&nbsp;message&nbsp;is&nbsp;not&nbsp;queued&nbsp;but&nbsp;no&nbsp;error&nbsp;is&nbsp;thrown&nbsp;and/or&nbsp;the&nbsp;process&nbsp;hangs.&lt;br&gt;<br>
&lt;br&gt;&amp;quot;App&nbsp;down&amp;quot;&nbsp;means&nbsp;I&nbsp;ran&nbsp;`rabbitmqctl&nbsp;stop_app`. &nbsp;&amp;quot;Daemon&nbsp;down&amp;quot;&nbsp;means&nbsp;I&nbsp;ran&nbsp;`rabbitmqctl&nbsp;stop`.&lt;br&gt;&lt;br&gt; &nbsp;As&nbsp;publishing&nbsp;process&nbsp;starts&nbsp;up:&lt;br&gt;&lt;br&gt;   &nbsp;Remote&nbsp;daemon&nbsp;up,&nbsp;app&nbsp;up&lt;br&gt;     &nbsp;+&nbsp;Everything&nbsp;okay&lt;br&gt;<br>
&lt;br&gt;   &nbsp;Remote&nbsp;daemon&nbsp;up,&nbsp;app&nbsp;down&lt;br&gt;     &nbsp;!&nbsp;Net::RabbitMQ&nbsp;hangs&nbsp;when&nbsp;declaring&nbsp;queue&lt;br&gt;&lt;br&gt;   &nbsp;Remote&nbsp;daemon&nbsp;down&lt;br&gt;     &nbsp;+&nbsp;Net::RabbitMQ&nbsp;throws&nbsp;error&nbsp;when&nbsp;declaring&nbsp;queue&lt;br&gt;       &nbsp;&amp;quot;Declaring&nbsp;queue:&nbsp;server&nbsp;channel&nbsp;error&nbsp;404,&nbsp;message:&nbsp;NOT_FOUND&nbsp;-&nbsp;no&nbsp;queue&nbsp;&amp;#39;test&amp;#39;&nbsp;in&nbsp;vhost&nbsp;&amp;#39;/&amp;#39;&amp;quot;&lt;br&gt;<br>
&lt;br&gt;   &nbsp;Local&nbsp;daemon&nbsp;up,&nbsp;app&nbsp;down&lt;br&gt;     &nbsp;+&nbsp;Net::RabbitMQ&nbsp;throws&nbsp;error&nbsp;when&nbsp;connecting&lt;br&gt;       &nbsp;&amp;quot;Opening&nbsp;socket:&nbsp;Connection&nbsp;refused&amp;quot;&lt;br&gt;&lt;br&gt;   &nbsp;Local&nbsp;daemon&nbsp;down&lt;br&gt;     &nbsp;+&nbsp;Net::RabbitMQ&nbsp;throws&nbsp;error&nbsp;when&nbsp;connecting&lt;br&gt;<br>
       &nbsp;&amp;quot;Opening&nbsp;socket:&nbsp;Connection&nbsp;refused&amp;quot;&lt;br&gt;&lt;br&gt;&lt;br&gt; &nbsp;After&nbsp;publishing&nbsp;process&nbsp;starts&nbsp;up:&lt;br&gt;&lt;br&gt;   &nbsp;Local&nbsp;app&nbsp;goes&nbsp;down&lt;br&gt;     &nbsp;-&nbsp;Process&nbsp;receives&nbsp;SIGPIPE&lt;br&gt;&lt;br&gt;   &nbsp;Local&nbsp;daemon&nbsp;goes&nbsp;down&lt;br&gt;     &nbsp;-&nbsp;Process&nbsp;receives&nbsp;SIGPIPE&lt;br&gt;<br>
&lt;br&gt;   &nbsp;Remote&nbsp;app&nbsp;goes&nbsp;down&lt;br&gt;     &nbsp;!&nbsp;Net::RabbitMQ&nbsp;falsely&nbsp;indicates&nbsp;success&nbsp;when&nbsp;publishing,&nbsp;then&nbsp;hangs&nbsp;(in&nbsp;DESTROY?)&lt;br&gt;&lt;br&gt;   &nbsp;Remote&nbsp;daemon&nbsp;goes&nbsp;down&lt;br&gt;     &nbsp;!&nbsp;Net::RabbitMQ&nbsp;falsely&nbsp;indicates&nbsp;success&nbsp;when&nbsp;publishing&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;   &nbsp;Local&nbsp;app&nbsp;goes&nbsp;down,&nbsp;comes&nbsp;back&nbsp;up&lt;br&gt;     &nbsp;-&nbsp;Process&nbsp;receives&nbsp;SIGPIPE&lt;br&gt;&lt;br&gt;   &nbsp;Local&nbsp;daemon&nbsp;goes&nbsp;down,&nbsp;comes&nbsp;back&nbsp;up&lt;br&gt;     &nbsp;-&nbsp;Process&nbsp;receives&nbsp;SIGPIPE&lt;br&gt;&lt;br&gt;   &nbsp;Remote&nbsp;app&nbsp;goes&nbsp;down,&nbsp;comes&nbsp;back&nbsp;up&lt;br&gt;     &nbsp;+&nbsp;Everything&nbsp;okay&lt;br&gt;<br>
&lt;br&gt;   &nbsp;Remote&nbsp;daemon&nbsp;goes&nbsp;down,&nbsp;comes&nbsp;back&nbsp;up&lt;br&gt;     &nbsp;+&nbsp;Everything&nbsp;okay&lt;br&gt;&lt;br&gt;&lt;br&gt;Have&nbsp;other&nbsp;people&nbsp;had&nbsp;these&nbsp;problems&nbsp;with&nbsp;Net::RabbitMQ? &nbsp;Can&nbsp;we&nbsp;resolve&nbsp;these&nbsp;issues&nbsp;by&nbsp;changing&nbsp;something&nbsp;in&nbsp;our&nbsp;RabbitMQ&nbsp;configuration?&lt;br&gt;<br>
&lt;br&gt;&lt;br&gt;thanks,&lt;br&gt;Ronald&lt;br&gt;&lt;br&gt;&lt;br&gt;P.S.&nbsp;Here&amp;#39;s&nbsp;my&nbsp;script.&lt;br&gt;&lt;br&gt;#!/usr/local/bin/perl&lt;br&gt;&lt;br&gt;use&nbsp;strict;&lt;br&gt;use&nbsp;warnings;&lt;br&gt;&lt;br&gt;use&nbsp;Net::RabbitMQ;&lt;br&gt;&lt;br&gt;$|&nbsp;=&nbsp;1;&lt;br&gt;&lt;br&gt;$SIG{&amp;#39;PIPE&amp;#39;}&nbsp;=&nbsp;sub&nbsp;{&nbsp;die&nbsp;&amp;quot;SIGPIPE\n&amp;quot;&nbsp;};&lt;br&gt;<br>
&lt;br&gt;my&nbsp;$mq&nbsp;=&nbsp;Net::RabbitMQ-&amp;gt;new();&lt;br&gt;&lt;br&gt;alarm(10);&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;Connecting\n&amp;quot;;&lt;br&gt;$mq-&amp;gt;connect(&amp;#39;localhost&amp;#39;,&nbsp;{&nbsp;user&nbsp;=&amp;gt;&nbsp;&amp;#39;engagement&amp;#39;,&nbsp;password&nbsp;=&amp;gt;&nbsp;&amp;#39;********&amp;#39;&nbsp;})&lt;br&gt; &nbsp;or&nbsp;die&nbsp;&amp;quot;Can&amp;#39;t&nbsp;connect&nbsp;to&nbsp;RabbitMQ\n&amp;quot;;&lt;br&gt;<br>
&lt;br&gt;print&nbsp;&amp;quot;Opening&nbsp;channel\n&amp;quot;;&lt;br&gt;$mq-&amp;gt;channel_open(1);&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;Declaring&nbsp;exchange\n&amp;quot;;&lt;br&gt;$mq-&amp;gt;exchange_declare(1,&nbsp;&amp;#39;ee_exchange&amp;#39;,&nbsp;{&nbsp;durable&nbsp;=&amp;gt;&nbsp;1&nbsp;});&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;Declaring&nbsp;queue\n&amp;quot;;&lt;br&gt;<br>
$mq-&amp;gt;queue_declare(1,&nbsp;&amp;#39;test&amp;#39;,&nbsp;{&nbsp;durable&nbsp;=&amp;gt;&nbsp;1&nbsp;});&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;Binding&nbsp;queue\n&amp;quot;;&lt;br&gt;$mq-&amp;gt;queue_bind(1,&nbsp;&amp;#39;test&amp;#39;,&nbsp;&amp;#39;ee_exchange&amp;#39;,&nbsp;&amp;#39;ee_test&amp;#39;);&lt;br&gt;&lt;br&gt;alarm(0);&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;&amp;gt;&nbsp;&amp;quot;;&lt;br&gt;<br>
&amp;lt;&amp;gt;;&lt;br&gt;&lt;br&gt;alarm(10);&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;Publishing&nbsp;message\n&amp;quot;;&lt;br&gt;my&nbsp;$rc&nbsp;=&lt;br&gt; &nbsp;$mq-&amp;gt;publish(1,&nbsp;&amp;#39;ee_test&amp;#39;,&nbsp;&amp;#39;hello&nbsp;world!&amp;#39;,&lt;br&gt;              &nbsp;{&nbsp;exchange&nbsp;=&amp;gt;&nbsp;&amp;#39;ee_exchange&amp;#39;,&nbsp;mandatory&nbsp;=&amp;gt;&nbsp;1,&nbsp;immediate&nbsp;=&amp;gt;&nbsp;0&nbsp;},&lt;br&gt;<br>
              &nbsp;{&nbsp;delivery_mode&nbsp;=&amp;gt;&nbsp;2&nbsp;});&lt;br&gt;print&nbsp;&amp;quot;Result:&nbsp;$rc\n&amp;quot;;&lt;br&gt;&lt;br&gt;__END__&lt;br&gt;&lt;br&gt;<br>

</tt>
