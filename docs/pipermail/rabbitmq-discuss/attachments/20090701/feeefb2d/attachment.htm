<tt>
Dear&nbsp;Tony,&lt;br&gt;&lt;br&gt;thank&nbsp;you&nbsp;for&nbsp;your&nbsp;email&nbsp;concerning&nbsp;the&nbsp;0.9.1&nbsp;C&nbsp;client&nbsp;(*),&nbsp;it&nbsp;is&nbsp;obviously&nbsp;the&nbsp;right&nbsp;way&nbsp;to&nbsp;go,&nbsp;but&nbsp;it&nbsp;would&nbsp;force&nbsp;me&nbsp;to&nbsp;deploy&nbsp;0.9.1&nbsp;in&nbsp;our&nbsp;infrastructure,&nbsp;I&nbsp;was&nbsp;hoping&nbsp;to&nbsp;go&nbsp;live&nbsp;with&nbsp;the&nbsp;current&nbsp;setup&nbsp;in&nbsp;the&nbsp;next&nbsp;couple&nbsp;of&nbsp;weeks.&nbsp;So,&nbsp;please&nbsp;forgive&nbsp;me&nbsp;if&nbsp;I&nbsp;insist&nbsp;on&nbsp;debugging&nbsp;the&nbsp;current&nbsp;setup.&lt;br&gt;<br>
&lt;br&gt;The&nbsp;reason&nbsp;I&nbsp;am&nbsp;annoying&nbsp;you&nbsp;guys&nbsp;with&nbsp;this&nbsp;is&nbsp;that,&nbsp;surely,&nbsp;you&nbsp;must&nbsp;have&nbsp;come&nbsp;across&nbsp;situations&nbsp;when&nbsp;your&nbsp;system&nbsp;runs&nbsp;out&nbsp;of&nbsp;file&nbsp;descriptors&nbsp;while&nbsp;you&nbsp;are&nbsp;opening/closing&nbsp;tcp&nbsp;connections&nbsp;in&nbsp;stress&nbsp;tests. &nbsp;Valentino,&nbsp;for&nbsp;example,&nbsp;has&nbsp;posted&nbsp;some&nbsp;suggestions&nbsp;concerning&nbsp;kernel&nbsp;params&nbsp;(please&nbsp;see&nbsp;the&nbsp;second&nbsp;link&nbsp;below).&lt;br&gt;<br>
&lt;br&gt;Here&amp;#39;s&nbsp;what&nbsp;I&amp;#39;m&nbsp;trying&nbsp;to&nbsp;do:&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt; &nbsp;+------------+    &nbsp;+----------------+     &nbsp;+-------------+&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt; &nbsp;|&nbsp;DB&nbsp;Trigger&nbsp;|   &nbsp;\|  &nbsp;TCP&nbsp;listener&nbsp;|    &nbsp;\|  &nbsp;RabbitMQ &nbsp;|&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt; &nbsp;|    &nbsp;(C)   &nbsp;&amp;#39;&amp;#39;&amp;#39;&amp;#39;&amp;#39;/|   &nbsp;(Erlang)   &nbsp;&amp;#39;&amp;#39;&amp;#39;&amp;#39;&amp;#39;&amp;#39;/|  &nbsp;(Erlang) &nbsp;|&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt; &nbsp;+------------+    &nbsp;+----------------+     &nbsp;+-------------+&lt;/span&gt;&lt;br&nbsp;style=&quot;font-family:&nbsp;courier&nbsp;new,monospace;&quot;&gt;<br>
&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;got&nbsp;a&nbsp;C&nbsp;trigger&nbsp;function&nbsp;in&nbsp;a&nbsp;database&nbsp;(Postgresql)&nbsp;which&nbsp;opens&nbsp;and&nbsp;closes&nbsp;a&nbsp;new&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;an&nbsp;Erlang&nbsp;node&nbsp;every&nbsp;time&nbsp;it&nbsp;fires.&nbsp;That&amp;#39;s&nbsp;the&nbsp;nature&nbsp;of&nbsp;row-level&nbsp;trigger&nbsp;functions,&nbsp;there&nbsp;is&nbsp;no&nbsp;way&nbsp;I&nbsp;can&nbsp;pool&nbsp;connections/maintain&nbsp;state&nbsp;across&nbsp;invocations.&nbsp;So&nbsp;this&nbsp;is&nbsp;2&nbsp;file&nbsp;descriptors&nbsp;(for&nbsp;2&nbsp;minutes&nbsp;--&nbsp;TIME_WAIT)&nbsp;just&nbsp;getting&nbsp;the&nbsp;message&nbsp;from&nbsp;the&nbsp;trigger&nbsp;to&nbsp;the&nbsp;Erlang&nbsp;node,&nbsp;and&nbsp;then&nbsp;rabbitmq&nbsp;will&nbsp;probably&nbsp;consume&nbsp;some&nbsp;file&nbsp;descriptors&nbsp;for&nbsp;opening/closing&nbsp;channels.&nbsp;The&nbsp;trigger&nbsp;is&nbsp;executed&nbsp;several&nbsp;times&nbsp;per&nbsp;second,&nbsp;say&nbsp;every&nbsp;50-100ms,&nbsp;I&nbsp;have&nbsp;increased&nbsp;the&nbsp;user&amp;#39;s&nbsp;nofile&nbsp;ulimit&nbsp;to&nbsp;32768,&nbsp;I&nbsp;have&nbsp;increased&nbsp;the&nbsp;number&nbsp;of&nbsp;concurrent&nbsp;Erlang&nbsp;processes&nbsp;to&nbsp;millions,&nbsp;I&nbsp;have&nbsp;even&nbsp;tried&nbsp;running&nbsp;my&nbsp;tcp&nbsp;acceptor&nbsp;code&nbsp;within&nbsp;the&nbsp;same&nbsp;VM&nbsp;as&nbsp;RabbitMQ,&nbsp;so&nbsp;that&nbsp;I&nbsp;can&nbsp;use&nbsp;a&nbsp;direct&nbsp;client&nbsp;connection&nbsp;and&nbsp;avoid&nbsp;any&nbsp;TCP&nbsp;overhead&nbsp;between&nbsp;the&nbsp;tcp&nbsp;listener&nbsp;and&nbsp;RabbitMQ.&nbsp;At&nbsp;this&nbsp;stage,&nbsp;I&amp;#39;m&nbsp;not&nbsp;consuming&nbsp;the&nbsp;(persistent)&nbsp;messages&nbsp;as&nbsp;they&nbsp;come&nbsp;in,&nbsp;they&nbsp;are&nbsp;stored&nbsp;in&nbsp;mnesia.&nbsp;And&nbsp;I&nbsp;either&nbsp;run&nbsp;out&nbsp;of&nbsp;file&nbsp;descriptors&nbsp;(separate&nbsp;VMs)&nbsp;or&nbsp;the&nbsp;RabbitMQ&nbsp;VM&nbsp;just&nbsp;dies&nbsp;after&nbsp;approx.&nbsp;300000&nbsp;messages&nbsp;(if&nbsp;tcp&nbsp;listener&nbsp;is&nbsp;running&nbsp;within&nbsp;RabbitMQ&nbsp;vm).&lt;br&gt;<br>
&lt;br&gt;I&nbsp;guess&nbsp;what&nbsp;I&nbsp;am&nbsp;asking&nbsp;is&nbsp;some&nbsp;feedback/stats,&nbsp;such&nbsp;as&nbsp;throughput&nbsp;limits&nbsp;you&nbsp;have&nbsp;observed&nbsp;with&nbsp;RabbitMQ,&nbsp;mnesia&nbsp;or&nbsp;the&nbsp;operating&nbsp;system,&nbsp;whether&nbsp;deploying&nbsp;0.9.1&nbsp;would&nbsp;lift&nbsp;any&nbsp;barriers,&nbsp;is&nbsp;there&nbsp;something&nbsp;fundamentally&nbsp;wrong&nbsp;with&nbsp;the&nbsp;way&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;use&nbsp;RabbitMQ&nbsp;etc.&nbsp;I&nbsp;remember&nbsp;from&nbsp;the&nbsp;Erlang&nbsp;factory&nbsp;talks&nbsp;you&nbsp;have&nbsp;been&nbsp;working&nbsp;with&nbsp;new&nbsp;persistence/offload&nbsp;to&nbsp;disk&nbsp;mechanisms.&lt;br&gt;<br>
&lt;br&gt;cheers,&nbsp;Michael&lt;br&gt;&lt;br&gt;Links:&lt;br&gt;---------&lt;br&gt;(*)&nbsp;&lt;a&nbsp;href=&quot;http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-June/004337.html&quot;&gt;http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-June/004337.html&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://www.nabble.com/Large-number-of-connections-td22994598.html&quot;&gt;http://www.nabble.com/Large-number-of-connections-td22994598.html&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://www.nabble.com/spawn-problem-td9684760.html&quot;&gt;http://www.nabble.com/spawn-problem-td9684760.html&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>

</tt>
